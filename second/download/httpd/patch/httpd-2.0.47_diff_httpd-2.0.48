diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/build/PrintPath /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/build/PrintPath
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/build/PrintPath	2003-07-07 22:52:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/build/PrintPath	2003-10-25 01:51:18.000000000 +0800
@@ -42,13 +42,13 @@
 ##
 # Now we make the adjustments required for OS/2 and everyone
 # else :)
 #
 # First of all, all OS/2 programs have the '.exe' extension.
 # Next, we adjust PATH (or what was given to us as PATH) to
-# be whitespace seperated directories.
+# be whitespace separated directories.
 # Finally, we try to determine the best flag to use for
 # test/[] to look for an executable file. OS/2 just has '-r'
 # but with other OSs, we do some funny stuff to check to see
 # if test/[] knows about -x, which is the prefered flag.
 ##
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/buildconf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/buildconf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/buildconf	2003-04-16 00:14:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/buildconf	2003-09-03 12:39:13.000000000 +0800
@@ -96,13 +96,15 @@
     echo "or specify the location of the source with " 
     echo "--with-apr=[path to apr] :"
     echo ""
     echo "   cd srclib"
     echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic login"
     echo "      (password 'anoncvs')"
-    echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic co apr"
+    echo ""
+    echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic co \\"
+    echo "      -r APR_0_9_BRANCH apr"
     echo ""
     exit 1
 fi
 if [ ! -d "$apu_src_dir" -o ! -f "$apu_src_dir/Makefile.in" ]; then
     echo ""
     echo "You don't have a copy of the apr-util source in $apu_src_dir. "
@@ -110,13 +112,15 @@
     echo "or specify the location of the source with "
     echo "--with-apr-util=[path to apr-util]:"
     echo ""
     echo "   cd srclib"
     echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic login"
     echo "      (password 'anoncvs')"
-    echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic co apr-util"
+    echo ""
+    echo "   cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic co \\"
+    echo "      -r APU_0_9_BRANCH apr-util"
     echo ""
     exit 1
 fi
 
 # These are temporary until Roy finishes the other build changes
 #
@@ -159,12 +163,16 @@
 
 echo copying build files
 cp $apr_src_dir/build/config.guess $apr_src_dir/build/config.sub \
    $apr_src_dir/build/PrintPath $apr_src_dir/build/apr_common.m4 \
    $apr_src_dir/build/find_apr.m4 $apu_src_dir/build/find_apu.m4 build
 
+# Remove any libtool files so one can switch between libtool 1.3
+# and libtool 1.4 by simply rerunning the buildconf script.
+(cd build ; rm -f ltconfig ltmain.sh)
+
 # Optionally copy libtool-1.3.x files
 if [ -f $apr_src_dir/build/ltconfig ]; then
     cp $apr_src_dir/build/ltconfig build
 fi
 if [ -f $apr_src_dir/build/ltmain.sh ]; then
     cp $apr_src_dir/build/ltmain.sh build
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/CHANGES	2003-07-07 22:51:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/CHANGES	2003-10-25 00:40:36.000000000 +0800
@@ -1,30 +1,187 @@
+Changes with Apache 2.0.48
+  
+  *) SECURITY [CAN-2003-0789]: mod_cgid: Resolve some mishandling of
+     the AF_UNIX socket used to communicate with the cgid daemon and
+     the CGI script.  [Jeff Trawick]
+
+  *) SECURITY [CAN-2003-0542]: Fix buffer overflows in mod_alias and
+     mod_rewrite which occurred if one configured a regular expression
+     with more than 9 captures.  [André Malo]
+
+  *) mod_include: fix segfault which occured if the filename was not
+     set, for example, when processing some error conditions.
+     PR 23836.  [Brian Akins <bakins@web.turner.com>, André Malo]
+
+  *) fix the config parser to support <Foo>..</Foo> containers (no
+     arguments in the opening tag) supported by httpd 1.3. Without
+     this change mod_perl 2.0's <Perl> sections are broken.
+     ["Philippe M. Chiasson" <gozer@cpan.org>]
+
+  *) mod_cgid: fix a hash table corruption problem which could
+     result in the wrong script being cleaned up at the end of a
+     request.  [Jeff Trawick]
+
+  *) Update httpd-*.conf to be clearer in describing the connection
+     between AddType and AddEncoding for defining the meaning of
+     compressed file extensions. [Roy Fielding]
+
+  *) mod_rewrite: Don't die silently when failing to open RewriteLogs.
+     PR 23416.  [André Malo]
+
+  *) mod_rewrite: Fix mod_rewrite's support of the [P] option to send
+     rewritten request using "proxy:". The code was adding multiple "proxy:"
+     fields in the rewritten URI. PR: 13946.
+     [Eider Oliveira <eider@bol.com.br>]
+
+  *) cache_util: Fix ap_check_cache_freshness to check max_age, smax_age, and
+     expires as directed in RFC 2616. [Thomas Castelle tcastelle@generali.fr]
+
+  *) Ensure that ssl-std.conf is generated at configure time, and switch
+     to using the expanded config variables to work the same as
+     httpd-std.conf PR: 19611
+     [Thom May]
+
+  *) mod_ssl: Fix segfaults after renegotiation failure. PR 21370
+     [Hartmut Keil <Hartmut.Keil@adnovum.ch>]
+
+  *) mod_autoindex: If a directory contains a file listed in the
+     DirectoryIndex directive, the folder icon is no longer replaced
+     by the icon of that file. PR 9587.
+     [David Shane Holden <dpejesh@yahoo.com>]
+
+  *) Fixed mod_usertrack to not get false positive matches on the
+     user-tracking cookie's name.  PR 16661.
+     [Manni Wood <manniwood@planet-save.com>]
+
+  *) mod_cache: Fix the cache code so that responses can be cached
+     if they have an Expires header but no Etag or Last-Modified
+     headers. PR 23130.
+     [bjorn@exoweb.net]
+
+  *) mod_log_config: Fix %b log format to write really "-" when 0 bytes
+     were sent (e.g. with 304 or 204 response codes).  [Astrid Keßler]
+
+  *) Modify ap_get_client_block() to note if it has seen EOS.
+     [Justin Erenkrantz]
+
+  *) Fix a bug, where mod_deflate sometimes unconditionally compressed the
+     content if the Accept-Encoding header contained only other tokens than
+     "gzip" (such as "deflate"). PR 21523.  [Joe Orton, André Malo]
+
+  *) Avoid an infinite recursion, which occured if the name of an included
+     config file or directory contained a wildcard character. PR 22194.
+     [André Malo]
+
+  *) mod_ssl: Fix a problem setting variables that represent the
+     client certificate chain.  PR 21371  [Jeff Trawick]
+
+  *) Unix: Handle permissions settings for flock-based mutexes in 
+     unixd_set_global|proc_mutex_perms().  Allow the functions to be
+     called for any type of mutex.  PR 20312  [Jeff Trawick]
+
+  *) ab: Work over non-loopback on Unix again. PR 21495. [Jeff Trawick]
+
+  *) Fix a misleading message from the some of the threaded MPMs when 
+     MaxClients has to be lowered due to the setting of ServerLimit.  
+     [Jeff Trawick]
+
+  *) Lower the severity of the "listener thread didn't exit" message
+     to debug, as it is of interest only to developers.  PR 9011
+     [Jeff Trawick]
+
+  *) MPMs: The bucket brigades subsystem now honors the MaxMemFree setting.
+     [Cliff Woolley, Jean-Jacques Clar]
+
+  *) Install config.nice into the build/ directory to make
+     minor version upgrades easier. [Joshua Slive]
+
+  *) Fix mod_deflate so that it does not call deflate() without checking
+     first whether it has something to deflate. (Currently this causes
+     deflate to generate a fatal error according to the zlib spec.)
+     PR 22259. [Stas Bekman]
+
+  *) mod_ssl: Fix FakeBasicAuth for subrequest.  Log an error when an
+     identity spoof is encountered.
+     [Sander Striker]
+
+  *) mod_rewrite: Ignore RewriteRules in .htaccess files if the directory
+     containing the .htaccess file is requested without a trailing slash.
+     PR 20195.  [André Malo]
+
+  *) ab: Overlong credentials given via command line no longer clobber
+     the buffer.  [André Malo]
+
+  *) mod_deflate: Don't attempt to hold all of the response until we're
+     done.  [Justin Erenkrantz]
+
+  *) Assure that we block properly when reading input bodies with SSL.
+     PR 19242.  [David Deaves <David.Deaves@dd.id.au>, William Rowe]
+
+  *) Update mime.types to include latest IANA and W3C types.  [Roy Fielding]
+
+  *) mod_ext_filter: Set additional environment variables for use by
+     the external filter.  PR 20944.  [Andrew Ho, Jeff Trawick]
+
+  *) Fix buildconf errors when libtool version changes.  [Jeff Trawick]
+
+  *) Remember an authenticated user during internal redirects if the
+     redirection target is not access protected and pass it
+     to scripts using the REDIRECT_REMOTE_USER environment variable.
+     PR 10678, 11602.  [André Malo]
+
+  *) mod_include: Fix a trio of bugs that would cause various unusual
+     sequences of parsed bytes to omit portions of the output stream.
+     PR 21095. [Ron Park <ronald.park@cnet.com>, André Malo, Cliff Woolley]
+
+  *) Update the header token parsing code to allow LWS between the
+     token word and the ':' seperator.  [PR 16520]
+     [Kris Verbeeck <kris.verbeeck@advalvas.be>, Nicel KM <mnicel@yahoo.com>]
+
+  *) Eliminate creation of a temporary table in ap_get_mime_headers_core()
+     [Joe Schaefer <joe+gmane@sunstarsys.com>]
+
+  *) Added FreeBSD directory layout. PR 21100.
+     [Sander Holthaus <info@orangexl.com>, André Malo]
+
+  *) Fix NULL-pointer issue in ab when parsing an incomplete or non-HTTP
+     response. PR 21085. [Glenn Nielsen <glenn@apache.org>, André Malo]
+
+  *) mod_rewrite: Perform child initialization on the rewrite log lock.
+     This fixes a log corruption issue when flock-based serialization
+     is used (e.g., FreeBSD).  [Jeff Trawick]
+
+  *) Don't respect the Server header field as set by modules and CGIs.
+     As with 1.3, for proxy requests any such field is from the origin
+     server; otherwise it will have our server info as controlled by
+     the ServerTokens directive.  [Jeff Trawick]
+
 Changes with Apache 2.0.47
 
   *) SECURITY [CAN-2003-0192]: Fixed a bug whereby certain sequences
      of per-directory renegotiations and the SSLCipherSuite directive
      being used to upgrade from a weak ciphersuite to a strong one
      could result in the weak ciphersuite being used in place of the
      strong one.  [Ben Laurie]
 
   *) SECURITY [CAN-2003-0253]: Fixed a bug in prefork MPM causing
      temporary denial of service when accept() on a rarely accessed port
-     returns certain errors.  Reported by Saheed Akhtar 
+     returns certain errors.  Reported by Saheed Akhtar
      <S.Akhtar@talis.com>.  [Jeff Trawick]
 
   *) SECURITY [CAN-2003-0254]: Fixed a bug in ftp proxy causing denial
      of service when target host is IPv6 but proxy server can't create
      IPv6 socket.  Fixed by the reporter.  [Yoshioka Tsuneo
      <tsuneo.yoshioka@f-secure.com>]
 
   *) SECURITY [VU#379828] Prevent the server from crashing when entering
      infinite loops. The new LimitInternalRecursion directive configures
      limits of subsequent internal redirects and nested subrequests, after
      which the request will be aborted.  PR 19753 (and probably others).
      [William Rowe, Jeff Trawick, André Malo]
-		      
+
   *) core_output_filter: don't split the brigade after a FLUSH bucket if
      it's the last bucket.  This prevents creating unneccessary empty
      brigades which may not be destroyed until the end of a keepalive
      connection.
      [Juan Rivera <Juan.Rivera@citrix.com>]
 
@@ -3555,13 +3712,13 @@
 
   *) Remove BindAddress from the default config file.
      [giles@nemeton.com.au]
 
   *) Allow module authors to add a module to their Apache build using
      --with-module, without re-running buildconf.  The syntax is:
-	--with-module=module_type:/path/to/module.c
+         --with-module=module_type:/path/to/module.c
      The configure script will copy the module.c file to 
      modules/module_type, and it will be added to the relevant Makefiles.
      currently, this only works for static modules.  [Ryan Bloom]
 
   *) Changes required to make prefork clean up idle children properly.
      There was a window during which a starting worker deadlocks when
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/config.layout /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/config.layout
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/config.layout	2002-07-17 02:29:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/config.layout	2003-07-12 20:56:17.000000000 +0800
@@ -271,12 +271,36 @@
     localstatedir: ${prefix}
     runtimedir:    ${prefix}/logs
     logfiledir:    ${prefix}/logs
     proxycachedir: ${prefix}/proxy
 </Layout>
 
+# FreeBSD Layout
+<Layout FreeBSD>
+  prefix:        /usr/local
+  exec_prefix:   ${prefix}
+  bindir:        ${exec_prefix}/bin
+  sbindir:       ${exec_prefix}/sbin
+  libdir:        ${exec_prefix}/lib
+  libexecdir:    ${exec_prefix}/libexec/apache2
+  mandir:        ${prefix}/man
+  sysconfdir:    ${prefix}/etc/apache2
+  datadir:       ${prefix}/www
+  installbuilddir: ${prefix}/share/apache2/build
+  errordir:      ${datadir}/error
+  iconsdir:      ${datadir}/icons
+  htdocsdir:     ${datadir}/data
+  manualdir:     ${prefix}/share/doc/apache2
+  cgidir:        ${datadir}/cgi-bin
+  includedir:    ${prefix}/include/apache2
+  localstatedir: /var
+  runtimedir:    ${localstatedir}/run
+  logfiledir:    ${localstatedir}/log
+  proxycachedir: ${datadir}/proxy
+</Layout>
+
 # Debian layout
 <Layout Debian>
     prefix:        
     exec_prefix:   ${prefix}/usr
     bindir:        ${exec_prefix}/bin
     sbindir:       ${exec_prefix}/sbin
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/configure	2003-07-07 22:52:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/configure	2003-10-25 01:51:27.000000000 +0800
@@ -15756,13 +15756,13 @@
 esac
 
 
 
 test -d docs/conf||$mkdir_p docs/conf
 
-                                                                                                                        ac_config_files="$ac_config_files $APACHE_OUTPUT_FILES docs/conf/httpd-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk"
+                                                                                                                                  ac_config_files="$ac_config_files $APACHE_OUTPUT_FILES docs/conf/httpd-std.conf docs/conf/ssl-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk"
           ac_config_commands="$ac_config_commands default"
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
@@ -16278,12 +16278,13 @@
 for ac_config_target in $ac_config_targets
 do
   case "$ac_config_target" in
   # Handling of arguments.
   "$APACHE_OUTPUT_FILES" ) CONFIG_FILES="$CONFIG_FILES $APACHE_OUTPUT_FILES" ;;
   "docs/conf/httpd-std.conf" ) CONFIG_FILES="$CONFIG_FILES docs/conf/httpd-std.conf" ;;
+  "docs/conf/ssl-std.conf" ) CONFIG_FILES="$CONFIG_FILES docs/conf/ssl-std.conf" ;;
   "include/ap_config_layout.h" ) CONFIG_FILES="$CONFIG_FILES include/ap_config_layout.h" ;;
   "support/apxs" ) CONFIG_FILES="$CONFIG_FILES support/apxs" ;;
   "support/apachectl" ) CONFIG_FILES="$CONFIG_FILES support/apachectl" ;;
   "support/dbmmanage" ) CONFIG_FILES="$CONFIG_FILES support/dbmmanage" ;;
   "support/envvars-std" ) CONFIG_FILES="$CONFIG_FILES support/envvars-std" ;;
   "support/log_server_status" ) CONFIG_FILES="$CONFIG_FILES support/log_server_status" ;;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/configure.in	2003-05-21 12:46:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/configure.in	2003-09-29 20:08:06.000000000 +0800
@@ -563,10 +563,10 @@
 AC_SUBST(ap_make_include)
 AC_SUBST(ap_make_delimiter)
 
 dnl Ensure that docs/conf is created.
 test -d docs/conf||$mkdir_p docs/conf
 
-AC_OUTPUT($APACHE_OUTPUT_FILES docs/conf/httpd-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk,[true],[
+AC_OUTPUT($APACHE_OUTPUT_FILES docs/conf/httpd-std.conf docs/conf/ssl-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk,[true],[
   APACHE_GEN_MAKEFILES
 ])
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/httpd-std.conf.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/httpd-std.conf.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/httpd-std.conf.in	2003-07-06 22:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/httpd-std.conf.in	2003-10-11 09:47:43.000000000 +0800
@@ -271,13 +271,13 @@
 
 #
 # ServerAdmin: Your address, where problems with the server should be
 # e-mailed.  This address appears on some server-generated pages, such
 # as error documents.  e.g. admin@your-domain.com
 #
-ServerAdmin you@your.address
+ServerAdmin you@example.com
 
 #
 # ServerName gives the name and port that the server uses to identify itself.
 # This can often be determined automatically, but we recommend you specify
 # it explicitly to prevent problems during startup.
 #
@@ -285,13 +285,13 @@
 # redirections will not work.  See also the UseCanonicalName directive.
 #
 # If your host doesn't have a registered DNS name, enter its IP address here.
 # You will have to access it by its address anyway, and this will make 
 # redirections work in a sensible way.
 #
-#ServerName new.host.name:80
+#ServerName www.example.com:80
 
 #
 # UseCanonicalName: Determines how Apache constructs self-referencing 
 # URLs and the SERVER_NAME and SERVER_PORT variables.
 # When set "Off", Apache will use the Hostname and Port supplied
 # by the client.  When set "On", Apache will use the value of the
@@ -691,21 +691,12 @@
 # IndexIgnore is a set of filenames which directory indexing should ignore
 # and not include in the listing.  Shell-style wildcarding is permitted.
 #
 IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
 
 #
-# AddEncoding allows you to have certain browsers (Mosaic/X 2.1+) uncompress
-# information on the fly. Note: Not all browsers support this.
-# Despite the name similarity, the following Add* directives have nothing
-# to do with the FancyIndexing customization directives above.
-#
-#AddEncoding x-compress Z
-#AddEncoding x-gzip gz tgz
-
-#
 # DefaultLanguage and AddLanguage allows you to specify the language of 
 # a document. You can then use content negotiation to give a browser a 
 # file in a language the user can understand.
 #
 # Specify a default language. This means that all data
 # going out without a specific language tag (see below) will 
@@ -729,54 +720,55 @@
 # E.g. 'Danmark/dk' versus 'Danish/da'.
 #
 # Note 3: In the case of 'ltz' we violate the RFC by using a three char
 # specifier. There is 'work in progress' to fix this and get
 # the reference data for rfc1766 cleaned up.
 #
-# Danish (da) - Dutch (nl) - English (en) - Estonian (et)
-# French (fr) - German (de) - Greek-Modern (el)
-# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (ko) 
-# Portugese (pt) - Luxembourgeois* (ltz)
-# Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cs)
-# Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
-# Russian (ru) - Croatian (hr)
+# Catalan (ca) - Croatian (hr) - Czech (cs) - Danish (da) - Dutch (nl)
+# English (en) - Esperanto (eo) - Estonian (et) - French (fr) - German (de)
+# Greek-Modern (el) - Hebrew (he) - Italian (it) - Japanese (ja)
+# Korean (ko) - Luxembourgeois* (ltz) - Norwegian Nynorsk (nn)
+# Norwegian (no) - Polish (pl) - Portugese (pt)
+# Brazilian Portuguese (pt-BR) - Russian (ru) - Swedish (sv)
+# Simplified Chinese (zh-CN) - Spanish (es) - Traditional Chinese (zh-TW)
 #
+AddLanguage ca .ca
+AddLanguage cs .cz .cs
 AddLanguage da .dk
-AddLanguage nl .nl
+AddLanguage de .de
+AddLanguage el .el
 AddLanguage en .en
+AddLanguage eo .eo
+AddLanguage es .es
 AddLanguage et .et
 AddLanguage fr .fr
-AddLanguage de .de
 AddLanguage he .he
-AddLanguage el .el
+AddLanguage hr .hr
 AddLanguage it .it
 AddLanguage ja .ja
-AddLanguage pl .po
 AddLanguage ko .ko
-AddLanguage pt .pt
+AddLanguage ltz .ltz
+AddLanguage nl .nl
 AddLanguage nn .nn
 AddLanguage no .no
-AddLanguage pt-br .pt-br
-AddLanguage ltz .ltz
-AddLanguage ca .ca
-AddLanguage es .es
-AddLanguage sv .sv
-AddLanguage cs .cz .cs
+AddLanguage pl .po
+AddLanguage pt .pt
+AddLanguage pt-BR .pt-br
 AddLanguage ru .ru
+AddLanguage sv .sv
 AddLanguage zh-CN .zh-cn
 AddLanguage zh-TW .zh-tw
-AddLanguage hr .hr
 
 #
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 #
 # Just list the languages in decreasing order of preference. We have
 # more or less alphabetized them here. You probably want to change this.
 #
-LanguagePriority en da nl et fr de el it ja ko no pl pt pt-br ltz ca es sv tw
+LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW
 
 #
 # ForceLanguagePriority allows you to serve a result page rather than
 # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
 # [in case no accepted languages matched the available variants]
 #
@@ -841,14 +833,27 @@
 AddCharset shift_jis   .sjis
 
 #
 # AddType allows you to add to or override the MIME configuration
 # file mime.types for specific file types.
 #
-AddType application/x-tar .tgz
-AddType image/x-icon .ico
+#AddType application/x-tar .tgz
+#
+# AddEncoding allows you to have certain browsers uncompress
+# information on the fly. Note: Not all browsers support this.
+# Despite the name similarity, the following Add* directives have nothing
+# to do with the FancyIndexing customization directives above.
+#
+#AddEncoding x-compress .Z
+#AddEncoding x-gzip .gz .tgz
+#
+# If the AddEncoding directives above are commented-out, then you
+# probably should define those extensions to indicate media types:
+#
+AddType application/x-compress .Z
+AddType application/x-gzip .gz .tgz
 
 #
 # AddHandler allows you to map certain file extensions to "handlers":
 # actions unrelated to filetype. These can be either built into the server
 # or added with the Action directive (see below)
 #
@@ -1024,21 +1029,21 @@
 # You may use the command line option '-S' to verify your virtual host
 # configuration.
 
 #
 # Use name-based virtual hosting.
 #
-#NameVirtualHost *
+#NameVirtualHost *:80
 
 #
 # VirtualHost example:
 # Almost any Apache directive may go into a VirtualHost container.
 # The first VirtualHost section is used for requests without a known
 # server name.
 #
-#<VirtualHost *>
+#<VirtualHost *:80>
 #    ServerAdmin webmaster@dummy-host.example.com
 #    DocumentRoot /www/docs/dummy-host.example.com
 #    ServerName dummy-host.example.com
 #    ErrorLog @rel_logfiledir@/dummy-host.example.com-error_log
 #    CustomLog @rel_logfiledir@/dummy-host.example.com-access_log common
 #</VirtualHost>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/httpd-win.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/httpd-win.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/httpd-win.conf	2003-07-06 22:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/httpd-win.conf	2003-10-11 09:47:43.000000000 +0800
@@ -610,21 +610,12 @@
 # IndexIgnore is a set of filenames which directory indexing should ignore
 # and not include in the listing.  Shell-style wildcarding is permitted.
 #
 IndexIgnore .??* *~ *# HEADER* README* RCS CVS *,v *,t
 
 #
-# AddEncoding allows you to have certain browsers (Mosaic/X 2.1+) uncompress
-# information on the fly. Note: Not all browsers support this.
-# Despite the name similarity, the following Add* directives have nothing
-# to do with the FancyIndexing customization directives above.
-#
-#AddEncoding x-compress Z
-#AddEncoding x-gzip gz tgz
-
-#
 # DefaultLanguage and AddLanguage allows you to specify the language of 
 # a document. You can then use content negotiation to give a browser a 
 # file in a language the user can understand.
 #
 # Specify a default language. This means that all data
 # going out without a specific language tag (see below) will 
@@ -648,54 +639,55 @@
 # E.g. 'Danmark/dk' versus 'Danish/da'.
 #
 # Note 3: In the case of 'ltz' we violate the RFC by using a three char
 # specifier. There is 'work in progress' to fix this and get
 # the reference data for rfc1766 cleaned up.
 #
-# Danish (da) - Dutch (nl) - English (en) - Estonian (et)
-# French (fr) - German (de) - Greek-Modern (el)
-# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (ko)
-# Portugese (pt) - Luxembourgeois* (ltz)
-# Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cs)
-# Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
-# Russian (ru) - Croatian (hr)
+# Catalan (ca) - Croatian (hr) - Czech (cs) - Danish (da) - Dutch (nl)
+# English (en) - Esperanto (eo) - Estonian (et) - French (fr) - German (de)
+# Greek-Modern (el) - Hebrew (he) - Italian (it) - Japanese (ja)
+# Korean (ko) - Luxembourgeois* (ltz) - Norwegian Nynorsk (nn)
+# Norwegian (no) - Polish (pl) - Portugese (pt)
+# Brazilian Portuguese (pt-BR) - Russian (ru) - Swedish (sv)
+# Simplified Chinese (zh-CN) - Spanish (es) - Traditional Chinese (zh-TW)
 #
+AddLanguage ca .ca
+AddLanguage cs .cz .cs
 AddLanguage da .dk
-AddLanguage nl .nl
+AddLanguage de .de
+AddLanguage el .el
 AddLanguage en .en
+AddLanguage eo .eo
+AddLanguage es .es
 AddLanguage et .et
 AddLanguage fr .fr
-AddLanguage de .de
 AddLanguage he .he
-AddLanguage el .el
+AddLanguage hr .hr
 AddLanguage it .it
 AddLanguage ja .ja
-AddLanguage pl .po
 AddLanguage ko .ko
-AddLanguage pt .pt
+AddLanguage ltz .ltz
+AddLanguage nl .nl
 AddLanguage nn .nn
 AddLanguage no .no
-AddLanguage pt-br .pt-br
-AddLanguage ltz .ltz
-AddLanguage ca .ca
-AddLanguage es .es
-AddLanguage sv .sv
-AddLanguage cs .cz .cs
+AddLanguage pl .po
+AddLanguage pt .pt
+AddLanguage pt-BR .pt-br
 AddLanguage ru .ru
+AddLanguage sv .sv
 AddLanguage zh-CN .zh-cn
 AddLanguage zh-TW .zh-tw
-AddLanguage hr .hr
 
 #
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 #
 # Just list the languages in decreasing order of preference. We have
 # more or less alphabetized them here. You probably want to change this.
 #
-LanguagePriority en da nl et fr de el it ja ko no pl pt pt-br ltz ca es sv tw
+LanguagePriority en ca cs da de el eo es et fr he hr it ja ko ltz nl nn no pl pt pt-BR ru sv zh-CN zh-TW
 
 #
 # ForceLanguagePriority allows you to serve a result page rather than
 # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
 # [in case no accepted languages matched the available variants]
 #
@@ -760,14 +752,27 @@
 AddCharset shift_jis   .sjis
 
 #
 # AddType allows you to add to or override the MIME configuration
 # file mime.types for specific file types.
 #
-AddType application/x-tar .tgz
-AddType image/x-icon .ico
+#AddType application/x-tar .tgz
+#
+# AddEncoding allows you to have certain browsers (Mosaic/X 2.1+) uncompress
+# information on the fly. Note: Not all browsers support this.
+# Despite the name similarity, the following Add* directives have nothing
+# to do with the FancyIndexing customization directives above.
+#
+#AddEncoding x-compress .Z
+#AddEncoding x-gzip .gz .tgz
+#
+# If the AddEncoding directives above are commented-out, then you
+# probably should define those extensions to indicate media types:
+#
+AddType application/x-compress .Z
+AddType application/x-gzip .gz .tgz
 
 #
 # AddHandler allows you to map certain file extensions to "handlers":
 # actions unrelated to filetype. These can be either built into the server
 # or added with the Action directive (see below)
 #
@@ -944,21 +949,21 @@
 # You may use the command line option '-S' to verify your virtual host
 # configuration.
 
 #
 # Use name-based virtual hosting.
 #
-#NameVirtualHost *
+#NameVirtualHost *:80
 
 #
 # VirtualHost example:
 # Almost any Apache directive may go into a VirtualHost container.
 # The first VirtualHost section is used for requests without a known
 # server name.
 #
-#<VirtualHost *>
+#<VirtualHost *:80>
 #    ServerAdmin webmaster@dummy-host.example.com
 #    DocumentRoot /www/docs/dummy-host.example.com
 #    ServerName dummy-host.example.com
 #    ErrorLog logs/dummy-host.example.com-error_log
 #    CustomLog logs/dummy-host.example.com-access_log common
 #</VirtualHost>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/mime.types /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/mime.types
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf/mime.types	2003-01-22 12:43:17.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf/mime.types	2003-08-17 22:37:25.000000000 +0800
@@ -5,54 +5,57 @@
 # is important so they know how to handle the content of the file.
 # Extra types can either be added here or by using an AddType directive
 # in your config files. For more information about Internet media types,
 # please read RFC 2045, 2046, 2047, 2048, and 2077.  The Internet media type
 # registry is at <http://www.iana.org/assignments/media-types/>.
 
-# MIME type			Extension
-application/EDI-Consent
-application/EDI-X12
-application/EDIFACT
+# MIME type			Extensions
 application/activemessage
 application/andrew-inset	ez
 application/applefile
 application/atomicmail
-application/batch-SMTP
+application/batch-smtp
 application/beep+xml
 application/cals-1840
+application/cnrp+xml
 application/commonground
+application/cpl+xml
 application/cybercash
 application/dca-rft
 application/dec-dx
 application/dvcs
+application/edi-consent
+application/edifact
+application/edi-x12
 application/eshop
+application/font-tdpfr
 application/http
 application/hyperstudio
 application/iges
 application/index
 application/index.cmd
 application/index.obj
 application/index.response
 application/index.vnd
 application/iotp
 application/ipp
 application/isup
-application/font-tdpfr
 application/mac-binhex40	hqx
 application/mac-compactpro	cpt
 application/macwriteii
 application/marc
 application/mathematica
-application/mathematica-old
+application/mathml+xml		mathml
 application/msword		doc
 application/news-message-id
 application/news-transmission
 application/ocsp-request
 application/ocsp-response
 application/octet-stream	bin dms lha lzh exe class so dll
 application/oda			oda
+application/ogg			ogg
 application/parityfec
 application/pdf			pdf
 application/pgp-encrypted
 application/pgp-keys
 application/pgp-signature
 application/pkcs10
@@ -62,13 +65,16 @@
 application/pkix-crl
 application/pkixcmp
 application/postscript		ai eps ps
 application/prs.alvestrand.titrax-sheet
 application/prs.cww
 application/prs.nprend
+application/prs.plucker
 application/qsig
+application/rdf+xml		rdf
+application/reginfo+xml
 application/remote-printing
 application/riscos
 application/rtf
 application/sdp
 application/set-payment
 application/set-payment-initiation
@@ -76,41 +82,55 @@
 application/set-registration-initiation
 application/sgml
 application/sgml-open-catalog
 application/sieve
 application/slate
 application/smil		smi smil
+application/srgs		gram
+application/srgs+xml		grxml
 application/timestamp-query
 application/timestamp-reply
+application/tve-trigger
 application/vemmi
-application/vnd.3M.Post-it-Notes
-application/vnd.FloGraphIt
+application/vnd.3gpp.pic-bw-large
+application/vnd.3gpp.pic-bw-small
+application/vnd.3gpp.pic-bw-var
+application/vnd.3gpp.sms
+application/vnd.3m.post-it-notes
 application/vnd.accpac.simply.aso
 application/vnd.accpac.simply.imp
 application/vnd.acucobol
+application/vnd.acucorp
+application/vnd.adobe.xfdf
 application/vnd.aether.imp
+application/vnd.amiga.ami
 application/vnd.anser-web-certificate-issue-initiation
 application/vnd.anser-web-funds-transfer-initiation
 application/vnd.audiograph
-application/vnd.businessobjects
+application/vnd.blueice.multipass
 application/vnd.bmi
+application/vnd.businessobjects
 application/vnd.canon-cpdl
 application/vnd.canon-lips
+application/vnd.cinderella
 application/vnd.claymore
 application/vnd.commerce-battelle
 application/vnd.commonspace
-application/vnd.comsocaller
 application/vnd.contact.cmsg
 application/vnd.cosmocaller
+application/vnd.criticaltools.wbs+xml
+application/vnd.ctc-posml
 application/vnd.cups-postscript
 application/vnd.cups-raster
 application/vnd.cups-raw
-application/vnd.ctc-posml
+application/vnd.curl
 application/vnd.cybank
+application/vnd.data-vision.rdz
 application/vnd.dna
 application/vnd.dpgraph
+application/vnd.dreamfactory
 application/vnd.dxr
 application/vnd.ecdis-update
 application/vnd.ecowin.chart
 application/vnd.ecowin.filerequest
 application/vnd.ecowin.fileupdate
 application/vnd.ecowin.series
@@ -123,12 +143,14 @@
 application/vnd.epson.salt
 application/vnd.epson.ssf
 application/vnd.ericsson.quickcall
 application/vnd.eudora.data
 application/vnd.fdf
 application/vnd.ffsns
+application/vnd.fints
+application/vnd.flographit
 application/vnd.framemaker
 application/vnd.fsc.weblaunch
 application/vnd.fujitsu.oasys
 application/vnd.fujitsu.oasys2
 application/vnd.fujitsu.oasys3
 application/vnd.fujitsu.oasysgp
@@ -136,28 +158,33 @@
 application/vnd.fujixerox.ddd
 application/vnd.fujixerox.docuworks
 application/vnd.fujixerox.docuworks.binder
 application/vnd.fut-misnet
 application/vnd.grafeq
 application/vnd.groove-account
+application/vnd.groove-help
 application/vnd.groove-identity-message
 application/vnd.groove-injector
 application/vnd.groove-tool-message
 application/vnd.groove-tool-template
 application/vnd.groove-vcard
+application/vnd.hbci
 application/vnd.hhe.lesson-player
-application/vnd.hp-HPGL
-application/vnd.hp-PCL
-application/vnd.hp-PCLXL
+application/vnd.hp-hpgl
 application/vnd.hp-hpid
 application/vnd.hp-hps
+application/vnd.hp-pcl
+application/vnd.hp-pclxl
 application/vnd.httphone
 application/vnd.hzn-3d-crossword
 application/vnd.ibm.afplinedata
-application/vnd.ibm.MiniPay
+application/vnd.ibm.electronic-media
+application/vnd.ibm.minipay
 application/vnd.ibm.modcap
+application/vnd.ibm.rights-management
+application/vnd.ibm.secure-container
 application/vnd.informix-visionary
 application/vnd.intercon.formnet
 application/vnd.intertrust.digibox
 application/vnd.intertrust.nncp
 application/vnd.intu.qbo
 application/vnd.intu.qfx
@@ -168,58 +195,79 @@
 application/vnd.japannet-payment-wakeup
 application/vnd.japannet-registration
 application/vnd.japannet-registration-wakeup
 application/vnd.japannet-setstore-wakeup
 application/vnd.japannet-verification
 application/vnd.japannet-verification-wakeup
+application/vnd.jisp
+application/vnd.kde.karbon
+application/vnd.kde.kchart
+application/vnd.kde.kformula
+application/vnd.kde.kivio
+application/vnd.kde.kontour
+application/vnd.kde.kpresenter
+application/vnd.kde.kspread
+application/vnd.kde.kword
+application/vnd.kenameaapp
 application/vnd.koan
+application/vnd.liberty-request+xml
+application/vnd.llamagraphics.life-balance.desktop
+application/vnd.llamagraphics.life-balance.exchange+xml
 application/vnd.lotus-1-2-3
 application/vnd.lotus-approach
 application/vnd.lotus-freelance
 application/vnd.lotus-notes
 application/vnd.lotus-organizer
 application/vnd.lotus-screencam
 application/vnd.lotus-wordpro
 application/vnd.mcd
 application/vnd.mediastation.cdkey
 application/vnd.meridian-slingshot
+application/vnd.micrografx.flo
+application/vnd.micrografx.igx
 application/vnd.mif		mif
 application/vnd.minisoft-hp3000-save
 application/vnd.mitsubishi.misty-guard.trustweb
 application/vnd.mobius.daf
 application/vnd.mobius.dis
+application/vnd.mobius.mbk
+application/vnd.mobius.mqy
 application/vnd.mobius.msl
 application/vnd.mobius.plc
 application/vnd.mobius.txf
+application/vnd.mophun.application
+application/vnd.mophun.certificate
 application/vnd.motorola.flexsuite
 application/vnd.motorola.flexsuite.adsi
 application/vnd.motorola.flexsuite.fis
 application/vnd.motorola.flexsuite.gotap
 application/vnd.motorola.flexsuite.kmr
 application/vnd.motorola.flexsuite.ttc
 application/vnd.motorola.flexsuite.wem
-application/vnd.mozilla.xul+xml
+application/vnd.mozilla.xul+xml	xul
 application/vnd.ms-artgalry
 application/vnd.ms-asf
 application/vnd.ms-excel	xls
 application/vnd.ms-lrm
 application/vnd.ms-powerpoint	ppt
 application/vnd.ms-project
 application/vnd.ms-tnef
 application/vnd.ms-works
+application/vnd.ms-wpl
 application/vnd.mseq
 application/vnd.msign
 application/vnd.music-niff
 application/vnd.musician
 application/vnd.netfpx
 application/vnd.noblenet-directory
 application/vnd.noblenet-sealer
 application/vnd.noblenet-web
-application/vnd.novadigm.EDM
-application/vnd.novadigm.EDX
-application/vnd.novadigm.EXT
+application/vnd.novadigm.edm
+application/vnd.novadigm.edx
+application/vnd.novadigm.ext
+application/vnd.obn
 application/vnd.osa.netdeploy
 application/vnd.palm
 application/vnd.pg.format
 application/vnd.pg.osasli
 application/vnd.powerbuilder6
 application/vnd.powerbuilder6-s
@@ -227,35 +275,38 @@
 application/vnd.powerbuilder7-s
 application/vnd.powerbuilder75
 application/vnd.powerbuilder75-s
 application/vnd.previewsystems.box
 application/vnd.publishare-delta-tree
 application/vnd.pvi.ptid1
+application/vnd.pwg-multiplexed
 application/vnd.pwg-xhtml-print+xml
+application/vnd.quark.quarkxpress
 application/vnd.rapid
 application/vnd.s3sms
+application/vnd.sealed.net
 application/vnd.seemail
 application/vnd.shana.informed.formdata
 application/vnd.shana.informed.formtemplate
 application/vnd.shana.informed.interchange
 application/vnd.shana.informed.package
+application/vnd.smaf
 application/vnd.sss-cod
 application/vnd.sss-dtf
 application/vnd.sss-ntf
 application/vnd.street-stream
 application/vnd.svd
 application/vnd.swiftview-ics
 application/vnd.triscape.mxs
 application/vnd.trueapp
 application/vnd.truedoc
-application/vnd.tve-trigger
 application/vnd.ufdl
 application/vnd.uplanet.alert
 application/vnd.uplanet.alert-wbxml
-application/vnd.uplanet.bearer-choice-wbxml
 application/vnd.uplanet.bearer-choice
+application/vnd.uplanet.bearer-choice-wbxml
 application/vnd.uplanet.cacheop
 application/vnd.uplanet.cacheop-wbxml
 application/vnd.uplanet.channel
 application/vnd.uplanet.channel-wbxml
 application/vnd.uplanet.list
 application/vnd.uplanet.list-wbxml
@@ -263,24 +314,32 @@
 application/vnd.uplanet.listcmd-wbxml
 application/vnd.uplanet.signal
 application/vnd.vcx
 application/vnd.vectorworks
 application/vnd.vidsoft.vidconference
 application/vnd.visio
+application/vnd.visionary
 application/vnd.vividence.scriptfile
+application/vnd.vsf
 application/vnd.wap.sic
 application/vnd.wap.slc
 application/vnd.wap.wbxml	wbxml
 application/vnd.wap.wmlc	wmlc
 application/vnd.wap.wmlscriptc	wmlsc
 application/vnd.webturbo
 application/vnd.wrq-hp3000-labelled
 application/vnd.wt.stf
+application/vnd.wv.csp+wbxml
 application/vnd.xara
 application/vnd.xfdl
+application/vnd.yamaha.hv-dic
+application/vnd.yamaha.hv-script
+application/vnd.yamaha.hv-voice
 application/vnd.yellowriver-custom-menu
+application/voicexml+xml	vxml
+application/watcherinfo+xml
 application/whoispp-query
 application/whoispp-response
 application/wita
 application/wordperfect5.1
 application/x-bcpio		bcpio
 application/x-cdlink		vcd
@@ -313,28 +372,62 @@
 application/x-troff-me		me
 application/x-troff-ms		ms
 application/x-ustar		ustar
 application/x-wais-source	src
 application/x400-bp
 application/xhtml+xml		xhtml xht
-application/xml
-application/xml-dtd
+application/xslt+xml		xslt
+application/xml			xml xsl
+application/xml-dtd		dtd
 application/xml-external-parsed-entity
 application/zip			zip
 audio/32kadpcm
+audio/amr
+audio/amr-wb
 audio/basic			au snd
+audio/cn
+audio/dat12
+audio/dsr-es201108
+audio/dvi4
+audio/evrc
+audio/evrc0
+audio/g722
 audio/g.722.1
+audio/g723
+audio/g726-16
+audio/g726-24
+audio/g726-32
+audio/g726-40
+audio/g728
+audio/g729
+audio/g729D
+audio/g729E
+audio/gsm
+audio/gsm-efr
+audio/l8
 audio/l16
+audio/l20
+audio/l24
+audio/lpc
 audio/midi			mid midi kar
-audio/mp4a-latm
+audio/mpa
 audio/mpa-robust
+audio/mp4a-latm
 audio/mpeg			mpga mp2 mp3
 audio/parityfec
+audio/pcma
+audio/pcmu
 audio/prs.sid
+audio/qcelp
+audio/red
+audio/smv
+audio/smv0
 audio/telephone-event
 audio/tone
+audio/vdvi
+audio/vnd.3gpp.iufp
 audio/vnd.cisco.nse
 audio/vnd.cns.anp1
 audio/vnd.cns.inf1
 audio/vnd.digital-winds
 audio/vnd.everad.plj
 audio/vnd.lucent.voice
@@ -344,45 +437,52 @@
 audio/vnd.nuera.ecelp9600
 audio/vnd.octel.sbc
 audio/vnd.qcelp
 audio/vnd.rhetorex.32kadpcm
 audio/vnd.vmx.cvsd
 audio/x-aiff			aif aiff aifc
+audio/x-alaw-basic
 audio/x-mpegurl			m3u
 audio/x-pn-realaudio		ram rm
 audio/x-pn-realaudio-plugin	rpm
 audio/x-realaudio		ra
 audio/x-wav			wav
 chemical/x-pdb			pdb
 chemical/x-xyz			xyz
 image/bmp			bmp
-image/cgm
+image/cgm			cgm
 image/g3fax
 image/gif			gif
 image/ief			ief
 image/jpeg			jpeg jpg jpe
 image/naplps
 image/png			png
 image/prs.btif
 image/prs.pti
+image/svg+xml			svg
+image/t38
 image/tiff			tiff tif
+image/tiff-fx
 image/vnd.cns.inf2
 image/vnd.djvu			djvu djv
 image/vnd.dwg
 image/vnd.dxf
 image/vnd.fastbidsheet
 image/vnd.fpx
 image/vnd.fst
 image/vnd.fujixerox.edmics-mmr
 image/vnd.fujixerox.edmics-rlc
+image/vnd.globalgraphics.pgb
 image/vnd.mix
+image/vnd.ms-modi
 image/vnd.net-fpx
 image/vnd.svf
 image/vnd.wap.wbmp		wbmp
 image/vnd.xiff
 image/x-cmu-raster		ras
+image/x-icon			ico
 image/x-portable-anymap		pnm
 image/x-portable-bitmap		pbm
 image/x-portable-graymap	pgm
 image/x-portable-pixmap		ppm
 image/x-rgb			rgb
 image/x-xbitmap			xbm
@@ -393,20 +493,24 @@
 message/external-body
 message/http
 message/news
 message/partial
 message/rfc822
 message/s-http
+message/sip
+message/sipfrag
 model/iges			igs iges
 model/mesh			msh mesh silo
 model/vnd.dwf
 model/vnd.flatland.3dml
 model/vnd.gdl
 model/vnd.gs-gdl
 model/vnd.gtw
 model/vnd.mts
+model/vnd.parasolid.transmit.binary
+model/vnd.parasolid.transmit.text
 model/vnd.vtu
 model/vrml			wrl vrml
 multipart/alternative
 multipart/appledouble
 multipart/byteranges
 multipart/digest
@@ -416,56 +520,72 @@
 multipart/mixed
 multipart/parallel
 multipart/related
 multipart/report
 multipart/signed
 multipart/voice-message
-text/calendar
+text/calendar			ics ifb
 text/css			css
 text/directory
 text/enriched
 text/html			html htm
 text/parityfec
 text/plain			asc txt
 text/prs.lines.tag
 text/rfc822-headers
 text/richtext			rtx
 text/rtf			rtf
 text/sgml			sgml sgm
-text/tab-separated-values	tsv
 text/t140
+text/tab-separated-values	tsv
 text/uri-list
-text/vnd.DMClientScript
-text/vnd.IPTC.NITF
-text/vnd.IPTC.NewsML
 text/vnd.abc
 text/vnd.curl
-text/vnd.flatland.3dml
+text/vnd.dmclientscript
 text/vnd.fly
 text/vnd.fmi.flexstor
 text/vnd.in3d.3dml
 text/vnd.in3d.spot
+text/vnd.iptc.nitf
+text/vnd.iptc.newsml
 text/vnd.latex-z
 text/vnd.motorola.reflex
 text/vnd.ms-mediapackage
+text/vnd.net2phone.commcenter.command
+text/vnd.sun.j2me.app-descriptor
 text/vnd.wap.si
 text/vnd.wap.sl
 text/vnd.wap.wml		wml
 text/vnd.wap.wmlscript		wmls
 text/x-setext			etx
-text/xml			xml xsl
+text/xml
 text/xml-external-parsed-entity
+video/bmpeg
+video/bt656
+video/celb
+video/dv
+video/h261
+video/h263
+video/h263-1998
+video/h263-2000
+video/jpeg
+video/mp1s
+video/mp2p
+video/mp2t
 video/mp4v-es
+video/mpv
 video/mpeg			mpeg mpg mpe
+video/nv
 video/parityfec
 video/pointer
 video/quicktime			qt mov
+video/smpte292m
 video/vnd.fvt
 video/vnd.motorola.video
 video/vnd.motorola.videop
 video/vnd.mpegurl		mxu
-video/vnd.mts
 video/vnd.nokia.interleaved-multimedia
+video/vnd.objectvideo
 video/vnd.vivo
 video/x-msvideo			avi
 video/x-sgi-movie		movie
 x-conference/x-cooltalk		ice
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/conf: ssl-std.conf
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/conf: ssl-std.conf.in
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/icons/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/icons/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/icons/README	1999-08-24 13:33:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/icons/README	2003-10-10 11:50:03.000000000 +0800
@@ -40,13 +40,13 @@
           This can represent BinHex-encoded data.
 
      blank.gif
           This can be used as a placeholder or a spacing element.
 
      bomb.gif
-          This can be used to repreesnt core files.
+          This can be used to represent core files.
 
      box1.gif, box2.gif
           These icons can be used to represent generic 3D applications and
           related files.
 
      broken.gif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/content-negotiation.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/content-negotiation.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/content-negotiation.html.en	2003-07-01 06:17:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/content-negotiation.html.en	2003-09-20 18:02:52.000000000 +0800
@@ -21,23 +21,23 @@
 <p><span>Available Languages: </span><a href="./en/content-negotiation.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/content-negotiation.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
 <a href="./ko/content-negotiation.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
 </div>
 
 
-    <p>Apache's supports content negotiation as described in
+    <p>Apache supports content negotiation as described in
     the HTTP/1.1 specification. It can choose the best
     representation of a resource based on the browser-supplied
     preferences for media type, languages, character set and
     encoding. It also implements a couple of features to give
     more intelligent handling of requests from browsers that send
     incomplete negotiation information.</p>
 
     <p>Content negotiation is provided by the
-    <code class="module"><a href="./mod/mod_negotiation.html">mod_negotiation</a></code> module.
-    which is compiled in by default.</p>
+    <code class="module"><a href="./mod/mod_negotiation.html">mod_negotiation</a></code> module, which is compiled in
+    by default.</p>
 </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#about">About Content Negotiation</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#negotiation">Negotiation in Apache</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#methods">The Negotiation Methods</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#better">Fiddling with Quality
     Values</a></li>
@@ -54,13 +54,13 @@
     <p>A resource may be available in several different
     representations. For example, it might be available in
     different languages or different media types, or a combination.
     One way of selecting the most appropriate choice is to give the
     user an index page, and let them select. However it is often
     possible for the server to choose automatically. This works
-    because browsers can send as part of each request information
+    because browsers can send, as part of each request, information
     about what representations they prefer. For example, a browser
     could indicate that it would like to see information in French,
     if possible, else English will do. Browsers indicate their
     preferences by headers in the request. To request only French
     representations, the browser would send</p>
 
@@ -80,17 +80,18 @@
   Accept-Language: fr; q=1.0, en; q=0.5<br />
   Accept: text/html; q=1.0, text/*; q=0.8, image/gif; q=0.6, image/jpeg; q=0.6, image/*; q=0.5, */*; q=0.1
 </code></p></div>
 
     <p>Apache supports 'server driven' content negotiation, as
     defined in the HTTP/1.1 specification. It fully supports the
-    Accept, Accept-Language, Accept-Charset and Accept-Encoding
+    <code>Accept</code>, <code>Accept-Language</code>,
+    <code>Accept-Charset</code> and<code>Accept-Encoding</code> 
     request headers. Apache also supports 'transparent'
     content negotiation, which is an experimental negotiation
     protocol defined in RFC 2295 and RFC 2296. It does not offer
-    support for 'feature negotiation' as defined in these RFCs. </p>
+    support for 'feature negotiation' as defined in these RFCs.</p>
 
     <p>A <strong>resource</strong> is a conceptual entity
     identified by a URI (RFC 2396). An HTTP server like Apache
     provides access to <strong>representations</strong> of the
     resource(s) within its namespace, with each representation in
     the form of a sequence of bytes with a defined media type,
@@ -121,17 +122,19 @@
 
    <h3><a name="type-map" id="type-map">Using a type-map file</a></h3>
 
     <p>A type map is a document which is associated with the
     handler named <code>type-map</code> (or, for
     backwards-compatibility with older Apache configurations, the
-    mime type <code>application/x-type-map</code>). Note that to
+    MIME type <code>application/x-type-map</code>). Note that to
     use this feature, you must have a handler set in the
     configuration that defines a file suffix as
-    <code>type-map</code>; this is best done with a</p>
+    <code>type-map</code>; this is best done with</p>
+
 <div class="example"><p><code>AddHandler type-map .var</code></p></div>
+
     <p>in the server configuration file.</p>
 
     <p>Type map files should have the same name as the resource
     which they are describing, and have an entry for each available
     variant; these entries consist of contiguous HTTP-format header
     lines. Entries for different variants are separated by blank
@@ -154,13 +157,13 @@
   Content-language: fr, de<br />
 </code></p></div>
     <p>Note also that a typemap file will take precedence over the
     filename's extension, even when Multiviews is on. If the
     variants have different source qualities, that may be indicated
     by the "qs" parameter to the media type, as in this picture
-    (available as jpeg, gif, or ASCII-art): </p>
+    (available as JPEG, GIF, or ASCII-art): </p>
 
 <div class="example"><p><code>
   URI: foo<br />
 <br />
   URI: foo.jpeg<br />
   Content-type: image/jpeg; qs=0.8<br />
@@ -174,17 +177,17 @@
 
     <p>qs values can vary in the range 0.000 to 1.000. Note that
     any variant with a qs value of 0.000 will never be chosen.
     Variants with no 'qs' parameter value are given a qs factor of
     1.0. The qs parameter indicates the relative 'quality' of this
     variant compared to the other available variants, independent
-    of the client's capabilities. For example, a jpeg file is
-    usually of higher source quality than an ascii file if it is
+    of the client's capabilities. For example, a JPEG file is
+    usually of higher source quality than an ASCII file if it is
     attempting to represent a photograph. However, if the resource
-    being represented is an original ascii art, then an ascii
-    representation would have a higher source quality than a jpeg
+    being represented is an original ASCII art, then an ASCII
+    representation would have a higher source quality than a JPEG
     representation. A qs value is therefore specific to a given
     variant depending on the nature of the resource it
     represents.</p>
 
     <p>The full list of headers recognized is available in the <a href="mod/mod_negotiation.html#typemaps">mod_negotation
     typemap</a> documentation.</p>
@@ -271,41 +274,42 @@
         <th>Notes</th>
       </tr>
 
       <tr valign="top">
         <td>Media Type</td>
 
-        <td>Browser indicates preferences with the Accept header
-        field. Each item can have an associated quality factor.
-        Variant description can also have a quality factor (the
-        "qs" parameter).</td>
+        <td>Browser indicates preferences with the <code>Accept</code>
+        header field. Each item can have an associated quality factor.
+        Variant description can also have a quality factor (the "qs"
+        parameter).</td>
       </tr>
 
       <tr valign="top">
         <td>Language</td>
 
-        <td>Browser indicates preferences with the Accept-Language
-        header field. Each item can have a quality factor. Variants
-        can be associated with none, one or more than one
-        language.</td>
+        <td>Browser indicates preferences with the
+        <code>Accept-Language</code> header field. Each item can have
+        a quality factor. Variants can be associated with none, one or
+        more than one language.</td>
       </tr>
 
       <tr valign="top">
         <td>Encoding</td>
 
-        <td>Browser indicates preference with the Accept-Encoding
-        header field. Each item can have a quality factor.</td>
+        <td>Browser indicates preference with the
+        <code>Accept-Encoding</code> header field. Each item can have
+        a quality factor.</td>
       </tr>
 
       <tr valign="top">
         <td>Charset</td>
 
-        <td>Browser indicates preference with the Accept-Charset
-        header field. Each item can have a quality factor. Variants
-        can indicate a charset as a parameter of the media
-        type.</td>
+        <td>Browser indicates preference with the
+        <code>Accept-Charset</code> header field. Each item can have a
+        quality factor. Variants can indicate a charset as a parameter
+        of the media type.</td>
       </tr>
     </table>
 
 
 <h3><a name="algorithm" id="algorithm">Apache Negotiation Algorithm</a></h3>
 
@@ -326,36 +330,36 @@
         not selected at each test are eliminated. After each test,
         if only one variant remains, select it as the best match
         and proceed to step 3. If more than one variant remains,
         move on to the next test. 
 
         <ol>
-          <li>Multiply the quality factor from the Accept header
-          with the quality-of-source factor for this variant's
+          <li>Multiply the quality factor from the <code>Accept</code>
+          header with the quality-of-source factor for this variants
           media type, and select the variants with the highest
           value.</li>
 
           <li>Select the variants with the highest language quality
           factor.</li>
 
           <li>Select the variants with the best language match,
           using either the order of languages in the
-          Accept-Language header (if present), or else the order of
-          languages in the <code>LanguagePriority</code> directive
-          (if present).</li>
+          <code>Accept-Language</code> header (if present), or else
+          the order of languages in the <code>LanguagePriority</code>
+          directive (if present).</li>
 
           <li>Select the variants with the highest 'level' media
           parameter (used to give the version of text/html media
           types).</li>
 
           <li>Select variants with the best charset media
-          parameters, as given on the Accept-Charset header line.
-          Charset ISO-8859-1 is acceptable unless explicitly
-          excluded. Variants with a <code>text/*</code> media type
-          but not explicitly associated with a particular charset
-          are assumed to be in ISO-8859-1.</li>
+          parameters, as given on the <code>Accept-Charset</code>
+          header line.  Charset ISO-8859-1 is acceptable unless
+          explicitly excluded. Variants with a <code>text/*</code>
+          media type but not explicitly associated with a particular
+          charset are assumed to be in ISO-8859-1.</li>
 
           <li>Select those variants which have associated charset
           media parameters that are <em>not</em> ISO-8859-1. If
           there are no such variants, select all variants
           instead.</li>
 
@@ -376,45 +380,45 @@
           file name comes first when sorted using ASCII code
           order.</li>
         </ol>
       </li>
 
       <li>The algorithm has now selected one 'best' variant, so
-      return it as the response. The HTTP response header Vary is
-      set to indicate the dimensions of negotiation (browsers and
-      caches can use this information when caching the resource).
-      End.</li>
+      return it as the response. The HTTP response header
+      <code>Vary</code> is set to indicate the dimensions of
+      negotiation (browsers and caches can use this information when
+      caching the resource).  End.</li>
 
       <li>To get here means no variant was selected (because none
       are acceptable to the browser). Return a 406 status (meaning
       "No acceptable representation") with a response body
       consisting of an HTML document listing the available
-      variants. Also set the HTTP Vary header to indicate the
-      dimensions of variance.</li>
+      variants. Also set the HTTP <code>Vary</code> header to
+      indicate the dimensions of variance.</li>
     </ol>
 
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="better" id="better">Fiddling with Quality
     Values</a></h2>
 
     <p>Apache sometimes changes the quality values from what would
     be expected by a strict interpretation of the Apache
     negotiation algorithm above. This is to get a better result
     from the algorithm for browsers which do not send full or
     accurate information. Some of the most popular browsers send
-    Accept header information which would otherwise result in the
-    selection of the wrong variant in many cases. If a browser
-    sends full and correct information these fiddles will not be
-    applied.</p>
+    <code>Accept</code> header information which would otherwise
+    result in the selection of the wrong variant in many cases. If a
+    browser sends full and correct information these fiddles will not
+    be applied.</p>
 
 <h3><a name="wildcards" id="wildcards">Media Types and Wildcards</a></h3>
 
-    <p>The Accept: request header indicates preferences for media
-    types. It can also include 'wildcard' media types, such as
-    "image/*" or "*/*" where the * matches any string. So a request
+    <p>The <code>Accept:</code> request header indicates preferences
+    for media types. It can also include 'wildcard' media types, such
+    as "image/*" or "*/*" where the * matches any string. So a request
     including:</p>
 
 <div class="example"><p><code>Accept: image/*, */*</code></p></div>
 
     <p>would indicate that any type starting "image/" is acceptable,
     as is any other type.
@@ -433,64 +437,66 @@
 </code></p></div>
     <p>The explicit types have no quality factor, so they default to a
     preference of 1.0 (the highest). The wildcard */* is given a
     low preference of 0.01, so other types will only be returned if
     no variant matches an explicitly listed type.</p>
 
-    <p>If the Accept: header contains <em>no</em> q factors at all,
-    Apache sets the q value of "*/*", if present, to 0.01 to
-    emulate the desired behavior. It also sets the q value of
-    wildcards of the format "type/*" to 0.02 (so these are
-    preferred over matches against "*/*". If any media type on the
-    Accept: header contains a q factor, these special values are
-    <em>not</em> applied, so requests from browsers which send the
-    explicit information to start with work as expected.</p>
+    <p>If the <code>Accept:</code> header contains <em>no</em> q
+    factors at all, Apache sets the q value of "*/*", if present, to
+    0.01 to emulate the desired behavior. It also sets the q value of
+    wildcards of the format "type/*" to 0.02 (so these are preferred
+    over matches against "*/*". If any media type on the
+    <code>Accept:</code> header contains a q factor, these special
+    values are <em>not</em> applied, so requests from browsers which
+    send the explicit information to start with work as expected.</p>
 
 
 <h3><a name="exceptions" id="exceptions">Language Negotiation Exceptions</a></h3>
 
     <p>New in Apache 2.0, some exceptions have been added to the
     negotiation algorithm to allow graceful fallback when language
     negotiation fails to find a match.</p>
 
     <p>When a client requests a page on your server, but the server
-    cannot find a single page that matches the Accept-language sent by
+    cannot find a single page that matches the
+    <code>Accept-language</code> sent by
     the browser, the server will return either a "No Acceptable
     Variant" or "Multiple Choices" response to the client.  To avoid
     these error messages, it is possible to configure Apache to ignore
-    the Accept-language in these cases and provide a document that
-    does not explicitly match the client's request.  The <code class="directive"><a href="./mod/mod_negotiation.html#forcelanguagepriority">ForceLanguagePriority</a></code>
+    the <code>Accept-language</code> in these cases and provide a
+    document that does not explicitly match the client's request.  The
+    <code class="directive"><a href="./mod/mod_negotiation.html#forcelanguagepriority">ForceLanguagePriority</a></code>
     directive can be used to override one or both of these error
-    messages and substitute the servers judgement in the form of the 
+    messages and substitute the servers judgement in the form of the
     <code class="directive"><a href="./mod/mod_negotiation.html#languagepriority">LanguagePriority</a></code>
     directive.</p>
 
     <p>The server will also attempt to match language-subsets when no
     other match can be found.  For example, if a client requests
     documents with the language <code>en-GB</code> for British
     English, the server is not normally allowed by the HTTP/1.1
     standard to match that against a document that is marked as simply
     <code>en</code>.  (Note that it is almost surely a configuration
     error to include <code>en-GB</code> and not <code>en</code> in the
-    Accept-Language header, since it is very unlikely that a reader
-    understands British English, but doesn't understand English in
-    general.  Unfortunately, many current clients have default
-    configurations that resemble this.)  However, if no other language
-    match is possible and the server is about to return a "No
+    <code>Accept-Language</code> header, since it is very unlikely
+    that a reader understands British English, but doesn't understand
+    English in general.  Unfortunately, many current clients have
+    default configurations that resemble this.)  However, if no other
+    language match is possible and the server is about to return a "No
     Acceptable Variants" error or fallback to the <code class="directive"><a href="./mod/mod_negotiation.html#languagepriority">LanguagePriority</a></code>, the server
     will ignore the subset specification and match <code>en-GB</code>
     against <code>en</code> documents.  Implicitly, Apache will add
     the parent language to the client's acceptable language list with
     a very low quality value.  But note that if the client requests
     "en-GB; qs=0.9, fr; qs=0.8", and the server has documents
     designated "en" and "fr", then the "fr" document will be returned.
     This is necessary to maintain compliance with the HTTP/1.1
     specification and to work effectively with properly configured
     clients.</p>
 
-    <p>In order to support advanced techniques (such as Cookies or
+    <p>In order to support advanced techniques (such as cookies or
     special URL-paths) to determine the user's preferred language,
     since Apache 2.0.47 <code class="module"><a href="./mod/mod_negotiation.html">mod_negotiation</a></code> recognizes
     the <a href="env.html">environment variable</a>
     <code>prefer-language</code>. If it exists and contains an
     appropriate language tag, <code class="module"><a href="./mod/mod_negotiation.html">mod_negotiation</a></code> will
     try to select a matching variant. If there's no such variant,
@@ -509,15 +515,15 @@
 <p>Apache extends the transparent content negotiation protocol (RFC
 2295) as follows. A new <code>{encoding ..}</code> element is used in
 variant lists to label variants which are available with a specific
 content-encoding only. The implementation of the RVSA/1.0 algorithm
 (RFC 2296) is extended to recognize encoded variants in the list, and
 to use them as candidate variants whenever their encodings are
-acceptable according to the Accept-Encoding request header. The
-RVSA/1.0 implementation does not round computed quality factors to 5
-decimal places before choosing the best variant.</p>
+acceptable according to the <code>Accept-Encoding</code> request
+header. The RVSA/1.0 implementation does not round computed quality
+factors to 5 decimal places before choosing the best variant.</p>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="naming" id="naming">Note on hyperlinks and naming conventions</a></h2>
 
     <p>If you are using language negotiation you can choose between
     different naming conventions, because files can have more than
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/content-negotiation.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/content-negotiation.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/content-negotiation.xml	2003-07-01 03:25:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/content-negotiation.xml	2003-09-20 18:02:52.000000000 +0800
@@ -4,34 +4,34 @@
 <manualpage metafile="content-negotiation.xml.meta">
 
 <title>Content Negotiation</title>
 
 <summary>
 
-    <p>Apache's supports content negotiation as described in
+    <p>Apache supports content negotiation as described in
     the HTTP/1.1 specification. It can choose the best
     representation of a resource based on the browser-supplied
     preferences for media type, languages, character set and
     encoding. It also implements a couple of features to give
     more intelligent handling of requests from browsers that send
     incomplete negotiation information.</p>
 
     <p>Content negotiation is provided by the
-    <module>mod_negotiation</module> module.
-    which is compiled in by default.</p>
+    <module>mod_negotiation</module> module, which is compiled in
+    by default.</p>
 </summary>
 
 <section id="about"><title>About Content Negotiation</title>
 
     <p>A resource may be available in several different
     representations. For example, it might be available in
     different languages or different media types, or a combination.
     One way of selecting the most appropriate choice is to give the
     user an index page, and let them select. However it is often
     possible for the server to choose automatically. This works
-    because browsers can send as part of each request information
+    because browsers can send, as part of each request, information
     about what representations they prefer. For example, a browser
     could indicate that it would like to see information in French,
     if possible, else English will do. Browsers indicate their
     preferences by headers in the request. To request only French
     representations, the browser would send</p>
 
@@ -51,17 +51,18 @@
   Accept-Language: fr; q=1.0, en; q=0.5<br />
   Accept: text/html; q=1.0, text/*; q=0.8, image/gif; q=0.6, image/jpeg; q=0.6, image/*; q=0.5, */*; q=0.1
 </example>
 
     <p>Apache supports 'server driven' content negotiation, as
     defined in the HTTP/1.1 specification. It fully supports the
-    Accept, Accept-Language, Accept-Charset and Accept-Encoding
+    <code>Accept</code>, <code>Accept-Language</code>,
+    <code>Accept-Charset</code> and<code>Accept-Encoding</code> 
     request headers. Apache also supports 'transparent'
     content negotiation, which is an experimental negotiation
     protocol defined in RFC 2295 and RFC 2296. It does not offer
-    support for 'feature negotiation' as defined in these RFCs. </p>
+    support for 'feature negotiation' as defined in these RFCs.</p>
 
     <p>A <strong>resource</strong> is a conceptual entity
     identified by a URI (RFC 2396). An HTTP server like Apache
     provides access to <strong>representations</strong> of the
     resource(s) within its namespace, with each representation in
     the form of a sequence of bytes with a defined media type,
@@ -92,17 +93,19 @@
 
    <section id="type-map"><title>Using a type-map file</title>
 
     <p>A type map is a document which is associated with the
     handler named <code>type-map</code> (or, for
     backwards-compatibility with older Apache configurations, the
-    mime type <code>application/x-type-map</code>). Note that to
+    MIME type <code>application/x-type-map</code>). Note that to
     use this feature, you must have a handler set in the
     configuration that defines a file suffix as
-    <code>type-map</code>; this is best done with a</p>
+    <code>type-map</code>; this is best done with</p>
+
 <example>AddHandler type-map .var</example>
+
     <p>in the server configuration file.</p>
 
     <p>Type map files should have the same name as the resource
     which they are describing, and have an entry for each available
     variant; these entries consist of contiguous HTTP-format header
     lines. Entries for different variants are separated by blank
@@ -125,13 +128,13 @@
   Content-language: fr, de<br />
 </example>
     <p>Note also that a typemap file will take precedence over the
     filename's extension, even when Multiviews is on. If the
     variants have different source qualities, that may be indicated
     by the "qs" parameter to the media type, as in this picture
-    (available as jpeg, gif, or ASCII-art): </p>
+    (available as JPEG, GIF, or ASCII-art): </p>
 
 <example>
   URI: foo<br />
 <br />
   URI: foo.jpeg<br />
   Content-type: image/jpeg; qs=0.8<br />
@@ -145,17 +148,17 @@
 
     <p>qs values can vary in the range 0.000 to 1.000. Note that
     any variant with a qs value of 0.000 will never be chosen.
     Variants with no 'qs' parameter value are given a qs factor of
     1.0. The qs parameter indicates the relative 'quality' of this
     variant compared to the other available variants, independent
-    of the client's capabilities. For example, a jpeg file is
-    usually of higher source quality than an ascii file if it is
+    of the client's capabilities. For example, a JPEG file is
+    usually of higher source quality than an ASCII file if it is
     attempting to represent a photograph. However, if the resource
-    being represented is an original ascii art, then an ascii
-    representation would have a higher source quality than a jpeg
+    being represented is an original ASCII art, then an ASCII
+    representation would have a higher source quality than a JPEG
     representation. A qs value is therefore specific to a given
     variant depending on the nature of the resource it
     represents.</p>
 
     <p>The full list of headers recognized is available in the <a
     href="mod/mod_negotiation.html#typemaps">mod_negotation
@@ -249,41 +252,42 @@
         <th>Notes</th>
       </tr>
 
       <tr valign="top">
         <td>Media Type</td>
 
-        <td>Browser indicates preferences with the Accept header
-        field. Each item can have an associated quality factor.
-        Variant description can also have a quality factor (the
-        "qs" parameter).</td>
+        <td>Browser indicates preferences with the <code>Accept</code>
+        header field. Each item can have an associated quality factor.
+        Variant description can also have a quality factor (the "qs"
+        parameter).</td>
       </tr>
 
       <tr valign="top">
         <td>Language</td>
 
-        <td>Browser indicates preferences with the Accept-Language
-        header field. Each item can have a quality factor. Variants
-        can be associated with none, one or more than one
-        language.</td>
+        <td>Browser indicates preferences with the
+        <code>Accept-Language</code> header field. Each item can have
+        a quality factor. Variants can be associated with none, one or
+        more than one language.</td>
       </tr>
 
       <tr valign="top">
         <td>Encoding</td>
 
-        <td>Browser indicates preference with the Accept-Encoding
-        header field. Each item can have a quality factor.</td>
+        <td>Browser indicates preference with the
+        <code>Accept-Encoding</code> header field. Each item can have
+        a quality factor.</td>
       </tr>
 
       <tr valign="top">
         <td>Charset</td>
 
-        <td>Browser indicates preference with the Accept-Charset
-        header field. Each item can have a quality factor. Variants
-        can indicate a charset as a parameter of the media
-        type.</td>
+        <td>Browser indicates preference with the
+        <code>Accept-Charset</code> header field. Each item can have a
+        quality factor. Variants can indicate a charset as a parameter
+        of the media type.</td>
       </tr>
     </table>
 </section>
 
 <section id="algorithm"><title>Apache Negotiation Algorithm</title>
 
@@ -304,36 +308,36 @@
         not selected at each test are eliminated. After each test,
         if only one variant remains, select it as the best match
         and proceed to step 3. If more than one variant remains,
         move on to the next test. 
 
         <ol>
-          <li>Multiply the quality factor from the Accept header
-          with the quality-of-source factor for this variant's
+          <li>Multiply the quality factor from the <code>Accept</code>
+          header with the quality-of-source factor for this variants
           media type, and select the variants with the highest
           value.</li>
 
           <li>Select the variants with the highest language quality
           factor.</li>
 
           <li>Select the variants with the best language match,
           using either the order of languages in the
-          Accept-Language header (if present), or else the order of
-          languages in the <code>LanguagePriority</code> directive
-          (if present).</li>
+          <code>Accept-Language</code> header (if present), or else
+          the order of languages in the <code>LanguagePriority</code>
+          directive (if present).</li>
 
           <li>Select the variants with the highest 'level' media
           parameter (used to give the version of text/html media
           types).</li>
 
           <li>Select variants with the best charset media
-          parameters, as given on the Accept-Charset header line.
-          Charset ISO-8859-1 is acceptable unless explicitly
-          excluded. Variants with a <code>text/*</code> media type
-          but not explicitly associated with a particular charset
-          are assumed to be in ISO-8859-1.</li>
+          parameters, as given on the <code>Accept-Charset</code>
+          header line.  Charset ISO-8859-1 is acceptable unless
+          explicitly excluded. Variants with a <code>text/*</code>
+          media type but not explicitly associated with a particular
+          charset are assumed to be in ISO-8859-1.</li>
 
           <li>Select those variants which have associated charset
           media parameters that are <em>not</em> ISO-8859-1. If
           there are no such variants, select all variants
           instead.</li>
 
@@ -354,45 +358,45 @@
           file name comes first when sorted using ASCII code
           order.</li>
         </ol>
       </li>
 
       <li>The algorithm has now selected one 'best' variant, so
-      return it as the response. The HTTP response header Vary is
-      set to indicate the dimensions of negotiation (browsers and
-      caches can use this information when caching the resource).
-      End.</li>
+      return it as the response. The HTTP response header
+      <code>Vary</code> is set to indicate the dimensions of
+      negotiation (browsers and caches can use this information when
+      caching the resource).  End.</li>
 
       <li>To get here means no variant was selected (because none
       are acceptable to the browser). Return a 406 status (meaning
       "No acceptable representation") with a response body
       consisting of an HTML document listing the available
-      variants. Also set the HTTP Vary header to indicate the
-      dimensions of variance.</li>
+      variants. Also set the HTTP <code>Vary</code> header to
+      indicate the dimensions of variance.</li>
     </ol>
 </section>
 </section>
 
 <section id="better"><title>Fiddling with Quality
     Values</title>
 
     <p>Apache sometimes changes the quality values from what would
     be expected by a strict interpretation of the Apache
     negotiation algorithm above. This is to get a better result
     from the algorithm for browsers which do not send full or
     accurate information. Some of the most popular browsers send
-    Accept header information which would otherwise result in the
-    selection of the wrong variant in many cases. If a browser
-    sends full and correct information these fiddles will not be
-    applied.</p>
+    <code>Accept</code> header information which would otherwise
+    result in the selection of the wrong variant in many cases. If a
+    browser sends full and correct information these fiddles will not
+    be applied.</p>
 
 <section id="wildcards"><title>Media Types and Wildcards</title>
 
-    <p>The Accept: request header indicates preferences for media
-    types. It can also include 'wildcard' media types, such as
-    "image/*" or "*/*" where the * matches any string. So a request
+    <p>The <code>Accept:</code> request header indicates preferences
+    for media types. It can also include 'wildcard' media types, such
+    as "image/*" or "*/*" where the * matches any string. So a request
     including:</p>
 
 <example>Accept: image/*, */*</example>
 
     <p>would indicate that any type starting "image/" is acceptable,
     as is any other type.
@@ -411,66 +415,68 @@
 </example>
     <p>The explicit types have no quality factor, so they default to a
     preference of 1.0 (the highest). The wildcard */* is given a
     low preference of 0.01, so other types will only be returned if
     no variant matches an explicitly listed type.</p>
 
-    <p>If the Accept: header contains <em>no</em> q factors at all,
-    Apache sets the q value of "*/*", if present, to 0.01 to
-    emulate the desired behavior. It also sets the q value of
-    wildcards of the format "type/*" to 0.02 (so these are
-    preferred over matches against "*/*". If any media type on the
-    Accept: header contains a q factor, these special values are
-    <em>not</em> applied, so requests from browsers which send the
-    explicit information to start with work as expected.</p>
+    <p>If the <code>Accept:</code> header contains <em>no</em> q
+    factors at all, Apache sets the q value of "*/*", if present, to
+    0.01 to emulate the desired behavior. It also sets the q value of
+    wildcards of the format "type/*" to 0.02 (so these are preferred
+    over matches against "*/*". If any media type on the
+    <code>Accept:</code> header contains a q factor, these special
+    values are <em>not</em> applied, so requests from browsers which
+    send the explicit information to start with work as expected.</p>
 </section>
 
 <section id="exceptions"><title>Language Negotiation Exceptions</title>
 
     <p>New in Apache 2.0, some exceptions have been added to the
     negotiation algorithm to allow graceful fallback when language
     negotiation fails to find a match.</p>
 
     <p>When a client requests a page on your server, but the server
-    cannot find a single page that matches the Accept-language sent by
+    cannot find a single page that matches the
+    <code>Accept-language</code> sent by
     the browser, the server will return either a "No Acceptable
     Variant" or "Multiple Choices" response to the client.  To avoid
     these error messages, it is possible to configure Apache to ignore
-    the Accept-language in these cases and provide a document that
-    does not explicitly match the client's request.  The <directive
+    the <code>Accept-language</code> in these cases and provide a
+    document that does not explicitly match the client's request.  The
+    <directive
     module="mod_negotiation">ForceLanguagePriority</directive>
     directive can be used to override one or both of these error
-    messages and substitute the servers judgement in the form of the 
+    messages and substitute the servers judgement in the form of the
     <directive module="mod_negotiation">LanguagePriority</directive>
     directive.</p>
 
     <p>The server will also attempt to match language-subsets when no
     other match can be found.  For example, if a client requests
     documents with the language <code>en-GB</code> for British
     English, the server is not normally allowed by the HTTP/1.1
     standard to match that against a document that is marked as simply
     <code>en</code>.  (Note that it is almost surely a configuration
     error to include <code>en-GB</code> and not <code>en</code> in the
-    Accept-Language header, since it is very unlikely that a reader
-    understands British English, but doesn't understand English in
-    general.  Unfortunately, many current clients have default
-    configurations that resemble this.)  However, if no other language
-    match is possible and the server is about to return a "No
+    <code>Accept-Language</code> header, since it is very unlikely
+    that a reader understands British English, but doesn't understand
+    English in general.  Unfortunately, many current clients have
+    default configurations that resemble this.)  However, if no other
+    language match is possible and the server is about to return a "No
     Acceptable Variants" error or fallback to the <directive
     module="mod_negotiation">LanguagePriority</directive>, the server
     will ignore the subset specification and match <code>en-GB</code>
     against <code>en</code> documents.  Implicitly, Apache will add
     the parent language to the client's acceptable language list with
     a very low quality value.  But note that if the client requests
     "en-GB; qs=0.9, fr; qs=0.8", and the server has documents
     designated "en" and "fr", then the "fr" document will be returned.
     This is necessary to maintain compliance with the HTTP/1.1
     specification and to work effectively with properly configured
     clients.</p>
 
-    <p>In order to support advanced techniques (such as Cookies or
+    <p>In order to support advanced techniques (such as cookies or
     special URL-paths) to determine the user's preferred language,
     since Apache 2.0.47 <module>mod_negotiation</module> recognizes
     the <a href="env.html">environment variable</a>
     <code>prefer-language</code>. If it exists and contains an
     appropriate language tag, <module>mod_negotiation</module> will
     try to select a matching variant. If there's no such variant,
@@ -489,15 +495,15 @@
 <p>Apache extends the transparent content negotiation protocol (RFC
 2295) as follows. A new <code>{encoding ..}</code> element is used in
 variant lists to label variants which are available with a specific
 content-encoding only. The implementation of the RVSA/1.0 algorithm
 (RFC 2296) is extended to recognize encoded variants in the list, and
 to use them as candidate variants whenever their encodings are
-acceptable according to the Accept-Encoding request header. The
-RVSA/1.0 implementation does not round computed quality factors to 5
-decimal places before choosing the best variant.</p>
+acceptable according to the <code>Accept-Encoding</code> request
+header. The RVSA/1.0 implementation does not round computed quality
+factors to 5 decimal places before choosing the best variant.</p>
 </section>
 
 <section id="naming"><title>Note on hyperlinks and naming conventions</title>
 
     <p>If you are using language negotiation you can choose between
     different naming conventions, because files can have more than
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html	2003-07-06 04:36:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html	2003-07-08 01:04:16.000000000 +0800
@@ -6,6 +6,10 @@
 Content-Language: ja
 Content-type: text/html; charset=ISO-2022-JP
 
 URI: filter.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
+
+URI: filter.html.ru.koi8-r
+Content-Language: ru
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.en	2003-06-30 09:23:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.en	2003-07-08 04:36:56.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="./">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>Filters</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./en/filter.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>This document describes the use of filters in Apache.</p>
   </div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
@@ -66,11 +67,12 @@
     <p>In addition, the module <code class="module"><a href="./mod/mod_ext_filter.html">mod_ext_filter</a></code> allows
     for external programs to be defined as filters.</p>
   </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./en/filter.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">Modules</a> | <a href="./mod/directives.html">Directives</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">Glossary</a> | <a href="./sitemap.html">Sitemap</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.ja.jis	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.ja.jis	2003-07-08 04:36:56.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP $B%5!<%P(B</a> &gt; <a href="http://httpd.apache.org/docs-project/">$B%I%-%e%a%s%F!<%7%g%s(B</a> &gt; <a href="./">$B%P!<%8%g%s(B 2.0</a></div><div id="page-content"><div id="preamble"><h1>$B%U%#%k%?(B</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./en/filter.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>Apache $B$G$N%U%#%k%?$N;H$$J}$K$D$$$F5-=R$7$F$$$^$9!#(B</p>
   </div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
@@ -66,11 +67,12 @@
     <p>$B$^$?!"(B<code class="module"><a href="./mod/mod_ext_filter.html">mod_ext_filter</a></code> $B%b%8%e!<%k$G(B
     $B30It%W%m%0%i%`$r%U%#%k%?$H$7$F;XDj$9$k$3$H$,$G$-$^$9!#(B</p>
   </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./en/filter.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">$B%b%8%e!<%k(B</a> | <a href="./mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">$BMQ8l(B</a> | <a href="./sitemap.html">$B%5%$%H%^%C%W(B</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.ko.euc-kr /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.ko.euc-kr
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.html.ko.euc-kr	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.html.ko.euc-kr	2003-07-08 04:36:56.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="./">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>ÇÊÅÍ</h1>
 <div class="toplang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./en/filter.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>ÀÌ ¹®¼­´Â ¾ÆÆÄÄ¡¿¡¼­ ÇÊÅÍ¸¦ »ç¿ëÇÏ´Â ¹æ¹ýÀ» ¼³¸íÇÑ´Ù.</p>
   </div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
@@ -64,11 +65,12 @@
     <p>¶Ç, <code class="module"><a href="./mod/mod_ext_filter.html">mod_ext_filter</a></code> ¸ðµâÀ» »ç¿ëÇÏ¿©
     ¿ÜºÎ ÇÁ·Î±×·¥À» ÇÊÅÍ·Î »ç¿ëÇÒ ¼öµµ ÀÖ´Ù.</p>
   </div></div>
 <div class="bottomlang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./en/filter.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/filter.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/filter.html" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/filter.html" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/filter.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">¸ðµâ</a> | <a href="./mod/directives.html">Áö½Ã¾îµé</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">¿ë¾î</a> | <a href="./sitemap.html">»çÀÌÆ®¸Ê</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: filter.html.ru.koi8-r
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/filter.xml.meta	2003-05-11 00:50:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/filter.xml.meta	2003-07-07 20:47:28.000000000 +0800
@@ -6,8 +6,9 @@
   <relpath>.</relpath>
 
   <variants>
     <variant>en</variant>
     <variant>ja</variant>
     <variant>ko</variant>
+    <variant>ru</variant>
   </variants>
 </metafile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: filter.xml.ru
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/glossary.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/glossary.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/glossary.html.en	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/glossary.html.en	2003-10-13 00:11:35.000000000 +0800
@@ -50,29 +50,29 @@
 <dt><a name="apacheextensiontool">APache eXtension Tool</a> <a name="apxs">(apxs)</a></dt> <dd>A perl script that aids in compiling <a href="#module">module</a> sources into Dynamic Shared Objects (<a href="#dso">DSO</a>s) and helps install them in the Apache Web
 server.<br /> See: <a href="programs/apxs.html">Manual Page: apxs</a></dd>
 
 <dt><a name="certificate">Certificate</a></dt>
 <dd>A data record used for authenticating network entities such
     as a server or a client. A certificate contains X.509 information pieces
-    about its owner (called the subject) and the signing <em>Certificate
-    Authority</em> (called the issuer), plus the owner's public key and the
-    signature made by the CA. Network entities verify these signatures using
-    CA certificates.<br />
+    about its owner (called the subject) and the signing <a href="#certificationauthority">Certification Authority</a> (called the
+    issuer), plus the owner's <a href="#publickey">public key</a> and the
+    signature made by the CA. Network entities verify these signatures
+    using CA certificates.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="certificationauthority">Certification Authority</a> <a name="ca">(CA)</a></dt> <dd>A trusted third party whose purpose is to
 sign certificates for network entities it has authenticated using
 secure means. Other network entities can check the signature to verify
 that a CA has authenticated the bearer of a certificate.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="certificatsigningrequest">Certificate Signing Request</a>
-<a name="csr">(CSR)</a></dt> <dd>An unsigned certificate for
-submission to a <em>Certification Authority</em>, which signs it with
-the <em>Private Key</em> of their CA <em>Certificate</em>. Once the
-CSR is signed, it becomes a real certificate.<br />
+<a name="csr">(CSR)</a></dt> <dd>An unsigned <a href="#certificate">certificate</a> for submission to a <a href="#certificationauthority">Certification Authority</a>, which signs it
+with the <a href="#privatekey">Private Key</a> of their CA
+<em>Certificate</em>. Once the CSR is signed, it becomes a real
+certificate.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 
 <dt><a name="cipher">Cipher</a></dt> <dd>An algorithm or system for
 data encryption. Examples are DES, IDEA, RC4, etc.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
@@ -104,17 +104,18 @@
 <dt><a name="context">Context</a></dt> <dd>An area in the <a href="#configurationfile">configuration files</a> where certain types
 of <a href="#directive">directives</a> are allowed.<br /> See: <a href="mod/directive-dict.html#Context">Terms
 Used to Describe Apache Directives</a></dd>
 
 <dt><a name="digitalsignature">Digital Signature</a></dt>
 <dd>An encrypted text block that validates a certificate or other file. A
-    <em>Certification Authority</em> creates a signature by generating a
-    hash of the <em>Public Key</em> embedded in a <em>Certificate</em>, then
-    encrypting the hash with its own <em>Private Key</em>. Only the CA's
-    public key can decrypt the signature, verifying that the CA has
-    authenticated the network entity that owns the <em>Certificate</em>.<br />
+    <a href="#certificationauthority">Certification Authority</a> creates a
+    signature by generating a hash of the <em>Public Key</em> embedded in a
+    <em>Certificate</em>, then encrypting the hash with its own <em>Private
+    Key</em>. Only the CA's public key can decrypt the signature, verifying
+    that the CA has authenticated the network entity that owns the
+    <em>Certificate</em>.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="directive">Directive</a></dt> <dd>A configuration command
 that controls one or more aspects of Apache's behavior.  Directives
 are placed in the <a href="#configurationfile">Configuration
 File</a><br /> See: <a href="mod/directives.html">Directive
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/glossary.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/glossary.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/glossary.xml	2003-04-24 06:43:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/glossary.xml	2003-10-13 00:11:35.000000000 +0800
@@ -40,30 +40,33 @@
 server.<br /> See: <a
 href="programs/apxs.html">Manual Page: apxs</a></dd>
 
 <dt><a name="certificate">Certificate</a></dt>
 <dd>A data record used for authenticating network entities such
     as a server or a client. A certificate contains X.509 information pieces
-    about its owner (called the subject) and the signing <em>Certificate
-    Authority</em> (called the issuer), plus the owner's public key and the
-    signature made by the CA. Network entities verify these signatures using
-    CA certificates.<br />
+    about its owner (called the subject) and the signing <a
+    href="#certificationauthority">Certification Authority</a> (called the
+    issuer), plus the owner's <a href="#publickey">public key</a> and the
+    signature made by the CA. Network entities verify these signatures
+    using CA certificates.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="certificationauthority">Certification Authority</a> <a
 name="ca">(CA)</a></dt> <dd>A trusted third party whose purpose is to
 sign certificates for network entities it has authenticated using
 secure means. Other network entities can check the signature to verify
 that a CA has authenticated the bearer of a certificate.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="certificatsigningrequest">Certificate Signing Request</a>
-<a name="csr">(CSR)</a></dt> <dd>An unsigned certificate for
-submission to a <em>Certification Authority</em>, which signs it with
-the <em>Private Key</em> of their CA <em>Certificate</em>. Once the
-CSR is signed, it becomes a real certificate.<br />
+<a name="csr">(CSR)</a></dt> <dd>An unsigned <a
+href="#certificate">certificate</a> for submission to a <a
+href="#certificationauthority">Certification Authority</a>, which signs it
+with the <a href="#privatekey">Private Key</a> of their CA
+<em>Certificate</em>. Once the CSR is signed, it becomes a real
+certificate.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 
 <dt><a name="cipher">Cipher</a></dt> <dd>An algorithm or system for
 data encryption. Examples are DES, IDEA, RC4, etc.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
@@ -101,17 +104,18 @@
 of <a href="#directive">directives</a> are allowed.<br /> See: <a
 href="mod/directive-dict.html#Context">Terms
 Used to Describe Apache Directives</a></dd>
 
 <dt><a name="digitalsignature">Digital Signature</a></dt>
 <dd>An encrypted text block that validates a certificate or other file. A
-    <em>Certification Authority</em> creates a signature by generating a
-    hash of the <em>Public Key</em> embedded in a <em>Certificate</em>, then
-    encrypting the hash with its own <em>Private Key</em>. Only the CA's
-    public key can decrypt the signature, verifying that the CA has
-    authenticated the network entity that owns the <em>Certificate</em>.<br />
+    <a href="#certificationauthority">Certification Authority</a> creates a
+    signature by generating a hash of the <em>Public Key</em> embedded in a
+    <em>Certificate</em>, then encrypting the hash with its own <em>Private
+    Key</em>. Only the CA's public key can decrypt the signature, verifying
+    that the CA has authenticated the network entity that owns the
+    <em>Certificate</em>.<br />
 See: <a href="ssl/">SSL/TLS Encryption</a></dd>
 
 <dt><a name="directive">Directive</a></dt> <dd>A configuration command
 that controls one or more aspects of Apache's behavior.  Directives
 are placed in the <a href="#configurationfile">Configuration
 File</a><br /> See: <a href="mod/directives.html">Directive
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html	2003-07-18 06:00:06.000000000 +0800
@@ -6,6 +6,10 @@
 Content-Language: ja
 Content-type: text/html; charset=ISO-2022-JP
 
 URI: handler.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
+
+URI: handler.html.ru.koi8-r
+Content-Language: ru
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.en	2003-06-30 09:23:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.en	2003-07-18 06:00:06.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="./">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>Apache's Handler Use</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./en/handler.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>This document describes the use of Apache's Handlers.</p>
   </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#definition">What is a Handler</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#examples">Examples</a></li>
@@ -141,11 +142,12 @@
     handlers is to use a dash-separated word, with no slashes, so
     as to not invade the media type name-space.</p>
   </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./en/handler.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">Modules</a> | <a href="./mod/directives.html">Directives</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">Glossary</a> | <a href="./sitemap.html">Sitemap</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.ja.jis	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.ja.jis	2003-07-18 06:00:06.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP $B%5!<%P(B</a> &gt; <a href="http://httpd.apache.org/docs-project/">$B%I%-%e%a%s%F!<%7%g%s(B</a> &gt; <a href="./">$B%P!<%8%g%s(B 2.0</a></div><div id="page-content"><div id="preamble"><h1>Apache $B$N%O%s%I%i$N;HMQ(B</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./en/handler.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>Apache $B$N%O%s%I%i$N;HMQ$K4X$7$F5-=R$7$F$$$^$9!#(B</p>
   </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#definition">$B%O%s%I%i$H$O(B</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#examples">$BNc(B</a></li>
@@ -145,11 +146,12 @@
     $B$NL>A06u4V$r?/$5$J$$$h$&$K!"%O%s%I%i$NL>A0$K$O%9%i%C%7%e$r4^$^$J$$!"(B
     $B%@%C%7%e(B ($BLuCm(B: "-") $B$GJ,N%$5$l$?L>A0$rIU$1$k=,47$K$J$C$F$$$^$9!#(B</p>
   </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./en/handler.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">$B%b%8%e!<%k(B</a> | <a href="./mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">$BMQ8l(B</a> | <a href="./sitemap.html">$B%5%$%H%^%C%W(B</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.ko.euc-kr /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.ko.euc-kr
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.html.ko.euc-kr	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.html.ko.euc-kr	2003-07-18 06:00:06.000000000 +0800
@@ -17,13 +17,14 @@
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="./">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>¾ÆÆÄÄ¡¿¡¼­ ÇÚµé·¯ »ç¿ë</h1>
 <div class="toplang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./en/handler.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>ÀÌ ¹®¼­´Â ¾ÆÆÄÄ¡¿¡¼­ ÇÚµé·¯¸¦ »ç¿ëÇÏ´Â ¹æ¹ýÀ» ¼³¸íÇÑ´Ù.</p>
   </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#definition">ÇÚµé·¯°¡ ¹«¾ùÀÎ°¡</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#examples">¿¹Á¦</a></li>
@@ -135,11 +136,12 @@
     ±âÈ£¸¦ »ç¿ëÇÏ´Â °ÍÀÌ ÀÏ¹ÝÀûÀÌ´Ù. ±×·¡¼­ ÇÚµé·¯ ÀÌ¸§ÀÌ
     media type°ú °ãÄ¡Áö ¾Ê´Â´Ù.</p>
   </div></div>
 <div class="bottomlang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./en/handler.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/handler.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/handler.html" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/handler.html" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/handler.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">¸ðµâ</a> | <a href="./mod/directives.html">Áö½Ã¾îµé</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">¿ë¾î</a> | <a href="./sitemap.html">»çÀÌÆ®¸Ê</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: handler.html.ru.koi8-r
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/handler.xml.meta	2003-05-11 00:50:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/handler.xml.meta	2003-07-15 16:24:11.000000000 +0800
@@ -6,8 +6,9 @@
   <relpath>.</relpath>
 
   <variants>
     <variant>en</variant>
     <variant>ja</variant>
     <variant>ko</variant>
+    <variant>ru</variant>
   </variants>
 </metafile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: handler.xml.ru
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html	2003-08-09 07:00:04.000000000 +0800
@@ -3,17 +3,17 @@
 Content-type: text/html; charset=ISO-8859-1
 
 URI: index.html.en
 Content-Language: en
 Content-type: text/html; charset=ISO-8859-1
 
-URI: index.html.fr
-Content-Language: fr
-Content-type: text/html; charset=ISO-8859-1
-
 URI: index.html.ja.jis
 Content-Language: ja
 Content-type: text/html; charset=ISO-2022-JP
 
 URI: index.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
+
+URI: index.html.ru.koi8-r
+Content-Language: ru
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.de	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.de	2003-08-09 22:32:54.000000000 +0800
@@ -19,15 +19,15 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP-Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Dokumentation</a></div>
 <div id="page-content"><h1>Dokumentation zum Apache HTTP Server Version 2.0</h1>
 <div class="toplang">
 <p><span>Verfügbare Sprachen: </span><a href="./de/" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Français">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 <form method="get" action="http://www.google.com/search"><p><input name="as_q" value="" type="text" /> <input value="Google-Suche" type="submit" /><input value="10" name="num" type="hidden" /><input value="de" name="hl" type="hidden" /><input value="ISO-8859-1" name="ie" type="hidden" /><input value="Google Search" name="btnG" type="hidden" /><input name="as_epq" value="Apache 2.0" type="hidden" /><input name="as_oq" value="" type="hidden" /><input name="as_eq" value="&quot;List-Post&quot;" type="hidden" /><input value="" name="lr" type="hidden" /><input value="i" name="as_ft" type="hidden" /><input value="" name="as_filetype" type="hidden" /><input value="all" name="as_qdr" type="hidden" /><input value="any" name="as_occt" type="hidden" /><input value="i" name="as_dt" type="hidden" /><input value="httpd.apache.org" name="as_sitesearch" type="hidden" /><input value="off" name="safe" type="hidden" /></p></form>
 <table id="indextable"><tr><td class="col1"><div class="category"><h2><a name="release" id="release">Hinweise zur Version</a></h2>
 <ul><li><a href="new_features_2_0.html">Neue Funktionen in Version 2.0</a></li>
 <li><a href="upgrading.html">Upgrade auf Version 2.0</a></li>
 <li><a href="license.html">Apache-Lizenz</a></li>
@@ -84,13 +84,13 @@
 <li><a href="misc/">Sonstiges</a></li>
 </ul>
 </div></td></tr></table></div>
 <div class="bottomlang">
 <p><span>Verfügbare Sprachen: </span><a href="./de/" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Français">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Gepflegt durch das <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">Module</a> | <a href="./mod/directives.html">Direktiven</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">Glossar</a> | <a href="./sitemap.html">Seitenindex</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.en	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.en	2003-08-09 22:32:54.000000000 +0800
@@ -19,15 +19,15 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a></div>
 <div id="page-content"><h1>Apache HTTP Server Version 2.0 Documentation</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Français">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 <form method="get" action="http://www.google.com/search"><p><input name="as_q" value="" type="text" /> <input value="Google Search" type="submit" /><input value="10" name="num" type="hidden" /><input value="en" name="hl" type="hidden" /><input value="ISO-8859-1" name="ie" type="hidden" /><input value="Google Search" name="btnG" type="hidden" /><input name="as_epq" value="Apache 2.0" type="hidden" /><input name="as_oq" value="" type="hidden" /><input name="as_eq" value="&quot;List-Post&quot;" type="hidden" /><input value="" name="lr" type="hidden" /><input value="i" name="as_ft" type="hidden" /><input value="" name="as_filetype" type="hidden" /><input value="all" name="as_qdr" type="hidden" /><input value="any" name="as_occt" type="hidden" /><input value="i" name="as_dt" type="hidden" /><input value="httpd.apache.org" name="as_sitesearch" type="hidden" /><input value="off" name="safe" type="hidden" /></p></form>
 <table id="indextable"><tr><td class="col1"><div class="category"><h2><a name="release" id="release">Release Notes</a></h2>
 <ul><li><a href="new_features_2_0.html">New features with Apache 2.0</a></li>
 <li><a href="upgrading.html">Upgrading to 2.0 from 1.3</a></li>
 <li><a href="license.html">Apache License</a></li>
@@ -83,13 +83,13 @@
 <li><a href="misc/">Other Notes</a></li>
 </ul>
 </div></td></tr></table></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Français">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">Modules</a> | <a href="./mod/directives.html">Directives</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">Glossary</a> | <a href="./sitemap.html">Sitemap</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual: index.html.fr
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.ja.jis	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.ja.jis	2003-08-09 22:32:54.000000000 +0800
@@ -19,15 +19,15 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP $B%5!<%P(B</a> &gt; <a href="http://httpd.apache.org/docs-project/">$B%I%-%e%a%s%F!<%7%g%s(B</a></div>
 <div id="page-content"><h1>Apache HTTP $B%5!<%P(B $B%P!<%8%g%s(B 2.0 $B%I%-%e%a%s%H(B</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 <form method="get" action="http://www.google.com/search"><p><input name="as_q" value="" type="text" /> <input value="Google Search" type="submit" /><input value="10" name="num" type="hidden" /><input value="ja" name="hl" type="hidden" /><input value="iso-2022-jp" name="ie" type="hidden" /><input value="Google Search" name="btnG" type="hidden" /><input name="as_epq" value="Apache 2.0" type="hidden" /><input name="as_oq" value="" type="hidden" /><input name="as_eq" value="&quot;List-Post&quot;" type="hidden" /><input value="" name="lr" type="hidden" /><input value="i" name="as_ft" type="hidden" /><input value="" name="as_filetype" type="hidden" /><input value="all" name="as_qdr" type="hidden" /><input value="any" name="as_occt" type="hidden" /><input value="i" name="as_dt" type="hidden" /><input value="httpd.apache.org" name="as_sitesearch" type="hidden" /><input value="off" name="safe" type="hidden" /></p></form>
 <table id="indextable"><tr><td class="col1"><div class="category"><h2><a name="release" id="release">$B%j%j!<%9%N!<%H(B</a></h2>
 <ul><li><a href="new_features_2_0.html">Apache 2.0 $B$N?75!G=(B</a></li>
 <li><a href="upgrading.html">1.3 $B$+$i(B 2.0 $B$X$N%"%C%W%0%l!<%I(B</a></li>
 <li><a href="license.html">Apache $B%i%$%;%s%9(B</a></li>
@@ -83,13 +83,13 @@
 <li><a href="misc/">$B$=$NB>(B</a></li>
 </ul>
 </div></td></tr></table></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">$B%b%8%e!<%k(B</a> | <a href="./mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">$BMQ8l(B</a> | <a href="./sitemap.html">$B%5%$%H%^%C%W(B</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.ko.euc-kr /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.ko.euc-kr
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.html.ko.euc-kr	2003-05-30 03:29:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.html.ko.euc-kr	2003-08-09 22:32:54.000000000 +0800
@@ -19,15 +19,15 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a></div>
 <div id="page-content"><h1>Apache HTTP Server Version 2.0 ¹®¼­</h1>
 <div class="toplang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 <form method="get" action="http://www.google.com/search"><p><input name="as_q" value="" type="text" /> <input value="Google °Ë»ö" type="submit" /><input value="10" name="num" type="hidden" /><input value="ko" name="hl" type="hidden" /><input value="EUC-KR" name="ie" type="hidden" /><input value="Google Search" name="btnG" type="hidden" /><input name="as_epq" value="Apache 2.0" type="hidden" /><input name="as_oq" value="" type="hidden" /><input name="as_eq" value="&quot;List-Post&quot;" type="hidden" /><input value="" name="lr" type="hidden" /><input value="i" name="as_ft" type="hidden" /><input value="" name="as_filetype" type="hidden" /><input value="all" name="as_qdr" type="hidden" /><input value="any" name="as_occt" type="hidden" /><input value="i" name="as_dt" type="hidden" /><input value="httpd.apache.org" name="as_sitesearch" type="hidden" /><input value="off" name="safe" type="hidden" /></p></form>
 <table id="indextable"><tr><td class="col1"><div class="category"><h2><a name="release" id="release">¹ßÇ¥¹®</a></h2>
 <ul><li><a href="new_features_2_0.html">¹öÀü 2.0ÀÇ »õ·Î¿î ±â´É</a></li>
 <li><a href="upgrading.html">1.3¿¡¼­ 2.0 ¹öÀüÀ¸·Î ¾÷±×·¹ÀÌµå</a></li>
 <li><a href="license.html">¾ÆÆÄÄ¡ ¶óÀÌ¼±½º</a></li>
@@ -83,13 +83,13 @@
 <li><a href="misc/">±âÅ¸</a></li>
 </ul>
 </div></td></tr></table></div>
 <div class="bottomlang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="./de/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
-<a href="./fr/" hreflang="fr" rel="alternate" title="Fran&#231;ais">&nbsp;fr&nbsp;</a> |
 <a href="./ja/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="./ko/" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="./ko/" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="./ru/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="./mod/">¸ðµâ</a> | <a href="./mod/directives.html">Áö½Ã¾îµé</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">¿ë¾î</a> | <a href="./sitemap.html">»çÀÌÆ®¸Ê</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: index.html.ru.koi8-r
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/index.xml.meta	2003-05-20 22:29:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/index.xml.meta	2003-08-09 07:00:04.000000000 +0800
@@ -5,11 +5,11 @@
   <path>/</path>
   <relpath>.</relpath>
 
   <variants>
     <variant>de</variant>
     <variant>en</variant>
-    <variant htmlonly="yes">fr</variant>
     <variant>ja</variant>
     <variant>ko</variant>
+    <variant>ru</variant>
   </variants>
 </metafile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual: index.xml.ru
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html	2003-07-13 02:44:36.000000000 +0800
@@ -13,7 +13,7 @@
 URI: install.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: install.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html.en	2003-07-01 06:17:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html.en	2003-09-02 03:10:15.000000000 +0800
@@ -35,36 +35,39 @@
     changed completely from Apache 1.3. Apache 1.3 used a custom
     set of scripts to achieve easy installation. Apache 2.0 now
     uses <code>libtool</code> and <code>autoconf</code>
     to create an environment that looks like many other Open Source
     projects.</p>
 
+    <p>If you are upgrading from one minor version to the next (for
+    example, 2.0.50 to 2.0.51), please skip down to the <a href="#upgrading">upgrading</a> section.</p>
+
 </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#overview">Overview for the
     impatient</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#requirements">Requirements</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#download">Download</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#extract">Extract</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#configure">Configuring the source tree</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#compile">Build</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#install">Install</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#customize">Customize</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#test">Test</a></li>
+<li><img alt="" src="./images/down.gif" /> <a href="#upgrading">Upgrading</a></li>
 </ul><h3>See also</h3><ul class="seealso"><li><a href="invoking.html">Starting Apache</a></li><li><a href="stopping.html">Stopping and Restarting</a></li></ul></div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="overview" id="overview">Overview for the
     impatient</a></h2>
 
     <table>
       
       <tr>
         <td><a href="#download">Download</a></td>
 
-        <td><code>$ lynx
-        http://www.apache.org/dist/httpd/httpd-2_0_<em>NN</em>.tar.gz</code>
+        <td><code>$ lynx http://httpd.apache.org/download.cgi</code>
         </td>
       </tr>
 
       <tr>
         <td><a href="#extract">Extract</a></td>
 
@@ -313,13 +316,13 @@
       "<code>-l</code>" options) to pass to the linker.</dd>
 
       <dt><code>INCLUDES=...</code></dt>
 
       <dd>Header file search directories ("<code>-I<em>dir</em></code>").</dd>
 
-      <dt><code>TARGET=...</code> [Default: <code>apache</code>]</dt>
+      <dt><code>TARGET=...</code> [Default: <code>httpd</code>]</dt>
 
       <dd>Name of the executable which will be built.</dd>
 
       <dt><code>NOTEST_CPPFLAGS=...</code></dt>
 
       <dt><code>NOTEST_CFLAGS=...</code></dt>
@@ -559,13 +562,13 @@
     2.2 system, but this will vary widely depending on your
     hardware and the number of modules which you have enabled.</p>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="install" id="install">Install</a></h2>
 
-    <p>Now its time to install the package under the configured
+    <p>Now it's time to install the package under the configured
     installation <em>PREFIX</em> (see <code>--prefix</code> option
     above) by running:</p>
 
 <div class="example"><p><code>$ make install</code></p></div>
 
     <p>If you are upgrading, the installation will not overwrite
@@ -596,12 +599,60 @@
     under the <code class="directive"><a href="./mod/core.html#documentroot">DocumentRoot</a></code>
     which will usually be <code><em>PREFIX</em>/htdocs/</code>.
     Then <a href="stopping.html">stop</a> the server again by
     running:</p>
 
 <div class="example"><p><code>$ <em>PREFIX</em>/bin/apachectl stop</code></p></div>
+</div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="upgrading" id="upgrading">Upgrading</a></h2>
+
+    <p>The first step in upgrading is to read the release announcement
+    and the file <code>CHANGES</code> in the source distribution to
+    find any changes that may affect your site.  When changing between
+    major releases (for example, from 1.3 to 2.0 or from 2.0 to 2.2),
+    there will likely be major differences in the compile-time and
+    run-time configuration that will require manual adjustments.  All
+    modules will also need to be upgraded to accomodate changes in the
+    module API.</p>
+
+    <p>Upgrading from one minor version to the next (for example, from
+    2.0.55 to 2.0.57) is easier.  The <code>make install</code>
+    process will not overwrite any of your existing documents, log
+    files, or configuration files.  In addition, the developers make
+    every effort to avoid incompatible changes in the
+    <code>configure</code> options, run-time configuration, or the
+    module API between minor versions.  In most cases you should be able to
+    use an identical <code>configure</code> command line, an identical
+    configuration file, and all of your modules should continue to
+    work.  (This is only valid for versions after 2.0.41; earlier
+    versions have incompatible changes.)</p>
+
+    <p>If you kept the source tree from your last installation,
+    upgrading is even easier.  The file <code>config.nice</code> in
+    the root of the old source tree contains the exact
+    <code>configure</code> command line that you used to configure the
+    source tree.  Then to upgrade from one version to the next, you
+    need only copy the <code>config.nice</code> file to the source
+    tree of the new version, edit it to make any desired changes, and
+    then run:</p>
+
+    <div class="example"><p><code>
+    $ ./config.nice<br />
+    $ make<br />
+    $ make install<br />
+    $ <em>PREFIX</em>/bin/apachectl stop<br />
+    $ <em>PREFIX</em>/bin/apachectl start<br />
+    </code></p></div>
+
+    <div class="warning">You should always test any new version in your
+    environment before putting it into production.  For example, you
+    can install and run the new version along side the old one by
+    using a different <code>--prefix</code> and a
+    different port (by adjusting the <code class="directive"><a href="./mod/mpm_common.html#listen">Listen</a></code> directive) to test for any
+    incompatibilities before doing the final upgrade.</div>
 </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="./de/install.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/install.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/install.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
 <a href="./ko/install.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>ëÏÍÐÉÌÉÒÏ×ÁÎÉÅ É ÕÓÔÁÎÏ×ËÁ</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./de/install.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/install.xml	2003-07-01 03:25:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/install.xml	2003-09-02 03:10:15.000000000 +0800
@@ -18,12 +18,16 @@
     changed completely from Apache 1.3. Apache 1.3 used a custom
     set of scripts to achieve easy installation. Apache 2.0 now
     uses <code>libtool</code> and <code>autoconf</code>
     to create an environment that looks like many other Open Source
     projects.</p>
 
+    <p>If you are upgrading from one minor version to the next (for
+    example, 2.0.50 to 2.0.51), please skip down to the <a
+    href="#upgrading">upgrading</a> section.</p>
+
 </summary>
 
 <seealso><a href="invoking.html">Starting Apache</a></seealso>
 <seealso><a href="stopping.html">Stopping and Restarting</a></seealso>
 
 <section id="overview"><title>Overview for the
@@ -31,14 +35,13 @@
 
     <table>
       <columnspec><column width=".13"/><column width=".80"/></columnspec>
       <tr>
         <td><a href="#download">Download</a></td>
 
-        <td><code>$ lynx
-        http://www.apache.org/dist/httpd/httpd-2_0_<em>NN</em>.tar.gz</code>
+        <td><code>$ lynx http://httpd.apache.org/download.cgi</code>
         </td>
       </tr>
 
       <tr>
         <td><a href="#extract">Extract</a></td>
 
@@ -294,13 +297,13 @@
       "<code>-l</code>" options) to pass to the linker.</dd>
 
       <dt><code>INCLUDES=...</code></dt>
 
       <dd>Header file search directories ("<code>-I<em>dir</em></code>").</dd>
 
-      <dt><code>TARGET=...</code> [Default: <code>apache</code>]</dt>
+      <dt><code>TARGET=...</code> [Default: <code>httpd</code>]</dt>
 
       <dd>Name of the executable which will be built.</dd>
 
       <dt><code>NOTEST_CPPFLAGS=...</code></dt>
 
       <dt><code>NOTEST_CFLAGS=...</code></dt>
@@ -544,13 +547,13 @@
     2.2 system, but this will vary widely depending on your
     hardware and the number of modules which you have enabled.</p>
 </section>
 
 <section id="install"><title>Install</title>
 
-    <p>Now its time to install the package under the configured
+    <p>Now it's time to install the package under the configured
     installation <em>PREFIX</em> (see <code>--prefix</code> option
     above) by running:</p>
 
 <example>$ make install</example>
 
     <p>If you are upgrading, the installation will not overwrite
@@ -586,8 +589,55 @@
     which will usually be <code><em>PREFIX</em>/htdocs/</code>.
     Then <a href="stopping.html">stop</a> the server again by
     running:</p>
 
 <example>$ <em>PREFIX</em>/bin/apachectl stop</example>
 </section>
+<section id="upgrading"><title>Upgrading</title>
 
+    <p>The first step in upgrading is to read the release announcement
+    and the file <code>CHANGES</code> in the source distribution to
+    find any changes that may affect your site.  When changing between
+    major releases (for example, from 1.3 to 2.0 or from 2.0 to 2.2),
+    there will likely be major differences in the compile-time and
+    run-time configuration that will require manual adjustments.  All
+    modules will also need to be upgraded to accomodate changes in the
+    module API.</p>
+
+    <p>Upgrading from one minor version to the next (for example, from
+    2.0.55 to 2.0.57) is easier.  The <code>make install</code>
+    process will not overwrite any of your existing documents, log
+    files, or configuration files.  In addition, the developers make
+    every effort to avoid incompatible changes in the
+    <code>configure</code> options, run-time configuration, or the
+    module API between minor versions.  In most cases you should be able to
+    use an identical <code>configure</code> command line, an identical
+    configuration file, and all of your modules should continue to
+    work.  (This is only valid for versions after 2.0.41; earlier
+    versions have incompatible changes.)</p>
+
+    <p>If you kept the source tree from your last installation,
+    upgrading is even easier.  The file <code>config.nice</code> in
+    the root of the old source tree contains the exact
+    <code>configure</code> command line that you used to configure the
+    source tree.  Then to upgrade from one version to the next, you
+    need only copy the <code>config.nice</code> file to the source
+    tree of the new version, edit it to make any desired changes, and
+    then run:</p>
+
+    <example>
+    $ ./config.nice<br />
+    $ make<br />
+    $ make install<br />
+    $ <em>PREFIX</em>/bin/apachectl stop<br />
+    $ <em>PREFIX</em>/bin/apachectl start<br />
+    </example>
+
+    <note type="warning">You should always test any new version in your
+    environment before putting it into production.  For example, you
+    can install and run the new version along side the old one by
+    using a different <code>--prefix</code> and a
+    different port (by adjusting the <directive
+    module="mpm_common">Listen</directive> directive) to test for any
+    incompatibilities before doing the final upgrade.</note>
+</section>
 </manualpage>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/invoking.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/invoking.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/invoking.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/invoking.html	2003-07-13 02:44:36.000000000 +0800
@@ -13,7 +13,7 @@
 URI: invoking.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: invoking.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/invoking.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/invoking.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/invoking.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/invoking.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>úÁÐÕÓË Apache</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./de/invoking.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/index.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/index.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/index.html.en	2003-05-30 03:29:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/index.html.en	2003-09-17 10:01:13.000000000 +0800
@@ -98,12 +98,19 @@
       <dt><a href="tutorials.html">Apache Tutorials</a></dt>
 
       <dd>
         <p>A list of external resources which help to accomplish common
         tasks with the Apache HTTP server.</p>
       </dd>
+
+      <dt><a href="relevant_standards.html">Relevant Standards</a></dt>
+
+      <dd>
+        <p>This document acts as a reference page for most of the relevant
+        standards that Apache follows.</p>
+      </dd>
     </dl>
   </div>
 </div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="../en/misc/" title="English">&nbsp;en&nbsp;</a></p>
 </div><div id="footer">
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/index.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/index.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/index.xml	2003-04-16 08:22:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/index.xml	2003-09-17 09:58:58.000000000 +0800
@@ -86,10 +86,17 @@
       <dt><a href="tutorials.html">Apache Tutorials</a></dt>
 
       <dd>
         <p>A list of external resources which help to accomplish common
         tasks with the Apache HTTP server.</p>
       </dd>
+
+      <dt><a href="relevant_standards.html">Relevant Standards</a></dt>
+
+      <dd>
+        <p>This document acts as a reference page for most of the relevant
+        standards that Apache follows.</p>
+      </dd>
     </dl>
   </summary>
 
 </manualpage>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/perf-tuning.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/perf-tuning.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/perf-tuning.html.en	2003-05-30 03:29:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/perf-tuning.html.en	2003-08-05 00:51:47.000000000 +0800
@@ -19,21 +19,12 @@
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="../">Version 2.0</a> &gt; <a href="./">Miscellaneous Documentation</a></div><div id="page-content"><div id="preamble"><h1>Apache Performance Tuning</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="../en/misc/perf-tuning.html" title="English">&nbsp;en&nbsp;</a></p>
 </div>
 
 
-    <div class="warning"><h3>Warning:</h3>
-      <p>This document has not been fully updated
-      to take into account changes made in the 2.0 version of the
-      Apache HTTP Server. Some of the information may still be
-      relevant, but please use it with care.</p>
-    </div>
-
-    <p>Orignally written by Dean Gaudet.</p>
-
     <p>Apache 2.0 is a general-purpose webserver, designed to
     provide a balance of flexibility, portability, and performance.
     Although it has not been designed specifically to set benchmark
     records, Apache 2.0 is capable of high performance in many
     real-world situations.</p>
 
@@ -541,12 +532,19 @@
     
 
     <h3>accept Serialization - multiple sockets</h3>
 
       
 
+    <div class="warning"><h3>Warning:</h3>
+      <p>This section has not been fully updated
+      to take into account changes made in the 2.0 version of the
+      Apache HTTP Server. Some of the information may still be
+      relevant, but please use it with care.</p>
+    </div>
+
       <p>This discusses a shortcoming in the Unix socket API. Suppose
       your web server uses multiple <code class="directive"><a href="../mod/mpm_common.html#listen">Listen</a></code> statements to listen on either multiple
       ports or multiple addresses. In order to test each socket
       to see if a connection is ready Apache uses
       <code>select(2)</code>. <code>select(2)</code> indicates that a
       socket has <em>zero</em> or <em>at least one</em> connection
@@ -671,12 +669,15 @@
       <code>src/include/ap_config.h</code> (1.3 or later). Some
       architectures do not have any locking choice made, on these
       architectures it is unsafe to use multiple
       <code class="directive"><a href="../mod/mpm_common.html#listen">Listen</a></code>
       directives.</p>
 
+      <p>The directive <code class="directive"><a href="../mod/mpm_common.html#acceptmutex">AcceptMutex</a></code> can be used to
+      change the selected mutuex implimentation at run-time.</p>
+
       <dl>
         <dt><code>USE_FLOCK_SERIALIZED_ACCEPT</code></dt>
 
         <dd>
           <p>This method uses the <code>flock(2)</code> system call to
           lock a lock file (located by the <code class="directive"><a href="../mod/mpm_common.html#lockfile">LockFile</a></code> directive).</p>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/perf-tuning.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/perf-tuning.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/perf-tuning.xml	2003-05-10 08:45:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/perf-tuning.xml	2003-08-05 00:51:47.000000000 +0800
@@ -6,21 +6,12 @@
   <parentdocument href="./">Miscellaneous Documentation</parentdocument>
 
   <title>Apache Performance Tuning</title>
 
   <summary>
 
-    <note type="warning"><title>Warning:</title>
-      <p>This document has not been fully updated
-      to take into account changes made in the 2.0 version of the
-      Apache HTTP Server. Some of the information may still be
-      relevant, but please use it with care.</p>
-    </note>
-
-    <p>Orignally written by Dean Gaudet.</p>
-
     <p>Apache 2.0 is a general-purpose webserver, designed to
     provide a balance of flexibility, portability, and performance.
     Although it has not been designed specifically to set benchmark
     records, Apache 2.0 is capable of high performance in many
     real-world situations.</p>
 
@@ -554,12 +545,19 @@
     </section>
 
     <section>
 
       <title>accept Serialization - multiple sockets</title>
 
+    <note type="warning"><title>Warning:</title>
+      <p>This section has not been fully updated
+      to take into account changes made in the 2.0 version of the
+      Apache HTTP Server. Some of the information may still be
+      relevant, but please use it with care.</p>
+    </note>
+
       <p>This discusses a shortcoming in the Unix socket API. Suppose
       your web server uses multiple <directive module="mpm_common"
       >Listen</directive> statements to listen on either multiple
       ports or multiple addresses. In order to test each socket
       to see if a connection is ready Apache uses
       <code>select(2)</code>. <code>select(2)</code> indicates that a
@@ -686,12 +684,16 @@
       <code>src/include/ap_config.h</code> (1.3 or later). Some
       architectures do not have any locking choice made, on these
       architectures it is unsafe to use multiple
       <directive module="mpm_common">Listen</directive>
       directives.</p>
 
+      <p>The directive <directive
+      module="mpm_common">AcceptMutex</directive> can be used to
+      change the selected mutuex implimentation at run-time.</p>
+
       <dl>
         <dt><code>USE_FLOCK_SERIALIZED_ACCEPT</code></dt>
 
         <dd>
           <p>This method uses the <code>flock(2)</code> system call to
           lock a lock file (located by the <directive module="mpm_common"
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc: relevant_standards.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc: relevant_standards.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc: relevant_standards.xml
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc: relevant_standards.xml.meta
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/rewriteguide.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/rewriteguide.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/rewriteguide.html.en	2003-05-30 03:29:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/rewriteguide.html.en	2003-07-10 20:01:41.000000000 +0800
@@ -1371,129 +1371,12 @@
           </ol>
         </dd>
       </dl>
 
     
 
-    <h3>Reverse Proxy</h3>
-
-      
-
-      <dl>
-        <dt>Description:</dt>
-
-        <dd>...</dd>
-
-        <dt>Solution:</dt>
-
-        <dd>
-<div class="example"><pre>
-##
-##  apache-rproxy.conf -- Apache configuration for Reverse Proxy Usage
-##
-
-#   server type
-ServerType           standalone
-Listen               8000
-MinSpareServers      16
-StartServers         16
-MaxSpareServers      16
-MaxClients           16
-MaxRequestsPerChild  100
-
-#   server operation parameters
-KeepAlive            on
-MaxKeepAliveRequests 100
-KeepAliveTimeout     15
-Timeout              400
-IdentityCheck        off
-HostnameLookups      off
-
-#   paths to runtime files
-PidFile              /path/to/apache-rproxy.pid
-LockFile             /path/to/apache-rproxy.lock
-ErrorLog             /path/to/apache-rproxy.elog
-CustomLog            /path/to/apache-rproxy.dlog "%{%v/%T}t %h -&gt; %{SERVER}e URL: %U"
-
-#   unused paths
-ServerRoot           /tmp
-DocumentRoot         /tmp
-CacheRoot            /tmp
-RewriteLog           /dev/null
-TransferLog          /dev/null
-TypesConfig          /dev/null
-AccessConfig         /dev/null
-ResourceConfig       /dev/null
-
-#   speed up and secure processing
-&lt;Directory /&gt;
-Options -FollowSymLinks -SymLinksIfOwnerMatch
-AllowOverride None
-&lt;/Directory&gt;
-
-#   the status page for monitoring the reverse proxy
-&lt;Location /apache-rproxy-status&gt;
-SetHandler server-status
-&lt;/Location&gt;
-
-#   enable the URL rewriting engine
-RewriteEngine        on
-RewriteLogLevel      0
-
-#   define a rewriting map with value-lists where
-#   mod_rewrite randomly chooses a particular value
-RewriteMap     server  rnd:/path/to/apache-rproxy.conf-servers
-
-#   make sure the status page is handled locally
-#   and make sure no one uses our proxy except ourself
-RewriteRule    ^/apache-rproxy-status.*  -  [L]
-RewriteRule    ^(http|ftp)://.*          -  [F]
-
-#   now choose the possible servers for particular URL types
-RewriteRule    ^/(.*\.(cgi|shtml))$  to://${server:dynamic}/$1  [S=1]
-RewriteRule    ^/(.*)$               to://${server:static}/$1
-
-#   and delegate the generated URL by passing it
-#   through the proxy module
-RewriteRule    ^to://([^/]+)/(.*)    http://$1/$2   [E=SERVER:$1,P,L]
-
-#   and make really sure all other stuff is forbidden
-#   when it should survive the above rules...
-RewriteRule    .*                    -              [F]
-
-#   enable the Proxy module without caching
-ProxyRequests        on
-NoCache              *
-
-#   setup URL reverse mapping for redirect reponses
-ProxyPassReverse  /  http://www1.foo.dom/
-ProxyPassReverse  /  http://www2.foo.dom/
-ProxyPassReverse  /  http://www3.foo.dom/
-ProxyPassReverse  /  http://www4.foo.dom/
-ProxyPassReverse  /  http://www5.foo.dom/
-ProxyPassReverse  /  http://www6.foo.dom/
-</pre></div>
-
-<div class="example"><pre>
-##
-##  apache-rproxy.conf-servers -- Apache/mod_rewrite selection table
-##
-
-#   list of backend servers which serve static
-#   pages (HTML files and Images, etc.)
-static    www1.foo.dom|www2.foo.dom|www3.foo.dom|www4.foo.dom
-
-#   list of backend servers which serve dynamically
-#   generated page (CGI programs or mod_perl scripts)
-dynamic   www5.foo.dom|www6.foo.dom
-</pre></div>
-        </dd>
-      </dl>
-
-    
-
     <h3>New MIME-type, New Service</h3>
 
       
 
       <dl>
         <dt>Description:</dt>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/rewriteguide.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/rewriteguide.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/misc/rewriteguide.xml	2003-04-16 08:22:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/misc/rewriteguide.xml	2003-07-08 05:26:32.000000000 +0800
@@ -1358,129 +1358,12 @@
       </dl>
 
     </section>
 
     <section>
 
-      <title>Reverse Proxy</title>
-
-      <dl>
-        <dt>Description:</dt>
-
-        <dd>...</dd>
-
-        <dt>Solution:</dt>
-
-        <dd>
-<example><pre>
-##
-##  apache-rproxy.conf -- Apache configuration for Reverse Proxy Usage
-##
-
-#   server type
-ServerType           standalone
-Listen               8000
-MinSpareServers      16
-StartServers         16
-MaxSpareServers      16
-MaxClients           16
-MaxRequestsPerChild  100
-
-#   server operation parameters
-KeepAlive            on
-MaxKeepAliveRequests 100
-KeepAliveTimeout     15
-Timeout              400
-IdentityCheck        off
-HostnameLookups      off
-
-#   paths to runtime files
-PidFile              /path/to/apache-rproxy.pid
-LockFile             /path/to/apache-rproxy.lock
-ErrorLog             /path/to/apache-rproxy.elog
-CustomLog            /path/to/apache-rproxy.dlog "%{%v/%T}t %h -&gt; %{SERVER}e URL: %U"
-
-#   unused paths
-ServerRoot           /tmp
-DocumentRoot         /tmp
-CacheRoot            /tmp
-RewriteLog           /dev/null
-TransferLog          /dev/null
-TypesConfig          /dev/null
-AccessConfig         /dev/null
-ResourceConfig       /dev/null
-
-#   speed up and secure processing
-&lt;Directory /&gt;
-Options -FollowSymLinks -SymLinksIfOwnerMatch
-AllowOverride None
-&lt;/Directory&gt;
-
-#   the status page for monitoring the reverse proxy
-&lt;Location /apache-rproxy-status&gt;
-SetHandler server-status
-&lt;/Location&gt;
-
-#   enable the URL rewriting engine
-RewriteEngine        on
-RewriteLogLevel      0
-
-#   define a rewriting map with value-lists where
-#   mod_rewrite randomly chooses a particular value
-RewriteMap     server  rnd:/path/to/apache-rproxy.conf-servers
-
-#   make sure the status page is handled locally
-#   and make sure no one uses our proxy except ourself
-RewriteRule    ^/apache-rproxy-status.*  -  [L]
-RewriteRule    ^(http|ftp)://.*          -  [F]
-
-#   now choose the possible servers for particular URL types
-RewriteRule    ^/(.*\.(cgi|shtml))$  to://${server:dynamic}/$1  [S=1]
-RewriteRule    ^/(.*)$               to://${server:static}/$1
-
-#   and delegate the generated URL by passing it
-#   through the proxy module
-RewriteRule    ^to://([^/]+)/(.*)    http://$1/$2   [E=SERVER:$1,P,L]
-
-#   and make really sure all other stuff is forbidden
-#   when it should survive the above rules...
-RewriteRule    .*                    -              [F]
-
-#   enable the Proxy module without caching
-ProxyRequests        on
-NoCache              *
-
-#   setup URL reverse mapping for redirect reponses
-ProxyPassReverse  /  http://www1.foo.dom/
-ProxyPassReverse  /  http://www2.foo.dom/
-ProxyPassReverse  /  http://www3.foo.dom/
-ProxyPassReverse  /  http://www4.foo.dom/
-ProxyPassReverse  /  http://www5.foo.dom/
-ProxyPassReverse  /  http://www6.foo.dom/
-</pre></example>
-
-<example><pre>
-##
-##  apache-rproxy.conf-servers -- Apache/mod_rewrite selection table
-##
-
-#   list of backend servers which serve static
-#   pages (HTML files and Images, etc.)
-static    www1.foo.dom|www2.foo.dom|www3.foo.dom|www4.foo.dom
-
-#   list of backend servers which serve dynamically
-#   generated page (CGI programs or mod_perl scripts)
-dynamic   www5.foo.dom|www6.foo.dom
-</pre></example>
-        </dd>
-      </dl>
-
-    </section>
-
-    <section>
-
       <title>New MIME-type, New Service</title>
 
       <dl>
         <dt>Description:</dt>
 
         <dd>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.html.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.html.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.html.de	2003-07-02 09:29:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.html.de	2003-10-14 08:29:51.000000000 +0800
@@ -1024,14 +1024,14 @@
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="ErrorLog" id="ErrorLog">ErrorLog</a>-<a name="errorlog" id="errorlog">Direktive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Beschreibung:</a></th><td>Ablageort, an dem der Server Fehler protokolliert</td></tr>
 <tr><th><a href="directive-dict.html#Syntax">Syntax:</a></th><td><code> ErrorLog <var>Dateiname</var>|syslog[:<var>facility</var>]</code></td></tr>
-<tr><th><a href="directive-dict.html#Default">Voreinstellung:</a></th><td><code>ErrorLog logs/error_log (Unix)<br />
-ErrorLog logs/error.log (Windows and OS/2)</code></td></tr>
+<tr><th><a href="directive-dict.html#Default">Voreinstellung:</a></th><td><code>ErrorLog logs/error_log (Unix) ErrorLog logs/error.log (Windows and
+  OS/2)</code></td></tr>
 <tr><th><a href="directive-dict.html#Context">Kontext:</a></th><td>Serverkonfiguration, Virtual Host</td></tr>
 <tr><th><a href="directive-dict.html#Status">Status:</a></th><td>Core</td></tr>
 <tr><th><a href="directive-dict.html#Module">Modul:</a></th><td>core</td></tr>
 </table>
     <p>Die Direktive <code class="directive">ErrorLog</code> bestimmt den Namen
     der Datei, in welcher der Server alle auftretenden Fehler protokolliert.
@@ -1618,12 +1618,19 @@
     <code>LOCK</code> und <code>UNLOCK</code>. <strong>Die Methodennamen
     unterscheiden zwischen Groß- und Kleinschreibung.</strong> Wenn
     <code>GET</code> verwendet wird, sind <code>HEAD</code>-Anfragen
     ebenfalls eingeschränkt. Die <code>TRACE</code>-Methode kann nicht
     limitiert werden.</p>
 
+    <div class="warning">
+      Bei Zugriffsbeschränkungen ist ein <code class="directive"><a href="#limitexcept">&lt;LimitExcept&gt;</a></code>-Abschnitt stets einem
+      <code class="directive"><a href="#limit">&lt;Limit&gt;</a></code>-Abschnitt
+      vorzuziehen, da ein <code class="directive"><a href="#limitexcept">&lt;LimitExcept&gt;</a></code>-Abschnitt vor allen möglichen
+      Methoden schützt.</div>
+        
+
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="LimitExcept" id="LimitExcept">&lt;LimitExcept&gt;</a>-<a name="limitexcept" id="limitexcept">Direktive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Beschreibung:</a></th><td>Beschränkt Zugriffskontrollen auf alle HTTP-Methoden
 außer den genannten</td></tr>
@@ -1648,13 +1655,13 @@
 
     <div class="example"><p><code>
       &lt;LimitExcept POST GET&gt;<br />
       <span class="indent">
         Require valid-user<br />
       </span>
-      &lt;LimitExcept&gt;
+      &lt;/LimitExcept&gt;
     </code></p></div>
 
 
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="LimitInternalRecursion" id="LimitInternalRecursion">LimitInternalRecursion</a>-<a name="limitinternalrecursion" id="limitinternalrecursion">Direktive</a></h2>
@@ -2155,12 +2162,19 @@
     <p>Beispiel:</p>
 
     <div class="example"><p><code>
       LogLevel notice
     </code></p></div>
 
+    <div class="note"><h3>Hinweis</h3>
+      <p>Beim Protokollieren in eine reguläre Datei können
+      Nachrichten des Levels <code>notice</code> nicht unterdrückt
+      werden und werden daher immer protokolliert. Dies trifft allerdings
+      nicht zu wenn mittels <code>syslog</code> protokolliert wird.</p>
+    </div>
+
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="MaxKeepAliveRequests" id="MaxKeepAliveRequests">MaxKeepAliveRequests</a>-<a name="maxkeepaliverequests" id="maxkeepaliverequests">Direktive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Beschreibung:</a></th><td>Anzahl der Anfragen, die bei einer persistenten Verbindung
 zulässig sind</td></tr>
@@ -2639,64 +2653,63 @@
 <tr><th><a href="directive-dict.html#Syntax">Syntax:</a></th><td><code>ScriptInterpreterSource Registry|Registry-Strict|Script</code></td></tr>
 <tr><th><a href="directive-dict.html#Default">Voreinstellung:</a></th><td><code>ScriptInterpreterSource Script</code></td></tr>
 <tr><th><a href="directive-dict.html#Context">Kontext:</a></th><td>Serverkonfiguration, Virtual Host, Verzeichnis, .htaccess</td></tr>
 <tr><th><a href="directive-dict.html#Override">AllowOverride:</a></th><td>FileInfo</td></tr>
 <tr><th><a href="directive-dict.html#Status">Status:</a></th><td>Core</td></tr>
 <tr><th><a href="directive-dict.html#Module">Modul:</a></th><td>core</td></tr>
-<tr><th><a href="directive-dict.html#Compatibility">Kompatibilität:</a></th><td>ausschließlich Win32<br />
-Die Option <code>Registry-Strict</code> ist verfügbar seit Apache
+<tr><th><a href="directive-dict.html#Compatibility">Kompatibilität:</a></th><td>ausschließlich Win32; Die Option
+  <code>Registry-Strict</code> ist verfügbar seit Apache
 2.0.</td></tr>
 </table>
     <p>Die Direktive steuert, wie der Apache den Interpreter zur Ausführung
     von CGI-Skripten bestimmt. Die Voreinstellung ist <code>Script</code>. Dies
     veranlaßt den Apache, den Interpreter zu verwenden, auf den die
     Shebang-Zeile (erste Zeile, beginnt mit <code>#!</code>) im Skript zeigt.
     Auf Win32-Systemen sieht diese Zeile üblicherweise so aus:</p>
 
     <div class="example"><p><code>
       #!C:/Perl/bin/perl.exe
     </code></p></div>
 
-    <p>oder, wenn perl im Pfad (Umgebungsvariable <code>PATH</code>) liegt,
-      einfach:</p>
+    <p>oder, wenn <code>perl</code> im Pfad (Umgebungsvariable
+      <code>PATH</code>) liegt, einfach:</p>
 
     <div class="example"><p><code>
       #!perl
     </code></p></div>
 
     <p>Die Einstellung <code>ScriptInterpreterSource Registry</code>
     veranlaßt eine Suche in <code>HKEY_CLASSES_ROOT</code> der
     Windows-Registrierungsdatenbank und verwendet die Endung der Skript-Datei
     (z.B. <code>.pl</code>) als Suchargument. Der durch den Unterschlüssel
     <code>Shell\ExecCGI\Command</code> oder, falls dieser nicht existiert,
     <code>Shell\Open\Command</code> definierte Befehl wird zum Öffnen der
-    Skript-Datei verwendet. Wenn der Schlüssel zur Dateiendung oder
-    beide Unterschlüssel fehlen, dann verwendet der Apache die Option
-    <code>Script</code>.</p>
+    Skript-Datei verwendet. Wenn die Registrierungsschlüsel nicht gefunden
+    werden, dann verwendet der Apache die Option <code>Script</code>.</p>
 
     <div class="warning"><h3>Sicherheit</h3>
-      <p>Seien Sie vorsichtig, <code>ScriptInterpreterSource Registry</code> bei
-      Verzeichnissen zu verwenden, auf die eine <code class="directive"><a href="../mod/mod_alias.html#scriptalias">ScriptAlias</a></code>-Anweisung zeigt, denn der
-      Apache versucht <strong>jede</strong> Datei innerhalb des Verzeichnisses
-      auszuführen. Die Einstellung <code>Registry</code> kann
-      unerwünschte Programmaufrufe bei Dateien verursachen, die
+      <p>Seien Sie vorsichtig, wenn Sie <code>ScriptInterpreterSource
+      Registry</code> bei Verzeichnissen verwenden, auf die eine <code class="directive"><a href="../mod/mod_alias.html#scriptalias">ScriptAlias</a></code>-Anweisung zeigt, denn der
+      Apache wird versuchen, <strong>jede</strong> Datei innerhalb des
+      Verzeichnisses auszuführen. Die Einstellung <code>Registry</code>
+      kann unerwünschte Programmaufrufe bei Dateien verursachen, die
       üblicherweise nicht ausgeführt werden. Auf den meisten
       Windows-Systemen beispielsweise startet der voreingestellte
       Öffnen-Befehl für <code>.htm</code>-Dateien den Microsoft
       Internet Explorer, so dass jede HTTP-Anfrage nach einer existierenden
-      <code>.htm</code>-Datei im Skript-Verzeichnis den Browser im Hintergrund
-      starten würde. Dies ist eine wirksame Methode, Ihr System binnen
-      etwa einer Minute zum Absturz zu bringen.</p>
+      <code>.htm</code>-Datei im Skript-Verzeichnis den Browser auf dem Server
+      im Hintergrund starten würde. Dies ist leichte Art und Weise, Ihr 
+      System binnen etwa einer Minute zum Absturz zu bringen.</p>
     </div>
           
     <p>Die seit Apache 2.0 neue Option <code>Registry-Strict</code>
     macht das gleiche wie <code>Registry</code>, verwendet jedoch nur den
     Unterschlüssel <code>Shell\ExecCGI\Command</code>. Der Schlüssel
     <code>ExecCGI</code> ist gewöhnlich nicht voreingestellt. Er muss
-    manuell eingerichtet werden und schützt Ihr System so for
-    versehentlichen Programmaufrufen.</p>
+    manuell in der Windows-Registrierungsdatenbank eingerichtet werden und 
+    verhindert dann versehentlicht Programmaufrufe auf Ihrem System.</p>
 
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="ServerAdmin" id="ServerAdmin">ServerAdmin</a>-<a name="serveradmin" id="serveradmin">Direktive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Beschreibung:</a></th><td>E-Mail-Adresse, die der Server in Fehlermeldungen einfügt,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.html.en	2003-07-02 09:17:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.html.en	2003-10-14 08:29:51.000000000 +0800
@@ -859,12 +859,14 @@
 
     <ul>
     <li>Some platforms may have broken sendfile support that the build
     system did not detect, especially if the binaries were built on
     another box and moved to such a machine with broken sendfile
     support.</li>
+    <li>On Linux the use of sendfile triggers TCP-checksum
+    offloading bugs on certain networking cards when using IPv6.</li>
     <li>With a network-mounted <code class="directive"><a href="#documentroot">DocumentRoot</a></code> (e.g., NFS or SMB),
     the kernel may be unable to serve the network file through
     its own cache.</li>
     </ul>
 
     <p>For server configurations that are vulnerable to these problems,
@@ -1529,12 +1531,18 @@
     <code>MKCOL</code>, <code>COPY</code>, <code>MOVE</code>,
     <code>LOCK</code>, and <code>UNLOCK</code>. <strong>The method name is
     case-sensitive.</strong> If <code>GET</code> is used it will also
     restrict <code>HEAD</code> requests. The <code>TRACE</code> method
     cannot be limited.</p>
 
+    <div class="warning">A <code class="directive"><a href="#limitexcept">&lt;LimitExcept&gt;</a></code> section should always be
+    used in preference to a <code class="directive"><a href="#limit">&lt;Limit&gt;</a></code> section when restricting access,
+    since a <code class="directive"><a href="#limitexcept">&lt;LimitExcept&gt;</a></code> section provides protection
+    against arbitrary methods.</div>
+
+
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="LimitExcept" id="LimitExcept">&lt;LimitExcept&gt;</a> <a name="limitexcept" id="limitexcept">Directive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Description:</a></th><td>Restrict access controls to all HTTP methods
 except the named ones</td></tr>
@@ -1557,13 +1565,13 @@
 
     <div class="example"><p><code>
       &lt;LimitExcept POST GET&gt;<br />
       <span class="indent">
         Require valid-user<br />
       </span>
-      &lt;LimitExcept&gt;
+      &lt;/LimitExcept&gt;
     </code></p></div>
 
 
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="LimitInternalRecursion" id="LimitInternalRecursion">LimitInternalRecursion</a> <a name="limitinternalrecursion" id="limitinternalrecursion">Directive</a></h2>
@@ -1610,15 +1618,13 @@
 <tr><th><a href="directive-dict.html#Override">Override:</a></th><td>All</td></tr>
 <tr><th><a href="directive-dict.html#Status">Status:</a></th><td>Core</td></tr>
 <tr><th><a href="directive-dict.html#Module">Module:</a></th><td>core</td></tr>
 </table>
     <p>This directive specifies the number of <var>bytes</var> from 0
     (meaning unlimited) to 2147483647 (2GB) that are allowed in a
-    request body. The default value is defined by the compile-time
-    constant <code>DEFAULT_LIMIT_REQUEST_BODY</code> (0 as
-    distributed).</p>
+    request body.</p>
 
     <p>The <code class="directive">LimitRequestBody</code> directive allows
     the user to set a limit on the allowed size of an HTTP request
     message body within the context in which the directive is given
     (server, per-directory, per-file or per-location). If the client
     request exceeds that limit, the server will return an error
@@ -2028,12 +2034,19 @@
     <p>For example:</p>
 
     <div class="example"><p><code>
       LogLevel notice
     </code></p></div>
 
+    <div class="note"><h3>Note</h3>
+      <p>When logging to a regular file messages of the level
+      <code>notice</code> cannot be suppressed and thus are always
+      logged. However, this doesn't apply when logging is done
+      using <code>syslog</code>.</p>
+    </div>
+
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="MaxKeepAliveRequests" id="MaxKeepAliveRequests">MaxKeepAliveRequests</a> <a name="maxkeepaliverequests" id="maxkeepaliverequests">Directive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Description:</a></th><td>Number of requests allowed on a persistent
 connection</td></tr>
@@ -2520,13 +2533,13 @@
     script. On Win32 systems this line usually looks like:</p>
 
     <div class="example"><p><code>
       #!C:/Perl/bin/perl.exe
     </code></p></div>
 
-    <p>or, if perl is in the <code>PATH</code>, simply:</p>
+    <p>or, if <code>perl</code> is in the <code>PATH</code>, simply:</p>
 
     <div class="example"><p><code>
       #!perl
     </code></p></div>
 
     <p>Setting <code>ScriptInterpreterSource Registry</code> will
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.xml	2003-07-02 09:16:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.xml	2003-10-14 08:29:51.000000000 +0800
@@ -794,12 +794,14 @@
 
     <ul>
     <li>Some platforms may have broken sendfile support that the build
     system did not detect, especially if the binaries were built on
     another box and moved to such a machine with broken sendfile
     support.</li>
+    <li>On Linux the use of sendfile triggers TCP-checksum
+    offloading bugs on certain networking cards when using IPv6.</li>
     <li>With a network-mounted <directive
     module="core">DocumentRoot</directive> (e.g., NFS or SMB),
     the kernel may be unable to serve the network file through
     its own cache.</li>
     </ul>
 
@@ -1475,12 +1477,21 @@
     <code>PATCH</code>, <code>PROPFIND</code>, <code>PROPPATCH</code>,
     <code>MKCOL</code>, <code>COPY</code>, <code>MOVE</code>,
     <code>LOCK</code>, and <code>UNLOCK</code>. <strong>The method name is
     case-sensitive.</strong> If <code>GET</code> is used it will also
     restrict <code>HEAD</code> requests. The <code>TRACE</code> method
     cannot be limited.</p>
+
+    <note type="warning">A <directive type="section"
+    module="core">LimitExcept</directive> section should always be
+    used in preference to a <directive type="section"
+    module="core">Limit</directive> section when restricting access,
+    since a <directive type="section"
+    module="core">LimitExcept</directive> section provides protection
+    against arbitrary methods.</note>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis type="section">
 <name>LimitExcept</name>
 <description>Restrict access controls to all HTTP methods
@@ -1507,13 +1518,13 @@
 
     <example>
       &lt;LimitExcept POST GET&gt;<br />
       <indent>
         Require valid-user<br />
       </indent>
-      &lt;LimitExcept&gt;
+      &lt;/LimitExcept&gt;
     </example>
 
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
@@ -1562,15 +1573,13 @@
 </contextlist>
 <override>All</override>
 
 <usage>
     <p>This directive specifies the number of <var>bytes</var> from 0
     (meaning unlimited) to 2147483647 (2GB) that are allowed in a
-    request body. The default value is defined by the compile-time
-    constant <code>DEFAULT_LIMIT_REQUEST_BODY</code> (0 as
-    distributed).</p>
+    request body.</p>
 
     <p>The <directive>LimitRequestBody</directive> directive allows
     the user to set a limit on the allowed size of an HTTP request
     message body within the context in which the directive is given
     (server, per-directory, per-file or per-location). If the client
     request exceeds that limit, the server will return an error
@@ -1983,12 +1992,19 @@
 
     <p>For example:</p>
 
     <example>
       LogLevel notice
     </example>
+
+    <note><title>Note</title>
+      <p>When logging to a regular file messages of the level
+      <code>notice</code> cannot be suppressed and thus are always
+      logged. However, this doesn't apply when logging is done
+      using <code>syslog</code>.</p>
+    </note>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MaxKeepAliveRequests</name>
 <description>Number of requests allowed on a persistent
@@ -2469,13 +2485,13 @@
     script. On Win32 systems this line usually looks like:</p>
 
     <example>
       #!C:/Perl/bin/perl.exe
     </example>
 
-    <p>or, if perl is in the <code>PATH</code>, simply:</p>
+    <p>or, if <code>perl</code> is in the <code>PATH</code>, simply:</p>
 
     <example>
       #!perl
     </example>
 
     <p>Setting <code>ScriptInterpreterSource Registry</code> will
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.xml.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.xml.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/core.xml.de	2003-07-02 09:29:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/core.xml.de	2003-10-14 08:29:51.000000000 +0800
@@ -1,10 +1,10 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
 <?xml-stylesheet type="text/xsl" href="../style/manual.de.xsl"?>
-<!-- English revision: 1.46.2.21 -->
+<!-- English revision: 1.46.2.27 -->
 
 <modulesynopsis metafile="core.xml.meta">
 
 <name>core</name>
 <description>St&auml;ndig verf&uuml;gbare Kernfunktionen des Apache HTTP
 Servers</description>
@@ -962,14 +962,14 @@
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ErrorLog</name>
 <description>Ablageort, an dem der Server Fehler protokolliert</description>
 <syntax> ErrorLog <var>Dateiname</var>|syslog[:<var>facility</var>]</syntax>
-<default>ErrorLog logs/error_log (Unix)<br />
-ErrorLog logs/error.log (Windows and OS/2)</default>
+<default>ErrorLog logs/error_log (Unix) ErrorLog logs/error.log (Windows and
+  OS/2)</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
 <usage>
     <p>Die Direktive <directive>ErrorLog</directive> bestimmt den Namen
     der Datei, in welcher der Server alle auftretenden Fehler protokolliert.
@@ -1565,12 +1565,21 @@
     <code>MKCOL</code>, <code>COPY</code>, <code>MOVE</code>,
     <code>LOCK</code> und <code>UNLOCK</code>. <strong>Die Methodennamen
     unterscheiden zwischen Gro&szlig;- und Kleinschreibung.</strong> Wenn
     <code>GET</code> verwendet wird, sind <code>HEAD</code>-Anfragen
     ebenfalls eingeschr&auml;nkt. Die <code>TRACE</code>-Methode kann nicht
     limitiert werden.</p>
+
+    <note type="warning">
+      Bei Zugriffsbeschr&auml;nkungen ist ein <directive type="section"
+      module="core">LimitExcept</directive>-Abschnitt stets einem
+      <directive type="section" module="core">Limit</directive>-Abschnitt
+      vorzuziehen, da ein <directive type="section"
+      module="core">LimitExcept</directive>-Abschnitt vor allen m&ouml;glichen
+      Methoden sch&uuml;tzt.</note>
+        
 </usage>
 </directivesynopsis>
 
 <directivesynopsis type="section">
 <name>LimitExcept</name>
 <description>Beschr&auml;nkt Zugriffskontrollen auf alle HTTP-Methoden
@@ -1598,13 +1607,13 @@
 
     <example>
       &lt;LimitExcept POST GET&gt;<br />
       <indent>
         Require valid-user<br />
       </indent>
-      &lt;LimitExcept&gt;
+      &lt;/LimitExcept&gt;
     </example>
 
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
@@ -2109,12 +2118,19 @@
 
     <p>Beispiel:</p>
 
     <example>
       LogLevel notice
     </example>
+
+    <note><title>Hinweis</title>
+      <p>Beim Protokollieren in eine regul&auml;re Datei k&ouml;nnen
+      Nachrichten des Levels <code>notice</code> nicht unterdr&uuml;ckt
+      werden und werden daher immer protokolliert. Dies trifft allerdings
+      nicht zu wenn mittels <code>syslog</code> protokolliert wird.</p>
+    </note>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MaxKeepAliveRequests</name>
 <description>Anzahl der Anfragen, die bei einer persistenten Verbindung
@@ -2583,14 +2599,14 @@
 CGI-Skripten</description>
 <syntax>ScriptInterpreterSource Registry|Registry-Strict|Script</syntax>
 <default>ScriptInterpreterSource Script</default>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context></contextlist>
 <override>FileInfo</override>
-<compatibility>ausschlie&szlig;lich Win32<br />
-Die Option <code>Registry-Strict</code> ist verf&uuml;gbar seit Apache
+<compatibility>ausschlie&szlig;lich Win32; Die Option
+  <code>Registry-Strict</code> ist verf&uuml;gbar seit Apache
 2.0.</compatibility>
 
 <usage>
     <p>Die Direktive steuert, wie der Apache den Interpreter zur Ausf&uuml;hrung
     von CGI-Skripten bestimmt. Die Voreinstellung ist <code>Script</code>. Dies
     veranla&szlig;t den Apache, den Interpreter zu verwenden, auf den die
@@ -2598,51 +2614,50 @@
     Auf Win32-Systemen sieht diese Zeile &uuml;blicherweise so aus:</p>
 
     <example>
       #!C:/Perl/bin/perl.exe
     </example>
 
-    <p>oder, wenn perl im Pfad (Umgebungsvariable <code>PATH</code>) liegt,
-      einfach:</p>
+    <p>oder, wenn <code>perl</code> im Pfad (Umgebungsvariable
+      <code>PATH</code>) liegt, einfach:</p>
 
     <example>
       #!perl
     </example>
 
     <p>Die Einstellung <code>ScriptInterpreterSource Registry</code>
     veranla&szlig;t eine Suche in <code>HKEY_CLASSES_ROOT</code> der
     Windows-Registrierungsdatenbank und verwendet die Endung der Skript-Datei
     (z.B. <code>.pl</code>) als Suchargument. Der durch den Unterschl&uuml;ssel
     <code>Shell\ExecCGI\Command</code> oder, falls dieser nicht existiert,
     <code>Shell\Open\Command</code> definierte Befehl wird zum &Ouml;ffnen der
-    Skript-Datei verwendet. Wenn der Schl&uuml;ssel zur Dateiendung oder
-    beide Unterschl&uuml;ssel fehlen, dann verwendet der Apache die Option
-    <code>Script</code>.</p>
+    Skript-Datei verwendet. Wenn die Registrierungsschl&uuml;sel nicht gefunden
+    werden, dann verwendet der Apache die Option <code>Script</code>.</p>
 
     <note type="warning"><title>Sicherheit</title>
-      <p>Seien Sie vorsichtig, <code>ScriptInterpreterSource Registry</code> bei
-      Verzeichnissen zu verwenden, auf die eine <directive
-        module="mod_alias">ScriptAlias</directive>-Anweisung zeigt, denn der
-      Apache versucht <strong>jede</strong> Datei innerhalb des Verzeichnisses
-      auszuf&uuml;hren. Die Einstellung <code>Registry</code> kann
-      unerw&uuml;nschte Programmaufrufe bei Dateien verursachen, die
+      <p>Seien Sie vorsichtig, wenn Sie <code>ScriptInterpreterSource
+      Registry</code> bei Verzeichnissen verwenden, auf die eine <directive
+      module="mod_alias">ScriptAlias</directive>-Anweisung zeigt, denn der
+      Apache wird versuchen, <strong>jede</strong> Datei innerhalb des
+      Verzeichnisses auszuf&uuml;hren. Die Einstellung <code>Registry</code>
+      kann unerw&uuml;nschte Programmaufrufe bei Dateien verursachen, die
       &uuml;blicherweise nicht ausgef&uuml;hrt werden. Auf den meisten
       Windows-Systemen beispielsweise startet der voreingestellte
       &Ouml;ffnen-Befehl f&uuml;r <code>.htm</code>-Dateien den Microsoft
       Internet Explorer, so dass jede HTTP-Anfrage nach einer existierenden
-      <code>.htm</code>-Datei im Skript-Verzeichnis den Browser im Hintergrund
-      starten w&uuml;rde. Dies ist eine wirksame Methode, Ihr System binnen
-      etwa einer Minute zum Absturz zu bringen.</p>
+      <code>.htm</code>-Datei im Skript-Verzeichnis den Browser auf dem Server
+      im Hintergrund starten w&uuml;rde. Dies ist leichte Art und Weise, Ihr 
+      System binnen etwa einer Minute zum Absturz zu bringen.</p>
     </note>
           
     <p>Die seit Apache 2.0 neue Option <code>Registry-Strict</code>
     macht das gleiche wie <code>Registry</code>, verwendet jedoch nur den
     Unterschl&uuml;ssel <code>Shell\ExecCGI\Command</code>. Der Schl&uuml;ssel
     <code>ExecCGI</code> ist gew&ouml;hnlich nicht voreingestellt. Er muss
-    manuell eingerichtet werden und sch&uuml;tzt Ihr System so for
-    versehentlichen Programmaufrufen.</p>
+    manuell in der Windows-Registrierungsdatenbank eingerichtet werden und 
+    verhindert dann versehentlicht Programmaufrufe auf Ihrem System.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerAdmin</name>
 <description>E-Mail-Adresse, die der Server in Fehlermeldungen einf&uuml;gt,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/directives.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/directives.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/directives.html	2003-07-06 04:36:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/directives.html	2003-07-13 02:44:37.000000000 +0800
@@ -13,7 +13,7 @@
 URI: directives.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: directives.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/directives.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/directives.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/directives.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/directives.html.ru.koi8-r	2003-07-10 20:01:41.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="../style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="../style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="../style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="../images/favicon.ico" rel="shortcut icon" /></head>
 <body id="directive-index"><div id="page-header">
 <p class="menu"><a href="../mod/">íÏÄÕÌÉ</a> | <a href="../mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="../sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="../images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="../images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="../">÷ÅÒÓÉÑ 2.0</a> &gt; <a href="./">íÏÄÕÌÉ</a></div><div id="preamble"><h1>áÌÆÁ×ÉÔÎÙÊ ÕËÁÚÁÔÅÌØ ÄÉÒÅËÔÉ×</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="../de/mod/directives.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_access.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_access.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_access.html.en	2003-05-30 03:29:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_access.html.en	2003-08-01 02:58:52.000000000 +0800
@@ -105,17 +105,21 @@
       <dd>
       <div class="example"><h3>Example:</h3><p><code>
         Allow from apache.org
       </code></p></div>
       <p>Hosts whose names match, or end in, this string are allowed
       access. Only complete components are matched, so the above
-      example will match <code>foo.apache.org</code> but it will
-      not match <code>fooapache.org</code>. This configuration will
-      cause the server to perform a reverse DNS lookup on the
-      client IP address, regardless of the setting of the <code class="directive"><a href="../mod/core.html#hostnamelookups">HostnameLookups</a></code>
-      directive.</p></dd>
+      example will match <code>foo.apache.org</code> but it will not
+      match <code>fooapache.org</code>. This configuration will cause
+      Apache to perform a double reverse DNS lookup on the client IP
+      address, regardless of the setting of the <code class="directive"><a href="../mod/core.html#hostnamelookups">HostnameLookups</a></code> directive.  It will do
+      a reverse DNS lookup on the IP address to find the associated
+      hostname, and then do a forward lookup on the hostname to assure
+      that it matches the original IP address.  Only if the forward
+      and reverse DNS are consistent and the hostname matches will
+      access be allowed.</p></dd>
 
       <dt>A full IP address</dt>
 
       <dd>
       <div class="example"><h3>Example:</h3><p><code>
         Allow from 10.1.2.3
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_access.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_access.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_access.xml	2003-04-16 06:56:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_access.xml	2003-08-01 02:58:52.000000000 +0800
@@ -82,18 +82,22 @@
       <dd>
       <example><title>Example:</title>
         Allow from apache.org
       </example>
       <p>Hosts whose names match, or end in, this string are allowed
       access. Only complete components are matched, so the above
-      example will match <code>foo.apache.org</code> but it will
-      not match <code>fooapache.org</code>. This configuration will
-      cause the server to perform a reverse DNS lookup on the
-      client IP address, regardless of the setting of the <directive
-      module="core">HostnameLookups</directive>
-      directive.</p></dd>
+      example will match <code>foo.apache.org</code> but it will not
+      match <code>fooapache.org</code>. This configuration will cause
+      Apache to perform a double reverse DNS lookup on the client IP
+      address, regardless of the setting of the <directive
+      module="core">HostnameLookups</directive> directive.  It will do
+      a reverse DNS lookup on the IP address to find the associated
+      hostname, and then do a forward lookup on the hostname to assure
+      that it matches the original IP address.  Only if the forward
+      and reverse DNS are consistent and the hostname matches will
+      access be allowed.</p></dd>
 
       <dt>A full IP address</dt>
 
       <dd>
       <example><title>Example:</title>
         Allow from 10.1.2.3
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_proxy.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_proxy.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_proxy.html.en	2003-07-06 10:39:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_proxy.html.en	2003-07-28 23:56:55.000000000 +0800
@@ -37,34 +37,28 @@
     <p>This module implements a proxy/gateway for Apache. It implements
     proxying capability for <code>FTP</code>, <code>CONNECT</code> (for SSL),
     <code>HTTP/0.9</code>, <code>HTTP/1.0</code>, and <code>HTTP/1.1</code>.
     The module can be configured to connect to other proxy modules for these
     and other protocols.</p>
 
-    <p>This module was experimental in Apache 1.1.x. Improvements and bugfixes
-    were made in Apache v1.2.x and Apache v1.3.x, then the module underwent a
-    major overhaul for Apache v2.0. The protocol support was upgraded to
-    <code>HTTP/1.1</code>, and filter support was enabled.</p>
-
-    <p>During the overhaul process, <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> features
-    have been split into several module files: <code class="module"><a href="../mod/mod_proxy_http.html">mod_proxy_http</a></code>,
-    <code class="module"><a href="../mod/mod_proxy_ftp.html">mod_proxy_ftp</a></code> and <code class="module"><a href="../mod/mod_proxy_connect.html">mod_proxy_connect</a></code>.
-    Thus, if you want to use one or more of the particular proxy functions,
-    load <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> <em>and</em> the appropriate
-    module(s) into the server (either statically or dynamically via the
-    <code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code> directive).</p>
-
-    <p>Please note that the <strong>caching</strong> function present in <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> up to Apache v1.3.x has been <strong>removed</strong>
-    from <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> and incorporated into a new module,
-    <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>. In other words, the Apache 2.0.x proxy doesn't 
-    cache - all caching functionality has been moved into
-    <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>, which is capable of caching any content, not
-    just content from the proxy.</p>
-
-    <p>If you need to use SSL when contacting remote servers, have a look at the
-    <code>SSLProxy*</code> directives in <code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>.</p>
+    <p>Apache's proxy features are divided into several modules in
+    addition to <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code>:
+    <code class="module"><a href="../mod/mod_proxy_http.html">mod_proxy_http</a></code>, <code class="module"><a href="../mod/mod_proxy_ftp.html">mod_proxy_ftp</a></code>
+    and <code class="module"><a href="../mod/mod_proxy_connect.html">mod_proxy_connect</a></code>.  Thus, if you want to use
+    one or more of the particular proxy functions, load
+    <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> <em>and</em> the appropriate module(s)
+    into the server (either statically at compile-time or dynamically
+    via the <code class="directive"><a href="../mod/mod_so.html#loadmodule">LoadModule</a></code>
+    directive).</p>
+
+    <p>In addition, extended features are provided by other modules.
+    Caching is provided by <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code> and related
+    modules.  The ability to contact remote servers using the SSL/TLS
+    protocol is provided by the <code>SSLProxy*</code> directives of
+    <code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code>.  These additional modules will need
+    to be loaded and configured to take advantage of these features.</p>
 </div>
 <div id="quickview"><h3 class="directives">Directives</h3>
 <ul id="toc">
 <li><img alt="" src="../images/down.gif" /> <a href="#allowconnect">AllowCONNECT</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#noproxy">NoProxy</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#proxy">&lt;Proxy&gt;</a></li>
@@ -84,92 +78,143 @@
 <li><img alt="" src="../images/down.gif" /> <a href="#proxyrequests">ProxyRequests</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#proxytimeout">ProxyTimeout</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#proxyvia">ProxyVia</a></li>
 </ul>
 <h3>Topics</h3>
 <ul id="topics">
-<li><img alt="" src="../images/down.gif" /> <a href="#configs">Common configuration topics</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#forwardreverse">Forward and Reverse Proxies</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#examples">Basic Examples</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#access">Controlling access to your proxy</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#ftp-proxy">FTP Proxy</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#startup">Slow Startup</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#intranet">Intranet Proxy</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#envsettings">Protocol Adjustments</a></li>
 </ul><h3>See also</h3>
 <ul class="seealso">
+<li><code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code></li>
 <li><code class="module"><a href="../mod/mod_proxy_http.html">mod_proxy_http</a></code></li>
 <li><code class="module"><a href="../mod/mod_proxy_ftp.html">mod_proxy_ftp</a></code></li>
 <li><code class="module"><a href="../mod/mod_proxy_connect.html">mod_proxy_connect</a></code></li>
 <li><code class="module"><a href="../mod/mod_ssl.html">mod_ssl</a></code></li>
 </ul></div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="section">
-<h2><a name="configs" id="configs">Common configuration topics</a></h2>
-    <ul>
-    <li><a href="#forwardreverse">Forward and Reverse Proxies</a></li>
-    <li><a href="#access">Controlling access to your proxy</a></li>
-    <li><a href="#mimetypes">Why doesn't file type <var>xxx</var> download via
-    FTP?</a></li>
-    <li><a href="#type">How can I force an FTP ASCII download of File
-    <var>xxx</var>?</a></li>
-    <li><a href="#percent2fhack">How can I access FTP files outside of my home
-    directory?</a></li>
-    <li><a href="#ftppass">How can I hide the FTP cleartext password in my
-    browser's URL line?</a></li>
-    <li><a href="#startup">Why does Apache start more slowly when using the
-    proxy module?</a></li>
-    <li><a href="#intranet">What other functions are useful for an intranet
-    proxy server?</a></li>
-    <li><a href="#envsettings">How can I make the proxy talk HTTP/1.0 and
-    disable keepalives?</a></li>
-    </ul>
-
-    <h3><a name="forwardreverse" id="forwardreverse">Forward and Reverse Proxies</a></h3>
+<h2><a name="forwardreverse" id="forwardreverse">Forward and Reverse Proxies</a></h2>
       <p>Apache can be configured in both a <dfn>forward</dfn> and
-      <dfn>reverse</dfn> proxy configuration.</p>
+      <dfn>reverse</dfn> proxy mode.</p>
 
-      <p>A <dfn>forward proxy</dfn> is an intermediate system that enables a
-      browser to connect to a remote network to which it normally does not have
-      access. A forward proxy can also be used to cache data, reducing load on
-      the networks between the forward proxy and the remote webserver.</p>
-
-      <p>Apache's <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> can be figured to behave like a
-      forward proxy using the <code class="directive"><a href="#proxyremote">ProxyRemote</a></code> directive. In addition, caching of data can be
-      achieved by configuring <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>. Other dedicated
-      forward proxy packages include <a href="http://www.squid-cache.org/">Squid</a>.</p>
-
-      <p>A <dfn>reverse proxy</dfn> is a webserver system that is capable of
-      serving webpages sourced from other webservers - in addition to webpages
-      on disk or generated dynamically by CGI - making these pages look like
-      they originated at the reverse proxy.</p>
-
-      <p>When configured with the mod_cache module the reverse proxy can act as
-      a cache for slower backend webservers. The reverse proxy can also enable
-      advanced URL strategies and management techniques, allowing webpages
-      served using different webserver systems or architectures to coexist
-      inside the same URL space. Reverse proxy systems are also ideal for
-      implementing centralised logging websites with many or diverse website
-      backends. Complex multi-tier webserver systems can be constructed using an
-      <code class="module"><a href="../mod/mod_proxy.html">mod_proxy</a></code> frontend and any number of backend
-      webservers.</p>
-
-      <p>The reverse proxy is configured using the <code class="directive"><a href="#proxypass">ProxyPass</a></code> and <code class="directive"><a href="#proxypassreverse">ProxyPassReverse</a></code> directives. Caching can be
-      enabled using mod_cache as with the forward proxy.</p>
-     
+      <p>An ordinary <dfn>forward proxy</dfn> is an intermediate
+      server that sits between the client and the <em>origin
+      server</em>.  In order to get content from the origin server,
+      the client sends a request to the proxy naming the origin server
+      as the target and the proxy then requests the content from the
+      origin server and returns it to the client.  The client must be
+      specially configured to use the forward proxy to access other
+      sites.</p>
+
+      <p>A typical usage of a forward proxy is to provide Internet
+      access to internal clients that are otherwise restricted by a
+      firewall.  The forward proxy can also use caching (as provided
+      by <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>) to reduce network usage.</p>
+
+      <p>The forward proxy is activated using the <code class="directive"><a href="#proxyrequests">ProxyRequests</a></code> directive.  Because
+      forward proxys allow clients to access arbitrary sites through
+      your server and to hide their true origin, it is essential that
+      you <a href="#access">secure your server</a> so that only
+      authorized clients can access the proxy before activating a
+      forward proxy.</p>
+
+      <p>A <dfn>reverse proxy</dfn>, by contrast, appears to the
+      client just like an ordinary web server.  No special
+      configuration on the client is necessary.  The client makes
+      ordinary requests for content in the name-space of the reverse
+      proxy.  The reverse proxy then decides where to send those
+      requests, and returns the content as if it was itself the
+      origin.</p>
+
+      <p>A typical usage of a reverse proxy is to provide Internet
+      users access to a server that is behind a firewall.  Reverse
+      proxies can also be used to balance load among several back-end
+      servers, or to provide caching for a slower back-end server.
+      In addition, reverse proxies can be used simply to bring
+      several servers into the same URL space.</p>
+
+      <p>A reverse proxy is activated using the <code class="directive"><a href="#proxypass">ProxyPass</a></code> directive or the
+      <code>[P]</code> flag to the <code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code> directive.  It is
+      <strong>not</strong> necessary to turn <code class="directive"><a href="#proxyrequests">ProxyRequests</a></code> on in order to
+      configure a reverse proxy.</p>
+    </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="examples" id="examples">Basic Examples</a></h2>
 
-    <h3><a name="access" id="access">Controlling access to your proxy</a></h3>
-      <p>You can control who can access your proxy via the <code class="directive"><a href="#proxy">&lt;Proxy&gt;</a></code> control block using
+    <p>The examples below are only a very basic idea to help you
+    get started.  Please read the documentation on the individual
+    directives.</p>
+
+    <p>In addition, if you wish to have caching enabled, consult
+    the documentation from <code class="module"><a href="../mod/mod_cache.html">mod_cache</a></code>.</p>
+
+    <div class="example"><h3>Forward Proxy</h3><p><code>
+    ProxyRequests On<br />
+    ProxyVia On<br />
+    <br />
+    &lt;Proxy *&gt;<br />
+    <span class="indent">
+      Order deny,allow<br />
+      Deny from all<br />
+      Allow from internal.example.com<br />
+    </span>
+    &lt;/Proxy&gt;
+    </code></p></div>
+
+    <div class="example"><h3>Reverse Proxy</h3><p><code>
+    ProxyRequests Off<br />
+    <br />
+    &lt;Proxy *&gt;<br />
+    <span class="indent">
+      Order deny,allow<br />
+      Allow from all<br />
+    </span>
+    &lt;/Proxy&gt;<br />
+    <br />
+    ProxyPass /foo http://foo.example.com/bar<br />
+    ProxyPassReverse /foo http://foo.example.com/bar
+    </code></p></div>
+    </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="access" id="access">Controlling access to your proxy</a></h2>
+      <p>You can control who can access your proxy via the <code class="directive"><a href="#proxy">&lt;Proxy&gt;</a></code> control block as in
       the following example:</p>
 
       <div class="example"><p><code>
         &lt;Proxy *&gt;<br />
         <span class="indent">
           Order Deny,Allow<br />
           Deny from all<br />
           Allow from 192.168.0<br />
         </span>
         &lt;/Proxy&gt;
       </code></p></div>
 
-      <p>When configuring a reverse proxy, access control takes on the
-      attributes of the normal server <code class="directive"><a href="../mod/core.html#directory">&lt;Directory&gt;</a></code> configuration.</p>
-     
+      <p>For more information on access control directives, see
+      <code class="module"><a href="../mod/mod_access.html">mod_access</a></code>.</p>
+
+      <p>Strictly limiting access is essential if you are using a
+      forward proxy (using the <code class="directive"><a href="#proxyrequests">ProxyRequests</a></code> directive).
+      Otherwise, your server can be used by any client to access
+      arbitrary hosts while hiding his or her true identity.  This is
+      dangerous both for your network and for the Internet at large.
+      When using a reverse proxy (using the <code class="directive"><a href="#proxypass">ProxyPass</a></code> directive with
+      <code>ProxyRequests Off</code>), access control is less
+      critical because clients can only contact the hosts that you
+      have specifically configured.</p>
+
+    </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="ftp-proxy" id="ftp-proxy">FTP Proxy</a></h2>
+
 
     <h3><a name="mimetypes" id="mimetypes">Why doesn't file type <var>xxx</var>
     download via FTP?</a></h3>
       <p>You probably don't have that particular file type defined as
       <code>application/octet-stream</code> in your proxy's mime.types
       configuration file. A useful line can be</p>
@@ -206,13 +251,13 @@
      
 
     <h3><a name="ftppass" id="ftppass">How can I hide the FTP cleartext password
     in my browser's URL line?</a></h3>
       <p>To log in to an FTP server by username and password, Apache uses
       different strategies. In absense of a user name and password in the URL
-      altogether, Apache sends an anomymous login to the FTP server,
+      altogether, Apache sends an anonymous login to the FTP server,
       <em>i.e.</em>,</p>
 
       <div class="example"><p><code>
         user: anonymous<br />
         password: apache_proxy@
       </code></p></div>
@@ -248,25 +293,27 @@
         FTP server as plaintext. You should therefore think twice before
         accessing your FTP server via HTTP (or before accessing your personal
         files via FTP at all!) When using unsecure channels, an eavesdropper
         might intercept your password on its way.</p>
       </div>
      
-
-    <h3><a name="startup" id="startup">Why does Apache start more slowly when using
-    the proxy module?</a></h3>
+   </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="startup" id="startup">Slow Startup</a></h2>
       <p>If you're using the <code class="directive"><a href="#proxyblock">ProxyBlock</a></code> directive, hostnames' IP addresses are looked up
       and cached during startup for later match test. This may take a few
       seconds (or more) depending on the speed with which the hostname lookups
       occur.</p>
-     
-
-    <h3><a name="intranet" id="intranet">What other functions are useful for an
-    intranet proxy server?</a></h3>
+    </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="intranet" id="intranet">Intranet Proxy</a></h2>
       <p>An Apache proxy server situated in an intranet needs to forward
-      external requests through the company's firewall. However, when it has to
+      external requests through the company's firewall (for this, configure
+      the <code class="directive"><a href="#proxyremote">ProxyRemote</a></code> directive
+      to forward the respective <var>scheme</var> to the firewall proxy).
+      However, when it has to
       access resources within the intranet, it can bypass the firewall when
       accessing hosts. The <code class="directive"><a href="#noproxy">NoProxy</a></code>
       directive is useful for specifying which hosts belong to the intranet and
       should be accessed directly.</p>
 
       <p>Users within an intranet tend to omit the local domain name from their
@@ -274,16 +321,15 @@
       <code>http://somehost.example.com/</code>. Some commercial proxy servers
       let them get away with this and simply serve the request, implying a
       configured local domain. When the <code class="directive"><a href="#proxydomain">ProxyDomain</a></code> directive is used and the server is <a href="#proxyrequests">configured for proxy service</a>, Apache can return
       a redirect response and send the client to the correct, fully qualified,
       server address. This is the preferred method since the user's bookmark
       files will then contain fully qualified hosts.</p>
-     
-
-    <h3><a name="envsettings" id="envsettings">How can I make the proxy talk HTTP/1.0 and 
-    disable keepalives?</a></h3>
+    </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="envsettings" id="envsettings">Protocol Adjustments</a></h2>
       <p>For circumstances where you have a application server which doesn't
       implement keepalives or HTTP/1.1 properly, there are 2 environment
       variables which when set send a HTTP/1.0 with no keepalive. These are set
       via the  <code class="directive"><a href="../mod/mod_env.html#setenv">SetEnv</a></code> directive.</p>
 
       <p>These are the <code>force-proxy-request-1.0</code> and
@@ -295,14 +341,13 @@
           ProxyPass http://buggyappserver:7001/foo/<br />
           SetEnv force-proxy-request-1.0 1<br />
           SetEnv proxy-nokeepalive 1<br />
         </span>
         &lt;/Location&gt;
       </code></p></div>
-     
-</div>
+    </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="AllowCONNECT" id="AllowCONNECT">AllowCONNECT</a> <a name="allowconnect" id="allowconnect">Directive</a></h2>
 <table class="directive">
 <tr><th><a href="directive-dict.html#Description">Description:</a></th><td>Ports that are allowed to CONNECT through the
 proxy</td></tr>
 <tr><th><a href="directive-dict.html#Syntax">Syntax:</a></th><td><code>AllowCONNECT <var>port</var> [<var>port</var>] ...</code></td></tr>
@@ -698,15 +743,19 @@
 
     <div class="note"><h3>Note</h3>
       <p>Order is important. you need to put the exclusions <em>before</em> the
       general proxypass directive.</p>
     </div>
 
-    <p>When used inside a <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code> section, the first argument is ommitted and the local
+    <p>When used inside a <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code> section, the first argument is omitted and the local
     directory is obtained from the <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code>.</p>
 
+    <div class="warning">The <code class="directive"><a href="#proxyrequests">ProxyRequests</a></code> directive should
+    usually be set <strong>off</strong> when using
+    <code class="directive">ProxyPass</code>.</div>
+
     <p>If you require a more flexible reverse-proxy configuration, see the
     <code class="directive"><a href="../mod/mod_rewrite.html#rewriterule">RewriteRule</a></code> directive with the
     <code>[P]</code> flag.</p>
 
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
@@ -722,12 +771,20 @@
     <p>This directive lets Apache adjust the URL in the <code>Location</code>,
     <code>Content-Location</code> and <code>URI</code> headers on HTTP redirect
     responses. This is essential when Apache is used as a reverse proxy to avoid
     by-passing the reverse proxy because of HTTP redirects on the backend
     servers which stay behind the reverse proxy.</p>
 
+    <p>Only the HTTP response headers specifically mentioned above
+    will be rewritten.  Apache will not rewrite other response
+    headers, nor will it rewrite URL references inside HTML pages.
+    This means that if the proxied content contains absolute URL
+    references, they will by-pass the proxy.  A third-party module
+    that will look inside the HTML and rewrite URL references is Nick
+    Kew's <a href="http://www.webthing.com/software/mod_proxy_html/">mod_proxy_html</a>.</p>
+
     <p><var>path</var> is the name of a local virtual path. <var>url</var> is a
     partial URL for the remote server - the same way they are used for the
     <code class="directive"><a href="#proxypass">ProxyPass</a></code> directive.</p>
 
     <p>For example, suppose the local server has address
     <code>http://example.com/</code>; then</p>
@@ -750,13 +807,13 @@
 
     <p>Note that this <code class="directive">ProxyPassReverse</code> directive can
     also be used in conjunction with the proxy pass-through feature
     (<code>RewriteRule ...  [P]</code>) from <code class="module"><a href="../mod/mod_rewrite.html">mod_rewrite</a></code>
     because its doesn't depend on a corresponding <code class="directive"><a href="#proxypass">ProxyPass</a></code> directive.</p>
 
-    <p>When used inside a <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code> section, the first argument is ommitted and the local
+    <p>When used inside a <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code> section, the first argument is omitted and the local
     directory is obtained from the <code class="directive"><a href="../mod/core.html#location">&lt;Location&gt;</a></code>.</p>
 
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="directive-section"><h2><a name="ProxyPreserveHost" id="ProxyPreserveHost">ProxyPreserveHost</a> <a name="proxypreservehost" id="proxypreservehost">Directive</a></h2>
 <table class="directive">
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_proxy.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_proxy.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_proxy.xml	2003-07-06 10:15:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_proxy.xml	2003-07-28 23:56:55.000000000 +0800
@@ -20,118 +20,158 @@
     <p>This module implements a proxy/gateway for Apache. It implements
     proxying capability for <code>FTP</code>, <code>CONNECT</code> (for SSL),
     <code>HTTP/0.9</code>, <code>HTTP/1.0</code>, and <code>HTTP/1.1</code>.
     The module can be configured to connect to other proxy modules for these
     and other protocols.</p>
 
-    <p>This module was experimental in Apache 1.1.x. Improvements and bugfixes
-    were made in Apache v1.2.x and Apache v1.3.x, then the module underwent a
-    major overhaul for Apache v2.0. The protocol support was upgraded to
-    <code>HTTP/1.1</code>, and filter support was enabled.</p>
-
-    <p>During the overhaul process, <module>mod_proxy</module> features
-    have been split into several module files: <module>mod_proxy_http</module>,
-    <module>mod_proxy_ftp</module> and <module>mod_proxy_connect</module>.
-    Thus, if you want to use one or more of the particular proxy functions,
-    load <module>mod_proxy</module> <em>and</em> the appropriate
-    module(s) into the server (either statically or dynamically via the
-    <directive module="mod_so">LoadModule</directive> directive).</p>
-
-    <p>Please note that the <strong>caching</strong> function present in <module
-    >mod_proxy</module> up to Apache v1.3.x has been <strong>removed</strong>
-    from <module>mod_proxy</module> and incorporated into a new module,
-    <module>mod_cache</module>. In other words, the Apache 2.0.x proxy doesn't 
-    cache - all caching functionality has been moved into
-    <module>mod_cache</module>, which is capable of caching any content, not
-    just content from the proxy.</p>
-
-    <p>If you need to use SSL when contacting remote servers, have a look at the
-    <code>SSLProxy*</code> directives in <module>mod_ssl</module>.</p>
+    <p>Apache's proxy features are divided into several modules in
+    addition to <module>mod_proxy</module>:
+    <module>mod_proxy_http</module>, <module>mod_proxy_ftp</module>
+    and <module>mod_proxy_connect</module>.  Thus, if you want to use
+    one or more of the particular proxy functions, load
+    <module>mod_proxy</module> <em>and</em> the appropriate module(s)
+    into the server (either statically at compile-time or dynamically
+    via the <directive module="mod_so">LoadModule</directive>
+    directive).</p>
+
+    <p>In addition, extended features are provided by other modules.
+    Caching is provided by <module>mod_cache</module> and related
+    modules.  The ability to contact remote servers using the SSL/TLS
+    protocol is provided by the <code>SSLProxy*</code> directives of
+    <module>mod_ssl</module>.  These additional modules will need
+    to be loaded and configured to take advantage of these features.</p>
 </summary>
+<seealso><module>mod_cache</module></seealso>
 <seealso><module>mod_proxy_http</module></seealso>
 <seealso><module>mod_proxy_ftp</module></seealso>
 <seealso><module>mod_proxy_connect</module></seealso>
 <seealso><module>mod_ssl</module></seealso>
 
-<section id="configs"><title>Common configuration topics</title>
-    <ul>
-    <li><a href="#forwardreverse">Forward and Reverse Proxies</a></li>
-    <li><a href="#access">Controlling access to your proxy</a></li>
-    <li><a href="#mimetypes">Why doesn't file type <var>xxx</var> download via
-    FTP?</a></li>
-    <li><a href="#type">How can I force an FTP ASCII download of File
-    <var>xxx</var>?</a></li>
-    <li><a href="#percent2fhack">How can I access FTP files outside of my home
-    directory?</a></li>
-    <li><a href="#ftppass">How can I hide the FTP cleartext password in my
-    browser's URL line?</a></li>
-    <li><a href="#startup">Why does Apache start more slowly when using the
-    proxy module?</a></li>
-    <li><a href="#intranet">What other functions are useful for an intranet
-    proxy server?</a></li>
-    <li><a href="#envsettings">How can I make the proxy talk HTTP/1.0 and
-    disable keepalives?</a></li>
-    </ul>
-
     <section id="forwardreverse"><title>Forward and Reverse Proxies</title>
       <p>Apache can be configured in both a <dfn>forward</dfn> and
-      <dfn>reverse</dfn> proxy configuration.</p>
+      <dfn>reverse</dfn> proxy mode.</p>
 
-      <p>A <dfn>forward proxy</dfn> is an intermediate system that enables a
-      browser to connect to a remote network to which it normally does not have
-      access. A forward proxy can also be used to cache data, reducing load on
-      the networks between the forward proxy and the remote webserver.</p>
-
-      <p>Apache's <module>mod_proxy</module> can be figured to behave like a
-      forward proxy using the <directive module="mod_proxy"
-      >ProxyRemote</directive> directive. In addition, caching of data can be
-      achieved by configuring <module>mod_cache</module>. Other dedicated
-      forward proxy packages include <a href="http://www.squid-cache.org/"
-      >Squid</a>.</p>
-
-      <p>A <dfn>reverse proxy</dfn> is a webserver system that is capable of
-      serving webpages sourced from other webservers - in addition to webpages
-      on disk or generated dynamically by CGI - making these pages look like
-      they originated at the reverse proxy.</p>
-
-      <p>When configured with the mod_cache module the reverse proxy can act as
-      a cache for slower backend webservers. The reverse proxy can also enable
-      advanced URL strategies and management techniques, allowing webpages
-      served using different webserver systems or architectures to coexist
-      inside the same URL space. Reverse proxy systems are also ideal for
-      implementing centralised logging websites with many or diverse website
-      backends. Complex multi-tier webserver systems can be constructed using an
-      <module>mod_proxy</module> frontend and any number of backend
-      webservers.</p>
-
-      <p>The reverse proxy is configured using the <directive
-      module="mod_proxy">ProxyPass</directive> and <directive
-      module="mod_proxy">ProxyPassReverse</directive> directives. Caching can be
-      enabled using mod_cache as with the forward proxy.</p>
+      <p>An ordinary <dfn>forward proxy</dfn> is an intermediate
+      server that sits between the client and the <em>origin
+      server</em>.  In order to get content from the origin server,
+      the client sends a request to the proxy naming the origin server
+      as the target and the proxy then requests the content from the
+      origin server and returns it to the client.  The client must be
+      specially configured to use the forward proxy to access other
+      sites.</p>
+
+      <p>A typical usage of a forward proxy is to provide Internet
+      access to internal clients that are otherwise restricted by a
+      firewall.  The forward proxy can also use caching (as provided
+      by <module>mod_cache</module>) to reduce network usage.</p>
+
+      <p>The forward proxy is activated using the <directive
+      module="mod_proxy">ProxyRequests</directive> directive.  Because
+      forward proxys allow clients to access arbitrary sites through
+      your server and to hide their true origin, it is essential that
+      you <a href="#access">secure your server</a> so that only
+      authorized clients can access the proxy before activating a
+      forward proxy.</p>
+
+      <p>A <dfn>reverse proxy</dfn>, by contrast, appears to the
+      client just like an ordinary web server.  No special
+      configuration on the client is necessary.  The client makes
+      ordinary requests for content in the name-space of the reverse
+      proxy.  The reverse proxy then decides where to send those
+      requests, and returns the content as if it was itself the
+      origin.</p>
+
+      <p>A typical usage of a reverse proxy is to provide Internet
+      users access to a server that is behind a firewall.  Reverse
+      proxies can also be used to balance load among several back-end
+      servers, or to provide caching for a slower back-end server.
+      In addition, reverse proxies can be used simply to bring
+      several servers into the same URL space.</p>
+
+      <p>A reverse proxy is activated using the <directive
+      module="mod_proxy">ProxyPass</directive> directive or the
+      <code>[P]</code> flag to the <directive
+      module="mod_rewrite">RewriteRule</directive> directive.  It is
+      <strong>not</strong> necessary to turn <directive
+      module="mod_proxy">ProxyRequests</directive> on in order to
+      configure a reverse proxy.</p>
     </section> <!-- /forwardreverse -->
 
+    <section id="examples"><title>Basic Examples</title>
+
+    <p>The examples below are only a very basic idea to help you
+    get started.  Please read the documentation on the individual
+    directives.</p>
+
+    <p>In addition, if you wish to have caching enabled, consult
+    the documentation from <module>mod_cache</module>.</p>
+
+    <example><title>Forward Proxy</title>
+    ProxyRequests On<br />
+    ProxyVia On<br />
+    <br />
+    &lt;Proxy *&gt;<br />
+    <indent>
+      Order deny,allow<br />
+      Deny from all<br />
+      Allow from internal.example.com<br />
+    </indent>
+    &lt;/Proxy&gt;
+    </example>
+
+    <example><title>Reverse Proxy</title>
+    ProxyRequests Off<br />
+    <br />
+    &lt;Proxy *&gt;<br />
+    <indent>
+      Order deny,allow<br />
+      Allow from all<br />
+    </indent>
+    &lt;/Proxy&gt;<br />
+    <br />
+    ProxyPass /foo http://foo.example.com/bar<br />
+    ProxyPassReverse /foo http://foo.example.com/bar
+    </example>
+    </section> <!-- /examples -->
+
+
     <section id="access"><title>Controlling access to your proxy</title>
       <p>You can control who can access your proxy via the <directive
-      module="mod_proxy" type="section">Proxy</directive> control block using
+      module="mod_proxy" type="section">Proxy</directive> control block as in
       the following example:</p>
 
       <example>
         &lt;Proxy *&gt;<br />
         <indent>
           Order Deny,Allow<br />
           Deny from all<br />
           Allow from 192.168.0<br />
         </indent>
         &lt;/Proxy&gt;
       </example>
 
-      <p>When configuring a reverse proxy, access control takes on the
-      attributes of the normal server <directive module="core" type="section"
-      >Directory</directive> configuration.</p>
+      <p>For more information on access control directives, see
+      <module>mod_access</module>.</p>
+
+      <p>Strictly limiting access is essential if you are using a
+      forward proxy (using the <directive
+      module="mod_proxy">ProxyRequests</directive> directive).
+      Otherwise, your server can be used by any client to access
+      arbitrary hosts while hiding his or her true identity.  This is
+      dangerous both for your network and for the Internet at large.
+      When using a reverse proxy (using the <directive
+      module="mod_proxy">ProxyPass</directive> directive with
+      <code>ProxyRequests Off</code>), access control is less
+      critical because clients can only contact the hosts that you
+      have specifically configured.</p>
+
     </section> <!-- /access -->
 
+   <section id="ftp-proxy"><title>FTP Proxy</title>
+
+
     <section id="mimetypes"><title>Why doesn't file type <var>xxx</var>
     download via FTP?</title>
       <p>You probably don't have that particular file type defined as
       <code>application/octet-stream</code> in your proxy's mime.types
       configuration file. A useful line can be</p>
 
@@ -170,13 +210,13 @@
     </section> <!-- /percent2fhck -->
 
     <section id="ftppass"><title>How can I hide the FTP cleartext password
     in my browser's URL line?</title>
       <p>To log in to an FTP server by username and password, Apache uses
       different strategies. In absense of a user name and password in the URL
-      altogether, Apache sends an anomymous login to the FTP server,
+      altogether, Apache sends an anonymous login to the FTP server,
       <em>i.e.</em>,</p>
 
       <example>
         user: anonymous<br />
         password: apache_proxy@
       </example>
@@ -212,26 +252,27 @@
         FTP server as plaintext. You should therefore think twice before
         accessing your FTP server via HTTP (or before accessing your personal
         files via FTP at all!) When using unsecure channels, an eavesdropper
         might intercept your password on its way.</p>
       </note>
     </section> <!-- /ftppass -->
-
-    <section id="startup"><title>Why does Apache start more slowly when using
-    the proxy module?</title>
+   </section> <!-- /ftpproxy -->
+    <section id="startup"><title>Slow Startup</title>
       <p>If you're using the <directive module="mod_proxy"
       >ProxyBlock</directive> directive, hostnames' IP addresses are looked up
       and cached during startup for later match test. This may take a few
       seconds (or more) depending on the speed with which the hostname lookups
       occur.</p>
     </section> <!-- /startup -->
 
-    <section id="intranet"><title>What other functions are useful for an
-    intranet proxy server?</title>
+    <section id="intranet"><title>Intranet Proxy</title>
       <p>An Apache proxy server situated in an intranet needs to forward
-      external requests through the company's firewall. However, when it has to
+      external requests through the company's firewall (for this, configure
+      the <directive module="mod_proxy">ProxyRemote</directive> directive
+      to forward the respective <var>scheme</var> to the firewall proxy).
+      However, when it has to
       access resources within the intranet, it can bypass the firewall when
       accessing hosts. The <directive module="mod_proxy">NoProxy</directive>
       directive is useful for specifying which hosts belong to the intranet and
       should be accessed directly.</p>
 
       <p>Users within an intranet tend to omit the local domain name from their
@@ -243,14 +284,13 @@
       href="#proxyrequests">configured for proxy service</a>, Apache can return
       a redirect response and send the client to the correct, fully qualified,
       server address. This is the preferred method since the user's bookmark
       files will then contain fully qualified hosts.</p>
     </section> <!-- /intranet -->
 
-    <section id="envsettings"><title>How can I make the proxy talk HTTP/1.0 and 
-    disable keepalives?</title>
+    <section id="envsettings"><title>Protocol Adjustments</title>
       <p>For circumstances where you have a application server which doesn't
       implement keepalives or HTTP/1.1 properly, there are 2 environment
       variables which when set send a HTTP/1.0 with no keepalive. These are set
       via the  <directive module="mod_env">SetEnv</directive> directive.</p>
 
       <p>These are the <code>force-proxy-request-1.0</code> and
@@ -263,13 +303,12 @@
           SetEnv force-proxy-request-1.0 1<br />
           SetEnv proxy-nokeepalive 1<br />
         </indent>
         &lt;/Location&gt;
       </example>
     </section> <!-- /envsettings -->
-</section>
 
 <directivesynopsis type="section">
 <name>Proxy</name>
 <description>Container for directives applied to proxied resources</description>
 <syntax>&lt;Proxy <var>wildcard-url</var>&gt; ...&lt;/Proxy&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
@@ -503,16 +542,21 @@
     <note><title>Note</title>
       <p>Order is important. you need to put the exclusions <em>before</em> the
       general proxypass directive.</p>
     </note>
 
     <p>When used inside a <directive type="section" module="core"
-    >Location</directive> section, the first argument is ommitted and the local
+    >Location</directive> section, the first argument is omitted and the local
     directory is obtained from the <directive type="section" module="core"
     >Location</directive>.</p>
 
+    <note type="warning">The <directive
+    module="mod_proxy">ProxyRequests</directive> directive should
+    usually be set <strong>off</strong> when using
+    <directive>ProxyPass</directive>.</note>
+
     <p>If you require a more flexible reverse-proxy configuration, see the
     <directive module="mod_rewrite">RewriteRule</directive> directive with the
     <code>[P]</code> flag.</p>
 </usage>
 </directivesynopsis>
 
@@ -529,12 +573,21 @@
     <p>This directive lets Apache adjust the URL in the <code>Location</code>,
     <code>Content-Location</code> and <code>URI</code> headers on HTTP redirect
     responses. This is essential when Apache is used as a reverse proxy to avoid
     by-passing the reverse proxy because of HTTP redirects on the backend
     servers which stay behind the reverse proxy.</p>
 
+    <p>Only the HTTP response headers specifically mentioned above
+    will be rewritten.  Apache will not rewrite other response
+    headers, nor will it rewrite URL references inside HTML pages.
+    This means that if the proxied content contains absolute URL
+    references, they will by-pass the proxy.  A third-party module
+    that will look inside the HTML and rewrite URL references is Nick
+    Kew's <a href="http://www.webthing.com/software/mod_proxy_html/"
+    >mod_proxy_html</a>.</p>
+
     <p><var>path</var> is the name of a local virtual path. <var>url</var> is a
     partial URL for the remote server - the same way they are used for the
     <directive module="mod_proxy">ProxyPass</directive> directive.</p>
 
     <p>For example, suppose the local server has address
     <code>http://example.com/</code>; then</p>
@@ -560,13 +613,13 @@
     also be used in conjunction with the proxy pass-through feature
     (<code>RewriteRule ...  [P]</code>) from <module>mod_rewrite</module>
     because its doesn't depend on a corresponding <directive module="mod_proxy"
     >ProxyPass</directive> directive.</p>
 
     <p>When used inside a <directive type="section" module="core"
-    >Location</directive> section, the first argument is ommitted and the local
+    >Location</directive> section, the first argument is omitted and the local
     directory is obtained from the <directive type="section" module="core"
     >Location</directive>.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_rewrite.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_rewrite.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_rewrite.html.en	2003-05-30 03:29:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_rewrite.html.en	2003-10-11 06:24:27.000000000 +0800
@@ -1565,21 +1565,12 @@
 
           <p>Note: <strong>You have to use this flag if you want to
           intermix directives of different modules which contain
           URL-to-filename translators</strong>. The typical example
           is the use of <code>mod_alias</code> and
           <code>mod_rewrite</code>..</p>
-
-<div class="note"><h3>For Apache hackers</h3>
-               If the current Apache API had a filename-to-filename
-              hook additionally to the URI-to-filename hook then we
-              wouldn't need this flag! But without such a hook this
-              flag is the only solution. The Apache Group has
-              discussed this problem and will add such a hook in
-              Apache version 2.0.
-</div>
         </li>
 
         <li>'<strong><code>skip|S</code></strong>=<em>num</em>'
         (<strong>s</strong>kip next rule(s))<br />
          This flag forces the rewriting engine to skip the next
         <em>num</em> rules in sequence when the current rule
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_rewrite.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_rewrite.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/mod_rewrite.xml	2003-04-16 06:56:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/mod_rewrite.xml	2003-10-11 06:24:27.000000000 +0800
@@ -1567,21 +1567,12 @@
 
           <p>Note: <strong>You have to use this flag if you want to
           intermix directives of different modules which contain
           URL-to-filename translators</strong>. The typical example
           is the use of <code>mod_alias</code> and
           <code>mod_rewrite</code>..</p>
-
-<note><title>For Apache hackers</title>
-               If the current Apache API had a filename-to-filename
-              hook additionally to the URI-to-filename hook then we
-              wouldn't need this flag! But without such a hook this
-              flag is the only solution. The Apache Group has
-              discussed this problem and will add such a hook in
-              Apache version 2.0.
-</note>
         </li>
 
         <li>'<strong><code>skip|S</code></strong>=<em>num</em>'
         (<strong>s</strong>kip next rule(s))<br />
          This flag forces the rewriting engine to skip the next
         <em>num</em> rules in sequence when the current rule
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/quickreference.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/quickreference.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/quickreference.html	2003-07-06 04:37:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/quickreference.html	2003-07-13 02:44:37.000000000 +0800
@@ -9,7 +9,7 @@
 URI: quickreference.html.ja.jis
 Content-Language: ja
 Content-type: text/html; charset=ISO-2022-JP
 
 URI: quickreference.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/quickreference.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/quickreference.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mod/quickreference.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mod/quickreference.html.ru.koi8-r	2003-07-10 20:01:41.000000000 +0800
@@ -10,13 +10,13 @@
 <link href="../style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="../style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="../images/favicon.ico" rel="shortcut icon" /></head>
 <body id="directive-index">
 <div id="page-header">
 <p class="menu"><a href="../mod/">íÏÄÕÌÉ</a> | <a href="../mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="../sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="../images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="../images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="../">÷ÅÒÓÉÑ 2.0</a> &gt; <a href="./">íÏÄÕÌÉ</a></div>
 <div id="preamble"><h1>ëÒÁÔËÏÅ ÒÕËÏ×ÏÄÓÔ×Ï ÐÏ ÄÉÒÅËÔÉ×ÁÍ</h1>
 <div class="toplang">
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html	2003-07-13 02:44:36.000000000 +0800
@@ -9,7 +9,7 @@
 URI: mpm.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: mpm.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html.en	2003-07-01 06:17:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html.en	2003-07-13 06:32:22.000000000 +0800
@@ -22,13 +22,13 @@
 <a href="./ja/mpm.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
 <a href="./ko/mpm.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
 <a href="./ru/mpm.html" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
 <p>This document describes what a Multi-Processing Module is and
-how they are using by the Apache HTTP Server.</p>
+how they are used by the Apache HTTP Server.</p>
 </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#introduction">Introduction</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#choosing">Choosing an MPM</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#defaults">MPM Defaults</a></li>
 </ul></div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>íÕÌØÔÉ-ÐÒÏÃÅÓÓÎÙÅ ÍÏÄÕÌÉ (íð-ÍÏÄÕÌÉ)</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./en/mpm.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/mpm.xml	2003-07-01 03:25:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/mpm.xml	2003-07-13 06:32:22.000000000 +0800
@@ -4,13 +4,13 @@
 <manualpage metafile="mpm.xml.meta">
 
   <title>Multi-Processing Modules (MPMs)</title>
 
 <summary>
 <p>This document describes what a Multi-Processing Module is and
-how they are using by the Apache HTTP Server.</p>
+how they are used by the Apache HTTP Server.</p>
 </summary>
 
 <section id="introduction"><title>Introduction</title>
 
     <p>The Apache HTTP Server is designed to be a powerful and
     flexible web server that can work on a very wide variety of
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/new_features_2_0.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/new_features_2_0.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/new_features_2_0.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/new_features_2_0.html	2003-07-13 02:44:36.000000000 +0800
@@ -17,7 +17,7 @@
 URI: new_features_2_0.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: new_features_2_0.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/new_features_2_0.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/new_features_2_0.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/new_features_2_0.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/new_features_2_0.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>ïÂÚÏÒ ÎÏ×ÙÈ ×ÏÚÍÏÖÎÏÓÔÅÊ × Apache 2.0</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./de/new_features_2_0.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.html	2003-07-06 04:37:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.html	2003-07-18 06:00:07.000000000 +0800
@@ -1,3 +1,7 @@
 URI: index.html.en
 Content-Language: en
 Content-type: text/html; charset=ISO-8859-1
+
+URI: index.html.ru.koi8-r
+Content-Language: ru
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.html.en	2003-05-30 03:30:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.html.en	2003-07-18 06:00:07.000000000 +0800
@@ -15,13 +15,14 @@
 <p class="apache">Apache HTTP Server Version 2.0</p>
 <img alt="" src="../images/feather.gif" /></div>
 <div class="up"><a href="../"><img title="&lt;-" alt="&lt;-" src="../images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="../">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>Server and Supporting Programs</h1>
 <div class="toplang">
-<p><span>Available Languages: </span><a href="../en/programs/" title="English">&nbsp;en&nbsp;</a></p>
+<p><span>Available Languages: </span><a href="../en/programs/" title="English">&nbsp;en&nbsp;</a> |
+<a href="../ru/programs/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>This page documents all the executable programs included
     with the Apache HTTP Server.</p>
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
@@ -75,11 +76,12 @@
 
       <dt><a href="other.html">Other Programs</a></dt>
       <dd>Support tools with no own manual page.</dd>
     </dl>
 </div></div>
 <div class="bottomlang">
-<p><span>Available Languages: </span><a href="../en/programs/" title="English">&nbsp;en&nbsp;</a></p>
+<p><span>Available Languages: </span><a href="../en/programs/" title="English">&nbsp;en&nbsp;</a> |
+<a href="../ru/programs/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="../mod/">Modules</a> | <a href="../mod/directives.html">Directives</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">Glossary</a> | <a href="../sitemap.html">Sitemap</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs: index.html.ru.koi8-r
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/programs/index.xml.meta	2003-04-16 07:34:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs/index.xml.meta	2003-07-15 16:30:44.000000000 +0800
@@ -4,8 +4,9 @@
   <basename>index</basename>
   <path>/programs/</path>
   <relpath>..</relpath>
 
   <variants>
     <variant>en</variant>
+    <variant>ru</variant>
   </variants>
 </metafile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/programs: index.xml.ru
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sections.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sections.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sections.html.en	2003-05-30 03:29:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sections.html.en	2003-09-18 16:16:15.000000000 +0800
@@ -316,13 +316,13 @@
 <code class="directive"><a href="./mod/core.html#files">&lt;Files&gt;</a></code>,
 <code class="directive"><a href="./mod/core.html#filesmatch">&lt;FilesMatch&gt;</a></code>,
 <code class="directive"><a href="./mod/core.html#location">&lt;Location&gt;</a></code>,
 <code class="directive"><a href="./mod/core.html#locationmatch">&lt;LocationMatch&gt;</a></code>,
 <code class="directive"><a href="./mod/mod_proxy.html#proxy">&lt;Proxy&gt;</a></code>,
 and <code class="directive"><a href="./mod/mod_proxy.html#proxymatch">&lt;ProxyMatch&gt;</a></code>
-sections.  There are some exceptions, however.</p>
+sections.  There are some exceptions, however:</p>
 
 <ul>
 <li>The <code class="directive"><a href="./mod/core.html#allowoverride">AllowOverride</a></code> directive
 works only in <code class="directive"><a href="./mod/core.html#directory">&lt;Directory&gt;</a></code>
 sections.</li>
 
@@ -344,14 +344,15 @@
 are interpreted, it is important to understand how this works.</p>
 
     <p>The order of merging is:</p>
 
     <ol>
       <li> <code class="directive"><a href="./mod/core.html#directory">&lt;Directory&gt;</a></code> (except regular expressions)
-      and .htaccess done simultaneously (with .htaccess, if allowed,
-      overriding <code class="directive"><a href="./mod/core.html#directory">&lt;Directory&gt;</a></code>)</li>
+      and <code>.htaccess</code> done simultaneously (with
+      <code>.htaccess</code>, if allowed, overriding
+      <code class="directive"><a href="./mod/core.html#directory">&lt;Directory&gt;</a></code>)</li>
 
       <li><code class="directive"><a href="./mod/core.html#directorymatch">&lt;DirectoryMatch&gt;</a></code>
       (and <code>&lt;Directory ~&gt;</code>)</li>
 
       <li><code class="directive"><a href="./mod/core.html#files">&lt;Files&gt;</a></code> and <code class="directive"><a href="./mod/core.html#filesmatch">&lt;FilesMatch&gt;</a></code> done
       simultaneously</li>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sections.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sections.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sections.xml	2003-04-24 06:43:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sections.xml	2003-09-18 16:16:15.000000000 +0800
@@ -328,13 +328,13 @@
 <directive type="section" module="core">Files</directive>,
 <directive type="section" module="core">FilesMatch</directive>,
 <directive type="section" module="core">Location</directive>,
 <directive type="section" module="core">LocationMatch</directive>,
 <directive type="section" module="mod_proxy">Proxy</directive>,
 and <directive type="section" module="mod_proxy">ProxyMatch</directive>
-sections.  There are some exceptions, however.</p>
+sections.  There are some exceptions, however:</p>
 
 <ul>
 <li>The <directive module="core">AllowOverride</directive> directive
 works only in <directive type="section" module="core">Directory</directive>
 sections.</li>
 
@@ -359,15 +359,15 @@
 
     <p>The order of merging is:</p>
 
     <ol>
       <li> <directive type="section"
       module="core">Directory</directive> (except regular expressions)
-      and .htaccess done simultaneously (with .htaccess, if allowed,
-      overriding <directive type="section"
-      module="core">Directory</directive>)</li>
+      and <code>.htaccess</code> done simultaneously (with
+      <code>.htaccess</code>, if allowed, overriding
+      <directive type="section" module="core">Directory</directive>)</li>
 
       <li><directive type="section" module="core">DirectoryMatch</directive>
       (and <code>&lt;Directory ~&gt;</code>)</li>
 
       <li><directive type="section"
       module="core">Files</directive> and <directive
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.html.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.html.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.html.de	2003-05-30 03:29:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.html.de	2003-09-19 04:54:51.000000000 +0800
@@ -38,13 +38,13 @@
 <li><img alt="" src="./images/down.gif" /> <a href="#howto">Praxis / Anleitungen</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#platform">Plattform-spezifische Anmerkungen</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#programs">Apache HTTP Server und Hilfsprogramme</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#misc">Weitere Apache-Dokumentationen</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#modules">Apache-Module</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#developer">Dokumentation für Entwickler</a></li>
-<li><img alt="" src="./images/down.gif" /> <a href="#descriptive">Beschreibende Informationen</a></li>
+<li><img alt="" src="./images/down.gif" /> <a href="#index">Glossar und Index</a></li>
 </ul>
 </div>
 <div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="release" id="release">Hinweise zur Version</a></h2>
 <ul><li><a href="upgrading.html">Upgrade von 1.3 auf 2.0</a></li>
 <li><a href="new_features_2_0.html">Neue Funktionen in Version 2.0</a></li>
@@ -86,14 +86,14 @@
 <li><a href="vhosts/fd-limits.html">Datei-Deskriptor-Begrenzungen</a></li>
 <li><a href="dns-caveats.html">Probleme bezüglich DNS und Apache</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="faq" id="faq">Häufig gestellte Fragen (FAQ)</a></h2>
 <ul><li><a href="faq/">Übersicht</a></li>
-<li class="separate"><a href="faq/all_in_one.html">Alle auf einer Seite</a></li>
 <li><a href="faq/support.html">Support</a></li>
+<li><a href="faq/error.html">Fehlermeldungen</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="ssl" id="ssl">SSL/TLS-Verschlüsselung des Apache</a></h2>
 <ul><li class="separate"><a href="ssl/">Übersicht</a></li>
 <li><a href="ssl/ssl_intro.html">SSL/TLS-Verschlüsselung: Einführung</a></li>
 <li><a href="ssl/ssl_compat.html">SSL/TLS-Verschlüsselung: Kompatibilität</a></li>
@@ -142,18 +142,18 @@
 <ul><li class="separate"><a href="misc/">Übersicht</a></li>
 <li><a href="misc/custom_errordocs.html">International angepaßte Server-Fehlermeldungen</a></li>
 <li><a href="misc/fin_wait_2.html">Verbindungen im FIN_WAIT_2 und Apache</a></li>
 <li><a href="misc/known_client_problems.html">Bekannte Client-Probleme</a></li>
 <li><a href="misc/descriptors.html">Deskriptoren und Apache</a></li>
 <li><a href="cgi_path.html">PATH_INFO-Änderungen in der CGI-Umgebung</a></li>
+<li><a href="misc/relevant_standards.html">Wichtige Standards</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="modules" id="modules">Apache-Module</a></h2>
-<ul><li><a href="mod/">Modul-Index</a></li>
-<li><a href="mod/directives.html">Direktiven-Index</a></li>
-<li><a href="mod/quickreference.html">Kurzreferenz der Direktiven</a></li>
+<ul><li><a href="mod/module-dict.html">Erklärung der Fachbegriffe zu Apache-Modulen</a></li>
+<li><a href="mod/directive-dict.html">Erklärung der Fachbegriffe zu Apache-Direktiven</a></li>
 </ul><ul><li><a href="mod/core.html">Apache-Kernfunktionen</a></li>
 <li><a href="mod/mpm_common.html">Allgemeine Direktiven der Apache-MPMs</a></li>
 <li><a href="mod/beos.html">Apache-MPM beos</a></li>
 <li><a href="mod/leader.html">Apache-MPM leader</a></li>
 <li><a href="mod/mpm_netware.html">Apache-MPM netware</a></li>
 <li><a href="mod/mpmt_os2.html">Apache-MPM os2</a></li>
@@ -218,25 +218,25 @@
 <li><a href="mod/mod_vhost_alias.html">Apache-Modul mod_vhost_alias</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="developer" id="developer">Dokumentation für Entwickler</a></h2>
 <ul><li class="separate"><a href="developer/">Übersicht</a></li>
 <li><a href="developer/API.html">Anmerkungen zur Apache-API</a></li>
-<li><a href="developer/debugging.html">Debuggen der Speicher-Belegung in der APR </a></li>
+<li><a href="developer/debugging.html">Debuggen der Speicher-Belegung in der APR</a></li>
 <li><a href="developer/documenting.html">Apache 2.0 dokumentieren</a></li>
 <li><a href="developer/hooks.html">Hook-Funktionen des Apache 2.0 </a></li>
 <li><a href="developer/modules.html">Module von Apache 1.3 nach Apache 2.0 konvertieren</a></li>
 <li><a href="developer/request.html">Verarbeitung der Anfragen im Apache 2.0</a></li>
 <li><a href="developer/filters.html">Wie Filter im Apache 2.0 arbeiten</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
-<div class="section"><h2><a name="descriptive" id="descriptive">Beschreibende Informationen</a></h2>
-<ul><li><a href="mod/module-dict.html">Erklärung der Fachbegriffe zu Apache-Modulen</a></li>
-<li><a href="mod/directive-dict.html">Erklärung der Fachbegriffe zu Apache-Direktiven</a></li>
-<li><a href="glossary.html">Glossar</a></li>
-<li>Seitenindex (dieses Dokument)</li>
+<div class="section"><h2><a name="index" id="index">Glossar und Index</a></h2>
+<ul><li><a href="glossary.html">Glossar</a></li>
+<li><a href="mod/">Modul-Index</a></li>
+<li><a href="mod/directives.html">Direktiven-Index</a></li>
+<li><a href="mod/quickreference.html">Kurzreferenz der Direktiven</a></li>
 </ul>
 </div></div>
 <div class="bottomlang">
 <p><span>Verfügbare Sprachen: </span><a href="./de/sitemap.html" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="./en/sitemap.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="./ja/sitemap.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.html.en	2003-07-01 06:17:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.html.en	2003-09-19 04:40:36.000000000 +0800
@@ -140,12 +140,13 @@
 <ul><li class="separate"><a href="misc/">Overview</a></li>
 <li><a href="misc/custom_errordocs.html">International Customized Server Error Messages</a></li>
 <li><a href="misc/fin_wait_2.html">Connections in FIN_WAIT_2 and Apache</a></li>
 <li><a href="misc/known_client_problems.html">Known Client Problems</a></li>
 <li><a href="misc/descriptors.html">Descriptors and Apache</a></li>
 <li><a href="cgi_path.html">PATH_INFO Changes in the CGI Environment</a></li>
+<li><a href="misc/relevant_standards.html">Relevant Standards</a></li>
 </ul>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section"><h2><a name="modules" id="modules">Apache modules</a></h2>
 <ul><li><a href="mod/module-dict.html">Definitions of terms used to describe Apache modules</a></li>
 <li><a href="mod/directive-dict.html">Definitions of terms used to describe Apache directives</a></li>
 </ul><ul><li><a href="mod/core.html">Apache Core Features</a></li>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.xml	2003-07-01 03:25:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.xml	2003-09-19 04:40:36.000000000 +0800
@@ -117,12 +117,13 @@
 <page separate="yes" href="misc/">Overview</page>
 <page href="misc/custom_errordocs.html">International Customized Server Error Messages</page>
 <page href="misc/fin_wait_2.html">Connections in FIN_WAIT_2 and Apache</page>
 <page href="misc/known_client_problems.html">Known Client Problems</page>
 <page href="misc/descriptors.html">Descriptors and Apache</page>
 <page href="cgi_path.html">PATH_INFO Changes in the CGI Environment</page>
+<page href="misc/relevant_standards.html">Relevant Standards</page>
 </category>
 
 <category id="modules">
 <title>Apache modules</title>
 <page href="mod/module-dict.html">Definitions of terms used to describe Apache modules</page>
 <page href="mod/directive-dict.html">Definitions of terms used to describe Apache directives</page>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.xml.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.xml.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/sitemap.xml.de	2003-04-25 16:24:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/sitemap.xml.de	2003-09-19 04:54:51.000000000 +0800
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8" ?>
 <!DOCTYPE sitemap SYSTEM "./style/sitemap.dtd"
   [ <!ENTITY allmodules SYSTEM "./mod/allmodules.xml.de"> ]
 >
 <?xml-stylesheet type="text/xsl" href="./style/manual.de.xsl"?>
-<!-- English revision: 1.12.2.12 -->
+<!-- English revision: 1.12.2.14 -->
 
 <sitemap metafile="sitemap.xml.meta">
 
   <title>Seitenindex</title>
 
 <summary>
@@ -59,14 +59,14 @@
 <page href="dns-caveats.html">Probleme bez&#252;glich DNS und Apache</page>
 </category>
 
 <category id="faq">
 <title>H&#228;ufig gestellte Fragen (FAQ)</title>
 <page href="faq/">&#220;bersicht</page>
-<page separate="yes" href="faq/all_in_one.html">Alle auf einer Seite</page>
 <page href="faq/support.html">Support</page>
+<page href="faq/error.html">Fehlermeldungen</page>
 </category>
 
 <category id="ssl">
 <title>SSL/TLS-Verschl&#252;sselung des Apache</title>
 <page separate="yes" href="ssl/">&#220;bersicht</page>
 <page href="ssl/ssl_intro.html">SSL/TLS-Verschl&#252;sselung: Einf&#252;hrung</page>
@@ -120,37 +120,36 @@
 <page separate="yes" href="misc/">&#220;bersicht</page>
 <page href="misc/custom_errordocs.html">International angepa&#223;te Server-Fehlermeldungen</page>
 <page href="misc/fin_wait_2.html">Verbindungen im FIN_WAIT_2 und Apache</page>
 <page href="misc/known_client_problems.html">Bekannte Client-Probleme</page>
 <page href="misc/descriptors.html">Deskriptoren und Apache</page>
 <page href="cgi_path.html">PATH_INFO-&#196;nderungen in der CGI-Umgebung</page>
+<page href="misc/relevant_standards.html">Wichtige Standards</page>
 </category>
 
 <category id="modules">
 <title>Apache-Module</title>
-<page href="mod/">Modul-Index</page>
-<page href="mod/directives.html">Direktiven-Index</page>
-<page href="mod/quickreference.html">Kurzreferenz der Direktiven</page>
+<page href="mod/module-dict.html">Erkl&#228;rung der Fachbegriffe zu Apache-Modulen</page>
+<page href="mod/directive-dict.html">Erkl&#228;rung der Fachbegriffe zu Apache-Direktiven</page>
 &allmodules;
 </category>
 
 <category id="developer">
 <title>Dokumentation f&#252;r Entwickler</title>
 <page separate="yes" href="developer/">&#220;bersicht</page>
 <page href="developer/API.html">Anmerkungen zur Apache-API</page>
-<page href="developer/debugging.html">Debuggen der Speicher-Belegung in der APR </page>
+<page href="developer/debugging.html">Debuggen der Speicher-Belegung in der APR</page>
 <page href="developer/documenting.html">Apache 2.0 dokumentieren</page>
 <page href="developer/hooks.html">Hook-Funktionen des Apache 2.0 </page>
 <page href="developer/modules.html">Module von Apache 1.3 nach Apache 2.0 konvertieren</page>
 <page href="developer/request.html">Verarbeitung der Anfragen im Apache 2.0</page>
 <page href="developer/filters.html">Wie Filter im Apache 2.0 arbeiten</page>
 </category>
 
-<category id="descriptive">
-<title>Beschreibende Informationen</title>
-<page href="mod/module-dict.html">Erkl&#228;rung der Fachbegriffe zu Apache-Modulen</page>
-<page href="mod/directive-dict.html">Erkl&#228;rung der Fachbegriffe zu Apache-Direktiven</page>
+<category id="index"><title>Glossar und Index</title>
 <page href="glossary.html">Glossar</page>
-<page>Seitenindex (dieses Dokument)</page>
+<page href="mod/">Modul-Index</page>
+<page href="mod/directives.html">Direktiven-Index</page>
+<page href="mod/quickreference.html">Kurzreferenz der Direktiven</page>
 </category>
 
 </sitemap>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/ssl/ssl_faq.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/ssl/ssl_faq.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/ssl/ssl_faq.html.en	2003-07-01 06:17:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/ssl/ssl_faq.html.en	2003-10-14 07:01:09.000000000 +0800
@@ -902,17 +902,12 @@
     </dd>
     <dt>Postings from the modssl-users Support Mailing List <a href="http://www.modssl.org/support/">http://www.modssl.org/support/</a></dt>
     <dd>Second search for your problem in one of the existing archives of the
         modssl-users mailing list. Perhaps your problem popped up at least once for
         another user, too.
     </dd>
-    <dt>Problem Reports in the Bug Database <a href="http://www.modssl.org/support/bugdb/">http://www.modssl.org/support/bugdb/</a></dt>
-    <dd>Third look inside the mod_ssl Bug Database. Perhaps
-        someone else already has reported the problem.
-    </dd>
-
     </dl>
 
 
 <h3><a name="contact" id="contact">What support contacts are available in case of mod_ssl problems?</a></h3>
  <p>The following lists all support possibilities for mod_ssl, in order of
     preference, i.e. start in this order and do not pick the support possibility
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/ssl/ssl_faq.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/ssl/ssl_faq.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/ssl/ssl_faq.xml	2003-07-01 03:25:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/ssl/ssl_faq.xml	2003-10-14 07:01:09.000000000 +0800
@@ -896,19 +896,12 @@
         href="http://www.modssl.org/support/"
         >http://www.modssl.org/support/</a></dt>
     <dd>Second search for your problem in one of the existing archives of the
         modssl-users mailing list. Perhaps your problem popped up at least once for
         another user, too.
     </dd>
-    <dt>Problem Reports in the Bug Database <a 
-        href="http://www.modssl.org/support/bugdb/"
-        >http://www.modssl.org/support/bugdb/</a></dt>
-    <dd>Third look inside the mod_ssl Bug Database. Perhaps
-        someone else already has reported the problem.
-    </dd>
-
     </dl>
 </section>
 
 <section id="contact"><title>What support contacts are available in case of mod_ssl problems?</title>
  <p>The following lists all support possibilities for mod_ssl, in order of
     preference, i.e. start in this order and do not pick the support possibility
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/stopping.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/stopping.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/stopping.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/stopping.html	2003-07-13 02:44:36.000000000 +0800
@@ -13,7 +13,7 @@
 URI: stopping.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: stopping.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/stopping.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/stopping.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/stopping.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/stopping.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>ïÓÔÁÎÏ× É ÐÅÒÅÚÁÐÕÓË</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./de/stopping.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/style/lang/ru.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/style/lang/ru.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/style/lang/ru.xml	2003-07-07 02:14:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/style/lang/ru.xml	2003-07-08 19:50:35.000000000 +0800
@@ -55,15 +55,15 @@
 
  <!-- Used in summaries -->
  <message name="summary">òÅÚÀÍÅ</message>
 
  <!-- Used in headers and footers -->
  <message name="apachetitle">- HTTP ÓÅÒ×ÅÒ Apache</message>
- <message name="apachehttpserver">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</message>
+ <message name="apachehttpserver">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</message>
  <message name="apachedocalt">[äïëõíåîôáãéñ APACHE]</message>
- <message name="search">Google Search</message> <!-- search button -->
+ <message name="search">ðÏÉÓË × Google</message> <!-- search button -->
  <message name="index">ïÇÌÁ×ÌÅÎÉÅ</message> <!-- deprecated -->
  <message name="home">îÁ ÇÌÁ×ÎÕÀ ÓÔÒÁÎÉÃÕ</message> <!-- deprecated -->
 
  <!-- breadcrumb links -->
  <message name="apache">Apache</message>
  <message name="http-server">HTTP ÓÅÒ×ÅÒ</message>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/style/xsl/typemap.xsl /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/style/xsl/typemap.xsl
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/style/xsl/typemap.xsl	2003-06-21 00:06:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/style/xsl/typemap.xsl	2003-07-13 02:39:15.000000000 +0800
@@ -120,11 +120,11 @@
 <xsl:template name="designations">
 <item lang="de"    charset="ISO-8859-1" >.de</item>
 <item lang="en"    charset="ISO-8859-1" >.en</item>
 <item lang="fr"    charset="ISO-8859-1" >.fr</item>
 <item lang="ja"    charset="ISO-2022-JP">.ja.jis</item>
 <item lang="ko"    charset="EUC-KR"     >.ko.euc-kr</item>
-<item lang="ru"    charset="KOI8-r"     >.ru.koi8-r</item>
+<item lang="ru"    charset="KOI8-R"     >.ru.koi8-r</item>
 <item lang="zh-CN" charset="GB2312"     >.zh-cn.gb2312</item>
 </xsl:template>
 
 </xsl:stylesheet>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/suexec.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/suexec.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/suexec.html.en	2003-07-01 06:17:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/suexec.html.en	2003-10-13 07:37:34.000000000 +0800
@@ -32,15 +32,15 @@
 
     <p>Used properly, this feature can reduce
     considerably the security risks involved with allowing users to
     develop and run private CGI or SSI programs. However, if suEXEC
     is improperly configured, it can cause any number of problems
     and possibly create new holes in your computer's security. If
-    you aren't familiar with managing setuid root programs and the
-    security issues they present, we highly recommend that you not
-    consider using suEXEC.</p>
+    you aren't familiar with managing <em>setuid root</em> programs
+    and the security issues they present, we highly recommend that
+    you not consider using suEXEC.</p>
   </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="./images/down.gif" /> <a href="#before">Before we begin</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#model">suEXEC Security Model</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#install">Configuring &amp; Installing
     suEXEC</a></li>
 <li><img alt="" src="./images/down.gif" /> <a href="#enable">Enabling &amp; Disabling
@@ -121,12 +121,22 @@
     to determine success or failure -- if any one of these
     conditions fail, the program logs the failure and exits with an
     error, otherwise it will continue:</p>
 
     <ol>
       <li>
+        <strong>Is the user executing this wrapper a valid user of
+        this system?</strong> 
+
+        <p class="indent">
+          This is to ensure that the user executing the wrapper is
+          truly a user of the system.
+        </p>
+     </li>
+
+     <li>
         <strong>Was the wrapper called with the proper number of
         arguments?</strong> 
 
         <p class="indent">
           The wrapper will only execute if it is given the proper
           number of arguments. The proper argument format is known
@@ -135,40 +145,32 @@
           hacked, or there is something wrong with the suEXEC
           portion of your Apache binary.
         </p>
       </li>
 
       <li>
-        <strong>Is the user executing this wrapper a valid user of
-        this system?</strong> 
-
-        <p class="indent">
-          This is to ensure that the user executing the wrapper is
-          truly a user of the system.
-        </p>
-      </li>
-
-      <li>
         <strong>Is this valid user allowed to run the
         wrapper?</strong> 
 
         <p class="indent">
           Is this user the user allowed to run this wrapper? Only
           one user (the Apache user) is allowed to execute this
           program.
         </p>
       </li>
 
       <li>
-        <strong>Does the target program have an unsafe hierarchical
-        reference?</strong> 
+        <strong>Does the target CGI or SSI program have an unsafe
+        hierarchical reference?</strong> 
 
         <p class="indent">
-          Does the target program contain a leading '/' or have a
-          '..' backreference? These are not allowed; the target
-          program must reside within the Apache webspace.
+          Does the target CGI or SSI program's path contain a leading
+          '/' or have a '..' backreference? These are not allowed; the
+          target CGI/SSI program must reside within suEXEC's document
+          root (see <code>--with-suexec-docroot=<em>DIR</em></code>
+          below).
         </p>
       </li>
 
       <li>
         <strong>Is the target user name valid?</strong> 
 
@@ -187,14 +189,14 @@
 
       <li>
         <strong>Is the target user <em>NOT</em> superuser?</strong>
 
 
         <p class="indent">
-          Presently, suEXEC does not allow 'root' to execute
-          CGI/SSI programs.
+          Presently, suEXEC does not allow <code><em>root</em></code>
+          to execute CGI/SSI programs.
         </p>
       </li>
 
       <li>
         <strong>Is the target userid <em>ABOVE</em> the minimum ID
         number?</strong> 
@@ -209,14 +211,14 @@
 
       <li>
         <strong>Is the target group <em>NOT</em> the superuser
         group?</strong> 
 
         <p class="indent">
-          Presently, suEXEC does not allow the 'root' group to
-          execute CGI/SSI programs.
+          Presently, suEXEC does not allow the <code><em>root</em></code>
+          group to execute CGI/SSI programs.
         </p>
       </li>
 
       <li>
         <strong>Is the target groupid <em>ABOVE</em> the minimum ID
         number?</strong> 
@@ -239,29 +241,31 @@
           is also initialized with all of the groups of which the
           user is a member.
         </p>
       </li>
 
       <li>
-        <strong>Does the directory in which the program resides
-        exist?</strong> 
+        <strong>Can we change directory to the one in which the target
+        CGI/SSI program resides?</strong>
 
         <p class="indent">
-          If it doesn't exist, it can't very well contain files.
+          If it doesn't exist, it can't very well contain files. If we
+          can't change directory to it, it might aswell not exist.
         </p>
       </li>
 
       <li>
         <strong>Is the directory within the Apache
         webspace?</strong> 
 
         <p class="indent">
           If the request is for a regular portion of the server, is
-          the requested directory within the server's document
-          root? If the request is for a UserDir, is the requested
-          directory within the user's document root?
+          the requested directory within suEXEC's document root? If
+          the request is for a UserDir, is the requested directory
+          within the directory configured as suEXEC's userdir (see
+          <a href="#install">suEXEC's configuration options</a>)?
         </p>
       </li>
 
       <li>
         <strong>Is the directory <em>NOT</em> writable by anyone
         else?</strong> 
@@ -271,31 +275,31 @@
           the owner user may be able to alter this directories
           contents.
         </p>
       </li>
 
       <li>
-        <strong>Does the target program exist?</strong> 
+        <strong>Does the target CGI/SSI program exist?</strong> 
 
         <p class="indent">
           If it doesn't exists, it can't very well be executed.
         </p>
       </li>
 
       <li>
-        <strong>Is the target program <em>NOT</em> writable by
-        anyone else?</strong> 
+        <strong>Is the target CGI/SSI program <em>NOT</em> writable
+        by anyone else?</strong> 
 
         <p class="indent">
           We don't want to give anyone other than the owner the
-          ability to change the program.
+          ability to change the CGI/SSI program.
         </p>
       </li>
 
       <li>
-        <strong>Is the target program <em>NOT</em> setuid or
+        <strong>Is the target CGI/SSI program <em>NOT</em> setuid or
         setgid?</strong> 
 
         <p class="indent">
           We do not want to execute programs that will then change
           our UID/GID again.
         </p>
@@ -321,17 +325,17 @@
           are listed in the safe environment list (also created
           during configuration).
         </p>
       </li>
 
       <li>
-        <strong>Can we successfully become the target program and
-        execute?</strong> 
+        <strong>Can we successfully become the target CGI/SSI program
+        and execute?</strong> 
 
         <p class="indent">
-          Here is where suEXEC ends and the target program begins.
+          Here is where suEXEC ends and the target CGI/SSI program begins.
         </p>
       </li>
     </ol>
 
     <p>This is the standard operation of the
     suEXEC wrapper's security model. It is somewhat stringent and
@@ -357,20 +361,20 @@
 
     <dl>
       <dt><code>--enable-suexec</code></dt>
 
       <dd>This option enables the suEXEC feature which is never
       installed or activated by default. At least one
-      --with-suexec-xxxxx option has to be provided together with the
-      --enable-suexec option to let APACI accept your request for
-      using the suEXEC feature.</dd>
+      <code>--with-suexec-xxxxx</code> option has to be provided
+      together with the <code>--enable-suexec</code> option to let
+      APACI accept your request for using the suEXEC feature.</dd>
 
       <dt><code>--with-suexec-bin=<em>PATH</em></code></dt>
 
-      <dd>The path to the suexec binary must be hard-coded in
-      the server for security reasons. Use this option to override
+      <dd>The path to the <code>suexec</code> binary must be hard-coded
+      in the server for security reasons. Use this option to override
       the default path. <em>e.g.</em>
       <code>--with-suexec-bin=/usr/sbin/suexec</code></dd>
 
       <dt><code>--with-suexec-caller=<em>UID</em></code></dt>
 
       <dd>The <a href="mod/mpm_common.html#user">username</a> under which
@@ -396,14 +400,14 @@
       not work!</strong></dd>
 
       <dt><code>--with-suexec-docroot=<em>DIR</em></code></dt>
 
       <dd>Define as the DocumentRoot set for Apache. This will be
       the only hierarchy (aside from UserDirs) that can be used for
-      suEXEC behavior. The default directory is the --datadir value
-      with the suffix "/htdocs", <em>e.g.</em> if you configure
+      suEXEC behavior. The default directory is the <code>--datadir</code>
+      value with the suffix "/htdocs", <em>e.g.</em> if you configure
       with "<code>--datadir=/home/apache</code>" the directory
       "/home/apache/htdocs" is used as document root for the suEXEC
       wrapper.</dd>
 
       <dt><code>--with-suexec-uidmin=<em>UID</em></code></dt>
 
@@ -420,69 +424,99 @@
       <dt><code>--with-suexec-logfile=<em>FILE</em></code></dt>
 
       <dd>This defines the filename to which all suEXEC
       transactions and errors are logged (useful for auditing and
       debugging purposes). By default the logfile is named
       "suexec_log" and located in your standard logfile directory
-      (--logfiledir).</dd>
+      (<code>--logfiledir</code>).</dd>
 
       <dt><code>--with-suexec-safepath=<em>PATH</em></code></dt>
 
       <dd>Define a safe PATH environment to pass to CGI
       executables. Default value is
       "/usr/local/bin:/usr/bin:/bin".</dd>
     </dl>
 
     <p><strong>Checking your suEXEC
     setup</strong><br />
      Before you compile and install the suEXEC wrapper you can
-    check the configuration with the --layout option.<br />
+    check the configuration with the <code>--layout</code> option.<br />
      Example output:</p>
 
 <div class="example"><p><code>
     suEXEC setup:<br />
-            suexec binary: /usr/local/apache/sbin/suexec<br />
-            document root: /usr/local/apache/share/htdocs<br />
+            suexec binary: /usr/local/apache2/sbin/suexec<br />
+            document root: /usr/local/apache2/share/htdocs<br />
            userdir suffix: public_html<br />
-                  logfile: /usr/local/apache/var/log/suexec_log<br />
+                  logfile: /usr/local/apache2/var/log/suexec_log<br />
                 safe path: /usr/local/bin:/usr/bin:/bin<br />
                 caller ID: www<br />
           minimum user ID: 100<br />
          minimum group ID: 100<br />
 </code></p></div>
 
     <p><strong>Compiling and installing the suEXEC
     wrapper</strong><br />
      If you have enabled the suEXEC feature with the
-    --enable-suexec option the suexec binary (together with Apache
-    itself) is automatically built if you execute the command
-    "make".<br />
+    <code>--enable-suexec</code> option the <code>suexec</code> binary
+    (together with Apache itself) is automatically built if you execute
+    the <code>make</code> command.<br />
      After all components have been built you can execute the
-    command "make install" to install them. The binary image
-    "suexec" is installed in the directory defined by the --sbindir
-    option. Default location is
-    "/usr/local/apache/sbin/suexec".<br />
+    command <code>make install</code> to install them. The binary image
+    <code>suexec</code> is installed in the directory defined by the
+    <code>--sbindir</code> option. The default location is
+    "/usr/local/apache2/sbin/suexec".<br />
      Please note that you need <strong><em>root
     privileges</em></strong> for the installation step. In order
     for the wrapper to set the user ID, it must be installed as
     owner <code><em>root</em></code> and must have the setuserid
     execution bit set for file modes.</p>
 
+    <p><strong>Setting paranoid permissions</strong><br />
+    Although the suEXEC wrapper will check to ensure that its
+    caller is the correct user as specified with the
+    <code>--with-suexec-caller</code> configure option, there is
+    always the possibility that a system or library call suEXEC uses
+    before this check may be exploitable on your system. To counter
+    this, and because it is best-practise in general, you should use 
+    filesystem permissions to ensure that only the group Apache 
+    runs as may execute suEXEC.</p>
+
+    <p>If for example, your web-server is configured to run as:</p>
+
+<div class="example"><p><code>
+    User www<br />
+    Group webgroup<br />
+</code></p></div>
+
+    <p>and <code>suexec</code> is installed at
+    "/usr/local/apache2/sbin/suexec", you should run:</p>
+
+<div class="example"><p><code>
+    chgrp webgroup /usr/local/apache2/bin/suexec<br />
+    chmod 4750 /usr/local/apache2/bin/suexec<br />
+</code></p></div>
+
+    <p>This will ensure that only the group Apache runs as can even
+    execute the suEXEC wrapper.</p>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="enable" id="enable">Enabling &amp; Disabling
     suEXEC</a></h2>
 
     <p>Upon startup of Apache, it looks for the file
-    "suexec" in the "sbin" directory (default is
+    <code>suexec</code> in the directory defined by the
+    <code>--sbindir</code> option (default is
     "/usr/local/apache/sbin/suexec"). If Apache finds a properly
     configured suEXEC wrapper, it will print the following message
     to the error log:</p>
+
 <div class="example"><p><code>
     [notice] suEXEC mechanism enabled (wrapper: <em>/path/to/suexec</em>)
 </code></p></div>
+
     <p>If you don't see this message at server startup, the server is
     most likely not finding the wrapper program where it expects
     it, or the executable is not installed <em>setuid root</em>.</p>
 
      <p>If you want to enable the suEXEC mechanism for the first time
     and an Apache server is already running you must kill and
@@ -486,13 +520,13 @@
 
      <p>If you want to enable the suEXEC mechanism for the first time
     and an Apache server is already running you must kill and
     restart Apache. Restarting it with a simple HUP or USR1 signal
     will not be enough. </p>
      <p>If you want to disable suEXEC you should kill and restart
-    Apache after you have removed the "suexec" file. </p>
+    Apache after you have removed the <code>suexec</code> file. </p>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="usage" id="usage">Using suEXEC</a></h2>
 
     <p><strong>Virtual Hosts:</strong><br /> One way to use the suEXEC
     wrapper is through the <code class="directive"><a href="./mod/mod_suexec.html#suexecusergroup">SuexecUserGroup</a></code> directive in
@@ -514,16 +548,16 @@
     above.</p>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="debug" id="debug">Debugging suEXEC</a></h2>
 
     <p>The suEXEC wrapper will write log information
-    to the file defined with the --with-suexec-logfile option as
-    indicated above. If you feel you have configured and installed
-    the wrapper properly, have a look at this log and the error_log
-    for the server to see where you may have gone astray.</p>
+    to the file defined with the <code>--with-suexec-logfile</code>
+    option as indicated above. If you feel you have configured and
+    installed the wrapper properly, have a look at this log and the
+    error_log for the server to see where you may have gone astray.</p>
 
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="jabberwock" id="jabberwock">Beware the Jabberwock:
     Warnings &amp; Examples</a></h2>
 
@@ -540,13 +574,13 @@
       <li><strong>suEXEC Points Of Interest</strong></li>
 
       <li>
         Hierarchy limitations 
 
         <p class="indent">
-          For security and efficiency reasons, all suexec requests
+          For security and efficiency reasons, all suEXEC requests
           must remain within either a top-level document root for
           virtual host requests, or one top-level personal document
           root for userdir requests. For example, if you have four
           VirtualHosts configured, you would need to structure all
           of your VHosts' document roots off of one main Apache
           document hierarchy to take advantage of suEXEC for
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/suexec.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/suexec.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/suexec.xml	2003-06-23 00:50:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/suexec.xml	2003-10-13 07:37:34.000000000 +0800
@@ -16,15 +16,15 @@
 
     <p>Used properly, this feature can reduce
     considerably the security risks involved with allowing users to
     develop and run private CGI or SSI programs. However, if suEXEC
     is improperly configured, it can cause any number of problems
     and possibly create new holes in your computer's security. If
-    you aren't familiar with managing setuid root programs and the
-    security issues they present, we highly recommend that you not
-    consider using suEXEC.</p>
+    you aren't familiar with managing <em>setuid root</em> programs
+    and the security issues they present, we highly recommend that
+    you not consider using suEXEC.</p>
   </summary>
 
 <section id="before"><title>Before we begin</title>
 
     <p>Before jumping head-first into this document,
     you should be aware of the assumptions made on the part of the
@@ -93,12 +93,22 @@
     to determine success or failure -- if any one of these
     conditions fail, the program logs the failure and exits with an
     error, otherwise it will continue:</p>
 
     <ol>
       <li>
+        <strong>Is the user executing this wrapper a valid user of
+        this system?</strong> 
+
+        <p class="indent">
+          This is to ensure that the user executing the wrapper is
+          truly a user of the system.
+        </p>
+     </li>
+
+     <li>
         <strong>Was the wrapper called with the proper number of
         arguments?</strong> 
 
         <p class="indent">
           The wrapper will only execute if it is given the proper
           number of arguments. The proper argument format is known
@@ -107,40 +117,32 @@
           hacked, or there is something wrong with the suEXEC
           portion of your Apache binary.
         </p>
       </li>
 
       <li>
-        <strong>Is the user executing this wrapper a valid user of
-        this system?</strong> 
-
-        <p class="indent">
-          This is to ensure that the user executing the wrapper is
-          truly a user of the system.
-        </p>
-      </li>
-
-      <li>
         <strong>Is this valid user allowed to run the
         wrapper?</strong> 
 
         <p class="indent">
           Is this user the user allowed to run this wrapper? Only
           one user (the Apache user) is allowed to execute this
           program.
         </p>
       </li>
 
       <li>
-        <strong>Does the target program have an unsafe hierarchical
-        reference?</strong> 
+        <strong>Does the target CGI or SSI program have an unsafe
+        hierarchical reference?</strong> 
 
         <p class="indent">
-          Does the target program contain a leading '/' or have a
-          '..' backreference? These are not allowed; the target
-          program must reside within the Apache webspace.
+          Does the target CGI or SSI program's path contain a leading
+          '/' or have a '..' backreference? These are not allowed; the
+          target CGI/SSI program must reside within suEXEC's document
+          root (see <code>--with-suexec-docroot=<em>DIR</em></code>
+          below).
         </p>
       </li>
 
       <li>
         <strong>Is the target user name valid?</strong> 
 
@@ -159,14 +161,14 @@
 
       <li>
         <strong>Is the target user <em>NOT</em> superuser?</strong>
 
 
         <p class="indent">
-          Presently, suEXEC does not allow 'root' to execute
-          CGI/SSI programs.
+          Presently, suEXEC does not allow <code><em>root</em></code>
+          to execute CGI/SSI programs.
         </p>
       </li>
 
       <li>
         <strong>Is the target userid <em>ABOVE</em> the minimum ID
         number?</strong> 
@@ -181,14 +183,14 @@
 
       <li>
         <strong>Is the target group <em>NOT</em> the superuser
         group?</strong> 
 
         <p class="indent">
-          Presently, suEXEC does not allow the 'root' group to
-          execute CGI/SSI programs.
+          Presently, suEXEC does not allow the <code><em>root</em></code>
+          group to execute CGI/SSI programs.
         </p>
       </li>
 
       <li>
         <strong>Is the target groupid <em>ABOVE</em> the minimum ID
         number?</strong> 
@@ -211,29 +213,31 @@
           is also initialized with all of the groups of which the
           user is a member.
         </p>
       </li>
 
       <li>
-        <strong>Does the directory in which the program resides
-        exist?</strong> 
+        <strong>Can we change directory to the one in which the target
+        CGI/SSI program resides?</strong>
 
         <p class="indent">
-          If it doesn't exist, it can't very well contain files.
+          If it doesn't exist, it can't very well contain files. If we
+          can't change directory to it, it might aswell not exist.
         </p>
       </li>
 
       <li>
         <strong>Is the directory within the Apache
         webspace?</strong> 
 
         <p class="indent">
           If the request is for a regular portion of the server, is
-          the requested directory within the server's document
-          root? If the request is for a UserDir, is the requested
-          directory within the user's document root?
+          the requested directory within suEXEC's document root? If
+          the request is for a UserDir, is the requested directory
+          within the directory configured as suEXEC's userdir (see
+          <a href="#install">suEXEC's configuration options</a>)?
         </p>
       </li>
 
       <li>
         <strong>Is the directory <em>NOT</em> writable by anyone
         else?</strong> 
@@ -243,31 +247,31 @@
           the owner user may be able to alter this directories
           contents.
         </p>
       </li>
 
       <li>
-        <strong>Does the target program exist?</strong> 
+        <strong>Does the target CGI/SSI program exist?</strong> 
 
         <p class="indent">
           If it doesn't exists, it can't very well be executed.
         </p>
       </li>
 
       <li>
-        <strong>Is the target program <em>NOT</em> writable by
-        anyone else?</strong> 
+        <strong>Is the target CGI/SSI program <em>NOT</em> writable
+        by anyone else?</strong> 
 
         <p class="indent">
           We don't want to give anyone other than the owner the
-          ability to change the program.
+          ability to change the CGI/SSI program.
         </p>
       </li>
 
       <li>
-        <strong>Is the target program <em>NOT</em> setuid or
+        <strong>Is the target CGI/SSI program <em>NOT</em> setuid or
         setgid?</strong> 
 
         <p class="indent">
           We do not want to execute programs that will then change
           our UID/GID again.
         </p>
@@ -293,17 +297,17 @@
           are listed in the safe environment list (also created
           during configuration).
         </p>
       </li>
 
       <li>
-        <strong>Can we successfully become the target program and
-        execute?</strong> 
+        <strong>Can we successfully become the target CGI/SSI program
+        and execute?</strong> 
 
         <p class="indent">
-          Here is where suEXEC ends and the target program begins.
+          Here is where suEXEC ends and the target CGI/SSI program begins.
         </p>
       </li>
     </ol>
 
     <p>This is the standard operation of the
     suEXEC wrapper's security model. It is somewhat stringent and
@@ -330,20 +334,20 @@
 
     <dl>
       <dt><code>--enable-suexec</code></dt>
 
       <dd>This option enables the suEXEC feature which is never
       installed or activated by default. At least one
-      --with-suexec-xxxxx option has to be provided together with the
-      --enable-suexec option to let APACI accept your request for
-      using the suEXEC feature.</dd>
+      <code>--with-suexec-xxxxx</code> option has to be provided
+      together with the <code>--enable-suexec</code> option to let
+      APACI accept your request for using the suEXEC feature.</dd>
 
       <dt><code>--with-suexec-bin=<em>PATH</em></code></dt>
 
-      <dd>The path to the suexec binary must be hard-coded in
-      the server for security reasons. Use this option to override
+      <dd>The path to the <code>suexec</code> binary must be hard-coded
+      in the server for security reasons. Use this option to override
       the default path. <em>e.g.</em>
       <code>--with-suexec-bin=/usr/sbin/suexec</code></dd>
 
       <dt><code>--with-suexec-caller=<em>UID</em></code></dt>
 
       <dd>The <a href="mod/mpm_common.html#user">username</a> under which
@@ -369,14 +373,14 @@
       not work!</strong></dd>
 
       <dt><code>--with-suexec-docroot=<em>DIR</em></code></dt>
 
       <dd>Define as the DocumentRoot set for Apache. This will be
       the only hierarchy (aside from UserDirs) that can be used for
-      suEXEC behavior. The default directory is the --datadir value
-      with the suffix "/htdocs", <em>e.g.</em> if you configure
+      suEXEC behavior. The default directory is the <code>--datadir</code>
+      value with the suffix "/htdocs", <em>e.g.</em> if you configure
       with "<code>--datadir=/home/apache</code>" the directory
       "/home/apache/htdocs" is used as document root for the suEXEC
       wrapper.</dd>
 
       <dt><code>--with-suexec-uidmin=<em>UID</em></code></dt>
 
@@ -393,69 +397,99 @@
       <dt><code>--with-suexec-logfile=<em>FILE</em></code></dt>
 
       <dd>This defines the filename to which all suEXEC
       transactions and errors are logged (useful for auditing and
       debugging purposes). By default the logfile is named
       "suexec_log" and located in your standard logfile directory
-      (--logfiledir).</dd>
+      (<code>--logfiledir</code>).</dd>
 
       <dt><code>--with-suexec-safepath=<em>PATH</em></code></dt>
 
       <dd>Define a safe PATH environment to pass to CGI
       executables. Default value is
       "/usr/local/bin:/usr/bin:/bin".</dd>
     </dl>
 
     <p><strong>Checking your suEXEC
     setup</strong><br />
      Before you compile and install the suEXEC wrapper you can
-    check the configuration with the --layout option.<br />
+    check the configuration with the <code>--layout</code> option.<br />
      Example output:</p>
 
 <example>
     suEXEC setup:<br />
-            suexec binary: /usr/local/apache/sbin/suexec<br />
-            document root: /usr/local/apache/share/htdocs<br />
+            suexec binary: /usr/local/apache2/sbin/suexec<br />
+            document root: /usr/local/apache2/share/htdocs<br />
            userdir suffix: public_html<br />
-                  logfile: /usr/local/apache/var/log/suexec_log<br />
+                  logfile: /usr/local/apache2/var/log/suexec_log<br />
                 safe path: /usr/local/bin:/usr/bin:/bin<br />
                 caller ID: www<br />
           minimum user ID: 100<br />
          minimum group ID: 100<br />
 </example>
 
     <p><strong>Compiling and installing the suEXEC
     wrapper</strong><br />
      If you have enabled the suEXEC feature with the
-    --enable-suexec option the suexec binary (together with Apache
-    itself) is automatically built if you execute the command
-    "make".<br />
+    <code>--enable-suexec</code> option the <code>suexec</code> binary
+    (together with Apache itself) is automatically built if you execute
+    the <code>make</code> command.<br />
      After all components have been built you can execute the
-    command "make install" to install them. The binary image
-    "suexec" is installed in the directory defined by the --sbindir
-    option. Default location is
-    "/usr/local/apache/sbin/suexec".<br />
+    command <code>make install</code> to install them. The binary image
+    <code>suexec</code> is installed in the directory defined by the
+    <code>--sbindir</code> option. The default location is
+    "/usr/local/apache2/sbin/suexec".<br />
      Please note that you need <strong><em>root
     privileges</em></strong> for the installation step. In order
     for the wrapper to set the user ID, it must be installed as
     owner <code><em>root</em></code> and must have the setuserid
     execution bit set for file modes.</p>
 
+    <p><strong>Setting paranoid permissions</strong><br />
+    Although the suEXEC wrapper will check to ensure that its
+    caller is the correct user as specified with the
+    <code>--with-suexec-caller</code> configure option, there is
+    always the possibility that a system or library call suEXEC uses
+    before this check may be exploitable on your system. To counter
+    this, and because it is best-practise in general, you should use 
+    filesystem permissions to ensure that only the group Apache 
+    runs as may execute suEXEC.</p>
+
+    <p>If for example, your web-server is configured to run as:</p>
+
+<example>
+    User www<br />
+    Group webgroup<br />
+</example>
+
+    <p>and <code>suexec</code> is installed at
+    "/usr/local/apache2/sbin/suexec", you should run:</p>
+
+<example>
+    chgrp webgroup /usr/local/apache2/bin/suexec<br />
+    chmod 4750 /usr/local/apache2/bin/suexec<br />
+</example>
+
+    <p>This will ensure that only the group Apache runs as can even
+    execute the suEXEC wrapper.</p>
 </section>
 
 <section id="enable"><title>Enabling &amp; Disabling
     suEXEC</title>
 
     <p>Upon startup of Apache, it looks for the file
-    "suexec" in the "sbin" directory (default is
+    <code>suexec</code> in the directory defined by the
+    <code>--sbindir</code> option (default is
     "/usr/local/apache/sbin/suexec"). If Apache finds a properly
     configured suEXEC wrapper, it will print the following message
     to the error log:</p>
+
 <example>
     [notice] suEXEC mechanism enabled (wrapper: <em>/path/to/suexec</em>)
 </example>
+
     <p>If you don't see this message at server startup, the server is
     most likely not finding the wrapper program where it expects
     it, or the executable is not installed <em>setuid root</em>.</p>
 
      <p>If you want to enable the suEXEC mechanism for the first time
     and an Apache server is already running you must kill and
@@ -459,13 +493,13 @@
 
      <p>If you want to enable the suEXEC mechanism for the first time
     and an Apache server is already running you must kill and
     restart Apache. Restarting it with a simple HUP or USR1 signal
     will not be enough. </p>
      <p>If you want to disable suEXEC you should kill and restart
-    Apache after you have removed the "suexec" file. </p>
+    Apache after you have removed the <code>suexec</code> file. </p>
 </section>
 
 <section id="usage"><title>Using suEXEC</title>
 
     <p><strong>Virtual Hosts:</strong><br /> One way to use the suEXEC
     wrapper is through the <directive
@@ -490,16 +524,16 @@
     above.</p>
 </section>
 
 <section id="debug"><title>Debugging suEXEC</title>
 
     <p>The suEXEC wrapper will write log information
-    to the file defined with the --with-suexec-logfile option as
-    indicated above. If you feel you have configured and installed
-    the wrapper properly, have a look at this log and the error_log
-    for the server to see where you may have gone astray.</p>
+    to the file defined with the <code>--with-suexec-logfile</code>
+    option as indicated above. If you feel you have configured and
+    installed the wrapper properly, have a look at this log and the
+    error_log for the server to see where you may have gone astray.</p>
 
 </section>
 
 <section id="jabberwock"><title>Beware the Jabberwock:
     Warnings &amp; Examples</title>
 
@@ -517,13 +551,13 @@
       <li><strong>suEXEC Points Of Interest</strong></li>
 
       <li>
         Hierarchy limitations 
 
         <p class="indent">
-          For security and efficiency reasons, all suexec requests
+          For security and efficiency reasons, all suEXEC requests
           must remain within either a top-level document root for
           virtual host requests, or one top-level personal document
           root for userdir requests. For example, if you have four
           VirtualHosts configured, you would need to structure all
           of your VHosts' document roots off of one main Apache
           document hierarchy to take advantage of suEXEC for
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/upgrading.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/upgrading.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/upgrading.html	2003-07-06 04:36:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/upgrading.html	2003-07-13 02:44:36.000000000 +0800
@@ -17,7 +17,7 @@
 URI: upgrading.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
 
 URI: upgrading.html.ru.koi8-r
 Content-Language: ru
-Content-type: text/html; charset=KOI8-r
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/upgrading.html.ru.koi8-r /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/upgrading.html.ru.koi8-r
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/upgrading.html.ru.koi8-r	2003-07-07 09:39:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/upgrading.html.ru.koi8-r	2003-07-10 20:01:40.000000000 +0800
@@ -9,13 +9,13 @@
 <link href="./style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
 <link href="./style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
 <link href="./style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
 <link href="./images/favicon.ico" rel="shortcut icon" /></head>
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="./mod/">íÏÄÕÌÉ</a> | <a href="./mod/directives.html">äÉÒÅËÔÉ×Ù</a> | <a href="./faq/">FAQ</a> | <a href="./glossary.html">çÌÏÓÓÁÒÉÊ</a> | <a href="./sitemap.html">ëÁÒÔÁ ÓÁÊÔÁ</a></p>
-<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ÷ÅÒÓÉÑ 2.0</p>
+<p class="apache">HTTP ÓÅÒ×ÅÒ Apache ×ÅÒÓÉÉ 2.0</p>
 <img alt="" src="./images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="./images/left.gif" /></a></div>
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP ÓÅÒ×ÅÒ</a> &gt; <a href="http://httpd.apache.org/docs-project/">äÏËÕÍÅÎÔÁÃÉÑ</a> &gt; <a href="./">÷ÅÒÓÉÑ 2.0</a></div><div id="page-content"><div id="preamble"><h1>ðÅÒÅÈÏÄ ÏÔ ×ÅÒÓÉÉ 1.3 Ë ×ÅÒÓÉÉ 2.0</h1>
 <div class="toplang">
 <p><span>äÏÓÔÕÐÎÙÅ ÑÚÙËÉ: </span><a href="./de/upgrading.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/urlmapping.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/urlmapping.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/urlmapping.html.en	2003-05-30 03:29:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/urlmapping.html.en	2003-08-26 00:51:14.000000000 +0800
@@ -89,13 +89,13 @@
     <p>For situations where you require additional flexibility, you
     can use the <code class="directive"><a href="./mod/mod_alias.html#aliasmatch">AliasMatch</a></code> and 
     <code class="directive"><a href="./mod/mod_alias.html#scriptaliasmatch">ScriptAliasMatch</a></code>
     directives to do powerful regular-expression based matching and
     substitution. For example,</p>
 
-<div class="example"><p><code>ScriptAliasMatch ^/~([a-zA-Z0-9]*)/cgi-bin/(.*)
+<div class="example"><p><code>ScriptAliasMatch ^/~([a-zA-Z0-9]+)/cgi-bin/(.+)
       /home/$1/cgi-bin/$2</code></p></div>
 
     <p>will map a request to
     <code>http://example.com/~user/cgi-bin/script.cgi</code> to the
     path <code>/home/user/cgi-bin/script.cgi</code> and will treat
     the resulting file as a CGI script.</p>
@@ -136,13 +136,13 @@
     to use the <code class="directive"><a href="./mod/mod_alias.html#aliasmatch">AliasMatch</a></code>
     directive to achieve the desired effect. For example, to make
     <code>http://www.example.com/upages/user/file.html</code> map to
     <code>/home/user/public_html/file.html</code>, use the following
     <code>AliasMatch</code> directive:</p>
 
-<div class="example"><p><code>AliasMatch ^/upages/([a-zA-Z0-9]*)/?(.*)
+<div class="example"><p><code>AliasMatch ^/upages/([a-zA-Z0-9]+)/?(.*)
       /home/$1/public_html/$2</code></p></div>
 </div><div class="top"><a href="#page-header"><img alt="top" src="./images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="redirect" id="redirect">URL Redirection</a></h2>
 
     <p>The configuration directives discussed in the above sections
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/urlmapping.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/urlmapping.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/urlmapping.xml	2003-04-24 06:43:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/urlmapping.xml	2003-08-26 00:51:14.000000000 +0800
@@ -94,13 +94,13 @@
     <p>For situations where you require additional flexibility, you
     can use the <directive module="mod_alias">AliasMatch</directive> and 
     <directive module="mod_alias">ScriptAliasMatch</directive>
     directives to do powerful regular-expression based matching and
     substitution. For example,</p>
 
-<example>ScriptAliasMatch ^/~([a-zA-Z0-9]*)/cgi-bin/(.*)
+<example>ScriptAliasMatch ^/~([a-zA-Z0-9]+)/cgi-bin/(.+)
       /home/$1/cgi-bin/$2</example>
 
     <p>will map a request to
     <code>http://example.com/~user/cgi-bin/script.cgi</code> to the
     path <code>/home/user/cgi-bin/script.cgi</code> and will treat
     the resulting file as a CGI script.</p>
@@ -141,13 +141,13 @@
     to use the <directive module="mod_alias">AliasMatch</directive>
     directive to achieve the desired effect. For example, to make
     <code>http://www.example.com/upages/user/file.html</code> map to
     <code>/home/user/public_html/file.html</code>, use the following
     <code>AliasMatch</code> directive:</p>
 
-<example>AliasMatch ^/upages/([a-zA-Z0-9]*)/?(.*)
+<example>AliasMatch ^/upages/([a-zA-Z0-9]+)/?(.*)
       /home/$1/public_html/$2</example>
 </section>
 
 <section id="redirect"><title>URL Redirection</title>
 
     <p>The configuration directives discussed in the above sections
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/examples.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/examples.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/examples.html.en	2003-05-30 03:30:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/examples.html.en	2003-10-14 07:01:09.000000000 +0800
@@ -131,13 +131,13 @@
            <code>*</code> matches any IP address, this configuration
            would work without changes whenever your IP address
            changes.</p>
     </div>
 
     <p>The above configuration is what you will want to use in almost
-    all name-based virtual hosting situations. The only think that this
+    all name-based virtual hosting situations. The only thing that this
     configuration will not work for, in fact, is when you are serving
     different content based on differing IP addresses or ports.</p>
 
 	</div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="twoips" id="twoips">Name-based hosts on more than one
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/examples.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/examples.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/examples.xml	2003-04-16 08:22:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/examples.xml	2003-10-14 07:01:09.000000000 +0800
@@ -96,13 +96,13 @@
            <code>*</code> matches any IP address, this configuration
            would work without changes whenever your IP address
            changes.</p>
     </note>
 
     <p>The above configuration is what you will want to use in almost
-    all name-based virtual hosting situations. The only think that this
+    all name-based virtual hosting situations. The only thing that this
     configuration will not work for, in fact, is when you are serving
     different content based on differing IP addresses or ports.</p>
 
 	</section>
 
 	<section id="twoips"><title>Name-based hosts on more than one
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html	2003-07-06 04:37:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html	2003-10-06 20:10:56.000000000 +0800
@@ -10,6 +10,10 @@
 Content-Language: ja
 Content-type: text/html; charset=ISO-2022-JP
 
 URI: index.html.ko.euc-kr
 Content-Language: ko
 Content-type: text/html; charset=EUC-KR
+
+URI: index.html.ru.koi8-r
+Content-Language: ru
+Content-type: text/html; charset=KOI8-R
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.de	2003-05-30 03:30:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.de	2003-10-11 06:24:27.000000000 +0800
@@ -18,13 +18,14 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP-Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Dokumentation</a> &gt; <a href="../">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>Apache-Dokumentation zu virtuellen Hosts</h1>
 <div class="toplang">
 <p><span>Verfügbare Sprachen: </span><a href="../de/vhosts/" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
     <p>Der Begriff <cite>virtueller Host</cite> <span class="transnote">(<em>Anm.d.Ü.:</em> engl. 'virtual
     host')</span> bezieht sich auf die Praxis, mehr als ein Webangebot
     (z.B. <code>www.company1.com</code> und <code>www.company2.com</code>)
     auf einer einzigen Maschine zu betreiben. Virtuelle Hosts können
@@ -96,11 +97,12 @@
 
 </div></div>
 <div class="bottomlang">
 <p><span>Verfügbare Sprachen: </span><a href="../de/vhosts/" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Gepflegt durch das <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="../mod/">Module</a> | <a href="../mod/directives.html">Direktiven</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">Glossar</a> | <a href="../sitemap.html">Seitenindex</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.en	2003-05-30 03:30:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.en	2003-10-11 06:24:27.000000000 +0800
@@ -18,13 +18,14 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="../">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>Apache Virtual Host documentation</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
 
     <p>The term <cite>Virtual Host</cite> refers to the practice of
     running more than one web site (such as
     <code>www.company1.com</code> and <code>www.company2.com</code>)
@@ -95,11 +96,12 @@
 
 </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="../mod/">Modules</a> | <a href="../mod/directives.html">Directives</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">Glossary</a> | <a href="../sitemap.html">Sitemap</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.ja.jis	2003-05-30 03:30:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.ja.jis	2003-10-11 06:24:27.000000000 +0800
@@ -18,13 +18,14 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP $B%5!<%P(B</a> &gt; <a href="http://httpd.apache.org/docs-project/">$B%I%-%e%a%s%F!<%7%g%s(B</a> &gt; <a href="../">$B%P!<%8%g%s(B 2.0</a></div><div id="page-content"><div id="preamble"><h1>Apache $B%P!<%A%c%k%[%9%H@bL@=q(B</h1>
 <div class="toplang">
 <p><span>Available Languages: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
 
     <p><cite>$B%P!<%A%c%k%[%9%H(B</cite>$B$H$$$&MQ8l$O!"(B1 $BBf$N%^%7%s>e$G(B
     (<code>www.company1.com</code> and <code>www.company2.com</code> $B$N$h$&$J(B)
     $BFs$D0J>e$N%&%'%V%5%$%H$r07$&1?MQJ}K!$N$3$H$r;X$7$^$9!#(B
@@ -92,11 +93,12 @@
 
 </div></div>
 <div class="bottomlang">
 <p><span>Available Languages: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="../mod/">$B%b%8%e!<%k(B</a> | <a href="../mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">$BMQ8l(B</a> | <a href="../sitemap.html">$B%5%$%H%^%C%W(B</a></p></div>
 </body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.ko.euc-kr /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.ko.euc-kr
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.html.ko.euc-kr	2003-05-30 03:30:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.html.ko.euc-kr	2003-10-11 06:24:27.000000000 +0800
@@ -18,13 +18,14 @@
 <div id="path">
 <a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Documentation</a> &gt; <a href="../">Version 2.0</a></div><div id="page-content"><div id="preamble"><h1>¾ÆÆÄÄ¡ °¡»óÈ£½ºÆ® ¹®¼­</h1>
 <div class="toplang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div>
 
 
     <p><cite>°¡»óÈ£½ºÆ® (Virtual Host)</cite>´Â ÇÑ ÄÄÇ»ÅÍ¿¡¼­
     ¿©·¯ À¥»çÀÌÆ®¸¦ (¿¹¸¦ µé¾î, <code>www.company1.com</code>°ú
     <code>www.company2.com</code>) ¼­ºñ½ºÇÔÀ» ¶æÇÑ´Ù.
@@ -92,11 +93,12 @@
 
 </div></div>
 <div class="bottomlang">
 <p><span>°¡´ÉÇÑ ¾ð¾î: </span><a href="../de/vhosts/" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
-<a href="../ko/vhosts/" title="Korean">&nbsp;ko&nbsp;</a></p>
+<a href="../ko/vhosts/" title="Korean">&nbsp;ko&nbsp;</a> |
+<a href="../ru/vhosts/" hreflang="ru" rel="alternate" title="Russian">&nbsp;ru&nbsp;</a></p>
 </div><div id="footer">
 <p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
 <p class="menu"><a href="../mod/">¸ðµâ</a> | <a href="../mod/directives.html">Áö½Ã¾îµé</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">¿ë¾î</a> | <a href="../sitemap.html">»çÀÌÆ®¸Ê</a></p></div>
 </body></html>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts: index.html.ru.koi8-r
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.xml.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.xml.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.xml.de	2003-04-25 16:19:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.xml.de	2003-08-14 05:31:15.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version='1.0' encoding='UTF-8' ?>
 <!DOCTYPE manualpage SYSTEM "../style/manualpage.dtd">
-<!--<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>-->
+<?xml-stylesheet type="text/xsl" href="../style/manual.de.xsl"?>
 <!-- English revision: 1.3.2.7 -->
 
 <manualpage metafile="index.xml.meta">
 <parentdocument href="../"/>
 
    <title>Apache-Dokumentation zu virtuellen Hosts</title>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/index.xml.meta	2003-05-11 00:50:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/index.xml.meta	2003-10-06 20:13:24.000000000 +0800
@@ -7,8 +7,9 @@
 
   <variants>
     <variant>de</variant>
     <variant>en</variant>
     <variant>ja</variant>
     <variant>ko</variant>
+    <variant>ru</variant>
   </variants>
 </metafile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts: index.xml.ru
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.de	2003-06-04 04:08:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.de	2003-08-14 05:34:48.000000000 +0800
@@ -13,13 +13,13 @@
 <body id="manual-page"><div id="page-header">
 <p class="menu"><a href="../mod/">Module</a> | <a href="../mod/directives.html">Direktiven</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">Glossar</a> | <a href="../sitemap.html">Seitenindex</a></p>
 <p class="apache">Apache HTTP Server Version 2.0</p>
 <img alt="" src="../images/feather.gif" /></div>
 <div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="../images/left.gif" /></a></div>
 <div id="path">
-<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP-Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Dokumentation</a> &gt; <a href="../">Version 2.0</a> &gt; <a href="./">Virtual Hosts</a></div><div id="page-content"><div id="preamble"><h1>Unterstützung namensbasierter virtueller Hosts</h1>
+<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP-Server</a> &gt; <a href="http://httpd.apache.org/docs-project/">Dokumentation</a> &gt; <a href="../">Version 2.0</a> &gt; <a href="./">Virtuelle Hosts</a></div><div id="page-content"><div id="preamble"><h1>Unterstützung namensbasierter virtueller Hosts</h1>
 <div class="toplang">
 <p><span>Verfügbare Sprachen: </span><a href="../de/vhosts/name-based.html" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/name-based.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/name-based.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
 <a href="../ko/vhosts/name-based.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
 </div>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.en	2003-06-04 04:08:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.en	2003-10-11 07:14:34.000000000 +0800
@@ -21,169 +21,164 @@
 <p><span>Available Languages: </span><a href="../de/vhosts/name-based.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
 <a href="../en/vhosts/name-based.html" title="English">&nbsp;en&nbsp;</a> |
 <a href="../ja/vhosts/name-based.html" hreflang="ja" rel="alternate" title="Japanese">&nbsp;ja&nbsp;</a> |
 <a href="../ko/vhosts/name-based.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
 </div>
 
-
-	<p>This document describes when and how to use name-based virtual hosts.</p>
-
+    <p>This document describes when and how to use name-based virtual hosts.</p>
 </div>
 <div id="quickview"><ul id="toc"><li><img alt="" src="../images/down.gif" /> <a href="#namevip">Name-based vs. IP-based Virtual Hosts</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#using">Using Name-based Virtual Hosts</a></li>
 <li><img alt="" src="../images/down.gif" /> <a href="#compat">Compatibility with Older Browsers</a></li>
 </ul><h3>See also</h3><ul class="seealso"><li><a href="ip-based.html">IP-based Virtual Host Support</a></li><li><a href="details.html">An In-Depth Discussion of Virtual Host Matching</a></li><li><a href="mass.html">Dynamically configured mass virtual hosting</a></li><li><a href="examples.html">Virtual Host examples for common setups</a></li><li><a href="examples.html#serverpath">ServerPath configuration example</a></li></ul></div>
 <div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="namevip" id="namevip">Name-based vs. IP-based Virtual Hosts</a></h2>
 
-	<p>IP-based virtual hosts use the IP address of the connection to
-	determine the correct virtual host to serve.  Therefore you need to
-	have a separate IP address for each host.  With name-based virtual
-	hosting, the server relies on the client to report the hostname as
-	part of the HTTP headers.  Using this technique, many different hosts
-	can share the same IP address.</p>
-
-	<p>Name-based virtual hosting is usually simpler, since you need
-	only configure your DNS server to map each hostname to the correct
-	IP address and then configure the Apache HTTP Server to recognize
-	the different hostnames.  Name-based virtual hosting also eases
-	the demand for scarce IP addresses.  Therefore you should use
-	name-based virtual hosting unless there is a specific reason to
-	choose IP-based virtual hosting.  Some reasons why you might consider
-	using IP-based virtual hosting:</p>
-
-	<ul>
-		<li>Some ancient clients are not compatible with name-based virtual
-		hosting.  For name-based virtual hosting to work, the client must send
-		the HTTP Host header.  This is required by HTTP/1.1, and is
-		implemented by all modern HTTP/1.0 browsers as an extension.  If you
-		need to support obsolete clients and still use name-based virtual
-		hosting, a possible technique is discussed at the end of this
-		document.</li>
-
-		<li>Name-based virtual hosting cannot be used with SSL secure servers
-		because of the nature of the SSL protocol.</li>
-
-		<li>Some operating systems and network equipment implement bandwidth
-		management techniques that cannot differentiate between hosts unless
-		they are on separate IP addresses.</li>
-	</ul>
+    <p>IP-based virtual hosts use the IP address of the connection to
+    determine the correct virtual host to serve.  Therefore you need to
+    have a separate IP address for each host.  With name-based virtual
+    hosting, the server relies on the client to report the hostname as
+    part of the HTTP headers.  Using this technique, many different hosts
+    can share the same IP address.</p>
+
+    <p>Name-based virtual hosting is usually simpler, since you need
+    only configure your DNS server to map each hostname to the correct
+    IP address and then configure the Apache HTTP Server to recognize
+    the different hostnames.  Name-based virtual hosting also eases
+    the demand for scarce IP addresses.  Therefore you should use
+    name-based virtual hosting unless there is a specific reason to
+    choose IP-based virtual hosting.  Some reasons why you might consider
+    using IP-based virtual hosting:</p>
+
+    <ul>
+        <li>Some ancient clients are not compatible with name-based virtual
+        hosting.  For name-based virtual hosting to work, the client must send
+        the HTTP Host header.  This is required by HTTP/1.1, and is
+        implemented by all modern HTTP/1.0 browsers as an extension.  If you
+        need to support obsolete clients and still use name-based virtual
+        hosting, a possible technique is discussed at the end of this
+        document.</li>
+
+        <li>Name-based virtual hosting cannot be used with SSL secure servers
+        because of the nature of the SSL protocol.</li>
+
+        <li>Some operating systems and network equipment implement bandwidth
+        management techniques that cannot differentiate between hosts unless
+        they are on separate IP addresses.</li>
+    </ul>
 
 </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="using" id="using">Using Name-based Virtual Hosts</a></h2>
 
 <table class="related"><tr><th>Related Modules</th><th>Related Directives</th></tr><tr><td><ul><li><code class="module"><a href="../mod/core.html">core</a></code></li></ul></td><td><ul><li><code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code></li><li><code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code></li><li><code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code></li><li><code class="directive"><a href="../mod/core.html#servername">ServerName</a></code></li><li><code class="directive"><a href="../mod/core.html#serverpath">ServerPath</a></code></li><li><code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code></li></ul></td></tr></table>
 
-	<p>To use name-based virtual hosting, you must designate the IP
-	address (and possibly port) on the server that will be accepting
-	requests for the hosts.  This is configured using the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive.
-	In the normal case where any and all IP addresses on the server should
-	be used, you can use <code>*</code> as the argument to
-  <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>.  Note that mentioning an
-  IP address in a	<code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive
-  does not automatically make the	server listen to that IP address.  See 
-  <a href="../bind.html">Setting which addresses and ports Apache uses</a> 
-  for more details.  In addition,	any IP address specified here must be 
-  associated with a network interface
-	on the server.</p>
-
-	<p>The next step is to create a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block for
-	each different host that you would like to serve.  The argument to the
-  <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> directive 
-  should be the same as the argument to the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive (ie, an IP address, 
-  or <code>*</code> for all addresses).  Inside each <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block, you will need at minimum a
-	<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> directive to
-	designate which host is served and a <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> directive to
-	show where in the filesystem the content for that host lives.</p>
+    <p>To use name-based virtual hosting, you must designate the IP
+    address (and possibly port) on the server that will be accepting
+    requests for the hosts.  This is configured using the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive.
+    In the normal case where any and all IP addresses on the server should
+    be used, you can use <code>*</code> as the argument to <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>. If you're planning to use
+    multiple ports (e.g. running SSL) you should add a Port to the argument,
+    such as <code>*:80</code>. Note that mentioning an IP address in a
+    <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive does not
+    automatically make the server listen to that IP address. See
+    <a href="../bind.html">Setting which addresses and ports Apache uses</a>
+    for more details. In addition, any IP address specified here must be
+    associated with a network interface	on the server.</p>
+
+    <p>The next step is to create a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block for
+    each different host that you would like to serve. The argument to the
+    <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> directive
+    should be the same as the argument to the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> directive (ie, an IP address,
+    or <code>*</code> for all addresses).  Inside each <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block, you will need at minimum a
+    <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> directive to designate
+    which host is served and a <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>
+    directive to show where in the filesystem the content for that host
+    lives.</p>
 
     <div class="note"><h3>Main host goes away</h3>
-	If you are adding virtual hosts to an existing web server, you
-	must also create a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block for the existing host.
-  The <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> and 
-  <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> included in this virtual 
-  host should be the same as the global	<code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> and <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>.  List this	virtual host first in 
-  the configuration file so that it will act as	the default host.
+        <p>If you are adding virtual hosts to an existing web server, you
+        must also create a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block for the existing host. The <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> and <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> included in this virtual host should be the
+        same as the global <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> and
+        <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>. List this virtual
+        host first in the configuration file so that it will act as the default
+        host.</p>
     </div>
 
-	<p>For example, suppose that you are serving the domain
-	<code>www.domain.tld</code> and you wish to add the virtual host
-	<code>www.otherdomain.tld</code>, which points at the same IP address.
-	Then you simply add the following to <code>httpd.conf</code>:</p>
-
-	<div class="example"><p><code>
-    NameVirtualHost *<br />
-    <br />
-    &lt;VirtualHost *&gt;<br />
-    <span class="indent">
-    ServerName www.domain.tld<br />
-    ServerAlias domain.tld *.domain.tld<br />
-    DocumentRoot /www/domain<br />
-    </span>
-    &lt;/VirtualHost&gt;<br />
-    <br />
-    &lt;VirtualHost *&gt;<br />
-    <span class="indent">ServerName www.otherdomain.tld<br />
-    DocumentRoot /www/otherdomain<br />
-    </span>
-    &lt;/VirtualHost&gt;<br />
-	</code></p></div>
-
-	<p>You can alternatively specify an explicit IP address in place of
-  the <code>*</code> in both the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> and <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> directives. 
-  For example, you might want to do this in order to run some name-based virtual 
-  hosts on one IP address, and either IP-based, or another set of name-based
-  virtual hosts on another address.</p>
-
-	<p>Many servers want to be accessible by more than one name.  This is
-	possible with the <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>
-	directive, placed inside the <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> section. For
-  example in the first <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block above, the <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code> directive indicates that the
-  listed names are other names which people can use to see that same
-  web site:</p>
-
-	<div class="example"><p><code>
-    ServerAlias domain.tld *.domain.tld
-	</code></p></div>
-
-	<p>then requests for all hosts in the <code>domain.tld</code> domain
-	will be served by the <code>www.domain.tld</code> virtual host.  The
-  wildcard characters <code>*</code> and <code>?</code> can be used to match 
-  names.  Of course, you can't just make up names and place them in <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> or <code>ServerAlias</code>.  
-  You must first have your DNS server	properly configured to map those names 
-  to an IP address associated	with your server.</p>
-
-	<p>Finally, you can fine-tune the configuration of the virtual hosts
-	by placing other directives inside the
-  <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> containers.  
-  Most directives can be placed in these containers and will then change the 
-  configuration only of the relevant virtual host.  To find out if a particular 
-  directive	is allowed, check the <a href="../mod/directive-dict.html#Context">Context</a> of the
-	directive.  Configuration directives set in the <em>main server
-  context</em> (outside any <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> container) will be used only if they 
-  are not overridden by the virtual host settings.</p>
-
-	<p>Now when a request arrives, the server will first check if it is
-  using an IP address that matches the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>.  If it is, then it will look at
-  each <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>	
-  section with a matching IP address and try to find one where the	
-  <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> or 
-  <code>ServerAlias</code> matches the requested hostname.  If it finds one, 
-  then it uses the configuration for that server. If no matching virtual host 
-  is found, then	<strong>the first listed virtual host</strong> that matches 
-  the IP address will be used.</p>
-
-	<p>As a consequence, the first listed virtual host is the
-  <em>default</em> virtual host.  The <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> from the
-	<em>main server</em> will <strong>never</strong> be used when an IP
-  address matches the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> 
-  directive.  If you would like to have a special configuration for requests 
-  that do not	match any particular virtual host, simply put that configuration 
-  in a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> 
-  container and list it first in the configuration file.</p>
+    <p>For example, suppose that you are serving the domain
+    <code>www.domain.tld</code> and you wish to add the virtual host
+    <code>www.otherdomain.tld</code>, which points at the same IP address.
+    Then you simply add the following to <code>httpd.conf</code>:</p>
+
+    <div class="example"><p><code>
+        NameVirtualHost *:80<br />
+        <br />
+        &lt;VirtualHost *:80&gt;<br />
+        <span class="indent">
+            ServerName www.domain.tld<br />
+            ServerAlias domain.tld *.domain.tld<br />
+            DocumentRoot /www/domain<br />
+        </span>
+        &lt;/VirtualHost&gt;<br />
+        <br />
+        &lt;VirtualHost *:80&gt;<br />
+        <span class="indent">ServerName www.otherdomain.tld<br />
+            DocumentRoot /www/otherdomain<br />
+        </span>
+        &lt;/VirtualHost&gt;<br />
+    </code></p></div>
+
+    <p>You can alternatively specify an explicit IP address in place of the
+    <code>*</code> in both the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> and <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> directives. For example, you might want to do this
+    in order to run some name-based virtual hosts on one IP address, and either
+    IP-based, or another set of name-based virtual hosts on another address.</p>
+
+    <p>Many servers want to be accessible by more than one name. This is
+    possible with the <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>
+    directive, placed inside the <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> section. For example in the first <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> block above, the
+    <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code> directive indicates that
+    the listed names are other names which people can use to see that same
+    web site:</p>
+
+    <div class="example"><p><code>
+        ServerAlias domain.tld *.domain.tld
+    </code></p></div>
+
+    <p>then requests for all hosts in the <code>domain.tld</code> domain will
+    be served by the <code>www.domain.tld</code> virtual host. The wildcard
+    characters <code>*</code> and <code>?</code> can be used to match names.
+    Of course, you can't just make up names and place them in <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> or <code>ServerAlias</code>. You must
+    first have your DNS server properly configured to map those names to an IP
+    address associated with your server.</p>
+
+    <p>Finally, you can fine-tune the configuration of the virtual hosts
+    by placing other directives inside the <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> containers. Most directives can be
+    placed in these containers and will then change the configuration only of
+    the relevant virtual host. To find out if a particular directive is allowed,
+    check the <a href="../mod/directive-dict.html#Context">Context</a> of the
+    directive. Configuration directives set in the <em>main server context</em>
+    (outside any <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    container) will be used only if they are not overridden by the virtual host
+    settings.</p>
+
+    <p>Now when a request arrives, the server will first check if it is using
+    an IP address that matches the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>. If it is, then it will look at each <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> section with a matching
+    IP address and try to find one where the <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> or <code>ServerAlias</code> matches the requested
+    hostname. If it finds one, then it uses the configuration for that server.
+    If no matching virtual host  is found, then <strong>the first listed virtual
+    host</strong> that matches the IP address will be used.</p>
+
+    <p>As a consequence, the first listed virtual host is the <em>default</em>
+    virtual host.  The <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> from
+    the <em>main server</em> will <strong>never</strong> be used when an IP
+    address matches the <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> 
+    directive. If you would like to have a special configuration for requests 
+    that do not	match any particular virtual host, simply put that configuration
+    in a <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    container and list it first in the configuration file.</p>
 
 </div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
 <div class="section">
 <h2><a name="compat" id="compat">Compatibility with Older Browsers</a></h2>
 
     <p>As mentioned earlier, there are some clients
@@ -202,22 +197,22 @@
     <p>There is a possible workaround with the <code class="directive"><a href="../mod/core.html#serverpath">ServerPath</a></code>
     directive, albeit a slightly cumbersome one:</p>
 
     <p>Example configuration:</p>
 
     <div class="example"><p><code>
-    NameVirtualHost 111.22.33.44<br />
-    <br />
-    &lt;VirtualHost 111.22.33.44&gt;<br />
-    <span class="indent">
-    ServerName www.domain.tld<br />
-    ServerPath /domain<br />
-    DocumentRoot /web/domain<br />
-    </span>
-    &lt;/VirtualHost&gt;<br />
- 	  </code></p></div>
+        NameVirtualHost 111.22.33.44<br />
+        <br />
+        &lt;VirtualHost 111.22.33.44&gt;<br />
+        <span class="indent">
+            ServerName www.domain.tld<br />
+            ServerPath /domain<br />
+            DocumentRoot /web/domain<br />
+        </span>
+        &lt;/VirtualHost&gt;<br />
+    </code></p></div>
 
     <p>What does this mean? It means that a request for any URI
     beginning with "<code>/domain</code>" will be served from the
     virtual host <code>www.domain.tld</code>. This means that the
     pages can be accessed as <code>http://www.domain.tld/domain/</code> 
     for all clients, although clients sending a <code>Host:</code> header 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.html.ja.jis	2003-04-23 23:04:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.html.ja.jis	2003-10-11 07:24:05.000000000 +0800
@@ -1,60 +1,56 @@
 <?xml version="1.0" encoding="iso-2022-jp"?>
-<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
-    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
-  <head>
-    <title>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H(B</title>
-  </head>
-  <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
-  <!-- English revision: 1.17 -->
-  <body bgcolor="#ffffff" text="#000000" link="#0000ff"
-  vlink="#000080" alink="#ff0000">
-        <div align="center">
-      <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
-
-      <h3>Apache HTTP Server Version 2.0</h3>
-    </div>
-
-
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head><!--
+        XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
+              This file is generated from xml source: DO NOT EDIT
+        XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
+      -->
+<title>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H(B - Apache HTTP $B%5!<%P(B</title>
+<link href="../style/css/manual.css" rel="stylesheet" media="all" type="text/css" title="Main stylesheet" />
+<link href="../style/css/manual-loose-100pc.css" rel="alternate stylesheet" media="all" type="text/css" title="No Sidebar - Default font size" />
+<link href="../style/css/manual-print.css" rel="stylesheet" media="print" type="text/css" />
+<link href="../images/favicon.ico" rel="shortcut icon" /></head>
+<body id="manual-page"><div id="page-header">
+<p class="menu"><a href="../mod/">$B%b%8%e!<%k(B</a> | <a href="../mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">$BMQ8l(B</a> | <a href="../sitemap.html">$B%5%$%H%^%C%W(B</a></p>
+<p class="apache">Apache HTTP $B%5!<%P(B $B%P!<%8%g%s(B 2.0</p>
+<img alt="" src="../images/feather.gif" /></div>
+<div class="up"><a href="./"><img title="&lt;-" alt="&lt;-" src="../images/left.gif" /></a></div>
+<div id="path">
+<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://httpd.apache.org/">HTTP $B%5!<%P(B</a> &gt; <a href="http://httpd.apache.org/docs-project/">$B%I%-%e%a%s%F!<%7%g%s(B</a> &gt; <a href="../">$B%P!<%8%g%s(B 2.0</a> &gt; <a href="./">$B%P!<%A%c%k%[%9%H(B</a></div><div id="page-content"><div id="preamble"><h1>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H(B</h1>
+<div class="toplang">
+<p><span>Available Languages: </span><a href="../de/vhosts/name-based.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
+<a href="../en/vhosts/name-based.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
+<a href="../ja/vhosts/name-based.html" title="Japanese">&nbsp;ja&nbsp;</a> |
+<a href="../ko/vhosts/name-based.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+</div>
 
 
     <p>$B$3$NJ8=q$G$OL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$r$I$s$J$H$-!"(B
-    $B$^$?$I$&$d$C$F;H$&$N$+$H$$$&$3$H$r@bL@$7$^$9!#(B</p>
-
-    <ul>
-      <li><a href="#namevip">$BL>A0%Y!<%9(B $B$H(B IP-based
-      $B$N%P!<%A%c%k%[%9%H$NHf3S(B</a></li>
-
-      <li><a href="#using">$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$rMxMQ$9$k(B</a></li>
-
-      <li><a href="#compat">$B8E$$%V%i%&%6$H$N8_49@-(B</a></li>
-    </ul>
+    $B$I$&$d$C$F;H$&$+$r@bL@$7$^$9!#(B</p>
 
-    <p>$B;29M(B: <a href="examples.html">$BI8=`E*$J%;%C%H%"%C%W$G$N(B
-    $B%P!<%A%c%k%[%9%H$NNc(B</a>$B!"(B <a href="ip-based.html">IP $B%Y!<%9$N(B
-    $B%P!<%A%c%k%[%9%H$N%5%]!<%H(B</a>$B!"(B <a href="details.html">
-    $B%P!<%A%c%k%[%9%H$N%^%C%A%s%0$N6qBNE*$J>\:Y(B</a> $B$H(B <a
-    href="mass.html">$BBgNL$N%P!<%A%c%k%[%9%H$rF0E*$K@_Dj$9$k(B</a>
-    </p>
-    <hr />
-
-    <h2><a id="namevip" name="namevip"
-    >$BL>A0%Y!<%9$H(B IP $B%Y!<%9$N%P!<%A%c%k%[%9%H$NHf3S(B</a></h2>
-
-    <p>$B=i4|$N%P!<%8%g%s$N(B HTTP $B$G$O(B ($BB>$NB?$/$N%W%m%H%3%k!"Nc$($P(B FTP
-    $B$HF1MM(B) $B0l$D$N%5!<%P>e$G$N%P!<%A%c%k%[%9%H$4$H$K0[$J$C$?(B IP
-    $B%"%I%l%9$,I,MW$G$7$?!#$$$/$D$+$N%W%i%C%H%U%)!<%`$G$O!"$3$N$3$H$,(B
-    $B<B9T2DG=$J%P!<%A%c%k%[%9%H$N?t$r8BDj$7$F$7$^$&$3$H$K$J$j$^$7$?!#(B
-    $B$^$?!"(BIP $B%"%I%l%9$N?t$K$O8B$j$,$"$k$H$$$&$3$H$K$D$$$F$N7|G0$+$i!"(B
-    $B%l%8%9%H%i(B (ARIN, RIPE, APNIC) $B$O%P!<%A%c%k%[%9%H$4$H$K(B
-    IP $B$r3d$jEv$F$k$h$&$J$3$H$OHr$1$k$h$&6/$/MW@A$7$F$$$^$9!#(B</p>
+</div>
+<div id="quickview"><ul id="toc"><li><img alt="" src="../images/down.gif" /> <a href="#namevip">$BL>A0%Y!<%9$H(B IP $B%Y!<%9$N%P!<%A%c%k%[%9%H$NHf3S(B</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#using">$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$rMxMQ$9$k(B</a></li>
+<li><img alt="" src="../images/down.gif" /> <a href="#compat">$B8E$$%V%i%&%6$H$N8_49@-(B</a></li>
+</ul><h3>$B;2>H(B</h3><ul class="seealso"><li><a href="ip-based.html">$B%M!<%`%Y!<%9$N%P!<%A%c%k%[%9%H(B</a></li><li><a href="details.html">$B%P!<%A%c%k%[%9%H$N%^%C%A%s%0$K$D$$$F$N>\:Y(B</a></li><li><a href="mass.html">$BBgNL$N%P!<%A%c%k%[%9%H$NF0E*$J@_Dj(B</a></li><li><a href="examples.html">$B%P!<%A%c%k%[%9%H$N0lHLE*$J@_DjNc(B</a></li><li><a href="examples.html#serverpath">ServerPath $B@_DjNc(B</a></li></ul></div>
+<div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="namevip" id="namevip">$BL>A0%Y!<%9$H(B IP $B%Y!<%9$N%P!<%A%c%k%[%9%H$NHf3S(B</a></h2>
+
+    <p>IP $B%Y!<%9$N%P!<%A%c%k%[%9%H$G$O!"1~Ez$9$k(B
+    $B%P!<%A%c%k%[%9%H$X$N%3%M%/%7%g%s$r7hDj$9$k$?$a$K(B IP
+    $B%"%I%l%9$r;HMQ$7$^$9!#$G$9$+$i!"$=$l$>$l$N%[%9%H$K8D!9$K(B IP
+    $B%"%I%l%9$,I,MW$K$J$j$^$9!#$3$l$KBP$7$FL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$G$O!"(B
+    $B%/%i%$%"%s%H$,(B HTTP $B%X%C%@$N0lIt$H$7$F%[%9%HL>$r9p$2$k!"(B
+    $B$H$$$&$3$H$K0MB8$7$^$9!#$3$N5;=Q$GF10l(B IP 
+    $B%"%I%l%9$r0[$J$kB??t$N%[%9%H$G6&M-$7$F$$$^$9!#(B</p>
 
     <p>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$ODL>oC1=c$G!"$=$l$>$l$N%[%9%HL>$H(B
     $B$=$l$KBP1~$9$k@53N$J(B IP $B%"%I%l%9$r(B DNS $B$G@_Dj$7!"0[$J$k(B
-    $B%[%9%HL>$r6hJL=PMh$k$h$&$K(B Apache HTTP $B%5!<%P$r@_Dj$9$k$@$1$G$9!#(B
+    $B%[%9%HL>$r6hJL$9$k$h$&$K(B Apache HTTP $B%5!<%P$r@_Dj$9$k$@$1$G$9!#(B
     $B$5$i$K!"L>A0%Y!<%9$N%P!<%A%c%k%[%9%H$OITB-$9$k(B IP
     $B%"%I%l%9$N<{MW$r4KOB$7$^$9!#$7$?$,$C$F!"(BIP $B%Y!<%9$N%P!<%A%c%k%[%9%H$r(B
     $BA*Br$9$Y$-FCDj$NM}M3$,$J$1$l$PL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$r;H$&$Y$-$G$9!#(B
     IP $B%Y!<%9$N%P!<%A%c%k%[%9%H$r;HMQ$9$k$3$H$r9MN8$9$kM}M3$H$7$F!"(B</p>
 
     <ul> 
@@ -64,177 +60,206 @@
       $B$3$l$O(B HTTP/1.1 $B$N;EMM$GMW5a$5$l$F$$$F!"$9$Y$F$N8=BeE*$J(B
       HTTP/1.0 $B%V%i%&%6$G$b3HD%$H$7$F<BAu$5$l$F$$$^$9!#(B
       $B$H$F$b8E$$%/%i%$%"%s%H$r%5%]!<%H$7$D$D!"L>A0%Y!<%9$N(B
       $B%P!<%A%c%k%[%9%H$r9T$$$?$$>l9g$O!"$3$NJ8=q$N:G8e$NJ}$K(B
       $B=q$+$l$F$$$k2r7h:v$K$J$k$+$b$7$l$J$$J}K!$r8+$F$/$@$5$$!#(B</li>
 
-      <li>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$O(B SSL $B%W%m%H%3%k$NFCD'$K$h$j!"(B
+      <li>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$O(B SSL $B%W%m%H%3%k$NFC(B$BD'$K$h$j!"(B
       SSL $B%;%-%e%"%5!<%P$K$O;H$($^$;$s!#(B</li>
 
       <li>$B%*%Z%l!<%F%#%s%0%7%9%F%`$d%M%C%H%o!<%/AuCV$N$J$+$K$O!"(B
       $BJL$N(B IP $B%"%I%l%9>e$G$J$$>l9g!"J#?t$N%[%9%H$rJL07$$$G$-$J$$$h$&$J(B
       $BBS0h4IM}$NJ}K!$r<BAu$7$F$$$k$b$N$,$"$j$^$9!#(B</li>
     </ul>
 
-    <h2><a id="using"
-    name="using">$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$rMxMQ$9$k(B</a></h2>
+</div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="using" id="using">$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$rMxMQ$9$k(B</a></h2>
 
-    <table border="1">
-      <tr>
-        <td valign="top"><strong>$B4XO"%G%#%l%/%F%#%V(B</strong><br />
-         <br />
-         <a href="../mod/core.html#documentroot">DocumentRoot</a><br />
-         <a
-         href="../mod/core.html#namevirtualhost">NameVirtualHost</a><br />
-         <a href="../mod/core.html#serveralias">ServerAlias</a><br />
-         <a href="../mod/core.html#servername">ServerName</a><br />
-         <a href="../mod/core.html#serverpath">ServerPath</a><br />
-         <a href="../mod/core.html#virtualhost">VirtualHost</a><br />
-        </td>
-      </tr>
-    </table>
+<table class="related"><tr><th>$B4XO"%b%8%e!<%k(B</th><th>$B4XO"%G%#%l%/%F%#%V(B</th></tr><tr><td><ul><li><code class="module"><a href="../mod/core.html">core</a></code></li></ul></td><td><ul><li><code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code></li><li><code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code></li><li><code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code></li><li><code class="directive"><a href="../mod/core.html#servername">ServerName</a></code></li><li><code class="directive"><a href="../mod/core.html#serverpath">ServerPath</a></code></li><li><code class="directive"><a href="../mod/core.html#virtualhost">VirtualHost</a></code></li><li><code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code></li></ul></td></tr></table>
 
     <p>$BL>A0%Y!<%9$N%P!<%A%c%k%[%9%H$r;H$&$K$O!"$=$N%[%9%H$X$N(B
     $B%j%/%(%9%H$r<u$1IU$1$k%5!<%P$N(B IP $B%"%I%l%9(B ($B$b$7$+$7$?$i%]!<%H$b(B)
     $B$r;XDj$9$kI,MW$,$"$j$^$9!#(B
-    $B$3$l$O(B <a href="../mod/core.html#namevirtualhost">NameVirtualHost</a>
-    $B%G%#%l%/%F%#%V$G@_Dj$7$^$9!#DL>o!"(B<code>NameVirtualHost</code> $B$G(B
+    $B$3$l$O(B <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>
+    $B%G%#%l%/%F%#%V$G@_Dj$7$^$9!#DL>o!"(B<code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> $B$G(B
     <code>*</code> $B$NB0@-$r;H$C$F%5!<%P$NA4$F$N(B IP $B%"%I%l%9$r;H$$$^$9!#(B
-    <code>NameVirtualHost</code> $B%G%#%l%/%F%#%V$G(B IP $B%"%I%l%9$r=q$$$F$b!"(B
+    <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> $B%G%#%l%/%F%#%V$G(B
+    IP $B%"%I%l%9$r=q$$$F$b!"(B
     $B<+F0E*$K%5!<%P$,$=$N(B IP $B%"%I%l%9$r%j%C%9%s$9$k$H$$$&$3$H$O$J$$$3$H$K(B
-    $BCm0U$7$F$/$@$5$$!#>\:Y$O(B <a href="../bind.html">Apache $B$N;H$&%"%I%l%9$H(B
-    $B%]!<%H$r@_Dj$9$k(B</a> $B$rFI$s$G$/$@$5$$!#$5$i$K!"$3$3$G;XDj$5$l$?(B
+    $BCm0U$7$F$/$@$5$$!#>\:Y$O!V(B<a href="../bind.html">Apache $B$N;H$&%"%I%l%9$H(B
+    $B%]!<%H$r@_Dj$9$k(B</a>$B!W$rFI$s$G$/$@$5$$!#$5$i$K!"$3$3$G;XDj$5$l$?(B
     IP $B%"%I%l%9$OA4$F%5!<%P$N%M%C%H%o!<%/%$%s%?!<%U%'!<%9$H4XO"IU$1$i$l$F(B
     $B$$$J$1$l$P$J$j$^$;$s!#(B</p>
 
-    <p>$B<!$O!"07$$$?$$$=$l$>$l$N%[%9%H$KBP$7$F(B <a
-    href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a> $B%V%m%C%/$r(B
-    $B:n@.$7$F$/$@$5$$!#(B<code>&lt;VirtualHost&gt;</code> $B%G%#%l%/%F%#%V$N(B
-    $B0z?t$O(B <code>NameVirtualHost</code> $B%G%#%l%/%F%#%V$N0z?t$H(B
-    $BF1$8$K$7$F$/$@$5$$(B ($B$9$J$o$A!"(BIP $B%"%I%l%90l$D$dA4$F$N%"%I%l%9$N$?$a$N(B
-    <code>*</code>)$B!#$=$l$>$l$N(B <code>&lt;VirtualHost&gt;</code> $B%G%#%l%/%F%#%V(B
-    $B$NCf$K$O!":GDc8B!"$I$N%[%9%H$,07$o$l$k$+$r<($9(B <a
-    href="../mod/core.html#servername">ServerName</a> $B%G%#%l%/%F%#%V$H!"(B
+    <p>$B<!$O!"07$&%[%9%H$=$l$>$l$KBP$7$F(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> $B%V%m%C%/$r(B
+    $B:n@.$7$F$/$@$5$$!#(B<code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    $B%G%#%l%/%F%#%V$N0z?t$O(B <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>
+    $B%G%#%l%/%F%#%V$N0z?t$HF1$8$K$7$F$/$@$5$$(B ($B$9$J$o$A!"(BIP $B%"%I%l%9$+!"A4$F$N%"%I%l%9$r0UL#$9$k(B
+    <code>*</code>)$B!#$=$l$>$l$N(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    $B%G%#%l%/%F%#%V$NCf$K$O!":GDc8B!"$I$N%[%9%H$,07$o$l$k$+$r<($9(B <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> $B%G%#%l%/%F%#%V$H!"(B
     $B$=$N%[%9%HMQ$N%3%s%F%s%D$,%U%!%$%k%7%9%F%`>e$N$I$3$K$"$k$+$r<($9(B
-    <a href="../mod/core.html#documentroot">DocumentRoot</a> $B%G%#%l%/%F%#%V$r(B
+    <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> $B%G%#%l%/%F%#%V$r(B
     $B=q$/I,MW$,$"$j$^$9!#(B</p>
 
-    <p>$B$?$H$($P!"(B<samp>www.domain.tld</samp> $B$H(B
-    <samp>www.otherdomain.tld</samp> $B$NN>J}$,(B 1$B$D$N(B IP
-    $B%"%I%l%9$r;X$7$F$$$k$H$7$^$7$g$&!#$=$N$h$&$J>l9g$O!"(B
-    <code>httpd.conf</code> $B$K0J2<$N$h$&$J%3!<%I$rDI2C$9$k$@$1$G$9(B</p>
-<pre>
-    NameVirtualHost *
-
-    &lt;VirtualHost *&gt;
-    ServerName www.domain.tld
-    DocumentRoot /www/domain
-    &lt;/VirtualHost&gt;
-
-    &lt;VirtualHost *&gt;
-    ServerName www.otherdomain.tld
-    DocumentRoot /www/otherdomain
-    &lt;/VirtualHost&gt;
-</pre>
+    <div class="note"><h3>$B%a%$%s%[%9%H$O$J$/$J$j$^$9(B</h3>
+    <p>$B4{$K$"$k%&%'%V%5!<%P$K%P!<%A%c%k%[%9%H$rDI2C$9$k>l9g!"(B
+    $B4{B8$N%&%'%V%5!<%P$KBP$7$F$b(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    $B%V%m%C%/$r:n$i$J$1$l$P$J$j$^$;$s!#$3$N%P!<%A%c%k%[%9%H$N(B
+    <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> $B$H(B
+    <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>
+    $B$O!"%0%m!<%P%k$J(B <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> $B$H(B
+    <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code>
+    $B$HF1$8$b$N$K$7$^$9!#$^$?!"$3$N%P!<%A%c%k%[%9%H$r@_Dj%U%!%$%k$NCf$G(B
+    $B@hF,$KCV$$$F!"%G%U%)%k%H%[%9%H$H$7$FF0:n$9$k$h$&$K$7$^$9!#(B</p>
+    </div>
+
+    <p>$B$?$H$($P!"(B<code>www.domain.tld</code> $B$rF0$+$7$F$$$F!"(B
+    $B$5$i$K%P!<%A%c%k%[%9%H(B <code>www.otherdomain.tld</code>
+    $B$rDI2C$9$k$H$7$^$7$g$&!#$3$N%P!<%A%c%k%[%9%H$OF10l(B IP $B$r;X$7$F$$$k$H$7$^$9!#(B
+    $B$=$N$h$&$J>l9g$O!"(B<code>httpd.conf</code>
+    $B$K0J2<$N$h$&$J%3!<%I$rDI2C$9$k$@$1$G$9(B</p>
+
+    <div class="example"><p><code>
+    NameVirtualHost *<br />
+    <br />
+    &lt;VirtualHost *&gt;<br />
+    <span class="indent">
+    ServerName www.domain.tld<br />
+    DocumentRoot /www/domain<br />
+    </span>
+    &lt;/VirtualHost&gt;<br />
+    <br />
+    &lt;VirtualHost *&gt;<br />
+    <span class="indent">
+    ServerName www.otherdomain.tld<br />
+    DocumentRoot /www/otherdomain<br />
+    </span>
+    &lt;/VirtualHost&gt;<br />
+    </code></p></div>
 
-    <p><code>NameVirtualHost</code> $B5Z$S(B
-    <code>&lt;VirtualHost&gt;</code> $B$N$I$A$i$N>l9g$b!"(B
+    <p><code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code> $B5Z$S(B
+    <code class="directive"><a href="../mod/core.html#virtualhost">VirtualHost</a></code> $B$N$I$A$i$N>l9g$b!"(B
     * $B$NItJ,$K$OL@<(E*$K(B IP $B%"%I%l%9$r;XDj$9$k$3$H$,$G$-$^$9!#(B</p>
 
     <p>$BJ#?t$NL>A0$G%5!<%P%"%/%;%9$,$G$-$k$h$&$K$7$?$$$3$H$bB?$$$G$7$g$&!#(B
-    $B$3$N$h$&$J$3$H$O!"(B<a href="../mod/core.html#serveralias"
-    ><code>ServerAlias</code></a> $B%G%#%l%/%F%#%V$r(B &lt;VirtualHost&gt;
+    $B$3$N$h$&$J$3$H$O!"(B<code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code> $B%G%#%l%/%F%#%V$r(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
     $B%;%/%7%g%s$K5-=R$9$k$3$H$G<B8=$G$-$^$9!#(B
-    $BNc$($P$3$l$r:G=i$N(B &lt;VirtualHost&gt; $B%V%m%C%/$K=q$-2C$($k$H!"(B</p> 
-<pre>
+    $BNc$($P>e5-$N(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> $B$NNc$G$"$l$P!"(B
+    $B<!$N$h$&$K0lMw$K5s$2$i$l$?L>A0$,!"(B
+    $B%f!<%6$,F10l$N%&%'%V%5%$%H$H$7$FL\$K$7$F;HMQ$G$-$k%5!<%PL>$G$"$k!"(B
+    $B$H(B <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>
+    $B%G%#%l%/%F%#%V$G;XDj$G$-(B$B$^$9!#(B</p> 
+
+    <div class="example"><p><code>
     ServerAlias domain.tld *.domain.tld
-</pre>
+    </code></p></div>
 
     <p><code>domain.tld</code> $B%I%a%$%s$X$NA4$F$N%[%9%H$X$N%j%/%(%9%H$O(B
     <code>www.domain.tld</code> $B$N%P!<%A%c%k%[%9%H$,=hM}$7$^$9!#(B
-    * $B$d(B ? $B$r%o%$%k%I%+!<%IJ8;z$H$7$F;HMQ$G$-$^$9!#(B
-  Of course,you can't just make up names and place them in <code>ServerName</code>
-  or <code>ServerAlias</code>.
-    $BBh0l$K(B DNS $B$N%[%9%HL>$H(B IP $B%"%I%l%9$r%5!<%P$K$"$o$;$FE,@Z$K@_Dj$9$k;v$,I,MW$G$9(B</p>
-
-    <p>$B:G8e$K!"(B<code>&lt;VirtualHost&gt;</code> $B%3%s%F%J$NCf$K(B
-    $BB>$N%G%#%l%/%F%#%V$r=q$/$3$H$G!"%P!<%A%c%k%[%9%H$N@_Dj$r:Y$+$/JQ99(B
-    $B$9$k$3$H$,$G$-$^$9!#$I$N%G%#%l%/%F%#%V$r=q$/$3$H$,$G$-$k$+$O!"(B
-    $B%G%#%l%/%F%#%V$N(B <a
-    href="../mod/directive-dist.html#context">$B%3%s%F%-%9%H(B</a> $B$r(B
+    $BL>A0$r%^%C%A$5$;$k$?$a$K!"%o%$%k%I%+!<%IJ8;z(B * $B$d(B ? 
+    $B$r;HMQ$9$k$3$H$b$G$-$^$9!#$b$A$m$s;W$$$D$-$NL>A0$r:n$C$F!"(B
+    <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> $B$d(B 
+    <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code>
+    $B$K$=$NL>A0$r=q$/$H$$$C$?$3$H$O$G$-$^$;$s!#$^$:$O!"(B
+    $B$3$l$i$NL>A0$,(B $B%5!<%P$KIU$1$i$l$?(B IP $B%"%I%l%9$K%^%C%W$5$l$k$h$&$K(B
+    DNS $B%5!<%P$rE,@Z$K@_Dj$7$J$1$l$P$J$j$^$;$s!#(B</p>
+
+    <p>$B:G8e$K!"(B<code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code> $B%3%s%F%J$NCf$K(B
+    $BB>$N%G%#%l%/%F%#%V$r=q$/$3$H$G!"%P!<%A%c%k%[%9%H$N@_Dj$r:Y$+$/D4@0(B
+    $B$9$k$3$H$,$G$-$^$9!#(B
+    $B$[$H$s$I$N%G%#%l%/%F%#%V$O$3$l$i$N%3%s%F%J$K@_CV$9$k$3$H$,$G$-$F!"(B
+    $BJQ99E@$O$=$N%P!<%A%c%k%[%9%H$KBP$7$F$N$_M-8z$K$J$j$^$9!#(B
+    $B$I$N%G%#%l%/%F%#%V$r=q$/$3$H$,$G$-$k$+$O!"%G%#%l%/%F%#%V$N(B <a href="../mod/directive-dist.html#context">$B%3%s%F%-%9%H(B</a> $B$r(B
     $BD4$Y$F$/$@$5$$!#(B<em>$B<g%5!<%P%3%s%F%-%9%H(B</em>
-    (<code>&lt;VirtualHost&gt;</code> $B%3%s%F%J$N30(B) $B$N(B
-    $B@_DjMQ%G%#%l%/%F%#%V$O%P!<%A%c%k%[%9%H$G$N@_Dj$G>e=q$-$5$l$F$$$J$$(B
-    $B$H$-$N$_;HMQ$5$l$^$9!#(B</p>
+    (<code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    $B%3%s%F%J$N30(B) $B$N@_DjMQ%G%#%l%/%F%#%V$O%P!<%A%c%k%[%9%H$G$N@_Dj$G(B
+    $B>e=q$-$5$l$J$$>l9g$N$_;HMQ$5$l$^$9!#(B</p>
 
-    <p>$B%j%/%(%9%H$,Mh$k$H!"%5!<%P$O$^$::G=i$K(B <code>NameVirtualHost</code>
+    <p>$B%j%/%(%9%H$,Mh$k$H!"%5!<%P$O$^$::G=i$K(B <code class="directive"><a href="../mod/core.html#namevirtualhost">&lt;NameVirtualHost&gt;</a></code>
     $B$K%^%C%A$9$k(B IP $B%"%I%l%9$+$I$&$+$r%A%'%C%/$7$^$9!#%^%C%A$9$l$P(B
-    $B%^%C%A$7$?(B IP $B%"%I%l%9$N(B <code>&lt;VirtualHost&gt;</code>
-    $B$N$=$l$>$l$N%;%/%7%g%s$NCf$+$i(B <code>ServerName</code> $B$+(B
-    <code>ServerAlias</code> $B$KMW5a$5$l$?%[%9%HL>$,$"$k$+C5$7$^$9!#(B
+    $B%^%C%A$7$?(B IP $B%"%I%l%9$N(B <code class="directive"><a href="../mod/core.html#virtualhost">&lt;VirtualHost&gt;</a></code>
+    $B$N$=$l$>$l$N%;%/%7%g%s$NCf$+$i(B 
+    <code class="directive"><a href="../mod/core.html#servername">ServerName</a></code> $B$+(B
+    <code class="directive"><a href="../mod/core.html#serveralias">ServerAlias</a></code> 
+    $B$KMW5a$5$l$?%[%9%HL>$,$"$k$+C5$7$^$9!#(B
     $B8+$D$+$l$P$=$N%5!<%PMQ$N@_Dj$r;H$$$^$9!#%^%C%A$9$k%P!<%A%c%k%[%9%H(B
     $B$,8+$D$+$i$J$1$l$P!"%^%C%A$7$?(B IP $B%"%I%l%9$N(B 
     <strong>$B%j%9%H$N:G=i$K$"$k%P!<%A%c%k%[%9%H(B</strong> $B$,;H$o$l$^$9!#(B</p>
 
     <p>$B7k2L$H$7$F!"%j%9%H$N:G=i$N%P!<%A%c%k%[%9%H$,(B <em>$B%G%U%)%k%H(B</em> $B$N(B
-    $B%P!<%A%c%k%[%9%H$K$J$j$^$9!#(BIP $B%"%I%l%9$,(B <code>NameVirtualHost</code>
+    $B%P!<%A%c%k%[%9%H$K$J$j$^$9!#(BIP $B%"%I%l%9$,(B <code class="directive"><a href="../mod/core.html#namevirtualhost">NameVirtualHost</a></code>
     $B%G%#%l%/%F%#%V$K%^%C%A$7$?>l9g$O!"(B<em>$B%a%$%s$N%5!<%P(B</em> $B$N(B
-    <code>DocumentRoot</code> $B;H$o$l(B <strong>$B$^$;$s(B</strong>
+    <code class="directive"><a href="../mod/core.html#documentroot">DocumentRoot</a></code> 
+    $B$O(B<strong>$B7h$7$F;H$o$l$^$;$s(B</strong>
     $B$I$N%P!<%A%c%k%[%9%H$K$b%^%C%A$7$J$$%j%/%(%9%H$KBP$7$F!"(B
     $BFCJL$J@_Dj$r$7$?$$$N$G$"$l$P!"@_Dj%U%!%$%kCf$N:G=i$N(B
-    <code>&lt;VirtualHost&gt;</code> $B$K$=$l$r5-=R$7$F$/$@$5$$!#(B</p>
+    <code>&lt;VirtualHost&gt;</code> $B%3%s%F%J$K$=$l$r5-=R$7$F$/$@$5$$!#(B</p>
 
-    <h2><a id="compat" name="compat">$B8E$$%V%i%&%6$H$N8_49@-(B</a></h2>
+</div><div class="top"><a href="#page-header"><img alt="top" src="../images/up.gif" /></a></div>
+<div class="section">
+<h2><a name="compat" id="compat">$B8E$$%V%i%&%6$H$N8_49@-(B</a></h2>
 
-    <p>$B>e$G=q$$$?$h$&$K!"L>A0%Y!<%9$N%P!<%A%c%k%[%9%H$,@5$7$/F0:n$9$k(B
+    <p>$B0JA0=R$Y$?$h$&$K!"L>A0%Y!<%9$N%P!<%A%c%k%[%9%H$,@5$7$/F0:n$9$k(B
     $B$?$a$KI,MW$J>pJs$rAw$C$F$3$J$$%/%i%$%"%s%H$,0MA3$H$7$FB8:_$7$F$$$^$9!#(B
     $B$=$N$h$&$J%/%i%$%"%s%H$KBP$7$F$O!"3:Ev$9$k(B IP $B%"%I%l%9$K$D$$$F!"(B
     $B0lHV:G=i$K@_Dj$5$l$F$$$k%P!<%A%c%k%[%9%H(B
     (<cite>$B%W%i%$%^%j(B</cite>$B$NL>A0%Y!<%9$N%P!<%A%c%k%[%9%H(B)
     $B$+$i%Z!<%8$,Aw$jJV$5$l$^$9!#(B</p>
 
+    <div class="note"><h3>$B$I$N$0$i$$8E$$$N(B ?</h3>
+    <p>$B!V8E$$!W$HI=8=$7$F$$$k>l9g!"K\Ev$K8E$$$3$H$r0UL#$7$F;H$C$F$$$^$9!#(B
+    $BIT9,$K$7$F:#8=:_$G$b$3$N$h$&$J8E$$%V%i%&%6$KAx6x$9$k$3$H$,$"$j$^$9!#(B
+    $B8=:_$N%V%i%&%6$OA4$F!"L>A0%Y!<%9$N%P!<%A%c%k%[%9%H$KI,MW$J(B
+    <code>Host</code> $B%X%C%@$rAw$j$^$9!#(B</p>
+    </div>
+
     <p><a href="../mod/core.html#serverpath"><code>ServerPath</code></a>
     $B%G%#%l%/%F%#%V$GBP=h$,2DG=$G$9!#$A$g$C$HIT3J9%$G$9$1$l$I$b!#(B</p>
 
     <p>$B@_DjNc(B</p>
-<pre>
-    NameVirtualHost 111.22.33.44
 
-    &lt;VirtualHost 111.22.33.44&gt;
-    ServerName www.domain.tld
-    ServerPath /domain
-    DocumentRoot /web/domain
-    &lt;/VirtualHost&gt;
-</pre>
+    <div class="example"><p><code>
+    NameVirtualHost 111.22.33.44<br />
+    <br />
+    &lt;VirtualHost 111.22.33.44&gt;<br />
+    <span class="indent">
+    ServerName www.domain.tld<br />
+    ServerPath /domain<br />
+    DocumentRoot /web/domain<br />
+    </span>
+    &lt;/VirtualHost&gt;<br />
+    </code></p></div>
 
     <p>$B$3$NNc$K$O$I$&$$$&0UL#$,$"$k$G$7$g$&$+(B? $B$3$l$O(B
-    "<samp>/domain</samp>" $B$G;O$^$k(B URI $B$X$N%j%/%(%9%H$O$9$Y$F!"(B
-    $B%P!<%A%c%k%[%9%H(B <samp>www.domain.tld</samp> $B$G=hM}$5$l$k!"(B
+    "<code>/domain</code>" $B$G;O$^$k(B URI $B$X$N%j%/%(%9%H$O$9$Y$F!"(B
+    $B%P!<%A%c%k%[%9%H(B <code>www.domain.tld</code> $B$G=hM}$5$l$k!"(B
     $B$H$$$&0UL#$G$9!#$D$^$j!"$9$Y$F$N%/%i%$%"%s%H$G(B
     <code>http://www.domain.tld/domain/</code> $B$G%"%/%;%9$G$-$k%Z!<%8$,!"(B
-    <samp>Host:</samp> $B%X%C%@$rAw$C$F$/$k%/%i%$%"%s%H$G$"$l$P(B
+    <code>Host:</code> $B%X%C%@$rAw$C$F$/$k%/%i%$%"%s%H$G$"$l$P(B
     <code>http://www.domain.tld/</code> $B$H$7$F$b%"%/%;%9$G$-$k!"(B
     $B$H$$$&0UL#$G$9!#(B</p>
 
-    <p>$B$3$l$r<BMQE*$J$b$N$H$9$k$?$a$K$O!"(B
-    $B%W%i%$%^%j$N%P!<%A%c%k%[%9%H$N%Z!<%8$K(B
-    <samp>http://www.domain.tld/domain/</samp> $B$X$N%j%s%/$r@_CV$7$^$9!#(B
+    <p>$B$3$l$,F0:n$9$k$h$&$K$9$k$K$O!"(B
+    $B%W(B$B%i%$%^%j$N%P!<%A%c%k%[%9%H$N%Z!<%8$K(B
+    <code>http://www.domain.tld/domain/</code> $B$X$N%j%s%/$r@_CV$7$^$9!#(B
     $B$=$7$F!"%P!<%A%c%k%[%9%H$N%Z!<%8$G$O!"=c?h$JAjBP%j%s%/(B (<em>$BNc(B:</em>
-    "<samp>file.html</samp>" $B$d(B "<samp>../icons/image.gif</samp>")$B!"(B
-    $B$"$k$$$O(B <samp>/domain/</samp> $B$G;O$^$k%j%s%/(B (<em>$BNc(B:</em>
-    "<samp>http://www.domain.tld/domain/misc/file.html</samp>" $B$d(B
-    "<samp>/domain/misc/file.html</samp>") $B$@$1$r@_CV$7$^$9!#(B</p>
+    "<code>file.html</code>" $B$d(B "<code>../icons/image.gif</code>")$B!"(B
+    $B$"$k$$$O(B <code>/domain/</code> $B$G;O$^$k%j%s%/(B (<em>$BNc(B:</em>
+    "<code>http://www.domain.tld/domain/misc/file.html</code>" $B$d(B
+    "<code>/domain/misc/file.html</code>") $B$@$1$r@_CV$7$^$9!#(B</p>
 
     <p>$B$3$l$K$O!"4vJ,$+$N5,N'$,I,MW$H$J$j$^$9$,!"(B
     $B$3$N$h$&$J%,%$%I%i%$%s$rCi<B$K<i$k$3$H$K$h$j!"$?$$$F$$$N>l9g!"(B
     $B$9$Y$F$N%V%i%&%6$G(B $B!=(B $B?7$7$$%V%i%&%6$G$b8E$$$b$N$G$b(B $B!=(B
     $B:n@.$7$?%Z!<%8$,8+$($k$H$$$&$3$H$rJ]>Z$7$^$9!#(B</p>
 
-    <p>$B;29M(B: <a href="examples.html#serverpath">ServerPath $B@_DjNc(B</a></p>
-        <hr />
-
-    <h3 align="center">Apache HTTP Server Version 2.0</h3>
-    <a href="./"><img src="../images/index.gif" alt="Index" /></a>
-    <a href="../"><img src="../images/home.gif" alt="Home" /></a>
-
-  </body>
-</html>
+</div></div>
+<div class="bottomlang">
+<p><span>Available Languages: </span><a href="../de/vhosts/name-based.html" hreflang="de" rel="alternate" title="Deutsch">&nbsp;de&nbsp;</a> |
+<a href="../en/vhosts/name-based.html" hreflang="en" rel="alternate" title="English">&nbsp;en&nbsp;</a> |
+<a href="../ja/vhosts/name-based.html" title="Japanese">&nbsp;ja&nbsp;</a> |
+<a href="../ko/vhosts/name-based.html" hreflang="ko" rel="alternate" title="Korean">&nbsp;ko&nbsp;</a></p>
+</div><div id="footer">
+<p class="apache">Maintained by the <a href="http://httpd.apache.org/docs-project/">Apache HTTP Server Documentation Project</a></p>
+<p class="menu"><a href="../mod/">$B%b%8%e!<%k(B</a> | <a href="../mod/directives.html">$B%G%#%l%/%F%#%V(B</a> | <a href="../faq/">FAQ</a> | <a href="../glossary.html">$BMQ8l(B</a> | <a href="../sitemap.html">$B%5%$%H%^%C%W(B</a></p></div>
+</body></html>
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml	2003-06-04 03:36:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml	2003-10-11 07:14:34.000000000 +0800
@@ -4,57 +4,55 @@
 
 <manualpage metafile="name-based.xml.meta">
 <parentdocument href="./">Virtual Hosts</parentdocument>
 <title>Name-based Virtual Host Support</title>
 
 <summary>
-
-	<p>This document describes when and how to use name-based virtual hosts.</p>
-
+    <p>This document describes when and how to use name-based virtual hosts.</p>
 </summary>
 
 <seealso><a href="ip-based.html">IP-based Virtual Host Support</a></seealso>
 <seealso><a href="details.html">An In-Depth Discussion of Virtual Host Matching</a></seealso>
 <seealso><a href="mass.html">Dynamically configured mass virtual hosting</a></seealso>
 <seealso><a href="examples.html">Virtual Host examples for common setups</a></seealso>
 <seealso><a href="examples.html#serverpath">ServerPath configuration example</a></seealso>
 
 <section id="namevip"><title>Name-based vs. IP-based Virtual Hosts</title>
 
-	<p>IP-based virtual hosts use the IP address of the connection to
-	determine the correct virtual host to serve.  Therefore you need to
-	have a separate IP address for each host.  With name-based virtual
-	hosting, the server relies on the client to report the hostname as
-	part of the HTTP headers.  Using this technique, many different hosts
-	can share the same IP address.</p>
-
-	<p>Name-based virtual hosting is usually simpler, since you need
-	only configure your DNS server to map each hostname to the correct
-	IP address and then configure the Apache HTTP Server to recognize
-	the different hostnames.  Name-based virtual hosting also eases
-	the demand for scarce IP addresses.  Therefore you should use
-	name-based virtual hosting unless there is a specific reason to
-	choose IP-based virtual hosting.  Some reasons why you might consider
-	using IP-based virtual hosting:</p>
-
-	<ul>
-		<li>Some ancient clients are not compatible with name-based virtual
-		hosting.  For name-based virtual hosting to work, the client must send
-		the HTTP Host header.  This is required by HTTP/1.1, and is
-		implemented by all modern HTTP/1.0 browsers as an extension.  If you
-		need to support obsolete clients and still use name-based virtual
-		hosting, a possible technique is discussed at the end of this
-		document.</li>
-
-		<li>Name-based virtual hosting cannot be used with SSL secure servers
-		because of the nature of the SSL protocol.</li>
-
-		<li>Some operating systems and network equipment implement bandwidth
-		management techniques that cannot differentiate between hosts unless
-		they are on separate IP addresses.</li>
-	</ul>
+    <p>IP-based virtual hosts use the IP address of the connection to
+    determine the correct virtual host to serve.  Therefore you need to
+    have a separate IP address for each host.  With name-based virtual
+    hosting, the server relies on the client to report the hostname as
+    part of the HTTP headers.  Using this technique, many different hosts
+    can share the same IP address.</p>
+
+    <p>Name-based virtual hosting is usually simpler, since you need
+    only configure your DNS server to map each hostname to the correct
+    IP address and then configure the Apache HTTP Server to recognize
+    the different hostnames.  Name-based virtual hosting also eases
+    the demand for scarce IP addresses.  Therefore you should use
+    name-based virtual hosting unless there is a specific reason to
+    choose IP-based virtual hosting.  Some reasons why you might consider
+    using IP-based virtual hosting:</p>
+
+    <ul>
+        <li>Some ancient clients are not compatible with name-based virtual
+        hosting.  For name-based virtual hosting to work, the client must send
+        the HTTP Host header.  This is required by HTTP/1.1, and is
+        implemented by all modern HTTP/1.0 browsers as an extension.  If you
+        need to support obsolete clients and still use name-based virtual
+        hosting, a possible technique is discussed at the end of this
+        document.</li>
+
+        <li>Name-based virtual hosting cannot be used with SSL secure servers
+        because of the nature of the SSL protocol.</li>
+
+        <li>Some operating systems and network equipment implement bandwidth
+        management techniques that cannot differentiate between hosts unless
+        they are on separate IP addresses.</li>
+    </ul>
 
 </section>
 
 <section id="using"><title>Using Name-based Virtual Hosts</title>
 
 <related>
@@ -69,136 +67,132 @@
 	<directive module="core">ServerName</directive>
 	<directive module="core">ServerPath</directive>
 	<directive module="core" type="section">VirtualHost</directive>
     </directivelist>
 </related>
 
-	<p>To use name-based virtual hosting, you must designate the IP
-	address (and possibly port) on the server that will be accepting
-	requests for the hosts.  This is configured using the <directive
-	module="core">NameVirtualHost</directive> directive.
-	In the normal case where any and all IP addresses on the server should
-	be used, you can use <code>*</code> as the argument to
-  <directive module="core">NameVirtualHost</directive>.  Note that mentioning an
-  IP address in a	<directive module="core">NameVirtualHost</directive> directive
-  does not automatically make the	server listen to that IP address.  See 
-  <a href="../bind.html">Setting which addresses and ports Apache uses</a> 
-  for more details.  In addition,	any IP address specified here must be 
-  associated with a network interface
-	on the server.</p>
-
-	<p>The next step is to create a <directive type="section"
-	module="core">VirtualHost</directive> block for
-	each different host that you would like to serve.  The argument to the
-  <directive type="section"	module="core">VirtualHost</directive> directive 
-  should be the same as the argument to the <directive
-  module="core">NameVirtualHost</directive> directive (ie, an IP address, 
-  or <code>*</code> for all addresses).  Inside each <directive type="section"	
-  module="core">VirtualHost</directive> block, you will need at minimum a
-	<directive module="core">ServerName</directive> directive to
-	designate which host is served and a <directive
-	module="core">DocumentRoot</directive> directive to
-	show where in the filesystem the content for that host lives.</p>
+    <p>To use name-based virtual hosting, you must designate the IP
+    address (and possibly port) on the server that will be accepting
+    requests for the hosts.  This is configured using the <directive
+    module="core">NameVirtualHost</directive> directive.
+    In the normal case where any and all IP addresses on the server should
+    be used, you can use <code>*</code> as the argument to <directive
+    module="core">NameVirtualHost</directive>. If you're planning to use
+    multiple ports (e.g. running SSL) you should add a Port to the argument,
+    such as <code>*:80</code>. Note that mentioning an IP address in a
+    <directive module="core">NameVirtualHost</directive> directive does not
+    automatically make the server listen to that IP address. See
+    <a href="../bind.html">Setting which addresses and ports Apache uses</a>
+    for more details. In addition, any IP address specified here must be
+    associated with a network interface	on the server.</p>
+
+    <p>The next step is to create a <directive type="section"
+    module="core">VirtualHost</directive> block for
+    each different host that you would like to serve. The argument to the
+    <directive type="section" module="core">VirtualHost</directive> directive
+    should be the same as the argument to the <directive
+    module="core">NameVirtualHost</directive> directive (ie, an IP address,
+    or <code>*</code> for all addresses).  Inside each <directive type="section"	
+    module="core">VirtualHost</directive> block, you will need at minimum a
+    <directive module="core">ServerName</directive> directive to designate
+    which host is served and a <directive module="core">DocumentRoot</directive>
+    directive to show where in the filesystem the content for that host
+    lives.</p>
 
     <note><title>Main host goes away</title>
-	If you are adding virtual hosts to an existing web server, you
-	must also create a <directive type="section"	
-  module="core">VirtualHost</directive> block for the existing host.
-  The <directive module="core">ServerName</directive> and 
-  <directive module="core">DocumentRoot</directive> included in this virtual 
-  host should be the same as the global	<directive 
-  module="core">ServerName</directive> and <directive 
-  module="core">DocumentRoot</directive>.  List this	virtual host first in 
-  the configuration file so that it will act as	the default host.
+        <p>If you are adding virtual hosts to an existing web server, you
+        must also create a <directive type="section" module="core"
+        >VirtualHost</directive> block for the existing host. The <directive
+        module="core">ServerName</directive> and <directive module="core"
+        >DocumentRoot</directive> included in this virtual host should be the
+        same as the global <directive module="core">ServerName</directive> and
+        <directive module="core">DocumentRoot</directive>. List this virtual
+        host first in the configuration file so that it will act as the default
+        host.</p>
     </note>
 
-	<p>For example, suppose that you are serving the domain
-	<code>www.domain.tld</code> and you wish to add the virtual host
-	<code>www.otherdomain.tld</code>, which points at the same IP address.
-	Then you simply add the following to <code>httpd.conf</code>:</p>
-
-	<example>
-    NameVirtualHost *<br />
-    <br />
-    &lt;VirtualHost *&gt;<br />
-    <indent>
-    ServerName www.domain.tld<br />
-    ServerAlias domain.tld *.domain.tld<br />
-    DocumentRoot /www/domain<br />
-    </indent>
-    &lt;/VirtualHost&gt;<br />
-    <br />
-    &lt;VirtualHost *&gt;<br />
-    <indent>ServerName www.otherdomain.tld<br />
-    DocumentRoot /www/otherdomain<br />
-    </indent>
-    &lt;/VirtualHost&gt;<br />
-	</example>
-
-	<p>You can alternatively specify an explicit IP address in place of
-  the <code>*</code> in both the <directive 
-  module="core">NameVirtualHost</directive> and <directive 
-  type="section"	module="core">VirtualHost</directive> directives. 
-  For example, you might want to do this in order to run some name-based virtual 
-  hosts on one IP address, and either IP-based, or another set of name-based
-  virtual hosts on another address.</p>
-
-	<p>Many servers want to be accessible by more than one name.  This is
-	possible with the <directive module="core">ServerAlias</directive>
-	directive, placed inside the <directive type="section"	
-  module="core">VirtualHost</directive> section. For
-  example in the first <directive type="section"	
-  module="core">VirtualHost</directive> block above, the <directive
-  module="core">ServerAlias</directive> directive indicates that the
-  listed names are other names which people can use to see that same
-  web site:</p>
-
-	<example>
-    ServerAlias domain.tld *.domain.tld
-	</example>
-
-	<p>then requests for all hosts in the <code>domain.tld</code> domain
-	will be served by the <code>www.domain.tld</code> virtual host.  The
-  wildcard characters <code>*</code> and <code>?</code> can be used to match 
-  names.  Of course, you can't just make up names and place them in <directive 
-  module="core">ServerName</directive> or <code>ServerAlias</code>.  
-  You must first have your DNS server	properly configured to map those names 
-  to an IP address associated	with your server.</p>
-
-	<p>Finally, you can fine-tune the configuration of the virtual hosts
-	by placing other directives inside the
-  <directive type="section"	module="core">VirtualHost</directive> containers.  
-  Most directives can be placed in these containers and will then change the 
-  configuration only of the relevant virtual host.  To find out if a particular 
-  directive	is allowed, check the <a
-	href="../mod/directive-dict.html#Context">Context</a> of the
-	directive.  Configuration directives set in the <em>main server
-  context</em> (outside any <directive type="section"	
-  module="core">VirtualHost</directive> container) will be used only if they 
-  are not overridden by the virtual host settings.</p>
-
-	<p>Now when a request arrives, the server will first check if it is
-  using an IP address that matches the <directive
-  module="core">NameVirtualHost</directive>.  If it is, then it will look at
-  each <directive type="section"	module="core">VirtualHost</directive>	
-  section with a matching IP address and try to find one where the	
-  <directive module="core">ServerName</directive> or 
-  <code>ServerAlias</code> matches the requested hostname.  If it finds one, 
-  then it uses the configuration for that server. If no matching virtual host 
-  is found, then	<strong>the first listed virtual host</strong> that matches 
-  the IP address will be used.</p>
-
-	<p>As a consequence, the first listed virtual host is the
-  <em>default</em> virtual host.  The <directive 
-  module="core">DocumentRoot</directive> from the
-	<em>main server</em> will <strong>never</strong> be used when an IP
-  address matches the <directive module="core">NameVirtualHost</directive> 
-  directive.  If you would like to have a special configuration for requests 
-  that do not	match any particular virtual host, simply put that configuration 
-  in a <directive type="section"	module="core">VirtualHost</directive> 
-  container and list it first in the configuration file.</p>
+    <p>For example, suppose that you are serving the domain
+    <code>www.domain.tld</code> and you wish to add the virtual host
+    <code>www.otherdomain.tld</code>, which points at the same IP address.
+    Then you simply add the following to <code>httpd.conf</code>:</p>
+
+    <example>
+        NameVirtualHost *:80<br />
+        <br />
+        &lt;VirtualHost *:80&gt;<br />
+        <indent>
+            ServerName www.domain.tld<br />
+            ServerAlias domain.tld *.domain.tld<br />
+            DocumentRoot /www/domain<br />
+        </indent>
+        &lt;/VirtualHost&gt;<br />
+        <br />
+        &lt;VirtualHost *:80&gt;<br />
+        <indent>ServerName www.otherdomain.tld<br />
+            DocumentRoot /www/otherdomain<br />
+        </indent>
+        &lt;/VirtualHost&gt;<br />
+    </example>
+
+    <p>You can alternatively specify an explicit IP address in place of the
+    <code>*</code> in both the <directive module="core"
+    >NameVirtualHost</directive> and <directive type="section" module="core"
+    >VirtualHost</directive> directives. For example, you might want to do this
+    in order to run some name-based virtual hosts on one IP address, and either
+    IP-based, or another set of name-based virtual hosts on another address.</p>
+
+    <p>Many servers want to be accessible by more than one name. This is
+    possible with the <directive module="core">ServerAlias</directive>
+    directive, placed inside the <directive type="section" module="core"
+    >VirtualHost</directive> section. For example in the first <directive
+    type="section" module="core">VirtualHost</directive> block above, the
+    <directive module="core">ServerAlias</directive> directive indicates that
+    the listed names are other names which people can use to see that same
+    web site:</p>
+
+    <example>
+        ServerAlias domain.tld *.domain.tld
+    </example>
+
+    <p>then requests for all hosts in the <code>domain.tld</code> domain will
+    be served by the <code>www.domain.tld</code> virtual host. The wildcard
+    characters <code>*</code> and <code>?</code> can be used to match names.
+    Of course, you can't just make up names and place them in <directive
+    module="core">ServerName</directive> or <code>ServerAlias</code>. You must
+    first have your DNS server properly configured to map those names to an IP
+    address associated with your server.</p>
+
+    <p>Finally, you can fine-tune the configuration of the virtual hosts
+    by placing other directives inside the <directive type="section"
+    module="core">VirtualHost</directive> containers. Most directives can be
+    placed in these containers and will then change the configuration only of
+    the relevant virtual host. To find out if a particular directive is allowed,
+    check the <a href="../mod/directive-dict.html#Context">Context</a> of the
+    directive. Configuration directives set in the <em>main server context</em>
+    (outside any <directive type="section" module="core">VirtualHost</directive>
+    container) will be used only if they are not overridden by the virtual host
+    settings.</p>
+
+    <p>Now when a request arrives, the server will first check if it is using
+    an IP address that matches the <directive module="core"
+    >NameVirtualHost</directive>. If it is, then it will look at each <directive
+    type="section" module="core">VirtualHost</directive> section with a matching
+    IP address and try to find one where the <directive module="core"
+    >ServerName</directive> or <code>ServerAlias</code> matches the requested
+    hostname. If it finds one, then it uses the configuration for that server.
+    If no matching virtual host  is found, then <strong>the first listed virtual
+    host</strong> that matches the IP address will be used.</p>
+
+    <p>As a consequence, the first listed virtual host is the <em>default</em>
+    virtual host.  The <directive module="core">DocumentRoot</directive> from
+    the <em>main server</em> will <strong>never</strong> be used when an IP
+    address matches the <directive module="core">NameVirtualHost</directive> 
+    directive. If you would like to have a special configuration for requests 
+    that do not	match any particular virtual host, simply put that configuration
+    in a <directive type="section" module="core">VirtualHost</directive>
+    container and list it first in the configuration file.</p>
 
 </section>
 
 <section id="compat"><title>Compatibility with Older Browsers</title>
 
     <p>As mentioned earlier, there are some clients
@@ -218,22 +212,22 @@
     module="core">ServerPath</directive>
     directive, albeit a slightly cumbersome one:</p>
 
     <p>Example configuration:</p>
 
     <example>
-    NameVirtualHost 111.22.33.44<br />
-    <br />
-    &lt;VirtualHost 111.22.33.44&gt;<br />
-    <indent>
-    ServerName www.domain.tld<br />
-    ServerPath /domain<br />
-    DocumentRoot /web/domain<br />
-    </indent>
-    &lt;/VirtualHost&gt;<br />
- 	  </example>
+        NameVirtualHost 111.22.33.44<br />
+        <br />
+        &lt;VirtualHost 111.22.33.44&gt;<br />
+        <indent>
+            ServerName www.domain.tld<br />
+            ServerPath /domain<br />
+            DocumentRoot /web/domain<br />
+        </indent>
+        &lt;/VirtualHost&gt;<br />
+    </example>
 
     <p>What does this mean? It means that a request for any URI
     beginning with "<code>/domain</code>" will be served from the
     virtual host <code>www.domain.tld</code>. This means that the
     pages can be accessed as <code>http://www.domain.tld/domain/</code> 
     for all clients, although clients sending a <code>Host:</code> header 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml.de /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml.de
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml.de	2003-06-04 04:08:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml.de	2003-08-14 05:26:42.000000000 +0800
@@ -1,13 +1,13 @@
 <?xml version='1.0' encoding='UTF-8' ?>
 <!DOCTYPE manualpage SYSTEM "../style/manualpage.dtd">
 <?xml-stylesheet type="text/xsl" href="../style/manual.de.xsl"?>
-<!-- English revision: 1.23.2.5 -->
+<!-- English revision: 1.5.2.5 -->
 
 <manualpage metafile="name-based.xml.meta">
-<parentdocument href="./">Virtual Hosts</parentdocument>
+  <parentdocument href="./">Virtuelle Hosts</parentdocument>
 <title>Unterst&uuml;tzung namensbasierter virtueller Hosts</title>
 
 <summary>
   <p>Das Dokument beschreibt, wann und wie namensbasierte virtuelle Hosts zu
     verwenden sind.</p>
 </summary>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts: name-based.xml.ja
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml.meta /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml.meta
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/docs/manual/vhosts/name-based.xml.meta	2003-06-04 04:08:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/docs/manual/vhosts/name-based.xml.meta	2003-10-11 07:24:05.000000000 +0800
@@ -5,10 +5,10 @@
   <path>/vhosts/</path>
   <relpath>..</relpath>
 
   <variants>
     <variant>de</variant>
     <variant>en</variant>
-    <variant htmlonly="yes">ja</variant>
+    <variant>ja</variant>
     <variant>ko</variant>
   </variants>
 </metafile>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/httpd.spec /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/httpd.spec
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/httpd.spec	2003-07-07 22:52:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/httpd.spec	2003-10-25 01:51:27.000000000 +0800
@@ -6,13 +6,13 @@
 # disable debuginfo on IA64
 %define debug_package %{nil}
 %endif
 
 Summary: Apache HTTP Server
 Name: httpd
-Version: 2.0.47
+Version: 2.0.48
 Release: 1
 URL: http://httpd.apache.org/
 Vendor: Apache Software Foundation
 Source0: http://www.apache.org/dist/httpd/httpd-%{version}.tar.gz
 License: Apache Software License
 Group: System Environment/Daemons
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/ap_release.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/ap_release.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/ap_release.h	2003-07-07 22:51:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/ap_release.h	2003-10-25 00:45:19.000000000 +0800
@@ -72,13 +72,13 @@
  * Example: "Apache/1.1.0 MrWidget/0.1-alpha" 
  */
 #define AP_SERVER_BASEVENDOR "Apache Software Foundation"
 #define AP_SERVER_BASEPRODUCT "Apache"
 #define AP_SERVER_MAJORVERSION "2"
 #define AP_SERVER_MINORVERSION "0"
-#define AP_SERVER_PATCHLEVEL "47"
+#define AP_SERVER_PATCHLEVEL "48"
 #define AP_SERVER_MINORREVISION AP_SERVER_MAJORVERSION "." AP_SERVER_MINORVERSION
 #define AP_SERVER_BASEREVISION  AP_SERVER_MINORREVISION "." AP_SERVER_PATCHLEVEL
 #define AP_SERVER_BASEVERSION AP_SERVER_BASEPRODUCT "/" AP_SERVER_BASEREVISION
 #define AP_SERVER_VERSION  AP_SERVER_BASEVERSION
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/httpd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/httpd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/httpd.h	2003-06-17 17:47:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/httpd.h	2003-10-25 00:19:31.000000000 +0800
@@ -318,12 +318,15 @@
 #define MAX_STRING_LEN HUGE_STRING_LEN
 #define HUGE_STRING_LEN 8192
 
 /** The size of the server's internal read-write buffers */
 #define AP_IOBUFSIZE 8192
 
+/** The max number of regex captures that can be expanded by ap_pregsub */
+#define AP_MAX_REG_MATCH 10
+
 /**
  * APR_HAS_LARGE_FILES introduces the problem of spliting sendfile into 
  * mutiple buckets, no greater than MAX(apr_size_t), and more granular 
  * than that in case the brigade code/filters attempt to read it directly.
  * ### 16mb is an invention, no idea if it is reasonable.
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/util_ebcdic.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/util_ebcdic.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/util_ebcdic.h	2003-02-04 01:31:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/util_ebcdic.h	2003-09-17 09:51:55.000000000 +0800
@@ -101,20 +101,20 @@
  * set to ASCII, then send it.
  * @param r   the current request
  * @param ... the strings to write, followed by a NULL pointer
  */
 int ap_rvputs_proto_in_ascii(request_rec *r, ...);
 
-#ifdef __cplusplus
-}
-#endif
-
 #else   /* APR_CHARSET_EBCDIC */
 
 #define ap_xlate_proto_to_ascii(x,y)          /* NOOP */
 #define ap_xlate_proto_from_ascii(x,y)        /* NOOP */
 
 #define ap_rvputs_proto_in_ascii  ap_rvputs
 
 #endif  /* APR_CHARSET_EBCDIC */
-    
+
+#ifdef __cplusplus
+}
+#endif
+
 #endif  /* !APACHE_UTIL_EBCDIC_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/util_filter.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/util_filter.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/include/util_filter.h	2003-06-15 13:33:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/include/util_filter.h	2003-08-23 04:40:59.000000000 +0800
@@ -247,13 +247,16 @@
  */
 struct ap_filter_rec_t {
     /** The registered name for this filter */
     const char *name;
     /** The function to call when this filter is invoked. */
     ap_filter_func filter_func;
-    /** The function to call before the handlers are invoked. */
+    /** The function to call before the handlers are invoked. Notice
+     * that this function is called only for filters participating in
+     * the http protocol. Filters for other protocols are to be
+     * initiliazed by the protocols themselves. */
     ap_init_filter_func filter_init_func;
     /** The type of filter, either AP_FTYPE_CONTENT or AP_FTYPE_CONNECTION.  
      * An AP_FTYPE_CONTENT filter modifies the data based on information 
      * found in the content.  An AP_FTYPE_CONNECTION filter modifies the 
      * data based on the type of connection.
      */
@@ -326,14 +329,16 @@
  * After this registration is performed, then a filter may be added 
  * into the filter chain by using ap_add_input_filter() and simply 
  * specifying the name.
  *
  * @param name The name to attach to the filter function
  * @param filter_func The filter function to name
- * @param ftype The type of filter function, either ::AP_FTYPE_CONTENT or ::
- *        AP_FTYPE_CONNECTION
+ * @param filter_init The function to call before the filter handlers 
+                      are invoked
+ * @param ftype The type of filter function, either ::AP_FTYPE_CONTENT or
+ *              ::AP_FTYPE_CONNECTION
  * @see add_input_filter()
  */
 AP_DECLARE(ap_filter_rec_t *) ap_register_input_filter(const char *name,
                                           ap_in_filter_func filter_func,
                                           ap_init_filter_func filter_init,
                                           ap_filter_type ftype);
@@ -342,12 +347,14 @@
  * After this registration is performed, then a filter may be added 
  * into the filter chain by using ap_add_output_filter() and simply 
  * specifying the name.
  *
  * @param name The name to attach to the filter function
  * @param filter_func The filter function to name
+ * @param filter_init The function to call before the filter handlers 
+ *                    are invoked
  * @param ftype The type of filter function, either ::AP_FTYPE_CONTENT or
  *              ::AP_FTYPE_CONNECTION
  * @see ap_add_output_filter()
  */
 AP_DECLARE(ap_filter_rec_t *) ap_register_output_filter(const char *name,
                                             ap_out_filter_func filter_func,
@@ -472,12 +479,14 @@
 
 /**
  * Flush function for apr_brigade_* calls.  This calls ap_pass_brigade
  * to flush the brigade if the brigade buffer overflows.
  * @param bb The brigade to flush
  * @param ctx The filter to pass the brigade to
+ * @note this function has nothing to do with FLUSH buckets. It is simply
+ * a way to flush content out of a brigade and down a filter stack.
  */
 AP_DECLARE_NONSTD(apr_status_t) ap_filter_flush(apr_bucket_brigade *bb,
                                                 void *ctx);
 
 /**
  * Flush the current brigade down the filter stack.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/Makefile.in	2003-05-18 01:11:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/Makefile.in	2003-08-25 08:12:06.000000000 +0800
@@ -92,13 +92,14 @@
 	@echo Installing build system files 
 	@test -d $(DESTDIR)$(installbuilddir) || $(MKINSTALLDIRS) $(DESTDIR)$(installbuilddir) 
 	@cp $(top_srcdir)/build/*.mk $(DESTDIR)$(installbuilddir); \
 	cp build/*.mk $(DESTDIR)$(installbuilddir); \
 	sed 's#LIBTOOL = \(.*\)#LIBTOOL = $(SHELL) $(installbuilddir)/libtool $(LTFLAGS)#' \
 	    build/config_vars.mk > $(DESTDIR)$(installbuilddir)/config_vars.mk; \
-	cp $(top_srcdir)/build/instdso.sh $(DESTDIR)$(installbuilddir);
+	cp $(top_srcdir)/build/instdso.sh $(DESTDIR)$(installbuilddir); \
+	cp $(top_builddir)/config.nice $(DESTDIR)$(installbuilddir);
 
 htdocs-srcdir = $(top_srcdir)/docs/docroot
 
 docs::
 	mkdir -p ./docs/api
 	srclib/apr/build/scandoc.pl -i./build/default.pl -p./docs/api/ ./include/*.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/arch/win32/mod_isapi.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/arch/win32/mod_isapi.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/arch/win32/mod_isapi.h	2003-02-04 01:31:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/arch/win32/mod_isapi.h	2003-07-31 03:20:53.000000000 +0800
@@ -71,13 +71,13 @@
     char         lpszExtensionDesc[256];
 } HSE_VERSION_INFO;
 
 /* The startup entry point that must be exported by every ISAPI handler
  */
 int APR_THREAD_FUNC GetExtensionVersion(HSE_VERSION_INFO *ver_info);
-typedef (APR_THREAD_FUNC *PFN_GETEXTENSIONVERSION)(HSE_VERSION_INFO *ver_info);
+typedef int (APR_THREAD_FUNC *PFN_GETEXTENSIONVERSION)(HSE_VERSION_INFO *ver_info);
 
 /* Our internal 'HCONN' representation, always opaque to the user.
  */
 typedef struct isapi_cid isapi_cid;
 typedef struct isapi_cid *HCONN;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/experimental/cache_util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/experimental/cache_util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/experimental/cache_util.c	2003-02-04 01:31:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/experimental/cache_util.c	2003-09-30 05:09:47.000000000 +0800
@@ -159,13 +159,14 @@
 }
 
 CACHE_DECLARE(int) ap_cache_check_freshness(cache_request_rec *cache, 
                                             request_rec *r)
 {
     apr_int64_t age, maxage_req, maxage_cresp, maxage, smaxage, maxstale, minfresh;
-    const char *cc_cresp, *cc_req, *pragma_cresp;
+    int age_in_errhdr = 0;
+    const char *cc_cresp, *cc_ceresp, *cc_req;
     const char *agestr = NULL;
     char *val;
     apr_time_t age_c = 0;
     cache_info *info = &(cache->handle->cache_obj->info);
 
     /*
@@ -198,37 +199,47 @@
      * 
      * - RFC2616 14.21 Expires: if this request header exists in the cached
      * entity, and it's value is in the past, it has expired.
      * 
      */
     cc_cresp = apr_table_get(r->headers_out, "Cache-Control");
+    cc_ceresp = apr_table_get(r->err_headers_out, "Cache-Control");
     cc_req = apr_table_get(r->headers_in, "Cache-Control");
-    /* TODO: pragma_cresp not being used? */
-    pragma_cresp = apr_table_get(r->headers_out, "Pragma");  
+    
     if ((agestr = apr_table_get(r->headers_out, "Age"))) {
         age_c = apr_atoi64(agestr);
     }
+    else if ((agestr = apr_table_get(r->err_headers_out, "Age"))) {
+        age_c = apr_atoi64(agestr);
+        age_in_errhdr = 1;
+    }
 
     /* calculate age of object */
     age = ap_cache_current_age(info, age_c, r->request_time);
 
     /* extract s-maxage */
     if (cc_cresp && ap_cache_liststr(r->pool, cc_cresp, "s-maxage", &val))
         smaxage = apr_atoi64(val);
+    else if (cc_ceresp && ap_cache_liststr(r->pool, cc_ceresp, "s-maxage", &val)) {
+        smaxage = apr_atoi64(val);
+    }
     else
         smaxage = -1;
 
     /* extract max-age from request */
     if (cc_req && ap_cache_liststr(r->pool, cc_req, "max-age", &val))
         maxage_req = apr_atoi64(val);
     else
         maxage_req = -1;
 
     /* extract max-age from response */
     if (cc_cresp && ap_cache_liststr(r->pool, cc_cresp, "max-age", &val))
         maxage_cresp = apr_atoi64(val);
+    else if (cc_ceresp && ap_cache_liststr(r->pool, cc_ceresp, "max-age", &val)) {
+        maxage_cresp = apr_atoi64(val);
+    }
     else
         maxage_cresp = -1;
 
     /*
      * if both maxage request and response, the smaller one takes priority
      */
@@ -250,35 +261,50 @@
         minfresh = apr_atoi64(val);
     else
         minfresh = 0;
 
     /* override maxstale if must-revalidate or proxy-revalidate */
     if (maxstale && ((cc_cresp &&
-                      ap_cache_liststr(NULL,
-                                       cc_cresp, "must-revalidate", NULL))
-                     || (cc_cresp && ap_cache_liststr(NULL,
-                                                      cc_cresp,
-                                                      "proxy-revalidate", NULL))))
+                      ap_cache_liststr(NULL, cc_cresp,
+                                       "must-revalidate", NULL)) ||
+                     (cc_cresp &&
+                      ap_cache_liststr(NULL, cc_cresp,
+                                       "proxy-revalidate", NULL)) ||
+                     (cc_ceresp &&
+                      ap_cache_liststr(NULL, cc_ceresp,
+                                       "must-revalidate", NULL)) ||
+                     (cc_ceresp &&
+                      ap_cache_liststr(NULL, cc_ceresp,
+                                       "proxy-revalidate", NULL)))) {
         maxstale = 0;
+    }
     /* handle expiration */
-    if ((-1 < smaxage && age < (smaxage - minfresh)) ||
-        (-1 < maxage && age < (maxage + maxstale - minfresh)) ||
-        (info->expire != APR_DATE_BAD && age < (apr_time_sec(info->expire - info->date) + maxstale - minfresh))) {
+    if (((smaxage != -1) && (age < (smaxage - minfresh))) ||
+        ((maxage != -1) && (age < (maxage + maxstale - minfresh))) ||
+        ((smaxage == -1) && (maxage == -1) &&
+         (info->expire != APR_DATE_BAD) &&
+         (age < (apr_time_sec(info->expire - info->date) + maxstale - minfresh)))) {
         /* it's fresh darlings... */
         /* set age header on response */
-        apr_table_set(r->headers_out, "Age",
-                      apr_psprintf(r->pool, "%lu", (unsigned long)age));
+        if (age_in_errhdr) {
+            apr_table_set(r->err_headers_out, "Age",
+                          apr_psprintf(r->pool, "%lu", (unsigned long)age));
+        }
+        else {
+            apr_table_set(r->headers_out, "Age",
+                          apr_psprintf(r->pool, "%lu", (unsigned long)age));
+        }
 
         /* add warning if maxstale overrode freshness calculation */
-        if (!((-1 < smaxage && age < smaxage) ||
-              (-1 < maxage && age < maxage) ||
+        if (!(((smaxage != -1) && age < smaxage) ||
+              ((maxage != -1) && age < maxage) ||
               (info->expire != APR_DATE_BAD && (info->expire - info->date) > age))) {
             /* make sure we don't stomp on a previous warning */
             apr_table_merge(r->headers_out, "Warning", "110 Response is stale");
         }
-        return 1;    /* Cache object is fresh */
+        return 1;    /* Cache object is fresh (enough) */
     }
     return 0;        /* Cache object is stale */
 }
 /* 
  * list is a comma-separated list of case-insensitive tokens, with
  * optional whitespace around the tokens.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/experimental/mod_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/experimental/mod_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/experimental/mod_cache.c	2003-05-16 01:51:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/experimental/mod_cache.c	2003-09-28 02:17:10.000000000 +0800
@@ -537,20 +537,20 @@
         /* if the server said 304 Not Modified but we have no cache
          * file - pass this untouched to the user agent, it's not for us.
          */
         reason = "HTTP Status 304 Not Modified";
     }
     else if (r->status == HTTP_OK && lastmods == NULL && etag == NULL 
-             && (conf->no_last_mod_ignore ==0)) {
-        /* 200 OK response from HTTP/1.0 and up without a Last-Modified
-         * header/Etag 
+             && (exps == NULL) && (conf->no_last_mod_ignore ==0)) {
+        /* 200 OK response from HTTP/1.0 and up without Last-Modified,
+         * Etag, or Expires headers.
          */
-        /* XXX mod-include clears last_modified/expires/etags - this
+        /* Note: mod-include clears last_modified/expires/etags - this
          * is why we have an optional function for a key-gen ;-) 
          */
-        reason = "No Last-Modified or Etag header";
+        reason = "No Last-Modified, Etag, or Expires headers";
     }
     else if (r->header_only) {
         /* HEAD requests */
         reason = "HTTP HEAD request";
     }
     else if (ap_cache_liststr(NULL, cc_out, "no-store", NULL)) {
@@ -720,13 +720,12 @@
     info->response_time = now;
 
     /* get the request time */
     info->request_time = r->request_time;
 
     /* check last-modified date */
-    /* XXX FIXME we're referencing date on a path where we didn't set it */
     if (lastmod != APR_DATE_BAD && lastmod > date) {
         /* if it's in the future, then replace by date */
         lastmod = date;
         lastmods = dates;
         ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                      r->server,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_deflate.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_deflate.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_deflate.c	2003-05-18 02:27:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_deflate.c	2003-09-17 18:39:43.000000000 +0800
@@ -322,13 +322,14 @@
                 ap_remove_output_filter(f);
                 return ap_pass_brigade(f->next, bb);
             }            
         }
 
         /* Let's see what our current Content-Encoding is.
-         * If gzip is present, don't gzip again.  (We could, but let's not.)
+         * If it's already encoded, don't compress again.
+         * (We could, but let's not.)
          */
         encoding = apr_table_get(r->headers_out, "Content-Encoding");
         if (encoding) {
             const char *err_enc;
 
             err_enc = apr_table_get(r->err_headers_out, "Content-Encoding");
@@ -347,20 +348,26 @@
         }
 
         if (encoding) {
             const char *tmp = encoding;
 
             token = ap_get_token(r->pool, &tmp, 0);
-            while (token && token[0]) {
-                if (!strcasecmp(token, "gzip")) {
+            while (token && *token) {
+                /* stolen from mod_negotiation: */
+                if (strcmp(token, "identity") && strcmp(token, "7bit") &&
+                    strcmp(token, "8bit") && strcmp(token, "binary")) {
+
                     ap_remove_output_filter(f);
                     return ap_pass_brigade(f->next, bb);			
                 }
+
                 /* Otherwise, skip token */
-                tmp++;
-                token = ap_get_token(r->pool, &tmp, 0);
+                if (*tmp) {
+                    ++tmp;
+                }
+                token = (*tmp) ? ap_get_token(r->pool, &tmp, 0) : NULL;
             }
         }
 
         /* Even if we don't accept this request based on it not having
          * the Accept-Encoding, we need to note that we were looking
          * for this header and downstream proxies should be aware of that.
@@ -373,15 +380,23 @@
             ap_remove_output_filter(f);
             return ap_pass_brigade(f->next, bb);
         }
 
         token = ap_get_token(r->pool, &accepts, 0);
         while (token && token[0] && strcasecmp(token, "gzip")) {
-            /* skip token */
-            accepts++;
-            token = ap_get_token(r->pool, &accepts, 0);
+            /* skip parameters, XXX: ;q=foo evaluation? */
+            while (*accepts == ';') { 
+                ++accepts;
+                token = ap_get_token(r->pool, &accepts, 1);
+            }
+
+            /* retrieve next token */
+            if (*accepts == ',') {
+                ++accepts;
+            }
+            token = (*accepts) ? ap_get_token(r->pool, &accepts, 0) : NULL;
         }
 
         /* No acceptable token found. */
         if (token == NULL || token[0] == '\0') {
             ap_remove_output_filter(f);
             return ap_pass_brigade(f->next, bb);
@@ -526,28 +541,34 @@
              */
             return ap_pass_brigade(f->next, ctx->bb);
         }
 
         if (APR_BUCKET_IS_FLUSH(e)) {
             apr_bucket *bkt;
-            zRC = deflate(&(ctx->stream), Z_SYNC_FLUSH);
-            if (zRC != Z_OK) {
-                return APR_EGENERAL;
+            apr_status_t rv;
+            if (ctx->stream.avail_in > 0) {
+                zRC = deflate(&(ctx->stream), Z_SYNC_FLUSH);
+                if (zRC != Z_OK) {
+                    return APR_EGENERAL;
+                }
             }
 
             ctx->stream.next_out = ctx->buffer;
             len = c->bufferSize - ctx->stream.avail_out;
 
             b = apr_bucket_heap_create((char *)ctx->buffer, len,
                                        NULL, f->c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(ctx->bb, b);
             ctx->stream.avail_out = c->bufferSize;
 
             bkt = apr_bucket_flush_create(f->c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(ctx->bb, bkt);
-            ap_pass_brigade(f->next, ctx->bb);
+            rv = ap_pass_brigade(f->next, ctx->bb);
+            if (rv != APR_SUCCESS) {
+                return rv;
+            }
             continue;
         }
 
         /* read */
         apr_bucket_read(e, &data, &len, APR_BLOCK_READ);
 
@@ -559,19 +580,26 @@
                                                       * but we'll just have to
                                                       * trust zlib */
         ctx->stream.avail_in = len;
 
         while (ctx->stream.avail_in != 0) {
             if (ctx->stream.avail_out == 0) {
+                apr_status_t rv;
+
                 ctx->stream.next_out = ctx->buffer;
                 len = c->bufferSize - ctx->stream.avail_out;
 
                 b = apr_bucket_heap_create((char *)ctx->buffer, len,
                                            NULL, f->c->bucket_alloc);
                 APR_BRIGADE_INSERT_TAIL(ctx->bb, b);
                 ctx->stream.avail_out = c->bufferSize;
+                /* Send what we have right now to the next filter. */
+                rv = ap_pass_brigade(f->next, ctx->bb);
+                if (rv != APR_SUCCESS) {
+                    return rv;
+                }
             }
 
             zRC = deflate(&(ctx->stream), Z_NO_FLUSH);
 
             if (zRC != Z_OK)
                 return APR_EGENERAL;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_ext_filter.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_ext_filter.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_ext_filter.c	2003-02-27 20:33:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_ext_filter.c	2003-07-28 09:54:17.000000000 +0800
@@ -475,12 +475,13 @@
     }
     
     /* add standard CGI variables as well as DOCUMENT_URI, DOCUMENT_PATH_INFO,
      * and QUERY_STRING_UNESCAPED
      */
     ap_add_cgi_vars(f->r);
+    ap_add_common_vars(f->r);
     apr_table_setn(f->r->subprocess_env, "DOCUMENT_URI", f->r->uri);
     apr_table_setn(f->r->subprocess_env, "DOCUMENT_PATH_INFO", f->r->path_info);
     if (f->r->args) {
             /* QUERY_STRING is added by ap_add_cgi_vars */
         char *arg_copy = apr_pstrdup(f->r->pool, f->r->args);
         ap_unescape_url(arg_copy);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_include.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_include.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/filters/mod_include.c	2003-02-04 01:31:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/filters/mod_include.c	2003-10-24 04:07:46.000000000 +0800
@@ -152,13 +152,13 @@
     apr_table_setn(e, "LAST_MODIFIED", LAZY_VALUE);
     apr_table_setn(e, "DOCUMENT_URI", r->uri);
     if (r->path_info && *r->path_info) {
         apr_table_setn(e, "DOCUMENT_PATH_INFO", r->path_info);
     }
     apr_table_setn(e, "USER_NAME", LAZY_VALUE);
-    if ((t = strrchr(r->filename, '/'))) {
+    if (r->filename && (t = strrchr(r->filename, '/'))) {
         apr_table_setn(e, "DOCUMENT_NAME", ++t);
     }
     else {
         apr_table_setn(e, "DOCUMENT_NAME", r->uri);
     }
     if (r->args) {
@@ -426,13 +426,14 @@
         if (!APR_STATUS_IS_SUCCESS(rv)) {
             ctx->status = rv;
             return NULL;
         }
 
         if (len == 0) { /* end of pipe? */
-            break;
+            dptr = APR_BUCKET_NEXT(dptr);
+            continue;
         }
 
         /* Set our buffer to use. */
         c = buf;
 
         /* The last bucket had a left over partial match that we need to
@@ -474,13 +475,13 @@
             ctx->head_start_bucket = NULL;
             ctx->head_start_index = 0;
         }
 
         if (len)
         {
-            pos = bndm(str, slen, c, len, ctx->start_seq_pat);
+            pos = bndm(str, slen, buf, len, ctx->start_seq_pat);
             if (pos != len)
             {
                 ctx->head_start_bucket = dptr;
                 ctx->head_start_index = pos;
                 ctx->bytes_parsed += pos + slen;
                 return found_start_sequence(dptr, ctx, pos + slen, len);
@@ -597,13 +598,14 @@
         if (!APR_STATUS_IS_SUCCESS(rv)) {
             ctx->status = rv;
             return NULL;
         }
 
         if (len == 0) { /* end of pipe? */
-            break;
+            dptr = APR_BUCKET_NEXT(dptr);
+            continue;
         }
         if (dptr == ctx->tag_start_bucket) {
             c = buf + ctx->tag_start_index;
         }
         else {
             c = buf;
@@ -2066,12 +2068,13 @@
                 new->left->parent = new;
                 new->parent = (struct parse_node *) NULL;
                 root = new;
             }
             else {
                 new->left = current->right;
+                new->left->parent = new;
                 current->right = new;
                 new->parent = current;
             }
             current = new;
             break;
 
@@ -2172,12 +2175,13 @@
                 new->left->parent = new;
                 new->parent = (struct parse_node *) NULL;
                 root = new;
             }
             else {
                 new->left = current->right;
+                new->left->parent = new;
                 current->right = new;
                 new->parent = current;
             }
             current = new;
             break;
 
@@ -2953,20 +2957,25 @@
                 apr_brigade_cleanup(ctx->ssi_tag_brigade);
             }
 
             /* If I am inside a conditional (if, elif, else) that is false
              *   then I need to throw away anything contained in it.
              */
-            if ((!(ctx->flags & FLAG_PRINTING)) && (tmp_dptr != NULL) &&
+            if ((!(ctx->flags & FLAG_PRINTING)) &&
                 (dptr != APR_BRIGADE_SENTINEL(*bb))) {
-                while ((dptr != APR_BRIGADE_SENTINEL(*bb)) &&
-                       (dptr != tmp_dptr)) {
+                apr_bucket *stop = (!tmp_dptr && ctx->state == PARSE_HEAD)
+                                   ? ctx->head_start_bucket
+                                   : tmp_dptr;
+
+                while ((dptr != APR_BRIGADE_SENTINEL(*bb)) && (dptr != stop)) {
                     apr_bucket *free_bucket = dptr;
 
-                    dptr = APR_BUCKET_NEXT (dptr);
-                    apr_bucket_delete(free_bucket);
+                    dptr = APR_BUCKET_NEXT(dptr);
+                    if (!APR_BUCKET_IS_METADATA(free_bucket)) {
+                        apr_bucket_delete(free_bucket);
+                    }
                 }
             }
 
             /* Adjust the current bucket position based on what was found... */
             if ((tmp_dptr != NULL) && (ctx->state == PARSE_DIRECTIVE)) {
                 if (ctx->tag_start_bucket != NULL) {
@@ -3194,25 +3203,14 @@
      *   the pertinent trailing buckets and pass on the initial part of the
      *   brigade. The pertinent parts of the next brigades will be added to
      *   these set aside buckets to form the whole tag and will be processed
      *   once the whole tag has been found.
      */
     if (ctx->state == PRE_HEAD) {
-        /* Inside a false conditional (if, elif, else), so toss it all... */
-        if ((dptr != APR_BRIGADE_SENTINEL(*bb)) &&
-            (!(ctx->flags & FLAG_PRINTING))) {
-            apr_bucket *free_bucket;
-            do {
-                free_bucket = dptr;
-                dptr = APR_BUCKET_NEXT (dptr);
-                apr_bucket_delete(free_bucket);
-            } while (dptr != APR_BRIGADE_SENTINEL(*bb));
-        }
-        else { 
-            /* Otherwise pass it along...
-             * No SSI tags in this brigade... */
+        if (!APR_BRIGADE_EMPTY(*bb)) {
+            /* pass it along... */
             rv = ap_pass_brigade(f->next, *bb);  
             if (rv != APR_SUCCESS) {
                 return rv;
             }
             ctx->bytes_parsed = 0;
         }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/generators/mod_autoindex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/generators/mod_autoindex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/generators/mod_autoindex.c	2003-04-23 04:02:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/generators/mod_autoindex.c	2003-09-28 02:34:56.000000000 +0800
@@ -1358,12 +1358,13 @@
     if (autoindex_opts & (FANCY_INDEXING | TABLE_INDEXING)) {
         p->lm = rr->finfo.mtime;
         if (dirent->filetype == APR_DIR) {
             if (autoindex_opts & FOLDERS_FIRST) {
                 p->isdir = 1;
             }
+            rr->filename = ap_make_dirstr_parent (rr->pool, rr->filename);
             if (!(p->icon = find_icon(d, rr, 1))) {
                 p->icon = find_default_icon(d, "^^DIRECTORY^^");
             }
             if (!(p->alt = find_alt(d, rr, 1))) {
                 if (!(p->alt = find_default_alt(d, "^^DIRECTORY^^"))) {
                     p->alt = "DIR";
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/generators/mod_cgid.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/generators/mod_cgid.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/generators/mod_cgid.c	2003-06-23 20:28:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/generators/mod_cgid.c	2003-10-25 00:37:06.000000000 +0800
@@ -766,13 +766,32 @@
                  */
                 ap_log_error(APLOG_MARK, APLOG_ERR, rc, r->server,
                              "couldn't create child process: %d: %s", rc, 
                              apr_filename_of_pathname(r->filename));
             }
             else {
-                apr_hash_set(script_hash, &cgid_req.conn_id, sizeof(cgid_req.conn_id), 
+                /* We don't want to leak storage for the key, so only allocate
+                 * a key if the key doesn't exist yet in the hash; there are
+                 * only a limited number of possible keys (one for each
+                 * possible thread in the server), so we can allocate a copy
+                 * of the key the first time a thread has a cgid request.
+                 * Note that apr_hash_set() only uses the storage passed in
+                 * for the key if it is adding the key to the hash for the
+                 * first time; new key storage isn't needed for replacing the
+                 * existing value of a key.
+                 */
+                void *key;
+
+                if (apr_hash_get(script_hash, &cgid_req.conn_id, sizeof(cgid_req.conn_id))) {
+                    key = &cgid_req.conn_id;
+                }
+                else {
+                    key = apr_pcalloc(pcgi, sizeof(cgid_req.conn_id));
+                    memcpy(key, &cgid_req.conn_id, sizeof(cgid_req.conn_id));
+                }
+                apr_hash_set(script_hash, key, sizeof(cgid_req.conn_id),
                              (void *)procnew->pid);
             }
         }
     } 
     return -1; 
 } 
@@ -1307,17 +1326,19 @@
     info->conn_id = r->connection->id;
     info->conf = conf;
     apr_pool_cleanup_register(r->pool, info,
                               cleanup_script,
                               apr_pool_cleanup_null);
     /* We are putting the socket discriptor into an apr_file_t so that we can
-     * use a pipe bucket to send the data to the client.
-     * Note that this does not register a cleanup for the socket.  We did
-     * that explicitly right after we created the socket.
+     * use a pipe bucket to send the data to the client.  APR will create
+     * a cleanup for the apr_file_t which will close the socket, so we'll
+     * get rid of the cleanup we registered when we created the socket.
      */
-    apr_os_pipe_put(&tempsock, &sd, r->pool);
+    
+    apr_os_pipe_put_ex(&tempsock, &sd, 1, r->pool);
+    apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
 
     if ((argv0 = strrchr(r->filename, '/')) != NULL) 
         argv0++; 
     else 
         argv0 = r->filename; 
 
@@ -1444,30 +1465,18 @@
              */ 
             discard_script_output(bb);
             apr_brigade_destroy(bb);
             return HTTP_MOVED_TEMPORARILY; 
         } 
 
-        /* Passing our socket down the filter chain in a pipe bucket
-         * gives up the responsibility of closing the socket, so
-         * get rid of the cleanup.
-         */
-        apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
-
         ap_pass_brigade(r->output_filters, bb);
     } 
 
     if (nph) {
         struct ap_filter_t *cur;
         
-        /* Passing our socket down the filter chain in a pipe bucket
-         * gives up the responsibility of closing the socket, so
-         * get rid of the cleanup.
-         */
-        apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
-
         /* get rid of all filters up through protocol...  since we
          * haven't parsed off the headers, there is no way they can
          * work
          */
 
         cur = r->proto_output_filters;
@@ -1602,13 +1611,12 @@
 }
 
 static int include_cmd(include_ctx_t *ctx, apr_bucket_brigade **bb, char *command,
                        request_rec *r, ap_filter_t *f)
 {
     char **env; 
-    const char *location; 
     int sd;
     apr_status_t rc = APR_SUCCESS; 
     int retval;
     apr_bucket_brigade *bcgi;
     apr_bucket *b;
     apr_file_t *tempsock = NULL;
@@ -1639,65 +1647,23 @@
      * to knock out the shell process, not the actual script
      */
     apr_pool_cleanup_register(r->pool, info,
                               cleanup_script,
                               apr_pool_cleanup_null);
     /* We are putting the socket discriptor into an apr_file_t so that we can
-     * use a pipe bucket to send the data to the client.
-     * Note that this does not register a cleanup for the socket.  We did
-     * that explicitly right after we created the socket.
+     * use a pipe bucket to send the data to the client.  APR will create
+     * a cleanup for the apr_file_t which will close the socket, so we'll
+     * get rid of the cleanup we registered when we created the socket.
      */
-    apr_os_pipe_put(&tempsock, &sd, r->pool);
-
-    if ((retval = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR))) 
-        return retval; 
-    
-    location = apr_table_get(r->headers_out, "Location"); 
-
-    if (location && location[0] == '/' && r->status == 200) { 
-        char argsbuffer[HUGE_STRING_LEN]; 
-
-        /* Soak up all the script output */ 
-        while (apr_file_gets(argsbuffer, HUGE_STRING_LEN, 
-                             tempsock) == APR_SUCCESS) { 
-            continue; 
-        } 
-        /* This redirect needs to be a GET no matter what the original 
-         * method was. 
-         */ 
-        r->method = apr_pstrdup(r->pool, "GET"); 
-        r->method_number = M_GET; 
-
-        /* We already read the message body (if any), so don't allow 
-         * the redirected request to think it has one. We can ignore 
-         * Transfer-Encoding, since we used REQUEST_CHUNKED_ERROR. 
-         */ 
-        apr_table_unset(r->headers_in, "Content-Length"); 
+    apr_os_pipe_put_ex(&tempsock, &sd, 1, r->pool);
+    apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
 
-        ap_internal_redirect_handler(location, r); 
-        return OK; 
-    } 
-    else if (location && r->status == 200) { 
-        /* XX Note that if a script wants to produce its own Redirect 
-         * body, it now has to explicitly *say* "Status: 302" 
-         */ 
-        return HTTP_MOVED_TEMPORARILY; 
-    } 
-
-    if (!r->header_only) { 
-        /* Passing our socket down the filter chain in a pipe bucket
-         * gives up the responsibility of closing the socket, so
-         * get rid of the cleanup.
-         */
-        apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
-
-        bcgi = apr_brigade_create(r->pool, r->connection->bucket_alloc);
-        b    = apr_bucket_pipe_create(tempsock, r->connection->bucket_alloc);
-        APR_BRIGADE_INSERT_TAIL(bcgi, b);
-        ap_pass_brigade(f->next, bcgi);
-    } 
+    bcgi = apr_brigade_create(r->pool, r->connection->bucket_alloc);
+    b    = apr_bucket_pipe_create(tempsock, r->connection->bucket_alloc);
+    APR_BRIGADE_INSERT_TAIL(bcgi, b);
+    ap_pass_brigade(f->next, bcgi);
 
     return 0;
 }
 
 static int handle_exec(include_ctx_t *ctx, apr_bucket_brigade **bb, request_rec *r,
                        ap_filter_t *f, apr_bucket *head_ptr, apr_bucket **inserted_head)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/http/http_protocol.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/http/http_protocol.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/http/http_protocol.c	2003-04-17 19:31:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/http/http_protocol.c	2003-09-17 18:47:39.000000000 +0800
@@ -1276,16 +1276,19 @@
     ap_recent_rfc822_date(date, r->request_time);
 
     h.pool = r->pool;
     h.bb = bb;
     form_header_field(&h, "Date", date);
 
-    /* keep a previously set server header (possibly from proxy), otherwise
+    /* keep the set-by-proxy server header, otherwise
      * generate a new server header */
-    if ((server = apr_table_get(r->headers_out, "Server")) != NULL) {
-        form_header_field(&h, "Server", server);
+    if (r->proxyreq != PROXYREQ_NONE) {
+        server = apr_table_get(r->headers_out, "Server");
+        if (server) {
+            form_header_field(&h, "Server", server);
+        }
     }
     else {
         form_header_field(&h, "Server", ap_get_server_version());
     }
 
     /* unset so we don't send them again */
@@ -1884,12 +1887,16 @@
 AP_DECLARE(long) ap_get_client_block(request_rec *r, char *buffer,
                                      apr_size_t bufsiz)
 {
     apr_status_t rv;
     apr_bucket_brigade *bb;
 
+    if (r->remaining < 0 || (!r->read_chunked && r->remaining == 0)) {
+        return 0;
+    }
+
     bb = apr_brigade_create(r->pool, r->connection->bucket_alloc);
     if (bb == NULL) {
         r->connection->keepalive = AP_CONN_CLOSE;
         return -1;
     }
 
@@ -1910,13 +1917,27 @@
 
     /* If this fails, it means that a filter is written incorrectly and that
      * it needs to learn how to properly handle APR_BLOCK_READ requests by
      * returning data when requested.
      */
     AP_DEBUG_ASSERT(!APR_BRIGADE_EMPTY(bb));
- 
+
+    /* Check to see if EOS in the brigade.
+     *
+     * If so, we have to leave a nugget for the *next* ap_get_client_block
+     * call to return 0.
+     */
+    if (APR_BUCKET_IS_EOS(APR_BRIGADE_LAST(bb))) {
+        if (r->read_chunked) {
+            r->remaining = -1;
+        }
+        else {
+            r->remaining = 0;
+        }
+    }
+
     rv = apr_brigade_flatten(bb, buffer, &bufsiz);
     if (rv != APR_SUCCESS) {
         apr_brigade_destroy(bb);
         return -1;
     }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/loggers/mod_log_config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/loggers/mod_log_config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/loggers/mod_log_config.c	2003-05-14 11:20:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/loggers/mod_log_config.c	2003-09-22 05:23:34.000000000 +0800
@@ -415,23 +415,23 @@
 {
     return pfmt(r->pool, r->status);
 }
 
 static const char *clf_log_bytes_sent(request_rec *r, char *a)
 {
-    if (!r->sent_bodyct) {
+    if (!r->sent_bodyct || !r->bytes_sent) {
         return "-";
     }
     else {
         return apr_off_t_toa(r->pool, r->bytes_sent);
     }
 }
 
 static const char *log_bytes_sent(request_rec *r, char *a)
 {
-    if (!r->sent_bodyct) {
+    if (!r->sent_bodyct || !r->bytes_sent) {
         return "0";
     }
     else {
         return apr_psprintf(r->pool, "%" APR_OFF_T_FMT, r->bytes_sent);
     }
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_alias.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_alias.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_alias.c	2003-04-25 00:16:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_alias.c	2003-10-25 00:19:32.000000000 +0800
@@ -325,26 +325,25 @@
 }
 
 static char *try_alias_list(request_rec *r, apr_array_header_t *aliases,
                             int doesc, int *status)
 {
     alias_entry *entries = (alias_entry *) aliases->elts;
-    regmatch_t regm[10];
+    regmatch_t regm[AP_MAX_REG_MATCH];
     char *found = NULL;
     int i;
 
     for (i = 0; i < aliases->nelts; ++i) {
         alias_entry *p = &entries[i];
         int l;
 
         if (p->regexp) {
-            if (!ap_regexec(p->regexp, r->uri, p->regexp->re_nsub + 1, regm,
-                            0)) {
+            if (!ap_regexec(p->regexp, r->uri, AP_MAX_REG_MATCH, regm, 0)) {
                 if (p->real) {
                     found = ap_pregsub(r->pool, p->real, r->uri,
-                                    p->regexp->re_nsub + 1, regm);
+                                       AP_MAX_REG_MATCH, regm);
                     if (found && doesc) {
                         apr_uri_t uri;
                         apr_uri_parse(r->pool, found, &uri);
                         /* Do not escape the query string or fragment. */
                         found = apr_uri_unparse(r->pool, &uri, 
                                                 APR_URI_UNP_OMITQUERY);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_rewrite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_rewrite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_rewrite.c	2003-05-19 10:25:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_rewrite.c	2003-10-25 00:19:32.000000000 +0800
@@ -115,12 +115,13 @@
 #include "http_log.h"
 #include "http_protocol.h"
 #include "mod_rewrite.h"
 
 #if !defined(OS2) && !defined(WIN32) && !defined(BEOS)  && !defined(NETWARE)
 #include "unixd.h"
+#define MOD_REWRITE_SET_MUTEX_PERMS /* XXX Apache should define something */
 #endif
 
 /*
 ** +-------------------------------------------------------+
 ** |                                                       |
 ** |             static module configuration
@@ -1014,13 +1015,13 @@
                                       APR_LOCK_DEFAULT, p)) != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
                      "mod_rewrite: could not create rewrite_log_lock");
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
-#if APR_USE_SYSVSEM_SERIALIZE
+#ifdef MOD_REWRITE_SET_MUTEX_PERMS
     rv = unixd_set_global_mutex_perms(rewrite_log_lock);
     if (rv != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
                      "mod_rewrite: Could not set permissions on "
                      "rewrite_log_lock; check User and Group directives");
         return HTTP_INTERNAL_SERVER_ERROR;
@@ -1037,13 +1038,16 @@
 
     /* step through the servers and
      * - open each rewriting logfile
      * - open the RewriteMap prg:xxx programs
      */
     for (; s; s = s->next) {
-        open_rewritelog(s, p);
+        if (!open_rewritelog(s, p)) {
+            return HTTP_INTERNAL_SERVER_ERROR;
+        }
+
         if (!first_time) {
             if (run_rewritemap_programs(s, p) != APR_SUCCESS) {
                 return HTTP_INTERNAL_SERVER_ERROR;
             }
         }
     }
@@ -1069,12 +1073,18 @@
             ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
                          "mod_rewrite: could not init rewrite_mapr_lock_acquire"
                          " in child");
         }
     }
 
+    rv = apr_global_mutex_child_init(&rewrite_log_lock, NULL, p);
+    if (rv != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
+                     "mod_rewrite: could not init rewrite log lock in child");
+    }
+    
     /* create the lookup cache */
     cachep = init_cache(p);
 }
 
 
 /*
@@ -1094,12 +1104,13 @@
 **
 */
 
 static int hook_uri2file(request_rec *r)
 {
     rewrite_server_conf *conf;
+    const char *saved_rulestatus;
     const char *var;
     const char *thisserver;
     char *thisport;
     const char *thisurl;
     char buf[512];
     char docroot[512];
@@ -1172,25 +1183,40 @@
 
     /* set the variable */
     var = apr_pstrcat(r->pool, ap_http_method(r), "://", thisserver, thisport,
                       thisurl, NULL);
     apr_table_setn(r->subprocess_env, ENVVAR_SCRIPT_URI, var);
 
-    /* if filename was not initially set,
-     * we start with the requested URI
-     */
-    if (r->filename == NULL) {
-        r->filename = apr_pstrdup(r->pool, r->uri);
-        rewritelog(r, 2, "init rewrite engine with requested uri %s",
-                   r->filename);
+    if (!(saved_rulestatus = apr_table_get(r->notes,"mod_rewrite_rewritten"))) {
+        /* if filename was not initially set,
+         * we start with the requested URI
+         */
+        if (r->filename == NULL) {
+            r->filename = apr_pstrdup(r->pool, r->uri);
+            rewritelog(r, 2, "init rewrite engine with requested uri %s",
+                       r->filename);
+        }
+        else {
+            rewritelog(r, 2, "init rewrite engine with passed filename %s."
+                       " Original uri = %s", r->filename, r->uri);
+        }
+
+        /*
+         *  now apply the rules ...
+         */
+        rulestatus = apply_rewrite_list(r, conf->rewriterules, NULL);
+        apr_table_set(r->notes,"mod_rewrite_rewritten",
+                      apr_psprintf(r->pool,"%d",rulestatus));
+    }
+    else {
+        rewritelog(r, 2,
+                   "uri already rewritten. Status %s, Uri %s, r->filename %s",
+                   saved_rulestatus, r->uri, r->filename);
+        rulestatus = atoi(saved_rulestatus);
     }
 
-    /*
-     *  now apply the rules ...
-     */
-    rulestatus = apply_rewrite_list(r, conf->rewriterules, NULL);
     if (rulestatus) {
         unsigned skip;
 
         if (strlen(r->filename) > 6 &&
             strncmp(r->filename, "proxy:", 6) == 0) {
             /* it should be go on as an internal proxy request */
@@ -1393,13 +1419,13 @@
 {
     rewrite_perdir_conf *dconf;
     char *cp;
     char *cp2;
     const char *ccp;
     char *prefix;
-    int l;
+    apr_size_t l;
     int rulestatus;
     int n;
     char *ofilename;
 
     dconf = (rewrite_perdir_conf *)ap_get_module_config(r->per_dir_config,
                                                         &rewrite_module);
@@ -1418,12 +1444,24 @@
        per-dir config of us, we return also immediately */
     if (dconf->directory == NULL) {
         return DECLINED;
     }
 
     /*
+     *  .htaccess file is called before really entering the directory, i.e.:
+     *  URL: http://localhost/foo  and .htaccess is located in foo directory
+     *  Ignore such attempts, since they may lead to undefined behaviour.
+     */
+    l = strlen(dconf->directory) - 1;
+    if (r->filename && strlen(r->filename) == l &&
+        (dconf->directory)[l] == '/' &&
+        !strncmp(r->filename, dconf->directory, l)) {
+        return DECLINED;
+    }
+
+    /*
      *  only do something under runtime if the engine is really enabled,
      *  for this directory, else return immediately!
      */
     if (dconf->state == ENGINE_DISABLED) {
         return DECLINED;
     }
@@ -1899,13 +1937,13 @@
 {
     char *uri;
     char *output;
     const char *vary;
     char newuri[MAX_STRING_LEN];
     regex_t *regexp;
-    regmatch_t regmatch[MAX_NMATCH];
+    regmatch_t regmatch[AP_MAX_REG_MATCH];
     backrefinfo *briRR = NULL;
     backrefinfo *briRC = NULL;
     int prefixstrip;
     int failed;
     apr_array_header_t *rewriteconds;
     rewritecond_entry *conds;
@@ -1956,13 +1994,13 @@
                    p->pattern, uri);
     }
     else {
         rewritelog(r, 3, "[per-dir %s] applying pattern '%s' to uri '%s'",
                    perdir, p->pattern, uri);
     }
-    rc = (ap_regexec(regexp, uri, regexp->re_nsub+1, regmatch, 0) == 0);
+    rc = (ap_regexec(regexp, uri, AP_MAX_REG_MATCH, regmatch, 0) == 0);
     if (! (( rc && !(p->flags & RULEFLAG_NOTMATCH)) ||
            (!rc &&  (p->flags & RULEFLAG_NOTMATCH))   ) ) {
         return 0;
     }
 
     /*
@@ -2252,13 +2290,13 @@
                               char *perdir, backrefinfo *briRR,
                               backrefinfo *briRC)
 {
     char input[MAX_STRING_LEN];
     apr_finfo_t sb;
     request_rec *rsub;
-    regmatch_t regmatch[MAX_NMATCH];
+    regmatch_t regmatch[AP_MAX_REG_MATCH];
     int rc;
 
     /*
      *   Construct the string we match against
      */
 
@@ -2357,14 +2395,13 @@
         else {
             rc = (strcmp(input, p->pattern+1) == 0 ? 1 : 0);
         }
     }
     else {
         /* it is really a regexp pattern, so apply it */
-        rc = (ap_regexec(p->regexp, input,
-                         p->regexp->re_nsub+1, regmatch,0) == 0);
+        rc = (ap_regexec(p->regexp, input, AP_MAX_REG_MATCH, regmatch,0) == 0);
 
         /* if it isn't a negated pattern and really matched
            we update the passed-through regex subst info structure */
         if (rc && !(p->flags & CONDFLAG_NOTMATCH)) {
             briRC->source = apr_pstrdup(r->pool, input);
             briRC->nsub   = p->regexp->re_nsub;
@@ -2517,13 +2554,13 @@
             }
             else if (inp[0] == '%') {
                 /* %N RewriteCond regexp backref expansion */
                 bri = briRC;
             }
             /* see ap_pregsub() in src/main/util.c */
-            if (bri && n <= bri->nsub
+            if (bri && n < AP_MAX_REG_MATCH
                 && bri->regmatch[n].rm_eo > bri->regmatch[n].rm_so) {
                 span = bri->regmatch[n].rm_eo - bri->regmatch[n].rm_so;
                 if (span > space) {
                     span = space;
                 }
                 memcpy(outp, bri->source + bri->regmatch[n].rm_so, span);
@@ -3379,61 +3416,60 @@
 ** |              rewriting logfile support
 ** |                                                       |
 ** +-------------------------------------------------------+
 */
 
 
-static void open_rewritelog(server_rec *s, apr_pool_t *p)
+static int open_rewritelog(server_rec *s, apr_pool_t *p)
 {
     rewrite_server_conf *conf;
     const char *fname;
     apr_status_t rc;
     piped_log *pl;
     int rewritelog_flags = ( APR_WRITE | APR_APPEND | APR_CREATE );
     apr_fileperms_t rewritelog_mode = ( APR_UREAD | APR_UWRITE |
                                         APR_GREAD | APR_WREAD );
 
     conf = ap_get_module_config(s->module_config, &rewrite_module);
 
-    if (conf->rewritelogfile == NULL) {
-        return;
-    }
-    if (*(conf->rewritelogfile) == '\0') {
-        return;
-    }
-    if (conf->rewritelogfp != NULL) {
-        return; /* virtual log shared w/ main server */
+    /* - no logfile configured
+     * - logfilename empty
+     * - virtual log shared w/ main server
+     */
+    if (!conf->rewritelogfile || !*conf->rewritelogfile || conf->rewritelogfp) {
+        return 1;
     }
 
     if (*conf->rewritelogfile == '|') {
         if ((pl = ap_open_piped_log(p, conf->rewritelogfile+1)) == NULL) {
             ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                          "mod_rewrite: could not open reliable pipe "
                          "to RewriteLog filter %s", conf->rewritelogfile+1);
-            exit(1);
+            return 0;
         }
         conf->rewritelogfp = ap_piped_log_write_fd(pl);
     }
     else if (*conf->rewritelogfile != '\0') {
         fname = ap_server_root_relative(p, conf->rewritelogfile);
         if (!fname) {
             ap_log_error(APLOG_MARK, APLOG_ERR, APR_EBADPATH, s,
                          "mod_rewrite: Invalid RewriteLog "
                          "path %s", conf->rewritelogfile);
-            exit(1);
+            return 0;
         }
         if ((rc = apr_file_open(&conf->rewritelogfp, fname,
                                 rewritelog_flags, rewritelog_mode, p))
                 != APR_SUCCESS) {
             ap_log_error(APLOG_MARK, APLOG_ERR, rc, s,
                          "mod_rewrite: could not open RewriteLog "
                          "file %s", fname);
-            exit(1);
+            return 0;
         }
     }
-    return;
+
+    return 1;
 }
 
 static void rewritelog(request_rec *r, int level, const char *text, ...)
 {
     rewrite_server_conf *conf;
     conn_rec *conn;
@@ -3576,13 +3612,13 @@
         ap_log_error(APLOG_MARK, APLOG_CRIT, rc, s,
                      "mod_rewrite: Parent could not create RewriteLock "
                      "file %s", lockname);
         return rc;
     }
 
-#if APR_USE_SYSVSEM_SERIALIZE
+#ifdef MOD_REWRITE_SET_MUTEX_PERMS
     rc = unixd_set_global_mutex_perms(rewrite_mapr_lock_acquire);
     if (rc != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, rc, s,
                      "mod_rewrite: Parent could not set permissions "
                      "on RewriteLock; check User and Group directives");
         return rc;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_rewrite.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_rewrite.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/mappers/mod_rewrite.h	2003-05-19 10:25:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/mappers/mod_rewrite.h	2003-08-01 07:43:37.000000000 +0800
@@ -437,13 +437,13 @@
 
 static char *select_random_value_part(request_rec *r, char *value);
 static void  rewrite_rand_init(void);
 static int   rewrite_rand(int l, int h);
 
     /* rewriting logfile support */
-static void  open_rewritelog(server_rec *s, apr_pool_t *p);
+static int   open_rewritelog(server_rec *s, apr_pool_t *p);
 static void  rewritelog(request_rec *r, int level, const char *text, ...)
                         __attribute__((format(printf,3,4)));
 static char *current_logtime(request_rec *r);
 
     /* rewriting lockfile support */
 static apr_status_t rewritelock_create(server_rec *s, apr_pool_t *p);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/metadata/mod_usertrack.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/metadata/mod_usertrack.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/metadata/mod_usertrack.c	2003-03-08 05:27:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/metadata/mod_usertrack.c	2003-09-28 02:24:38.000000000 +0800
@@ -122,12 +122,14 @@
 
 typedef struct {
     int enabled;
     cookie_type_e style;
     char *cookie_name;
     char *cookie_domain;
+    char *regexp_string;  /* used to compile regexp; save for debugging */
+    regex_t *regexp;  /* used to find usertrack cookie in cookie header */
 } cookie_dir_rec;
 
 /* Make Cookie: Now we have to generate something that is going to be
  * pretty unique.  We can base it on the pid, time, hostip */
 
 #define COOKIE_NAME "Apache"
@@ -190,42 +192,54 @@
                    (dcfg->style == CT_COOKIE2 ? "Set-Cookie2" : "Set-Cookie"),
                    new_cookie);
     apr_table_setn(r->notes, "cookie", apr_pstrdup(r->pool, cookiebuf));   /* log first time */
     return;
 }
 
+/* dcfg->regexp is "^cookie_name=([^;]+)|;[ \t]+cookie_name=([^;]+)",
+ * which has three subexpressions, $0..$2 */
+#define NUM_SUBS 3
+
 static int spot_cookie(request_rec *r)
 {
     cookie_dir_rec *dcfg = ap_get_module_config(r->per_dir_config,
 						&usertrack_module);
-    const char *cookie;
-    const char *value;
+    const char *cookie_header;
+    regmatch_t regm[NUM_SUBS];
 
     /* Do not run in subrequests */
     if (!dcfg->enabled || r->main) {
         return DECLINED;
     }
 
-    if ((cookie = apr_table_get(r->headers_in,
-                                (dcfg->style == CT_COOKIE2
-                                 ? "Cookie2"
-                                 : "Cookie"))))
-        if ((value = ap_strstr_c(cookie, dcfg->cookie_name))) {
-            char *cookiebuf, *cookieend;
-
-            value += strlen(dcfg->cookie_name) + 1;  /* Skip over the '=' */
-            cookiebuf = apr_pstrdup(r->pool, value);
-            cookieend = strchr(cookiebuf, ';');
-            if (cookieend)
-                *cookieend = '\0';      /* Ignore anything after a ; */
-
+    if ((cookie_header = apr_table_get(r->headers_in,
+                                       (dcfg->style == CT_COOKIE2
+                                        ? "Cookie2"
+                                        : "Cookie")))) {
+        if (!ap_regexec(dcfg->regexp, cookie_header, NUM_SUBS, regm, 0)) {
+            char *cookieval = NULL;
+            /* Our regexp,
+             * ^cookie_name=([^;]+)|;[ \t]+cookie_name=([^;]+)
+             * only allows for $1 or $2 to be available. ($0 is always
+             * filled with the entire matched expression, not just
+             * the part in parentheses.) So just check for either one
+             * and assign to cookieval if present. */
+            if (regm[1].rm_so != -1) {
+                cookieval = ap_pregsub(r->pool, "$1", cookie_header,
+                                       NUM_SUBS, regm);
+            }
+            if (regm[2].rm_so != -1) {
+                cookieval = ap_pregsub(r->pool, "$2", cookie_header,
+                                       NUM_SUBS, regm);
+            }
             /* Set the cookie in a note, for logging */
-            apr_table_setn(r->notes, "cookie", cookiebuf);
+            apr_table_setn(r->notes, "cookie", cookieval);
 
             return DECLINED;    /* There's already a cookie, no new one */
         }
+    }
     make_cookie(r);
     return OK;                  /* We set our cookie */
 }
 
 static void *make_cookie_log_state(apr_pool_t *p, server_rec *s)
 {
@@ -328,13 +342,32 @@
 
 static const char *set_cookie_name(cmd_parms *cmd, void *mconfig,
                                    const char *name)
 {
     cookie_dir_rec *dcfg = (cookie_dir_rec *) mconfig;
 
+    /* The goal is to end up with this regexp,
+     * ^cookie_name=([^;]+)|;[ \t]+cookie_name=([^;]+)
+     * with cookie_name
+     * obviously substituted with the real cookie name set by the
+     * user in httpd.conf. */
+    dcfg->regexp_string = apr_pstrcat(cmd->pool, "^", name,
+                                      "=([^;]+)|;[ \t]+", name,
+                                      "=([^;]+)", NULL);
+
     dcfg->cookie_name = apr_pstrdup(cmd->pool, name);
+
+    dcfg->regexp = ap_pregcomp(cmd->pool, dcfg->regexp_string, REG_EXTENDED);
+    if (dcfg->regexp == NULL) {
+        return "Regular expression could not be compiled.";
+    }
+    if (dcfg->regexp->re_nsub + 1 != NUM_SUBS) {
+        return apr_pstrcat(cmd->pool, "Invalid cookie name \"",
+                           name, "\"", NULL);
+    }
+
     return NULL;
 }
 
 /*
  * Set the value for the 'Domain=' attribute.
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/proxy/proxy_ftp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/proxy/proxy_ftp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/proxy/proxy_ftp.c	2003-07-07 22:51:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/proxy/proxy_ftp.c	2003-10-25 00:19:32.000000000 +0800
@@ -316,12 +316,16 @@
     char buffer[MAX_STRING_LEN];
     enum {
         HEADER, BODY, FOOTER
     }    state;
 }      proxy_dir_ctx_t;
 
+/* fallback regex for ls -s1;  ($0..$2) == 3 */
+#define LS_REG_PATTERN "^ *([0-9]+) +([^ ]+)$"
+#define LS_REG_MATCH   3
+
 apr_status_t ap_proxy_send_dir_filter(ap_filter_t *f, apr_bucket_brigade *in)
 {
     request_rec *r = f->r;
     conn_rec *c = r->connection;
     apr_pool_t *p = r->pool;
     apr_bucket_brigade *out = apr_brigade_create(p, c->bucket_alloc);
@@ -459,16 +463,16 @@
     while (BODY == ctx->state) {
         char *filename;
         int found = 0;
         int eos = 0;
 
         regex_t *re = NULL;
-        regmatch_t re_result[3];
+        regmatch_t re_result[LS_REG_MATCH];
 
         /* Compile the output format of "ls -s1" as a fallback for non-unix ftp listings */
-        re = ap_pregcomp(p, "^ *([0-9]+) +([^ ]+)$", REG_EXTENDED);
+        re = ap_pregcomp(p, LS_REG_PATTERN, REG_EXTENDED);
 
         /* get a complete line */
         /* if the buffer overruns - throw data away */
         while (!found && !APR_BRIGADE_EMPTY(ctx->in)) {
             char *pos, *response;
             apr_size_t len, max;
@@ -578,13 +582,13 @@
                                    ap_escape_html(p, ctx->buffer),
                                    ap_escape_uri(p, filename),
                                    ap_escape_html(p, filename));
             }
         }
         /* Try a fallback for listings in the format of "ls -s1" */
-        else if (0 == ap_regexec(re, ctx->buffer, 3, re_result, 0)) {
+        else if (0 == ap_regexec(re, ctx->buffer, LS_REG_MATCH, re_result, 0)) {
 
             filename = apr_pstrndup(p, &ctx->buffer[re_result[2].rm_so], re_result[2].rm_eo - re_result[2].rm_so);
 
             str = apr_pstrcat(p, ap_escape_html(p, apr_pstrndup(p, ctx->buffer, re_result[2].rm_so)),
                               "<a href=\"", ap_escape_uri(p, filename), "\">",
                               ap_escape_html(p, filename), "</a>\n", NULL);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/mod_ssl.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/mod_ssl.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/mod_ssl.h	2003-05-17 02:12:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/mod_ssl.h	2003-09-16 09:00:06.000000000 +0800
@@ -434,13 +434,12 @@
     apr_shm_t      *pSessionCacheDataMM;
     apr_rmm_t      *pSessionCacheDataRMM;
     apr_table_t    *tSessionCacheDataTable;
     ssl_mutexmode_t nMutexMode;
     apr_lockmech_e  nMutexMech;
     const char     *szMutexFile;
-    BOOL            ChownMutexFile;
     apr_global_mutex_t   *pMutex;
     apr_array_header_t   *aRandSeed;
     apr_hash_t     *tVHostKeys;
     void           *pTmpKeys[SSL_TMP_KEY_MAX];
     apr_hash_t     *tPublicCert;
     apr_hash_t     *tPrivateKey;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_config.c	2003-03-31 07:17:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_config.c	2003-09-16 09:00:06.000000000 +0800
@@ -98,13 +98,12 @@
     mc->pSessionCacheDataMM    = NULL;
     mc->pSessionCacheDataRMM   = NULL;
     mc->tSessionCacheDataTable = NULL;
     mc->nMutexMode             = SSL_MUTEXMODE_UNSET;
     mc->nMutexMech             = APR_LOCK_DEFAULT;
     mc->szMutexFile            = NULL;
-    mc->ChownMutexFile         = FALSE;
     mc->pMutex                 = NULL;
     mc->aRandSeed              = apr_array_make(pool, 4,
                                                 sizeof(ssl_randseed_t));
     mc->tVHostKeys             = apr_hash_make(pool);
     mc->tPrivateKey            = apr_hash_make(pool);
     mc->tPublicCert            = apr_hash_make(pool);
@@ -399,13 +398,12 @@
                                arg+6, NULL);
         }
         mc->nMutexMode  = SSL_MUTEXMODE_USED;
         mc->nMutexMech = APR_LOCK_FLOCK;
         mc->szMutexFile = apr_psprintf(mc->pPool, "%s.%lu",
                                        file, (unsigned long)getpid());
-        mc->ChownMutexFile = TRUE;
     }
 #endif
 #if APR_HAS_FCNTL_SERIALIZE
     else if (strlen(arg) > 6 && strcEQn(arg, "fcntl:", 6)) {
         const char *file = ap_server_root_relative(cmd->pool, arg+6);
         if (!file) {
@@ -446,13 +444,12 @@
             return apr_pstrcat(cmd->pool, "Invalid SSLMutex file: path ", 
                                arg+5, NULL);
         }
         mc->nMutexMode  = SSL_MUTEXMODE_USED;
 #if APR_HAS_FLOCK_SERIALIZE
         mc->nMutexMech  = APR_LOCK_FLOCK;
-        mc->ChownMutexFile = TRUE;
 #endif
 #if APR_HAS_FCNTL_SERIALIZE
         mc->nMutexMech  = APR_LOCK_FCNTL;
 #endif
         mc->szMutexFile =
             apr_psprintf(mc->pPool, "%s.%lu",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_io.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_io.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_io.c	2003-04-06 03:04:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_io.c	2003-09-28 02:47:05.000000000 +0800
@@ -777,21 +777,21 @@
 
 static apr_status_t ssl_filter_write(ap_filter_t *f,
                                      const char *data,
                                      apr_size_t len)
 {
     ssl_filter_ctx_t *filter_ctx = f->ctx;
-    bio_filter_out_ctx_t *outctx = 
-           (bio_filter_out_ctx_t *)(filter_ctx->pbioWrite->ptr);
+    bio_filter_out_ctx_t *outctx;
     int res;
 
     /* write SSL */
     if (filter_ctx->pssl == NULL) {
         return APR_EGENERAL;
     }
 
+    outctx = (bio_filter_out_ctx_t *)filter_ctx->pbioWrite->ptr;
     res = SSL_write(filter_ctx->pssl, (unsigned char *)data, len);
 
     if (res < 0) {
         int ssl_err = SSL_get_error(filter_ctx->pssl, res);
         conn_rec *c = (conn_rec*)SSL_get_app_data(outctx->filter_ctx->pssl);
 
@@ -1000,12 +1000,17 @@
         sslconn->client_cert = NULL;
     }
     SSL_free(ssl);
     sslconn->ssl = NULL;
     filter_ctx->pssl = NULL; /* so filters know we've been shutdown */
 
+    if (abortive) {
+        /* prevent any further I/O */
+        c->aborted = 1;
+    }
+
     return APR_SUCCESS;
 }
 
 static apr_status_t ssl_io_filter_cleanup(void *data)
 {
     apr_status_t ret;
@@ -1272,23 +1277,32 @@
 
 static apr_status_t ssl_io_filter_output(ap_filter_t *f,
                                          apr_bucket_brigade *bb)
 {
     apr_status_t status = APR_SUCCESS;
     ssl_filter_ctx_t *filter_ctx = f->ctx;
+    bio_filter_in_ctx_t *inctx;
 
     if (f->c->aborted) {
         apr_brigade_cleanup(bb);
         return APR_ECONNABORTED;
     }
 
     if (!filter_ctx->pssl) {
         /* ssl_filter_io_shutdown was called */
         return ap_pass_brigade(f->next, bb);
     }
 
+    inctx = (bio_filter_in_ctx_t *)filter_ctx->pbioRead->ptr;
+    /* When we are the writer, we must initialize the inctx
+     * mode so that we block for any required ssl input, because
+     * output filtering is always nonblocking.
+     */
+    inctx->mode = AP_MODE_READBYTES;
+    inctx->block = APR_BLOCK_READ;
+
     if ((status = ssl_io_filter_connect(filter_ctx)) != APR_SUCCESS) {
         return ssl_io_filter_error(f, bb, status);
     }
 
     while (!APR_BRIGADE_EMPTY(bb)) {
         apr_bucket *bucket = APR_BRIGADE_FIRST(bb);
@@ -1356,21 +1370,22 @@
 
     filter_ctx->pInputFilter = ap_add_input_filter(ssl_io_filter, inctx, NULL, c);
 
     filter_ctx->pbioRead = BIO_new(&bio_filter_in_method);
     filter_ctx->pbioRead->ptr = (void *)inctx;
 
-    inctx->filter_ctx = filter_ctx;
     inctx->ssl = ssl;
     inctx->bio_out = filter_ctx->pbioWrite;
     inctx->f = filter_ctx->pInputFilter;
-    inctx->bb = apr_brigade_create(c->pool, c->bucket_alloc);
-
+    inctx->rc = APR_SUCCESS;
+    inctx->mode = AP_MODE_READBYTES;
     inctx->cbuf.length = 0;
-
+    inctx->bb = apr_brigade_create(c->pool, c->bucket_alloc);
+    inctx->block = APR_BLOCK_READ;
     inctx->pool = c->pool;
+    inctx->filter_ctx = filter_ctx;
 }
 
 void ssl_io_filter_init(conn_rec *c, SSL *ssl)
 {
     ssl_filter_ctx_t *filter_ctx;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_kernel.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_kernel.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_kernel.c	2003-07-07 22:51:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_kernel.c	2003-09-28 02:47:05.000000000 +0800
@@ -693,12 +693,13 @@
             SSL_do_handshake(ssl);
 
             if (SSL_get_state(ssl) != SSL_ST_OK) {
                 ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
                              "Re-negotiation request failed");
 
+                r->connection->aborted = 1;
                 return HTTP_FORBIDDEN;
             }
 
             ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                          "Awaiting re-negotiation handshake");
 
@@ -707,12 +708,13 @@
 
             if (SSL_get_state(ssl) != SSL_ST_OK) {
                 ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
                              "Re-negotiation handshake failed: "
                         "Not accepted by client!?");
 
+                r->connection->aborted = 1;
                 return HTTP_FORBIDDEN;
             }
         }
 
         /*
          * Remember the peer certificate's DN
@@ -837,12 +839,20 @@
         (apr_table_get(r->notes, "ssl-access-forbidden")))
     {
         return HTTP_FORBIDDEN;
     }
 
     /*
+     * We decline when we are in a subrequest.  The Authorization header
+     * would already be present if it was added in the main request.
+     */
+    if (!ap_is_initial_req(r)) {
+        return DECLINED;
+    }
+
+    /*
      * Make sure the user is not able to fake the client certificate
      * based authentication by just entering an X.509 Subject DN
      * ("/XX=YYY/XX=YYY/..") as the username and "password" as the
      * password.
      */
     if ((auth_line = apr_table_get(r->headers_in, "Authorization"))) {
@@ -853,12 +863,14 @@
 
             auth_line = ap_pbase64decode(r->pool, auth_line);
             username = ap_getword_nulls(r->pool, &auth_line, ':');
             password = auth_line;
 
             if ((username[0] == '/') && strEQ(password, "password")) {
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                    "Encountered FakeBasicAuth spoof: %s", username);
                 return HTTP_FORBIDDEN;
             }
         }
     }
 
     /*
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_mutex.c	2003-03-31 22:37:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_mutex.c	2003-09-16 09:00:06.000000000 +0800
@@ -60,12 +60,13 @@
                                   Christmas and Halloween
                                   because DEC 25 = OCT 31.''
                                              -- Unknown     */
 #include "mod_ssl.h"
 #if !defined(OS2) && !defined(WIN32) && !defined(BEOS) && !defined(NETWARE)
 #include "unixd.h"
+#define MOD_SSL_SET_MUTEX_PERMS /* XXX Apache should define something */
 #endif
 
 int ssl_mutex_init(server_rec *s, apr_pool_t *p)
 {
     SSLModConfigRec *mc = myModConfig(s);
     apr_status_t rv;
@@ -81,31 +82,20 @@
                          mc->szMutexFile);
         else
             ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
                          "Cannot create SSLMutex");
         return FALSE;
     }
-#if !defined(OS2) && !defined(WIN32) && !defined(BEOS) && !defined(NETWARE)
-    if (mc->szMutexFile && mc->ChownMutexFile == TRUE)
-        chown(mc->szMutexFile, unixd_config.user_id, -1);
-#endif
 
-#if APR_HAS_SYSVSEM_SERIALIZE
-#if APR_USE_SYSVSEM_SERIALIZE
-    if (mc->nMutexMech == APR_LOCK_DEFAULT || 
-        mc->nMutexMech == APR_LOCK_SYSVSEM) {
-#else
-    if (mc->nMutexMech == APR_LOCK_SYSVSEM) {
-#endif
-        rv = unixd_set_global_mutex_perms(mc->pMutex);
-        if (rv != APR_SUCCESS) {
-            ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
-                         "Could not set permissions on ssl_mutex; check User "
-                         "and Group directives");
-            return FALSE;
-        }
+#ifdef MOD_SSL_SET_MUTEX_PERMS
+    rv = unixd_set_global_mutex_perms(mc->pMutex);
+    if (rv != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Could not set permissions on ssl_mutex; check User "
+                     "and Group directives");
+        return FALSE;
     }
 #endif
     return TRUE;
 }
 
 int ssl_mutex_reinit(server_rec *s, apr_pool_t *p)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_vars.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_vars.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_engine_vars.c	2003-02-04 01:31:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_engine_vars.c	2003-09-16 21:37:33.000000000 +0800
@@ -287,13 +287,13 @@
     }
     else if (ssl != NULL && strlen(var) >= 6 && strcEQn(var, "CIPHER", 6)) {
         result = ssl_var_lookup_ssl_cipher(p, c, var+6);
     }
     else if (ssl != NULL && strlen(var) > 18 && strcEQn(var, "CLIENT_CERT_CHAIN_", 18)) {
         sk = SSL_get_peer_cert_chain(ssl);
-        result = ssl_var_lookup_ssl_cert_chain(p, sk, var+17);
+        result = ssl_var_lookup_ssl_cert_chain(p, sk, var+18);
     }
     else if (ssl != NULL && strcEQ(var, "CLIENT_VERIFY")) {
         result = ssl_var_lookup_ssl_cert_verify(p, c);
     }
     else if (ssl != NULL && strlen(var) > 7 && strcEQn(var, "CLIENT_", 7)) {
         if ((xs = SSL_get_peer_certificate(ssl)) != NULL) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_scache_dbm.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_scache_dbm.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/modules/ssl/ssl_scache_dbm.c	2003-02-04 01:31:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/modules/ssl/ssl_scache_dbm.c	2003-09-10 22:20:20.000000000 +0800
@@ -142,35 +142,50 @@
     UCHAR ucaData[SSL_SESSION_MAX_DER];
     int nData;
     UCHAR *ucp;
     apr_status_t rv;
 
     /* streamline session data */
-    if ((nData = i2d_SSL_SESSION(sess, NULL)) > sizeof(ucaData))
+    if ((nData = i2d_SSL_SESSION(sess, NULL)) > sizeof(ucaData)) {
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "streamline session data size too large: %d > %d",
+                 nData, sizeof(ucaData));
         return FALSE;
+    }
     ucp = ucaData;
     i2d_SSL_SESSION(sess, &ucp);
 
     /* be careful: do not try to store too much bytes in a DBM file! */
 #ifdef PAIRMAX
-    if ((idlen + nData) >= PAIRMAX)
+    if ((idlen + nData) >= PAIRMAX) {
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "data size too large for DBM session cache: %d >= %d",
+                 (idlen + nData), PAIRMAX);
         return FALSE;
+    }
 #else
-    if ((idlen + nData) >= 950 /* at least less than approx. 1KB */)
+    if ((idlen + nData) >= 950 /* at least less than approx. 1KB */) {
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "data size too large for DBM session cache: %d >= %d",
+                 (idlen + nData), 950);
         return FALSE;
+    }
 #endif
 
     /* create DBM key */
     dbmkey.dptr  = (char *)id;
     dbmkey.dsize = idlen;
 
     /* create DBM value */
     dbmval.dsize = sizeof(time_t) + nData;
     dbmval.dptr  = (char *)malloc(dbmval.dsize);
-    if (dbmval.dptr == NULL)
+    if (dbmval.dptr == NULL) {
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "malloc error creating DBM value");
         return FALSE;
+    }
     memcpy((char *)dbmval.dptr, &expiry, sizeof(time_t));
     memcpy((char *)dbmval.dptr+sizeof(time_t), ucaData, nData);
 
     /* and store it to the DBM file */
     ssl_mutex_on(s);
     if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/os/unix/unixd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/os/unix/unixd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/os/unix/unixd.c	2003-05-16 04:28:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/os/unix/unixd.c	2003-09-16 09:00:06.000000000 +0800
@@ -414,41 +414,76 @@
     }
 
     return ap_unix_create_privileged_process(newproc, progname, args, env,
                                               attr, ugid, p);
 }
 
+/* XXX move to APR and externalize (but implement differently :) ) */
+static apr_lockmech_e proc_mutex_mech(apr_proc_mutex_t *pmutex)
+{
+    const char *mechname = apr_proc_mutex_name(pmutex);
+
+    if (!strcmp(mechname, "sysvsem")) {
+        return APR_LOCK_SYSVSEM;
+    }
+    else if (!strcmp(mechname, "flock")) {
+        return APR_LOCK_FLOCK;
+    }
+    return APR_LOCK_DEFAULT;
+}
+
 AP_DECLARE(apr_status_t) unixd_set_proc_mutex_perms(apr_proc_mutex_t *pmutex)
 {
-/* MPM shouldn't call us unless we're actually using a SysV sem;
- * this is just to avoid compile issues on systems without that
- * feature
- */
+    if (!geteuid()) {
+        apr_lockmech_e mech = proc_mutex_mech(pmutex);
+
+        switch(mech) {
 #if APR_HAS_SYSVSEM_SERIALIZE
-    apr_os_proc_mutex_t ospmutex;
+        case APR_LOCK_SYSVSEM:
+        {
+            apr_os_proc_mutex_t ospmutex;
 #if !APR_HAVE_UNION_SEMUN
-    union semun {
-        long val;
-        struct semid_ds *buf;
-        ushort *array;
-    };
+            union semun {
+                long val;
+                struct semid_ds *buf;
+                ushort *array;
+            };
+#endif
+            union semun ick;
+            struct semid_ds buf;
+        
+            apr_os_proc_mutex_get(&ospmutex, pmutex);
+            buf.sem_perm.uid = unixd_config.user_id;
+            buf.sem_perm.gid = unixd_config.group_id;
+            buf.sem_perm.mode = 0600;
+            ick.buf = &buf;
+            if (semctl(ospmutex.crossproc, 0, IPC_SET, ick) < 0) {
+                return errno;
+            }
+        }
+        break;
 #endif
-    union semun ick;
-    struct semid_ds buf;
+#if APR_HAS_FLOCK_SERIALIZE
+        case APR_LOCK_FLOCK:
+        {
+            const char *lockfile = apr_proc_mutex_lockfile(pmutex);
 
-    if (!geteuid()) {
-        apr_os_proc_mutex_get(&ospmutex, pmutex);
-        buf.sem_perm.uid = unixd_config.user_id;
-        buf.sem_perm.gid = unixd_config.group_id;
-        buf.sem_perm.mode = 0600;
-        ick.buf = &buf;
-        if (semctl(ospmutex.crossproc, 0, IPC_SET, ick) < 0) {
-            return errno;
+            if (lockfile) {
+                if (chown(lockfile, unixd_config.user_id,
+                          -1 /* no gid change */) < 0) {
+                    return errno;
+                }
+            }
         }
-    }
+        break;
 #endif
+        default:
+            /* do nothing */
+            break;
+        }
+    }
     return APR_SUCCESS;
 }
 
 AP_DECLARE(apr_status_t) unixd_set_global_mutex_perms(apr_global_mutex_t *gmutex)
 {
 #if !APR_PROC_MUTEX_IS_GLOBAL
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/os/unix/unixd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/os/unix/unixd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/os/unix/unixd.h	2003-02-04 01:31:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/os/unix/unixd.h	2003-09-16 09:00:06.000000000 +0800
@@ -117,12 +117,22 @@
 AP_DECLARE(const char *) unixd_set_group(cmd_parms *cmd, void *dummy, 
                                          const char *arg);
 #if defined(RLIMIT_CPU) || defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_NPROC) || defined(RLIMIT_AS)
 AP_DECLARE(void) unixd_set_rlimit(cmd_parms *cmd, struct rlimit **plimit,
                            const char *arg, const char * arg2, int type);
 #endif
+
+/**
+ * One of the functions to set mutex permissions should be called in
+ * the parent process on platforms that switch identity when the 
+ * server is started as root.
+ * If the child init logic is performed before switching identity
+ * (e.g., MPM setup for an accept mutex), it should only be called
+ * for SysV semaphores.  Otherwise, it is safe to call it for all
+ * mutex types.
+ */
 AP_DECLARE(apr_status_t) unixd_set_proc_mutex_perms(apr_proc_mutex_t *pmutex);
 AP_DECLARE(apr_status_t) unixd_set_global_mutex_perms(apr_global_mutex_t *gmutex);
 AP_DECLARE(apr_status_t) unixd_accept(void **accepted, ap_listen_rec *lr, apr_pool_t *ptrans);
 
 #ifdef HAVE_KILLPG
 #define unixd_killpg(x, y)	(killpg ((x), (y)))
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/config.c	2003-02-27 12:01:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/config.c	2003-10-14 11:43:18.000000000 +0800
@@ -923,12 +923,15 @@
 
     if (cmd_name[1] != '/') {
         char *lastc = cmd_name + strlen(cmd_name) - 1;
         if (*lastc == '>') {
             *lastc = '\0' ;
         }
+        if (cmd_name[0] == '<' && *args == '\0') {
+            args = ">";
+        }
     }
 
     newdir = apr_pcalloc(p, sizeof(ap_directive_t));
     newdir->filename = parms->config_file->name;
     newdir->line_num = parms->config_file->line_number;
     newdir->directive = cmd_name;
@@ -1439,70 +1442,29 @@
     const fnames *f1 = fn1;
     const fnames *f2 = fn2;
 
     return strcmp(f1->fname,f2->fname);
 }
 
-AP_DECLARE(void) ap_process_resource_config(server_rec *s, const char *fname,
-                                            ap_directive_t **conftree,
-                                            apr_pool_t *p,
-                                            apr_pool_t *ptemp)
+static void process_resource_config_nofnmatch(server_rec *s, const char *fname,
+                                              ap_directive_t **conftree,
+                                              apr_pool_t *p,
+                                              apr_pool_t *ptemp)
 {
     cmd_parms parms;
-    apr_finfo_t finfo;
-    const char *errmsg;
     ap_configfile_t *cfp;
-    int ispatt;
-
-    /* XXX: lstat() won't work on the wildcard pattern...
-     */
-
-    /* don't require conf/httpd.conf if we have a -C or -c switch */
-    if ((ap_server_pre_read_config->nelts
-        || ap_server_post_read_config->nelts)
-        && !(strcmp(fname, ap_server_root_relative(p, SERVER_CONFIG_FILE)))) {
-        if (apr_lstat(&finfo, fname, APR_FINFO_TYPE, p) != APR_SUCCESS)
-            return;
-    }
+    const char *errmsg;
 
-    ispatt = apr_fnmatch_test(fname);
-    if (ispatt || ap_is_rdirectory(p, fname)) {
+    if (ap_is_rdirectory(p, fname)) {
         apr_dir_t *dirp;
         apr_finfo_t dirent;
         int current;
         apr_array_header_t *candidates = NULL;
         fnames *fnew;
         apr_status_t rv;
-        char errmsg[120], *path = apr_pstrdup(p, fname), *pattern = NULL;
-
-        if (ispatt) {
-            pattern = ap_strrchr(path, '/');
-        
-            AP_DEBUG_ASSERT(pattern != NULL); /* path must be absolute. */
-        
-            *pattern++ = '\0';
-            
-            if (apr_fnmatch_test(path)) {
-                fprintf(stderr, "%s: wildcard patterns not allowed in Include "
-                        "%s\n", ap_server_argv0, fname);
-                exit(1);
-            }
-
-            if (!ap_is_rdirectory(p, path)){ 
-                fprintf(stderr, "%s: Include directory '%s' not found",
-                        ap_server_argv0, path);
-                exit(1);
-            }
-            
-            if (!apr_fnmatch_test(pattern)) {
-                fprintf(stderr, "%s: must include a wildcard pattern "
-                        "for Include %s\n", ap_server_argv0, fname);
-                exit(1);
-            }
-
-        }
+        char errmsg[120], *path = apr_pstrdup(p, fname);
 
         /*
          * first course of business is to grok all the directory
          * entries here and store 'em away. Recall we need full pathnames
          * for this.
          */
@@ -1515,16 +1477,13 @@
         }
 
         candidates = apr_array_make(p, 1, sizeof(fnames));
         while (apr_dir_read(&dirent, APR_FINFO_DIRENT, dirp) == APR_SUCCESS) {
             /* strip out '.' and '..' */
             if (strcmp(dirent.name, ".")
-                && strcmp(dirent.name, "..")
-                && (!ispatt ||
-                    apr_fnmatch(pattern, dirent.name, 
-                                FNM_PERIOD) == APR_SUCCESS)) {
+                && strcmp(dirent.name, "..")) {
                 fnew = (fnames *) apr_array_push(candidates);
                 fnew->fname = ap_make_full_path(p, path, dirent.name);
             }
         }
 
         apr_dir_close(dirp);
@@ -1535,13 +1494,14 @@
             /*
              * Now recurse these... we handle errors and subdirectories
              * via the recursion, which is nice
              */
             for (current = 0; current < candidates->nelts; ++current) {
                 fnew = &((fnames *) candidates->elts)[current];
-                ap_process_resource_config(s, fnew->fname, conftree, p, ptemp);
+                process_resource_config_nofnmatch(s, fnew->fname, conftree, p,
+                                                  ptemp);
             }
         }
 
         return;
     }
 
@@ -1572,12 +1531,113 @@
         ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s", errmsg);
         exit(1);
     }
 
     ap_cfg_closefile(cfp);
+
+    return;
+}
+
+AP_DECLARE(void) ap_process_resource_config(server_rec *s, const char *fname,
+                                            ap_directive_t **conftree,
+                                            apr_pool_t *p,
+                                            apr_pool_t *ptemp)
+{
+    /* XXX: lstat() won't work on the wildcard pattern...
+     */
+
+    /* don't require conf/httpd.conf if we have a -C or -c switch */
+    if ((ap_server_pre_read_config->nelts
+        || ap_server_post_read_config->nelts)
+        && !(strcmp(fname, ap_server_root_relative(p, SERVER_CONFIG_FILE)))) {
+        apr_finfo_t finfo;
+
+        if (apr_lstat(&finfo, fname, APR_FINFO_TYPE, p) != APR_SUCCESS)
+            return;
+    }
+
+    if (!apr_fnmatch_test(fname)) {
+        process_resource_config_nofnmatch(s, fname, conftree, p, ptemp);
+    }
+    else {
+        apr_dir_t *dirp;
+        apr_finfo_t dirent;
+        int current;
+        apr_array_header_t *candidates = NULL;
+        fnames *fnew;
+        apr_status_t rv;
+        char errmsg[120], *path = apr_pstrdup(p, fname), *pattern = NULL;
+
+        pattern = ap_strrchr(path, '/');
+
+        AP_DEBUG_ASSERT(pattern != NULL); /* path must be absolute. */
+
+        *pattern++ = '\0';
+
+        if (apr_fnmatch_test(path)) {
+            fprintf(stderr, "%s: wildcard patterns not allowed in Include "
+                    "%s\n", ap_server_argv0, fname);
+            exit(1);
+        }
+
+        if (!ap_is_rdirectory(p, path)){ 
+            fprintf(stderr, "%s: Include directory '%s' not found",
+                    ap_server_argv0, path);
+            exit(1);
+        }
+
+        if (!apr_fnmatch_test(pattern)) {
+            fprintf(stderr, "%s: must include a wildcard pattern "
+                    "for Include %s\n", ap_server_argv0, fname);
+            exit(1);
+        }
+
+        /*
+         * first course of business is to grok all the directory
+         * entries here and store 'em away. Recall we need full pathnames
+         * for this.
+         */
+        rv = apr_dir_open(&dirp, path, p);
+        if (rv != APR_SUCCESS) {
+            fprintf(stderr, "%s: could not open config directory %s: %s\n",
+                    ap_server_argv0, path,
+                    apr_strerror(rv, errmsg, sizeof errmsg));
+            exit(1);
+        }
+
+        candidates = apr_array_make(p, 1, sizeof(fnames));
+        while (apr_dir_read(&dirent, APR_FINFO_DIRENT, dirp) == APR_SUCCESS) {
+            /* strip out '.' and '..' */
+            if (strcmp(dirent.name, ".")
+                && strcmp(dirent.name, "..")
+                && (apr_fnmatch(pattern, dirent.name,
+                                FNM_PERIOD) == APR_SUCCESS)) {
+                fnew = (fnames *) apr_array_push(candidates);
+                fnew->fname = ap_make_full_path(p, path, dirent.name);
+            }
+        }
+
+        apr_dir_close(dirp);
+        if (candidates->nelts != 0) {
+            qsort((void *) candidates->elts, candidates->nelts,
+                  sizeof(fnames), fname_alphasort);
+
+            /*
+             * Now recurse these... we handle errors and subdirectories
+             * via the recursion, which is nice
+             */
+            for (current = 0; current < candidates->nelts; ++current) {
+                fnew = &((fnames *) candidates->elts)[current];
+                process_resource_config_nofnmatch(s, fnew->fname, conftree, p,
+                                                  ptemp);
+            }
+        }
+    }
+
+    return;
 }
 
 AP_DECLARE(void) ap_process_config_tree(server_rec *s,
                                         ap_directive_t *conftree,
                                         apr_pool_t *p, apr_pool_t *ptemp)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/core.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/core.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/core.c	2003-07-01 09:25:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/core.c	2003-08-23 04:57:48.000000000 +0800
@@ -4041,13 +4041,13 @@
                     nbytes += n;
                 }
             }
         }
 
 
-        /* Completed iterating over the brigades, now determine if we want
+        /* Completed iterating over the brigade, now determine if we want
          * to buffer the brigade or send the brigade out on the network.
          *
          * Save if we haven't accumulated enough bytes to send, and:
          *
          *   1) we didn't see a file, we don't have more passes over the
          *      brigade to perform,  AND we didn't stop at a FLUSH bucket.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/beos/beos.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/beos/beos.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/beos/beos.c	2003-02-04 01:32:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/beos/beos.c	2003-09-06 03:00:52.000000000 +0800
@@ -387,24 +387,24 @@
     apr_allocator_max_free_set(allocator, ap_max_mem_free);
     apr_pool_create_ex(&ptrans, tpool, NULL, allocator);
     apr_allocator_owner_set(allocator, ptrans);
 
     apr_pool_tag(ptrans, "transaction");
 
+    bucket_alloc = apr_bucket_alloc_create_ex(allocator);
+
     apr_thread_mutex_lock(worker_thread_count_mutex);
     worker_thread_count++;
     apr_thread_mutex_unlock(worker_thread_count_mutex);
 
     (void) ap_update_child_status_from_indexes(0, child_slot, SERVER_STARTING,
                                                (request_rec*)NULL);
                                   
     apr_poll_setup(&pollset, num_listening_sockets + 1, tpool);
     for(n=0 ; n <= num_listening_sockets ; n++)
         apr_poll_socket_add(pollset, listening_sockets[n], APR_POLLIN);
-	
-    bucket_alloc = apr_bucket_alloc_create(tpool);
 
     while (1) {
         /* If we're here, then chances are (unless we're the first thread created) 
          * we're going to be held up in the accept mutex, so doing this here
          * shouldn't hurt performance.
          */
@@ -1044,12 +1044,15 @@
     ap_threads_to_start = DEFAULT_START_THREADS;
     min_spare_threads = DEFAULT_MIN_FREE_THREADS;
     max_spare_threads = DEFAULT_MAX_FREE_THREADS;
     ap_thread_limit = HARD_THREAD_LIMIT;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_max_requests_per_thread = DEFAULT_MAX_REQUESTS_PER_THREAD;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/leader/leader.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/leader/leader.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/leader/leader.c	2003-02-04 01:32:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/leader/leader.c	2003-09-06 05:26:56.000000000 +0800
@@ -778,15 +778,16 @@
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
     free(ti);
 
     apr_allocator_create(&allocator);
     apr_allocator_max_free_set(allocator, ap_max_mem_free);
+    /* XXX: why is ptrans's parent not tpool?  --jcw 08/2003 */
     apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
     apr_allocator_owner_set(allocator, ptrans);
-    bucket_alloc = apr_bucket_alloc_create(tpool);
+    bucket_alloc = apr_bucket_alloc_create_ex(allocator);
 
     apr_poll_setup(&pollset, num_listensocks, tpool);
     for(lr = ap_listeners ; lr != NULL ; lr = lr->next)
         apr_poll_socket_add(pollset, lr->sd, APR_POLLIN);
 
     /* TODO: Switch to a system where threads reuse the results from earlier
@@ -1796,12 +1797,15 @@
     ap_daemons_limit = server_limit;
     ap_threads_per_child = DEFAULT_THREADS_PER_CHILD;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
@@ -1908,13 +1912,13 @@
                     max_clients, ap_daemons_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
-                    server_limit);
+                    server_limit * ap_threads_per_child);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
         ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/perchild/perchild.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/perchild/perchild.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/perchild/perchild.c	2003-02-04 01:32:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/perchild/perchild.c	2003-09-06 03:00:52.000000000 +0800
@@ -1594,12 +1594,15 @@
     max_spare_threads = DEFAULT_MAX_SPARE_THREAD;
     max_threads = thread_limit;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     curr_child_num = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     /* we need to know ServerLimit and ThreadLimit before we start processing
      * the tree because we need to already have allocated child_info_table
      */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/threadpool/threadpool.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/threadpool/threadpool.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/experimental/threadpool/threadpool.c	2003-02-04 01:32:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/experimental/threadpool/threadpool.c	2003-09-06 05:26:57.000000000 +0800
@@ -1044,18 +1044,16 @@
     free(ti);
 
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
     apr_allocator_create(&allocator);
     apr_allocator_max_free_set(allocator, ap_max_mem_free);
+    /* XXX: why is ptrans's parent not tpool? --jcw 08/2003 */
     apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
     apr_allocator_owner_set(allocator, ptrans);
-
-    /* XXX: What happens if this is allocated from the
-     * single-thread-optimized ptrans pool? -aaron */
-    bucket_alloc = apr_bucket_alloc_create(tpool);
+    bucket_alloc = apr_bucket_alloc_create_ex(allocator);
 
     wakeup = (worker_wakeup_info *)apr_palloc(tpool, sizeof(*wakeup));
     wakeup->pool = ptrans;
     if ((rv = apr_thread_cond_create(&wakeup->cond, tpool)) != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
                      "apr_thread_cond_create failed. Attempting to shutdown "
@@ -1269,13 +1267,13 @@
             /* listener not dead yet */
             apr_sleep(APR_USEC_PER_SEC / 2);
             wakeup_listener();
             ++iter;
         }
         if (iter >= 10) {
-            ap_log_error(APLOG_MARK, APLOG_CRIT, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                          "the listener thread didn't exit");
         }
         else {
             rv = apr_thread_join(&thread_rv, listener);
             if (rv != APR_SUCCESS) {
                 ap_log_error(APLOG_MARK, APLOG_CRIT, rv, ap_server_conf,
@@ -2053,12 +2051,15 @@
     ap_daemons_limit = server_limit;
     ap_threads_per_child = DEFAULT_THREADS_PER_CHILD;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
@@ -2165,13 +2166,13 @@
                     max_clients, ap_daemons_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
-                    server_limit);
+                    server_limit * ap_threads_per_child);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
         ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpm.h	2003-02-04 01:32:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpm.h	2003-09-09 06:44:40.000000000 +0800
@@ -68,8 +68,9 @@
 #define MPM_NAME "MPMT_OS2"
 
 extern server_rec *ap_server_conf;
 #define AP_MPM_WANT_SET_PIDFILE
 #define AP_MPM_WANT_SET_MAX_REQUESTS
 #define AP_MPM_DISABLE_NAGLE_ACCEPTED_SOCK
+#define AP_MPM_WANT_SET_MAX_MEM_FREE
 
 #endif /* APACHE_MPM_MPMT_OS2_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpmt_os2.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpmt_os2.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpmt_os2.c	2003-02-04 01:32:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpmt_os2.c	2003-09-06 03:00:52.000000000 +0800
@@ -509,12 +509,15 @@
     ap_thread_limit = HARD_THREAD_LIMIT;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
     ap_min_spare_threads = DEFAULT_MIN_SPARE_THREAD;
     ap_max_spare_threads = DEFAULT_MAX_SPARE_THREAD;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     return OK;
 }
 
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpmt_os2_child.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpmt_os2_child.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/mpmt_os2/mpmt_os2_child.c	2003-02-04 01:32:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/mpmt_os2/mpmt_os2_child.c	2003-09-06 03:00:52.000000000 +0800
@@ -399,12 +399,13 @@
 
 static void worker_main(void *vpArg)
 {
     long conn_id;
     conn_rec *current_conn;
     apr_pool_t *pconn;
+    apr_allocator_t *allocator;
     apr_bucket_alloc_t *bucket_alloc;
     worker_args_t *worker_args;
     HQUEUE workq;
     PID owner;
     int rc;
     REQUESTDATA rd;
@@ -427,16 +428,19 @@
     }
 
     conn_id = ID_FROM_CHILD_THREAD(child_slot, thread_slot);
     ap_update_child_status_from_indexes(child_slot, thread_slot, SERVER_READY, 
                                         NULL);
 
+    apr_allocator_create(&allocator);
+    apr_allocator_max_free_set(allocator, ap_max_mem_free);
+    bucket_alloc = apr_bucket_alloc_create_ex(allocator);
+
     while (rc = DosReadQueue(workq, &rd, &len, (PPVOID)&worker_args, 0, DCWW_WAIT, &priority, NULLHANDLE),
            rc == 0 && rd.ulData != WORKTYPE_EXIT) {
         pconn = worker_args->pconn;
-        bucket_alloc = apr_bucket_alloc_create(pconn);
         ap_create_sb_handle(&sbh, pconn, child_slot, thread_slot);
         current_conn = ap_run_create_connection(pconn, ap_server_conf,
                                                 worker_args->conn_sd, conn_id,
                                                 sbh, bucket_alloc);
 
         if (current_conn) {
@@ -448,12 +452,15 @@
         ap_update_child_status_from_indexes(child_slot, thread_slot, 
                                             SERVER_READY, NULL);
     }
 
     ap_update_child_status_from_indexes(child_slot, thread_slot, SERVER_DEAD, 
                                         NULL);
+
+    apr_bucket_alloc_destroy(bucket_alloc);
+    apr_allocator_destroy(allocator);
 }
 
 
 
 static void server_maintenance(void *vpArg)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/netware/mpm_netware.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/netware/mpm_netware.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/netware/mpm_netware.c	2003-06-04 03:48:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/netware/mpm_netware.c	2003-09-06 06:55:04.000000000 +0800
@@ -209,20 +209,20 @@
 static int volatile restart_pending;
 static int volatile is_graceful;
 static int volatile wait_to_finish=1;
 ap_generation_t volatile ap_my_generation=0;
 
 /* a clean exit from a child with proper cleanup */
-static void clean_child_exit(int code, int worker_num, apr_pool_t *pthrd, 
+static void clean_child_exit(int code, int worker_num, apr_pool_t *ptrans, 
                              apr_bucket_alloc_t *bucket_alloc) __attribute__ ((noreturn));
-static void clean_child_exit(int code, int worker_num, apr_pool_t *pthrd, 
+static void clean_child_exit(int code, int worker_num, apr_pool_t *ptrans, 
                              apr_bucket_alloc_t *bucket_alloc)
 {
+    apr_bucket_alloc_destroy(bucket_alloc);
     if (!shutdown_pending) {
-        apr_bucket_alloc_destroy(bucket_alloc);
-        apr_pool_destroy(pthrd);
+        apr_pool_destroy(ptrans);
     }
 
     atomic_dec (&worker_thread_count);
     if (worker_num >=0)
         ap_update_child_status_from_indexes(0, worker_num, WORKER_DEAD, 
                                             (request_rec *) NULL);
@@ -356,13 +356,13 @@
 #endif
 
 /*static */
 void worker_main(void *arg)
 {
     ap_listen_rec *lr, *first_lr, *last_lr = NULL;
-    apr_pool_t *ptrans, *pthrd;
+    apr_pool_t *ptrans;
     apr_pool_t *pbucket;
     apr_allocator_t *allocator;
     apr_bucket_alloc_t *bucket_alloc;
     conn_rec *current_conn;
     apr_status_t stat = APR_EINIT;
     ap_sb_handle_t *sbh;
@@ -381,20 +381,17 @@
     tv.tv_sec = 1;
     tv.tv_usec = 0;
 
     apr_allocator_create(&allocator);
     apr_allocator_max_free_set(allocator, ap_max_mem_free);
 
-    apr_pool_create_ex(&pthrd, pmain, NULL, allocator);
-    apr_allocator_owner_set(allocator, pthrd);
-    apr_pool_tag(pthrd, "worker_thrd_pool");
-
-    apr_pool_create(&ptrans, pthrd);
+    apr_pool_create_ex(&ptrans, pmain, NULL, allocator);
+    apr_allocator_owner_set(allocator, ptrans);
     apr_pool_tag(ptrans, "transaction");
 
-    bucket_alloc = apr_bucket_alloc_create(pthrd);
+    bucket_alloc = apr_bucket_alloc_create_ex(allocator);
 
     atomic_inc (&worker_thread_count);
 
     while (!die_now) {
         /*
         * (Re)initialize this child to a pre-connection state.
@@ -402,26 +399,26 @@
         current_conn = NULL;
         apr_pool_clear(ptrans);
 
         if ((ap_max_requests_per_child > 0
             && requests_this_child++ >= ap_max_requests_per_child)) {
             DBPRINT1 ("\n**Thread slot %d is shutting down", my_worker_num);
-            clean_child_exit(0, my_worker_num, pthrd, bucket_alloc);
+            clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
         }
 
         ap_update_child_status_from_indexes(0, my_worker_num, WORKER_READY, 
                                             (request_rec *) NULL);
 
         /*
         * Wait for an acceptable connection to arrive.
         */
 
         for (;;) {
             if (shutdown_pending || restart_pending || (ap_scoreboard_image->servers[0][my_worker_num].status == WORKER_IDLE_KILL)) {
                 DBPRINT1 ("\nThread slot %d is shutting down\n", my_worker_num);
-                clean_child_exit(0, my_worker_num, pthrd, bucket_alloc);
+             	 clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
             }
 
             /* Check the listen queue on all sockets for requests */
             memcpy(&main_fds, &listenfds, sizeof(fd_set));
             srv = select(listenmaxfd + 1, &main_fds, NULL, NULL, &tv);
 
@@ -524,19 +521,19 @@
                         * the network is up again, and restart the children.
                         * Ben Hyde noted that temporary ENETDOWN situations
                         * occur in mobile IP.
                         */
                         ap_log_error(APLOG_MARK, APLOG_EMERG, stat, ap_server_conf,
                             "apr_accept: giving up.");
-                        clean_child_exit(APEXIT_CHILDFATAL, my_worker_num, pthrd, 
+                        clean_child_exit(APEXIT_CHILDFATAL, my_worker_num, ptrans, 
                                          bucket_alloc);
                 }
                 else {
                         ap_log_error(APLOG_MARK, APLOG_ERR, stat, ap_server_conf,
                             "apr_accept: (client socket)");
-                        clean_child_exit(1, my_worker_num, pthrd, bucket_alloc);
+                        clean_child_exit(1, my_worker_num, ptrans, bucket_alloc);
                 }
             }
         }
 
         ap_create_sb_handle(&sbh, ptrans, 0, my_worker_num);
         /*
@@ -549,13 +546,13 @@
         if (current_conn) {
             ap_process_connection(current_conn, csd);
             ap_lingering_close(current_conn);
         }
         request_count++;
     }
-    clean_child_exit(0, my_worker_num, pthrd, bucket_alloc);
+    clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
 }
 
 
 static int make_child(server_rec *s, int slot)
 {
     int tid;
@@ -1012,12 +1009,15 @@
     ap_threads_to_start = DEFAULT_START_THREADS;
     ap_threads_min_free = DEFAULT_MIN_FREE_THREADS;
     ap_threads_max_free = DEFAULT_MAX_FREE_THREADS;
     ap_threads_limit = HARD_THREAD_LIMIT;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     return OK;
 }
 
 static void netware_mpm_hooks(apr_pool_t *p)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/prefork/prefork.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/prefork/prefork.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/prefork/prefork.c	2003-07-07 22:51:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/prefork/prefork.c	2003-09-06 03:00:53.000000000 +0800
@@ -1260,12 +1260,15 @@
     ap_daemons_max_free = DEFAULT_MAX_FREE_DAEMON;
     ap_daemons_limit = server_limit;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/winnt/mpm_winnt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/winnt/mpm_winnt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/winnt/mpm_winnt.c	2003-02-04 01:32:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/winnt/mpm_winnt.c	2003-09-06 03:00:53.000000000 +0800
@@ -1383,12 +1383,15 @@
     }
 
     ap_listen_pre_config();
     ap_threads_per_child = DEFAULT_THREADS_PER_CHILD;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/worker/worker.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/worker/worker.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/mpm/worker/worker.c	2003-02-04 01:32:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/mpm/worker/worker.c	2003-09-06 05:26:57.000000000 +0800
@@ -888,14 +888,12 @@
     int is_idle = 0;
 
     free(ti);
 
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
-    bucket_alloc = apr_bucket_alloc_create(apr_thread_pool_get(thd));
-
     while (!workers_may_exit) {
         if (!is_idle) {
             rv = ap_queue_info_set_idle(worker_queue_info, last_ptrans);
             last_ptrans = NULL;
             if (rv != APR_SUCCESS) {
                 ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
@@ -941,24 +939,23 @@
                              "ap_queue_pop failed");
             }
             continue;
         }
         is_idle = 0;
         worker_sockets[thread_slot] = csd;
+        bucket_alloc = apr_bucket_alloc_create(ptrans);
         process_socket(ptrans, csd, process_slot, thread_slot, bucket_alloc);
         worker_sockets[thread_slot] = NULL;
         requests_this_child--; /* FIXME: should be synchronized - aaron */
         apr_pool_clear(ptrans);
         last_ptrans = ptrans;
     }
 
     ap_update_child_status_from_indexes(process_slot, thread_slot,
         (dying) ? SERVER_DEAD : SERVER_GRACEFUL, (request_rec *) NULL);
 
-    apr_bucket_alloc_destroy(bucket_alloc);
-
     apr_thread_exit(thd, APR_SUCCESS);
     return NULL;
 }
 
 static int check_signal(int signum)
 {
@@ -1141,13 +1138,13 @@
             /* listener not dead yet */
             apr_sleep(apr_time_make(0, 500000));
             wakeup_listener();
             ++iter;
         }
         if (iter >= 10) {
-            ap_log_error(APLOG_MARK, APLOG_CRIT, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                          "the listener thread didn't exit");
         }
         else {
             rv = apr_thread_join(&thread_rv, listener);
             if (rv != APR_SUCCESS) {
                 ap_log_error(APLOG_MARK, APLOG_CRIT, rv, ap_server_conf,
@@ -1916,12 +1913,15 @@
     ap_daemons_limit = server_limit;
     ap_threads_per_child = DEFAULT_THREADS_PER_CHILD;
     ap_pid_fname = DEFAULT_PIDLOG;
     ap_lock_fname = DEFAULT_LOCKFILE;
     ap_max_requests_per_child = DEFAULT_MAX_REQUESTS_PER_CHILD;
     ap_extended_status = 0;
+#ifdef AP_MPM_WANT_SET_MAX_MEM_FREE
+	ap_max_mem_free = APR_ALLOCATOR_MAX_FREE_UNLIMITED;
+#endif
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
@@ -2028,13 +2028,13 @@
                     max_clients, ap_daemons_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
-                    server_limit);
+                    server_limit * ap_threads_per_child);
        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
         ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/protocol.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/protocol.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/protocol.c	2003-04-19 04:30:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/protocol.c	2003-09-10 20:13:51.000000000 +0800
@@ -702,16 +702,13 @@
     apr_size_t last_len = 0;
     apr_size_t alloc_len = 0;
     char *field;
     char *value;
     apr_size_t len;
     int fields_read = 0;
-    apr_table_t *tmp_headers;
-
-    /* We'll use apr_table_overlap later to merge these into r->headers_in. */
-    tmp_headers = apr_table_make(r->pool, 50);
+    char *tmp_field;
 
     /*
      * Read header lines until we get the empty separator line, a read error,
      * the connection closes (EOF), reach the server limit, or we timeout.
      */
     while(1) {
@@ -790,23 +787,41 @@
                                                               last_field),
                                                "</pre>\n", NULL));
                     return;
                 }
 
                 *value = '\0';
+                tmp_field = value;  /* used to trim the whitespace between key
+                                     * token and separator
+                                     */
                 ++value;
                 while (*value == ' ' || *value == '\t') {
                     ++value;            /* Skip to start of value   */
                 }
 
-                apr_table_addn(tmp_headers, last_field, value);
+                /* This check is to avoid any invalid memory reference while
+                 * traversing backwards in the key. To avoid a case where
+                 * the header starts with ':' (or with just some white
+                 * space and the ':') followed by the value
+                 */
+                if (tmp_field > last_field) {
+                    --tmp_field;
+                    while ((tmp_field > last_field) &&
+                           (*tmp_field == ' ' || *tmp_field == '\t')) {
+                        --tmp_field;   /* Removing LWS between key and ':' */
+                    }
+                    ++tmp_field;
+                    *tmp_field = '\0';
+                }
 
+                apr_table_addn(r->headers_in, last_field, value);
+                
                 /* reset the alloc_len so that we'll allocate a new
                  * buffer if we have to do any more folding: we can't
                  * use the previous buffer because its contents are
-                 * now part of tmp_headers
+                 * now part of r->headers_in
                  */
                 alloc_len = 0;
 
             } /* end if current line is not a continuation starting with tab */
         }
 
@@ -822,13 +837,13 @@
         if (!folded) {
             last_field = field;
             last_len = len;
         }
     }
 
-    apr_table_overlap(r->headers_in, tmp_headers, APR_OVERLAP_TABLES_MERGE);
+    apr_table_compress(r->headers_in, APR_OVERLAP_TABLES_MERGE);
 }
 
 AP_DECLARE(void) ap_get_mime_headers(request_rec *r)
 {
     apr_bucket_brigade *tmp_bb;
     tmp_bb = apr_brigade_create(r->pool, r->connection->bucket_alloc);
@@ -1139,16 +1154,12 @@
 
     while (*auth_line == ' ' || *auth_line == '\t') {
         auth_line++;
     }
 
     t = ap_pbase64decode(r->pool, auth_line);
-    /* Note that this allocation has to be made from r->connection->pool
-     * because it has the lifetime of the connection.  The other allocations
-     * are temporary and can be tossed away any time.
-     */
     r->user = ap_getword_nulls (r->pool, &t, ':');
     r->ap_auth_type = "Basic";
 
     *pw = t;
 
     return OK;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/util_script.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/util_script.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/server/util_script.c	2003-02-04 01:32:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/server/util_script.c	2003-07-24 05:53:42.000000000 +0800
@@ -283,12 +283,23 @@
     apr_sockaddr_port_get(&rport, c->remote_addr);
     apr_table_addn(e, "REMOTE_PORT", apr_itoa(r->pool, rport));
 
     if (r->user) {
 	apr_table_addn(e, "REMOTE_USER", r->user);
     }
+    else if (r->prev) {
+        request_rec *back = r->prev;
+
+        while (back) {
+            if (back->user) {
+                apr_table_addn(e, "REDIRECT_REMOTE_USER", back->user);
+                break;
+            }
+            back = back->prev;
+        }
+    }
     if (r->ap_auth_type) {
 	apr_table_addn(e, "AUTH_TYPE", r->ap_auth_type);
     }
     rem_logname = ap_get_remote_logname(r);
     if (rem_logname) {
 	apr_table_addn(e, "REMOTE_IDENT", apr_pstrdup(r->pool, rem_logname));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/apr-config.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/apr-config.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/apr-config.in	2003-06-21 00:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/apr-config.in	2003-08-25 07:10:25.000000000 +0800
@@ -276,15 +276,15 @@
     --apr-lib-target)
     echo "$APR_LIB_TARGET"
     exit 0
     ;;
     --apr-libtool)
     if test "$location" = "installed"; then
-        echo "${SHELL} ${installbuilddir}/libtool"
+        echo "${installbuilddir}/libtool"
     else
-        echo "${SHELL} $thisdir/libtool"
+        echo "$thisdir/libtool"
     fi
     exit 0
     ;;
     --help)
     show_usage
     exit 0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/apr.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/apr.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/apr.dsp	2003-03-11 02:19:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/apr.dsp	2003-08-23 18:01:22.000000000 +0800
@@ -152,12 +152,16 @@
 SOURCE=.\file_io\win32\readwrite.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\file_io\win32\seek.c
 # End Source File
+# Begin Source File
+
+SOURCE=.\file_io\unix\tempdir.c
+# End Source File
 # End Group
 # Begin Group "locks"
 
 # PROP Default_Filter ""
 # Begin Source File
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/apr_network.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/apr_network.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/apr_network.m4	2002-10-22 20:37:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/apr_network.m4	2003-09-02 16:42:56.000000000 +0800
@@ -138,12 +138,79 @@
 if test "$ac_cv_negative_eai" = "yes"; then
   AC_DEFINE(NEGATIVE_EAI, 1, [Define if EAI_ error codes from getaddrinfo are negative])
 fi
 ])
 
 dnl
+dnl check for getnameinfo() that properly resolves IPv4-mapped IPv6 addresses
+dnl
+dnl Darwin is known not to map them correctly
+dnl
+AC_DEFUN(APR_CHECK_GETNAMEINFO_IPV4_MAPPED,[
+  AC_CACHE_CHECK(whether getnameinfo resolves IPv4-mapped IPv6 addresses,
+                 ac_cv_getnameinfo_ipv4_mapped,[
+  AC_TRY_RUN( [
+#ifdef HAVE_NETDB_H
+#include <netdb.h>
+#endif
+#ifdef HAVE_STRING_H
+#include <string.h>
+#endif
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
+void main(void) {
+    struct sockaddr_in6 sa = {0};
+    struct in_addr ipv4;
+    char hbuf[NI_MAXHOST];
+    unsigned int *addr32;
+    int error;
+
+    ipv4.s_addr = inet_addr("127.0.0.1");
+
+    sa.sin6_family = AF_INET6;
+    sa.sin6_port = 0;
+
+    addr32 = (unsigned int *)&sa.sin6_addr;
+    addr32[2] = htonl(0x0000FFFF);
+    addr32[3] = ipv4.s_addr;
+
+#ifdef SIN6_LEN
+    sa.sin6_len = sizeof(sa);
+#endif
+
+    error = getnameinfo((const struct sockaddr *)&sa, sizeof(sa),
+                        hbuf, sizeof(hbuf), NULL, 0,
+                        NI_NUMERICHOST);
+    if (error) {
+        exit(1);
+    } else {
+        exit(0);
+    }
+}
+],[
+  ac_cv_getnameinfo_ipv4_mapped="yes"
+],[
+  ac_cv_getnameinfo_ipv4_mapped="no"
+],[
+  ac_cv_getnameinfo_ipv4_mapped="yes"
+])])
+if test "$ac_cv_getnameinfo_ipv4_mapped" = "no"; then
+  AC_DEFINE(GETNAMEINFO_IPV4_MAPPED_FAILS, 1,
+            [Define if getnameinfo does not map IPv4 address correctly])
+fi
+])
+
+dnl
 dnl check for presence of  retrans/retry variables in the res_state structure
 dnl
 AC_DEFUN(APR_CHECK_RESOLV_RETRANS,[
   AC_CACHE_CHECK(for presence of retrans/retry fields in res_state/resolv.h , ac_cv_retransretry,[
   AC_TRY_RUN( [
 #include <sys/types.h>
@@ -562,43 +629,12 @@
   have_sockaddr_in6=1
 else
   have_sockaddr_in6=0
 fi
 ])
 
-
-dnl
-dnl Check to see if this platform includes sa_len in it's
-dnl struct sockaddr.  If it does it changes the length of sa_family
-dnl which could cause us problems
-dnl
-AC_DEFUN(APR_CHECK_SOCKADDR_SA_LEN,[
-AC_CACHE_CHECK(for sockaddr sa_len, ac_cv_define_sockaddr_sa_len,[
-AC_TRY_COMPILE([
-#ifdef HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#ifdef HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-],[
-struct sockaddr_in sai;
-int i = sai.sin_len;
-],[
-  ac_cv_define_sockaddr_sa_len=yes
-],[
-  ac_cv_define_sockaddr_sa_len=no
-])
-])
-
-if test "$ac_cv_define_sockaddr_sa_len" = "yes"; then
-  AC_DEFINE(HAVE_SOCKADDR_SA_LEN, 1 ,[Define if we have length field in sockaddr_in])
-fi
-])
-
-
 dnl
 dnl APR_INADDR_NONE
 dnl
 dnl checks for missing INADDR_NONE macro
 dnl
 AC_DEFUN(APR_INADDR_NONE,[
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_exports.awk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_exports.awk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_exports.awk	2002-07-16 18:08:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_exports.awk	2003-09-26 15:25:59.000000000 +0800
@@ -73,14 +73,14 @@
     if (!index(symbol, "#")) {
         push("const void *ap_hack_" symbol " = (const void *)" symbol ";")
         scope_used[scope] = 1
     }
 }
 
-/^[ \t]*AP[RU]?_(CORE_)?DECLARE[^(]*[(][^)]*[)]([^ ]* )*[^(]+[(]/ {
-    sub("[ \t]*AP[RU]?_(CORE_)?DECLARE[^(]*[(][^)]*[)][ \t]*", "")
+/^[ \t]*AP[RUI]?_(CORE_)?DECLARE[^(]*[(][^)]*[)]([^ ]* )*[^(]+[(]/ {
+    sub("[ \t]*AP[RUI]?_(CORE_)?DECLARE[^(]*[(][^)]*[)][ \t]*", "")
     sub("[(].*", "")
     sub("([^ ]* (^([ \t]*[(])))+", "")
 
     add_symbol($0)
     next
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_nw_export.awk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_nw_export.awk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_nw_export.awk	2002-07-20 03:46:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_nw_export.awk	2003-09-26 15:25:59.000000000 +0800
@@ -20,14 +20,14 @@
 	if (count == 0) {
 		printf(" %s", line)
 		line = ""
 	}
 }
 
-/^[ \t]*AP[RU]?_DECLARE[^(]*[(][^)]*[)]([^ ]* )*[^(]+[(]/ {
-    sub("[ \t]*AP[RU]?_DECLARE[^(]*[(][^)]*[)][ \t]*", "")
+/^[ \t]*AP[RUI]?_DECLARE[^(]*[(][^)]*[)]([^ ]* )*[^(]+[(]/ {
+    sub("[ \t]*AP[RUI]?_DECLARE[^(]*[(][^)]*[)][ \t]*", "")
     sub("[(].*", "")
     sub("([^ ]* (^([ \t]*[(])))+", "")
 
     add_symbol($0)
     next
 }
@@ -62,13 +62,13 @@
     sub("[ \t]*APR_DECLARE_INHERIT_UNSET[^(]*[(]", "", $0)
     sub("[)].*$", "", $0)
     add_symbol("apr_" $0 "_inherit_unset")
     next
 }
 
-/^[ \t]*AP[RU]?_DECLARE_DATA .*;$/ {
+/^[ \t]*AP[RUI]?_DECLARE_DATA .*;$/ {
        varname = $NF;
        gsub( /[*;]/, "", varname);
        gsub( /\[.*\]/, "", varname);
        add_symbol(varname);
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_var_export.awk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_var_export.awk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/make_var_export.awk	2002-04-09 06:43:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/make_var_export.awk	2003-09-26 15:25:59.000000000 +0800
@@ -1,10 +1,10 @@
 # Based on apr's make_export.awk, which is
 # based on Ryan Bloom's make_export.pl
 
-/^#[ \t]*if(def)? (AP[RU]?_|!?defined).*/ {
+/^#[ \t]*if(def)? (AP[RUI]?_|!?defined).*/ {
 	if (old_filename != FILENAME) {
 		if (old_filename != "") printf("%s", line)
 		macro_no = 0
 		found = 0
 		count = 0
 		old_filename = FILENAME
@@ -44,13 +44,13 @@
 	if (count == 0) {
 		printf("%s", line)
 		line = ""
 	}
 }
 
-/^[ \t]*(extern[ \t]+)?AP[RU]?_DECLARE_DATA .*;$/ {
+/^[ \t]*(extern[ \t]+)?AP[RUI]?_DECLARE_DATA .*;$/ {
        varname = $NF;
        gsub( /[*;]/, "", varname);
        gsub( /\[.*\]/, "", varname);
        add_symbol(varname);
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/nw_export.inc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/nw_export.inc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/nw_export.inc	2003-02-19 03:47:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/nw_export.inc	2003-08-26 02:17:36.000000000 +0800
@@ -75,6 +75,7 @@
 #include "apr_strmatch.h"
 #include "apr_uri.h"
 #include "apr_uuid.h"
 #include "apr_xlate.h"
 #include "apr_xml.h"
 #include "apu_compat.h"
+#include "apu_want.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/NWGNUmakefile	2002-10-17 07:53:03.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/NWGNUmakefile	2003-08-26 02:17:36.000000000 +0800
@@ -15,12 +15,13 @@
 #
 # build this level's files
 
 FILES_prebuild_headers = \
 	$(APR)/include/apr.h \
 	$(APRUTIL)/include/apu.h \
+	$(APRUTIL)/include/apu_want.h \
 	$(APRUTIL)/include/apr_ldap.h \
 	$(APRUTIL)/include/private/apu_config.h \
 	$(APRUTIL)/include/private/apu_select_dbm.h \
 	$(APRUTIL)/xml/expat/lib/expat.h \
 	$(APRUTIL)/xml/expat/lib/config.h \
 	$(EOLIST) 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/prebuildNW.bat /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/prebuildNW.bat
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/prebuildNW.bat	2002-02-09 03:15:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/prebuildNW.bat	2003-08-26 02:17:36.000000000 +0800
@@ -25,12 +25,13 @@
 
 @echo Fixing up the APR headers
 copy ..\include\apr.hnw ..\include\apr.h
 
 @echo Fixing up the APR-Util headers
 copy ..\..\apr-util\include\apu.hnw ..\..\apr-util\include\apu.h
+copy ..\..\apr-util\include\apu_want.hnw ..\..\apr-util\include\apu_want.h
 copy ..\..\apr-util\include\apr_ldap.hnw ..\..\apr-util\include\apr_ldap.h
 copy ..\..\apr-util\include\private\apu_config.hw ..\..\apr-util\include\private\apu_config.h
 copy ..\..\apr-util\xml\expat\lib\expat.h.in ..\..\apr-util\xml\expat\lib\expat.h
 copy ..\..\apr-util\xml\expat\lib\config.hnw ..\..\apr-util\xml\expat\lib\config.h
 copy ..\..\apr-util\include\private\apu_select_dbm.hw ..\..\apr-util\include\private\apu_select_dbm.h
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/PrintPath /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/PrintPath
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/build/PrintPath	2001-02-18 21:36:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/build/PrintPath	2003-09-23 07:58:13.000000000 +0800
@@ -42,13 +42,13 @@
 ##
 # Now we make the adjustments required for OS/2 and everyone
 # else :)
 #
 # First of all, all OS/2 programs have the '.exe' extension.
 # Next, we adjust PATH (or what was given to us as PATH) to
-# be whitespace seperated directories.
+# be whitespace separated directories.
 # Finally, we try to determine the best flag to use for
 # test/[] to look for an executable file. OS/2 just has '-r'
 # but with other OSs, we do some funny stuff to check to see
 # if test/[] knows about -x, which is the prefered flag.
 ##
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/CHANGES	2003-06-23 05:56:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/CHANGES	2003-10-25 00:35:15.000000000 +0800
@@ -1,7 +1,46 @@
+Changes with APR 0.9.5
+
+  *) Add apr_os_pipe_put_ex(), which allows the caller to tell APR
+     to establish a cleanup on the pipe.  [Jeff Trawick, Brad Nicholes]
+
+  *) Fix make_exports.awk to work with apr-iconv.  [Justin Erenkrantz]
+
 Changes with APR 0.9.4
+
+  *) win32: fix apr_file_dup() and apr_file_dup2() to dup the
+     ungetchar member [Stas Bekman]
+
+  *) Preserve leading '../' segments as when merging to an empty and
+     unrooted path - fixes a bug observed in SVN with Win32/Netware/OS2.
+     [Mike Pilato <cmpilato@collab.net>, William Rowe]
+
+  *) Work around a bug in Darwin when calling getnameinfo() on IPv4-mapped
+     IPv6-addresses.  [Colm MacCárthaigh <colm@stdlib.net>, Jeff Trawick,
+     Justin Erenkrantz]
+
+  *) Add apr_temp_dir_get() for getting the most suitable temp directory
+     [Mike Pilato <cmpilato@collab.net>, Thom May]
+
+  *) Modify apr_sockaddr_info_get to call the resolver when we
+     do not have a hostname.  Also, fix bugs in the getaddrinfo()
+     implementation.
+     [Colm MacCárthaigh <colm@stdlib.net>, Justin Erenkrantz]
+
+  *) Change the behavior of unix process 'trylock's to return
+     APR_ENOTIMPL instead of segfaulting, consistent with the
+     other lock implementations.  [William Rowe]
+
+  *) Fix a subtle race where the ownership of a unix nested
+     thread lock could be corrupted when the prior owner released
+     the lock with another thread waiting on the same lock.
+     [William Rowe]
+
+  *) apr_socket_data_set(): allow the same key to be used for
+     multiple sockets in the same pool.  [Jeff Trawick]
+
   *) Add new table function apr_table_compress() and replace
      red-black trees with mergesort in apr_table_overlap()
      [Joe Schaefer <joe+gmane@sunstarsys.com>, Brian Pane]
 
   *) Win32: Adopt Brian Havard's OS/2 rwlock implementation for
      Windows [Marc Adkins, Bill Stoddard]
@@ -1371,13 +1410,13 @@
      reflects if the file found was, in fact, a link.   [William Rowe]
 
   *) Fixed apr_open and apr_rename to function on Win9x.
      [Mike Pilato <cmpilato@collab.net>] 
   
   *) Add apr_open_stdout.  This mirrors apr_open_stderr, except it works
-     on stdout.  [cmpilato@collab.net]
+     on stdout.  [Mike Pilato <cmpilato@collab.net>]
 
   *) Fix bug in file_io/unix/dir.c.  There is no such thing as a dirent,
      it must be a struct dirent.  
      [Kevin Pilch-Bisson <kevin@pilch-bisson.net>]
 
   *) Fix the configure script so that we can build from a different
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/configure	2003-07-07 22:51:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/configure	2003-10-25 01:51:00.000000000 +0800
@@ -461,13 +461,13 @@
 # endif
 #endif
 #if HAVE_UNISTD_H
 # include <unistd.h>
 #endif"
 
-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os apr_srcdir apr_builddir top_builddir apr_builders APR_DOTTED_VERSION APR_MAJOR_VERSION CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC EXEEXT OBJEXT SET_MAKE CPP AWK LN_S RANLIB ac_ct_RANLIB INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA RM AS ASCPP AR ac_ct_AR EGREP apr_charset_ebcdic APR_LIBNAME ECHO STRIP ac_ct_STRIP LIBTOOL installbuilddir lt_compile link so_ext lib_target export_lib_target shlibpath_var LTFLAGS LT_LDFLAGS lib_target_libs MKDEP apr_force_atomic_generic proc_mutex_is_global eolstr INSTALL_SUBDIRS threads have_sigsuspend have_sigwait useshmgetanon usemmapzero usemmapanon haveshmgetanon havemmapzero havemmapanon usemmaptmp usemmapshm useshmget usebeosarea useos2shm havemmaptmp havemmapshm haveshmget havebeosarea haveos2shm sharedmem sendfile apr_inaddr_none fork have_inet_addr tcp_nodelay_inherited o_nonblock_inherited have_inet_network have_sigaction have_setrlimit have_getrlimit mmap have_memmove arpa_ineth conioh ctypeh crypth errnoh direnth fcntlh ioh limitsh netdbh sys_syslimitsh netinet_inh netinet_sctph netinet_sctp_uioh netinet_tcph stdargh stdioh stdlibh stringh stringsh sys_sendfileh sys_signalh sys_socketh sys_typesh sys_timeh sys_uioh sys_unh timeh unistdh signalh sys_waith pthreadh semaphoreh voidp_size short_value int_value long_value int64_value off_t_value size_t_value ssize_t_value socklen_t_value int64_t_fmt int64_t_fmt_len uint64_t_fmt uint64_t_fmt_len uint64_t_hex_fmt ssize_t_fmt size_t_fmt off_t_fmt pid_t_fmt int64_literal stdint have_strnicmp have_strncasecmp have_stricmp have_strcasecmp have_strdup have_strstr have_memchr have_int64_strfn int64_strfn aprdso oc struct_rlimit have_union_semun hasflockser hassysvser hasposixser hasfcntlser hasprocpthreadser hasrwlockser flockser sysvser posixser fcntlser procpthreadser pthreadser proclockglobal rand have_in_addr file_as_socket apr_tcp_nopush_flag have_corkable_tcp acceptfilter have_sctp have_ipv6 EXTRA_CPPFLAGS EXTRA_CFLAGS EXTRA_LDFLAGS EXTRA_LIBS EXTRA_INCLUDES NOTEST_CPPFLAGS NOTEST_CFLAGS NOTEST_LDFLAGS NOTEST_LIBS NOTEST_INCLUDES LDLIBS OSDIR DEFAULT_OSDIR LIBTOOL_LIBS SUBDIRS INCLUDE_RULES LIBOBJS LTLIBOBJS'
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os apr_srcdir apr_builddir top_builddir apr_builders APR_DOTTED_VERSION APR_MAJOR_VERSION CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC EXEEXT OBJEXT SET_MAKE CPP AWK LN_S RANLIB ac_ct_RANLIB INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA RM AS ASCPP AR ac_ct_AR EGREP apr_charset_ebcdic APR_LIBNAME ECHO STRIP ac_ct_STRIP LIBTOOL installbuilddir lt_compile link so_ext lib_target export_lib_target shlibpath_var LTFLAGS LT_LDFLAGS lib_target_libs MKDEP apr_force_atomic_generic proc_mutex_is_global eolstr INSTALL_SUBDIRS threads have_sigsuspend have_sigwait useshmgetanon usemmapzero usemmapanon haveshmgetanon havemmapzero havemmapanon usemmaptmp usemmapshm useshmget usebeosarea useos2shm havemmaptmp havemmapshm haveshmget havebeosarea haveos2shm sharedmem sendfile apr_inaddr_none fork have_inet_addr tcp_nodelay_inherited o_nonblock_inherited have_inet_network have_sigaction have_setrlimit have_getrlimit mmap have_memmove arpa_ineth conioh ctypeh crypth errnoh direnth fcntlh ioh limitsh netdbh sys_syslimitsh netinet_inh netinet_sctph netinet_sctp_uioh netinet_tcph stdargh stdioh stdlibh stringh stringsh sys_ioctlh sys_sendfileh sys_signalh sys_socketh sys_sockioh sys_typesh sys_timeh sys_uioh sys_unh timeh unistdh signalh sys_waith pthreadh semaphoreh voidp_size short_value int_value long_value int64_value off_t_value size_t_value ssize_t_value socklen_t_value int64_t_fmt int64_t_fmt_len uint64_t_fmt uint64_t_fmt_len uint64_t_hex_fmt ssize_t_fmt size_t_fmt off_t_fmt pid_t_fmt int64_literal stdint have_strnicmp have_strncasecmp have_stricmp have_strcasecmp have_strdup have_strstr have_memchr have_int64_strfn int64_strfn aprdso oc struct_rlimit have_union_semun hasflockser hassysvser hasposixser hasfcntlser hasprocpthreadser hasrwlockser flockser sysvser posixser fcntlser procpthreadser pthreadser proclockglobal rand have_in_addr file_as_socket apr_tcp_nopush_flag have_corkable_tcp acceptfilter have_sctp have_ipv6 EXTRA_CPPFLAGS EXTRA_CFLAGS EXTRA_LDFLAGS EXTRA_LIBS EXTRA_INCLUDES NOTEST_CPPFLAGS NOTEST_CFLAGS NOTEST_LDFLAGS NOTEST_LIBS NOTEST_INCLUDES LDLIBS OSDIR DEFAULT_OSDIR LIBTOOL_LIBS SUBDIRS INCLUDE_RULES LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
 ac_init_help=
 ac_init_version=false
 # The variables have the same names as the options, with
@@ -998,12 +998,13 @@
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
   --enable-layout=LAYOUT
+  --experimental-libtool Use experimental custom libtool (not included in source distribution)
   --enable-shared=PKGS  build shared libraries default=yes
   --enable-static=PKGS  build static libraries default=yes
   --enable-fast-install=PKGS  optimize for fast installation default=yes
   --disable-libtool-lock  avoid locking (might break parallel builds)
   --enable-debug          Turn on debugging and compile time warnings
   --enable-maintainer-mode  Turn on debugging and compile time warnings
@@ -7355,20 +7354,44 @@
 
 APR_LIBNAME="apr${libsuffix}"
 
 
 echo "performing libtool configuration..."
 
+# Check whether --enable-experimental-libtool or --disable-experimental-libtool was given.
+if test "${enable_experimental_libtool+set}" = set; then
+  enableval="$enable_experimental_libtool"
+  experimental_libtool=$enableval
+else
+  experimental_libtool=no
+fi;
+
 case $host in
 *os2*)
     # Use a custom-made libtool replacement
     echo "using aplibtool"
     LIBTOOL="$srcdir/build/aplibtool"
     gcc $CFLAGS $CPPFLAGS -o $LIBTOOL.exe $LIBTOOL.c
     ;;
-*)  # Check whether --enable-shared or --disable-shared was given.
+*)
+    if test "x$LTFLAGS" = "x"; then
+        LTFLAGS='--silent'
+    fi
+    if test "$experimental_libtool" = "yes"; then
+        # Use a custom-made libtool replacement
+        echo "using jlibtool"
+        LIBTOOL="$apr_builddir/libtool"
+        LIBTOOL_SRC="$apr_srcdir/build/jlibtool.c"
+        if test ! -f $LIBTOOL_SRC; then
+          { { echo "$as_me:$LINENO: error: Experimental libtool source not found.  It is not included with APR by default." >&5
+echo "$as_me: error: Experimental libtool source not found.  It is not included with APR by default." >&2;}
+   { (exit 1); exit 1; }; }
+        fi
+        $CC $CFLAGS $CPPFLAGS -o $LIBTOOL $LIBTOOL_SRC
+    else
+    # Check whether --enable-shared or --disable-shared was given.
 if test "${enable_shared+set}" = set; then
   enableval="$enable_shared"
   p=${PACKAGE-default}
 case $enableval in
 yes) enable_shared=yes ;;
 no) enable_shared=no ;;
@@ -8499,13 +8522,13 @@
 
 # Some flags need to be propagated to the compiler or linker for good
 # libtool support.
 case $host in
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 8505 "configure"' > conftest.$ac_ext
+  echo '#line 8528 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; then
     case `/usr/bin/file conftest.$ac_objext` in
@@ -9027,13 +9050,13 @@
 # to fail, enabling locking or at least warning the user not to do parallel
 # builds.
 chmod -w .
 save_CFLAGS="$CFLAGS"
 CFLAGS="$CFLAGS -o out/conftest2.$ac_objext"
 compiler_c_o=no
-if { (eval echo configure:9033: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>out/conftest.err; } && test -s out/conftest2.$ac_objext; then
+if { (eval echo configure:9056: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>out/conftest.err; } && test -s out/conftest2.$ac_objext; then
   # The compiler can only warn and ignore the option if not recognized
   # So say no if there are warnings
   if test -s out/conftest.err; then
     lt_cv_compiler_c_o=no
   else
     lt_cv_compiler_c_o=yes
@@ -10839,13 +10862,13 @@
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self=cross
 else
     lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10845 "configure"
+#line 10868 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
 #include <dlfcn.h>
 #endif
 
@@ -10937,13 +10960,13 @@
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self_static=cross
 else
     lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10943 "configure"
+#line 10966 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
 #include <dlfcn.h>
 #endif
 
@@ -11672,19 +11695,17 @@
 # Always use our own libtool.
 LIBTOOL='$(SHELL) $(apr_builddir)/libtool'
 
 # Prevent multiple expansion
 
 
-    if test "x$LTFLAGS" = "x"; then
-        LTFLAGS='--silent'
-    fi
-    # get libtool's setting of shlibpath_var
-    eval `grep "^shlibpath_var=[A-Z_]*$" $apr_builddir/libtool`
-    if test "x$shlibpath_var" = "x"; then
-        shlibpath_var=REPLACE_WITH_YOUR_SHLIBPATH_VAR
+        # get libtool's setting of shlibpath_var
+        eval `grep "^shlibpath_var=[A-Z_]*$" $apr_builddir/libtool`
+        if test "x$shlibpath_var" = "x"; then
+            shlibpath_var=REPLACE_WITH_YOUR_SHLIBPATH_VAR
+        fi
     fi
     ;;
 esac
 
 
 # Check whether --with-installbuilddir or --without-installbuilddir was given.
@@ -12297,16 +12318,16 @@
 # this is the place to put specific options for platform/compiler
 # combinations
 case "$host:$CC" in
     *-hp-hpux*:cc )
 
   if test "x$CFLAGS" = "x"; then
-    echo "  setting CFLAGS to \"-Ae +DAportable +Z\""
-    CFLAGS="-Ae +DAportable +Z"
+    echo "  setting CFLAGS to \"-Ae +Z\""
+    CFLAGS="-Ae +Z"
   else
-    apr_addto_bugger="-Ae +DAportable +Z"
+    apr_addto_bugger="-Ae +Z"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
       for j in $CFLAGS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
@@ -12316,12 +12337,36 @@
         echo "  adding \"$i\" to CFLAGS"
         CFLAGS="$CFLAGS $i"
       fi
     done
   fi
 
+	if echo "$CFLAGS " | grep '+DA' >/dev/null; then :
+	else
+
+  if test "x$CFLAGS" = "x"; then
+    echo "  setting CFLAGS to \"+DAportable\""
+    CFLAGS="+DAportable"
+  else
+    apr_addto_bugger="+DAportable"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $CFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to CFLAGS"
+        CFLAGS="$CFLAGS $i"
+      fi
+    done
+  fi
+
+	fi
 	;;
     powerpc-*-beos:mwcc* )
 
   echo "  forcing CPP to \"mwcc -E\""
   CPP="mwcc -E"
 
@@ -12662,13 +12707,16 @@
         # 3.4-RELEASE: 340   4.1.1-RELEASE: 411
         os_version=`uname -r | sed -e 's/\(.\)\.\(.\)\.\(.\).*/\1\2\3/' | sed -e 's/\(.\)\.\(.\)\-.*/\1\20/'`
         ;;
     *linux*)
         os_version=`uname -r | sed -e 's/\(.\)\.\(.\)\.\(.\).*/\1\2\3/'`
         ;;
-     *)
+    *darwin*)
+        os_version=`uname -r | sed -e 's/\(.\)\.\(.\).*/\1\2/'`
+        ;;
+    *)
         os_version=OS_VERSION_IS_NOT_SET
         ;;
 esac
 
 
 echo "$as_me:$LINENO: checking for res_init in -lresolv" >&5
@@ -16856,12 +16904,83 @@
   sendfile="1"
 fi
 done
 
 
 
+for ac_func in utime utimes
+do
+as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_func" >&5
+echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
+if eval "test \"\${$as_ac_var+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func (); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char $ac_func ();
+char (*f) ();
+
+int
+main ()
+{
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+f = $ac_func;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_var=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_var=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
+if test `eval echo '${'$as_ac_var'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+
 
 # Check whether --with-sendfile or --without-sendfile was given.
 if test "${with_sendfile+set}" = set; then
   withval="$with_sendfile"
    if test "$withval" = "yes"; then
         sendfile="1"
@@ -18670,20 +18791,22 @@
     kernel/OS.h		\
     net/errno.h		\
     netinet/in.h	\
     netinet/sctp.h      \
     netinet/sctp_uio.h  \
     sys/file.h		\
+    sys/ioctl.h         \
     sys/mman.h		\
     sys/poll.h		\
     sys/resource.h	\
     sys/select.h	\
     sys/sem.h		\
     sys/sendfile.h	\
     sys/signal.h	\
     sys/socket.h	\
+    sys/sockio.h	\
     sys/stat.h          \
     sys/sysctl.h	\
     sys/syslimits.h	\
     sys/time.h		\
     sys/types.h		\
     sys/uio.h		\
@@ -18843,20 +18966,22 @@
     kernel/OS.h		\
     net/errno.h		\
     netinet/in.h	\
     netinet/sctp.h      \
     netinet/sctp_uio.h  \
     sys/file.h		\
+    sys/ioctl.h         \
     sys/mman.h		\
     sys/poll.h		\
     sys/resource.h	\
     sys/select.h	\
     sys/sem.h		\
     sys/sendfile.h	\
     sys/signal.h	\
     sys/socket.h	\
+    sys/sockio.h	\
     sys/stat.h          \
     sys/sysctl.h	\
     sys/syslimits.h	\
     sys/time.h		\
     sys/types.h		\
     sys/uio.h		\
@@ -25446,78 +25573,12 @@
     echo "no"
 fi
 
 
 
 
-
-echo "$as_me:$LINENO: checking for sockaddr sa_len" >&5
-echo $ECHO_N "checking for sockaddr sa_len... $ECHO_C" >&6
-if test "${ac_cv_define_sockaddr_sa_len+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-
-#ifdef HAVE_SYS_TYPES_H
-#include <sys/types.h>
-#endif
-#ifdef HAVE_NETINET_IN_H
-#include <netinet/in.h>
-#endif
-
-int
-main ()
-{
-
-struct sockaddr_in sai;
-int i = sai.sin_len;
-
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-
-  ac_cv_define_sockaddr_sa_len=yes
-
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-
-  ac_cv_define_sockaddr_sa_len=no
-
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-
-fi
-echo "$as_me:$LINENO: result: $ac_cv_define_sockaddr_sa_len" >&5
-echo "${ECHO_T}$ac_cv_define_sockaddr_sa_len" >&6
-
-if test "$ac_cv_define_sockaddr_sa_len" = "yes"; then
-
-cat >>confdefs.h <<\_ACEOF
-#define HAVE_SOCKADDR_SA_LEN 1
-_ACEOF
-
-fi
-
-
 # Check the types only if we have gethostbyname_r
 if test "$ac_cv_func_gethostbyname_r" = "yes"; then
 
 
 echo "$as_me:$LINENO: checking style of gethostbyname_r routine" >&5
 echo $ECHO_N "checking style of gethostbyname_r routine... $ECHO_C" >&6
@@ -26316,18 +26377,12 @@
     fi
 else
    user_disabled_ipv6=0
 fi;
 
 case $host in
-  *apple-darwin*)
-    # It appears that Jaguar has all the right features, but
-    # getnameinfo() fails to find the hostname for a mapped
-    # address.
-    broken_ipv6=1
-    ;;
   *)
     broken_ipv6=0
 esac
 
 echo "$as_me:$LINENO: checking for library containing getaddrinfo" >&5
 echo $ECHO_N "checking for library containing getaddrinfo... $ECHO_C" >&6
@@ -26989,44 +27044,140 @@
   have_sockaddr_in6=1
 else
   have_sockaddr_in6=0
 fi
 
 
-echo "$as_me:$LINENO: checking if APR supports IPv6" >&5
-echo $ECHO_N "checking if APR supports IPv6... $ECHO_C" >&6
 have_ipv6="0"
 if test "$user_disabled_ipv6" = 1; then
-    echo "$as_me:$LINENO: result: no -- disabled by user" >&5
-echo "${ECHO_T}no -- disabled by user" >&6
+    ipv6_result="no -- disabled by user"
 else
     if test "x$broken_ipv6" = "x0"; then
         if test "x$have_sockaddr_in6" = "x1"; then
             if test "x$ac_cv_working_getaddrinfo" = "xyes"; then
                 if test "x$ac_cv_working_getnameinfo" = "xyes"; then
+
+  echo "$as_me:$LINENO: checking whether getnameinfo resolves IPv4-mapped IPv6 addresses" >&5
+echo $ECHO_N "checking whether getnameinfo resolves IPv4-mapped IPv6 addresses... $ECHO_C" >&6
+if test "${ac_cv_getnameinfo_ipv4_mapped+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+  if test "$cross_compiling" = yes; then
+
+  ac_cv_getnameinfo_ipv4_mapped="yes"
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#ifdef HAVE_NETDB_H
+#include <netdb.h>
+#endif
+#ifdef HAVE_STRING_H
+#include <string.h>
+#endif
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
+#ifdef HAVE_SYS_SOCKET_H
+#include <sys/socket.h>
+#endif
+#ifdef HAVE_NETINET_IN_H
+#include <netinet/in.h>
+#endif
+
+void main(void) {
+    struct sockaddr_in6 sa = {0};
+    struct in_addr ipv4;
+    char hbuf[NI_MAXHOST];
+    unsigned int *addr32;
+    int error;
+
+    ipv4.s_addr = inet_addr("127.0.0.1");
+
+    sa.sin6_family = AF_INET6;
+    sa.sin6_port = 0;
+
+    addr32 = (unsigned int *)&sa.sin6_addr;
+    addr32[2] = htonl(0x0000FFFF);
+    addr32[3] = ipv4.s_addr;
+
+#ifdef SIN6_LEN
+    sa.sin6_len = sizeof(sa);
+#endif
+
+    error = getnameinfo((const struct sockaddr *)&sa, sizeof(sa),
+                        hbuf, sizeof(hbuf), NULL, 0,
+                        NI_NUMERICHOST);
+    if (error) {
+        exit(1);
+    } else {
+        exit(0);
+    }
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+
+  ac_cv_getnameinfo_ipv4_mapped="yes"
+
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+
+  ac_cv_getnameinfo_ipv4_mapped="no"
+
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+fi
+echo "$as_me:$LINENO: result: $ac_cv_getnameinfo_ipv4_mapped" >&5
+echo "${ECHO_T}$ac_cv_getnameinfo_ipv4_mapped" >&6
+if test "$ac_cv_getnameinfo_ipv4_mapped" = "no"; then
+
+cat >>confdefs.h <<\_ACEOF
+#define GETNAMEINFO_IPV4_MAPPED_FAILS 1
+_ACEOF
+
+fi
+
                     have_ipv6="1"
-                    echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
+                    ipv6_result="yes"
                 else
-                    echo "$as_me:$LINENO: result: no -- no getnameinfo" >&5
-echo "${ECHO_T}no -- no getnameinfo" >&6
+                    ipv6_result="no -- no getnameinfo"
                 fi
             else
-                echo "$as_me:$LINENO: result: no -- no working getaddrinfo" >&5
-echo "${ECHO_T}no -- no working getaddrinfo" >&6
+                ipv6_result="no -- no working getaddrinfo"
             fi
         else
-            echo "$as_me:$LINENO: result: no -- no sockaddr_in6" >&5
-echo "${ECHO_T}no -- no sockaddr_in6" >&6
+            ipv6_result="no -- no sockaddr_in6"
         fi
     else
-        echo "$as_me:$LINENO: result: no -- the platform has problems supporting IPv6" >&5
-echo "${ECHO_T}no -- the platform has problems supporting IPv6" >&6
+        ipv6_result="no -- the platform has known problems supporting IPv6"
     fi
 fi
 
+echo "$as_me:$LINENO: checking if APR supports IPv6" >&5
+echo $ECHO_N "checking if APR supports IPv6... $ECHO_C" >&6
+echo "$as_me:$LINENO: result: $ipv6_result" >&5
+echo "${ECHO_T}$ipv6_result" >&6
+
 
 
 
 
 for ac_header in langinfo.h
 do
@@ -28067,15 +28218,17 @@
 s,@netinet_tcph@,$netinet_tcph,;t t
 s,@stdargh@,$stdargh,;t t
 s,@stdioh@,$stdioh,;t t
 s,@stdlibh@,$stdlibh,;t t
 s,@stringh@,$stringh,;t t
 s,@stringsh@,$stringsh,;t t
+s,@sys_ioctlh@,$sys_ioctlh,;t t
 s,@sys_sendfileh@,$sys_sendfileh,;t t
 s,@sys_signalh@,$sys_signalh,;t t
 s,@sys_socketh@,$sys_socketh,;t t
+s,@sys_sockioh@,$sys_sockioh,;t t
 s,@sys_typesh@,$sys_typesh,;t t
 s,@sys_timeh@,$sys_timeh,;t t
 s,@sys_uioh@,$sys_uioh,;t t
 s,@sys_unh@,$sys_unh,;t t
 s,@timeh@,$timeh,;t t
 s,@unistdh@,$unistdh,;t t
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/configure.in	2003-06-11 23:20:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/configure.in	2003-10-17 06:13:01.000000000 +0800
@@ -126,28 +126,43 @@
 AC_SUBST(APR_LIBNAME)
 
 dnl prep libtool
 dnl
 echo "performing libtool configuration..."
 
+AC_ARG_ENABLE(experimental-libtool,[  --experimental-libtool Use experimental custom libtool (not included in source distribution)],
+  [experimental_libtool=$enableval],[experimental_libtool=no])
+
 case $host in
 *os2*)
     # Use a custom-made libtool replacement
     echo "using aplibtool"
     LIBTOOL="$srcdir/build/aplibtool"
     gcc $CFLAGS $CPPFLAGS -o $LIBTOOL.exe $LIBTOOL.c
     ;;
-*)  dnl libtoolize requires that the following not be indented
-AC_PROG_LIBTOOL
+*)
     if test "x$LTFLAGS" = "x"; then
         LTFLAGS='--silent'
     fi
-    # get libtool's setting of shlibpath_var
-    eval `grep "^shlibpath_var=[[A-Z_]]*$" $apr_builddir/libtool`
-    if test "x$shlibpath_var" = "x"; then
-        shlibpath_var=REPLACE_WITH_YOUR_SHLIBPATH_VAR
+    if test "$experimental_libtool" = "yes"; then
+        # Use a custom-made libtool replacement
+        echo "using jlibtool"
+        LIBTOOL="$apr_builddir/libtool"
+        LIBTOOL_SRC="$apr_srcdir/build/jlibtool.c"
+        if test ! -f $LIBTOOL_SRC; then
+          AC_MSG_ERROR([Experimental libtool source not found.  It is not included with APR by default.])
+        fi
+        $CC $CFLAGS $CPPFLAGS -o $LIBTOOL $LIBTOOL_SRC
+    else
+    dnl libtoolize requires that the following not be indented
+AC_PROG_LIBTOOL
+        # get libtool's setting of shlibpath_var
+        eval `grep "^shlibpath_var=[[A-Z_]]*$" $apr_builddir/libtool`
+        if test "x$shlibpath_var" = "x"; then
+            shlibpath_var=REPLACE_WITH_YOUR_SHLIBPATH_VAR
+        fi
     fi
     ;;
 esac
 
 AC_ARG_WITH(installbuilddir, [  --with-installbuilddir=DIR location to store APR build files (defaults to '${datadir}/build')],
   [ installbuilddir=$withval ], [ installbuilddir="${datadir}/build" ] )
@@ -311,13 +326,17 @@
 fi
 
 # this is the place to put specific options for platform/compiler
 # combinations
 case "$host:$CC" in
     *-hp-hpux*:cc )
-	APR_ADDTO(CFLAGS,[-Ae +DAportable +Z])
+	APR_ADDTO(CFLAGS,[-Ae +Z])
+	if echo "$CFLAGS " | grep '+DA' >/dev/null; then :
+	else
+	  APR_ADDTO(CFLAGS,[+DAportable])
+	fi 
 	;;
     powerpc-*-beos:mwcc* )
 	APR_SETVAR(CPP,[mwcc -E])
 	APR_SETVAR(CC,mwcc)
 	APR_SETVAR(AR,ar)
 	;;
@@ -428,13 +447,16 @@
         # 3.4-RELEASE: 340   4.1.1-RELEASE: 411
         os_version=`uname -r | sed -e 's/\(.\)\.\(.\)\.\(.\).*/\1\2\3/' | sed -e 's/\(.\)\.\(.\)\-.*/\1\20/'`
         ;;
     *linux*)
         os_version=`uname -r | sed -e 's/\(.\)\.\(.\)\.\(.\).*/\1\2\3/'`
         ;;
-     *)
+    *darwin*)
+        os_version=`uname -r | sed -e 's/\(.\)\.\(.\).*/\1\2/'`
+        ;;
+    *)
         os_version=OS_VERSION_IS_NOT_SET
         ;;
 esac
 
 dnl ----------------------------- Checks for Any required Libraries
 dnl Note: Autoconf will always append LIBS with an extra " " in AC_CHECK_LIB.
@@ -785,12 +807,13 @@
 AC_CHECK_FUNCS(setrlimit, [ have_setrlimit="1" ], [ have_setrlimit="0" ]) 
 AC_CHECK_FUNCS(getrlimit, [ have_getrlimit="1" ], [ have_getrlimit="0" ]) 
 AC_CHECK_FUNCS(writev)
 sendfile="0"
 AC_CHECK_LIB(sendfile, sendfilev)
 AC_CHECK_FUNCS(sendfile send_file sendfilev, [ sendfile="1" ])
+AC_CHECK_FUNCS(utime utimes)
 
 dnl THIS MUST COME AFTER THE THREAD TESTS - FreeBSD doesn't always have a
 dnl threaded poll() and we don't want to use sendfile on early FreeBSD 
 dnl systems if we are also using threads.
 
 AC_ARG_WITH(sendfile, [  --with-sendfile         Override decision to use sendfile],
@@ -912,20 +935,22 @@
     kernel/OS.h		\
     net/errno.h		\
     netinet/in.h	\
     netinet/sctp.h      \
     netinet/sctp_uio.h  \
     sys/file.h		\
+    sys/ioctl.h         \
     sys/mman.h		\
     sys/poll.h		\
     sys/resource.h	\
     sys/select.h	\
     sys/sem.h		\
     sys/sendfile.h	\
     sys/signal.h	\
     sys/socket.h	\
+    sys/sockio.h	\
     sys/stat.h          \
     sys/sysctl.h	\
     sys/syslimits.h	\
     sys/time.h		\
     sys/types.h		\
     sys/uio.h		\
@@ -966,15 +991,17 @@
 AC_SUBST(netinet_tcph)
 AC_SUBST(stdargh)
 AC_SUBST(stdioh)
 AC_SUBST(stdlibh)
 AC_SUBST(stringh)
 AC_SUBST(stringsh)
+AC_SUBST(sys_ioctlh)
 AC_SUBST(sys_sendfileh)
 AC_SUBST(sys_signalh)
 AC_SUBST(sys_socketh)
+AC_SUBST(sys_sockioh)
 AC_SUBST(sys_typesh)
 AC_SUBST(sys_timeh)
 AC_SUBST(sys_uioh)
 AC_SUBST(sys_unh)
 AC_SUBST(timeh)
 AC_SUBST(unistdh)
@@ -1703,14 +1730,12 @@
     echo "no"
 fi
 
 AC_SUBST(have_in_addr)
 AC_SUBST(file_as_socket)
 
-APR_CHECK_SOCKADDR_SA_LEN
-
 # Check the types only if we have gethostbyname_r
 if test "$ac_cv_func_gethostbyname_r" = "yes"; then
     APR_CHECK_GETHOSTBYNAME_R_STYLE
 fi
 
 APR_CHECK_TCP_NODELAY_INHERITED
@@ -1771,18 +1796,12 @@
   [ if test "$enableval" = "no"; then
         user_disabled_ipv6=1
     fi ],
   [ user_disabled_ipv6=0 ] )
 
 case $host in
-  *apple-darwin*)
-    # It appears that Jaguar has all the right features, but
-    # getnameinfo() fails to find the hostname for a mapped
-    # address.
-    broken_ipv6=1
-    ;;
   *)
     broken_ipv6=0
 esac
 
 AC_SEARCH_LIBS(getaddrinfo, socket inet6)
 AC_SEARCH_LIBS(gai_strerror, socket inet6)
@@ -1790,37 +1809,40 @@
 AC_CHECK_FUNCS(gai_strerror)
 APR_CHECK_WORKING_GETADDRINFO
 APR_CHECK_NEGATIVE_EAI
 APR_CHECK_WORKING_GETNAMEINFO
 APR_CHECK_SOCKADDR_IN6
 
-AC_MSG_CHECKING(if APR supports IPv6)
 have_ipv6="0"
 if test "$user_disabled_ipv6" = 1; then
-    AC_MSG_RESULT([no -- disabled by user])
+    ipv6_result="no -- disabled by user"
 else
     if test "x$broken_ipv6" = "x0"; then
         if test "x$have_sockaddr_in6" = "x1"; then
             if test "x$ac_cv_working_getaddrinfo" = "xyes"; then
                 if test "x$ac_cv_working_getnameinfo" = "xyes"; then
+                    APR_CHECK_GETNAMEINFO_IPV4_MAPPED
                     have_ipv6="1"
-                    AC_MSG_RESULT([yes])
+                    ipv6_result="yes"
                 else
-                    AC_MSG_RESULT([no -- no getnameinfo])
+                    ipv6_result="no -- no getnameinfo"
                 fi
             else
-                AC_MSG_RESULT([no -- no working getaddrinfo])
+                ipv6_result="no -- no working getaddrinfo"
             fi
         else
-            AC_MSG_RESULT([no -- no sockaddr_in6])
+            ipv6_result="no -- no sockaddr_in6"
         fi
     else
-        AC_MSG_RESULT([no -- the platform has problems supporting IPv6])
+        ipv6_result="no -- the platform has known problems supporting IPv6"
     fi
 fi
 
+AC_MSG_CHECKING(if APR supports IPv6)
+AC_MSG_RESULT($ipv6_result)
+
 AC_SUBST(have_ipv6)
 
 dnl Check for langinfo support
 
 AC_CHECK_HEADERS(langinfo.h)
 AC_CHECK_FUNCS(nl_langinfo)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/netware/filestat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/netware/filestat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/netware/filestat.c	2003-05-24 18:30:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/netware/filestat.c	2003-07-15 03:02:11.000000000 +0800
@@ -59,12 +59,16 @@
 #include "apr_general.h"
 #include "apr_strings.h"
 #include "apr_errno.h"
 #include "apr_hash.h"
 #include "apr_thread_rwlock.h"
 
+#ifdef HAVE_UTIME_H
+#include <utime.h>
+#endif
+
 /*#define APR_HAS_PSA*/
 
 static apr_filetype_e filetype_from_mode(mode_t mode)
 {
     apr_filetype_e type = APR_NOFILE;
 
@@ -384,6 +388,49 @@
 APR_DECLARE(apr_status_t) apr_lstat(apr_finfo_t *finfo, const char *fname,
                       apr_int32_t wanted, apr_pool_t *pool)
 {
     return apr_stat(finfo, fname, wanted | APR_FINFO_LINK, pool);
 }
 
+
+APR_DECLARE(apr_status_t) apr_file_mtime_set(const char *fname,
+                                              apr_time_t mtime,
+                                              apr_pool_t *pool)
+{
+    apr_status_t status;
+    apr_finfo_t finfo;
+
+    status = apr_stat(&finfo, fname, APR_FINFO_ATIME, pool);
+    if (!APR_STATUS_IS_SUCCESS(status)) {
+        return status;
+    }
+
+#ifdef HAVE_UTIMES
+    {
+      struct timeval tvp[2];
+    
+      tvp[0].tv_sec = apr_time_sec(finfo.atime);
+      tvp[0].tv_usec = apr_time_usec(finfo.atime);
+      tvp[1].tv_sec = apr_time_sec(mtime);
+      tvp[1].tv_usec = apr_time_usec(mtime);
+      
+      if (utimes(fname, tvp) == -1) {
+        return errno;
+      }
+    }
+#elif defined(HAVE_UTIME)
+    {
+      struct utimbuf buf;
+      
+      buf.actime = (time_t) (finfo.atime / APR_USEC_PER_SEC);
+      buf.modtime = (time_t) (mtime / APR_USEC_PER_SEC);
+      
+      if (utime(fname, &buf) == -1) {
+        return errno;
+      }
+    }
+#else
+    return APR_ENOTIMPL;
+#endif
+
+    return APR_SUCCESS;
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/netware/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/netware/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/netware/pipe.c	2003-03-21 02:39:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/netware/pipe.c	2003-10-25 00:35:15.000000000 +0800
@@ -133,34 +133,49 @@
         *timeout = thepipe->timeout;
         return APR_SUCCESS;
     }
     return APR_EINVAL;
 }
 
-APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
-                                          apr_os_file_t *thefile,
-                                          apr_pool_t *pool)
+APR_DECLARE(apr_status_t) apr_os_pipe_put_ex(apr_file_t **file,
+                                             apr_os_file_t *thefile,
+                                             int register_cleanup,
+                                             apr_pool_t *pool)
 {
     int *dafile = thefile;
     
     (*file) = apr_pcalloc(pool, sizeof(apr_file_t));
     (*file)->pool = pool;
     (*file)->eof_hit = 0;
     (*file)->is_pipe = 1;
     (*file)->blocking = BLK_UNKNOWN; /* app needs to make a timeout call */
     (*file)->timeout = -1;
     (*file)->ungetchar = -1; /* no char avail */
     (*file)->filedes = *dafile;
-    (*file)->flags = APR_FILE_NOCLEANUP;
+    if (!register_cleanup) {
+        (*file)->flags = APR_FILE_NOCLEANUP;
+    }
     (*file)->buffered = 0;
 #if APR_HAS_THREADS
     (*file)->thlock = NULL;
 #endif
+    if (register_cleanup) {
+        apr_pool_cleanup_register((*file)->pool, (void *)(*file),
+                                  apr_unix_file_cleanup,
+                                  apr_pool_cleanup_null);
+    }
     return APR_SUCCESS;
 }
 
+APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
+                                          apr_os_file_t *thefile,
+                                          apr_pool_t *pool)
+{
+    return apr_os_pipe_put_ex(file, thefile, 0, pool);
+}
+
 APR_DECLARE(apr_status_t) apr_file_pipe_create(apr_file_t **in, apr_file_t **out, apr_pool_t *pool)
 {
 	int     	filedes[2];
 	int 		err;
 
     if (pipe(filedes) == -1) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/filestat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/filestat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/filestat.c	2003-05-24 18:30:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/filestat.c	2003-07-09 00:03:37.000000000 +0800
@@ -252,6 +252,15 @@
             rc = DosSetPathInfo(fname, FIL_STANDARD, &fs3, sizeof(fs3), 0);
         }
     }
 
     return APR_FROM_OS_ERROR(rc);
 }
+
+
+/* ### Somebody please write this! */
+APR_DECLARE(apr_status_t) apr_file_mtime_set(const char *fname,
+                                              apr_time_t mtime,
+                                              apr_pool_t *pool)
+{
+  return APR_ENOTIMPL;
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/Makefile.in	2003-02-26 18:38:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/Makefile.in	2003-08-29 21:45:02.000000000 +0800
@@ -14,13 +14,14 @@
 	maperrorcode.lo \
 	fullrw.lo \
 	filepath.lo \
 	filepath_util.lo \
 	filesys.lo \
 	mktemp.lo \
-	copy.lo
+	copy.lo \
+	tempdir.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
 
 INCDIR=../../include
 OSDIR=$(INCDIR)/arch/@OSDIR@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/os2/pipe.c	2003-01-07 08:52:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2/pipe.c	2003-10-25 00:35:15.000000000 +0800
@@ -181,20 +181,35 @@
     }
     return APR_EINVAL;
 }
 
 
 
-APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
-                                          apr_os_file_t *thefile,
-                                          apr_pool_t *pool)
+APR_DECLARE(apr_status_t) apr_os_pipe_put_ex(apr_file_t **file,
+                                             apr_os_file_t *thefile,
+                                             int register_cleanup,
+                                             apr_pool_t *pool)
 {
     (*file) = apr_pcalloc(pool, sizeof(apr_file_t));
     (*file)->pool = pool;
     (*file)->isopen = TRUE;
     (*file)->pipe = 1;
     (*file)->blocking = BLK_UNKNOWN; /* app needs to make a timeout call */
     (*file)->timeout = -1;
     (*file)->filedes = *thefile;
 
+    if (register_cleanup) {
+        apr_pool_cleanup_register(pool, *file, apr_file_cleanup,
+                                  apr_pool_cleanup_null);
+    }
+
     return APR_SUCCESS;
 }
+
+
+
+APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
+                                          apr_os_file_t *thefile,
+                                          apr_pool_t *pool)
+{
+    return apr_os_pipe_put_ex(file, thefile, 0, pool);
+}
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/os2: tempdir.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/filestat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/filestat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/filestat.c	2003-05-24 18:30:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/filestat.c	2003-07-09 00:03:37.000000000 +0800
@@ -210,12 +210,57 @@
         }
     }
 
     return apr_file_perms_set(fname, finfo.protection);
 }
 
+
+APR_DECLARE(apr_status_t) apr_file_mtime_set(const char *fname,
+                                              apr_time_t mtime,
+                                              apr_pool_t *pool)
+{
+    apr_status_t status;
+    apr_finfo_t finfo;
+
+    status = apr_stat(&finfo, fname, APR_FINFO_ATIME, pool);
+    if (!APR_STATUS_IS_SUCCESS(status)) {
+        return status;
+    }
+
+#ifdef HAVE_UTIMES
+    {
+      struct timeval tvp[2];
+    
+      tvp[0].tv_sec = apr_time_sec(finfo.atime);
+      tvp[0].tv_usec = apr_time_usec(finfo.atime);
+      tvp[1].tv_sec = apr_time_sec(mtime);
+      tvp[1].tv_usec = apr_time_usec(mtime);
+      
+      if (utimes(fname, tvp) == -1) {
+        return errno;
+      }
+    }
+#elif defined(HAVE_UTIME)
+    {
+      struct utimbuf buf;
+      
+      buf.actime = (time_t) (finfo.atime / APR_USEC_PER_SEC);
+      buf.modtime = (time_t) (mtime / APR_USEC_PER_SEC);
+      
+      if (utime(fname, &buf) == -1) {
+        return errno;
+      }
+    }
+#else
+    return APR_ENOTIMPL;
+#endif
+
+    return APR_SUCCESS;
+}
+
+
 APR_DECLARE(apr_status_t) apr_stat(apr_finfo_t *finfo, 
                                    const char *fname, 
                                    apr_int32_t wanted, apr_pool_t *pool)
 {
     struct stat info;
     int srv;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/Makefile.in	2003-02-13 04:20:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/Makefile.in	2003-08-23 18:01:22.000000000 +0800
@@ -12,13 +12,14 @@
 	flock.lo \
 	fullrw.lo \
 	open.lo \
 	pipe.lo \
 	readwrite.lo \
 	seek.lo \
-	mktemp.lo
+	mktemp.lo \
+	tempdir.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
 
 INCDIR=../../include
 OSDIR=$(INCDIR)/arch/@OSDIR@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/unix/pipe.c	2003-03-19 13:32:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix/pipe.c	2003-10-25 00:35:16.000000000 +0800
@@ -168,34 +168,49 @@
         *timeout = thepipe->timeout;
         return APR_SUCCESS;
     }
     return APR_EINVAL;
 }
 
-APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
-                                          apr_os_file_t *thefile,
-                                          apr_pool_t *pool)
+APR_DECLARE(apr_status_t) apr_os_pipe_put_ex(apr_file_t **file,
+                                             apr_os_file_t *thefile,
+                                             int register_cleanup,
+                                             apr_pool_t *pool)
 {
     int *dafile = thefile;
     
     (*file) = apr_pcalloc(pool, sizeof(apr_file_t));
     (*file)->pool = pool;
     (*file)->eof_hit = 0;
     (*file)->is_pipe = 1;
     (*file)->blocking = BLK_UNKNOWN; /* app needs to make a timeout call */
     (*file)->timeout = -1;
     (*file)->ungetchar = -1; /* no char avail */
     (*file)->filedes = *dafile;
-    (*file)->flags = APR_FILE_NOCLEANUP;
+    if (!register_cleanup) {
+        (*file)->flags = APR_FILE_NOCLEANUP;
+    }
     (*file)->buffered = 0;
 #if APR_HAS_THREADS
     (*file)->thlock = NULL;
 #endif
+    if (register_cleanup) {
+        apr_pool_cleanup_register((*file)->pool, (void *)(*file),
+                                  apr_unix_file_cleanup,
+                                  apr_pool_cleanup_null);
+    }
     return APR_SUCCESS;
 }
 
+APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
+                                          apr_os_file_t *thefile,
+                                          apr_pool_t *pool)
+{
+    return apr_os_pipe_put_ex(file, thefile, 0, pool);
+}
+
 APR_DECLARE(apr_status_t) apr_file_pipe_create(apr_file_t **in, apr_file_t **out, apr_pool_t *pool)
 {
     int filedes[2];
 
     if (pipe(filedes) == -1) {
         return errno;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/unix: tempdir.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filedup.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filedup.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filedup.c	2003-01-07 08:52:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filedup.c	2003-09-20 02:07:26.000000000 +0800
@@ -78,12 +78,13 @@
     (*new_file)->filehand = newhand;
     (*new_file)->flags = old_file->flags & ~APR_INHERIT;
     (*new_file)->pool = p;
     (*new_file)->fname = apr_pstrdup(p, old_file->fname);
     (*new_file)->append = old_file->append;
     (*new_file)->buffered = FALSE;
+    (*new_file)->ungetchar = old_file->ungetchar;
 
     apr_pool_cleanup_register((*new_file)->pool, (void *)(*new_file), file_cleanup,
                         apr_pool_cleanup_null);
 
     return APR_SUCCESS;
 #endif /* !defined(_WIN32_WCE) */
@@ -147,12 +148,13 @@
 
     new_file->flags = newflags;
     new_file->filehand = newhand;
     new_file->fname = apr_pstrdup(new_file->pool, old_file->fname);
     new_file->append = old_file->append;
     new_file->buffered = FALSE;
+    new_file->ungetchar = old_file->ungetchar;
 
     return APR_SUCCESS;
 #endif /* !defined(_WIN32_WCE) */
 }
 
 APR_DECLARE(apr_status_t) apr_file_setaside(apr_file_t **new_file,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filepath.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filepath.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filepath.c	2003-06-25 15:02:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filepath.c	2003-09-18 03:07:30.000000000 +0800
@@ -703,14 +703,14 @@
             /* This isn't legal unless the unc path is completed
              */
             if (fixunc)
                 return APR_EBADPATH;
 #endif
 
-            /* backpath (../) */
-            if (pathlen <= rootlen) 
+            /* backpath (../) when an absolute path is given */
+            if (rootlen && (pathlen <= rootlen)) 
             {
                 /* Attempt to move above root.  Always die if the 
                  * APR_FILEPATH_SECUREROOTTEST flag is specified.
                  */
                 if (flags & APR_FILEPATH_SECUREROOTTEST)
                     return APR_EABOVEROOT;
@@ -733,34 +733,39 @@
                     return APR_EABOVEROOT;
 
                 /* Otherwise append another backpath.
                  */
                 if (pathlen + 3 >= sizeof(path))
                     return APR_ENAMETOOLONG;
-                memcpy(path + pathlen, ((flags && APR_FILEPATH_NATIVE) 
+                memcpy(path + pathlen, ((flags & APR_FILEPATH_NATIVE) 
                                           ? "..\\" : "../"), 3);
                 pathlen += 3;
+                /* The 'root' part of this path now includes the ../ path,
+                 * because that backpath will not be parsed by the truename
+                 * code below.
+                 */
+                keptlen = pathlen;
             }
             else 
             {
                 /* otherwise crop the prior segment 
                  */
                 do {
                     --pathlen;
                 } while (pathlen && path[pathlen - 1] != '/'
                                  && path[pathlen - 1] != '\\');
-            }
 
-            /* Now test if we are above where we started and back up
-             * the keptlen offset to reflect the added/altered path.
-             */
-            if (pathlen < keptlen) 
-            {
-                if (flags & APR_FILEPATH_SECUREROOTTEST)
-                    return APR_EABOVEROOT;
-                keptlen = pathlen;
+                /* Now test if we are above where we started and back up
+                 * the keptlen offset to reflect the added/altered path.
+                 */
+                if (pathlen < keptlen) 
+                {
+                    if (flags & APR_FILEPATH_SECUREROOTTEST)
+                        return APR_EABOVEROOT;
+                    keptlen = pathlen;
+                }
             }
         }
         else /* not empty or dots */
         {
 #ifndef NETWARE
             if (fixunc) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filestat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filestat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/filestat.c	2003-05-24 18:30:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/filestat.c	2003-07-08 06:44:10.000000000 +0800
@@ -759,6 +759,40 @@
 
     if (rv == 0)
         return apr_get_os_error();
 
     return APR_SUCCESS;
 }
+
+
+APR_DECLARE(apr_status_t) apr_file_mtime_set(const char *fname,
+                                             apr_time_t mtime,
+                                             apr_pool_t *pool)
+{
+    apr_file_t *thefile;
+    apr_status_t rv;
+
+    rv = apr_file_open(&thefile, fname,
+                       APR_READ | APR_WRITEATTRS,
+                       APR_OS_DEFAULT, pool);
+    if (!rv)
+    {
+        FILETIME file_ctime;
+        FILETIME file_atime;
+        FILETIME file_mtime;
+
+        if (!GetFileTime(thefile->filehand,
+                         &file_ctime, &file_atime, &file_mtime))
+            rv = apr_get_os_error();
+        else
+        {
+            AprTimeToFileTime(&file_mtime, mtime);
+            if (!SetFileTime(thefile->filehand,
+                             &file_ctime, &file_atime, &file_mtime))
+                rv = apr_get_os_error();
+        }
+
+        apr_file_close(thefile);
+    }
+
+    return rv;
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/open.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/open.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/file_io/win32/open.c	2003-01-07 08:52:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/file_io/win32/open.c	2003-07-08 06:44:10.000000000 +0800
@@ -306,13 +306,16 @@
     if (flag & APR_READ) {
         oflags |= GENERIC_READ;
     }
     if (flag & APR_WRITE) {
         oflags |= GENERIC_WRITE;
     }
-    
+    if (flag & APR_WRITEATTRS) {
+        oflags |= FILE_WRITE_ATTRIBUTES;
+    }
+
     if (apr_os_level >= APR_WIN_NT) 
         sharemode |= FILE_SHARE_DELETE;
 
     if (flag & APR_CREATE) {
         if (flag & APR_EXCL) {
             /* only create new if file does not already exist */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_atomic.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_atomic.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_atomic.h	2003-05-03 12:11:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_atomic.h	2003-09-20 05:58:18.000000000 +0800
@@ -161,13 +161,13 @@
  * a macro here will be declared as a function later, and
  * apr_atomic.c will provide a mutex-based default implementation.
  */
 
 #if defined(WIN32)
 
-typedef LONG apr_atomic_t;
+#define apr_atomic_t LONG
 
 #define apr_atomic_add(mem, val)     InterlockedExchangeAdd(mem,val)
 #define apr_atomic_dec(mem)          InterlockedDecrement(mem)
 #define apr_atomic_inc(mem)          InterlockedIncrement(mem)
 #define apr_atomic_set(mem, val)     InterlockedExchange(mem, val)
 #define apr_atomic_read(mem)         (*mem)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_file_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_file_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_file_io.h	2003-06-15 08:05:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_file_io.h	2003-08-23 18:01:22.000000000 +0800
@@ -83,31 +83,34 @@
 
 /**
  * @defgroup apr_file_open_flags File Open Flags/Routines
  * @{
  */
 
-#define APR_READ       1           /**< Open the file for reading */
-#define APR_WRITE      2           /**< Open the file for writing */
-#define APR_CREATE     4           /**< Create the file if not there */
-#define APR_APPEND     8           /**< Append to the end of the file */
-#define APR_TRUNCATE   16          /**< Open the file and truncate to 0 length */
-#define APR_BINARY     32          /**< Open the file in binary mode */
-#define APR_EXCL       64          /**< Open should fail if APR_CREATE and file
+/* Note to implementors: Values in the range 0x00100000--0x80000000
+   are reserved for platform-specific values. */
+
+#define APR_READ       0x00001     /**< Open the file for reading */
+#define APR_WRITE      0x00002     /**< Open the file for writing */
+#define APR_CREATE     0x00004     /**< Create the file if not there */
+#define APR_APPEND     0x00008     /**< Append to the end of the file */
+#define APR_TRUNCATE   0x00010     /**< Open the file and truncate to 0 length */
+#define APR_BINARY     0x00020     /**< Open the file in binary mode */
+#define APR_EXCL       0x00040     /**< Open should fail if APR_CREATE and file
                                         exists. */
-#define APR_BUFFERED   128         /**< Open the file for buffered I/O */
-#define APR_DELONCLOSE 256         /**< Delete the file after close */
-#define APR_XTHREAD    512         /**< Platform dependent tag to open the file
+#define APR_BUFFERED   0x00080     /**< Open the file for buffered I/O */
+#define APR_DELONCLOSE 0x00100     /**< Delete the file after close */
+#define APR_XTHREAD    0x00200     /**< Platform dependent tag to open the file
                                         for use across multiple threads */
-#define APR_SHARELOCK  1024        /**< Platform dependent support for higher
+#define APR_SHARELOCK  0x00400     /**< Platform dependent support for higher
                                         level locked read/write access to support
                                         writes across process/machines */
-#define APR_FILE_NOCLEANUP  2048   /**< Do not register a cleanup when the file
+#define APR_FILE_NOCLEANUP 0x00800 /**< Do not register a cleanup when the file
                                         is opened */
-#define APR_SENDFILE_ENABLED  4096 /**< Advisory flag that this file should 
-                                        support apr_sendfile operation */ 
+#define APR_SENDFILE_ENABLED 0x01000 /**< Advisory flag that this file should
+                                          support apr_sendfile operation */
 /** @} */
 
 /**
  * @defgroup apr_file_seek_flags File Seek Flags
  * @{
  */
@@ -654,12 +657,24 @@
 APR_DECLARE(apr_status_t) apr_file_attrs_set(const char *fname,
                                              apr_fileattrs_t attributes,
                                              apr_fileattrs_t attr_mask,
                                              apr_pool_t *cont);
 
 /**
+ * Set the mtime of the specified file.
+ * @param fname The full path to the file (using / on all systems)
+ * @param mtime The mtime to apply to the file.
+ * @param pool The pool to use.
+ * @warning Platforms which do not implement this feature will return
+ *      APR_ENOTIMPL.
+ */
+APR_DECLARE(apr_status_t) apr_file_mtime_set(const char *fname,
+                                             apr_time_t mtime,
+                                             apr_pool_t *pool);
+
+/**
  * Create a new directory on the file system.
  * @param path the path for the directory to be created.  (use / on all systems)
  * @param perm Permissions for the new direcoty.
  * @param cont the pool to use.
  */                        
 APR_DECLARE(apr_status_t) apr_dir_make(const char *path, apr_fileperms_t perm, 
@@ -746,12 +761,28 @@
  * array.  
  *
  */
 APR_DECLARE(apr_status_t) apr_file_mktemp(apr_file_t **fp, char *templ,
                                           apr_int32_t flags, apr_pool_t *p);
 
+
+/**
+ * Find an existing directory suitable as a temporary storage location.
+ * @param temp_dir The temp directory.
+ * @param p The pool to use for any necessary allocations.
+ * @remark   
+ * This function uses an algorithm to search for a directory that an
+ * an application can use for temporary storage.  Once such a
+ * directory is found, that location is cached by the library.  Thus,
+ * callers only pay the cost of this algorithm once if that one time
+ * is successful.
+ *
+ */
+APR_DECLARE(apr_status_t) apr_temp_dir_get(const char **temp_dir, 
+                                           apr_pool_t *p);
+
 /** @} */
 
 #ifdef __cplusplus
 }
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.h.in	2003-05-12 18:49:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.h.in	2003-10-17 06:13:02.000000000 +0800
@@ -124,15 +124,17 @@
 #define APR_HAVE_STDARG_H        @stdargh@
 #define APR_HAVE_STDINT_H        @stdint@
 #define APR_HAVE_STDIO_H         @stdioh@
 #define APR_HAVE_STDLIB_H        @stdlibh@
 #define APR_HAVE_STRING_H        @stringh@
 #define APR_HAVE_STRINGS_H       @stringsh@
+#define APR_HAVE_SYS_IOCTL_H     @sys_ioctlh@
 #define APR_HAVE_SYS_SENDFILE_H  @sys_sendfileh@
 #define APR_HAVE_SYS_SIGNAL_H    @sys_signalh@
 #define APR_HAVE_SYS_SOCKET_H    @sys_socketh@
+#define APR_HAVE_SYS_SOCKIO_H    @sys_sockioh@
 #define APR_HAVE_SYS_SYSLIMITS_H @sys_syslimitsh@
 #define APR_HAVE_SYS_TIME_H      @sys_timeh@
 #define APR_HAVE_SYS_TYPES_H     @sys_typesh@
 #define APR_HAVE_SYS_UIO_H       @sys_uioh@
 #define APR_HAVE_SYS_UN_H        @sys_unh@
 #define APR_HAVE_SYS_WAIT_H      @sys_waith@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.hnw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.hnw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.hnw	2003-04-16 05:45:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.hnw	2003-10-17 06:13:02.000000000 +0800
@@ -140,12 +140,13 @@
 #define APR_HAVE_STRING_H       1
 #define APR_HAVE_STRINGS_H      0
 #define APR_HAVE_STRTOLL	1
 #define APR_HAVE_SYS_SENDFILE_H 0
 #define APR_HAVE_SYS_SIGNAL_H   0
 #define APR_HAVE_SYS_SOCKET_H   0
+#define APR_HAVE_SYS_SOCKIO_H   0
 #define APR_HAVE_SYS_SYSLIMITS_H 0
 #define APR_HAVE_SYS_TIME_H     0
 #define APR_HAVE_SYS_TYPES_H    1
 #define APR_HAVE_SYS_UIO_H      1
 #define APR_HAVE_SYS_UN_H       0
 #define APR_HAVE_SYS_WAIT_H     0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.hw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.hw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr.hw	2003-04-16 06:28:13.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr.hw	2003-10-17 06:13:02.000000000 +0800
@@ -168,12 +168,13 @@
 #define APR_HAVE_STDLIB_H       1
 #define APR_HAVE_STRING_H       1
 #define APR_HAVE_STRINGS_H      0
 #define APR_HAVE_SYS_SENDFILE_H 0
 #define APR_HAVE_SYS_SIGNAL_H   0
 #define APR_HAVE_SYS_SOCKET_H   0
+#define APR_HAVE_SYS_SOCKIO_H   0
 #define APR_HAVE_SYS_SYSLIMITS_H 0
 #define APR_HAVE_SYS_TIME_H     0
 #define APR_HAVE_SYS_TYPES_H    1
 #define APR_HAVE_SYS_UIO_H      0
 #define APR_HAVE_SYS_WAIT_H     0
 #define APR_HAVE_UNISTD_H       0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_network_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_network_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_network_io.h	2003-05-30 10:26:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_network_io.h	2003-10-17 06:13:02.000000000 +0800
@@ -718,12 +718,21 @@
  * @param t Socket timeout returned from the query.
  */
 APR_DECLARE(apr_status_t) apr_socket_timeout_get(apr_socket_t *sock, 
                                                  apr_interval_time_t *t);
 
 /**
+ * Query the specified socket if at the OOB/Urgent data mark
+ * @param sock The socket to query
+ * @param atmark Is set to true if socket is at the OOB/urgent mark,
+ *               otherwise is set to false.
+ */
+APR_DECLARE(apr_status_t) apr_socket_atmark(apr_socket_t *sock, 
+                                            int *atmark);
+
+/**
  * Return an apr_sockaddr_t from an apr_socket_t
  * @param sa The returned apr_sockaddr_t.
  * @param which Which interface do we want the apr_sockaddr_t for?
  * @param sock The socket to use
  */
 APR_DECLARE(apr_status_t) apr_socket_addr_get(apr_sockaddr_t **sa,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_pools.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_pools.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_pools.h	2003-03-12 04:02:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_pools.h	2003-09-27 03:12:32.000000000 +0800
@@ -478,16 +478,18 @@
  * @param pool The current pool
  * @warning The data to be attached to the pool should have a life span
  *          at least as long as the pool it is being attached to.
  *
  *      Users of APR must take EXTREME care when choosing a key to
  *      use for their data.  It is possible to accidentally overwrite
- *      data by choosing a key that another part of the program is using
- *      It is advised that steps are taken to ensure that a unique
- *      key is used at all times.
- * @bug Specify how to ensure this uniqueness!
+ *      data by choosing a key that another part of the program is using.
+ *      Therefore it is advised that steps are taken to ensure that unique
+ *      keys are used for all of the userdata objects in a particular pool
+ *      (the same key in two different pools or a pool and one of its
+ *      subpools is okay) at all times.  Careful namespace prefixing of
+ *      key names is a typical way to help ensure this uniqueness.
  */
 APR_DECLARE(apr_status_t) apr_pool_userdata_set(
     const void *data,
     const char *key,
     apr_status_t (*cleanup)(void *),
     apr_pool_t *pool);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_portable.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_portable.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_portable.h	2003-03-06 05:22:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_portable.h	2003-10-25 00:35:16.000000000 +0800
@@ -388,12 +388,27 @@
  */
 APR_DECLARE(apr_status_t) apr_os_pipe_put(apr_file_t **file,
                                           apr_os_file_t *thefile,
                                           apr_pool_t *cont);
 
 /**
+ * convert the file from os specific type to apr type.
+ * @param file The apr file we are converting to.
+ * @param thefile The os specific pipe to convert
+ * @param register_cleanup A cleanup will be registered on the apr_file_t
+ *   to issue apr_file_close().
+ * @param cont The pool to use if it is needed.
+ * @remark On Unix, it is only possible to put a file descriptor into
+ *         an apr file type.
+ */
+APR_DECLARE(apr_status_t) apr_os_pipe_put_ex(apr_file_t **file,
+                                             apr_os_file_t *thefile,
+                                             int register_cleanup,
+                                             apr_pool_t *cont);
+
+/**
  * convert the dir from os specific type to apr type.
  * @param dir The apr dir we are converting to.
  * @param thedir The os specific dir to convert
  * @param cont The pool to use when creating to apr directory.
  */
 APR_DECLARE(apr_status_t) apr_os_dir_put(apr_dir_t **dir,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_ring.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_ring.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_ring.h	2003-03-06 05:22:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_ring.h	2003-08-13 09:51:29.000000000 +0800
@@ -479,42 +479,61 @@
 
 
 /* Debugging tools: */
 
 #ifdef APR_RING_DEBUG
 #include <stdio.h>
+#include <assert.h>
+
 #define APR_RING_CHECK_ONE(msg, ptr)					\
 	fprintf(stderr, "*** %s %p\n", msg, ptr)
+
 #define APR_RING_CHECK(hp, elem, link, msg)				\
 	APR_RING_CHECK_ELEM(APR_RING_SENTINEL(hp, elem, link), elem, link, msg)
+
 #define APR_RING_CHECK_ELEM(ep, elem, link, msg) do {			\
 	struct elem *start = (ep);					\
-	struct elem *this = start;					\
+	struct elem *here = start;					\
 	fprintf(stderr, "*** ring check start -- %s\n", msg);		\
 	do {								\
-	    fprintf(stderr, "\telem %p\n", this);			\
+	    fprintf(stderr, "\telem %p\n", here);			\
 	    fprintf(stderr, "\telem->next %p\n",			\
-		    APR_RING_NEXT(this, link));				\
+		    APR_RING_NEXT(here, link));				\
 	    fprintf(stderr, "\telem->prev %p\n",			\
-		    APR_RING_PREV(this, link));				\
+		    APR_RING_PREV(here, link));				\
 	    fprintf(stderr, "\telem->next->prev %p\n",			\
-		    APR_RING_PREV(APR_RING_NEXT(this, link), link));	\
+		    APR_RING_PREV(APR_RING_NEXT(here, link), link));	\
 	    fprintf(stderr, "\telem->prev->next %p\n",			\
-		    APR_RING_NEXT(APR_RING_PREV(this, link), link));	\
-	    if (APR_RING_PREV(APR_RING_NEXT(this, link), link) != this) { \
-		fprintf(stderr, "\t*** this->next->prev != this\n");	\
+		    APR_RING_NEXT(APR_RING_PREV(here, link), link));	\
+	    if (APR_RING_PREV(APR_RING_NEXT(here, link), link) != here) { \
+		fprintf(stderr, "\t*** elem->next->prev != elem\n");	\
 		break;							\
 	    }								\
-	    if (APR_RING_NEXT(APR_RING_PREV(this, link), link) != this) { \
-		fprintf(stderr, "\t*** this->prev->next != this\n");	\
+	    if (APR_RING_NEXT(APR_RING_PREV(here, link), link) != here) { \
+		fprintf(stderr, "\t*** elem->prev->next != elem\n");	\
 		break;							\
 	    }								\
-	    this = APR_RING_NEXT(this, link);				\
-	} while (this != start);					\
+	    here = APR_RING_NEXT(here, link);				\
+	} while (here != start);					\
 	fprintf(stderr, "*** ring check end\n");			\
     } while (0)
+
+#define APR_RING_CHECK_CONSISTENCY(hp, elem, link)			\
+	APR_RING_CHECK_ELEM_CONSISTENCY(APR_RING_SENTINEL(hp, elem, link),\
+					elem, link)
+
+#define APR_RING_CHECK_ELEM_CONSISTENCY(ep, elem, link) do {		\
+	struct elem *start = (ep);					\
+	struct elem *here = start;					\
+	do {								\
+	    assert(APR_RING_PREV(APR_RING_NEXT(here, link), link) == here); \
+	    assert(APR_RING_NEXT(APR_RING_PREV(here, link), link) == here); \
+	    here = APR_RING_NEXT(here, link);				\
+	} while (here != start);					\
+    } while (0)
+
 #else
 /**
  * Print a single pointer value to STDERR
  *   (This is a no-op unless APR_RING_DEBUG is defined.)
  * @param msg Descriptive message
  * @param ptr Pointer value to print
@@ -529,21 +548,42 @@
  * @param elem The name of the element struct
  * @param link The name of the APR_RING_ENTRY in the element struct
  * @param msg  Descriptive message
  */
 #define APR_RING_CHECK(hp, elem, link, msg)
 /**
+ * Loops around a ring and checks all the pointers for consistency.  Pops
+ * an assertion if any inconsistency is found.  Same idea as APR_RING_CHECK()
+ * except that it's silent if all is well.
+ *   (This is a no-op unless APR_RING_DEBUG is defined.)
+ * @param hp   Head of the ring
+ * @param elem The name of the element struct
+ * @param link The name of the APR_RING_ENTRY in the element struct
+ */
+#define APR_RING_CHECK_CONSISTENCY(hp, elem, link)
+/**
  * Dump all ring pointers to STDERR, starting with the given element and
  * looping all the way around the ring back to that element.  Aborts if
  * an inconsistency is found.
  *   (This is a no-op unless APR_RING_DEBUG is defined.)
  * @param ep   The element
  * @param elem The name of the element struct
  * @param link The name of the APR_RING_ENTRY in the element struct
  * @param msg  Descriptive message
  */
 #define APR_RING_CHECK_ELEM(ep, elem, link, msg)
+/**
+ * Loops around a ring, starting with the given element, and checks all
+ * the pointers for consistency.  Pops an assertion if any inconsistency
+ * is found.  Same idea as APR_RING_CHECK_ELEM() except that it's silent
+ * if all is well.
+ *   (This is a no-op unless APR_RING_DEBUG is defined.)
+ * @param ep   The element
+ * @param elem The name of the element struct
+ * @param link The name of the APR_RING_ENTRY in the element struct
+ */
+#define APR_RING_CHECK_ELEM_CONSISTENCY(ep, elem, link)
 #endif
 
 /** @} */ 
 
 #endif /* !APR_RING_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_version.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_version.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/apr_version.h	2003-03-31 13:29:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/apr_version.h	2003-09-26 13:27:22.000000000 +0800
@@ -96,13 +96,13 @@
  * Minor API changes that do not cause binary compatibility problems.
  * Should be reset to 0 when upgrading APR_MAJOR_VERSION
  */
 #define APR_MINOR_VERSION       9
 
 /** patch level */
-#define APR_PATCH_VERSION       4
+#define APR_PATCH_VERSION       5
 
 
 /** 
  *  This symbol is defined for internal, "development" copies of APR. This
  *  symbol will be #undef'd for releases. 
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/netware/apr_arch_file_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/netware/apr_arch_file_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/netware/apr_arch_file_io.h	2003-01-07 08:52:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/netware/apr_arch_file_io.h	2003-10-02 22:49:33.000000000 +0800
@@ -144,14 +144,12 @@
     struct stat info;
     char *casedName;
     apr_time_t expire;
     NXPathCtx_t pathCtx;
 };
 
-extern apr_int32_t CpuCurrentProcessor; /* system variable */
-
 #define MAX_SERVER_NAME     64
 #define MAX_VOLUME_NAME     64
 #define MAX_PATH_NAME       256
 #define MAX_FILE_NAME       256
 
 #define DRIVE_ONLY          1
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/netware/apr_private.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/netware/apr_private.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/netware/apr_private.h	2003-02-17 05:59:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/netware/apr_private.h	2003-08-01 01:44:36.000000000 +0800
@@ -84,19 +84,25 @@
 #define HAVE_STDDEF_H   1
 #define HAVE_STDLIB_H   1
 #define HAVE_SYS_STAT_H 1
 #define HAVE_SYS_MMAN_H 1
 #define HAVE_FCNTL_H    1
 #define HAVE_ICONV_H    1
+#define HAVE_UTIME_H    1
 
 #define HAVE_STRICMP    1
 #define HAVE_STRNICMP   1
 #define HAVE_STRDUP     1
 #define HAVE_STRSTR     1
 #define HAVE_MEMCHR     1
 #define HAVE_CALLOC     1
+#define HAVE_UTIME      1
+
+#define HAVE_GETENV     1
+#define HAVE_SETENV     1
+#define HAVE_UNSETENV   1
 
 /*#define DSO_USE_DLFCN */
 
 #ifdef NW_BUILD_IPV6
 #define HAVE_GETADDRINFO 1
 #define HAVE_GETNAMEINFO 1
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/os2/apr_arch_networkio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/os2/apr_arch_networkio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/os2/apr_arch_networkio.h	2003-01-07 08:06:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/os2/apr_arch_networkio.h	2003-07-08 20:53:10.000000000 +0800
@@ -60,12 +60,19 @@
 #include "apr_general.h"
 #include "apr_arch_os2calls.h"
 #if APR_HAVE_NETDB_H
 #include <netdb.h>
 #endif
 
+typedef struct sock_userdata_t sock_userdata_t;
+struct sock_userdata_t {
+    sock_userdata_t *next;
+    const char *key;
+    void *data;
+};
+
 struct apr_socket_t {
     apr_pool_t *cntxt;
     int socketdes;
     int type;
     int protocol;
     apr_sockaddr_t *local_addr;
@@ -74,12 +81,13 @@
     int nonblock;
     int local_port_unknown;
     int local_interface_unknown;
     int remote_addr_unknown;
     apr_int32_t netmask;
     apr_int32_t inherit;
+    sock_userdata_t *userdata;
 };
 
 /* Error codes returned from sock_errno() */
 #define SOCBASEERR              10000
 #define SOCEPERM                (SOCBASEERR+1)             /* Not owner */
 #define SOCESRCH                (SOCBASEERR+3)             /* No such process */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_arch_networkio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_arch_networkio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_arch_networkio.h	2003-01-07 07:44:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_arch_networkio.h	2003-10-17 06:13:02.000000000 +0800
@@ -99,32 +99,45 @@
 #if APR_HAVE_ARPA_INET_H
 #include <arpa/inet.h>
 #endif
 #if APR_HAVE_SYS_SOCKET_H
 #include <sys/socket.h>
 #endif
+#if APR_HAVE_SYS_SOCKIO_H
+#include <sys/sockio.h>
+#endif
 #if APR_HAVE_NETDB_H
 #include <netdb.h>
 #endif
 #if APR_HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
 #if APR_HAVE_SYS_SENDFILE_H
 #include <sys/sendfile.h>
 #endif
+#if APR_HAVE_SYS_IOCTL_H
+#include <sys/ioctl.h>
+#endif
 /* End System Headers */
 
 #ifndef HAVE_POLLIN
 #define POLLIN   1
 #define POLLPRI  2
 #define POLLOUT  4
 #define POLLERR  8
 #define POLLHUP  16
 #define POLLNVAL 32
 #endif
 
+typedef struct sock_userdata_t sock_userdata_t;
+struct sock_userdata_t {
+    sock_userdata_t *next;
+    const char *key;
+    void *data;
+};
+
 struct apr_socket_t {
     apr_pool_t *cntxt;
     int socketdes;
     int type;
     int protocol;
     apr_sockaddr_t *local_addr;
@@ -135,12 +148,13 @@
 #endif
     int local_port_unknown;
     int local_interface_unknown;
     int remote_addr_unknown;
     apr_int32_t netmask;
     apr_int32_t inherit;
+    sock_userdata_t *userdata;
 };
 
 const char *apr_inet_ntop(int af, const void *src, char *dst, apr_size_t size);
 int apr_inet_pton(int af, const char *src, void *dst);
 void apr_sockaddr_vars_set(apr_sockaddr_t *, int, apr_port_t);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_arch_thread_mutex.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_arch_thread_mutex.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_arch_thread_mutex.h	2003-01-07 07:44:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_arch_thread_mutex.h	2003-08-08 06:16:24.000000000 +0800
@@ -57,23 +57,24 @@
 
 #include "apr.h"
 #include "apr_private.h"
 #include "apr_general.h"
 #include "apr_thread_mutex.h"
 #include "apr_portable.h"
+#include "apr_atomic.h"
 
 #if APR_HAVE_PTHREAD_H
 #include <pthread.h>
 #endif
 
 #if APR_HAS_THREADS
 struct apr_thread_mutex_t {
     apr_pool_t *pool;
     pthread_mutex_t mutex;
-    apr_os_thread_t owner;
-    int owner_ref;
+    volatile apr_os_thread_t owner;
+    volatile apr_atomic_t owner_ref;
     char nested; /* a boolean */
 };
 #endif
 
 #endif  /* THREAD_MUTEX_H */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_private.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_private.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/unix/apr_private.h.in	2003-07-07 22:51:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/unix/apr_private.h.in	2003-10-25 01:50:58.000000000 +0800
@@ -61,12 +61,15 @@
 /* Define if gethostbyname_r has the glibc style */
 #undef GETHOSTBYNAME_R_GLIBC2
 
 /* Define if gethostbyname_r has the hostent_data for the third argument */
 #undef GETHOSTBYNAME_R_HOSTENT_DATA
 
+/* Define if getnameinfo does not map IPv4 address correctly */
+#undef GETNAMEINFO_IPV4_MAPPED_FAILS
+
 /* Define to 1 if you have the `alloca' function. */
 #undef HAVE_ALLOCA
 
 /* Define to 1 if you have the <alloca.h> header file. */
 #undef HAVE_ALLOCA_H
 
@@ -394,15 +397,12 @@
 /* Define to 1 if you have the `sigsuspend' function. */
 #undef HAVE_SIGSUSPEND
 
 /* Define to 1 if you have the `sigwait' function. */
 #undef HAVE_SIGWAIT
 
-/* Define if we have length field in sockaddr_in */
-#undef HAVE_SOCKADDR_SA_LEN
-
 /* Whether you have socklen_t */
 #undef HAVE_SOCKLEN_T
 
 /* Define if SO_ACCEPTFILTER is defined in sys/socket.h */
 #undef HAVE_SO_ACCEPTFILTER
 
@@ -454,12 +454,15 @@
 /* Define to 1 if you have the <sysgtime.h> header file. */
 #undef HAVE_SYSGTIME_H
 
 /* Define to 1 if you have the <sys/file.h> header file. */
 #undef HAVE_SYS_FILE_H
 
+/* Define to 1 if you have the <sys/ioctl.h> header file. */
+#undef HAVE_SYS_IOCTL_H
+
 /* Define to 1 if you have the <sys/ipc.h> header file. */
 #undef HAVE_SYS_IPC_H
 
 /* Define to 1 if you have the <sys/mman.h> header file. */
 #undef HAVE_SYS_MMAN_H
 
@@ -487,12 +490,15 @@
 /* Define to 1 if you have the <sys/signal.h> header file. */
 #undef HAVE_SYS_SIGNAL_H
 
 /* Define to 1 if you have the <sys/socket.h> header file. */
 #undef HAVE_SYS_SOCKET_H
 
+/* Define to 1 if you have the <sys/sockio.h> header file. */
+#undef HAVE_SYS_SOCKIO_H
+
 /* Define to 1 if you have the <sys/stat.h> header file. */
 #undef HAVE_SYS_STAT_H
 
 /* Define to 1 if you have the <sys/sysctl.h> header file. */
 #undef HAVE_SYS_SYSCTL_H
 
@@ -541,12 +547,18 @@
 /* Define to 1 if you have the <unix.h> header file. */
 #undef HAVE_UNIX_H
 
 /* Define to 1 if you have the `unsetenv' function. */
 #undef HAVE_UNSETENV
 
+/* Define to 1 if you have the `utime' function. */
+#undef HAVE_UTIME
+
+/* Define to 1 if you have the `utimes' function. */
+#undef HAVE_UTIMES
+
 /* Define if C compiler supports VLA */
 #undef HAVE_VLA
 
 /* Define to 1 if you have the `waitpid' function. */
 #undef HAVE_WAITPID
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/win32/apr_arch_file_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/win32/apr_arch_file_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/win32/apr_arch_file_io.h	2003-01-25 01:15:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/win32/apr_arch_file_io.h	2003-07-08 06:44:11.000000000 +0800
@@ -130,16 +130,17 @@
 #define S_IFLNK        0120000  /* Symbolic Link */
 #define S_IFSOCK       0140000  /* Socket */
 #define S_IFWHT        0160000  /* Whiteout */
 #endif
 
 /* Internal Flags for apr_file_open */
-#define APR_OPENINFO     0x4000    /* Open without READ or WRITE access */
-#define APR_OPENLINK     0x2000    /* Open a link itself, if supported */
-#define APR_READCONTROL  0x1000    /* Read the file's owner/perms */
-#define APR_WRITECONTROL 0x0800    /* Modifythe file's owner/perms */
+#define APR_OPENINFO     0x00100000 /* Open without READ or WRITE access */
+#define APR_OPENLINK     0x00200000 /* Open a link itself, if supported */
+#define APR_READCONTROL  0x00400000 /* Read the file's owner/perms */
+#define APR_WRITECONTROL 0x00800000 /* Modifythe file's owner/perms */
+#define APR_WRITEATTRS   0x01000000 /* Modify the file's attributes */
 
 /* Entries missing from the MSVC 5.0 Win32 SDK:
  */
 #ifndef FILE_ATTRIBUTE_DEVICE
 #define FILE_ATTRIBUTE_DEVICE        0x00000040
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/win32/apr_arch_networkio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/win32/apr_arch_networkio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/include/arch/win32/apr_arch_networkio.h	2003-01-07 07:44:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/include/arch/win32/apr_arch_networkio.h	2003-07-08 20:53:10.000000000 +0800
@@ -55,12 +55,19 @@
 #ifndef NETWORK_IO_H
 #define NETWORK_IO_H
 
 #include "apr_network_io.h"
 #include "apr_general.h"
 
+typedef struct sock_userdata_t sock_userdata_t;
+struct sock_userdata_t {
+    sock_userdata_t *next;
+    const char *key;
+    void *data;
+};
+
 struct apr_socket_t {
     apr_pool_t         *cntxt;
     SOCKET              socketdes;
     int                 type; /* SOCK_STREAM, SOCK_DGRAM */
     int                 protocol;
     apr_sockaddr_t     *local_addr;
@@ -70,12 +77,13 @@
     apr_int32_t         disconnected;
     int                 local_port_unknown;
     int                 local_interface_unknown;
     int                 remote_addr_unknown;
     apr_int32_t         netmask;
     apr_int32_t         inherit;
+    sock_userdata_t    *userdata;
 };
 
 #ifdef _WIN32_WCE
 #ifndef WSABUF
 typedef struct _WSABUF {
     u_long      len;     /* the length of the buffer */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/libapr.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/libapr.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/libapr.dsp	2003-03-11 02:25:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/libapr.dsp	2003-08-23 18:01:22.000000000 +0800
@@ -158,12 +158,16 @@
 SOURCE=.\file_io\win32\readwrite.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\file_io\win32\seek.c
 # End Source File
+# Begin Source File
+
+SOURCE=.\file_io\unix\tempdir.c
+# End Source File
 # End Group
 # Begin Group "locks"
 
 # PROP Default_Filter ""
 # Begin Source File
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/locks/unix/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/locks/unix/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/locks/unix/proc_mutex.c	2003-06-08 03:45:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/locks/unix/proc_mutex.c	2003-08-07 07:54:31.000000000 +0800
@@ -59,12 +59,16 @@
 
 APR_DECLARE(apr_status_t) apr_proc_mutex_destroy(apr_proc_mutex_t *mutex)
 {
     return apr_pool_cleanup_run(mutex->pool, mutex, apr_proc_mutex_cleanup);
 }
 
+static apr_status_t proc_mutex_no_tryacquire(apr_proc_mutex_t *new_mutex)
+{
+    return APR_ENOTIMPL;
+}
 
 #if APR_HAS_POSIXSEM_SERIALIZE
 
 #ifndef SEM_FAILED
 #define SEM_FAILED (-1)
 #endif
@@ -162,16 +166,16 @@
 }
 
 static apr_status_t proc_mutex_posix_release(apr_proc_mutex_t *mutex)
 {
     int rc;
 
+    mutex->curr_locked = 0;
     if ((rc = sem_post((sem_t *)mutex->interproc->filedes)) < 0) {
         return errno;
     }
-    mutex->curr_locked = 0;
     return APR_SUCCESS;
 }
 
 static apr_status_t proc_mutex_posix_child_init(apr_proc_mutex_t **mutex,
                                                 apr_pool_t *cont,
                                                 const char *fname)
@@ -185,13 +189,13 @@
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_posix_create,
     proc_mutex_posix_acquire,
-    NULL, /* no tryacquire */
+    proc_mutex_no_tryacquire,
     proc_mutex_posix_release,
     proc_mutex_posix_cleanup,
     proc_mutex_posix_child_init,
     "posixsem"
 };
 
@@ -266,19 +270,19 @@
 }
 
 static apr_status_t proc_mutex_sysv_release(apr_proc_mutex_t *mutex)
 {
     int rc;
 
+    mutex->curr_locked = 0;
     do {
         rc = semop(mutex->interproc->filedes, &proc_mutex_op_off, 1);
     } while (rc < 0 && errno == EINTR);
     if (rc < 0) {
         return errno;
     }
-    mutex->curr_locked = 0;
     return APR_SUCCESS;
 }
 
 static apr_status_t proc_mutex_sysv_child_init(apr_proc_mutex_t **mutex, apr_pool_t *cont, const char *fname)
 {
     return APR_SUCCESS;
@@ -290,13 +294,13 @@
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_sysv_create,
     proc_mutex_sysv_acquire,
-    NULL, /* no tryacquire */
+    proc_mutex_no_tryacquire,
     proc_mutex_sysv_release,
     proc_mutex_sysv_cleanup,
     proc_mutex_sysv_child_init,
     "sysvsem"
 };
 
@@ -431,19 +435,19 @@
 /* TODO: Add proc_mutex_proc_pthread_tryacquire(apr_proc_mutex_t *mutex) */
 
 static apr_status_t proc_mutex_proc_pthread_release(apr_proc_mutex_t *mutex)
 {
     apr_status_t rv;
 
+    mutex->curr_locked = 0;
     if ((rv = pthread_mutex_unlock(mutex->pthread_interproc))) {
 #ifdef PTHREAD_SETS_ERRNO
         rv = errno;
 #endif
         return rv;
     }
-    mutex->curr_locked = 0;
     return APR_SUCCESS;
 }
 
 static apr_status_t proc_mutex_proc_pthread_child_init(apr_proc_mutex_t **mutex,
                                             apr_pool_t *cont, 
                                             const char *fname)
@@ -453,13 +457,13 @@
 
 const apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_proc_pthread_methods =
 {
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
     proc_mutex_proc_pthread_create,
     proc_mutex_proc_pthread_acquire,
-    NULL, /* no tryacquire */
+    proc_mutex_no_tryacquire,
     proc_mutex_proc_pthread_release,
     proc_mutex_proc_pthread_cleanup,
     proc_mutex_proc_pthread_child_init,
     "pthread"
 };
 
@@ -550,19 +554,19 @@
 }
 
 static apr_status_t proc_mutex_fcntl_release(apr_proc_mutex_t *mutex)
 {
     int rc;
 
+    mutex->curr_locked=0;
     do {
         rc = fcntl(mutex->interproc->filedes, F_SETLKW, &proc_mutex_unlock_it);
     } while (rc < 0 && errno == EINTR);
     if (rc < 0) {
         return errno;
     }
-    mutex->curr_locked=0;
     return APR_SUCCESS;
 }
 
 static apr_status_t proc_mutex_fcntl_child_init(apr_proc_mutex_t **mutex,
                                                 apr_pool_t *pool, 
                                                 const char *fname)
@@ -576,13 +580,13 @@
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_fcntl_create,
     proc_mutex_fcntl_acquire,
-    NULL, /* no tryacquire */
+    proc_mutex_no_tryacquire,
     proc_mutex_fcntl_release,
     proc_mutex_fcntl_cleanup,
     proc_mutex_fcntl_child_init,
     "fcntl"
 };
 
@@ -658,19 +662,19 @@
 }
 
 static apr_status_t proc_mutex_flock_release(apr_proc_mutex_t *mutex)
 {
     int rc;
 
+    mutex->curr_locked = 0;
     do {
         rc = flock(mutex->interproc->filedes, LOCK_UN);
     } while (rc < 0 && errno == EINTR);
     if (rc < 0) {
         return errno;
     }
-    mutex->curr_locked = 0;
     return APR_SUCCESS;
 }
 
 static apr_status_t proc_mutex_flock_child_init(apr_proc_mutex_t **mutex,
                                                 apr_pool_t *pool, 
                                                 const char *fname)
@@ -702,13 +706,13 @@
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_flock_create,
     proc_mutex_flock_acquire,
-    NULL, /* no tryacquire */
+    proc_mutex_no_tryacquire,
     proc_mutex_flock_release,
     proc_mutex_flock_cleanup,
     proc_mutex_flock_child_init,
     "flock"
 };
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/locks/unix/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/locks/unix/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/locks/unix/thread_mutex.c	2003-06-08 21:42:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/locks/unix/thread_mutex.c	2003-08-09 03:20:23.000000000 +0800
@@ -105,27 +105,41 @@
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_lock(apr_thread_mutex_t *mutex)
 {
     apr_status_t rv;
 
     if (mutex->nested) {
+        /*
+         * Although threadsafe, this test is NOT reentrant.  
+         * The thread's main and reentrant attempts will both mismatch 
+         * testing the mutex is owned by this thread, so a deadlock is expected.
+         */
         if (apr_os_thread_equal(mutex->owner, apr_os_thread_current())) {
-            mutex->owner_ref++;
+            apr_atomic_inc(&mutex->owner_ref);
             return APR_SUCCESS;
         }
 
         rv = pthread_mutex_lock(&mutex->mutex);
         if (rv) {
 #ifdef PTHREAD_SETS_ERRNO
             rv = errno;
 #endif
             return rv;
         }
 
+        if (apr_atomic_cas(&mutex->owner_ref, 1, 0) != 0) {
+            /* The owner_ref should be zero when the lock is not held,
+             * if owner_ref was non-zero we have a mutex reference bug.
+             * XXX: so now what?
+             */
+            mutex->owner_ref = 1;
+        }
+        /* Note; do not claim ownership until the owner_ref has been
+         * incremented; limits a subtle race in reentrant code.
+         */
         mutex->owner = apr_os_thread_current();
-        mutex->owner_ref = 1;
         return rv;
     }
     else {
         rv = pthread_mutex_lock(&mutex->mutex);
 #ifdef PTHREAD_SETS_ERRNO
         if (rv) {
@@ -138,27 +152,42 @@
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_trylock(apr_thread_mutex_t *mutex)
 {
     apr_status_t rv;
 
     if (mutex->nested) {
+        /*
+         * Although threadsafe, this test is NOT reentrant.  
+         * The thread's main and reentrant attempts will both mismatch 
+         * testing the mutex is owned by this thread, so one will fail 
+         * the trylock.
+         */
         if (apr_os_thread_equal(mutex->owner, apr_os_thread_current())) {
-            mutex->owner_ref++;
+            apr_atomic_inc(&mutex->owner_ref);
             return APR_SUCCESS;
         }
 
         rv = pthread_mutex_trylock(&mutex->mutex);
         if (rv) {
 #ifdef PTHREAD_SETS_ERRNO
             rv = errno;
 #endif
             return (rv == EBUSY) ? APR_EBUSY : rv;
         }
 
+        if (apr_atomic_cas(&mutex->owner_ref, 1, 0) != 0) {
+            /* The owner_ref should be zero when the lock is not held,
+             * if owner_ref was non-zero we have a mutex reference bug.
+             * XXX: so now what?
+             */
+            mutex->owner_ref = 1;
+        }
+        /* Note; do not claim ownership until the owner_ref has been
+         * incremented; limits a subtle race in reentrant code.
+         */
         mutex->owner = apr_os_thread_current();
-        mutex->owner_ref = 1;
     }
     else {
         rv = pthread_mutex_trylock(&mutex->mutex);
         if (rv) {
 #ifdef PTHREAD_SETS_ERRNO
             rv = errno;
@@ -172,38 +201,43 @@
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_unlock(apr_thread_mutex_t *mutex)
 {
     apr_status_t status;
 
     if (mutex->nested) {
+        /*
+         * The code below is threadsafe and reentrant.
+         */
         if (apr_os_thread_equal(mutex->owner, apr_os_thread_current())) {
-            mutex->owner_ref--;
-            if (mutex->owner_ref > 0)
+            /*
+             * This should never occur, and indicates an application error
+             */
+            if (mutex->owner_ref == 0) {
+                return APR_EINVAL;
+            }
+
+            if (apr_atomic_dec(&mutex->owner_ref) != 0)
                 return APR_SUCCESS;
+            mutex->owner = 0;
         }
-        status = pthread_mutex_unlock(&mutex->mutex);
-        if (status) {
-#ifdef PTHREAD_SETS_ERRNO
-            status = errno;
-#endif
-            return status;
+        /*
+         * This should never occur, and indicates an application error
+         */
+        else {
+            return APR_EINVAL;
         }
-
-        memset(&mutex->owner, 0, sizeof mutex->owner);
-        mutex->owner_ref = 0;
-        return status;
     }
-    else {
-        status = pthread_mutex_unlock(&mutex->mutex);
+
+    status = pthread_mutex_unlock(&mutex->mutex);
 #ifdef PTHREAD_SETS_ERRNO
-        if (status) {
-            status = errno;
-        }
-#endif
-        return status;
+    if (status) {
+        status = errno;
     }
+#endif
+
+    return status;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_destroy(apr_thread_mutex_t *mutex)
 {
     return apr_pool_cleanup_run(mutex->pool, mutex, thread_mutex_cleanup);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/memory/unix/apr_pools.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/memory/unix/apr_pools.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/memory/unix/apr_pools.c	2003-05-28 12:39:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/memory/unix/apr_pools.c	2003-09-29 01:14:21.000000000 +0800
@@ -52,12 +52,13 @@
  * <http://www.apache.org/>.
  */
 
 #include "apr.h"
 #include "apr_private.h"
 
+#include "apr_atomic.h"
 #include "apr_portable.h" /* for get_os_proc */
 #include "apr_strings.h"
 #include "apr_general.h"
 #include "apr_pools.h"
 #include "apr_allocator.h"
 #include "apr_lib.h"
@@ -552,12 +553,19 @@
         apr_pools_initialized = 0;
         return rv;
     }
 
     apr_pool_tag(global_pool, "apr_global_pool");
 
+    /* This has to happen here because mutexes might be backed by
+     * atomics.  It used to be snug and safe in apr_initialize().
+     */
+    if ((rv = apr_atomic_init(global_pool)) != APR_SUCCESS) {
+        return rv;
+    }
+
 #if APR_HAS_THREADS
     {
         apr_thread_mutex_t *mutex;
 
         if ((rv = apr_thread_mutex_create(&mutex,
                                           APR_THREAD_MUTEX_DEFAULT,
@@ -853,13 +861,13 @@
 #endif /* defined(NETWARE) */
 
     if ((pool->parent = parent) != NULL) {
 #if APR_HAS_THREADS
         apr_thread_mutex_t *mutex;
 
-        if ((mutex = apr_allocator_mutex_get(allocator)) != NULL)
+        if ((mutex = apr_allocator_mutex_get(parent->allocator)) != NULL)
             apr_thread_mutex_lock(mutex);
 #endif /* APR_HAS_THREADS */
 
         if ((pool->sibling = parent->child) != NULL)
             pool->sibling->ref = &pool->sibling;
 
@@ -1263,12 +1271,19 @@
     }
 
     apr_pool_tag(global_pool, "APR global pool");
 
     apr_pools_initialized = 1;
 
+    /* This has to happen here because mutexes might be backed by
+     * atomics.  It used to be snug and safe in apr_initialize().
+     */
+    if ((rv = apr_atomic_init(global_pool)) != APR_SUCCESS) {
+        return rv;
+    }
+
 #if (APR_POOL_DEBUG & APR_POOL_DEBUG_VERBOSE_ALL)
     apr_file_open_stderr(&file_stderr, global_pool);
     if (file_stderr) {
         apr_file_printf(file_stderr,
             "POOL DEBUG: [PID"
 #if APR_HAS_THREADS
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/netware/aprlib.def /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/netware/aprlib.def
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/netware/aprlib.def	2002-06-27 06:01:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/netware/aprlib.def	2003-10-02 22:49:33.000000000 +0800
@@ -1,4 +1,3 @@
 MODULE  LIBC.NLM
 MODULE  WS2_32.NLM
-IMPORT  CpuCurrentProcessor
 EXPORT	@aprlib.imp
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/unix/errorcodes.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/unix/errorcodes.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/unix/errorcodes.c	2003-02-25 04:32:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/unix/errorcodes.c	2003-07-06 18:34:55.000000000 +0800
@@ -371,12 +371,21 @@
     else {
         return buf;
     }
 }
 #elif defined(HAVE_STRERROR_R)
 /* glibc style */
+
+/* BeOS has the function available, but it doesn't provide
+ * the prototype publically (doh!), so to avoid a build warning
+ * we add a suitable prototype here.
+ */
+#if defined(BEOS)
+const char *strerror_r(apr_status_t, char *, apr_size_t);
+#endif
+
 static char *native_strerror(apr_status_t statcode, char *buf,
                              apr_size_t bufsize)
 {
     const char *msg;
 
     buf[0] = '\0';
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/unix/start.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/unix/start.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/misc/unix/start.c	2003-01-07 07:44:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/misc/unix/start.c	2003-09-28 07:58:23.000000000 +0800
@@ -96,15 +96,18 @@
     if (apr_pool_create(&pool, NULL) != APR_SUCCESS) {
         return APR_ENOPOOL;
     }
 
     apr_pool_tag(pool, "apr_initialize");
 
-    if ((status = apr_atomic_init(pool)) != APR_SUCCESS) {
-        return status;
-    }
+    /* apr_atomic_init() used to be called from here aswell.
+     * Pools rely on mutexes though, which can be backed by
+     * atomics.  Due to this circular dependency
+     * apr_pool_initialize() is taking care of calling
+     * apr_atomic_init() at the correct time.
+     */
 
     apr_signal_init(pool);
 
     return APR_SUCCESS;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/mmap/unix/mmap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/mmap/unix/mmap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/mmap/unix/mmap.c	2003-03-11 03:02:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/mmap/unix/mmap.c	2003-07-14 08:38:17.000000000 +0800
@@ -140,12 +140,13 @@
     pages = (size + B_PAGE_SIZE -1) / B_PAGE_SIZE;
     aid = create_area("apr_mmap", &mm , B_ANY_ADDRESS, pages * B_PAGE_SIZE,
         B_NO_LOCK, B_WRITE_AREA|B_READ_AREA);
 
     if (aid < B_NO_ERROR) {
         /* we failed to get an area we can use... */
+        *new = NULL;
         return APR_ENOMEM;
     }
 
     if (aid >= B_NO_ERROR)
         read(file->filedes, mm, size);
     
@@ -160,12 +161,13 @@
     }
 
     mm = mmap(NULL, size, native_flags, MAP_SHARED, file->filedes, offset);
 
     if (mm == (void *)-1) {
         /* we failed to get an mmap'd file... */
+        *new = NULL;
         return errno;
     }
 #endif
 
     (*new)->mm = mm;
     (*new)->size = size;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/os2/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/os2/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/os2/sockets.c	2003-01-07 07:44:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/os2/sockets.c	2003-07-08 20:53:10.000000000 +0800
@@ -55,12 +55,13 @@
 #include "apr_arch_networkio.h"
 #include "apr_arch_inherit.h"
 #include "apr_network_io.h"
 #include "apr_general.h"
 #include "apr_portable.h"
 #include "apr_lib.h"
+#include "apr_strings.h"
 #include <errno.h>
 #include <string.h>
 #include <sys/socket.h>
 #include <netinet/tcp.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
@@ -238,23 +239,46 @@
         return APR_SUCCESS;
     }
 }
 
 
 APR_DECLARE(apr_status_t) apr_socket_data_get(void **data, const char *key,
-                                     apr_socket_t *socket)
+                                     apr_socket_t *sock)
 {
-    return apr_pool_userdata_get(data, key, socket->cntxt);
+    sock_userdata_t *cur = sock->userdata;
+
+    *data = NULL;
+
+    while (cur) {
+        if (!strcmp(cur->key, key)) {
+            *data = cur->data;
+            break;
+        }
+        cur = cur->next;
+    }
+
+    return APR_SUCCESS;
 }
 
 
 
-APR_DECLARE(apr_status_t) apr_socket_data_set(apr_socket_t *socket, void *data, const char *key,
+APR_DECLARE(apr_status_t) apr_socket_data_set(apr_socket_t *sock, void *data, const char *key,
                                      apr_status_t (*cleanup) (void *))
 {
-    return apr_pool_userdata_set(data, key, cleanup, socket->cntxt);
+    sock_userdata_t *new = apr_palloc(sock->cntxt, sizeof(sock_userdata_t));
+
+    new->key = apr_pstrdup(sock->cntxt, key);
+    new->data = data;
+    new->next = sock->userdata;
+    sock->userdata = new;
+
+    if (cleanup) {
+        apr_pool_cleanup_register(sock->cntxt, data, cleanup, cleanup);
+    }
+
+    return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_os_sock_get(apr_os_sock_t *thesock, apr_socket_t *sock)
 {
     *thesock = sock->socketdes;
     return APR_SUCCESS;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/os2/sockopt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/os2/sockopt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/os2/sockopt.c	2003-02-25 07:13:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/os2/sockopt.c	2003-10-17 06:13:02.000000000 +0800
@@ -167,12 +167,26 @@
                                            apr_int32_t opt, apr_int32_t *on)
 {
     return apr_socket_opt_get(sock, opt, on);
 }
                                            
 
+APR_DECLARE(apr_status_t) apr_socket_atmark(apr_socket_t *sock, int *atmark)
+{
+    int oobmark;
+
+    if (ioctl(sock->socketdes, SIOCATMARK, (void*)&oobmark, sizeof(oobmark)) < 0) {
+        return APR_OS2_STATUS(sock_errno());
+    }
+
+    *atmark = (oobmark != 0);
+
+    return APR_SUCCESS;
+}
+
+
 APR_DECLARE(apr_status_t) apr_gethostname(char *buf, apr_int32_t len, 
                                           apr_pool_t *cont)
 {
     if (gethostname(buf, len) == -1) {
         buf[0] = '\0';
         return APR_OS2_STATUS(sock_errno());
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sendrecv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sendrecv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sendrecv.c	2003-05-30 20:50:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sendrecv.c	2003-08-01 19:06:52.000000000 +0800
@@ -738,12 +738,20 @@
         hdtr = &no_hdtr;
     }
 
     /* Ignore flags for now. */
     flags = 0;
 
+    /* word to the wise: by default, AIX stores files sent by send_file()
+     * in the network buffer cache...  there are supposedly scenarios
+     * where the most recent copy of the file won't be sent, but I can't
+     * recreate the potential problem, perhaps because of the way we
+     * use send_file()...  if you suspect such a problem, try turning
+     * on the SF_SYNC_CACHE flag
+     */
+
     /* AIX can also send the headers/footers as part of the system call */
     parms.header_length = 0;
     if (hdtr && hdtr->numheaders) {
         if (hdtr->numheaders == 1) {
             parms.header_data = hdtr->headers[0].iov_base;
             parms.header_length = hdtr->headers[0].iov_len;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockaddr.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockaddr.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockaddr.c	2003-02-16 18:10:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockaddr.c	2003-09-30 03:08:15.000000000 +0800
@@ -366,17 +366,39 @@
                                   apr_port_t port, apr_int32_t flags, 
                                   apr_pool_t *p)
 {
     struct addrinfo hints, *ai, *ai_list;
     apr_sockaddr_t *prev_sa;
     int error;
+    char *servname = NULL; 
 
     memset(&hints, 0, sizeof(hints));
     hints.ai_family = family;
     hints.ai_socktype = SOCK_STREAM;
-    error = getaddrinfo(hostname, NULL, &hints, &ai_list);
+    if(hostname == NULL) {
+#ifdef AI_PASSIVE 
+        /* If hostname is NULL, assume we are trying to bind to all
+         * interfaces. */
+        hints.ai_flags |= AI_PASSIVE;
+#endif
+        /* getaddrinfo according to RFC 2553 must have either hostname
+         * or servname non-NULL.
+         */
+#ifdef _AIX
+        /* But current AIX getaddrinfo() doesn't like servname = "0";
+         * the "1" won't hurt since we use the port parameter to fill
+         * in the returned socket addresses later
+         */
+        if (!port) {
+            servname = "1";
+        }
+        else
+#endif
+        servname = apr_itoa(p, port);
+    }
+    error = getaddrinfo(hostname, servname, &hints, &ai_list);
     if (error) {
 #ifndef WIN32
         if (error == EAI_SYSTEM) {
             return errno;
         }
         else 
@@ -401,16 +423,19 @@
 
         new_sa->pool = p;
         memcpy(&new_sa->sa, ai->ai_addr, ai->ai_addrlen);
         apr_sockaddr_vars_set(new_sa, ai->ai_family, port);
 
         if (!prev_sa) { /* first element in new list */
-            new_sa->hostname = apr_pstrdup(p, hostname);
+            if (hostname) {
+                new_sa->hostname = apr_pstrdup(p, hostname);
+            }
             *sa = new_sa;
         }
         else {
+            new_sa->hostname = prev_sa->hostname;
             prev_sa->next = new_sa;
         }
 
         prev_sa = new_sa;
         ai = ai->ai_next;
     }
@@ -471,12 +496,18 @@
 #endif
     int hosterror;
 #endif
     struct hostent hs;
     struct in_addr ipaddr;
     char *addr_list[2];
+    const char *orig_hostname = hostname;
+
+    if (hostname == NULL) {
+        /* if we are given a NULL hostname, assume '0.0.0.0' */
+        hostname = "0.0.0.0";
+    }
 
     if (*hostname >= '0' && *hostname <= '9' &&
         strspn(hostname, "0123456789.") == strlen(hostname)) {
 
         ipaddr.s_addr = inet_addr(hostname);
         addr_list[0] = (char *)&ipaddr;
@@ -525,16 +556,19 @@
 
         new_sa->pool = p;
         new_sa->sa.sin.sin_addr = *(struct in_addr *)hp->h_addr_list[curaddr];
         apr_sockaddr_vars_set(new_sa, AF_INET, port);
 
         if (!prev_sa) { /* first element in new list */
-            new_sa->hostname = apr_pstrdup(p, hostname);
+            if (orig_hostname) {
+                new_sa->hostname = apr_pstrdup(p, orig_hostname);
+            }
             *sa = new_sa;
         }
         else {
+            new_sa->hostname = prev_sa->hostname;
             prev_sa->next = new_sa;
         }
 
         prev_sa = new_sa;
         ++curaddr;
     }
@@ -561,28 +595,24 @@
 #if !APR_HAVE_IPV6
         if (flags & APR_IPV6_ADDR_OK) {
             return APR_ENOTIMPL;
         }
 #endif
     }
-    
-    if (hostname) {
 #if !APR_HAVE_IPV6
-        if (family == APR_UNSPEC) {
-            family = APR_INET;
-        }
-#endif
-        return find_addresses(sa, hostname, family, port, flags, p);
+    /* What may happen is that APR is not IPv6-enabled, but we're still
+     * going to call getaddrinfo(), so we have to tell the OS we only
+     * want IPv4 addresses back since we won't know what to do with
+     * IPv6 addresses.
+     */
+    if (family == APR_UNSPEC) {
+        family = APR_INET;
     }
+#endif
 
-    *sa = apr_pcalloc(p, sizeof(apr_sockaddr_t));
-    (*sa)->pool = p;
-    apr_sockaddr_vars_set(*sa, 
-                          family == APR_UNSPEC ? APR_INET : family,
-                          port);
-    return APR_SUCCESS;
+    return find_addresses(sa, hostname, family, port, flags, p);
 }
 
 APR_DECLARE(apr_status_t) apr_getnameinfo(char **hostname,
                                           apr_sockaddr_t *sockaddr,
                                           apr_int32_t flags)
 {
@@ -594,16 +624,35 @@
     char tmphostname[256];
 #endif
 
     /* don't know if it is portable for getnameinfo() to set h_errno;
      * clear it then see if it was set */
     SET_H_ERRNO(0);
+
     /* default flags are NI_NAMREQD; otherwise, getnameinfo() will return
      * a numeric address string if it fails to resolve the host name;
      * that is *not* what we want here
+     *
+     * Additionally, if we know getnameinfo() doesn't handle IPv4-mapped
+     * IPv6 addresses correctly, drop down to IPv4 before calling
+     * getnameinfo().
      */
+#ifdef GETNAMEINFO_IPV4_MAPPED_FAILS
+    if (sockaddr->family == AF_INET6 &&
+        IN6_IS_ADDR_V4MAPPED(&sockaddr->sa.sin6.sin6_addr)) {
+        struct apr_sockaddr_t tmpsa;
+        tmpsa.sa.sin.sin_family = AF_INET;
+        tmpsa.sa.sin.sin_addr.s_addr = ((uint32_t *)sockaddr->ipaddr_ptr)[3];
+
+        rc = getnameinfo((const struct sockaddr *)&tmpsa.sa,
+                         sizeof(struct sockaddr_in),
+                         tmphostname, sizeof(tmphostname), NULL, 0,
+                         flags != 0 ? flags : NI_NAMEREQD);
+    }
+    else
+#endif
     rc = getnameinfo((const struct sockaddr *)&sockaddr->sa, sockaddr->salen,
                      tmphostname, sizeof(tmphostname), NULL, 0,
                      flags != 0 ? flags : NI_NAMEREQD);
     if (rc != 0) {
         *hostname = NULL;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockets.c	2003-05-30 20:50:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockets.c	2003-07-08 20:53:11.000000000 +0800
@@ -51,12 +51,13 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
 
 #include "apr_arch_networkio.h"
 #include "apr_network_io.h"
+#include "apr_strings.h"
 #include "apr_support.h"
 #include "apr_portable.h"
 #include "apr_arch_inherit.h"
 
 #if defined(BEOS) && !defined(BEOS_BONE)
 #define close closesocket
@@ -315,19 +316,42 @@
 #endif
     return APR_SUCCESS;
 }
 
 apr_status_t apr_socket_data_get(void **data, const char *key, apr_socket_t *sock)
 {
-    return apr_pool_userdata_get(data, key, sock->cntxt);
+    sock_userdata_t *cur = sock->userdata;
+
+    *data = NULL;
+
+    while (cur) {
+        if (!strcmp(cur->key, key)) {
+            *data = cur->data;
+            break;
+        }
+        cur = cur->next;
+    }
+
+    return APR_SUCCESS;
 }
 
 apr_status_t apr_socket_data_set(apr_socket_t *sock, void *data, const char *key,
-                              apr_status_t (*cleanup) (void *))
+                                 apr_status_t (*cleanup) (void *))
 {
-    return apr_pool_userdata_set(data, key, cleanup, sock->cntxt);
+    sock_userdata_t *new = apr_palloc(sock->cntxt, sizeof(sock_userdata_t));
+
+    new->key = apr_pstrdup(sock->cntxt, key);
+    new->data = data;
+    new->next = sock->userdata;
+    sock->userdata = new;
+
+    if (cleanup) {
+        apr_pool_cleanup_register(sock->cntxt, data, cleanup, cleanup);
+    }
+
+    return APR_SUCCESS;
 }
 
 apr_status_t apr_os_sock_get(apr_os_sock_t *thesock, apr_socket_t *sock)
 {
     *thesock = sock->socketdes;
     return APR_SUCCESS;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockopt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockopt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/unix/sockopt.c	2003-05-30 20:50:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/unix/sockopt.c	2003-10-17 06:13:02.000000000 +0800
@@ -366,12 +367,33 @@
             *on = apr_is_option_set(sock->netmask, opt);
     }
     return APR_SUCCESS;
 }
 
 
+apr_status_t apr_socket_atmark(apr_socket_t *sock, int *atmark)
+{
+/* In 1.0 we rely on compile failure to assure all platforms grabbed
+ * the correct header file support for SIOCATMARK, but we don't want 
+ * to fail the build of 0.9.  Keep things good for the released branch.
+ */
+#ifdef SIOCATMARK
+    int oobmark;
+
+    if (ioctl(sock->socketdes, SIOCATMARK, (void*) &oobmark) < 0)
+        return apr_get_netos_error();
+
+    *atmark = (oobmark != 0);
+
+    return APR_SUCCESS;
+#else
+    return APR_ENOTIMPL;
+#endif
+}
+
+
 /* deprecated */
 apr_status_t apr_setsocketopt(apr_socket_t *sock,
                               apr_int32_t opt, apr_int32_t on)
 {
     return apr_socket_opt_set(sock, opt, on);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/win32/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/win32/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/win32/sockets.c	2003-01-07 07:44:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/win32/sockets.c	2003-07-08 20:53:12.000000000 +0800
@@ -54,12 +54,13 @@
 
 #include "apr_arch_networkio.h"
 #include "apr_network_io.h"
 #include "apr_general.h"
 #include "apr_lib.h"
 #include "apr_portable.h"
+#include "apr_strings.h"
 #include <string.h>
 #include "apr_arch_inherit.h"
 #include "apr_arch_misc.h"
 
 static char generic_inaddr_any[16] = {0}; /* big enough for IPv4 or IPv6 */
 
@@ -400,22 +401,45 @@
         sock->local_interface_unknown = 1;
     }
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_socket_data_get(void **data, const char *key,
-                                             apr_socket_t *socket)
+                                             apr_socket_t *sock)
 {
-    return apr_pool_userdata_get(data, key, socket->cntxt);
+    sock_userdata_t *cur = sock->userdata;
+
+    *data = NULL;
+
+    while (cur) {
+        if (!strcmp(cur->key, key)) {
+            *data = cur->data;
+            break;
+        }
+        cur = cur->next;
+    }
+
+    return APR_SUCCESS;
 }
 
-APR_DECLARE(apr_status_t) apr_socket_data_set(apr_socket_t *socket, void *data,
+APR_DECLARE(apr_status_t) apr_socket_data_set(apr_socket_t *sock, void *data,
                                              const char *key,
                                              apr_status_t (*cleanup)(void *))
 {
-    return apr_pool_userdata_set(data, key, cleanup, socket->cntxt);
+    sock_userdata_t *new = apr_palloc(sock->cntxt, sizeof(sock_userdata_t));
+
+    new->key = apr_pstrdup(sock->cntxt, key);
+    new->data = data;
+    new->next = sock->userdata;
+    sock->userdata = new;
+
+    if (cleanup) {
+        apr_pool_cleanup_register(sock->cntxt, data, cleanup, cleanup);
+    }
+
+    return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_os_sock_get(apr_os_sock_t *thesock,
                                           apr_socket_t *sock)
 {
     *thesock = sock->socketdes;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/win32/sockopt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/win32/sockopt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/network_io/win32/sockopt.c	2003-02-25 07:13:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/network_io/win32/sockopt.c	2003-10-17 06:13:03.000000000 +0800
@@ -273,12 +273,25 @@
                                            apr_int32_t opt, apr_int32_t *on)
 {
     return apr_socket_opt_get(sock, opt, on);
 }
                                            
 
+APR_DECLARE(apr_status_t) apr_socket_atmark(apr_socket_t *sock, int *atmark)
+{
+    u_long oobmark;
+
+    if (ioctlsocket(sock->socketdes, SIOCATMARK, (void*) &oobmark) < 0)
+        return apr_get_netos_error();
+
+    *atmark = (oobmark != 0);
+
+    return APR_SUCCESS;
+}
+
+
 APR_DECLARE(apr_status_t) apr_gethostname(char *buf, int len,
                                           apr_pool_t *cont)
 {
     if (gethostname(buf, len) == -1) {
         buf[0] = '\0';
         return apr_get_netos_error();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/NWGNUmakefile	2003-03-04 08:03:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/NWGNUmakefile	2003-10-02 22:49:33.000000000 +0800
@@ -218,13 +218,12 @@
 # Any additional imports go here
 #
 FILES_nlm_Ximports = \
 	@libc.imp \
 	@ws2nlm.imp \
 	@netware.imp \
-	CpuCurrentProcessor \
 	$(EOLIST)
  
 #   
 # Any symbols exported to here
 #
 FILES_nlm_exports = \
@@ -283,12 +282,13 @@
 	$(OBJDIR)/shm.o \
 	$(OBJDIR)/signals.o \
 	$(OBJDIR)/sockaddr.o \
 	$(OBJDIR)/sockets.o \
 	$(OBJDIR)/sockopt.o \
 	$(OBJDIR)/start.o \
+	$(OBJDIR)/tempdir.o \
 	$(OBJDIR)/thread.o \
 	$(OBJDIR)/thread_cond.o \
 	$(OBJDIR)/thread_mutex.o \
 	$(OBJDIR)/thread_rwlock.o \
 	$(OBJDIR)/threadpriv.o \
 	$(OBJDIR)/time.o \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/Makefile.in	2003-07-02 20:12:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/Makefile.in	2003-08-12 02:19:38.000000000 +0800
@@ -39,14 +39,12 @@
 CLEAN_TARGETS = testfile.tmp mod_test.slo proc_child@EXEEXT@ occhild@EXEEXT@ \
 readchild@EXEEXT@
 
 INCDIR=../include
 INCLUDES=-I$(INCDIR)
 
-CFLAGS=$(MY_CFLAGS)
-
 check: $(STDTEST_PORTABLE) $(STDTEST_NONPORTABLE)
 	for prog in $(STDTEST_PORTABLE) $(STDTEST_NONPORTABLE); do \
 		./$$prog; \
 		if test $$? = 255; then \
 			echo "$$prog failed"; \
 			break; \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/Makefile.win /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/Makefile.win
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/Makefile.win	2003-02-17 11:47:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/Makefile.win	2003-07-04 09:54:07.000000000 +0800
@@ -1,12 +1,11 @@
 
 LINK=link /nologo
 
 NONPORTABLE = \
 	testshm.exe \
-	testprocmutex.exe \
 	testglobalmutex.exe
 
 PROGRAMS = \
 	client.exe \
 	sendfile.exe \
 	server.exe \
@@ -97,13 +96,13 @@
 TESTS = testall.obj testtime.obj teststr.obj testvsn.obj testipsub.obj \
 	testmmap.obj testud.obj testtable.obj testsleep.obj testpools.obj \
 	testfmt.obj testfile.obj testdir.obj testfileinfo.obj testrand.obj \
 	testdso.obj testoc.obj testdup.obj testsockets.obj testproc.obj \
 	testpoll.obj testlock.obj testsockopt.obj testpipe.obj testthread.obj \
 	testhash.obj testargs.obj testnames.obj testuser.obj testpath.obj \
-	testenv.obj
+	testenv.obj testprocmutex.obj
 
 testall.exe: $(TESTS) CuTest.obj $(LOCAL_LIBS)
 	$(LINK) /debug /subsystem:console /machine:I386 $(TESTS) CuTest.obj \
 		$(LOCAL_LIBS) $(ALL_LIBS)
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/nwgnuaprtest /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/nwgnuaprtest
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/nwgnuaprtest	2003-02-19 03:48:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/nwgnuaprtest	2003-08-01 01:45:25.000000000 +0800
@@ -114,13 +114,13 @@
 #
 NLM_VERSION		= 1,0,0
 
 #
 # If this is specified, it will override the default of 64K
 #
-NLM_STACK_SIZE	= 
+NLM_STACK_SIZE	= 524288
 
 #
 # If this is specified it will be used by the link '-entry' directive
 #
 NLM_ENTRY_SYM	= _LibCPrelude
 
@@ -185,12 +185,13 @@
 	$(OBJDIR)/testnames.o \
 	$(OBJDIR)/testoc.o \
 	$(OBJDIR)/testpath.o \
 	$(OBJDIR)/testpoll.o \
 	$(OBJDIR)/testpools.o \
 	$(OBJDIR)/testproc.o \
+	$(OBJDIR)/testprocmutex.o \
 	$(OBJDIR)/testrand.o \
 	$(OBJDIR)/testsleep.o \
 	$(OBJDIR)/testsockets.o \
 	$(OBJDIR)/testsockopt.o \
 	$(OBJDIR)/teststr.o \
 	$(OBJDIR)/testthread.o \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/nwgnuproc_child /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/nwgnuproc_child
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/nwgnuproc_child	2002-12-21 04:08:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/nwgnuproc_child	2003-08-01 01:46:13.000000000 +0800
@@ -138,13 +138,13 @@
 #
 NLM_CHECK_SYM	=
 
 #
 # If this is specified it will be used by the link '-flags' directive
 #
-NLM_FLAGS		= AUTOUNLOAD, PSEUDOPREEMPTION
+NLM_FLAGS		= AUTOUNLOAD, PSEUDOPREEMPTION, MULTIPLE
  
 #
 # If this is specified it will be linked in with the XDCData option in the def 
 # file instead of the default of $(APR)/misc/netware/apache.xdc.  XDCData can 
 # be disabled by setting APACHE_UNIPROC in the environment
 #
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testfile.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testfile.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testfile.c	2003-05-29 03:25:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testfile.c	2003-07-11 03:57:58.000000000 +0800
@@ -503,12 +503,51 @@
     CuAssertIntEquals(tc, APR_SUCCESS, rv);
 
     rv = apr_file_remove(fname, p);
     CuAssertIntEquals(tc, APR_SUCCESS, rv);
 }
 
+static void test_truncate(CuTest *tc)
+{
+    apr_status_t rv;
+    apr_file_t *f;
+    const char *fname = "data/testtruncate.dat";
+    const char *s;
+    apr_size_t nbytes;
+    apr_finfo_t finfo;
+
+    apr_file_remove(fname, p);
+
+    rv = apr_file_open(&f, fname,
+                       APR_CREATE | APR_WRITE, APR_UREAD | APR_UWRITE, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    
+    s = "some data";
+    nbytes = strlen(s);
+    rv = apr_file_write(f, s, &nbytes);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    CuAssertIntEquals(tc, strlen(s), nbytes);
+
+    rv = apr_file_close(f);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+
+    rv = apr_file_open(&f, fname,
+                       APR_TRUNCATE | APR_WRITE, APR_UREAD | APR_UWRITE, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+
+    rv = apr_file_close(f);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+
+    rv = apr_stat(&finfo, fname, APR_FINFO_SIZE, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    CuAssertIntEquals(tc, 0, finfo.size);
+
+    rv = apr_file_remove(fname, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+}
+
 CuSuite *testfile(void)
 {
     CuSuite *suite = CuSuiteNew("File I/O");
 
     SUITE_ADD_TEST(suite, test_open_noreadwrite);
     SUITE_ADD_TEST(suite, test_open_excl);
@@ -527,10 +566,11 @@
     SUITE_ADD_TEST(suite, test_userdata_getnokey);
     SUITE_ADD_TEST(suite, test_getc);
     SUITE_ADD_TEST(suite, test_ungetc);
     SUITE_ADD_TEST(suite, test_gets);
     SUITE_ADD_TEST(suite, test_bigread);
     SUITE_ADD_TEST(suite, test_mod_neg);
+    SUITE_ADD_TEST(suite, test_truncate);
 
     return suite;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testfileinfo.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testfileinfo.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testfileinfo.c	2003-02-07 20:33:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testfileinfo.c	2003-07-08 06:44:11.000000000 +0800
@@ -236,18 +236,66 @@
     rv = apr_file_info_get(&finfo, APR_FINFO_SIZE, thefile);
     apr_assert_success(tc, "get file size", rv);
     CuAssertTrue(tc, bytes == (apr_size_t) finfo.size);
     apr_file_close(thefile);
 }
 
+static void test_mtime_set(CuTest *tc)
+{
+    apr_file_t *thefile;
+    apr_finfo_t finfo;
+    apr_time_t epoch = 0;
+    apr_status_t rv;
+
+    /* This test sort of depends on the system clock being at least
+     * marginally ccorrect; We'll be setting the modification time to
+     * the epoch.
+     */
+    rv = apr_file_open(&thefile, NEWFILENAME,
+                       APR_READ | APR_WRITE | APR_CREATE | APR_TRUNCATE
+                       | APR_BUFFERED | APR_DELONCLOSE,
+                       APR_OS_DEFAULT, p);
+    apr_assert_success(tc, "open file", rv);
+
+    /* Check that the current mtime is not the epoch */
+    rv = apr_stat(&finfo, NEWFILENAME, APR_FINFO_MTIME, p);
+    if (rv  == APR_INCOMPLETE) {
+        char *str;
+	int i;
+        str = apr_pstrdup(p, "APR_INCOMPLETE:  Missing ");
+        for (i = 0; vfi[i].bits; ++i) {
+            if (vfi[i].bits & ~finfo.valid) {
+                str = apr_pstrcat(p, str, vfi[i].description, " ", NULL);
+            }
+        }
+        CuFail(tc, str);
+    }
+    apr_assert_success(tc, "get initial mtime", rv);
+    CuAssertTrue(tc, finfo.mtime != epoch);
+
+    /* Reset the mtime to the epoch and verify the result.
+     * Note: we blindly assume that if the first apr_stat succeeded,
+     * the second one will, too.
+     */
+    rv = apr_file_mtime_set(NEWFILENAME, epoch, p);
+    apr_assert_success(tc, "set mtime", rv);
+
+    rv = apr_stat(&finfo, NEWFILENAME, APR_FINFO_MTIME, p);
+    apr_assert_success(tc, "get modified mtime", rv);
+    CuAssertTrue(tc, finfo.mtime == epoch);
+
+    apr_file_close(thefile);
+}
+
 CuSuite *testfileinfo(void)
 {
     CuSuite *suite = CuSuiteNew("File Info");
 
     SUITE_ADD_TEST(suite, test_info_get);
     SUITE_ADD_TEST(suite, test_stat);
     SUITE_ADD_TEST(suite, test_stat_eq_finfo);
     SUITE_ADD_TEST(suite, test_buffered_write_size);
+    SUITE_ADD_TEST(suite, test_mtime_set);
 
     return suite;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testnames.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testnames.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testnames.c	2003-01-09 04:40:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testnames.c	2003-09-18 03:07:30.000000000 +0800
@@ -111,12 +111,25 @@
     char *dstpath = NULL;
 
     rv = apr_filepath_merge(&dstpath, ABS_ROOT"foo/bar", "../baz", 0, p);
     CuAssertPtrNotNull(tc, dstpath);
     CuAssertIntEquals(tc, APR_SUCCESS, rv);
     CuAssertStrEquals(tc, ABS_ROOT"foo/baz", dstpath);
+
+    rv = apr_filepath_merge(&dstpath, "", "../test", 0, p);
+    CuAssertIntEquals(tc, 0, APR_SUCCESS);
+    CuAssertStrEquals(tc, "../test", dstpath);
+
+    /* Very dangerous assumptions here about what the cwd is.  However, let's assume
+     * that the testall is invoked from within apr/test/ so the following test should
+     * return ../test unless a previously fixed bug remains or the developer changes
+     * the case of the test directory:
+     */
+    rv = apr_filepath_merge(&dstpath, "", "../test", APR_FILEPATH_TRUENAME, p);
+    CuAssertIntEquals(tc, 0, APR_SUCCESS);
+    CuAssertStrEquals(tc, "../test", dstpath);
 }
 
 static void merge_secure(CuTest *tc)
 {
     apr_status_t rv;
     char *dstpath = NULL;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testprocmutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testprocmutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testprocmutex.c	2003-07-03 03:44:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testprocmutex.c	2003-07-03 17:14:16.000000000 +0800
@@ -64,70 +64,90 @@
 #include <stdlib.h>
 #include "test_apr.h"
 
 #if APR_HAS_FORK
 
 #define MAX_ITER 200
-#define MAX_COUNTER (MAX_ITER * 4)
+#define CHILDREN 6
+#define MAX_COUNTER (MAX_ITER * CHILDREN)
 
 static apr_proc_mutex_t *proc_lock;
 static volatile int *x;
 
 /* a slower more racy way to implement (*x)++ */
 static int increment(int n)
 {
     apr_sleep(1);
     return n+1;
 }
 
-static void make_child(apr_proc_t **proc, apr_pool_t *p)
+static void make_child(CuTest *tc, apr_proc_t **proc, apr_pool_t *p)
 {
-    int i = 0;
+    apr_status_t rv;
+
     *proc = apr_pcalloc(p, sizeof(**proc));
 
     /* slight delay to allow things to settle */
     apr_sleep (1);
 
-    if (apr_proc_fork(*proc, p) == APR_INCHILD) {
+    rv = apr_proc_fork(*proc, p);
+    if (rv == APR_INCHILD) {
+        int i = 0;
         /* The parent process has setup all processes to call apr_terminate
          * at exit.  But, that means that all processes must also call
          * apr_initialize at startup.  You cannot have an unequal number
          * of apr_terminate and apr_initialize calls.  If you do, bad things
          * will happen.  In this case, the bad thing is that if the mutex
          * is a semaphore, it will be destroyed before all of the processes
          * die.  That means that the test will most likely fail.
          */
         apr_initialize();
 
+        if (apr_proc_mutex_child_init(&proc_lock, NULL, p))
+            exit(1);
+
         do {
-            apr_proc_mutex_lock(proc_lock); 
+            if (apr_proc_mutex_lock(proc_lock))
+                exit(1);
             i++;
             *x = increment(*x);
-            apr_proc_mutex_unlock(proc_lock); 
+            if (apr_proc_mutex_unlock(proc_lock))
+                exit(1);
         } while (i < MAX_ITER);
-        exit(1);
-    }
+        exit(0);
+    } 
+
+    CuAssert(tc, "fork failed", rv == APR_INPARENT);
+}
+
+/* Wait for a child process and check it terminated with success. */
+static void await_child(CuTest *tc, apr_proc_t *proc)
+{
+    int code;
+    apr_exit_why_e why;
+    apr_status_t rv;
+
+    rv = apr_proc_wait(proc, &code, &why, APR_WAIT);
+    CuAssert(tc, "child did not terminate with success",
+             rv == APR_CHILD_DONE && why == APR_PROC_EXIT && code == 0);
 }
 
 static void test_exclusive(CuTest *tc, const char *lockname)
 {
-    apr_proc_t *p1, *p2, *p3, *p4;
+    apr_proc_t *child[CHILDREN];
     apr_status_t rv;
+    int n;
  
     rv = apr_proc_mutex_create(&proc_lock, lockname, APR_LOCK_DEFAULT, p);
     apr_assert_success(tc, "create the mutex", rv);
  
-    make_child(&p1, p);
-    make_child(&p2, p);
-    make_child(&p3, p);
-    make_child(&p4, p);
- 
-    apr_proc_wait(p1, NULL, NULL, APR_WAIT);
-    apr_proc_wait(p2, NULL, NULL, APR_WAIT);
-    apr_proc_wait(p3, NULL, NULL, APR_WAIT);
-    apr_proc_wait(p4, NULL, NULL, APR_WAIT);
+    for (n = 0; n < CHILDREN; n++)
+        make_child(tc, &child[n], p);
+
+    for (n = 0; n < CHILDREN; n++)
+        await_child(tc, child[n]);
     
     CuAssert(tc, "Locks don't appear to work", *x == MAX_COUNTER);
 }
 #endif
 
 static void proc_mutex(CuTest *tc)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testsockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testsockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/test/testsockets.c	2003-01-01 08:01:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/test/testsockets.c	2003-07-08 20:53:12.000000000 +0800
@@ -165,20 +165,48 @@
     CuAssertIntEquals(tc, 7771, fromport);
 
     apr_socket_close(sock);
     apr_socket_close(sock2);
 }
 
+static void socket_userdata(CuTest *tc)
+{
+    apr_socket_t *sock1, *sock2;
+    apr_status_t rv;
+    char *data;
+    const char *key = "GENERICKEY";
+
+    rv = apr_socket_create(&sock1, AF_INET, SOCK_STREAM, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    rv = apr_socket_create(&sock2, AF_INET, SOCK_STREAM, p);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+
+    rv = apr_socket_data_set(sock1, "SOCK1", key, NULL);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    rv = apr_socket_data_set(sock2, "SOCK2", key, NULL);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+
+    rv = apr_socket_data_get((void **)&data, key, sock1);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    CuAssertStrEquals(tc, "SOCK1", data);
+    rv = apr_socket_data_get((void **)&data, key, sock2);
+    CuAssertIntEquals(tc, APR_SUCCESS, rv);
+    CuAssertStrEquals(tc, "SOCK2", data);
+}
+
 CuSuite *testsockets(void)
 {
     CuSuite *suite = CuSuiteNew("Socket Creation");
 
     SUITE_ADD_TEST(suite, tcp_socket);
     SUITE_ADD_TEST(suite, udp_socket);
 
     SUITE_ADD_TEST(suite, tcp6_socket);
     SUITE_ADD_TEST(suite, udp6_socket);
 
     SUITE_ADD_TEST(suite, sendto_receivefrom);
+
+    SUITE_ADD_TEST(suite, socket_userdata);
+    
     return suite;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/threadproc/unix/signals.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/threadproc/unix/signals.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr/threadproc/unix/signals.c	2003-01-07 07:44:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr/threadproc/unix/signals.c	2003-07-14 17:00:55.000000000 +0800
@@ -136,24 +136,25 @@
         return SIG_ERR;
     return oact.sa_handler;
 }
 
 #endif /* HAVE_SIGACTION */
 
-
-#ifdef SYS_SIGLIST_DECLARED
+/* AC_DECL_SYS_SIGLIST defines either of these symbols depending
+ * on the version of autoconf used. */
+#if defined(SYS_SIGLIST_DECLARED) || HAVE_DECL_SYS_SIGLIST
 
 void apr_signal_init(apr_pool_t *pglobal)
 {
 }
 const char *apr_signal_description_get(int signum)
 {
     return sys_siglist[signum];
 }
 
-#else /* !SYS_SIGLIST_DECLARED */
+#else /* !(SYS_SIGLIST_DECLARED || HAVE_DECL_SYS_SIGLIST) */
 
 /* we need to roll our own signal description stuff */
 
 #if defined(NSIG)
 #define APR_NUMSIG NSIG
 #elif defined(_NSIG)
@@ -295,13 +296,13 @@
     return
         signum < APR_NUMSIG
         ? signal_description[signum]
         : "unknown signal (number)";
 }
 
-#endif /* SYS_SIGLIST_DECLARED */
+#endif /* SYS_SIGLIST_DECLARED || HAVE_DECL_SYS_SIGLIST */
 
 #if APR_HAS_THREADS && (HAVE_SIGSUSPEND || APR_HAVE_SIGWAIT) && !defined(OS2)
 
 static void remove_sync_sigs(sigset_t *sig_mask)
 {
 #ifdef SIGABRT
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/aprutil.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/aprutil.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/aprutil.dsp	2003-03-29 06:35:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/aprutil.dsp	2003-09-08 03:47:09.000000000 +0800
@@ -369,12 +369,47 @@
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apu_want.h.in
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apu_want.hnw
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apu_want.hw
+
+!IF  "$(CFG)" == "aprutil - Win32 Release"
+
+# Begin Custom Build - Creating apu_want.h from apu_want.hw
+InputPath=.\include\apu_want.hw
+
+".\include\apu_want.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apu_want.hw > .\include\apu_want.h
+
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
+
+# Begin Custom Build - Creating apu_want.h from apu_want.hw
+InputPath=.\include\apu_want.hw
+
+".\include\apu_want.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apu_want.hw > .\include\apu_want.h
+
+# End Custom Build
+
+!ENDIF 
+
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_config.h.in
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\private\apu_config.hw
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/apu-config.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/apu-config.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/apu-config.in	2003-06-21 00:39:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/apu-config.in	2003-07-09 01:54:32.000000000 +0800
@@ -70,12 +70,13 @@
 
 APRUTIL_LIBNAME="@APRUTIL_LIBNAME@"
 
 APU_SOURCE_DIR="@abs_srcdir@"
 APU_BUILD_DIR="@abs_builddir@"
 APR_XML_EXPAT_OLD="@APR_XML_EXPAT_OLD@"
+APU_DB_VERSION="@apu_db_version@"
 
 show_usage()
 {
     cat << EOF
 Usage: apu-config [OPTION]
 
@@ -88,12 +89,13 @@
   --libs            print library information
   --srcdir          print APR-util source directory
   --link-ld         print link switch(es) for linking to APR-util
   --link-libtool    print the libtool inputs for linking to APR-util
   --apu-la-file     print the path to the .la file, if available
   --old-expat       indicate if APR-util was built against an old expat
+  --db-version      print the DB version
   --version         print APR-util's version as a dotted triple
   --help            print this help
 
 When linking with libtool, an application should do something like:
   APU_LIBS="\`apu-config --link-libtool --libs\`"
 or when linking directly:
@@ -235,12 +237,16 @@
         echo "no"
     else
         echo "$APR_XML_EXPAT_OLD"
     fi
     exit 0
     ;;
+    --db-version)
+    echo $APU_DB_VERSION
+    exit 0
+    ;;
     --help)
     show_usage
     exit 0
     ;;
     *)
     show_usage
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/buckets/apr_brigade.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/buckets/apr_brigade.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/buckets/apr_brigade.c	2003-01-01 08:02:17.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/buckets/apr_brigade.c	2003-08-28 10:09:52.000000000 +0800
@@ -124,12 +124,16 @@
      */
     if (e != APR_BRIGADE_SENTINEL(b)) {
         f = APR_RING_LAST(&b->list);
         APR_RING_UNSPLICE(e, f, link);
         APR_RING_SPLICE_HEAD(&a->list, e, f, apr_bucket, link);
     }
+
+    APR_BRIGADE_CHECK_CONSISTENCY(a);
+    APR_BRIGADE_CHECK_CONSISTENCY(b);
+
     return a;
 }
 
 APU_DECLARE(apr_status_t) apr_brigade_partition(apr_bucket_brigade *b,
                                                 apr_off_t point,
                                                 apr_bucket **after_point)
@@ -145,12 +149,14 @@
     }
     if (point == 0) {
         *after_point = APR_BRIGADE_FIRST(b);
         return APR_SUCCESS;
     }
 
+    APR_BRIGADE_CHECK_CONSISTENCY(b);
+
     APR_BRIGADE_FOREACH(e, b) {
         if ((e->length == (apr_size_t)(-1)) && (point > (apr_size_t)(-1))) {
             /* XXX: point is too far out to simply split this bucket,
              * we must fix this bucket's size and keep going... */
             rv = apr_bucket_read(e, &s, &len, APR_BLOCK_READ);
             if (rv != APR_SUCCESS) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/buckets/apr_buckets_alloc.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/buckets/apr_buckets_alloc.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/buckets/apr_buckets_alloc.c	2003-07-02 14:35:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/buckets/apr_buckets_alloc.c	2003-08-28 13:48:29.000000000 +0800
@@ -77,43 +77,53 @@
     apr_memnode_t *blocks;
 };
 
 static apr_status_t alloc_cleanup(void *data)
 {
     apr_bucket_alloc_t *list = data;
-    apr_allocator_t *allocator = list->allocator;
 
-    apr_allocator_free(allocator, list->blocks);
-    apr_allocator_destroy(allocator);
+    apr_allocator_free(list->allocator, list->blocks);
     return APR_SUCCESS;
 }
 
 APU_DECLARE_NONSTD(apr_bucket_alloc_t *) apr_bucket_alloc_create(apr_pool_t *p)
 {
-    apr_allocator_t *allocator;
+    apr_allocator_t *allocator = apr_pool_allocator_get(p);
+    apr_bucket_alloc_t *list = apr_bucket_alloc_create_ex(allocator);
+
+    list->pool = p;
+    apr_pool_cleanup_register(list->pool, list, alloc_cleanup,
+                              apr_pool_cleanup_null);
+
+    return list;
+}
+
+APU_DECLARE_NONSTD(apr_bucket_alloc_t *) apr_bucket_alloc_create_ex(
+                                             apr_allocator_t *allocator)
+{
     apr_bucket_alloc_t *list;
     apr_memnode_t *block;
 
-    apr_allocator_create(&allocator);
     block = apr_allocator_alloc(allocator, ALLOC_AMT);
     list = (apr_bucket_alloc_t *)block->first_avail;
-    list->pool = p;
+    list->pool = NULL;
     list->allocator = allocator;
     list->freelist = NULL;
     list->blocks = block;
     block->first_avail += APR_ALIGN_DEFAULT(sizeof(*list));
 
-    apr_pool_cleanup_register(list->pool, list, alloc_cleanup,
-                              apr_pool_cleanup_null);
-
     return list;
 }
 
 APU_DECLARE_NONSTD(void) apr_bucket_alloc_destroy(apr_bucket_alloc_t *list)
 {
-    apr_pool_cleanup_run(list->pool, list, alloc_cleanup);
+    if (list->pool) {
+        apr_pool_cleanup_kill(list->pool, list, alloc_cleanup);
+    }
+
+    apr_allocator_free(list->allocator, list->blocks);
 }
 
 APU_DECLARE_NONSTD(void *) apr_bucket_alloc(apr_size_t size, 
                                             apr_bucket_alloc_t *list)
 {
     node_header_t *node;
@@ -148,18 +158,39 @@
         node->memnode = memnode;
         node->size = size;
     }
     return ((char *)node) + SIZEOF_NODE_HEADER_T;
 }
 
+#ifdef APR_BUCKET_DEBUG
+#if APR_HAVE_STDLIB_H
+#include <stdlib.h>
+#endif
+static void check_not_already_free(node_header_t *node)
+{
+    apr_bucket_alloc_t *list = node->alloc;
+    node_header_t *curr = list->freelist;
+
+    while (curr) {
+        if (node == curr) {
+            abort();
+        }
+        curr = curr->next;
+    }
+}
+#else
+#define check_not_already_free(node)
+#endif
+
 APU_DECLARE_NONSTD(void) apr_bucket_free(void *mem)
 {
     node_header_t *node = (node_header_t *)((char *)mem - SIZEOF_NODE_HEADER_T);
     apr_bucket_alloc_t *list = node->alloc;
 
     if (node->size == SMALL_NODE_SIZE) {
+        check_not_already_free(node);
         node->next = list->freelist;
         list->freelist = node;
     }
     else {
         apr_allocator_free(list->allocator, node->memnode);
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/build/apu-conf.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/build/apu-conf.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/build/apu-conf.m4	2003-05-28 17:56:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/build/apu-conf.m4	2003-08-29 01:29:07.000000000 +0800
@@ -30,467 +30,12 @@
   dnl ### would be nice to obsolete these
   APR_SOURCE_DIR="`$apr_config --srcdir`"
   AC_SUBST(APR_BUILD_DIR)
   AC_SUBST(APR_SOURCE_DIR)
 ])
 
-dnl
-dnl APU_CHECK_DB1: is DB1 present?
-dnl
-dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
-dnl
-AC_DEFUN(APU_CHECK_DB1,[
-AC_CHECK_HEADER(db1/db.h, [
-  AC_CHECK_LIB(db1, dbopen, [
-  apu_db_header=db1/db.h
-  apu_db_lib=db1
-  apu_db_version=1
-  ])])
-if test "$apu_db_version" != "1"; then
-AC_CHECK_HEADER(db.h, [
-  AC_CHECK_LIB(c, dbopen, [
-  apu_db_header=db.h
-  apu_db_lib=
-  apu_db_version=1
-  ], [
-  AC_CHECK_LIB(db1, dbopen, [
-  apu_db_header=db.h
-  apu_db_lib=db1
-  apu_db_version=1
-  ])])])
-fi
-])
-
-dnl
-dnl APU_CHECK_DB185: is DB1.85 present?
-dnl
-dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
-dnl
-dnl NB: BerkelyDB v2 and above can be compiled in 1.85 mode
-dnl which has a libdb not libdb1 or libdb185
-AC_DEFUN(APU_CHECK_DB185,[
-AC_CHECK_HEADER(db_185.h, [
-  AC_CHECK_LIB(db, dbopen, [
-  apu_db_header=db_185.h
-  apu_db_lib=db
-  apu_db_version=185
-  ])])])
-
-dnl
-dnl APU_CHECK_DB2: is DB2 present?
-dnl
-dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
-dnl
-AC_DEFUN(APU_CHECK_DB2,[
-AC_CHECK_HEADER(db2/db.h, [
-  AC_CHECK_LIB(db2, db_open, [
-  apu_db_header=db2/db.h
-  apu_db_lib=db2
-  apu_db_version=2
-  ])])
-if test "$apu_db_version" != "2"; then
-AC_CHECK_HEADER(db.h, [
-  AC_CHECK_LIB(db, db_open, [
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=2
-  ])])
-fi
-])
-
-dnl
-dnl APU_CHECK_DB3: is DB3 present?
-dnl
-dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
-dnl
-AC_DEFUN(APU_CHECK_DB3,[
-AC_CHECK_HEADER(db3/db.h, [
-  AC_CHECK_LIB(db3, db_create, [
-  apu_db_header=db3/db.h
-  apu_db_lib=db3
-  apu_db_version=3
-  ])])
-if test "$apu_db_version" != "3"; then
-AC_CHECK_HEADER(db.h, [
-  AC_CHECK_LIB(db, db_create, [
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=3
-  ])])
-fi
-])
-
-dnl
-dnl APU_CHECK_DB4: is DB4 present?
-dnl
-dnl if present: sets apu_db_header, apu_db_lib, and apu_db_version
-dnl
-dnl At this point in time, DB4 doesn't have some functions that DB3 does.
-dnl So look for a function that was removed in DB3 to confirm DB4.  
-dnl If it fails, then we know we are DB4 at least.
-dnl
-AC_DEFUN(APU_CHECK_DB4,[
-AC_CHECK_HEADER(db4/db.h, [
-  AC_CHECK_LIB(db4, db_create, [
-  apu_db_header=db4/db.h
-  apu_db_lib=db4
-  apu_db_version=4
-  ], [
-  AC_CHECK_LIB(db-4.0, db_create, [
-  apu_db_header=db4/db.h
-  apu_db_lib=db-4.0
-  apu_db_version=4
-  ])])])
-if test "$apu_db_version" != "4"; then
-AC_CHECK_HEADER(db.h, [
-  AC_CHECK_LIB(db, db_create, [
-    AC_CHECK_LIB(db, lock_get, [], [
-        apu_db_header=db.h
-        apu_db_lib=db
-        apu_db_version=4
-    ])], [
-      AC_CHECK_LIB(db, db_create_4000, [
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
-    ], [
-      AC_CHECK_LIB(db, db_create_4001, [
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
-    ])])])])
-fi
-])
-
-AC_DEFUN(APU_CHECK_BERKELEY_DB,[
-if test "$apu_want_db" != "0"; then
-  APU_CHECK_DB4
-  if test "$apu_db_version" != "4"; then
-    APU_CHECK_DB3
-    if test "$apu_db_version" != "3"; then
-      APU_CHECK_DB2
-      if test "$apu_db_version" != "2"; then
-        APU_CHECK_DB1
-        if test "$apu_db_version" != "1"; then
-          APU_CHECK_DB185
-        fi
-      fi
-    fi
-  fi
-fi
-AC_MSG_CHECKING(for Berkeley DB)
-if test "$apu_db_version" != "0"; then
-  apu_have_db=1
-  AC_MSG_RESULT(found db$apu_db_version)
-else
-  AC_MSG_RESULT(not found)
-fi
-
-
-])
-dnl
-dnl APU_CHECK_DBM: see what kind of DBM backend to use for apr_dbm.
-dnl
-AC_DEFUN(APU_CHECK_DBM,[
-apu_use_sdbm=0
-apu_use_ndbm=0
-apu_use_gdbm=0
-apu_use_db=0
-dnl it's in our codebase
-apu_have_sdbm=1
-apu_have_gdbm=0
-apu_have_ndbm=0
-apu_have_db=0
-
-apu_db_header=db.h		# default so apu_select_dbm.h is syntactically correct
-apu_db_version=0
-
-if test -n "$apu_db_xtra_libs"; then
-  saveddbxtralibs="$LIBS"
-  LIBS="$apu_db_xtra_libs $LIBS"
-fi
-
-AC_ARG_WITH(dbm,
-  [  --with-dbm=DBM          choose the DBM type to use.
-                          DBM={sdbm,gdbm,ndbm,db,db1,db185,db2,db3,db4}],[
-  if test "$withval" = "yes"; then
-    AC_MSG_ERROR([--with-dbm needs to specify a DBM type to use.
-One of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4])
-  fi
-  requested="$withval"
-],[
-  requested=default
-])
-
-AC_ARG_WITH([gdbm],
-[ --with-gdbm=DIR          specify GDBM location], [
-    apu_have_gdbm=0
-    if test "$withval" = "yes"; then
-      AC_CHECK_HEADER(gdbm.h, AC_CHECK_LIB(gdbm, gdbm_open, [apu_have_gdbm=1]))
-    elif test "$withval" = "no"; then
-      apu_have_gdbm=0
-    else
-        CPPFLAGS="-I$withval/include"
-        LIBS="-L$withval/lib "
-
-        AC_MSG_CHECKING(checking for gdbm in $withval)
-        AC_CHECK_HEADER(gdbm.h, AC_CHECK_LIB(gdbm, gdbm_open, [apu_have_gdbm=1]))
-        if test "$apu_have_gdbm" != "0"; then
-            APR_ADDTO(APRUTIL_LDFLAGS, [-L$withval/lib])
-            APR_ADDTO(APRUTIL_INCLUDES, [-I$withval/include])
-        fi
-    fi
-],[
-    apu_have_gdbm=0
-    AC_CHECK_HEADER(gdbm.h, AC_CHECK_LIB(gdbm, gdbm_open, [apu_have_gdbm=1]))
-])
-
-AC_ARG_WITH([ndbm],
-[ --with-ndbm=PATH 
-    Find the NDBM header and library in \`PATH/include' and 
-    \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search 
-    for header files in HEADER, and the library in LIB.  If you omit
-    the \`=PATH' part completely, the configure script will search
-    for NDBM in a number of standard places.], [
-
-    apu_have_ndbm=0
-    if test "$withval" = "yes"; then
-      AC_MSG_CHECKING(checking for ndbm in the usual places)
-      apu_want_ndbm=1
-      NDBM_INC=""
-      NDBM_LDFLAGS=""
-    elif test "$withval" = "no"; then
-      apu_want_ndbm=0
-    else
-      apu_want_ndbm=1
-      case "$withval" in
-        *":"*)
-          NDBM_INC="-I`echo $withval |sed -e 's/:.*$//'`"
-          NDBM_LDFLAGS="-L`echo $withval |sed -e 's/^.*://'`"
-          AC_MSG_CHECKING(checking for ndbm includes with $NDBM_INC libs with $NDBM_LDFLAGS )
-        ;;
-        *)
-          NDBM_INC="-I$withval/include"
-          NDBM_LDFLAGS="-L$withval/lib"
-          AC_MSG_CHECKING(checking for ndbm includes in $withval)
-        ;;
-      esac
-    fi
-
-    save_cppflags="$CPPFLAGS"
-    save_ldflags="$LDFLAGS"
-    CPPFLAGS="$CPPFLAGS $NDBM_INC"
-    LDFLAGS="$LDFLAGS $NDBM_LDFLAGS"
-    dnl db_ndbm_open is what sleepcat's compatibility library actually has in it's lib
-    if test "$apu_want_ndbm" != "0"; then
-      AC_CHECK_HEADER(ndbm.h, 
-        AC_CHECK_LIB(c, dbm_open, [apu_have_ndbm=1;apu_ndbm_lib=c],
-            AC_CHECK_LIB(dbm, dbm_open, [apu_have_ndbm=1;apu_ndbm_lib=dbm],
-                AC_CHECK_LIB(db, dbm_open, [apu_have_ndbm=1;apu_ndbm_lib=db],
-                    AC_CHECK_LIB(db, __db_ndbm_open, [apu_have_ndbm=1;apu_ndbm_lib=db])
-                )
-            )
-        )
-      )
-      if test "$apu_have_ndbm" != "0";  then
-            if test "$withval" != "yes"; then
-                APR_ADDTO(APRUTIL_INCLUDES, [$NDBM_INC])
-                APR_ADDTO(APRUTIL_LDFLAGS, [$NDBM_LDFLAGS])
-            fi
-      elif test "$withval" != "yes"; then
-            AC_ERROR( NDBM not found in the specified directory)
-      fi
-    fi
-    CPPFLAGS="$save_cppflags"
-    LDFLAGS="$save_ldflags"
-],[
-    dnl don't check it no one has asked us for it
-    apu_have_ndbm=0
-])
-
-
-dnl We're going to try to find the highest version of Berkeley DB supported.
-AC_ARG_WITH([berkeley-db],
-[--with-berkeley-db=PATH
-     Find the Berkeley DB header and library in \`PATH/include' and
-    \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search
-    for header files in HEADER, and the library in LIB.  If you omit
-    the \`=PATH' part completely, the configure script will search
-    for Berkeley DB in a number of standard places.
-], [
-   if test "$withval" = "yes"; then
-      apu_want_db=1
-      BDB_INC=""
-      BDB_LDFLAGS=""
-    elif test "$withval" = "no"; then
-      apu_want_db=0
-    else
-      apu_want_db=1
-      case "$withval" in 
-        *":"*)
-          BDB_INC="-I`echo $withval |sed -e 's/:.*$//'`"
-          BDB_LDFLAGS="-L`echo $withval |sed -e 's/^.*://'`"
-        ;;
-        *)
-          BDB_INC="-I$withval/include"
-          BDB_LDFLAGS="-L$withval/lib"
-        ;;
-      esac
-      AC_MSG_RESULT(looking for berkeley-db includes with $BDB_INC)
-      AC_MSG_RESULT(looking for berkeley-db libs with $BDB_LDFLAGS)
-    fi
-    save_cppflags="$CPPFLAGS"
-    save_ldflags="$LDFLAGS"
-    CPPFLAGS="$CPPFLAGS $BDB_INC"
-    LDFLAGS="$LDFLAGS $BDB_LDFLAGS"
-    if test "$apu_want_db" != "0"; then
-        APU_CHECK_BERKELEY_DB
-        if test "$apu_db_version" != "0"; then
-            if test "$withval" != "yes"; then
-                APR_ADDTO(APRUTIL_INCLUDES, [$BDB_INC])
-                APR_ADDTO(APRUTIL_LDFLAGS, [$BDB_LDFLAGS])
-            fi
-        elif test "$withval" != "yes"; then
-            AC_ERROR( Berkeley DB not found in the specified directory)
-        fi
-    fi 
-    CPPFLAGS="$save_cppflags"
-    LDFLAGS="$save_ldflags"
-],[
-    APU_CHECK_BERKELEY_DB
-])
-
-
-dnl Note that we may have found db3, but the user wants db1.  So, check
-dnl explicitly for db1 in this case.  Unfortunately, this means 
-dnl repeating the DB tests again.  And, the fact that the APU Berkeley
-dnl DB macros can't have the side-effect of setting LIBS.
-case "$requested" in
-  sdbm)
-    apu_use_sdbm=1
-    apu_default_dbm=sdbm
-    ;;
-  gdbm)
-    apu_use_gdbm=1
-    apu_default_dbm=gdbm
-    ;;
-  ndbm)
-    apu_use_ndbm=1
-    apu_default_dbm=ndbm
-    ;;
-  db)
-    if test "$apu_db_version" != "0"; then
-      apu_use_db=1
-      apu_default_dbm=db
-    else
-      AC_MSG_ERROR(Berkeley db requested, but not found)
-    fi
-    ;;
-  db1)
-    APU_CHECK_DB1
-    if test "$apu_db_version" = "1"; then
-      apu_use_db=1
-      apu_default_dbm=db1
-    else
-      AC_MSG_ERROR(Berkeley db1 not found)
-    fi
-    ;;
-  db185)
-    APU_CHECK_DB185
-    if test "$apu_db_version" = "185"; then
-      apu_use_db=1
-      apu_default_dbm=db185
-    else
-      AC_MSG_ERROR(Berkeley db185 not found)
-    fi
-    ;;
-  db2)
-    APU_CHECK_DB2
-    if test "$apu_db_version" = "2"; then
-      apu_use_db=1
-      apu_default_dbm=db2
-    else
-      AC_MSG_ERROR(Berkeley db2 not found)
-    fi
-    ;;
-  db3)
-    APU_CHECK_DB3
-    if test "$apu_db_version" = "3"; then
-      apu_use_db=1
-      apu_default_dbm=db3
-    else
-      AC_MSG_ERROR(Berkeley db3 not found)
-    fi
-    ;;
-  db4)
-    APU_CHECK_DB4
-    if test "$apu_db_version" = "4"; then
-      apu_use_db=1
-      apu_default_dbm=db4
-    else
-      AC_MSG_ERROR(Berkeley db4 not found)
-    fi
-    ;;
-  default)
-    dnl ### use more sophisticated DBMs for the default?
-    apu_default_dbm="sdbm (default)"
-    apu_use_sdbm=1
-    ;;
-  *)
-    AC_MSG_ERROR([--with-dbm=$look_for is an unknown DBM type.
-Use one of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4])
-    ;;
-esac
-
-if test -n "$apu_db_xtra_libs"; then
-  LIBS="$saveddbxtralibs"
-fi
-
-dnl Yes, it'd be nice if we could collate the output in an order
-dnl so that the AC_MSG_CHECKING would be output before the actual
-dnl checks, but it isn't happening now.
-AC_MSG_CHECKING(for default DBM)
-AC_MSG_RESULT($apu_default_dbm)
-
-AC_SUBST(apu_use_sdbm)
-AC_SUBST(apu_use_gdbm)
-AC_SUBST(apu_use_ndbm)
-AC_SUBST(apu_use_db)
-
-AC_SUBST(apu_have_sdbm)
-AC_SUBST(apu_have_gdbm)
-AC_SUBST(apu_have_ndbm)
-AC_SUBST(apu_have_db)
-AC_SUBST(apu_db_header)
-AC_SUBST(apu_db_version)
-
-dnl Since we have already done the AC_CHECK_LIB tests, if we have it, 
-dnl we know the library is there.
-if test "$apu_have_gdbm" = "1"; then
-  APR_ADDTO(APRUTIL_EXPORT_LIBS,[-lgdbm])
-  APR_ADDTO(APRUTIL_LIBS,[-lgdbm])
-fi
-
-if test "$apu_have_ndbm" = "1"; then
-  APR_ADDTO(APRUTIL_EXPORT_LIBS,[-l$apu_ndbm_lib])
-  APR_ADDTO(APRUTIL_LIBS,[-l$apu_ndbm_lib])
-fi
-
-
-if test "$apu_db_version" != "0"; then
-  if test -n "$apu_db_lib"; then
-    APR_ADDTO(APRUTIL_EXPORT_LIBS,[-l$apu_db_lib])
-    APR_ADDTO(APRUTIL_LIBS,[-l$apu_db_lib])
-    if test -n "apu_db_xtra_libs"; then
-      APR_ADDTO(APRUTIL_EXPORT_LIBS,[$apu_db_xtra_libs])
-      APR_ADDTO(APRUTIL_LIBS,[$apu_db_xtra_libs])
-    fi
-  fi
-fi
-
-])
 
 dnl
 dnl APU_TEST_EXPAT(directory): test if Expat is located in the specified dir
 dnl
 dnl if present: sets expat_include_dir, expat_libs, possibly expat_old
 dnl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/build: dbm.m4
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/CHANGES	2003-06-12 15:27:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/CHANGES	2003-09-26 13:43:56.000000000 +0800
@@ -1,8 +1,24 @@
+Changes with APR-util 0.9.5
+
 Changes with APR-util 0.9.4
 
+  *) Changed apr_bucket_alloc_create() so that it uses the allocator
+     from the pool that was passed in rather than creating its own.
+     Also, the bucket_allocator is now allocated from the apr_allocator_t
+     rather than using apr_palloc().  Added apr_bucket_alloc_create_ex()
+     which takes an apr_allocator_t* directly rather than an apr_pool_t*.
+     [Cliff Woolley, Jean-Jacques Clar]
+
+  *) Added debugging consistency checks to the buckets code.  Add
+     -DAPR_BUCKET_DEBUG to the build flags to enable.
+     [Cliff Woolley]
+
+  *) Make the version of the db library APU built against visible.
+     [Thom May]
+
   *) Fix a problem with VPATH builds copying the APR rules.mk into the
      source directory rather than the build directory.  [Justin Erenkrantz]
 
   *) SECURITY [httpd incident CAN-2003-0189] Address a thread safety
      issue with apr_password_validate() on AIX, Linux, Mac OS X, and
      possibly other platforms.  [Jeff Trawick, Justin Erenkrantz]
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/configure	2003-07-07 22:51:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/configure	2003-10-25 01:51:13.000000000 +0800
@@ -848,27 +848,34 @@
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
   --with-apr=DIR|FILE     prefix for installed APR, path to APR build tree,
                           or the full path to apr-config
   --with-ldap-include=path  path to ldap include files with trailing slash
   --with-ldap-lib=path    path to ldap lib file
   --with-ldap=library     ldap library to use
-  --with-dbm=DBM          choose the DBM type to use.
-                          DBM={sdbm,gdbm,ndbm,db,db1,db185,db2,db3,db4}
- --with-gdbm=DIR          specify GDBM location
- --with-ndbm=PATH
-    Find the NDBM header and library in \`PATH/include' and
-    \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search
-    for header files in HEADER, and the library in LIB.  If you omit
-    the \`=PATH' part completely, the configure script will search
-    for NDBM in a number of standard places.
---with-berkeley-db=PATH
-     Find the Berkeley DB header and library in \`PATH/include' and
-    \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search
-    for header files in HEADER, and the library in LIB.  If you omit
-    the \`=PATH' part completely, the configure script will search
-    for Berkeley DB in a number of standard places.
+
+    --with-dbm=DBM          choose the DBM type to use.
+      DBM={sdbm,gdbm,ndbm,db,db1,db185,db2,db3,db4}
+
+
+    --with-gdbm=DIR          specify GDBM location
+
+
+    --with-ndbm=PATH
+      Find the NDBM header and library in \`PATH/include' and
+      \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search
+      for header files in HEADER, and the library in LIB.  If you omit
+      the \`=PATH' part completely, the configure script will search
+      for NDBM in a number of standard places.
+
+
+    --with-berkeley-db=PATH
+      Find the Berkeley DB header and library in \`PATH/include' and
+      \`PATH/lib'.  If PATH is of the form \`HEADER:LIB', then search
+      for header files in HEADER, and the library in LIB.  If you omit
+      the \`=PATH' part completely, the configure script will search
+      for Berkeley DB in a number of standard places.
 
   --with-expat=DIR        specify Expat location
   --with-iconv=DIR        path to iconv installation
 
 Some influential environment variables:
   CC          C compiler command
@@ -6510,46 +6544,41 @@
 
 
 
 
 
 
-apu_use_sdbm=0
-apu_use_ndbm=0
-apu_use_gdbm=0
-apu_use_db=0
-apu_have_sdbm=1
-apu_have_gdbm=0
-apu_have_ndbm=0
-apu_have_db=0
-
-apu_db_header=db.h		# default so apu_select_dbm.h is syntactically correct
-apu_db_version=0
-
-if test -n "$apu_db_xtra_libs"; then
-  saveddbxtralibs="$LIBS"
-  LIBS="$apu_db_xtra_libs $LIBS"
-fi
+  apu_use_sdbm=0
+  apu_use_ndbm=0
+  apu_use_gdbm=0
+  apu_use_db=0
+    apu_have_sdbm=1
+  apu_have_gdbm=0
+  apu_have_ndbm=0
+  apu_have_db=0
+
+  apu_db_header=db.h                # default so apu_select_dbm.h is syntactically correct
+  apu_db_version=0
 
 
 # Check whether --with-dbm or --without-dbm was given.
 if test "${with_dbm+set}" = set; then
   withval="$with_dbm"
 
-  if test "$withval" = "yes"; then
-    { { echo "$as_me:$LINENO: error: --with-dbm needs to specify a DBM type to use.
-One of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&5
+    if test "$withval" = "yes"; then
+      { { echo "$as_me:$LINENO: error: --with-dbm needs to specify a DBM type to use.
+        One of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&5
 echo "$as_me: error: --with-dbm needs to specify a DBM type to use.
-One of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&2;}
+        One of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&2;}
    { (exit 1); exit 1; }; }
-  fi
-  requested="$withval"
+    fi
+    requested="$withval"
 
 else
 
-  requested=default
+    requested=default
 
 fi;
 
 
 # Check whether --with-gdbm or --without-gdbm was given.
 if test "${with_gdbm+set}" = set; then
@@ -6715,18 +6744,18 @@
 fi
 
 
     elif test "$withval" = "no"; then
       apu_have_gdbm=0
     else
-        CPPFLAGS="-I$withval/include"
-        LIBS="-L$withval/lib "
+      CPPFLAGS="-I$withval/include"
+      LIBS="-L$withval/lib "
 
-        echo "$as_me:$LINENO: checking checking for gdbm in $withval" >&5
+      echo "$as_me:$LINENO: checking checking for gdbm in $withval" >&5
 echo $ECHO_N "checking checking for gdbm in $withval... $ECHO_C" >&6
-        if test "${ac_cv_header_gdbm_h+set}" = set; then
+      if test "${ac_cv_header_gdbm_h+set}" = set; then
   echo "$as_me:$LINENO: checking for gdbm.h" >&5
 echo $ECHO_N "checking for gdbm.h... $ECHO_C" >&6
 if test "${ac_cv_header_gdbm_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
 echo "$as_me:$LINENO: result: $ac_cv_header_gdbm_h" >&5
@@ -6878,13 +6907,13 @@
   apu_have_gdbm=1
 fi
 
 fi
 
 
-        if test "$apu_have_gdbm" != "0"; then
+      if test "$apu_have_gdbm" != "0"; then
 
   if test "x$APRUTIL_LDFLAGS" = "x"; then
     echo "  setting APRUTIL_LDFLAGS to \"-L$withval/lib\""
     APRUTIL_LDFLAGS="-L$withval/lib"
   else
     apr_addto_bugger="-L$withval/lib"
@@ -6921,13 +6950,13 @@
         echo "  adding \"$i\" to APRUTIL_INCLUDES"
         APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
       fi
     done
   fi
 
-        fi
+      fi
     fi
 
 else
 
     apu_have_gdbm=0
     if test "${ac_cv_header_gdbm_h+set}" = set; then
@@ -7451,13 +7479,13 @@
 
 
 fi
 
 
       if test "$apu_have_ndbm" != "0";  then
-            if test "$withval" != "yes"; then
+        if test "$withval" != "yes"; then
 
   if test "x$APRUTIL_INCLUDES" = "x"; then
     echo "  setting APRUTIL_INCLUDES to \"$NDBM_INC\""
     APRUTIL_INCLUDES="$NDBM_INC"
   else
     apr_addto_bugger="$NDBM_INC"
@@ -7494,15 +7522,15 @@
         echo "  adding \"$i\" to APRUTIL_LDFLAGS"
         APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
       fi
     done
   fi
 
-            fi
+        fi
       elif test "$withval" != "yes"; then
-            { { echo "$as_me:$LINENO: error: NDBM not found in the specified directory" >&5
+        { { echo "$as_me:$LINENO: error: NDBM not found in the specified directory" >&5
 echo "$as_me: error: NDBM not found in the specified directory" >&2;}
    { (exit 1); exit 1; }; }
       fi
     fi
     CPPFLAGS="$save_cppflags"
     LDFLAGS="$save_ldflags"
@@ -7511,65 +7539,124 @@
 
         apu_have_ndbm=0
 
 fi;
 
 
+  if test -n "$apu_db_xtra_libs"; then
+    saveddbxtralibs="$LIBS"
+    LIBS="$apu_db_xtra_libs $LIBS"
+  fi
+
 
 # Check whether --with-berkeley-db or --without-berkeley-db was given.
 if test "${with_berkeley_db+set}" = set; then
   withval="$with_berkeley_db"
 
-   if test "$withval" = "yes"; then
+    if test "$withval" = "yes"; then
       apu_want_db=1
-      BDB_INC=""
-      BDB_LDFLAGS=""
+      user_places=""
     elif test "$withval" = "no"; then
       apu_want_db=0
     else
       apu_want_db=1
-      case "$withval" in
-        *":"*)
-          BDB_INC="-I`echo $withval |sed -e 's/:.*$//'`"
-          BDB_LDFLAGS="-L`echo $withval |sed -e 's/^.*://'`"
-        ;;
-        *)
-          BDB_INC="-I$withval/include"
-          BDB_LDFLAGS="-L$withval/lib"
-        ;;
-      esac
-      echo "$as_me:$LINENO: result: looking for berkeley-db includes with $BDB_INC" >&5
-echo "${ECHO_T}looking for berkeley-db includes with $BDB_INC" >&6
-      echo "$as_me:$LINENO: result: looking for berkeley-db libs with $BDB_LDFLAGS" >&5
-echo "${ECHO_T}looking for berkeley-db libs with $BDB_LDFLAGS" >&6
+      user_places="$withval"
     fi
-    save_cppflags="$CPPFLAGS"
-    save_ldflags="$LDFLAGS"
-    CPPFLAGS="$CPPFLAGS $BDB_INC"
-    LDFLAGS="$LDFLAGS $BDB_LDFLAGS"
+
     if test "$apu_want_db" != "0"; then
 
-if test "$apu_want_db" != "0"; then
+  requested=$requested
+  check_places=$user_places
+
+  case "$requested" in
+  db)
+
+  all_places="$check_places"
+
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
 
-if test "${ac_cv_header_db4_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db4/db.h usability" >&5
-echo $ECHO_N "checking db4/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -7588,18 +7675,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db4/db.h presence" >&5
-echo $ECHO_N "checking db4/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -7625,282 +7712,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db4/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db4/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db4_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db4_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb4" >&5
-echo $ECHO_N "checking for db_create in -ldb4... $ECHO_C" >&6
-if test "${ac_cv_lib_db4_db_create+set}" = set; then
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb4  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
-main ()
-{
-db_create ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db4_db_create=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db4_db_create=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db4_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db4_db_create" >&6
-if test $ac_cv_lib_db4_db_create = yes; then
 
-  apu_db_header=db4/db.h
-  apu_db_lib=db4
-  apu_db_version=4
+    apu_try_berkeley_db_save_libs="$LIBS"
 
-else
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb-4.0" >&5
-echo $ECHO_N "checking for db_create in -ldb-4.0... $ECHO_C" >&6
-if test "${ac_cv_lib_db_4_0_db_create+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb-4.0  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-db_create ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_4_0_db_create=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_4_0_db_create=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_4_0_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_4_0_db_create" >&6
-if test $ac_cv_lib_db_4_0_db_create = yes; then
+  int major, minor, patch;
 
-  apu_db_header=db4/db.h
-  apu_db_lib=db-4.0
-  apu_db_version=4
+  db_version(&major, &minor, &patch);
 
-fi
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
 
-fi
+  /* Run-time check:  ensure the library claims to be the correct version. */
 
-fi
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
 
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
 
-if test "$apu_db_version" != "4"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
-else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-$ac_includes_default
-#include <db.h>
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char dbopen ();
 int
 main ()
 {
-db_create ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -7911,48 +7881,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
+fi
 
-echo "$as_me:$LINENO: checking for lock_get in -ldb" >&5
-echo $ECHO_N "checking for lock_get in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_lock_get+set}" = set; then
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char lock_get ();
+char db_open ();
 int
 main ()
 {
-lock_get ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -7963,182 +7939,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_lock_get=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_lock_get=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_lock_get" >&5
-echo "${ECHO_T}$ac_cv_lib_db_lock_get" >&6
-if test $ac_cv_lib_db_lock_get = yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBDB 1
-_ACEOF
-
-  LIBS="-ldb $LIBS"
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-
-        apu_db_header=db.h
-        apu_db_lib=db
-        apu_db_version=4
+  result=no
 
 fi
 
-else
-
-      echo "$as_me:$LINENO: checking for db_create_4000 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4000 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4000+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
+          fi
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create_4000 ();
-int
-main ()
-{
-db_create_4000 ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4000=yes
 else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4000=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+  result="no"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4000" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4000" >&6
-if test $ac_cv_lib_db_db_create_4000 = yes; then
 
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
 
-else
 
-      echo "$as_me:$LINENO: checking for db_create_4001 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4001 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4001+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create_4001 ();
-int
-main ()
-{
-db_create_4001 ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4001=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4001=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4001" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4001" >&6
-if test $ac_cv_lib_db_db_create_4001 = yes; then
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
 
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
 
-fi
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
 
-fi
 
-fi
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
 
-fi
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
 
 
-fi
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
 
   if test "$apu_db_version" != "4"; then
 
-if test "${ac_cv_header_db3_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db3/db.h usability" >&5
-echo $ECHO_N "checking db3/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -8157,18 +8199,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db3/db.h presence" >&5
-echo $ECHO_N "checking db3/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -8194,59 +8236,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db3/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db3/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db3_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db3_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb3" >&5
-echo $ECHO_N "checking for db_create in -ldb3... $ECHO_C" >&6
-if test "${ac_cv_lib_db3_db_create+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb3  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char dbopen ();
 int
 main ()
 {
-db_create ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -8257,160 +8405,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db3_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db3_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db3_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db3_db_create" >&6
-if test $ac_cv_lib_db3_db_create = yes; then
-
-  apu_db_header=db3/db.h
-  apu_db_lib=db3
-  apu_db_version=3
-
-fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-
-if test "$apu_db_version" != "3"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-$ac_includes_default
-#include <db.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
-
-fi
-if test $ac_cv_header_db_h = yes; then
-
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char db_open ();
 int
 main ()
 {
-db_create ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -8421,55 +8463,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=3
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-    if test "$apu_db_version" != "3"; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
 
-if test "${ac_cv_header_db2_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db2/db.h usability" >&5
-echo $ECHO_N "checking db2/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -8488,18 +8723,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db2/db.h presence" >&5
-echo $ECHO_N "checking db2/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -8525,59 +8760,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db2/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db2/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db2_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db2_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb2" >&5
-echo $ECHO_N "checking for db_open in -ldb2... $ECHO_C" >&6
-if test "${ac_cv_lib_db2_db_open+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb2  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_open ();
+char dbopen ();
 int
 main ()
 {
-db_open ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -8588,145 +8929,39 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db2_db_open=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db2_db_open=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db2_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db2_db_open" >&6
-if test $ac_cv_lib_db2_db_open = yes; then
-
-  apu_db_header=db2/db.h
-  apu_db_lib=db2
-  apu_db_version=2
-
-fi
-
-fi
-
-
-if test "$apu_db_version" != "2"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
-else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-$ac_includes_default
-#include <db.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+  result=no
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb" >&5
-echo $ECHO_N "checking for db_open in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_open+set}" = set; then
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -8752,55 +8987,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_open=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_open=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_open" >&6
-if test $ac_cv_lib_db_db_open = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=2
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-      if test "$apu_db_version" != "2"; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+      if test "$apu_db_version" != "3"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
 
-if test "${ac_cv_header_db1_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db1/db.h usability" >&5
-echo $ECHO_N "checking db1/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db1/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -8819,18 +9247,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db1/db.h presence" >&5
-echo $ECHO_N "checking db1/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db1/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -8856,44 +9284,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db1/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db1/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db1_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db1_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -8919,52 +9453,306 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
-
-  apu_db_header=db1/db.h
-  apu_db_lib=db1
-  apu_db_version=1
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-if test "$apu_db_version" != "1"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+        if test "$apu_db_version" != "2"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -8983,18 +9771,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -9020,44 +9808,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -lc" >&5
-echo $ECHO_N "checking for dbopen in -lc... $ECHO_C" >&6
-if test "${ac_cv_lib_c_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lc  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -9083,53 +9977,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_c_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_c_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_c_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_c_dbopen" >&6
-if test $ac_cv_lib_c_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=
-  apu_db_version=1
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
+
+fi
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char dbopen ();
+char db_open ();
 int
 main ()
 {
-dbopen ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -9140,229 +10035,119 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db1
-  apu_db_version=1
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
 
-fi
 
-        if test "$apu_db_version" != "1"; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-if test "${ac_cv_header_db_185_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
-else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db_185.h usability" >&5
-echo $ECHO_N "checking db_185.h usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-$ac_includes_default
-#include <db_185.h>
-_ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_header_compiler=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
 
-# Is the header present?
-echo "$as_me:$LINENO: checking db_185.h presence" >&5
-echo $ECHO_N "checking db_185.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db_185.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
   else
-    ac_cpp_err=
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
   fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db_185.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db_185.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_db_185_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
-
-fi
-if test $ac_cv_header_db_185_h = yes; then
-
-  echo "$as_me:$LINENO: checking for dbopen in -ldb" >&5
-echo $ECHO_N "checking for dbopen in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_dbopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char dbopen ();
-int
-main ()
-{
-dbopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_dbopen=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_dbopen=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db_dbopen" >&6
-if test $ac_cv_lib_db_dbopen = yes; then
-
-  apu_db_header=db_185.h
-  apu_db_lib=db
-  apu_db_version=185
-
-fi
-
-fi
 
 
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
         fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
       fi
-    fi
+    done
   fi
-fi
-echo "$as_me:$LINENO: checking for Berkeley DB" >&5
-echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
-if test "$apu_db_version" != "0"; then
-  apu_have_db=1
-  echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
-echo "${ECHO_T}found db$apu_db_version" >&6
-else
-  echo "$as_me:$LINENO: result: not found" >&5
-echo "${ECHO_T}not found" >&6
-fi
 
-
-
-        if test "$apu_db_version" != "0"; then
-            if test "$withval" != "yes"; then
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
 
   if test "x$APRUTIL_INCLUDES" = "x"; then
-    echo "  setting APRUTIL_INCLUDES to \"$BDB_INC\""
-    APRUTIL_INCLUDES="$BDB_INC"
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
   else
-    apr_addto_bugger="$BDB_INC"
+    apr_addto_bugger="-I$found/include"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
       for j in $APRUTIL_INCLUDES; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
@@ -9374,16 +10159,16 @@
       fi
     done
   fi
 
 
   if test "x$APRUTIL_LDFLAGS" = "x"; then
-    echo "  setting APRUTIL_LDFLAGS to \"$BDB_LDFLAGS\""
-    APRUTIL_LDFLAGS="$BDB_LDFLAGS"
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
   else
-    apr_addto_bugger="$BDB_LDFLAGS"
+    apr_addto_bugger="-L$found/lib"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
       for j in $APRUTIL_LDFLAGS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
@@ -9393,44 +10178,105 @@
         echo "  adding \"$i\" to APRUTIL_LDFLAGS"
         APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
       fi
     done
   fi
 
-            fi
-        elif test "$withval" != "yes"; then
-            { { echo "$as_me:$LINENO: error: Berkeley DB not found in the specified directory" >&5
-echo "$as_me: error: Berkeley DB not found in the specified directory" >&2;}
-   { (exit 1); exit 1; }; }
-        fi
-    fi
-    CPPFLAGS="$save_cppflags"
-    LDFLAGS="$save_ldflags"
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
 
-else
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+          if test "$apu_db_version" != "1"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
 
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
 
-if test "$apu_want_db" != "0"; then
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
 
-if test "${ac_cv_header_db4_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db4/db.h usability" >&5
-echo $ECHO_N "checking db4/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -9449,18 +10295,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db4/db.h presence" >&5
-echo $ECHO_N "checking db4/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -9486,59 +10332,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db4/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db4/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db4_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db4_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb4" >&5
-echo $ECHO_N "checking for db_create in -ldb4... $ECHO_C" >&6
-if test "${ac_cv_lib_db4_db_create+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb4  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char dbopen ();
 int
 main ()
 {
-db_create ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -9549,53 +10501,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db4_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db4_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db4_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db4_db_create" >&6
-if test $ac_cv_lib_db4_db_create = yes; then
-
-  apu_db_header=db4/db.h
-  apu_db_lib=db4
-  apu_db_version=4
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
+
+fi
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb-4.0" >&5
-echo $ECHO_N "checking for db_create in -ldb-4.0... $ECHO_C" >&6
-if test "${ac_cv_lib_db_4_0_db_create+set}" = set; then
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb-4.0  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char db_open ();
 int
 main ()
 {
-db_create ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -9606,54 +10559,269 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_4_0_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_4_0_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_4_0_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_4_0_db_create" >&6
-if test $ac_cv_lib_db_4_0_db_create = yes; then
-
-  apu_db_header=db4/db.h
-  apu_db_lib=db-4.0
-  apu_db_version=4
-
-fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-if test "$apu_db_version" != "4"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+          fi
+        fi
+      fi
+    fi
+  fi
+  echo "$as_me:$LINENO: checking for Berkeley DB" >&5
+echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
+  if test "$apu_have_db" = "1"; then
+    echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
+echo "${ECHO_T}found db$apu_db_version" >&6
+  else
+    echo "$as_me:$LINENO: result: not found" >&5
+echo "${ECHO_T}not found" >&6
+  fi
+
+    if test "$apu_have_db" = "0"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db requested" >&5
+echo "$as_me: error: Berkeley db requested" >&2;}
+   { (exit but not found); exit but not found; }; }
+    fi
+    ;;
+  db1)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -9672,18 +10840,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -9709,177 +10877,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
-main ()
-{
-db_create ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
 
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
 
-echo "$as_me:$LINENO: checking for lock_get in -ldb" >&5
-echo $ECHO_N "checking for lock_get in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_lock_get+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char lock_get ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-lock_get ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_lock_get=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_lock_get=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_lock_get" >&5
-echo "${ECHO_T}$ac_cv_lib_db_lock_get" >&6
-if test $ac_cv_lib_db_lock_get = yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBDB 1
-_ACEOF
 
-  LIBS="-ldb $LIBS"
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-else
 
-        apu_db_header=db.h
-        apu_db_lib=db
-        apu_db_version=4
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
 
-else
-
-      echo "$as_me:$LINENO: checking for db_create_4000 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4000 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4000+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create_4000 ();
+char dbopen ();
 int
 main ()
 {
-db_create_4000 ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -9890,53 +11046,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4000=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4000=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4000" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4000" >&6
-if test $ac_cv_lib_db_db_create_4000 = yes; then
-
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
 
-      echo "$as_me:$LINENO: checking for db_create_4001 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4001 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4001+set}" = set; then
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create_4001 ();
+char db_open ();
 int
 main ()
 {
-db_create_4001 ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -9947,59 +11104,254 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4001=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4001=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4001" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4001" >&6
-if test $ac_cv_lib_db_db_create_4001 = yes; then
-
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
-fi
 
 
-fi
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-  if test "$apu_db_version" != "4"; then
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
 
-if test "${ac_cv_header_db3_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+    if test "$apu_db_version" != "1"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db1 not found" >&5
+echo "$as_me: error: Berkeley db1 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db185)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db3/db.h usability" >&5
-echo $ECHO_N "checking db3/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -10018,18 +11370,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db3/db.h presence" >&5
-echo $ECHO_N "checking db3/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -10055,223 +11407,223 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db3/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db3/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db3_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db3_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb3" >&5
-echo $ECHO_N "checking for db_create in -ldb3... $ECHO_C" >&6
-if test "${ac_cv_lib_db3_db_create+set}" = set; then
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb3  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-db_create ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db3_db_create=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db3_db_create=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db3_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db3_db_create" >&6
-if test $ac_cv_lib_db3_db_create = yes; then
 
-  apu_db_header=db3/db.h
-  apu_db_lib=db3
-  apu_db_version=3
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-fi
 
-fi
+                eval "$cache_id=$apu_try_berkeley_db"
 
+fi
 
-if test "$apu_db_version" != "3"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-$ac_includes_default
-#include <db.h>
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+eval "$as_ac_Lib=no"
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+  result=no
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char db_open ();
 int
 main ()
 {
-db_create ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -10282,55 +11634,254 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=3
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-    if test "$apu_db_version" != "3"; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-if test "${ac_cv_header_db2_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
-else
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+    if test "$apu_db_version" != "185"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db185 not found" >&5
+echo "$as_me: error: Berkeley db185 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db2)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db2/db.h usability" >&5
-echo $ECHO_N "checking db2/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -10349,18 +11900,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db2/db.h presence" >&5
-echo $ECHO_N "checking db2/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -10386,208 +11937,208 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db2/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db2/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db2_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db2_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb2" >&5
-echo $ECHO_N "checking for db_open in -ldb2... $ECHO_C" >&6
-if test "${ac_cv_lib_db2_db_open+set}" = set; then
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb2  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_open ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-db_open ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db2_db_open=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db2_db_open=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db2_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db2_db_open" >&6
-if test $ac_cv_lib_db2_db_open = yes; then
 
-  apu_db_header=db2/db.h
-  apu_db_lib=db2
-  apu_db_version=2
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-fi
 
-fi
+                eval "$cache_id=$apu_try_berkeley_db"
 
+fi
 
-if test "$apu_db_version" != "2"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-$ac_includes_default
-#include <db.h>
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+eval "$as_ac_Lib=no"
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+  result=no
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb" >&5
-echo $ECHO_N "checking for db_open in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_open+set}" = set; then
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -10613,55 +12164,254 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_open=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_open=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_open" >&6
-if test $ac_cv_lib_db_db_open = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=2
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-      if test "$apu_db_version" != "2"; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-if test "${ac_cv_header_db1_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+    if test "$apu_db_version" != "2"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db2 not found" >&5
+echo "$as_me: error: Berkeley db2 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db3)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db1/db.h usability" >&5
-echo $ECHO_N "checking db1/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db1/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -10680,18 +12430,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db1/db.h presence" >&5
-echo $ECHO_N "checking db1/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db1/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -10717,208 +12467,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db1/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db1/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db1_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db1_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char dbopen ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-dbopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
+  int major, minor, patch;
 
-  apu_db_header=db1/db.h
-  apu_db_lib=db1
-  apu_db_version=1
+  db_version(&major, &minor, &patch);
 
-fi
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
 
-fi
+  /* Run-time check:  ensure the library claims to be the correct version. */
 
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
 
-if test "$apu_db_version" != "1"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
-else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-$ac_includes_default
-#include <db.h>
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -lc" >&5
-echo $ECHO_N "checking for dbopen in -lc... $ECHO_C" >&6
-if test "${ac_cv_lib_c_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lc  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -10944,53 +12636,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_c_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_c_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_c_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_c_dbopen" >&6
-if test $ac_cv_lib_c_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=
-  apu_db_version=1
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
+
+fi
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char dbopen ();
+char db_open ();
 int
 main ()
 {
-dbopen ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -11001,57 +12694,254 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db1
-  apu_db_version=1
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
 
-fi
-
-        if test "$apu_db_version" != "1"; then
 
-if test "${ac_cv_header_db_185_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+    if test "$apu_db_version" != "3"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db3 not found" >&5
+echo "$as_me: error: Berkeley db3 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db4)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db_185.h usability" >&5
-echo $ECHO_N "checking db_185.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db_185.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -11070,18 +12960,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db_185.h presence" >&5
-echo $ECHO_N "checking db_185.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db_185.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -11107,44 +12997,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db_185.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db_185.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db_185_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_185_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb" >&5
-echo $ECHO_N "checking for dbopen in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -11170,262 +13166,312 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db_dbopen" >&6
-if test $ac_cv_lib_db_dbopen = yes; then
-
-  apu_db_header=db_185.h
-  apu_db_lib=db
-  apu_db_version=185
-
-fi
-
-fi
-
-
-        fi
-      fi
-    fi
-  fi
-fi
-echo "$as_me:$LINENO: checking for Berkeley DB" >&5
-echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
-if test "$apu_db_version" != "0"; then
-  apu_have_db=1
-  echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
-echo "${ECHO_T}found db$apu_db_version" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  echo "$as_me:$LINENO: result: not found" >&5
-echo "${ECHO_T}not found" >&6
-fi
+  result=no
 
+fi
 
-
-
-fi;
-
-
-case "$requested" in
-  sdbm)
-    apu_use_sdbm=1
-    apu_default_dbm=sdbm
-    ;;
-  gdbm)
-    apu_use_gdbm=1
-    apu_default_dbm=gdbm
-    ;;
-  ndbm)
-    apu_use_ndbm=1
-    apu_default_dbm=ndbm
-    ;;
-  db)
-    if test "$apu_db_version" != "0"; then
-      apu_use_db=1
-      apu_default_dbm=db
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db requested" >&5
-echo "$as_me: error: Berkeley db requested" >&2;}
-   { (exit but not found); exit but not found; }; }
-    fi
-    ;;
-  db1)
-
-if test "${ac_cv_header_db1_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db1/db.h usability" >&5
-echo $ECHO_N "checking db1/db.h usability... $ECHO_C" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-$ac_includes_default
-#include <db1/db.h>
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
+eval "$as_ac_Lib=no"
 fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
-# Is the header present?
-echo "$as_me:$LINENO: checking db1/db.h presence" >&5
-echo $ECHO_N "checking db1/db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db1/db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
 
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db1/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db1/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db1/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db1/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db1/db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db1/db.h" >&5
-echo $ECHO_N "checking for db1/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db1_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+          fi
+
 else
-  ac_cv_header_db1_db_h=$ac_header_preproc
+  result="no"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db1_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db1_db_h" >&6
 
-fi
-if test $ac_cv_header_db1_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char dbopen ();
-int
-main ()
-{
-dbopen ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
-else
-  echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
-fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-  apu_db_header=db1/db.h
-  apu_db_lib=db1
-  apu_db_version=1
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
 
-fi
 
-fi
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db4 not found" >&5
+echo "$as_me: error: Berkeley db4 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db41)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
 
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
 
-if test "$apu_db_version" != "1"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -11444,18 +13490,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -11481,44 +13527,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -lc" >&5
-echo $ECHO_N "checking for dbopen in -lc... $ECHO_C" >&6
-if test "${ac_cv_lib_c_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lc  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -11544,53 +13696,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_c_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_c_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_c_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_c_dbopen" >&6
-if test $ac_cv_lib_c_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=
-  apu_db_version=1
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb1" >&5
-echo $ECHO_N "checking for dbopen in -ldb1... $ECHO_C" >&6
-if test "${ac_cv_lib_db1_dbopen+set}" = set; then
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb1  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char dbopen ();
+char db_open ();
 int
 main ()
 {
-dbopen ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -11601,66 +13754,257 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db1_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db1_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db1_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db1_dbopen" >&6
-if test $ac_cv_lib_db1_dbopen = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db1
-  apu_db_version=1
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
 
-fi
 
-    if test "$apu_db_version" = "1"; then
-      apu_use_db=1
-      apu_default_dbm=db1
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db1 not found" >&5
-echo "$as_me: error: Berkeley db1 not found" >&2;}
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db4 not found" >&5
+echo "$as_me: error: Berkeley db4 not found" >&2;}
    { (exit 1); exit 1; }; }
     fi
     ;;
-  db185)
+  default)
+
+  all_places="$check_places"
+
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
 
-if test "${ac_cv_header_db_185_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db_185.h usability" >&5
-echo $ECHO_N "checking db_185.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db_185.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -11679,18 +14023,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db_185.h presence" >&5
-echo $ECHO_N "checking db_185.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db_185.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -11716,44 +14060,150 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db_185.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db_185.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db_185.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db_185.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db_185.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db_185.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db_185.h" >&5
-echo $ECHO_N "checking for db_185.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_185_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db_185_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_185_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_185_h" >&6
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db_185_h = yes; then
 
-  echo "$as_me:$LINENO: checking for dbopen in -ldb" >&5
-echo $ECHO_N "checking for dbopen in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_dbopen+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -11779,62 +14229,10357 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_dbopen=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_dbopen=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_dbopen" >&5
-echo "${ECHO_T}$ac_cv_lib_db_dbopen" >&6
-if test $ac_cv_lib_db_dbopen = yes; then
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
 
-  apu_db_header=db_185.h
-  apu_db_lib=db
-  apu_db_version=185
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-    if test "$apu_db_version" = "185"; then
-      apu_use_db=1
-      apu_default_dbm=db185
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db185 not found" >&5
-echo "$as_me: error: Berkeley db185 not found" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
-    ;;
-  db2)
 
-if test "${ac_cv_header_db2_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+  if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+      if test "$apu_db_version" != "3"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+        if test "$apu_db_version" != "2"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+          if test "$apu_db_version" != "1"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+          fi
+        fi
+      fi
+    fi
+  fi
+  echo "$as_me:$LINENO: checking for Berkeley DB" >&5
+echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
+  if test "$apu_have_db" = "1"; then
+    echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
+echo "${ECHO_T}found db$apu_db_version" >&6
+  else
+    echo "$as_me:$LINENO: result: not found" >&5
+echo "${ECHO_T}not found" >&6
+  fi
+
+    ;;
+  esac
+
+      if test "$apu_have_db" = "0"; then
+        { { echo "$as_me:$LINENO: error: Berkeley DB not found." >&5
+echo "$as_me: error: Berkeley DB not found." >&2;}
+   { (exit 1); exit 1; }; }
+      fi
+    fi
+
+else
+
+
+  requested=$requested
+  check_places=""
+
+  case "$requested" in
+  db)
+
+  all_places="$check_places"
+
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+  if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+      if test "$apu_db_version" != "3"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+        if test "$apu_db_version" != "2"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+          if test "$apu_db_version" != "1"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+          fi
+        fi
+      fi
+    fi
+  fi
+  echo "$as_me:$LINENO: checking for Berkeley DB" >&5
+echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
+  if test "$apu_have_db" = "1"; then
+    echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
+echo "${ECHO_T}found db$apu_db_version" >&6
+  else
+    echo "$as_me:$LINENO: result: not found" >&5
+echo "${ECHO_T}not found" >&6
+  fi
+
+    if test "$apu_have_db" = "0"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db requested" >&5
+echo "$as_me: error: Berkeley db requested" >&2;}
+   { (exit but not found); exit but not found; }; }
+    fi
+    ;;
+  db1)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+    if test "$apu_db_version" != "1"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db1 not found" >&5
+echo "$as_me: error: Berkeley db1 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db185)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+    if test "$apu_db_version" != "185"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db185 not found" >&5
+echo "$as_me: error: Berkeley db185 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db2)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+    if test "$apu_db_version" != "2"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db2 not found" >&5
+echo "$as_me: error: Berkeley db2 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db3)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+    if test "$apu_db_version" != "3"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db3 not found" >&5
+echo "$as_me: error: Berkeley db3 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db4)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db4 not found" >&5
+echo "$as_me: error: Berkeley db4 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  db41)
+
+  places="$check_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+      { { echo "$as_me:$LINENO: error: Berkeley db4 not found" >&5
+echo "$as_me: error: Berkeley db4 not found" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+    ;;
+  default)
+
+  all_places="$check_places"
+
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local/BerkeleyDB.4.1"
+  fi
+
+  bdb_version="4"
+  if test ""1"" != "-1"; then
+    bdb_version="$bdb_version."1""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.1 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"1"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="1"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+  if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std /usr/local /usr/local/BerkeleyDB.4.0"
+  fi
+
+  bdb_version="4"
+  if test ""0"" != "-1"; then
+    bdb_version="$bdb_version."0""
+    if test ""-1"" != "-1"; then
+      bdb_version="$bdb_version."-1""
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db4/db.h db.h"
+  bdb_default_search_lib_names="db-4.0 db4 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_includes_default
+#include <$bdb_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_header_compiler=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <$bdb_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test ""4"" = "3" -o ""4"" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_"4"_"0"_"-1"_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major="4"
+    apu_check_berkeley_db_minor="0"
+    apu_check_berkeley_db_patch="-1"
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
+
+fi
+
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test ""4"" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          elif test ""4"" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char db_open ();
+int
+main ()
+{
+db_open ();
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Lib=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_Lib=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
+
+fi
+
+          fi
+
+else
+  result="no"
+fi
+
+
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=4
+  fi
+
+    if test "$apu_db_version" != "4"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=3
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db3/db.h db.h"
+  bdb_default_search_lib_names="db3 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db2/db.h usability" >&5
-echo $ECHO_N "checking db2/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -11853,18 +24598,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db2/db.h presence" >&5
-echo $ECHO_N "checking db2/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db2/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -11890,208 +24635,208 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db2/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db2/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db2/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db2/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db2/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db2/db.h" >&5
-echo $ECHO_N "checking for db2/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db2_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db2_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db2_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db2_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db2_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "3" = "3" -o "3" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_3_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb2" >&5
-echo $ECHO_N "checking for db_open in -ldb2... $ECHO_C" >&6
-if test "${ac_cv_lib_db2_db_open+set}" = set; then
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb2  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=3
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_open ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-db_open ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db2_db_open=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db2_db_open=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db2_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db2_db_open" >&6
-if test $ac_cv_lib_db2_db_open = yes; then
 
-  apu_db_header=db2/db.h
-  apu_db_lib=db2
-  apu_db_version=2
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-fi
 
-fi
+                eval "$cache_id=$apu_try_berkeley_db"
 
+fi
 
-if test "$apu_db_version" != "2"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "3" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-$ac_includes_default
-#include <db.h>
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+eval "$as_ac_Lib=no"
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+  result=no
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_open in -ldb" >&5
-echo $ECHO_N "checking for db_open in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_open+set}" = set; then
+          elif test "3" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -12117,64 +24862,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_open=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_open=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_open" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_open" >&6
-if test $ac_cv_lib_db_db_open = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=2
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-    if test "$apu_db_version" = "2"; then
-      apu_use_db=1
-      apu_default_dbm=db2
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db2 not found" >&5
-echo "$as_me: error: Berkeley db2 not found" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
     ;;
-  db3)
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=3
+  fi
+
+      if test "$apu_db_version" != "3"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=2
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db2/db.h db.h"
+  bdb_default_search_lib_names="db2 db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
 
-if test "${ac_cv_header_db3_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db3/db.h usability" >&5
-echo $ECHO_N "checking db3/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -12193,18 +25122,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db3/db.h presence" >&5
-echo $ECHO_N "checking db3/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db3/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -12230,223 +25159,223 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db3/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db3/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db3/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db3/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db3/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db3/db.h" >&5
-echo $ECHO_N "checking for db3/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db3_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db3_db_h=$ac_header_preproc
+  eval "$as_ac_Header=$ac_header_preproc"
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db3_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db3_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 
 fi
-if test $ac_cv_header_db3_db_h = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "2" = "3" -o "2" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb3" >&5
-echo $ECHO_N "checking for db_create in -ldb3... $ECHO_C" >&6
-if test "${ac_cv_lib_db3_db_create+set}" = set; then
+            cache_id="`echo apu_cv_check_berkeley_db_2_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb3  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=2
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-db_create ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db3_db_create=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db3_db_create=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db3_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db3_db_create" >&6
-if test $ac_cv_lib_db3_db_create = yes; then
 
-  apu_db_header=db3/db.h
-  apu_db_lib=db3
-  apu_db_version=3
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-fi
 
-fi
+                eval "$cache_id=$apu_try_berkeley_db"
 
+fi
 
-if test "$apu_db_version" != "3"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "2" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-$ac_includes_default
-#include <db.h>
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char dbopen ();
+int
+main ()
+{
+dbopen ();
+  ;
+  return 0;
+}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
+         { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_header_compiler=no
-fi
-rm -f conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
-
-# Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-#include <db.h>
-_ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
+eval "$as_ac_Lib=no"
 fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+  result=no
 
 fi
-if test $ac_cv_header_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
+          elif test "2" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char db_open ();
 int
 main ()
 {
-db_create ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -12457,64 +25386,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
-
-  apu_db_header=db.h
-  apu_db_lib=db
-  apu_db_version=3
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
+          fi
+
+else
+  result="no"
 fi
 
 
-fi
 
-    if test "$apu_db_version" = "3"; then
-      apu_use_db=1
-      apu_default_dbm=db3
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db3 not found" >&5
-echo "$as_me: error: Berkeley db3 not found" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
     ;;
-  db4)
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=2
+  fi
+
+        if test "$apu_db_version" != "2"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "0" != "-1"; then
+    bdb_version="$bdb_version.0"
+    if test "0" != "-1"; then
+      bdb_version="$bdb_version.0"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db1/db.h db.h"
+  bdb_default_search_lib_names="db1"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
 
-if test "${ac_cv_header_db4_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db4/db.h usability" >&5
-echo $ECHO_N "checking db4/db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -12533,18 +25646,18 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db4/db.h presence" >&5
-echo $ECHO_N "checking db4/db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db4/db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
@@ -12570,59 +25683,165 @@
 echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
 echo "${ECHO_T}$ac_header_preproc" >&6
 
 # So?  What about this header?
 case $ac_header_compiler:$ac_header_preproc in
   yes:no )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db4/db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
   no:yes )
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db4/db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db4/db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db4/db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db4/db.h: proceeding with the preprocessor's result" >&2;};;
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
 esac
-echo "$as_me:$LINENO: checking for db4/db.h" >&5
-echo $ECHO_N "checking for db4/db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db4_db_h+set}" = set; then
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_0_0_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_cv_header_db4_db_h=$ac_header_preproc
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=0
+    apu_check_berkeley_db_patch=0
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
+main ()
+{
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
+}
+
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  apu_try_berkeley_db=yes
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+apu_try_berkeley_db=no
+fi
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db4_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db4_db_h" >&6
+
+    LIBS="$apu_try_berkeley_db_save_libs"
+
+
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
-if test $ac_cv_header_db4_db_h = yes; then
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb4" >&5
-echo $ECHO_N "checking for db_create in -ldb4... $ECHO_C" >&6
-if test "${ac_cv_lib_db4_db_create+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb4  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char dbopen ();
 int
 main ()
 {
-db_create ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -12633,53 +25852,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db4_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db4_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db4_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db4_db_create" >&6
-if test $ac_cv_lib_db4_db_create = yes; then
-
-  apu_db_header=db4/db.h
-  apu_db_lib=db4
-  apu_db_version=4
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
 
-  echo "$as_me:$LINENO: checking for db_create in -ldb-4.0" >&5
-echo $ECHO_N "checking for db_create in -ldb-4.0... $ECHO_C" >&6
-if test "${ac_cv_lib_db_4_0_db_create+set}" = set; then
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb-4.0  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create ();
+char db_open ();
 int
 main ()
 {
-db_create ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -12690,54 +25910,248 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_4_0_db_create=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_4_0_db_create=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_4_0_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_4_0_db_create" >&6
-if test $ac_cv_lib_db_4_0_db_create = yes; then
-
-  apu_db_header=db4/db.h
-  apu_db_lib=db-4.0
-  apu_db_version=4
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
 
-if test "$apu_db_version" != "4"; then
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
+
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
+
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
+    ;;
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *)
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  esac
+
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=1
+  fi
+
+          if test "$apu_db_version" != "1"; then
+
+  places="$all_places"
+  if test -z "$places"; then
+    places="std"
+  fi
+
+  bdb_version=1
+  if test "-1" != "-1"; then
+    bdb_version="$bdb_version.-1"
+    if test "-1" != "-1"; then
+      bdb_version="$bdb_version.-1"
+    fi
+  fi
+  bdb_places="$places"
+  bdb_default_search_headers="db_185.h"
+  bdb_default_search_lib_names="db"
+
+
+  apu_have_db=0
+
+  # Save the original values of the flags we tweak.
+  apu_check_lib_save_libs="$LIBS"
+  apu_check_lib_save_cppflags="$CPPFLAGS"
+
+  # The variable `found' is the prefix under which we've found
+  # Berkeley DB, or `not' if we haven't found it anywhere yet.
+  found=not
+  for bdb_place in $bdb_places; do
+
+    LDFLAGS="$apu_check_lib_save_ldflags"
+    CPPFLAGS="$apu_check_lib_save_cppflags"
+    case "$bdb_place" in
+      "std" )
+        description="the standard places"
+      ;;
+      *":"* )
+        header="`echo $bdb_place | sed -e 's/:.*$//'`"
+        lib="`echo $bdb_place | sed -e 's/^.*://'`"
+        CPPFLAGS="$CPPFLAGS -I$header"
+        LDFLAGS="$LDFLAGS -L$lib"
+        description="$header and $lib"
+      ;;
+      * )
+        LDFLAGS="$LDFLAGS -L$bdb_place/lib"
+        CPPFLAGS="$CPPFLAGS -I$bdb_place/include"
+        description="$bdb_place"
+      ;;
+    esac
+
+    # Since there is no AC_MSG_NOTICE in autoconf 2.13, we use this
+    # trick to display a message instead.
+    echo "$as_me:$LINENO: checking checking for Berkeley DB $bdb_version in $description" >&5
+echo $ECHO_N "checking checking for Berkeley DB $bdb_version in $description... $ECHO_C" >&6
+    echo "$as_me:$LINENO: result: " >&5
+echo "${ECHO_T}" >&6
+
+    for bdb_libname in $bdb_default_search_lib_names; do
+      for bdb_header in $bdb_default_search_headers; do
+        # Clear the header cache variable for each location
+
+        cache_id="`echo ac_cv_header_${bdb_header} \
+                 | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
+
+        unset $cache_id
+        as_ac_Header=`echo "ac_cv_header_$bdb_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 else
   # Is the header compilable?
-echo "$as_me:$LINENO: checking db.h usability" >&5
-echo $ECHO_N "checking db.h usability... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header usability" >&5
+echo $ECHO_N "checking $bdb_header usability... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 $ac_includes_default
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
@@ -12756,214 +26170,202 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
 echo "${ECHO_T}$ac_header_compiler" >&6
 
 # Is the header present?
-echo "$as_me:$LINENO: checking db.h presence" >&5
-echo $ECHO_N "checking db.h presence... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking $bdb_header presence" >&5
+echo $ECHO_N "checking $bdb_header presence... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
-#include <db.h>
+#include <$bdb_header>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
-else
-  echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_header_preproc=no
-fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc in
-  yes:no )
-    { echo "$as_me:$LINENO: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: db.h: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-  no:yes )
-    { echo "$as_me:$LINENO: WARNING: db.h: present but cannot be compiled" >&5
-echo "$as_me: WARNING: db.h: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: db.h: check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: db.h: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: db.h: proceeding with the preprocessor's result" >&2;};;
-esac
-echo "$as_me:$LINENO: checking for db.h" >&5
-echo $ECHO_N "checking for db.h... $ECHO_C" >&6
-if test "${ac_cv_header_db_h+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_cv_header_db_h=$ac_header_preproc
-fi
-echo "$as_me:$LINENO: result: $ac_cv_header_db_h" >&5
-echo "${ECHO_T}$ac_cv_header_db_h" >&6
-
-fi
-if test $ac_cv_header_db_h = yes; then
-
-  echo "$as_me:$LINENO: checking for db_create in -ldb" >&5
-echo $ECHO_N "checking for db_create in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
-#line $LINENO "configure"
-#include "confdefs.h"
-
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char db_create ();
-int
-main ()
-{
-db_create ();
-  ;
-  return 0;
-}
-_ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
-  (eval $ac_link) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create=yes
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
 else
   echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create=no
+  cat conftest.$ac_ext >&5
+  ac_header_preproc=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc in
+  yes:no )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $bdb_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+  no:yes )
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $bdb_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $bdb_header: check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $bdb_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $bdb_header: proceeding with the preprocessor's result" >&2;};;
+esac
+echo "$as_me:$LINENO: checking for $bdb_header" >&5
+echo $ECHO_N "checking for $bdb_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create" >&6
-if test $ac_cv_lib_db_db_create = yes; then
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+
+          if test "1" = "3" -o "1" = "4"; then
+            # We generate a separate cache variable for each prefix and libname
+            # we search under.  That way, we avoid caching information that
+            # changes if the user runs `configure' with a different set of
+            # switches.
+
+            cache_id="`echo apu_cv_check_berkeley_db_1_-1_-1_${bdb_header}_${bdb_libname}_in_${bdb_place} \
+                     | sed -e 's/[^a-zA-Z0-9_]/_/g'`"
 
 
-echo "$as_me:$LINENO: checking for lock_get in -ldb" >&5
-echo $ECHO_N "checking for lock_get in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_lock_get+set}" = set; then
+            echo "$as_me:$LINENO: checking for $bdb_libname" >&5
+echo $ECHO_N "checking for $bdb_libname... $ECHO_C" >&6
+                                    if eval "test \"\${$cache_id+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
-cat >conftest.$ac_ext <<_ACEOF
+
+
+    apu_try_berkeley_db_save_libs="$LIBS"
+
+    apu_check_berkeley_db_major=1
+    apu_check_berkeley_db_minor=-1
+    apu_check_berkeley_db_patch=-1
+    apu_try_berkeley_db_header=$bdb_header
+    apu_try_berkeley_db_libname=$bdb_libname
+
+    LIBS="$LIBS -l$apu_try_berkeley_db_libname"
+    if test "$cross_compiling" = yes; then
+  apu_try_berkeley_db=yes
+
+else
+  cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
-/* Override any gcc2 internal prototype to avoid an error.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-/* We use char because int might match the return type of a gcc2
-   builtin and then its argument prototype would still apply.  */
-char lock_get ();
-int
+#include <stdio.h>
+#include <$apu_try_berkeley_db_header>
 main ()
 {
-lock_get ();
-  ;
-  return 0;
+  int major, minor, patch;
+
+  db_version(&major, &minor, &patch);
+
+  /* Sanity check: ensure that db.h constants actually match the db library */
+  if (major != DB_VERSION_MAJOR
+      || minor != DB_VERSION_MINOR
+      || patch != DB_VERSION_PATCH)
+    exit (1);
+
+  /* Run-time check:  ensure the library claims to be the correct version. */
+
+  if ($apu_check_berkeley_db_major != -1) {
+    if (major < $apu_check_berkeley_db_major)
+      exit (1);
+    if (major > $apu_check_berkeley_db_major)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_minor != -1) {
+    if (minor < $apu_check_berkeley_db_minor)
+      exit (1);
+    if (minor > $apu_check_berkeley_db_minor)
+      exit (0);
+  }
+
+  if ($apu_check_berkeley_db_patch == -1
+      || patch >= $apu_check_berkeley_db_patch)
+    exit (0);
+  else
+    exit (1);
 }
+
 _ACEOF
-rm -f conftest.$ac_objext conftest$ac_exeext
+rm -f conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest$ac_exeext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_lock_get=yes
+  apu_try_berkeley_db=yes
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_lock_get=no
+( exit $ac_status )
+apu_try_berkeley_db=no
 fi
-rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_lock_get" >&5
-echo "${ECHO_T}$ac_cv_lib_db_lock_get" >&6
-if test $ac_cv_lib_db_lock_get = yes; then
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBDB 1
-_ACEOF
 
-  LIBS="-ldb $LIBS"
+    LIBS="$apu_try_berkeley_db_save_libs"
 
-else
 
-        apu_db_header=db.h
-        apu_db_lib=db
-        apu_db_version=4
+                eval "$cache_id=$apu_try_berkeley_db"
 
 fi
 
-else
-
-      echo "$as_me:$LINENO: checking for db_create_4000 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4000 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4000+set}" = set; then
+            result="`eval echo '$'$cache_id`"
+            echo "$as_me:$LINENO: result: $result" >&5
+echo "${ECHO_T}$result" >&6
+          elif test "1" = "1"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_dbopen" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for dbopen in -l$bdb_libname" >&5
+echo $ECHO_N "checking for dbopen in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create_4000 ();
+char dbopen ();
 int
 main ()
 {
-db_create_4000 ();
+dbopen ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -12974,53 +26376,54 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4000=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4000=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4000" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4000" >&6
-if test $ac_cv_lib_db_db_create_4000 = yes; then
-
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
-
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
 else
+  result=no
 
-      echo "$as_me:$LINENO: checking for db_create_4001 in -ldb" >&5
-echo $ECHO_N "checking for db_create_4001 in -ldb... $ECHO_C" >&6
-if test "${ac_cv_lib_db_db_create_4001+set}" = set; then
+fi
+
+          elif test "1" = "2"; then
+            as_ac_Lib=`echo "ac_cv_lib_$bdb_libname''_db_open" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for db_open in -l$bdb_libname" >&5
+echo $ECHO_N "checking for db_open in -l$bdb_libname... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Lib+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldb  $LIBS"
+LIBS="-l$bdb_libname  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
 /* We use char because int might match the return type of a gcc2
    builtin and then its argument prototype would still apply.  */
-char db_create_4001 ();
+char db_open ();
 int
 main ()
 {
-db_create_4001 ();
+db_open ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
 if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
@@ -13031,69 +26434,247 @@
          { ac_try='test -s conftest$ac_exeext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_cv_lib_db_db_create_4001=yes
+  eval "$as_ac_Lib=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-ac_cv_lib_db_db_create_4001=no
+eval "$as_ac_Lib=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:$LINENO: result: $ac_cv_lib_db_db_create_4001" >&5
-echo "${ECHO_T}$ac_cv_lib_db_db_create_4001" >&6
-if test $ac_cv_lib_db_db_create_4001 = yes; then
-
-      apu_db_header=db.h
-      apu_db_lib=db
-      apu_db_version=4
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
+if test `eval echo '${'$as_ac_Lib'}'` = yes; then
+  result=yes
+else
+  result=no
 
 fi
 
-fi
+          fi
 
+else
+  result="no"
 fi
 
-fi
 
 
-fi
+        # If we found it, no need to search any more.
+        if test "$result" = "yes"; then
+          found="$bdb_place"
+          break
+        fi
+      done
+      test "$found" != "not" && break
+    done
+    test "$found" != "not" && break
+  done
 
-    if test "$apu_db_version" = "4"; then
-      apu_use_db=1
-      apu_default_dbm=db4
-    else
-      { { echo "$as_me:$LINENO: error: Berkeley db4 not found" >&5
-echo "$as_me: error: Berkeley db4 not found" >&2;}
-   { (exit 1); exit 1; }; }
-    fi
+  # Restore the original values of the flags we tweak.
+  LDFLAGS="$apu_check_lib_save_ldflags"
+  CPPFLAGS="$apu_check_lib_save_cppflags"
+
+  case "$found" in
+  "not")
+    apu_have_db=0
     ;;
-  default)
-        apu_default_dbm="sdbm (default)"
-    apu_use_sdbm=1
+  "std")
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
+    ;;
+  *":"*)
+    header="`echo $found | sed -e 's/:.*$//'`"
+    lib="`echo $found | sed -e 's/^.*://'`"
+
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$header\""
+    APRUTIL_INCLUDES="-I$header"
+  else
+    apr_addto_bugger="-I$header"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$lib\""
+    APRUTIL_LDFLAGS="-L$lib"
+  else
+    apr_addto_bugger="-L$lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
     ;;
   *)
-    { { echo "$as_me:$LINENO: error: --with-dbm=$look_for is an unknown DBM type.
-Use one of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&5
-echo "$as_me: error: --with-dbm=$look_for is an unknown DBM type.
-Use one of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&2;}
-   { (exit 1); exit 1; }; }
+
+  if test "x$APRUTIL_INCLUDES" = "x"; then
+    echo "  setting APRUTIL_INCLUDES to \"-I$found/include\""
+    APRUTIL_INCLUDES="-I$found/include"
+  else
+    apr_addto_bugger="-I$found/include"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_INCLUDES"
+        APRUTIL_INCLUDES="$APRUTIL_INCLUDES $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$found/lib\""
+    APRUTIL_LDFLAGS="-L$found/lib"
+  else
+    apr_addto_bugger="-L$found/lib"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+    apu_db_header=$bdb_header
+    apu_db_lib=$bdb_libname
+    apu_have_db=1
     ;;
-esac
+  esac
 
-if test -n "$apu_db_xtra_libs"; then
-  LIBS="$saveddbxtralibs"
-fi
+  if test "$apu_have_db" = "1"; then
+    apu_db_version=185
+  fi
+
+          fi
+        fi
+      fi
+    fi
+  fi
+  echo "$as_me:$LINENO: checking for Berkeley DB" >&5
+echo $ECHO_N "checking for Berkeley DB... $ECHO_C" >&6
+  if test "$apu_have_db" = "1"; then
+    echo "$as_me:$LINENO: result: found db$apu_db_version" >&5
+echo "${ECHO_T}found db$apu_db_version" >&6
+  else
+    echo "$as_me:$LINENO: result: not found" >&5
+echo "${ECHO_T}not found" >&6
+  fi
+
+    ;;
+  esac
+
+
+fi;
+
+  if test -n "$apu_db_xtra_libs"; then
+    LIBS="$saveddbxtralibs"
+  fi
+
+  case "$requested" in
+    sdbm)
+      apu_use_sdbm=1
+      apu_default_dbm=sdbm
+      ;;
+    gdbm)
+      apu_use_gdbm=1
+      apu_default_dbm=gdbm
+      ;;
+    ndbm)
+      apu_use_ndbm=1
+      apu_default_dbm=ndbm
+      ;;
+    db)
+      apu_use_db=1
+      apu_default_dbm=db
+      ;;
+    db1)
+      apu_use_db=1
+      apu_default_dbm=db1
+      ;;
+    db185)
+      apu_use_db=1
+      apu_default_dbm=db185
+      ;;
+    db2)
+      apu_use_db=1
+      apu_default_dbm=db2
+      ;;
+    db3)
+      apu_use_db=1
+      apu_default_dbm=db3
+      ;;
+    db4)
+      apu_use_db=1
+      apu_default_dbm=db4
+      ;;
+    db41)
+      apu_use_db=1
+      apu_default_dbm=db4
+      ;;
+    default)
+            apu_default_dbm="sdbm (default)"
+      apu_use_sdbm=1
+      ;;
+    *)
+      { { echo "$as_me:$LINENO: error: --with-dbm=$look_for is an unknown DBM type.
+        Use one of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&5
+echo "$as_me: error: --with-dbm=$look_for is an unknown DBM type.
+        Use one of: sdbm, gdbm, ndbm, db, db1, db185, db2, db3, db4" >&2;}
+   { (exit 1); exit 1; }; }
+      ;;
+  esac
 
-echo "$as_me:$LINENO: checking for default DBM" >&5
+        echo "$as_me:$LINENO: checking for default DBM" >&5
 echo $ECHO_N "checking for default DBM... $ECHO_C" >&6
-echo "$as_me:$LINENO: result: $apu_default_dbm" >&5
+  echo "$as_me:$LINENO: result: $apu_default_dbm" >&5
 echo "${ECHO_T}$apu_default_dbm" >&6
 
 
 
 
 
@@ -13102,13 +26683,13 @@
 
 
 
 
 
 
-if test "$apu_have_gdbm" = "1"; then
+      if test "$apu_have_gdbm" = "1"; then
 
   if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
     echo "  setting APRUTIL_EXPORT_LIBS to \"-lgdbm\""
     APRUTIL_EXPORT_LIBS="-lgdbm"
   else
     apr_addto_bugger="-lgdbm"
@@ -13145,15 +26726,15 @@
         echo "  adding \"$i\" to APRUTIL_LIBS"
         APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
-fi
+  fi
 
-if test "$apu_have_ndbm" = "1"; then
+  if test "$apu_have_ndbm" = "1"; then
 
   if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
     echo "  setting APRUTIL_EXPORT_LIBS to \"-l$apu_ndbm_lib\""
     APRUTIL_EXPORT_LIBS="-l$apu_ndbm_lib"
   else
     apr_addto_bugger="-l$apu_ndbm_lib"
@@ -13190,17 +26771,15 @@
         echo "  adding \"$i\" to APRUTIL_LIBS"
         APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
-fi
-
+  fi
 
-if test "$apu_db_version" != "0"; then
-  if test -n "$apu_db_lib"; then
+  if test "$apu_have_db" = "1"; then
 
   if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
     echo "  setting APRUTIL_EXPORT_LIBS to \"-l$apu_db_lib\""
     APRUTIL_EXPORT_LIBS="-l$apu_db_lib"
   else
     apr_addto_bugger="-l$apu_db_lib"
@@ -13282,14 +26861,12 @@
       fi
     done
   fi
 
     fi
   fi
-fi
-
 
 
 
 
 # Check whether --with-expat or --without-expat was given.
 if test "${with_expat+set}" = set; then
@@ -15009,13 +28586,13 @@
 if test ! -d "$top_builddir/include/private"; then
     mkdir $top_builddir/include
     mkdir $top_builddir/include/private
 fi
 
 MAKEFILES="Makefile buckets/Makefile crypto/Makefile dbm/Makefile dbm/sdbm/Makefile encoding/Makefile hooks/Makefile ldap/Makefile uri/Makefile xml/Makefile misc/Makefile strmatch/Makefile xlate/Makefile $test_Makefile"
-                                                            ac_config_files="$ac_config_files export_vars.sh apu-config include/private/apu_select_dbm.h include/apr_ldap.h include/apu.h $MAKEFILES"
+                                                                      ac_config_files="$ac_config_files export_vars.sh apu-config include/private/apu_select_dbm.h include/apr_ldap.h include/apu.h include/apu_want.h $MAKEFILES"
           ac_config_commands="$ac_config_commands default"
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
@@ -15522,12 +29099,13 @@
   # Handling of arguments.
   "export_vars.sh" ) CONFIG_FILES="$CONFIG_FILES export_vars.sh" ;;
   "apu-config" ) CONFIG_FILES="$CONFIG_FILES apu-config" ;;
   "include/private/apu_select_dbm.h" ) CONFIG_FILES="$CONFIG_FILES include/private/apu_select_dbm.h" ;;
   "include/apr_ldap.h" ) CONFIG_FILES="$CONFIG_FILES include/apr_ldap.h" ;;
   "include/apu.h" ) CONFIG_FILES="$CONFIG_FILES include/apu.h" ;;
+  "include/apu_want.h" ) CONFIG_FILES="$CONFIG_FILES include/apu_want.h" ;;
   "$MAKEFILES" ) CONFIG_FILES="$CONFIG_FILES $MAKEFILES" ;;
   "default" ) CONFIG_COMMANDS="$CONFIG_COMMANDS default" ;;
   "include/private/apu_config.h" ) CONFIG_HEADERS="$CONFIG_HEADERS include/private/apu_config.h" ;;
   *) { { echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
 echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
    { (exit 1); exit 1; }; };;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/configure.in	2003-06-12 15:27:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/configure.in	2003-08-29 01:29:07.000000000 +0800
@@ -10,12 +10,13 @@
 
 sinclude(build/apu-conf.m4)
 sinclude(build/apu-iconv.m4)
 sinclude(build/apu-hints.m4)
 sinclude(build/apr_common.m4)
 sinclude(build/find_apr.m4)
+sinclude(build/dbm.m4)
 
 dnl Generate ./config.nice for reproducing runs of configure
 dnl 
 APR_CONFIG_NICE(config.nice)
 
 dnl # Some initial steps for configuration.  We setup the default directory
@@ -194,10 +195,11 @@
 AC_OUTPUT([
     export_vars.sh
     apu-config
     include/private/apu_select_dbm.h
     include/apr_ldap.h
     include/apu.h
+    include/apu_want.h
     $MAKEFILES
 	],[
 chmod +x apu-config
 ])
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/dbm/apr_dbm_berkeleydb.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/dbm/apr_dbm_berkeleydb.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/dbm/apr_dbm_berkeleydb.c	2003-01-01 08:02:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/dbm/apr_dbm_berkeleydb.c	2003-08-18 18:43:19.000000000 +0800
@@ -52,13 +52,15 @@
  * <http://www.apache.org/>.
  */
 
 #include "apr_strings.h"
 #define APR_WANT_MEMFUNC
 #include "apr_want.h"
-#define APU_DBM_BERKELEYDB_PRIVATE 1
+
+#define APU_WANT_DB
+#include "apu_want.h"
 
 #if APR_HAVE_STDLIB_H
 #include <stdlib.h> /* for abort() */
 #endif
 
 #include "apu.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apr_buckets.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apr_buckets.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apr_buckets.h	2003-07-02 14:35:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apr_buckets.h	2003-08-28 13:48:29.000000000 +0800
@@ -56,12 +56,16 @@
  * @brief APR-UTIL Buckets/Bucket Brigades
  */
 
 #ifndef APR_BUCKETS_H
 #define APR_BUCKETS_H
 
+#if defined(APR_BUCKET_DEBUG) && !defined(APR_RING_DEBUG)
+#define APR_RING_DEBUG
+#endif
+
 #include "apu.h"
 #include "apr_network_io.h"
 #include "apr_file_io.h"
 #include "apr_general.h"
 #include "apr_mmap.h"
 #include "apr_errno.h"
@@ -312,12 +316,43 @@
 
 /**
  * Function called when a brigade should be flushed
  */
 typedef apr_status_t (*apr_brigade_flush)(apr_bucket_brigade *bb, void *ctx);
 
+/*
+ * define APR_BUCKET_DEBUG if you want your brigades to be checked for
+ * validity at every possible instant.  this will slow your code down
+ * substantially but is a very useful debugging tool.
+ */
+#ifdef APR_BUCKET_DEBUG
+
+#define APR_BRIGADE_CHECK_CONSISTENCY(b)				\
+        APR_RING_CHECK_CONSISTENCY(&(b)->list, apr_bucket, link)
+
+#define APR_BUCKET_CHECK_CONSISTENCY(e)					\
+        APR_RING_CHECK_ELEM_CONSISTENCY((e), apr_bucket, link)
+
+#else
+/**
+ * checks the ring pointers in a bucket brigade for consistency.  an
+ * abort() will be triggered if any inconsistencies are found.
+ *   note: this is a no-op unless APR_BUCKET_DEBUG is defined.
+ * @param b The brigade
+ */
+#define APR_BRIGADE_CHECK_CONSISTENCY(b)
+/**
+ * checks the brigade a bucket is in for ring consistency.  an
+ * abort() will be triggered if any inconsistencies are found.
+ *   note: this is a no-op unless APR_BUCKET_DEBUG is defined.
+ * @param e The bucket
+ */
+#define APR_BUCKET_CHECK_CONSISTENCY(e)
+#endif
+
+
 /**
  * Wrappers around the RING macros to reduce the verbosity of the code
  * that handles bucket brigades.
  */
 /**
  * The magic pointer value that indicates the head of the brigade
@@ -402,58 +437,66 @@
  * @param b The brigade to add to
  * @param e The first bucket in a list of buckets to insert
  */
 #define APR_BRIGADE_INSERT_HEAD(b, e) do {				\
 	apr_bucket *ap__b = (e);                                        \
 	APR_RING_INSERT_HEAD(&(b)->list, ap__b, apr_bucket, link);	\
+        APR_BRIGADE_CHECK_CONSISTENCY((b));				\
     } while (0)
 
 /**
  * Insert a list of buckets at the end of a brigade
  * @param b The brigade to add to
  * @param e The first bucket in a list of buckets to insert
  */
 #define APR_BRIGADE_INSERT_TAIL(b, e) do {				\
 	apr_bucket *ap__b = (e);					\
 	APR_RING_INSERT_TAIL(&(b)->list, ap__b, apr_bucket, link);	\
+        APR_BRIGADE_CHECK_CONSISTENCY((b));				\
     } while (0)
 
 /**
  * Concatenate brigade b onto the end of brigade a, leaving brigade b empty
  * @param a The first brigade
  * @param b The second brigade
  */
-#define APR_BRIGADE_CONCAT(a, b)					\
-	APR_RING_CONCAT(&(a)->list, &(b)->list, apr_bucket, link)
+#define APR_BRIGADE_CONCAT(a, b) do {					\
+        APR_RING_CONCAT(&(a)->list, &(b)->list, apr_bucket, link);	\
+        APR_BRIGADE_CHECK_CONSISTENCY((a));				\
+    } while (0)
 
 /**
  * Prepend brigade b onto the beginning of brigade a, leaving brigade b empty
  * @param a The first brigade
  * @param b The second brigade
  */
-#define APR_BRIGADE_PREPEND(a, b)					\
-	APR_RING_PREPEND(&(a)->list, &(b)->list, apr_bucket, link)
+#define APR_BRIGADE_PREPEND(a, b) do {					\
+        APR_RING_PREPEND(&(a)->list, &(b)->list, apr_bucket, link);	\
+        APR_BRIGADE_CHECK_CONSISTENCY((a));				\
+    } while (0)
 
 /**
  * Insert a list of buckets before a specified bucket
  * @param a The bucket to insert before
  * @param b The buckets to insert
  */
 #define APR_BUCKET_INSERT_BEFORE(a, b) do {				\
 	apr_bucket *ap__a = (a), *ap__b = (b);				\
 	APR_RING_INSERT_BEFORE(ap__a, ap__b, link);			\
+        APR_BUCKET_CHECK_CONSISTENCY(ap__a);				\
     } while (0)
 
 /**
  * Insert a list of buckets after a specified bucket
  * @param a The bucket to insert after
  * @param b The buckets to insert
  */
 #define APR_BUCKET_INSERT_AFTER(a, b) do {				\
 	apr_bucket *ap__a = (a), *ap__b = (b);				\
 	APR_RING_INSERT_AFTER(ap__a, ap__b, link);			\
+        APR_BUCKET_CHECK_CONSISTENCY(ap__a);				\
     } while (0)
 
 /**
  * Get the next bucket in the list
  * @param e The current bucket
  * @return The next bucket
@@ -919,20 +962,36 @@
                                               void *ctx,
                                               const char *fmt, va_list va);
 
 /*  *****  Bucket freelist functions *****  */
 /**
  * Create a bucket allocator.
- * @param p Pool to allocate the allocator from [note: this is only
- *          used to allocate internal structures of the allocator, NOT
- *          to allocate the memory handed out by the allocator]
+ * @param p This pool's underlying apr_allocator_t is used to allocate memory
+ *          for the bucket allocator.  When the pool is destroyed, the bucket
+ *          allocator's cleanup routine will free all memory that has been
+ *          allocated from it.
+ * @remark  The reason the allocator gets its memory from the pool's
+ *          apr_allocator_t rather than from the pool itself is because
+ *          the bucket allocator will free large memory blocks back to the
+ *          allocator when it's done with them, thereby preventing memory
+ *          footprint growth that would occur if we allocated from the pool.
  * @warning The allocator must never be used by more than one thread at a time.
  */
 APU_DECLARE_NONSTD(apr_bucket_alloc_t *) apr_bucket_alloc_create(apr_pool_t *p);
 
 /**
+ * Create a bucket allocator.
+ * @param allocator This apr_allocator_t is used to allocate both the bucket
+ *          allocator and all memory handed out by the bucket allocator.  The
+ *          caller is responsible for destroying the bucket allocator and the
+ *          apr_allocator_t -- no automatic cleanups will happen.
+ * @warning The allocator must never be used by more than one thread at a time.
+ */
+APU_DECLARE_NONSTD(apr_bucket_alloc_t *) apr_bucket_alloc_create_ex(apr_allocator_t *allocator);
+
+/**
  * Destroy a bucket allocator.
  * @param list The allocator to be destroyed
  */
 APU_DECLARE_NONSTD(void) apr_bucket_alloc_destroy(apr_bucket_alloc_t *list);
 
 /**
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apr_hooks.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apr_hooks.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apr_hooks.h	2003-01-01 08:02:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apr_hooks.h	2003-08-16 06:27:28.000000000 +0800
@@ -242,16 +242,16 @@
 /** run this hook last, after EVERYTHING */
 #define APR_HOOK_REALLY_LAST	30
 
 /**
  * The global pool used to allocate any memory needed by the hooks.
  */ 
-APU_DECLARE_DATA extern apr_pool_t *apr_global_hook_pool;
+APU_DECLARE_DATA extern apr_pool_t *apr_hook_global_pool;
 
 /** @deprecated @see apr_hook_global_pool */
-APU_DECLARE_DATA extern apr_pool_t *apr_hook_global_pool;
+APU_DECLARE_DATA extern apr_pool_t *apr_global_hook_pool;
 
 /**
  * A global variable to determine if debugging information about the
  * hooks functions should be printed
  */ 
 APU_DECLARE_DATA extern int apr_hook_debug_enabled;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.h.in	2003-01-01 08:02:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.h.in	2003-08-18 18:43:19.000000000 +0800
@@ -110,18 +110,14 @@
 #define APU_HAVE_SDBM   @apu_have_sdbm@
 #define APU_HAVE_GDBM   @apu_have_gdbm@
 #define APU_HAVE_NDBM   @apu_have_ndbm@
 #define APU_HAVE_DB     @apu_have_db@
 
 #if APU_HAVE_DB
-#if APU_DBM_BERKELEYDB_PRIVATE 
-/* found version @apu_db_version@ */
-/* this is only required for compiling dbm/apr_dbm_berkeleydb */
-#include <@apu_db_header@>
-#endif
-#endif
+#define APU_HAVE_DB_VERSION    @apu_db_version@
+#endif /* APU_HAVE_DB */
 
 #define APU_HAVE_APR_ICONV     0
 #define APU_HAVE_ICONV         @have_iconv@
 #define APR_HAS_XLATE          (APU_HAVE_APR_ICONV || APU_HAVE_ICONV)
 
 #endif /* APU_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.hnw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.hnw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.hnw	2003-01-08 00:22:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.hnw	2003-08-18 18:43:19.000000000 +0800
@@ -112,19 +112,12 @@
  * we always have SDBM (it's in our codebase)
  */
 #define APU_HAVE_SDBM   1
 #define APU_HAVE_GDBM   0
 #define APU_HAVE_DB     0
 
-#if APU_HAVE_DB
-#if APU_DBM_BERKELEYDB_PRIVATE 
-/* this is only required for compiling dbm/apr_dbm_berkeleydb */
-/* found version @db_version@ */
-#include <db.h>
-#endif
-#endif
 
 #define HAVE_ICONV_H           1
 #define APU_HAVE_APR_ICONV     0
 #define APU_HAVE_ICONV         1
 #define APR_HAS_XLATE          (APU_HAVE_APR_ICONV || APU_HAVE_ICONV)
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.hw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.hw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu.hw	2003-01-01 08:02:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu.hw	2003-08-18 18:43:19.000000000 +0800
@@ -143,19 +143,12 @@
  * we always have SDBM (it's in our codebase)
  */
 #define APU_HAVE_SDBM   1
 #define APU_HAVE_GDBM   0
 #define APU_HAVE_DB     0
 
-#if APU_HAVE_DB
-#if APU_DBM_BERKELEYDB_PRIVATE 
-/* this is only required for compiling dbm/apr_dbm_berkeleydb */
-/* win32 note.. you will need to change this for db1 */
-#include <db.h>
-#endif
-#endif
 
 #define APU_HAVE_APR_ICONV     1
 #define APU_HAVE_ICONV         0
 #define APR_HAS_XLATE          (APU_HAVE_APR_ICONV || APU_HAVE_ICONV)
 
 #endif /* APU_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu_version.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu_version.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/apu_version.h	2003-03-31 14:06:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/apu_version.h	2003-09-26 13:31:43.000000000 +0800
@@ -98,13 +98,13 @@
  * Minor API changes that do not cause binary compatibility problems.
  * Should be reset to 0 when upgrading APU_MAJOR_VERSION
  */
 #define APU_MINOR_VERSION       9
 
 /** patch level */
-#define APU_PATCH_VERSION       4
+#define APU_PATCH_VERSION       5
 
 /** 
  *  This symbol is defined for internal, "development" copies of APU. This
  *  symbol will be #undef'd for releases. 
  */
 #define APU_IS_DEV_VERSION
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include: apu_want.h.in
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include: apu_want.hnw
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include: apu_want.hw
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/private/apu_config.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/private/apu_config.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/include/private/apu_config.h.in	2003-07-07 22:51:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/include/private/apu_config.h.in	2003-10-25 01:51:10.000000000 +0800
@@ -36,15 +36,12 @@
 /* Define to 1 if you have the <ldap.h> header file. */
 #undef HAVE_LDAP_H
 
 /* Define to 1 if you have the <ldap_ssl.h> header file. */
 #undef HAVE_LDAP_SSL_H
 
-/* Define to 1 if you have the `db' library (-ldb). */
-#undef HAVE_LIBDB
-
 /* Define to 1 if you have the `lber' library (-llber). */
 #undef HAVE_LIBLBER
 
 /* Define to 1 if you have the <memory.h> header file. */
 #undef HAVE_MEMORY_H
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/libaprutil.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/libaprutil.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/libaprutil.dsp	2003-03-29 06:35:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/libaprutil.dsp	2003-08-18 18:43:19.000000000 +0800
@@ -375,12 +375,47 @@
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apu_want.h.in
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apu_want.hnw
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apu_want.hw
+
+!IF  "$(CFG)" == "libaprutil - Win32 Release"
+
+# Begin Custom Build - Creating apu_want.h from apu_want.hw
+InputPath=.\include\apu_want.hw
+
+".\include\apu_want.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apu_want.hw > .\include\apu_want.h
+
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
+
+# Begin Custom Build - Creating apu_want.h from apu_want.hw
+InputPath=.\include\apu_want.hw
+
+".\include\apu_want.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apu_want.hw > .\include\apu_want.h
+
+# End Custom Build
+
+!ENDIF 
+
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_config.h.in
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\private\apu_config.hw
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/misc/apr_reslist.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/misc/apr_reslist.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/srclib/apr-util/misc/apr_reslist.c	2003-01-01 08:02:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/srclib/apr-util/misc/apr_reslist.c	2003-09-18 14:23:50.000000000 +0800
@@ -283,13 +283,13 @@
 {
     apr_status_t rv;
     apr_reslist_t *rl;
 
     /* Do some sanity checks so we don't thrash around in the
      * maintenance routine later. */
-    if (min >= smax || min >= hmax || smax > hmax || ttl < 0) {
+    if (min > smax || min > hmax || smax > hmax || ttl < 0) {
         return APR_EINVAL;
     }
 
     rl = apr_pcalloc(pool, sizeof(*rl));
     rl->pool = pool;
     rl->min = min;
@@ -365,12 +365,18 @@
     }
     /* Otherwise the reason we dropped out of the loop
      * was because there is a new slot available, so create
      * a resource to fill the slot and use it. */
     else {
         rv = create_resource(reslist, &res);
+
+        if (rv != APR_SUCCESS) {
+           apr_thread_mutex_unlock(reslist->listlock);
+           return rv;
+        }
+
         reslist->ntotal++;
         *resource = res->opaque;
         free_container(reslist, res);
         apr_thread_mutex_unlock(reslist->listlock);
         return APR_SUCCESS;
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/support/ab.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/support/ab.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/support/ab.c	2003-02-04 01:32:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/support/ab.c	2003-09-15 23:40:06.000000000 +0800
@@ -1253,13 +1253,13 @@
     if ((rv = apr_connect(c->aprsock, destsa)) != APR_SUCCESS) {
 	if (APR_STATUS_IS_EINPROGRESS(rv)) {
             apr_pollfd_t new_pollfd;
 	    c->state = STATE_CONNECTING;
 	    c->rwrite = 0;
             new_pollfd.desc_type = APR_POLL_SOCKET;
-            new_pollfd.reqevents = APR_POLLIN;
+            new_pollfd.reqevents = APR_POLLOUT | APR_POLLIN;
             new_pollfd.desc.s = c->aprsock;
             new_pollfd.client_data = c;
 	    apr_pollset_add(readbits, &new_pollfd);
 	    return;
 	}
 	else {
@@ -1472,14 +1472,20 @@
 	     * needs to be extended to handle whatever servers folks want to
 	     * test against. -djg
 	     */
 
 	    /* check response code */
 	    part = strstr(c->cbuff, "HTTP");	/* really HTTP/1.x_ */
-	    strncpy(respcode, (part + strlen("HTTP/1.x_")), 3);
-	    respcode[3] = '\0';
+            if (part && strlen(part) > strlen("HTTP/1.x_")) {
+                strncpy(respcode, (part + strlen("HTTP/1.x_")), 3);
+                respcode[3] = '\0';
+            }
+            else {
+                strcpy(respcode, "500");
+            }
+
 	    if (respcode[0] != '2') {
 		err_response++;
 		if (verbosity >= 2)
 		    printf("WARNING: Response code not 2xx (%s)\n", respcode);
 	    }
 	    else if (verbosity >= 3) {
@@ -1768,20 +1774,20 @@
 /* ------------------------------------------------------- */
 
 /* display copyright information */
 static void copyright(void)
 {
     if (!use_html) {
-	printf("This is ApacheBench, Version %s\n", AP_AB_BASEREVISION " <$Revision: 1.121.2.1 $> apache-2.0");
+	printf("This is ApacheBench, Version %s\n", AP_AB_BASEREVISION " <$Revision: 1.121.2.4 $> apache-2.0");
 	printf("Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\n");
 	printf("Copyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/\n");
 	printf("\n");
     }
     else {
 	printf("<p>\n");
-	printf(" This is ApacheBench, Version %s <i>&lt;%s&gt;</i> apache-2.0<br>\n", AP_AB_BASEREVISION, "$Revision: 1.121.2.1 $");
+	printf(" This is ApacheBench, Version %s <i>&lt;%s&gt;</i> apache-2.0<br>\n", AP_AB_BASEREVISION, "$Revision: 1.121.2.4 $");
 	printf(" Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/<br>\n");
 	printf(" Copyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/<br>\n");
 	printf("</p>\n<p>\n");
     }
 }
 
@@ -2061,24 +2067,30 @@
 	    /*
 	     * assume username passwd already to be in colon separated form.
 	     * Ready to be uu-encoded.
 	     */
 	    while (apr_isspace(*optarg))
 		optarg++;
+            if (apr_base64_encode_len(strlen(optarg)) > sizeof(tmp)) {
+                err("Authentication credentials too long\n");
+            }
 	    l = apr_base64_encode(tmp, optarg, strlen(optarg));
 	    tmp[l] = '\0';
 
             auth = apr_pstrcat(cntxt, auth, "Authorization: Basic ", tmp,
                                "\r\n", NULL);
 	    break;
 	case 'P':
 	    /*
              * assume username passwd already to be in colon separated form.
              */
 	    while (apr_isspace(*optarg))
 		optarg++;
+            if (apr_base64_encode_len(strlen(optarg)) > sizeof(tmp)) {
+                err("Proxy credentials too long\n");
+            }
 	    l = apr_base64_encode(tmp, optarg, strlen(optarg));
 	    tmp[l] = '\0';
 
             auth = apr_pstrcat(cntxt, auth, "Proxy-Authorization: Basic ",
                                tmp, "\r\n", NULL);
 	    break;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/support/suexec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/support/suexec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.47/support/suexec.c	2003-02-23 01:44:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.48/support/suexec.c	2003-07-24 05:53:42.000000000 +0800
@@ -156,12 +156,13 @@
     "REMOTE_ADDR=",
     "REMOTE_HOST=",
     "REMOTE_IDENT=",
     "REMOTE_PORT=",
     "REMOTE_USER=",
     "REDIRECT_QUERY_STRING=",
+    "REDIRECT_REMOTE_USER=",
     "REDIRECT_STATUS=",
     "REDIRECT_URL=",
     "REQUEST_METHOD=",
     "REQUEST_URI=",
     "SCRIPT_FILENAME=",
     "SCRIPT_NAME=",
