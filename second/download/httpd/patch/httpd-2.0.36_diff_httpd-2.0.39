diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/acinclude.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/acinclude.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/acinclude.m4	2002-04-19 01:29:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/acinclude.m4	2002-05-14 15:51:52.000000000 +0800
@@ -17,32 +17,12 @@
 dnl APACHE_FAST_OUTPUT(FILENAME)
 dnl Perform substitutions on FILENAME (Makefiles only)
 AC_DEFUN(APACHE_FAST_OUTPUT,[
   APACHE_FAST_OUTPUT_FILES="$APACHE_FAST_OUTPUT_FILES $1"
 ])
 
-dnl APACHE_MKDIR_P_CHECK
-dnl checks whether mkdir -p works
-AC_DEFUN(APACHE_MKDIR_P_CHECK,[
-  AC_CACHE_CHECK(for working mkdir -p, ac_cv_mkdir_p,[
-    test -d conftestdir && rm -rf conftestdir
-    mkdir -p conftestdir/somedir >/dev/null 2>&1
-    if test -d conftestdir/somedir; then
-      ac_cv_mkdir_p=yes
-    else
-      ac_cv_mkdir_p=no
-    fi
-    rm -rf conftestdir
-  ])
-  if test "$ac_cv_mkdir_p" = "yes"; then
-      mkdir_p="mkdir -p"
-  else
-      mkdir_p="$top_srcdir/build/mkdir.sh"
-  fi
-])
-
 dnl APACHE_GEN_CONFIG_VARS
 dnl Creates config_vars.mk
 AC_DEFUN(APACHE_GEN_CONFIG_VARS,[
   APACHE_SUBST(abs_srcdir)
   APACHE_SUBST(bindir)
   APACHE_SUBST(sbindir)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Apache.dsw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Apache.dsw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Apache.dsw	2002-05-01 23:23:13.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Apache.dsw	2002-05-15 08:15:44.000000000 +0800
@@ -300,16 +300,13 @@
 {{{
 }}}
 
 Package=<4>
 {{{
     Begin Project Dependency
-    Project_Dep_Name apr
-    End Project Dependency
-    Begin Project Dependency
-    Project_Dep_Name aprutil
+    Project_Dep_Name libapr
     End Project Dependency
 }}}
 
 ###############################################################################
 
 Project: "gen_uri_delims"=".\srclib\apr-util\uri\gen_uri_delims.dsp" - Package Owner=<4>
@@ -747,13 +744,13 @@
     Project_Dep_Name mod_dav
     End Project Dependency
 }}}
 
 ###############################################################################
 
-Project: "mod_deflate"=".\modules\experimental\mod_deflate.dsp" - Package Owner=<4>
+Project: "mod_deflate"=".\modules\filters\mod_deflate.dsp" - Package Owner=<4>
 
 Package=<5>
 {{{
 }}}
 
 Package=<4>
Binary files /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/apachenw.mcp.zip and /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/apachenw.mcp.zip differ
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: autom4te.cache
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/binbuild.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/binbuild.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/binbuild.sh	2002-02-08 07:01:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/binbuild.sh	2002-05-17 22:49:31.000000000 +0800
@@ -9,13 +9,13 @@
 OS=`./srclib/apr/build/config.guess`
 BUILD_DIR="`pwd`/bindist"
 DEFAULT_DIR="/usr/local/apache2"
 APDIR=`pwd`
 APDIR=`basename $APDIR`
 APFULLDIR=`pwd`
-CONFIGPARAM="--with-layout=BinaryDistribution --prefix=$BUILD_DIR --enable-mods-shared=most --with-expat=$APFULLDIR/srclib/apr-util/xml/expat --enable-static-support"
+CONFIGPARAM="--enable-layout=Apache --prefix=$BUILD_DIR --enable-mods-shared=most --with-expat=$APFULLDIR/srclib/apr-util/xml/expat --enable-static-support"
 VER=`echo $APDIR |sed s/httpd-//`
 TAR="`srclib/apr/build/PrintPath tar`"
 GTAR="`srclib/apr/build/PrintPath gtar`"
 GZIP="`srclib/apr/build/PrintPath gzip`"
 
 if [ x$1 != x ]; then
@@ -136,13 +136,12 @@
     -e "s%#ServerName.*%#ServerName localhost%" \
     bindist/conf/httpd-std.conf > bindist/conf/httpd.conf
 cp bindist/conf/httpd.conf bindist/conf/httpd-std.conf
 
 for one_file in apachectl envvars envvars-std; do
     sed -e "s%$BUILD_DIR%$DEFAULT_DIR%" \
-        -e "s%^#binbuild %%" \
         bindist/bin/$one_file > bindist/bin/$one_file.tmp
     mv bindist/bin/$one_file.tmp bindist/bin/$one_file
 done
 
 echo "Creating distribution archive and readme file..."
  
@@ -155,13 +154,13 @@
   then
     $GTAR -zcf ../httpd-$VER-$OS.tar.gz -C .. httpd-$VER
   else
     if [ "x$TAR" != "x" ]
     then
       case "x$OS" in
-        x*390*) $TAR -cfU ../httpd-$VER-$OS.tar -C .. httpd-$VER;;
+        x*os390*) $TAR -cfU ../httpd-$VER-$OS.tar -C .. httpd-$VER;;
 	    *) (cd .. && $TAR -cf httpd-$VER-$OS.tar httpd-$VER);;
       esac
       if [ "x$GZIP" != "x" ]
       then
         $GZIP ../httpd-$VER-$OS.tar
       fi
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build: config_vars.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/install-bindist.sh.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/install-bindist.sh.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/install-bindist.sh.in	2002-04-27 02:56:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/install-bindist.sh.in	2002-06-14 02:46:28.000000000 +0800
@@ -51,13 +51,13 @@
 perls='perl5 perl'
 path=`echo $PATH | sed -e 's/:/ /g'`
  
 for dir in ${path} ;  do
   for pperl in ${perls} ; do
     if test -f "${dir}/${pperl}" ; then
-      if `${dir}/${pperl} -v | grep 'version 5\.' >/dev/null 2>&1` ; then
+      if `${dir}/${pperl} -v >/dev/null 2>&1` ; then
         PERL="${dir}/${pperl}"
         break
       fi
     fi
   done
 done
@@ -71,14 +71,13 @@
 echo "Installing binary distribution for platform @os@"
 echo "into directory $SR ..."
 lmkdir $SR 755
 lmkdir $SR/proxy 750
 lmkdir $SR/logs 755
 lmkdir $SR/build 755
-cp -p bindist/build/libtool $SR/build
-cp -p bindist/build/instdso.sh $SR/build
+lcopy bindist/build $SR/build 750 750
 lcopy bindist/man $SR/man 755 644
 if [ -d bindist/modules ]
 then
   lcopy bindist/modules $SR/modules 750 750
 fi
 lcopy bindist/include $SR/include 755 644
@@ -118,17 +117,17 @@
 then
   echo "[Preserving existing error documents directory.]"
 else
   lcopy bindist/error $SR/error 755 644
 fi
  
-sed -e "s;^#!\@perlbin\@.*;#!$PERL;" -e "s;\@prefix\@;$SR;" \
+sed -e "s;^#!\@perlbin\@.*;#!$PERL;" -e "s;\@exp_installbuilddir\@;$SR/build;" \
 	support/apxs.in > $SR/bin/apxs
-PRE=`grep "^prefix = " build/config_vars.mk`
+PRE=`grep "^prefix = " bindist/build/config_vars.mk`
 PRE=`echo $PRE | sed -e "s;prefix = ;;"`
-sed -e "s;$PRE;$SR;" build/config_vars.mk > $SR/build/config_vars.mk
+sed -e "s;$PRE;$SR;" bindist/build/config_vars.mk > $SR/build/config_vars.mk
 sed -e "s;^#!/.*;#!$PERL;" bindist/bin/dbmmanage > $SR/bin/dbmmanage
 sed -e "s%@default_dir@%$SR%" \
         -e "s%^HTTPD=.*$%HTTPD=\"$SR/bin/httpd -d $SR\"%" bindist/bin/apachectl > $SR/bin/apachectl
 sed -e "s%@default_dir@%$SR%" \
         bindist/bin/envvars-std > $SR/bin/envvars-std
 if [ $HAD_ENVVARS = no ]
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/instdso.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/instdso.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/instdso.sh	2002-04-19 22:04:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/instdso.sh	2002-06-16 15:43:14.000000000 +0800
@@ -13,14 +13,15 @@
     echo "Usage: instdso.sh SH_LIBTOOL-value dso-name path-to-modules"
     exit 1
 fi
 
 SH_LIBTOOL=`echo $1 | sed -e 's/^SH_LIBTOOL=//'`
 DSOARCHIVE=$2
+DSOARCHIVE_BASENAME=`basename $2`
 TARGETDIR=$3
-DSOBASE=`echo $DSOARCHIVE | sed -e 's/\.la$//'`
+DSOBASE=`echo $DSOARCHIVE_BASENAME | sed -e 's/\.la$//'`
 TARGET_NAME="$DSOBASE.so"
 
 SYS=`uname -s`
 
 if test "$SYS" = "AIX"
 then
@@ -33,14 +34,22 @@
 fi
 
 CMD="$SH_LIBTOOL --mode=install cp $DSOARCHIVE $TARGETDIR/"
 echo $CMD
 $CMD || exit $?
 
-DLNAME=`grep "^dlname" $TARGETDIR/$DSOARCHIVE | sed -e "s/dlname='\([^']*\)'/\1/"`
-LIBRARY_NAMES=`grep "library_names" $TARGETDIR/$DSOARCHIVE | sed -e "s/dlname='\([^']*\)'/\1/"`
+if test "$SYS" = "OS/2"
+then
+    # on OS/2, aplibtool --install doesn't copy the .la files & we can't
+    # rename DLLs to have a .so extension or they won't load so none of the 
+    # steps below make sense.
+    exit 0
+fi
+
+DLNAME=`grep "^dlname" $TARGETDIR/$DSOARCHIVE_BASENAME | sed -e "s/dlname='\([^']*\)'/\1/"`
+LIBRARY_NAMES=`grep "library_names" $TARGETDIR/$DSOARCHIVE_BASENAME | sed -e "s/dlname='\([^']*\)'/\1/"`
 LIBRARY_NAMES=`echo $LIBRARY_NAMES | sed -e "s/ *$DLNAME//g"`
 
 if test -n "$LIBRARY_NAMES"
 then
     for f in $LIBRARY_NAMES
     do
@@ -50,12 +59,12 @@
 
 if test "$DLNAME" != "$TARGET_NAME"
 then
     mv $TARGETDIR/$DLNAME $TARGETDIR/$TARGET_NAME
 fi
 
-rm -f $TARGETDIR/$DSOARCHIVE
+rm -f $TARGETDIR/$DSOARCHIVE_BASENAME
 rm -f $TARGETDIR/$DSOBASE.a
 rm -f $TARGETDIR/lib$DSOBASE.a
 rm -f $TARGETDIR/lib$TARGET_NAME
 
 exit 0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/mkconfNW.awk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/mkconfNW.awk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/mkconfNW.awk	2002-04-24 07:32:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/mkconfNW.awk	2002-06-01 01:52:51.000000000 +0800
@@ -16,12 +16,13 @@
 
     B["htdocsdir"] = A["ServerRoot"]"/"A["htdocsdir"]
     B["iconsdir"] = A["ServerRoot"]"/"A["iconsdir"]
     B["manualdir"] = A["ServerRoot"]"/"A["manualdir"]
     B["errordir"] = A["ServerRoot"]"/"A["errordir"]
     B["proxycachedir"] = A["ServerRoot"]"/"A["proxycachedir"]
+    B["cgidir"] = A["ServerRoot"]"/"A["cgidir"]
 }
 
 /@@LoadModule@@/ {
     print "#LoadModule auth_anon_module modules/authanon.nlm"
     print "#LoadModule auth_dbm_module modules/authdbm.nlm"
     print "#LoadModule auth_digest_module modules/digest.nlm"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/NWGNUenvironment.inc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/NWGNUenvironment.inc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/NWGNUenvironment.inc	2002-04-29 23:10:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/NWGNUenvironment.inc	2002-06-12 02:26:21.000000000 +0800
@@ -175,44 +175,32 @@
 ifeq (\, $(findstring \,$(INSTALL)))
 INSTDIRS = $(dest)
 endif
 endif
 
 ifndef INSTALL
-INSTALL = $(AP_WORK)\..\Dist
-INSTDIRS = $(AP_WORK)\..\Dist
+INSTALL = $(AP_WORK)\Dist
+INSTDIRS = $(AP_WORK)\Dist
 endif
 
 INSTDEVDIRS := \
     $(INSTDIRS) \
 	$(INSTALL)\Apache2\include \
 	$(INSTALL)\Apache2\lib \
 
 INSTDIRS += \
 	$(INSTALL)\Apache2 \
+	$(INSTALL)\Apache2\bin \
 	$(INSTALL)\Apache2\cgi-bin \
 	$(INSTALL)\Apache2\conf \
 	$(INSTALL)\Apache2\error \
-	$(INSTALL)\Apache2\error\include \
 	$(INSTALL)\Apache2\htdocs \
 	$(INSTALL)\Apache2\icons \
-	$(INSTALL)\Apache2\icons\small \
 	$(INSTALL)\Apache2\logs \
 	$(INSTALL)\Apache2\man \
 	$(INSTALL)\Apache2\manual \
-	$(INSTALL)\Apache2\manual\developer \
-	$(INSTALL)\Apache2\manual\faq \
-	$(INSTALL)\Apache2\manual\howto \
-	$(INSTALL)\Apache2\manual\images \
-	$(INSTALL)\Apache2\manual\misc \
-	$(INSTALL)\Apache2\manual\mod \
-	$(INSTALL)\Apache2\manual\platform \
-	$(INSTALL)\Apache2\manual\programs \
-	$(INSTALL)\Apache2\manual\search \
-	$(INSTALL)\Apache2\manual\ssl \
-	$(INSTALL)\Apache2\manual\vhosts \
 	$(INSTALL)\Apache2\modules \
 
 #
 # Declare Command and tool macros here
 #
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build: rules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/rules.mk.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/rules.mk.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/rules.mk.in	2002-04-19 01:51:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/rules.mk.in	2002-06-16 05:48:53.000000000 +0800
@@ -51,13 +51,13 @@
 # information on the Apache Software Foundation, please see
 # <http://www.apache.org/>.
 #
 # The build environment was originally provided by Sascha Schumann.
 #
 
-include $(top_builddir)/build/config_vars.mk
+@ap_make_include@ @ap_make_delimiter@$(top_builddir)/build/config_vars.mk@ap_make_delimiter@
 
 # Combine all of the flags together in the proper order so that
 # the user-defined flags can always override the configure ones, if needed.
 # Note that includes are listed after the flags because -I options have
 # left-to-right precedence and CPPFLAGS may include user-defined overrides.
 #
@@ -194,15 +194,15 @@
 	    echo "rm -f $(EXTRACLEAN_TARGETS)"; \
 	    rm -f $(EXTRACLEAN_TARGETS) ; \
 	fi
 
 local-install: $(TARGETS) $(SHARED_TARGETS) $(INSTALL_TARGETS)
 	@if test -n '$(PROGRAMS)'; then \
-	    test -d $(sbindir) || $(MKINSTALLDIRS) $(sbindir); \
+	    test -d $(DESTDIR)$(sbindir) || $(MKINSTALLDIRS) $(DESTDIR)$(sbindir); \
 	    list='$(PROGRAMS)'; for i in $$list; do \
-	        $(INSTALL_PROGRAM) $$i $(sbindir); \
+	        $(INSTALL_PROGRAM) $$i $(DESTDIR)$(sbindir); \
 	    done; \
 	fi
 
 # to be filled in by the actual Makefile if extra commands are needed
 x-local-depend x-local-clean x-local-distclean x-local-extraclean:
 
@@ -249,13 +249,13 @@
 .def.la:
 	$(LIBTOOL) --mode=compile $(MK_IMPLIB) -o $@ $<
 
 #
 # Dependencies
 #
-include $(builddir)/.deps
+@ap_make_include@ @ap_make_delimiter@$(builddir)/.deps@ap_make_delimiter@
 
 .PHONY: all all-recursive install-recursive local-all $(PHONY_TARGETS) \
 	shared-build shared-build-recursive local-shared-build \
 	depend depend-recursive local-depend x-local-depend \
 	clean clean-recursive local-clean x-local-clean \
 	distclean distclean-recursive local-distclean x-local-distclean \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/special.mk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/special.mk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/build/special.mk	2002-03-14 04:47:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/build/special.mk	2002-06-15 12:41:52.000000000 +0800
@@ -59,18 +59,18 @@
 include $(builddir)/modules.mk
 TARGETS = $(static)
 SHARED_TARGETS = $(shared)
 INSTALL_TARGETS = install-modules
 
 install-modules:
-	@test -d $(libexecdir) || $(MKINSTALLDIRS) $(libexecdir);
+	@test -d $(DESTDIR)$(libexecdir) || $(MKINSTALLDIRS) $(DESTDIR)$(libexecdir);
 	@builtin='$(BUILTIN_LIBS)'; \
 	has_mod_so=`echo $$builtin|sed 's/^.*mod_so.*$$/has_mod_so/'`; \
 	if [ "x$$has_mod_so" = "xhas_mod_so" ]; then \
 		list='$(shared)'; \
 		for i in $$list; do \
-			$(top_srcdir)/build/instdso.sh SH_LIBTOOL='$(SH_LIBTOOL)' $$i $(libexecdir); \
+			$(top_srcdir)/build/instdso.sh SH_LIBTOOL='$(SH_LIBTOOL)' $$i $(DESTDIR)$(libexecdir); \
 		done; \
 	fi	
 
 include $(top_builddir)/build/rules.mk
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/buildconf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/buildconf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/buildconf	2002-03-14 04:47:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/buildconf	2002-05-26 06:32:40.000000000 +0800
@@ -112,17 +112,17 @@
 (cd srclib/apr-util && ./buildconf) || {
     echo "./buildconf failed for apr-util" 
     exit 1
 }
 
 echo rebuilding $pcre_configure
-(cd srclib/pcre && autoconf)
+(cd srclib/pcre && ${AUTOCONF:-autoconf})
 
 echo rebuilding $config_h_in
 rm -f $config_h_in
-autoheader 2>&1 | grep -v "$cross_compile_warning"
+${AUTOHEADER:-autoheader} 2>&1 | grep -v "$cross_compile_warning"
 
 echo rebuilding configure
 rm -f config.cache
-autoconf 2>&1 | grep -v "$cross_compile_warning"
+${AUTOCONF:-autoconf} 2>&1 | grep -v "$cross_compile_warning"
 
 exit 0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/CHANGES	2002-05-01 18:37:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/CHANGES	2002-06-18 00:01:53.000000000 +0800
@@ -1,10 +1,325 @@
+Changes with Apache 2.0.39
+
+  *) Fixed a build problem in htpasswd.c on Win32.
+     [Guenter Knauf <eflash@gmx.net>, Cliff Woolley]
+
+Changes with Apache 2.0.38
+
+  *) Rewrite htpasswd to use APR.  The removes the annoying warning about
+     tmpnam being unsafe.   [Ryan Bloom]
+
+  *) We must set the MIME-type for .shtml files to text/html if we want them
+     to be parsed for SSI tags.  Add the config for that to the default 
+     config file so that it is easier to enable .shtml parsing.
+     [Dave Dyer <ddyer@real-me.net>]
+
+  *) Fixed a problem with 'make install' on ReliantUnix.
+     [Jean-frederic Clere <jfrederic.clere@fujitsu-siemens.com>]
+
+  *) Make the default_handler catch all requests that aren't served by
+     another handler.  This also gets us to return a 404 if a directory
+     is requested, there is no DirectoryIndex, and mod_autoindex isn't
+     loaded.  [Justin Erenkrantz]
+
+  *) Fixed the handling of nested if-statements in shtml files.
+     PR 9866  [Brian Pane]
+
+  *) Allow 'make install DESTDIR=/path'.  This allows packagers to install
+     into a directory different from the one that was configured.  This 
+     also mirrors the root= feature from 1.3.  We cannot use prefix=,
+     because both APR and APR-util resolve their installation paths at 
+     configuration time.  This means that there is no variable prefix 
+     to replace.  [Andreas Hasenack <andreas@netbank.com.br>]
+
+  *) AIX 4.3.2 and above: Define SINGLE_LISTEN_UNSERIALIZED_ACCEPT.
+     These levels of AIX don't have a thundering herd problem with
+     accept().  [Jeff Trawick]
+
+  *) prefork MPM: Ignore mutex errors during graceful restart.  For
+     certain types of mutexes (particularly SysV semaphores), we
+     should expect to occasionally fail to obtain or release the
+     mutex during restart processing.  [Jeff Trawick]
+
+  *) Fix install-bindist.sh so that it finds any perl instead of just
+     early perl 5.x versions.  This is consistent with a build/install
+     from source, and it allows the perl scripts installed by a bindist 
+     to work on systems with perl 5.6.  [Jeff Trawick]
+
+  *) Fix apxs so that the makefile created by "apxs -g" works on AIX and
+     Tru64 (and probably some other platforms).  [Jeff Trawick]
+
+  *) Allow CGI scripts to return their Content-Length.  This also fixes a
+     hang on HEAD requests seen on certain platforms (such as FreeBSD).
+     [Justin Erenkrantz]
+
+  *) Added log rotation based on file size to the RotateLog support
+     utility. [Brad Nicholes]
+
+  *) Fix some casting in mod_rewrite which broke random maps.
+     PR 9770  [Allan Edwards, Greg Ames, Jeff Trawick]
+
 Changes with Apache 2.0.37
 
+  *) allow POST method over SSL when per-directory client cert
+     authentication is used with 'SSLOptions +OptRenegotiate' enabled
+     and a client cert was found in the ssl session cache.
+
+  *) 'SSLOptions +OptRengotiate' will use client cert in from the ssl
+     session cache when there is no cert chain in the cache.  prior to
+     the fix this situation would result in a FORBIDDEN response and
+     error message "Cannot find peer certificate chain"
+     [Doug MacEachern]
+
+  *) ap_finalize_sub_req_protocol() shouldn't send an EOS bucket if
+     one was already sent.  PR 9644  [Jeff Trawick]
+
+  *) Fix the display of the default name for the mime types config
+     file.  PR 9729  [Matthew Brecknell <mbrecknell@orchestream.com>]
+
+  *) Fix the working directory *for WinNT/2K/XP services only* to
+     change to the Apache directory (one level above the location 
+     of Apache.exe, in the case that Apache.exe resides in bin/.)
+     Solves the case of ServerRoot /foo paths where /foo was not
+     on the same drive as /winnt/system32.  [William Rowe]
+
+  *) Make 2.0's "AcceptMutex" startup message now "completely"
+     match how 1.3 does it. [Jim Jagielski]
+
+  *) Implement a fixed size memory cache using a priority queue
+     [Ian Holsman]
+
+  *) Fix apxs to allow "apxs -q installbuilddir" and to allow
+     querying certain other variables from config_vars.mk.  PR 9316  
+     [Jeff Trawick]
+
+  *) Added the "detached" attribute to the cgi_exec_info_t internals
+     so that Win32 and Netware won't create a new window or console
+     for each CGI invoked.  PR 8387
+     [Brad Nicholes, William Rowe]
+
+  *) Consolidated the command line parameters and attributes that are 
+     manipulated by the optional function ap_cgi_build_command() in
+     mod_cgi into a single structure.
+     [Brad Nicholes]
+
+  *) Get rid of uninitialized value errors with "apxs -q" on certain
+     variables.  [Stas Bekman <stas@stason.org>]
+
+  *) Fix apxs to allow it to work when the build directory is somewhere
+     besides server-root/build.  PR 8453  
+     [Jeff Trawick and a host of others]
+
+  *) Allow ap_discard_request_body to be called multiple times in the
+     same request.  Essentially, ap_http_filter keeps track of whether
+     it has sent an EOS bucket up the stack, if so, it will only ever
+     send an EOS bucket for this request.  
+     [Ryan Bloom, Justin Erenkrantz, Greg Stein]
+
+  *) Remove all special mod_ssl URIs.  This also fixes the bug where
+     redirecting (.*) will allow an SSL protected page to be viewed
+     without SSL.  [Ryan Bloom]
+
+  *) Fix the binary build install script so that the build logic
+     created by "apxs -g" will work when the user has a binary
+     build.  [Jeff Trawick]
+
+  *) Allow instdso.sh to work with full paths to the shared module.
+     [Justin Erenkrantz]
+
+  *) NetWare: Enabled CGI functionality and added mod_cgi as a built
+     in module for NetWare  [Brad Nicholes]
+
+  *) Changed cgi and piped log behavior to accept 65536 characters
+     on Win32 (matching Linux) before deadlocking between outputing
+     client stdin, slurping the output from stdout and then the stderr
+     stream.  PR 8179  [William Rowe]
+
+  *) Fixed Win32 wintty.exe support to assure the window title is valid.
+     Elimiates possible gpfault or garbage title without the -t option.
+     [William Rowe]
+
+  *) Rewrite mod_cgi, mod_cgid, and mod_proxy input handling to use
+     brigades and input filters.  [Justin Erenkrantz]
+
+  *) Allow ap_http_filter (HTTP_IN) to return EOS when there is no request
+     body.  [Justin Erenkrantz]
+    
+  *) NetWare: Piping log entries through RotateLogs using the 
+     CustomLogs directive is finally supported now that we have 
+     the pipes and spawning functionality working.
+     [Brad Nicholes]
+
+  *) Detect overflow when reading the hex bytes forming a chunk line.
+     [Aaron Bannert]
+
+  *) Allow RewriteMap prg:'s to take command-line arguments.  PR 8464.
+     [James Tait <JTait@wyrddreams.demon.co.uk>]
+
+  *) Correctly return 413 when an invalid chunk size is given on
+     input.  Also modify ap_discard_request_body to not do anything
+     on sub-requests or when the connection will be dropped.
+     [Justin Erenkrantz]
+
+  *) Fix the TIME_* SSL var lookups to be threadsafe.  PR 9469.
+     [Cliff Woolley]
+
+  *) Ensure that apr_brigade_write() flushes in all of the cases that
+     it should to avoid conditions in some modules that could cause
+     large amounts of data to be buffered.  [Cliff Woolley]
+
+  *) Fix problem where mod_cache/mod_disk_cache was incorrectly
+     stripping the content_type from cached responses.
+     [Bill Stoddard]
+
+  *) apachectl passes through any httpd options.  Note: apachectl
+     should be used in preference to httpd since it ensures that any
+     appropriate environment variables have been set up.
+     [Jeff Trawick]
+
+  *) Fix the combination of mod_cgid, mod_setuexec, and mod_userdir.
+     PR 7810  [Colm MacCarthaigh <colmmacc@redbrick.dcu.ie>]
+
+  *) Fix suexec execution of CGI scripts from mod_include.
+     PR 7791, 8291  [Colm MacCarthaigh <colmmacc@redbrick.dcu.ie>]
+
+  *) Fix segfaults at startup on some platforms when mod_auth_digest,
+     mod_suexec, or mod_ssl were used as DSO's due to the way they
+     were tracking the current init phase since DSO's get completely
+     unloaded and reloaded between phases.  PR 9413.
+     [Tsuyoshi Sasamoto <nazonazo@super.win.ne.jp>, Brad Nicholes]
+
+  *) Fix mod_include's handling of regular expressions in
+     "<!--#if" directives [Julius Gawlas <julius_gawlas@hp.com>]
+
+  *) Fix the worker MPM deadlock problem  [Brian Pane]
+
+  *) Modify the module documentation to allow for translations.
+     [Yoshiki Hayashi, Joshua Slive]
+
+  *) Fix a file permissions problem which prevented mod_disk_cache
+     from working on Unix.  [Jeff Trawick]
+
+  *) Add "-k start|restart|graceful|stop" support to httpd for the Unix 
+     MPMs.  These have semantics very similar to the old apachectl 
+     commands of the same name.  [Justin Erenkrantz, Jeff Trawick]
+
+  *) Make sure that the runtime dir is created by make install.
+     PR 9233.  [Jeff Trawick]
+
+  *) Fix an unusual set of ./configure arguments that could cause
+     mod_http to be built as a DSO, which it currently doesn't
+     support.  PR 9244.
+     [Cliff Woolley, Robin Johnson <robbat2@orbis-terrarum.net>]
+
+  *) Win32: Fix bug in apr_sendfile() that caused incorrect operation
+     of the %X, %b and %B logformat options. PR 8253, 8996.
+     [Bill Stoddard]
+
+  *) If content-encoding is already present, do not run deflate (PR 9222)
+     [Kazuhisa ASADA <kaz@asada.sytes.net>]
+
+  *) The APLOG_NOERRNO flag to ap_log_[r]error() is now deprecated.
+     It is currently ignored and it will be removed in a future release
+     of Apache.  [Jeff Trawick]
+
+  *) Removed documentation references to the no-longer-supported
+     "make certificate" feature of mod_ssl for Apache 1.3.x.  Test
+     certificates, if truly desired, can be generated using openssl
+     commands.  PR 8724.  [Cliff Woolley]
+
+  *) Remove SSLLog and SSLLogLevel directives in favor of having
+     mod_ssl use the standard ErrorLog directives.  [Justin Erenkrantz]
+
+  *) OS/390: LIBPATH no longer has to be manually uncommented in
+     envvars to get apachectl to set up httpd properly.  [Jeff Trawick]
+
+  *) mod_isapi: All mod_isapi directives, excluding ISAPICacheFile,
+     may now be specified to the <File/Directory > container, rather
+     than by vhost.  [William Rowe]
+
+  *) mod_isapi: Experimental support for faux async support for ISAPI
+     modules.  [William Rowe]
+
+  *) mod_isapi: Major refactoring of the code to rely on apr internals
+     rather than MS APIs (using our own mod_isapi.h headers for ISAPI
+     symbol definitions.)  [William Rowe]
+
+  *) mod_isapi: Fixed the return string length from GetServerVariable
+     callback, it was not including the trailing null in the consumed
+     buffer size.  This was particularly bad for Delphi 6.0 users.
+     PR 8934  [Sebastian Hantsch <sebastian.hantsch@gmx.de>]
+
+  *) Fixed Win32 builds for Microsoft VisualStudio 7.0 (.net).
+     [William Rowe]
+
+  *) Make apxs look in the correct directory for envvars.  It was
+     broken when sbindir != bindir.  PR 8869
+     [Andreas Sundström <sunkan@zappa.cx>]
+  
+  *) Fix mod_deflate corruption when using multiple buckets.  PR 9014.
+     [Asada Kazuhisa <kaz@asada.sytes.net>]
+
+  *) Performance enhancements for access logger when using
+     default timestamp formatting  [Brian Pane]
+
+  *) Added EnableMMAP config directive to enable the server
+     administrator to disable memory-mapping of delivered files
+     on a per-directory basis.  [Brian Pane]
+
+  *) Performance enhancements for mod_setenvif  [Brian Pane]
+
+  *) Fix a mod_ssl build problem on OS/390.  [Jeff Trawick]
+
+  *) Fixed If-Modified-Since on Win32, which would give false positives
+     because of the sub-second resolution of file timestamps on that
+     platform.  [Cliff Woolley]
+
+  *) Reverse the hook ordering for mod_userdir and mod_alias so
+     that Alias/ScriptAlias will override Userdir.  PR 8841
+     [Joshua Slive]
+
+  *) Move mod_deflate out of experimental and into filters.
+     [Justin Erenkrantz]
+
+  *) Get proxy CONNECT basically working.  [Jeff Trawick]
+
+  *) Fix mod_rewrite hang when APR uses SysV Semaphores and
+     RewriteLogLevel is set to anything other than 0.  PR: 8143
+     [Aaron Bannert, Cliff Woolley]
+
+  *) Fix byterange requests from returning 416 when using dynamic data
+     (such as filters like mod_include).  [Justin Erenkrantz]
+
+  *) Allow mod_rewrite's set of "int:" internal RewriteMap functions
+     to be extended by third-party modules via an optional function.
+     [Tahiry Ramanamampanoharana <nomentsoa@hotmail.com>, Cliff Woolley]
+
+  *) Fix mod_include expression parser's handling of unquoted strings
+     followed immediately by a closing paren.  PR 8462.  [Brian Pane]
+
+  *) Remove autom4te.cache in 'make distclean'.
+     [Thom May <thom@planetarytramp.net>]
+
+  *) Fix generated httpd.conf to respect layout for LoadModule lines.
+     PR 8170.  [Thom May <thom@planetarytramp.net>]
+
+  *) Win32: During a graceful restart, threads in the new process
+     were accessing scoreboard slots still in use by active threads in 
+     the the old process. [Bill Stoddard]
+
 Changes with Apache 2.0.36
 
+  *) Fix some minor formatting issues with ab. Part of this is
+     in reference to PR 8544, the rest I noticed while testing
+     the PR fix. [Paul J. Reder]
+
+  *) Fix a case where an invalid pass phrase is entered and an
+     error message is given, but the prompt is not shown again.
+     This left the user in an ambiguous state. PR 8320 [Paul J. Reder]
+
   *) Close sockets on worker MPM when doing a graceless restart.
      [Aaron Bannert]
 
   *) Reverted a minor optimization in mod_ssl.c that used the vhost ID
      as the session id context rather that a MD5 hash of that vhost ID,
      because it caused very long vhost id's to be unusable with mod_ssl.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/config.layout /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/config.layout
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/config.layout	2002-04-16 13:57:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/config.layout	2002-05-17 22:49:30.000000000 +0800
@@ -1,12 +1,12 @@
 ##
 ##  config.layout -- Pre-defined Installation Path Layouts
 ##
 ##  Hints:
-##  - layouts can be loaded with configure's --with-layout=ID option
-##  - when no --with-layout option is given, the default layout is `Apache'
+##  - layouts can be loaded with configure's --enable-layout=ID option
+##  - when no --enable-layout option is given, the default layout is `Apache'
 ##  - a trailing plus character (`+') on paths is replaced with a 
 ##    `/<target>' suffix where <target> is currently hardcoded to 'apache2'.
 ##    (This may become a configurable parameter at some point.)
 ##
 
 #   Classical Apache path layout.
@@ -55,36 +55,12 @@
     localstatedir: ${prefix}/var+
     runtimedir:    ${localstatedir}/run
     logfiledir:    ${localstatedir}/log
     proxycachedir: ${localstatedir}/proxy
 </Layout>
 
-#   Apache binary distribution path layout
-<Layout BinaryDistribution>
-    prefix:        /usr/local/apache
-    exec_prefix:
-    bindir:        bin
-    sbindir:       bin
-    libdir:        lib
-    libexecdir:    libexec
-    mandir:        man
-    sysconfdir:    conf
-    datadir:
-    installbuilddir: build
-    errordir:      error
-    iconsdir:      icons
-    htdocsdir:     htdocs
-    manualdir:     manual
-    cgidir:        cgi-bin
-    includedir:    include
-    localstatedir:
-    runtimedir:    logs
-    logfiledir:    logs
-    proxycachedir: proxy
-</Layout>
-
 #   Mac OS X Server (Rhapsody)
 <Layout Mac OS X Server>
     prefix:        /Local/Library/WebServer
     exec_prefix:   /usr
     bindir:        ${exec_prefix}/bin
     sbindir:       ${exec_prefix}/sbin
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: config.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: config.nice
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: config.status
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/configure	2002-05-02 04:53:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/configure	2002-06-18 11:46:43.000000000 +0800
@@ -848,14 +848,14 @@
   --enable-disk-cache     disk caching module
   --enable-mem-cache      memory caching module
   --enable-example        example and demo module
   --enable-ext-filter     external filter module
   --enable-case-filter    example uppercase conversion filter
   --enable-case-filter-in example uppercase conversion input filter
-  --enable-deflate        Deflate transfer encoding support
   --disable-include       Server Side Includes
+  --enable-deflate        Deflate transfer encoding support
   --disable-log-config    logging configuration
   --disable-env           clearing/setting of ENV vars
   --enable-mime-magic     automagically determining MIME type
   --enable-cern-meta      CERN-type meta files
   --enable-expires        Expires header control
   --enable-headers        HTTP header control
@@ -914,12 +914,15 @@
   --enable-rewrite        regex URL translation
   --enable-so             DSO capability
 
 Optional Packages:
   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --with-apr=DIR|FILE     prefix for installed APR, path to APR build tree,
+                          or the full path to apr-config
+  --with-apr-util=DIR     prefix for installed APU, or path to APU build tree
   --with-port=PORT        Port on which to listen (default is 80)
   --with-z=DIR            use a specific zlib library
   --with-ssl=DIR          SSL/TLS toolkit (OpenSSL)
   --with-mpm=MPM          Choose the process model for Apache to use.
                           MPM={beos|worker|prefork|mpmt_os2|perchild|leader|threadpool}
   --with-module=module-type:module-file
@@ -2430,12 +2441,99 @@
 
 orig_prefix="$prefix"
 
 echo $ac_n "${nl}Configuring Apache Portable Runtime library ...${nl}"
 
 
+  apr_found="no"
+
+  if test "$ac_cv_emxos2" = "yes"; then
+    # Scripts don't pass test -x on OS/2
+    TEST_X="test -f"
+  else
+    TEST_X="test -x"
+  fi
+
+  echo "$as_me:$LINENO: checking for APR" >&5
+echo $ECHO_N "checking for APR... $ECHO_C" >&6
+
+# Check whether --with-apr or --without-apr was given.
+if test "${with_apr+set}" = set; then
+  withval="$with_apr"
+
+    if test "$withval" = "no" || test "$withval" = "yes"; then
+      { { echo "$as_me:$LINENO: error: --with-apr requires a directory to be provided" >&5
+echo "$as_me: error: --with-apr requires a directory to be provided" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+
+    if $TEST_X "$withval/bin/apr-config"; then
+      apr_found="yes"
+      apr_config="$withval/bin/apr-config"
+    elif $TEST_X "$withval/apr-config"; then
+      apr_found="yes"
+      apr_config="$withval/apr-config"
+    elif $TEST_X "$withval" && $withval --help > /dev/null 2>&1 ; then
+      apr_found="yes"
+      apr_config="$withval"
+    fi
+
+        if test "$apr_found" != "yes"; then
+      { { echo "$as_me:$LINENO: error: the --with-apr parameter is incorrect. It must specify an install prefix, a
+build directory, or an apr-config file." >&5
+echo "$as_me: error: the --with-apr parameter is incorrect. It must specify an install prefix, a
+build directory, or an apr-config file." >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+
+else
+
+    if test -n "" && test "" = "1"; then
+      if apr-config --help > /dev/null 2>&1 ; then
+        apr_found="yes"
+        apr_config="apr-config"
+      else
+                for lookdir in /usr /usr/local /opt/apr /usr/local/apache2 ; do
+          if $TEST_X "$lookdir/bin/apr-config"; then
+            apr_found="yes"
+            apr_config="$lookdir/bin/apr-config"
+            break
+          fi
+        done
+      fi
+    fi
+        if test -d ""$srcdir/srclib/apr""; then
+      apr_temp_abs_srcdir="`cd "$srcdir/srclib/apr" && pwd`"
+      if test "$apr_found" = "yes" \
+         && test "`$apr_config --srcdir`" = "$apr_temp_abs_srcdir"; then
+                        apr_found="no"
+      fi
+            if test "$apr_found" = "no"; then
+        apr_found="reconfig"
+        if test -n ""./srclib/apr""; then
+          apr_config=""./srclib/apr"/apr-config"
+        else
+          apr_config=""$srcdir/srclib/apr"/apr-config"
+        fi
+      fi
+    fi
+
+fi;
+
+  echo "$as_me:$LINENO: result: $apr_found" >&5
+echo "${ECHO_T}$apr_found" >&6
+
+
+if test "$apr_found" = "no"; then
+  { { echo "$as_me:$LINENO: error: APR not found.  Please read the documentation." >&5
+echo "$as_me: error: APR not found.  Please read the documentation." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+if test "$apr_found" = "reconfig"; then
+
   # save our work to this point; this allows the sub-package to use it
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
@@ -2536,16 +2634,187 @@
   { echo "$as_me:$LINENO: creating cache $cache_file" >&5
 echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
 
+    AP_BUILD_SRCLIB_DIRS="apr $AP_BUILD_SRCLIB_DIRS"
+  AP_CLEAN_SRCLIB_DIRS="$AP_CLEAN_SRCLIB_DIRS apr"
+fi
+
+
+  if test "x$CFLAGS" = "x"; then
+    echo "  setting CFLAGS to \"`$apr_config --cflags`\""
+    CFLAGS="`$apr_config --cflags`"
+  else
+    apr_addto_bugger="`$apr_config --cflags`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $CFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to CFLAGS"
+        CFLAGS="$CFLAGS $i"
+      fi
+    done
+  fi
+
+
+  if test "x$CPPFLAGS" = "x"; then
+    echo "  setting CPPFLAGS to \"`$apr_config --cppflags`\""
+    CPPFLAGS="`$apr_config --cppflags`"
+  else
+    apr_addto_bugger="`$apr_config --cppflags`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $CPPFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to CPPFLAGS"
+        CPPFLAGS="$CPPFLAGS $i"
+      fi
+    done
+  fi
+
+
+  if test "x$LDFLAGS" = "x"; then
+    echo "  setting LDFLAGS to \"`$apr_config --ldflags`\""
+    LDFLAGS="`$apr_config --ldflags`"
+  else
+    apr_addto_bugger="`$apr_config --ldflags`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to LDFLAGS"
+        LDFLAGS="$LDFLAGS $i"
+      fi
+    done
+  fi
+
+
+  if test "x$INCLUDES" = "x"; then
+    echo "  setting INCLUDES to \"`$apr_config --includes`\""
+    INCLUDES="`$apr_config --includes`"
+  else
+    apr_addto_bugger="`$apr_config --includes`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to INCLUDES"
+        INCLUDES="$INCLUDES $i"
+      fi
+    done
+  fi
+
+SHLIBPATH_VAR=`$apr_config --shlib-path-var`
 
 echo $ac_n "${nl}Configuring Apache Portable Runtime Utility library...${nl}"
 
 
+  apu_found="no"
+
+  echo "$as_me:$LINENO: checking for APR-util" >&5
+echo $ECHO_N "checking for APR-util... $ECHO_C" >&6
+
+# Check whether --with-apr-util or --without-apr-util was given.
+if test "${with_apr_util+set}" = set; then
+  withval="$with_apr_util"
+
+    if test "$withval" = "no" || test "$withval" = "yes"; then
+      { { echo "$as_me:$LINENO: error: --with-apr-util requires a directory to be provided" >&5
+echo "$as_me: error: --with-apr-util requires a directory to be provided" >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+
+    if test -x "$withval/bin/apu-config"; then
+       apu_found="yes"
+       apu_config="$withval/bin/apu-config"
+    elif test -x "$withval/apu-config"; then
+              apu_found="yes"
+       apu_config="$withval/apu-config"
+    elif test -x "$withval" && $withval --help > /dev/null 2>&1 ; then
+       apu_found="yes"
+       apu_config="$withval"
+    fi
+
+            if test "$apu_found" != "yes"; then
+      { { echo "$as_me:$LINENO: error:
+The directory given to --with-apr-util does not specify a prefix for an
+installed APU, nor an APR-util build directory." >&5
+echo "$as_me: error:
+The directory given to --with-apr-util does not specify a prefix for an
+installed APU, nor an APR-util build directory." >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+
+else
+
+    if test -n "" && test "" = "1"; then
+      if apu-config --help > /dev/null 2>&1 ; then
+        apu_found="yes"
+        apu_config="apu-config"
+      else
+                for lookdir in /usr /usr/local /opt/apr /usr/local/apache2 ; do
+          if test -x "$lookdir/bin/apu-config"; then
+            apu_found="yes"
+            apu_config="$lookdir/bin/apu-config"
+            break
+          fi
+        done
+      fi
+    fi
+        if test -d ""$srcdir/srclib/apr-util""; then
+      apu_temp_abs_srcdir="`cd "$srcdir/srclib/apr-util" && pwd`"
+      if test "$apu_found" = "yes" \
+         && test "`$apu_config --srcdir`" = "$apu_temp_abs_srcdir"; then
+                        apu_found="no"
+      fi
+            if test "$apu_found" = "no"; then
+        apu_found="reconfig"
+        if test -n ""./srclib/apr-util""; then
+          apu_config=""./srclib/apr-util"/apu-config"
+        else
+          apu_config=""$srcdir/srclib/apr-util"/apu-config"
+        fi
+      fi
+    fi
+
+fi;
+
+  echo "$as_me:$LINENO: result: $apu_found" >&5
+echo "${ECHO_T}$apu_found" >&6
+
+
+if test "$apu_found" = "no"; then
+  { { echo "$as_me:$LINENO: error: APR-util not found.  Please read the documentation." >&5
+echo "$as_me: error: APR-util not found.  Please read the documentation." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+if test "$apu_found" = "reconfig"; then
+
   # save our work to this point; this allows the sub-package to use it
   cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
@@ -2646,12 +2915,58 @@
   { echo "$as_me:$LINENO: creating cache $cache_file" >&5
 echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
 
+    AP_BUILD_SRCLIB_DIRS="$AP_BUILD_SRCLIB_DIRS apr-util"
+  AP_CLEAN_SRCLIB_DIRS="apr-util $AP_CLEAN_SRCLIB_DIRS"
+fi
+
+
+  if test "x$LDFLAGS" = "x"; then
+    echo "  setting LDFLAGS to \"`$apu_config --ldflags`\""
+    LDFLAGS="`$apu_config --ldflags`"
+  else
+    apr_addto_bugger="`$apu_config --ldflags`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to LDFLAGS"
+        LDFLAGS="$LDFLAGS $i"
+      fi
+    done
+  fi
+
+
+  if test "x$INCLUDES" = "x"; then
+    echo "  setting INCLUDES to \"`$apu_config --includes`\""
+    INCLUDES="`$apu_config --includes`"
+  else
+    apr_addto_bugger="`$apu_config --includes`"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $INCLUDES; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to INCLUDES"
+        INCLUDES="$INCLUDES $i"
+      fi
+    done
+  fi
+
 
 echo $ac_n "${nl}Configuring PCRE regular expression library ...${nl}"
 
 
   # save our work to this point; this allows the sub-package to use it
   cat >confcache <<\_ACEOF
@@ -2759,117 +3074,24 @@
 fi
 
 
 
 echo $ac_n "${nl}Configuring Apache httpd ...${nl}"
 
-echo $ac_n "obtaining flag settings from the sub-configures...${nl}"
-. ./srclib/apr/APRVARS
-
-
-  if test "x$CFLAGS" = "x"; then
-    echo "  setting CFLAGS to \"$EXTRA_CFLAGS\""
-    CFLAGS="$EXTRA_CFLAGS"
-  else
-    apr_addto_bugger="$EXTRA_CFLAGS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $CFLAGS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to CFLAGS"
-        CFLAGS="$CFLAGS $i"
-      fi
-    done
-  fi
-
-
-  if test "x$CPPFLAGS" = "x"; then
-    echo "  setting CPPFLAGS to \"$EXTRA_CPPFLAGS\""
-    CPPFLAGS="$EXTRA_CPPFLAGS"
-  else
-    apr_addto_bugger="$EXTRA_CPPFLAGS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $CPPFLAGS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to CPPFLAGS"
-        CPPFLAGS="$CPPFLAGS $i"
-      fi
-    done
-  fi
-
-
-  if test "x$LDFLAGS" = "x"; then
-    echo "  setting LDFLAGS to \"$EXTRA_LDFLAGS\""
-    LDFLAGS="$EXTRA_LDFLAGS"
-  else
-    apr_addto_bugger="$EXTRA_LDFLAGS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LDFLAGS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LDFLAGS"
-        LDFLAGS="$LDFLAGS $i"
-      fi
-    done
-  fi
-
-
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"$EXTRA_LIBS\""
-    LIBS="$EXTRA_LIBS"
-  else
-    apr_addto_bugger="$EXTRA_LIBS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LIBS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
-      fi
-    done
-  fi
-
-EXTRA_CFLAGS=
-EXTRA_CPPFLAGS=
-EXTRA_LDFLAGS=
-EXTRA_LIBS=
-EXTRA_INCLUDES=
-
 abs_srcdir=`(cd $srcdir && pwd)`
 abs_builddir=`pwd`
 
 
 if test "$abs_builddir" != "$abs_srcdir"; then
   USE_VPATH=1
 
   if test "x$INCLUDES" = "x"; then
-    echo "  setting INCLUDES to \"-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/include -I\$(top_srcdir)/include -I\$(top_builddir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_builddir)/srclib/apr-util/include -I\$(top_srcdir)/srclib/apr-util/include\""
-    INCLUDES="-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/include -I\$(top_srcdir)/include -I\$(top_builddir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_builddir)/srclib/apr-util/include -I\$(top_srcdir)/srclib/apr-util/include"
+    echo "  setting INCLUDES to \"-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_builddir)/modules/proxy -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/modules/filters -I\$(top_srcdir)/modules/filters -I\$(top_builddir)/include -I\$(top_srcdir)/include\""
+    INCLUDES="-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_builddir)/modules/proxy -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/modules/filters -I\$(top_srcdir)/modules/filters -I\$(top_builddir)/include -I\$(top_srcdir)/include"
   else
-    apr_addto_bugger="-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/include -I\$(top_srcdir)/include -I\$(top_builddir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_builddir)/srclib/apr-util/include -I\$(top_srcdir)/srclib/apr-util/include"
+    apr_addto_bugger="-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_builddir)/modules/proxy -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/modules/filters -I\$(top_srcdir)/modules/filters -I\$(top_builddir)/include -I\$(top_srcdir)/include"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
       for j in $INCLUDES; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
@@ -2882,16 +3104,16 @@
     done
   fi
 
 else
 
   if test "x$INCLUDES" = "x"; then
-    echo "  setting INCLUDES to \"-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr-util/include\""
-    INCLUDES="-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr-util/include"
+    echo "  setting INCLUDES to \"-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/filters -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include\""
+    INCLUDES="-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/filters -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include"
   else
-    apr_addto_bugger="-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr-util/include"
+    apr_addto_bugger="-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/filters -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
       for j in $INCLUDES; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
@@ -2924,14 +3146,15 @@
       LTCFLAGS=""
       ;;
   *)
       if test "x$LTFLAGS" = "x"; then
           LTFLAGS='--silent'
       fi
-      LIBTOOL='$(SHELL) $(top_builddir)/srclib/apr/libtool $(LTFLAGS)'
-      libtoolversion=`$abs_builddir/srclib/apr/libtool --version`
+      my_libtool=`$apr_config --apr-libtool`
+      LIBTOOL="$my_libtool \$(LTFLAGS)"
+      libtoolversion=`$my_libtool --version`
       case $libtoolversion in
           *1.4*)
               SH_LIBTOOL='$(LIBTOOL)'
               SHLTCFLAGS="-prefer-pic"
               LTCFLAGS="-prefer-non-pic -static"
               ;;
@@ -3026,12 +3249,21 @@
 
 
   echo "  forcing SINGLE_LISTEN_UNSERIALIZED_ACCEPT to \"1\""
   SINGLE_LISTEN_UNSERIALIZED_ACCEPT="1"
 
       ;;
+  *aix*)
+      aixver=`echo $host | sed 's/^[^0-9]*//' | sed 's/\.//g'`
+      if test $aixver -ge 4320; then
+
+  echo "  forcing SINGLE_LISTEN_UNSERIALIZED_ACCEPT to \"1\""
+  SINGLE_LISTEN_UNSERIALIZED_ACCEPT="1"
+
+      fi
+      ;;
 esac
 
 
 
 # Extract the first word of "rm", so it can be a program name with args.
 set dummy rm; ac_word=$2
@@ -6480,12 +6712,13 @@
 
   fi
 
 fi
 
 cache_objs="mod_cache.lo cache_storage.lo cache_util.lo "
+mem_cache_objs="mod_mem_cache.lo cache_cache.lo cache_pqueue.lo cache_hash.lo "
 
   echo "$as_me:$LINENO: checking whether to enable mod_cache" >&5
 echo $ECHO_N "checking whether to enable mod_cache... $ECHO_C" >&6
     # Check whether --enable-cache or --disable-cache was given.
 if test "${enable_cache+set}" = set; then
   enableval="$enable_cache"
@@ -6709,16 +6942,16 @@
       if test "mem_cache" = "so"; then
           sharedobjs=yes
       fi
       shared="";;
     esac
 
-  if test -z ""; then
+  if test -z "$mem_cache_objs"; then
     objects="mod_mem_cache.lo"
   else
-    objects=""
+    objects="$mem_cache_objs"
   fi
 
   if test -z "$module_standalone"; then
     if test -z "$shared"; then
       libname="mod_mem_cache.la"
       BUILTIN_LIBS="$BUILTIN_LIBS $modpath_current/$libname"
@@ -7021,62 +7254,174 @@
     enable_case_filter_in=$module_default
     _apmod_extra_msg=" ($module_selection)"
   elif test "$enable_case_filter_in" = "most"; then
     if test "$module_selection" = "most" -o "$module_selection" = "all"; then
       enable_case_filter_in=$module_default
       _apmod_extra_msg=" ($module_selection)"
-    elif test "$enable_case_filter_in" != "yes"; then
-      enable_case_filter_in=no
+    elif test "$enable_case_filter_in" != "yes"; then
+      enable_case_filter_in=no
+    fi
+  elif test "$enable_case_filter_in" = "maybe-all"; then
+    if test "$module_selection" = "all"; then
+      enable_case_filter_in=$module_default
+      _apmod_extra_msg=" (all)"
+    else
+      enable_case_filter_in=no
+    fi
+  fi
+  if test "$enable_case_filter_in" != "no"; then
+            :
+  fi
+  echo "$as_me:$LINENO: result: $enable_case_filter_in$_apmod_extra_msg" >&5
+echo "${ECHO_T}$enable_case_filter_in$_apmod_extra_msg" >&6
+  if test "$enable_case_filter_in" != "no"; then
+    case "$enable_case_filter_in" in
+    shared*)
+      enable_case_filter_in=`echo $ac_n $enable_case_filter_in$ac_c|sed 's/shared,*//'`
+      sharedobjs=yes
+      shared=yes
+      DSO_MODULES="$DSO_MODULES case_filter_in"
+      ;;
+    *)
+      MODLIST="$MODLIST case_filter_in"
+      if test "case_filter_in" = "so"; then
+          sharedobjs=yes
+      fi
+      shared="";;
+    esac
+
+  if test -z ""; then
+    objects="mod_case_filter_in.lo"
+  else
+    objects=""
+  fi
+
+  if test -z "$module_standalone"; then
+    if test -z "$shared"; then
+      libname="mod_case_filter_in.la"
+      BUILTIN_LIBS="$BUILTIN_LIBS $modpath_current/$libname"
+      modpath_static="$modpath_static $libname"
+      cat >>$modpath_current/modules.mk<<EOF
+$libname: $objects
+	\$(MOD_LINK) $objects
+EOF
+    else
+      apache_need_shared=yes
+      libname="mod_case_filter_in.la"
+      shobjects=`echo $objects | sed 's/\.lo/.slo/g'`
+      modpath_shared="$modpath_shared $libname"
+      cat >>$modpath_current/modules.mk<<EOF
+$libname: $shobjects
+	\$(SH_LINK) -rpath \$(libexecdir) -module -avoid-version  $objects
+EOF
+    fi
+  fi
+
+  fi
+
+
+
+  echo "DISTCLEAN_TARGETS = modules.mk" >> $modpath_current/modules.mk
+  echo "static = $modpath_static" >> $modpath_current/modules.mk
+  echo "shared = $modpath_shared" >> $modpath_current/modules.mk
+  if test ! -z "$modpath_static" -o ! -z "$modpath_shared"; then
+    MODULE_DIRS="$MODULE_DIRS $current_dir"
+  else
+    MODULE_CLEANDIRS="$MODULE_CLEANDIRS $current_dir"
+  fi
+
+  APACHE_FAST_OUTPUT_FILES="$APACHE_FAST_OUTPUT_FILES $modpath_current/Makefile"
+
+
+
+
+
+
+  current_dir=filters
+  modpath_current=modules/filters
+  modpath_static=
+  modpath_shared=
+  test -d filters || $srcdir/build/mkdir.sh $modpath_current
+  > $modpath_current/modules.mk
+
+
+
+  echo "$as_me:$LINENO: checking whether to enable mod_include" >&5
+echo $ECHO_N "checking whether to enable mod_include... $ECHO_C" >&6
+    # Check whether --enable-include or --disable-include was given.
+if test "${enable_include+set}" = set; then
+  enableval="$enable_include"
+
+else
+  enable_include=yes
+fi;
+    _apmod_extra_msg=""
+      if test "$module_selection" = "most" -a "$enable_include" = "most"; then
+    _apmod_error_fatal="no"
+  else
+    _apmod_error_fatal="yes"
+  fi
+  if test "$enable_include" = "static"; then
+    enable_include=yes
+  elif test "$enable_include" = "yes"; then
+    enable_include=$module_default
+    _apmod_extra_msg=" ($module_selection)"
+  elif test "$enable_include" = "most"; then
+    if test "$module_selection" = "most" -o "$module_selection" = "all"; then
+      enable_include=$module_default
+      _apmod_extra_msg=" ($module_selection)"
+    elif test "$enable_include" != "yes"; then
+      enable_include=no
     fi
-  elif test "$enable_case_filter_in" = "maybe-all"; then
+  elif test "$enable_include" = "maybe-all"; then
     if test "$module_selection" = "all"; then
-      enable_case_filter_in=$module_default
+      enable_include=$module_default
       _apmod_extra_msg=" (all)"
     else
-      enable_case_filter_in=no
+      enable_include=no
     fi
   fi
-  if test "$enable_case_filter_in" != "no"; then
+  if test "$enable_include" != "no"; then
             :
   fi
-  echo "$as_me:$LINENO: result: $enable_case_filter_in$_apmod_extra_msg" >&5
-echo "${ECHO_T}$enable_case_filter_in$_apmod_extra_msg" >&6
-  if test "$enable_case_filter_in" != "no"; then
-    case "$enable_case_filter_in" in
+  echo "$as_me:$LINENO: result: $enable_include$_apmod_extra_msg" >&5
+echo "${ECHO_T}$enable_include$_apmod_extra_msg" >&6
+  if test "$enable_include" != "no"; then
+    case "$enable_include" in
     shared*)
-      enable_case_filter_in=`echo $ac_n $enable_case_filter_in$ac_c|sed 's/shared,*//'`
+      enable_include=`echo $ac_n $enable_include$ac_c|sed 's/shared,*//'`
       sharedobjs=yes
       shared=yes
-      DSO_MODULES="$DSO_MODULES case_filter_in"
+      DSO_MODULES="$DSO_MODULES include"
       ;;
     *)
-      MODLIST="$MODLIST case_filter_in"
-      if test "case_filter_in" = "so"; then
+      MODLIST="$MODLIST include"
+      if test "include" = "so"; then
           sharedobjs=yes
       fi
       shared="";;
     esac
 
   if test -z ""; then
-    objects="mod_case_filter_in.lo"
+    objects="mod_include.lo"
   else
     objects=""
   fi
 
   if test -z "$module_standalone"; then
     if test -z "$shared"; then
-      libname="mod_case_filter_in.la"
+      libname="mod_include.la"
       BUILTIN_LIBS="$BUILTIN_LIBS $modpath_current/$libname"
       modpath_static="$modpath_static $libname"
       cat >>$modpath_current/modules.mk<<EOF
 $libname: $objects
 	\$(MOD_LINK) $objects
 EOF
     else
       apache_need_shared=yes
-      libname="mod_case_filter_in.la"
+      libname="mod_include.la"
       shobjects=`echo $objects | sed 's/\.lo/.slo/g'`
       modpath_shared="$modpath_shared $libname"
       cat >>$modpath_current/modules.mk<<EOF
 $libname: $shobjects
 	\$(SH_LINK) -rpath \$(libexecdir) -module -avoid-version  $objects
 EOF
@@ -7084,12 +7429,34 @@
   fi
 
   fi
 
 
 
+  if test "x$LT_LDFLAGS" = "x"; then
+    echo "  setting LT_LDFLAGS to \"-export-dynamic\""
+    LT_LDFLAGS="-export-dynamic"
+  else
+    apr_addto_bugger="-export-dynamic"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $LT_LDFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to LT_LDFLAGS"
+        LT_LDFLAGS="$LT_LDFLAGS $i"
+      fi
+    done
+  fi
+
+
+
   echo "$as_me:$LINENO: checking whether to enable mod_deflate" >&5
 echo $ECHO_N "checking whether to enable mod_deflate... $ECHO_C" >&6
     # Check whether --enable-deflate or --disable-deflate was given.
 if test "${enable_deflate+set}" = set; then
   enableval="$enable_deflate"
 
@@ -7492,146 +7859,12 @@
 
 
 
 
 
 
-  current_dir=filters
-  modpath_current=modules/filters
-  modpath_static=
-  modpath_shared=
-  test -d filters || $srcdir/build/mkdir.sh $modpath_current
-  > $modpath_current/modules.mk
-
-
-
-  echo "$as_me:$LINENO: checking whether to enable mod_include" >&5
-echo $ECHO_N "checking whether to enable mod_include... $ECHO_C" >&6
-    # Check whether --enable-include or --disable-include was given.
-if test "${enable_include+set}" = set; then
-  enableval="$enable_include"
-
-else
-  enable_include=yes
-fi;
-    _apmod_extra_msg=""
-      if test "$module_selection" = "most" -a "$enable_include" = "most"; then
-    _apmod_error_fatal="no"
-  else
-    _apmod_error_fatal="yes"
-  fi
-  if test "$enable_include" = "static"; then
-    enable_include=yes
-  elif test "$enable_include" = "yes"; then
-    enable_include=$module_default
-    _apmod_extra_msg=" ($module_selection)"
-  elif test "$enable_include" = "most"; then
-    if test "$module_selection" = "most" -o "$module_selection" = "all"; then
-      enable_include=$module_default
-      _apmod_extra_msg=" ($module_selection)"
-    elif test "$enable_include" != "yes"; then
-      enable_include=no
-    fi
-  elif test "$enable_include" = "maybe-all"; then
-    if test "$module_selection" = "all"; then
-      enable_include=$module_default
-      _apmod_extra_msg=" (all)"
-    else
-      enable_include=no
-    fi
-  fi
-  if test "$enable_include" != "no"; then
-            :
-  fi
-  echo "$as_me:$LINENO: result: $enable_include$_apmod_extra_msg" >&5
-echo "${ECHO_T}$enable_include$_apmod_extra_msg" >&6
-  if test "$enable_include" != "no"; then
-    case "$enable_include" in
-    shared*)
-      enable_include=`echo $ac_n $enable_include$ac_c|sed 's/shared,*//'`
-      sharedobjs=yes
-      shared=yes
-      DSO_MODULES="$DSO_MODULES include"
-      ;;
-    *)
-      MODLIST="$MODLIST include"
-      if test "include" = "so"; then
-          sharedobjs=yes
-      fi
-      shared="";;
-    esac
-
-  if test -z ""; then
-    objects="mod_include.lo"
-  else
-    objects=""
-  fi
-
-  if test -z "$module_standalone"; then
-    if test -z "$shared"; then
-      libname="mod_include.la"
-      BUILTIN_LIBS="$BUILTIN_LIBS $modpath_current/$libname"
-      modpath_static="$modpath_static $libname"
-      cat >>$modpath_current/modules.mk<<EOF
-$libname: $objects
-	\$(MOD_LINK) $objects
-EOF
-    else
-      apache_need_shared=yes
-      libname="mod_include.la"
-      shobjects=`echo $objects | sed 's/\.lo/.slo/g'`
-      modpath_shared="$modpath_shared $libname"
-      cat >>$modpath_current/modules.mk<<EOF
-$libname: $shobjects
-	\$(SH_LINK) -rpath \$(libexecdir) -module -avoid-version  $objects
-EOF
-    fi
-  fi
-
-  fi
-
-
-
-  if test "x$LT_LDFLAGS" = "x"; then
-    echo "  setting LT_LDFLAGS to \"-export-dynamic\""
-    LT_LDFLAGS="-export-dynamic"
-  else
-    apr_addto_bugger="-export-dynamic"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LT_LDFLAGS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LT_LDFLAGS"
-        LT_LDFLAGS="$LT_LDFLAGS $i"
-      fi
-    done
-  fi
-
-
-
-  echo "DISTCLEAN_TARGETS = modules.mk" >> $modpath_current/modules.mk
-  echo "static = $modpath_static" >> $modpath_current/modules.mk
-  echo "shared = $modpath_shared" >> $modpath_current/modules.mk
-  if test ! -z "$modpath_static" -o ! -z "$modpath_shared"; then
-    MODULE_DIRS="$MODULE_DIRS $current_dir"
-  else
-    MODULE_CLEANDIRS="$MODULE_CLEANDIRS $current_dir"
-  fi
-
-  APACHE_FAST_OUTPUT_FILES="$APACHE_FAST_OUTPUT_FILES $modpath_current/Makefile"
-
-
-
-
-
-
   current_dir=loggers
   modpath_current=modules/loggers
   modpath_static=
   modpath_shared=
   test -d loggers || $srcdir/build/mkdir.sh $modpath_current
   > $modpath_current/modules.mk
@@ -11412,12 +11645,20 @@
   test -d http || $srcdir/build/mkdir.sh $modpath_current
   > $modpath_current/modules.mk
 
 
 http_objects="http_core.lo http_protocol.lo http_request.lo"
 
+if test "$enable_http" = "yes"; then
+    enable_http="static"
+elif test "$enable_http" = "shared"; then
+    { { echo "$as_me:$LINENO: error: mod_http can not be built as a shared DSO" >&5
+echo "$as_me: error: mod_http can not be built as a shared DSO" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
 
   echo "$as_me:$LINENO: checking whether to enable mod_http" >&5
 echo $ECHO_N "checking whether to enable mod_http... $ECHO_C" >&6
     # Check whether --enable-http or --disable-http was given.
 if test "${enable_http+set}" = set; then
   enableval="$enable_http"
@@ -14353,20 +14594,28 @@
 cat >>confdefs.h <<_ACEOF
 #define AP_SUEXEC_UMASK 0$withval
 _ACEOF
 
 fi;
 
-AP_LIBS="$abs_builddir/srclib/pcre/libpcre.la $abs_builddir/srclib/apr-util/libaprutil.la $AP_LIBS"
+AP_LIBS="$abs_builddir/srclib/pcre/libpcre.la $AP_LIBS"
 
-AP_LIBS="$AP_LIBS $abs_builddir/srclib/apr/libapr.la"
+AP_LIBS="$AP_LIBS `$apu_config --link-libtool --libs` `$apr_config --link-libtool --libs`"
 
   APACHE_VAR_SUBST="$APACHE_VAR_SUBST AP_LIBS"
 
 
 
+  APACHE_VAR_SUBST="$APACHE_VAR_SUBST AP_BUILD_SRCLIB_DIRS"
+
+
+
+  APACHE_VAR_SUBST="$APACHE_VAR_SUBST AP_CLEAN_SRCLIB_DIRS"
+
+
+
 
 cat >>confdefs.h <<\_ACEOF
 #define AP_USING_AUTOCONF 1
 _ACEOF
 
 
@@ -14626,78 +14875,12 @@
 if test -d ./test; then
 
   APACHE_FAST_OUTPUT_FILES="$APACHE_FAST_OUTPUT_FILES test/Makefile"
 
 fi
 
-. ./srclib/apr-util/export_vars.sh
-
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"$APRUTIL_EXPORT_LIBS\""
-    LIBS="$APRUTIL_EXPORT_LIBS"
-  else
-    apr_addto_bugger="$APRUTIL_EXPORT_LIBS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LIBS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
-      fi
-    done
-  fi
-
-
-  if test "x$INCLUDES" = "x"; then
-    echo "  setting INCLUDES to \"$APRUTIL_EXPORT_INCLUDES\""
-    INCLUDES="$APRUTIL_EXPORT_INCLUDES"
-  else
-    apr_addto_bugger="$APRUTIL_EXPORT_INCLUDES"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $INCLUDES; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to INCLUDES"
-        INCLUDES="$INCLUDES $i"
-      fi
-    done
-  fi
-
-
-  if test "x$LDFLAGS" = "x"; then
-    echo "  setting LDFLAGS to \"$APRUTIL_LDFLAGS\""
-    LDFLAGS="$APRUTIL_LDFLAGS"
-  else
-    apr_addto_bugger="$APRUTIL_LDFLAGS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LDFLAGS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LDFLAGS"
-        LDFLAGS="$LDFLAGS $i"
-      fi
-    done
-  fi
-
-AP_LIBS="$AP_LIBS $LIBTOOL_LIBS"
-
 echo $ac_n "${nl}Restore user-defined environment settings...${nl}"
 
 
 if test "x$apr_ste_save_CPPFLAGS" = "x"; then
   EXTRA_CPPFLAGS="$CPPFLAGS"
   CPPFLAGS=
@@ -15090,23 +15273,29 @@
     perlbin="/replace/with/path/to/perl/interpreter"
 fi
 
 
 
 BSD_MAKEFILE=no
+ap_make_include=include
+ap_make_delimiter=' '
 case $host in
 *bsdi*)
     # Check whether they've installed GNU make
     if make --version > /dev/null 2>&1; then
         true
     else
         BSD_MAKEFILE=yes
+        ap_make_include=.include
+        ap_make_delimiter='"'
     fi
     ;;
 esac
 
+
+
 test -d docs/conf||$mkdir_p docs/conf
 
 ac_config_files="$ac_config_files $APACHE_OUTPUT_FILES docs/conf/httpd-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk"
 ac_config_commands="$ac_config_commands default"
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
@@ -15774,12 +15963,14 @@
 s,@SHLIBPATH_VAR@,$SHLIBPATH_VAR,;t t
 s,@OS_SPECIFIC_VARS@,$OS_SPECIFIC_VARS,;t t
 s,@PRE_SHARED_CMDS@,$PRE_SHARED_CMDS,;t t
 s,@POST_SHARED_CMDS@,$POST_SHARED_CMDS,;t t
 s,@shared_build@,$shared_build,;t t
 s,@AP_LIBS@,$AP_LIBS,;t t
+s,@AP_BUILD_SRCLIB_DIRS@,$AP_BUILD_SRCLIB_DIRS,;t t
+s,@AP_CLEAN_SRCLIB_DIRS@,$AP_CLEAN_SRCLIB_DIRS,;t t
 s,@AP_SIG_GRACEFUL@,$AP_SIG_GRACEFUL,;t t
 s,@AP_SIG_GRACEFUL_STRING@,$AP_SIG_GRACEFUL_STRING,;t t
 s,@AP_SIG_GRACEFUL_SHORT@,$AP_SIG_GRACEFUL_SHORT,;t t
 s,@EXTRA_CPPFLAGS@,$EXTRA_CPPFLAGS,;t t
 s,@EXTRA_CFLAGS@,$EXTRA_CFLAGS,;t t
 s,@EXTRA_CXXFLAGS@,$EXTRA_CXXFLAGS,;t t
@@ -15819,12 +16010,14 @@
 s,@SH_LIBS@,$SH_LIBS,;t t
 s,@SH_LIBTOOL@,$SH_LIBTOOL,;t t
 s,@MK_IMPLIB@,$MK_IMPLIB,;t t
 s,@INSTALL_PROG_FLAGS@,$INSTALL_PROG_FLAGS,;t t
 s,@DSO_MODULES@,$DSO_MODULES,;t t
 s,@perlbin@,$perlbin,;t t
+s,@ap_make_include@,$ap_make_include,;t t
+s,@ap_make_delimiter@,$ap_make_delimiter,;t t
 CEOF
 
 _ACEOF
 
   cat >>$CONFIG_STATUS <<\_ACEOF
   # Split the substitutions into bite-sized pieces for seds with
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/configure.in	2002-04-18 17:01:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/configure.in	2002-06-16 05:48:53.000000000 +0800
@@ -13,12 +13,14 @@
 dnl #
 dnl # Include our own M4 macros along with those for APR and libtool
 dnl #
 sinclude(srclib/apr/build/apr_common.m4)
 sinclude(srclib/apr/build/apr_network.m4)
 sinclude(srclib/apr/build/apr_threads.m4)
+sinclude(srclib/apr/build/find_apr.m4)
+sinclude(srclib/apr-util/build/find_apu.m4)
 sinclude(acinclude.m4)
 
 dnl XXX we can't just use AC_PREFIX_DEFAULT because that isn't subbed in
 dnl by configure until it is too late.  Is that how it should be or not?
 dnl Something seems broken here.                                               
 AC_PREFIX_DEFAULT(/usr/local/apache2)
@@ -45,66 +47,80 @@
 dnl
 APR_CONFIG_NICE(config.nice)
 
 nl='
 '
 dnl Check that mkdir -p works
-APACHE_MKDIR_P_CHECK
+APR_MKDIR_P_CHECK($top_srcdir/build/mkdir.sh)
 
 dnl ## Run configure for packages Apache uses
 
 dnl shared library support for these packages doesn't currently
 dnl work on some platforms
 
 AC_CANONICAL_SYSTEM
 
 orig_prefix="$prefix"
 
 echo $ac_n "${nl}Configuring Apache Portable Runtime library ...${nl}"
 
-APR_SUBDIR_CONFIG(srclib/apr, "$apache_apr_flags --prefix=$prefix --exec-prefix=$exec_prefix --libdir=$libdir --includedir=$includedir --bindir=$bindir --datadir=$datadir --with-installbuilddir=$installbuilddir")
+APR_FIND_APR("$srcdir/srclib/apr", "./srclib/apr")
+
+if test "$apr_found" = "no"; then
+  AC_MSG_ERROR([APR not found.  Please read the documentation.])
+fi
+
+if test "$apr_found" = "reconfig"; then
+  APR_SUBDIR_CONFIG(srclib/apr, "$apache_apr_flags --prefix=$prefix --exec-prefix=$exec_prefix --libdir=$libdir --includedir=$includedir --bindir=$bindir --datadir=$datadir --with-installbuilddir=$installbuilddir")
+  dnl We must be the first to build and the last to be cleaned
+  AP_BUILD_SRCLIB_DIRS="apr $AP_BUILD_SRCLIB_DIRS"
+  AP_CLEAN_SRCLIB_DIRS="$AP_CLEAN_SRCLIB_DIRS apr"
+fi
+
+APR_ADDTO(CFLAGS, `$apr_config --cflags`)
+APR_ADDTO(CPPFLAGS, `$apr_config --cppflags`)
+APR_ADDTO(LDFLAGS, `$apr_config --ldflags`)
+APR_ADDTO(INCLUDES, `$apr_config --includes`)
+SHLIBPATH_VAR=`$apr_config --shlib-path-var`
 
 echo $ac_n "${nl}Configuring Apache Portable Runtime Utility library...${nl}"
 
-APR_SUBDIR_CONFIG(srclib/apr-util, "--with-apr=../apr --prefix=$prefix --exec-prefix=$exec_prefix --libdir=$libdir --includedir=$includedir --bindir=$bindir")
+APR_FIND_APU("$srcdir/srclib/apr-util", "./srclib/apr-util")
+
+if test "$apu_found" = "no"; then
+  AC_MSG_ERROR([APR-util not found.  Please read the documentation.])
+fi
+
+if test "$apu_found" = "reconfig"; then
+  APR_SUBDIR_CONFIG(srclib/apr-util, "--with-apr=../apr --prefix=$prefix --exec-prefix=$exec_prefix --libdir=$libdir --includedir=$includedir --bindir=$bindir")
+  dnl We must be the last to build and the first to be cleaned
+  AP_BUILD_SRCLIB_DIRS="$AP_BUILD_SRCLIB_DIRS apr-util"
+  AP_CLEAN_SRCLIB_DIRS="apr-util $AP_CLEAN_SRCLIB_DIRS"
+fi
+
+APR_ADDTO(LDFLAGS, `$apu_config --ldflags`)
+APR_ADDTO(INCLUDES, `$apu_config --includes`)
 
 echo $ac_n "${nl}Configuring PCRE regular expression library ...${nl}"
 
 APR_SUBDIR_CONFIG(srclib/pcre, "--prefix=$prefix --exec-prefix=$exec_prefix --libdir=$libdir --includedir=$includedir --bindir=$bindir")
 
 echo $ac_n "${nl}Configuring Apache httpd ...${nl}"
 
-echo $ac_n "obtaining flag settings from the sub-configures...${nl}"
-. ./srclib/apr/APRVARS
-
-dnl Now that we have APR's EXTRA_flags in our environment, move them over
-dnl to the normal variables to avoid duplications and use them for testing.
-dnl We ignore EXTRA_INCLUDES because our own includes will encompass them.
-dnl
-APR_ADDTO(CFLAGS, $EXTRA_CFLAGS)
-APR_ADDTO(CPPFLAGS, $EXTRA_CPPFLAGS)
-APR_ADDTO(LDFLAGS, $EXTRA_LDFLAGS)
-APR_ADDTO(LIBS, $EXTRA_LIBS)
-EXTRA_CFLAGS=
-EXTRA_CPPFLAGS=
-EXTRA_LDFLAGS=
-EXTRA_LIBS=
-EXTRA_INCLUDES=
-
 dnl Absolute source/build directory
 abs_srcdir=`(cd $srcdir && pwd)`
 abs_builddir=`pwd`
 
 dnl If the source dir is not equal to the build dir, 
 dnl then we are running in VPATH mode.
 
 if test "$abs_builddir" != "$abs_srcdir"; then
   USE_VPATH=1
-  APR_ADDTO(INCLUDES, [-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/include -I\$(top_srcdir)/include -I\$(top_builddir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_builddir)/srclib/apr-util/include -I\$(top_srcdir)/srclib/apr-util/include])
+  APR_ADDTO(INCLUDES, [-I. -I\$(srcdir) -I\$(top_builddir)/os/\$(OS_DIR) -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_builddir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_builddir)/modules/http -I\$(top_srcdir)/modules/http -I\$(top_builddir)/modules/proxy -I\$(top_srcdir)/modules/proxy -I\$(top_builddir)/modules/filters -I\$(top_srcdir)/modules/filters -I\$(top_builddir)/include -I\$(top_srcdir)/include])
 else
-  APR_ADDTO(INCLUDES, [-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include -I\$(top_srcdir)/srclib/apr/include -I\$(top_srcdir)/srclib/apr-util/include])
+  APR_ADDTO(INCLUDES, [-I. -I\$(top_srcdir)/os/\$(OS_DIR) -I\$(top_srcdir)/server/mpm/\$(MPM_SUBDIR_NAME) -I\$(top_srcdir)/modules/http -I\$(top_srcdir)/modules/filters -I\$(top_srcdir)/modules/proxy -I\$(top_srcdir)/include])
 fi
 
 echo $ac_n "${nl}Applying OS-specific hints for httpd ...${nl}"
 
 case $host in
   *os2*)
@@ -122,14 +138,15 @@
       LTCFLAGS=""
       ;;
   *)
       if test "x$LTFLAGS" = "x"; then
           LTFLAGS='--silent'
       fi
-      LIBTOOL='$(SHELL) $(top_builddir)/srclib/apr/libtool $(LTFLAGS)'
-      libtoolversion=`$abs_builddir/srclib/apr/libtool --version`
+      my_libtool=`$apr_config --apr-libtool`
+      LIBTOOL="$my_libtool \$(LTFLAGS)"
+      libtoolversion=`$my_libtool --version`
       case $libtoolversion in
           *1.4*)
               SH_LIBTOOL='$(LIBTOOL)'
               SHLTCFLAGS="-prefer-pic"
               LTCFLAGS="-prefer-non-pic -static"
               ;;
@@ -188,12 +205,18 @@
       esac
       ;;
   *cygwin*)
       APR_SETVAR(APACHE_MPM, [prefork])
       APR_SETVAR(SINGLE_LISTEN_UNSERIALIZED_ACCEPT, [1])
       ;;
+  *aix*)
+      aixver=`echo $host | sed 's/^[[^0-9]]*//' | sed 's/\.//g'`
+      if test $aixver -ge 4320; then
+        APR_SETVAR(SINGLE_LISTEN_UNSERIALIZED_ACCEPT, [1])
+      fi
+      ;;
 esac
 
 dnl
 dnl Process command line arguments. This is done early in the process so the
 dnl user can get feedback quickly in case of an error.
 dnl
@@ -386,17 +409,19 @@
 
 AC_ARG_WITH(suexec-umask,
 APACHE_HELP_STRING(--with-suexec-umask,umask for suexec'd process),[
   AC_DEFINE_UNQUOTED(AP_SUEXEC_UMASK, 0$withval, [umask for suexec'd process] ) ] )
 
 dnl AP_LIBS specifies the actual libraries. note we have some required libs.
-AP_LIBS="$abs_builddir/srclib/pcre/libpcre.la $abs_builddir/srclib/apr-util/libaprutil.la $AP_LIBS"
+AP_LIBS="$abs_builddir/srclib/pcre/libpcre.la $AP_LIBS"
 
 dnl APR should go after the other libs, so the right symbols can be picked up
-AP_LIBS="$AP_LIBS $abs_builddir/srclib/apr/libapr.la"
+AP_LIBS="$AP_LIBS `$apu_config --link-libtool --libs` `$apr_config --link-libtool --libs`"
 APACHE_SUBST(AP_LIBS)
+APACHE_SUBST(AP_BUILD_SRCLIB_DIRS)
+APACHE_SUBST(AP_CLEAN_SRCLIB_DIRS)
 
 AC_DEFINE(AP_USING_AUTOCONF, 1,
 		[Using autoconf to configure Apache])
 
 if test "$SINGLE_LISTEN_UNSERIALIZED_ACCEPT" = "1"; then
     AC_DEFINE(SINGLE_LISTEN_UNSERIALIZED_ACCEPT, 1, 
@@ -426,19 +451,12 @@
 APACHE_FAST_OUTPUT(support/Makefile srclib/pcre/Makefile)
 
 if test -d ./test; then
     APACHE_FAST_OUTPUT(test/Makefile)
 fi
 
-dnl get the exported vars from APRUTIL
-. ./srclib/apr-util/export_vars.sh
-APR_ADDTO(LIBS, $APRUTIL_EXPORT_LIBS)
-APR_ADDTO(INCLUDES, $APRUTIL_EXPORT_INCLUDES)
-APR_ADDTO(LDFLAGS, $APRUTIL_LDFLAGS)
-AP_LIBS="$AP_LIBS $LIBTOOL_LIBS"
-
 dnl ## Finalize the variables
 echo $ac_n "${nl}Restore user-defined environment settings...${nl}"
 
 APR_RESTORE_THE_ENVIRONMENT(CPPFLAGS, EXTRA_)
 APR_RESTORE_THE_ENVIRONMENT(CFLAGS, EXTRA_)
 APR_RESTORE_THE_ENVIRONMENT(CXXFLAGS, EXTRA_)
@@ -468,22 +486,28 @@
 fi
 AC_SUBST(perlbin)
 
 dnl If we are running on BSD/OS, we need to use the BSD .include syntax.
 
 BSD_MAKEFILE=no
+ap_make_include=include
+ap_make_delimiter=' '
 case $host in
 *bsdi*)
     # Check whether they've installed GNU make
     if make --version > /dev/null 2>&1; then
         true
     else
         BSD_MAKEFILE=yes
+        ap_make_include=.include
+        ap_make_delimiter='"'
     fi
     ;;
 esac
+AC_SUBST(ap_make_include)
+AC_SUBST(ap_make_delimiter)
 
 dnl Ensure that docs/conf is created.
 test -d docs/conf||$mkdir_p docs/conf
 
 AC_OUTPUT($APACHE_OUTPUT_FILES docs/conf/httpd-std.conf include/ap_config_layout.h support/apxs support/apachectl support/dbmmanage support/envvars-std support/log_server_status support/logresolve.pl support/phf_abuse_log.cgi support/split-logfile build/rules.mk,[true],[
   APACHE_GEN_MAKEFILES
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-nw.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-nw.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-nw.conf	2002-02-14 03:58:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-nw.conf	2002-06-14 02:39:04.000000000 +0800
@@ -438,13 +438,14 @@
 # the manual, even if you choose to move your DocumentRoot.  You may comment
 # this out if you do not care for the documentation.
 #
 Alias /manual "@@ServerRoot@@/manual"
 
 <Directory "@@ServerRoot@@/manual">
-    Options Indexes FollowSymLinks MultiViews
+    Options Indexes FollowSymLinks MultiViews IncludesNoExec
+    AddOutputFilter Includes html
     AllowOverride None
     Order allow,deny
     Allow from all
 </Directory>
 
 #
@@ -590,13 +591,13 @@
 # Note 3: In the case of 'ltz' we violate the RFC by using a three char
 # specifier. There is 'work in progress' to fix this and get
 # the reference data for rfc1766 cleaned up.
 #
 # Danish (da) - Dutch (nl) - English (en) - Estonian (et)
 # French (fr) - German (de) - Greek-Modern (el)
-# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (kr)
+# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (ko)
 # Portugese (pt) - Luxembourgeois* (ltz)
 # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
 # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
 # Russian (ru) - Croatian (hr)
 #
 AddLanguage da .dk
@@ -607,13 +608,13 @@
 AddLanguage de .de
 AddLanguage he .he
 AddLanguage el .el
 AddLanguage it .it
 AddLanguage ja .ja
 AddLanguage pl .po
-AddLanguage kr .kr
+AddLanguage ko .ko
 AddLanguage pt .pt
 AddLanguage nn .nn
 AddLanguage no .no
 AddLanguage pt-br .pt-br
 AddLanguage ltz .ltz
 AddLanguage ca .ca
@@ -629,13 +630,13 @@
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 #
 # Just list the languages in decreasing order of preference. We have
 # more or less alphabetized them here. You probably want to change this.
 #
-LanguagePriority en da nl et fr de el it ja kr no pl pt pt-br ltz ca es sv tw
+LanguagePriority en da nl et fr de el it ja ko no pl pt pt-br ltz ca es sv tw
 
 #
 # ForceLanguagePriority allows you to serve a result page rather than
 # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
 # [in case no accepted languages matched the available variants]
 #
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf: httpd-std.conf
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-std.conf.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-std.conf.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-std.conf.in	2002-04-24 22:24:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-std.conf.in	2002-06-15 15:20:59.000000000 +0800
@@ -171,36 +171,36 @@
 StartThreads               10
 MaxClients                 50
 MaxRequestsPerThread       10000
 </IfModule>    
 
 # NetWare MPM
-# ThreadStackSize ...... Stack size allocated for each worker thread
-# StartThreads ......... Number of worker threads launched at server startup
-# MinSpareThreads ...... Minimum number of idle threads, to handle request spikes
-# MaxSpareThreads ...... Maximum number of idle threads
-# MaxThreads ........... Maximum number of worker threads alive at the same time
-# MaxRequestsPerChild .. Maximum  number of requests a thread serves. It is 
-#                         recommended that the default value of 0 be set for this
-#                         directive on NetWare.  This will allow the thread to 
-#                         continue to service requests indefinitely.                          
+# ThreadStackSize: Stack size allocated for each worker thread
+# StartThreads: Number of worker threads launched at server startup
+# MinSpareThreads: Minimum number of idle threads, to handle request spikes
+# MaxSpareThreads: Maximum number of idle threads
+# MaxThreads: Maximum number of worker threads alive at the same time
+# MaxRequestsPerChild: Maximum  number of requests a thread serves. It is 
+#                      recommended that the default value of 0 be set for this
+#                      directive on NetWare.  This will allow the thread to 
+#                      continue to service requests indefinitely.                          
 <IfModule mpm_netware.c>
 ThreadStackSize      65536
 StartThreads           250
 MinSpareThreads         25
 MaxSpareThreads        250
 MaxThreads            1000
 MaxRequestsPerChild      0
 </IfModule>
 
 # OS/2 MPM
-# StartServers ......... Number of server processes to maintain
-# MinSpareThreads ...... Minimum number of idle threads per process, 
-#                         to handle request spikes
-# MaxSpareThreads ...... Maximum number of idle threads per process
-# MaxRequestsPerChild .. Maximum number of connections per server process
+# StartServers: Number of server processes to maintain
+# MinSpareThreads: Minimum number of idle threads per process, 
+#                  to handle request spikes
+# MaxSpareThreads: Maximum number of idle threads per process
+# MaxRequestsPerChild: Maximum number of connections per server process
 <IfModule mpmt_os2.c>
 StartServers           2
 MinSpareThreads        5
 MaxSpareThreads       10
 MaxRequestsPerChild    0
 </IfModule>
@@ -391,13 +391,14 @@
 # same purpose, but it is much slower.
 #
 DirectoryIndex index.html index.html.var
 
 #
 # AccessFileName: The name of the file to look for in each directory
-# for access control information.  See also the AllowOverride directive.
+# for additional configuration directives.  See also the AllowOverride 
+# directive.
 #
 AccessFileName .htaccess
 
 #
 # The following lines prevent .htaccess and .htpasswd files from being 
 # viewed by Web clients. 
@@ -441,12 +442,22 @@
 # each client request will result in AT LEAST one lookup request to the
 # nameserver.
 #
 HostnameLookups Off
 
 #
+# EnableMMAP: Control whether memory-mapping is used to deliver
+# files (assuming that the underlying OS supports it).
+# The default is on; turn this off if you serve from NFS-mounted 
+# filesystems.  On some systems, turning it off (regardless of
+# filesystem) can improve performance; for details, please see
+# http://httpd.apache.org/docs-2.0/mod/core.html#enablemmap
+#
+# EnableMMAP off
+
+#
 # ErrorLog: The location of the error log file.
 # If you do not specify an ErrorLog directive within a <VirtualHost>
 # container, error messages relating to that virtual host will be
 # logged here.  If you *do* define an error logfile for a <VirtualHost>
 # container, that host's errors will be logged there and not here.
 #
@@ -526,13 +537,14 @@
 # the manual, even if you choose to move your DocumentRoot.  You may comment
 # this out if you do not care for the documentation.
 #
 Alias /manual "@exp_manualdir@"
 
 <Directory "@exp_manualdir@">
-    Options Indexes FollowSymLinks MultiViews
+    Options Indexes FollowSymLinks MultiViews IncludesNoExec
+    AddOutputFilter Includes html
     AllowOverride None
     Order allow,deny
     Allow from all
 </Directory>
 
 #
@@ -573,16 +585,14 @@
 
 #
 # Directives controlling the display of server-generated directory listings.
 #
 
 #
-# FancyIndexing is whether you want fancy directory indexing or standard.
-# VersionSort is whether files containing version numbers should be 
-# compared in the natural way, so that `apache-1.3.9.tar' is placed before
-# `apache-1.3.12.tar'.
+# IndexOptions: Controls the appearance of server-generated directory
+# listings.
 #
 IndexOptions FancyIndexing VersionSort
 
 #
 # AddIcon* directives tell the server which icon to show for different
 # files or filename extensions.  These are only displayed for
@@ -686,13 +696,13 @@
 # Note 3: In the case of 'ltz' we violate the RFC by using a three char
 # specifier. There is 'work in progress' to fix this and get
 # the reference data for rfc1766 cleaned up.
 #
 # Danish (da) - Dutch (nl) - English (en) - Estonian (et)
 # French (fr) - German (de) - Greek-Modern (el)
-# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (kr) 
+# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (ko) 
 # Portugese (pt) - Luxembourgeois* (ltz)
 # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
 # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
 # Russian (ru) - Croatian (hr)
 #
 AddLanguage da .dk
@@ -703,13 +713,13 @@
 AddLanguage de .de
 AddLanguage he .he
 AddLanguage el .el
 AddLanguage it .it
 AddLanguage ja .ja
 AddLanguage pl .po
-AddLanguage kr .kr
+AddLanguage ko .ko
 AddLanguage pt .pt
 AddLanguage nn .nn
 AddLanguage no .no
 AddLanguage pt-br .pt-br
 AddLanguage ltz .ltz
 AddLanguage ca .ca
@@ -725,13 +735,13 @@
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 #
 # Just list the languages in decreasing order of preference. We have
 # more or less alphabetized them here. You probably want to change this.
 #
-LanguagePriority en da nl et fr de el it ja kr no pl pt pt-br ltz ca es sv tw
+LanguagePriority en da nl et fr de el it ja ko no pl pt pt-br ltz ca es sv tw
 
 #
 # ForceLanguagePriority allows you to serve a result page rather than
 # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
 # [in case no accepted languages matched the available variants]
 #
@@ -830,12 +840,13 @@
 
 # Filters allow you to process content before it is sent to the client.
 #
 # To parse .shtml files for server-side includes (SSI):
 # (You will also need to add "Includes" to the "Options" directive.)
 #
+#AddType text/html .shtml
 #AddOutputFilter INCLUDES .shtml
 
 #
 # Action lets you define media types that will execute a script whenever
 # a matching file is called. This eliminates the need for repeated URL
 # pathnames for oft-used CGI file processors.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-win.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-win.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/httpd-win.conf	2002-02-16 05:13:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/httpd-win.conf	2002-06-14 02:39:04.000000000 +0800
@@ -453,13 +453,14 @@
 # the manual, even if you choose to move your DocumentRoot.  You may comment
 # this out if you do not care for the documentation.
 #
 Alias /manual "@@ServerRoot@@/manual"
 
 <Directory "@@ServerRoot@@/manual">
-    Options Indexes FollowSymLinks MultiViews
+    Options Indexes FollowSymLinks MultiViews IncludesNoExec
+    AddOutputFilter Includes html
     AllowOverride None
     Order allow,deny
     Allow from all
 </Directory>
 
 #
@@ -605,13 +606,13 @@
 # Note 3: In the case of 'ltz' we violate the RFC by using a three char
 # specifier. There is 'work in progress' to fix this and get
 # the reference data for rfc1766 cleaned up.
 #
 # Danish (da) - Dutch (nl) - English (en) - Estonian (et)
 # French (fr) - German (de) - Greek-Modern (el)
-# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (kr)
+# Italian (it) - Norwegian (no) - Norwegian Nynorsk (nn) - Korean (ko)
 # Portugese (pt) - Luxembourgeois* (ltz)
 # Spanish (es) - Swedish (sv) - Catalan (ca) - Czech(cz)
 # Polish (pl) - Brazilian Portuguese (pt-br) - Japanese (ja)
 # Russian (ru) - Croatian (hr)
 #
 AddLanguage da .dk
@@ -622,13 +623,13 @@
 AddLanguage de .de
 AddLanguage he .he
 AddLanguage el .el
 AddLanguage it .it
 AddLanguage ja .ja
 AddLanguage pl .po
-AddLanguage kr .kr
+AddLanguage ko .ko
 AddLanguage pt .pt
 AddLanguage nn .nn
 AddLanguage no .no
 AddLanguage pt-br .pt-br
 AddLanguage ltz .ltz
 AddLanguage ca .ca
@@ -644,13 +645,13 @@
 # LanguagePriority allows you to give precedence to some languages
 # in case of a tie during content negotiation.
 #
 # Just list the languages in decreasing order of preference. We have
 # more or less alphabetized them here. You probably want to change this.
 #
-LanguagePriority en da nl et fr de el it ja kr no pl pt pt-br ltz ca es sv tw
+LanguagePriority en da nl et fr de el it ja ko no pl pt pt-br ltz ca es sv tw
 
 #
 # ForceLanguagePriority allows you to serve a result page rather than
 # MULTIPLE CHOICES (Prefer) [in case of a tie] or NOT ACCEPTABLE (Fallback)
 # [in case no accepted languages matched the available variants]
 #
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/ssl-std.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/ssl-std.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/conf/ssl-std.conf	2001-11-08 06:16:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/conf/ssl-std.conf	2002-05-17 03:05:24.000000000 +0800
@@ -79,22 +79,12 @@
 SSLRandomSeed connect builtin
 #SSLRandomSeed startup file:/dev/random  512
 #SSLRandomSeed startup file:/dev/urandom 512
 #SSLRandomSeed connect file:/dev/random  512
 #SSLRandomSeed connect file:/dev/urandom 512
 
-#   Logging:
-#   The home of the dedicated SSL protocol logfile. Errors are
-#   additionally duplicated in the general error log file.  Put
-#   this somewhere where it cannot be used for symlink attacks on
-#   a real server (i.e. somewhere where only root can write).
-#   Log levels are (ascending order: higher ones include lower ones):
-#   none, error, warn, info, trace, debug.
-SSLLog      logs/ssl_engine_log
-SSLLogLevel info
-
 ##
 ## SSL Virtual Host Context
 ##
 
 <VirtualHost _default_:443>
 
@@ -114,17 +104,16 @@
 #   See the mod_ssl documentation for a complete list.
 SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
 
 #   Server Certificate:
 #   Point SSLCertificateFile at a PEM encoded certificate.  If
 #   the certificate is encrypted, then you will be prompted for a
-#   pass phrase.  Note that a kill -HUP will prompt again. A test
-#   certificate can be generated with `make certificate' under
-#   built time. Keep in mind that if you've both a RSA and a DSA
-#   certificate you can configure both in parallel (to also allow
-#   the use of DSA ciphers, etc.)
+#   pass phrase.  Note that a kill -HUP will prompt again.  Keep
+#   in mind that if you have both an RSA and a DSA certificate you
+#   can configure both in parallel (to also allow the use of DSA
+#   ciphers, etc.)
 SSLCertificateFile @@ServerRoot@@/conf/ssl.crt/server.crt
 #SSLCertificateFile @@ServerRoot@@/conf/ssl.crt/server-dsa.crt
 
 #   Server Private Key:
 #   If the key is not combined with the certificate, use this
 #   directive to point at the key file.  Keep in mind that if
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot/index.html.ca /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot/index.html.ca
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot/index.html.ca	2001-01-20 03:44:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot/index.html.ca	2002-05-21 05:31:08.000000000 +0800
@@ -1,51 +1,38 @@
-<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
-<HTML>
- <HEAD>
-  <TITLE>P&agrave;gina de prova de l'instal&middot;laci&oacute; d'Apache</TITLE>
- </HEAD>
-<!-- Background white, links blue (unvisited), navy (visited), red (active) -->
- <BODY
-  BGCOLOR="#FFFFFF"
-  TEXT="#000000"
-  LINK="#0000FF"
-  VLINK="#000080"
-  ALINK="#FF0000"
- >
-  <H1 ALIGN="CENTER">
-   Funciona&nbsp;!  El servidor web Apache est&agrave; instal&middot;lat
-   en aquest lloc &nbsp;!
-  </H1>
-  <P>
-  Si veu aquesta p&agrave;gina, es que els propietaris d'aquest domini
-  acaben d'instal&middot;lar satisfact&ograve;riament el
-  servidor web Apache.
-  Ara han d'afegir contingut en aquest directori i substituir aquesta p&agrave;gina, 
-  o b&egrave; dirigir aquest servidor cap al contingut real.
-  </P>
-  <HR>
-  <BLOCKQUOTE>
-   Si est&agrave; veien aquesta p&agrave;gina i no es la que esperava, posis en
-   contacte  amb
-   <STRONG>l'administrador web d'aquest lloc.</STRONG>
-   (Provi d'enviar un correu electr&ograve;nic a <SAMP>&lt;Webmaster@<EM>domain</EM>&gt;</SAMP>.)
-   Encara que aquest lloc est&agrave; utilitzant el programari Apache, es gaireb&eacute; segur
-   que no t&egrave; res a veure amb el Grup Apache, per tant 
-   no envi&iuml; cap correu electr&ograve;nic als autors d'Apache referent a aquest lloc o al seu contingut.
-   Si es que ho fa, el seu missatge ser&agrave; <STRONG><BIG>ignorat</BIG></STRONG>.
-  </BLOCKQUOTE>
-  <HR>
-  <P>
-  La
-  <A HREF="manual/">documentaci&oacute;</A>
-  d'Apache ha estat inclosa en aquesta distribuci&oacute;.
-  </P>
-  <P>
-  L'administrador de web pot utilitzar lliurement la imatge d'aqu&iacute; sota
-  en el servidor web equipat amb el programari Apache.
-  Gr&agrave;cies per utilitzar Apache&nbsp;!
-  </P>
-  <DIV ALIGN="CENTER">
-   <IMG SRC="apache_pb.gif" ALT="">
-  </DIV>
- </BODY>
-</HTML>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title>P&agrave;gina de prova de la instal&middot;laci&oacute; d'Apache</title>
+</head>
+<!-- Background white, links blue (unvisited), navy (visited), red
+(active) -->
+<body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
+vlink="#000080" alink="#FF0000">
+<p>Si veieu aix&ograve;, la instal&middot;laci&oacute; del progamari
+del <a href="http://www.apache.org/foundation/preFAQ.html">servidor
+web d'Apache</a> al sistema ha tingut &egrave;xit. Ja podeu afegir
+contingut al directori i substituir aquesta p&agrave;gina.</p>
+
+<hr width="50%" size="8" />
+<h2 align="center">Veieu aquest text en comptes de la p&agrave;gina web que
+cerc&agrave;veu?</h2>
+
+<p>Aquesta p&agrave;gina &eacute;s aqu&iacute; perqu&egrave; l'administrador
+del lloc ha canviat la configuraci&oacute; d'aquest servidor web.
+<strong>Poseu-vos en contacte amb la persona responsable del manteniment
+d'aquest servidor.</strong>
+La Apache Software Foundation, que va escriure el programari del servidor web
+que fa servir l'administrador d'aquest lloc, no t&eacute; res a veure amb el
+seu manteniment i no pot ajudar-vos a resoldre els problemes de configuraci&oacute;.</p>
+
+<hr width="50%" size="8" />
+<p>Aquesta distribuci&oacute; inclou la <a href="manual/">documentaci&oacute;</a>
+d'Apache.</p>
+
+<p>Podeu fer servir lliurement la imatge que surt a sota en un servidor web
+que funcioni amb Apache. Gr&agrave;cies per fer servir Apache!</p>
+
+<div align="center"><img src="apache_pb.gif" alt="" /></div>
+</body>
+</html>
+
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot: index.html.ko.euc-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot: index.html.kr.iso2022-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot: index.html.lb.utf8
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot: index.html.ltz.utf8
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot: index.html.lu.utf8
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot: index.html.tw
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot: index.html.tw.Big5
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot/index.html.var /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot/index.html.var
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/docroot/index.html.var	2002-01-07 20:44:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot/index.html.var	2002-06-11 08:19:17.000000000 +0800
@@ -51,15 +51,15 @@
 Content-type: text/html
 
 URI: index.html.ja.iso2022-jp
 Content-language: ja
 Content-type: text/html;charset=ISO-2022-JP
 
-URI: index.html.kr.iso2022-kr
-Content-language: kr
-Content-type: text/html;charset=ISO-2022-KR
+URI: index.html.ko.euc-kr
+Content-language: ko
+Content-type: text/html;charset=EUC-KR
 
 URI: index.html.ltz.utf8
 Content-language: ltz
 Content-type: text/html;charset=UTF-8
 
 URI: index.html.lu.utf8
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/docroot: index.html.zh
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/doxygen.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/doxygen.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/doxygen.conf	2001-11-24 00:33:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/doxygen.conf	2002-05-21 04:00:49.000000000 +0800
@@ -15,16 +15,38 @@
 # not sure why this doesn't work as EXPAND_AS_DEFINED, it should!
 PREDEFINED="APR_DECLARE(x)=x" \
        "APR_DECLARE_NONSTD(x)=x" \
        "AP_DECLARE_HOOK(ret,name,args)=ret name args;" \
        "AP_DECLARE(x)=x" \
        "AP_DECLARE_NONSTD(x)=x" \
+       "APR_HAS_THREADS" \
+       "APR_HAS_MMAP" \
+	APR_HAS_INLINE \
+	APR_HAS_FLOCK_SERIALIZE \
+	APR_HAS_SYSVSEM_SERIALIZE \
+	APR_HAS_POSIXSEM_SERIALIZE \
+	APR_HAS_FCNTL_SERIALIZE \
+	APR_HAS_PROC_PTHREAD_SERIALIZE \
+	APR_HAS_RWLOCK_SERIALIZE \
+	APR_HAS_SHARED_MEMORY \
+	APR_HAS_SENDFILE \
+	APR_HAS_FORK \
+	APR_HAS_RANDOM \
+	APR_HAS_XLATE \
+	APR_HAS_OTHER_CHILD \
+	APR_HAS_DSO \
+	APR_HAS_SO_ACCEPTFILTER \
+	APR_HAS_UNICODE_FS \
+	APR_HAS_PROC_INVOKED \
+	APR_HAS_USER \
+	APR_HAS_LARGE_FILES \
+	APR_HAS_XTHREAD_FILES \
        DOXYGEN= \
        APU_DECLARE_DATA= \
        __pre_nw__= \
        "APU_DECLARE(x)=x"
 
 OPTIMIZE_OUTPUT_FOR_C=YES
 
 FULL_PATH_NAMES=YES
 # some autoconf guru needs to make configure set this correctly...
-STRIP_FROM_PATH=/home/ianh/commit/httpd-2.0
+STRIP_FROM_PATH=/var/www/lxr/source
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/error/include/bottom.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/error/include/bottom.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/error/include/bottom.html	2001-08-21 09:31:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/error/include/bottom.html	2002-06-15 19:43:11.000000000 +0800
@@ -8,11 +8,18 @@
 <ADDRESS>
   <A HREF="/"><!--#echo encoding="none" var="SERVER_NAME" --></A>
   <BR>
   <!--#config timefmt="%c" -->
   <small><!--#echo encoding="none" var="DATE_LOCAL" --></small>
   <BR>
+
+  <!-- Set this value to 1 to display server version in all error
+  documents -->
+  <!--#set var="ShowVersion" value="0" -->
+
+  <!--#if expr="$ShowVersion = 1" -->
   <small><!--#echo encoding="none" var="SERVER_SOFTWARE" --></small>
+  <!--#endif -->
 </ADDRESS>
 </DL>
 </BODY>
 </HTML>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/icons: diskimg.gif
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/icons: diskimg.png
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: bind.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: bind.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: bind.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: cgi_path.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: cgi_path.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: cgi_path.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/content-negotiation.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/content-negotiation.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/content-negotiation.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/content-negotiation.html	2002-06-18 11:46:44.000000000 +0800
@@ -19,18 +19,18 @@
 
 
 
 
     <h1 align="CENTER">Content Negotiation</h1>
 
-    <p>Apache's support for content negotiation has been updated to
-    meet the HTTP/1.1 specification. It can choose the best
+    <p>Apache's supports content negotiation as described in
+    the HTTP/1.1 specification. It can choose the best
     representation of a resource based on the browser-supplied
     preferences for media type, languages, character set and
-    encoding. It is also implements a couple of features to give
-    more intelligent handling of requests from browsers which send
+    encoding. It also implements a couple of features to give
+    more intelligent handling of requests from browsers that send
     incomplete negotiation information.</p>
 
     <p>Content negotiation is provided by the <a
     href="mod/mod_negotiation.html">mod_negotiation</a> module,
     which is compiled in by default.</p>
     <hr />
@@ -64,16 +64,16 @@
     last resort:</p>
 <pre>
   Accept-Language: fr; q=1.0, en; q=0.5
   Accept: text/html; q=1.0, text/*; q=0.8, image/gif; q=0.6,
         image/jpeg; q=0.6, image/*; q=0.5, */*; q=0.1
 </pre>
-    Apache 1.2 supports 'server driven' content negotiation, as
+    Apache supports 'server driven' content negotiation, as
     defined in the HTTP/1.1 specification. It fully supports the
     Accept, Accept-Language, Accept-Charset and Accept-Encoding
-    request headers. Apache 1.3.4 also supports 'transparent'
+    request headers. Apache also supports 'transparent'
     content negotiation, which is an experimental negotiation
     protocol defined in RFC 2295 and RFC 2296. It does not offer
     support for 'feature negotiation' as defined in these RFCs. 
 
     <p>A <strong>resource</strong> is a conceptual entity
     identified by a URI (RFC 2396). An HTTP server like Apache
@@ -123,13 +123,13 @@
     variant; these entries consist of contiguous HTTP-format header
     lines. Entries for different variants are separated by blank
     lines. Blank lines are illegal within an entry. It is
     conventional to begin a map file with an entry for the combined
     entity as a whole (although this is not required, and if
     present will be ignored). An example map file is shown below.
-    This file would be named <code>foo.html</code>, as it describes
+    This file would be named <code>foo.var</code>, as it describes
     a resource named <code>foo</code>.</p>
 <pre>
   URI: foo
 
   URI: foo.en.html
   Content-type: text/html
@@ -168,69 +168,16 @@
     being represented is an original ascii art, then an ascii
     representation would have a higher source quality than a jpeg
     representation. A qs value is therefore specific to a given
     variant depending on the nature of the resource it
     represents.</p>
 
-    <p>The full list of headers recognized is:</p>
+    <p>The full list of headers recognized is available in the <a
+    href="mod/mod_negotiation.html#typemaps">mod_negotation</a>
+    documentation.</p>
 
-    <dl>
-      <dt><code>URI:</code></dt>
-
-      <dd>uri of the file containing the variant (of the given
-      media type, encoded with the given content encoding). These
-      are interpreted as URLs relative to the map file; they must
-      be on the same server (!), and they must refer to files to
-      which the client would be granted access if they were to be
-      requested directly.</dd>
-
-      <dt><code>Content-Type:</code></dt>
-
-      <dd>media type --- charset, level and "qs" parameters may be
-      given. These are often referred to as MIME types; typical
-      media types are <code>image/gif</code>,
-      <code>text/plain</code>, or
-      <code>text/html;&nbsp;level=3</code>.</dd>
-
-      <dt><code>Content-Language:</code></dt>
-
-      <dd>The languages of the variant, specified as an Internet
-      standard language tag from RFC 1766 (<em>e.g.</em>,
-      <code>en</code> for English, <code>kr</code> for Korean,
-      <em>etc.</em>).</dd>
-
-      <dt><code>Content-Encoding:</code></dt>
-
-      <dd>If the file is compressed, or otherwise encoded, rather
-      than containing the actual raw data, this says how that was
-      done. Apache only recognizes encodings that are defined by an
-      <a href="mod/mod_mime.html#addencoding">AddEncoding</a>
-      directive. This normally includes the encodings
-      <code>x-compress</code> for compress'd files, and
-      <code>x-gzip</code> for gzip'd files. The <code>x-</code>
-      prefix is ignored for encoding comparisons.</dd>
-
-      <dt><code>Content-Length:</code></dt>
-
-      <dd>The size of the file in bytes. Specifying content lengths
-      in the type-map allows the server to compare file sizes
-      without checking the actual files.</dd>
-
-      <dt><code>Description:</code></dt>
-
-      <dd>A human-readable textual description of the variant. If
-      Apache cannot find any appropriate variant to return, it will
-      return an error response which lists all available variants
-      instead. Such a variant list will include the human-readable
-      variant descriptions.</dd>
-    </dl>
-    Using a type map file is preferred over <code>MultiViews</code>
-    because it requires less CPU time, and less file access, to
-    parse a file explicitly listing the various resource variants,
-    than to have to look at every matching file, and parse its file
-    extensions. 
 
     <h3>Multiviews</h3>
 
     <p><code>MultiViews</code> is a per-directory option, meaning
     it can be set with an <code>Options</code> directive within a
     <code>&lt;Directory&gt;</code>, <code>&lt;Location&gt;</code>
@@ -259,19 +206,20 @@
 </pre>
     then the server will arbitrate between <code>index.html</code>
     and <code>index.html3</code> if both are present. If neither
     are present, and <code>index.cgi</code> is there, the server
     will run it. 
 
-    <p>If one of the files found when reading the directive is a
-    CGI script, it's not obvious what should happen. The code gives
-    that case special treatment --- if the request was a POST, or a
-    GET with QUERY_ARGS or PATH_INFO, the script is given an
-    extremely high quality rating, and generally invoked; otherwise
-    it is given an extremely low quality rating, which generally
-    causes one of the other views (if any) to be retrieved.</p>
+    <p>If one of the files found when reading the directory does not
+    have an extension recognized by <code>mod_mime</code> to designate
+    its Charset, Content-Type, Language, or Encoding, then the result
+    depends on the setting of the <a
+    href="mod/mod_mime.html#multiviewsmatch">MultiViewsMatch</a>
+    directive.  This directive determines whether handlers, filters,
+    and other extension types can participate in MultiViews
+    negotiation.</p>
 
     <h2>The Negotiation Methods</h2>
     After Apache has obtained a list of the variants for a given
     resource, either from a type-map file or from the filenames in
     the directory, it invokes one of two methods to decide on the
     'best' variant to return, if any. It is not necessary to know
@@ -480,39 +428,54 @@
     wildcards of the format "type/*" to 0.02 (so these are
     preferred over matches against "*/*". If any media type on the
     Accept: header contains a q factor, these special values are
     <em>not</em> applied, so requests from browsers which send the
     correct information to start with work as expected.</p>
 
-    <h3>Variants with no Language</h3>
-
-    <p>If some of the variants for a particular resource have a
-    language attribute, and some do not, those variants with no
-    language are given a very low language quality factor of
-    0.001.</p>
-
-    <p>The reason for setting this language quality factor for
-    variant with no language to a very low value is to allow for a
-    default variant which can be supplied if none of the other
-    variants match the browser's language preferences. For example,
-    consider the situation with three variants:</p>
+    <h3>Language Negotiation Exceptions</h3>
 
-    <ul>
-      <li>foo.en.html, language en</li>
+    <p>New in Apache 2.0, some exceptions have been added to the
+    negotiation algorithm to allow graceful fallback when language
+    negotiation fails to find a match.</p>
+
+    <p>When a client requests a page on your server, but the server
+    cannot find a single page that matches the Accept-language sent by
+    the browser, the server will return either a "No Acceptable
+    Variant" or "Multiple Choices" response to the client.  To avoid
+    these error messages, it is possible to configure Apache to ignore
+    the Accept-language in these cases and provide a document that
+    does not explictly match the client's request.  The <a
+    href="mod/mod_negotiation.html#forcelanguagepriority">ForceLanguagePriority</a>
+    directive can be used to override one or both of these error
+    messages and subsitute the servers judgement in the form of the <a
+    href="mod/mod_negotiation.html#languagepriority">LanguagePriority</a>
+    directive.</p>
+
+    <p>The server will also attempt to match language-subsets when no
+    other match can be found.  For example, if a client requests
+    documents with the language <code>en-GB</code> for British
+    English, the server is not normally allowed by the HTTP/1.1
+    standard to match that against a document that is marked as simply
+    <code>en</code>.  (Note that it is almost surely a configuration
+    error to include <code>en-GB</code> and not <code>en</code> in the
+    Accept-Language header, since it is very unlikely that a reader
+    understands British English, but doesn't understand English in
+    general.  Unfortunately, many current clients have default
+    configurations that resemble this.)  However, if no other language
+    match is possible and the server is about to return a "No
+    Acceptable Variants" error or fallback to the
+    <code>LanguagePriority</code>, the server will ignore the subset
+    specification and match <code>en-GB</code> against <code>en</code>
+    documents.  Implicitly, Apache will add the parent language to
+    the client's acceptable language list with a very low quality
+    value.  But note that if the client requests "en-GB; qs=0.9, fr;
+    qs=0.8", and the server has documents designated "en" and "fr",
+    then the "fr" document will be returned.  This is necessary to
+    maintain compliance with the HTTP/1.1 specification and to work
+    effectively with properly configured clients.</p>
 
-      <li>foo.fr.html, language en</li>
-
-      <li>foo.html, no language</li>
-    </ul>
-
-    <p>The meaning of a variant with no language is that it is
-    always acceptable to the browser. If the request
-    Accept-Language header includes either en or fr (or both) one
-    of foo.en.html or foo.fr.html will be returned. If the browser
-    does not list either en or fr as acceptable, foo.html will be
-    returned instead.</p>
 
     <h2>Extensions to Transparent Content Negotiation</h2>
     Apache extends the transparent content negotiation protocol
     (RFC 2295) as follows. A new <code>{encoding ..}</code> element
     is used in variant lists to label variants which are available
     with a specific content-encoding only. The implementation of
@@ -648,17 +611,25 @@
     <p>For requests which come from a HTTP/1.0 compliant client
     (either a browser or a cache), the directive
     <tt>CacheNegotiatedDocs</tt> can be used to allow caching of
     responses which were subject to negotiation. This directive can
     be given in the server config or virtual host, and takes no
     arguments. It has no effect on requests from HTTP/1.1 clients. 
+
+    <h2>More Information</h2>
+
+    <p>For more information about content negotiation, see Alan
+    J. Flavell's <a
+    href="http://ppewww.ph.gla.ac.uk/~flavell/www/lang-neg.html">Language
+    Negotiation Notes</a>.  But note that this document may not be
+    updated to include changes in Apache 2.0.</p>
+
         <hr />
 
     <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="images/index.gif" alt="Index" /></a>
 
 
 
-    </p>
   </body>
 </html>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: custom-error.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: custom-error.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: custom-error.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/developer/filters.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/developer/filters.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/developer/filters.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/developer/filters.html	2002-06-18 11:46:44.000000000 +0800
@@ -2,13 +2,13 @@
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
     <meta name="generator" content="HTML Tidy, see www.w3.org" />
 
-    <title>Request Processing in Apache 2.0</title>
+    <title>How filters work in Apache 2.0</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
         <div align="CENTER">
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/dso.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/dso.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/dso.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/dso.html	2002-06-18 11:46:44.000000000 +0800
@@ -67,13 +67,13 @@
 
     <p>The DSO support for loading individual Apache modules is
     based on a module named <a
     href="mod/mod_so.html"><code>mod_so.c</code></a> which must be
     statically compiled into the Apache core. It is the only module
     besides <code>core.c</code> which cannot be put into a DSO
-    itself. Practically all other distributed Apache modules then
+    itself. Practically all other distributed Apache modules
     can then be placed into a DSO by individually enabling the DSO
     build for them via <code>configure</code>'s
     <code>--enable-<i>module</i>=shared</code> option as disucussed
     in the <a href="install.html">install documentation</a>. After
     a module is compiled into a DSO named <code>mod_foo.so</code>
     you can use <a href="mod/mod_so.html"><code>mod_so</code></a>'s
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: dso.html.ko.euc-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: env.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: env.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: env.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: filter.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: filter.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: filter.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/handler.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/handler.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/handler.html.en	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/handler.html.en	2002-06-18 11:46:44.000000000 +0800
@@ -143,13 +143,13 @@
     <hr />
 
     <h2><a id="programmer" name="programmer">Programmer's
     Note</a></h2>
 
     <p>In order to implement the handler features, an addition has
-    been made to the <a href="misc/API.html">Apache API</a> that
+    been made to the <a href="developer/API.html">Apache API</a> that
     you may wish to make use of. Specifically, a new record has
     been added to the <code>request_rec</code> structure:</p>
 <pre>
     char *handler
 </pre>
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/handler.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/handler.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/handler.html.ja.jis	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/handler.html.ja.jis	2002-06-18 11:46:44.000000000 +0800
@@ -4,13 +4,13 @@
 <html xmlns="http://www.w3.org/1999/xhtml"   xml:lang="ja" lang="ja">
   <head>
 
     <title>Apache $B$N%O%s%I%i$N;HMQ(B</title>
 
   </head>
-  <!-- English revision: 1.23 -->
+  <!-- English revision: 1.24 -->
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
   <body bgcolor="#ffffff" text="#000000" link="#0000ff"
   vlink="#000080" alink="#ff0000">
         <div align="CENTER">
       <img src="images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
@@ -143,13 +143,13 @@
     <hr />
 
     <h2><a id="programmer"
     name="programmer">$B%W%m%0%i%^8~$1$N%a%b(B</a></h2>
 
     <p>$B%O%s%I%i$N5!G=$r<BAu$9$k$?$a$K!"MxMQ$9$k$HJXMx$+$b$7$l$J$$$b$N$,(B
-    <a href="misc/api.html">Apache API</a>
+    <a href="developer/API.html">Apache API</a>
     $B$KDI2C$5$l$^$7$?!#>\$7$/8@$&$H!"(B<code>request_rec</code>
     $B9=B$BN$K?7$7$$%l%3!<%I$,DI2C$5$l$?$H$$$&$3$H$G$9!#(B</p>
 <pre>
     char *handler
 </pre>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/howto: auth.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto: auth.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto: auth.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/howto/ssi.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto/ssi.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/howto/ssi.html.en	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto/ssi.html.en	2002-06-18 11:46:44.000000000 +0800
@@ -491,13 +491,13 @@
     structure for building conditional statements. This allows you
     to effectively generate multiple logical pages out of one
     actual page.</p>
 
     <p>The structure of this conditional construct is:</p>
 <pre>
-        &lt;!--#if expr="test_condition" --&gt;
+    &lt;!--#if expr="test_condition" --&gt;
     &lt;!--#elif expr="test_condition" --&gt;
     &lt;!--#else --&gt;
     &lt;!--#endif --&gt;
 </pre>
 
     <p>A <em>test_condition</em> can be any sort of logical
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/howto/ssi.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto/ssi.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/howto/ssi.html.ja.jis	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/howto/ssi.html.ja.jis	2002-06-18 11:46:44.000000000 +0800
@@ -1,507 +1,555 @@
-<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
-<html>
-<head>
-<title>Apache $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</title>
-<!-- link rev="made" href="mailto:rbowen@rcbowen.com" -->
-</head>
-<!-- English revision: 1.7 -->
-<!-- Background white, links blue (unvisited), navy (visited), red (active) -->
-<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#000080"
-alink="#FF0000">
-    <div align="CENTER">
+<?xml version="1.0" encoding="iso-2022-jp"?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
+  <head>
+
+    <title>Apache $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</title>
+
+    <!-- link rev="made" href="mailto:rbowen@rcbowen.com" -->
+
+  </head>
+  <!-- English revision: 1.12 -->
+  <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
+  <body bgcolor="#ffffff" text="#000000" link="#0000ff"
+  vlink="#000080" alink="#ff0000">
+        <div align="CENTER">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
-<h1 align="CENTER">Apache $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</h1>
 
-<a name="__index__"></a> <!-- INDEX BEGIN -->
- 
+    <h1 align="center">Apache $B%A%e!<%H%j%"%k(B: Server Side Includes
+    $BF~Lg(B</h1>
 
-<ul>
-<li><a href="#apachetutorial:introductiontoserversideincludes">Apache
- $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</a></li>
-
-<li><a href="#whataressi">SSI $B$H$O(B?</a></li>
-
-<li><a href="#configuringyourservertopermitssi">SSI $B$r5v2D$9$k$?$a$N(B
-$B%5!<%P$N@_Dj(B</a></li>
-
-<li><a href="#basicssidirectives">$B4pK\E*$J(B SSI $B%G%#%l%/%F%#%V(B</a>
-
-<ul>
-  <li><a href="#today'sdate">$B:#F|$NF|IU(B</a></li>
-
-  <li><a href="#modificationdateofthefile">$B%U%!%$%k$NJQ99F|(B</a></li>
-
-  <li><a href="#includingtheresultsofacgiprogram">CGI $B%W%m%0%i%`$N7k2L$r(B
-$B<h$j9~$`(B</a></li>
-</ul>
-</li>
-
-<li><a href="#additionalexamples">$BDI2C$NNc(B</a>
-
-<ul>
-<li><a href="#whenwasthisdocumentmodified">$B$$$D$3$N%I%-%e%a%s%H$O(B
-$B=$@5$5$l$?$N$+(B?</a></li>
-
-<li><a href="#includingastandardfooter">$BI8=`$N%U%C%?$rA^F~$9$k(B</a></li>
-
-<li><a href="#whatelsecaniconfig">$BB>$K2?$,@_Dj$G$-$k$N$+(B?</a></li>
-
-<li><a href="#executingcommands">$B%3%^%s%I$N<B9T(B</a></li>
-</ul>
-</li>
-
-<li><a href="#advancedssitechniques">$B9bEY$J(B SSI $B%F%/%K%C%/(B</a>
-
-<ul>
-<li><a href="#settingvariables">$BJQ?t$r@_Dj$9$k(B</a></li>
-
-<li><a href="#conditionalexpressions">$B>r7o<0(B</a></li>
-</ul>
-</li>
-
-<li><a href="#conclusion">$B=*$o$j$K(B</a></li>
-</ul>
-
-<!-- INDEX END -->
-<hr>
-<h2><a name=
-"apachetutorial:introductiontoserversideincludes">Apache
-$B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</a></h2>
-
-<table border="1">
-<tr>
-<td valign="top"><strong>$B4XO"%b%8%e!<%k(B</strong><br>
-<br>
- <a href="../mod/mod_include.html">mod_include</a><br>
-<a href="../mod/mod_cgi.html">mod_cgi</a><br>
-<a href="../mod/mod_expires.html">mod_expires</a><br>
- </td>
-<td valign="top"><strong>$B4XO"%G%#%l%/%F%#%V(B</strong><br>
-<br>
- <a href="../mod/core.html#options">Options</a><br>
-<a href="../mod/mod_include.html#xbithack">XBitHack</a><br>
-<a href="../mod/mod_mime.html#addtype">AddType</a><br>
-<a href="../mod/mod_mime.html#addhandler">AddHandler</a><br>
-<a href=
-"../mod/mod_setenvif.html#BrowserMatchNoCase">BrowserMatchNoCase</a><br>
-
- </td>
-</tr>
-</table>
-
-<p>$B$3$NJ8=q$O:G=i!"(BApache Today (http://www.apachetoday.com/) $B$K;02s$NO":\5-;v$H$7$F7G:\$5$l$^$7$?!#(B
-$B$3$3$G$O!"(BApcheToday $B$H(B Internet.com $B$H$N6(Dj$K$h$j:\$;$F$$$^$9!#(B</p>
-
-<p>$B$3$N5-;v$O!"DL>o$OC1$K(B SSI $B$H8F$P$l$k(B Server Side Includes $B$r(B
-$B07$$$^$9!#$3$N5-;v$K$*$$$F$O!"%5!<%P$G$N(B SSI $B$r5v2D$9$k$?$a$N@_Dj$H!"(B
-$B8=:_$N(B HTML $B%Z!<%8$KF0E*$J%3%s%F%s%D$r2C$($k$?$a$N$$$/$D$+$N4pK\E*$J(B
-SSI $B5;=Q$r>R2p$7$^$9!#(B</p>
-
-<p>$B5-;v$N8eH>$G$O!"(BSSI $B%G%#%l%/%F%#%V$G(B
-SSI $B$H6&$K<B9T$9$k$3$H$,$G$-$k>r7oJ8$N$h$&$J4vJ,9bEY$J;vJA$K(B
-$B$D$$$F=R$Y$F$$$^$9!#(B</p>
-
-<hr>
-<h2><a name="whataressi">SSI $B$H$O(B?</a></h2>
-
-<p>SSI (Server Side Includes) $B$O!"(BHTML $B%Z!<%8Cf$KG[CV$5$l$k%G%#%l%/%F%#%V$G$"$j!"(B
-$B%5!<%P$G%Z!<%8$rDs6!$9$k;~$KI>2A$5$l$^$9!#(B
-SSI $B$O!"(BCGI $B%W%m%0%i%`$d$=$NB>$NF0E*$J5;=Q$GA4$F$N%Z!<%8$rDs6!(B
-$B$;$:$K!"F0E*$K@8@.$5$l$?%3%s%F%s%D$r8=:_$N(B HTML $B%Z!<%8$K(B
-$B2C$($^$9!#(B</p>
-
-<p>$B$I$&$$$&>l9g$K(B SSI $B$r;H$$!"$I$&$$$&>l9g$K%W%m%0%i%`$G%Z!<%8$r40A4$K@8@.$9$k$+(B
-$B$O!"%Z!<%8$N$&$A$I$NDxEY$,@EE*$G$"$j!"%Z!<%8$,Ds6!$5$l$k$?$S$K(B
-$B:F7W;;$9$kI,MW$,$I$NDxEY$"$k$+$GDL>o$O7hDj$7$^$9!#(BSSI $B$O8=:_;~9o$N$h$&$J(B
-$B>.$5$$>pJs$r2C$($k$K$O$&$C$F$D$1$NJ}K!$G$9!#(B
-$B$7$+$7!"$=$N%Z!<%8$N$[$H$s$I$NItJ,$,Ds6!;~$K@8@.$5$l$k>l9g$O!"(B
-$BB>$NJ}K!$rC5$9I,MW$,$"$j$^$9!#(B</p>
-
-<hr>
-<h2><a name="configuringyourservertopermitssi">SSI $B$r5v2D$9$k$?$a$N(B
-$B%5!<%P$N@_Dj(B</a></h2>
+    <a id="__index__" name="__index__"></a> <!-- INDEX BEGIN -->
 
-<p>$B%5!<%P$G(B SSI $B5v2D$9$k$K$O!"(B<code>httpd.conf</code> $B%U%!%$%k(B
-$B$^$?$O(B <code>.htaccess</code> $B%U%!%$%k$K<!$N%G%#%l%/%F%#%V$r;XDj$9$kI,MW$,$"$j$^$9(B:</p>
+    <ul>
+      <li><a
+      href="#apachetutorial:introductiontoserversideincludes">Apache
+      $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</a></li>
 
+      <li><a href="#whataressi">SSI $B$H$O(B?</a></li>
+
+      <li><a href="#configuringyourservertopermitssi">SSI
+      $B$r5v2D$9$k$?$a$N%5!<%P$N@_Dj(B</a></li>
+
+      <li>
+        <a href="#basicssidirectives">$B4pK\E*$J(B SSI $B%G%#%l%/%F%#%V(B</a>
+
+        <ul>
+          <li><a href="#today'sdate">$B:#F|$NF|IU(B</a></li>
+
+          <li><a href="#modificationdateofthefile">$B%U%!%$%k$NJQ99F|(B</a></li>
+
+          <li><a href="#includingtheresultsofacgiprogram">CGI
+          $B%W%m%0%i%`$N7k2L$r<h$j9~$`(B</a></li>
+        </ul>
+      </li>
+
+      <li>
+        <a href="#additionalexamples">$BDI2C$NNc(B</a>
+
+        <ul>
+          <li><a href="#whenwasthisdocumentmodified"
+          >$B$$$D$3$N%I%-%e%a%s%H$O=$@5$5$l$?$N$+(B?</a></li>
+
+          <li><a href="#includingastandardfooter"
+          >$BI8=`$N%U%C%?$rA^F~$9$k(B</a></li>
+
+          <li><a
+          href="#whatelsecaniconfig">$BB>$K2?$,@_Dj$G$-$k$N$+(B?</a></li>
+
+          <li><a href="#executingcommands">$B%3%^%s%I$N<B9T(B</a></li>
+        </ul>
+      </li>
+
+
+
+      <li>
+        <a href="#advancedssitechniques">$B9bEY$J(B SSI $B%F%/%K%C%/(B</a>
+
+
+        <ul>
+          <li><a href="#settingvariables">$BJQ?t$r@_Dj$9$k(B</a></li>
+
+
+          <li><a href="#conditionalexpressions">$B>r7o<0(B</a></li>
+
+        </ul>
+      </li>
+
+      <li><a href="#conclusion">$B=*$o$j$K(B</a></li>
+    </ul>
+    <!-- INDEX END -->
+    <hr />
+
+    <h2><a id="apachetutorial:introductiontoserversideincludes"
+    name="apachetutorial:introductiontoserversideincludes">Apache
+    $B%A%e!<%H%j%"%k(B: Server Side Includes $BF~Lg(B</a></h2>
+
+    <table border="1">
+      <tr>
+        <td valign="top"><strong>$B4XO"%b%8%e!<%k(B</strong><br />
+         <br />
+         <a href="../mod/mod_include.html">mod_include</a><br />
+         <a href="../mod/mod_cgi.html">mod_cgi</a><br />
+         <a href="../mod/mod_expires.html">mod_expires</a><br />
+        </td>
+
+        <td valign="top"><strong>$B4XO"%G%#%l%/%F%#%V(B</strong><br />
+         <br />
+         <a href="../mod/core.html#options">Options</a><br />
+         <a href="../mod/mod_include.html#xbithack">XBitHack</a>
+         <br />
+         <a href="../mod/mod_mime.html#addtype">AddType</a><br />
+         <a href="../mod/core.html#setoutputfilter">SetOutputFilter</a>
+         <br />
+         <a href="../mod/mod_setenvif.html#browsermatchnocase"
+         >BrowserMatchNoCase</a><br />
+        </td>
+      </tr>
+    </table>
+
+    <p>$B$3$N5-;v$O!"DL>o$OC1$K(B SSI $B$H8F$P$l$k(B Server Side Includes
+    $B$r07$$$^$9!#$3$N5-;v$K$*$$$F$O!"%5!<%P$G$N(B SSI $B$r5v2D$9$k$?$a$N@_Dj$H!"(B
+    $B8=:_$N(B HTML $B%Z!<%8$KF0E*$J%3%s%F%s%D$r2C$($k$?$a$N$$$/$D$+$N4pK\E*$J(B
+    SSI $B5;=Q$r>R2p$7$^$9!#(B</p>
+
+    <p>$B5-;v$N8eH>$G$O!"(BSSI $B%G%#%l%/%F%#%V$G(B SSI
+    $B$H6&$K<B9T$9$k$3$H$,$G$-$k>r7oJ8$N$h$&$J(B
+    $B4vJ,9bEY$J;vJA$K$D$$$F=R$Y$F$$$^$9!#(B</p>
+    <hr />
+
+    <h2><a id="whataressi" name="whataressi">SSI $B$H$O(B?</a></h2>
+
+    <p>SSI (Server Side Includes) $B$O!"(BHTML
+    $B%Z!<%8Cf$KG[CV$5$l$k%G%#%l%/%F%#%V$G$"$j!"(B
+    $B%5!<%P$G%Z!<%8$rDs6!$9$k;~$KI>2A$5$l$^$9!#(BSSI $B$O!"(BCGI
+    $B%W%m%0%i%`$d$=$NB>$NF0E*$J5;=Q$GA4$F$N%Z!<%8$rDs6!$;$:$K!"(B
+    $BF0E*$K@8@.$5$l$?%3%s%F%s%D$r8=:_$N(B HTML $B%Z!<%8$K2C$($^$9!#(B</p>
+
+    <p>$B$I$&$$$&>l9g$K(B SSI $B$r;H$$!"$I$&$$$&>l9g$K%W%m%0%i%`$G(B
+    $B%Z!<%8$r40A4$K@8@.$9$k$+$O!"%Z!<%8$N$&$A$I$NDxEY$,@EE*$G$"$j!"(B
+    $B%Z!<%8$,Ds6!$5$l$k$?$S$K:F7W;;$9$kI,MW$,$I$NDxEY$"$k$+$GDL>o$O7hDj$7$^$9!#(B
+    SSI $B$O8=:_;~9o$N$h$&$J>.$5$$>pJs$r2C$($k$K$O$&$C$F$D$1$NJ}K!$G$9!#(B
+    $B$7$+$7!"$=$N%Z!<%8$N$[$H$s$I$NItJ,$,Ds6!;~$K@8@.$5$l$k>l9g$O!"(B
+    $BB>$NJ}K!$rC5$9I,MW$,$"$j$^$9!#(B</p>
+    <hr />
+
+    <h2><a id="configuringyourservertopermitssi"
+    name="configuringyourservertopermitssi">SSI
+    $B$r5v2D$9$k$?$a$N%5!<%P$N@_Dj(B</a></h2>
+
+    <p>$B%5!<%P$G(B SSI $B$r5v2D$9$k$K$O!"(B<code>httpd.conf</code>
+    $B%U%!%$%k$^$?$O(B <code>.htaccess</code>
+    $B%U%!%$%k$K<!$N%G%#%l%/%F%#%V$r;XDj$9$kI,MW$,$"$j$^$9(B:</p>
 <pre>
         Options +Includes
 </pre>
 
-<p>$B$3$N;XDj$O!"%U%!%$%k$r(B SSI $B%G%#%l%/%F%#%V$G2r@O$5$;$k$3$H$r5v2D$9$k(B
-$B$H$$$&$3$H$r(B Apache $B$KEA$($^$9!#(B</p>
-
-<p>$BA4$F$N%U%!%$%k$,(B SSI $B%G%#%l%/%F%#%V$G2r@O$5$l$k$H$$$&$o$1$G$O$"$j$^$;$s!#(B
-$B$I$N%U%!%$%k$,2r@O$5$l$k$+$r(B Apache $B$KEA$($kI,MW$,$"$j$^$9!#$3$l$r(B
-$B9T$J$&$K$OFs$DJ}K!$,$"$j$^$9!#<!$N%G%#%l%/%F%#%V$r;H$&$3$H$G!"(B
-$BNc$($P(B <code>.shtml</code> $B$N$h$&$JFCJL$J%U%!%$%k3HD%;R$r;}$D%U%!%$%k$r(B
-$B2r@O$9$k$h$&(B Apache $B$KEA$($k$3$H$,$G$-$^$9(B:</p>
-
+    <p>$B$3$N;XDj$O!"%U%!%$%k$r(B SSI
+    $B%G%#%l%/%F%#%V$G2r@O$5$;$k$3$H$r5v2D$9$k$H$$$&$3$H$r(B Apache
+    $B$KEA$($^$9!#$[$H$s$I$N@_Dj$G$O$*8_$$$r>e=q$-$G$-$k!"J#?t$N(B
+    <a href="../mod/core.html#options">Options</a> $B$,$"$k$3$H$K(B
+    $BCm0U$7$F$/$@$5$$!#$*$=$i$/!"@_Dj$,:G8e$KI>2A$5$l$k$3$H$r(B
+    $BJ]>Z$5$l$k$?$a$K!"(BSSI $B$r;HMQ$7$?$$%G%#%l%/%H%j$K(B <code>Options</code>
+    $B%G%#%l%/%F%#%V$rE,MQ$9$kI,MW$,$"$k$G$7$g$&!#(B</p>
+
+    <p>$BA4$F$N%U%!%$%k$,(B SSI
+    $B%G%#%l%/%F%#%V$G2r@O$5$l$k$H$$$&$o$1$G$O$"$j$^$;$s!#(B
+    $B$I$N%U%!%$%k$,2r@O$5$l$k$+$r(B Apache $B$KEA$($kI,MW$,$"$j$^$9!#(B
+    $B$3$l$r9T$J$&$K$OFs$DJ}K!$,$"$j$^$9!#(B
+    $B<!$N%G%#%l%/%F%#%V$r;H$&$3$H$G!"Nc$($P(B <code>.shtml</code>
+    $B$N$h$&$JFCJL$J%U%!%$%k3HD%;R$r;}$D%U%!%$%k$r2r@O$9$k$h$&(B
+    Apache $B$KEA$($k$3$H$,$G$-$^$9(B:</p>
 <pre>
         AddType text/html .shtml
-        AddHandler server-parsed .shtml
+	AddOutputFilter INCLUDES .shtml
 </pre>
+    <p>$B$3$NJ}K!$N7gE@$O!"$b$78=:_$N%Z!<%8$K(B SSI $B%G%#%l%/%F%#%V$r2C$($?$$>l9g!"(B
+    $B$=$l$i$N%G%#%l%/%F%#%V$,<B9T$5$l$k$h$&$K(B 
+    <code>.shtml</code> $B3HD%;R$K$9$k$?$a!"$=$N%Z!<%8$NL>A0$H!"(B
+    $B$=$N%Z!<%8$X$NA4$F$N%j%s%/$rJQ99$7$J$1$l$P$J$i$J$$$3$H$G$9!#(B</p>
 
-<p>$B$3$NJ}K!$N7gE@$O!"$b$78=:_$N%Z!<%8$K(B SSI 
-$B%G%#%l%/%F%#%V$r2C$($?$$>l9g!"$=$l$i$N%G%#%l%/%F%#%V$,<B9T$5$l$k(B
-$B$h$&$K(B <code>.shtml</code> $B3HD%;R$K$9$k$?$a!"$=$N%Z!<%8$NL>A0$H!"(B
-$B$=$N%Z!<%8$X$NA4$F$N%j%s%/$rJQ99$7$J$1$l$P$J$i$J$$$3$H$G$9!#(B</p>
-
-<p>$B$b$&0l$D$NJ}K!$O!"(B<code>XBitHack</code> $B%G%#%l%/%F%#%V$r;HMQ$9$k$3$H$G$9(B:</p>
-
+    <p>$B$b$&0l$D$NJ}K!$O!"(B<code>XBitHack</code>
+    $B%G%#%l%/%F%#%V$r;HMQ$9$k$3$H$G$9(B:</p>
 <pre>
         XBitHack on
 </pre>
 
-<p><code>XBitHack</code> $B$O!"%U%!%$%k$N<B9T%S%C%H$,N)$C$F$$$k>l9g!"(B
-SSI $B%G%#%l%/%F%#%V$K$h$j2r@O$9$k$3$H$r(B Apache $B$KEA$($^$9!#=>$C$F!"(B
-SSI $B%G%#%l%/%F%#%V$r8=:_$N%Z!<%8$K2C$($k$?$a$K$O!"%U%!%$%kL>$rJQ99$7$J$/$F$b$h$/!"(B
-$BC1$K(B <code>chmod</code> $B$r;HMQ$7$F%U%!%$%k$r<B9T2DG=$K$9$k(B
-$B$@$1$G:Q$_$^$9!#(B</p>
-
+    <p><code>XBitHack</code> $B$O!"%U%!%$%k$N<B9T%S%C%H$,N)$C$F$$$k>l9g!"(B
+    SSI $B%G%#%l%/%F%#%V$K$h$j2r@O$9$k$3$H$r(B Apache $B$KEA$($^$9!#(B
+    $B=>$C$F!"(BSSI $B%G%#%l%/%F%#%V$r8=:_$N%Z!<%8$K2C$($k$?$a$K$O!"(B
+    $B%U%!%$%kL>$rJQ99$7$J$/$F$b$h$/!"C1$K(B <code>chmod</code>
+    $B$r;HMQ$7$F%U%!%$%k$r<B9T2DG=$K$9$k$@$1$G:Q$_$^$9!#(B</p>
 <pre>
         chmod +x pagename.html
 </pre>
 
-<p>$B9T$J$&$Y$-$G$O$J$$$3$H$K4X$9$kC;$$%3%a%s%H!#;~!9C/$+$,!"(B
-$BA4$F$N(B <code>.html</code> $B%U%!%$%k$r(B SSI $B$G2r@O$9$k$h$&(B Apache $B$KEA$($l$P!"(B
-$B$o$6$o$6(B <code>.shtml</code> $B$H$$$&%U%!%$%kL>$K$9$kI,MW$,$J$$$H$$$C$F(B
-$BA&$a$k$N$r8+$k$3$H$G$7$g$&!#$3$&$$$&?M$?$A$O!"$*$=$i$/(B <code>XBitHack</code>
-$B$K$D$$$FJ9$$$?$3$H$,$J$$$N$G$7$g$&!#$3$NJ}K!$K$D$$$FCm0U$9$k$3$H$O!"(B
-$B$?$H$((B SSI $B%G%#%l%/%F%#%V$rA4$/4^$^$J$$>l9g$G$b!"(BApache $B$,%/%i%$%"%s%H$K(B
-$BAw$kA4$F$N%U%!%$%k$r:G8e$^$GFI$_9~$^$;$k$3$H$K$J$j$^$9!#(B
-$B$3$NJ}K!$O$+$J$j=hM}$rCY$/$9$k$b$N$G$"$j!"NI$/$J$$%"%$%G%"$G$9!#(B</p>
-
-<p>$B$b$A$m$s!"(BWindows $B$G$O$=$N$h$&$J<B9T%S%C%H$r%;%C%H$9$k$h$&$J$b$N$O(B
-$B$"$j$^$;$s$N$G%*%W%7%g%s$,>/$7@)8B$5$l$F$$$^$9!#(B</p>
-
-<p>$B%G%U%)%k%H$N@_Dj$G$O!"(BApache $B$O(B SSI $B%Z!<%8$K$D$$$F:G=*JQ99;~9o$d(B
-$B%3%s%F%s%D$ND9$5$r(B HTTP $B%X%C%@$KAw$j$^$;$s!#(B
-$BF0E*$J%3%s%F%s%D$G$"$k$?$a!"$=$l$i$NCM$r7W;;$9$k$N$,Fq$7$$$+$i$G$9!#(B
-$B$3$N$?$a%I%-%e%a%s%H$,(B
-$B%-%c%C%7%e$5$l$J$/$J$j!"7k2L$H$7$F%/%i%$%"%s%H$N@-G=$,(B
-$BCY$/$J$C$?$h$&$K46$8$5$;$k$3$H$K$J$j$^$9!#(B
-$B$3$l$r2r7h$9$kJ}K!$,Fs$D$"$j$^$9(B:</p>
-
-<ol> 
-
-<li><code>XBitHack Full</code> $B@_Dj$r;HMQ$9$k!#$3$N@_Dj$K$h$j!"$b$H$b$HMW5a$5$l$?(B
-$B%U%!%$%k$N;~9o$r;2>H$7!"FI$_9~$^$l$k%U%!%$%k$NJQ99;~9o$r(B
-$BL5;k$7$F:G=*JQ99;~9o$r7hDj$9$k$h$&(B Apache $B$KEA$($^$9!#(B</li>
-
-<li><a href="../mod/mod_expires.html">mod_expires</a> $B$GDs6!$5$l$F$$$k%G%#%l%/%F%#%V$r;HMQ$7$F!"(B
-$B%U%!%$%k$,L58z$K$J$k;~9o$rL@<($7$^$9!#(B
-$B$3$l$K$h$j!"%V%i%&%6$H%W%m%-%7$K%-%c%C%7%e$,M-8z$G$"$k$3$H$rDLCN$7$^$9!#(B</li>
-
-</ol>
+    <p>$B9T$J$&$Y$-$G$O$J$$$3$H$K4X$9$kC;$$%3%a%s%H!#;~!9C/$+$,!"A4$F$N(B
+    <code>.html</code> $B%U%!%$%k$r(B SSI $B$G2r@O$9$k$h$&(B Apache $B$KEA$($l$P!"(B
+    $B$o$6$o$6(B <code>.shtml</code> $B$H$$$&%U%!%$%kL>$K$9$kI,MW$,$J$$$H$$$C$F(B
+    $BA&$a$k$N$r8+$k$3$H$G$7$g$&!#$3$&$$$&?M$?$A$O!"$*$=$i$/(B
+    <code>XBitHack</code> $B$K$D$$$FJ9$$$?$3$H$,$J$$$N$G$7$g$&!#(B
+    $B$3$NJ}K!$K$D$$$FCm0U$9$k$3$H$O!"$?$H$((B SSI
+    $B%G%#%l%/%F%#%V$rA4$/4^$^$J$$>l9g$G$b!"(BApache $B$,%/%i%$%"%s%H$K(B
+    $BAw$kA4$F$N%U%!%$%k$r:G8e$^$GFI$_9~$^$;$k$3$H$K$J$j$^$9!#(B
+    $B$3$NJ}K!$O$+$J$j=hM}$rCY$/$9$k$b$N$G$"$j!"NI$/$J$$%"%$%G%"$G$9!#(B</p>
+
+    <p>$B$b$A$m$s!"(BWindows $B$G$O$=$N$h$&$J<B9T%S%C%H$r%;%C%H(B
+    $B$9$k$h$&$J$b$N$O$"$j$^$;$s$N$G%*%W%7%g%s$,>/$7@)8B$5$l$F$$$^$9!#(B</p>
+
+    <p>$B%G%U%)%k%H$N@_Dj$G$O!"(BApache $B$O(B SSI $B%Z!<%8$K$D$$$F:G=*JQ99;~9o$d(B
+    $B%3%s%F%s%D$ND9$5$r(B HTTP $B%X%C%@$KAw$j$^$;$s!#(B
+    $BF0E*$J%3%s%F%s%D$G$"$k$?$a!"$=$l$i$NCM$r7W;;$9$k$N$,Fq$7$$$+$i$G$9!#(B
+    $B$3$N$?$a%I%-%e%a%s%H$,%-%c%C%7%e$5$l$J$/$J$j!"(B
+    $B7k2L$H$7$F%/%i%$%"%s%H$N@-G=$,CY$/$J$C$?$h$&$K46$8$5$;$k$3$H$K$J$j$^$9!#(B
+    $B$3$l$r2r7h$9$kJ}K!$,Fs$D$"$j$^$9(B:</p>
+
+    <ol>
+      <li><code>XBitHack Full</code> $B@_Dj$r;HMQ$9$k!#(B
+      $B$3$N@_Dj$K$h$j!"$b$H$b$HMW5a$5$l$?%U%!%$%k$N;~9o$r;2>H$7!"(B
+      $BFI$_9~$^$l$k%U%!%$%k$NJQ99;~9o$rL5;k$7$F:G=*JQ99;~9o$r7hDj$9$k$h$&(B
+      Apache $B$KEA$($^$9!#(B</li>
+
+      <li><a href="../mod/mod_expires.html">mod_expires</a>
+      $B$GDs6!$5$l$F$$$k%G%#%l%/%F%#%V$r;HMQ$7$F!"(B
+      $B%U%!%$%k$,L58z$K$J$k;~9o$rL@<($7$^$9!#$3$l$K$h$j!"(B
+      $B%V%i%&%6$H%W%m%-%7$K%-%c%C%7%e$,M-8z$G$"$k$3$H$rDLCN$7$^$9!#(B
+      </li>
+    </ol>
+    <hr />
 
-<hr>
-<h2><a name="basicssidirectives">$B4pK\E*$J(B SSI $B%G%#%l%/%F%#%V(B</a></h2>
-
-<p>SSI $B%G%#%l%/%F%#%V$O0J2<$NJ8K!$G5-=R$7$^$9(B:</p>
+    <h2><a id="basicssidirectives" name="basicssidirectives">$B4pK\E*$J(B
+    SSI $B%G%#%l%/%F%#%V(B</a></h2>
 
+    <p>SSI $B%G%#%l%/%F%#%V$O0J2<$NJ8K!$G5-=R$7$^$9(B:</p>
 <pre>
         &lt;!--#element attribute=value attribute=value ... --&gt;
 </pre>
 
-<p>HTML $B$N%3%a%s%H$N$h$&$J=q<0$r$7$F$$$k$N$G!"$b$7(B SSI $B$r(B
-$B@5$7$/F0:n2DG=$K$7$J$1$l$P!"%V%i%&%6$O$=$l$rL5;k$9$k$G$7$g$&!#$7$+$7!"(B
-HTML $B%=!<%9Cf$G$O8+$($^$9!#$b$7(B SSI $B$r@5$7$/@_Dj$7$?$J$i!"(B
-$B%G%#%l%/%F%#%V$O$=$N7k2L$HCV$-49$($i$l$^$9!#(B</p>
-
-<p>element $B$O$?$/$5$s$"$k$b$N$+$i0l$D;XDj$9$k$3$H$,$G$-$^$9!#(B
-$B;XDj$G$-$k$b$N$NBgB??t$K$D$$$F$O!"<!2s$b$&>/$7>\$7$/@bL@$7$^$9!#(B
-$B$3$3$G$O!"(BSSI $B$G9T$J$&$3$H$,$G$-$kNc$r$$$/$D$+<($7$^$9!#(B</p>
+    <p>HTML $B$N%3%a%s%H$N$h$&$J=q<0$r$7$F$$$k$N$G!"$b$7(B SSI
+    $B$r@5$7$/F0:n2DG=$K$7$J$1$l$P!"%V%i%&%6$O$=$l$rL5;k$9$k$G$7$g$&!#(B
+    $B$7$+$7!"(BHTML $B%=!<%9Cf$G$O8+$($^$9!#$b$7(B SSI $B$r@5$7$/@_Dj$7$?$J$i!"(B
+    $B%G%#%l%/%F%#%V$O$=$N7k2L$HCV$-49$($i$l$^$9!#(B</p>
+
+    <p>element $B$O$?$/$5$s$"$k$b$N$+$i0l$D;XDj$9$k$3$H$,$G$-$^$9!#(B
+    $B;XDj$G$-$k$b$N$NBgB??t$K$D$$$F$O!"<!2s$b$&>/$7>\$7$/@bL@$7$^$9!#(B
+    $B$3$3$G$O!"(BSSI $B$G9T$J$&$3$H$,$G$-$kNc$r$$$/$D$+<($7$^$9!#(B
+    </p>
 
-<h3><a name="today'sdate">$B:#F|$NF|IU(B</a></h3>
+    <h3><a id="todaysdate" name="todaysdate">$B:#F|$NF|IU(B</a></h3>
 
 <pre>
         &lt;!--#echo var="DATE_LOCAL" --&gt;
 </pre>
 
-<p><code>echo</code> $BMWAG$OC1$KJQ?t$NCM$r=PNO$7$^$9!#(BCGI $B%W%m%0%i%`$K(B
-$BMxMQ2DG=$J4D6-JQ?t$NA4$F$N%;%C%H$r4^$`B?$/$NI8=`JQ?t$,$"$j$^$9!#(B
-$B$^$?!"(B<code>set</code> $BMWAG$rMQ$$$k$3$H$G!"FH<+$NJQ?t$rDj5A$9$k$3$H$,(B
-$B$G$-$^$9!#(B</p>
-
-<p>$B=PNO$5$l$kF|IU$N=q<0$,9%$-$G$O$J$$>l9g!"$=$N=q<0$r(B
-$B=$@5$9$k$?$a$K!"(B<code>config</code> $BMWAG$K(B <code>timefmt</code> $BB0@-$r(B
-$B;HMQ$9$k$3$H$,$G$-$^$9!#(B</p>
-
+    <p><code>echo</code> $BMWAG$OC1$KJQ?t$NCM$r=PNO$7$^$9!#(B
+    CGI $B%W%m%0%i%`$KMxMQ2DG=$J4D6-JQ?t$NA4$F$N(B
+    $B%;%C%H$r4^$`B?$/$NI8=`JQ?t$,$"$j$^$9!#$^$?!"(B<code>set</code>
+    $BMWAG$rMQ$$$k$3$H$G!"FH<+$NJQ?t$rDj5A$9$k$3$H$,$G$-$^$9!#(B
+    </p>
+
+    <p>$B=PNO$5$l$kF|IU$N=q<0$,9%$-$G$O$J$$>l9g!"$=$N=q<0$r=$@5$9$k$?$a$K!"(B
+    <code>config</code> $BMWAG$K(B <code>timefmt</code>
+    $BB0@-$r;HMQ$9$k$3$H$,$G$-$^$9!#(B</p>
 <pre>
         &lt;!--#config timefmt="%A %B %d, %Y" --&gt;
         Today is &lt;!--#echo var="DATE_LOCAL" --&gt;
 </pre>
 
-<h3><a name="modificationdateofthefile">$B%U%!%$%k$NJQ99F|(B</a></h3>
+    <h3><a id="modificationdateofthefile"
+    name="modificationdateofthefile">$B%U%!%$%k$NJQ99F|(B</a></h3>
 
 <pre>
         This document last modified &lt;!--#flastmod file="index.html" --&gt;
 </pre>
 
-<p>$B$3$NMWAG$b(B <code>timefmt</code> $B%U%)!<%^%C%H$N@_Dj$K=>$$$^$9!#(B</p>
-
-<h3><a name="includingtheresultsofacgiprogram">CGI $B%W%m%0%i%`$N7k2L$r<h$j9~$`(B
-</a></h3>
-
-<p>$B$3$l$O!"A4$F$N?M$N$*5$$KF~$j$G$"$k(B ``$B%R%C%H%+%&%s%?(B'' $B$N$h$&$J(B CGI $B%W%m%0%i%`$N(B
-$B7k2L$r=PNO$9$k(B SSI $B$N$h$j0lHLE*$J;HMQ$N$&$A$N0l$D$G$9!#(B</p>
+    <p>$B$3$NMWAG$b(B <code>timefmt</code>
+    $B%U%)!<%^%C%H$N@_Dj$K=>$$$^$9!#(B</p>
 
+    <h3><a id="includingtheresultsofacgiprogram"
+    name="includingtheresultsofacgiprogram">CGI
+    $B%W%m%0%i%`$N7k2L$r<h$j9~$`(B</a></h3>
+
+    <p>$B$3$l$O!"A4$F$N?M$N$*5$$KF~$j$G$"$k(B ``$B%R%C%H%+%&%s%?(B'' $B$N$h$&$J(B
+    CGI $B%W%m%0%i%`$N7k2L$r=PNO$9$k(B SSI
+    $B$N$h$j0lHLE*$J;HMQ$N$&$A$N0l$D$G$9!#(B</p>
 <pre>
         &lt;!--#include virtual="/cgi-bin/counter.pl" --&gt;
 </pre>
+    <hr />
 
-<hr>
-<h2><a name="additionalexamples">$BDI2C$NNc(B</a></h2>
-
-<p>$B0J2<$O!"(BSSI $B$r;HMQ$7$F(B HTML $B%I%-%e%a%s%H$K$*$$$F$G$-$k$3$H$N(B
-$B$$$/$D$+$NFCJL$JNc$G$9!#(B</p>
-
-<hr>
-<h2><a name="whenwasthisdocumentmodified">$B$$$D$3$N%I%-%e%a%s%H$O=$@5$5$l$?$N$+(B?
-</a></h2>
-
-<p>$B@h$K!"%I%-%e%a%s%H$,:G8e$KJQ99$5$l$?$N$O$$$D$+$r%f!<%6$KDLCN$9$k$?$a$K(B SSI $B$r;HMQ$9$k$3$H$,$G$-$k$3$H$r(B
-$B=R$Y$^$7$?!#$7$+$7$J$,$i!"<B:]$NJ}K!$O!"$$$/$V$sLdBj$N$^$^$K$7$F$*$-$^$7$?!#(B
-HTML $B%I%-%e%a%s%H$KG[CV$5$l$?<!$N%3!<%I$O!"%Z!<%8$K(B
-$B$=$N$h$&$J%?%$%`%9%?%s%W$rF~$l$k$G$7$g$&!#$b$A$m$s!">e=R$N(B
-$B$h$&$K!"(BSSI $B$r@5$7$/F0:n2DG=$K$7$F$*$/I,MW$,$"$j$^$9!#(B</p>
+    <h2><a id="additionalexamples"
+    name="additionalexamples">$BDI2C$NNc(B</a></h2>
 
+    <p>$B0J2<$O!"(BSSI $B$r;HMQ$7$F(B HTML
+    $B%I%-%e%a%s%H$K$*$$$F$G$-$k$3$H$N$$$/$D$+$NFCJL$JNc$G$9!#(B</p>
+    <hr />
+
+    <h2><a id="whenwasthisdocumentmodified"
+    name="whenwasthisdocumentmodified"
+    >$B$$$D$3$N%I%-%e%a%s%H$O=$@5$5$l$?$N$+(B?</a></h2>
+
+    <p>$B@h$K!"%I%-%e%a%s%H$,:G8e$KJQ99$5$l$?$N$O$$$D$+$r(B
+    $B%f!<%6$KDLCN$9$k$?$a$K(B SSI $B$r;HMQ$9$k$3$H$,$G$-$k$3$H$r=R$Y$^$7$?!#(B
+    $B$7$+$7$J$,$i!"<B:]$NJ}K!$O!"$$$/$V$sLdBj$N$^$^$K$7$F$*$-$^$7$?!#(B
+    HTML $B%I%-%e%a%s%H$KG[CV$5$l$?<!$N%3!<%I$O!"%Z!<%8$K$=$N$h$&$J(B
+    $B%?%$%`%9%?%s%W$rF~$l$k$G$7$g$&!#$b$A$m$s!">e=R$N$h$&$K!"(B
+    SSI $B$r@5$7$/F0:n2DG=$K$7$F$*$/I,MW$,$"$j$^$9!#(B</p>
 <pre>
         &lt;!--#config timefmt="%A %B %d, %Y" --&gt;
         This file last modified &lt;!--#flastmod file="ssi.shtml" --&gt;
 </pre>
 
-<p>$B$b$A$m$s!"(B<code>ssi.shtml</code> $B$NItJ,$r<B:]$NEv3:%U%!%$%kL>$H(B
-$BCV$-49$($kI,MW$,$"$j$^$9!#$b$7!"$"$i$f$k%U%!%$%k$KD%$k$3$H$,(B
-$B$G$-$k0lHLE*$J%3!<%I$rC5$7$F$$$k$J$i!"$3$l$OITJX$G$"$k$+$b$7$l$^$;$s!#(B
-$B$*$=$i$/$=$N>l9g$O!"$=$&$9$kBe$o$j$KJQ?t(B <code>LAST_MODIFIED</code>
-$B$r;HMQ$7$?$$$H9M$($k$G$7$g$&(B:</p>
-
+    <p>$B$b$A$m$s!"(B<code>ssi.shtml</code>
+    $B$NItJ,$r<B:]$NEv3:%U%!%$%kL>$HCV$-49$($kI,MW$,$"$j$^$9!#(B
+    $B$b$7!"$"$i$f$k%U%!%$%k$KD%$k$3$H$,$G$-$k0lHLE*$J%3!<%I$rC5$7$F$$$k$J$i!"(B
+    $B$3$l$OITJX$G$"$k$+$b$7$l$^$;$s!#$*$=$i$/$=$N>l9g$O!"(B
+    $B$=$&$9$kBe$o$j$KJQ?t(B <code>LAST_MODIFIED</code>
+    $B$r;HMQ$7$?$$$H9M$($k$G$7$g$&(B:</p>
 <pre>
         &lt;!--#config timefmt="%D" --&gt;
         This file last modified &lt;!--#echo var="LAST_MODIFIED" --&gt;
 </pre>
 
-<p><code>timefmt</code> $B=q<0$K$D$$$F$N$h$j>\:Y$K$D$$$F$O!"(B
-$B$*9%$_$N8!:w%5%$%H$K9T$-!"(B<code>ctime</code> $B$G8!:w$7$F$_$F$/$@$5$$!#J8K!$OF1$8$G$9!#(B</p>
-
-<hr>
-<h2><a name="includingastandardfooter">$BI8=`$N%U%C%?$rA^F~$9$k(B</a></h2>
-
-<p>$B$b$7?t%Z!<%8$rD6$($k%Z!<%8$r;}$D%5%$%H$r4IM}$7$F$$$k$J$i$P!"(B
-$BA4%Z!<%8$KBP$7$FJQ9`$r9T$J$&$3$H$,K\Ev$K6lDK$H$J$jF@$k$3$H$,J,$+$k$G$7$g$&!#(B
-$BA4$F$N%Z!<%8$KEO$C$F$"$k<o$NI8=`E*$J304Q$r0];}$7$h$&$H(B
-$B$7$F$$$k$J$i$PFC$K$=$&$G$7$g$&!#(B</p>
-
-<p>$B%X%C%@$d%U%C%?MQ$NA^F~MQ%U%!%$%k$r;HMQ$9$k$3$H$G!"$3$N$h$&$J(B
-$B99?7$K$+$+$kIiC4$r8:$i$9$3$H$,$G$-$^$9!#0l$D$N%U%C%?%U%!%$%k$r(B
-$B:n@.$7!"$=$l$r(B <code>include</code> SSI $B%3%^%s%I$G3F%Z!<%8$K(B
-$BF~$l$k$@$1$G:Q$_$^$9!#(B<code>include</code> $BMWAG$O!"(B<code>file</code> $BB0@-(B
-$B$^$?$O(B <code>virtual</code> $BB0@-$N$$$:$l$+$r;HMQ$7$F$I$N%U%!%$%k$rA^F~$9$k$+$r(B
-$B7h$a$k$3$H$,$G$-$^$9!#(B<code>file</code> $BB0@-$O!"(B<em>$B%+%l%s%H%G%#%l%/%H%j$+$i$N(B
-$BAjBP%Q%9$G<($5$l$?(B</em>$B%U%!%$%k%Q%9$G$9!#$=$l$O(B
-/ $B$G;O$^$k@dBP%U%!%$%k%Q%9$K$O$G$-$:!"$^$?!"$=$N%Q%9$N0lIt$K(B ../ $B$r(B
-$B4^$`$3$H$,$G$-$J$$$3$H$r0UL#$7$^$9!#(B<code>virtual</code> $BB0@-$O!"$*$=$i$/(B
-$B$h$jJXMx$@$H;W$$$^$9$,!"Ds6!$9$k%I%-%e%a%s%H$+$i$NAjBP(B URL $B$G;XDj$9$Y$-$G$9!#(B
-$B$=$l$O(B / $B$G;O$a$k$3$H$,$G$-$^$9$,!"Ds6!$9$k%U%!%$%k$HF1$8%5!<%P>e$K(B
-$BB8:_$7$J$/$F$O$J$j$^$;$s!#(B</p>
-
+    <p><code>timefmt</code>
+    $B=q<0$K$D$$$F$N$h$j>\:Y$K$D$$$F$O!"$*9%$_$N8!:w%5%$%H$K9T$-!"(B
+    <code>strftime</code> $B$G8!:w$7$F$_$F$/$@$5$$!#J8K!$OF1$8$G$9!#(B</p>
+    <hr />
+
+    <h2><a id="includingastandardfooter"
+    name="includingastandardfooter">$BI8=`$N%U%C%?$rA^F~$9$k(B</a></h2>
+
+
+    <p>$B$b$7?t%Z!<%8$rD6$($k%Z!<%8$r;}$D%5%$%H$r4IM}$7$F$$$k$J$i$P!"(B
+    $BA4%Z!<%8$KBP$7$FJQ9`$r9T$J$&$3$H$,K\Ev$K6lDK$H$J$jF@$k$3$H$,(B
+    $BJ,$+$k$G$7$g$&!#A4$F$N%Z!<%8$KEO$C$F$"$k<o$NI8=`E*$J304Q$r(B
+    $B0];}$7$h$&$H$7$F$$$k$J$i$PFC$K$=$&$G$7$g$&!#(B</p>
+
+    <p>$B%X%C%@$d%U%C%?MQ$NA^F~MQ%U%!%$%k$r;HMQ$9$k$3$H$G!"(B
+    $B$3$N$h$&$J99?7$K$+$+$kIiC4$r8:$i$9$3$H$,$G$-$^$9!#(B
+    $B0l$D$N%U%C%?%U%!%$%k$r:n@.$7!"$=$l$r(B <code>include</code>
+    SSI $B%3%^%s%I$G3F%Z!<%8$KF~$l$k$@$1$G:Q$_$^$9!#(B<code>include</code>
+    $BMWAG$O!"(B<code>file</code> $BB0@-$^$?$O(B <code>virtual</code>
+    $BB0@-$N$$$:$l$+$r;HMQ$7$F$I$N%U%!%$%k$rA^F~$9$k$+$r7h$a$k$3$H$,$G$-$^$9!#(B
+    <code>file</code> $BB0@-$O!"(B<em>$B%+%l%s%H%G%#%l%/%H%j$+$i$NAjBP%Q%9$G<($5$l$?(B
+    </em>$B%U%!%$%k%Q%9$G$9!#(B
+    $B$=$l$O(B / $B$G;O$^$k@dBP%U%!%$%k%Q%9$K$O$G$-$:!"$^$?!"$=$N%Q%9$N0lIt$K(B ../
+    $B$r4^$`$3$H$,$G$-$J$$$3$H$r0UL#$7$^$9!#(B<code>virtual</code>
+    $BB0@-$O!"$*$=$i$/$h$jJXMx$@$H;W$$$^$9$,!"Ds6!$9$k%I%-%e%a%s%H$+$i$NAjBP(B
+    URL $B$G;XDj$9$Y$-$G$9!#$=$l$O(B / $B$G;O$a$k$3$H$,$G$-$^$9$,!"(B
+    $BDs6!$9$k%U%!%$%k$HF1$8%5!<%P>e$KB8:_$7$J$/$F$O$J$j$^$;$s!#(B</p>
 <pre>
         &lt;!--#include virtual="/footer.html" --&gt;
 </pre>
 
-<p>$B;d$O:G8e$NFs$D$rAH$_9g$o$;$F!"(B<code>LAST_MODIFIED</code> $B%G%#%l%/%F%#%V$r(B
-$B%U%C%?%U%!%$%k$NCf$KCV$/$3$H$,$h$/$"$j$^$9!#(B
-SSI $B%G%#%l%/%F%#%V$O!"A^F~MQ$N%U%!%$%k$K4^$^$;$?$j!"(B
-$BA^F~%U%!%$%k$N%M%9%H$r$7$?$j$9$k$3$H$,$G$-$^$9!#$9$J$o$A!"(B
-$BA^F~MQ$N%U%!%$%k$OB>$N%U%!%$%k$r:F5"E*$KA^F~$9$k$3$H$,$G$-$^$9!#(B</p>
+    <p>$B;d$O:G8e$NFs$D$rAH$_9g$o$;$F!"(B<code>LAST_MODIFIED</code>
+    $B%G%#%l%/%F%#%V$r%U%C%?%U%!%$%k$NCf$KCV$/$3$H$,$h$/$"$j$^$9!#(B
+    SSI $B%G%#%l%/%F%#%V$O!"A^F~MQ$N%U%!%$%k$K4^$^$;$?$j!"(B
+    $BA^F~%U%!%$%k$N%M%9%H$r$7$?$j$9$k$3$H$,$G$-$^$9!#$9$J$o$A!"(B
+    $BA^F~MQ$N%U%!%$%k$OB>$N%U%!%$%k$r:F5"E*$KA^F~$9$k$3$H$,$G$-$^$9!#(B</p>
+    <hr />
 
-<hr>
-<h2><a name="whatelsecaniconfig">$BB>$K2?$,@_Dj$G$-$k$N$+(B?</a></h2>
+    <h2><a id="whatelsecaniconfig"
+    name="whatelsecaniconfig">$BB>$K2?$,@_Dj$G$-$k$N$+(B?</a></h2>
 
-<p>$B;~9o=q<0$r(B <code>config</code> $B$G@_Dj$G$-$k$3$H$K2C$($F!"(B
-$B99$KFs$D(B <code>config</code> $B$G@_Dj$9$k$3$H$,$G$-$^$9!#(B</p>
-
-<p>$BDL>o!"(BSSI $B%G%#%l%/%F%#%V$G2?$+$,$&$^$/$$$+$J$$$H$-$O!"<!$N%a%C%;!<%8$,(B
-$B=PNO$5$l$^$9!#(B</p>
+    <p>$B;~9o=q<0$r(B <code>config</code> $B$G@_Dj$G$-$k$3$H$K2C$($F!"(B
+    $B99$KFs$D(B <code>config</code> $B$G@_Dj$9$k$3$H$,$G$-$^$9!#(B</p>
 
+    <p>$BDL>o!"(BSSI $B%G%#%l%/%F%#%V$G2?$+$,$&$^$/$$$+$J$$$H$-$O!"(B
+    $B<!$N%a%C%;!<%8$,=PNO$5$l$^$9!#(B</p>
 <pre>
         [an error occurred while processing this directive]
 </pre>
 
-<p>$B$3$N%a%C%;!<%8$rB>$N$b$N$K$7$?$$>l9g!"(B
-<code>config</code> $BMWAG$N(B <code>errmsg</code> $BB0@-$GJQ99$9$k$3$H$,(B
-$B$G$-$^$9(B:<p>
-
+    <p>$B$3$N%a%C%;!<%8$rB>$N$b$N$K$7$?$$>l9g!"(B<code>config</code>
+    $BMWAG$N(B <code>errmsg</code> $BB0@-$GJQ99$9$k$3$H$,$G$-$^$9(B:</p>
 <pre>
         &lt;!--#config errmsg="[It appears that you don't know how to use SSI]" --&gt;
 </pre>
 
-<p>$B$*$=$i$/!"%(%s%I%f!<%6$O$3$N%a%C%;!<%8$r7h$7$F8+$k$3$H$O$"$j$^$;$s!#(B
-$B$J$<$J$i!"$=$N%5%$%H$,@8$-$?>uBV$K$J$kA0$K(B SSI $B%G%#%l%/%F%#%V$K4X$9$k(B
-$BA4$F$NLdBj$r2r7h$7$F$$$k$O$:$@$+$i$G$9!#(B($B$=$&$G$9$h$M(B?)</p>
-
-<p>$B$=$7$F!"(B<code>config</code> $B$K$*$$$F(B <code>sizefmt</code> $BB0@-$r;HMQ$9$k$3$H$G!"(B
-$BJV$5$l$k%U%!%$%k%5%$%:$N=q<0$r@_Dj$9$k$3$H$,$G$-$^$9!#(B
-$B%P%$%H?t$K$O(B <code>bytes</code> $B$r!"E,Ev$K(B Kb $B$d(B Mb $B$K(B
-$BC;=L$5$;$k$K$O(B <code>abbrev</code> $B$r;XDj$9$k$3$H$,$G$-$^$9!#(B</p>
-
-<hr>
-<h2><a name="executingcommands">$B%3%^%s%I$N<B9T(B</a></h2>
-
-<p>$B:#8e?t%v7n$NFb$K!">.$5$J(B CGI $B%W%m%0%i%`$H(B SSI $B$r;HMQ$9$k(B
-$B5-;v$r=P$7$?$$$H9M$($F$$$^$9!#$3$3$G$O$=$l$H$OJL$K!"(B
-<code>exec</code> $BMWAG$K$h$C$F9T$J$&$3$H$,$G$-$k$3$H$r<($7$^$9!#(B
-SSI $B$K%7%'%k(B ($B@53N$K$O(B <code>/bin/sh</code>$B!#(BWin32 $B$J$i$P(B DOS $B%7%'%k(B)
-$B$r;HMQ$7$F%3%^%s%I$r<B9T$5$;$k$3$H$,$G$-$^$9!#2<5-$NNc$G$O!"%G%#%l%/%H%j(B
-$B%j%9%H=PNO$r9T$J$$$^$9!#(B</p>
-
+    <p>$B$*$=$i$/!"%(%s%I%f!<%6$O$3$N%a%C%;!<%8$r7h$7$F8+$k$3$H$O$"$j$^$;$s!#(B
+    $B$J$<$J$i!"$=$N%5%$%H$,@8$-$?>uBV$K$J$kA0$K(B SSI $B%G%#%l%/%F%#%V$K4X$9$k(B
+    $BA4$F$NLdBj$r2r7h$7$F$$$k$O$:$@$+$i$G$9!#(B($B$=$&$G$9$h$M(B?)</p>
+
+    <p>$B$=$7$F!"(B<code>config</code> $B$K$*$$$F(B <code>sizefmt</code>
+    $BB0@-$r;HMQ$9$k$3$H$G!"(B
+    $BJV$5$l$k%U%!%$%k%5%$%:$N=q<0$r@_Dj$9$k$3$H$,$G$-$^$9!#(B
+    $B%P%$%H?t$K$O(B <code>bytes</code> $B$r!"E,Ev$K(B Kb $B$d(B Mb
+    $B$KC;=L$5$;$k$K$O(B <code>abbrev</code> $B$r;XDj$9$k$3$H$,$G$-$^$9!#(B</p>
+    <hr />
+
+    <h2><a id="executingcommands"
+    name="executingcommands">$B%3%^%s%I$N<B9T(B</a></h2>
+
+    <p>$B:#8e?t%v7n$N$&$A$K!">.$5$J(B CGI $B%W%m%0%i%`$H(B SSI
+    $B$r;HMQ$9$k5-;v$r=P$7$?$$$H9M$($F$$$^$9!#$3$3$G$O$=$l$H$OJL$K!"(B
+    <code>exec</code> $BMWAG$K$h$C$F9T$J$&$3$H$,$G$-$k$3$H$r<($7$^$9!#(B
+    SSI $B$K%7%'%k(B ($B@53N$K$O(B <code>/bin/sh</code>$B!#(BWin32 $B$J$i$P(B DOS $B%7%'%k(B)
+    $B$r;HMQ$7$F%3%^%s%I$r<B9T$5$;$k$3$H$,$G$-$^$9!#(B
+    $B2<5-$NNc$G$O!"%G%#%l%/%H%j%j%9%H=PNO$r9T$J$$$^$9!#(B</p>
 <pre>
         &lt;pre&gt;
         &lt;!--#exec cmd="ls" --&gt;
         &lt;/pre&gt;
 </pre>
 
-<p>Windows $B>e$G$O!"(B</p>
-
+    <p>Windows $B>e$G$O!"(B</p>
 <pre>
         &lt;pre&gt;
         &lt;!--#exec cmd="dir" --&gt;
         &lt;/pre&gt;
 </pre>
 
-<p>Windows $B>e$G$O!"$3$N%G%#%l%/%F%#%V$K$h$C$F$$$/$D$+$N4qL/$J(B
-$B=q<0$K5$$E$/$G$7$g$&!#$J$<$J$i(B <code>dir</code> $B$N=PNO$,(B
-$BJ8;zNs(B ``&lt;<code>dir</code>&gt;'' $B$r4^$_!"%V%i%&%6$r:.Mp$5$;$k$+$i$G$9!#(B</P>
-
-<p>$B$3$N5!G=$OHs>o$K4m81$G$"$j!"$I$s$J%3!<%I$G$b(B <code>exec</code> $B%?%0$K(B
-$BKd$a9~$^$l$F$7$^$($P<B9T$9$k$3$H$KCm0U$7$F$/$@$5$$!#Nc$($P(B 
-`` $B%2%9%H%V%C%/(B '' $B$N$h$&$K!"$b$7!"%f!<%6$,%Z!<%8$NFbMF$r(B
-$BJT=8$G$-$k>u67$K$"$k$J$i$P!"$3$N5!G=$r3N<B$KM^@)$7$F$/$@$5$$!#(B
-<code>Options</code> $B%G%#%l%/%F%#%V$N(B <code>IncludesNOEXEC</code> $B0z?t$r;XDj$9$k$3$H$G!"(B
-SSI $B$O5v2D$9$k$1$l$I(B <code>exec</code> $B5!G=$O5v2D$7$J$$$h$&$K$9$k$3$H$,$G$-$^$9!#(B</p>
-
-<hr>
-<h2><a name="advancedssitechniques">$B9bEY$J(B SSI $B%F%/%K%C%/(B</a></h2>
-
-<p>$B%3%s%F%s%D$r=PNO$9$k$3$H$K2C$(!"(BApache SSI $B$OJQ?t$r@_Dj$7!"$=$7$FHf3S(B
-$B$H>r7oJ,4t$K$=$NJQ?t$r;HMQ$G$-$k5!G=$rDs6!$7$F$$$^$9!#(B</p>
-
-<h3><a name="caveat">$B7Y9p(B</a></h3>
-
-<p>$B$3$N5-;v$G=R$Y$?BgItJ,$N5!G=$O!"(BApache 1.2 $B0J9_$r(B
-$B;HMQ$7$F$$$k>l9g$N$_MxMQ2DG=$G$9!#$b$A$m$s!"$b$7(B Apache 1.2 $B0J9_$r(B
-$B;HMQ$7$F$J$$>l9g!"D>$A$K%"%C%W%0%l!<%I$9$kI,MW$,$"$j$^$9!#(B
-$B$5$!!":#$=$l$r9T$J$$$J$5$$!#$=$l$^$GBT$C$F$$$^$9!#(B</p>
-
-<hr>
-<h2><a name="settingvariables">$BJQ?t$r@_Dj$9$k(B</a></h2>
-
-<p><code>set</code> $B%G%#%l%/%F%#%V$r;HMQ$7$F!"8e$G;HMQ$9$k$?$a$KJQ?t$r(B
-$B@_Dj$9$k$3$H$,$G$-$^$9!#$3$l$O8e$N@bL@$GI,MW$K$J$k$N$G!"$3$3$G(B
-$B$=$l$K$D$$$F=R$Y$F$$$^$9!#J8K!$O0J2<$N$H$*$j$G$9(B:</p>
-
+    <p>Windows $B>e$G$O!"$3$N%G%#%l%/%F%#%V$K$h$C$F$$$/$D$+$N4qL/$J(B
+    $B=q<0$K5$$E$/$G$7$g$&!#$J$<$J$i(B <code>dir</code> $B$N=PNO$,J8;zNs(B
+    ``&lt;<code>dir</code>&gt;'' $B$r4^$_!"%V%i%&%6$r:.Mp$5$;$k$+$i$G$9!#(B</p>
+
+    <p>$B$3$N5!G=$OHs>o$K4m81$G$"$j!"$I$s$J%3!<%I$G$b(B <code>exec</code>
+    $B%?%0$KKd$a9~$^$l$F$7$^$($P<B9T$9$k$3$H$KCm0U$7$F$/$@$5$$!#Nc$($P(B 
+    `` $B%2%9%H%V%C%/(B '' $B$N$h$&$K!"$b$7!"(B
+    $B%f!<%6$,%Z!<%8$NFbMF$rJT=8$G$-$k>u67$K$"$k$J$i$P!"(B
+    $B$3$N5!G=$r3N<B$KM^@)$7$F$/$@$5$$!#(B<code>Options</code>
+    $B%G%#%l%/%F%#%V$N(B <code>IncludesNOEXEC</code> $B0z?t$r;XDj$9$k$3$H$G!"(B
+    SSI $B$O5v2D$9$k$1$l$I(B <code>exec</code>
+    $B5!G=$O5v2D$7$J$$$h$&$K$9$k$3$H$,$G$-$^$9!#(B</p>
+    <hr />
+
+    <h2><a id="advancedssitechniques"
+    name="advancedssitechniques">$B9bEY$J(B SSI $B%F%/%K%C%/(B</a></h2>
+
+    <p>$B%3%s%F%s%D$r=PNO$9$k$3$H$K2C$(!"(BApache SSI $B$OJQ?t$r@_Dj$7!"(B
+    $B$=$7$FHf3S$H>r7oJ,4t$K$=$NJQ?t$r;HMQ$G$-$k5!G=$rDs6!$7$F$$$^$9!#(B
+    </p>
+
+    <h3><a id="caveat" name="caveat">$B7Y9p(B</a></h3>
+
+    <p>$B$3$N5-;v$G=R$Y$?BgItJ,$N5!G=$O!"(BApache 1.2
+    $B0J9_$r;HMQ$7$F$$$k>l9g$N$_MxMQ2DG=$G$9!#$b$A$m$s!"$b$7(B Apache 1.2
+    $B0J9_$r;HMQ$7$F$J$$>l9g!"D>$A$K%"%C%W%0%l!<%I$9$kI,MW$,$"$j$^$9!#(B
+    $B$5$!!":#$=$l$r9T$J$$$J$5$$!#$=$l$^$GBT$C$F$$$^$9!#(B
+    </p>
+    <hr />
+
+    <h2><a id="settingvariables"
+    name="settingvariables">$BJQ?t$r@_Dj$9$k(B</a></h2>
+
+    <p><code>set</code> $B%G%#%l%/%F%#%V$r;HMQ$7$F!"(B
+    $B8e$G;HMQ$9$k$?$a$KJQ?t$r@_Dj$9$k$3$H$,$G$-$^$9!#(B
+    $B$3$l$O8e$N@bL@$GI,MW$K$J$k$N$G!"$3$3$G$=$l$K$D$$$F=R$Y$F$$$^$9!#(B
+    $BJ8K!$O0J2<$N$H$*$j$G$9(B:</p>
 <pre>
         &lt;!--#set var="name" value="Rich" --&gt;
 </pre>
 
-<p>$B$3$N$h$&$KC1=c$KJ8;z$I$*$j$K@_Dj$9$k$3$H$K2C$(!"(B
-$BNc$($P4D6-JQ?t$dA0$N5-;v$G=R$Y$?JQ?t(B ($BNc$($P(B <code
->LAST_MODIFIED</code> $B$N$h$&$J(B) $B$r4^$`B>$N$"$i$f$kJQ?t$r(B
-$BCM$r@_Dj$9$k$N$K;HMQ$9$k$3$H$,(B
-$B$G$-$^$9!#JQ?tL>$NA0$K%I%k5-9f(B ($) $B$r;HMQ$9$k$3$H$G!"(B
-$B$=$l$,%j%F%i%kJ8;zNs$G$O$J$/$FJQ?t$G$"$k$3$H$r<($7$^$9!#(B</p>
-
+    <p>$B$3$N$h$&$KC1=c$KJ8;z$I$*$j$K@_Dj$9$k$3$H$K2C$(!"(B
+    $BNc$($P4D6-JQ?t$dA0$N5-;v$G=R$Y$?JQ?t(B
+    ($BNc$($P(B <code>LAST_MODIFIED</code> $B$N$h$&$J(B)
+    $B$r4^$`B>$N$"$i$f$kJQ?t$rCM$r@_Dj$9$k$N$K;HMQ$9$k$3$H$,$G$-$^$9!#(B
+    $BJQ?tL>$NA0$K%I%k5-9f(B ($) $B$r;HMQ$9$k$3$H$G!"(B
+    $B$=$l$,%j%F%i%kJ8;zNs$G$O$J$/$FJQ?t$G$"$k$3$H$r<($7$^$9!#(B</p>
 <pre>
         &lt;!--#set var="modified" value="$LAST_MODIFIED" --&gt;
 </pre>
 
-<p>$B%I%k5-9f(B ($) $B$rJ8;z$H$7$FJQ?t$NCM$KF~$l$k$K$O!"%P%C%/%9%i%C%7%e$K$h$C$F(B
-$B%I%k5-9f$r%(%9%1!<%W$9$kI,MW$,$"$j$^$9!#(B</p>
-
+    <p>$B%I%k5-9f(B ($) $B$rJ8;z$H$7$FJQ?t$NCM$KF~$l$k$K$O!"(B
+    $B%P%C%/%9%i%C%7%e$K$h$C$F%I%k5-9f$r%(%9%1!<%W$9$kI,MW$,$"$j$^$9!#(B</p>
 <pre>
         &lt;!--#set var="cost" value="\$100" --&gt;
 </pre>
 
-<p>$B:G8e$K$J$j$^$9$,!"D9$$J8;zNs$NCf$KJQ?t$rCV$-$?$$>l9g$G!"(B
-$BJQ?tL>$,B>$NJ8;z$H$V$D$+$k2DG=@-$,$"$j!"$=$l$i$NJ8;z$K$D$$$F(B
-$B:.Mp$7$F$7$^$&>l9g!"$3$N:.Mp$r<h$j=|$/$?$a!"JQ?tL>$rCf3g8L$G(B
-$B0O$`$3$H$,$G$-$^$9(B ($B$3$l$K$D$$$F$NNI$$Nc$r<($9$N$OFq$7$$$N$G$9$,!"(B
-$B$*$=$i$/J,$+$C$F$$$?$@$1$k$G$7$g$&(B)$B!#(B</P>
+    <p>$B:G8e$K$J$j$^$9$,!"D9$$J8;zNs$NCf$KJQ?t$rCV$-$?$$>l9g$G!"(B
+    $BJQ?tL>$,B>$NJ8;z$H$V$D$+$k2DG=@-$,$"$j!"(B
+    $B$=$l$i$NJ8;z$K$D$$$F:.Mp$7$F$7$^$&>l9g!"$3$N:.Mp$r<h$j=|$/$?$a!"(B
+    $BJQ?tL>$rCf3g8L$G0O$`$3$H$,$G$-$^$9(B
+    ($B$3$l$K$D$$$F$NNI$$Nc$r<($9$N$OFq$7$$$N$G$9$,!"(B
+    $B$*$=$i$/J,$+$C$F$$$?$@$1$k$G$7$g$&(B)$B!#(B
+    </p>
 
 <pre>
         &lt;!--#set var="date" value="${DATE_LOCAL}_${DATE_GMT}" --&gt;
 </pre>
+    <hr />
 
-<hr>
-<h2><a name="conditionalexpressions">$B>r7o<0(B</a></h2>
+    <h2><a id="conditionalexpressions"
+    name="conditionalexpressions">$B>r7o<0(B</a></h2>
 
-<p>$B$5$F!"JQ?t$r;}$C$F$$$F!"$=$l$i$NCM$r@_Dj$7$FHf3S$9$k$3$H$,$G$-$k$N$G$9$+$i!"(B
-$B>r7o$rI=$9$?$a$K$=$l$i$r;HMQ$9$k$3$H$,$G$-$^$9!#$3$l$K$h$j(B SSI $B$O(B
-$B$"$k<o$N>.$5$J%W%m%0%i%_%s%08@8l$K$J$C$F$$$^$9!#(B<code>mod_include</code> $B$O(B
-$B>r7o$rI=8=$9$k$?$a$K(B <code>if</code>, <code>elif</code>, <code>else</code>,
-<code>endif</code> $B9=B$$rDs6!$7$F$$$^$9!#$3$l$K$h$C$F!"0l$D$N<B:]$N%Z!<%8$+$i(B
-$BJ#?t$NO@M}%Z!<%8$r8z2LE*$K@8@.$9$k$3$H$,$G$-$^$9!#(B</p>
+    <p>$B$5$F!"JQ?t$r;}$C$F$$$F!"(B
+    $B$=$l$i$NCM$r@_Dj$7$FHf3S$9$k$3$H$,$G$-$k$N$G$9$+$i!"(B
+    $B>r7o$rI=$9$?$a$K$=$l$i$r;HMQ$9$k$3$H$,$G$-$^$9!#$3$l$K$h$j(B
+    SSI $B$O$"$k<o$N>.$5$J%W%m%0%i%_%s%08@8l$K$J$C$F$$$^$9!#(B
+    <code>mod_include</code> $B$O>r7o$rI=8=$9$k$?$a$K(B <code>if</code>,
+    <code>elif</code>, <code>else</code>, <code>endif</code>
+    $B9=B$$rDs6!$7$F$$$^$9!#$3$l$K$h$C$F!"(B
+    $B0l$D$N<B:]$N%Z!<%8$+$iJ#?t$NO@M}%Z!<%8$r8z2LE*$K@8@.$9$k$3$H$,$G$-$^$9!#(B</p>
+
+    <p>$B>r7o9=B$$O0J2<$N$H$*$j$G$9(B:</p>
+<pre>
+    &lt;!--#if expr="test_condition" --&gt;
+    &lt;!--#elif expr="test_condition" --&gt;
+    &lt;!--#else --&gt;
+    &lt;!--#endif --&gt;
+</pre>
+
+    <p><em>test_condition</em>
+    $B$O$"$i$f$k<oN`$NO@M}E*Hf3S$r$9$k$3$H$,$G$-$^$9!#(B
+    $BCM$rHf3S$7$?$j!"$=$NCM$,(B ``$B??(B'' $B$+$I$&$+$rI>2A$7$^$9(B
+    ($B6u$G$J$$$J$iM?$($i$l$?J8;zNs$O??$G$9(B)$B!#(B
+    $BMxMQ2DG=$JHf3S1i;;;R$NA4$F$N%j%9%H$K$D$$$F$O!"(B
+    <code>mod_include</code> $B%I%-%e%a%s%F!<%7%g%s$r;2>H$7$F$/$@$5$$!#(B
+    $B$3$3$G$O!"$3$N9=B$$r$I$&;HMQ$9$k$+$NNc$r$$$/$D$+<($7$^$9!#(B</p>
 
-<p>$B>r7o9=B$$O0J2<$N$H$*$j$G$9(B:</p>
-
-<pre>
-        &lt;!--#if expr="test_condition" --&gt;
-        &lt;!--#elif expr="test_condition" --&gt;
-        &lt;!--#else --&gt;
-        &lt;!--#endif --&gt;
-</pre>
-
-<p><em>test_condition</em> $B$O$"$i$f$k<oN`$NO@M}E*Hf3S$r$9$k$3$H$,$G$-$^$9!#(B
-$BCM$rHf3S$7$?$j!"$=$NCM$,(B ``$B??(B'' $B$+$I$&$+$rI>2A$7$^$9(B ($B6u$G$J$$$J$i(B
-$BM?$($i$l$?J8;zNs$O??$G$9(B)$B!#MxMQ2DG=$JHf3S1i;;;R$NA4$F$N%j%9%H$K$D$$$F$O!"(B
-<code>mod_include</code> $B%I%-%e%a%s%F!<%7%g%s$r;2>H$7$F$/$@$5$$!#(B
-$B$3$3$G$O!"$3$N9=B$$r$I$&;HMQ$9$k$+$NNc$r$$$/$D$+<($7$^$9!#(B</p>
-
-<p>$B@_Dj%U%!%$%k$G<!$N9T$r5-=R$7$^$9(B:</P>
+<p>$B@_Dj%U%!%$%k$G<!$N9T$r5-=R$7$^$9(B:</p>
 
 <pre>
         BrowserMatchNoCase macintosh Mac
         BrowserMatchNoCase MSIE InternetExplorer
 </pre>
 
-<p>$B$3$l$O%/%i%$%"%s%H$,(B Macintosh $B>e$G%$%s%?!<%M%C%H%(%/%9%W%m!<%i$,(B
-$BF0$$$F$$$k>l9g!"4D6-JQ?t(B ``Mac'' $B$H(B ``InternetExplorer'' $B$r??$H@_Dj$7$^$9!#(B</P>
-
-<p>$B<!$K!"(BSSI $B$,2DG=$K$J$C$?%I%-%e%a%s%H$G0J2<$r9T$J$$$^$9(B:</p>
+    <p>$B$3$l$O%/%i%$%"%s%H$,(B Macintosh
+    $B>e$G%$%s%?!<%M%C%H%(%/%9%W%m!<%i$,F0$$$F$$$k>l9g!"4D6-JQ?t(B
+    ``Mac'' $B$H(B ``InternetExplorer'' $B$r??$H@_Dj$7$^$9!#(B</p>
 
+    <p>$B<!$K!"(BSSI $B$,2DG=$K$J$C$?%I%-%e%a%s%H$G0J2<$r9T$J$$$^$9(B:
+    </p>
 <pre>
         &lt;!--#if expr="${Mac} &amp;&amp; ${InternetExplorer}" --&gt;
         Apologetic text goes here
         &lt;!--#else --&gt;
         Cool JavaScript code goes here
         &lt;!--#endif --&gt;
 </pre>
 
-<p>Mac $B>e$N(B IE $B$KBP$7$F2?$+;W$&$H$3$m$,$"$k$o$1$G$"$j$^$;$s!#(B
-$BB>$G$O<B9T$G$-$F$$$k$$$/$D$+$N(B JavaScript $B$r(B Mac $B>e$N(B IE $B$G(B
-$B<B9T$5$;$k$N$K!"@h=5?t;~4V6lO+$7$?$H$$$&$@$1$N$3$H$G$9!#(B
-$B>e$NNc$O$=$N;CDjE*$JBP=hJ}K!$G$9!#(B</p>
-
-<p>$BB>$N$I$s$JJQ?t(B ($B$"$J$?$,Dj5A$9$k$b$N!"$^$?$OIaDL$N4D6-JQ?t$N$$$:$l$+(B) $B$b!"(B
-$B>r7oJ8$K;HMQ$9$k$3$H$,$G$-$^$9!#(BApache $B$O(B <code>SetEnvIf</code> 
-$B%G%#%l%/%F%#%V$dB>$N4XO"%G%#%l%/%F%#%V;HMQ$7$F4D6-JQ?t$r@_Dj$9$k$3$H$,(B
-$B$G$-$^$9!#$3$N5!G=$K$h$j!"(BCGI $B$KMj$k$3$H$J$/$+$J$jJ#;($JF0E*$J$3$H$r$5$;$k(B
-$B$3$H$,$G$-$^$9!#(B</p>
-
-<hr>
-<h2><a name="conclusion">$B=*$o$j$K(B</a></h2>
-
-<p>SSI $B$O3N$+$K(B CGI $B$dF0E*$J%&%'%V%Z!<%8$r@8@.$9$kB>$N5;=Q$KBe$o$k$b$N(B
-$B$G$O$"$j$^$;$s!#$7$+$7!"(B
-$B$?$/$5$s$NM>J,$J:n6H$r$;$:$K!">/NL$NF0E*$J%3%s%F%s%D$r2C$($k$K$O(B
-$B$9$0$l$?J}K!$G$9!#(B</p>
+    <p>Mac $B>e$N(B IE $B$KBP$7$F2?$+;W$&$H$3$m$,$"$k$o$1$G$"$j$^$;$s!#(B
+    $BB>$G$O<B9T$G$-$F$$$k$$$/$D$+$N(B JavaScript $B$r(B Mac $B>e$N(B IE
+    $B$G<B9T$5$;$k$N$K!"@h=5?t;~4V6lO+$7$?$H$$$&$@$1$N$3$H$G$9!#(B
+    $B>e$NNc$O$=$N;CDjE*$JBP=hJ}K!$G$9!#(B</p>
+
+    <p>$BB>$N$I$s$JJQ?t(B ($B$"$J$?$,Dj5A$9$k$b$N!"(B
+    $B$^$?$OIaDL$N4D6-JQ?t$N$$$:$l$+(B) $B$b!">r7oJ8$K;HMQ$9$k$3$H$,$G$-$^$9!#(B
+    Apache $B$O(B <code>SetEnvIf</code> $B%G%#%l%/%F%#%V$dB>$N4XO"(B
+    $B%G%#%l%/%F%#%V$r;HMQ$7$F4D6-JQ?t$r@_Dj$9$k$3$H$,$G$-$^$9!#(B
+    $B$3$N5!G=$K$h$j!"(BCGI
+    $B$KMj$k$3$H$J$/$+$J$jJ#;($JF0E*$J$3$H$r$5$;$k$3$H$,$G$-$^$9!#(B</p>
+    <hr />
+
+    <h2><a id="conclusion" name="conclusion">$B=*$o$j$K(B</a></h2>
+
+    <p>SSI $B$O3N$+$K(B CGI
+    $B$dF0E*$J%&%'%V%Z!<%8$r@8@.$9$kB>$N5;=Q$KBe$o$k$b$N$G$O$"$j$^$;$s!#(B
+    $B$7$+$7!"$?$/$5$s$NM>J,$J:n6H$r$;$:$K!"(B
+    $B>/NL$NF0E*$J%3%s%F%s%D$r2C$($k$K$O$9$0$l$?J}K!$G$9!#(B</p>
+        <hr />
+
+    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <a href="./"><img src="../images/index.gif" alt="Index" /></a>
+    <a href="../"><img src="../images/home.gif" alt="Home" /></a>
+
+
 
-</body>
+  </body>
 </html>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.en /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.en
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.en	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.en	2002-06-18 11:46:44.000000000 +0800
@@ -92,71 +92,74 @@
               <tr>
                 <td align="center" bgcolor="#e9e9e9">
                 <strong>Release Notes</strong> </td>
               </tr>
 
               <tr>
-                <td><a href="new_features_2_0.html">New Features in
+                <td align="left"><a href="new_features_2_0.html">New Features in
                 Version 2.0</a> </td>
               </tr>
 
               <tr>
-                <td><a href="upgrading.html">Upgrading to Version
+                <td align="left"><a href="upgrading.html">Upgrading to Version
                 2.0</a> </td>
               </tr>
 
               <tr>
-                <td><a href="LICENSE">Apache License</a> </td>
+                <td align="left"><a href="LICENSE">Apache License</a> </td>
               </tr>
             </table>
 
             <table border="0" cellpadding="4" cellspacing="0"
             bgcolor="#ffffff" width="280">
               <tr>
                 <td align="center" bgcolor="#e9e9e9">
                 <strong>Reference Manual</strong> </td>
               </tr>
 
               <tr>
-                <td><a href="install.html">Compiling and
+                <td align="left"><a href="install.html">Compiling and
                 Installing</a> </td>
               </tr>
 
               <tr>
-                <td><a href="invoking.html">Starting</a> </td>
+                <td align="left"><a href="invoking.html">Starting</a> </td>
               </tr>
 
               <tr>
-                <td><a href="stopping.html">Stopping or
+                <td align="left"><a href="stopping.html">Stopping or
                 Restarting</a> </td>
               </tr>
 
               <tr>
-                <td><a href="mod/directives.html">Run-time
+                <td align="left"><a href="mod/directives.html">Run-time
                 Configuration Directives</a> </td>
               </tr>
 
               <tr>
-                <td>Modules: <a href="mod/index-bytype.html">By
-                Type</a> or <a href="mod/">Alphabetical</a> </td>
+                <td align="left"><a href="mod/">Modules</a> </td>
               </tr>
 
               <tr>
-                <td><a href="mpm.html">Multi-Processing Modules
+                <td align="left"><a href="mpm.html">Multi-Processing Modules
                 (MPMs)</a> </td>
               </tr>
 
               <tr>
-                <td><a href="programs/">Server and Supporting
-                Programs</a> </td>
+                <td align="left"><a href="filter.html">Filters</a> </td>
+              </tr>
+
+              <tr>
+                <td align="left"><a href="handler.html">Handlers</a> </td>
               </tr>
 
               <tr>
-                <td><a href="dso.html">Dynamic Shared Object (DSO)
-                Support</a> </td>
+                <td align="left"><a href="programs/">Server and Supporting
+                Programs</a> </td>
               </tr>
+
             </table>
 
             <table border="0" cellpadding="4" cellspacing="0"
             bgcolor="#ffffff" width="280">
               <tr>
                 <td align="center" bgcolor="#e9e9e9">
@@ -161,147 +164,153 @@
               <tr>
                 <td align="center" bgcolor="#e9e9e9">
                 <strong>Platform Specific Notes</strong> </td>
               </tr>
 
               <tr>
-                <td><a href="platform/windows.html">Microsoft
+                <td align="left"><a href="platform/windows.html">Microsoft
                 Windows</a> </td>
               </tr>
               <tr>
-                <td><a href="platform/netware.html">Novell NetWare
+                <td align="left"><a href="platform/netware.html">Novell NetWare
                 </a> </td>
               </tr>
             </table>
-          </td>
-
-          <td align="center" valign="top" bgcolor="#cccccc">
-            <table border="0" cellpadding="0" cellspacing="0"
-            bgcolor="#cccccc">
-              <tr>
-                <td align="center"><img src="images/pixel.gif"
-                width="1" height="1" border="0" alt="." /></td>
-              </tr>
-            </table>
-          </td>
 
-          <td align="center" valign="top">
             <table border="0" cellpadding="4" cellspacing="0"
             bgcolor="#ffffff" width="280">
               <tr>
-                <td align="center" bgcolor="#e9e9e9"><strong>Using
-                the Apache HTTP Server</strong> </td>
+                <td align="center" bgcolor="#e9e9e9"><strong>Other
+                Topics</strong> </td>
               </tr>
 
               <tr>
-                <td><a href="configuring.html">Configuration
-                Files</a> </td>
+                <td align="left"><a href="faq/">Frequently Asked Questions</a>
+                </td>
               </tr>
 
               <tr>
-                <td><a href="server-wide.html">Server-Wide
-                Configuration</a> </td>
+                <td align="left"><a href="sitemap.html">SiteMap</a>
+                </td>
               </tr>
 
               <tr>
-                <td><a href="logs.html">Log Files</a> </td>
+                <td align="left"><a href="misc/tutorials.html">Tutorials</a>
+                </td>
               </tr>
 
               <tr>
-                <td><a href="urlmapping.html">Mapping URLs to the
-                Filesystem</a> </td>
+                <td align="left"><a href="developer/">Documentation for
+                Developers</a> </td>
               </tr>
 
               <tr>
-                <td><a href="vhosts/">Virtual Hosts</a> </td>
+                <td align="left"><a href="misc/">Other Notes</a> </td>
               </tr>
+            </table>
 
+
+          </td>
+
+          <td align="center" valign="top" bgcolor="#cccccc">
+            <table border="0" cellpadding="0" cellspacing="0"
+            bgcolor="#cccccc">
               <tr>
-                <td><a href="ssl/">SSL/TLS Strong Encryption</a></td>
+                <td align="center"><img src="images/pixel.gif"
+                width="1" height="1" border="0" alt="." /></td>
               </tr>
+            </table>
+          </td>
 
+          <td align="center" valign="top">
+            <table border="0" cellpadding="4" cellspacing="0"
+            bgcolor="#ffffff" width="280">
               <tr>
-                <td><a href="howto/ssi.html">Server Side
-                Includes</a> </td>
+                <td align="center" bgcolor="#e9e9e9"><strong>Users'
+                Guide</strong> </td>
               </tr>
 
               <tr>
-                <td><a href="howto/cgi.html">Dynamic Content with
-                CGI</a> </td>
+                <td align="left"><a href="howto/auth.html">Authentication,
+                Authorization, and Access Control</a></td>
               </tr>
 
               <tr>
-                <td><a href="handler.html">Handlers</a> </td>
+                <td align="left"><a href="howto/cgi.html">CGI: Dynamic 
+                Content</a> </td>
               </tr>
 
               <tr>
-                <td><a href="filter.html">Filters</a> </td>
+                <td align="left"><a href="configuring.html">Configuration
+                Files</a> </td>
               </tr>
 
               <tr>
-                <td><a href="content-negotiation.html">Content
+                <td align="left"><a href="content-negotiation.html">Content
                 negotiation</a> </td>
               </tr>
 
               <tr>
-                <td><a href="env.html">Environment Variables</a>
+                <td align="left"><a href="dso.html">Dynamic Shared 
+                Objects (DSO)</a> </td>
+              </tr>
+
+              <tr>
+                <td align="left"><a href="env.html">Environment Variables</a>
                 </td>
               </tr>
 
               <tr>
-                <td><a href="suexec.html">Using SetUserID Execution
-                for CGI</a> </td>
+                <td align="left"><a href="logs.html">Log Files</a> </td>
               </tr>
 
               <tr>
-                <td><a href="misc/perf-tuning.html">General
-                Performance hints</a> </td>
+                <td align="left"><a href="urlmapping.html">Mapping URLs to the
+                Filesystem</a> </td>
               </tr>
 
               <tr>
-                <td><a href="misc/security_tips.html">Security
-                tips</a> </td>
+                <td align="left"><a href="misc/perf-tuning.html">Performance 
+                hints</a> </td>
               </tr>
 
               <tr>
-                <td><a href="misc/rewriteguide.html">URL Rewriting
-                Guide</a> </td>
+                <td align="left"><a href="misc/security_tips.html">Security
+                tips</a> </td>
               </tr>
-            </table>
 
-            <table border="0" cellpadding="4" cellspacing="0"
-            bgcolor="#ffffff" width="280">
               <tr>
-                <td align="center" bgcolor="#e9e9e9"><strong>Other
-                Topics</strong> </td>
+                <td align="left"><a href="howto/ssi.html">Server Side
+                Includes (SSI)</a> </td>
               </tr>
 
               <tr>
-                <td><a href="faq/">Frequently Asked Questions</a>
-                </td>
+                <td align="left"><a href="server-wide.html">Server-Wide
+                Configuration</a> </td>
               </tr>
 
               <tr>
-                <td><a href="sitemap.html">SiteMap</a>
-                </td>
+                <td align="left"><a href="ssl/">SSL/TLS Encryption</a></td>
               </tr>
 
               <tr>
-                <td><a href="misc/tutorials.html">Tutorials</a>
-                </td>
+                <td align="left"><a href="suexec.html">Suexec Execution
+                for CGI</a> </td>
               </tr>
 
               <tr>
-                <td><a href="developer/">Documentation for
-                Developers</a> </td>
+                <td align="left"><a href="misc/rewriteguide.html">URL Rewriting
+                Guide</a> </td>
               </tr>
 
               <tr>
-                <td><a href="misc/">Other Notes</a> </td>
+                <td align="left"><a href="vhosts/">Virtual Hosts</a> </td>
               </tr>
+
             </table>
+
           </td>
         </tr>
       </table>
     </div>
 
     <p align="center">Maintained by the <a
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.fr /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.fr
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.fr	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.fr	2002-06-18 11:46:44.000000000 +0800
@@ -124,15 +124,13 @@
               <tr>
                 <td><a href="mod/directives.html">Directives de
                 configuration de l'ex&eacute;cution</a> </td>
               </tr>
 
               <tr>
-                <td>Modules <a href="mod/index-bytype.html">par
-                type</a> ou <a href="mod/">par ordre
-                alphab&eacute;tique</a> </td>
+                <td><a href="mod/">Modules</a> </td>
               </tr>
 
               <tr>
                 <td><a href="mpm.html">Modules Multi-Traitements
                 (MPMs)</a> </td>
               </tr>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/index.html.ja.jis	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/index.html.ja.jis	2002-06-18 11:46:44.000000000 +0800
@@ -4,13 +4,13 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
   <head>
 
     <title>Apache HTTP $B%5!<%P(B $B%P!<%8%g%s(B 2.0 $B%I%-%e%a%s%H(B</title>
 
   </head>
-  <!-- English revision: 1.30 -->
+  <!-- English revision: 1.33 -->
   <body bgcolor="#ffffff" text="#000000" link="#0000ff"
   vlink="#000080" alink="#ff0000">
     <div align="center">
       <table cellspacing="0" cellpadding="0" border="0"
       width="600">
         <tr>
@@ -29,12 +29,16 @@
 
                 <td align="center" bgcolor="#bebebe"><a
                 href="mod/directives.html"><strong>$B%G%#%l%/%F%#%V(B</strong></a>
                 </td>
 
                 <td align="center" bgcolor="#bebebe"><a
+                href="sitemap.html"><strong>$B%5%$%H%^%C%W(B</strong></a>
+                </td>
+
+                <td align="center" bgcolor="#bebebe"><a
                 href="mod/"><strong>$B%b%8%e!<%k(B</strong></a> </td>
 
                 <td align="center" bgcolor="#bebebe"><a
                 href="http://www.apache.org/search.html"
                 ><strong>$B8!:w(B</strong></a> </td>
               </tr>
@@ -88,219 +92,217 @@
                <tr>
                  <td align="center" bgcolor="#e9e9e9">
                  <strong>$B%j%j!<%9%N!<%H(B</strong> </td>
                </tr>
 
                <tr>
-                 <td><a href="new_features_2_0.html">Apache 2.0
+                 <td align="left"><a href="new_features_2_0.html">Apache 2.0
                  $B$N?75!G=(B</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="upgrading.html">Apache 2.0
+                 <td align="left"><a href="upgrading.html">Apache 2.0
                  $B$X$N%"%C%W%0%l!<%I(B</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="license">Apache $B$N%i%$%;%s%9(B</a> </td>
+                 <td align="left"><a href="LICENSE">Apache $B$N%i%$%;%s%9(B</a> </td>
                </tr>
              </table>
 
              <table border="0" cellpadding="4" cellspacing="0"
              bgcolor="#ffffff" width="280">
                <tr>
                  <td align="center" bgcolor="#e9e9e9">
                  <strong>$B%j%U%!%l%s%9%^%K%e%"%k(B</strong> </td>
                </tr>
 
                <tr>
-                 <td><a
+                 <td align="left"><a
                  href="install.html">$B%3%s%Q%$%k$H%$%s%9%H!<%k(B</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="invoking.html">$B5/F0(B</a> </td>
+                 <td align="left"><a href="invoking.html">$B5/F0(B</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="stopping.html">$B=*N;$^$?$O:F5/F0(B</a>
+                 <td align="left"><a href="stopping.html">$B=*N;$H:F5/F0(B</a>
                  </td>
                </tr>
 
                <tr>
-                 <td><a href="sitemap.html">$B%5%$%H%^%C%W(B</a>
+                 <td align="left"><a
+                 href="mod/directives.html">$B<B9T$N@_DjMQ%G%#%l%/%F%#%V(B</a>
                  </td>
                </tr>
 
                <tr>
-                 <td><a href="mod/directives.html">$B%G%#%l%/%F%#%V(B</a>
-                 </td>
+                 <td align="left"><a href="mod/">$B%b%8%e!<%k(B</a> </td>
                </tr>
 
                <tr>
-                 <td>$B%b%8%e!<%k(B: <a href="mod/index-bytype.html">$B<oN`JL(B</a>
-                 $B$H(B <a href="mod/">$B%"%k%U%!%Y%C%H=g(B</a> </td>
+                 <td align="left"><a href="mpm.html">$B%^%k%A%W%m%;%C%7%s%0%b%8%e!<%k(B
+                 (MPM)</a> </td>
                </tr>
 
-               <tr>
-                 <td><a href="mpm.html">Multi-Processing Modules
-                 (MPMs)</a> </td>
-               </tr>
+              <tr>
+                <td align="left"><a href="filter.html">$B%U%#%k%?(B</a> </td>
+              </tr>
 
-               <tr>
-                 <td><a
-                 href="programs/">$B%5!<%P$H%5%]!<%H%W%m%0%i%`(B</a></td>
-               </tr>
+              <tr>
+                <td align="left"><a href="handler.html">$B%O%s%I%i(B</a> </td>
+              </tr>
 
                <tr>
-                 <td><a href="dso.html">Dynamic Shared Object (DSO)
-                 $B$N%5%]!<%H(B</a> </td>
+                 <td align="left"><a
+                 href="programs/">$B%5!<%P$H%5%]!<%H%W%m%0%i%`(B</a></td>
                </tr>
              </table>
 
              <table border="0" cellpadding="4" cellspacing="0"
              bgcolor="#ffffff" width="280">
                <tr>
                  <td align="center" bgcolor="#e9e9e9">
                  <strong>$B%W%i%C%H%U%)!<%`8GM-$N>pJs(B</strong></td>
                </tr>
 
                <tr>
-                 <td><a href="platform/windows.html">Microsoft
+                 <td align="left"><a href="platform/windows.html">Microsoft
                  Windows</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="platform/netware.html">Novell
+                 <td align="left"><a href="platform/netware.html">Novell
                  NetWare</a> </td>
                </tr>
              </table>
-           </td>
 
-           <td align="center" valign="top" bgcolor="#cccccc">
-             <table border="0" cellpadding="0" cellspacing="0"
-             bgcolor="#cccccc">
-               <tr>
-                 <td align="center"><img src="images/pixel.gif"
-                 width="1" height="1" border="0" alt="." /></td>
-               </tr>
-             </table>
-           </td>
-
-           <td align="center" valign="top">
              <table border="0" cellpadding="4" cellspacing="0"
-             bgcolor="#ffffff" width="280">
+	       bgcolor="#ffffff" width="280">
                <tr>
                  <td align="center" bgcolor="#e9e9e9">
-                 <strong>Apache HTTP $B%5!<%P$r;H$&(B</strong> </td>
+		 <strong>$B$=$NB>(B</strong> </td>
                </tr>
 
                <tr>
-                 <td><a href="configuring.html">$B@_Dj%U%!%$%k(B</a> </td>
+		 <td><a href="faq/">FAQ</a> </td>
                </tr>
 
                <tr>
-                 <td><a href="server-wide.html">$B%5!<%PA4BN$N@_Dj(B</a> </td>
+		 <td><a href="sitemap.html">$B%5%$%H%^%C%W(B</a> </td>
                </tr>
 
 
-              <tr>
-                <td><a href="logs.html">$B%m%0%U%!%$%k(B</a> </td>
-              </tr>
+	       <tr>
+		 <td><a href="misc/tutorials.html">$B%A%e!<%H%j%"%k(B</a>
+		 </td>
+	       </tr>
 
                <tr>
-                 <td><a href="urlmapping.html">URL
-                 $B$r%U%!%$%k%7%9%F%`$K%^%C%W$9$k(B</a></td>
+		 <td><a href="developer/">$B3+H/<T$N$?$a$N%I%-%e%a%s%H(B</a>
+		 </td>
                </tr>
 
                <tr>
-                 <td><a href="vhosts/">$B%P!<%A%c%k%[%9%H(B</a></td>
+		  <td><a href="misc/">$B$=$NB>(B</a> </td>
                </tr>
+	     </table>
+           </td>
 
-              <tr>
-                <td><a href="ssl/">SSL/TLS $B$K$h$k6/NO$J0E9f2=(B</a></td>
-              </tr>
+           <td align="center" valign="top" bgcolor="#cccccc">
+             <table border="0" cellpadding="0" cellspacing="0"
+             bgcolor="#cccccc">
+               <tr>
+                 <td align="center"><img src="images/pixel.gif"
+                 width="1" height="1" border="0" alt="." /></td>
+               </tr>
+             </table>
+           </td>
+
+           <td align="center" valign="top">
+             <table border="0" cellpadding="4" cellspacing="0"
+             bgcolor="#ffffff" width="280">
+               <tr>
+                 <td align="center" bgcolor="#e9e9e9">
+                 <strong>Apache HTTP $B%5!<%P$r;H$&(B</strong> </td>
+               </tr>
 
               <tr>
-                <td><a href="howto/ssi.html">Server Side
-                Includes</a> </td>
+                <td><a href="howto/auth.html">$BG'>Z!"(B
+                $B>5G'!"%"%/%;%9@)8f(B</a></td>
               </tr>
 
               <tr>
                 <td><a href="howto/cgi.html">CGI $B$K$h$kF0E*%3%s%F%s%D(B</a>
                 </td>
               </tr>
 
-              <tr>
-                <td><a href="handler.html">$B%O%s%I%i(B</a> </td>
-              </tr>
-
-              <tr>
-                <td><a href="filter.html">$B%U%#%k%?(B</a> </td>
-              </tr>
+               <tr>
+                 <td><a href="configuring.html">$B@_Dj%U%!%$%k(B</a> </td>
+               </tr>
 
               <tr>
                 <td><a href="content-negotiation.html"
                 >$B%3%s%F%s%H%M%4%7%(!<%7%g%s(B</a> </td>
               </tr>
 
+               <tr>
+                 <td><a href="dso.html">$BF0E*6&M-%*%V%8%'%/%H(B (DSO)
+                 $B$N%5%]!<%H(B</a> </td>
+               </tr>
+
               <tr>
                 <td><a href="env.html">$B4D6-JQ?t(B</a> </td>
               </tr>
 
-
               <tr>
-                <td><a href="suexec.html">CGI $B$G(B SetUserID
-                $B<B9T$r;H$&(B</a> </td>
+                <td><a href="logs.html">$B%m%0%U%!%$%k(B</a> </td>
               </tr>
 
+               <tr>
+                 <td><a href="urlmapping.html">URL
+                 $B$r%U%!%$%k%7%9%F%`$K%^%C%W$9$k(B</a></td>
+               </tr>
+
               <tr>
                 <td><a href="misc/perf-tuning.html"
-                >$B0lHLE*$J@-G=$K4X$9$k%R%s%H(B</a> </td>
+                >$B@-G=$K4X$9$k%R%s%H(B</a> </td>
               </tr>
 
               <tr>
                 <td><a href="misc/security_tips.html"
                 >$B%;%-%e%j%F%#>pJs(B</a> </td>
               </tr>
 
               <tr>
-                <td><a href="misc/rewriteguide.html">URL Rewriting
-                $B$N%,%$%I(B</a> </td>
-              </tr>
-            </table>
-
-            <table border="0" cellpadding="4" cellspacing="0"
-              bgcolor="#ffffff" width="280">
-              <tr>
-                <td align="center" bgcolor="#e9e9e9">
-                <strong>$B$=$NB>(B</strong> </td>
+                <td><a href="howto/ssi.html">Server Side
+                Includes</a> </td>
               </tr>
 
-              <tr>
-                <td><a href="faq/">FAQ</a> </td>
-              </tr>
+               <tr>
+                 <td><a href="server-wide.html">$B%5!<%PA4BN$N@_Dj(B</a> </td>
+               </tr>
 
               <tr>
-                <td><a href="sitemap.html">$B%5%$%H%^%C%W(B</a> </td>
+                <td><a href="ssl/">SSL/TLS $B$K$h$k6/NO$J0E9f2=(B</a></td>
               </tr>
 
-
               <tr>
-                <td><a href="misc/tutorials.html">$B%A%e!<%H%j%"%k(B</a>
-                </td>
+                <td><a href="suexec.html">CGI $B$N(B Suexec
+                $B<B9T(B</a> </td>
               </tr>
 
               <tr>
-                <td><a href="developer/">$B3+H/<T$N$?$a$N%I%-%e%a%s%H(B</a>
-                </td>
+                <td><a href="misc/rewriteguide.html">URL Rewriting
+                $B$N%,%$%I(B</a> </td>
               </tr>
 
-              <tr>
-                 <td><a href="misc/">$B$=$NB>(B</a> </td>
-              </tr>
+               <tr>
+                 <td><a href="vhosts/">$B%P!<%A%c%k%[%9%H(B</a></td>
+               </tr>
             </table>
           </td>
         </tr>
       </table>
     </div>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: index.html.ko.euc-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: install.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: install.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: install.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: install.html.ko.euc-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: invoking.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: invoking.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: invoking.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/logs.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/logs.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/logs.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/logs.html	2002-06-18 11:46:44.000000000 +0800
@@ -50,13 +50,13 @@
       </li>
 
       <li><a href="#rotation">Log Rotation</a></li>
 
       <li><a href="#piped">Piped Logs</a></li>
 
-      <li><a href="#virtualhosts">VirtualHosts</a></li>
+      <li><a href="#virtualhosts">Virtual Hosts</a></li>
 
       <li>
         <a href="#other">Other Log Files</a> 
 
         <ul>
           <li><a href="#pidfile">PID File</a></li>
@@ -107,13 +107,13 @@
     what went wrong and how to fix it.</p>
 
     <p>The error log is usually written to a file (typically
     <code>error_log</code> on unix systems and
     <code>error.log</code> on Windows and OS/2). On unix systems it
     is also possible to have the server send errors to
-    <code>syslog</code> or <a href="#pipe">pipe them to a
+    <code>syslog</code> or <a href="#piped">pipe them to a
     program</a>.</p>
 
     <p>The format of the error log is relatively free-form and
     descriptive. But there is certain information that is contained
     in most error log entries. For example, here is a typical
     message.</p>
@@ -550,14 +550,13 @@
     <blockquote>
       <code>CustomLog "|/usr/local/apache/bin/rotatelogs
       /var/log/access_log 86400" common</code>
     </blockquote>
 
     <p>A similar, but much more flexible log rotation program
-    called <a
-    href="http://www.ford-mason.co.uk/resources/cronolog/">cronolog</a>
+    called <a href="http://www.cronolog.org/">cronolog</a>
     is available at an external site.</p>
 
     <p>As with conditional logging, piped logs are a very powerful
     tool, but they should not be used where a simpler solution like
     off-line post-processing is available.</p>
     <hr />
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/fin_wait_2.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/fin_wait_2.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/fin_wait_2.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/fin_wait_2.html	2002-06-18 11:46:44.000000000 +0800
@@ -27,13 +27,13 @@
       <li>
         <h2>What is the FIN_WAIT_2 state?</h2>
         Starting with the Apache 1.2 betas, people are reporting
         many more connections in the FIN_WAIT_2 state (as reported
         by <code>netstat</code>) than they saw using older
         versions. When the server closes a TCP connection, it sends
-        a packet with the FIN bit sent to the client, which then
+        a packet with the FIN bit set to the client, which then
         responds with a packet with the ACK bit set. The client
         then sends a packet with the FIN bit set to the server,
         which responds with an ACK and the connection is closed.
         The state that the connection is in during the period
         between when the server gets the ACK from the client and
         the server gets the FIN from the client is known as
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/perf-tuning.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/perf-tuning.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/perf-tuning.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/perf-tuning.html	2002-06-18 11:46:44.000000000 +0800
@@ -17,13 +17,13 @@
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
 
     <blockquote>
-      <strong>Warning:</strong> This document has not been updated
+      <strong>Warning:</strong> This document has not been fully updated
       to take into account changes made in the 2.0 version of the
       Apache HTTP Server. Some of the information may still be
       relevant, but please use it with care.
     </blockquote>
 
     <h1 align="center">Apache Performance Notes</h1>
@@ -44,16 +44,12 @@
       <li>
         Appendixes 
 
         <ul>
           <li><a href="#trace">Detailed Analysis of a
           Trace</a></li>
-
-          <li><a href="#patches">Patches Available</a></li>
-
-          <li><a href="#preforking">The Pre-Forking Model</a></li>
         </ul>
       </li>
     </ul>
     <hr />
 
     <table border="1">
@@ -72,12 +68,14 @@
         href="../mod/core.html#allowoverride">AllowOverride</a><br />
          <a
         href="../mod/mod_dir.html#directoryindex">DirectoryIndex</a><br />
          <a
         href="../mod/core.html#hostnamelookups">HostnameLookups</a><br />
          <a
+        href="../mod/core.html#enablemmap">EnableMMAP</a><br />
+         <a
         href="../mod/core.html#keepalivetimeout">KeepAliveTimeout</a><br />
          <a
         href="../mod/prefork.html#maxspareservers">MaxSpareServers</a><br />
          <a
         href="../mod/prefork.html#mixspareservers">MinSpareServers</a><br />
          <a href="../mod/core.html#options">Options</a>
@@ -88,44 +86,29 @@
       </tr>
     </table>
 
     <h3><a id="introduction"
     name="introduction">Introduction</a></h3>
 
-    <p>Apache is a general webserver, which is designed to be
-    correct first, and fast second. Even so, its performance is
-    quite satisfactory. Most sites have less than 10Mbits of
-    outgoing bandwidth, which Apache can fill using only a low end
-    Pentium-based webserver. In practice sites with more bandwidth
-    require more than one machine to fill the bandwidth due to
-    other constraints (such as CGI or database transaction
-    overhead). For these reasons the development focus has been
-    mostly on correctness and configurability.</p>
-
-    <p>Unfortunately many folks overlook these facts and cite raw
-    performance numbers as if they are some indication of the
-    quality of a web server product. There is a bare minimum
-    performance that is acceptable, beyond that extra speed only
-    caters to a much smaller segment of the market. But in order to
-    avoid this hurdle to the acceptance of Apache in some markets,
-    effort was put into Apache 1.3 to bring performance up to a
-    point where the difference with other high-end webservers is
-    minimal.</p>
-
-    <p>Finally there are the folks who just plain want to see how
-    fast something can go. The author falls into this category. The
-    rest of this document is dedicated to these folks who want to
-    squeeze every last bit of performance out of Apache's current
-    model, and want to understand why it does some things which
-    slow it down.</p>
-
-    <p>Note that this is tailored towards Apache 1.3 on Unix. Some
-    of it applies to Apache on NT. Apache on NT has not been tuned
-    for performance yet; in fact it probably performs very poorly
-    because NT performance requires a different programming
-    model.</p>
+    <p>Apache 2.0 is a general-purpose webserver, designed to
+    provide a balance of flexibility, portability, and performance.
+    Although it has not been designed specifically to set benchmark
+    records, Apache 2.0 is capable of high performance in many
+    real-world situations.</p>
+
+    <p>Compared to Apache 1.3, release 2.0 contains many additional
+    optimizations to increase throughput and scalability.  Most of
+    these improvements are enabled by default.  However, there are
+    compile-time and run-time configuration choices that can
+    significantly affect performance.  This document describes the
+    options that a server administrator can configure to tune the
+    performance of an Apache 2.0 installation.  Some of these
+    configuration options enable the httpd to better take advantage
+    of the capabilities of the hardware and OS, while others allow
+    the administrator to trade functionality for speed.</p>
+
     <hr />
 
     <h3><a id="hardware" name="hardware">Hardware and Operating
     System Issues</a></h3>
 
     <p>The single biggest hardware issue affecting webserver
@@ -140,16 +123,28 @@
     <p>Beyond that the rest is mundane: get a fast enough CPU, a
     fast enough network card, and fast enough disks, where "fast
     enough" is something that needs to be determined by
     experimentation.</p>
 
     <p>Operating system choice is largely a matter of local
-    concerns. But a general guideline is to always apply the latest
-    vendor TCP/IP patches. HTTP serving completely breaks many of
-    the assumptions built into Unix kernels up through 1994 and
-    even 1995. Good choices include recent FreeBSD, and Linux.</p>
+    concerns. But some guidelines that have proven generally
+    useful are:</p>
+    <ul>
+      <li>Run the latest stable release and patchlevel of the
+      operating system that you choose.  Many OS suppliers have
+      introduced significant performance improvements to their
+      TCP stacks and thread libraries in recent years.</li>
+      <li>If your OS supports a sendfile(2) system call, make
+      sure you install the release and/or patches needed to
+      enable it.  (With Linux, for example, this means using
+      Linux 2.4 or later.  For early releases of Solaris 8,
+      you may need to apply a patch.)  On systems where it
+      is available, sendfile enables Apache 2 to deliver
+      static content faster and with lower CPU utilization.</li>
+    </ul>
+
     <hr />
 
     <h3><a id="runtime" name="runtime">Run-Time Configuration
     Issues</a></h3>
 
     <h4>HostnameLookups</h4>
@@ -284,12 +279,41 @@
     <p>Also note that explicitly creating a <code>type-map</code>
     file provides better performance than using
     <code>MultiViews</code>, as the necessary information can be
     determined by reading this single file, rather than having to
     scan the directory for files.</p>
 
+    <h4>Memory-mapping</h4>
+
+    <p>In situations where Apache 2.0 needs to look at the contents
+    of a file being delivered--for example, when doing server-side-include
+    processing--it normally memory-maps the file if the OS supports
+    some form of mmap(2).
+    </p>
+
+    <p>On some platforms, this memory-mapping improves performance.
+    However, there are cases where memory-mapping can hurt the performance
+    or even the stability of the httpd:</p>
+
+    <ul>
+      <li>On some operating systems, mmap does not scale as well as
+      read(2) when the number of CPUs increases.  On multiprocessor
+      Solaris servers, for example, Apache 2.0 sometimes delivers
+      server-parsed files faster when mmap is disabled.</li>
+
+      <li>If you memory-map a file located on an NFS-mounted filesystem
+      and a process on another NFS client machine deletes or truncates
+      the file, your process may get a bus error the next time it tries
+      to access the mapped file content.</li>
+    </ul>
+
+    <p>For installations where either of these factors applies, you
+    should use <code>EnableMMAP off</code> to disable the memory-mapping
+    of delivered files.  (Note: This directive can be overridden on
+    a per-directory basis.)</p>
+
     <h4>Process Creation</h4>
 
     <p>Prior to Apache 1.3 the <code>MinSpareServers</code>,
     <code>MaxSpareServers</code>, and <code>StartServers</code>
     settings all had drastic effects on benchmark results. In
     particular, Apache required a "ramp-up" period in order to
@@ -682,393 +706,155 @@
     server. This will save RAM that's allocated only for supporting
     dynamically loaded modules.</p>
     <hr />
 
     <h3><a id="trace" name="trace">Appendix: Detailed Analysis of a
     Trace</a></h3>
-    Here is a system call trace of Apache 1.3 running on Linux. The
-    run-time configuration file is essentially the default plus: 
-
-    <blockquote>
-<pre>
-&lt;Directory /&gt;
-    AllowOverride none
-    Options FollowSymLinks
-&lt;/Directory&gt;
-</pre>
-    </blockquote>
-    The file being requested is a static 6K file of no particular
-    content. Traces of non-static requests or requests with content
-    negotiation look wildly different (and quite ugly in some
-    cases). First the entire trace, then we'll examine details.
-    (This was generated by the <code>strace</code> program, other
-    similar programs include <code>truss</code>,
-    <code>ktrace</code>, and <code>par</code>.) 
-
-    <blockquote>
-<pre>
-accept(15, {sin_family=AF_INET, sin_port=htons(22283), sin_addr=inet_addr("127.0.0.1")}, [16]) = 3
-flock(18, LOCK_UN)                      = 0
-sigaction(SIGUSR1, {SIG_IGN}, {0x8059954, [], SA_INTERRUPT}) = 0
-getsockname(3, {sin_family=AF_INET, sin_port=htons(8080), sin_addr=inet_addr("127.0.0.1")}, [16]) = 0
-setsockopt(3, IPPROTO_TCP1, [1], 4)     = 0
-read(3, "GET /6k HTTP/1.0\r\nUser-Agent: "..., 4096) = 60
-sigaction(SIGUSR1, {SIG_IGN}, {SIG_IGN}) = 0
-time(NULL)                              = 873959960
-gettimeofday({873959960, 404935}, NULL) = 0
-stat("/home/dgaudet/ap/apachen/htdocs/6k", {st_mode=S_IFREG|0644, st_size=6144, ...}) = 0
-open("/home/dgaudet/ap/apachen/htdocs/6k", O_RDONLY) = 4
-mmap(0, 6144, PROT_READ, MAP_PRIVATE, 4, 0) = 0x400ee000
-writev(3, [{"HTTP/1.1 200 OK\r\nDate: Thu, 11"..., 245}, {"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 6144}], 2) = 6389
-close(4)                                = 0
-time(NULL)                              = 873959960
-write(17, "127.0.0.1 - - [10/Sep/1997:23:39"..., 71) = 71
-gettimeofday({873959960, 417742}, NULL) = 0
-times({tms_utime=5, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 446747
-shutdown(3, 1 /* send */)               = 0
-oldselect(4, [3], NULL, [3], {2, 0})    = 1 (in [3], left {2, 0})
-read(3, "", 2048)                       = 0
-close(3)                                = 0
-sigaction(SIGUSR1, {0x8059954, [], SA_INTERRUPT}, {SIG_IGN}) = 0
-munmap(0x400ee000, 6144)                = 0
-flock(18, LOCK_EX)                      = 0
-</pre>
-    </blockquote>
-
-    <p>Notice the accept serialization:</p>
-
-    <blockquote>
-<pre>
-flock(18, LOCK_UN)                      = 0
-...
-flock(18, LOCK_EX)                      = 0
-</pre>
-    </blockquote>
-    These two calls can be removed by defining
-    <code>SINGLE_LISTEN_UNSERIALIZED_ACCEPT</code> as described
-    earlier. 
-
-    <p>Notice the <code>SIGUSR1</code> manipulation:</p>
-
-    <blockquote>
-<pre>
-sigaction(SIGUSR1, {SIG_IGN}, {0x8059954, [], SA_INTERRUPT}) = 0
-...
-sigaction(SIGUSR1, {SIG_IGN}, {SIG_IGN}) = 0
-...
-sigaction(SIGUSR1, {0x8059954, [], SA_INTERRUPT}, {SIG_IGN}) = 0
-</pre>
-    </blockquote>
-    This is caused by the implementation of graceful restarts. When
-    the parent receives a <code>SIGUSR1</code> it sends a
-    <code>SIGUSR1</code> to all of its children (and it also
-    increments a "generation counter" in shared memory). Any
-    children that are idle (between connections) will immediately
-    die off when they receive the signal. Any children that are in
-    keep-alive connections, but are in between requests will die
-    off immediately. But any children that have a connection and
-    are still waiting for the first request will not die off
-    immediately. 
-
-    <p>To see why this is necessary, consider how a browser reacts
-    to a closed connection. If the connection was a keep-alive
-    connection and the request being serviced was not the first
-    request then the browser will quietly reissue the request on a
-    new connection. It has to do this because the server is always
-    free to close a keep-alive connection in between requests
-    (<em>i.e.</em>, due to a timeout or because of a maximum number
-    of requests). But, if the connection is closed before the first
-    response has been received the typical browser will display a
-    "document contains no data" dialogue (or a broken image icon).
-    This is done on the assumption that the server is broken in
-    some way (or maybe too overloaded to respond at all). So Apache
-    tries to avoid ever deliberately closing the connection before
-    it has sent a single response. This is the cause of those
-    <code>SIGUSR1</code> manipulations.</p>
-
-    <p>Note that it is theoretically possible to eliminate all
-    three of these calls. But in rough tests the gain proved to be
-    almost unnoticeable.</p>
-
-    <p>In order to implement virtual hosts, Apache needs to know
-    the local socket address used to accept the connection:</p>
-
-    <blockquote>
-<pre>
-getsockname(3, {sin_family=AF_INET, sin_port=htons(8080), sin_addr=inet_addr("127.0.0.1")}, [16]) = 0
-</pre>
-    </blockquote>
-    It is possible to eliminate this call in many situations (such
-    as when there are no virtual hosts, or when <code>Listen</code>
-    directives are used which do not have wildcard addresses). But
-    no effort has yet been made to do these optimizations. 
-
-    <p>Apache turns off the Nagle algorithm:</p>
-
-    <blockquote>
-<pre>
-setsockopt(3, IPPROTO_TCP1, [1], 4)     = 0
-</pre>
-    </blockquote>
-    because of problems described in <a
-    href="http://www.isi.edu/~johnh/PAPERS/Heidemann97a.html">a
-    paper by John Heidemann</a>. 
-
-    <p>Notice the two <code>time</code> calls:</p>
-
-    <blockquote>
-<pre>
-time(NULL)                              = 873959960
-...
-time(NULL)                              = 873959960
-</pre>
-    </blockquote>
-    One of these occurs at the beginning of the request, and the
-    other occurs as a result of writing the log. At least one of
-    these is required to properly implement the HTTP protocol. The
-    second occurs because the Common Log Format dictates that the
-    log record include a timestamp of the end of the request. A
-    custom logging module could eliminate one of the calls. Or you
-    can use a method which moves the time into shared memory, see
-    the <a href="#patches">patches section below</a>. 
-
-    <p>As described earlier, <code>ExtendedStatus On</code> causes
-    two <code>gettimeofday</code> calls and a call to
-    <code>times</code>:</p>
-
-    <blockquote>
-<pre>
-gettimeofday({873959960, 404935}, NULL) = 0
-...
-gettimeofday({873959960, 417742}, NULL) = 0
-times({tms_utime=5, tms_stime=0, tms_cutime=0, tms_cstime=0}) = 446747
-</pre>
-    </blockquote>
-    These can be removed by setting <code>ExtendedStatus Off</code>
-    (which is the default). 
-
-    <p>It might seem odd to call <code>stat</code>:</p>
-
-    <blockquote>
-<pre>
-stat("/home/dgaudet/ap/apachen/htdocs/6k", {st_mode=S_IFREG|0644, st_size=6144, ...}) = 0
-</pre>
-    </blockquote>
-    This is part of the algorithm which calculates the
-    <code>PATH_INFO</code> for use by CGIs. In fact if the request
-    had been for the URI <code>/cgi-bin/printenv/foobar</code> then
-    there would be two calls to <code>stat</code>. The first for
-    <code>/home/dgaudet/ap/apachen/cgi-bin/printenv/foobar</code>
-    which does not exist, and the second for
-    <code>/home/dgaudet/ap/apachen/cgi-bin/printenv</code>, which
-    does exist. Regardless, at least one <code>stat</code> call is
-    necessary when serving static files because the file size and
-    modification times are used to generate HTTP headers (such as
-    <code>Content-Length</code>, <code>Last-Modified</code>) and
-    implement protocol features (such as
-    <code>If-Modified-Since</code>). A somewhat more clever server
-    could avoid the <code>stat</code> when serving non-static
-    files, however doing so in Apache is very difficult given the
-    modular structure. 
-
-    <p>All static files are served using <code>mmap</code>:</p>
-
-    <blockquote>
-<pre>
-mmap(0, 6144, PROT_READ, MAP_PRIVATE, 4, 0) = 0x400ee000
-...
-munmap(0x400ee000, 6144)                = 0
-</pre>
-    </blockquote>
-    On some architectures it's slower to <code>mmap</code> small
-    files than it is to simply <code>read</code> them. The define
-    <code>MMAP_THRESHOLD</code> can be set to the minimum size
-    required before using <code>mmap</code>. By default it's set to
-    0 (except on SunOS4 where experimentation has shown 8192 to be
-    a better value). Using a tool such as <a
-    href="http://www.bitmover.com/lmbench/">lmbench</a> you can
-    determine the optimal setting for your environment. 
-
-    <p>You may also wish to experiment with
-    <code>MMAP_SEGMENT_SIZE</code> (default 32768) which determines
-    the maximum number of bytes that will be written at a time from
-    mmap()d files. Apache only resets the client's
-    <code>Timeout</code> in between write()s. So setting this large
-    may lock out low bandwidth clients unless you also increase the
-    <code>Timeout</code>.</p>
-
-    <p>It may even be the case that <code>mmap</code> isn't used on
-    your architecture; if so then defining
-    <code>USE_MMAP_FILES</code> and <code>HAVE_MMAP</code> might
-    work (if it works then report back to us).</p>
-
-    <p>Apache does its best to avoid copying bytes around in
-    memory. The first write of any request typically is turned into
-    a <code>writev</code> which combines both the headers and the
-    first hunk of data:</p>
-
-    <blockquote>
-<pre>
-writev(3, [{"HTTP/1.1 200 OK\r\nDate: Thu, 11"..., 245}, {"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 6144}], 2) = 6389
-</pre>
-    </blockquote>
-    When doing HTTP/1.1 chunked encoding Apache will generate up to
-    four element <code>writev</code>s. The goal is to push the byte
-    copying into the kernel, where it typically has to happen
-    anyhow (to assemble network packets). On testing, various
-    Unixes (BSDI 2.x, Solaris 2.5, Linux 2.0.31+) properly combine
-    the elements into network packets. Pre-2.0.31 Linux will not
-    combine, and will create a packet for each element, so
-    upgrading is a good idea. Defining <code>NO_WRITEV</code> will
-    disable this combining, but result in very poor chunked
-    encoding performance. 
-
-    <p>The log write:</p>
-
-    <blockquote>
-<pre>
-write(17, "127.0.0.1 - - [10/Sep/1997:23:39"..., 71) = 71
-</pre>
-    </blockquote>
-    can be deferred by defining <code>BUFFERED_LOGS</code>. In this
-    case up to <code>PIPE_BUF</code> bytes (a POSIX defined
-    constant) of log entries are buffered before writing. At no
-    time does it split a log entry across a <code>PIPE_BUF</code>
-    boundary because those writes may not be atomic.
-    (<em>i.e.</em>, entries from multiple children could become
-    mixed together). The code does its best to flush this buffer
-    when a child dies. 
-
-    <p>The lingering close code causes four system calls:</p>
-
-    <blockquote>
-<pre>
-shutdown(3, 1 /* send */)               = 0
-oldselect(4, [3], NULL, [3], {2, 0})    = 1 (in [3], left {2, 0})
-read(3, "", 2048)                       = 0
-close(3)                                = 0
-</pre>
+    <p>Here is a system call trace of Apache 2.0.38 with the worker MPM
+    on Solaris 8.  This trace was collected using:</p>
+<blockquote>
+<code>truss -l -p <i>httpd_child_pid</i></code>.</code>
+</blockquote>
+    <p>The <code>-l</code> option tells truss to log the ID of the
+    LWP (lightweight process--Solaris's form of kernel-level thread)
+    that invokes each system call.</p>
+
+    <p>Other systems may have different system call tracing utilities
+    such as <code>strace</code>, <code>ktrace</code>, or <code>par</code>.
+    They all produce similar output.</p>
+
+    <p>In this trace, a client has requested a 10KB static file
+    from the httpd.  Traces of non-static requests or requests
+    with content negotiation look wildly different (and quite ugly
+    in some cases).
+
+    <blockquote>
+<pre>
+/67:    accept(3, 0x00200BEC, 0x00200C0C, 1) (sleeping...)
+/67:    accept(3, 0x00200BEC, 0x00200C0C, 1)            = 9
+</pre>
+<blockquote>
+<p>In this trace, the listener thread is running within LWP #67.</p>
+<p>Note the lack of accept(2) serialization.  On this particular
+platform, the worker MPM uses an unserialized accept by default
+unless it is listening on multiple ports.</p>
+</blockquote>
+<pre>
+/65:    lwp_park(0x00000000, 0)                         = 0
+/67:    lwp_unpark(65, 1)                               = 0
+</pre>
+<blockquote>
+<p>Upon accepting the connection, the listener thread wakes up
+a worker thread to do the request processing.  In this trace,
+the worker thread that handles the request is mapped to LWP #65.</p>
+</blockquote>
+<pre>
+/65:    getsockname(9, 0x00200BA4, 0x00200BC4, 1)       = 0
+</pre>
+<blockquote>
+<p>In order to implement virtual hosts, Apache needs to know
+the local socket address used to accept the connection.  It
+is possible to eliminate this call in many situations (such
+as when there are no virtual hosts, or when <code>Listen</code>
+directives are used which do not have wildcard addresses). But
+no effort has yet been made to do these optimizations. </p>
+</blockquote>
+<pre>
+/65:    brk(0x002170E8)                                 = 0
+/65:    brk(0x002190E8)                                 = 0
+</pre>
+<blockquote>
+<p>The brk(2) calls allocate memory from the heap.  It is rare
+to see these in a system call trace, because the httpd uses
+custom memory allocators (<code>apr_pool</code> and
+<code>apr_bucket_alloc</code>) for most request processing.
+In this trace, the httpd has just been started, so it must
+call malloc(3) to get the blocks of raw memory with which
+to create the custom memory allocators.
+</blockquote>
+<pre>
+/65:    fcntl(9, F_GETFL, 0x00000000)                   = 2
+/65:    fstat64(9, 0xFAF7B818)                          = 0
+/65:    getsockopt(9, 65535, 8192, 0xFAF7B918, 0xFAF7B910, 2190656) = 0
+/65:    fstat64(9, 0xFAF7B818)                          = 0
+/65:    getsockopt(9, 65535, 8192, 0xFAF7B918, 0xFAF7B914, 2190656) = 0
+/65:    setsockopt(9, 65535, 8192, 0xFAF7B918, 4, 2190656) = 0
+/65:    fcntl(9, F_SETFL, 0x00000082)                   = 0
+</pre>
+<blockquote>
+<p>Next, the worker thread puts the connection to the client (file
+descriptor 9) in non-blocking mode.  The setsockopt(2) and getsockopt(2)
+calls are a side-effect of how Solaris's libc handles fcntl(2) on sockets.</p>
+</blockquote>
+<pre>
+/65:    read(9, " G E T   / 1 0 k . h t m".., 8000)     = 97
+</pre>
+<blockquote>
+<p>The worker thread reads the request from the client.</p>
+</blockquote>
+<pre>
+/65:    stat("/var/httpd/apache/httpd-8999/htdocs/10k.html", 0xFAF7B978) = 0
+/65:    open("/var/httpd/apache/httpd-8999/htdocs/10k.html", O_RDONLY) = 10
+</pre>
+<blockquote>
+<p>This httpd has been configured with <code>Options FollowSymLinks</code>
+and <code>AllowOverride None</code>.  Thus it doesn't need to lstat(2)
+each directory in the path leading up to the requested file, nor
+check for <code>.htaccess</code> files.  It simply calls stat(2) to
+verify that the file: 1) exists, and 2) is a regular file, not a
+directory.
+</blockquote>
+<pre>
+/65:    sendfilev(0, 9, 0x00200F90, 2, 0xFAF7B53C)      = 10269
+</pre>
+<blockquote>
+<p>In this example, the httpd is able to send the HTTP response
+header and the requested file with a single sendfilev(2) system call.
+Sendfile semantics vary among operating systems.  On some other
+systems, it is necessary to do a write(2) or writev(2) call to
+send the headers before calling sendfile(2).</p>
+</blockquote>
+<pre>
+/65:    write(4, " 1 2 7 . 0 . 0 . 1   -  ".., 78)      = 78
+</pre>
+<blockquote>
+<p>This write(2) call records the request in the access log.
+Note that one thing missing from this trace is a time(2) call.
+Unlike Apache 1.3, Apache 2.0 uses gettimeofday(3) to look up
+the time.  On some operating systems, like Linux or Solaris,
+gettimeofday has an optimized implementation that doesn't require
+as much overhead as a typical system call.</p>
+</blockquote>
+<pre>
+/65:    shutdown(9, 1, 1)                               = 0
+/65:    poll(0xFAF7B980, 1, 2000)                       = 1
+/65:    read(9, 0xFAF7BC20, 512)                        = 0
+/65:    close(9)                                        = 0
+</pre>
+<blockquote>
+<p>The worker thread does a lingering close of the connection.</p>
+</blockquote>
+<pre>
+/65:    close(10)                                       = 0
+/65:    lwp_park(0x00000000, 0)         (sleeping...)
+</pre>
+<blockquote>
+<p>Finally the worker thread closes the file that it has just delivered
+and blocks until the listener assigns it another connection.</p>
+</blockquote>
+<pre>
+/67:    accept(3, 0x001FEB74, 0x001FEB94, 1) (sleeping...)</pre>
+</pre>
+<blockquote>
+<p>Meanwhile, the listener thread is able to accept another connection
+as soon as it has dispatched this connection to a worker thread (subject
+to some flow-control logic in the worker MPM that throttles the listener
+if all the available workers are busy).  Though it isn't apparent from
+this trace, the next accept(2) can (and usually does, under high load
+conditions) occur in parallel with the worker thread's handling of the
+just-accepted connection.</p>
+</blockquote>
     </blockquote>
-    which were described earlier. 
 
-    <p>Let's apply some of these optimizations:
-    <code>-DSINGLE_LISTEN_UNSERIALIZED_ACCEPT
-    -DBUFFERED_LOGS</code> and <code>ExtendedStatus Off</code>.
-    Here's the final trace:</p>
-
-    <blockquote>
-<pre>
-accept(15, {sin_family=AF_INET, sin_port=htons(22286), sin_addr=inet_addr("127.0.0.1")}, [16]) = 3
-sigaction(SIGUSR1, {SIG_IGN}, {0x8058c98, [], SA_INTERRUPT}) = 0
-getsockname(3, {sin_family=AF_INET, sin_port=htons(8080), sin_addr=inet_addr("127.0.0.1")}, [16]) = 0
-setsockopt(3, IPPROTO_TCP1, [1], 4)     = 0
-read(3, "GET /6k HTTP/1.0\r\nUser-Agent: "..., 4096) = 60
-sigaction(SIGUSR1, {SIG_IGN}, {SIG_IGN}) = 0
-time(NULL)                              = 873961916
-stat("/home/dgaudet/ap/apachen/htdocs/6k", {st_mode=S_IFREG|0644, st_size=6144, ...}) = 0
-open("/home/dgaudet/ap/apachen/htdocs/6k", O_RDONLY) = 4
-mmap(0, 6144, PROT_READ, MAP_PRIVATE, 4, 0) = 0x400e3000
-writev(3, [{"HTTP/1.1 200 OK\r\nDate: Thu, 11"..., 245}, {"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 6144}], 2) = 6389
-close(4)                                = 0
-time(NULL)                              = 873961916
-shutdown(3, 1 /* send */)               = 0
-oldselect(4, [3], NULL, [3], {2, 0})    = 1 (in [3], left {2, 0})
-read(3, "", 2048)                       = 0
-close(3)                                = 0
-sigaction(SIGUSR1, {0x8058c98, [], SA_INTERRUPT}, {SIG_IGN}) = 0
-munmap(0x400e3000, 6144)                = 0
-</pre>
-    </blockquote>
-    That's 19 system calls, of which 4 remain relatively easy to
-    remove, but don't seem worth the effort. 
-
-    <h3><a id="patches" name="patches">Appendix: Patches
-    Available</a></h3>
-    There are <a
-    href="http://www.arctic.org/~dgaudet/apache/1.3/">several
-    performance patches available for 1.3.</a> Although they may
-    not apply cleanly to the current version, it shouldn't be
-    difficult for someone with a little C knowledge to update them.
-    In particular: 
-
-    <ul>
-      <li>A <a
-      href="http://www.arctic.org/~dgaudet/apache/1.3/shared_time.patch">
-      patch</a> to remove all <code>time(2)</code> system
-      calls.</li>
-
-      <li>A <a
-      href="http://www.arctic.org/~dgaudet/apache/1.3/mod_include_speedups.patch">
-      patch</a> to remove various system calls from
-      <code>mod_include</code>, these calls are used by few sites
-      but required for backwards compatibility.</li>
-
-      <li>A <a
-      href="http://www.arctic.org/~dgaudet/apache/1.3/top_fuel.patch">
-      patch</a> which integrates the above two plus a few other
-      speedups at the cost of removing some functionality.</li>
-    </ul>
-
-    <h3><a id="preforking" name="preforking">Appendix: The
-    Pre-Forking Model</a></h3>
-
-    <p>Apache (on Unix) is a <em>pre-forking</em> model server. The
-    <em>parent</em> process is responsible only for forking
-    <em>child</em> processes, it does not serve any requests or
-    service any network sockets. The child processes actually
-    process connections, they serve multiple connections (one at a
-    time) before dying. The parent spawns new or kills off old
-    children in response to changes in the load on the server (it
-    does so by monitoring a scoreboard which the children keep up
-    to date).</p>
-
-    <p>This model for servers offers a robustness that other models
-    do not. In particular, the parent code is very simple, and with
-    a high degree of confidence the parent will continue to do its
-    job without error. The children are complex, and when you add
-    in third party code via modules, you risk segmentation faults
-    and other forms of corruption. Even should such a thing happen,
-    it only affects one connection and the server continues serving
-    requests. The parent quickly replaces the dead child.</p>
-
-    <p>Pre-forking is also very portable across dialects of Unix.
-    Historically this has been an important goal for Apache, and it
-    continues to remain so.</p>
-
-    <p>The pre-forking model comes under criticism for various
-    performance aspects. Of particular concern are the overhead of
-    forking a process, the overhead of context switches between
-    processes, and the memory overhead of having multiple
-    processes. Furthermore it does not offer as many opportunities
-    for data-caching between requests (such as a pool of
-    <code>mmapped</code> files). Various other models exist and
-    extensive analysis can be found in the <a
-    href="http://www.cs.wustl.edu/~jxh/research/research.html">papers
-    of the JAWS project</a>. In practice all of these costs vary
-    drastically depending on the operating system.</p>
-
-    <p>Apache's core code is already multithread aware, and Apache
-    version 1.3 is multithreaded on NT. There have been at least
-    two other experimental implementations of threaded Apache, one
-    using the 1.3 code base on DCE, and one using a custom
-    user-level threads package and the 1.0 code base; neither is
-    publicly available. There is also an experimental port of
-    Apache 1.3 to <a
-    href="http://www.mozilla.org/docs/refList/refNSPR/">Netscape's
-    Portable Run Time</a>, which <a
-    href="http://www.arctic.org/~dgaudet/apache/2.0/">is
-    available</a> (but you're encouraged to join the <a
-    href="http://dev.apache.org/mailing-lists">new-httpd mailing
-    list</a> if you intend to use it). Part of our redesign for
-    version 2.0 of Apache will include abstractions of the server
-    model so that we can continue to support the pre-forking model,
-    and also support various threaded models. 
-        <hr />
-
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
-    <a href="./"><img src="../images/index.gif" alt="Index" /></a>
-    <a href="../"><img src="../images/home.gif" alt="Home" /></a>
-
-    </p>
   </body>
 </html>
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/rewriteguide.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/rewriteguide.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/rewriteguide.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/rewriteguide.html	2002-06-18 11:46:44.000000000 +0800
@@ -84,13 +84,13 @@
       <dl>
         <dt><strong>Description:</strong></dt>
 
         <dd>On some webservers there are more than one URL for a
         resource. Usually there are canonical URLs (which should be
         actually used and distributed) and those which are just
-        shortcuts, internal ones, etc. Independed which URL the
+        shortcuts, internal ones, etc. Independent of which URL the
         user supplied with the request he should finally see the
         canonical one only.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
@@ -194,13 +194,13 @@
         <dd>Every webmaster can sing a song about the problem of
         the trailing slash on URLs referencing directories. If they
         are missing, the server dumps an error, because if you say
         <code>/~quux/foo</code> instead of <code>/~quux/foo/</code>
         then the server searches for a <em>file</em> named
         <code>foo</code>. And because this file is a directory it
-        complains. Actually is tries to fix it themself in most of
+        complains. Actually it tries to fix it itself in most of
         the cases, but sometimes this mechanism need to be emulated
         by you. For instance after you have done a lot of
         complicated URL rewritings to CGI scripts etc.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
@@ -256,18 +256,18 @@
 
       <h2>Webcluster through Homogeneous URL Layout</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>We want to create a homogenous and consistent URL
+        <dd>We want to create a homogeneous and consistent URL
         layout over all WWW servers on a Intranet webcluster, i.e.
         all URLs (per definition server local and thus server
-        dependent!) become actually server <em>independed</em>!
+        dependent!) become actually server <em>independent</em>!
         What we want is to give the WWW namespace a consistent
-        server-independend layout: no URL should have to include
+        server-independent layout: no URL should have to include
         any physically correct target server. The cluster itself
         should drive us automatically to the physical target
         host.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
@@ -329,13 +329,13 @@
 
       <h2>Move Homedirs to Different Webserver</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>A lot of webmaster aksed for a solution to the
+        <dd>Many webmasters have asked for a solution to the
         following situation: They wanted to redirect just all
         homedirs on a webserver to another webserver. They usually
         need such things when establishing a newer webserver which
         will replace the old one over time.</dd>
 
         <dt><strong>Solution:</strong></dt>
@@ -362,13 +362,13 @@
 
       <h2>Structured Homedirs</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>Some sites with thousend of users usually use a
+        <dd>Some sites with thousands of users usually use a
         structured homedir layout, i.e. each homedir is in a
         subdirectory which begins for instance with the first
         character of the username. So, <code>/~foo/anypath</code>
         is <code>/home/<strong>f</strong>/foo/.www/anypath</code>
         while <code>/~bar/anypath</code> is
         <code>/home/<strong>b</strong>/bar/.www/anypath</code>.</dd>
@@ -390,13 +390,13 @@
               </td>
             </tr>
           </table>
         </dd>
       </dl>
 
-      <h2>Filesystem Reorganisation</h2>
+      <h2>Filesystem Reorganization</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
         <dd>
           This really is a hardcore example: a killer application
@@ -586,13 +586,13 @@
 
       <h2>Search pages in more than one directory</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>Sometimes it is neccessary to let the webserver search
+        <dd>Sometimes it is necessary to let the webserver search
         for pages in more than one directory. Here MultiViews or
         other techniques cannot help.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
@@ -733,20 +733,20 @@
         <dt><strong>Description:</strong></dt>
 
         <dd>A typical FAQ about URL rewriting is how to redirect
         failing requests on webserver A to webserver B. Usually
         this is done via ErrorDocument CGI-scripts in Perl, but
         there is also a mod_rewrite solution. But notice that this
-        is less performant than using a ErrorDocument
+        performs more poorly than using an ErrorDocument
         CGI-script!</dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
           The first solution has the best performance but less
-          flexibility and is less error safe: 
+          flexibility, and is less error safe: 
 
           <table bgcolor="#E0E5F5" border="0" cellspacing="0"
           cellpadding="5">
             <tr>
               <td>
 <pre>
@@ -943,29 +943,29 @@
               </td>
             </tr>
           </table>
         </dd>
       </dl>
 
-      <h2>Time-Dependend Rewriting</h2>
+      <h2>Time-Dependent Rewriting</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>When tricks like time-dependend content should happen a
+        <dd>When tricks like time-dependent content should happen a
         lot of webmasters still use CGI scripts which do for
         instance redirects to specialized pages. How can it be done
         via mod_rewrite?</dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
           There are a lot of variables named <code>TIME_xxx</code>
           for rewrite conditions. In conjunction with the special
           lexicographic comparison patterns &lt;STRING, &gt;STRING
-          and =STRING we can do time-dependend redirects: 
+          and =STRING we can do time-dependent redirects: 
 
           <table bgcolor="#E0E5F5" border="0" cellspacing="0"
           cellpadding="5">
             <tr>
               <td>
 <pre>
@@ -1095,19 +1095,19 @@
               </td>
             </tr>
           </table>
         </dd>
       </dl>
 
-      <h2>Browser Dependend Content</h2>
+      <h2>Browser Dependent Content</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
         <dd>At least for important top-level pages it is sometimes
-        necesarry to provide the optimum of browser dependend
+        necessary to provide the optimum of browser dependent
         content, i.e. one has to provide a maximum version for the
         latest Netscape variants, a minimum version for the Lynx
         browsers and a average feature version for all others.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
@@ -1223,13 +1223,13 @@
 
       <h2>Retrieve Missing Data from Intranet</h2>
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
-        <dd>This is a tricky way of virtually running a corporates
+        <dd>This is a tricky way of virtually running a corporate
         (external) Internet webserver
         (<code>www.quux-corp.dom</code>), while actually keeping
         and maintaining its data on a (internal) Intranet webserver
         (<code>www2.quux-corp.dom</code>) which is protected by a
         firewall. The trick is that on the external webserver we
         retrieve the requested data on-the-fly from the internal
@@ -1637,13 +1637,13 @@
 /internal/cgi/user/swwidx?i=/u/user/foo/
 </pre>
 
           <p>which is ugly. Because we have to hard-code
           <strong>both</strong> the location of the area
           <strong>and</strong> the location of the CGI inside the
-          hyperlink. When we have to reorganise or area, we spend a
+          hyperlink. When we have to reorganize the area, we spend a
           lot of time changing the various hyperlinks.</p>
         </dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
@@ -1684,22 +1684,22 @@
 
       <dl>
         <dt><strong>Description:</strong></dt>
 
         <dd>How can we transform a static page
         <code>foo.html</code> into a dynamic variant
-        <code>foo.cgi</code> in a seemless way, i.e. without notice
+        <code>foo.cgi</code> in a seamless way, i.e. without notice
         by the browser/user.</dd>
 
         <dt><strong>Solution:</strong></dt>
 
         <dd>
           We just rewrite the URL to the CGI-script and force the
           correct MIME-type so it gets really run as a CGI-script.
           This way a request to <code>/~quux/foo.html</code>
-          internally leads to the invokation of
+          internally leads to the invocation of
           <code>/~quux/foo.cgi</code>. 
 
           <table bgcolor="#E0E5F5" border="0" cellspacing="0"
           cellpadding="5">
             <tr>
               <td>
@@ -2171,13 +2171,13 @@
 
         <dd>
           We first have to make sure mod_rewrite is below(!)
           mod_proxy in the <code>Configuration</code> file when
           compiling the Apache webserver. This way it gets called
           _before_ mod_proxy. Then we configure the following for a
-          host-dependend deny... 
+          host-dependent deny... 
 
           <table bgcolor="#E0E5F5" border="0" cellspacing="0"
           cellpadding="5">
             <tr>
               <td>
 <pre>
@@ -2185,13 +2185,13 @@
 RewriteRule !^http://[^/.]\.mydomain.com.*  - [F]
 </pre>
               </td>
             </tr>
           </table>
 
-          <p>...and this one for a user@host-dependend deny:</p>
+          <p>...and this one for a user@host-dependent deny:</p>
 
           <table bgcolor="#E0E5F5" border="0" cellspacing="0"
           cellpadding="5">
             <tr>
               <td>
 <pre>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/tutorials.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/tutorials.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/misc/tutorials.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/misc/tutorials.html	2002-06-18 11:46:44.000000000 +0800
@@ -16,21 +16,21 @@
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
 
+    <h1 align="CENTER">Apache Tutorials</h1>
+
     <blockquote>
       <strong>Warning:</strong> This document has not been updated
       to take into account changes made in the 2.0 version of the
       Apache HTTP Server. Some of the information may still be
       relevant, but please use it with care.
     </blockquote>
 
-    <h1 align="CENTER">Apache Tutorials</h1>
-
     <p>The following documents give you step-by-step instructions
     on how to accomplish common tasks with the Apache http server.
     Many of these documents are located at external sites and are
     not the work of the Apache Software Foundation. Copyright to
     documents on external sites is owned by the authors or their
     assignees. Please consult the <a href="../">official Apache
@@ -47,13 +47,13 @@
       <li><a
       href="http://apachetoday.com/news_story.php3?ltsn=2000-07-10-001-01-NW-LF-SW">
       Configuring Your Apache Server Installation</a>
       (ApacheToday)</li>
 
       <li><a
-      href="http://oreilly.apacheweek.com/pub/a/apache/2000/02/24/installing_apache.html">
+      href="http://www.onlamp.com/pub/a/apache/2000/02/24/installing_apache.html">
       Getting, Installing, and Running Apache (on Unix)</a>
       (O'Reilly Network Apache DevCenter)</li>
 
       <li><a
       href="http://www.builder.com/Servers/Apache/ss01.html">Maximum
       Apache: Getting Started</a> (CNET Builder.com)</li>
@@ -65,13 +65,13 @@
     </ul>
 
     <h2>Basic Configuration</h2>
 
     <ul>
       <li><a
-      href="http://oreilly.apacheweek.com/pub/a/apache/2000/03/02/configuring_apache.html">
+      href="http://www.onlamp.com/pub/a/apache/2000/03/02/configuring_apache.html">
       An Amble Through Apache Configuration</a> (O'Reilly Network
       Apache DevCenter)</li>
 
       <li><a
       href="http://apachetoday.com/news_story.php3?ltsn=2000-07-19-002-01-NW-LF-SW">
       Using .htaccess Files with Apache</a> (ApacheToday)</li>
@@ -128,13 +128,13 @@
     </ul>
 
     <h2>Logging</h2>
 
     <ul>
       <li><a
-      href="http://oreilly.apacheweek.com/pub/a/apache/2000/03/10/log_rhythms.html">
+      href="http://www.onlamp.com/pub/a/apache/2000/03/10/log_rhythms.html">
       Log Rhythms</a> (O'Reilly Network Apache DevCenter)</li>
 
       <li><a
       href="http://www.apacheweek.com/features/logfiles">Gathering
       Visitor Information: Customising Your Logfiles</a>
       (Apacheweek)</li>
@@ -204,13 +204,13 @@
 
       <li><a
       href="http://ppewww.ph.gla.ac.uk/~flavell/www/lang-neg.html">Language
       Negotiation Notes</a> (Alan J. Flavell)</li>
     </ul>
 
-    <p>If you have a pointer to a an accurate and well-written
+    <p>If you have a pointer to an accurate and well-written
     tutorial not included here, please let us know by submitting it
     to the <a href="http://bugs.apache.org/">Apache Bug
     Database</a>.     <hr />
 
     <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: allmodules.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/allmodules.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/allmodules.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/allmodules.xml	2002-04-04 02:36:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/allmodules.xml	2002-05-06 16:31:44.000000000 +0800
@@ -1,52 +1,54 @@
-<modulelist>
-<modulefile>core.xml</modulefile>
-<modulefile>mod_access.xml</modulefile>
-<modulefile>mod_actions.xml</modulefile>
-<modulefile>mod_alias.xml</modulefile>
-<modulefile>mod_asis.xml</modulefile>
-<modulefile>mod_auth.xml</modulefile>
-<modulefile>mod_auth_anon.xml</modulefile>
-<modulefile>mod_auth_dbm.xml</modulefile>
-<modulefile>mod_auth_digest.xml</modulefile>
-<modulefile>mod_autoindex.xml</modulefile>
-<modulefile>mod_cache.xml</modulefile>
-<modulefile>mod_cern_meta.xml</modulefile>
-<modulefile>mod_cgi.xml</modulefile>
-<modulefile>mod_cgid.xml</modulefile>
-<modulefile>mod_charset_lite.xml</modulefile>
-<modulefile>mod_dav.xml</modulefile>
-<modulefile>mod_deflate.xml</modulefile>
-<modulefile>mod_dir.xml</modulefile>
-<modulefile>mod_env.xml</modulefile>
-<modulefile>mod_example.xml</modulefile>
-<modulefile>mod_expires.xml</modulefile>
-<modulefile>mod_ext_filter.xml</modulefile>
-<modulefile>mod_file_cache.xml</modulefile>
-<modulefile>mod_headers.xml</modulefile>
-<modulefile>mod_imap.xml</modulefile>
-<modulefile>mod_include.xml</modulefile>
-<modulefile>mod_info.xml</modulefile>
-<modulefile>mod_isapi.xml</modulefile>
-<modulefile>mod_log_config.xml</modulefile>
-<modulefile>mod_mime.xml</modulefile>
-<modulefile>mod_mime_magic.xml</modulefile>
-<modulefile>mod_negotiation.xml</modulefile>
-<modulefile>mod_proxy.xml</modulefile>
-<modulefile>mod_rewrite.xml</modulefile>
-<modulefile>mod_setenvif.xml</modulefile>
-<modulefile>mod_so.xml</modulefile>
-<modulefile>mod_ssl.xml</modulefile>
-<modulefile>mod_speling.xml</modulefile>
-<modulefile>mod_status.xml</modulefile>
-<modulefile>mod_suexec.xml</modulefile>
-<modulefile>mod_unique_id.xml</modulefile>
-<modulefile>mod_userdir.xml</modulefile>
-<modulefile>mod_usertrack.xml</modulefile>
-<modulefile>mod_vhost_alias.xml</modulefile>
-<modulefile>mpm_common.xml</modulefile>
-<modulefile>mpm_netware.xml</modulefile>
-<modulefile>mpm_winnt.xml</modulefile>
-<modulefile>perchild.xml</modulefile>
-<modulefile>prefork.xml</modulefile>
-<modulefile>worker.xml</modulefile>
-</modulelist>
+<?xml version="1.0" encoding="ISO-8859-1"?>
+
+<modulefilelist>
+  <modulefile>core.xml</modulefile>
+  <modulefile>mod_access.xml</modulefile>
+  <modulefile>mod_actions.xml</modulefile>
+  <modulefile>mod_alias.xml</modulefile>
+  <modulefile>mod_asis.xml</modulefile>
+  <modulefile>mod_auth.xml</modulefile>
+  <modulefile>mod_auth_anon.xml</modulefile>
+  <modulefile>mod_auth_dbm.xml</modulefile>
+  <modulefile>mod_auth_digest.xml</modulefile>
+  <modulefile>mod_autoindex.xml</modulefile>
+  <modulefile>mod_cache.xml</modulefile>
+  <modulefile>mod_cern_meta.xml</modulefile>
+  <modulefile>mod_cgi.xml</modulefile>
+  <modulefile>mod_cgid.xml</modulefile>
+  <modulefile>mod_charset_lite.xml</modulefile>
+  <modulefile>mod_dav.xml</modulefile>
+  <modulefile>mod_deflate.xml</modulefile>
+  <modulefile>mod_dir.xml</modulefile>
+  <modulefile>mod_env.xml</modulefile>
+  <modulefile>mod_example.xml</modulefile>
+  <modulefile>mod_expires.xml</modulefile>
+  <modulefile>mod_ext_filter.xml</modulefile>
+  <modulefile>mod_file_cache.xml</modulefile>
+  <modulefile>mod_headers.xml</modulefile>
+  <modulefile>mod_imap.xml</modulefile>
+  <modulefile>mod_include.xml</modulefile>
+  <modulefile>mod_info.xml</modulefile>
+  <modulefile>mod_isapi.xml</modulefile>
+  <modulefile>mod_log_config.xml</modulefile>
+  <modulefile>mod_mime.xml</modulefile>
+  <modulefile>mod_mime_magic.xml</modulefile>
+  <modulefile>mod_negotiation.xml</modulefile>
+  <modulefile>mod_proxy.xml</modulefile>
+  <modulefile>mod_rewrite.xml</modulefile>
+  <modulefile>mod_setenvif.xml</modulefile>
+  <modulefile>mod_so.xml</modulefile>
+  <modulefile>mod_ssl.xml</modulefile>
+  <modulefile>mod_speling.xml</modulefile>
+  <modulefile>mod_status.xml</modulefile>
+  <modulefile>mod_suexec.xml</modulefile>
+  <modulefile>mod_unique_id.xml</modulefile>
+  <modulefile>mod_userdir.xml</modulefile>
+  <modulefile>mod_usertrack.xml</modulefile>
+  <modulefile>mod_vhost_alias.xml</modulefile>
+  <modulefile>mpm_common.xml</modulefile>
+  <modulefile>mpm_netware.xml</modulefile>
+  <modulefile>mpm_winnt.xml</modulefile>
+  <modulefile>perchild.xml</modulefile>
+  <modulefile>prefork.xml</modulefile>
+  <modulefile>worker.xml</modulefile>
+</modulefilelist>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: core.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: core.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/core.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/core.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/core.xml	2002-04-15 06:08:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/core.xml	2002-06-15 10:48:16.000000000 +0800
@@ -1,19 +1,19 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>core</name>
 <description>Core Apache HTTP Server features that are always
 available</description>
 <status>Core</status>
 
 <directivesynopsis>
 <name>AcceptPathInfo</name>
-<description>Controls whether requests can contain trailing pathname information</description>    
+<description>Resources accept trailing pathname information</description>    
 <syntax>AcceptPathInfo On|Off|Default</syntax>
 <default>AcceptPathInfo Default</default>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
 <compatibility>Available in Apache 2.0.30 and later</compatibility>
@@ -74,23 +74,24 @@
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AccessFileName</name>
-<description>Sets the name of the .htaccess file</description>
+<description>Name of the distributed configuration file</description>
 <syntax>AccessFileName <em>filename</em> [<em>filename</em>] ...</syntax>
 <default>AccessFileName .htaccess</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
 <usage>
     <p>When returning a document to the client the server looks for
-    the first existing access control file from this list of names
-    in every directory of the path to the document, if access
-    control files are enabled for that directory. For example:</p>
+    the first existing configuration file from this list of names in
+    every directory of the path to the document, if distributed
+    configuration files are enabled for that directory. For
+    example:</p>
 
 <example>
 AccessFileName .acl
 </example>
 
     <p>before returning the document
@@ -108,20 +109,20 @@
 <seealso><directive module="core">AllowOverride</directive></seealso>
 <seealso><a href="../configuring.html">Configuration Files</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddDefaultCharset</name>
-<description>Specifies the default character set to be added for a
+<description>Default character set to be added for a
 response without an explicit character set</description>
 <syntax>AddDefaultCharset On|Off|<em>charset</em></syntax>
 <default>AddDefaultCharset Off</default>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
-
+<override>FileInfo</override>
 
 <usage>
 
     <p>This directive specifies the name of the character set that
     will be added to any response that does not have any parameter on
     the content type in the HTTP headers. This will override any
@@ -138,15 +139,16 @@
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AllowOverride</name>
-<description>Sets the types of directives that are allowed in
+<description>Types of directives that are allowed in
 .htaccess files</description>
-<syntax>AllowOverride All|None|<em>directive-type</em> [<em>directive-type</em>] ...</syntax>
+<syntax>AllowOverride All|None|<em>directive-type</em> 
+[<em>directive-type</em>] ...</syntax>
 <default>AllowOverride All</default>
 <contextlist><context>directory</context></contextlist>
 
 <usage>
     <p>When the server finds an .htaccess file (as specified by <directive
     module="core">AccessFileName</directive>) it needs to know
@@ -236,13 +238,13 @@
 <seealso><directive module="core">AccessFileName</directive></seealso>
 <seealso><a href="../configuring.html">Configuration Files</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AuthName</name>
-<description>Sets the authorization realm for use in HTTP
+<description>Authorization realm for use in HTTP
 authentication</description>
 <syntax>AuthName <em>auth-domain</em></syntax>
 <contextlist><context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>AuthConfig</override>
 
@@ -270,13 +272,13 @@
     href="../howto/auth.html">Authentication, Authorization, and 
     Access Control</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AuthType</name>
-<description>Selects the type of user authentication</description>
+<description>Type of user authentication</description>
 <syntax>AuthType Basic|Digest</syntax>
 <contextlist><context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>AuthConfig</override>
 
 <usage>
@@ -303,13 +305,12 @@
 <default>ContentDigest off</default>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>Options</override>
 <status>Experimental</status>
-<compatibility>Available in Apache 1.1 and later</compatibility>
 
 <usage>
     <p>This directive enables the generation of
     <code>Content-MD5</code> headers as defined in RFC1864
     respectively RFC2068.</p>
 
@@ -336,16 +337,16 @@
     this header.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>DefaultType</name>
-<description>Sets the MIME content-type that will be sent if the
+<description>MIME content-type that will be sent if the
 server cannot determine a type in any other way</description>
 <syntax>DefaultType <em>MIME-type</em></syntax>
-<default>DefaultType text/html</default>
+<default>DefaultType text/plain</default>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
 
 <usage>
@@ -380,27 +381,37 @@
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
 <usage>
     <p><directive type="section">Directory</directive> and
     <code>&lt;/Directory&gt;</code> are used to enclose a group of
-    directives which will apply only to the named directory and
-    sub-directories of that directory. Any directive which is allowed
+    directives that will apply only to the named directory and
+    sub-directories of that directory. Any directive that is allowed
     in a directory context may be used.  <em>Directory-path</em> is
-    either the full path to a directory, or a wild-card string. In a
-    wild-card string, `?' matches any single character, and `*'
-    matches any sequences of characters.  You may
-    also use `[]' character ranges like in the shell. Also as of
-    Apache 1.3 none of the wildcards match a `/' character, which more
-    closely mimics the behavior of Unix shells. Example:</p>
+    either the full path to a directory, or a wild-card string using
+    Unix shell-style matching. In a wild-card string, `?' matches any
+    single character, and `*' matches any sequences of characters.
+    You may also use `[]' character ranges. None of the wildcards
+    match a `/' character, so <code>&lt;Directory
+    /*/public_html&gt;</code> will not match
+    <code>/home/user/public_html</code>, but <code>&lt;Directory
+    /home/*/public_html&gt;</code> will match. Example:</p>
 <example>
    &lt;Directory /usr/local/httpd/htdocs&gt;<br />
 &nbsp;&nbsp;Options Indexes FollowSymLinks<br />
    &lt;/Directory&gt;<br />
 </example>
 
+<note>
+<p>Be careful with the <em>directory-path</em> arguments: They have
+to literally match the filesystem path which Apache uses to access the
+files. Directives applied to a particular &lt;Directory&gt; will not
+apply to files accessed from that same directory via a different path,
+such as via different symbolic links.</p>
+</note>
+
     <p>Extended regular
     expressions can also be used, with the addition of the
     <code>~</code> character. For example:</p>
 <example>
    &lt;Directory ~ "^/www/.*/[0-9]{3}"&gt;
 </example>
@@ -416,13 +427,13 @@
 
 <example>
       &lt;Directory /&gt;<br />
        &nbsp;&nbsp;AllowOverride None<br />
        &lt;/Directory&gt;<br />
       <br />
-       &lt;Directory /home/*&gt;<br />
+       &lt;Directory /home/&gt;<br />
        &nbsp;&nbsp;AllowOverride FileInfo<br />
        &lt;/Directory&gt;
 </example>
     <p>for access to the document <code>/home/web/dir/doc.html</code>
     the steps are:</p>
 
@@ -515,13 +526,13 @@
 work</a> for an explanation of how these different sections are
 combined when a request is received</seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>DocumentRoot</name>
-<description>Sets the directory that forms the main document tree visible
+<description>Directory that forms the main document tree visible
 from the web</description>
 <syntax>DocumentRoot <em>directory-path</em></syntax>
 <default>DocumentRoot /usr/local/apache/htdocs</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
@@ -542,14 +553,54 @@
 </usage>
 <seealso><a href="../urlmapping.html">Mapping URLs to Filesystem
 Location</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
+<name>EnableMMAP</name>
+<description>Use memory-mapping to read files during delivery</description>
+<syntax>EnableMMAP on|off</syntax>
+<default>EnableMMAP on</default>
+<contextlist><context>server config</context><context>virtual host</context>
+<context>directory</context><context>.htaccess</context>
+</contextlist>
+<override>FileInfo</override>
+
+<usage>
+    <p>This directive controls whether the httpd may use
+    memory-mapping if it needs to read the contents of a file during
+    delivery.  By default, when the handling of a request requires
+    access to the data within a file-- for example, when delivering a
+    server-parsed file using <module>mod_include</module>-- Apache
+    memory-maps the file if the OS supports it.
+    </p>
+    <p>
+    This memory-mapping sometimes yields a performance improvement.
+    But in some environments, it is better to disable the memory-mapping
+    to prevent operational problems:
+    </p>
+    <ul>
+    <li>On some multiprocessor systems, memory-mapping can reduce the
+    performance of the httpd.</li>
+    <li>With an NFS-mounted <directive module="core">DocumentRoot</directive>,
+    the httpd may crash due tof a segmentation fault if a file is deleted
+    or truncated while the httpd has it memory-mapped.</li>
+    </ul>
+    <p>
+    For server configurations that are vulnerable to these problems,
+    you should disable memory-mapping of delivered files by specifying:
+    </p>
+<example>
+   EnableMMAP off
+</example>
+</usage>
+</directivesynopsis>
+
+<directivesynopsis>
 <name>ErrorDocument</name>
-<description>Specifies what the server will return to the client
+<description>What the server will return to the client
 in case of an error</description>
 <syntax>ErrorDocument <em>error-code document</em></syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
@@ -604,24 +655,32 @@
     URL in an <code>ErrorDocument 401</code>, the client will not
     know to prompt the user for a password since it will not
     receive the 401 status code. Therefore, <strong>if you use an
     "ErrorDocument 401" directive then it must refer to a local
     document.</strong></p>
 
+    <p>Microsoft Internet Explorer (MSIE) will ignore server-generated
+    error messages when they are "too small" and substitute its own
+    "friendly" error messages.  The size threshold varies depending on
+    the type of error, but in general, if you make your error document
+    greater than 512 bytes, then MSIE will show the server-generated
+    error rather than masking it.  More information is available in
+    Microsoft Knowledgebase article <a
+    href="http://support.microsoft.com/default.aspx?scid=kb;en-us;Q294807">Q294807</a>.</p>
+
     <p>Prior to version 2.0, messages were indicated by prefixing
     them with a single unmatched double quote character.</p>
 </usage>
 
 <seealso><a href="../custom-error.html">documentation of
     customizable responses</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ErrorLog</name>
-<description>Sets the name of the file to which the server
-will log errors</description>    
+<description>Location where the server will log errors</description>    
 <syntax> ErrorLog <em>file-path</em>|syslog[:<em>facility</em>]</syntax>
 <default>ErrorLog logs/error_log (Unix)
 ErrorLog logs/error.log (Windows and OS/2)</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
@@ -650,13 +709,13 @@
 <seealso><directive module="core">LogLevel</directive></seealso>
 <seealso><a href="../logs.html">Apache Log Files</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>FileETag</name>
-<description>Configures the file attributes used to create the ETag
+<description>File attributes used to create the ETag
 HTTP response header</description>
 <syntax>FileETag <em>component</em> ...</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
@@ -703,28 +762,29 @@
     </p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis type="section">
 <name>Files</name>
-<description>Contains that directives that apply to matched
+<description>Contains directives that apply to matched
 filenames</description>
 <syntax>&lt;Files <em>filename</em>&gt; ... &lt;/Files&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>The <directive type="section">Files</directive> directive
     provides for access control by filename. It is comparable to the
     <directive module="core" type="directive">Directory</directive>
     directive and <directive module="core"
     type="directive">Location</directive> directives. It should be
     matched with a <code>&lt;/Files&gt;</code> directive. The
     directives given within this section will be applied to any object
-    with a basename (last component of filename) matching the
+    with a basename (not a full path) matching the
     specified filename. <directive type="section">Files</directive>
     sections are processed in the order they appear in the
     configuration file, after the <directive module="core"
     type="section">Directory</directive> sections and
     <code>.htaccess</code> files are read, but before <directive
     type="section" module="core">Location</directive> sections. Note
@@ -758,18 +818,19 @@
     explanation of how these different sections are combined when a
     request is received</seealso>
 </directivesynopsis>
 
 <directivesynopsis type="section">
 <name>FilesMatch</name>
-<description>Contains that directives that apply to regular-expression matched
+<description>Contains directives that apply to regular-expression matched
 filenames</description>
 <syntax>&lt;FilesMatch <em>regex</em>&gt; ... &lt;/FilesMatch&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>The <directive type="section">FilesMatch</directive> directive
     provides for access control by filename, just as the <directive
     module="core" type="section">Files</directive> directive
     does. However, it accepts a regular expression. For example:</p>
@@ -790,12 +851,13 @@
 <name>ForceType</name>
 <description>Forces all matching files to be served with the specified
 MIME content-type</description>
 <syntax>ForceType <em>mime-type</em></syntax>
 <contextlist><context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 <compatibility>Moved to the core in Apache 2.0</compatibility>
 
 <usage>
     <p>When placed into an <code>.htaccess</code> file or a
     <directive type="section" module="core">Directory</directive>, or
     <directive type="section" module="core">Location</directive> or 
@@ -859,13 +921,14 @@
 <directivesynopsis>
 <name>IdentityCheck</name>
 <description>Enables logging of the RFC1413 identity of the remote 
 user</description>
 <syntax>IdentityCheck on|off</syntax>
 <default>IdentityCheck off</default>
-
+<contextlist><context>server config</context><context>virtual host</context>
+<context>directory</context></contextlist>
 <usage>
     <p>This directive enables RFC1413-compliant logging of the
     remote user name for each connection, where the client machine
     runs identd or something similar. This information is logged in
     the access log.</p>
 
@@ -887,12 +950,13 @@
 if a test is true at startup</description>
 <syntax>&lt;IfDefine [!]<em>parameter-name</em>&gt; <em>...</em>
     &lt;/IfDefine&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>The <code>&lt;IfDefine
     <em>test</em>&gt;...&lt;/IfDefine&gt;</code> section is used to
     mark directives that are conditional. The directives within an
     <directive type="section">IfDefine</directive> section are only
@@ -942,12 +1006,13 @@
 presence of absence of a specific module</description>
 <syntax>&lt;IfModule [!]<em>module-name</em>&gt; <em>...</em>
     &lt;/IfModule&gt;</syntax>     
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>The <code>&lt;IfModule
     <em>test</em>&gt;...&lt;/IfModule&gt;</code> section is used to
     mark directives that are conditional. The directives within an
     <directive type="section">IfModule</directive> section are only
@@ -984,13 +1049,15 @@
 
 <directivesynopsis>
 <name>Include</name>
 <description>Includes other configuration files from within
 the server configuration files</description>
 <syntax>Include <em>file-path</em>|<em>directory-path</em></syntax>
-<contextlist><context>server config</context></contextlist>
+<contextlist><context>server config</context><context>virtual host</context>
+<context>directory</context>
+</contextlist>
 
 <usage>
     <p>This directive allows inclusion of other configuration files
     from within the server configuration files.</p>
 
     <p>If <directive>Include</directive> points to a directory, rather than a
@@ -1038,13 +1105,13 @@
 
 <seealso><a href="../programs/apachectl.html">apachectl</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>KeepAlive</name>
-<description>Turns on or off HTTP persistent connections.</description>
+<description>Enables HTTP persistent connections</description>
 <syntax>KeepAlive on|off</syntax>
 <default>KeepAlive On</default>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
     <p>The Keep-Alive extension to HTTP/1.0 and the persistent
@@ -1070,13 +1137,13 @@
 
 <seealso><directive module="core">MaxKeepAliveRequests</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>KeepAliveTimeout</name>
-<description>Sets the amount of time the server will wait for subsequent
+<description>Amount of time the server will wait for subsequent
 requests on a persistent connection</description>
 <syntax>KeepAliveTimeout <em>seconds</em></syntax>
 <default>KeepAliveTimeout 15</default>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
@@ -1091,19 +1158,20 @@
     occupied waiting on connections with idle clients.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis type="section">
 <name>Limit</name>
-<description>Restrict access controls to only certain HTTP
+<description>Restrict enclosed access controls to only certain HTTP
 methods</description>    
 <syntax>&lt;Limit <em>method</em> [<em>method</em>] ... &gt; ...
     &lt;/Limit&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>Access controls are normally effective for
     <strong>all</strong> access methods, and this is the usual
     desired behavior. <strong>In the general case, access control
     directives should not be placed within a
@@ -1136,12 +1204,13 @@
 except the named ones</description>    
 <syntax>&lt;LimitExcept <em>method</em> [<em>method</em>] ... &gt; ...
     &lt;/LimitExcept&gt;</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p><directive type="section">LimitExcept</directive> and
     <code>&lt;/LimitExcept&gt;</code> are used to enclose
     a group of access control directives which will then apply to any
     HTTP access method <strong>not</strong> listed in the arguments; 
@@ -1168,12 +1237,13 @@
 from the client</description>
 <syntax>LimitRequestBody <em>bytes</em></syntax>
 <default>LimitRequestBody 0</default>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>This directive specifies the number of <em>bytes</em> from 0
     (meaning unlimited) to 2147483647 (2GB) that are allowed in a
     request body. The default value is defined by the compile-time
     constant <code>DEFAULT_LIMIT_REQUEST_BODY</code> (0 as
@@ -1372,16 +1442,16 @@
     type="section" module="core">Files</directive> sections.</p>
 
     <p>Note that URLs do not have to line up with the filesystem at
     all, it should be emphasized that &lt;Location&gt; operates
     completely outside the filesystem.</p>
 
-    <p>For all origin (non-proxy) requests, the URL to be matched
-    is of the form <code>/path/</code>, and you should not include
-    any <code>http://servername</code> prefix. For proxy requests,
-    the URL to be matched is of the form
+    <p>For all origin (non-proxy) requests, the URL to be matched is a
+    URL-path of the form <code>/path/</code>.  No scheme, hostname,
+    port, or query string may be included.  For proxy requests, the
+    URL to be matched is of the form
     <code>scheme://servername/path</code>, and you must include the
     prefix.</p>
 
     <p>The URL may use wildcards In a wild-card string, `?' matches
     any single character, and `*' matches any sequences of
     characters.</p>
@@ -1576,13 +1646,13 @@
 
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MaxKeepAliveRequests</name>
-<description>Sets the number of requests allowed on a persistent 
+<description>Number of requests allowed on a persistent 
 connection</description>
 <syntax>MaxKeepAliveRequests <em>number</em></syntax>
 <default>MaxKeepAliveRequests 100</default>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
@@ -1598,13 +1668,13 @@
     <example>MaxKeepAliveRequests 500</example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>NameVirtualHost</name>
-<description>Configures an IP address for name-virtual
+<description>Designates an IP address for name-virtual
 hosting</description>
 <syntax>NameVirtualHost <em>addr</em>[:<em>port</em>]</syntax>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
     <p>The <directive>NameVirtualHost</directive> directive is a
@@ -1639,12 +1709,29 @@
 
      <p>IPv6 addresses must be enclosed in square brackets, as shown
      in the following example:</p>
  
 <example>NameVirtualHost [fe80::a00:20ff:fea7:ccea]:8080</example>
 
+    <p>To receive requests on all interfaces, you can use an argument of
+    *</p>
+
+<example>NameVirtualHost *</example>
+
+<note><title>Argument to &lt;VirtualHost&gt; directive</title>
+<p>Note that the argument to the &lt;VirtualHost&gt; directive must exactly
+match the argument to the <directive>NameVirtualHost</directive>
+directive.</p>
+<example>
+NameVirtualHost 1.2.3.4<br />
+&lt;VirtualHost 1.2.3.4&gt;<br />
+...<br />
+&lt;/VirtualHost&gt;<br />
+</example>
+</note>
+
 </usage>
 
 <seealso>See also: <a href="../vhosts/">Virtual Hosts
 documentation</a></seealso>
 
 </directivesynopsis>
@@ -1841,14 +1928,12 @@
 <description>Limits the CPU consumption of processes launched
 by Apache children</description>
 <syntax>RLimitCPU <em>number</em>|max [<em>number</em>|max]</syntax>
 <default>Unset; uses operating system defaults</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
-<compatibility>Moved in version 2.0 to
-    the <a href="../mpm.html">MPMs</a></compatibility>
 
 <usage>
     <p>Takes 1 or 2 parameters. The first parameter sets the soft
     resource limit for all processes and the second parameter sets
     the maximum resource limit. Either parameter can be a number,
     or <em>max</em> to indicate to the server that the limit should
@@ -1875,14 +1960,12 @@
 <description>Limits the memory consumption of processes launched
 by Apache children</description>
 <syntax>RLimitMEM <em>number</em>|max [<em>number</em>|max]</syntax>
 <default>Unset; uses operating system defaults</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
-<compatibility>Moved in version 2.0 to the <a
-href="../mpm.html">MPMs</a>.</compatibility>
 
 <usage>
     <p>Takes 1 or 2 parameters. The first parameter sets the soft
     resource limit for all processes and the second parameter sets
     the maximum resource limit. Either parameter can be a number,
     or <em>max</em> to indicate to the server that the limit should
@@ -1909,14 +1992,12 @@
 <description>Limits the number of processes that can be launched by 
 processes launched by Apache children</description>
 <syntax>RLimitNPROC <em>number</em>|max [<em>number</em>|max]</syntax>
 <default>Unset; uses operating system defaults</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
-<compatibility>Moved in version 2.0 to the <a
-href="../mpm.html">MPMs</a>.</compatibility>
 
 <usage>
     <p>Takes 1 or 2 parameters. The first parameter sets the soft
     resource limit for all processes and the second parameter sets
     the maximum resource limit. Either parameter can be a number,
     or <code>max</code> to indicate to the server that the limit
@@ -1943,18 +2024,19 @@
 <seealso><directive module="core">RLimitMEM</directive></seealso>
 <seealso><directive module="core">RLimitCPU</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>Satisfy</name>
-<description>Configures how host-level access control and user authentication
-interact</description>
+<description>Interaction between host-level access control and 
+user authentication</description>
 <syntax>Satisfy any|all</syntax>
 <default>Satisfy all</default>
 <contextlist><context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>AuthConfig</override>
 
 <usage>
     <p>Access policy if both <directive
     module="core">Allow</directive> and <directive
     module="core">Require</directive> used. The parameter can be
     either <em>'all'</em> or <em>'any'</em>. This directive is only
@@ -1983,18 +2065,19 @@
    <seealso><directive module="mod_access">Allow</directive></seealso>
    <seealso><directive module="core">Require</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ScriptInterpreterSource</name>
-<description>Controls how the interpreter for CGI scripts is
-located</description>
+<description>Technique for locating the interpreter for CGI 
+scripts</description>
 <syntax>ScriptInterpreterSource registry|script</syntax>
 <default>ScriptInterpreterSource script</default>
 <contextlist><context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 <compatibility>Win32 only</compatibility>
 
 <usage>
     <p>This directive is used to control how Apache finds the
     interpreter used to run CGI scripts. The default technique is to
     use the interpreter pointed to by the #! line in the
@@ -2003,13 +2086,13 @@
     extension (e.g., .pl) as a search key.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerAdmin</name>
-<description>Sets the email address that the server includes in error
+<description>Email address that the server includes in error
 messages sent to the client</description>
 <syntax>ServerAdmin <em>email-address</em></syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 
 <usage>
@@ -2024,13 +2107,13 @@
     server!</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerAlias</name>
-<description>Sets alternate names for a host used when matching requests
+<description>Alternate names for a host used when matching requests
 to name-virtual hosts</description>
 <syntax>ServerAlias <em>hostname</em> [<em>hostname</em>] ...</syntax>
 <contextlist><context>virtual host</context></contextlist>
 
 <usage>
     <p>The <directive>ServerAlias</directive> directive sets the
@@ -2047,13 +2130,13 @@
 </usage>
 <seealso><a href="../vhosts/">Apache Virtual Host documentation</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerName</name>
-<description>Sets the hostname and port that the server uses to identify
+<description>Hostname and port that the server uses to identify
 itself</description>
 <syntax>ServerName <em>fully-qualified-domain-name[:port]</em></syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 <compatibility>In version 2.0, this
      directive supersedes the functionality of the <directive>Port</directive>
@@ -2100,13 +2183,13 @@
 <seealso><directive module="core">NameVirtualHost</directive></seealso>
 <seealso><directive module="core">ServerAlias</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerPath</name>
-<description>Sets the legacy URL pathname for a name-virtual host that
+<description>Legacy URL pathname for a name-virtual host that
 is accessed by an incompatible browser</description>
 <syntax>ServerPath <em>directory-path</em></syntax>
 <contextlist><context>virtual host</context></contextlist>
 
 <usage>
     <p>The <directive>ServerPath</directive> directive sets the legacy
@@ -2115,23 +2198,28 @@
 </usage>
 <seealso><a href="../vhosts/">Apache Virtual Host documentation</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ServerRoot</name>
-<description>Sets the base directory for the server installation</description>
+<description>Base directory for the server installation</description>
 <syntax>ServerRoot <em>directory-path</em></syntax>
 <default>ServerRoot /usr/local/apache</default>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
     <p>The <directive>ServerRoot</directive> directive sets the
     directory in which the server lives. Typically it will contain the
     subdirectories <code>conf/</code> and <code>logs/</code>. Relative
     paths for other configuration files are taken as relative to this
     directory.</p>
+
+    <example><title>Example</title>
+    ServerRoot /home/httpd
+    </example>
+
 </usage>
 <seealso><a href="../invoking.html">the <code>-d</code>
     option to <code>httpd</code></a></seealso>
 <seealso><a href="../misc/security_tips.html#serverroot">the
     security tips</a> for information on how to properly set
     permissions on the ServerRoot</seealso>
@@ -2142,12 +2230,13 @@
 <description>Configures the footer on server-generated documents</description>
 <syntax>ServerSignature On|Off|EMail</syntax>
 <default>ServerSignature Off</default>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>All</override>
 
 <usage>
     <p>The <directive>ServerSignature</directive> directive allows the
     configuration of a trailing footer line under server-generated
     documents (error messages, mod_proxy ftp directory listings,
     mod_info output, ...). The reason why you would want to enable
@@ -2211,12 +2300,13 @@
 <description>Forces all matching files to be processed by a
 handler</description>
 <syntax>SetHandler <em>handler-name</em></syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 <compatibility>Moved into the core in Apache 2.0</compatibility>
 
 <usage>
     <p>When placed into an <code>.htaccess</code> file or a
     <directive type="section" module="core">Directory</directive> or 
     <directive type="section" module="core">Location</directive>
@@ -2236,23 +2326,28 @@
     the following into httpd.conf:</p>
 <example>
     &lt;Location /status&gt;<br />
     SetHandler server-status<br />
     &lt;/Location&gt;
 </example>
+
 </usage>
+
+<seealso><directive module="mod_mime">AddHandler</directive></seealso>
+
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SetInputFilter</name>
 <description>Sets the filters that will process client requests and POST
 input</description>
 <syntax>SetInputFilter <em>filter</em>[<em>;filter</em>...]</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 
 <usage>
     <p>The <directive>SetInputFilter</directive> directive sets the
     filter or filters which will process client requests and POST
     input when they are received by the server. This is in addition to
     any filters defined elsewhere, including the
@@ -2271,12 +2366,13 @@
 <description>Sets the filters that will process responses from the
 server</description>
 <syntax>SetOutputFilter <em>filter</em> [<em>filter</em>] ...</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 
 <usage>
     <p>The <directive>SetOutputFilter</directive> directive sets the filters
     which will process responses from the server before they are
     sent to the client. This is in addition to any filters defined
     elsewhere, including the
@@ -2298,13 +2394,13 @@
 </usage>
 <seealso><a href="../filter.html">Filters</a> documentation</seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>TimeOut</name>
-<description>Defines the amount of time the server will wait for
+<description>Amount of time the server will wait for
 certain events before failing a request</description>
 <syntax>TimeOut <em>number</em></syntax>
 <default>TimeOut 300</default>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
@@ -2335,14 +2431,13 @@
 <name>UseCanonicalName</name>
 <description>Configures how the server determines its own name and
 port</description>
 <syntax>UseCanonicalName on|off|dns</syntax>
 <default>UseCanonicalName on</default>
 <contextlist><context>server config</context><context>virtual host</context>
-<context>directory</context><context>.htaccess</context></contextlist>
-<override>Options</override>
+<context>directory</context></contextlist>
 
 <usage>
     <p>In many situations Apache has to construct a
     <em>self-referential</em> URL. That is, a URL which refers back to
     the same server. With <code>UseCanonicalName on</code> Apache will
     use the hostname and port specified in the <directive
@@ -2401,24 +2496,30 @@
     ...&gt; ... &lt;/VirtualHost&gt;</syntax>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
     <p><directive type="section">VirtualHost</directive> and
     <code>&lt;/VirtualHost&gt;</code> are used to enclose a group of
-    directives which will apply only to a particular virtual host. Any
-    directive which is allowed in a virtual host context may be
+    directives that will apply only to a particular virtual host. Any
+    directive that is allowed in a virtual host context may be
     used. When the server receives a request for a document on a
     particular virtual host, it uses the configuration directives
     enclosed in the <directive type="section">VirtualHost</directive>
     section. <em>Addr</em> can be</p>
 
     <ul>
-      <li>The IP address of the virtual host</li>
+      <li>The IP address of the virtual host;</li>
 
       <li>A fully qualified domain name for the IP address of the
-      virtual host.</li>
+      virtual host;</li>
+
+      <li>The character *, which is used only in combination with
+      <code>NameVirtualHost *</code> to match all IP addresses; or</li>
+
+      <li>The string <code>_default_</code>, which is used only
+      with IP virtual hosting to catch unmatched IP addresses.</li>
     </ul>
     
 
 <example><title>Example</title>
        &lt;VirtualHost 10.1.2.3&gt;<br />
        ServerAdmin webmaster@host.foo.com<br />
@@ -2447,21 +2548,26 @@
     <p>Each Virtual Host must correspond to a different IP address,
     different port number or a different host name for the server,
     in the former case the server machine must be configured to
     accept IP packets for multiple addresses. (If the machine does
     not have multiple network interfaces, then this can be
     accomplished with the <code>ifconfig alias</code> command (if
-    your OS supports it), or with kernel patches like <a
-    href="../misc/vif-info.html">VIF</a> (for SunOS(TM) 4.1.x)).</p>
+    your OS supports it).</p>
 
-    <p>The special name <code>_default_</code> can be specified in
+    <p>When using IP-based virtual hosting, the special name
+    <code>_default_</code> can be specified in
     which case this virtual host will match any IP address that is
     not explicitly listed in another virtual host. In the absence
     of any _default_ virtual host the "main" server config,
     consisting of all those definitions outside any VirtualHost
-    section, is used when no match occurs.</p>
+    section, is used when no IP-match occurs.  (But note that any IP
+    address that matches a <directive
+    module="core">NameVirtualHost</directive> directive will use neither
+    the "main" server config nor the _default_ virtual host.  See the <a
+    href="../vhosts/name-based.html">name-based virtual hosting</a>
+    documentation for further details.)</p>
 
     <p>You can specify a <code>:port</code> to change the port that is
     matched. If unspecified then it defaults to the same port as the
     most recent <directive module="mpm_common">Listen</directive>
     statement of the main server. You may also specify <code>:*</code>
     to match all ports on that address. (This is recommended when used
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: directives.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: directives.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/directives.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/directives.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/directives.xml	2002-03-10 06:42:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/directives.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,17 +1,19 @@
 <?xml version="1.0"?>
-<!DOCTYPE directiveindex [
-    <!ENTITY allmodules SYSTEM "allmodules.xml">
-]>
+<!DOCTYPE directiveindex SYSTEM "../style/modulesynopsis.dtd"
+  [ <!ENTITY allmodules SYSTEM "allmodules.xml"> ]
+>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
 <directiveindex>
-<title>Directive Index</title>
-<summary>
-    <p>Each Apache directive available in the standard Apache
-    distribution is listed here. They are described using a
-    consistent format, and there is <a href="directive-dict.html"
-    rel="Glossary">a dictionary</a> of the terms used in their
-    descriptions available.</p>
-</summary>
-&allmodules;
+  <title>Directive Index</title>
+  <summary>
+    <p>
+      Each Apache directive available in the standard Apache
+      distribution is listed here. They are described using a
+      consistent format, and there is <a href="directive-dict.html"
+      rel="Glossary">a dictionary</a> of the terms used in their
+      descriptions available.
+    </p>
+  </summary>
+  &allmodules;
 </directiveindex>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: index-bytype.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: index.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: index.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/index.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/index.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/index.xml	2002-03-10 13:06:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/index.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,18 +1,18 @@
 <?xml version="1.0"?>
-<!DOCTYPE directiveindex [
-    <!ENTITY allmodules SYSTEM "allmodules.xml">
-]>
+<!DOCTYPE moduleindex SYSTEM "../style/modulesynopsis.dtd"
+  [ <!ENTITY allmodules SYSTEM "allmodules.xml"> ]
+>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
 <moduleindex>
-<title>Module Index</title>
-<summary>
-
-    <p>Below is a list of all of the modules that come as part of
-    the Apache distribution.  See also the complete
-    alphabetical list of <a href="directives.html">all Apache
-    directives</a>.</p>
-
-</summary>
-&allmodules;
+  <title>Module Index</title>
+  <summary>
+    <p>
+      Below is a list of all of the modules that come as part of
+      the Apache distribution.  See also the complete
+      alphabetical list of <a href="directives.html">all Apache
+      directives</a>.
+    </p>
+  </summary>
+  &allmodules;
 </moduleindex>
\ No newline at end of file
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_access.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_access.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_access.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_access.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_access.xml	2002-03-07 00:24:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_access.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_access</name> 
 
 <description>Provides access control based on client hostname, IP
 address, or other characteristics of the client request.</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_actions.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_actions.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_actions.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_actions.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_actions.xml	2002-04-15 00:57:46.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_actions.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_actions</name> 
 
 <description>This module provides for executing CGI scripts based on
 media type or request method.</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_alias.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_alias.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_alias.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_alias.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_alias.xml	2002-04-26 04:08:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_alias.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_alias</name>
 <description>Provides for mapping different parts of the host
     filesystem in the document tree and for URL redirection</description>
 <status>Base</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_asis.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_asis.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_asis.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_asis.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_asis.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_asis.xml	2002-05-27 09:25:22.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_asis</name>
 <description>Sends files that contain their own
 HTTP headers</description>
 <status>Base</status>
@@ -20,12 +20,15 @@
     requiring a cgi-script or an nph script.</p>
 
     <p>For historical reasons, this module will also process any
     file with the mime type <code>httpd/send-as-is</code>.</p>
 </summary>
 
+<seealso><module>mod_headers</module></seealso>
+<seealso><module>mod_cern_meta</module></seealso>
+
 <section><title>Usage</title>
 
     <p>In the server configuration file, associate files with the
     <code>send-as-is</code> handler <em>e.g.</em></p>
 
 <example>AddHandler send-as-is asis</example>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_auth_anon.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_auth_anon.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_anon.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_anon.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_anon.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_anon.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_auth_anon</name>
 <description>Allows "anonymous" user access to authenticated
     areas</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_auth_dbm.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_auth_dbm.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_dbm.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_dbm.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_dbm.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_dbm.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_auth_dbm</name>
 <description>Provides for user authentication using DBM
     files</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_auth_digest.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_auth_digest.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_digest.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_digest.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth_digest.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth_digest.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 <name>mod_auth_digest</name>
 <description>User authentication using MD5
     Digest Authentication.</description>
 <status>Experimental</status>
 <sourcefile>mod_auth_digest.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_auth.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_auth.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_auth_ldap.html
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_auth.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_auth.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_auth</name>
 <description>User authentication using text files</description>
 <status>Base</status>
 <sourcefile>mod_auth.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_autoindex.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_autoindex.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_autoindex.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_autoindex.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_autoindex.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_autoindex.xml	2002-06-13 15:13:55.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 <name>mod_autoindex</name>
 
 <description>Generates directory indexes,
     automatically, similar to the Unix <em>ls</em> command or the
     Win32 <em>dir</em> shell command</description>
@@ -236,12 +236,13 @@
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddDescription</name>
+<description>Description to display for a file</description>
 <syntax>AddDescription
     <em>string file</em> [<em>file</em>] ...</syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>Indexes</override>
@@ -383,13 +384,13 @@
 <override>Indexes</override>
 
 <usage>
     <p>The <directive>DefaultIcon</directive> directive sets the icon
     to display for files when no specific icon is known, for <code><a
     href="#indexoptions:fancyindexing">FancyIndexing</a></code>.
-    <em>Url</em> is a (%-escaped) relative URL to the icon.
+    <em>Url-path</em> is a (%-escaped) relative URL to the icon.
     Examples:</p>
 <example>DefaultIcon /icon/unknown.xbm</example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
@@ -404,12 +405,16 @@
 
 <usage>
     <p>The <directive>HeaderName</directive> directive sets the name
     of the file that will be inserted at the top of the index
     listing. <em>Filename</em> is the name of the file to include.</p>
 
+<example><title>Example</title>
+HeaderName HEADER.html
+</example>
+
 <note>
       <p>Both HeaderName and <directive
       module="mod_autoindex">ReadmeName</directive> now treat
       <em>Filename</em> as a URI path relative to the one used to
       access the directory being indexed. <em>Filename</em> must
       resolve to a document with a major content type of
@@ -817,25 +822,31 @@
     directory listing in a different order.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ReadmeName</name>
+<description>Name of the file that will be inserted at the end
+of the index listing</description>
 <syntax>ReadmeName <em>filename</em></syntax>
 <contextlist><context>server config</context><context>virtual host</context>
 <context>directory</context><context>.htaccess</context>
 </contextlist>
 <override>Indexes</override>
 
 <usage>
     <p>The <directive>ReadmeName</directive> directive sets the name
     of the file that will be appended to the end of the index
     listing. <em>Filename</em> is the name of the file to include, and
     is taken to be relative to the location being indexed.</p>
 
+    <example><title>Example</title>
+    ReadmeName FOOTER.html
+    </example>
+
     <p>See also <directive
     module="mod_autoindex">HeaderName</directive>, where this behavior
     is described in greater detail.</p>
 </usage>
 </directivesynopsis>
 
-</modulesynopsis>
\ No newline at end of file
+</modulesynopsis>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_cache.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_cache.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cache.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cache.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cache.xml	2002-04-30 11:41:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cache.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_cache</name>
 <description>Content cache keyed to URIs</description>
 <status>Experimental</status>
 <sourcefile>mod_cache.c</sourcefile>
@@ -16,22 +16,22 @@
 </note>
     <p>mod_cache implements an RFC 2616 compliant HTTP content
     cache that can be used to cache either local or proxied content.
     mod_cache requires the services of one or more storage
     management modules. Two storage management modules are included in
     the base Apache distribution:</p>
-    <ul>
-    <li><em>mod_disk_cache</em></li><br />
-    implements a disk based storage manager for use with mod_proxy</br>
-    <li><em>mod_mem_cache</em></li><br />
-    implements an in-memory based storage manager. mod_mem_cache
+    <dl>
+    <dt><em>mod_disk_cache</em></dt>
+    <dd>implements a disk based storage manager for use with mod_proxy</dd>
+    <dt><em>mod_mem_cache</em></dt>
+    <dd>implements an in-memory based storage manager. mod_mem_cache
     can be configured to operate in two modes: caching open file
     descriptors or caching objects in heap storage. <em>mod_mem_cache</em>
     is most useful when used to cache locally generated content or to cache 
-    backend server content for mod_proxy configured for ProxyPass (aka <em>reverse proxy</em>)
-    </ul>
+    backend server content for mod_proxy configured for ProxyPass (aka <em>reverse proxy</em>)</dd>
+    </dl>
     <p>Content stored and retrived keyed to the URL. Content with
     access protections is not cached.</p>
 </summary>
 
 <section><title>Sample Configuration</title>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_cern_meta.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_cern_meta.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cern_meta.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cern_meta.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cern_meta.xml	2002-03-11 19:09:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cern_meta.xml	2002-06-13 07:48:30.000000000 +0800
@@ -1,19 +1,18 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_cern_meta</name>
 <description>CERN httpd metafile semantics</description>
 <status>Extension</status>
 <sourcefile>mod_cern_meta.c</sourcefile>
 <identifier>cern_meta_module</identifier>
 
 <summary>
-    <!-- XXX: Should mention other possibilities in Apache: mod_header -->
     <p>Emulate the CERN HTTPD Meta file semantics. Meta files are HTTP
     headers that can be output in addition to the normal range of
     headers for each file accessed. They appear rather like the
     Apache .asis files, and are able to provide a crude way of
     influencing the Expires: header, as well as providing other
     curiosities. There are many ways to manage meta information,
@@ -22,12 +21,15 @@
 
     <p>More information on the <a
     href="http://www.w3.org/pub/WWW/Daemon/User/Config/General.html#MetaDir">
     CERN metafile semantics</a> is available.</p>
 </summary>
 
+<seealso><module>mod_headers</module></seealso>
+<seealso><module>mod_asis</module></seealso>
+
 <directivesynopsis>
 <name>MetaFiles</name>
 <description>Activates CERN meta-file processing</description>
 <syntax>MetaFiles on|off</syntax>
 <default>MetaFiles off</default>
 <contextlist><context>directory</context></contextlist>
@@ -47,13 +49,20 @@
 
 <usage>
     <p>Specifies the name of the directory in which Apache can find
     meta information files. The directory is usually a 'hidden'
     subdirectory of the directory that contains the file being
     accessed. Set to "<code>.</code>" to look in the same directory
-    as the file.</p>
+    as the file:</p>
+
+    <example>MetaDir .</example>
+
+    <p>Or, to set it to a subdirectory of the directory containing the
+    files:</p>
+
+    <example>MetaDir .meta</example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MetaSuffix</name>
 <description>File name suffix for the file containg CERN-style
@@ -67,10 +76,15 @@
     meta information. For example, the default values for the two
     directives will cause a request to
     <code>DOCUMENT_ROOT/somedir/index.html</code> to look in
     <code>DOCUMENT_ROOT/somedir/.web/index.html.meta</code> and
     will use its contents to generate additional MIME header
     information.</p>
+
+    <p>Example:</p>
+
+    <example>MetaSuffix .meta</example>
+
 </usage>
 </directivesynopsis>
 
 </modulesynopsis>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_cgid.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_cgid.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cgid.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cgid.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cgid.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cgid.xml	2002-06-14 05:54:53.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_cgid</name>
 <description>Execution of CGI scripts using an
     external CGI daemon</description>
 <status>Base</status>
@@ -24,13 +24,14 @@
     process. In order to avoid incurring this expense on each CGI
     invocation, mod_cgid creates an external daemon that is
     responsible for forking child processes to run CGI scripts. The
     main server communicates with this daemon using a unix domain
     socket.</p>
 
-    <p>This module is used by default whenever a multi-threaded MPM
+    <p>This module is used by default instead of
+    <module>mod_cgi</module> whenever a multi-threaded MPM
     is selected during the compilation process. At the user level,
     this module is identical in configuration and operation to
     <module>mod_cgi</module>. The only exception is the
     additional directive <code>ScriptSock</code> which gives the
     name of the socket to use for communication with the cgi
     daemon.</p>
@@ -58,11 +59,16 @@
     <p>This directive sets the name of the socket to use for
     communication with the CGI daemon. The socket will be opened
     using the permissions of the user who starts Apache (usually
     root). To maintain the security of communications with CGI
     scripts, it is important that no other user has permission to
     write in the directory where the socket is located.</p>
+
+    <example><title>Example</title>
+    ScriptSock /var/run/cgid.sock
+    </example>
+
 </usage>
 </directivesynopsis>
 
 </modulesynopsis>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_cgi.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_cgi.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cgi.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cgi.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_cgi.xml	2002-04-23 18:01:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_cgi.xml	2002-06-13 10:35:57.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_cgi</name>
 <description>Execution of CGI scripts</description>
 <status>Base</status>
 <sourcefile>mod_cgi.c</sourcefile>
@@ -137,13 +137,17 @@
 
 <usage>
     <p>The <directive>ScriptLog</directive> directive sets the CGI
     script error logfile. If no ScriptLog is given, no error log is
     created. If given, any CGI errors are logged into the filename
     given as argument. If this is a relative file or path it is taken
-    relative to the server root.</p>
+    relative to the <code>ServerRoot</code>.</p>
+
+    <example><title>Example</title>
+    ScriptLog logs/cgi_log
+    </example>
 
     <p>This log will be opened as the user the child processes run
     as, ie. the user specified in the main <directive module="mpm_common"
     >User</directive> directive. This means that
     either the directory the script log is in needs to be writable
     by that user or the file needs to be manually created and set
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_charset_lite.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_charset_lite.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_charset_lite.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_charset_lite.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_charset_lite.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_charset_lite.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_charset_lite</name>
 <description>Specify character set translation or recoding</description>
 <status>Experimental</status>
 <sourcefile>mod_charset_lite.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_dav.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_dav.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_dav.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_dav.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_dav.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_dav.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_dav.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_dav</name> 
 <description>Distributed Authoring and Versioning
 (<a href="http://www.webdav.org/">WebDAV</a>) functionality</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_dav.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_deflate.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_deflate.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_deflate.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_deflate.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_deflate.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_deflate.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,20 +1,20 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_deflate</name>
 <description>Compress content before
     it is delivered to the client</description>
-<status>experimental</status>
+<status>Extension</status>
 <sourcefile>mod_deflate.c</sourcefile>
 <identifier>deflate_module</identifier>
 
 <summary>
-    <p>The experimental <module>mod_deflate</module> module provides
+    <p>The <module>mod_deflate</module> module provides
     the <code>DEFLATE</code> output filter that allows output from
     your server to be compressed before being sent to the client over
     the network.</p>
 </summary>
 <seealso><directive module="mod_mime">AddOutputFilter</directive></seealso>
 <seealso><directive module="core">SetOutputFilter</directive></seealso>
@@ -56,33 +56,44 @@
     to the request.  The name of the note is the value specified for
     the directive.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
+<name>DeflateBufferSize</name>
+<description>Fragment size to be compressed at one time by zlib</description>
+<syntax>DeflateBufferSize <em>value</em></syntax>
+<contextlist><context>server config</context></contextlist>
+
+<usage>
+    <p>The <directive>DeflateBufferSize</directive> directive specifies
+    the size in bytes of the fragments that zlib should compress at one
+    time.</p>
+</usage>
+</directivesynopsis>
+
+<directivesynopsis>
 <name>DeflateWindowSize</name>
 <description>Zlib compression window size</description>
 <syntax>DeflateWindowSize <em>value</em></syntax>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
-    <!-- XXX: Ummm... What unit??? -->
     <p>The <directive>DeflateWindowSize</directive> directive specifies the
-    zlib compression window size.</p>
+    zlib compression window size (a value between 1 and 15).</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>DeflateMemLevel</name>
 <description>Amount of memory available to zlib for compression</description>
 <syntax>DeflateMemLevel <em>value</em></syntax>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
-    <!-- XXX: Ummm... What unit??? -->
     <p>The <directive>DeflateMemLevel</directive> directive specifies
-    the amount of memory available to zlib for compression.</p>
+    the amount of memory in bytes available to zlib for compression.</p>
 </usage>
 </directivesynopsis>
 
 </modulesynopsis>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_dir.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_dir.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_dir.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_dir.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_dir.xml	2002-03-07 00:24:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_dir.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 <name>mod_dir</name>
 <description>Provides for "trailing slash" redirects and
     serving directory index files</description>
 <status>Base</status>
 <sourcefile>mod_dir.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_env.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_env.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_env.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_env.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_env.xml	2002-03-07 06:16:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_env.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_env</name>
   <description>Modifies the environment which is
     passed to CGI scripts and SSI pages</description>
   <status>Base</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_example.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_example.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_example.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_example.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_example.xml	2002-03-09 01:19:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_example.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_example</name>
 <description>Illustrates the Apache module API</description>
 <status>Experimental</status>
 <sourcefile>mod_example.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_expires.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_expires.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_expires.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_expires.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_expires.xml	2002-03-11 03:37:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_expires.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_expires</name>
 <description>Generation of
     <code>Expires</code> HTTP headers according to user-specified
     criteria</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_ext_filter.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_ext_filter.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_ext_filter.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_ext_filter.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_ext_filter.xml	2002-03-09 01:19:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_ext_filter.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_ext_filter</name>
 <description>Pass the response body
     through an external program before delivery to the
     client</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_file_cache.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_file_cache.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_file_cache.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_file_cache.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_file_cache.xml	2002-03-09 01:19:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_file_cache.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_file_cache</name>
 <description>Caches a static list of files in memory</description>
 <status>Experimental</status>
 <sourcefile>mod_file_cache.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_headers.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_headers.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_headers.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_headers.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_headers.xml	2002-03-09 01:19:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_headers.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_headers</name>
 <description>Customization of HTTP request
     and response headers</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_imap.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_imap.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_imap.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_imap.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_imap.xml	2002-03-09 01:19:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_imap.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_imap</name>
 <description>Server-side imagemap processing</description>
 <status>Base</status>
 <sourcefile>mod_imap.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_include.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_include.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_include.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_include.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_include.xml	2002-04-15 01:08:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_include.xml	2002-06-15 10:34:29.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_include</name>
 <description>Server-parsed html documents (Server Side Includes)</description>
 <status>Base</status>
 <sourcefile>mod_include.c</sourcefile>
@@ -12,13 +12,13 @@
 <summary>
 
     <p>This module provides a filter which will process files
     before they are sent to the client. The processing is
     controlled by specially formated SGML comments, referred to as
     <em>elements</em>. These elements allow conditional text, the
-    inclusion other files or programs, as well as the setting and
+    inclusion of other files or programs, as well as the setting and
     printing of environment variables.</p>
 
 </summary>
     <seealso><directive module="core">Options</directive></seealso>
     <seealso><directive module="core">SetOutputFilter</directive></seealso>
     <seealso><directive module="core">AcceptPathInfo</directive></seealso>
@@ -38,13 +38,13 @@
       AddOutputFilter INCLUDES .shtml
     </example>
 
     <p>The following directive must be given for the directories
     containing the shtml files (typically in a
     <code>&lt;Directory&gt;</code> section, but this directive is
-    also valid .htaccess files if <code>AllowOverride
+    also valid in .htaccess files if <code>AllowOverride
     Options</code> is set):</p>
 
     <example>
       Options +Includes
     </example>
 
@@ -432,17 +432,17 @@
     <p>EXAMPLE: the below example will print "in foo" if the
     DOCUMENT_URI is /foo/file.html, "in bar" if it is
     /bar/file.html and "in neither" otherwise:</p>
 
 <example>
     &lt;!--#if expr="\"$DOCUMENT_URI\" = \"/foo/file.html\"" --&gt;<br />
-    in foo<br />
+&nbsp;&nbsp;    in foo<br />
     &lt;!--#elif expr="\"$DOCUMENT_URI\" = \"/bar/file.html\"" --&gt;<br />
-    in bar<br />
+&nbsp;&nbsp;    in bar<br />
     &lt;!--#else --&gt;<br />
-    in neither<br />
+&nbsp;&nbsp;    in neither<br />
     &lt;!--#endif --&gt;
 </example>
 </section>
 
 <section id="flowctrl">
     <title>Flow Control Elements</title>
@@ -553,100 +553,127 @@
     configure the server to accept requests with PATH_INFO.</p>
 
 </section>
 
 <directivesynopsis>
 <name>SSIEndTag</name>
-<description>Changes the string that mod_include looks for to end an
-include command.</description>
+<description>String that ends an include element</description>
 <syntax>SSIEndTag <em>tag</em></syntax>
 <default>SSIEndTag &quot;--&gt;&quot;</default>
 <contextlist><context>server config</context>
 <context>virtual host</context></contextlist>
-<override>FileInfo</override>
 <compatibility>Available in version 2.0.30 and later.
 </compatibility>
 
 <usage>
     <p>This directive changes the string that mod_include looks for 
-    to mark the end of a include command.</p>
+    to mark the end of an include element.</p>
+
+    <example>
+    <title>Example</title>
+    SSIEndTag "%&gt;"
+    </example>
 
 </usage>
-<seealso><directive>SSIStartTag</directive></seealso>
+<seealso><directive module="mod_include">SSIStartTag</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SSIUndefinedEcho</name>
-<description>Changes the string that mod_include displays when
-a variable isn't set.</description>
+<description>String displayed when
+an unset variable is echoed</description>
 <syntax>SSIUndefinedEcho <em>tag</em></syntax>
 <default>SSIUndefinedEcho &quot;&lt;!-- undef --&gt;&quot;</default>
 <contextlist><context>server config</context>
 <context>virtual host</context></contextlist>
-<override>FileInfo</override>
 <compatibility>Available in version 2.0.34 and later.
 </compatibility>
 
 <usage>
     <p>This directive changes the string that mod_include displays
     when a variable is not set and &quot;echoed&quot;.</p>
+
+    <example>
+    <title>Example</title>
+    SSIUndefinedEcho "[ No Value ]"
+    </example>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SSIErrorMsg</name>
-<description>Changes the error message displayed when there is an error</description>
+<description>Error message displayed when there is an SSI error</description>
 <syntax>SSIErrorMsg <em>message</em></syntax>
 <default>SSIErrorMsg 
 &quot;[an error occurred while processing this directive]&quot;</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
-<override></override>
+<override>All</override>
 <compatibility>Available in version 2.0.30 and later.</compatibility>
 
 <usage>
     <p>The SSIErrorMsg directive changes the error message displayed
     when mod_include encounters an error. For production servers you
     may consider changing the default error message to
     <code>&quot;&lt;!-- Error --&gt;&quot;</code> so that the message
     is not presented to the user.
     </p>
     <p>This directive has the same effect as the <code>&lt;!--#config
     errmsg=<em>message</em> --&gt;</code> element.</p>
 
+    <example>
+    <title>Example</title>
+    SSIErrorMsg "&lt;!-- Error --&gt;"
+    </example>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SSIStartTag</name>
-<description></description>
+<description>String that starts an include element</description>
 <syntax>Changes the string that mod_include looks for to start an
 include element</syntax>
 <default>SSIStartTag &quot;&lt;!--&quot;</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 </contextlist>
-<override></override>
 <compatibility>Available in version 2.0.30 and later.</compatibility>
 
 <usage>
 
     <p>This directive changes the string that mod_include looks for 
     to mark an include element to process.</p>
 
-    <p>You may want to use this option if have 2 servers parsing the
+    <p>You may want to use this option if you have 2 servers parsing the
     output of a file each processing different commands (possibly at
     different times).</p> 
 
+    <example>
+    <title>Example</title>
+    SSIStartTag "&lt;%"
+    </example>
+
+    <p>The example given above, in conjunction with a matching
+    <directive module="mod_include">SSIEndTag</directive>, will 
+    allow you to use SSI directives as shown in the example 
+    below:</p>
+
+    <example>
+    <title>SSI directives with alternate start and end tags</title>
+    &lt;%#printenv %&gt;
+    </example>
+
 </usage>
-<seealso><directive>SSIEndTag</directive></seealso>
+<seealso><directive module="mod_include">SSIEndTag</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SSITimeFormat</name>
 <description>Configures the format in which date strings are 
 displayed</description>
@@ -655,22 +682,31 @@
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
-<override></override>
+<override>All</override>
 <compatibility>Available in version 2.0.30 and later.</compatibility>
 
 <usage>
 <p>This directive changes the format in which date strings are displayed 
     when echoing DATE environment variables.  The <em>formatstring</em>
     is as in strftime(3) from the C standard library.</p>
 
     <p>This directive has the same effect as the <code>&lt;!--#config
     timefmt=<em>formatstring</em> --&gt;</code> element.</p>
+
+    <example>
+    <title>Example</title>
+    SSITimeFormat "%R, %B %d, %Y"
+    </example>
+
+    <p>The above directive would cause times to be displayed in the
+    format "22:26, June 14, 2002".</p>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>XBitHack</name>
 <description>Parse SSI directives in files with the execute 
@@ -681,13 +717,12 @@
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override>Options</override>
-<compatibility></compatibility>
 
 <usage>
     <p>The XBitHack directives controls the parsing of ordinary
     html documents. This directive only affects files associated
     with the MIME type <code>text/html</code>. XBitHack can take on
     the following values:</p>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_info.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_info.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_info.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_info.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_info.xml	2002-03-09 02:00:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_info.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_info</name>
 <description>Provides a comprehensive overview of the server
 configuration</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_isapi.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_isapi.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_isapi.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_isapi.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_isapi.xml	2002-03-10 02:31:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_isapi.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_isapi</name>
 <description>ISAPI Extensions within Apache for Windows</description>
 <status>Base</status>
 <sourcefile>mod_isapi.c</sourcefile>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_ldap.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_log_config.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_log_config.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_log_config.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_log_config.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_log_config.xml	2002-04-02 11:09:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_log_config.xml	2002-05-31 15:31:09.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_log_config</name>
 <description>Logging of the requests made to the server</description>
 <status>Base</status>
 <sourcefile>mod_log_config.c</sourcefile>
@@ -292,14 +292,14 @@
     of a '<code>env=!<em>name</em></code>' clause), then the
     request will be logged.</p>
 
     <p>Environment variables can be set on a <em>per</em>-request
     basis using the <module>mod_setenvif</module>
     and/or <module>mod_rewrite</module> modules. For
-    example, if you don't want to record requests for all GIF
-    images on your server in a separate logfile but not your main
+    example, if you want to record requests for all GIF
+    images on your server in a separate logfile but not in your main
     log, you can use:</p>
     
 <example>
     SetEnvIf Request_URI \.gif$ gif-image<br />
     CustomLog gif-requests.log common env=gif-image<br />
     CustomLog nongif-requests.log common env=!gif-image
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_mime.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_mime.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_mime_magic.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_mime_magic.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_mime_magic.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_mime_magic.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_mime_magic.xml	2002-03-10 02:31:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_mime_magic.xml	2002-06-13 08:02:58.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_mime_magic</name>
 <description>Determines the MIME type of a file
     by looking at a few bytes of its contents</description>
 <status>Extension</status>
@@ -295,10 +295,15 @@
     <p>The <directive>MimeMagicFile</directive> directive can be used to
     enable this module, the default file is distributed at
     <code>conf/magic</code>. Non-rooted paths are relative to the
     ServerRoot. Virtual hosts will use the same file as the main
     server unless a more specific setting is used, in which case
     the more specific setting overrides the main server's file.</p>
+
+    <p>For example</p>
+
+    <example>MimeMagicFile conf/magic</example>
+
 </usage>
 </directivesynopsis>
 </modulesynopsis>
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_mime.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_mime.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_mime.xml	2002-03-09 02:00:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_mime.xml	2002-06-13 15:12:20.000000000 +0800
@@ -1,14 +1,14 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_mime</name>
-<description>Associates the request filename's extensions
-    (e.g. .html) with the file's behavior (handlers and filters)
+<description>Associates the requested filename's extensions
+    with the file's behavior (handlers and filters)
     and content (mime-type, language, character set and
     encoding)</description>
 <status>Base</status>
 <sourcefile>mod_mime.c</sourcefile>
 <identifier>mime_module</identifier>
 
@@ -20,77 +20,69 @@
     information is sent to the browser, and participates in content
     negotiation, so the user's preferences are respected when
     choosing one of several possible files to serve. See
     <module>mod_negotiation</module> for more information
     about content negotiation. </p>
 
-    <p>The directives <directive>AddCharset</directive>,
-    <directive>AddEncoding</directive>,
-    <directive>AddLanguage</directive> and
-    <directive>AddType</directive> all used to map file extensions
-    onto the meta-information for that file. Respectively they set
-    the character set, content-encoding, content-language, and
-    MIME-type (content-type) of documents.</p>
-
-    <p>In addition, mod_mime may define the "handler" for a
-    document, which controls which module or script will serve the
-    document. With the introduction of "filters" in Apache 2.0,
-    mod_mime can also define the filters that the the content
-    should be processed through (e.g. the Includes output filter
-    for server side scripting) and what filters the client request
-    and POST content should be processed through (the input
-    filters.)</p>
-
-    <p>The directives <directive>AddHandler</directive>,
-    <directive>AddOutputFilter</directive>, and
-    <directive>AddInputFilter</directive> control the modules
-    or scripts that serve the document.  The 
-    <directive>MultiviewsMatch</directive> directive allows
-    <directive>mod_negotiation</directive> to consider these
-    file extensions to included when testing Multiviews matches.</p>
-
-    <p>The directive <directive>TypesConfig</directive> is used
-    to specify a file which also maps extensions onto MIME types.
-    Most administrators use the provided mime.types file which
-    associates common filename extensions with IANA registered
-    content types. The current list is maintained at
-    <code>http://www.isi.edu/in-notes/iana/assignments/media-types/media-types</code>
-    although it may be mirrored elsewhere). This simplifies the
-    httpd.conf file by providing the majority of media-type
-    definitions, and they may be overridden by 
-    <directive>AddType</directive> directives as needed.</p>
+    <p>The directives <directive
+    module="mod_mime">AddCharset</directive>, <directive
+    module="mod_mime">AddEncoding</directive>, <directive
+    module="mod_mime">AddLanguage</directive> and <directive
+    module="mod_mime">AddType</directive> are all used to map file
+    extensions onto the meta-information for that file. Respectively
+    they set the character set, content-encoding, content-language,
+    and MIME-type (content-type) of documents.  The directive <directive
+    module="mod_mime">TypesConfig</directive> is used to specify a
+    file which also maps extensions onto MIME types. </p>
+
+    <p>In addition, <module>mod_mime</module> may define the <a
+    href="../handler.html">handler</a> and <a
+    href="../filter.html">filters</a> that originate and process
+    content.  The directives <directive
+    module="mod_mime">AddHandler</directive>, <directive
+    module="mod_mime">AddOutputFilter</directive>, and <directive
+    module="mod_mime">AddInputFilter</directive> control the modules
+    or scripts that serve the document.  The <directive
+    module="mod_mime">MultiviewsMatch</directive> directive allows
+    <module>mod_negotiation</module> to consider these file extensions
+    to be included when testing Multiviews matches.</p>
+
+    <p>While <module>mod_mime</module> associates meta-information
+    with filename extensions, the <module>core</module> server
+    provides directives that are used to associate all the files in a
+    given container (<em>e.g.</em>, <directive type="section"
+    module="core">location</directive>, <directive type="section"
+    module="core">directory</directive>, or <directive type="section"
+    module="core">Files</directive>) with particular
+    meta-information. These directives include <directive
+    module="core">ForceType</directive>, <directive
+    module="core">SetHandler</directive>, <directive
+    module="core">SetInputFilter</directive>, and <directive
+    module="core">SetOutputFilter</directive>.  The core directives
+    override any filename extension mappings defined in
+    <module>mod_mime</module>.</p>
 
-    <note>Please do not send requests to the Apache httpd Project
-    to add any new entries in the distributed mime.types file
-    unless (1) they are already registered with IANA, and (2) they
-    use widely accepted, non-conflicting filename extensions across
-    platforms. category/x-subtype requests will be automatically
-    rejected, as will any new two-letter extensions as they will
-    likely conflict later with the already crowded language and
-    character set namespace.</note>
-
-    <p>The core directives <directive
-    module="core">ForceType</directive> and
-    <directive>SetHandler</directive> are used to
-    associate all the files in a given container (<em>e.g.</em>,
-    &lt;location&gt;, &lt;directory&gt;, or &lt;Files&gt;) with a
-    particular MIME-type or handler. These settings override any
-    filename extension mappings defined in mod_mime.</p>
-
-    <p>Note that changing the type or encoding of a file does not
+    <p>Note that changing the meta-information for a file does not
     change the value of the <code>Last-Modified</code> header.
     Thus, previously cached copies may still be used by a client or
     proxy, with the previous headers. If you change the
     meta-information (language, content type, character set or
     encoding) you may need to 'touch' affected files (updating
     their last modified date) to ensure that all visitors are
     receive the corrected content headers.</p>
 </summary>
 
-    <seealso>See also: <directive
+    <seealso><directive
     module="mod_mime_magic">MimeMagicFile</directive></seealso>
+<seealso><directive module="core">AddDefaultCharset</directive></seealso>
+<seealso><directive module="core">ForceType</directive></seealso>
+<seealso><directive module="core">DefaultType</directive></seealso>
+<seealso><directive module="core">SetHandler</directive></seealso>
+<seealso><directive module="core">SetInputFilter</directive></seealso>
+<seealso><directive module="core">SetOutputFilter</directive></seealso>
+
 
 <section id="multipleext">
 <title>Files with Multiple Extensions</title>
 
     <p>Files can have more than one extension, and the order of the
     extensions is <em>normally</em> irrelevant. For example, if the
@@ -214,13 +206,12 @@
 <directivesynopsis>
 <name>AddCharset</name>
 <description>Maps the given filename extensions
     to the specified content charset</description>
 <syntax>AddCharset <em>charset extension</em> 
 [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
@@ -256,22 +247,22 @@
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 
 </usage>
 <seealso><module>mod_negotiation</module></seealso>
+<seealso><directive module="core">AddDefaultCharset</directive></seealso>
 
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddEncoding</name>
 <description>Maps the given filename extensions
     to the specified encoding type</description>
 <syntax>AddEncoding
     <em>MIME-enc extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
@@ -313,38 +304,35 @@
     specified without the <code>x-</code>.</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 
 </usage>
-<seealso><a href="#multipleext">Files with
-    multiple extensions</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddHandler</name>
-<description>AddHandler maps the filename extensions
-to the <a href="../handler.html">handler</a> 
-<em>handler-name</em></description>
+<description>Maps the filename extensions
+to the specified handler</description>
 <syntax>AddHandler
     <em>handler-name extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
-<compatibility></compatibility>
 
 <usage>
-<p>This mapping is added to any already in
-    force, overriding any mappings that already exist for the same
-    <em>extension</em>. For example, to activate CGI scripts with
-    the file extension "<code>.cgi</code>", you might use:</p>
+<p>Files having the name <em>extension</em> will be served by the
+specified <a href="../handler.html">handler-name</a>.  This mapping is
+added to any already in force, overriding any mappings that already
+exist for the same <em>extension</em>. For example, to activate CGI
+scripts with the file extension "<code>.cgi</code>", you might
+use:</p>
 
 <example>
     AddHandler cgi-script .cgi
 </example>
 
     <p>Once that has been put into your srm.conf or httpd.conf
@@ -352,66 +340,60 @@
     will be treated as a CGI program.</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 
 </usage>
- <seealso><a href="#multipleext">Files with
-    multiple extensions</a></seealso>
+<seealso><directive module="core">SetHandler</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddInputFilter</name>
-<description>Maps the filename extensions
-    to the filter or filters which will process
+<description>Maps filename extensions
+    to the filters that will process
     client requests</description>
 <syntax>AddInputFilter
     <em>filter</em>[<em>;filter</em>...] extension
     [<em>extension</em> ...]</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>AddInputFilter
     is only available in Apache 2.0.26 and later.</compatibility>
 
 <usage>
 
-    <p>AddInputFilter maps the filename extensions
-    <em>extension</em> to the filter or filters which will process
+    <p>AddInputFilter maps the filename extensions <em>extension</em>
+    to the <a href="../filter.html">filters</a> which will process
     client requests and POST input when they are received by the
     server. This is in addition to any filters defined elsewhere,
     including the <a
     href="core.html#setinputfilter">SetInputFilter</a> directive.
-    This mapping is merged over any already in force, overriding
-    any mappings that already exist for the same
-    <em>extension</em>.</p>
+    This mapping is merged over any already in force, overriding any
+    mappings that already exist for the same <em>extension</em>.</p>
 
     <p>If more than one filter is specified, they must be separated
     by semicolons in the order in which they should process the
     content. Both the filter and <em>extension</em> arguments are
     case-insensitive, and the extension may be specified with or
     without a leading dot.</p>
 
 </usage>
-<seealso><a href="../filter.html">Filters</a>
-    documentation.</seealso>
 
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>AddLanguage</name>
 <description>Maps the given filename extension
 to the specified content language</description>
 <syntax>AddLanguage
     <em>MIME-lang extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
@@ -457,126 +439,122 @@
     treated as being "<code>en-us</code>".</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 
 </usage>
-<seealso><a href="#multipleext">Files with
-    multiple extensions</a></seealso>
 <seealso><module>mod_negotiation</module></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddOutputFilter</name>
 <description>maps the filename
 extensions to the filters that will process
 responses from the server</description>
 <syntax>AddOutputFilter
     <em>filter</em>[<em>;filter</em>...] extension
     [<em>extension</em> ...]</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override></override>
 <compatibility>AddOutputFilter
     is only available in Apache 2.0.26 and later.</compatibility>
 
 <usage>
 
-    <p>The <directive>AddOutputFilter</directive> directive maps the filename
-    extensions <em>extension</em> to the filters which will process
-    responses from the server before they are sent to the client.
-    This is in addition to any filters defined elsewhere, including
-    the <directive module="core">SetOutputFilter</directive>
+    <p>The <directive>AddOutputFilter</directive> directive maps the
+    filename extensions <em>extension</em> to the <a
+    href="../filter.html">filters</a> which will process responses
+    from the server before they are sent to the client.  This is in
+    addition to any filters defined elsewhere, including the
+    <directive module="core">SetOutputFilter</directive>
     directive. This mapping is merged over any already in force,
     overriding any mappings that already exist for the same
     <em>extension</em>.</p>
 
     <p>For example, the following configuration will process all
-    .shtml files for server-side includes.</p>
+    .shtml files for server-side includes and will then compress
+    the output using <module>mod_deflate</module>.</p>
      
 
     <example>
-      &nbsp;&nbsp;AddOutputFilter INCLUDES shtml
+      AddOutputFilter INCLUDES;DEFLATE shtml
     </example>
 
     <p>If more than one filter is specified, they must be separated
     by semicolons in the order in which they should process the
     content. Both the filter and <em>extension</em> arguments are
     case-insensitive, and the extension may be specified with or
     without a leading dot.</p>
 
 </usage>
-<seealso><a href="../filter.html">Filters</a> documentation</seealso>
 
+<seealso><directive module="mod_mime">RemoveOutputFilter</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AddType</name>
 <description>Maps the given filename extensions
 onto the specified content type</description>
 <syntax>AddType <em>MIME-type
     extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
 
 <usage>
 
-    <p>The AddType directive maps the given filename extensions
-    onto the specified content type. <em>MIME-type</em> is the MIME
-    type to use for filenames containing <em>extension</em>. This
-    mapping is added to any already in force, overriding any
-    mappings that already exist for the same <em>extension</em>.
-    This directive can be used to add mappings not listed in the
-    MIME types file (see the <directive>TypesConfig</directive>
+    <p>The AddType directive maps the given filename extensions onto
+    the specified content type. <em>MIME-type</em> is the MIME type to
+    use for filenames containing <em>extension</em>. This mapping is
+    added to any already in force, overriding any mappings that
+    already exist for the same <em>extension</em>.  This directive can
+    be used to add mappings not listed in the MIME types file (see the
+    <directive module="mod_mime">TypesConfig</directive>
     directive).</p>
     
     <p>Example:</p>
 
     <example>
       AddType image/gif .gif
     </example>
 
     <note>It is recommended that new MIME types be added using the
     AddType directive rather than changing the 
     <directive>TypesConfig</directive> file. </note>
 
-    <note>Note that, unlike the NCSA httpd, this directive cannot be
-    used to set the type of particular files.</note>
-
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 
 </usage>
-<seealso><a href="#multipleext">Files with
-    multiple extensions</a></seealso>
+<seealso><directive module="core">DefaultType</directive></seealso>
+<seealso><directive module="core">ForceType</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MultiviewsMatch</name>
+<description>The types of files that will be included when 
+searching for a matching file with MultiViews</description>
 <syntax>MultiviewsMatch
     <em>[NegotiatedOnly] [Handlers] [Filters] [Any]</em></syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
-<compatibility>only available 
+<compatibility>Available 
     in Apache 2.0.26 and later.</compatibility>
 
 <usage>
 
     <p>MultiviewsMatch permits three different behaviors for
     <a href="mod_negotiation.html">mod_negotiation</a>'s Multiviews 
@@ -599,22 +577,30 @@
     Handler option, if .asis files are associated with the asis-handler.</p>
 
     <p>You may finally allow Any extensions to match, even if mod_mime 
     doesn't recognize the extension.  This was the behavior in Apache 1.3,
     and can cause unpredicatable results, such as serving .old or .bak
     files the webmaster never expected to be served.</p>
+
+    <p>For example, the following configuration will allow handlers
+    and filters to participate in Multviews, but will exclude unknown
+    files:</p>
+<example>
+MultiviewsMatch Handlers Filters
+</example>
+
 </usage>
+<seealso><directive module="core">Options</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>DefaultLanguage</name>
 <description>Sets all files in the given scope to the 
 specified language</description>
 <syntax>DefaultLanguage
     <em>MIME-lang</em></syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
@@ -638,24 +624,27 @@
 
     <p>If no <code>DefaultLanguage</code> directive is in force,
     and a file does not have any language extensions as configured
     by <code>AddLanguage</code>, then that file will be considered
     to have no language attribute.</p>
 
+<example><title>Example</title>
+DeafaultLanguage en
+</example>
+
 </usage>
-<seealso><a href="#multipleext">Files with
-    multiple extensions</a></seealso>
 <seealso><module>mod_negotiation</module></seealso>
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>RemoveCharset</name>
+<description>Removes any character set associations for a set of file
+extensions</description>
 <syntax>RemoveCharset
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>RemoveCharset is
     only available in Apache 2.0.24 and later.</compatibility>
@@ -666,20 +655,26 @@
     This allows <code>.htaccess</code> files in subdirectories to
     undo any associations inherited from parent directories or the
     server config files.</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
+
+<example><title>Example</title>
+RemoveCharset .html .shtml
+</example>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>RemoveEncoding</name>
+<description>Removes any content encoding associations for a set of file
+extensions</description>
 <syntax>RemoveEncoding
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>RemoveEncoding
     is only available in Apache 1.3.13 and later.</compatibility>
@@ -719,15 +714,16 @@
 </usage>
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>RemoveHandler</name>
+<description>Removes any handler associations for a set of file
+extensions</description>
 <syntax>RemoveHandler
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>RemoveHandler is
     only available in Apache 1.3.4 and later.</compatibility>
@@ -763,15 +759,16 @@
 </usage>
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>RemoveInputFilter</name>
+<description>Removes any input filter associations for a set of file
+extensions</description>
 <syntax>RemoveInputFilter
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>RemoveInputFilter is only available in Apache 
 2.0.26 and later.</compatibility>
@@ -783,20 +780,22 @@
     This allows <code>.htaccess</code> files in subdirectories to
     undo any associations inherited from parent directories or the
     server config files.</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>RemoveLanguage</name>
+<description>Removes any language associations for a set of file
+extensions</description>
 <syntax>RemoveLanguage
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default>None</default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <compatibility>RemoveLanguage
     is only available in Apache 2.0.24 and later.</compatibility>
@@ -814,15 +813,16 @@
     be specified with or without a leading dot.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>RemoveOutputFilter</name>
+<description>Removes any output filter associations for a set of file
+extensions</description>
 <syntax>RemoveOutputFilter
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default></default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override></override>
 <compatibility>RemoveOutputFilter is only available in Apache 
@@ -835,21 +835,28 @@
     This allows <code>.htaccess</code> files in subdirectories to
     undo any associations inherited from parent directories or the
     server config files.</p>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
+
+    <example><title>Example</title>
+    RemoveOutputFilter shtml
+    </example>
 </usage>
+
+<seealso><directive module="mod_mime">AddOutputFilter</directive></seealso>
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>RemoveType</name>
+<description>Removes any content type associations for a set of file
+extensions</description>
 <syntax>RemoveType
     <em>extension</em> [<em>extension</em>] ...</syntax>
-<default></default>
 <contextlist>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override></override>
 <compatibility>RemoveType is
@@ -872,14 +879,14 @@
 
     <p>This will remove any special handling of <code>.cgi</code>
     files in the <code>/foo/</code> directory and any beneath it,
     causing the files to be treated as being of the <a
     href="core.html#defaulttype">default type</a>.</p>
 
-    <note><strong>Note:</strong><module>RemoveType</module> directives
-    are processed <em>after</em> any <module>AddType</module>
+    <note><strong>Note:</strong><directive>RemoveType</directive> directives
+    are processed <em>after</em> any <directive>AddType</directive>
     directives, so it is possible they may undo the effects of the
     latter if both occur within the same directory
     configuration.</note>
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
@@ -883,38 +890,57 @@
 
     <p>The <em>extension</em> argument is case-insensitive, and can
     be specified with or without a leading dot.</p>
 </usage>
 </directivesynopsis>
 
-
-
 <directivesynopsis>
 <name>TypesConfig</name>
+<description>The location of the mime.types file</description>
 <syntax>TypesConfig <em>file-path</em></syntax>
 <default>TypesConfig conf/mime.types</default>
 <contextlist>
 <context>server config</context>
 </contextlist>
 
 <usage>
 
-    <p>The TypesConfig directive sets the location of the MIME
-    types configuration file. <em>Filename</em> is relative to the
-    <a href="core.html#serverroot">ServerRoot</a>. This file sets
-    the default list of mappings from filename extensions to
-    content types; changing this file is not recommended. Use the
-    <a href="#addtype">AddType</a> directive instead. The file
-    contains lines in the format of the arguments to an AddType
-    command:</p>
+    <p>The TypesConfig directive sets the location of the MIME types
+    configuration file. <em>Filename</em> is relative to the <a
+    href="core.html#serverroot">ServerRoot</a>. This file sets the
+    default list of mappings from filename extensions to content
+    types. Most administrators use the provided
+    <code>mime.types</code> file, which associates common filename
+    extensions with IANA registered content types. The current list is
+    maintained at
+    <code>http://www.isi.edu/in-notes/iana/assignments/media-types/media-types</code>. This
+    simplifies the <code>httpd.conf</code> file by providing the
+    majority of media-type definitions, and may be overridden by
+    <directive module="mod_mime">AddType</directive> directives as
+    needed.  You should not edit the <code>mime.types</code> file,
+    because it may be replaced when you upgrade your server.</p>
+   
+    <p>The file contains lines in the format of the arguments to
+    an <directive module="mod_mime">AddType</directive> directive:</p>
 
     <example>
       MIME-type extension extension ...
     </example>
 
     <p>
-    The extensions are lower-cased. Blank lines, and lines
+    The case of the extension does not matter. Blank lines, and lines
     beginning with a hash character (`#') are ignored. </p>
+
+    <note>Please do not send requests to the Apache HTTP Server Project
+    to add any new entries in the distributed mime.types file
+    unless (1) they are already registered with IANA, and (2) they
+    use widely accepted, non-conflicting filename extensions across
+    platforms. category/x-subtype requests will be automatically
+    rejected, as will any new two-letter extensions as they will
+    likely conflict later with the already crowded language and
+    character set namespace.</note>
+
 </usage>
+<seealso><module>mod_mime_magic</module></seealso>
 </directivesynopsis>
 </modulesynopsis>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_mmap_static.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_negotiation.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_negotiation.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_negotiation.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_negotiation.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_negotiation.xml	2002-04-23 18:01:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_negotiation.xml	2002-05-30 00:26:43.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_negotiation</name>
 <description>Provides for <a
     href="../content-negotiation.html">content negotiation</a></description>
 <status>Base</status>
@@ -25,18 +25,19 @@
       module="core">Options</directive>, where the server does an
       implicit filename pattern match, and choose from amongst the
       results.</li>
     </ul>
 </summary>
 
-<seealso><directive module="mod_mime">DefaultLangauge</directive></seealso>
+<seealso><directive module="mod_mime">DefaultLanguage</directive></seealso>
 <seealso><directive module="mod_mime">AddEncoding</directive></seealso>
 <seealso><directive module="mod_mime">AddLanguage</directive></seealso>
 <seealso><directive module="mod_mime">AddType</directive></seealso>
+<seealso><directive module="mod_mime">MultiViewsMatch</directive></seealso>
 
-<section><title>Type maps</title>
+<section id="typemaps"><title>Type maps</title>
     <p>A type map has the same format as RFC822 mail headers. It
     contains document descriptions separated by blank lines, with
     lines beginning with a hash character ('#') treated as
     comments. A document description consists of several header
     records; records may be continued on multiple lines if the
     continuation lines start with spaces. The leading space will be
@@ -94,21 +95,44 @@
           file would have a higher source quality than a jpeg file.
           All qs values are therefore specific to a given
           resource.</dd>
         </dl>
         Example: 
 
-        <blockquote>
-          <code>Content-Type: image/jpeg; qs=0.8</code>
-        </blockquote>
+<example>Content-Type: image/jpeg; qs=0.8</example>
       </dd>
 
       <dt>URI:</dt>
 
-      <dd>The path to the file containing this variant, relative to
-      the map file.</dd>
+      <dd>uri of the file containing the variant (of the given
+      media type, encoded with the given content encoding). These
+      are interpreted as URLs relative to the map file; they must
+      be on the same server (!), and they must refer to files to
+      which the client would be granted access if they were to be
+      requested directly.</dd>
+
+      <dt>Body:</dt>
+   
+      <dd><p>New in Apache 2.0, the actual content of the resource may
+      be included in the type-map file using the Body header.  This
+      header must contain a string that designates a delimiter for
+      the body content.  Then all following lines in the type map
+      file will be considered part of the resource body until the
+      delimiter string is found.</p>
+
+      <p>Example:</p>
+<example>
+Body:----xyz----<br />
+&lt;html&gt;<br />
+&lt;body&gt;<br />
+&lt;p&gt;Content of the page.&lt;/p&gt;<br />
+&lt;/body&gt;<br />
+&lt;/html&gt;<br />
+----xyz----
+</example>
+      </dd>
     </dl>
 </section>
 
 <section><title>MultiViews</title>
 
     <p>A MultiViews search is enabled by the MultiViews <directive
@@ -149,17 +173,17 @@
     argument; it was turned on by the presence of the directive by
     itself.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
-<name>ForceLangaugePriority</name>
+<name>ForceLanguagePriority</name>
 <description>Action to take if a single acceptable document is not 
 found</description>
 <syntax>ForceLanguagePriority None|Prefer|Fallback [Prefer|Fallback]</syntax>
-<default>ForceLangaugePriority None</default>
+<default>ForceLanguagePriority Prefer</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
 <override>FileInfo</override>
@@ -186,13 +210,13 @@
 </example>
 
     <p><code>ForceLanguagePriority Fallback</code> uses
     <code>LanguagePriority</code> to serve a valid result, rather than
     returning an HTTP result 406 (NOT ACCEPTABLE).  If the directives
     below were given, and the user's Accept-Language only permitted an
-    es langauge response, but such a variant isn't found, then the
+    es language response, but such a variant isn't found, then the
     first variant from the LanguagePriority list below will be
     served.</p>
 
 <example>
       LanguagePriority en fr de<br />
       ForceLanguagePriority Fallback
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_proxy.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_proxy.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_proxy.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_proxy.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_proxy.xml	2002-03-19 06:30:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_proxy.xml	2002-06-07 10:20:53.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_proxy</name>
 <description>HTTP/1.1 proxy/gateway server</description>
 <status>Extension</status>
 <sourcefile>mod_proxy.c</sourcefile>
@@ -55,12 +55,13 @@
 <li><a href="#percent2fhack">How can I access FTP files outside of my home directory?</a></li>
 <li><a href="#ftppass">How can I hide the FTP cleartext password in my browser's URL line?</a></li>
 <li><a href="#startup">Why does Apache start more slowly when using the
         proxy module?</a></li>
 <!--<li><a href="#socks">Can I use the Apache proxy module with my SOCKS proxy?</a>-->
 <li><a href="#intranet">What other functions are useful for an intranet proxy server?</a></li>
+<li><a href="#envsettings">How can I make the proxy talk HTTP/1.0 and disable keepalives?</a></li>
 </ul>
 
 <section id="forwardreverse"><title>Forward and Reverse Proxies</title>
 
 <p>Apache can be configured in both a <em>forward</em> and <em>reverse</em>
 proxy configuration.</p>
@@ -96,30 +97,24 @@
 enabled using mod_cache as with the forward proxy.</p>
 
 </section>
 
 <section id="access"><title>Controlling access to your proxy</title>
 
-<!-- XXX: This is completely wrong... There is a proxy block
-in 2.0 -->
-
-<p>You can control who can access your proxy via the normal <directive module="core" type="section">Directory</directive>
+<p>You can control who can access your proxy via the 
+<directive module="mod_proxy" type="section">Proxy</directive>
 control block using the following example:</p>
 
 <example>
-&lt;Directory proxy:*&gt;<br />
+&lt;Proxy *&gt;<br />
 Order Deny,Allow<br />
 Deny from all<br />
 Allow from 192.168.0<br />
-&lt;/Directory&gt;
+&lt;/Proxy&gt;
 </example>
 
-<p>A <directive module="core" type="section">Files</directive> block
-will also work, and is the only method known to work for all possible
-URLs in Apache versions earlier than 1.2b10.</p>
-
 <p>When configuring a reverse proxy, access control takes on the
 attributes of the normal server <directive module="core"
 type="section">directory</directive> configuration.</p>
 
 
 <!--<h2><a name="shortname">Using Netscape hostname shortcuts</a></h2>
@@ -258,17 +253,92 @@
 local domain. When the <directive module="mod_proxy">ProxyDomain</directive> directive
 is used and the server is <a href="#proxyrequests">configured for
 proxy service</a>, Apache can return a redirect response and send the client
 to the correct, fully qualified, server address. This is the preferred method
 since the user's bookmark files will then contain fully qualified hosts.</p>
 </section>
+<section id="envsettings"><title>How can I make the proxy talk HTTP/1.0 and 
+disable keepalives?</title>
+
+<p>For circumstances where you have a application server which doesn't implement
+keepalives or HTTP/1.1 properly, there are 2 environment variables which when
+set send a HTTP/1.0 with no keepalive. These are set via the  <directive
+module="mod_env">SetEnv</directive> directive.</p>
+<p>These are the 'force-proxy-request-1.0' and 'proxy-nokeepalive' notes.</p>
+
+<example>
+&lt;location /buggyappserver/ &gt;<br />
+ProxyPass http://buggyappserver:7001/foo/<br />
+SetEnv force-proxy-request-1.0 1<br />
+SetEnv proxy-nokeepalive 1<br />
+&lt;/location&gt;
+</example>
 
 </section>
 
+</section>
+
+<directivesynopsis type="section">
+<name>Proxy</name>
+<syntax>&lt;Proxy <em>wildcard-url</em>&gt; ...&lt;/Proxy&gt;</syntax>
+<description>Container for directives applied to proxied 
+resources</description>
+<contextlist><context>server config</context>
+<context>virtual host</context></contextlist>
+
+<usage>
+<p>Directives placed in <directive type="section">Proxy</directive>
+sections apply only to matching proxied content.  Shell-style
+wildcards are allowed.</p>
+
+<p>For example, the following will allow only hosts in
+<code>yournetwork.example.com</code> to access content via your
+proxy server:</p>
+
+<example>
+&lt;Proxy *&gt;<br />
+&nbsp;&nbsp;Order Deny,Allow<br />
+&nbsp;&nbsp;Deny from all<br />
+&nbsp;&nbsp;Allow from yournetwork.example.com<br />
+&lt;/Proxy&gt;
+</example>
+
+<p>The following example will process all files in the
+<code>foo</code> directory of <code>example.com</code> through the
+<code>INCLUDES</code> filter when they are sent through the proxy
+server:</p>
+<example>
+&lt;Proxy http://example.com/foo/*&gt;<br />
+&nbsp;&nbsp;SetOutputFilter INCLUDES<br />
+&lt;/Proxy&gt;
+</example>
+</usage>
+</directivesynopsis>
+
+
+<directivesynopsis type="section">
+<name>ProxyMatch</name>
+<syntax>&lt;Proxy <em>regex</em>&gt; ...&lt;/Proxy&gt;</syntax>
+<description>Container for directives applied to regular-expression-matched 
+proxied resources</description>
+<contextlist><context>server config</context>
+<context>virtual host</context></contextlist>
+
+<usage>
+<p>The <directive type="section">ProxyMatch</directive> directive is
+identical to the <directive module="mod_proxy"
+type="section">Proxy</directive> directive, except it matches URLs
+using regular expressions.</p>
+</usage>
+</directivesynopsis>
+
+
 <directivesynopsis>
 <name>ProxyPreserveHost</name>
+<description>Use incoming Host HTTP request header for
+proxy request</description>
 <syntax>ProxyPreserveHost on|off</syntax>
 <default>ProxyPreserveHost Off</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 <compatibility>Available in
@@ -282,12 +352,13 @@
 <p>This option should normally be turned 'off'.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyRequests</name>
+<description>Enables forward (standard) proxy requests</description>
 <syntax>ProxyRequests on|off</syntax>
 <default>ProxyRequests Off</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
@@ -306,12 +377,13 @@
 
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyRemote</name>
+<description>Remote proxy used to handle certain requests</description>
 <syntax>ProxyRemote <em>match remote-server</em></syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
 <usage>
@@ -344,26 +416,44 @@
 webserver can be embedded within a virtualhost URL space even if that
 server is hidden by another forward proxy.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
+<name>ProxyRemoteMatch</name>
+<description>Remote proxy used to handle requests
+matched by regular expressions</description>
+<syntax>ProxyRemote <em>regex remote-server</em></syntax>
+<contextlist><context>server config</context>
+<context>virtual host</context>
+</contextlist>
+
+<usage>
+<p>The <directive>ProxyRemoteMatch</directive> is identical
+to the <directive module="mod_proxy">ProxyRemote</directive>
+directive, except the first argument is a regular expression
+match against the requested URL.</p>
+</usage>
+</directivesynopsis>
+
+<directivesynopsis>
 <name>ProxyPass</name>
+<description>Maps remote servers into the local server 
+URL-space</description>
 <syntax>ProxyPass [<em>path</em>] !|<em>url</em></syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
 <usage>
-<!-- XXX: Need to document that the path is not used when placed in
-a location section -->
 <p>This directive allows remote servers to be mapped into the space of
 the local server; the local server does not act as a proxy in the
 conventional sense, but appears to be a mirror of the remote
 server. <em>path</em> is the name of a local virtual path;
-<em>url</em> is a partial URL for the remote server.</p>
+<em>url</em> is a partial URL for the remote server and cannot
+include a query string.</p>
 
 <p>Suppose the local server has address <code>http://wibble.org/</code>; 
 then</p>
 <example>
    ProxyPass /mirror/foo/ http://foo.com/
 </example>
@@ -378,25 +468,36 @@
         ProxyPass /mirror/foo/i !<br />
         ProxyPass /mirror/foo http://foo.com
 </example>
 <p>will proxy all requests to /mirror/foo to foo.com EXCEPT requests made to /mirror/foo/i</p>
 
 <note>NB: order is important. you need to put the exclusions BEFORE the general proxypass directive</note>
+
+<p>When used inside a <directive type="section"
+module="core">Location</directive> section, the first argument is
+ommitted and the local directory is obtained from the <directive
+type="section" module="core">Location</directive>.</p>
+
+<p>If you require a more flexible reverse-proxy configuration, see
+the <directive module="mod_rewrite">RewriteRule</directive> directive
+with the <code>[P]</code> flag.</p>
+
 </usage>
+
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyPassReverse</name>
+<description>Adjusts the URL in HTTP response headers sent from
+a reverse proxied server</description>
 <syntax>ProxyPassReverse [<em>path</em>] <em>url</em></syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
 <usage>
-<!-- XXX: Need to document that the path is not used when placed in
-a location section -->
 <p>This directive lets Apache adjust the URL in the <code>Location</code>,
 <code>Content-Location</code> and <code>URI</code> headers on
 HTTP redirect responses. This is essential when Apache is used as
 a reverse proxy to avoid by-passing the reverse proxy because of HTTP
 redirects on the backend servers which stay behind the reverse proxy.</p>
 
@@ -423,17 +524,25 @@
 Note that this <directive>ProxyPassReverse</directive> directive can
 also be used in conjunction with the proxy pass-through feature
 ("<code>RewriteRule ...  [P]</code>") from
 <module>mod_rewrite</module> because its doesn't depend on a
 corresponding <directive module="mod_proxy">ProxyPass</directive>
 directive.</p>
+
+<p>When used inside a <directive type="section"
+module="core">Location</directive> section, the first argument is
+ommitted and the local directory is obtained from the <directive
+type="section" module="core">Location</directive>.</p>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>AllowCONNECT</name>
+<description>Ports that are allowed to <code>CONNECT</code> through
+the proxy</description>
 <syntax>AllowCONNECT <em>port</em> [<em>port</em>] ...</syntax>
 <default>AllowCONNECT 443 563</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
@@ -448,12 +557,14 @@
 allow connections to the listed ports only.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyBlock</name>
+<description>Words, hosts, or domains that are banned from being
+proxied</description>
 <syntax>ProxyBlock *|<em>word|host|domain</em>
 [<em>word|host|domain</em>] ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
@@ -486,12 +597,14 @@
 
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyReceiveBufferSize</name>
+<description>Network buffer size for outgoing HTTP and FTP 
+connections</description>
 <syntax>ProxyReceiveBufferSize <em>bytes</em></syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
 <usage>
@@ -504,13 +617,29 @@
   ProxyReceiveBufferSize 2048
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
+<name>ProxyIOBufferSize</name>
+<description>IO buffer size for outgoing HTTP and FTP 
+connections</description>
+<syntax>ProxyIOBufferSize <em>bytes</em></syntax>
+<contextlist><context>server config</context>
+<context>virtual host</context>
+</contextlist>
+
+<usage>
+<!-- XXX: content needed -->
+</usage>
+</directivesynopsis>
+
+<directivesynopsis>
 <name>ProxyMaxForwards</name>
+<description>Maximium number of proxies that a request can be forwarded
+through</description>
 <syntax>ProxyMaxForwards <em>number</em></syntax>
 <default>ProxyMaxForwards 10</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 <compatibility>Available in Apache 2.0 and later</compatibility>
@@ -525,12 +654,14 @@
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>NoProxy</name>
+<description>Hosts, domains, or networks that will be connected
+to directly</description>
 <syntax>NoProxy 
  <em>Domain</em>|
  <em>SubNet</em>|
  <em>IpAddr</em>| 
  <em>Hostname</em>
 [<em>Domain</em>| 
@@ -593,13 +724,13 @@
          <dd>the subnet 192.168.0.0 with an implied netmask of 16 valid bits
              (sometimes used in the netmask form <code>255.255.0.0</code>)</dd>
          <dt><code>192.168.112.0/21</code></dt>
          <dd>the subnet <code>192.168.112.0/21</code> with a netmask of 21
              valid bits (also used in the form 255.255.248.0)</dd>
         </dl>
-		As a degenerate case, a <em>SubNet</em> with 32 valid bits is the
+	As a degenerate case, a <em>SubNet</em> with 32 valid bits is the
         equivalent to an <em>IPAddr</em>, while a <em>SubNet</em> with zero
         valid bits (<em>e.g.</em>, 0.0.0.0/0) is the same as the constant
         <em>_Default_</em>, matching any IP address. </dd>
 
     <!-- ===================== IPAddr ======================= -->
     <dt><a name="ipaddr">
@@ -640,12 +771,13 @@
 </usage>
 <seealso><a href="../dns-caveats.html">DNS Issues</a></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyTimeout</name>
+<description>Network timeout for proxied requests</description>
 <syntax>ProxyTimeout <em>seconds</em></syntax>
 <default>ProxyTimeout 300</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 <compatibility>Available in
@@ -659,12 +791,13 @@
 </p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyDomain</name>
+<description>Default domain name for proxied requests</description>
 <syntax>ProxyDomain <em>Domain</em></syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
 <usage>
@@ -682,12 +815,14 @@
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyVia</name>
+<description>Information provided in the <code>Via</code> HTTP response
+header for proxied requests</description>
 <syntax>ProxyVia on|off|full|block</syntax>
 <default>ProxyVia off</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 
@@ -716,12 +851,13 @@
 </ul>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ProxyErrorOverride</name>
+<description>Override error pages for proxied content</description>
 <syntax>ProxyErrorOverride On|Off</syntax>
 <default>ProxyErrorOverride Off</default>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 </contextlist>
 <compatibility>Available in version 2.0 and later</compatibility>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_rewrite.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_rewrite.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_rewrite.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_rewrite.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_rewrite.xml	2002-03-12 23:22:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_rewrite.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_rewrite</name> 
 
 <description>Provides a rule-based rewriting engine to rewrite requested
 URLs on the fly</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_setenvif.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_setenvif.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_setenvif.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_setenvif.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_setenvif.xml	2002-03-07 00:24:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_setenvif.xml	2002-06-14 19:23:41.000000000 +0800
@@ -1,18 +1,17 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_setenvif</name>
 <description>Allows the setting of environment variables based
 on characteristics of the request</description>
 <status>Base</status>
 <sourcefile>mod_setenvif.c</sourcefile>
 <identifier>setenvif_module</identifier>
-<compatibility>Available in Apache 1.3 and later</compatibility>
 
 
 <summary>
 
     <p>The <module>mod_setenvif</module> module allows you to set
     environment variables according to whether different aspects of
@@ -34,78 +33,45 @@
 <seealso><a href="../env.html">Environment Variables in Apache</a></seealso>
 
 <directivesynopsis>
 <name>BrowserMatch</name>
 <description>Sets environment variables conditional on HTTP User-Agent
 </description>
-<syntax>BrowserMatch <em>regex env-variable</em>[=<em>value</em>]
-[<em>env-variable</em>[=<em>value</em>]] ...</syntax>
+<syntax>BrowserMatch <em>regex [!]env-variable</em>[=<em>value</em>]
+[[!]<em>env-variable</em>[=<em>value</em>]] ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
 <override>FileInfo</override>
-<compatibility>Apache 1.2 and
-    above (in Apache 1.2 this directive was found in the
-    now-obsolete mod_browser module)</compatibility>
 
 <usage>
-    <p>The <directive>BrowserMatch</directive> directive defines
-    environment variables based on the <code>User-Agent</code> HTTP
-    request header field.  The first argument should be a POSIX.2
-    extended regular expression (similar to an
-    <code>egrep</code>-style regex). The rest of the arguments give
-    the names of variables to set, and optionally values to which they
-    should be set. These take the form of</p>
-
-    <ol>
-      <li><code><em>varname</em></code>, or</li>
-
-      <li><code>!<em>varname</em></code>, or</li>
-
-      <li><code><em>varname</em>=<em>value</em></code></li>
-    </ol>
-
-    <p>In the first form, the value will be set to "1". The second
-    will remove the given variable if already defined, and the
-    third will set the variable to the value given by
-    <code><em>value</em></code>. If a <code>User-Agent</code>
-    string matches more than one entry, they will be merged.
-    Entries are processed in the order in which they appear, and
-    later entries can override earlier ones.</p>
+  <p>The <directive>BrowserMatch</directive> is a special cases of the
+  <directive module="mod_setenvif">SetEnvIf</directive> directive that
+  sets environment variables conditional on the
+  <code>User-Agent</code> HTTP request header.  The following two
+  lines have the same effect:</p>
+<example>
+   BrowserMatchNoCase Robot is_a_robot<br /> 
+   SetEnvIfNoCase User-Agent Robot is_a_robot<br /> 
+</example>
 
-    <p>For example:</p>
+    <p>Some additional examples:</p>
 <example>
     BrowserMatch ^Mozilla forms jpeg=yes browser=netscape<br />
     BrowserMatch "^Mozilla/[2-3]" tables agif frames javascript<br />
     BrowserMatch MSIE !javascript<br />
 </example>
- 
-    <p>Note that the regular expression string is
-    <strong>case-sensitive</strong>. For case-INsensitive matching,
-    see the <directive
-    module="mod_setenvif">BrowserMatchNoCase</directive>
-    directive.</p>
-
-    <p>The <directive>BrowserMatch</directive> and
-    <directive>BrowserMatchNoCase</directive> directives are special cases of
-    the <directive module="mod_setenvif">SetEnvIf</directive> and <directive
-    module="mod_setenvif">SetEnvIfNoCase</directive>
-    directives. The following two lines have the same effect:</p>
-<example>
-   BrowserMatchNoCase Robot is_a_robot<br />
-   SetEnvIfNoCase User-Agent Robot is_a_robot<br />
-</example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>BrowserMatchNoCase</name>
 <description>Sets environment variables conditional on User-Agent without
 respect to case</description>
-<syntax>BrowserMatchNoCase  <em>regex env-variable</em>[=<em>value</em>]
-    [<em>env-variable</em>[=<em>value</em>]] ...</syntax>
+<syntax>BrowserMatchNoCase  <em>regex [!]env-variable</em>[=<em>value</em>]
+    [[!]<em>env-variable</em>[=<em>value</em>]] ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
 <override>FileInfo</override>
 <compatibility>Apache 1.2 and
     above (in Apache 1.2 this directive was found in the
@@ -137,30 +103,34 @@
 
 <directivesynopsis>
 <name>SetEnvIf</name>
 <description>Sets environment variables based on attributes of the request
 </description>
 <syntax>SetEnvIf <em>attribute
-    regex env-variable</em>[=<em>value</em>]
-    [<em>env-variable</em>[=<em>value</em>]] ...</syntax>
+    regex [!]env-variable</em>[=<em>value</em>]
+    [[!]<em>env-variable</em>[=<em>value</em>]] ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
 <override>FileInfo</override>
-<compatibility>Apache 1.3 and
-    above; the Request_Protocol keyword and environment-variable
-    matching are only available with 1.3.7 and later</compatibility>
 
 <usage>
-    <p>The <directive>SetEnvIf</directive> directive defines environment
-    variables based on attributes of the request. These attributes
-    can be the values of various HTTP request header fields (see <a
+    <p>The <directive>SetEnvIf</directive> directive defines
+    environment variables based on attributes of the request. The
+    <em>attribute</em> specified in the first argument can be one of three
+    things:</p>
+
+<ol>
+<li>An HTTP request header field (see <a
     href="http://www.rfc-editor.org/rfc/rfc2616.txt">RFC2616</a>
-    for more information about these), or of other aspects of the
-    request, including the following:</p>
+    for more information about these); for example: <code>Host</code>,
+    <code>User-Agent</code>, <code>Referer</code>, and 
+    <code>Accept-Language</code>.  A regular expression may be
+    used to specify a set of request headers.</li>
 
+<li>One of the following aspects of the request:
     <ul>
       <li><code>Remote_Host</code> - the hostname (if available) of
       the client making the request</li>
 
       <li><code>Remote_Addr</code> - the IP address of the client
       making the request</li>
@@ -173,40 +143,52 @@
       cetera</em>)</li>
 
       <li><code>Request_Protocol</code> - the name and version of
       the protocol with which the request was made (<em>e.g.</em>,
       "HTTP/0.9", "HTTP/1.1", <em>etc.</em>)</li>
 
-      <li><code>Request_URI</code> - the portion of the URL
-      following the scheme and host portion</li>
+      <li><code>Request_URI</code> - the resource requested on the HTTP
+       request line -- generally the portion of the URL
+      following the scheme and host portion without the query string</li>
     </ul>
+</li>
+
+<li>The name of an environment variable in the list of those
+associated with the request. This allows
+<directive>SetEnvIf</directive> directives to test against the result
+of prior matches. Only those environment variables defined by earlier
+<code>SetEnvIf[NoCase]</code> directives are available for testing in
+this manner. 'Earlier' means that they were defined at a broader scope
+(such as server-wide) or previously in the current directive's scope.
+Environment variables will be considered only if there was no match
+among request characteristics and a regular expression was not
+used for the <em>attribute</em>.</li>
+</ol>
+
+<p>The second argument (<em>regex</em>) is a <a
+href="http://www.pcre.org/">Perl compatible regular expression</a>.
+This is similar to a POSIX.2 egrep-style regular expression.
+If the <em>regex</em> matches against the <em>attribute</em>,
+then the remainder of the arguments are evaluated.</p>
+
+<p>The rest of the arguments give the names of variables to set, and
+optionally values to which they should be set. These take the form
+of</p>
 
-    <p>Some of the more commonly used request header field names
-    include <code>Host</code>, <code>User-Agent</code>, and
-    <code>Referer</code>.</p>
-
-    <p>If the <em>attribute</em> name doesn't match any of the
-    special keywords, nor any of the request's header field names,
-    it is tested as the name of an environment variable in the list
-    of those associated with the request. This allows
-    <directive>SetEnvIf</directive> directives to test against the result of
-    prior matches.</p>
-
-<note>
-      <strong>Only those environment variables defined by earlier
-      <code>SetEnvIf[NoCase]</code> directives are available for
-      testing in this manner. 'Earlier' means that they were
-      defined at a broader scope (such as server-wide) or
-      previously in the current directive's scope.</strong>
-</note>
-
-    <p><em>attribute</em> may be a regular expression when used to
-    match a request header. If <em>attribute</em> is a regular
-    expression and it doesn't match any of the request's header
-    names, then <em>attribute</em> is not tested against the
-    request's environment variable list.</p>
+    <ol>
+      <li><code><em>varname</em></code>, or</li>
+
+      <li><code>!<em>varname</em></code>, or</li>
+
+      <li><code><em>varname</em>=<em>value</em></code></li>
+    </ol>
+
+    <p>In the first form, the value will be set to "1". The second
+    will remove the given variable if already defined, and the
+    third will set the variable to the literal value given by
+    <code><em>value</em></code>.</p>
 
 <example>
 <title>Example:</title>
    SetEnvIf Request_URI "\.gif$" object_is_image=gif<br />
    SetEnvIf Request_URI "\.jpg$" object_is_image=jpg<br />
    SetEnvIf Request_URI "\.xbm$" object_is_image=xbm<br />
@@ -226,20 +208,25 @@
 
     <p>The last example will set environment variable
     <code>HAVE_TS</code> if the request contains any headers that
     begin with "TS" whose values begins with any character in the
     set [a-z].</p>
 </usage>
+
+<seealso><a href="../env.html">Environment Variables in Apache</a>,
+for additional examples.
+</seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SetEnvIfNoCase</name>
 <description>Sets environment variables based on attributes of the request
 without respect to case</description>
-<syntax>SetEnvIfNoCase <em>attribute regex env-variable</em>[=<em>value</em>]
-    [<em>env-variable</em>[=<em>value</em>]] ...</syntax>
+<syntax>SetEnvIfNoCase <em>attribute regex 
+        [!]env-variable</em>[=<em>value</em>]
+    [[!]<em>env-variable</em>[=<em>value</em>]] ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context><context>directory</context>
 <context>.htaccess</context></contextlist>
 <override>FileInfo</override>
 <compatibility>Apache 1.3 and above</compatibility>
 
@@ -257,7 +244,7 @@
     to be set to "<code>apache</code>" if the HTTP request header
     field <code>Host:</code> was included and contained
     <code>Apache.Org</code>, <code>apache.org</code>, or any other
     combination.</p>
 </usage>
 </directivesynopsis>
-</modulesynopsis>
\ No newline at end of file
+</modulesynopsis>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_so.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_so.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_so.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_so.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_so.xml	2002-04-02 11:09:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_so.xml	2002-05-27 08:44:06.000000000 +0800
@@ -1,39 +1,30 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_so</name>
-<description>
- This module provides for loading of executable code and
- modules into the server at start-up or restart time.
-</description>
-<status>Base (Windows>; Optional (Unix)</status>
+<description>Loading of executable code and
+modules into the server at start-up or restart time</description>
+<status>Base (Windows); Optional (Unix)</status>
 <sourcefile>mod_so.c</sourcefile>
 <identifier>so_module</identifier>
-<compatibility>Available in Apache 1.3 and later.</compatibility>
 
 <summary>
 
     <p>On selected operating systems this module can be used to
     load modules into Apache at runtime via the <a
     href="../dso.html">Dynamic Shared Object</a> (DSO) mechanism,
     rather than requiring a recompilation.</p>
 
     <p>On Unix, the loaded code typically comes from shared object
     files (usually with <code>.so</code> extension), on Windows
     this may either the <code>.so</code> or <code>.dll</code>
-    extension. This module is only available in Apache 1.3 and
-    up.</p>
+    extension.</p>
 
-    <p>In previous releases, the functionality of this module was
-    provided for Unix by mod_dld, and for Windows by mod_dll. On
-    Windows, mod_dll was used in beta release 1.3b1 through 1.3b5.
-    mod_so combines these two modules into a single module for all
-    operating systems.</p>
     <note type="warning"><title>Warning</title>
     <p>Apache 1.3 modules cannot be directly used
     with Apache 2.0 - the module must be modified to dynamically
     load or compile into Apache 2.0.</p>
     </note>
 </summary>
@@ -110,13 +102,12 @@
 </section>
 
 <directivesynopsis>
 <name>LoadFile</name>
 <description>Link in the named object file or library</description>
 <syntax>LoadFile <em>filename</em> [<em>filename</em>] ...</syntax>
-<default>none</default>
 <contextlist>
 <context>server config</context>
 </contextlist>
 
 <usage>
 
@@ -135,13 +126,12 @@
 
 <directivesynopsis>
 <name>LoadModule</name>
 <description>Links in the object file or library, and adds to the list
 of active modules</description>
 <syntax>LoadModule <em>module filename</em></syntax>
-<default>none</default>
 <contextlist>
 <context>server config</context>
 </contextlist>
 
 <usage>
     <p>The LoadModule directive links in the object file or library
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_speling.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_speling.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_speling.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_speling.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_speling.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_speling.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_speling</name>
 <description>Attempts to correct mistaken URLs that
 users might have entered by ignoring capitalization and by
 allowing up to one misspelling</description>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_ssl.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_ssl.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_ssl.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_ssl.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_ssl.xml	2002-03-10 12:34:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_ssl.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_ssl</name>
 <description>Strong cryptography using the Secure Sockets
 Layer (SSL) and Transport Layer Security (TLS) protocols</description>
 <status>Extension</status>
@@ -19,77 +19,74 @@
 to provide the cryptography engine.</p>
 
 <p>Further details, discussion, and examples are provided in the
 <a href="../ssl/">SSL documentation</a>.</p>
 </summary>
 
-<section id="ToC25"><title>Environment Variables</title>
+<section><title>Environment Variables</title>
 
 <p>This module provides a lot of SSL information as additional environment
 variables to the SSI and CGI namespace. The generated variables are listed in
 the table below. For backward compatibility the information can
 be made available under different names, too. Look in the <a
 href="../ssl/ssl_compat.html">Compatibility</a> chapter for details on the
 compatibility variables.</p>
 
-<div align="center">
-<a name="table4"></a>
 <table width="600" cellspacing="0" cellpadding="1" border="0" summary="">
-<caption align="bottom" id="sf">SSI/CGI Environment Variables</caption>
+<!-- <caption align="bottom">SSI/CGI Environment Variables</caption> -->
 <tr><td bgcolor="#cccccc">
 <table width="598" cellpadding="5" cellspacing="0" border="0" summary="">
-<tr><td valign="top" align="center" bgcolor="#ffffff">
+<tr><td bgcolor="#ffffff">
 <table border="0" cellspacing="0" cellpadding="2" width="598" summary="">
-<tr id="H">
+<tr>
  <td><strong>Variable Name:</strong></td>
  <td><strong>Value Type:</strong></td>
  <td><strong>Description:</strong></td>
 </tr>
-<tr id="D"><td><code>HTTPS</code></td>                         <td>flag</td>      <td>HTTPS is being used.</td></tr>
-<tr id="H"><td><code>SSL_PROTOCOL</code></td>                  <td>string</td>    <td>The SSL protocol version (SSLv2, SSLv3, TLSv1)</td></tr>
-<tr id="H"><td><code>SSL_SESSION_ID</code></td>                <td>string</td>    <td>The hex-encoded SSL session id</td></tr>
-<tr id="D"><td><code>SSL_CIPHER</code></td>                    <td>string</td>    <td>The cipher specification name</td></tr>
-<tr id="D"><td><code>SSL_CIPHER_EXPORT</code></td>             <td>string</td>    <td><code>true</code> if cipher is an export cipher</td></tr>
-<tr id="H"><td><code>SSL_CIPHER_USEKEYSIZE</code></td>         <td>number</td>    <td>Number of cipher bits (actually used)</td></tr>
-<tr id="D"><td><code>SSL_CIPHER_ALGKEYSIZE</code></td>         <td>number</td>    <td>Number of cipher bits (possible)</td></tr>
-<tr id="H"><td><code>SSL_VERSION_INTERFACE</code></td>         <td>string</td>    <td>The mod_ssl program version</td></tr>
-<tr id="D"><td><code>SSL_VERSION_LIBRARY</code></td>           <td>string</td>    <td>The OpenSSL program version</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_M_VERSION</code></td>          <td>string</td>    <td>The version of the client certificate</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_M_SERIAL</code></td>           <td>string</td>    <td>The serial of the client certificate</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_S_DN</code></td>               <td>string</td>    <td>Subject DN in client's certificate</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_S_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of client's Subject DN</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_I_DN</code></td>               <td>string</td>    <td>Issuer DN of client's certificate</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_I_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of client's Issuer DN</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_V_START</code></td>            <td>string</td>    <td>Validity of client's certificate (start time)</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_V_END</code></td>              <td>string</td>    <td>Validity of client's certificate (end time)</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_A_SIG</code></td>              <td>string</td>    <td>Algorithm used for the signature of client's certificate</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_A_KEY</code></td>              <td>string</td>    <td>Algorithm used for the public key of client's certificate</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_CERT</code></td>               <td>string</td>    <td>PEM-encoded client certificate</td></tr>
-<tr id="D"><td><code>SSL_CLIENT_CERT_CHAIN</code><em>n</em></td> <td>string</td>    <td>PEM-encoded certificates in client certificate chain</td></tr>
-<tr id="H"><td><code>SSL_CLIENT_VERIFY</code></td>             <td>string</td>    <td><code>NONE</code>, <code>SUCCESS</code>, <code>GENEROUS</code> or <code>FAILED:</code><em>reason</em></td></tr>
-<tr id="D"><td><code>SSL_SERVER_M_VERSION</code></td>          <td>string</td>    <td>The version of the server certificate</td></tr>
-<tr id="H"><td><code>SSL_SERVER_M_SERIAL</code></td>           <td>string</td>    <td>The serial of the server certificate</td></tr>
-<tr id="D"><td><code>SSL_SERVER_S_DN</code></td>               <td>string</td>    <td>Subject DN in server's certificate</td></tr>
-<tr id="H"><td><code>SSL_SERVER_S_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of server's Subject DN</td></tr>
-<tr id="D"><td><code>SSL_SERVER_I_DN</code></td>               <td>string</td>    <td>Issuer DN of server's certificate</td></tr>
-<tr id="H"><td><code>SSL_SERVER_I_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of server's Issuer DN</td></tr>
-<tr id="D"><td><code>SSL_SERVER_V_START</code></td>            <td>string</td>    <td>Validity of server's certificate (start time)</td></tr>
-<tr id="H"><td><code>SSL_SERVER_V_END</code></td>              <td>string</td>    <td>Validity of server's certificate (end time)</td></tr>
-<tr id="D"><td><code>SSL_SERVER_A_SIG</code></td>              <td>string</td>    <td>Algorithm used for the signature of server's certificate</td></tr>
-<tr id="H"><td><code>SSL_SERVER_A_KEY</code></td>              <td>string</td>    <td>Algorithm used for the public key of server's certificate</td></tr>
-<tr id="D"><td><code>SSL_SERVER_CERT</code></td>               <td>string</td>    <td>PEM-encoded server certificate</td></tr>
+<tr><td><code>HTTPS</code></td>                         <td>flag</td>      <td>HTTPS is being used.</td></tr>
+<tr><td><code>SSL_PROTOCOL</code></td>                  <td>string</td>    <td>The SSL protocol version (SSLv2, SSLv3, TLSv1)</td></tr>
+<tr><td><code>SSL_SESSION_ID</code></td>                <td>string</td>    <td>The hex-encoded SSL session id</td></tr>
+<tr><td><code>SSL_CIPHER</code></td>                    <td>string</td>    <td>The cipher specification name</td></tr>
+<tr><td><code>SSL_CIPHER_EXPORT</code></td>             <td>string</td>    <td><code>true</code> if cipher is an export cipher</td></tr>
+<tr><td><code>SSL_CIPHER_USEKEYSIZE</code></td>         <td>number</td>    <td>Number of cipher bits (actually used)</td></tr>
+<tr><td><code>SSL_CIPHER_ALGKEYSIZE</code></td>         <td>number</td>    <td>Number of cipher bits (possible)</td></tr>
+<tr><td><code>SSL_VERSION_INTERFACE</code></td>         <td>string</td>    <td>The mod_ssl program version</td></tr>
+<tr><td><code>SSL_VERSION_LIBRARY</code></td>           <td>string</td>    <td>The OpenSSL program version</td></tr>
+<tr><td><code>SSL_CLIENT_M_VERSION</code></td>          <td>string</td>    <td>The version of the client certificate</td></tr>
+<tr><td><code>SSL_CLIENT_M_SERIAL</code></td>           <td>string</td>    <td>The serial of the client certificate</td></tr>
+<tr><td><code>SSL_CLIENT_S_DN</code></td>               <td>string</td>    <td>Subject DN in client's certificate</td></tr>
+<tr><td><code>SSL_CLIENT_S_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of client's Subject DN</td></tr>
+<tr><td><code>SSL_CLIENT_I_DN</code></td>               <td>string</td>    <td>Issuer DN of client's certificate</td></tr>
+<tr><td><code>SSL_CLIENT_I_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of client's Issuer DN</td></tr>
+<tr><td><code>SSL_CLIENT_V_START</code></td>            <td>string</td>    <td>Validity of client's certificate (start time)</td></tr>
+<tr><td><code>SSL_CLIENT_V_END</code></td>              <td>string</td>    <td>Validity of client's certificate (end time)</td></tr>
+<tr><td><code>SSL_CLIENT_A_SIG</code></td>              <td>string</td>    <td>Algorithm used for the signature of client's certificate</td></tr>
+<tr><td><code>SSL_CLIENT_A_KEY</code></td>              <td>string</td>    <td>Algorithm used for the public key of client's certificate</td></tr>
+<tr><td><code>SSL_CLIENT_CERT</code></td>               <td>string</td>    <td>PEM-encoded client certificate</td></tr>
+<tr><td><code>SSL_CLIENT_CERT_CHAIN</code><em>n</em></td> <td>string</td>    <td>PEM-encoded certificates in client certificate chain</td></tr>
+<tr><td><code>SSL_CLIENT_VERIFY</code></td>             <td>string</td>    <td><code>NONE</code>, <code>SUCCESS</code>, <code>GENEROUS</code> or <code>FAILED:</code><em>reason</em></td></tr>
+<tr><td><code>SSL_SERVER_M_VERSION</code></td>          <td>string</td>    <td>The version of the server certificate</td></tr>
+<tr><td><code>SSL_SERVER_M_SERIAL</code></td>           <td>string</td>    <td>The serial of the server certificate</td></tr>
+<tr><td><code>SSL_SERVER_S_DN</code></td>               <td>string</td>    <td>Subject DN in server's certificate</td></tr>
+<tr><td><code>SSL_SERVER_S_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of server's Subject DN</td></tr>
+<tr><td><code>SSL_SERVER_I_DN</code></td>               <td>string</td>    <td>Issuer DN of server's certificate</td></tr>
+<tr><td><code>SSL_SERVER_I_DN_</code><em>x509</em></td> <td>string</td>    <td>Component of server's Issuer DN</td></tr>
+<tr><td><code>SSL_SERVER_V_START</code></td>            <td>string</td>    <td>Validity of server's certificate (start time)</td></tr>
+<tr><td><code>SSL_SERVER_V_END</code></td>              <td>string</td>    <td>Validity of server's certificate (end time)</td></tr>
+<tr><td><code>SSL_SERVER_A_SIG</code></td>              <td>string</td>    <td>Algorithm used for the signature of server's certificate</td></tr>
+<tr><td><code>SSL_SERVER_A_KEY</code></td>              <td>string</td>    <td>Algorithm used for the public key of server's certificate</td></tr>
+<tr><td><code>SSL_SERVER_CERT</code></td>               <td>string</td>    <td>PEM-encoded server certificate</td></tr>
 </table>
 [ where <em>x509</em> is a component of a X.509 DN:
   <code>C,ST,L,O,OU,CN,T,I,G,S,D,UID,Email</code> ]
 </td>
 </tr></table>
 </td></tr></table>
-</div>
 </section>
 
-<section id="ToC26"><title>Custom Log Formats</title>
+<section><title>Custom Log Formats</title>
 
 <p>When <module>mod_ssl</module> is built into Apache or at least
 loaded (under DSO situation) additional functions exist for the <a
 href="../mod_log_config.html#formats">Custom Log Format</a> of 
 <module>mod_log_config</module>. First there is an
 additional ``<code>%{</code><em>varname</em><code>}x</code>''
@@ -506,63 +503,60 @@
 <p>An SSL cipher can also be an export cipher and is either a SSLv2 or SSLv3/TLSv1
 cipher (here TLSv1 is equivalent to SSLv3). To specify which ciphers to use,
 one can either specify all the Ciphers, one at a time, or use aliases to
 specify the preference and order for the ciphers (see <a href="#table1">Table
 1</a>).</p>
 
-<div align="center">
-<a name="table1"></a>
 <table width="600" cellspacing="0" cellpadding="1" border="0" summary="">
-<caption align="bottom" id="sf">Table 1: OpenSSL Cipher Specification Tags</caption>
+<!-- <caption align="bottom">Table 1: OpenSSL Cipher Specification Tags</caption> -->
 <tr><td bgcolor="#cccccc">
 <table width="598" cellpadding="5" cellspacing="0" border="0" summary="">
-<tr><td valign="top" align="center" bgcolor="#ffffff">
+<tr><td bgcolor="#ffffff">
 <table border="0" cellspacing="0" cellpadding="2" width="598" summary="">
-<tr id="D"><td><strong>Tag</strong></td> <td><strong>Description</strong></td></tr>
-<tr id="H"><td colspan="2"><em>Key Exchange Algorithm:</em></td></tr>
-<tr id="D"><td><code>kRSA</code></td>   <td>RSA key exchange</td></tr>
-<tr id="H"><td><code>kDHr</code></td>   <td>Diffie-Hellman key exchange with RSA key</td></tr>
-<tr id="D"><td><code>kDHd</code></td>   <td>Diffie-Hellman key exchange with DSA key</td></tr>
-<tr id="H"><td><code>kEDH</code></td>   <td>Ephemeral (temp.key) Diffie-Hellman key exchange (no cert)</td>   </tr>
-<tr id="H"><td colspan="2"><em>Authentication Algorithm:</em></td></tr>
-<tr id="D"><td><code>aNULL</code></td>  <td>No authentication</td></tr>
-<tr id="H"><td><code>aRSA</code></td>   <td>RSA authentication</td></tr>
-<tr id="D"><td><code>aDSS</code></td>   <td>DSS authentication</td> </tr>
-<tr id="H"><td><code>aDH</code></td>    <td>Diffie-Hellman authentication</td></tr>
-<tr id="D"><td colspan="2"><em>Cipher Encoding Algorithm:</em></td></tr>
-<tr id="H"><td><code>eNULL</code></td>  <td>No encoding</td>         </tr>
-<tr id="D"><td><code>DES</code></td>    <td>DES encoding</td>        </tr>
-<tr id="H"><td><code>3DES</code></td>   <td>Triple-DES encoding</td> </tr>
-<tr id="D"><td><code>RC4</code></td>    <td>RC4 encoding</td>       </tr>
-<tr id="H"><td><code>RC2</code></td>    <td>RC2 encoding</td>       </tr>
-<tr id="D"><td><code>IDEA</code></td>   <td>IDEA encoding</td>       </tr>
-<tr id="H"><td colspan="2"><em>MAC Digest Algorithm</em>:</td></tr>
-<tr id="D"><td><code>MD5</code></td>    <td>MD5 hash function</td></tr>
-<tr id="H"><td><code>SHA1</code></td>   <td>SHA1 hash function</td></tr>
-<tr id="D"><td><code>SHA</code></td>    <td>SHA hash function</td> </tr>
-<tr id="H"><td colspan="2"><em>Aliases:</em></td></tr>
-<tr id="D"><td><code>SSLv2</code></td>  <td>all SSL version 2.0 ciphers</td></tr>
-<tr id="H"><td><code>SSLv3</code></td>  <td>all SSL version 3.0 ciphers</td> </tr>
-<tr id="D"><td><code>TLSv1</code></td>  <td>all TLS version 1.0 ciphers</td> </tr>
-<tr id="H"><td><code>EXP</code></td>    <td>all export ciphers</td>  </tr>
-<tr id="D"><td><code>EXPORT40</code></td> <td>all 40-bit export ciphers only</td>  </tr>
-<tr id="H"><td><code>EXPORT56</code></td> <td>all 56-bit export ciphers only</td>  </tr>
-<tr id="D"><td><code>LOW</code></td>    <td>all low strength ciphers (no export, single DES)</td></tr>
-<tr id="H"><td><code>MEDIUM</code></td> <td>all ciphers with 128 bit encryption</td> </tr>
-<tr id="D"><td><code>HIGH</code></td>   <td>all ciphers using Triple-DES</td>     </tr>
-<tr id="H"><td><code>RSA</code></td>    <td>all ciphers using RSA key exchange</td> </tr>
-<tr id="D"><td><code>DH</code></td>     <td>all ciphers using Diffie-Hellman key exchange</td> </tr>
-<tr id="H"><td><code>EDH</code></td>    <td>all ciphers using Ephemeral Diffie-Hellman key exchange</td> </tr>
-<tr id="D"><td><code>ADH</code></td>    <td>all ciphers using Anonymous Diffie-Hellman key exchange</td> </tr>
-<tr id="H"><td><code>DSS</code></td>    <td>all ciphers using DSS authentication</td> </tr>
-<tr id="D"><td><code>NULL</code></td>   <td>all ciphers using no encryption</td> </tr>
+<tr><td><strong>Tag</strong></td> <td><strong>Description</strong></td></tr>
+<tr><td colspan="2"><em>Key Exchange Algorithm:</em></td></tr>
+<tr><td><code>kRSA</code></td>   <td>RSA key exchange</td></tr>
+<tr><td><code>kDHr</code></td>   <td>Diffie-Hellman key exchange with RSA key</td></tr>
+<tr><td><code>kDHd</code></td>   <td>Diffie-Hellman key exchange with DSA key</td></tr>
+<tr><td><code>kEDH</code></td>   <td>Ephemeral (temp.key) Diffie-Hellman key exchange (no cert)</td>   </tr>
+<tr><td colspan="2"><em>Authentication Algorithm:</em></td></tr>
+<tr><td><code>aNULL</code></td>  <td>No authentication</td></tr>
+<tr><td><code>aRSA</code></td>   <td>RSA authentication</td></tr>
+<tr><td><code>aDSS</code></td>   <td>DSS authentication</td> </tr>
+<tr><td><code>aDH</code></td>    <td>Diffie-Hellman authentication</td></tr>
+<tr><td colspan="2"><em>Cipher Encoding Algorithm:</em></td></tr>
+<tr><td><code>eNULL</code></td>  <td>No encoding</td>         </tr>
+<tr><td><code>DES</code></td>    <td>DES encoding</td>        </tr>
+<tr><td><code>3DES</code></td>   <td>Triple-DES encoding</td> </tr>
+<tr><td><code>RC4</code></td>    <td>RC4 encoding</td>       </tr>
+<tr><td><code>RC2</code></td>    <td>RC2 encoding</td>       </tr>
+<tr><td><code>IDEA</code></td>   <td>IDEA encoding</td>       </tr>
+<tr><td colspan="2"><em>MAC Digest Algorithm</em>:</td></tr>
+<tr><td><code>MD5</code></td>    <td>MD5 hash function</td></tr>
+<tr><td><code>SHA1</code></td>   <td>SHA1 hash function</td></tr>
+<tr><td><code>SHA</code></td>    <td>SHA hash function</td> </tr>
+<tr><td colspan="2"><em>Aliases:</em></td></tr>
+<tr><td><code>SSLv2</code></td>  <td>all SSL version 2.0 ciphers</td></tr>
+<tr><td><code>SSLv3</code></td>  <td>all SSL version 3.0 ciphers</td> </tr>
+<tr><td><code>TLSv1</code></td>  <td>all TLS version 1.0 ciphers</td> </tr>
+<tr><td><code>EXP</code></td>    <td>all export ciphers</td>  </tr>
+<tr><td><code>EXPORT40</code></td> <td>all 40-bit export ciphers only</td>  </tr>
+<tr><td><code>EXPORT56</code></td> <td>all 56-bit export ciphers only</td>  </tr>
+<tr><td><code>LOW</code></td>    <td>all low strength ciphers (no export, single DES)</td></tr>
+<tr><td><code>MEDIUM</code></td> <td>all ciphers with 128 bit encryption</td> </tr>
+<tr><td><code>HIGH</code></td>   <td>all ciphers using Triple-DES</td>     </tr>
+<tr><td><code>RSA</code></td>    <td>all ciphers using RSA key exchange</td> </tr>
+<tr><td><code>DH</code></td>     <td>all ciphers using Diffie-Hellman key exchange</td> </tr>
+<tr><td><code>EDH</code></td>    <td>all ciphers using Ephemeral Diffie-Hellman key exchange</td> </tr>
+<tr><td><code>ADH</code></td>    <td>all ciphers using Anonymous Diffie-Hellman key exchange</td> </tr>
+<tr><td><code>DSS</code></td>    <td>all ciphers using DSS authentication</td> </tr>
+<tr><td><code>NULL</code></td>   <td>all ciphers using no encryption</td> </tr>
 </table>
 </td>
 </tr></table>
 </td></tr></table>
-</div>
 <p>
 Now where this becomes interesting is that these can be put together
 to specify the order and ciphers you wish to use. To speed this up
 there are also aliases (<code>SSLv2, SSLv3, TLSv1, EXP, LOW, MEDIUM,
 HIGH</code>) for certain groups of ciphers. These tags can be joined
 together with prefixes to form the <em>cipher-spec</em>. Available
@@ -596,57 +590,54 @@
 </example>
 <p>The complete list of particular RSA &amp; DH ciphers for SSL is given in <a
 href="#table2">Table 2</a>.</p>
 <example><title>Example</title>
 SSLCipherSuite RSA:!EXP:!NULL:+HIGH:+MEDIUM:-LOW
 </example>
-<div align="center">
-<a name="table2"></a>
 <table width="600" cellspacing="0" cellpadding="1" border="0" summary="">
-<caption align="bottom" id="sf">Table 2: Particular SSL Ciphers</caption>
+<!-- <caption align="bottom">Table 2: Particular SSL Ciphers</caption> -->
 <tr><td bgcolor="#cccccc">
 <table width="598" cellpadding="5" cellspacing="0" border="0" summary="">
-<tr><td valign="top" align="center" bgcolor="#ffffff">
+<tr><td bgcolor="#ffffff">
 <table border="0" cellspacing="0" cellpadding="2" width="598" summary="">
-<tr id="D"><td><strong>Cipher-Tag</strong></td> <td><strong>Protocol</strong></td> <td><strong>Key Ex.</strong></td> <td><strong>Auth.</strong></td> <td><strong>Enc.</strong></td> <td><strong>MAC</strong></td> <td><strong>Type</strong></td> </tr>
-<tr id="H"><td colspan="7"><em>RSA Ciphers:</em></td></tr>
-<tr id="D"><td><code>DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>DES-CBC3-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>3DES(168)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td><code>IDEA-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>IDEA(128)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>RC4-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="D"><td><code>RC4-MD5</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="H"><td><code>IDEA-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>IDEA(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td><code>RC2-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC2(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="H"><td><code>RC4-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td><code>DES-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>RC4-64-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC4(64)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td><code>DES-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>DES(56)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="H"><td><code>EXP-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
-<tr id="D"><td><code>EXP-RC2-CBC-MD5</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>RC2(40)</td> <td>MD5</td> <td>  export</td> </tr>
-<tr id="H"><td><code>EXP-RC4-MD5</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
-<tr id="D"><td><code>EXP-RC2-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA(512)</td> <td>RSA</td> <td>RC2(40)</td> <td>MD5</td> <td>  export</td> </tr>
-<tr id="H"><td><code>EXP-RC4-MD5</code></td> <td>SSLv2</td> <td>RSA(512)</td> <td>RSA</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
-<tr id="D"><td><code>NULL-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>None</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>NULL-MD5</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>None</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td colspan="7"><em>Diffie-Hellman Ciphers:</em></td></tr>
-<tr id="H"><td><code>ADH-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="D"><td><code>ADH-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>ADH-RC4-MD5</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
-<tr id="D"><td><code>EDH-RSA-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>RSA</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>EDH-DSS-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>DSS</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="D"><td><code>EDH-RSA-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>RSA</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="H"><td><code>EDH-DSS-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>DSS</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
-<tr id="D"><td><code>EXP-EDH-RSA-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>RSA</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
-<tr id="H"><td><code>EXP-EDH-DSS-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>DSS</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
-<tr id="D"><td><code>EXP-ADH-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>None</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
-<tr id="H"><td><code>EXP-ADH-RC4-MD5</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>None</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
+<tr><td><strong>Cipher-Tag</strong></td> <td><strong>Protocol</strong></td> <td><strong>Key Ex.</strong></td> <td><strong>Auth.</strong></td> <td><strong>Enc.</strong></td> <td><strong>MAC</strong></td> <td><strong>Type</strong></td> </tr>
+<tr><td colspan="7"><em>RSA Ciphers:</em></td></tr>
+<tr><td><code>DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>DES-CBC3-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>3DES(168)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>IDEA-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>IDEA(128)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>RC4-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>RC4-MD5</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>IDEA-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>IDEA(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>RC2-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC2(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>RC4-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>DES-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>RC4-64-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>RC4(64)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>DES-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA</td> <td>RSA</td> <td>DES(56)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>EXP-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
+<tr><td><code>EXP-RC2-CBC-MD5</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>RC2(40)</td> <td>MD5</td> <td>  export</td> </tr>
+<tr><td><code>EXP-RC4-MD5</code></td> <td>SSLv3</td> <td>RSA(512)</td> <td>RSA</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
+<tr><td><code>EXP-RC2-CBC-MD5</code></td> <td>SSLv2</td> <td>RSA(512)</td> <td>RSA</td> <td>RC2(40)</td> <td>MD5</td> <td>  export</td> </tr>
+<tr><td><code>EXP-RC4-MD5</code></td> <td>SSLv2</td> <td>RSA(512)</td> <td>RSA</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
+<tr><td><code>NULL-SHA</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>None</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>NULL-MD5</code></td> <td>SSLv3</td> <td>RSA</td> <td>RSA</td> <td>None</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td colspan="7"><em>Diffie-Hellman Ciphers:</em></td></tr>
+<tr><td><code>ADH-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>ADH-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>ADH-RC4-MD5</code></td> <td>SSLv3</td> <td>DH</td> <td>None</td> <td>RC4(128)</td> <td>MD5</td> <td>&nbsp; </td> </tr>
+<tr><td><code>EDH-RSA-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>RSA</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>EDH-DSS-DES-CBC3-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>DSS</td> <td>3DES(168)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>EDH-RSA-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>RSA</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>EDH-DSS-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH</td> <td>DSS</td> <td>DES(56)</td> <td>SHA1</td> <td>&nbsp;</td> </tr>
+<tr><td><code>EXP-EDH-RSA-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>RSA</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
+<tr><td><code>EXP-EDH-DSS-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>DSS</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
+<tr><td><code>EXP-ADH-DES-CBC-SHA</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>None</td> <td>DES(40)</td> <td>SHA1</td> <td> export</td> </tr>
+<tr><td><code>EXP-ADH-RC4-MD5</code></td> <td>SSLv3</td> <td>DH(512)</td> <td>None</td> <td>RC4(40)</td> <td>MD5</td> <td>  export</td> </tr>
 </table>
 </td>
 </tr></table>
 </td></tr></table>
-</div>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>SSLCertificateFile</name>
 <description>Server PEM-encoded X.509 Certificate file</description>
@@ -908,84 +899,12 @@
 SSLVerifyDepth 10
 </example>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
-<name>SSLLog</name>
-<description>Where to write the dedicated SSL engine logfile</description>
-<syntax>SSLLog <em>file-path</em></syntax>
-<contextlist><context>server config</context>
-<context>virtual host</context></contextlist>
-
-<usage>
-<p>
-This directive sets the name of the dedicated SSL protocol engine logfile.
-Error type messages are additionally duplicated to the general Apache error
-log file (directive <code>ErrorLog</code>). Put this somewhere where it cannot
-be used for symlink attacks on a real server (i.e. somewhere where only root
-can write). If the <em>file-path</em> does not begin with a slash
-('<code>/</code>') then it is assumed to be relative to the <em>Server
-Root</em>. If <em>file-path</em> begins with a bar ('<code>|</code>') then the
-following string is assumed to be a path to an executable program to which a
-reliable pipe can be established. The directive should occur only once per
-virtual server config.</p>
-<example><title>Example</title>
-SSLLog /usr/local/apache/logs/ssl_engine_log
-</example>
-</usage>
-</directivesynopsis>
-
-<directivesynopsis>
-<name>SSLLogLevel</name>
-<description>Logging level for the dedicated SSL engine 
-logfile</description>
-<syntax>SSLLogLevel <em>level</em></syntax>
-<default>SSLLogLevel none</default>
-<contextlist><context>server config</context>
-<context>virtual host</context></contextlist>
-
-<usage>
-<p>
-This directive sets the verbosity degree of the dedicated SSL protocol engine
-logfile. The <em>level</em> is one of the following (in ascending order where
-higher levels include lower levels):</p>
-<ul>
-<li><code>none</code><br />
-    no dedicated SSL logging is done, but messages of level
-    ``<code>error</code>'' are still written to the general Apache error
-    logfile.
-</li>
-<li><code>error</code><br />
-    log messages of error type only, i.e. messages which show fatal situations
-    (processing is stopped). Those messages are also duplicated to the
-    general Apache error logfile.
-</li>
-<li><code>warn</code><br />
-    log also warning messages, i.e. messages which show non-fatal problems
-    (processing is continued).
-</li>
-<li><code>info</code><br />
-    log also informational messages, i.e. messages which show major
-    processing steps.
-</li>
-<li><code>trace</code><br />
-    log also trace messages, i.e. messages which show minor processing steps.
-</li>
-<li><code>debug</code><br />
-    log also debugging messages, i.e. messages which show development and
-    low-level I/O information.
-</li>
-</ul>
-<example><title>Example</title>
-SSLLogLevel warn
-</example>
-</usage>
-</directivesynopsis>
-
-<directivesynopsis>
 <name>SSLOptions</name>
 <description>Configure various SSL engine run-time options</description>
 <syntax>SSLOptions [+|-]<em>option</em> ...</syntax>
 <contextlist><context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
@@ -1178,19 +1097,17 @@
             and %{SSL_CLIENT_S_DN_O} eq "Snake Oil, Ltd." \<br />
             and %{SSL_CLIENT_S_DN_OU} in {"Staff", "CA", "Dev"} \<br />
             and %{TIME_WDAY} &gt;= 1 and %{TIME_WDAY} &lt;= 5 \<br />
             and %{TIME_HOUR} &gt;= 8 and %{TIME_HOUR} &lt;= 20       ) \<br />
            or %{REMOTE_ADDR} =~ m/^192\.76\.162\.[0-9]+$/
 </example>
-<div align="center">
-<a name="table3"></a>
 <table width="600" cellspacing="0" cellpadding="1" border="0" summary="">
-<caption align="bottom" id="sf">Table 3: Available Variables for SSLRequire</caption>
+<!-- <caption align="bottom">Table 3: Available Variables for SSLRequire</caption> -->
 <tr><td bgcolor="#cccccc">
 <table width="598" cellpadding="5" cellspacing="0" border="0" summary="">
-<tr><td valign="top" align="center" bgcolor="#ffffff">
+<tr><td bgcolor="#ffffff">
 <table summary=""><tr><td>
 <em>Standard CGI/1.0 and Apache variables:</em>
 <pre>
 HTTP_USER_AGENT        PATH_INFO             AUTH_TYPE
 HTTP_REFERER           QUERY_STRING          SERVER_SOFTWARE
 HTTP_COOKIE            REMOTE_HOST           API_VERSION
@@ -1246,11 +1163,10 @@
                        SSL_CLIENT_VERIFY
 </pre>
 </td></tr></table>
 </td>
 </tr></table>
 </td></tr></table>
-</div>
 </usage>
 </directivesynopsis>
 
 </modulesynopsis>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_status.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_status.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_status.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_status.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_status.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_status.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_status</name>
 <description>Provides information on server activity and
 performance</description>
 <status>Base</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_suexec.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_suexec.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_suexec.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_suexec.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_suexec.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_suexec.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_suexec.xml	2002-06-15 10:36:57.000000000 +0800
@@ -1,41 +1,49 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_suexec</name>
 <description>Allows CGI scripts to run as a specified user
 and Group</description>
 <status>Extension</status>
 <sourcefile>mod_suexec.c</sourcefile>
 <identifier>suexec_module</identifier>
 <compatibility>Available in Apache 2.0 and later</compatibility>
 
 
 <summary>
-    <p>This module allows CGI scripts to run as a specified user
-    and Group.</p>
+    <p>This module, in combination with the <a
+    href="../programs/suexec.html">suexec support program</a> allows
+    CGI scripts to run as a specified user and Group.</p>
 </summary>
 
+<seealso><a href="../suexec.html">SuEXEC support</a></seealso>
 
 <directivesynopsis>
 
 <name>SuexecUserGroup</name>
+<description>User and group permissions for CGI programs</description>
 <syntax>SuexecUserGroup <em>User Group</em></syntax>
-<default>None</default>
 <contextlist><context>server config</context>
 <context>virtual host</context></contextlist>
 <compatibility>SuexecUserGroup is only available in 2.0 and
 later.</compatibility>
 
 <usage>
-    <p>The <directive>SuexecUserGroup</directive> directive allows you to
-    specify a user and group for CGI programs to run as. Non-CGI
-    requests are still processes with the user specified in the
-    User directive. This directive replaces using the User and
-    Group directives inside of VirtualHosts.</p>
+    <p>The <directive>SuexecUserGroup</directive> directive allows you
+    to specify a user and group for CGI programs to run as. Non-CGI
+    requests are still processes with the user specified in the User
+    directive. This directive replaces the Apache 1.3 configuration of
+    using the User and Group directives inside of VirtualHosts.</p>
+
+    <example>
+    <title>Example</title>
+    SuexecUserGroup nobody nogroup
+    </example>
+
 </usage>
 
 </directivesynopsis>
 </modulesynopsis>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_suexec.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_TEMPLATE.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_unique_id.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_unique_id.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_unique_id.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_unique_id.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_unique_id.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_unique_id.xml	2002-05-23 22:50:11.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_unique_id</name>
 <description>Provides an environment variable with a unique
 identifier for each request</description>
 <status>Extension</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_userdir.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_userdir.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_userdir.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_userdir.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_userdir.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_userdir.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_userdir.xml	2002-05-27 06:08:58.000000000 +0800
@@ -1,38 +1,33 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_userdir</name>
-<description>Provides for user-specific
-directories</description>
+<description>User-specific directories</description>
 <status>Base</status>
 <sourcefile>mod_userdir.c</sourcefile>
 <identifier>userdir_module</identifier>
 
 <summary>
+This module allows user-specific directories to be accessed using the
+<code>http://example.com/~user/</code> syntax.
 </summary>
 
+<seealso><a href="../urlmapping.html">Mapping URLs to the
+Filesystem</a></seealso>
 
 <directivesynopsis>
 
 <name>UserDir</name>
-<description>Sets the directory from which to serve files when requests
-for a particular user are received, denoted by requests containing
-<em>~username</em>, such as 
-<em>http://server.example.com/~bob/</em></description>
+<description>Location of the user-specific directories</description>
 <syntax>UserDir <em>directory-filename</em></syntax>
 <default>UserDir public_html</default>
 <contextlist><context>server config</context> <context>virtual
 host</context></contextlist>
-<compatibility>All forms except the <code>UserDir public_html</code>
-form are only available in Apache 1.1 or above. Use of the 
-<code>enabled</code> keyword, or <code>disabled</code> with a
-list of usernames, is only available in Apache 1.3 and
-above.</compatibility>
 
 <usage>
 
     <p>The <directive>UserDir</directive> directive sets the real
     directory in a user's home directory to use when a request for a
     document for a user is received. <em>Directory-filename</em> is
@@ -87,20 +82,19 @@
 <tr><td>UserDir
 http://www.foo.com/~*/</td><td>http://www.foo.com/~bob/one/two.html</td></tr>
 </table> 
 
 <note>
       <strong>Be careful when using this directive; for instance,
-      <code>"UserDir ./"</code> would map
-      <code>"/~root"</code> to <code>"/"</code> - which is probably
-      undesirable. If you are running Apache 1.3 or above, it is
-      strongly recommended that your configuration include a
-      "<code>UserDir disabled root</code>" declaration.
-      See also the <directive module="core">Directory</directive>
-      directive and the <a href="../misc/security_tips.html">Security
-      Tips</a> page for more information.</strong>
+      <code>"UserDir ./"</code> would map <code>"/~root"</code> to
+      <code>"/"</code> - which is probably undesirable. It is strongly
+      recommended that your configuration include a "<code>UserDir
+      disabled root</code>" declaration.  See also the <directive
+      module="core">Directory</directive> directive and the <a
+      href="../misc/security_tips.html">Security Tips</a> page for
+      more information.</strong>
 </note>
 
 <p>Additional examples:</p>
 
 <p>To allow a few users to have <code>UserDir</code> directories, but
 not anyone else, use the following:</p>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_userdir.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_usertrack.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_usertrack.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_usertrack.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_usertrack.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_usertrack.xml	2002-03-11 20:01:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_usertrack.xml	2002-05-27 06:08:58.000000000 +0800
@@ -1,20 +1,18 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 
 <modulesynopsis>
 <name>mod_usertrack</name> 
 <description>
-    This module uses cookies to provide for a
-    <em>clickstream</em> log of user activity on a site.
+<em>Clickstream</em> logging of user activity on a site
 </description>
 <status>Extension</status>
 <sourcefile>mod_usertrack.c</sourcefile>
 <identifier>usertrack_module</identifier>
-<compatibility>Known as mod_cookies prior to Apache 1.3.</compatibility>
 
 <summary>
     <p>Previous releases of Apache have included a module which
     generates a 'clickstream' log of user activity on a site using
     cookies. This was called the "cookies" module, mod_cookies. In
     Apache 1.2 and later this module has been renamed the "user
@@ -36,14 +34,16 @@
     example:</p>
 <example>
 CustomLog logs/clickstream "%{cookie}n %r %t"
 </example>
 
     <p>For backward compatibility the configurable log module
-    implements the old <directive>CookieLog</directive> directive, but this
-    should be upgraded to the above <directive>CustomLog</directive> directive. </p>
+    implements the old <directive
+    module="mod_log_config">CookieLog</directive> directive, but this
+    should be upgraded to the above <directive
+    module="mod_log_config">CustomLog</directive> directive. </p>
 </section>
 
 <section>
 <title>2-digit or 4-digit dates for cookies?</title>
 
     <p>(the following is from message
@@ -83,21 +83,21 @@
 </pre>
 
 </section>
 
 <directivesynopsis>
 <name>CookieDomain</name>
-<description>controls the setting of the domain to which the tracking cookie applies.</description>
+<description>The domain to which the tracking cookie applies</description>
 <syntax>CookieDomain <em>domain</em></syntax>
-<default>None</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 
 <usage>
 
     <p>This directive controls the setting of the domain to which
     the tracking cookie applies. If not present, no domain is
     included in the cookie header field.</p>
@@ -108,23 +108,21 @@
 </usage>
 </directivesynopsis>
 
 
 <directivesynopsis>
 <name>CookieExpires</name>
+<description>Expiry time for the tracking cookie</description>
 <syntax>CookieExpires <em>expiry-period</em></syntax>
-<default></default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
-<override></override>
-<compatibility>In 1.3.20 and earlier, not usable in directory and
-.htaccess</compatibility>
+<override>FileInfo</override>
 
 <usage>
     <p>When used, this directive sets an expiry time on the cookie
     generated by the usertrack module. The <em>expiry-period</em>
     can be given either as a number of seconds, or in the format
     such as "2 weeks 3 days 7 hours". Valid denominations are:
@@ -136,20 +134,22 @@
     current browser session.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>CookieName</name>
+<description>Name of the tracking cookie</description>
 <syntax>CookieName <em>token</em></syntax>
-<default>Apache</default>
+<default>CookieName Apache</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 
 <usage>
     <p>This directive allows you to change the name of the cookie
     this module uses for its tracking purposes. By default the
     cookie is named "<code>Apache</code>".</p>
 
@@ -158,22 +158,23 @@
     Valid characters include A-Z, a-z, 0-9, "_", and "-".</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>CookieStyle</name>
-<description>Controls the format of the cookie header field</description>
+<description>Format of the cookie header field</description>
 <syntax>CookieStyle
     <em>Netscape|Cookie|Cookie2|RFC2109|RFC2965</em></syntax>
-<default></default>
+<default>CookieStyle Netscape</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
+<override>FileInfo</override>
 
 <usage>
     <p>This directive controls the format of the cookie header
     field. The three formats allowed are:</p>
 
     <ul>
@@ -195,14 +196,15 @@
 </directivesynopsis>
 
 
 
 <directivesynopsis>
 <name>CookieTracking</name>
+<description>Enables tracking cookie</description>
 <syntax>CookieTracking on|off</syntax>
-<default></default>
+<default>CookieTracking off</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 <context>directory</context>
 <context>.htaccess</context>
 </contextlist>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mod_vhost_alias.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mod_vhost_alias.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_vhost_alias.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_vhost_alias.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mod_vhost_alias.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mod_vhost_alias.xml	2002-05-27 06:08:58.000000000 +0800
@@ -1,15 +1,14 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mod_vhost_alias</name>
-<description>Provides for <a
-href="../vhosts/mass.html">dynamically configured mass virtual
-hosting</a></description>
+<description>Provides for dynamically configured mass virtual
+hosting</description>
 <status>Extension</status>
 <sourcefile>mod_vhost_alias.c</sourcefile>
 <identifier>vhost_alias_module</identifier>
 
 <summary>
 
@@ -20,12 +19,14 @@
     huge number of virtual hosts with similar configurations.</p>
 
 
 </summary>
     <seealso><directive
     module="core">UseCanonicalName</directive>.</seealso>
+    <seealso><a href="../vhosts/mass.html">Dynamically configured mass 
+virtual hosting</a></seealso>
 
 <section>
     <title>Directory Name Interpolation</title>
 
     <p>All the directives in this module interpolate a string into
     a pathname. The interpolated string (henceforth called the
@@ -184,15 +185,12 @@
 <syntax>VirtualDocumentRoot <em>interpolated-directory</em></syntax>
 <default>none</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 </contextlist>
-<override></override>
-<compatibility>VirtualDocumentRoot is only available in 1.3.7 and
-later.</compatibility>
 
 <usage>
 
     <p>The <code>VirtualDocumentRoot</code> directive allows you to
     determine where Apache will find your documents based on the
     value of the server name. The result of expanding
@@ -214,15 +212,12 @@
 <syntax>VirtualDocumentRootIP <em>interpolated-directory</em></syntax>
 <default>none</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 </contextlist>
-<override></override>
-<compatibility>VirtualDocumentRootIP is only available in 1.3.7 
-and later.</compatibility>
 
 <usage>
 
 <p>The <code>VirtualDocumentRootIP</code> directive is like the
     <directive>VirtualDocumentRoot</directive>
     directive, except that it uses the IP address of the server end
@@ -237,15 +232,12 @@
 <syntax>VirtualScriptAlias <em>interpolated-directory</em></syntax>
 <default>none</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 </contextlist>
-<override></override>
-<compatibility>VirtualScriptAlias is only available in 1.3.7
-and later.</compatibility>
 
 <usage>
 
     <p>The <code>VirtualScriptAlias</code> directive allows you to
     determine where Apache will find CGI scripts in a similar
     manner to <directive>VirtualDocumentRoot</directive>
@@ -264,15 +256,12 @@
 <syntax>VirtualScriptAliasIP <em>interpolated-directory</em></syntax>
 <default>none</default>
 <contextlist>
 <context>server config</context>
 <context>virtual host</context>
 </contextlist>
-<override></override>
-<compatibility>VirtualScriptAliasIP is only available in 1.3.7 
-and later.</compatibility>
 
 <usage>
 
     <p>The <code>VirtualScriptAliasIP</code> directive is like the
     <a
     href="#virtualscriptalias"><code>VirtualScriptAlias</code></a>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mpm_common.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mpm_common.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_common.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_common.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_common.xml	2002-04-02 10:38:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_common.xml	2002-06-14 10:31:01.000000000 +0800
@@ -1,19 +1,19 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mpm_common</name>
 <description>A collection of directives that are implemented by
 more than one multi-processing module (MPM)</description>
 <status>MPM</status>
 
 <directivesynopsis>
 <name>CoreDumpDirectory</name>
-<description>Sets the directory where Apache attempts to
+<description>Directory where Apache attempts to
 switch before dumping core</description>
 <syntax>CoreDumpDirectory <em>directory</em></syntax>
 <default>See usage for the default setting</default>
 <contextlist><context>server config</context></contextlist>
 <modulelist><module>worker</module><module>perchild</module>
 <module>prefork</module><module>mpm_winnt</module>
@@ -30,13 +30,13 @@
     different location.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>Group</name>
-<description>Sets the group under which the server will answer
+<description>Group under which the server will answer
 requests</description>
 <syntax>Group <em>unix-group</em></syntax>
 <default>Group #-1</default>
 <contextlist><context>server config</context><context>virtual host</context>
 </contextlist>
 <modulelist><module>worker</module><module>perchild</module>
@@ -62,25 +62,25 @@
     but this is not always possible or desirable.</p>
 
     <p>Note: if you start the server as a non-root user, it will
     fail to change to the specified group, and will instead
     continue to run as the group of the original user.</p>
 
-    <p>Special note: Use of this directive in &lt;VirtualHost&lt; is
+    <p>Special note: Use of this directive in &lt;VirtualHost&gt; is
     no longer supported. To implement the <a
     href="../suexec.html">suEXEC wrapper</a> with Apache 2.0, use the
     <directive module="mod_suexec">SuexecUserGroup</directive>
     directive. SECURITY: See <directive
     module="mpm_common">User</directive> for a discussion of the
     security considerations.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>PidFile</name>
-<description>Sets the file where the server records the process ID
+<description>File where the server records the process ID
 of the daemon</description>
 <syntax>PidFile <em>filename</em></syntax>
 <default>PidFile logs/httpd.pid</default>
 <contextlist><context>server config</context></contextlist>
 <modulelist><module>worker</module><module>perchilde</module>
 <module>prefork</module><module>mpm_winnt</module>
@@ -89,12 +89,16 @@
 <usage>
     <p>The <directive>PidFile</directive> directive sets the file to
     which the server records the process id of the daemon. If the
     filename does not begin with a slash (/) then it is assumed to be
     relative to the <directive module="core">ServerRoot</directive>.</p>
 
+    <example><title>Example</title>
+    PidFile /var/run/apache.pid
+    </example>
+
     <p>It is often useful to be able to send the server a signal,
     so that it closes and then reopens its <directive
     module="core">ErrorLog</directive> and TransferLog, and
     re-reads its configuration files. This is done by sending a
     SIGHUP (kill -1) signal to the process id listed in the
     PidFile.</p>
@@ -104,13 +108,13 @@
     href="../misc/security_tips.html#serverroot">security</a>.</p>
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>Listen</name>
-<description>Sets the IP addresses and ports that the server
+<description>IP addresses and ports that the server
 listens to</description>
 <syntax>Listen [<em>IP-address</em>:]<em>portnumber</em></syntax>
 <contextlist><context>server config</context></contextlist>
 <modulelist><module>worker</module><module>perchild</module>
 <module>prefork</module><module>mpm_winnt</module>
 </modulelist>
@@ -213,13 +217,13 @@
 
 <directivesynopsis>
 <name>MaxClients</name>
 <description>Maximum number of child processes that will be created
 to serve requests</description>
 <syntax>MaxClients <em>number</em></syntax>
-<default>>MaxClients
+<default>MaxClients
     8 (with threads) MaxClients 256</default>
 <contextlist><context>server config</context></contextlist>
 <modulelist><module>worker</module><module>prefork</module>
 </modulelist>
 
 <usage>
@@ -285,29 +289,37 @@
 </directivesynopsis>
 
 <directivesynopsis>
 <name>MaxSpareThreads</name>
 <description>Maximum number of idle threads</description>
 <syntax>MaxSpareThreads <em>number</em></syntax>
-<default>MaxSpareThreads 10 (Perchild) or 500 (worker)</default>
 <contextlist><context>server config</context></contextlist>
-<modulelist><module>worker</module><module>perchild</module>
+<modulelist><module>mpm_netware</module>
+<module>perchild</module><module>worker</module>
 </modulelist>
 
 <usage>
     <p>Maximum number of idle threads. Different MPMs deal with this
-    directive differently. <module>perchild</module> monitors the
-    number of idle threads on a per-child basis. If there are too many
-    idle threads in that child, the server will begin to kill threads
+    directive differently.</p>
+
+    <p>For <module>perchild</module> the default is
+    <code>MaxSpareThreads 10</code>.  This MPM monitors the number of
+    idle threads on a per-child basis. If there are too many idle
+    threads in that child, the server will begin to kill threads
     within that child.</p>
 
-    <p><module>worker</module> deals with idle threads on a
-    server-wide basis. If there are too many idle threads in the
+    <p>For <module>worker</module> the default is
+    <code>MaxSpareThreads 500</code>.  This MPM deals with idle threads
+    on a server-wide basis. If there are too many idle threads in the
     server then child processes are killed until the number of idle
     threads is less than this number.</p>
 
+    <p>For <module>mpm_netware</module> the default is
+    <code>MaxSpareThreads 100</code>.  Since this MPM runs a
+    single-process, the spare thread count is also server-wide.</p>
+
 </usage>
 <seealso><directive module="mpm_common">MinSpareThreads</directive></seealso>
 <seealso><directive module="mpm_common">StartServers</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
@@ -331,29 +343,38 @@
 
 <directivesynopsis>
 <name>MinSpareThreads</name>
 <description>Minimum number of idle threads available to handle request
 spikes</description>
 <syntax>MinSpareServers <em>number</em></syntax>
-<default>MinSpareThreads 5 (Perchild) or 250 (worker)</default>
 <contextlist><context>server config</context></contextlist>
-<modulelist><module>worker</module><module>perchild</module>
+<modulelist><module>mpm_netware</module>
+<module>perchild</module><module>worker</module>      
 </modulelist>
 
 <usage>
     <p>Minimum number of idle threads to handle request spikes.
     Different MPMs deal with this directive
-    differently. <module>perchild</module> monitors the number of idle
+    differently.</p>
+
+    <p><module>perchild</module> uses a default of
+    <code>MinSpareThreads 5</code> and monitors the number of idle
     threads on a per-child basis. If there aren't enough idle threads
     in that child, the server will begin to create new threads within
     that child.</p>
 
-    <p><module>worker</module> deals with idle threads on a
-    server-wide basis. If there aren't enough idle threads in the
-    server then child processes are created until the number of idle
-    threads is greater than number.</p>
+    <p><module>worker</module> uses a default of <code>MinSpareThreads
+    250</code> and deals with idle threads on a server-wide basis. If
+    there aren't enough idle threads in the server then child
+    processes are created until the number of idle threads is greater
+    than number.</p>
+
+    <p><module>mpm_netware</module> uses a default of
+    <code>MinSpareThreads 10</code> and, since it is a single-process
+    MPM, tracks this on a server-wide bases.</p>
+
 </usage>
 <seealso><directive module="mpm_common">MaxSpareThreads</directive></seealso>
 <seealso><directive module="mpm_common">StartServers</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
@@ -388,12 +409,16 @@
     this communication. If the file is left unspecified, Apache first
     attempts to create the scoreboard entirely in memory (using anonymous
     shared memory) and, failing that, will attempt to create the file on
     disk (using file-based shared memory). Specifying this directive causes
     Apache to always create the file on the disk.</p>
 
+    <example><title>Example</title>
+    ScoreBoardFile /var/run/apache_status
+    </example>
+
     <p>File-based shared memory is useful for third-party applications
     that require direct access to the scoreboard.</p>
 
     <p>If you use a <directive>ScoreBoardFile</directive> then
     you may see improved speed by placing it on a RAM disk. But be
     careful that you heed the same warnings about log file placement
@@ -485,23 +510,32 @@
 <seealso><directive module="mpm_common">MinSpareThreads</directive></seealso>
 <seealso><directive module="mpm_common">MaxSpareThreads</directive></seealso>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>StartThreads</name>
-<description>Nubmer of threads each child creates on startup</description>
+<description>Nubmer of threads created on startup</description>
 <syntax>StartThreads <em>number</em></syntax>
-<default>StartThreads 5</default>
 <contextlist><context>server config</context></contextlist>
-<modulelist><module>perchild</module></modulelist>
+<modulelist><module>mpm_netware</module><module>perchild</module></modulelist>
 
 <usage>
-    <p>Number of threads each child creates on startup. As the
+    <p>Number of threads created on startup. As the
     number of threads is dynamically controlled depending on the
     load, there is usually little reason to adjust this
     parameter.</p>
+
+    <p>For <module>perchild</module> the default is <code>StartThreads
+    5</code> and this directive tracks the number of threads per
+    process at startup.</p>
+
+    <p>For <module>mpm_netware</module> the default is
+    <code>StartThreads 50</code> and, since there is only a single
+    process, this is the total number of threads created at startup to
+    serve requests.</p>
+
 </usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ThreadLimit</name>
 <description>Sets the upper limit on the configurable number of threads
@@ -581,22 +615,20 @@
 
       <dt># followed by a user number.</dt>
 
       <dd>Refers to a user by their number.</dd>
     </dl>
 
-    <p>The user should have no privileges which result in it being
-    able to access files which are not intended to be visible to the
+    <p>The user should have no privileges that result in it being
+    able to access files that are not intended to be visible to the
     outside world, and similarly, the user should not be able to
-    execute code which is not meant for httpd requests. It is
+    execute code that is not meant for httpd requests. It is
     recommended that you set up a new user and group specifically for
     running the server. Some admins use user <code>nobody</code>, but
-    this is not always possible or desirable. For example
-    <module>mod_proxy</module>'s cache, when enabled, must be
-    accessible to this user (see <directive
-    module="mod_proxy">CacheRoot</directive>).</p>
+    this is not always desirable, since the <code>nobody</code> user
+    can have other uses on the system.</p>
 
     <p>Notes: If you start the server as a non-root user, it will
     fail to change to the lesser privileged user, and will instead
     continue to run as that original user. If you do start the
     server as root, then it is normal for the parent process to
     remain running as root.</p>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mpm_netware.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mpm_netware.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_netware.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_netware.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_netware.xml	2002-03-10 13:06:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_netware.xml	2002-06-14 10:31:01.000000000 +0800
@@ -1,20 +1,21 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 <name>mpm_netware</name>
 <description>Multi-Processing Module implementing an exclusively threaded web
     server optimized for Novell NetWare</description>
 <status>MPM</status>
 <sourcefile>mpm_netware.c</sourcefile>
 <identifier>mpm_netware_module</identifier>
 
 <summary>
-    <p>This Multi-Processing Module (MPM) implements an exclusively threaded web server
-    that has been optimized for Novell NetWare.</p>
+    <p>This Multi-Processing Module (MPM) implements an exclusively
+    threaded web server that has been optimized for Novell
+    NetWare.</p>
 
     <p>The main thread is responsible for launching child
     worker threads which listen for connections and serve them when they
     arrive. Apache always tries to maintain several <em>spare</em>
     or idle worker threads, which stand ready to serve incoming
     requests. In this way, clients do not need to wait for a new
@@ -63,59 +64,22 @@
 <usage>
 <p>The MaxThreads directive sets the desired maximum
     number worker threads allowable.</p>
 </usage>
 </directivesynopsis>
 
-<directivesynopsis>
+<directivesynopsis location="mpm_common">
 <name>MaxSpareThreads</name>
-<syntax>MaxSpareThreads <em>number</em></syntax>
-<default>MaxSpareThreads 100</default>
-<contextlist><context>server config</context></contextlist>
-
-<usage>
-    <p>The <directive>MaxSpareThreads</directive> directive sets the
-    desired maximum number of <em>idle</em> worker threads. An idle
-    worker thread is one which is not handling a request. If there are
-    more than MaxSpareThreads idle, then the main thread will kill off
-    the excess worker threads.</p>
-
-    <p>Tuning of this parameter should only be necessary on very
-    busy sites. Setting this parameter to a large number is almost
-    always a bad idea.</p>
-</usage>
 </directivesynopsis>
 
-<directivesynopsis>
+<directivesynopsis location="mpm_common">
 <name>MinSpareThreads</name>
-<syntax>MinSpareThreads <em>number</em></syntax>
-<default>MinSpareThreads 10</default>
-<contextlist><context>server config</context></contextlist>
-
-<usage>
-<p>The <directive>MinSpareThreads</directive> directive sets the
-desired minimum number of <em>idle</em> worker threads. An idle worker
-thread is one which is not handling a request. If there are fewer than
-MinSpareThreads idle, then the main thread spawns new worker.</p>
-
-    <p>Tuning of this parameter should only be necessary on very
-    busy sites. Setting this parameter to a large number is almost
-    always a bad idea.</p>
-</usage>
 </directivesynopsis>
 
-<directivesynopsis>
+<directivesynopsis location="mpm_common">
 <name>StartThreads</name>
-<syntax>StartThreads <em>number</em></syntax>
-<default>StartThreads 50</default>
-<contextlist><context>server config</context></contextlist>
-
-<usage>
-<p>The StartThreads directive sets the desired
-    number of worker threads to spawn and startup</p>
-</usage>
 </directivesynopsis>
 
 <directivesynopsis>
 <name>ThreadStackSize</name>
 <syntax>ThreadStackSize <em>number</em></syntax>
 <default>ThreadStackSize 65536</default>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: mpm_winnt.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mpm_winnt.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mpm_winnt.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_winnt.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_winnt.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/mpm_winnt.xml	2002-03-07 04:58:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/mpm_winnt.xml	2002-05-23 22:50:12.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>mpm_winnt</name>
 <description>This Multi-Processing Module is optimized for Windows
     NT.</description>
 <status>MPM</status>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: mpm_winnt.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: perchild.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: perchild.html.en
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/perchild.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/perchild.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/perchild.xml	2002-03-10 12:34:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/perchild.xml	2002-06-08 10:51:09.000000000 +0800
@@ -1,9 +1,9 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>perchild</name>
 <description>Multi-Processing Module allowing for daemon processes
     serving requests to be assigned a variety of different
     userids</description>
@@ -24,42 +24,47 @@
     threads in each process.</p>
 
     <p>A single control process launches the number of child processes
     indicated by the <directive
     module="mpm_common">NumServers</directive> directive at server
     startup. Each child process creates threads as specified in the
-    <code>StartThreads</code> directive. The individual threads then
+    <directive module="mpm_common">StartThreads</directive> directive.
+    The individual threads then
     listen for connections and serve them when they arrive.</p>
 
     <p>Apache always tries to maintain a pool of <em>spare</em> or
     idle server threads, which stand ready to serve incoming
     requests. In this way, clients do not need to wait for new
     threads to be created. For each child process, Apache assesses
     the number of idle threads and creates or destroys threads to
     keep this number within the boundaries specified by
-    <code>MinSpareThreads</code> and <code>MaxSpareThreads</code>.
+    <directive module="mpm_common">MinSpareThreads</directive>
+    and <directive module="mpm_common">MaxSpareThreads</directive>.
     Since this process is very self-regulating, it is rarely
     necessary to modify these directives from their default values.
     The maximum number of clients that may be served simultaneously
     is determined by multiplying the number of server processes
-    that will be created (<code>NumServers</code>) by the maximum
+    that will be created (<directive 
+    module="mpm_common">NumServers</directive>) by the maximum
     number of threads created in each process
-    (<code>MaxThreadsPerChild</code>).</p>
+    (<directive module="mpm_common">MaxThreadsPerChild</directive>).</p>
 
     <p>While the parent process is usually started as root under
     Unix in order to bind to port 80, the child processes and
     threads are launched by Apache as a less-privileged user. The
-    <code>User</code> and <code>Group</code> directives are used to
+    <directive module="mpm_common">User</directive> and <directive
+    module="mpm_common">Group</directive> directives are used to
     set the privileges of the Apache child processes. The child
     processes must be able to read all the content that will be
     served, but should have as few privileges beyond that as
     possible. In addition, unless <a
     href="../suexec.html">suexec</a> is used, these directives also
     set the privileges which will be inherited by CGI scripts.</p>
 
-    <p><code>MaxRequestsPerChild</code> controls how frequently the
+    <p><directive module="mpm_common">MaxRequestsPerChild</directive>
+    controls how frequently the
     server recycles processes by killing old ones and launching new
     ones.</p>
 
     <p>See also: <a href="../bind.html">Setting which addresses and
     ports Apache uses</a>.</p>
 
@@ -132,19 +137,19 @@
 <name>ChildPerUserId</name>
 <syntax>ChildPerUserID <em>user_id</em>
 <em>group_id</em> <em>child_id</em></syntax>
 <contextlist><context>server config</context></contextlist>
 
 <usage>
-    <p>Specify a user id and group id for a specific child process. The number of
-children if set by the <a href="mpm_common.html#numservers">NumServers</a>
-directive. For example, the default value for <a
-href="mpm_common.html#numservers">NumServers</a> is 5 and that means
+<p>Specify a user id and group id for a specific child process. The number of
+children is set by the <directive module="mpm_common">NumServers</directive>
+directive. For example, the default value for <directive
+module="mpm_common">NumServers</directive> is 5 and that means
 children ids 1,2,3,4 and 5 are available for assigment. If a child does not
-have an associated ChildPerUserID, it inherits the <a
-href="mpm_common.html#user">User</a> and <a
-href="mpm_common.html#group">Group</a> settings from the main server </p> 
+have an associated ChildPerUserID, it inherits the <directive
+module="mpm_common">User</directive> and <directive
+module="mpm_common">Group</directive> settings from the main server </p> 
 </usage>
 </directivesynopsis>
 
 </modulesynopsis>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: prefork.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: prefork.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: prefork.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/prefork.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/prefork.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/prefork.xml	2002-03-11 19:13:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/prefork.xml	2002-06-06 18:48:48.000000000 +0800
@@ -1,23 +1,37 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 
 <name>prefork</name>
 <description>Implements a non-threaded, pre-forking web server</description>
 <status>MPM</status>
 <sourcefile>prefork.c</sourcefile>
 <identifier>mpm_prefork_module</identifier>
 
 <summary>
-    <p>This Multi-Processing Module (MPM) implements a
-    non-threaded, pre-forking web server which handles request in a
-    manner very similar to the default behavior of Apache 1.3 on
-    Unix.</p>
+    <p>This Multi-Processing Module (MPM) implements a non-threaded,
+    pre-forking web server that handles requests in a manner similar
+    to Apache 1.3.  It is appropriate for sites that need to avoid
+    threading for compatibility with non-thread-safe libraries.  It
+    is also the best MPM for isolating each request, so that a problem
+    with a single request will not affect any other.</p>
+
+    <p>This MPM is very self-regulating, so it is rarely necessary to
+    adjust its configuration directives.  Most important is that
+    <directive module="mpm_common">MaxClients</directive> be big enough to 
+    handle as many simultaneous requests as you expect to receive, but
+    small enough to assure that there is enough physical RAM for all
+    processes.</p>
 
+</summary>
+<seealso><a href="../bind.html">Setting which addresses and
+    ports Apache uses</a></seealso>
+
+<section><title>How it Works</title>
     <p>A single control process is responsible for launching child
     processes which listen for connections and serve them when they
     arrive. Apache always tries to maintain several <em>spare</em>
     or idle server processes, which stand ready to serve incoming
     requests. In this way, clients do not need to wait for a new
     child processes to be forked before their requests can be
@@ -43,23 +57,18 @@
     in order to bind to port 80, the child processes are launched by
     Apache as a less-privileged user. The <directive
     module="mpm_common">User</directive> and <directive
     module="mpm_common">Group</directive> directives are used to set
     the privileges of the Apache child processes. The child processes
     must be able to read all the content that will be served, but
-    should have as few privileges beyond that as possible. In
-    addition, unless <a href="../suexec.html">suexec</a> is used,
-    these directives also set the privileges which will be inherited
-    by CGI scripts.</p>
+    should have as few privileges beyond that as possible.</p>
 
     <p><directive module="mpm_common">MaxRequestsPerChild</directive>
     controls how frequently the server recycles processes by killing
     old ones and launching new ones.</p>
-</summary>
-<seealso><a href="../bind.html">Setting which addresses and
-    ports Apache uses</a></seealso>
+</section>
 
 <directivesynopsis location="mpm_common">
 <name>CoreDumpDirectory</name>
 </directivesynopsis>
 
 <directivesynopsis location="mpm_common">
@@ -76,12 +85,16 @@
 
 <directivesynopsis location="mpm_common">
 <name>LockFile</name>
 </directivesynopsis>
 
 <directivesynopsis location="mpm_common">
+<name>MaxClients</name>
+</directivesynopsis>
+
+<directivesynopsis location="mpm_common">
 <name>MaxRequestsPerChild</name>
 </directivesynopsis>
 
 <directivesynopsis location="mpm_common">
 <name>MaxSpareServers</name>
 </directivesynopsis>
@@ -107,12 +120,16 @@
 </directivesynopsis>
 
 <directivesynopsis location="mpm_common">
 <name>User</name>
 </directivesynopsis>
 
+<directivesynopsis location="mpm_common">
+<name>Group</name>
+</directivesynopsis>
+
 <directivesynopsis>
 <name>AcceptMutex</name>
 <description>Method that Apache uses to serialize multiple children
 accepting requests on network sockets</description>
 <syntax>AcceptMutex default|<em>method</em></syntax>
 <default>AcceptMutex default</default>
@@ -195,14 +212,12 @@
     fewer than MinSpareServers idle, then the parent process creates
     new children at a maximum rate of 1 per second.</p>
 
     <p>Tuning of this parameter should only be necessary on very
     busy sites. Setting this parameter to a large number is almost
     always a bad idea.</p>
-
-    <p>This directive has no effect on Microsoft Windows.</p>
 </usage>
 <seealso><directive module="prefork">MaxSpareServers</directive></seealso>
 <seealso><directive module="mpm_common">StartServers</directive></seealso>
 </directivesynopsis>
 
 </modulesynopsis>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: prefork.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod: worker.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: worker.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: worker.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/worker.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/worker.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/mod/worker.xml	2002-04-16 14:13:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod/worker.xml	2002-06-02 23:47:38.000000000 +0800
@@ -1,62 +1,81 @@
 <?xml version="1.0"?>
 <!DOCTYPE modulesynopsis SYSTEM "../style/modulesynopsis.dtd">
-<?xml-stylesheet type="text/xsl" href="../style/manual.xsl"?>
+<?xml-stylesheet type="text/xsl" href="../style/manual.en.xsl"?>
 <modulesynopsis>
 <name>worker</name>
 <description>Multi-Processing Module implementing a hybrid
     multi-threaded multi-process web server</description>
 <status>MPM</status>
 <sourcefile>worker.c</sourcefile>
 <identifier>mpm_worker_module</identifier>
 
 <summary>
     <p>This Multi-Processing Module (MPM) implements a hybrid
-    multi-process multi-threaded server. Each process has a fixed
+    multi-process multi-threaded server.  By using threads to serve
+    requests, it is able to serve a large number of requests with
+    less system resources than a process-based server.  Yet it
+    retains much of the stability of a process-based server by 
+    keeping multiple processes available, each with many threads.</p>
+
+    <p>The most important directives used to control this MPM are
+    <directive module="mpm_common">ThreadsPerChild</directive> and
+    <directive module="mpm_common">MaxClients</directive>.  By multiplying
+    together the value of these directives you define the total number
+    of simultaneous connections that the server can handle.</p>
+
+</summary>
+<seealso><a href="../bind.html">Setting which addresses and
+    ports Apache uses</a></seealso>
+
+<section><title>How it Works</title>
+    <p>Each process has a fixed
     number of threads. The server adjusts to handle load by
     increasing or decreasing the number of processes.</p>
 
     <p>A single control process is responsible for launching child
-    processes. Each child process creates a fixed number of threads
-    as specified in the <code>ThreadsPerChild</code> directive. The
-    individual threads then listen for connections and serve them
-    when they arrive.</p>
+    processes. Each child process creates a fixed number of threads as
+    specified in the <directive
+    module="mpm_common">ThreadsPerChild</directive> directive. The
+    individual threads then listen for connections and serve them when
+    they arrive.</p>
 
     <p>Apache always tries to maintain a pool of <em>spare</em> or
     idle server threads, which stand ready to serve incoming
     requests. In this way, clients do not need to wait for a new
     threads or processes to be created before their requests can be
     served. Apache assesses the total number of idle threads in all
-    processes, and forks or kills processes to keep this number
-    within the boundaries specified by <code>MinSpareThreads</code>
-    and <code>MaxSpareThreads</code>. Since this process is very
-    self-regulating, it is rarely necessary to modify these
-    directives from their default values. The maximum number of
+    processes, and forks or kills processes to keep this number within
+    the boundaries specified by <directive
+    module="mpm_common">MinSpareThreads</directive> and <directive
+    module="mpm_common">MaxSpareThreads</directive>. Since this
+    process is very self-regulating, it is rarely necessary to modify
+    these directives from their default values. The maximum number of
     clients that may be served simultaneously is determined by
     multiplying the maximum number of server processes that will be
-    created (<code>MaxClients</code>) by the number of threads
-    created in each process (<code>ThreadsPerChild</code>).</p>
-
-    <p>While the parent process is usually started as root under
-    Unix in order to bind to port 80, the child processes and
-    threads are launched by Apache as a less-privileged user. The
-    <code>User</code> and <code>Group</code> directives are used to
-    set the privileges of the Apache child processes. The child
-    processes must be able to read all the content that will be
-    served, but should have as few privileges beyond that as
-    possible. In addition, unless <a
-    href="../suexec.html">suexec</a> is used, these directives also
-    set the privileges which will be inherited by CGI scripts.</p>
-
-    <p><code>MaxRequestsPerChild</code> controls how frequently the
-    server recycles processes by killing old ones and launching new
-    ones.</p>
-
-    <p>See also: <a href="../bind.html">Setting which addresses and
-    ports Apache uses</a>.</p>
-</summary>
+    created (<directive module="mpm_common">MaxClients</directive>) by
+    the number of threads created in each process (<directive
+    module="mpm_common">ThreadsPerChild</directive>).</p>
+
+    <p>While the parent process is usually started as root under Unix
+    in order to bind to port 80, the child processes and threads are
+    launched by Apache as a less-privileged user. The <directive
+    module="mpm_common">User</directive> and <directive
+    module="mpm_common">Group</directive> directives are used to set
+    the privileges of the Apache child processes. The child processes
+    must be able to read all the content that will be served, but
+    should have as few privileges beyond that as possible. In
+    addition, unless <a href="../suexec.html">suexec</a> is used,
+    these directives also set the privileges which will be inherited
+    by CGI scripts.</p>
+
+    <p><directive module="mpm_common">MaxRequestsPerChild</directive>
+    controls how frequently the server recycles processes by killing
+    old ones and launching new ones.</p>
+</section>
+ 
 
 <directivesynopsis location="mpm_common"><name>CoreDumpDirectory</name>
 </directivesynopsis>
 <directivesynopsis location="mpm_common"><name>Group</name>
 </directivesynopsis>
 <directivesynopsis location="mpm_common"><name>PidFile</name>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/mod: worker.xml.ja
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: mpm.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: mpm.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: mpm.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: mpm.html.ko.euc-kr
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: new_features_2_0.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: new_features_2_0.html.ko.euc-kr
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/footer.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/footer.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/footer.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/footer.html	2002-06-18 11:46:44.000000000 +0800
@@ -1,6 +1,6 @@
     <hr />
 
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <h3 align="center">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/header.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/header.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/header.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/header.html	2002-06-18 11:46:44.000000000 +0800
@@ -1,6 +1,6 @@
-    <div align="CENTER">
+    <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/netware.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/netware.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/netware.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/netware.html	2002-06-18 11:46:44.000000000 +0800
@@ -8,13 +8,13 @@
     <title>Using Apache with Novell NetWare</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
-        <div align="CENTER">
+        <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
@@ -503,13 +503,13 @@
         the distribution directory if it exists.</li>
     </ul>
 
     <hr />
         <hr />
 
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <h3 align="center">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
 
   </body>
 </html>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/perf-hp.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/perf-hp.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/perf-hp.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/perf-hp.html	2002-06-18 11:46:44.000000000 +0800
@@ -9,13 +9,13 @@
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
     <a id="initial" name="initial">&nbsp;</a> 
-        <div align="CENTER">
+        <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/win_compiling.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/win_compiling.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/win_compiling.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/win_compiling.html	2002-06-18 11:46:44.000000000 +0800
@@ -1,20 +1,20 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
     <meta name="generator" content="HTML Tidy, see www.w3.org" />
-
+    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
     <title>Compiling Apache for Microsoft Windows</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
-        <div align="CENTER">
+        <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
@@ -91,16 +91,24 @@
         site has a compiled native Win32 binary, 
         <a href="http://cm.bell-labs.com/cm/cs/who/bwk/awk95.exe"
          >http://cm.bell-labs.com/cm/cs/who/bwk/awk95.exe</a> which 
         you must save with the name awk.exe rather than awk95.exe.<br />
         <br />
          Note that Developer Studio IDE will only find awk.exe from
-        the <u>T</u>ools menu <u>O</u>ptions... Directories tab list of
-        Executable file paths.  Add the path for awk.exe to this list,
-        and your system PATH environment variable, as needed.<br />
-        <br />
+        the <u>T</u>ools menu <u>O</u>ptions... Directories tab 
+        (the Projects - VC++ Directories pane in Developer Studio 7.0)
+        listing Executable file paths.  Add the path for awk.exe to this 
+        list, and your system PATH environment variable, as needed.<br />
+        <br />
+         Also note that if you are using Cygwin (<a href="http://www.cygwin.com/"
+         >http://www.cygwin.com/</a>) the awk utility is named gawk.exe and
+         that the file awk.exe is really a symlink to the gawk.exe file. The
+         Windows command shell does not recognize symlinks, and because of that
+         building InstallBin will fail. A workaround is to delete awk.exe from
+         the cygwin installation and rename gawk.exe to awk.exe.<br />
+         <br />
       </li>
 
       <li>[Optional] OpenSSL libraries (for mod_ssl and ab.exe with ssl support)<br />
         <br />
          <strong>Caution:  there are significant restrictions and 
         prohibitions on the use and distribution of strong cryptography 
@@ -115,15 +123,13 @@
         <br />
          OpenSSL must be installed into a srclib subdirectory named openssl, 
         obtained from <a href="http://www.openssl.org/source/"
          >http://www.openssl.org/source/</a>, in order to compile mod_ssl
         or the abs project (ab.exe with SSL support.)  To prepare OpenSSL 
         for both release and debug builds of Apache, and disable the patent 
-        protected features in 0.9.6c (as built by the ASF for binary
-        distribution from the United States),  you might use the following 
-        build commands;
+        protected features in 0.9.6,  you might use the following build commands;
 <pre>
   perl util\mkfiles.pl >MINFO
   perl util\mk1mf.pl dll no-asm no-mdc2 no-rc5 no-idea VC-WIN32 >makefile
   perl util\mk1mf.pl dll debug no-asm no-mdc2 no-rc5 no-idea VC-WIN32 >makefile.dbg
   perl util\mkdef.pl 32 libeay no-asm no-mdc2 no-rc5 no-idea >ms\libeay32.def
   perl util\mkdef.pl 32 ssleay no-asm no-mdc2 no-rc5 no-idea >ms\ssleay32.def
@@ -187,34 +193,46 @@
     a test compile (without installing) you may build the BuildBin
     project instead.</p>
 
     <p>The .dsp project files are distributed in Visual C++ 6.0
     format. Visual C++ 5.0 (97) will recognize them.  Visual C++
     7.0 (.net) must convert Apache.dsw plus the .dsp files into an 
-    .msproj format, be sure you reconvert the .msproj file if any 
-    of the source .dsp files change!</p>
+    Apache.sln plus .msproj files, be sure you reconvert the .msproj 
+    file if any of the source .dsp files change!  This is really
+    trivial, just open Apache.dsw in the VC++ 7.0 IDE once again.</p>
+
+    <p>Visual C++ 7.0 (.net) users should also use the <u>B</u>uild
+    menu, C<u>o</u>nfiguration Manager dialog to uncheck both the 
+    Debug and Release Solution modules abs, mod_ssl, and mod_deflate.
+    These modules are built by invoking nmake or the IDE directly with
+    the BinBuild target to build those modules explicitly, only if the 
+    srclib directories openssl and/or zlib exist.</p>
 
     <p>Exported .mak files pose a greater hassle, but they are
-    required for Visual C++ 5.0 and 7.0 users to build mod_ssl, ab
-    with SSL support or mod_deflate, since only VC 6.0 knows how
-    to invoke .dsp files directly.  Build the entire project from
-    within the IDE, then export all makefiles.  You must build the
-    projects in order to create all dynamic auto-generated targets,
-    so that dependencies can be parsed correctly.  Run the following
-    command to fix the paths so they will build anywhere;
+    required for Visual C++ 5.0 users to build mod_ssl, abs (ab
+    with SSL support) and/or mod_deflate.  VC++ 7.0 (.net) users
+    also benefit, nmake builds are faster than binenv builds.
+    Build the entire project from within the VC++ 5.0 or 6.0 IDE, 
+    then use the <u>P</u>roject Menu <u>E</u>xport for all makefiles.
+    You must build the projects first in order to create all dynamic 
+    auto-generated targets, so that dependencies can be parsed 
+    correctly.  Run the following command to fix the paths so they 
+    will build anywhere;</p>
 <pre>
      perl srclib\apr\build\fixwin32mak.pl
 </pre>
-    You must type this command from the <em>top level</em>
+    <p>You must type this command from the <em>top level</em>
     directory of the httpd source tree. Every .mak and .dep project 
-    file within the current directory and below will be converted,
-    and the timestamps adjusted to reflect the .dsp. If you contribute 
-    back a patch that revises project files, you must submit project 
-    files in Visual Studio 6.0 format.<br />
-     <br />
-     
+    file within the current directory and below will be corrected,
+    and the timestamps adjusted to reflect the .dsp.</p>
+
+    <p>If you contribute back a patch that revises project files, we
+    must commit project files in Visual Studio 6.0 format.  Changes
+    should be simple, with minimal compilation and linkage flags that
+    will be recognized by all VC++ 5.0 through 7.0 environments.</p>
+
     <h3><a id="projectcomponents" name="projectcomponents">Project
     Components</a></h3>
 
     <p>The Apache.dsw workspace and makefile.win nmake script both
     build the .dsp projects of the Apache server in the following
     sequence:</p>
@@ -272,13 +290,13 @@
 
     <p>Once Apache has been compiled, it needs to be installed in
     its server root directory. The default is the
     <code>\Apache2</code> directory, of the same drive.</p>
 
     <p>To build and install all the files into the desired folder
-    <em>dir</em> automatically, use one the following nmake
+    <em>dir</em> automatically, use one of the following nmake
     commands:</p>
 <pre>
     nmake /f Makefile.win installr INSTDIR=<em>dir</em>
 
     nmake /f Makefile.win installd INSTDIR=<em>dir</em>
 </pre>
@@ -368,12 +386,12 @@
     cause the build to fail completely.  And don't forget to run
     srclib/apr/build/fixwin32mak.pl in order to fix absolute
     paths within the .mak files.</p>
 
         <hr />
 
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <h3 align="center">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
   </body>
 </html>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/windows.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/windows.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/windows.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/windows.html	2002-06-18 11:46:44.000000000 +0800
@@ -8,13 +8,13 @@
     <title>Using Apache with Microsoft Windows</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
-        <div align="CENTER">
+        <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
@@ -222,13 +222,13 @@
     logs any errors to its own error.log file in the logs folder
     within the Apache server root folder. You will <em>not</em>
     find Apache error details in the Windows NT Event
     Log.</strong></p>
 
     <p>After starting Apache running (either in a console window or
-    as a service) if will be listening to port 80 (unless you
+    as a service) it will be listening to port 80 (unless you
     changed the <samp>Listen</samp> directive in the configuration
     files). To connect to the server and access the default page,
     launch a browser and enter this URL:</p>
 <pre>
   http://localhost/
 </pre>
@@ -577,13 +577,13 @@
     these commands provide a Windows equivalent to <code>kill -TERM
     <em>pid</em></code> and <code>kill -USR1 <em>pid</em></code>.
     The command line option used, <code>-k</code>, was chosen as a
     reminder of the "kill" command used on Unix.</p>
         <hr />
 
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <h3 align="center">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
 
   </body>
 </html>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/win_service.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/win_service.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/platform/win_service.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/platform/win_service.html	2002-06-18 11:46:44.000000000 +0800
@@ -8,13 +8,13 @@
     <title>Running Apache for Windows as a Service</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
   vlink="#000080" alink="#FF0000">
-        <div align="CENTER">
+        <div align="center">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
@@ -368,13 +368,13 @@
     Foundation never endorses the use of Windows 95/98 as a public
     httpd server. These facilities exist only to assist the user in
     developing web content and learning the Apache server, and
     perhaps as a intranet server on a secured, private network.</p>
         <hr />
 
-    <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
+    <h3 align="center">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
 
   </body>
 </html>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/programs/httpd.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/programs/httpd.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/programs/httpd.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/programs/httpd.html	2002-06-18 11:46:44.000000000 +0800
@@ -1,21 +1,21 @@
 
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml">
-<head><title>Manual Page: http  - Apache HTTP Server</title></head>
+<head><title>Manual Page: httpd  - Apache HTTP Server</title></head>
 <body bgcolor="#ffffff" text="#000000" link="#0000ff"
 vlink="#000080" alink="#ff0000">
     <div align="CENTER">
       <img src="../images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
       <h3>Apache HTTP Server Version 2.0</h3>
     </div>
 
 
-<h1 align="center">Manual Page: http</h1>
+<h1 align="center">Manual Page: httpd</h1>
 <!-- This document was autogenerated from the man page -->
 <pre>
 <strong>NAME</strong>
      httpd - Apache hypertext transfer protocol server
 
 <strong>SYNOPSIS</strong>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: sections.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: sections.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: sections.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/server-wide.html.ja.jis /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/server-wide.html.ja.jis
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/server-wide.html.ja.jis	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/server-wide.html.ja.jis	2002-06-18 11:46:44.000000000 +0800
@@ -4,13 +4,13 @@
 <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
   <head>
 
     <title>Server-Wide Configuration</title>
 
   </head>
-  <!-- English revision: 1.7 -->
+  <!-- English revision: 1.8 -->
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
   <body bgcolor="#ffffff" text="#000000" link="#0000ff"
   vlink="#000080" alink="#ff0000">
         <div align="CENTER">
       <img src="images/sub.gif" alt="[APACHE DOCUMENTATION]" /> 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/sitemap.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/sitemap.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/sitemap.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/sitemap.html	2002-06-18 11:46:44.000000000 +0800
@@ -87,13 +87,13 @@
 <li><a href="howto/ssi.html">Apache Tutorial: Introduction to Server
 Side Includes</a></li>
 <li><a href="misc/tutorials.html">Apache Tutorials</a></li>
 </ul></li>
 
 
-<li>Platfrom-specific Notes
+<li>Platform-specific Notes
 <ul>
 <li><a href="platform/windows.html">Using Apache with Microsoft
 Windows</a></li>
 <li><a href="platform/win_compiling.html">Compiling Apache for
 Microsoft Windows</a></li>
 <li><a href="platform/win_service.html">Running Apache for Windows as
@@ -127,38 +127,39 @@
 <li><a href="misc/descriptors.html">Descriptors and Apache</a></li>
 <li><a href="cgi_path.html">PATH_INFO Changes in the CGI Environment</a></li>
 </ul></li>
 
 <li><a href="mod/">Apache modules</a>
 <ul>
-<li><a href="mod/index-bytype.html">Apache modules - By Type</a></li>
 <li><a href="mod/directives.html">Apache directives</a></li>
 <li><a href="mod/module-dict.html">Definitions of terms used to describe Apache modules</a></li>
 <li><a href="mod/directive-dict.html">Definitions of terms used to describe Apache directives</a></li>
 <li><a href="mod/core.html">Apache Core Features</a></li>
 <li><a href="mod/mpm_common.html">Apache MPM Common Directives</a></li>
 <li><a href="mod/mpm_netware.html">Apache MPM netware</a></li>
 <li><a href="mod/mpm_winnt.html">Apache MPM winnt</a></li>
 <li><a href="mod/perchild.html">Apache MPM perchild</a></li>
 <li><a href="mod/prefork.html">Apache MPM prefork</a></li>
-<li><a href="mod/threaded.html">Apache MPM threaded</a></li>
+<li><a href="mod/worker.html">Apache MPM worker</a></li>
 <li><a href="mod/mod_access.html">Apache module mod_access</a></li>
 <li><a href="mod/mod_actions.html">Apache module mod_actions</a></li>
 <li><a href="mod/mod_alias.html">Apache module mod_alias</a></li>
 <li><a href="mod/mod_asis.html">Apache module mod_asis</a></li>
 <li><a href="mod/mod_auth.html">Apache module mod_auth</a></li>
 <li><a href="mod/mod_auth_anon.html">Apache module mod_auth_anon.c</a></li>
 <li><a href="mod/mod_auth_dbm.html">Apache module mod_auth_dbm</a></li>
 <li><a href="mod/mod_auth_digest.html">Apache module mod_auth_digest</a></li>
 <li><a href="mod/mod_auth_ldap.html">Apache module mod_ldap</a></li>
 <li><a href="mod/mod_autoindex.html">Apache module mod_autoindex</a></li>
+<li><a href="mod/mod_cache.html">Apache module mod_cache</a></li>
 <li><a href="mod/mod_cern_meta.html">Apache module mod_cern_meta</a></li>
 <li><a href="mod/mod_cgi.html">Apache module mod_cgi</a></li>
 <li><a href="mod/mod_cgid.html">Apache module mod_cgi</a></li>
 <li><a href="mod/mod_charset_lite.html">Apache module mod_charset_lite</a></li>
 <li><a href="mod/mod_dav.html">Apache module mod_dav</a></li>
+<li><a href="mod/mod_deflate.html">Apache module mod_deflate</a></li>
 <li><a href="mod/mod_dir.html">Apache module mod_dir</a></li>
 <li><a href="mod/mod_env.html">Apache module mod_env</a></li>
 <li><a href="mod/mod_example.html">Apache module mod_example</a></li>
 <li><a href="mod/mod_expires.html">Apache module mod_expires</a></li>
 <li><a href="mod/mod_ext_filter.html">Apache module mod_ext_filter</a></li>
 <li><a href="mod/mod_file_cache.html">Apache module mod_file_cache</a></li>
@@ -168,13 +169,12 @@
 <li><a href="mod/mod_info.html">Apache module mod_info</a></li>
 <li><a href="mod/mod_isapi.html">Apache module mod_isapi</a></li>
 <li><a href="mod/mod_ldap.html">Apache module mod_ldap</a></li>
 <li><a href="mod/mod_log_config.html">Apache module mod_log_config</a></li>
 <li><a href="mod/mod_mime.html">Apache module mod_mime</a></li>
 <li><a href="mod/mod_mime_magic.html">Apache module mod_mime_magic</a></li>
-<li><a href="mod/mod_mmap_static.html">Apache module mod_mmap_static</a></li>
 <li><a href="mod/mod_negotiation.html">Apache module mod_negotiation</a></li>
 <li><a href="mod/mod_proxy.html">Apache module mod_proxy</a></li>
 <li><a href="mod/mod_rewrite.html">Apache module mod_rewrite</a></li>
 <li><a href="mod/mod_setenvif.html">Apache module mod_setenvif</a></li>
 <li><a href="mod/mod_so.html">Apache module mod_so</a></li>
 <li><a href="mod/mod_speling.html">Apache module mod_speling</a></li>
@@ -193,12 +193,13 @@
 <li><a href="developer/debugging.html">Debugging Memory Allocation in APR</a></li>
 <li><a href="developer/documenting.html">Documenting Apache 2.0</a></li>
 <li><a href="developer/hooks.html">Apache 2.0 Hook Functions</a></li>
 <li><a href="developer/layeredio.html">Apache 2.0 Layered I/O</a></li>
 <li><a href="developer/modules.html">Converting Modules from Apache 1.3 to Apache 2.0</a></li>
 <li><a href="developer/request.html">Request Processing in Apache 2.0</a></li>
+<li><a href="developer/filters.html">How Filters Work in Apache 2.0</a></li>
 </ul></li>
 
 </ul></li>
 
 </ul>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/ssl: index.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/ssl: index.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/ssl: index.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/ssl/ssl_faq.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/ssl/ssl_faq.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/ssl/ssl_faq.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/ssl/ssl_faq.html	2002-06-18 11:46:44.000000000 +0800
@@ -90,13 +90,12 @@
 <li><a href="#ToC23">How to switch with relative hyperlinks?</a></li>
 </ul></li>
 <li><a href="#ToC24">About Certificates</a></li>
 <ul>
 <li><a href="#ToC25">What are Keys, CSRs and Certs?</a></li>
 <li><a href="#ToC26">Difference on startup?</a></li>
-<li><a href="#ToC27">How to create a dummy cert?</a></li>
 <li><a href="#ToC28">How to create a real cert?</a></li>
 <li><a href="#ToC29">How to create my own CA?</a></li>
 <li><a href="#ToC30">How to change a pass phrase?</a></li>
 <li><a href="#ToC31">How to remove a pass phrase?</a></li>
 <li><a href="#ToC32">How to verify a key/cert pair?</a></li>
 <li><a href="#ToC33">Bad Certificate Error?</a></li>
@@ -446,32 +445,26 @@
 <p>
 <li><a name="ToC15"></a>
     <a name="entropy"></a>
     <strong id="faq">
 When I fire up the server, mod_ssl stops with the error
 "Failed to generate temporary 512 bit RSA private key", why?
-And a "PRNG not seeded" error occurs if I try "make certificate".
 </strong>&nbsp;&nbsp;
     [<a href="#entropy"><b>L</b></a>]
     <p>
     Cryptographic software needs a source of unpredictable data
     to work correctly. Many open source operating systems provide
     a "randomness device" that serves this purpose (usually named
     <code>/dev/random</code>). On other systems, applications have to
     seed the OpenSSL Pseudo Random Number Generator (PRNG) manually with
     appropriate data before generating keys or performing public key
     encryption. As of version 0.9.5, the OpenSSL functions that need
     randomness report an error if the PRNG has not been seeded with
     at least 128 bits of randomness. So mod_ssl has to provide enough
-    entropy to the PRNG to work correctly. For this one has to use the
-    <code>SSLRandomSeed</code> directives (to solve the run-time problem)
-    and create a <code>$HOME/.rnd</code> file to make sure enough
-    entropy is available also for the "<code>make certificate</code>"
-    step (in case the "<code>make certificate</code>" procedure is not
-    able to gather enough entropy theirself by searching for system
-    files).
+    entropy to the PRNG to work correctly.  For this one has to use the
+    <code>SSLRandomSeed</code> directives.
 </ul>
 <p>
 <br>
 <h2><a name="ToC16">About Configuration</a></h2>
 <ul>
 <p>
@@ -636,36 +629,12 @@
     To type in the pass phrase manually when starting the server can be
     problematic, for instance when starting the server from the system boot
     scripts. As an alternative to this situation you can follow the steps
     below under ``How can I get rid of the pass-phrase dialog at Apache
     startup time?''.
 <p>
-<li><a name="ToC27"></a>
-    <a name="cert-dummy"></a>
-    <strong id="faq">
-How can I create a dummy SSL server Certificate for testing purposes?
-</strong>&nbsp;&nbsp;
-    [<a href="#cert-dummy"><b>L</b></a>]
-    <p>
-    A Certificate does not have to be signed by a public CA. You can use your
-    private key to sign the Certificate which contains your public key. You
-    can install this Certificate into your server, and people using Netscape
-    Navigator (not MSIE) will be able to connect after clicking OK to a
-    warning dialogue. You can get MSIE to work, and your customers can
-    eliminate the dialogue, by installing that Certificate manually into their
-    browsers.
-    <p>
-    Just use the ``<code>make certificate</code>'' command at the top-level
-    directory of the Apache source tree right before installing Apache via
-    ``<code>make install</code>''. This creates a self-signed SSL Certificate
-    which expires after 30 days and isn't encrypted (which means you don't
-    need to enter a pass-phrase at Apache startup time).
-    <p>
-    BUT REMEMBER: YOU REALLY HAVE TO CREATE A REAL CERTIFICATE FOR THE LONG
-    RUN! HOW THIS IS DONE IS DESCRIBED IN THE NEXT ANSWER.
-<p>
 <li><a name="ToC28"></a>
     <a name="cert-real"></a>
     <strong id="faq">
 Ok, I've got my server installed and want to create a real SSL
 server Certificate for it. How do I do it?
 </strong>&nbsp;&nbsp;
@@ -1100,14 +1069,14 @@
 </strong>&nbsp;&nbsp;
     [<a href="#cipher-shared"><b>L</b></a>]
     <p>
     Either you have messed up your <code>SSLCipherSuite</code>
     directive (compare it with the pre-configured example in
     <code>httpd.conf-dist</code>) or you have choosen the DSA/DH
-    algorithms instead of RSA under "<code>make certificate</code>"
-    and ignored or overseen the warnings. Because if you have choosen
+    algorithms instead of RSA when you generated your private key
+    and ignored or overlooked the warnings.  If you have choosen
     DSA/DH, then your server no longer speaks RSA-based SSL ciphers
     (at least not until you also configure an additional RSA-based
     certificate/key pair). But current browsers like NS or IE only speak
     RSA ciphers. The result is the "no shared ciphers" error. To fix
     this, regenerate your server certificate/key pair and this time
     choose the RSA algorithm.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/stopping.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/stopping.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/stopping.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/stopping.html	2002-06-18 11:46:44.000000000 +0800
@@ -27,13 +27,13 @@
     href="platform/windows.html#signal">Signalling Apache when
     running</a>.</p>
 
     <p>You will notice many <code>httpd</code> executables running
     on your system, but you should not send signals to any of them
     except the parent, whose pid is in the <a
-    href="mod/core.html#pidfile">PidFile</a>. That is to say you
+    href="mod/mpm_common.html#pidfile">PidFile</a>. That is to say you
     shouldn't ever need to send signals to any process except the
     parent. There are three signals that you can send the parent:
     <code>TERM</code>, <code>HUP</code>, and <code>USR1</code>,
     which will be described in a moment.</p>
 
     <p>To send a signal to the parent you should issue a command
@@ -50,13 +50,13 @@
 <pre>
     tail -f /usr/local/apache/logs/error_log
 </pre>
     </blockquote>
     Modify those examples to match your <a
     href="mod/core.html#serverroot">ServerRoot</a> and <a
-    href="mod/core.html#pidfile">PidFile</a> settings. 
+    href="mod/mpm_common.html#pidfile">PidFile</a> settings. 
 
     <p>A shell script called <a
     href="programs/apachectl.html">apachectl</a> is provided which
     automates the processing of signalling Apache. For details
     about this script, see the documentation on <a
     href="invoking.html">starting Apache</a>.</p>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/build.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/build.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/build.xml	2002-02-14 08:48:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/build.xml	2002-05-23 22:22:17.000000000 +0800
@@ -14,16 +14,21 @@
    description="Render HTML Pages via XSLT">
 
     <!-- Transform the modules directory -->
     <style   basedir="../mod/"
              destdir="../mod/"
            extension=".html"
-               style="./manual.xsl"
-            excludes="empty.xml"
+               style="./manual.en.xsl"
             includes="*.xml">
+      <mapper type="glob" from="*.xml" to="*.html.en"/>
+      <param name="relative-path" expression="."/>
+    </style>
+    <style   basedir="../mod/"
+             destdir="../mod/"
+           extension=".html"
+               style="./manual.ja.xsl"
+            includes="*.xml.ja">
+      <mapper type="glob" from="*.xml.ja" to="*.html.ja.jis"/>
       <param name="relative-path" expression="."/>
     </style>
   </target>
-
-
-
 </project>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style: common.xsl
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/en.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/en.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/en.xml	2002-03-06 23:57:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/en.xml	2002-05-26 00:57:17.000000000 +0800
@@ -1,24 +1,47 @@
 <?xml version="1.0" encoding="ISO-8859-1"?>
 <!DOCTYPE xsl:stylesheet [ <!ENTITY nbsp "&#160;"> ]>
-<!-- English -->
+
+<!--                   -->
+<!-- Language: English -->
+<!--                   -->
+
+<!-- Some strings might be used in other contexts, than stated in the -->
+<!-- comments...                                                      -->
 <messages>
- <message name="seealso">See also </message>
- <message name="description">Description</message>
+ <!-- Used for the moduleindex -->
+ <message name="corefeatures">Core Features and Multi-Processing Modules</message>
+ <message name="othermodules">Other Modules</message>
+
+ <!-- Title for modulesynopsis -->
  <message name="apachemodule">Apache Module</message>
+
+ <!-- Used in description box for modulesynopsis -->
+ <message name="description">Description</message>
+ <message name="seealso">See also </message>
  <message name="status">Status</message>
  <message name="moduleidentifier">Module&nbsp;Identifier</message>
  <message name="compatibility">Compatibility</message>
+
+ <!-- Used in description box for directives -->
  <message name="syntax">Syntax</message>
  <message name="default">Default</message>
  <message name="context">Context</message>
  <message name="override">Override</message>
  <message name="status">Status</message>
  <message name="module">Module</message>
- <message name="nodirective">This module provides no directives.</message>
- <message name="apachedocalt">[APACHE DOCUMENTATION]</message>
+
+ <!-- Used for directive lists -->
+ <message name="directives">Directives</message>
+ <message name="directive">Directive</message>
+ <message name="nodirectives">This module provides no directives.</message>
+
+ <!-- Used in summaries -->
+ <message name="summary">Summary</message>
+
+ <!-- Used in headers and footers -->
+ <message name="apachetitle">- Apache HTTP Server</message>
  <message name="apachehttpserver">Apache HTTP Server Version 2.0</message>
+ <message name="apachedocalt">[APACHE DOCUMENTATION]</message>
  <message name="index">Index</message>
  <message name="home">Home</message>
- <message name="directives">Directives</message>
- <message name="directive">Directive</message>
 </messages>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style: ja.xml
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style: manual.en.xsl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style: manual.ja.xsl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style: manual.xsl
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/modulesynopsis.dtd /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/modulesynopsis.dtd
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style/modulesynopsis.dtd	2002-03-12 23:24:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/style/modulesynopsis.dtd	2002-05-06 16:19:07.000000000 +0800
@@ -44,13 +44,14 @@
 <!ELEMENT seealso %Inline;>
 
 <!ELEMENT a %Inline;>
 
 <!ATTLIST a  href CDATA #IMPLIED 
              name CDATA #IMPLIED
-             id   CDATA #IMPLIED >
+             id   CDATA #IMPLIED
+             rel  CDATA #IMPLIED >
 
 <!ELEMENT img EMPTY>
 <!ATTLIST img
   src         CDATA   #REQUIRED
   alt         CDATA   #REQUIRED
   border      CDATA   #IMPLIED
@@ -127,7 +128,17 @@
 <!ELEMENT usage %Block;>
 
 <!ELEMENT summary %Block;>
 
 <!ELEMENT blockquote %BlockOrInline;>
 
-<!ELEMENT pre %Inline;>
\ No newline at end of file
+<!ELEMENT pre %Inline;>
+
+<!-- Used in allmodules.xml -->
+<!ELEMENT modulefilelist (modulefile+)>
+<!ELEMENT modulefile (#PCDATA)>
+
+<!-- Used in index.xml -->
+<!ELEMENT moduleindex (title | summary | modulefilelist)+>
+
+<!-- Used in directive.xml -->
+<!ELEMENT directiveindex (title | summary | modulefilelist)+>
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/style: settings.xsl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual: suexec.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: suexec.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: suexec.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: upgrading.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual: upgrading.html.ko.euc-kr
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/urlmapping.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/urlmapping.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/urlmapping.html	2002-05-02 04:53:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/urlmapping.html	2002-06-18 11:46:44.000000000 +0800
@@ -1,13 +1,11 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 
 <html xmlns="http://www.w3.org/1999/xhtml">
   <head>
-    <meta name="generator" content="HTML Tidy, see www.w3.org" />
-
     <title>Mapping URLs to Filesystem Locations - Apache HTTP
     Server</title>
   </head>
   <!-- Background white, links blue (unvisited), navy (visited), red (active) -->
 
   <body bgcolor="#FFFFFF" text="#000000" link="#0000FF"
@@ -34,23 +32,26 @@
       DocumentRoot</a></li>
 
       <li><a href="#user">User Directories</a></li>
 
       <li><a href="#redirect">URL Redirection</a></li>
 
+      <li><a href="#proxy">Reverse Proxy</a></li>
+
       <li><a href="#rewrite">Rewrite Engine</a></li>
 
       <li><a href="#notfound">File Not Found</a></li>
     </ul>
     <hr />
 
     <table border="1">
       <tr>
         <td valign="top"><strong>Related Modules</strong><br />
          <br />
          <a href="mod/mod_alias.html">mod_alias</a><br />
+         <a href="mod/mod_proxy.html">mod_proxy</a><br />
          <a href="mod/mod_rewrite.html">mod_rewrite</a><br />
          <a href="mod/mod_userdir.html">mod_userdir</a><br />
          <a href="mod/mod_speling.html">mod_speling</a><br />
          <a
         href="mod/mod_vhost_alias.html">mod_vhost_alias</a><br />
          </td>
@@ -64,12 +65,14 @@
         href="mod/mod_speling.html#checkspelling">CheckSpelling</a><br />
          <a
         href="mod/core.html#documentroot">DocumentRoot</a><br />
          <a
         href="mod/core.html#errordocument">ErrorDocument</a><br />
          <a href="mod/core.html#options">Options</a><br />
+         <a href="mod/mod_proxy.html#proxypass">ProxyPass</a><br />
+         <a href="mod/mod_proxy.html#proxypassreverse">ProxyPassReverse</a><br />
          <a href="mod/mod_alias.html#redirect">Redirect</a><br />
          <a
         href="mod/mod_alias.html#redirectmatch">RedirectMatch</a><br />
          <a
         href="mod/mod_rewrite.html#RewriteCond">RewriteCond</a><br />
          <a
@@ -141,13 +144,13 @@
     href="mod/mod_alias.html#aliasmatch">AliasMatch</a> and <a
     href="mod/mod_alias.html#scriptaliasmatch">ScriptAliasMatch</a>
     directives to do powerful regular-expression based matching and
     substitution. For example,</p>
 
     <blockquote>
-      <code>ScriptAliasMatch ^/~([^/]*)/cgi-bin/(.*)
+      <code>ScriptAliasMatch ^/~([a-zA-Z0-9]*)/cgi-bin/(.*)
       /home/$1/cgi-bin/$2</code>
     </blockquote>
 
     <p>will map a request to
     <code>http://example.com/~user/cgi-bin/script.cgi</code> to the
     path <code>/home/user/cgi-bin/script.cgi</code> and will treat
@@ -192,13 +195,13 @@
     to achieve the desired effect. For example, to make
     <code>http://www.example.com/upages/user/file.html</code> map
     to <code>/home/user/public_html/file.html</code>, use the
     following <code>AliasMatch</code> directive:</p>
 
     <blockquote>
-      <code>AliasMatch ^/upages/([^/]*)/?(.*)
+      <code>AliasMatch ^/upages/([a-zA-Z0-9]*)/?(.*)
       /home/$1/public_html/$2</code>
     </blockquote>
 
     <h2><a id="redirect" name="redirect">URL Redirection</a></h2>
 
     <p>The configuration directives discussed in the above sections
@@ -242,24 +245,58 @@
 
     <blockquote>
       <code>RedirectMatch temp .*
       http://www.example.com/startpage.html</code>
     </blockquote>
 
+
+<h2><a id="proxy" name="proxy">Reverse Proxy</a></h2>
+
+<p>Apache also allows you to bring remote documents into the URL space
+of the local server.  This technique is called <em>reverse
+proxying</em> because the web server acts like a proxy server by
+fetching the documents from a remote server and returning them to the
+client.  It is different from normal proxying because, to the client,
+it appears the documents originate at the reverse proxy server.</p>
+
+<p>In the following example, when clients request documents under the
+<code>/foo/</code> directory, the server fetches those documents from
+the <code>/bar/</code> directory on <code>internal.example.com</code>
+and returns them to the client as if they were from the local
+server.</p>
+
+<blockquote>
+ProxyPass /foo/ http://internal.example.com/bar/<br />
+ProxyPassReverse /foo/ http://internal.example.com/bar/
+</blockquote>
+
+<p>The <a href="mod/mod_proxy.html#proxypass">ProxyPass</a> configures
+the server to fetch the appropriate documents, while the <a
+href="mod/mod_proxy.html#proxypassreverse">ProxyPassReverse</a>
+directive rewrites redirects originating at
+<code>internal.examle.com</code> so that they target the appropriate
+directory on the local server.  It is important to note, however, that
+links inside the documents will not be rewritten.  So any absolute
+links on <code>internal.example.com</code> will result in the client
+breaking out of the proxy server and requesting directly from
+<code>internal.example.com</code>.</p>
+
+
     <h2><a id="rewrite" name="rewrite">Rewriting Engine</a></h2>
 
-    <p>When even more powerful substitution is required, the
-    rewriting engine provided by <a
-    href="mod/mod_rewrite.html">mod_rewrite</a> can be useful. The
-    directives provided by this module use characteristics of the
-    request such as browser type or source IP address in deciding
-    from where to serve content. In addition, mod_rewrite can use
-    external database files or programs to determine how to handle
-    a request. Many practical examples employing mod_rewrite are
-    discussed in the <a href="misc/rewriteguide.html">URL Rewriting
-    Guide</a>.</p>
+    <p>When even more powerful substitution is required, the rewriting
+    engine provided by <a href="mod/mod_rewrite.html">mod_rewrite</a>
+    can be useful. The directives provided by this module use
+    characteristics of the request such as browser type or source IP
+    address in deciding from where to serve content. In addition,
+    mod_rewrite can use external database files or programs to
+    determine how to handle a request. The rewriting engine is capable
+    of performing all three types of mappings discussed above:
+    internal redirects (aliases), external redirects, and proxying.
+    Many practical examples employing mod_rewrite are discussed in the
+    <a href="misc/rewriteguide.html">URL Rewriting Guide</a>.</p>
 
     <h2><a id="notfound" name="notfound">File Not Found</a></h2>
 
     <p>Inevitably, URLs will be requested for which no matching
     file can be found in the filesystem. This can happen for
     several reasons. In some cases, it can be a result of moving
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/vhosts/examples.html /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts/examples.html
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/vhosts/examples.html	2002-05-02 04:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts/examples.html	2002-06-18 11:46:44.000000000 +0800
@@ -625,13 +625,12 @@
     a client which sent a correct <CODE>Host:</CODE> header can use
     both URL variants, <EM>i.e.</EM>, with or without URL prefix.
     </BLOCKQUOTE>
 
 </UL> 
 
-<LI><STRONG>Setup:</STRONG>
     <hr />
 
     <h3 align="CENTER">Apache HTTP Server Version 2.0</h3>
     <a href="./"><img src="../images/index.gif" alt="Index" /></a>
     <a href="../"><img src="../images/home.gif" alt="Home" /></a>
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/vhosts: fd-limits.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: fd-limits.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: fd-limits.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/vhosts: index.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: index.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: index.html.ja.jis
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/manual/vhosts: name-based.html
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: name-based.html.en
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/manual/vhosts: name-based.html.ja.jis
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/STATUS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/STATUS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/docs/STATUS	2002-03-30 03:22:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/docs/STATUS	2002-06-11 08:19:17.000000000 +0800
@@ -1,8 +1,8 @@
 Apache HTTP Server 2.0 Documentation Status File.
-Last modified: $Date: 2002/03/29 19:22:47 $
+Last modified: $Date: 2002/06/11 00:19:17 $
 
 If you are interested in helping accomplish some of the tasks on this
 list or otherwise improving the documentation, please join the
 apache-docs mailing list by mailing to 
 apache-docs-subscribe@apache.org
 
@@ -81,25 +81,22 @@
     - Spanish (.es)
     - Estonian (.et)
     - French (.fr)
     - Hebrew (.he.iso8859-8)
     - Italian (.it)
     - Japanese (.ja.iso2022-jp, .ja.jis)
-    - Korean (.kr.iso2022-kr, .kt.iso-kr)
-    - ? (.ltz)
-    - ? (.lu)
+    - Korean (.ko.euc-kr)
+    - Luxembourgish (.lb)
     - Dutch (.nl)
     - Norwegian (.no)
     - Polish (.po.iso-pl)
     - Portuguese (.pt)
     - Portuguese [Brasilian] (.pt-br)
     - Russian (.ru.cp-1251, .ru.cp866, .ru.iso-ru, .ru.koi8-r, .ru.ucs[248])
     - Swedish (.se)
-    - Twi (.tw, .tw.big5)
-      (is that supposed to be Chinese/Taiwanese?  Because if so, it is using
-      the code reserved for Twi..)
+    - Chinese (.zh)
     [Need this clarified --jsl]
 
 
 New User documentation
 ======================
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include: ap_config_auto.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include: ap_config_layout.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/ap_mmn.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/ap_mmn.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/ap_mmn.h	2002-04-29 20:51:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/ap_mmn.h	2002-06-13 07:59:29.000000000 +0800
@@ -101,40 +101,47 @@
  * 20020306 (2.0.34-dev) bump for filter type renames.
  * 20020318 (2.0.34-dev) mod_dav's API for REPORT generation changed
  * 20020319 (2.0.34-dev) M_INVALID changed, plus new M_* methods for RFC 3253
  * 20020327 (2.0.35-dev) Add parameter to quick_handler hook
  * 20020329 (2.0.35-dev) bump for addition of freelists to bucket API
  * 20020329.1 (2.0.36) minor bump for new arg to opt fn ap_cgi_build_command
+ * 20020506 (2.0.37-dev) Removed r->boundary in request_rec.
+ * 20020529 (2.0.37-dev) Standardized the names of some apr_pool_*_set funcs
+ * 20020602 (2.0.37-dev) Bucket API change (metadata buckets)
+ * 20020612 (2.0.38-dev) Changed server_rec->[keep_alive_]timeout to apr time
  */
 
 #define MODULE_MAGIC_COOKIE 0x41503230UL /* "AP20" */
 
 #ifndef MODULE_MAGIC_NUMBER_MAJOR
-#define MODULE_MAGIC_NUMBER_MAJOR 20020329
+#define MODULE_MAGIC_NUMBER_MAJOR 20020612
 #endif
 #define MODULE_MAGIC_NUMBER_MINOR 1                     /* 0...n */
-#define MODULE_MAGIC_NUMBER MODULE_MAGIC_NUMBER_MAJOR	/* backward compat */
 
 /**
  * Determine if the server's current MODULE_MAGIC_NUMBER is at least a
  * specified value.
  * <pre>
  * Useful for testing for features.
  * For example, suppose you wish to use the apr_table_overlap
  *    function.  You can do this:
  * 
- * #if MODULE_MAGIC_AT_LEAST(19980812,2)
+ * #if AP_MODULE_MAGIC_AT_LEAST(19980812,2)
  *     ... use apr_table_overlap()
  * #else
  *     ... alternative code which doesn't use apr_table_overlap()
  * #endif
  * </pre>
  * @param major The major module magic number
  * @param minor The minor module magic number
- * @deffunc MODULE_MAGIC_AT_LEAST(int major, int minor)
+ * @deffunc AP_MODULE_MAGIC_AT_LEAST(int major, int minor)
  */
-#define MODULE_MAGIC_AT_LEAST(major,minor)		\
-    ((major) > MODULE_MAGIC_NUMBER_MAJOR 		\
+#define AP_MODULE_MAGIC_AT_LEAST(major,minor)		\
+    ((major) < MODULE_MAGIC_NUMBER_MAJOR 		\
 	|| ((major) == MODULE_MAGIC_NUMBER_MAJOR 	\
-	    && (minor) >= MODULE_MAGIC_NUMBER_MINOR))
+	    && (minor) <= MODULE_MAGIC_NUMBER_MINOR))
+
+/** @deprecated present for backwards compatibility */
+#define MODULE_MAGIC_NUMBER MODULE_MAGIC_NUMBER_MAJOR
+#define MODULE_MAGIC_AT_LEAST old_broken_macro_we_hope_you_are_not_using
 
 #endif /* !APACHE_AP_MMN_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/ap_release.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/ap_release.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/ap_release.h	2002-04-25 20:04:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/ap_release.h	2002-06-18 00:06:06.000000000 +0800
@@ -70,11 +70,11 @@
  * advertizing or other non-essential information is explicitly forbidden."
  *
  * Example: "Apache/1.1.0 MrWidget/0.1-alpha" 
  */
 #define AP_SERVER_BASEVENDOR "Apache Software Foundation"
 #define AP_SERVER_BASEPRODUCT "Apache"
-#define AP_SERVER_BASEREVISION "2.0.36"
+#define AP_SERVER_BASEREVISION "2.0.39"
 #define AP_SERVER_BASEVERSION AP_SERVER_BASEPRODUCT "/" AP_SERVER_BASEREVISION
 #define AP_SERVER_VERSION  AP_SERVER_BASEVERSION
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_core.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_core.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_core.h	2002-04-06 04:55:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_core.h	2002-05-12 07:24:29.000000000 +0800
@@ -512,12 +512,21 @@
     /*
      * What attributes/data should be included in ETag generation?
      */
     etag_components_t etag_bits;
     etag_components_t etag_add;
     etag_components_t etag_remove;
+
+    /*
+     * Run-time performance tuning
+     */
+#define ENABLE_MMAP_OFF    (0)
+#define ENABLE_MMAP_ON     (1)
+#define ENABLE_MMAP_UNSET  (2)
+    int enable_mmap;  /* whether files in this dir can be mmap'ed */
+
 } core_dir_config;
 
 /* Per-server core configuration */
 
 typedef struct {
   
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/httpd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/httpd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/httpd.h	2002-03-29 16:17:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/httpd.h	2002-06-16 03:19:42.000000000 +0800
@@ -626,17 +626,17 @@
 /**
  * @defgroup values_request_rec_used_path_info Possible values for request_rec.used_path_info 
  * @{
  * Possible values for request_rec.used_path_info:
  */
 
-/** Accept request given path_info */
-#define AP_REQ_ACCEPT_PATH_INFO     0
-/** Send 404 error if path_info was given */
+/** Accept the path_info from the request */
+#define AP_REQ_ACCEPT_PATH_INFO    0
+/** Return a 404 error if path_info was given */
 #define AP_REQ_REJECT_PATH_INFO    1
-/** Module's choice for handling path_info */
+/** Module may chose to use the given path_info */
 #define AP_REQ_DEFAULT_PATH_INFO   2
 /** @} */
 
 /*
  * Things which may vary per file-lookup WITHIN a request ---
  * e.g., state of MIME config.  Basically, the name of an object, info
@@ -686,83 +686,81 @@
 /* ### would be nice to not include this from httpd.h ... */
 /* This comes after we have defined the request_rec type */
 #include "apr_uri.h"
 
 /** A structure that represents one process */
 struct process_rec {
-    /** Global pool. Please try to cleared on _all_ exits */
+    /** Global pool. Cleared upon normal exit */
     apr_pool_t *pool;
-    /** aka configuration pool, cleared on restarts */
+    /** Configuration pool. Cleared upon restart */
     apr_pool_t *pconf;
-    /** How many command line arguments were pass to the program */
+    /** Number of command line arguments passed to the program */
     int argc;
     /** The command line arguments */
     const char * const *argv;
     /** The program name used to execute the program */
     const char *short_name;
 };
 
 /** A structure that represents the current request */
 struct request_rec {
     /** The pool associated with the request */
     apr_pool_t *pool;
-    /** The connection over which this connection has been read */
+    /** The connection to the client */
     conn_rec *connection;
-    /** The virtual host this request is for */
+    /** The virtual host for this request */
     server_rec *server;
 
-    /** If we wind up getting redirected, pointer to the request we 
-     *  redirected to.  */
+    /** Pointer to the redirected request if this is an external redirect */
     request_rec *next;
-    /** If this is an internal redirect, pointer to where we redirected 
-     *  *from*.  */
+    /** Pointer to the previous request if this is an internal redirect */
     request_rec *prev;
 
-    /** If this is a sub_request (see request.h) pointer back to the 
-     *  main request.  */
+    /** Pointer to the main request if this is a sub-request (see request.h) */
     request_rec *main;
 
     /* Info about the request itself... we begin with stuff that only
      * protocol.c should ever touch...
      */
-    /** First line of request, so we can log it */
+    /** First line of request */
     char *the_request;
     /** HTTP/0.9, "simple" request (e.g. GET /foo\n w/no headers) */
     int assbackwards;
     /** A proxy request (calculated during post_read_request/translate_name)
-     *  possible values PROXYREQ_NONE, PROXYREQ_PROXY, PROXYREQ_REVERSE
+     *  possible values PROXYREQ_NONE, PROXYREQ_PROXY, PROXYREQ_REVERSE,
+     *                  PROXYREQ_RESPONSE
      */
     int proxyreq;
     /** HEAD request, as opposed to GET */
     int header_only;
-    /** Protocol, as given to us, or HTTP/0.9 */
+    /** Protocol string, as given to us, or HTTP/0.9 */
     char *protocol;
-    /** Number version of protocol; 1.1 = 1001 */
+    /** Protocol version number of protocol; 1.1 = 1001 */
     int proto_num;
     /** Host, as set by full URI or Host: */
     const char *hostname;
 
-    /** When the request started */
+    /** Time when the request started */
     apr_time_t request_time;
 
     /** Status line, if set by script */
     const char *status_line;
-    /** In any case */
+    /** Status line */
     int status;
 
     /* Request method, two ways; also, protocol, etc..  Outside of protocol.c,
      * look, but don't touch.
      */
 
-    /** GET, HEAD, POST, etc. */
+    /** Request method (eg. GET, HEAD, POST, etc.) */
     const char *method;
     /** M_GET, M_POST, etc. */
     int method_number;
 
     /**
-     *  allowed is a bitvector of the allowed methods.
+     *  'allowed' is a bitvector of the allowed methods.
      *
      *  A handler must ensure that the request method is one that
      *  it is capable of handling.  Generally modules should DECLINE
      *  any request methods they do not handle.  Prior to aborting the
      *  handler like this the handler should set r->allowed to the list
      *  of methods that it is willing to handle.  This bitvector is used
@@ -785,31 +783,31 @@
     ap_method_list_t *allowed_methods; 
 
     /** byte count in stream is for body */
     apr_off_t sent_bodyct;
     /** body byte count, for easy access */
     apr_off_t bytes_sent;
-    /** Time the resource was last modified */
+    /** Last modified time of the requested resource */
     apr_time_t mtime;
 
     /* HTTP/1.1 connection-level features */
 
     /** sending chunked transfer-coding */
     int chunked;
-    /** multipart/byteranges boundary */
-    const char *boundary;
     /** The Range: header */
     const char *range;
     /** The "real" content length */
     apr_off_t clength;
 
-    /** bytes left to read */
+    /** Remaining bytes left to read from the request body */
     apr_off_t remaining;
-    /** bytes that have been read */
+    /** Number of bytes that have been read  from the request body */
     apr_off_t read_length;
-    /** how the request body should be read */
+    /** Method for reading the request body
+     * (eg. REQUEST_CHUNKED_ERROR, REQUEST_NO_BODY,
+     *  REQUEST_CHUNKED_DECHUNK, etc...) */
     int read_body;
     /** reading chunked transfer-coding */
     int read_chunked;
     /** is client waiting for a 100 response? */
     unsigned expecting_100;
 
@@ -841,59 +839,61 @@
      * MUST be lowercased strings.  They may be pointers to static strings;
      * they should not be modified in place.
      */
     /** The content-type for the current request */
     const char *content_type;	/* Break these out --- we dispatch on 'em */
     /** The handler string that we use to call a handler function */
-    const char *handler;	/* What we *really* dispatch on           */
+    const char *handler;	/* What we *really* dispatch on */
 
     /** How to encode the data */
     const char *content_encoding;
-    /** array of (char*) representing the content languages */
+    /** Array of strings representing the content languages */
     apr_array_header_t *content_languages;
 
     /** variant list validator (if negotiated) */
     char *vlist_validator;
     
     /** If an authentication check was made, this gets set to the user name. */
     char *user;	
     /** If an authentication check was made, this gets set to the auth type. */
     char *ap_auth_type;
 
-    /** This response is non-cache-able */
+    /** This response can not be cached */
     int no_cache;
     /** There is no local copy of this response */
     int no_local_copy;
 
     /* What object is being requested (either directly, or via include
      * or content-negotiation mapping).
      */
 
-    /** the uri without any parsing performed */
+    /** The URI without any parsing performed */
     char *unparsed_uri;	
-    /** the path portion of the URI */
+    /** The path portion of the URI */
     char *uri;
-    /** The filename on disk that this response corresponds to */
+    /** The filename on disk corresponding to this response */
     char *filename;
+    /* XXX: What does this mean? Please define "canonicalize" -aaron */
     /** The true filename, we canonicalize r->filename if these don't match */
     char *canonical_filename;
-    /** The path_info for this request if there is any. */
+    /** The PATH_INFO extracted from this request */
     char *path_info;
-    /** QUERY_ARGS, if any */
+    /** The QUERY_ARGS extracted from this request */
     char *args;	
     /** ST_MODE set to zero if no such file */
     apr_finfo_t finfo;
-    /** components of uri, dismantled */
+    /** A struct containing the components of URI */
     apr_uri_t parsed_uri;
 
-    /** Flag for the handler to accept or reject path_info on 
-     *  the current request.  All modules should respect the
-     *  AP_REQ_ACCEPT_PATH_INFO and AP_REQ_REJECT_PATH_INFO 
-     *  values, while AP_REQ_DEFAULT_PATH_INFO indicates they
-     *  may follow existing conventions.  This is set to the
-     *  user's preference upon HOOK_VERY_FIRST of the fixups.
+    /**
+     * Flag for the handler to accept or reject path_info on 
+     * the current request.  All modules should respect the
+     * AP_REQ_ACCEPT_PATH_INFO and AP_REQ_REJECT_PATH_INFO 
+     * values, while AP_REQ_DEFAULT_PATH_INFO indicates they
+     * may follow existing conventions.  This is set to the
+     * user's preference upon HOOK_VERY_FIRST of the fixups.
      */
     int used_path_info;
 
     /* Various other config info which may change with .htaccess files
      * These are config vectors, with one void* pointer for each module
      * (the thing pointed to being the module's business).
@@ -901,18 +901,18 @@
 
     /** Options set in config files, etc. */
     struct ap_conf_vector_t *per_dir_config;
     /** Notes on *this* request */
     struct ap_conf_vector_t *request_config;
 
-/**
- * a linked list of the configuration directives in the .htaccess files
- * accessed by this request.
- * N.B. always add to the head of the list, _never_ to the end.
- * that way, a sub request's list can (temporarily) point to a parent's list
- */
+    /**
+     * A linked list of the .htaccess configuration directives
+     * accessed by this request.
+     * N.B. always add to the head of the list, _never_ to the end.
+     * that way, a sub request's list can (temporarily) point to a parent's list
+     */
     const struct htaccess_result *htaccess;
 
     /** A list of output filters to be used for this request */
     struct ap_filter_t *output_filters;
     /** A list of input filters to be used for this request */
     struct ap_filter_t *input_filters;
@@ -944,12 +944,13 @@
  * @{
  */
 
 #define PROXYREQ_NONE 0		/**< No proxy */
 #define PROXYREQ_PROXY 1	/**< Standard proxy */
 #define PROXYREQ_REVERSE 2	/**< Reverse proxy */
+#define PROXYREQ_RESPONSE 3 /**< Origin response */
 
 /* @} */
 
 
 /** Structure to store things which are per connection */
 struct conn_rec {
@@ -1075,16 +1076,16 @@
     struct ap_conf_vector_t *lookup_defaults;
 
     /* Transaction handling */
 
     /** I haven't got a clue */
     server_addr_rec *addrs;
-    /** Timeout, in seconds, before we give up */
-    int timeout;
-    /** Seconds we'll wait for another request */
-    int keep_alive_timeout;
+    /** Timeout, as an apr interval, before we give up */
+    apr_interval_time_t timeout;
+    /** The apr interval we will wait for another request */
+    apr_interval_time_t keep_alive_timeout;
     /** Maximum requests per connection */
     int keep_alive_max;
     /** Use persistent connections? */
     int keep_alive;
 
     /** Pathname for ServerPath */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_log.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_log.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_log.h	2002-04-22 11:25:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_log.h	2002-06-05 03:01:05.000000000 +0800
@@ -99,16 +99,28 @@
 #define	APLOG_DEBUG	7	/* debug-level messages */
 
 #define	APLOG_LEVELMASK	7	/* mask off the level value */
 
 #endif
 
+/* APLOG_NOERRNO is ignored and should not be used.  It will be
+ * removed in a future release of Apache.
+ */
 #define APLOG_NOERRNO		(APLOG_LEVELMASK + 1)
 
-/* Use APLOG_TOCLIENT to cause ap_log_rerror() to send the message
- * to the client in addition to recording it to the error log.
+/* Use APLOG_TOCLIENT on ap_log_rerror() to give content
+ * handlers the option of including the error text in the 
+ * ErrorDocument sent back to the client. Setting APLOG_TOCLIENT
+ * will cause the error text to be saved in the request_rec->notes 
+ * table, keyed to the string "error-notes", iff:
+ * - the severity level of the message is APLOG_WARNING or greater
+ * - there are no other "error-notes" set in request_rec->notes
+ * Once error-notes is set, it is up to the content handler to
+ * determine whether this text should be send back to the client.
+ * Note: Client generated text streams sent back to the  client MUST 
+ * be escaped to prevent CSS attacks.
  */
 #define APLOG_TOCLIENT          (APLOG_LEVELMASK + 2)
 
 /* normal but significant condition on startup, usually printed to stderr */
 #define APLOG_STARTUP           ((APLOG_LEVELMASK + 1) * 4) 
 
@@ -234,12 +246,20 @@
  * Log the current pid of the parent process
  * @param p The pool to use for logging
  * @param fname The name of the file to log to
  */
 AP_DECLARE(void) ap_log_pid(apr_pool_t *p, const char *fname);
 
+/**
+ * Retrieve the pid from a pidfile.
+ * @param p The pool to use for logging
+ * @param filename The name of the file containing the pid
+ * @param mypid Pointer to pid_t (valid only if return APR_SUCCESS)
+ */
+AP_DECLARE(apr_status_t) ap_read_pid(apr_pool_t *p, const char *filename, pid_t *mypid);
+
 typedef struct piped_log piped_log;
 
 /**
  * The piped logging structure.  Piped logs are used to move functionality
  * out of the main server.  For example, log rotation is done with piped logs.
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_main.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_main.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_main.h	2002-04-18 00:36:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_main.h	2002-05-23 20:58:36.000000000 +0800
@@ -56,12 +56,14 @@
  * University of Illinois, Urbana-Champaign.
  */
 
 #ifndef APACHE_HTTP_MAIN_H
 #define APACHE_HTTP_MAIN_H
 
+#include "apr_optional.h"
+
 /* AP_SERVER_BASEARGS is the command argument list parsed by http_main.c
  * in apr_getopt() format.  Use this for default'ing args that the MPM
  * can safely ignore and pass on from its rewrite_args() handler.
  */
 #define AP_SERVER_BASEARGS "C:c:D:d:E:e:f:vVlLth?X"
 
@@ -86,11 +88,13 @@
  *  config file */
 AP_DECLARE_DATA extern apr_array_header_t *ap_server_post_read_config;
 /** An array of all -D defines on the command line.  This allows people to
  *  effect the server based on command line options */
 AP_DECLARE_DATA extern apr_array_header_t *ap_server_config_defines;
 
+APR_DECLARE_OPTIONAL_FN(int, ap_signal_server, (int *, apr_pool_t *));
+
 #ifdef __cplusplus
 }
 #endif
 
 #endif	/* !APACHE_HTTP_MAIN_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_protocol.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_protocol.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/http_protocol.h	2002-04-20 00:04:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/http_protocol.h	2002-05-31 13:03:09.000000000 +0800
@@ -160,13 +160,23 @@
  *    - then, if there are no parameters on type, add the default charset
  *    - return type
  * @param r The current request
  * @return The content-type
  * @deffunc const char *ap_make_content_type(request_rec *r, const char *type);
  */ 
-AP_DECLARE(const char *) ap_make_content_type(request_rec *r, const char *type);
+AP_DECLARE(const char *) ap_make_content_type(request_rec *r,
+                                              const char *type);
+
+#ifdef CORE_PRIVATE
+/**
+ * Precompile metadata structures used by ap_make_content_type()
+ * @param r The pool to use for allocations
+ * @deffunc void ap_setup_make_content_type(apr_pool_t *pool)
+ */
+AP_DECLARE(void) ap_setup_make_content_type(apr_pool_t *pool);
+#endif /* CORE_PRIVATE */
 
 /**
  * Construct an entity tag from the resource information.  If it's a real
  * file, build in some of the file characteristics.
  * @param r The current request
  * @param force_weak Force the entity tag to be weak - it could be modified
@@ -645,21 +655,30 @@
  * This bucket can be passed down the filter stack to indicate that an
  * HTTP error occurred while running a filter.  In order for this bucket
  * to be used successfully, it MUST be sent as the first bucket in the
  * first brigade to be sent from a given filter.
  */
 struct ap_bucket_error {
+    /** Number of buckets using this memory */
+    apr_bucket_refcount refcount;
     /** The error code */
     int status;
     /** The error string */
     const char    *data;
 };
 
 AP_DECLARE_DATA extern const apr_bucket_type_t ap_bucket_type_error;
 
 /**
+ * Determine if a bucket is an error bucket
+ * @param e The bucket to inspect
+ * @return true or false
+ */
+#define AP_BUCKET_IS_ERROR(e)         (e->type == &ap_bucket_type_error)
+
+/**
  * Make the bucket passed in an error bucket
  * @param b The bucket to make into an error bucket
  * @param error The HTTP error code to put in the bucket. 
  * @param buf An optional error string to put in the bucket.
  * @param p A pool to allocate out of.
  * @return The new bucket, or NULL if allocation failed
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/mpm_common.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/mpm_common.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/mpm_common.h	2002-03-30 00:21:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/mpm_common.h	2002-05-23 20:58:37.000000000 +0800
@@ -277,11 +277,16 @@
 #ifdef AP_MPM_WANT_SET_COREDUMPDIR
 extern char ap_coredump_dir[MAX_STRING_LEN];
 const char *ap_mpm_set_coredumpdir(cmd_parms *cmd, void *dummy,
                                    const char *arg);
 #endif
 
+#ifdef AP_MPM_WANT_SIGNAL_SERVER
+int ap_signal_server(int *, apr_pool_t *);
+void ap_mpm_rewrite_args(process_rec *);
+#endif
+
 #ifdef __cplusplus
 }
 #endif
 
 #endif /* !APACHE_MPM_COMMON_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/util_filter.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/util_filter.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/include/util_filter.h	2002-03-14 04:47:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/include/util_filter.h	2002-06-08 11:05:06.000000000 +0800
@@ -160,15 +160,19 @@
  *
  * The return value of a filter should be an APR status value.
  * 
  * @ingroup filter
  * @{
  */
-typedef apr_status_t (*ap_out_filter_func)(ap_filter_t *f, apr_bucket_brigade *b);
-typedef apr_status_t (*ap_in_filter_func)(ap_filter_t *f, apr_bucket_brigade *b, 
-                                          ap_input_mode_t mode, apr_read_type_e block, apr_off_t readbytes);
+typedef apr_status_t (*ap_out_filter_func)(ap_filter_t *f,
+                                           apr_bucket_brigade *b);
+typedef apr_status_t (*ap_in_filter_func)(ap_filter_t *f,
+                                          apr_bucket_brigade *b, 
+                                          ap_input_mode_t mode,
+                                          apr_read_type_e block,
+                                          apr_off_t readbytes);
 
 typedef union ap_filter_func {
     ap_out_filter_func out_func;
     ap_in_filter_func in_func;
 } ap_filter_func;
 
@@ -300,13 +304,14 @@
  * Pass the current bucket brigade down to the next filter on the filter
  * stack.  The filter returns an apr_status_t value.  If the bottom-most 
  * filter doesn't write to the network, then ::AP_NOBODY_WROTE is returned.
  * @param filter The next filter in the chain
  * @param bucket The current bucket brigade
  */
-AP_DECLARE(apr_status_t) ap_pass_brigade(ap_filter_t *filter, apr_bucket_brigade *bucket);
+AP_DECLARE(apr_status_t) ap_pass_brigade(ap_filter_t *filter,
+                                         apr_bucket_brigade *bucket);
 
 /**
  * This function is used to register an input filter with the system. 
  * After this registration is performed, then a filter may be added 
  * into the filter chain by using ap_add_input_filter() and simply 
  * specifying the name.
@@ -444,22 +449,24 @@
  * @param save_to The brigade that was previously set-aside.  Regardless, the
  *             new bucket brigade is returned in this location.
  * @param b The bucket brigade to save aside.  This brigade is always empty
  *          on return
  * @param p Ensure that all data in the brigade lives as long as this pool
  */
-AP_DECLARE(apr_status_t) ap_save_brigade(ap_filter_t *f, apr_bucket_brigade **save_to,
+AP_DECLARE(apr_status_t) ap_save_brigade(ap_filter_t *f,
+                                         apr_bucket_brigade **save_to,
                                          apr_bucket_brigade **b, apr_pool_t *p);    
 
 /**
  * Flush function for apr_brigade_* calls.  This calls ap_pass_brigade
  * to flush the brigade if the brigade buffer overflows.
  * @param bb The brigade to flush
  * @param ctx The filter to pass the brigade to
  */
-AP_DECLARE_NONSTD(apr_status_t) ap_filter_flush(apr_bucket_brigade *bb, void *ctx);
+AP_DECLARE_NONSTD(apr_status_t) ap_filter_flush(apr_bucket_brigade *bb,
+                                                void *ctx);
 
 /**
  * Flush the current brigade down the filter stack.
  * @param f The current filter
  * @param bb The brigade to flush
  */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39: LAYOUT
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/libhttpd.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/libhttpd.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/libhttpd.dsp	2002-04-17 11:02:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/libhttpd.dsp	2002-06-06 09:05:34.000000000 +0800
@@ -195,31 +195,29 @@
 SOURCE=.\server\gen_test_char.exe
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
 USERDEP__WIN32=".\include\os.h"	
-# Begin Custom Build - Generating test_char.h
+# Begin Custom Build - Generating test_char.h from gen_test_char.exe
 InputPath=.\server\gen_test_char.exe
 
 ".\server\test_char.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\server\gen_test_char.exe >.\server\test_char.h 
-	echo Generated test_char.h from gen_test_char.exe 
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
 USERDEP__WIN32=".\include\os.h"	
-# Begin Custom Build - Generating test_char.h
+# Begin Custom Build - Generating test_char.h from gen_test_char.exe
 InputPath=.\server\gen_test_char.exe
 
 ".\server\test_char.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\server\gen_test_char.exe >.\server\test_char.h 
-	echo Generated test_char.h from gen_test_char.exe 
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -227,30 +225,57 @@
 
 SOURCE=.\modules\http\mod_core.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_core.h
+# Begin Custom Build - Creating include/mod_core.h
 InputPath=.\modules\http\mod_core.h
 
 ".\include\mod_core.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\http\mod_core.h .\include
-	echo Created mod_core.h
+	type .\modules\http\mod_core.h > .\include\mod_core.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_core.h
+# Begin Custom Build - Creating include/mod_core.h
 InputPath=.\modules\http\mod_core.h
 
 ".\include\mod_core.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\http\mod_core.h .\include
-	echo Created mod_core.h
+	type .\modules\http\mod_core.h > .\include\mod_core.h
+	
+# End Custom Build
+
+!ENDIF 
+
+# End Source File
+# Begin Source File
+
+SOURCE=.\modules\generators\mod_cgi.h
+
+!IF  "$(CFG)" == "libhttpd - Win32 Release"
+
+# PROP Ignore_Default_Tool 1
+# Begin Custom Build - Creating include/mod_cgi.h
+InputPath=.\modules\generators\mod_cgi.h
+
+".\include\mod_cgi.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\modules\generators\mod_cgi.h > .\include\mod_cgi.h
+	
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
+
+# PROP Ignore_Default_Tool 1
+# Begin Custom Build - Creating include/mod_cgi.h
+InputPath=.\modules\generators\mod_cgi.h
+
+".\include\mod_cgi.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\modules\generators\mod_cgi.h > .\include\mod_cgi.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -258,30 +283,57 @@
 
 SOURCE=.\modules\dav\main\mod_dav.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_dav.h
+# Begin Custom Build - Creating include/mod_dav.h
 InputPath=.\modules\dav\main\mod_dav.h
 
 ".\include\mod_dav.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\dav\main\mod_dav.h .\include
-	echo Created mod_dav.h
+	type .\modules\dav\main\mod_dav.h > .\include\mod_dav.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_dav.h
+# Begin Custom Build - Creating include/mod_dav.h
 InputPath=.\modules\dav\main\mod_dav.h
 
 ".\include\mod_dav.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\dav\main\mod_dav.h .\include
-	echo Created mod_dav.h
+	type .\modules\dav\main\mod_dav.h > .\include\mod_dav.h
+	
+# End Custom Build
+
+!ENDIF 
+
+# End Source File
+# Begin Source File
+
+SOURCE=.\modules\filters\mod_include.h
+
+!IF  "$(CFG)" == "libhttpd - Win32 Release"
+
+# PROP Ignore_Default_Tool 1
+# Begin Custom Build - Creating include/mod_include.h
+InputPath=.\modules\filters\mod_include.h
+
+".\include\mod_include.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\modules\filters\mod_include.h > .\include\mod_include.h
+	
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
+
+# PROP Ignore_Default_Tool 1
+# Begin Custom Build - Creating include/mod_include.h
+InputPath=.\modules\filters\mod_include.h
+
+".\include\mod_include.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\modules\filters\mod_include.h > .\include\mod_include.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -289,30 +341,28 @@
 
 SOURCE=.\modules\proxy\mod_proxy.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_proxy.h
+# Begin Custom Build - Creating include/mod_proxy.h
 InputPath=.\modules\proxy\mod_proxy.h
 
 ".\include\mod_proxy.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\proxy\mod_proxy.h .\include
-	echo Created mod_proxy.h
+	type .\modules\proxy\mod_proxy.h > .\include\mod_proxy.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mod_proxy.h
+# Begin Custom Build - Creating include/mod_proxy.h
 InputPath=.\modules\proxy\mod_proxy.h
 
 ".\include\mod_proxy.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\modules\proxy\mod_proxy.h .\include
-	echo Created mod_proxy.h
+	type .\modules\proxy\mod_proxy.h > .\include\mod_proxy.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -320,30 +370,28 @@
 
 SOURCE=.\server\mpm\winnt\mpm.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mpm.h
+# Begin Custom Build - Creating include/mpm.h
 InputPath=.\server\mpm\winnt\mpm.h
 
 ".\include\mpm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\server\mpm\winnt\mpm.h .\include
-	echo Created mpm.h
+	type .\server\mpm\winnt\mpm.h > .\include\mpm.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mpm.h
+# Begin Custom Build - Creating include/mpm.h
 InputPath=.\server\mpm\winnt\mpm.h
 
 ".\include\mpm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\server\mpm\winnt\mpm.h .\include
-	echo Created mpm.h
+	type .\server\mpm\winnt\mpm.h > .\include\mpm.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -351,30 +399,28 @@
 
 SOURCE=.\server\mpm\winnt\mpm_default.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mpm_default.h
+# Begin Custom Build - Creating include/mpm_default.h
 InputPath=.\server\mpm\winnt\mpm_default.h
 
 ".\include\mpm_default.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\server\mpm\winnt\mpm_default.h .\include
-	echo Created mpm_default.h
+	type .\server\mpm\winnt\mpm_default.h > .\include\mpm_default.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating mpm_default.h
+# Begin Custom Build - Creating include/mpm_default.h
 InputPath=.\server\mpm\winnt\mpm_default.h
 
 ".\include\mpm_default.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\server\mpm\winnt\mpm_default.h .\include
-	echo Created mpm_default.h
+	type .\server\mpm\winnt\mpm_default.h > .\include\mpm_default.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -382,30 +428,28 @@
 
 SOURCE=.\os\win32\os.h
 
 !IF  "$(CFG)" == "libhttpd - Win32 Release"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating os.h
+# Begin Custom Build - Creating include/os.h
 InputPath=.\os\win32\os.h
 
 ".\include\os.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\os\win32\os.h .\include
-	echo Created os.h
+	type .\os\win32\os.h > .\include\os.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libhttpd - Win32 Debug"
 
 # PROP Ignore_Default_Tool 1
-# Begin Custom Build - Generating os.h
+# Begin Custom Build - Creating include/os.h
 InputPath=.\os\win32\os.h
 
 ".\include\os.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	xcopy /y .\os\win32\os.h .\include
-	echo Created os.h
+	type .\os\win32\os.h > .\include\os.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Makefile.in	2002-04-29 07:41:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Makefile.in	2002-06-15 17:41:03.000000000 +0800
@@ -1,20 +1,18 @@
 
 SUBDIRS = srclib os server modules support
 CLEAN_SUBDIRS = test
 
 PROGRAM_NAME         = $(progname)
 PROGRAM_SOURCES      = modules.c
-PROGRAM_LDADD        = $(EXTRA_LDFLAGS) $(HTTPD_LDFLAGS) \
-                       $(PROGRAM_DEPENDENCIES) $(EXTRA_LIBS)
+PROGRAM_LDADD        = $(HTTPD_LDFLAGS) $(PROGRAM_DEPENDENCIES) $(EXTRA_LIBS) $(AP_LIBS)
 PROGRAM_DEPENDENCIES = \
   $(BUILTIN_LIBS) \
   $(MPM_LIB) \
   server/libmain.la \
-  os/$(OS_DIR)/libos.la \
-  $(AP_LIBS)
+  os/$(OS_DIR)/libos.la
 
 PROGRAMS        = $(PROGRAM_NAME)
 TARGETS         = $(PROGRAMS) $(shared_build) $(other_targets)
 PHONY_TARGETS   = $(srcdir)/buildmark.c
 INSTALL_TARGETS = install-conf install-htdocs install-error install-icons \
 	install-other install-cgi install-include install-suexec install-man \
@@ -27,16 +25,16 @@
 
 include $(top_builddir)/build/rules.mk
 include $(top_srcdir)/build/program.mk
 
 install-conf:
 	@echo Installing configuration files
-	@test -d $(sysconfdir) || $(MKINSTALLDIRS) $(sysconfdir)
+	@test -d $(DESTDIR)$(sysconfdir) || $(MKINSTALLDIRS) $(DESTDIR)$(sysconfdir)
 	@cd $(top_srcdir)/docs/conf; \
 	for i in mime.types magic; do \
-		$(INSTALL_DATA) $$i $(sysconfdir); \
+		$(INSTALL_DATA) $$i $(DESTDIR)$(sysconfdir); \
 	done; \
 	for j in $(top_srcdir)/docs/conf $(top_builddir)/docs/conf ; do \
 		cd $$j ; \
 	for i in *-std*.conf ssl.conf; do \
 		[ -f $$i ] || continue; \
 		( \
@@ -54,133 +52,135 @@
 					< $$i; \
 				for j in $(DSO_MODULES) "^EOL^"; do \
 					if test "x$$j" = "xssl"; then \
 						echo "<IfDefine SSL>"; \
 					fi; \
 					if test $$j != "^EOL^"; then \
-						echo "LoadModule $${j}_module modules/mod_$${j}.so"; \
+						echo "LoadModule $${j}_module $(rel_libexecdir)/mod_$${j}.so"; \
 					fi; \
 					if test "x$$j" = "xssl"; then \
 						echo "</IfDefine>"; \
 					fi; \
 				done; \
 				sed -e '1,/@@LoadModule@@/d' \
 					-e '/@@LoadModule@@/d' \
 					-e 's#@@ServerRoot@@#$(prefix)#g' \
 					-e 's#@@Port@@#$(PORT)#g' \
 					< $$i; \
 			fi \
-		) > $(sysconfdir)/$$i; \
-		chmod 0644 $(sysconfdir)/$$i; \
+		) > $(DESTDIR)$(sysconfdir)/$$i; \
+		chmod 0644 $(DESTDIR)$(sysconfdir)/$$i; \
 		file=`echo $$i|sed s/-std//`; \
 		if [ "$$file" = "httpd.conf" ]; then \
 			file=`echo $$file|sed s/.*.conf/$(PROGRAM_NAME).conf/`; \
 		fi; \
-		if test "$$file" != "$$i" && test ! -f $(sysconfdir)/$$file; then \
-			$(INSTALL_DATA) $(sysconfdir)/$$i $(sysconfdir)/$$file; \
+		if test "$$file" != "$$i" && test ! -f $(DESTDIR)$(sysconfdir)/$$file; then \
+			$(INSTALL_DATA) $(DESTDIR)$(sysconfdir)/$$i $(DESTDIR)$(sysconfdir)/$$file; \
 		fi; \
 	done ; \
 	done
 	@if test -f "$(builddir)/envvars-std"; then \
-	    cp -p envvars-std $(sbindir); \
-	    if test ! -f $(sbindir)/envvars; then \
-	        cp -p envvars-std $(sbindir)/envvars ; \
+	    cp -p envvars-std $(DESTDIR)$(sbindir); \
+	    if test ! -f $(DESTDIR)$(sbindir)/envvars; then \
+	        cp -p envvars-std $(DESTDIR)$(sbindir)/envvars ; \
 	    fi ; \
 	fi
 
 install-build:
 	@echo Installing build system files 
-	@test -d $(installbuilddir) || $(MKINSTALLDIRS) $(installbuilddir) 
-	@cp build/*.mk $(installbuilddir); \
+	@test -d $(DESTDIR)$(installbuilddir) || $(MKINSTALLDIRS) $(DESTDIR)$(installbuilddir) 
+	@cp build/*.mk $(DESTDIR)$(installbuilddir); \
 	sed 's#LIBTOOL = \(.*\)#LIBTOOL = $(SHELL) $(installbuilddir)/libtool $(LTFLAGS)#' \
-	    build/config_vars.mk > $(installbuilddir)/config_vars.mk; \
-	cp $(top_srcdir)/build/instdso.sh $(installbuilddir);
+	    build/config_vars.mk > $(DESTDIR)$(installbuilddir)/config_vars.mk; \
+	cp $(top_srcdir)/build/instdso.sh $(DESTDIR)$(installbuilddir);
 
 htdocs-srcdir = $(top_srcdir)/docs/docroot
 
 docs::
 	mkdir -p ./docs/api
 	srclib/apr/build/scandoc.pl -i./build/default.pl -p./docs/api/ ./include/*.h
 
 dox::
 	doxygen $(top_srcdir)/docs/doxygen.conf
 
 install-htdocs:
 	@echo Installing HTML documents
-	@test -d $(htdocsdir) || $(MKINSTALLDIRS) $(htdocsdir)
-	@test -d $(htdocs-srcdir) && (cd $(htdocs-srcdir) && cp -rp * $(htdocsdir))
-	@test -d $(manualdir) || $(MKINSTALLDIRS) $(manualdir)
-	@test -d $(top_srcdir)/docs/manual && (cd $(top_srcdir)/docs/manual && cp -rp * $(manualdir))
-	@test "x$(htdocsdir)" != "x" && cd $(htdocsdir) && find . -name "CVS" -print | xargs rm -rf {} \;
+	@test -d $(DESTDIR)$(htdocsdir) || $(MKINSTALLDIRS) $(DESTDIR)$(htdocsdir)
+	@test -d $(htdocs-srcdir) && (cd $(htdocs-srcdir) && cp -rp * $(DESTDIR)$(htdocsdir))
+	@test -d $(DESTDIR)$(manualdir) || $(MKINSTALLDIRS) $(DESTDIR)$(manualdir)
+	@test -d $(top_srcdir)/docs/manual && (cd $(top_srcdir)/docs/manual && cp -rp * $(DESTDIR)$(manualdir))
+	-@test "x$(htdocsdir)" != "x" && cd $(DESTDIR)$(htdocsdir) && find . -name "CVS" -print | xargs rm -rf
 
 install-error:
 	@echo Installing error documents
-	@test -d $(errordir) || $(MKINSTALLDIRS) $(errordir)
-	@cd $(top_srcdir)/docs/error && cp -rp * $(errordir)
-	@test "x$(errordir)" != "x" && cd $(errordir) && find . -name "CVS" -print | xargs rm -rf {} \;
+	@test -d $(DESTDIR)$(errordir) || $(MKINSTALLDIRS) $(DESTDIR)$(errordir)
+	@cd $(top_srcdir)/docs/error && cp -rp * $(DESTDIR)$(errordir)
+	-@test "x$(errordir)" != "x" && cd $(DESTDIR)$(errordir) && find . -name "CVS" -print | xargs rm -rf
 
 install-icons:
 	@echo Installing icons
-	@test -d $(iconsdir) || $(MKINSTALLDIRS) $(iconsdir)
-	@cd $(top_srcdir)/docs/icons && cp -rp * $(iconsdir)
-	@test "x$(iconsdir)" != "x" && cd $(iconsdir) && find . -name "CVS" -print | xargs rm -rf {} \;
+	@test -d $(DESTDIR)$(iconsdir) || $(MKINSTALLDIRS) $(DESTDIR)$(iconsdir)
+	@cd $(top_srcdir)/docs/icons && cp -rp * $(DESTDIR)$(iconsdir)
+	-@test "x$(iconsdir)" != "x" && cd $(DESTDIR)$(iconsdir) && find . -name "CVS" -print | xargs rm -rf
 
 install-cgi:
 	@echo Installing CGIs
-	@test -d $(cgidir) || $(MKINSTALLDIRS) $(cgidir)
-	@cd $(top_srcdir)/docs/cgi-examples && cp -rp * $(cgidir)
-	@test "x$(cgidir)" != "x" && cd $(cgidir) && find . -name "CVS" -print | xargs rm -rf {} \;
+	@test -d $(DESTDIR)$(cgidir) || $(MKINSTALLDIRS) $(DESTDIR)$(cgidir)
+	@cd $(top_srcdir)/docs/cgi-examples && cp -rp * $(DESTDIR)$(cgidir)
+	-@test "x$(cgidir)" != "x" && cd $(DESTDIR)$(cgidir) && find . -name "CVS" -print | xargs rm -rf
 
 install-other:
-	@test -d $(logfiledir) || $(MKINSTALLDIRS) $(logfiledir)
+	@test -d $(DESTDIR)$(logfiledir) || $(MKINSTALLDIRS) $(DESTDIR)$(logfiledir)
+	@test -d $(DESTDIR)$(runtimedir) || $(MKINSTALLDIRS) $(DESTDIR)$(runtimedir)
 	@for ext in dll x; do \
 		file=apachecore.$$ext; \
 		if test -f $$file; then \
-			cp -p $$file $(libdir); \
+			cp -p $$file $(DESTDIR)$(libdir); \
 		fi; \
 	done; \
 	file=httpd.dll; \
 	if test -f $$file; then \
-		cp -p $$file $(bindir); \
+		cp -p $$file $(DESTDIR)$(bindir); \
 	fi;
 
 install-include:
 	@echo Installing header files
-	@test -d $(includedir)     || $(MKINSTALLDIRS) $(includedir)
-	@cp -p include/*.h $(srcdir)/include/*.h $(includedir)
-	@cp -p $(srcdir)/os/$(OS_DIR)/os.h $(includedir)
+	@test -d $(DESTDIR)$(includedir)     || $(MKINSTALLDIRS) $(DESTDIR)$(includedir)
+	@cp -p include/*.h $(srcdir)/include/*.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/os/$(OS_DIR)/os.h $(DESTDIR)$(includedir)
 	@if test -f $(srcdir)/os/$(OS_DIR)/os-inline.c; then \
-            cp -p $(srcdir)/os/$(OS_DIR)/os-inline.c $(includedir); \
+            cp -p $(srcdir)/os/$(OS_DIR)/os-inline.c $(DESTDIR)$(includedir); \
         fi;
-	@cp -p $(srcdir)/server/mpm/$(MPM_SUBDIR_NAME)/*.h $(includedir)
-	@cp -p $(srcdir)/modules/dav/main/mod_dav.h $(includedir)
-	@cp -p $(srcdir)/modules/filters/mod_include.h $(includedir)
-	@cp -p $(srcdir)/modules/generators/mod_cgi.h $(includedir)
-	@cp -p $(srcdir)/modules/loggers/mod_log_config.h $(includedir)
-	@cp -p $(srcdir)/modules/http/mod_core.h $(includedir)
-	@cp -p $(srcdir)/modules/proxy/mod_proxy.h $(includedir)
-	@cp -p $(srcdir)/modules/ssl/*.h $(includedir)
-	@cp -p $(srcdir)/srclib/pcre/pcre*.h $(includedir)
-	@cp -p $(srcdir)/srclib/apr/include/*.h $(includedir)
-	@cp -p $(srcdir)/srclib/apr-util/include/*.h $(includedir)
-	@cp -p $(srcdir)/os/$(OS_DIR)/*.h $(includedir)
-	@chmod 644 $(includedir)/*.h
+	@cp -p $(srcdir)/server/mpm/$(MPM_SUBDIR_NAME)/*.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/dav/main/mod_dav.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/filters/mod_include.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/generators/mod_cgi.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/loggers/mod_log_config.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/http/mod_core.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/proxy/mod_proxy.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/modules/ssl/*.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/srclib/pcre/pcre*.h $(DESTDIR)$(includedir)
+	@cp -p $(srcdir)/os/$(OS_DIR)/*.h $(DESTDIR)$(includedir)
+	@chmod 644 $(DESTDIR)$(includedir)/*.h
 
 install-man:
 	@echo Installing man pages
-	@test -d $(mandir)      || $(MKINSTALLDIRS) $(mandir)
-	@test -d $(mandir)/man1 || $(MKINSTALLDIRS) $(mandir)/man1
-	@test -d $(mandir)/man8 || $(MKINSTALLDIRS) $(mandir)/man8
-	@cp -p $(top_srcdir)/docs/man/*.1 $(mandir)/man1
-	@cp -p $(top_srcdir)/docs/man/*.8 $(mandir)/man8
+	@test -d $(DESTDIR)$(mandir)      || $(MKINSTALLDIRS) $(DESTDIR)$(mandir)
+	@test -d $(DESTDIR)$(mandir)/man1 || $(MKINSTALLDIRS) $(DESTDIR)$(mandir)/man1
+	@test -d $(DESTDIR)$(mandir)/man8 || $(MKINSTALLDIRS) $(DESTDIR)$(mandir)/man8
+	@cp -p $(top_srcdir)/docs/man/*.1 $(DESTDIR)$(mandir)/man1
+	@cp -p $(top_srcdir)/docs/man/*.8 $(DESTDIR)$(mandir)/man8
 
 install-suexec:
 	@if test -f $(builddir)/support/suexec; then \
-            test -d $(sbindir) || $(MKINSTALLDIRS) $(sbindir); \
-            $(INSTALL_PROGRAM) $(top_builddir)/support/suexec $(sbindir); \
-            chmod 4755 $(sbindir)/suexec; \
+            test -d $(DESTDIR)$(sbindir) || $(MKINSTALLDIRS) $(DESTDIR)$(sbindir); \
+            $(INSTALL_PROGRAM) $(top_builddir)/support/suexec $(DESTDIR)$(sbindir); \
+            chmod 4755 $(DESTDIR)$(sbindir)/suexec; \
 	fi
 
 suexec:
 	cd support && $(MAKE) suexec
 
+x-local-distclean:
+	@rm -rf autom4te.cache
+
 include $(top_srcdir)/os/os2/core.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Makefile.win /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Makefile.win
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/Makefile.win	2002-04-30 03:53:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/Makefile.win	2002-06-16 11:25:36.000000000 +0800
@@ -24,12 +24,16 @@
 # Be aware that certain awk's will not accept backslahed names,
 # so the server root should be given in forward slashes (quoted),
 # preferably with the drive designation!
 
 default:        _apacher
 
+!IF ("$(CTARGET)" == "") && EXIST("Apache.sln")
+CTARGET=/build
+!ENDIF
+
 !IF !EXIST("srclib\apr")
 !MESSAGE Please check out or download and unpack the Apache Portability Runtime
 !MESSAGE sources (apr and apr-util) into your $(INSTDIR)\srclib directory.
 !MESSAGE Apache cannot build without these libraries!
 !MESSAGE 
 !ERROR Need $(INSTDIR)\srclib\apr
@@ -58,12 +62,15 @@
 	cd modules\ssl
 	$(MAKE) $(MAKEOPT) -f mod_ssl.mak CFG="mod_ssl - Win32 $(LONG)" RECURSE=0 .\$(LONG)\mod_ssl.so
 	cd ..\..
 	cd support
 	$(MAKE) $(MAKEOPT) -f abs.mak CFG="abs - Win32 $(LONG)" RECURSE=0 .\$(LONG)\abs.exe
 	cd ..
+!ELSEIF EXIST("Apache.sln")
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project mod_ssl
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project abs
 !ELSE
 	msdev Apache.dsw /USEENV /MAKE \
 		"mod_ssl - Win32 $(LONG)" \
 		"abs - Win32 $(LONG)" /NORECURSE $(CTARGET)
 !ENDIF
 
@@ -78,16 +85,18 @@
 	echo was 0.9.6c available from http://www.openssl.org/
 !ENDIF
 
 !IF EXIST("srclib\zlib")
 
 _tryzlib:
-!IF EXIST("modules\experimental\mod_deflate.mak")
-	cd modules\experimental
+!IF EXIST("modules\filters\mod_deflate.mak")
+	cd modules\filters
 	$(MAKE) $(MAKEOPT) -f mod_deflate.mak CFG="mod_deflate - Win32 $(LONG)" RECURSE=0 .\$(LONG)\mod_deflate.so
 	cd ..\..
+!ELSEIF EXIST("Apache.sln")
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project mod_deflate
 !ELSE
 	msdev Apache.dsw /USEENV /MAKE \
 		"mod_deflate - Win32 $(LONG)" /NORECURSE $(CTARGET)
 !ENDIF
 
 !ELSE
@@ -205,17 +214,17 @@
 	cd ..\..\..
 	cd modules\experimental
 	 $(MAKE) $(MAKEOPT) -f mod_cache.mak       CFG="mod_cache - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f mod_mem_cache.mak   CFG="mod_mem_cache - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f mod_disk_cache.mak  CFG="mod_disk_cache - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f mod_ext_filter.mak  CFG="mod_ext_filter - Win32 $(LONG)" RECURSE=0 $(CTARGET)
+	cd ..\..
+	cd modules\filters
 !IF EXIST("srclib\zlib")
 	 $(MAKE) $(MAKEOPT) -f mod_deflate.mak     CFG="mod_deflate - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 !ENDIF
-	cd ..\..
-	cd modules\filters
 	 $(MAKE) $(MAKEOPT) -f mod_include.mak     CFG="mod_include - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	cd ..\..
 	cd modules\generators
 	 $(MAKE) $(MAKEOPT) -f mod_asis.mak        CFG="mod_asis - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f mod_autoindex.mak   CFG="mod_autoindex - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f mod_cgi.mak         CFG="mod_cgi - Win32 $(LONG)" RECURSE=0 $(CTARGET)
@@ -273,12 +282,32 @@
 	cd ..
 	cd support\win32
 	 $(MAKE) $(MAKEOPT) -f ApacheMonitor.mak   CFG="ApacheMonitor - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	 $(MAKE) $(MAKEOPT) -f wintty.mak          CFG="wintty - Win32 $(LONG)" RECURSE=0 $(CTARGET)
 	cd ..\..
 
+!ELSEIF EXIST("Apache.sln")
+
+_cleanr:  
+	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release CTARGET="/clean" _build
+
+_cleand:  
+	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=D LONG=Debug   CTARGET="/clean" _build
+
+_build:
+	echo Building Win32 $(LONG) targets ($(SHORT) suffixes)
+	-del $(LONG)\buildmark.obj
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project BuildBin
+!IF EXIST("srclib\openssl")
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project mod_ssl
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project abs
+!ENDIF
+!IF EXIST("srclib\zlib")
+	devenv Apache.sln /useenv $(CTARGET) $(LONG) /project mod_deflate
+!ENDIF
+
 !ELSE
 
 _cleanr:  
 	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release CTARGET="/CLEAN" _build
 
 _cleand:  
@@ -365,26 +394,81 @@
 	copy modules\metadata\$(LONG)\mod_unique_id.so "$(INSTDIR)\modules" <.y
 	copy modules\metadata\$(LONG)\mod_usertrack.so "$(INSTDIR)\modules" <.y
 	copy modules\proxy\$(LONG)\mod_proxy.so "$(INSTDIR)\modules" <.y
 	copy modules\proxy\$(LONG)\mod_proxy_connect.so "$(INSTDIR)\modules" <.y
 	copy modules\proxy\$(LONG)\mod_proxy_ftp.so "$(INSTDIR)\modules" <.y
 	copy modules\proxy\$(LONG)\mod_proxy_http.so "$(INSTDIR)\modules" <.y
+!IF "$(SHORT)" == "D"
+	copy $(LONG)\Apache.pdb "$(INSTDIR)\bin" <.y
+	copy $(LONG)\libhttpd.pdb "$(INSTDIR)\bin" <.y
+	copy srclib\apr\$(LONG)\libapr.pdb "$(INSTDIR)\bin" <.y
+	copy srclib\apr-util\$(LONG)\libaprutil.pdb "$(INSTDIR)\bin" <.y
+	copy modules\aaa\$(LONG)\mod_access.pdb "$(INSTDIR)\modules" <.y
+	copy modules\aaa\$(LONG)\mod_auth.pdb "$(INSTDIR)\modules" <.y
+	copy modules\aaa\$(LONG)\mod_auth_anon.pdb "$(INSTDIR)\modules" <.y
+	copy modules\aaa\$(LONG)\mod_auth_dbm.pdb "$(INSTDIR)\modules" <.y
+	copy modules\aaa\$(LONG)\mod_auth_digest.pdb "$(INSTDIR)\modules" <.y
+	copy modules\arch\win32\$(LONG)\mod_isapi.pdb "$(INSTDIR)\modules" <.y
+	copy modules\cache\$(LONG)\mod_file_cache.pdb "$(INSTDIR)\modules" <.y
+	copy modules\dav\fs\$(LONG)\mod_dav_fs.pdb "$(INSTDIR)\modules" <.y
+	copy modules\dav\main\$(LONG)\mod_dav.pdb "$(INSTDIR)\modules" <.y
+	copy modules\experimental\$(LONG)\mod_cache.pdb "$(INSTDIR)\modules" <.y
+	copy modules\experimental\$(LONG)\mod_mem_cache.pdb "$(INSTDIR)\modules" <.y
+	copy modules\experimental\$(LONG)\mod_disk_cache.pdb "$(INSTDIR)\modules" <.y
+	copy modules\experimental\$(LONG)\mod_ext_filter.pdb "$(INSTDIR)\modules" <.y
+	copy modules\filters\$(LONG)\mod_include.pdb "$(INSTDIR)\modules" <.y
+	copy modules\generators\$(LONG)\mod_asis.pdb "$(INSTDIR)\modules" <.y
+	copy modules\generators\$(LONG)\mod_autoindex.pdb "$(INSTDIR)\modules" <.y
+	copy modules\generators\$(LONG)\mod_cgi.pdb "$(INSTDIR)\modules" <.y
+	copy modules\generators\$(LONG)\mod_info.pdb "$(INSTDIR)\modules" <.y
+	copy modules\generators\$(LONG)\mod_status.pdb "$(INSTDIR)\modules" <.y
+	copy modules\http\$(LONG)\mod_mime.pdb "$(INSTDIR)\modules" <.y
+	copy modules\loggers\$(LONG)\mod_log_config.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_actions.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_alias.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_dir.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_imap.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_negotiation.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_rewrite.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_speling.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_userdir.pdb "$(INSTDIR)\modules" <.y
+	copy modules\mappers\$(LONG)\mod_vhost_alias.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_cern_meta.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_env.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_expires.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_headers.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_mime_magic.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_setenvif.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_unique_id.pdb "$(INSTDIR)\modules" <.y
+	copy modules\metadata\$(LONG)\mod_usertrack.pdb "$(INSTDIR)\modules" <.y
+	copy modules\proxy\$(LONG)\mod_proxy.pdb "$(INSTDIR)\modules" <.y
+	copy modules\proxy\$(LONG)\mod_proxy_connect.pdb "$(INSTDIR)\modules" <.y
+	copy modules\proxy\$(LONG)\mod_proxy_ftp.pdb "$(INSTDIR)\modules" <.y
+	copy modules\proxy\$(LONG)\mod_proxy_http.pdb "$(INSTDIR)\modules" <.y
+!ENDIF
 !IF EXIST("srclib\openssl")
 	copy modules\ssl\$(LONG)\mod_ssl.so "$(INSTDIR)\modules" <.y
 	copy srclib\openssl\$(SSLBIN)\openssl.exe "$(INSTDIR)\bin" <.y
 	copy srclib\openssl\$(SSLBIN)\libeay32.dll "$(INSTDIR)\bin" <.y
 	copy srclib\openssl\$(SSLBIN)\ssleay32.dll "$(INSTDIR)\bin" <.y
+!IF "$(SHORT)" == "D"
+	copy modules\ssl\$(LONG)\mod_ssl.pdb "$(INSTDIR)\modules" <.y
+	copy srclib\openssl\$(SSLBIN)\openssl.pdb "$(INSTDIR)\bin" <.y
+	copy srclib\openssl\$(SSLBIN)\libeay32.pdb "$(INSTDIR)\bin" <.y
+	copy srclib\openssl\$(SSLBIN)\ssleay32.pdb "$(INSTDIR)\bin" <.y
+!ENDIF
 	type << >> "$(INSTDIR)\README.txt"
 
   This binary distribution includes cryptographic software written by
   Eric Young (eay@cryptsoft.com), software written by Tim Hudson 
   (tjh@cryptsoft.com), and software developed by the OpenSSL Project 
   for use in the OpenSSL Toolkit <http://www.openssl.org/>.
 <<
 	-awk -f <<script.awk < "srclib\openssl\LICENSE" >> "$(INSTDIR)\LICENSE.txt"
-{   print "";
+BEGIN {
+    print "";
     print "For the libeay32.dll, ssleay32.dll and certtool.exe components:";
     print "";
     while ( getline > 0 ) {
 	print $$0;
    }
 }
@@ -433,56 +517,75 @@
  the Apache HTTP Server user's list or <http://www.openssl.org/support/> the
  OpenSSL support page.
 
 --------------------------------------------------------------------------------
 <<
 	copy support\$(LONG)\abs.exe "$(INSTDIR)\bin\ab.exe" <.y
+!IF "$(SHORT)" == "D"
+	copy support\$(LONG)\abs.pdb "$(INSTDIR)\bin\ab.pdb" <.y
+!ENDIF
 !ELSE
 	copy support\$(LONG)\ab.exe "$(INSTDIR)\bin" <.y
+!IF "$(SHORT)" == "D"
+	copy support\$(LONG)\ab.pdb "$(INSTDIR)\bin" <.y
+!ENDIF
 !ENDIF
 !IF EXIST("srclib\zlib")
 	type << >> "$(INSTDIR)\README.txt"
 
   This binary distribution of mod_deflate.so includes zlib compression code
   <http://www.gzip.org/zlib/> written by Jean-loup Gailly (jloup@gzip.org)
   and Mark Adler (madler@alumni.caltech.edu) .
 <<
 	-awk -f <<script.awk < "srclib\zlib\README" >> "$(INSTDIR)\LICENSE.txt"
-{  while ( getline > 0 ) {
-      if ( $$0 ~ /Copyright notice:/ ) {
-	print "";
-	print "For the mod_deflate zlib compression component:";
-        while ( getline > 0 && $$0 !~ /^[^ ]/ ) {
-	  print $$0;
+BEGIN {
+    while ( getline > 0 ) {
+	if ( $$0 ~ /Copyright notice:/ ) {
+	    print "";
+	    print "For the mod_deflate zlib compression component:";
+	    while ( getline > 0 && $$0 !~ /^[^ ]/ ) {
+		print $$0;
+            }
+            exit 0;
         }
-        exit 0;
-      }
-   }
+    }
+    exit 1;
 }
 <<
-	copy modules\experimental\$(LONG)\mod_deflate.so "$(INSTDIR)\modules" <.y
+	copy modules\filters\$(LONG)\mod_deflate.so "$(INSTDIR)\modules" <.y
+!IF "$(SHORT)" == "D"
+	copy modules\filters\$(LONG)\mod_deflate.pdb "$(INSTDIR)\modules" <.y
+!ENDIF
 !ENDIF
 	copy support\$(LONG)\htdbm.exe "$(INSTDIR)\bin" <.y
 	copy support\$(LONG)\htdigest.exe "$(INSTDIR)\bin" <.y
 	copy support\$(LONG)\htpasswd.exe "$(INSTDIR)\bin" <.y
 	copy support\$(LONG)\logresolve.exe "$(INSTDIR)\bin" <.y
 	copy support\$(LONG)\rotatelogs.exe "$(INSTDIR)\bin" <.y
 	copy support\win32\$(LONG)\ApacheMonitor.exe "$(INSTDIR)\bin" <.y
 	copy support\win32\$(LONG)\wintty.exe "$(INSTDIR)\bin" <.y
+!IF "$(SHORT)" == "D"
+	copy support\$(LONG)\htdbm.pdb "$(INSTDIR)\bin" <.y
+	copy support\$(LONG)\htdigest.pdb "$(INSTDIR)\bin" <.y
+	copy support\$(LONG)\htpasswd.pdb "$(INSTDIR)\bin" <.y
+	copy support\$(LONG)\logresolve.pdb "$(INSTDIR)\bin" <.y
+	copy support\$(LONG)\rotatelogs.pdb "$(INSTDIR)\bin" <.y
+	copy support\win32\$(LONG)\ApacheMonitor.pdb "$(INSTDIR)\bin" <.y
+	copy support\win32\$(LONG)\wintty.pdb "$(INSTDIR)\bin" <.y
+!ENDIF
 	copy docs\cgi-examples\printenv "$(INSTDIR)\cgi-bin\printenv.pl" <.y
-	-awk -f <<script.awk "docs\cgi-examples\printenv" "$(INSTDIR)\cgi-bin\printenv.pl"
+	-awk -f <<script.awk "docs/cgi-examples/printenv" > "$(INSTDIR)\cgi-bin\printenv.pl"
     BEGIN { 
-	srcfl = ARGV[1];
-	dstfl = ARGV[2];
 	if ( "perl -e \"print $$^X;\"" | getline perlroot ) {
 	    gsub( /\\/, "/", perlroot );
-	    print "#!" perlroot > dstfl;
-	    getline < srcfl;
+	    print "#!" perlroot;
 	}
-	while ( ( getline < srcfl ) > 0 ) {
-	    print $$0 > dstfl;
+    }
+    {
+	if ( $$0 !~ /^#!/ ) {
+	    print $$0;
 	}
     }
 <<
 	xcopy docs\error "$(INSTDIR)\error" /s /d < .a
 	xcopy docs\docroot "$(INSTDIR)\htdocs" /d < .a
 	xcopy docs\manual "$(INSTDIR)\manual" /s /d < .a
@@ -511,44 +614,46 @@
 	if not exist "$(INSTDIR)\conf\magic" \
 	    copy "$(INSTDIR)\conf\magic.default" "$(INSTDIR)\conf\magic"
 	copy docs\conf\mime.types "$(INSTDIR)\conf\mime.types.default" <.y
 	if not exist "$(INSTDIR)\conf\mime.types" \
 	    copy "$(INSTDIR)\conf\mime.types.default" "$(INSTDIR)\conf\mime.types"
 	copy docs\conf\httpd-win.conf "$(INSTDIR)\conf\httpd.default.conf" <.y
-	-awk -f <<script.awk "docs\conf\httpd-win.conf" "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)"
+	-awk -f <<script.awk "docs/conf/httpd-win.conf" "$(INSTDIR)" > "$(INSTDIR)\conf\httpd.default.conf"
     BEGIN { 
-	srcfl = ARGV[1];
-	dstfl = ARGV[2];
-	serverroot = ARGV[3];
+	serverroot = ARGV[2];
+	delete ARGV[2];
 	gsub( /\\/, "/", serverroot );
-	while ( ( getline < srcfl ) > 0 ) {
-	    gsub( /@@ServerRoot@@/, serverroot );
-	    gsub( /@@ServerName@@/, "$(SERVERNAME)" );
-	    gsub( /@@Port@@/, "$(PORT)" );
-	    print $$0 > dstfl;
-	}
+	"pwd" | getline root;
+	gsub( /^\//, substr( root, 1, 2 ) "/", serverroot );
+    }
+    {
+	gsub( /@@ServerRoot@@/, serverroot );
+	gsub( /@@ServerName@@/, "$(SERVERNAME)" );
+	gsub( /@@Port@@/, "$(PORT)" );
+	print $$0;
     }
 <<
 	if not exist "$(INSTDIR)\conf\httpd.conf" \
 	    copy "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)\conf\httpd.conf"
 	copy docs\conf\ssl-std.conf "$(INSTDIR)\conf\ssl.default.conf" <.y
-	-awk -f <<script.awk "docs\conf\ssl-std.conf" "$(INSTDIR)\conf\ssl.default.conf" "$(INSTDIR)"
+	-awk -f <<script.awk "docs/conf/ssl-std.conf" "$(INSTDIR)" > "$(INSTDIR)\conf\ssl.default.conf"
     BEGIN { 
-	srcfl = ARGV[1];
-	dstfl = ARGV[2];
-	serverroot = ARGV[3];
+	serverroot = ARGV[2];
+	delete ARGV[2];
 	gsub( /\\/, "/", serverroot );
-	while ( ( getline < srcfl ) > 0 ) {
-	    gsub( /@@ServerRoot@@/, serverroot );
-	    print $$0 > dstfl;
-	}
+	"pwd" | getline root;
+	gsub( /^\//, substr( root, 1, 2 ) "/", serverroot );
+    }
+    {
+	gsub( /@@ServerRoot@@/, serverroot );
+	print $$0;
     }
 <<
 	if not exist "$(INSTDIR)\conf\ssl.conf" \
 	    copy "$(INSTDIR)\conf\ssl.default.conf" "$(INSTDIR)\conf\ssl.conf"
-	-awk -f <<script.awk "support\dbmmanage.in" >"$(INSTDIR)\bin\dbmmanage.pl"
+	-awk -f <<script.awk "support/dbmmanage.in" >"$(INSTDIR)\bin\dbmmanage.pl"
     { if ( $$0 ~ /^BEGIN \{ @AnyDBM_File::/ ) {
 	  sub( /ISA = qw\(.*\)/, "ISA = qw(SDBM_File)" ); 
       }
       if ( $$0 !~ /^#!@perlbin@/ )
 	  print $$0;
     }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_access.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_access.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_access.c	2002-03-14 04:47:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_access.c	2002-05-17 19:33:08.000000000 +0800
@@ -318,13 +318,13 @@
         else
             ret = HTTP_FORBIDDEN;
     }
 
     if (ret == HTTP_FORBIDDEN
         && (ap_satisfies(r) != SATISFY_ANY || !ap_some_auth_required(r))) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
             "client denied by server configuration: %s",
             r->filename);
     }
 
     return ret;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_anon.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_anon.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_anon.c	2002-03-14 04:47:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_anon.c	2002-05-18 12:13:12.000000000 +0800
@@ -163,25 +163,25 @@
 
 static const command_rec anon_auth_cmds[] =
 {
     AP_INIT_ITERATE("Anonymous", anon_set_string_slots, NULL, OR_AUTHCFG, 
      "a space-separated list of user IDs"),
     AP_INIT_FLAG("Anonymous_MustGiveEmail", ap_set_flag_slot,
-     (void *)APR_XtOffsetOf(anon_auth_config_rec, anon_auth_mustemail),
+     (void *)APR_OFFSETOF(anon_auth_config_rec, anon_auth_mustemail),
      OR_AUTHCFG, "Limited to 'on' or 'off'"),
     AP_INIT_FLAG("Anonymous_NoUserId", ap_set_flag_slot,
-     (void *)APR_XtOffsetOf(anon_auth_config_rec, anon_auth_nouserid),
+     (void *)APR_OFFSETOF(anon_auth_config_rec, anon_auth_nouserid),
      OR_AUTHCFG, "Limited to 'on' or 'off'"),
     AP_INIT_FLAG("Anonymous_VerifyEmail", ap_set_flag_slot,
-     (void *)APR_XtOffsetOf(anon_auth_config_rec, anon_auth_verifyemail),
+     (void *)APR_OFFSETOF(anon_auth_config_rec, anon_auth_verifyemail),
      OR_AUTHCFG, "Limited to 'on' or 'off'"),
     AP_INIT_FLAG("Anonymous_LogEmail", ap_set_flag_slot,
-     (void *)APR_XtOffsetOf(anon_auth_config_rec, anon_auth_logemail),
+     (void *)APR_OFFSETOF(anon_auth_config_rec, anon_auth_logemail),
      OR_AUTHCFG, "Limited to 'on' or 'off'"),
     AP_INIT_FLAG("Anonymous_Authoritative", ap_set_flag_slot,
-     (void *)APR_XtOffsetOf(anon_auth_config_rec, anon_auth_authoritative),
+     (void *)APR_OFFSETOF(anon_auth_config_rec, anon_auth_authoritative),
      OR_AUTHCFG, "Limited to 'on' or 'off'"),
     {NULL}
 };
 
 module AP_MODULE_DECLARE_DATA auth_anon_module;
 
@@ -221,21 +221,21 @@
 	   && ((!conf->anon_auth_mustemail) || strlen(sent_pw))
     /* does the password look like an email address ? */
 	   && ((!conf->anon_auth_verifyemail)
 	       || ((strpbrk("@", sent_pw) != NULL)
 		   && (strpbrk(".", sent_pw) != NULL)))) {
 	if (conf->anon_auth_logemail && ap_is_initial_req(r)) {
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, APR_SUCCESS, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_INFO, APR_SUCCESS, r,
 			"Anonymous: Passwd <%s> Accepted",
 			sent_pw ? sent_pw : "\'none\'");
 	}
 	return OK;
     }
     else {
 	if (conf->anon_auth_authoritative) {
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, APR_SUCCESS, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_ERR, APR_SUCCESS, r,
 			"Anonymous: Authoritative, Passwd <%s> not accepted",
 			sent_pw ? sent_pw : "\'none\'");
 	    return HTTP_UNAUTHORIZED;
 	}
 	/* Drop out the bottom to return DECLINED */
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth.c	2002-03-14 04:47:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth.c	2002-05-18 12:13:12.000000000 +0800
@@ -108,20 +108,20 @@
     return ap_set_file_slot(cmd, offset, f);
 }
 
 static const command_rec auth_cmds[] =
 {
     AP_INIT_TAKE12("AuthUserFile", set_auth_slot,
-                   (void *) APR_XtOffsetOf(auth_config_rec, auth_pwfile),
+                   (void *)APR_OFFSETOF(auth_config_rec, auth_pwfile),
                    OR_AUTHCFG, "text file containing user IDs and passwords"),
     AP_INIT_TAKE12("AuthGroupFile", set_auth_slot,
-                   (void *) APR_XtOffsetOf(auth_config_rec, auth_grpfile),
+                   (void *)APR_OFFSETOF(auth_config_rec, auth_grpfile),
                    OR_AUTHCFG,
                    "text file containing group names and member user IDs"),
     AP_INIT_FLAG("AuthAuthoritative", ap_set_flag_slot,
-                 (void *) APR_XtOffsetOf(auth_config_rec, auth_authoritative),
+                 (void *)APR_OFFSETOF(auth_config_rec, auth_authoritative),
                  OR_AUTHCFG,
                  "Set to 'no' to allow access control to be passed along to "
                  "lower modules if the UserID is not known to this module"),
     {NULL}
 };
 
@@ -226,20 +226,20 @@
     }
 
     if (!(real_pw = get_pw(r, r->user, conf->auth_pwfile))) {
         if (!(conf->auth_authoritative)) {
             return DECLINED;
         }
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "user %s not found: %s", r->user, r->uri);
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
     invalid_pw = apr_password_validate(sent_pw, real_pw);
     if (invalid_pw != APR_SUCCESS) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "user %s: authentication failure for \"%s\": "
                       "Password Mismatch",
                       r->user, r->uri);
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
@@ -313,13 +313,13 @@
             /* if we aren't authoritative, any require directive could be
              * valid even if we don't grok it.  However, if we are 
              * authoritative, we can warn the user they did something wrong.
              * That something could be a missing "AuthAuthoritative off", but
              * more likely is a typo in the require directive.
              */
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "access to %s failed, reason: unknown require "
                           "directive:\"%s\"", r->uri, reqs[x].requirement);
         }
     }
 
     if (!method_restricted) {
@@ -327,13 +327,13 @@
     }
 
     if (!(conf->auth_authoritative)) {
         return DECLINED;
     }
 
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "access to %s failed, reason: user %s not allowed access",
                   r->uri, user);
         
     ap_note_basic_auth_failure(r);
     return HTTP_UNAUTHORIZED;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_dbm.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_dbm.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_dbm.c	2002-03-14 04:47:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_dbm.c	2002-05-18 12:13:12.000000000 +0800
@@ -123,28 +123,28 @@
     return NULL;
 }
 
 static const command_rec dbm_auth_cmds[] =
 {
     AP_INIT_TAKE1("AuthDBMUserFile", ap_set_file_slot,
-     (void *) APR_XtOffsetOf(dbm_auth_config_rec, auth_dbmpwfile),
+     (void *)APR_OFFSETOF(dbm_auth_config_rec, auth_dbmpwfile),
      OR_AUTHCFG, "dbm database file containing user IDs and passwords"),
     AP_INIT_TAKE1("AuthDBMGroupFile", ap_set_file_slot,
-     (void *) APR_XtOffsetOf(dbm_auth_config_rec, auth_dbmgrpfile),
+     (void *)APR_OFFSETOF(dbm_auth_config_rec, auth_dbmgrpfile),
      OR_AUTHCFG, "dbm database file containing group names and member user IDs"),
     AP_INIT_TAKE12("AuthUserFile", set_dbm_slot,
-     (void *) APR_XtOffsetOf(dbm_auth_config_rec, auth_dbmpwfile),
+     (void *)APR_OFFSETOF(dbm_auth_config_rec, auth_dbmpwfile),
      OR_AUTHCFG, NULL),
     AP_INIT_TAKE12("AuthGroupFile", set_dbm_slot,
-     (void *) APR_XtOffsetOf(dbm_auth_config_rec, auth_dbmgrpfile),
+     (void *)APR_OFFSETOF(dbm_auth_config_rec, auth_dbmgrpfile),
      OR_AUTHCFG, NULL),
     AP_INIT_TAKE1("AuthDBMType", set_dbm_type,
      NULL,
      OR_AUTHCFG, "what type of DBM file the user file is"),
     AP_INIT_FLAG("AuthDBMAuthoritative", ap_set_flag_slot,
-     (void *) APR_XtOffsetOf(dbm_auth_config_rec, auth_dbmauthoritative),
+     (void *)APR_OFFSETOF(dbm_auth_config_rec, auth_dbmauthoritative),
      OR_AUTHCFG, "Set to 'no' to allow access control to be passed along to lower modules, if the UserID is not known in this module"),
     {NULL}
 };
 
 module AP_MODULE_DECLARE_DATA auth_dbm_module;
 
@@ -228,25 +228,25 @@
         return DECLINED;
 
     if (!(real_pw = get_dbm_pw(r, r->user, conf->auth_dbmpwfile,
                                conf->auth_dbmtype))) {
         if (!(conf->auth_dbmauthoritative))
             return DECLINED;
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "DBM user %s not found: %s", r->user, r->filename);
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
     /* Password is up to first : if exists */
     colon_pw = strchr(real_pw, ':');
     if (colon_pw) {
         *colon_pw = '\0';
     }
     invalid_pw = apr_password_validate(sent_pw, real_pw);
     if (invalid_pw != APR_SUCCESS) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "DBM user %s: authentication failure for \"%s\": "
                       "Password Mismatch",
                       r->user, r->uri);
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
@@ -287,13 +287,13 @@
             char *v;
 
             if (!(groups = get_dbm_grp(r, user, conf->auth_dbmgrpfile,
                                        conf->auth_dbmtype))) {
                 if (!(conf->auth_dbmauthoritative))
                     return DECLINED;
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "user %s not in DBM group file %s: %s",
                             user, conf->auth_dbmgrpfile, r->filename);
                 ap_note_basic_auth_failure(r);
                 return HTTP_UNAUTHORIZED;
             }
             orig_groups = groups;
@@ -303,13 +303,13 @@
                 while (groups[0]) {
                     v = ap_getword(r->pool, &groups, ',');
                     if (!strcmp(v, w))
                         return OK;
                 }
             }
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "user %s not in right group: %s",
                           user, r->filename);
             ap_note_basic_auth_failure(r);
             return HTTP_UNAUTHORIZED;
         }
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_digest.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_digest.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa/mod_auth_digest.c	2002-04-28 17:02:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/aaa/mod_auth_digest.c	2002-06-13 06:27:37.000000000 +0800
@@ -142,14 +142,14 @@
     const char  *ha1;
 } digest_config_rec;
 
 
 #define DFLT_ALGORITHM  "MD5"
 
-#define DFLT_NONCE_LIFE (300*APR_USEC_PER_SEC)
-#define NEXTNONCE_DELTA (30*APR_USEC_PER_SEC)
+#define DFLT_NONCE_LIFE apr_time_from_sec(300)
+#define NEXTNONCE_DELTA apr_time_from_sec(30)
 
 
 #define NONCE_TIME_LEN  (((sizeof(apr_time_t)+2)/3)*4)
 #define NONCE_HASH_LEN  (2*APR_SHA1_DIGESTSIZE)
 #define NONCE_LEN       (int )(NONCE_TIME_LEN + NONCE_HASH_LEN)
 
@@ -236,13 +236,13 @@
 /*
  * initialization code
  */
 
 static apr_status_t cleanup_tables(void *not_used)
 {
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                   "Digest: cleaning up shared memory");
     fflush(stderr);
 
     if (client_shm) {
         apr_shm_destroy(client_shm);
         client_shm = NULL;
@@ -262,13 +262,13 @@
 }
 
 static apr_status_t initialize_secret(server_rec *s)
 {
     apr_status_t status;
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, s,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, s,
                  "Digest: generating secret for digest authentication ...");
 
 #if APR_HAS_RANDOM
     status = apr_generate_random_bytes(secret, sizeof(secret));
 #else
 #error APR random number support is missing; you probably need to install the truerand library.
@@ -279,13 +279,13 @@
         ap_log_error(APLOG_MARK, APLOG_CRIT, status, s,
                      "Digest: error generating secret: %s", 
                      apr_strerror(status, buf, sizeof(buf)));
         return status;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, s, "Digest: done");
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, s, "Digest: done");
 
     return APR_SUCCESS;
 }
 
 static void log_error_and_cleanup(char *msg, apr_status_t sts, server_rec *s)
 {
@@ -381,13 +381,13 @@
 
     /* initialize_module() will be called twice, and if it's a DSO
      * then all static data from the first call will be lost. Only
      * set up our static data on the second call. */
     apr_pool_userdata_get(&data, userdata_key, s->process->pool);
     if (!data) {
-        apr_pool_userdata_setn((const void *)1, userdata_key,
+        apr_pool_userdata_set((const void *)1, userdata_key,
                                apr_pool_cleanup_null, s->process->pool);
         return OK;
     }
     if (initialize_secret(s) != APR_SUCCESS) {
         return !OK;
     }
@@ -507,13 +507,13 @@
         }
         conf->qop_list[0] = "none";
         return NULL;
     }
 
     if (!strcasecmp(op, "auth-int")) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, cmd->server,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
                      "Digest: WARNING: qop `auth-int' currently only works "
                      "correctly for responses with no entity");
     }
     else if (strcasecmp(op, "auth")) {
         return apr_pstrcat(cmd->pool, "Unrecognized qop: ", op, NULL);
     }
@@ -540,13 +540,13 @@
     if (endptr < (t+strlen(t)) && !apr_isspace(*endptr)) {
         return apr_pstrcat(cmd->pool,
                            "Invalid time in AuthDigestNonceLifetime: ",
                            t, NULL);
     }
 
-    ((digest_config_rec *) config)->nonce_lifetime = lifetime * APR_USEC_PER_SEC;
+    ((digest_config_rec *) config)->nonce_lifetime = apr_time_from_sec(lifetime);
     return NULL;
 }
 
 static const char *set_nonce_format(cmd_parms *cmd, void *config,
                                     const char *fmt)
 {
@@ -554,26 +554,26 @@
     return "AuthDigestNonceFormat is not implemented (yet)";
 }
 
 static const char *set_nc_check(cmd_parms *cmd, void *config, int flag)
 {
     if (flag && !client_shm)
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                      cmd->server, "Digest: WARNING: nonce-count checking "
                      "is not supported on platforms without shared-memory "
                      "support - disabling check");
 
     ((digest_config_rec *) config)->check_nc = flag;
     return NULL;
 }
 
 static const char *set_algorithm(cmd_parms *cmd, void *config, const char *alg)
 {
     if (!strcasecmp(alg, "MD5-sess")) {
         if (!client_shm) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0,
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                          cmd->server, "Digest: WARNING: algorithm `MD5-sess' "
                          "is not supported on platforms without shared-memory "
                          "support - reverting to MD5");
             alg = "MD5";
         }
     }
@@ -629,13 +629,13 @@
     shmem_size  = size;
     num_buckets = (size - sizeof(*client_list)) /
                   (sizeof(client_entry*) + HASH_DEPTH * sizeof(client_entry));
     if (num_buckets == 0) {
         num_buckets = 1;
     }
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, cmd->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, cmd->server,
                  "Digest: Set shmem-size: %ld, num-buckets: %ld", shmem_size,
                  num_buckets);
 
     return NULL;
 }
 
@@ -745,17 +745,17 @@
         client_list->table[bucket] = entry;
     }
 
     apr_global_mutex_unlock(client_lock);
 
     if (entry) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                       "get_client(): client %lu found", key);
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                       "get_client(): client %lu not found", key);
     }
 
     return entry;
 }
 
@@ -821,13 +821,13 @@
 
     /* try to allocate a new entry */
 
     entry = (client_entry *)apr_rmm_malloc(client_rmm, sizeof(client_entry));
     if (!entry) {
         long num_removed = gc();
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
                      "Digest: gc'd %ld client entries. Total new clients: "
                      "%ld; Total removed clients: %ld; Total renewed clients: "
                      "%ld", num_removed,
                      client_list->num_created - client_list->num_renewed,
                      client_list->num_removed, client_list->num_renewed);
         entry = (client_entry *)apr_rmm_malloc(client_rmm, sizeof(client_entry));
@@ -844,13 +844,13 @@
     client_list->table[bucket] = entry;
     client_list->num_created++;
     client_list->num_entries++;
 
     apr_global_mutex_unlock(client_lock);
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, s,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
                  "allocated new client %lu", key);
 
     return entry;
 }
 
 
@@ -1070,12 +1070,13 @@
         /* this counter is not synch'd, because it doesn't really matter
          * if it counts exactly.
          */
         t.time = (*otn_counter)++;
     }
     else {
+        /* XXX: WHAT IS THIS CONSTANT? */
         t.time = 42;
     }
     len = apr_base64_encode_binary(nonce, t.arr, sizeof(t.arr));
     gen_nonce_hash(nonce+NONCE_TIME_LEN, nonce, opaque, server, conf);
 
     return nonce;
@@ -1463,23 +1464,23 @@
     if (!conf->check_nc || !client_shm) {
         return OK;
     }
 
     nc = strtol(snc, &endptr, 16);
     if (endptr < (snc+strlen(snc)) && !apr_isspace(*endptr)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: invalid nc %s received - not a number", snc);
         return !OK;
     }
 
     if (!resp->client) {
         return !OK;
     }
 
     if (nc != resp->client->nonce_count) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: Warning, possible replay attack: nonce-count "
                       "check failed: %lu != %lu", nc,
                       resp->client->nonce_count);
         return !OK;
     }
 
@@ -1492,13 +1493,13 @@
     apr_time_t dt;
     int len;
     time_rec nonce_time;
     char tmp, hash[NONCE_HASH_LEN+1];
 
     if (strlen(resp->nonce) != NONCE_LEN) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: invalid nonce %s received - length is not %d",
                       resp->nonce, NONCE_LEN);
         note_digest_auth_failure(r, conf, resp, 1);
         return HTTP_UNAUTHORIZED;
     }
 
@@ -1507,42 +1508,42 @@
     len = apr_base64_decode_binary(nonce_time.arr, resp->nonce);
     gen_nonce_hash(hash, resp->nonce, resp->opaque, r->server, conf);
     resp->nonce[NONCE_TIME_LEN] = tmp;
     resp->nonce_time = nonce_time.time;
 
     if (strcmp(hash, resp->nonce+NONCE_TIME_LEN)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: invalid nonce %s received - hash is not %s",
                       resp->nonce, hash);
         note_digest_auth_failure(r, conf, resp, 1);
         return HTTP_UNAUTHORIZED;
     }
 
     dt = r->request_time - nonce_time.time;
     if (conf->nonce_lifetime > 0 && dt < 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: invalid nonce %s received - user attempted "
                       "time travel", resp->nonce);
         note_digest_auth_failure(r, conf, resp, 1);
         return HTTP_UNAUTHORIZED;
     }
 
     if (conf->nonce_lifetime > 0) {
         if (dt > conf->nonce_lifetime) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0,r,
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, 0,r,
                           "Digest: user %s: nonce expired (%.2f seconds old "
                           "- max lifetime %.2f) - sending new nonce", 
                           r->user, ((double)dt)/APR_USEC_PER_SEC, 
                           ((double)(conf->nonce_lifetime))/APR_USEC_PER_SEC);
             note_digest_auth_failure(r, conf, resp, 1);
             return HTTP_UNAUTHORIZED;
         }
     }
     else if (conf->nonce_lifetime == 0 && resp->client) {
         if (memcmp(resp->client->last_nonce, resp->nonce, NONCE_LEN)) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                           "Digest: user %s: one-time-nonce mismatch - sending "
                           "new nonce", r->user);
             note_digest_auth_failure(r, conf, resp, 1);
             return HTTP_UNAUTHORIZED;
         }
     }
@@ -1669,13 +1670,13 @@
 
     if (!(t = ap_auth_type(r)) || strcasecmp(t, "Digest")) {
         return DECLINED;
     }
 
     if (!ap_auth_name(r)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: need AuthName: %s", r->uri);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
 
     /* get the client response and mark */
@@ -1699,18 +1700,18 @@
 
 
     /* check for existence and syntax of Auth header */
 
     if (resp->auth_hdr_sts != VALID) {
         if (resp->auth_hdr_sts == NOT_DIGEST) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: client used wrong authentication scheme "
                           "`%s': %s", resp->scheme, r->uri);
         }
         else if (resp->auth_hdr_sts == INVALID) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: missing user, realm, nonce, uri, digest, "
                           "cnonce, or nonce_count in authorization header: %s",
                           r->uri);
         }
         /* else (resp->auth_hdr_sts == NO_HEADER) */
         note_digest_auth_failure(r, conf, resp, 0);
@@ -1727,13 +1728,13 @@
          * request-uri), so lets do a more sophisticated match
          */
         apr_uri_t r_uri, d_uri;
 
         copy_uri_components(&r_uri, resp->psd_request_uri, r);
         if (apr_uri_parse(r->pool, resp->uri, &d_uri) != APR_SUCCESS) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: invalid uri <%s> in Authorization header",
                           resp->uri);
             return HTTP_BAD_REQUEST;
         }
 
         if (d_uri.hostname) {
@@ -1745,13 +1746,13 @@
         if (d_uri.query) {
             ap_unescape_url(d_uri.query);
         }
 
         if (r->method_number == M_CONNECT) {
             if (strcmp(resp->uri, r_uri.hostinfo)) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "Digest: uri mismatch - <%s> does not match "
                               "request-uri <%s>", resp->uri, r_uri.hostinfo);
                 return HTTP_BAD_REQUEST;
             }
         }
         else if (
@@ -1773,62 +1774,62 @@
                     && d_uri.path[0] == '*' && d_uri.path[1] == '\0'))
             /* check that query matches */
             || (d_uri.query != r_uri.query
                 && (!d_uri.query || !r_uri.query
                     || strcmp(d_uri.query, r_uri.query)))
             ) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: uri mismatch - <%s> does not match "
                           "request-uri <%s>", resp->uri, resp->raw_request_uri);
             return HTTP_BAD_REQUEST;
         }
     }
 
     if (resp->opaque && resp->opaque_num == 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: received invalid opaque - got `%s'",
                       resp->opaque);
         note_digest_auth_failure(r, conf, resp, 0);
         return HTTP_UNAUTHORIZED;
     }
 
     if (strcmp(resp->realm, conf->realm)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: realm mismatch - got `%s' but expected `%s'",
                       resp->realm, conf->realm);
         note_digest_auth_failure(r, conf, resp, 0);
         return HTTP_UNAUTHORIZED;
     }
 
     if (resp->algorithm != NULL
         && strcasecmp(resp->algorithm, "MD5")
         && strcasecmp(resp->algorithm, "MD5-sess")) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: unknown algorithm `%s' received: %s",
                       resp->algorithm, r->uri);
         note_digest_auth_failure(r, conf, resp, 0);
         return HTTP_UNAUTHORIZED;
     }
 
     if (!conf->pwfile) {
         return DECLINED;
     }
 
     if (!(conf->ha1 = get_hash(r, r->user, conf->realm, conf->pwfile))) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Digest: user `%s' in realm `%s' not found: %s",
                       r->user, conf->realm, r->uri);
         note_digest_auth_failure(r, conf, resp, 0);
         return HTTP_UNAUTHORIZED;
     }
 
     
     if (resp->message_qop == NULL) {
         /* old (rfc-2069) style digest */
         if (strcmp(resp->digest, old_digest(r, resp, conf->ha1))) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: user %s: password mismatch: %s", r->user,
                           r->uri);
             note_digest_auth_failure(r, conf, resp, 0);
             return HTTP_UNAUTHORIZED;
         }
     }
@@ -1842,26 +1843,26 @@
             }
         }
 
         if (!match
             && !(conf->qop_list[0] == NULL
                  && !strcasecmp(resp->message_qop, "auth"))) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: invalid qop `%s' received: %s",
                           resp->message_qop, r->uri);
             note_digest_auth_failure(r, conf, resp, 0);
             return HTTP_UNAUTHORIZED;
         }
 
         exp_digest = new_digest(r, resp, conf);
         if (!exp_digest) {
             /* we failed to allocate a client struct */
             return HTTP_INTERNAL_SERVER_ERROR;
         }
         if (strcmp(resp->digest, exp_digest)) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: user %s: password mismatch: %s", r->user,
                           r->uri);
             note_digest_auth_failure(r, conf, resp, 0);
             return HTTP_UNAUTHORIZED;
         }
     }
@@ -1993,25 +1994,25 @@
                 if (apr_table_get(grpstatus, w)) {
                     return OK;
                 }
             }
         }
         else {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Digest: access to %s failed, reason: unknown "
                           "require directive \"%s\"",
                           r->uri, reqs[x].requirement);
             return DECLINED;
         }
     }
 
     if (!method_restricted) {
         return OK;
     }
 
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "Digest: access to %s failed, reason: user %s not "
                   "allowed access", r->uri, user);
 
     note_digest_auth_failure(r, conf,
         (digest_header_rec *) ap_get_module_config(r->request_config,
                                                    &auth_digest_module),
@@ -2132,13 +2133,13 @@
 
         /* calculate rspauth attribute
          */
         if (resp->algorithm && !strcasecmp(resp->algorithm, "MD5-sess")) {
             ha1 = get_session_HA1(r, resp, conf, 0);
             if (!ha1) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "Digest: internal error: couldn't find session "
                               "info for user %s", resp->username);
                 return !OK;
             }
         }
         else {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/aaa: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/netware/mod_cache.def /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware/mod_cache.def
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/netware/mod_cache.def	2002-01-12 07:39:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware/mod_cache.def	2002-05-08 01:39:16.000000000 +0800
@@ -1,6 +1,5 @@
 EXPORT  cache_module
-EXPORT  cache_hook_create_entity
-EXPORT  cache_hook_open_entity
-EXPORT  cache_hook_remove_url
+EXPORT  @mod_cache.imp
+
 
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware: mod_disk_cache.def
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/netware/mod_mem_cache.def /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware/mod_mem_cache.def
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/netware/mod_mem_cache.def	2002-01-12 07:39:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware/mod_mem_cache.def	2002-05-08 01:39:16.000000000 +0800
@@ -1,5 +1,3 @@
-IMPORT  cache_hook_create_entity
-IMPORT  cache_hook_open_entity
-IMPORT  cache_hook_remove_url
+IMPORT  @mod_cache.imp
 EXPORT  mem_cache_module
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/netware: mod_netware.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_isapi.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_isapi.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_isapi.c	2002-04-27 06:23:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_isapi.c	2002-06-13 06:27:37.000000000 +0800
@@ -55,500 +55,490 @@
  * originally written at the National Center for Supercomputing Applications,
  * University of Illinois, Urbana-Champaign.
  */
 
 /*
  * mod_isapi.c - Internet Server Application (ISA) module for Apache
- * by Alexei Kosut <akosut@apache.org>
+ * by Alexei Kosut <akosut@apache.org>, significant overhauls and
+ * redesign by William Rowe <wrowe@covalent.net>, and hints from many
+ * other developer/users who have hit on specific flaws.
  *
- * This module implements Microsoft's ISAPI, allowing Apache (when running
- * under Windows) to load Internet Server Applications (ISAPI extensions).
- * It implements all of the ISAPI 2.0 specification, except for the 
- * "Microsoft-only" extensions dealing with asynchronous I/O. All ISAPI
- * extensions that use only synchronous I/O and are compatible with the
- * ISAPI 2.0 specification should work (most ISAPI 1.0 extensions should
- * function as well).
+ * This module implements the ISAPI Handler architecture, allowing 
+ * Apache to load Internet Server Applications (ISAPI extensions),
+ * similar to the support in IIS, Zope, O'Reilly's WebSite and others.
  *
- * To load, simply place the ISA in a location in the document tree.
- * Then add an "AddHandler isapi-isa dll" into your config file.
- * You should now be able to load ISAPI DLLs just be reffering to their
- * URLs. Make sure the ExecCGI option is active in the directory
- * the ISA is in.
+ * It is a complete implementation of the ISAPI 2.0 specification, 
+ * except for "Microsoft extensions" to the API which provide 
+ * asynchronous I/O.  It is further extended to include additional
+ * "Microsoft extentions" through IIS 5.0, with some deficiencies
+ * where one-to-one mappings don't exist.
+ *
+ * Refer to /manual/mod/mod_isapi.html for additional details on
+ * configuration and use, but check this source for specific support
+ * of the API, 
  */
 
-#include "apr_strings.h"
-#include "apr_portable.h"
-#include "apr_buckets.h"
 #include "ap_config.h"
 #include "httpd.h"
 #include "http_config.h"
 #include "http_core.h"
 #include "http_protocol.h"
 #include "http_request.h"
 #include "http_log.h"
 #include "util_script.h"
 #include "mod_core.h"
+#include "apr_lib.h"
+#include "apr_strings.h"
+#include "apr_portable.h"
+#include "apr_buckets.h"
+#include "apr_thread_mutex.h"
+#include "apr_thread_rwlock.h"
+#include "apr_hash.h"
+#include "mod_isapi.h"
 
-/* We use the exact same header file as the original */
-#include <HttpExt.h>
-
-#if !defined(HSE_REQ_MAP_URL_TO_PATH_EX) \
- || !defined(HSE_REQ_SEND_RESPONSE_HEADER_EX)
-#pragma message("WARNING: This build of Apache is missing the recent changes")
-#pragma message("in the Microsoft Win32 Platform SDK; some mod_isapi features")
-#pragma message("will be disabled.  To obtain the latest Platform SDK files,")
-#pragma message("please refer to:")
-#pragma message("http://msdn.microsoft.com/downloads/sdks/platform/platform.asp")
-#endif
-
-/* TODO: Unknown errors that must be researched for correct codes */
-
-#define TODO_ERROR 1
+/* Retry frequency for a failed-to-load isapi .dll */
+#define ISAPI_RETRY apr_time_from_sec(30)
 
-/* Seems IIS does not enforce the requirement for \r\n termination on HSE_REQ_SEND_RESPONSE_HEADER,
-   define this to conform */
-#define RELAX_HEADER_RULE
+/**********************************************************
+ *
+ *  ISAPI Module Configuration
+ *
+ **********************************************************/
 
 module AP_MODULE_DECLARE_DATA isapi_module;
 
-/* Declare the ISAPI functions */
+#define ISAPI_UNDEF -1
 
-BOOL WINAPI GetServerVariable (HCONN hConn, LPSTR lpszVariableName,
-                               LPVOID lpvBuffer, LPDWORD lpdwSizeofBuffer);
-BOOL WINAPI WriteClient (HCONN ConnID, LPVOID Buffer, LPDWORD lpdwBytes,
-                         DWORD dwReserved);
-BOOL WINAPI ReadClient (HCONN ConnID, LPVOID lpvBuffer, LPDWORD lpdwSize);
-BOOL WINAPI ServerSupportFunction (HCONN hConn, DWORD dwHSERequest,
-                                   LPVOID lpvBuffer, LPDWORD lpdwSize,
-                                   LPDWORD lpdwDataType);
-
-/* Our isapi server config structure */
-
-typedef struct {
-    apr_array_header_t *loaded;
-    DWORD ReadAheadBuffer;
-    int LogNotSupported;
-    int AppendLogToErrors;
-    int AppendLogToQuery;
-} isapi_server_conf;
+/* Our isapi per-dir config structure */
+typedef struct isapi_dir_conf {
+    int read_ahead_buflen;
+    int log_unsupported;
+    int log_to_errlog;
+    int log_to_query;
+    int fake_async;
+} isapi_dir_conf;
 
-/* Our loaded isapi module description structure */
+typedef struct isapi_loaded isapi_loaded;
 
-typedef struct {
-    const char *filename;
-    apr_dso_handle_t *handle;
-    HSE_VERSION_INFO *pVer;
-    PFN_GETEXTENSIONVERSION GetExtensionVersion;
-    PFN_HTTPEXTENSIONPROC   HttpExtensionProc;
-    PFN_TERMINATEEXTENSION  TerminateExtension;
-    int   refcount;
-    DWORD timeout;
-    BOOL  fakeasync;
-    DWORD reportversion;
-} isapi_loaded;
+apr_status_t isapi_lookup(apr_pool_t *p, server_rec *s, request_rec *r, 
+                          const char *fpath, isapi_loaded** isa);
 
-/* Our "Connection ID" structure */
+static void *create_isapi_dir_config(apr_pool_t *p, char *dummy)
+{
+    isapi_dir_conf *dir = apr_palloc(p, sizeof(isapi_dir_conf));
+    
+    dir->read_ahead_buflen = ISAPI_UNDEF;
+    dir->log_unsupported   = ISAPI_UNDEF;
+    dir->log_to_errlog     = ISAPI_UNDEF;
+    dir->log_to_query      = ISAPI_UNDEF;
+    dir->fake_async        = ISAPI_UNDEF;
 
-typedef struct {
-    LPEXTENSION_CONTROL_BLOCK ecb;
-    isapi_server_conf *sconf;
-    isapi_loaded *isa;
-    request_rec  *r;
-    PFN_HSE_IO_COMPLETION completion;
-    PVOID  completion_arg;
-    HANDLE complete;
-} isapi_cid;
+    return dir;
+}
 
-static void *create_isapi_server_config(apr_pool_t *p, server_rec *s)
+static void *merge_isapi_dir_configs(apr_pool_t *p, void *base_, void *add_)
 {
-    isapi_server_conf *sconf = apr_palloc(p, sizeof(isapi_server_conf));
-    sconf->loaded = apr_array_make(p, 20, sizeof(isapi_loaded*));
+    isapi_dir_conf *base = (isapi_dir_conf *) base_;
+    isapi_dir_conf *add = (isapi_dir_conf *) add_;
+    isapi_dir_conf *dir = apr_palloc(p, sizeof(isapi_dir_conf));
     
-    sconf->ReadAheadBuffer = 49152;
-    sconf->LogNotSupported    = -1;
-    sconf->AppendLogToErrors   = 0;
-    sconf->AppendLogToQuery    = 0;
-
-    return sconf;
+    dir->read_ahead_buflen = (add->read_ahead_buflen == ISAPI_UNDEF)
+                                ? base->read_ahead_buflen
+                                 : add->read_ahead_buflen;
+    dir->log_unsupported   = (add->log_unsupported == ISAPI_UNDEF)
+                                ? base->log_unsupported
+                                 : add->log_unsupported;
+    dir->log_to_errlog     = (add->log_to_errlog == ISAPI_UNDEF)
+                                ? base->log_to_errlog
+                                 : add->log_to_errlog;
+    dir->log_to_query      = (add->log_to_query == ISAPI_UNDEF)
+                                ? base->log_to_query
+                                 : add->log_to_query;
+    dir->fake_async        = (add->fake_async == ISAPI_UNDEF)
+                                ? base->fake_async
+                                 : add->fake_async;
+    
+    return dir;
 }
 
-static int compare_loaded(const void *av, const void *bv)
+static const char *isapi_cmd_cachefile(cmd_parms *cmd, void *dummy, 
+                                       const char *filename)
 {
-    const isapi_loaded **a = av;
-    const isapi_loaded **b = bv;
+    isapi_loaded *isa;
+    apr_finfo_t tmp;
+    apr_status_t rv;
+    char *fspec;
+
+    /* ### Just an observation ... it would be terribly cool to be
+     * able to use this per-dir, relative to the directory block being
+     * defined.  The hash result remains global, but shorthand of
+     * <Directory "c:/webapps/isapi">
+     *     ISAPICacheFile myapp.dll anotherapp.dll thirdapp.dll
+     * </Directory>
+     * would be very convienent.
+     */
+    fspec = ap_server_root_relative(cmd->pool, filename);
+    if (!fspec) {
+	ap_log_error(APLOG_MARK, APLOG_WARNING, APR_EBADPATH, cmd->server,
+	             "ISAPI: invalid module path, skipping %s", filename);
+	return NULL;
+    }
+    if ((rv = apr_stat(&tmp, fspec, APR_FINFO_TYPE, 
+                      cmd->temp_pool)) != APR_SUCCESS) { 
+	ap_log_error(APLOG_MARK, APLOG_WARNING, rv, cmd->server,
+	    "ISAPI: unable to stat, skipping %s", fspec);
+	return NULL;
+    }
+    if (tmp.filetype != APR_REG) {
+	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
+	    "ISAPI: not a regular file, skipping %s", fspec);
+	return NULL;
+    }
 
-    return strcmp((*a)->filename, (*b)->filename);
+    /* Load the extention as cached (with null request_rec) */
+    rv = isapi_lookup(cmd->pool, cmd->server, NULL, fspec, &isa); 
+    if (rv != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_WARNING, rv, cmd->server,
+                     "ISAPI: unable to cache, skipping %s", fspec);
+	return NULL;
+    }
+
+    return NULL;
 }
 
-static int isapi_post_config(apr_pool_t *p, apr_pool_t *plog,
-                             apr_pool_t *ptemp, server_rec *s)
+static const command_rec isapi_cmds[] = {
+    AP_INIT_TAKE1("ISAPIReadAheadBuffer", ap_set_int_slot,
+        (void *)APR_OFFSETOF(isapi_dir_conf, read_ahead_buflen), 
+        OR_FILEINFO, "Maximum client request body to initially pass to the"
+                     " ISAPI handler (default: 48192)"),
+    AP_INIT_FLAG("ISAPILogNotSupported", ap_set_flag_slot,
+        (void *)APR_OFFSETOF(isapi_dir_conf, log_unsupported), 
+        OR_FILEINFO, "Log requests not supported by the ISAPI server"
+                     " on or off (default: off)"),
+    AP_INIT_FLAG("ISAPIAppendLogToErrors", ap_set_flag_slot,
+        (void *)APR_OFFSETOF(isapi_dir_conf, log_to_errlog), 
+        OR_FILEINFO, "Send all Append Log requests to the error log"
+                     " on or off (default: off)"),
+    AP_INIT_FLAG("ISAPIAppendLogToQuery", ap_set_flag_slot,
+        (void *)APR_OFFSETOF(isapi_dir_conf, log_to_query), 
+        OR_FILEINFO, "Append Log requests are concatinated to the query args"
+                     " on or off (default: on)"),
+    AP_INIT_FLAG("ISAPIFakeAsync", ap_set_flag_slot,
+        (void *)APR_OFFSETOF(isapi_dir_conf, fake_async), 
+        OR_FILEINFO, "Fake Asynchronous support for isapi callbacks"
+                     " on or off [Experimental] (default: off)"),
+    AP_INIT_ITERATE("ISAPICacheFile", isapi_cmd_cachefile, NULL, 
+        RSRC_CONF, "Cache the specified ISAPI extension in-process"),
+    {NULL}
+};
+
+/**********************************************************
+ *
+ *  ISAPI Module Cache handling section
+ *
+ **********************************************************/
+
+/* Our isapi global config values */
+static struct isapi_global_conf {
+    apr_pool_t         *pool;
+    apr_thread_mutex_t *lock;
+    apr_hash_t         *hash;
+} loaded;
+
+/* Our loaded isapi module description structure */
+struct isapi_loaded {
+    const char          *filename;
+    apr_thread_rwlock_t *in_progress;
+    apr_status_t         last_load_rv;
+    apr_time_t           last_load_time;
+    apr_dso_handle_t    *handle;
+    HSE_VERSION_INFO    *isapi_version;
+    apr_uint32_t         report_version;
+    apr_uint32_t         timeout;
+    PFN_GETEXTENSIONVERSION GetExtensionVersion;
+    PFN_HTTPEXTENSIONPROC   HttpExtensionProc;
+    PFN_TERMINATEEXTENSION  TerminateExtension;
+};
+
+static apr_status_t isapi_unload(isapi_loaded *isa, int force)
 {
-    isapi_server_conf *sconf = ap_get_module_config(s->module_config, 
-                                                    &isapi_module);
-    isapi_loaded **elts = (isapi_loaded **)sconf->loaded->elts;
-    int nelts = sconf->loaded->nelts;
-
-    /* sort the elements of the main_server, by filename */
-    qsort(elts, nelts, sizeof(isapi_loaded*), compare_loaded);
-
-    /* and make all virtualhosts share the same */
-    for (s = s->next; s; s = s->next) {
-	ap_set_module_config(s->module_config, &isapi_module, sconf);
+    /* All done with the DLL... get rid of it...
+     *
+     * If optionally cached, and we weren't asked to force the unload,
+     * pass HSE_TERM_ADVISORY_UNLOAD, and if it returns 1, unload, 
+     * otherwise, leave it alone (it didn't choose to cooperate.)
+     */
+    if (!isa->handle) {
+        return APR_SUCCESS;
     }
-    return OK;
+    if (isa->TerminateExtension) {
+        if (force) {
+            (*isa->TerminateExtension)(HSE_TERM_MUST_UNLOAD);
+        }
+        else if (!(*isa->TerminateExtension)(HSE_TERM_ADVISORY_UNLOAD)) {
+            return APR_EGENERAL;
+        }
+    }
+    apr_dso_unload(isa->handle);
+    isa->handle = NULL;
+    return APR_SUCCESS;
 }
 
-static apr_status_t isapi_unload(isapi_loaded* isa, int force);
-
-static apr_status_t cleanup_isapi(void *isa)
+static apr_status_t cleanup_isapi(void *isa_)
 {
-    return isapi_unload((isapi_loaded*) isa, TRUE);
+    isapi_loaded* isa = (isapi_loaded*) isa_;
+
+    /* We must force the module to unload, we are about 
+     * to lose the isapi structure's allocation entirely.
+     */
+    return isapi_unload(isa, 1);
 }
 
-static apr_status_t isapi_load(apr_pool_t *p, isapi_server_conf *sconf, 
-                               request_rec *r, const char *fpath, 
-                               isapi_loaded** isa)
+static apr_status_t isapi_load(apr_pool_t *p, server_rec *s, isapi_loaded *isa)
 {
-    isapi_loaded **found = (isapi_loaded **)sconf->loaded->elts;
     apr_status_t rv;
-    int n;
 
-    for (n = 0; n < sconf->loaded->nelts; ++n) {
-        if (strcasecmp(fpath, (*found)->filename) == 0) {
-            break;
-        }
-        ++found;
-    }
-    
-    if (n < sconf->loaded->nelts) 
-    {
-        *isa = *found;
-        if ((*isa)->handle) 
-        {
-            ++(*isa)->refcount;
-            return APR_SUCCESS;
-        }
-        /* Otherwise we fall through and have to reload the resource
-         * into this existing mod_isapi cache bucket.
-         */
-    }
-    else
-    {
-        *isa = apr_pcalloc(p, sizeof(isapi_module));
-        (*isa)->filename = fpath;
-        (*isa)->pVer = apr_pcalloc(p, sizeof(HSE_VERSION_INFO));
-    
-        /* TODO: These need to become overrideable, so that we
-         * assure a given isapi can be fooled into behaving well.
-         */
-        (*isa)->timeout = INFINITE; /* microsecs */
-        (*isa)->fakeasync = TRUE;
-        (*isa)->reportversion = MAKELONG(0, 5); /* Revision 5.0 */
-    }
+    isa->isapi_version = apr_pcalloc(p, sizeof(HSE_VERSION_INFO));
+
+    /* TODO: These aught to become overrideable, so that we
+     * assure a given isapi can be fooled into behaving well.
+     *
+     * The tricky bit, they aren't really a per-dir sort of
+     * config, they will always be constant across every 
+     * reference to the .dll no matter what context (vhost,
+     * location, etc) they apply to.
+     */
+    isa->report_version = MAKELONG(0, 5); /* Revision 5.0 */
+    isa->timeout = INFINITE; /* microsecs */
     
-    rv = apr_dso_load(&(*isa)->handle, fpath, p);
+    rv = apr_dso_load(&isa->handle, isa->filename, p);
     if (rv)
     {
-        ap_log_rerror(APLOG_MARK, APLOG_ALERT, rv, r,
-                      "ISAPI %s failed to load", fpath);
-        (*isa)->handle = NULL;
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "ISAPI: failed to load %s", isa->filename);
+        isa->handle = NULL;
         return rv;
     }
 
-    rv = apr_dso_sym((void**)&(*isa)->GetExtensionVersion, (*isa)->handle,
+    rv = apr_dso_sym((void**)&isa->GetExtensionVersion, isa->handle,
                      "GetExtensionVersion");
     if (rv)
     {
-        ap_log_rerror(APLOG_MARK, APLOG_ALERT, rv, r,
-                      "ISAPI %s is missing GetExtensionVersion()",
-                      fpath);
-        apr_dso_unload((*isa)->handle);
-        (*isa)->handle = NULL;
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "ISAPI: missing GetExtensionVersion() in %s",
+                     isa->filename);
+        apr_dso_unload(isa->handle);
+        isa->handle = NULL;
         return rv;
     }
 
-    rv = apr_dso_sym((void**)&(*isa)->HttpExtensionProc, (*isa)->handle,
+    rv = apr_dso_sym((void**)&isa->HttpExtensionProc, isa->handle,
                      "HttpExtensionProc");
     if (rv)
     {
-        ap_log_rerror(APLOG_MARK, APLOG_ALERT, rv, r,
-                      "ISAPI %s is missing HttpExtensionProc()",
-                      fpath);
-        apr_dso_unload((*isa)->handle);
-        (*isa)->handle = NULL;
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "ISAPI: missing HttpExtensionProc() in %s",
+                     isa->filename);
+        apr_dso_unload(isa->handle);
+        isa->handle = NULL;
         return rv;
     }
 
     /* TerminateExtension() is an optional interface */
-    rv = apr_dso_sym((void**)&(*isa)->TerminateExtension, (*isa)->handle,
+    rv = apr_dso_sym((void**)&isa->TerminateExtension, isa->handle,
                      "TerminateExtension");
     SetLastError(0);
 
     /* Run GetExtensionVersion() */
-    if (!((*isa)->GetExtensionVersion)((*isa)->pVer)) {
+    if (!(isa->GetExtensionVersion)(isa->isapi_version)) {
         apr_status_t rv = apr_get_os_error();
-        ap_log_rerror(APLOG_MARK, APLOG_ALERT, rv, r,
-                      "ISAPI %s call GetExtensionVersion() failed", 
-                      fpath);
-        apr_dso_unload((*isa)->handle);
-        (*isa)->handle = NULL;
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "ISAPI: failed call to GetExtensionVersion() in %s", 
+                     isa->filename);
+        apr_dso_unload(isa->handle);
+        isa->handle = NULL;
         return rv;
     }
 
-    ++(*isa)->refcount;
-
-    apr_pool_cleanup_register(p, *isa, cleanup_isapi, 
-                                   apr_pool_cleanup_null);
+    apr_pool_cleanup_register(p, isa, cleanup_isapi, 
+                              apr_pool_cleanup_null);
 
     return APR_SUCCESS;
 }
 
-static apr_status_t isapi_unload(isapi_loaded* isa, int force)
+apr_status_t isapi_lookup(apr_pool_t *p, server_rec *s, request_rec *r, 
+                          const char *fpath, isapi_loaded** isa)
 {
-    /* All done with the DLL... get rid of it...
-     *
-     * If optionally cached, pass HSE_TERM_ADVISORY_UNLOAD,
-     * and if it returns TRUE, unload, otherwise, cache it.
-     */
-    if (((--isa->refcount > 0) && !force) || !isa->handle)
-        return APR_SUCCESS;
-    if (isa->TerminateExtension) {
-        if (force)
-            (*isa->TerminateExtension)(HSE_TERM_MUST_UNLOAD);
-        else if (!(*isa->TerminateExtension)(HSE_TERM_ADVISORY_UNLOAD))
-            return APR_EGENERAL;
-    }
-    apr_dso_unload(isa->handle);
-    isa->handle = NULL;
-    return APR_SUCCESS;
-}
-
-apr_status_t isapi_handler (request_rec *r)
-{
-    isapi_server_conf * sconf;
-    apr_table_t *e;
     apr_status_t rv;
-    isapi_loaded *isa;
-    isapi_cid *cid;
-    const char *val;
-    DWORD read;
-    int res;
-    
-    if(strcmp(r->handler, "isapi-isa"))
-        return DECLINED;    
-
-    sconf = ap_get_module_config(r->server->module_config, &isapi_module);
-    e = r->subprocess_env;
+    const char *key;
 
-    /* Use similar restrictions as CGIs
-     *
-     * If this fails, it's pointless to load the isapi dll.
-     */
-    if (!(ap_allow_options(r) & OPT_EXECCGI))
-        return HTTP_FORBIDDEN;
-
-    if (r->finfo.filetype == APR_NOFILE)
-        return HTTP_NOT_FOUND;
-
-    if (r->finfo.filetype != APR_REG)
-        return HTTP_FORBIDDEN;
-
-    if ((r->used_path_info == AP_REQ_REJECT_PATH_INFO) &&
-        r->path_info && *r->path_info)
-    {
-        /* default to accept */
-        return HTTP_NOT_FOUND;
+    if ((rv = apr_thread_mutex_lock(loaded.lock)) != APR_SUCCESS) {
+        return rv;
     }
 
-    /* Load the isapi extention without caching (sconf == NULL) 
-     * but note that we will recover an existing cached module.
-     */
-    if (isapi_load(r->pool, sconf, r, r->filename, &isa) != APR_SUCCESS)
-        return HTTP_INTERNAL_SERVER_ERROR;
-        
-    /* Set up variables */
-    ap_add_common_vars(r);
-    ap_add_cgi_vars(r);
-    apr_table_setn(e, "UNMAPPED_REMOTE_USER", "REMOTE_USER");
-    if ((val = apr_table_get(e, "HTTPS")) && strcmp(val, "on"))
-        apr_table_setn(e, "SERVER_PORT_SECURE", "1");
-    else
-        apr_table_setn(e, "SERVER_PORT_SECURE", "0");
-    apr_table_setn(e, "URL", r->uri);
+    *isa = apr_hash_get(loaded.hash, fpath, APR_HASH_KEY_STRING);
 
-    /* Set up connection structure and ecb */
-    cid = apr_pcalloc(r->pool, sizeof(isapi_cid));
-    cid->sconf = ap_get_module_config(r->server->module_config, &isapi_module);
-
-    cid->ecb = apr_pcalloc(r->pool, sizeof(struct _EXTENSION_CONTROL_BLOCK));
-    cid->ecb->ConnID = (HCONN)cid;
-    cid->isa = isa;
-    cid->r = r;
-    cid->r->status = 0;
-    cid->complete = NULL;
-    cid->completion = NULL;
-    
-    cid->ecb->cbSize = sizeof(EXTENSION_CONTROL_BLOCK);
-    cid->ecb->dwVersion = isa->reportversion;
-    cid->ecb->dwHttpStatusCode = 0;
-    strcpy(cid->ecb->lpszLogData, "");
-    // TODO: are copies really needed here?
-    cid->ecb->lpszMethod = apr_pstrdup(r->pool, (char*) r->method);
-    cid->ecb->lpszQueryString = apr_pstrdup(r->pool, 
-                                (char*) apr_table_get(e, "QUERY_STRING"));
-    cid->ecb->lpszPathInfo = apr_pstrdup(r->pool, 
-                             (char*) apr_table_get(e, "PATH_INFO"));
-    cid->ecb->lpszPathTranslated = apr_pstrdup(r->pool, 
-                                   (char*) apr_table_get(e, "PATH_TRANSLATED"));
-    cid->ecb->lpszContentType = apr_pstrdup(r->pool, 
-                                (char*) apr_table_get(e, "CONTENT_TYPE"));
-    /* Set up the callbacks */
-    cid->ecb->GetServerVariable = GetServerVariable;
-    cid->ecb->WriteClient = WriteClient;
-    cid->ecb->ReadClient = ReadClient;
-    cid->ecb->ServerSupportFunction = ServerSupportFunction;
-
-    
-    /* Set up client input */
-    res = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR);
-    if (res) {
-        isapi_unload(isa, FALSE);
-        return res;
-    }
+    if (*isa) {
 
-    if (ap_should_client_block(r)) {
-        /* Time to start reading the appropriate amount of data,
-         * and allow the administrator to tweak the number
-         * TODO: add the httpd.conf option for ReadAheadBuffer.
+        /* If we find this lock exists, use a set-aside copy of gainlock
+         * to avoid race conditions on NULLing the in_progress variable 
+         * when the load has completed.  Release the global isapi hash
+         * lock so other requests can proceed, then rdlock for completion
+         * of loading our desired dll or wrlock if we would like to retry
+         * loading the dll (because last_load_rv failed and retry is up.)
          */
-        if (r->remaining) {
-            cid->ecb->cbTotalBytes = (apr_size_t)r->remaining;
-            if (cid->ecb->cbTotalBytes > cid->sconf->ReadAheadBuffer)
-                cid->ecb->cbAvailable = cid->sconf->ReadAheadBuffer;
-            else
-                cid->ecb->cbAvailable = cid->ecb->cbTotalBytes;
-        }
-        else
-        {
-            cid->ecb->cbTotalBytes = 0xffffffff;
-            cid->ecb->cbAvailable = cid->sconf->ReadAheadBuffer;
-        }
+        apr_thread_rwlock_t *gainlock = (*isa)->in_progress;
 
-        cid->ecb->lpbData = apr_pcalloc(r->pool, cid->ecb->cbAvailable + 1);
-
-        read = 0;
-        while (read < cid->ecb->cbAvailable &&
-               ((res = ap_get_client_block(r, cid->ecb->lpbData + read,
-                                        cid->ecb->cbAvailable - read)) > 0)) {
-            read += res;
+        /* gainlock is NULLed after the module loads successfully.
+         * This free-threaded module can be used without any locking.
+         */
+        if (!gainlock) {
+            rv = (*isa)->last_load_rv;
+            apr_thread_mutex_unlock(loaded.lock);
+            return rv;
         }
 
-        if (res < 0) {
-            isapi_unload(isa, FALSE);
-            return HTTP_INTERNAL_SERVER_ERROR;
+            
+        if ((*isa)->last_load_rv == APR_SUCCESS) {
+            apr_thread_mutex_unlock(loaded.lock);
+            if ((rv = apr_thread_rwlock_rdlock(gainlock)) 
+                    != APR_SUCCESS) {
+                return rv;
+            }
+            rv = (*isa)->last_load_rv;
+            apr_thread_rwlock_unlock(gainlock);
+            return rv;
         }
 
-        /* Although it's not to spec, IIS seems to null-terminate
-         * its lpdData string. So we will too.
-         */
-        if (res == 0)
-            cid->ecb->cbAvailable = cid->ecb->cbTotalBytes = read;
-        else
-            cid->ecb->cbAvailable = read;
-        cid->ecb->lpbData[read] = '\0';
-    }
-    else {
-        cid->ecb->cbTotalBytes = 0;
-        cid->ecb->cbAvailable = 0;
-        cid->ecb->lpbData = NULL;
-    }
-
-    /* All right... try and run the sucker */
-    rv = (*isa->HttpExtensionProc)(cid->ecb);
+        if (apr_time_now() > (*isa)->last_load_time + ISAPI_RETRY) {
+        
+            /* Remember last_load_time before releasing the global
+             * hash lock to avoid colliding with another thread
+             * that hit this exception at the same time as our
+             * retry attempt, since we unlock the global mutex
+             * before attempting a write lock for this module.
+             */
+            apr_time_t check_time = (*isa)->last_load_time;
+            apr_thread_mutex_unlock(loaded.lock);
 
-    /* Check for a log message - and log it */
-    if (cid->ecb->lpszLogData && *cid->ecb->lpszLogData)
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
-                      "ISAPI %s: %s", r->filename, cid->ecb->lpszLogData);
+            if ((rv = apr_thread_rwlock_wrlock(gainlock)) 
+                    != APR_SUCCESS) {
+                return rv;
+            }
 
-    switch(rv) {
-        case 0:  /* Strange, but MS isapi accepts this as success */
-        case HSE_STATUS_SUCCESS:
-        case HSE_STATUS_SUCCESS_AND_KEEP_CONN:
-            /* Ignore the keepalive stuff; Apache handles it just fine without
-             * the ISA's "advice".
-             * Per Microsoft: "In IIS versions 4.0 and later, the return
-             * values HSE_STATUS_SUCCESS and HSE_STATUS_SUCCESS_AND_KEEP_CONN
-             * are functionally identical: Keep-Alive connections are
-             * maintained, if supported by the client."
-             * ... so we were pat all this time
+            /* If last_load_time is unchanged, we still own this
+             * retry, otherwise presume another thread provided 
+             * our retry (for good or ill).  Relock the global
+             * hash for updating last_load_ vars, so their update
+             * is always atomic to the global lock.
              */
-            break;
+            if (check_time == (*isa)->last_load_time) {
 
-        case HSE_STATUS_PENDING:    
-            /* emulating async behavior...
-             *
-             * Create a cid->completed event and wait on it for some timeout
-             * so that the app thinks is it running async.
-             *
-             * All async ServerSupportFunction calls will be handled through
-             * the registered IO_COMPLETION hook.
-             */
-            
-            if (!isa->fakeasync) {
-                if (cid->sconf->LogNotSupported)
-                {
-                     ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                                   "ISAPI %s asynch I/O request refused", 
-                                   r->filename);
-                     cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
-                }
+                rv = isapi_load(loaded.pool, s, *isa);
+
+                apr_thread_mutex_lock(loaded.lock);
+                (*isa)->last_load_rv = rv;
+                (*isa)->last_load_time = apr_time_now();
+                apr_thread_mutex_unlock(loaded.lock);
             }
             else {
-                cid->complete = CreateEvent(NULL, FALSE, FALSE, NULL);
-                if (WaitForSingleObject(cid->complete, isa->timeout)
-                        == WAIT_TIMEOUT) {
-                    /* TODO: Now what... if this hung, then do we kill our own
-                     * thread to force its death?  For now leave timeout = -1
-                     */
-                }
+                rv = (*isa)->last_load_rv;
             }
-            break;
+            apr_thread_rwlock_unlock(gainlock);
 
-        case HSE_STATUS_ERROR:    
-            /* end response if we have yet to do so.
-             */
-            cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
-            break;
+            return rv;
+        }
 
-        default:
-            /* TODO: log unrecognized retval for debugging 
-             */
-            cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
-            break;
+        /* We haven't hit timeup on retry, let's grab the last_rv
+         * within the hash mutex before unlocking.
+         */
+        rv = (*isa)->last_load_rv;
+        apr_thread_mutex_unlock(loaded.lock);
+
+        return rv;
     }
 
-    /* Set the status (for logging) */
-    if (cid->ecb->dwHttpStatusCode) {
-        cid->r->status = cid->ecb->dwHttpStatusCode;
+    /* If the module was not found, it's time to create a hash key entry
+     * before releasing the hash lock to avoid multiple threads from 
+     * loading the same module.
+     */
+    key = apr_pstrdup(loaded.pool, fpath);
+    *isa = apr_pcalloc(loaded.pool, sizeof(isapi_loaded));
+    (*isa)->filename = key;
+    if (r) {
+        /* A mutex that exists only long enough to attempt to
+         * load this isapi dll, the release this module to all
+         * other takers that came along during the one-time
+         * load process.  Short lifetime for this lock would
+         * be great, however, using r->pool is nasty if those
+         * blocked on the lock haven't all unlocked before we
+         * attempt to destroy.  A nastier race condition than
+         * I want to deal with at this moment...
+         */
+        apr_thread_rwlock_create(&(*isa)->in_progress, loaded.pool);
+        apr_thread_rwlock_wrlock((*isa)->in_progress);
     }
 
-    /* All done with the DLL... get rid of it... */
-    isapi_unload(isa, FALSE);
+    apr_hash_set(loaded.hash, key, APR_HASH_KEY_STRING, *isa);
     
-    return OK;		/* NOT r->status, even if it has changed. */
+    /* Now attempt to load the isapi on our own time, 
+     * allow other isapi processing to resume.
+     */
+    apr_thread_mutex_unlock(loaded.lock);
+
+    rv = isapi_load(loaded.pool, s, *isa);
+    (*isa)->last_load_time = apr_time_now();
+    (*isa)->last_load_rv = rv;
+
+    if (r && (rv == APR_SUCCESS)) {
+        /* Let others who are blocked on this particular
+         * module resume their requests, for better or worse.
+         */
+        apr_thread_rwlock_t *unlock = (*isa)->in_progress;
+        (*isa)->in_progress = NULL;
+        apr_thread_rwlock_unlock(unlock);
+    }
+    else if (!r && (rv != APR_SUCCESS)) {
+        /* We must leave a rwlock around for requests to retry
+         * loading this dll after timeup... since we were in 
+         * the setup code we had avoided creating this lock.
+         */
+        apr_thread_rwlock_create(&(*isa)->in_progress, loaded.pool);
+    }
+
+    return (*isa)->last_load_rv;
 }
 
-BOOL WINAPI GetServerVariable (HCONN hConn, LPSTR lpszVariableName,
-                               LPVOID lpvBuffer, LPDWORD lpdwSizeofBuffer)
+/**********************************************************
+ *
+ *  ISAPI Module request callbacks section
+ *
+ **********************************************************/
+
+/* Our "Connection ID" structure */
+typedef struct isapi_cid {
+    EXTENSION_CONTROL_BLOCK *ecb;
+    isapi_dir_conf           dconf;
+    isapi_loaded            *isa;
+    request_rec             *r;
+    int                      headers_sent;
+    PFN_HSE_IO_COMPLETION    completion;
+    void                    *completion_arg;
+    apr_thread_mutex_t      *completed;
+} isapi_cid;
+
+int APR_THREAD_FUNC GetServerVariable (isapi_cid    *cid, 
+                                       char         *variable_name,
+                                       void         *buf_data, 
+                                       apr_uint32_t *buf_size)
 {
-    request_rec *r = ((isapi_cid *)hConn)->r;
+    request_rec *r = cid->r;
     const char *result;
-    DWORD len;
+    apr_uint32_t len;
 
-    if (!strcmp(lpszVariableName, "ALL_HTTP")) 
+    if (!strcmp(variable_name, "ALL_HTTP")) 
     {
         /* lf delimited, colon split, comma seperated and 
          * null terminated list of HTTP_ vars 
          */
         const apr_array_header_t *arr = apr_table_elts(r->subprocess_env);
         const apr_table_entry_t *elts = (const apr_table_entry_t *)arr->elts;
@@ -557,202 +547,281 @@
         for (len = 0, i = 0; i < arr->nelts; i++) {
             if (!strncmp(elts[i].key, "HTTP_", 5)) {
                 len += strlen(elts[i].key) + strlen(elts[i].val) + 2;
             }
         }
   
-        if (*lpdwSizeofBuffer < len + 1) {
-            *lpdwSizeofBuffer = len + 1;
+        if (*buf_size < len + 1) {
+            *buf_size = len + 1;
             SetLastError(ERROR_INSUFFICIENT_BUFFER);
-            return FALSE;
+            return 0;
         }
     
         for (i = 0; i < arr->nelts; i++) {
             if (!strncmp(elts[i].key, "HTTP_", 5)) {
-                strcpy(lpvBuffer, elts[i].key);
-                ((char*)lpvBuffer) += strlen(elts[i].key);
-                *(((char*)lpvBuffer)++) = ':';
-                strcpy(lpvBuffer, elts[i].val);
-                ((char*)lpvBuffer) += strlen(elts[i].val);
-                *(((char*)lpvBuffer)++) = '\n';
+                strcpy(buf_data, elts[i].key);
+                ((char*)buf_data) += strlen(elts[i].key);
+                *(((char*)buf_data)++) = ':';
+                strcpy(buf_data, elts[i].val);
+                ((char*)buf_data) += strlen(elts[i].val);
+                *(((char*)buf_data)++) = '\n';
             }
         }
 
-        *(((char*)lpvBuffer)++) = '\0';
-        *lpdwSizeofBuffer = len;
-        return TRUE;
+        *(((char*)buf_data)++) = '\0';
+        *buf_size = len + 1;
+        return 1;
     }
     
-    if (!strcmp(lpszVariableName, "ALL_RAW")) 
+    if (!strcmp(variable_name, "ALL_RAW")) 
     {
         /* lf delimited, colon split, comma seperated and 
          * null terminated list of the raw request header
          */
         const apr_array_header_t *arr = apr_table_elts(r->headers_in);
         const apr_table_entry_t *elts = (const apr_table_entry_t *)arr->elts;
         int i;
 
         for (len = 0, i = 0; i < arr->nelts; i++) {
             len += strlen(elts[i].key) + strlen(elts[i].val) + 2;
         }
   
-        if (*lpdwSizeofBuffer < len + 1) {
-            *lpdwSizeofBuffer = len + 1;
+        if (*buf_size < len + 1) {
+            *buf_size = len + 1;
             SetLastError(ERROR_INSUFFICIENT_BUFFER);
-            return FALSE;
+            return 0;
         }
     
         for (i = 0; i < arr->nelts; i++) {
-            strcpy(lpvBuffer, elts[i].key);
-            ((char*)lpvBuffer) += strlen(elts[i].key);
-            *(((char*)lpvBuffer)++) = ':';
-            *(((char*)lpvBuffer)++) = ' ';
-            strcpy(lpvBuffer, elts[i].val);
-            ((char*)lpvBuffer) += strlen(elts[i].val);
-            *(((char*)lpvBuffer)++) = '\n';
-        }
-        *(((char*)lpvBuffer)++) = '\0';
-        *lpdwSizeofBuffer = len;
-        return TRUE;
+            strcpy(buf_data, elts[i].key);
+            ((char*)buf_data) += strlen(elts[i].key);
+            *(((char*)buf_data)++) = ':';
+            *(((char*)buf_data)++) = ' ';
+            strcpy(buf_data, elts[i].val);
+            ((char*)buf_data) += strlen(elts[i].val);
+            *(((char*)buf_data)++) = '\n';
+        }
+        *(((char*)buf_data)++) = '\0';
+        *buf_size = len + 1;
+        return 1;
     }
     
     /* Not a special case */
-    result = apr_table_get(r->subprocess_env, lpszVariableName);
+    result = apr_table_get(r->subprocess_env, variable_name);
 
     if (result) {
         len = strlen(result);
-        if (*lpdwSizeofBuffer < len + 1) {
-            *lpdwSizeofBuffer = len + 1;
+        if (*buf_size < len + 1) {
+            *buf_size = len + 1;
             SetLastError(ERROR_INSUFFICIENT_BUFFER);
-            return FALSE;
+            return 0;
         }
-        strcpy(lpvBuffer, result);
-        *lpdwSizeofBuffer = len;
-        return TRUE;
+        strcpy(buf_data, result);
+        *buf_size = len + 1;
+        return 1;
     }
 
     /* Not Found */
     SetLastError(ERROR_INVALID_INDEX);
-    return FALSE;
+    return 0;
 }
 
-BOOL WINAPI WriteClient (HCONN ConnID, LPVOID Buffer, LPDWORD lpdwBytes,
-                         DWORD dwReserved)
+int APR_THREAD_FUNC WriteClient(isapi_cid    *cid, 
+                                void         *buf_data, 
+                                apr_uint32_t *buf_size, 
+                                apr_uint32_t  flags)
 {
-    request_rec *r = ((isapi_cid *)ConnID)->r;
+    request_rec *r = cid->r;
     conn_rec *c = r->connection;
     apr_bucket_brigade *bb;
     apr_bucket *b;
-
-    if (dwReserved == HSE_IO_SYNC)
-        ; /* XXX: Fake it */
+    apr_status_t rv;
 
     bb = apr_brigade_create(r->pool, c->bucket_alloc);
-    b = apr_bucket_transient_create(Buffer, *lpdwBytes, c->bucket_alloc);
+    b = apr_bucket_transient_create(buf_data, *buf_size, c->bucket_alloc);
     APR_BRIGADE_INSERT_TAIL(bb, b);
     b = apr_bucket_flush_create(c->bucket_alloc);
     APR_BRIGADE_INSERT_TAIL(bb, b);
-    ap_pass_brigade(r->output_filters, bb);
+    rv = ap_pass_brigade(r->output_filters, bb);
 
-    return TRUE;
+    if ((flags & HSE_IO_ASYNC) && cid->completion) {
+        if (rv == OK) {
+            cid->completion(cid->ecb, cid->completion_arg, 
+                            *buf_size, ERROR_SUCCESS);
+        }
+        else {
+            cid->completion(cid->ecb, cid->completion_arg, 
+                            *buf_size, ERROR_WRITE_FAULT);
+        }
+    }
+    return (rv == OK);
 }
 
-BOOL WINAPI ReadClient (HCONN ConnID, LPVOID lpvBuffer, LPDWORD lpdwSize)
+int APR_THREAD_FUNC ReadClient(isapi_cid    *cid, 
+                               void         *buf_data, 
+                               apr_uint32_t *buf_size)
 {
-    request_rec *r = ((isapi_cid *)ConnID)->r;
-    DWORD read = 0;
+    request_rec *r = cid->r;
+    apr_uint32_t read = 0;
     int res;
 
-    if (r->remaining < *lpdwSize) {
-        *lpdwSize = (apr_size_t)r->remaining;
+    if (r->remaining < *buf_size) {
+        *buf_size = (apr_size_t)r->remaining;
     }
 
-    while (read < *lpdwSize &&
-           ((res = ap_get_client_block(r, (char*)lpvBuffer + read,
-                                       *lpdwSize - read)) > 0)) {
+    while (read < *buf_size &&
+           ((res = ap_get_client_block(r, (char*)buf_data + read,
+                                       *buf_size - read)) > 0)) {
         read += res;
     }
 
-    *lpdwSize = read;
-    return TRUE;
+    *buf_size = read;
+    if (res < 0) {
+        SetLastError(ERROR_READ_FAULT);
+    }
+    return (res >= 0);
 }
 
-static apr_ssize_t SendResponseHeaderEx(isapi_cid *cid, const char *stat,
-                                        const char *head, apr_size_t statlen,
+/* Common code invoked for both HSE_REQ_SEND_RESPONSE_HEADER and 
+ * the newer HSE_REQ_SEND_RESPONSE_HEADER_EX ServerSupportFunction(s)
+ */
+static apr_ssize_t send_response_header(isapi_cid *cid, 
+                                        const char *stat,
+                                        const char *head, 
+                                        apr_size_t statlen,
                                         apr_size_t headlen)
 {
+    int head_present = 1;
     int termarg;
     char *termch;
+    apr_size_t ate = 0;
+
+    if (!head || headlen == 0 || !*head) {
+        head = stat;
+        stat = NULL;
+        headlen = statlen;
+        statlen = 0;
+        head_present = 0; /* Don't eat the header */
+    }
 
     if (!stat || statlen == 0 || !*stat) {
-        stat = "Status: 200 OK";
+        if (head && headlen && *head && ((stat = memchr(head, '\r', headlen))
+                                      || (stat = memchr(head, '\n', headlen))
+                                      || (stat = memchr(head, '\0', headlen))
+                                      || (stat = head + headlen))) {
+            statlen = stat - head;
+            if (memchr(head, ':', statlen)) {
+                stat = "Status: 200 OK";
+                statlen = strlen(stat);
+            }
+            else {
+                const char *flip = head;
+                head = stat;
+                stat = flip;
+                headlen -= statlen;
+                ate += statlen;
+                if (*head == '\r' && headlen)
+                    ++head, --headlen, ++ate;
+                if (*head == '\n' && headlen)
+                    ++head, --headlen, ++ate;
+            }
+        }
     }
-    else {
-        char *newstat;
-        newstat = apr_palloc(cid->r->pool, statlen + 9);
+
+    if (stat && (statlen > 0) && *stat) {
+        char *newstat = apr_palloc(cid->r->pool, statlen + 9);
+        char *stattok = (char*)memchr(stat, ' ', statlen - 1) + 1;
         strcpy(newstat, "Status: ");
+        /* Now decide if we follow the xxx message 
+         * or the http/x.x xxx message format 
+         */
+        if (!apr_isdigit(*stat) && stattok && apr_isdigit(*stattok)) {
+            statlen -= stattok - (char*)stat;
+            stat = stattok;
+        }
         apr_cpystrn(newstat + 8, stat, statlen + 1);
         stat = newstat;
     }
 
     if (!head || headlen == 0 || !*head) {
         head = "\r\n";
+        headlen = 2;
     }
     else
     {
-        if (head[headlen]) {
+        if (head[headlen - 1] && head[headlen]) {
             /* Whoops... not NULL terminated */
             head = apr_pstrndup(cid->r->pool, head, headlen);
         }
     }
  
-    /* Parse them out, or die trying */
-    cid->r->status= ap_scan_script_header_err_strs(cid->r, NULL, &termch,
-                                                  &termarg, stat, head, NULL);
+    /* Seems IIS does not enforce the requirement for \r\n termination 
+     * on HSE_REQ_SEND_RESPONSE_HEADER, but we won't panic... 
+     * ap_scan_script_header_err_strs handles this aspect for us.
+     *
+     * Parse them out, or die trying 
+     */
+    if (stat) {
+        cid->r->status = ap_scan_script_header_err_strs(cid->r, NULL, 
+                                        &termch, &termarg, stat, head, NULL);
+    }
+    else {
+        cid->r->status = ap_scan_script_header_err_strs(cid->r, NULL, 
+                                        &termch, &termarg, head, NULL);
+    }
     cid->ecb->dwHttpStatusCode = cid->r->status;
     if (cid->r->status == HTTP_INTERNAL_SERVER_ERROR)
         return -1;
-    
-    /* Headers will actually go when they are good and ready */
 
-    /* If all went well, tell the caller we consumed the headers complete */
+    /* If only Status was passed, we consumed nothing 
+     */
+    if (!head_present)
+        return 0;
+
+    cid->headers_sent = 1;
+
+    /* If all went well, tell the caller we consumed the headers complete 
+     */
     if (!termch)
-        return(headlen);
+        return(ate + headlen);
 
-    /* Any data left is sent directly by the caller, all we
-     * give back is the size of the headers we consumed
+    /* Any data left must be sent directly by the caller, all we
+     * give back is the size of the headers we consumed (which only
+     * happens if the parser got to the head arg, which varies based
+     * on whether we passed stat+head to scan, or only head.
      */
-    if (termch && (termarg == 1) && head + headlen > termch) {
-        return termch - head;
+    if (termch && (termarg == (stat ? 1 : 0))
+               && head_present && head + headlen > termch) {
+        return ate + termch - head;
     }
-    return 0;
+    return ate;
 }
 
-BOOL WINAPI ServerSupportFunction(HCONN hConn, DWORD dwHSERequest,
-                                  LPVOID lpvBuffer, LPDWORD lpdwSize,
-                                  LPDWORD lpdwDataType)
+int APR_THREAD_FUNC ServerSupportFunction(isapi_cid    *cid, 
+                                          apr_uint32_t  HSE_code,
+                                          void         *buf_data, 
+                                          apr_uint32_t *buf_size,
+                                          apr_uint32_t *data_type)
 {
-    isapi_cid *cid = (isapi_cid *)hConn;
     request_rec *r = cid->r;
     conn_rec *c = r->connection;
     request_rec *subreq;
 
-    switch (dwHSERequest) {
-    case 1: /* HSE_REQ_SEND_URL_REDIRECT_RESP */
+    switch (HSE_code) {
+    case HSE_REQ_SEND_URL_REDIRECT_RESP:
         /* Set the status to be returned when the HttpExtensionProc()
          * is done.
          * WARNING: Microsoft now advertises HSE_REQ_SEND_URL_REDIRECT_RESP
          *          and HSE_REQ_SEND_URL as equivalant per the Jan 2000 SDK.
          *          They most definately are not, even in their own samples.
          */
-        apr_table_set (r->headers_out, "Location", lpvBuffer);
-        cid->r->status = cid->ecb->dwHttpStatusCode 
-                                               = HTTP_MOVED_TEMPORARILY;
-        return TRUE;
+        apr_table_set (r->headers_out, "Location", buf_data);
+        cid->r->status = cid->ecb->dwHttpStatusCode = HTTP_MOVED_TEMPORARILY;
+        return 1;
 
-    case 2: /* HSE_REQ_SEND_URL */
+    case HSE_REQ_SEND_URL:
         /* Soak up remaining input */
         if (r->remaining > 0) {
             char argsbuffer[HUGE_STRING_LEN];
             while (ap_get_client_block(r, argsbuffer, HUGE_STRING_LEN));
         }
 
@@ -761,245 +830,330 @@
         r->method_number = M_GET;
 
         /* Don't let anyone think there's still data */
         apr_table_unset(r->headers_in, "Content-Length");
 
         /* AV fault per PR3598 - redirected path is lost! */
-        (char*)lpvBuffer = apr_pstrdup(r->pool, (char*)lpvBuffer);
-        ap_internal_redirect((char*)lpvBuffer, r);
-        return TRUE;
+        (char*)buf_data = apr_pstrdup(r->pool, (char*)buf_data);
+        ap_internal_redirect((char*)buf_data, r);
+        return 1;
 
-    case 3: /* HSE_REQ_SEND_RESPONSE_HEADER */
+    case HSE_REQ_SEND_RESPONSE_HEADER:
     {
         /* Parse them out, or die trying */
         apr_size_t statlen = 0, headlen = 0;
         apr_ssize_t ate;
-        if (lpvBuffer)
-            statlen = strlen((char*) lpvBuffer);
-        if (lpdwDataType)
-            headlen = strlen((char*) lpdwDataType);
-        ate = SendResponseHeaderEx(cid, (char*) lpvBuffer,
-                                   (char*) lpdwDataType,
+        if (buf_data)
+            statlen = strlen((char*) buf_data);
+        if (data_type)
+            headlen = strlen((char*) data_type);
+        ate = send_response_header(cid, (char*) buf_data,
+                                   (char*) data_type,
                                    statlen, headlen);
         if (ate < 0) {
-            SetLastError(TODO_ERROR);
-            return FALSE;
+            SetLastError(ERROR_INVALID_PARAMETER);
+            return 0;
         }
         else if ((apr_size_t)ate < headlen) {
             apr_bucket_brigade *bb;
             apr_bucket *b;
             bb = apr_brigade_create(cid->r->pool, c->bucket_alloc);
-	    b = apr_bucket_transient_create((char*) lpdwDataType + ate, 
+	    b = apr_bucket_transient_create((char*) data_type + ate, 
                                            headlen - ate, c->bucket_alloc);
 	    APR_BRIGADE_INSERT_TAIL(bb, b);
             b = apr_bucket_flush_create(c->bucket_alloc);
 	    APR_BRIGADE_INSERT_TAIL(bb, b);
 	    ap_pass_brigade(cid->r->output_filters, bb);
         }
-        return TRUE;
+        return 1;
     }
 
-    case 4: /* HSE_REQ_DONE_WITH_SESSION */
-        /* Signal to resume the thread completing this request
+    case HSE_REQ_DONE_WITH_SESSION:
+        /* Signal to resume the thread completing this request,
+         * leave it to the pool cleanup to dispose of our mutex.
          */
-        if (cid->complete)
-            SetEvent(cid->complete);            
-        return TRUE;
+        if (cid->completed) {
+            apr_thread_mutex_unlock(cid->completed);
+        }
+        return 1;
 
-    case 1001: /* HSE_REQ_MAP_URL_TO_PATH */
+    case HSE_REQ_MAP_URL_TO_PATH:
     {
         /* Map a URL to a filename */
-        char *file = (char *)lpvBuffer;
-        DWORD len;
-        subreq = ap_sub_req_lookup_uri(apr_pstrndup(r->pool, file, *lpdwSize),
+        char *file = (char *)buf_data;
+        apr_uint32_t len;
+        subreq = ap_sub_req_lookup_uri(apr_pstrndup(r->pool, file, *buf_size),
                                        r, NULL);
 
-        len = apr_cpystrn(file, subreq->filename, *lpdwSize) - file;
+        len = apr_cpystrn(file, subreq->filename, *buf_size) - file;
 
 
         /* IIS puts a trailing slash on directories, Apache doesn't */
         if (subreq->finfo.filetype == APR_DIR) {
-            if (len < *lpdwSize - 1) {
+            if (len < *buf_size - 1) {
                 file[len++] = '\\';
                 file[len] = '\0';
             }
         }
-        *lpdwSize = len;
-        return TRUE;
+        *buf_size = len;
+        return 1;
     }
 
-    case 1002: /* HSE_REQ_GET_SSPI_INFO */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                           "ISAPI ServerSupportFunction HSE_REQ_GET_SSPI_INFO "
+    case HSE_REQ_GET_SSPI_INFO:
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                           "ISAPI: ServerSupportFunction HSE_REQ_GET_SSPI_INFO "
                            "is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
         
-    case 1003: /* HSE_APPEND_LOG_PARAMETER */
-        /* Log lpvBuffer, of lpdwSize bytes, in the URI Query (cs-uri-query) field
+    case HSE_APPEND_LOG_PARAMETER:
+        /* Log buf_data, of buf_size bytes, in the URI Query (cs-uri-query) field
          */
-        apr_table_set(r->notes, "isapi-parameter", (char*) lpvBuffer);
-        if (cid->sconf->AppendLogToQuery) {
+        apr_table_set(r->notes, "isapi-parameter", (char*) buf_data);
+        if (cid->dconf.log_to_query) {
             if (r->args)
-                r->args = apr_pstrcat(r->pool, r->args, (char*) lpvBuffer, NULL);
+                r->args = apr_pstrcat(r->pool, r->args, (char*) buf_data, NULL);
             else
-                r->args = apr_pstrdup(r->pool, (char*) lpvBuffer);
+                r->args = apr_pstrdup(r->pool, (char*) buf_data);
         }
-        if (cid->sconf->AppendLogToErrors)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
-                          "ISAPI %s: %s", cid->r->filename,
-                          (char*) lpvBuffer);
-        return TRUE;
+        if (cid->dconf.log_to_errlog)
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
+                          "ISAPI: %s: %s", cid->r->filename,
+                          (char*) buf_data);
+        return 1;
         
-    case 1005: /* HSE_REQ_IO_COMPLETION */
+    case HSE_REQ_IO_COMPLETION:
         /* Emulates a completion port...  Record callback address and 
          * user defined arg, we will call this after any async request 
          * (e.g. transmitfile) as if the request executed async.
          * Per MS docs... HSE_REQ_IO_COMPLETION replaces any prior call
-         * to HSE_REQ_IO_COMPLETION, and lpvBuffer may be set to NULL.
+         * to HSE_REQ_IO_COMPLETION, and buf_data may be set to NULL.
          */
-        if (!cid->isa->fakeasync) {
-            if (cid->sconf->LogNotSupported)
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction HSE_REQ_IO_COMPLETION "
-                          "is not supported: %s", r->filename);
-            SetLastError(ERROR_INVALID_PARAMETER);
-            return FALSE;
-        }
-        cid->completion = (PFN_HSE_IO_COMPLETION) lpvBuffer;
-        cid->completion_arg = (PVOID) lpdwDataType;
-        return TRUE;
+        if (cid->dconf.fake_async) {
+            cid->completion = (PFN_HSE_IO_COMPLETION) buf_data;
+            cid->completion_arg = (void *) data_type;
+            return 1;
+        }
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                      "ISAPI: ServerSupportFunction HSE_REQ_IO_COMPLETION "
+                      "is not supported: %s", r->filename);
+        SetLastError(ERROR_INVALID_PARAMETER);
+        return 0;
 
-    case 1006: /* HSE_REQ_TRANSMIT_FILE */
+    case HSE_REQ_TRANSMIT_FILE:
     {
-        HSE_TF_INFO *tf = (HSE_TF_INFO*)lpvBuffer;
+        /* we do nothing with (tf->dwFlags & HSE_DISCONNECT_AFTER_SEND)
+         */
+        HSE_TF_INFO *tf = (HSE_TF_INFO*)buf_data;
+        apr_uint32_t sent = 0;
+        apr_ssize_t ate = 0;
         apr_status_t rv;
         apr_bucket_brigade *bb;
         apr_bucket *b;
         apr_file_t *fd;
+        apr_off_t fsize;
 
-        if (!cid->isa->fakeasync && (tf->dwFlags & HSE_IO_ASYNC)) {
-            if (cid->sconf->LogNotSupported)
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                         "ISAPI ServerSupportFunction HSE_REQ_TRANSMIT_FILE "
+        if (!cid->dconf.fake_async && (tf->dwFlags & HSE_IO_ASYNC)) {
+            if (cid->dconf.log_unsupported)
+                ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                         "ISAPI: ServerSupportFunction HSE_REQ_TRANSMIT_FILE "
                          "as HSE_IO_ASYNC is not supported: %s", r->filename);
             SetLastError(ERROR_INVALID_PARAMETER);
-            return FALSE;
+            return 0;
         }
         
-        if ((rv = apr_os_file_put(&fd, tf->hFile, 0, r->pool)) != APR_SUCCESS) {
-            return FALSE;
+        /* Presume the handle was opened with the CORRECT semantics
+         * for TransmitFile 
+         */
+        if ((rv = apr_os_file_put(&fd, &tf->hFile, 
+                                  APR_READ | APR_XTHREAD, r->pool)) 
+                != APR_SUCCESS) {
+            return 0;
+        }
+        if (tf->BytesToWrite) {
+            fsize = tf->BytesToWrite;
+        }
+        else {
+            apr_finfo_t fi;
+            if (apr_file_info_get(&fi, APR_FINFO_SIZE, fd) != APR_SUCCESS) {
+                SetLastError(ERROR_INVALID_PARAMETER);
+                return 0;
+            }
+            fsize = fi.size - tf->Offset;
         }
         
         /* apr_dupfile_oshandle (&fd, tf->hFile, r->pool); */
         bb = apr_brigade_create(r->pool, c->bucket_alloc);
 
-        if (tf->dwFlags & HSE_IO_SEND_HEADERS) 
-        {
-            /* According to MS: if calling HSE_REQ_TRANSMIT_FILE with the
-             * HSE_IO_SEND_HEADERS flag, then you can't otherwise call any
-             * HSE_SEND_RESPONSE_HEADERS* fn, but if you don't use the flag,
-             * you must have done so.  They document that the pHead headers
-             * option is valid only for HSE_IO_SEND_HEADERS - we are a bit
-             * more flexible and assume with the flag, pHead are the
-             * response headers, and without, pHead simply contains text
-             * (handled after this case).
-             */
-            apr_ssize_t ate = SendResponseHeaderEx(cid, tf->pszStatusCode, 
-                                                   (char*)tf->pHead,
-                                                   strlen(tf->pszStatusCode), 
-                                                   tf->HeadLength);
+        /* According to MS: if calling HSE_REQ_TRANSMIT_FILE with the
+         * HSE_IO_SEND_HEADERS flag, then you can't otherwise call any
+         * HSE_SEND_RESPONSE_HEADERS* fn, but if you don't use the flag,
+         * you must have done so.  They document that the pHead headers
+         * option is valid only for HSE_IO_SEND_HEADERS - we are a bit
+         * more flexible and assume with the flag, pHead are the
+         * response headers, and without, pHead simply contains text
+         * (handled after this case).
+         */
+        if ((tf->dwFlags & HSE_IO_SEND_HEADERS) && tf->pszStatusCode) {
+            ate = send_response_header(cid, tf->pszStatusCode,  
+                                            (char*)tf->pHead,
+                                            strlen(tf->pszStatusCode),
+                                            tf->HeadLength);
+        }
+        else if (!cid->headers_sent && tf->pHead && tf->HeadLength 
+                                    && *(char*)tf->pHead) {
+            ate = send_response_header(cid, NULL, (char*)tf->pHead,
+                                            0, tf->HeadLength);
             if (ate < 0)
             {
                 apr_brigade_destroy(bb);
-                SetLastError(TODO_ERROR);
-                return FALSE;
-            }
-            if ((apr_size_t)ate < tf->HeadLength)
-            {
-                b = apr_bucket_transient_create((char*)tf->pHead + ate, 
-                                                tf->HeadLength - ate,
-                                                c->bucket_alloc);
-                APR_BRIGADE_INSERT_TAIL(bb, b);
+                SetLastError(ERROR_INVALID_PARAMETER);
+                return 0;
             }
         }
-        else if (tf->pHead && tf->HeadLength) {
-            b = apr_bucket_transient_create((char*)tf->pHead, 
-                                            tf->HeadLength,
-                                            c->bucket_alloc);
+
+        if (tf->pHead && (apr_size_t)ate < tf->HeadLength) {
+            sent = tf->HeadLength - ate;
+            b = apr_bucket_transient_create((char*)tf->pHead + ate, 
+                                            sent, c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(bb, b);
         }
 
-        b = apr_bucket_file_create(fd, tf->Offset, 
-                                   tf->BytesToWrite, r->pool, c->bucket_alloc);
+        sent += (apr_uint32_t)fsize;
+#if APR_HAS_LARGE_FILES
+        if (r->finfo.size > AP_MAX_SENDFILE) {
+            /* APR_HAS_LARGE_FILES issue; must split into mutiple buckets,
+             * no greater than MAX(apr_size_t), and more granular than that
+             * in case the brigade code/filters attempt to read it directly.
+             */
+            b = apr_bucket_file_create(fd, tf->Offset, AP_MAX_SENDFILE, 
+                                       r->pool, c->bucket_alloc);
+            while (fsize > AP_MAX_SENDFILE) {
+                apr_bucket *bc;
+                apr_bucket_copy(b, &bc);
+                APR_BRIGADE_INSERT_TAIL(bb, bc);
+                b->start += AP_MAX_SENDFILE;
+                fsize -= AP_MAX_SENDFILE;
+            }
+            b->length = (apr_size_t)fsize; /* Resize just the last bucket */
+        }
+        else
+#endif
+            b = apr_bucket_file_create(fd, tf->Offset, (apr_size_t)fsize, 
+                                       r->pool, c->bucket_alloc);
         APR_BRIGADE_INSERT_TAIL(bb, b);
         
         if (tf->pTail && tf->TailLength) {
+            sent += tf->TailLength;
             b = apr_bucket_transient_create((char*)tf->pTail, 
                                             tf->TailLength, c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(bb, b);
         }
         
         b = apr_bucket_flush_create(c->bucket_alloc);
         APR_BRIGADE_INSERT_TAIL(bb, b);
         ap_pass_brigade(r->output_filters, bb);
 
-        /* we do nothing with (tf->dwFlags & HSE_DISCONNECT_AFTER_SEND)
+        /* Use tf->pfnHseIO + tf->pContext, or if NULL, then use cid->fnIOComplete
+         * pass pContect to the HseIO callback.
          */
-
         if (tf->dwFlags & HSE_IO_ASYNC) {
-            /* XXX: Fake async response,
-             * use tf->pfnHseIO, or if NULL, then use cid->fnIOComplete
-             * pass pContect to the HseIO callback.
-             */
+            if (tf->pfnHseIO) {
+                if (rv == OK) {
+                    tf->pfnHseIO(cid->ecb, tf->pContext, 
+                                 ERROR_SUCCESS, sent);
+                }
+                else {
+                    tf->pfnHseIO(cid->ecb, tf->pContext, 
+                                 ERROR_WRITE_FAULT, sent);
+                }
+            }
+            else if (cid->completion) {
+                if (rv == OK) {
+                    cid->completion(cid->ecb, cid->completion_arg, 
+                                    sent, ERROR_SUCCESS);
+                }
+                else {
+                    cid->completion(cid->ecb, cid->completion_arg, 
+                                    sent, ERROR_WRITE_FAULT);
+                }
+            }
         }
-        return TRUE;
+        return (rv == OK);
     }
 
-    case 1007: /* HSE_REQ_REFRESH_ISAPI_ACL */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction "
+    case HSE_REQ_REFRESH_ISAPI_ACL:
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction "
                           "HSE_REQ_REFRESH_ISAPI_ACL "
                           "is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
-    case 1008: /* HSE_REQ_IS_KEEP_CONN */
-        *((LPBOOL) lpvBuffer) = (r->connection->keepalive == 1);
-        return TRUE;
-
-    case 1010: /* XXX: Fake it : HSE_REQ_ASYNC_READ_CLIENT */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI asynchronous I/O not supported: %s", 
-                          r->filename);
-        SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+    case HSE_REQ_IS_KEEP_CONN:
+        *((int *)buf_data) = (r->connection->keepalive == 1);
+        return 1;
+
+    case HSE_REQ_ASYNC_READ_CLIENT:
+    {
+        apr_uint32_t read = 0;
+        int res;
+        if (!cid->dconf.fake_async) {
+            if (cid->dconf.log_unsupported) 
+                ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                            "ISAPI: asynchronous I/O not supported: %s", 
+                            r->filename);
+            SetLastError(ERROR_INVALID_PARAMETER);
+            return 0;
+        }
+
+        if (r->remaining < *buf_size) {
+            *buf_size = (apr_size_t)r->remaining;
+        }
+
+        while (read < *buf_size &&
+            ((res = ap_get_client_block(r, (char*)buf_data + read,
+                                        *buf_size - read)) > 0)) {
+            read += res;
+        }
+
+        if ((*data_type & HSE_IO_ASYNC) && cid->completion) {
+            if (res >= 0) {
+                cid->completion(cid->ecb, cid->completion_arg, 
+                                read, ERROR_SUCCESS);
+            }
+            else {
+                cid->completion(cid->ecb, cid->completion_arg, 
+                                read, ERROR_READ_FAULT);
+            }
+        }
+        return (res >= 0);
+    }
 
-    case 1011: /* HSE_REQ_GET_IMPERSONATION_TOKEN  Added in ISAPI 4.0 */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction "
+    case HSE_REQ_GET_IMPERSONATION_TOKEN:  /* Added in ISAPI 4.0 */
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction "
                           "HSE_REQ_GET_IMPERSONATION_TOKEN "
                           "is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
-#ifdef HSE_REQ_MAP_URL_TO_PATH_EX
-    case 1012: /* HSE_REQ_MAP_URL_TO_PATH_EX */
+    case HSE_REQ_MAP_URL_TO_PATH_EX:
     {
         /* Map a URL to a filename */
-        LPHSE_URL_MAPEX_INFO info = (LPHSE_URL_MAPEX_INFO) lpdwDataType;
-        char* test_uri = apr_pstrndup(r->pool, (char *)lpvBuffer, *lpdwSize);
+        HSE_URL_MAPEX_INFO *info = (HSE_URL_MAPEX_INFO*)data_type;
+        char* test_uri = apr_pstrndup(r->pool, (char *)buf_data, *buf_size);
 
         subreq = ap_sub_req_lookup_uri(test_uri, r, NULL);
         info->cchMatchingURL = strlen(test_uri);        
         info->cchMatchingPath = apr_cpystrn(info->lpszPath, subreq->filename, 
-                                            MAX_PATH) - info->lpszPath;
+                                      sizeof(info->lpszPath)) - info->lpszPath;
 
         /* Mapping started with assuming both strings matched.
          * Now roll on the path_info as a mismatch and handle
          * terminating slashes for directory matches.
          */
         if (subreq->path_info && *subreq->path_info) {
@@ -1050,47 +1204,45 @@
          * XxX: As everywhere, EXEC flags could use some work...
          *      and this could go further with more flags, as desired.
          */ 
         info->dwFlags = (subreq->finfo.protection & APR_UREAD    ? 0x001 : 0)
                       | (subreq->finfo.protection & APR_UWRITE   ? 0x002 : 0)
                       | (subreq->finfo.protection & APR_UEXECUTE ? 0x204 : 0);
-        return TRUE;
+        return 1;
     }
-#endif
 
-    case 1014: /* HSE_REQ_ABORTIVE_CLOSE */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction HSE_REQ_ABORTIVE_CLOSE"
+    case HSE_REQ_ABORTIVE_CLOSE:
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction HSE_REQ_ABORTIVE_CLOSE"
                           " is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
-    case 1015: /* HSE_REQ_GET_CERT_INFO_EX  Added in ISAPI 4.0 */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction "
+    case HSE_REQ_GET_CERT_INFO_EX:  /* Added in ISAPI 4.0 */
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction "
                           "HSE_REQ_GET_CERT_INFO_EX "
                           "is not supported: %s", r->filename);        
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
-#ifdef HSE_REQ_SEND_RESPONSE_HEADER_EX
-    case 1016: /* HSE_REQ_SEND_RESPONSE_HEADER_EX  Added in ISAPI 4.0 */
+    case HSE_REQ_SEND_RESPONSE_HEADER_EX:  /* Added in ISAPI 4.0 */
     {
-        LPHSE_SEND_HEADER_EX_INFO shi
-                                  = (LPHSE_SEND_HEADER_EX_INFO) lpvBuffer;
-        /* XXX: ignore shi->fKeepConn?  We shouldn't need the advise */
-        /* r->connection->keepalive = shi->fKeepConn; */
-        apr_ssize_t ate = SendResponseHeaderEx(cid, shi->pszStatus, 
+        HSE_SEND_HEADER_EX_INFO *shi = (HSE_SEND_HEADER_EX_INFO*)buf_data;
+
+        /*  Ignore shi->fKeepConn - we don't want the advise
+         */
+        apr_ssize_t ate = send_response_header(cid, shi->pszStatus, 
                                                shi->pszHeader,
                                                shi->cchStatus, 
                                                shi->cchHeader);
         if (ate < 0) {
-            SetLastError(TODO_ERROR);
-            return FALSE;
+            SetLastError(ERROR_INVALID_PARAMETER);
+            return 0;
         }
         else if ((apr_size_t)ate < shi->cchHeader) {
             apr_bucket_brigade *bb;
             apr_bucket *b;
             bb = apr_brigade_create(cid->r->pool, c->bucket_alloc);
 	    b = apr_bucket_transient_create(shi->pszHeader + ate, 
@@ -1098,196 +1250,338 @@
                                             c->bucket_alloc);
 	    APR_BRIGADE_INSERT_TAIL(bb, b);
             b = apr_bucket_flush_create(c->bucket_alloc);
 	    APR_BRIGADE_INSERT_TAIL(bb, b);
 	    ap_pass_brigade(cid->r->output_filters, bb);
         }
-        return TRUE;
-
+        return 1;
     }
-#endif
 
-    case 1017: /* HSE_REQ_CLOSE_CONNECTION  Added after ISAPI 4.0 */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction "
+    case HSE_REQ_CLOSE_CONNECTION:  /* Added after ISAPI 4.0 */
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction "
                           "HSE_REQ_CLOSE_CONNECTION "
                           "is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
-    case 1018: /* HSE_REQ_IS_CONNECTED  Added after ISAPI 4.0 */
+    case HSE_REQ_IS_CONNECTED:  /* Added after ISAPI 4.0 */
         /* Returns True if client is connected c.f. MSKB Q188346
          * assuming the identical return mechanism as HSE_REQ_IS_KEEP_CONN
          */
-        *((LPBOOL) lpvBuffer) = (r->connection->aborted == 0);
-        return TRUE;
+        *((int *)buf_data) = (r->connection->aborted == 0);
+        return 1;
 
-    case 1020: /* HSE_REQ_EXTENSION_TRIGGER  Added after ISAPI 4.0 */
+    case HSE_REQ_EXTENSION_TRIGGER:  /* Added after ISAPI 4.0 */
         /*  Undocumented - defined by the Microsoft Jan '00 Platform SDK
          */
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction "
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction "
                           "HSE_REQ_EXTENSION_TRIGGER "
                           "is not supported: %s", r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
 
     default:
-        if (cid->sconf->LogNotSupported)
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
-                          "ISAPI ServerSupportFunction (%d) not supported: "
-                          "%s", dwHSERequest, r->filename);
+        if (cid->dconf.log_unsupported)
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                          "ISAPI: ServerSupportFunction (%d) not supported: "
+                          "%s", HSE_code, r->filename);
         SetLastError(ERROR_INVALID_PARAMETER);
-        return FALSE;
+        return 0;
     }
 }
 
-/*
- * Command handler for the ISAPIReadAheadBuffer directive, which is TAKE1
- */
-static const char *isapi_cmd_readaheadbuffer(cmd_parms *cmd, void *config, 
-                                             char *arg)
-{
-    isapi_server_conf *sconf = ap_get_module_config(cmd->server->module_config,
-                                                   &isapi_module);
-    char *scan;
-    long val;
-
-    if (((val = strtol(arg, (char **) &scan, 10)) <= 0) || *scan)
-        return "ISAPIReadAheadBuffer must be a legitimate value.";
-    
-    sconf->ReadAheadBuffer = val;
-    return NULL;
-}
+/**********************************************************
+ *
+ *  ISAPI Module request invocation section
+ *
+ **********************************************************/
 
-/*
- * Command handler for the ISAPIReadAheadBuffer directive, which is TAKE1
- */
-static const char *isapi_cmd_lognotsupported(cmd_parms *cmd, void *config, 
-                                             char *arg)
+apr_status_t isapi_handler (request_rec *r)
 {
-    isapi_server_conf *sconf = ap_get_module_config(cmd->server->module_config,
-                                               &isapi_module);
+    isapi_dir_conf *dconf;
+    apr_table_t *e;
+    apr_status_t rv;
+    isapi_loaded *isa;
+    isapi_cid *cid;
+    const char *val;
+    apr_uint32_t read;
+    int res;
+    
+    if(strcmp(r->handler, "isapi-isa") 
+        && strcmp(r->handler, "isapi-handler")) {
+        /* Hang on to the isapi-isa for compatibility with older docs
+         * (wtf did '-isa' mean in the first place?) but introduce
+         * a newer and clearer "isapi-handler" name.
+         */
+        return DECLINED;    
+    }
+    dconf = ap_get_module_config(r->per_dir_config, &isapi_module);
+    e = r->subprocess_env;
 
-    if (strcasecmp(arg, "on") == 0) {
-        sconf->LogNotSupported = -1;
+    /* Use similar restrictions as CGIs
+     *
+     * If this fails, it's pointless to load the isapi dll.
+     */
+    if (!(ap_allow_options(r) & OPT_EXECCGI)) {
+        return HTTP_FORBIDDEN;
     }
-    else if (strcasecmp(arg, "off") == 0) {
-        sconf->LogNotSupported = 0;
+    if (r->finfo.filetype == APR_NOFILE) {
+        return HTTP_NOT_FOUND;
     }
-    else {
-        return "ISAPILogNotSupported must be on or off";
+    if (r->finfo.filetype != APR_REG) {
+        return HTTP_FORBIDDEN;
+    }
+    if ((r->used_path_info == AP_REQ_REJECT_PATH_INFO) &&
+        r->path_info && *r->path_info) {
+        /* default to accept */
+        return HTTP_NOT_FOUND;
     }
-    return NULL;
-}
 
-static const char *isapi_cmd_appendlogtoerrors(cmd_parms *cmd, void *config, 
-                                               char *arg)
-{
-    isapi_server_conf *sconf = ap_get_module_config(cmd->server->module_config,
-                                                   &isapi_module);
+    if (isapi_lookup(r->pool, r->server, r, r->filename, &isa) 
+           != APR_SUCCESS) {
+        return HTTP_INTERNAL_SERVER_ERROR;
+    }
+    /* Set up variables */
+    ap_add_common_vars(r);
+    ap_add_cgi_vars(r);
+    apr_table_setn(e, "UNMAPPED_REMOTE_USER", "REMOTE_USER");
+    if ((val = apr_table_get(e, "HTTPS")) && strcmp(val, "on"))
+        apr_table_setn(e, "SERVER_PORT_SECURE", "1");
+    else
+        apr_table_setn(e, "SERVER_PORT_SECURE", "0");
+    apr_table_setn(e, "URL", r->uri);
+
+    /* Set up connection structure and ecb,
+     * NULL or zero out most fields.
+     */
+    cid = apr_pcalloc(r->pool, sizeof(isapi_cid));
+    
+    /* Fixup defaults for dconf */
+    cid->dconf.read_ahead_buflen = (dconf->read_ahead_buflen == ISAPI_UNDEF)
+                                     ? 48192 : dconf->read_ahead_buflen;
+    cid->dconf.log_unsupported   = (dconf->log_unsupported == ISAPI_UNDEF)
+                                     ? 0 : dconf->log_unsupported;
+    cid->dconf.log_to_errlog     = (dconf->log_to_errlog == ISAPI_UNDEF)
+                                     ? 0 : dconf->log_to_errlog;
+    cid->dconf.log_to_query      = (dconf->log_to_query == ISAPI_UNDEF)
+                                     ? 1 : dconf->log_to_query;
+    cid->dconf.fake_async        = (dconf->fake_async == ISAPI_UNDEF)
+                                     ? 0 : dconf->fake_async;
+
+    cid->ecb = apr_pcalloc(r->pool, sizeof(EXTENSION_CONTROL_BLOCK));
+    cid->ecb->ConnID = cid;
+    cid->isa = isa;
+    cid->r = r;
+    cid->r->status = 0;
+    
+    cid->ecb->cbSize = sizeof(EXTENSION_CONTROL_BLOCK);
+    cid->ecb->dwVersion = isa->report_version;
+    cid->ecb->dwHttpStatusCode = 0;
+    strcpy(cid->ecb->lpszLogData, "");
+    /* TODO: are copies really needed here?
+     */
+    cid->ecb->lpszMethod = (char*) r->method;
+    cid->ecb->lpszQueryString = (char*) apr_table_get(e, "QUERY_STRING");
+    cid->ecb->lpszPathInfo = (char*) apr_table_get(e, "PATH_INFO");
+    cid->ecb->lpszPathTranslated = (char*) apr_table_get(e, "PATH_TRANSLATED");
+    cid->ecb->lpszContentType = (char*) apr_table_get(e, "CONTENT_TYPE");
+    
+    /* Based on some examples I've noticed, NULL is expected here. 
+     */
+    if (!*cid->ecb->lpszQueryString) {
+        cid->ecb->lpszQueryString = NULL;
+    }
+
+    /* Set up the callbacks */
+    cid->ecb->GetServerVariable = GetServerVariable;
+    cid->ecb->WriteClient = WriteClient;
+    cid->ecb->ReadClient = ReadClient;
+    cid->ecb->ServerSupportFunction = ServerSupportFunction;
 
-    if (strcasecmp(arg, "on") == 0) {
-        sconf->AppendLogToErrors = -1;
+    /* Set up client input */
+    res = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR);
+    if (res) {
+        isapi_unload(isa, 0);
+        return res;
     }
-    else if (strcasecmp(arg, "off") == 0) {
-        sconf->AppendLogToErrors = 0;
+
+    if (ap_should_client_block(r)) {
+        /* Time to start reading the appropriate amount of data,
+         * and allow the administrator to tweak the number
+         */
+        if (r->remaining) {
+            cid->ecb->cbTotalBytes = (apr_size_t)r->remaining;
+            if (cid->ecb->cbTotalBytes > (apr_uint32_t)cid->dconf.read_ahead_buflen)
+                cid->ecb->cbAvailable = cid->dconf.read_ahead_buflen;
+            else
+                cid->ecb->cbAvailable = cid->ecb->cbTotalBytes;
+        }
+        else
+        {
+            cid->ecb->cbTotalBytes = 0xffffffff;
+            cid->ecb->cbAvailable = cid->dconf.read_ahead_buflen;
+        }
+
+        cid->ecb->lpbData = apr_pcalloc(r->pool, cid->ecb->cbAvailable + 1);
+
+        read = 0;
+        while (read < cid->ecb->cbAvailable &&
+               ((res = ap_get_client_block(r, cid->ecb->lpbData + read,
+                                        cid->ecb->cbAvailable - read)) > 0)) {
+            read += res;
+        }
+
+        if (res < 0) {
+            isapi_unload(isa, 0);
+            return HTTP_INTERNAL_SERVER_ERROR;
+        }
+
+        /* Although it's not to spec, IIS seems to null-terminate
+         * its lpdData string. So we will too.
+         */
+        if (res == 0)
+            cid->ecb->cbAvailable = cid->ecb->cbTotalBytes = read;
+        else
+            cid->ecb->cbAvailable = read;
+        cid->ecb->lpbData[read] = '\0';
     }
     else {
-        return "ISAPIAppendLogToErrors must be on or off";
+        cid->ecb->cbTotalBytes = 0;
+        cid->ecb->cbAvailable = 0;
+        cid->ecb->lpbData = NULL;
     }
-    return NULL;
-}
 
-static const char *isapi_cmd_appendlogtoquery(cmd_parms *cmd, void *config, 
-                                              char *arg)
-{
-    isapi_server_conf *sconf = ap_get_module_config(cmd->server->module_config,
-                                                   &isapi_module);
+    /* All right... try and run the sucker */
+    rv = (*isa->HttpExtensionProc)(cid->ecb);
 
-    if (strcasecmp(arg, "on") == 0) {
-        sconf->AppendLogToQuery = -1;
-    }
-    else if (strcasecmp(arg, "off") == 0) {
-        sconf->AppendLogToQuery = 0;
+    /* Check for a log message - and log it */
+    if (cid->ecb->lpszLogData && *cid->ecb->lpszLogData)
+        ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
+                      "ISAPI: %s: %s", r->filename, cid->ecb->lpszLogData);
+
+    switch(rv) {
+        case 0:  /* Strange, but MS isapi accepts this as success */
+        case HSE_STATUS_SUCCESS:
+        case HSE_STATUS_SUCCESS_AND_KEEP_CONN:
+            /* Ignore the keepalive stuff; Apache handles it just fine without
+             * the ISAPI Handler's "advice".
+             * Per Microsoft: "In IIS versions 4.0 and later, the return
+             * values HSE_STATUS_SUCCESS and HSE_STATUS_SUCCESS_AND_KEEP_CONN
+             * are functionally identical: Keep-Alive connections are
+             * maintained, if supported by the client."
+             * ... so we were pat all this time
+             */
+            break;
+
+        case HSE_STATUS_PENDING:
+            /* emulating async behavior...
+             *
+             * Create a cid->completed mutex and wait on it for some timeout
+             * so that the app thinks is it running async.
+             *
+             * All async ServerSupportFunction calls will be handled through
+             * the registered IO_COMPLETION hook.
+             *
+             * This request completes upon a notification through
+             * ServerSupportFunction(HSE_REQ_DONE_WITH_SESSION)
+             */
+            if (cid->dconf.fake_async) {
+                apr_thread_mutex_t *comp;
+
+                rv = apr_thread_mutex_create(&cid->completed, 
+                                             APR_THREAD_MUTEX_UNNESTED, 
+                                             r->pool);
+                comp = cid->completed;
+                if (cid->completed && (rv == APR_SUCCESS)) {
+                    rv = apr_thread_mutex_lock(comp);
+                }
+                /* The completion port is now locked.  When we regain the
+                 * lock, we may destroy the request.
+                 */
+                if (cid->completed && (rv == APR_SUCCESS)) {
+                    rv = apr_thread_mutex_lock(comp);
+                }
+                break;
+            }
+            else if (cid->dconf.log_unsupported) {
+                 ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
+                               "ISAPI: asynch I/O result HSE_STATUS_PENDING "
+                               "from HttpExtensionProc() is not supported: %s",
+                               r->filename);
+                 cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
+            }
+            break;
+
+        case HSE_STATUS_ERROR:    
+            /* end response if we have yet to do so.
+             */
+            cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
+            break;
+
+        default:
+            /* TODO: log unrecognized retval for debugging 
+             */
+            cid->r->status = HTTP_INTERNAL_SERVER_ERROR;
+            break;
     }
-    else {
-        return "ISAPIAppendLogToQuery must be on or off";
+
+    /* Set the status (for logging) */
+    if (cid->ecb->dwHttpStatusCode) {
+        cid->r->status = cid->ecb->dwHttpStatusCode;
     }
-    return NULL;
+
+    return cid->r->status;
 }
 
-static const char *isapi_cmd_cachefile(cmd_parms *cmd, void *dummy, 
-                                       const char *filename)
+/**********************************************************
+ *
+ *  ISAPI Module Setup Hooks
+ *
+ **********************************************************/
 
+static int isapi_pre_config(apr_pool_t *pconf, apr_pool_t *plog, apr_pool_t *ptemp)
 {
-    isapi_server_conf *sconf = ap_get_module_config(cmd->server->module_config, 
-                                                    &isapi_module);
-    isapi_loaded *isa, **newisa;
-    apr_finfo_t tmp;
     apr_status_t rv;
-    char *fspec;
-    
-    fspec = ap_server_root_relative(cmd->pool, filename);
-    if (!fspec) {
-	ap_log_error(APLOG_MARK, APLOG_WARNING, APR_EBADPATH, cmd->server,
-	             "ISAPI: Invalid module path %s, skipping", filename);
-	return NULL;
-    }
-    if ((rv = apr_stat(&tmp, fspec, APR_FINFO_TYPE, 
-                      cmd->temp_pool)) != APR_SUCCESS) { 
-	ap_log_error(APLOG_MARK, APLOG_WARNING, rv, cmd->server,
-	    "ISAPI: unable to stat(%s), skipping", fspec);
-	return NULL;
+
+    apr_pool_sub_make(&loaded.pool, pconf, NULL);
+    if (!loaded.pool) {
+	ap_log_error(APLOG_MARK, APLOG_ERR, APR_EGENERAL, NULL,
+	             "ISAPI: could not create the isapi cache pool");
+        return APR_EGENERAL;
     }
-    if (tmp.filetype != APR_REG) {
-	ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, cmd->server,
-	    "ISAPI: %s isn't a regular file, skipping", fspec);
-	return NULL;
+    
+    loaded.hash = apr_hash_make(loaded.pool);
+    if (!loaded.hash) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
+                     "ISAPI: Failed to create module cache");
+        return APR_EGENERAL;
     }
 
-    /* Load the extention as cached (passing sconf) */
-    rv = isapi_load(cmd->pool, sconf, NULL, fspec, &isa); 
+    rv = apr_thread_mutex_create(&loaded.lock, APR_THREAD_MUTEX_DEFAULT, 
+                                 loaded.pool);
     if (rv != APR_SUCCESS) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING, rv, cmd->server,
-                     "ISAPI: unable to cache %s, skipping", fspec);
-	return NULL;
+        ap_log_error(APLOG_MARK, rv, 0, NULL,
+                     "ISAPI: Failed to create module cache lock");
+        return rv;
     }
-
-    /* Add to cached list of loaded modules */
-    newisa = apr_array_push(sconf->loaded);
-    *newisa = isa;
-    
-    return NULL;
+    return OK;
 }
 
 static void isapi_hooks(apr_pool_t *cont)
 {
-    ap_hook_post_config(isapi_post_config, NULL, NULL, APR_HOOK_MIDDLE);
+    ap_hook_pre_config(isapi_pre_config, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_handler(isapi_handler, NULL, NULL, APR_HOOK_MIDDLE);
 }
 
-static const command_rec isapi_cmds[] = {
-AP_INIT_TAKE1("ISAPIReadAheadBuffer", isapi_cmd_readaheadbuffer, NULL, RSRC_CONF,
-  "Maximum bytes to initially pass to the ISAPI handler"),
-AP_INIT_TAKE1("ISAPILogNotSupported", isapi_cmd_lognotsupported, NULL, RSRC_CONF,
-  "Log requests not supported by the ISAPI server"),
-AP_INIT_TAKE1("ISAPIAppendLogToErrors", isapi_cmd_appendlogtoerrors, NULL, RSRC_CONF,
-  "Send all Append Log requests to the error log"),
-AP_INIT_TAKE1("ISAPIAppendLogToQuery", isapi_cmd_appendlogtoquery, NULL, RSRC_CONF,
-  "Append Log requests are concatinated to the query args"),
-AP_INIT_ITERATE("ISAPICacheFile", isapi_cmd_cachefile, NULL, RSRC_CONF,
-  "Cache the specified ISAPI extension in-process"),
-{ NULL }
-};
-
 module AP_MODULE_DECLARE_DATA isapi_module = {
    STANDARD20_MODULE_STUFF,
-   NULL,                        /* create per-dir config */
-   NULL,                        /* merge per-dir config */
-   create_isapi_server_config,  /* server config */
+   create_isapi_dir_config,     /* create per-dir config */
+   merge_isapi_dir_configs,     /* merge per-dir config */
+   NULL,                        /* server config */
    NULL,                        /* merge server config */
    isapi_cmds,                  /* command apr_table_t */
    isapi_hooks                  /* register hooks */
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_isapi.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_isapi.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_isapi.dsp	2002-01-10 16:47:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_isapi.dsp	2002-05-14 13:23:54.000000000 +0800
@@ -90,12 +90,16 @@
 # Begin Source File
 
 SOURCE=.\mod_isapi.c
 # End Source File
 # Begin Source File
 
+SOURCE=.\mod_isapi.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\mod_isapi.rc
 # End Source File
 # Begin Source File
 
 SOURCE=..\..\..\build\win32\win32ver.awk
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32: mod_isapi.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_win32.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_win32.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/arch/win32/mod_win32.c	2002-04-14 06:34:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/arch/win32/mod_win32.c	2002-06-15 08:36:05.000000000 +0800
@@ -66,13 +66,13 @@
 #include "http_core.h"
 #include "http_protocol.h"
 #include "http_request.h"
 #include "http_log.h"
 #include "util_script.h"
 #include "mod_core.h"
-#include "apr_optional.h"
+#include "mod_cgi.h"
 #include "apr_lib.h"
 
 #ifdef WIN32
 
 /* 
  * CGI Script stuff for Win32...
@@ -410,24 +410,24 @@
     return args;
 }
 
 
 static apr_status_t ap_cgi_build_command(const char **cmd, const char ***argv,
                                          request_rec *r, apr_pool_t *p, 
-                                         int process_cgi, apr_cmdtype_e *type)
+                                         cgi_exec_info_t *e_info)
 {
     const char *ext = NULL;
     const char *interpreter = NULL;
     win32_dir_conf *d;
     apr_file_t *fh;
     const char *args = "";
 
     d = (win32_dir_conf *)ap_get_module_config(r->per_dir_config, 
                                                &win32_module);
 
-    if (process_cgi) {
+    if (e_info->cmd_type) {
         /* Handle the complete file name, we DON'T want to follow suexec, since
          * an unrooted command is as predictable as shooting craps in Win32.
          *
          * Notice that unlike most mime extension parsing, we have to use the
          * win32 parsing here, therefore the final extension is the only one
          * we will consider
@@ -454,17 +454,17 @@
                      == INTERPRETER_SOURCE_REGISTRY_STRICT)) {
          /* Check the registry */
         int strict = (d->script_interpreter_source 
                       == INTERPRETER_SOURCE_REGISTRY_STRICT);
         interpreter = get_interpreter_from_win32_registry(r->pool, ext,
                                                           strict);
-        if (interpreter && *type != APR_SHELLCMD) {
-            *type = APR_PROGRAM_PATH;
+        if (interpreter && e_info->cmd_type != APR_SHELLCMD) {
+            e_info->cmd_type = APR_PROGRAM_PATH;
         }
         else {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                  strict ? "No ExecCGI verb found for files of type '%s'."
                         : "No ExecCGI or Open verb found for files of type '%s'.", 
                  ext);
         }
     }
     if (!interpreter) {
@@ -496,14 +496,14 @@
             }
             if (i < sizeof(buffer)) {
                 interpreter = buffer + 2;
                 while (isspace(*interpreter)) {
                     ++interpreter;
                 }
-                if (*type != APR_SHELLCMD) {
-                    *type = APR_PROGRAM_PATH;
+                if (e_info->cmd_type != APR_SHELLCMD) {
+                    e_info->cmd_type = APR_PROGRAM_PATH;
                 }
             }
         }
         else {
             /* Not a script, is it an executable? */
             IMAGE_DOS_HEADER *hdr = (IMAGE_DOS_HEADER*)buffer;    
@@ -517,29 +517,27 @@
                     interpreter = "";
                 }
             }
         }
     }
     if (!interpreter) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "%s is not executable; ensure interpreted scripts have "
                       "\"#!\" first line", *cmd);
         return APR_EBADF;
     }
 
     *argv = (const char **)(split_argv(p, interpreter, *cmd,
                                        args)->elts);
     *cmd = (*argv)[0];
+
+    e_info->detached = 1;
+
     return APR_SUCCESS;
 }
 
-APR_DECLARE_OPTIONAL_FN(apr_status_t, ap_cgi_build_command,
-                        (const char **cmd, const char ***argv, 
-                         request_rec *r, apr_pool_t *p, 
-                         int replace_cmd, apr_cmdtype_e *type));
-
 static void register_hooks(apr_pool_t *p)
 {
     APR_REGISTER_OPTIONAL_FN(ap_cgi_build_command);
 }
 
 static const command_rec win32_cmds[] = {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/cache: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/cache: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/cache/mod_file_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/cache/mod_file_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/cache/mod_file_cache.c	2002-04-20 03:16:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/cache/mod_file_cache.c	2002-06-09 11:44:03.000000000 +0800
@@ -206,30 +206,30 @@
                                  cmd->temp_pool)) != APR_SUCCESS) {
 	ap_log_error(APLOG_MARK, APLOG_WARNING, rc, cmd->server,
 	    "mod_file_cache: unable to stat(%s), skipping", fspec);
 	return;
     }
     if (tmp.finfo.filetype != APR_REG) {
-	ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, cmd->server,
+	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
 	    "mod_file_cache: %s isn't a regular file, skipping", fspec);
 	return;
     }
     if (tmp.finfo.size > AP_MAX_SENDFILE) {
-	ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, cmd->server,
+	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
 	    "mod_file_cache: %s is too large to cache, skipping", fspec);
 	return;
     }
 
     rc = apr_file_open(&fd, fspec, APR_READ | APR_BINARY | APR_XTHREAD,
                        APR_OS_DEFAULT, cmd->pool);
     if (rc != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_WARNING, rc, cmd->server,
                      "mod_file_cache: unable to open(%s, O_RDONLY), skipping", fspec);
 	return;
     }
-    apr_file_set_inherit(fd);
+    apr_file_inherit_set(fd);
 
     /* WooHoo, we have a file to put in the cache */
     new_file = apr_pcalloc(cmd->pool, sizeof(a_file));
     new_file->finfo = tmp.finfo;
 
 #if APR_HAS_MMAP
@@ -285,24 +285,24 @@
 static const char *cachefilehandle(cmd_parms *cmd, void *dummy, const char *filename)
 {
 #if APR_HAS_SENDFILE
     cache_the_file(cmd, filename, 0);
 #else
     /* Sendfile not supported by this OS */
-    ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, cmd->server,
+    ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
                  "mod_file_cache: unable to cache file: %s. Sendfile is not supported on this OS", filename);
 #endif
     return NULL;
 }
 static const char *cachefilemmap(cmd_parms *cmd, void *dummy, const char *filename) 
 {
 #if APR_HAS_MMAP
     cache_the_file(cmd, filename, 1);
 #else
     /* MMAP not supported by this OS */
-    ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, cmd->server,
+    ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
                  "mod_file_cache: unable to cache file: %s. MMAP is not supported by this OS", filename);
 #endif
     return NULL;
 }
 
 static int file_cache_post_config(apr_pool_t *p, apr_pool_t *plog,
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/cache: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/fs: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/fs: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/fs: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/mod_dav.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/mod_dav.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/mod_dav.c	2002-04-06 09:11:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/mod_dav.c	2002-06-08 06:31:34.000000000 +0800
@@ -211,19 +211,19 @@
        (long)newconf, (long)base, (long)overrides); */
 
     newconf->provider_name = DAV_INHERIT_VALUE(parent, child, provider_name);
     newconf->provider = DAV_INHERIT_VALUE(parent, child, provider);
     if (parent->provider_name != NULL) {
         if (child->provider_name == NULL) {
-            ap_log_error(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                          "\"DAV Off\" cannot be used to turn off a subtree "
                          "of a DAV-enabled location.");
         }
         else if (strcasecmp(child->provider_name,
                             parent->provider_name) != 0) {
-            ap_log_error(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                          "A subtree cannot specify a different DAV provider "
                          "than its parent.");
         }
     }
 
     newconf->locktimeout = DAV_INHERIT_VALUE(parent, child, locktimeout);
@@ -351,15 +351,12 @@
 
     /* ### I really don't think this is needed; gotta test */
     r->status_line = ap_get_status_line(status);
 
     ap_set_content_type(r, "text/html");
 
-    /* since we're returning DONE, ensure the request body is consumed. */
-    (void) ap_discard_request_body(r);
-
     /* begin the response now... */
     ap_rvputs(r,
               DAV_RESPONSE_BODY_1,
               r->status_line,
               DAV_RESPONSE_BODY_2,
               &r->status_line[4],
@@ -388,15 +385,12 @@
 
     /* ### I really don't think this is needed; gotta test */
     r->status_line = ap_get_status_line(err->status);
 
     ap_set_content_type(r, DAV_XML_CONTENT_TYPE);
 
-    /* since we're returning DONE, ensure the request body is consumed. */
-    (void) ap_discard_request_body(r);
-
     ap_rputs(DAV_XML_HEADER DEBUG_CR
              "<D:error xmlns:D=\"DAV:\"", r);
 
     if (err->desc != NULL) {
         /* ### should move this namespace somewhere (with the others!) */
         ap_rputs(" xmlns:m=\"http://apache.org/dav/xmlns\"", r);
@@ -548,13 +542,13 @@
         if (errscan->save_errno != 0) {
             errno = errscan->save_errno;
             ap_log_rerror(APLOG_MARK, level, errno, r, "%s  [%d, #%d]",
                           errscan->desc, errscan->status, errscan->error_id);
         }
         else {
-            ap_log_rerror(APLOG_MARK, level | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, level, 0, r,
                           "%s  [%d, #%d]",
                           errscan->desc, errscan->status, errscan->error_id);
         }
     }
 }
 
@@ -592,15 +586,12 @@
         if (stackerr != NULL && stackerr->tagname != NULL)
             return dav_error_response_tag(r, stackerr);
 
         return err->status;
     }
 
-    /* since we're returning DONE, ensure the request body is consumed. */
-    (void) ap_discard_request_body(r);
-
     /* send the multistatus and tell Apache the request/response is DONE. */
     dav_send_multistatus(r, err->status, response, NULL);
     return DONE;
 }
 
 /* handy function for return values of methods that (may) create things */
@@ -652,13 +643,13 @@
     else if (strcmp(depth, "1") == 0) {
         return 1;
     }
 
     /* The caller will return an HTTP_BAD_REQUEST. This will augment the
      * default message that Apache provides. */
-    ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "An invalid Depth header was specified.");
     return -1;
 }
 
 static int dav_get_overwrite(request_rec *r)
 {
@@ -675,13 +666,13 @@
     if ((*overwrite == 'T' || *overwrite == 't') && overwrite[1] == '\0') {
         return 1;
     }
 
     /* The caller will return an HTTP_BAD_REQUEST. This will augment the
      * default message that Apache provides. */
-    ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "An invalid Overwrite header was specified.");
     return -1;
 }
 
 /* resolve a request URI to a resource descriptor.
  *
@@ -1103,20 +1094,20 @@
      * For non-collections, depth is ignored, unless it is an illegal value (1).
      */
     depth = dav_get_depth(r, DAV_INFINITY);
 
     if (resource->collection && depth != DAV_INFINITY) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth must be \"infinity\" for DELETE of a collection.");
         return HTTP_BAD_REQUEST;
     }
 
     if (!resource->collection && depth == 1) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth of \"1\" is not allowed for DELETE.");
         return HTTP_BAD_REQUEST;
     }
 
     /*
     ** If any resources fail the lock/If: conditions, then we must fail
@@ -1525,13 +1516,13 @@
     if ((result = ap_xml_parse_input(r, &doc)) != OK) {
         return result;
     }
     /* note: doc == NULL if no request body */
 
     if (doc && !dav_validate_root(doc, "options")) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The \"options\" element was not found.");
         return HTTP_BAD_REQUEST;
     }
 
     /* determine which providers are available */
     dav_level = "1";
@@ -1919,13 +1910,13 @@
         return result;
     }
     /* note: doc == NULL if no request body */
 
     if (doc && !dav_validate_root(doc, "propfind")) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The \"propfind\" element was not found.");
         return HTTP_BAD_REQUEST;
     }
 
     /* ### validate that only one of these three elements is present */
 
@@ -1941,13 +1932,13 @@
         ctx.propfind_type = DAV_PROPFIND_IS_PROP;
     }
     else {
         /* "propfind" element must have one of the above three children */
 
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The \"propfind\" element does not contain one of "
                       "the required child elements (the specific command).");
         return HTTP_BAD_REQUEST;
     }
 
     ctx.w.walk_type = DAV_WALKTYPE_NORMAL | DAV_WALKTYPE_AUTH;
@@ -2162,13 +2153,13 @@
         return result;
     }
     /* note: doc == NULL if no request body */
 
     if (doc == NULL || !dav_validate_root(doc, "propertyupdate")) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body does not contain "
                       "a \"propertyupdate\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* Check If-Headers and existing locks */
@@ -2225,13 +2216,13 @@
             dav_close_propdb(propdb);
 
             /* undo any auto-checkout */
             dav_auto_checkin(r, resource, 1 /*undo*/, 0 /*unlock*/, &av_info);
 
             /* This supplies additional information for the default message. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "A \"prop\" element is missing inside "
                           "the propertyupdate command.");
             return HTTP_BAD_REQUEST;
         }
 
         for (one_prop = prop_group->first_child; one_prop;
@@ -2304,13 +2295,13 @@
     r->read_chunked = 0;
     r->remaining = 0;
 
     if (tenc) {
         if (strcasecmp(tenc, "chunked")) {
             /* Use this instead of Apache's default error string */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Unknown Transfer-Encoding %s", tenc);
             return HTTP_NOT_IMPLEMENTED;
         }
 
         r->read_chunked = 1;
     }
@@ -2320,13 +2311,13 @@
         while (apr_isdigit(*pos) || apr_isspace(*pos)) {
             ++pos;
         }
 
         if (*pos != '\0') {
             /* This supplies additional information for the default message. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Invalid Content-Length %s", lenp);
             return HTTP_BAD_REQUEST;
         }
 
         r->remaining = atol(lenp);
     }
@@ -2516,22 +2507,22 @@
 
         if (nscp_host != NULL && nscp_path != NULL)
             dest = apr_psprintf(r->pool, "http://%s%s", nscp_host, nscp_path);
     }
     if (dest == NULL) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request is missing a Destination header.");
         return HTTP_BAD_REQUEST;
     }
 
     lookup = dav_lookup_uri(dest, r, 1 /* must_be_absolute */);
     if (lookup.rnew == NULL) {
         if (lookup.err.status == HTTP_BAD_REQUEST) {
             /* This supplies additional information for the default message. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           lookup.err.desc);
             return HTTP_BAD_REQUEST;
         }
 
         /* ### this assumes that dav_lookup_uri() only generates a status
          * ### that Apache can provide a status line for!! */
@@ -2590,19 +2581,19 @@
         /* dav_get_depth() supplies additional information for the
          * default message. */
         return HTTP_BAD_REQUEST;
     }
     if (depth == 1) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth must be \"0\" or \"infinity\" for COPY or MOVE.");
         return HTTP_BAD_REQUEST;
     }
     if (is_move && is_dir && depth != DAV_INFINITY) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth must be \"infinity\" when moving a collection.");
         return HTTP_BAD_REQUEST;
     }
 
     /*
      * Check If-Headers and existing locks for each resource in the source
@@ -2884,13 +2875,13 @@
 
     if ((result = ap_xml_parse_input(r, &doc)) != OK)
         return result;
 
     depth = dav_get_depth(r, DAV_INFINITY);
     if (depth != 0 && depth != DAV_INFINITY) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth must be 0 or \"infinity\" for LOCK.");
         return HTTP_BAD_REQUEST;
     }
 
     /* Ask repository module to resolve the resource */
     err = dav_get_resource(r, 0 /* label_allowed */, 0 /* use_checked_in */,
@@ -3043,13 +3034,13 @@
     locks_hooks = DAV_GET_HOOKS_LOCKS(r);
     if (locks_hooks == NULL)
         return DECLINED;
 
     if ((const_locktoken_txt = apr_table_get(r->headers_in,
                                              "Lock-Token")) == NULL) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Unlock failed (%s):  "
                       "No Lock-Token specified in header", r->filename);
         return HTTP_BAD_REQUEST;
     }
 
     locktoken_txt = apr_pstrdup(r->pool, const_locktoken_txt);
@@ -3153,38 +3144,38 @@
 
     if (doc != NULL) {
         const ap_xml_elem *child;
         apr_size_t tsize;
 
         if (!dav_validate_root(doc, "version-control")) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The request body does not contain "
                           "a \"version-control\" element.");
             return HTTP_BAD_REQUEST;
         }
 
         /* get the version URI */
         if ((child = dav_find_child(doc->root, "version")) == NULL) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The \"version-control\" element does not contain "
                           "a \"version\" element.");
             return HTTP_BAD_REQUEST;
         }
 
         if ((child = dav_find_child(child, "href")) == NULL) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The \"version\" element does not contain "
                           "an \"href\" element.");
             return HTTP_BAD_REQUEST;
         }
 
         /* get version URI */
         ap_xml_to_text(r->pool, child, AP_XML_X2T_INNER, NULL, NULL,
                        &target, &tsize);
         if (tsize == 0) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "An \"href\" element does not contain a URI.");
             return HTTP_BAD_REQUEST;
         }
     }
 
     /* Check request preconditions */
@@ -3330,13 +3321,13 @@
 
     if (doc != NULL) {
         const ap_xml_elem *aset;
 
         if (!dav_validate_root(doc, "checkout")) {
             /* This supplies additional information for the default msg. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The request body, if present, must be a "
                           "DAV:checkout element.");
             return HTTP_BAD_REQUEST;
         }
 
         if (dav_find_child(doc->root, "apply-to-version") != NULL) {
@@ -3377,13 +3368,13 @@
                 if (activities->nelts == 0) {
                     /* no href's is a DTD violation:
                        <!ELEMENT activity-set (href+ | new)>
                     */
 
                     /* This supplies additional info for the default msg. */
-                    ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "Within the DAV:activity-set element, the "
                                   "DAV:new element must be used, or at least "
                                   "one DAV:href must be specified.");
                     return HTTP_BAD_REQUEST;
                 }
             }
@@ -3530,13 +3521,13 @@
     if ((result = ap_xml_parse_input(r, &doc)) != OK)
         return result;
 
     if (doc != NULL) {
         if (!dav_validate_root(doc, "checkin")) {
             /* This supplies additional information for the default msg. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The request body, if present, must be a "
                           "DAV:checkin element.");
             return HTTP_BAD_REQUEST;
         }
 
         keep_checked_out = dav_find_child(doc->root, "keep-checked-out") != NULL;
@@ -3618,49 +3609,49 @@
     if ((result = ap_xml_parse_input(r, &doc)) != OK) {
         return result;
     }
 
     if (doc == NULL || !dav_validate_root(doc, "update")) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body does not contain "
                       "an \"update\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* check for label-name or version element, but not both */
     if ((child = dav_find_child(doc->root, "label-name")) != NULL)
         is_label = 1;
     else if ((child = dav_find_child(doc->root, "version")) != NULL) {
         /* get the href element */
         if ((child = dav_find_child(child, "href")) == NULL) {
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "The version element does not contain "
                           "an \"href\" element.");
             return HTTP_BAD_REQUEST;
         }
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The \"update\" element does not contain "
                       "a \"label-name\" or \"version\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* a depth greater than zero is only allowed for a label */
     if (!is_label && depth != 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Depth must be zero for UPDATE with a version");
         return HTTP_BAD_REQUEST;
     }
 
     /* get the target value (a label or a version URI) */
     ap_xml_to_text(r->pool, child, AP_XML_X2T_INNER, NULL, NULL,
                    &target, &tsize);
     if (tsize == 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "A \"label-name\" or \"href\" element does not contain "
                       "any content.");
         return HTTP_BAD_REQUEST;
     }
 
     /* Ask repository module to resolve the resource */
@@ -3687,13 +3678,13 @@
     /* ### dav_lookup_uri only allows absolute URIs; is that OK? */
     if (!is_label) {
         lookup = dav_lookup_uri(target, r, 0 /* must_be_absolute */);
         if (lookup.rnew == NULL) {
             if (lookup.err.status == HTTP_BAD_REQUEST) {
                 /* This supplies additional information for the default message. */
-                ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               lookup.err.desc);
                 return HTTP_BAD_REQUEST;
             }
 
             /* ### this assumes that dav_lookup_uri() only generates a status
              * ### that Apache can provide a status line for!! */
@@ -3834,13 +3825,13 @@
     if ((result = ap_xml_parse_input(r, &doc)) != OK) {
         return result;
     }
 
     if (doc == NULL || !dav_validate_root(doc, "label")) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body does not contain "
                       "a \"label\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* check for add, set, or remove element */
@@ -3851,30 +3842,30 @@
         ctx.label_op = DAV_LABEL_SET;
     }
     else if ((child = dav_find_child(doc->root, "remove")) != NULL) {
         ctx.label_op = DAV_LABEL_REMOVE;
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The \"label\" element does not contain "
                       "an \"add\", \"set\", or \"remove\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* get the label string */
     if ((child = dav_find_child(child, "label-name")) == NULL) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The label command element does not contain "
                       "a \"label-name\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     ap_xml_to_text(r->pool, child, AP_XML_X2T_INNER, NULL, NULL,
                    &ctx.label, &tsize);
     if (tsize == 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "A \"label-name\" element does not contain "
                       "a label name.");
         return HTTP_BAD_REQUEST;
     }
 
     /* do the label operation walk */
@@ -3935,13 +3926,13 @@
         return DECLINED;
 
     if ((result = ap_xml_parse_input(r, &doc)) != OK)
         return result;
     if (doc == NULL) {
         /* This supplies additional information for the default msg. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body must specify a report.");
         return HTTP_BAD_REQUEST;
     }
 
     /* Ask repository module to resolve the resource.
      * First determine whether a Target-Selector header is allowed
@@ -3997,13 +3988,13 @@
     if ((result = ap_xml_parse_input(r, &doc)) != OK) {
         return result;
     }
 
     if (doc == NULL
         || !dav_validate_root(doc, "mkworkspace")) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body does not contain "
                       "a \"mkworkspace\" element.");
         return HTTP_BAD_REQUEST;
     }
 
     /* Check request preconditions */
@@ -4122,41 +4113,41 @@
 
     if ((result = ap_xml_parse_input(r, &doc)) != OK)
         return result;
 
     if (doc == NULL || !dav_validate_root(doc, "merge")) {
         /* This supplies additional information for the default msg. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request body must be present and must be a "
                       "DAV:merge element.");
         return HTTP_BAD_REQUEST;
     }
 
     if ((source_elem = dav_find_child(doc->root, "source")) == NULL) {
         /* This supplies additional information for the default msg. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The DAV:merge element must contain a DAV:source "
                       "element.");
         return HTTP_BAD_REQUEST;
     }
     if ((href_elem = dav_find_child(source_elem, "href")) == NULL) {
         /* This supplies additional information for the default msg. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The DAV:source element must contain a DAV:href "
                       "element.");
         return HTTP_BAD_REQUEST;
     }
     source = dav_xml_get_cdata(href_elem, r->pool, 1 /* strip_white */);
 
     /* get a subrequest for the source, so that we can get a dav_resource
        for that source. */
     lookup = dav_lookup_uri(source, r, 0 /* must_be_absolute */);
     if (lookup.rnew == NULL) {
         if (lookup.err.status == HTTP_BAD_REQUEST) {
             /* This supplies additional information for the default message. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           lookup.err.desc);
             return HTTP_BAD_REQUEST;
         }
 
         /* ### this assumes that dav_lookup_uri() only generates a status
          * ### that Apache can provide a status line for!! */
@@ -4263,22 +4254,22 @@
     }
 
     /* get the destination URI */
     dest = apr_table_get(r->headers_in, "Destination");
     if (dest == NULL) {
         /* This supplies additional information for the default message. */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "The request is missing a Destination header.");
         return HTTP_BAD_REQUEST;
     }
 
     lookup = dav_lookup_uri(dest, r, 0 /* must_be_absolute */);
     if (lookup.rnew == NULL) {
         if (lookup.err.status == HTTP_BAD_REQUEST) {
             /* This supplies additional information for the default message. */
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           lookup.err.desc);
             return HTTP_BAD_REQUEST;
         }
         else if (lookup.err.status == HTTP_BAD_GATEWAY) {
             /* ### Bindings protocol draft 02 says to return 507
              * ### (Cross Server Binding Forbidden); Apache already defines 507
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/mod_dav.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/mod_dav.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/mod_dav.h	2002-04-08 20:46:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/mod_dav.h	2002-05-17 19:24:16.000000000 +0800
@@ -94,19 +94,19 @@
 
 
 #if 1
 #define DAV_DEBUG 1
 #define DEBUG_CR	"\n"
 #define DBG0(f)		ap_log_error(APLOG_MARK, \
-				APLOG_ERR|APLOG_NOERRNO, 0, NULL, (f))
+				APLOG_ERR, 0, NULL, (f))
 #define DBG1(f,a1)	ap_log_error(APLOG_MARK, \
-				APLOG_ERR|APLOG_NOERRNO, 0, NULL, f, a1)
+				APLOG_ERR, 0, NULL, f, a1)
 #define DBG2(f,a1,a2)	ap_log_error(APLOG_MARK, \
-				APLOG_ERR|APLOG_NOERRNO, 0, NULL, f, a1, a2)
+				APLOG_ERR, 0, NULL, f, a1, a2)
 #define DBG3(f,a1,a2,a3) ap_log_error(APLOG_MARK, \
-			       APLOG_ERR|APLOG_NOERRNO, 0, NULL, f, a1, a2, a3)
+			       APLOG_ERR, 0, NULL, f, a1, a2, a3)
 #else
 #undef DAV_DEBUG
 #define DEBUG_CR	""
 #endif
 
 #define DAV_INFINITY	INT_MAX	/* for the Depth: header */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/util_lock.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/util_lock.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/dav/main/util_lock.c	2002-03-14 04:47:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/dav/main/util_lock.c	2002-05-17 19:33:08.000000000 +0800
@@ -753,13 +753,13 @@
 	    (*hooks->close_lockdb)(lockdb);
         }
 
         if (err != NULL) {
 	    /* ### don't log an error. return err. add higher-level desc. */
 
-	    ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		          "Failed to query lock-null status for %s",
 			  r->filename);
 
 	    return DAV_RESOURCE_ERROR;
         }
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/echo: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/echo: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/echo: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_cache.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_cache.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_hash.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_hash.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_pqueue.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: cache_pqueue.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/cache_storage.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/cache_storage.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/cache_storage.c	2002-03-21 01:41:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/cache_storage.c	2002-06-05 11:45:13.000000000 +0800
@@ -183,24 +183,71 @@
     cache->handle = apr_palloc(r->pool, sizeof(cache_handle_t));
 
     while (next) {
         type = ap_cache_tokstr(r->pool, next, &next);
         switch ((rv = cache_run_open_entity(cache->handle, r, type, key))) {
         case OK: {
+            char *vary = NULL;
             info = &(cache->handle->cache_obj->info);
-            /* XXX:
-             * Handle being returned a collection of entities.
+            if (cache_read_entity_headers(cache->handle, r) != APR_SUCCESS) {
+                /* TODO: Handle this error */
+                return DECLINED;
+            }
+
+            /*
+             * Check Content-Negotiation - Vary
+             * 
+             * At this point we need to make sure that the object we found in the cache
+             * is the same object that would be delivered to the client, when the
+             * effects of content negotiation are taken into effect.
+             * 
+             * In plain english, we want to make sure that a language-negotiated
+             * document in one language is not given to a client asking for a
+             * language negotiated document in a different language by mistake.
+             * 
+             * This code makes the assumption that the storage manager will
+             * cache the info->req_hdrs if the response contains a Vary
+             * header.
+             * 
+             * RFC2616 13.6 and 14.44 describe the Vary mechanism.
              */
-
-            /* Has the cache entry expired? */
-            if (r->request_time > info->expire)
-                cache->fresh = 0;
-            else
-                cache->fresh = 1;
-
-            /*** do content negotiation here */
+            vary = ap_pstrdup(r->pool, ap_table_get(r->headers_out, "Vary"));
+            while (vary && *vary) {
+                char *name = vary;
+                const char *h1, *h2;
+
+                /* isolate header name */
+                while (*vary && !ap_isspace(*vary) && (*vary != ','))
+                    ++vary;
+                while (*vary && (ap_isspace(*vary) || (*vary == ','))) {
+                    *vary = '\0';
+                    ++vary;
+                }
+
+                /*
+                 * is this header in the request and the header in the cached
+                 * request identical? If not, we give up and do a straight get
+                 */
+                h1 = ap_table_get(r->headers_in, name);
+                h2 = ap_table_get(info->req_hdrs, name);
+                if (h1 == h2) {
+                    /* both headers NULL, so a match - do nothing */
+                }
+                else if (h1 && h2 && !strcmp(h1, h2)) {
+                    /* both headers exist and are equal - do nothing */
+                }
+                else {
+                    /* headers do not match, so Vary failed */
+                    ap_log_error(APLOG_MARK, APLOG_INFO, APR_SUCCESS, r->server,
+                                 "cache_select_url(): Vary header mismatch - Cached document cannot be used. \n");
+                    apr_table_clear(r->headers_out);
+                    r->status_line = NULL;
+                    cache->handle = NULL;
+                    return DECLINED;
+                }
+            }
             return OK;
         }
         case DECLINED: {
             /* try again with next cache type */
             continue;
         }
@@ -234,13 +281,12 @@
     /* Build the header table from info in the info struct */
     rv = h->read_headers(h, r);
     if (rv != APR_SUCCESS) {
         return rv;
     }
 
-    ap_set_content_type(r, apr_pstrdup(r->pool, info->content_type));
     r->filename = apr_pstrdup(r->pool, info->filename );
 
     return APR_SUCCESS;
 }
 apr_status_t cache_read_entity_body(cache_handle_t *h, apr_pool_t *p, apr_bucket_brigade *b) 
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/cache_util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/cache_util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/cache_util.c	2002-04-04 01:34:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/cache_util.c	2002-06-05 11:45:13.000000000 +0800
@@ -130,13 +130,150 @@
         }
     }
 
     return type;
 }
 
-/*
+
+/* do a HTTP/1.1 age calculation */
+CACHE_DECLARE(apr_time_t) ap_cache_current_age(cache_info *info, const apr_time_t age_value)
+{
+    apr_time_t apparent_age, corrected_received_age, response_delay, corrected_initial_age,
+           resident_time, current_age;
+
+    /* Perform an HTTP/1.1 age calculation. (RFC2616 13.2.3) */
+
+    apparent_age = MAX(0, info->response_time - info->date);
+    corrected_received_age = MAX(apparent_age, age_value);
+    response_delay = info->response_time - info->request_time;
+    corrected_initial_age = corrected_received_age + response_delay;
+    resident_time = apr_time_now() - info->response_time;
+    current_age = corrected_initial_age + resident_time;
+
+    return (current_age);
+}
+
+CACHE_DECLARE(int) ap_cache_check_freshness(cache_request_rec *cache, 
+                                            request_rec *r)
+{
+    apr_time_t age, maxage_req, maxage_cresp, maxage, smaxage, maxstale, minfresh;
+    const char *cc_cresp, *cc_req, *pragma_cresp;
+    const char *agestr = NULL;
+    char *val;
+    apr_time_t age_c = 0;
+    cache_info *info = &(cache->handle->cache_obj->info);
+
+    /*
+     * We now want to check if our cached data is still fresh. This depends
+     * on a few things, in this order:
+     *
+     * - RFC2616 14.9.4 End to end reload, Cache-Control: no-cache no-cache in
+     * either the request or the cached response means that we must
+     * revalidate the request unconditionally, overriding any expiration
+     * mechanism. It's equivalent to max-age=0,must-revalidate.
+     * 
+     * - RFC2616 14.32 Pragma: no-cache This is treated the same as
+     * Cache-Control: no-cache.
+     * 
+     * - RFC2616 14.9.3 Cache-Control: max-stale, must-revalidate,
+     * proxy-revalidate if the max-stale request header exists, modify the
+     * stale calculations below so that an object can be at most <max-stale>
+     * seconds stale before we request a revalidation, _UNLESS_ a
+     * must-revalidate or proxy-revalidate cached response header exists to
+     * stop us doing this.
+     * 
+     * - RFC2616 14.9.3 Cache-Control: s-maxage the origin server specifies the
+     * maximum age an object can be before it is considered stale. This
+     * directive has the effect of proxy|must revalidate, which in turn means
+     * simple ignore any max-stale setting.
+     * 
+     * - RFC2616 14.9.4 Cache-Control: max-age this header can appear in both
+     * requests and responses. If both are specified, the smaller of the two
+     * takes priority.
+     * 
+     * - RFC2616 14.21 Expires: if this request header exists in the cached
+     * entity, and it's value is in the past, it has expired.
+     * 
+     */
+    cc_cresp = ap_table_get(r->headers_out, "Cache-Control");
+    cc_req = ap_table_get(r->headers_in, "Cache-Control");
+    pragma_cresp = ap_table_get(r->headers_out, "Pragma");  /* TODO: pragma_cresp not being used? */
+    if ((agestr = ap_table_get(r->headers_out, "Age"))) {
+        age_c = atoi(agestr);
+    }
+
+    /* calculate age of object */
+    age = ap_cache_current_age(info, age_c);
+
+    /* extract s-maxage */
+    if (cc_cresp && ap_cache_liststr(cc_cresp, "s-maxage", &val))
+        smaxage = atoi(val);
+    else
+        smaxage = -1;
+
+    /* extract max-age from request */
+    if (cc_req && ap_cache_liststr(cc_req, "max-age", &val))
+        maxage_req = atoi(val);
+    else
+        maxage_req = -1;
+
+    /* extract max-age from response */
+    if (cc_cresp && ap_cache_liststr(cc_cresp, "max-age", &val))
+        maxage_cresp = atoi(val);
+    else
+        maxage_cresp = -1;
+
+    /*
+     * if both maxage request and response, the smaller one takes priority
+     */
+    if (-1 == maxage_req)
+        maxage = maxage_cresp;
+    else if (-1 == maxage_cresp)
+        maxage = maxage_req;
+    else
+        maxage = MIN(maxage_req, maxage_cresp);
+
+    /* extract max-stale */
+    if (cc_req && ap_cache_liststr(cc_req, "max-stale", &val))
+        maxstale = atoi(val);
+    else
+        maxstale = 0;
+
+    /* extract min-fresh */
+    if (cc_req && ap_cache_liststr(cc_req, "min-fresh", &val))
+        minfresh = atoi(val);
+    else
+        minfresh = 0;
+
+    /* override maxstale if must-revalidate or proxy-revalidate */
+    if (maxstale && ((cc_cresp &&
+                      ap_cache_liststr(cc_cresp, "must-revalidate", NULL))
+                     || (cc_cresp && ap_cache_liststr(cc_cresp,
+                                                      "proxy-revalidate", NULL))))
+        maxstale = 0;
+    /* handle expiration */
+    if ((-1 < smaxage && age < (smaxage - minfresh)) ||
+        (-1 < maxage && age < (maxage + maxstale - minfresh)) ||
+        (info->expire != APR_DATE_BAD && age < (info->expire - info->date + maxstale - minfresh))) {
+        /* it's fresh darlings... */
+        /* set age header on response */
+        ap_table_set(r->headers_out, "Age",
+                     ap_psprintf(r->pool, "%lu", (unsigned long)age));
+
+        /* add warning if maxstale overrode freshness calculation */
+        if (!((-1 < smaxage && age < smaxage) ||
+              (-1 < maxage && age < maxage) ||
+              (info->expire != APR_DATE_BAD && (info->expire - info->date) > age))) {
+            /* make sure we don't stomp on a previous warning */
+            ap_table_merge(r->headers_out, "Warning", "110 Response is stale");
+        }
+        return 1;    /* Cache object is fresh */
+    }
+    return 0;        /* Cache object is stale */
+}
+/* 
  * list is a comma-separated list of case-insensitive tokens, with
  * optional whitespace around the tokens.
  * The return returns 1 if the token val is found in the list, or 0
  * otherwise.
  */
 CACHE_DECLARE(int) ap_cache_liststr(const char *list, const char *key, char **val)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/config.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/config.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/config.m4	2002-01-06 08:44:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/config.m4	2002-06-07 03:07:09.000000000 +0800
@@ -12,68 +12,22 @@
 dnl #  list of object files for mod_cache
 cache_objs="dnl
 mod_cache.lo dnl
 cache_storage.lo dnl
 cache_util.lo dnl
 " 
+dnl #  list of object files for mod_mem_cache
+mem_cache_objs="dnl
+mod_mem_cache.lo dnl
+cache_cache.lo dnl
+cache_pqueue.lo dnl
+cache_hash.lo dnl
+" 
 APACHE_MODULE(cache, dynamic file caching, $cache_objs, , no)
 APACHE_MODULE(disk_cache, disk caching module, , , no)
-APACHE_MODULE(mem_cache, memory caching module, , , no)
+APACHE_MODULE(mem_cache, memory caching module, $mem_cache_objs, , no)
 APACHE_MODULE(example, example and demo module, , , no)
 APACHE_MODULE(ext_filter, external filter module, , , no)
 APACHE_MODULE(case_filter, example uppercase conversion filter, , , no)
 APACHE_MODULE(case_filter_in, example uppercase conversion input filter, , , no)
 
-APACHE_MODULE(deflate, Deflate transfer encoding support, , , no, [
-  AC_ARG_WITH(z, APACHE_HELP_STRING(--with-z=DIR,use a specific zlib library),
-  [
-    if test "x$withval" != "xyes" && test "x$withval" != "x"; then
-      ap_zlib_base="$withval"
-    fi
-  ])
-  if test "x$ap_zlib_base" = "x"; then
-    AC_MSG_CHECKING([for zlib location])
-    AC_CACHE_VAL(ap_cv_zlib,[
-      for dir in /usr/local /usr ; do
-        if test -d $dir && test -f $dir/include/zlib.h; then
-          ap_cv_zlib=$dir
-          break
-        fi
-      done
-    ])
-    ap_zlib_base=$ap_cv_zlib
-    if test "x$ap_zlib_base" = "x"; then
-      enable_deflate=no
-      AC_MSG_RESULT([not found])
-    else
-      AC_MSG_RESULT([$ap_zlib_base])
-    fi
-  fi
-  if test "$enable_deflate" != "no"; then
-    ap_save_includes=$INCLUDE
-    ap_save_ldflags=$LDFLAGS
-    ap_save_libs=$LIBS
-    ap_save_cppflags=$CPPFLAGS
-    if test "$ap_zlib_base" != "/usr"; then
-      APR_ADDTO(INCLUDES, [-I${ap_zlib_base}/include])
-      dnl put in CPPFLAGS temporarily so that AC_TRY_LINK below will work
-      CPPFLAGS="$CPPFLAGS -I${ap_zlib_base}/include"
-      APR_ADDTO(LDFLAGS, [-L${ap_zlib_base}/lib])
-      if test "x$ap_platform_runtime_link_flag" != "x"; then
-         APR_ADDTO(LDFLAGS, [$ap_platform_runtime_link_flag${ap_zlib_base}/lib])
-      fi
-    fi
-    APR_ADDTO(LIBS, [-lz])
-    AC_MSG_CHECKING([for zlib library])
-    AC_TRY_LINK([#include <zlib.h>], [return Z_OK;], 
-    [AC_MSG_RESULT(found) 
-     AC_CHECK_HEADERS(zutil.h)],
-    [AC_MSG_RESULT(not found)
-     enable_deflate=no
-     INCLUDES=$ap_save_includes
-     LDFLAGS=$ap_save_ldflags
-     LIBS=$ap_save_libs])
-    CPPFLAGS=$ap_save_cppflags
-  fi
-])
-
 APACHE_MODPATH_FINISH
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.c	2002-04-02 01:13:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.c	2002-06-06 05:49:16.000000000 +0800
@@ -103,18 +103,18 @@
     /*
      * Which cache module (if any) should handle this request?
      */
     if (!(types = ap_cache_get_cachetype(r, conf, path))) {
         return DECLINED;
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "cache: URL %s is being handled by %s", path, types);
 
     urllen = strlen(url);
     if (urllen > MAX_URL_LENGTH) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "cache: URL exceeds length threshold: %s", url);
         return DECLINED;
     }
     /* DECLINE urls ending in / */
     if (url[urllen-1] == '/') {
         return DECLINED;
@@ -149,26 +149,24 @@
      *
      * Caching is forbidden under the following circumstances:
      *
      * - RFC2616 14.9.2 Cache-Control: no-store
      * - Pragma: no-cache
      * - Any requests requiring authorization.
-     * - Any URLs whose length exceeds MAX_URL_LENGTH
-     * - TODO: Make MAX_URL_LENGTH a config directive?
      */
     if (conf->ignorecachecontrol_set == 1 && conf->ignorecachecontrol == 1 && auth == NULL) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
             "incoming request is asking for a uncached version of %s, but we know better and are ignoring it", url);
     }
     else {
         if (ap_cache_liststr(cc_in, "no-store", NULL) ||
             ap_cache_liststr(pragma, "no-cache", NULL) || (auth != NULL)) {
             /* delete the previously cached file */
             cache_remove_url(r, cache->types, url);
 
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                         "cache: no-store forbids caching of %s", url);
             return DECLINED;
         }
     }
 
     /*
@@ -188,46 +186,48 @@
      */
 
     rv = cache_select_url(r, cache->types, url);
     if (DECLINED == rv) {
         if (!lookup) {
             /* no existing cache file */
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "cache: no cache - add cache_in filter and DECLINE");
             /* add cache_in filter to cache this request */
             ap_add_output_filter("CACHE_IN", NULL, r, r->connection);
         }
         return DECLINED;
     }
     else if (OK == rv) {
-        /* cache file exists */
+        /* RFC2616 13.2 - Check cache object expiration */
+        cache->fresh = ap_cache_check_freshness(cache, r);
         if (cache->fresh) {
+            /* fresh data available */
             apr_bucket_brigade *out;
             conn_rec *c = r->connection;
 
-            /* fresh data available */
             if (lookup) {
                 return OK;
             }
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            rv = ap_meets_conditions(r);
+            if (rv != OK) {
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                             "cache: fresh cache - returning status %d", rv);
+                return rv;
+            }
+
+            /*
+             * Not a conditionl request. Serve up the content 
+             */
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "cache: fresh cache - add cache_out filter and "
                          "handle request");
 
             /* We are in the quick handler hook, which means that no output
              * filters have been set. So lets run the insert_filter hook.
-             * XXX - Should we be inserting filters in the output stream
-             * for proxy requests? Certainly we need the core filters
-             * (byterange, chunking, etc.).  I can also see the need to
-             * conditionally insert tag processing filters (e.g. INCLUDES).
              */
             ap_run_insert_filter(r);
-
-            /* Now add the cache_out filter. cache_out is a FTYPE_CONTENT
-             * which means it will be inserted first in the stream, which
-             * is exactly what we need.
-             */
             ap_add_output_filter("CACHE_OUT", NULL, r, r->connection);
 
             /* kick off the filter stack */
             out = apr_brigade_create(r->pool, c->bucket_alloc);
             if (APR_SUCCESS != (rv = ap_pass_brigade(r->output_filters, out))) {
                 ap_log_error(APLOG_MARK, APLOG_ERR, rv, r->server,
@@ -241,59 +241,59 @@
         else {
             /* stale data available */
             if (lookup) {
                 return DECLINED;
             }
 
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "cache: stale cache - test conditional");
             /* if conditional request */
             if (ap_cache_request_is_conditional(r)) {
-                ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                              r->server,
                              "cache: conditional - add cache_in filter and "
                              "DECLINE");
-
+                /* Why not add CACHE_CONDITIONAL? */
                 ap_add_output_filter("CACHE_IN", NULL, r, r->connection);
 
                 return DECLINED;
             }
             /* else if non-conditional request */
             else {
                 /* fudge response into a conditional */
                 if (info && info->etag) {
-                    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                                  r->server,
                                  "cache: nonconditional - fudge conditional "
                                  "by etag");
                     /* if we have a cached etag */
                     apr_table_set(r->headers_in, "If-None-Match", info->etag);
                 }
                 else if (info && info->lastmods) {
-                    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                                  r->server,
                                  "cache: nonconditional - fudge conditional "
                                  "by lastmod");
                     /* if we have a cached IMS */
                     apr_table_set(r->headers_in, 
                                   "If-Modified-Since", 
                                   info->lastmods);
                 }
                 else {
                     /* something else - pretend there was no cache */
-                    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                                  r->server,
                                  "cache: nonconditional - no cached "
                                  "etag/lastmods - add cache_in and DECLINE");
 
                     ap_add_output_filter("CACHE_IN", NULL, r, r->connection);
 
                     return DECLINED;
                 }
                 /* add cache_conditional filter */
-                ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                              r->server,
                              "cache: nonconditional - add cache_conditional and"
                              " DECLINE");
                 ap_add_output_filter("CACHE_CONDITIONAL", 
                                      NULL, 
                                      r, 
@@ -333,26 +333,23 @@
         ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
                      "CACHE_OUT enabled unexpectedly");
         ap_remove_output_filter(f);
         return ap_pass_brigade(f->next, bb);
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, APR_SUCCESS, r->server,
             "cache: running CACHE_OUT filter");
 
-    /* TODO: Handle getting errors on either of these calls 
-     * ???: Should we return headers on a subrequest?
-     */
-    cache_read_entity_headers(cache->handle, r);    
+    /* cache_read_entity_headers() was called in cache_select_url() */
     cache_read_entity_body(cache->handle, r->pool, bb);
 
     /* This filter is done once it has served up its content */
     ap_remove_output_filter(f);
 
-    ap_log_error(APLOG_MARK, APLOG_INFO | APLOG_NOERRNO, 0, r->server,
-            "cached version of %s being served", r->uri);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, APR_SUCCESS, r->server,
+            "cache: serving cached version of %s", r->uri);
     return ap_pass_brigade(f->next, bb);
 }
 
 
 /*
  * CACHE_CONDITIONAL filter
@@ -365,13 +362,13 @@
  * Otherwise
  *   replace ourselves with cache_in filter
  */
 
 static int cache_conditional_filter(ap_filter_t *f, apr_bucket_brigade *in)
 {
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, f->r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, f->r->server,
                  "cache: running CACHE_CONDITIONAL filter");
 
     if (f->r->status == HTTP_NOT_MODIFIED) {
         /* replace ourselves with CACHE_OUT filter */
         ap_add_output_filter("CACHE_OUT", NULL, f->r, f->r->connection);
     }
@@ -413,13 +410,13 @@
     (cache_server_conf *) ap_get_module_config(sconf, &cache_module);
     void *scache = r->request_config;
     cache_request_rec *cache =
     (cache_request_rec *) ap_get_module_config(scache, &cache_module);
 
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, f->r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, f->r->server,
                  "cache: running CACHE_IN filter");
 
     /* check first whether running this filter has any point or not */
     if(r->no_cache) {
         ap_remove_output_filter(f);
         return ap_pass_brigade(f->next, in);
@@ -548,13 +545,13 @@
            ap_cache_liststr(cc_out, "public", NULL))
         ) ||
 
     /* or we've been asked not to cache it above */
         r->no_cache) {
 
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "cache: response is not cachable");
 
         /* remove this object from the cache 
          * BillS Asks.. Why do we need to make this call to remove_url?
          * leave it in for now..
          */
@@ -644,13 +641,13 @@
     if (rv != OK) {
         /* Caching layer declined the opportunity to cache the response */
         ap_remove_output_filter(f);
         return ap_pass_brigade(f->next, in);
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "cache: Caching url: %s", url);
 
     /*
      * We now want to update the cache file header information with
      * the new date, last modified, expire and content length and write
      * it away to our cache file. First, we determine these values from
@@ -675,13 +672,13 @@
          * the cache 
          */
         date = now;
         dates = apr_pcalloc(r->pool, MAX_STRING_LEN);
         apr_rfc822_date(dates, now);
         ap_table_set(r->headers_out, "Date", dates);
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "cache: Added date header");
         info->date = date;
     }
     else {
         date = info->date;
     }
@@ -696,13 +693,13 @@
     /* XXX FIXME we're referencing date on a path where we didn't set it */
     if (lastmod != APR_DATE_BAD && lastmod > date)
     {
         /* if its in the future, then replace by date */
         lastmod = date;
         lastmods = dates;
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, 
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, 
                      r->server,
                      "cache: Last modified is in the future, "
                      "replacing with now");
     }
     info->lastmod = lastmod;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.dsp	2002-04-03 14:09:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.dsp	2002-06-08 00:28:47.000000000 +0800
@@ -49,14 +49,14 @@
 # ADD BASE RSC /l 0x409 /d "NDEBUG"
 # ADD RSC /l 0x409 /d "NDEBUG"
 BSC32=bscmake.exe
 # ADD BASE BSC32 /nologo
 # ADD BSC32 /nologo
 LINK32=link.exe
-# ADD BASE LINK32 kernel32.lib /nologo /subsystem:windows /dll /incremental:no /map /machine:I386
-# ADD LINK32 kernel32.lib /nologo /subsystem:windows /dll /incremental:no /map /machine:I386 /out:"Release/mod_cache.so" /base:@..\..\os\win32\BaseAddr.ref,mod_cache
+# ADD BASE LINK32 kernel32.lib /nologo /subsystem:windows /dll /map /machine:I386
+# ADD LINK32 kernel32.lib /nologo /subsystem:windows /dll /map /machine:I386 /out:"Release/mod_cache.so" /base:@..\..\os\win32\BaseAddr.ref,mod_cache
 
 !ELSEIF  "$(CFG)" == "mod_cache - Win32 Debug"
 
 # PROP BASE Use_MFC 0
 # PROP BASE Use_Debug_Libraries 1
 # PROP BASE Output_Dir "Debug"
@@ -89,12 +89,24 @@
 # Name "mod_cache - Win32 Debug"
 # Begin Group "Source Files"
 
 # PROP Default_Filter "cpp;c;cxx;rc;def;r;odl;idl;hpj;bat"
 # Begin Source File
 
+SOURCE=.\cache_cache.c
+# End Source File
+# Begin Source File
+
+SOURCE=.\cache_hash.c
+# End Source File
+# Begin Source File
+
+SOURCE=.\cache_pqueue.c
+# End Source File
+# Begin Source File
+
 SOURCE=.\cache_storage.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\cache_util.c
 # End Source File
@@ -105,12 +117,24 @@
 # End Group
 # Begin Group "Header Files"
 
 # PROP Default_Filter "h;hpp;hxx;hm;inl"
 # Begin Source File
 
+SOURCE=.\cache_cache.h
+# End Source File
+# Begin Source File
+
+SOURCE=.\cache_hash.h
+# End Source File
+# Begin Source File
+
+SOURCE=.\cache_pqueue.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\mod_cache.h
 # End Source File
 # End Group
 # Begin Group "Resource Files"
 
 # PROP Default_Filter "ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_cache.h	2002-04-04 01:34:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_cache.h	2002-06-05 11:45:13.000000000 +0800
@@ -195,12 +195,17 @@
     apr_time_t lastmod;
     char lastmod_str[APR_RFC822_DATE_LEN];
     apr_time_t expire;
     apr_time_t request_time;
     apr_time_t response_time;
     apr_size_t len;
+    apr_time_t ims;    /*  If-Modified_Since header value    */
+    apr_time_t ius;    /*  If-UnModified_Since header value    */
+    const char *im;         /* If-Match header value */
+    const char *inm;         /* If-None-Match header value */
+    apr_table_t *req_hdrs;   /* These are the original request headers   */
 };
 
 /* cache handle information */
 typedef struct cache_object cache_object_t;
 struct cache_object {
     char *key;
@@ -235,15 +240,22 @@
     cache_handle_t *handle;		/* current cache handle */
     int in_checked;			/* CACHE_IN must cache the entity */
 } cache_request_rec;
 
 
 /* cache_util.c */
+/* do a HTTP/1.1 age calculation */
+CACHE_DECLARE(apr_time_t) ap_cache_current_age(cache_info *info, const apr_time_t age_value);
+
 /**
- *
+ * Check the freshness of the cache object per RFC2616 section 13.2 (Expiration Model)
+ * @param cache cache_request_rec
+ * @param r request_rec
+ * @return 0 ==> cache object is stale, 1 ==> cache object is fresh
  */
+CACHE_DECLARE(int) ap_cache_check_freshness(cache_request_rec *cache, request_rec *r);
 CACHE_DECLARE(apr_time_t) ap_cache_hex2usec(const char *x);
 CACHE_DECLARE(void) ap_cache_usec2hex(apr_time_t j, char *y);
 CACHE_DECLARE(char *) generate_name(apr_pool_t *p, int dirlevels, 
                                     int dirlength, 
                                     const char *name);
 CACHE_DECLARE(int) ap_cache_request_is_conditional(request_rec *r);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental: mod_cache.imp
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_charset_lite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_charset_lite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_charset_lite.c	2002-03-29 16:17:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_charset_lite.c	2002-05-17 19:33:09.000000000 +0800
@@ -241,13 +241,13 @@
     charset_req_t *reqinfo;
     charset_filter_ctx_t *input_ctx, *output_ctx;
     apr_status_t rv;
     const char *mime_type;
 
     if (dc->debug >= DBGLVL_FLOW) {
-        ap_log_rerror(APLOG_MARK,APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK,APLOG_DEBUG, 0, r,
                       "uri: %s file: %s method: %d "
                       "imt: %s flags: %s%s%s %s->%s",
                       r->uri, r->filename, r->method_number,
                       r->content_type ? r->content_type : "(unknown)",
                       r->main     ? "S" : "",    /* S if subrequest */
                       r->prev     ? "R" : "",    /* R if redirect */
@@ -256,13 +256,13 @@
     }
 
     /* If we don't have a full directory configuration, bail out.
      */
     if (!dc->charset_source || !dc->charset_default) {
         if (dc->debug >= DBGLVL_PMC) {
-            ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                           "incomplete configuration: src %s, dst %s",
                           dc->charset_source ? dc->charset_source : "unspecified",
                           dc->charset_default ? dc->charset_default : "unspecified");
         }
         return DECLINED;
     }
@@ -300,21 +300,21 @@
          * mod_info output, hard-coded error documents, etc.
          */
         strcmp(mime_type, DIR_MAGIC_TYPE) &&
 #endif
         strncasecmp(mime_type, "message/", 8)) {
         if (dc->debug >= DBGLVL_GORY) {
-            ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                           "mime type is %s; no translation selected",
                           mime_type);
         }
         return DECLINED;
     }
 
     if (dc->debug >= DBGLVL_GORY) {
-        ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                       "charset_source: %s charset_default: %s",
                       dc && dc->charset_source ? dc->charset_source : "(none)",
                       dc && dc->charset_default ? dc->charset_default : "(none)");
     }
 
     /* Get storage for the request data and the output filter context.
@@ -403,25 +403,25 @@
     if (reqinfo) {
         if (reqinfo->output_ctx && !configured_on_output(r, XLATEOUT_FILTER_NAME)) {
             ap_add_output_filter(XLATEOUT_FILTER_NAME, reqinfo->output_ctx, r, 
                                  r->connection);
         }
         else if (dc->debug >= DBGLVL_FLOW) {
-            ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                           "xlate output filter not added implicitly because %s",
                           !reqinfo->output_ctx ? 
                           "no output configuration available" :
                           "another module added the filter");
         }
 
         if (reqinfo->input_ctx && !configured_on_input(r, XLATEIN_FILTER_NAME)) {
             ap_add_input_filter(XLATEIN_FILTER_NAME, reqinfo->input_ctx, r,
                                 r->connection);
         }
         else if (dc->debug >= DBGLVL_FLOW) {
-            ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                           "xlate input filter not added implicitly because %s",
                           !reqinfo->input_ctx ?
                           "no input configuration available" :
                           "another module added the filter");
         }
     }
@@ -545,28 +545,28 @@
 static void log_xlate_error(ap_filter_t *f, apr_status_t rv)
 {
     charset_filter_ctx_t *ctx = f->ctx;
     const char *msg;
     char msgbuf[100];
     int cur;
-    int flags = APLOG_ERR;
 
     switch(ctx->ees) {
     case EES_LIMIT:
-        flags |= APLOG_NOERRNO;
+        rv = 0;
         msg = "xlate filter - a built-in restriction was encountered";
         break;
     case EES_BAD_INPUT:
-        flags |= APLOG_NOERRNO;
+        rv = 0;
         msg = "xlate filter - an input character was invalid";
         break;
     case EES_BUCKET_READ:
+        rv = 0;
         msg = "xlate filter - bucket read routine failed";
         break;
     case EES_INCOMPLETE_CHAR:
-        flags |= APLOG_NOERRNO;
+        rv = 0;
         strcpy(msgbuf, "xlate filter - incomplete char at end of input - ");
         cur = 0;
         while (cur < ctx->saved) {
             apr_snprintf(msgbuf + strlen(msgbuf), sizeof(msgbuf) - strlen(msgbuf), 
                          "%02X", (unsigned)ctx->buf[cur]);
             ++cur;
@@ -576,13 +576,13 @@
     case EES_DOWNSTREAM:
         msg = "xlate filter - an error occurred in a lower filter";
         break;
     default:
         msg = "xlate filter - returning error";
     }
-    ap_log_rerror(APLOG_MARK, flags, rv, f->r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, f->r,
                   "%s", msg);
 }
 
 /* chk_filter_chain() is called once per filter instance; it tries to
  * determine if the current filter instance should be disabled because
  * its translation is incompatible with the translation of an existing
@@ -652,13 +652,13 @@
                      */
                     if (last_xlate_ctx == f->ctx) {
                         last_xlate_ctx->noop = 1;
                         if (debug >= DBGLVL_PMC) {
                             const char *symbol = output ? "->" : "<-";
 
-                            ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO,
+                            ap_log_rerror(APLOG_MARK, APLOG_DEBUG,
                                           0, f->r,
                                           "%s %s - disabling "
                                           "translation %s%s%s; existing "
                                           "translation %s%s%s",
                                           f->r->uri ? "uri" : "file",
                                           f->r->uri ? f->r->uri : f->r->filename,
@@ -670,13 +670,13 @@
                                           curctx->dc->charset_default);
                         }
                     }
                     else {
                         const char *symbol = output ? "->" : "<-";
 
-                        ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO,
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR,
                                       0, f->r,
                                       "chk_filter_chain() - can't disable "
                                       "translation %s%s%s; existing "
                                       "translation %s%s%s",
                                       last_xlate_ctx->dc->charset_source,
                                       symbol,
@@ -856,13 +856,13 @@
             ctx->dc = dc;
             ctx->noop = 1;
         }
     }
 
     if (dc->debug >= DBGLVL_GORY) {
-        ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, f->r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, f->r,
                      "xlate_out_filter() - "
                      "charset_source: %s charset_default: %s",
                      dc && dc->charset_source ? dc->charset_source : "(none)",
                      dc && dc->charset_default ? dc->charset_default : "(none)");
     }
 
@@ -1014,13 +1014,13 @@
             ctx->dc = dc;
             ctx->noop = 1;
         }
     }
 
     if (dc->debug >= DBGLVL_GORY) {
-        ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, f->r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, f->r,
                      "xlate_in_filter() - "
                      "charset_source: %s charset_default: %s",
                      dc && dc->charset_source ? dc->charset_source : "(none)",
                      dc && dc->charset_default ? dc->charset_default : "(none)");
     }
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: mod_deflate.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: mod_deflate.dsp
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: mod_deflate.exp
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_disk_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_disk_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_disk_cache.c	2002-04-04 05:26:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_disk_cache.c	2002-05-31 00:34:38.000000000 +0800
@@ -345,13 +345,13 @@
     h->read_body = &read_body;
     h->read_headers = &read_headers;
     h->write_body = &write_body;
     h->write_headers = &write_headers;
     h->remove_entity = &remove_entity;
 
-    ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                  "disk_cache: Caching URL %s",  key);
 
     return OK;
 }
 
 static int open_entity(cache_handle_t *h, request_rec *r, const char *type, const char *key)
@@ -419,26 +419,24 @@
     h->read_body = &read_body;
     h->read_headers = &read_headers;
     h->write_body = &write_body;
     h->write_headers = &write_headers;
     h->remove_entity = &remove_entity;
 
-    ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                  "disk_cache: Serving Cached URL %s",  dobj->name);
     return OK;
 }
 
 static int remove_url(const char *type, char *key) 
 {
   return OK;
 }
 
 static int remove_entity(cache_handle_t *h) 
 {
-    cache_object_t *obj = h->cache_obj;
-
     /* Null out the cache object pointer so next time we start from scratch  */
     h->cache_obj = NULL;
     return OK;
 }
 
 /*
@@ -492,13 +490,13 @@
 	*temp = '\0';              /* overlay it with the null terminator */
 
     r->status_line = apr_pstrdup(r->pool, urlbuff);            /* Save status line into request rec  */
 
     apr_file_close(dobj->hfd);
 
-    ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                  "disk_cache: Served headers for URL %s",  dobj->name);
     return APR_SUCCESS;
 }
 
 static apr_status_t read_body(cache_handle_t *h, apr_pool_t *p, apr_bucket_brigade *bb) 
 {
@@ -545,13 +543,13 @@
         if (rv != APR_SUCCESS) {
             mkdir_structure(conf, dobj->hdrsfile, r->pool);
         }
 
         rv = apr_file_open(&dobj->hfd, dobj->hdrsfile,
                            APR_WRITE | APR_CREATE | APR_EXCL,
-                           0, r->pool);
+                           APR_OS_DEFAULT, r->pool);
         if (rv != APR_SUCCESS) {
             return rv;
         }
         hfd = dobj->hfd;
         dobj->name = h->cache_obj->key;
 
@@ -595,22 +593,21 @@
         apr_file_close(hfd); /* flush and close */
     }
     else {
         /* XXX log message */
     }
 
-    ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                  "disk_cache: Caching headers for URL %s",  dobj->name);
     return APR_SUCCESS;
 }
 static apr_status_t write_body(cache_handle_t *h, request_rec *r, apr_bucket_brigade *b) 
 {
     apr_bucket *e;
     apr_status_t rv;
     disk_cache_object_t *dobj = (disk_cache_object_t *) h->cache_obj->vobj;
-    cache_info *info = &(h->cache_obj->info);
 
     if (!dobj->fd) {
         rv = apr_file_open(&dobj->fd, dobj->tempfile, 
                            APR_WRITE | APR_CREATE | APR_BINARY| APR_TRUNCATE | APR_BUFFERED,
                            APR_UREAD | APR_UWRITE, r->pool);
         if (rv != APR_SUCCESS) {
@@ -622,13 +619,13 @@
         apr_size_t length;
         apr_bucket_read(e, &str, &length, APR_BLOCK_READ);
         apr_file_write(dobj->fd, str, &length);
     }
     if (APR_BUCKET_IS_EOS(APR_BRIGADE_LAST(b))) {
         file_cache_el_final(h, r);    /* Link to the perm file, and close the descriptor  */
-        ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
                      "disk_cache: Cached body for URL %s",  dobj->name);
     }
 
     return APR_SUCCESS;	
 }
 
@@ -671,14 +668,16 @@
     conf->space = atoi(arg);
     return NULL;
 }
 static const char
 *set_cache_gcint(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
+/*
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
+*/
     /* XXX */
     return NULL;
 }
 /*
  * Consider eliminating the next two directives in favor of
  * Ian's prime number hash...
@@ -712,15 +711,16 @@
     conf->dirlength = val;
     return NULL;
 }
 static const char
 *set_cache_exchk(cmd_parms *parms, void *in_struct_ptr, int flag)
 {
+    /* XXX 
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const char
 *set_cache_minfs(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
@@ -736,47 +736,52 @@
     conf->maxfs = atoi(arg);
     return NULL;
 }
 static const char
 *set_cache_minetm(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
+    /* XXX
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const char
 *set_cache_gctime(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
+    /* XXX
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const char
 *add_cache_gcclean(cmd_parms *parms, void *in_struct_ptr, const char *arg, const char *arg1)
 {
+    /* XXX
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const char
 *add_cache_gcclnun(cmd_parms *parms, void *in_struct_ptr, const char *arg, const char *arg1)
 {
+    /* XXX
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const char
 *set_cache_maxgcmem(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
+    /* XXX
     disk_cache_conf *conf = ap_get_module_config(parms->server->module_config, 
                                                  &disk_cache_module);
-    /* XXX */
+    */
     return NULL;
 }
 static const command_rec disk_cache_cmds[] =
 {
     AP_INIT_TAKE1("CacheRoot", set_cache_root, NULL, RSRC_CONF,
                  "The directory to store cache files"),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_example.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_example.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_example.c	2002-03-28 19:17:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_example.c	2002-06-17 09:59:32.000000000 +0800
@@ -1018,14 +1018,17 @@
      */
     trace_add(r->server, NULL, cfg, "x_post_config()");
     return DECLINED;
 }
 
 /*
- * This routine is called to perform any module-specific fixing of header
- * fields, et cetera.  It is invoked just before any content-handler.
+ * This routine is called just after the server accepts the connection,
+ * but before it is handed off to a protocol module to be served.  The point
+ * of this hook is to allow modules an opportunity to modify the connection
+ * as soon as possible. The core server uses this phase to setup the
+ * connection record based on the type of connection that is being used.
  *
  * The return value is OK, DECLINED, or HTTP_mumble.  If we return OK, the
  * server will still call any remaining modules with an handler for this
  * phase.
  */
 static int x_pre_connection(conn_rec *c, void *csd)
@@ -1039,12 +1042,26 @@
      */
     trace_add(r->server, NULL, cfg, "x_post_config()");
 #endif
     return OK;
 }
 
+/* This routine is used to actually process the connection that was received.
+ * Only protocol modules should implement this hook, as it gives them an
+ * opportunity to replace the standard HTTP processing with processing for
+ * some other protocol.  Both echo and POP3 modules are available as
+ * examples.
+ *
+ * The return VALUE is OK, DECLINED, or HTTP_mumble.  If we return OK, no 
+ * further modules are called for this phase.
+ */
+static int x_process_connection(conn_rec *c)
+{
+    return DECLINED;
+}
+
 /*
  * This routine is called after the request has been read but before any other
  * phases have been processed.  This allows us to make decisions based upon
  * the input header fields.
  *
  * The return value is OK, DECLINED, or HTTP_mumble.  If we return OK, no
@@ -1248,16 +1265,13 @@
     ap_hook_post_config(x_post_config, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_open_logs(x_open_logs, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_child_init(x_child_init, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_handler(x_handler, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_quick_handler(x_quick_handler, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_pre_connection(x_pre_connection, NULL, NULL, APR_HOOK_MIDDLE);
-/* This module doesn't have a process connection phase, but I am leaving
- * the code in, in-case somebody wants to add one.
- */
-/*    ap_hook_process_connection(x_fixer_upper, NULL, NULL, APR_HOOK_MIDDLE); */
+    ap_hook_process_connection(x_process_connection, NULL, NULL, APR_HOOK_MIDDLE);
     /* [1] post read_request handling */
     ap_hook_post_read_request(x_post_read_request, NULL, NULL,
                               APR_HOOK_MIDDLE);
     ap_hook_log_transaction(x_logger, NULL, NULL, APR_HOOK_MIDDLE);
 #if 0
     ap_hook_http_method(x_http_method, NULL, NULL, APR_HOOK_MIDDLE);
@@ -1292,38 +1306,12 @@
         NULL,                               /* argument to include in call */
         OR_OPTIONS,                         /* where available */
         "Example directive - no arguments"  /* directive description */
     ),
     {NULL}
 };
-
-/*--------------------------------------------------------------------------*/
-/*                                                                          */
-/* Now the list of content handlers available from this module.             */
-/*                                                                          */
-/*--------------------------------------------------------------------------*/
-/* 
- * List of content handlers our module supplies.  Each handler is defined by
- * two parts: a name by which it can be referenced (such as by
- * {Add,Set}Handler), and the actual routine name.  The list is terminated by
- * a NULL block, since it can be of variable length.
- *
- * Note that content-handlers are invoked on a most-specific to least-specific
- * basis; that is, a handler that is declared for "text/plain" will be
- * invoked before one that was declared for "text / *".  Note also that
- * if a content-handler returns anything except DECLINED, no other
- * content-handlers will be called.
- */
-#if 0
-static const handler_rec x_handlers[] =
-{
-    {"example-handler", x_handler},
-    {NULL}
-};
-#endif
-
 /*--------------------------------------------------------------------------*/
 /*                                                                          */
 /* Finally, the list of callback routines and data structures that provide  */
 /* the static hooks into our module from the other parts of the server.     */
 /*                                                                          */
 /*--------------------------------------------------------------------------*/
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_ext_filter.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_ext_filter.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_ext_filter.c	2002-04-26 02:03:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_ext_filter.c	2002-06-13 07:59:30.000000000 +0800
@@ -482,13 +482,13 @@
     sc = ap_get_module_config(f->r->server->module_config,
                               &ext_filter_module);
     ctx->dc = dc;
     /* look for the user-defined filter */
     ctx->filter = apr_hash_get(sc->h, f->frec->name, APR_HASH_KEY_STRING);
     if (!ctx->filter) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, f->r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, f->r,
                       "couldn't find definition of filter '%s'",
                       f->frec->name);
         return APR_EINVAL;
     }
     ctx->p = f->r->pool;
     if (ctx->filter->intype &&
@@ -511,13 +511,13 @@
              */
             apr_table_unset(f->r->headers_out, "Content-Length");
         }
     }
 
     if (dc->debug >= DBGLVL_SHOWOPTIONS) {
-        ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, f->r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, f->r,
                       "%sfiltering `%s' through `%s', cfg %s",
                       ctx->noop ? "skipping: " : "",
                       f->r->uri ? f->r->uri : f->r->filename,
                       ctx->filter->command,
                       get_cfg_string(dc, ctx->filter, f->r->pool));
     }
@@ -601,13 +601,13 @@
             if (APR_STATUS_IS_EAGAIN(rv)) {
 #if APR_FILES_AS_SOCKETS
                 int num_events;
                 
                 rv = apr_poll(ctx->pollset,
                               &num_events,
-                              f->r->server->timeout * APR_USEC_PER_SEC);
+                              f->r->server->timeout);
                 if (rv || dc->debug >= DBGLVL_GORY) {
                     ap_log_rerror(APLOG_MARK, APLOG_DEBUG,
                                   rv, f->r, "apr_poll()");
                 }
                 if (rv != APR_SUCCESS && !APR_STATUS_IS_EINTR(rv)) { 
                     /* some error such as APR_TIMEUP */
@@ -616,13 +616,13 @@
 #else /* APR_FILES_AS_SOCKETS */
                 /* Yuck... I'd really like to wait until I can read
                  * or write, but instead I have to sleep and try again 
                  */
                 apr_sleep(100000); /* 100 milliseconds */
                 if (dc->debug >= DBGLVL_GORY) {
-                    ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 
+                    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 
                                   0, f->r, "apr_sleep()");
                 }
 #endif /* APR_FILES_AS_SOCKETS */
             }
             else if (rv != APR_SUCCESS) {
                 return rv;
@@ -693,13 +693,13 @@
             return rv;
         }
         /* since we've seen eos and closed the child's stdin, set the proper pipe 
          * timeout; we don't care if we don't return from apr_file_read() for a while... 
          */
         rv = apr_file_pipe_timeout_set(ctx->proc->out, 
-                                  r->server->timeout * APR_USEC_PER_SEC);
+                                       r->server->timeout);
         if (rv) {
             ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
                           "apr_file_pipe_timeout_set(child output)");
             return rv;
         }
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_mem_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_mem_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/mod_mem_cache.c	2002-04-30 11:25:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/mod_mem_cache.c	2002-06-16 00:49:19.000000000 +0800
@@ -55,31 +55,26 @@
  * originally written at the National Center for Supercomputing Applications,
  * University of Illinois, Urbana-Champaign.
  */
 
 #define CORE_PRIVATE
 #include "mod_cache.h"
+#include "cache_pqueue.h"
+#include "cache_cache.h"
 #include "ap_mpm.h"
 #include "apr_thread_mutex.h"
 #if APR_HAVE_UNISTD_H
 #include <unistd.h>
 #endif
 
 #if !APR_HAS_THREADS
 #error This module does not currently compile unless you have a thread-capable APR. Sorry!
 #endif
 
 module AP_MODULE_DECLARE_DATA mem_cache_module;
 
-/* 
- * XXX
- * This cache uses apr_hash functions which leak storage when something is removed
- * from the cache. This can be fixed in the apr_hash functions by making them use
- * malloc/free rather than pools to manage their storage requirements.
- */
-
 typedef enum {
     CACHE_TYPE_FILE = 1,
     CACHE_TYPE_HEAP,
     CACHE_TYPE_MMAP
 } cache_type_e;
 
@@ -90,48 +85,176 @@
 
 typedef struct mem_cache_object {
     cache_type_e type;
     apr_ssize_t num_header_out;
     apr_ssize_t num_subprocess_env;
     apr_ssize_t num_notes;
+    apr_ssize_t num_req_hdrs;
     cache_header_tbl_t *header_out;
     cache_header_tbl_t *subprocess_env;
     cache_header_tbl_t *notes;
+    cache_header_tbl_t *req_hdrs; /* for Vary negotiation */
     apr_size_t m_len;
     void *m;
     apr_os_file_t fd;
+    long priority;      /**< the priority of this entry */
+    long total_refs;          /**< total number of references this entry has had */
+
+#ifdef USE_ATOMICS
+    apr_atomic_t pos;   /**< the position of this entry in the cache */
+#else
+    apr_ssize_t pos;
+#endif
+
 } mem_cache_object_t;
 
 typedef struct {
     apr_thread_mutex_t *lock;
-    apr_hash_t *cacheht;
+    cache_cache_t *cache_cache;
     apr_size_t cache_size;
     apr_size_t object_cnt;
 
     /* Fields set by config directives */
     apr_size_t min_cache_object_size;   /* in bytes */
     apr_size_t max_cache_object_size;   /* in bytes */
     apr_size_t max_cache_size;          /* in bytes */
     apr_size_t max_object_cnt;
+    cache_pqueue_set_priority *cache_remove_algorithm;
 
 } mem_cache_conf;
 static mem_cache_conf *sconf;
 
 #define DEFAULT_MAX_CACHE_SIZE 100*1024
 #define DEFAULT_MIN_CACHE_OBJECT_SIZE 0
 #define DEFAULT_MAX_CACHE_OBJECT_SIZE 10000
-#define DEFAULT_MAX_OBJECT_CNT 1000
+#define DEFAULT_MAX_OBJECT_CNT 1009
 #define CACHEFILE_LEN 20
 
 /* Forward declarations */
 static int remove_entity(cache_handle_t *h);
 static apr_status_t write_headers(cache_handle_t *h, request_rec *r, cache_info *i);
 static apr_status_t write_body(cache_handle_t *h, request_rec *r, apr_bucket_brigade *b);
 static apr_status_t read_headers(cache_handle_t *h, request_rec *r);
 static apr_status_t read_body(cache_handle_t *h, apr_pool_t *p, apr_bucket_brigade *bb);
 
+static void cleanup_cache_object(cache_object_t *obj);
+
+static long memcache_get_priority(void*a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+
+    return  mobj->priority;
+}
+
+static void memcache_inc_frequency(void*a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+
+    mobj->total_refs++;
+    mobj->priority = 0;
+}
+
+static void memcache_set_pos(void *a, apr_ssize_t pos)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+
+#ifdef USE_ATOMICS
+    apr_atomic_set(&mobj->pos, pos);
+#else
+    mobj->pos = pos;
+#endif    
+}
+static apr_ssize_t memcache_get_pos(void *a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+
+#ifdef USE_ATOMICS
+    return apr_atomic_read(&mobj->pos);
+#else
+    return mobj->pos;
+#endif    
+}
+
+static apr_size_t memcache_cache_get_size(void*a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+    return mobj->m_len;
+}
+/** callback to get the key of a item */
+static const char* memcache_cache_get_key(void*a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    return obj->key;
+}
+/** 
+ * callback to free an entry 
+ * There is way too much magic in this code. Right now, this callback
+ * is only called out of cache_insert() which is called under protection
+ * of the sconf->lock, which means that we do not (and should not)
+ * attempt to obtain the lock recursively. 
+ */
+static void memcache_cache_free(void*a)
+{
+    cache_object_t *obj = (cache_object_t *)a;
+
+    /* Cleanup the cache object. Object should be removed from the cache
+     * now. Increment the refcount before setting cleanup to avoid a race 
+     * condition. A similar pattern is used in remove_url()
+     */
+#ifdef USE_ATOMICS
+    apr_atomic_inc(&obj->refcount);
+#else
+    obj->refcount++;
+#endif
+
+    obj->cleanup = 1;
+
+#ifdef USE_ATOMICS
+    if (!apr_atomic_dec(&obj->refcount)) {
+        cleanup_cache_object(obj);
+    }
+#else
+    obj->refcount--;
+    if (!obj->refcount) {
+        cleanup_cache_object(obj);
+    }
+#endif
+}
+/*
+ * functions return a 'negative' score as lower is better in a priority Q
+ */
+static long memcache_lru_algorithm(long queue_clock, void *a) 
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+    if (mobj->priority == 0)
+        mobj->priority = ((long)(queue_clock + mobj->total_refs));
+
+    /*	
+     * a 'proper' LRU function would just be
+     *  mobj->priority = mobj->total_refs; 
+     */
+    return -1*mobj->priority;
+}
+
+static long memcache_gdsf_algorithm(long queue_clock, void *a) 
+{
+    cache_object_t *obj = (cache_object_t *)a;
+    mem_cache_object_t *mobj = obj->vobj;
+
+    if (mobj->priority == 0)
+        mobj->priority = queue_clock + (long)(mobj->total_refs*1000 / mobj->m_len);
+
+    return -1*mobj->priority;
+}
+
 static void cleanup_cache_object(cache_object_t *obj)
 {
     mem_cache_object_t *mobj = obj->vobj;
 
     /* TODO:
      * We desperately need a more efficient way of allocating objects. We're
@@ -182,31 +305,42 @@
         }
         if (mobj->notes) {
             if (mobj->notes[0].hdr) 
                 free(mobj->notes[0].hdr);
             free(mobj->notes);
         }
+        if (mobj->req_hdrs) {
+            if (mobj->req_hdrs[0].hdr)
+                free(mobj->req_hdrs[0].hdr);
+            free(mobj->req_hdrs);
+        }
         free(mobj);
     }
-    return;
 }
 static apr_status_t decrement_refcount(void *arg) 
 {
     cache_object_t *obj = (cache_object_t *) arg;
 
     /* If obj->complete is not set, the cache update failed and the
-     * object needs to be removed from the cache.
+     * object needs to be removed from the cache then cleaned up.
      */
     if (!obj->complete) {
         mem_cache_object_t *mobj = (mem_cache_object_t *) obj->vobj;
         if (sconf->lock) {
             apr_thread_mutex_lock(sconf->lock);
         }
-        apr_hash_set(sconf->cacheht, obj->key, strlen(obj->key), NULL);
-        sconf->object_cnt--;
-        sconf->cache_size -= mobj->m_len;
+        /* Remember, objects marked for cleanup are, by design, already
+         * removed from the cache. remove_url() could have already
+         * removed the object from the cache (and set obj->cleanup)
+         */
+        if (!obj->cleanup) {
+            cache_remove(sconf->cache_cache, obj);
+            sconf->object_cnt--;
+            sconf->cache_size -= mobj->m_len;
+            obj->cleanup = 1;
+        }
         if (sconf->lock) {
             apr_thread_mutex_unlock(sconf->lock);
         }
     }
 
     /* Cleanup the cache object */
@@ -233,69 +367,66 @@
 #endif
     return APR_SUCCESS;
 }
 static apr_status_t cleanup_cache_mem(void *sconfv)
 {
     cache_object_t *obj;
-    apr_hash_index_t *hi;
     mem_cache_conf *co = (mem_cache_conf*) sconfv;
 
     if (!co) {
         return APR_SUCCESS;
     }
+    if (!co->cache_cache) {
+        return APR_SUCCESS;
+    }
 
-    /* Iterate over the cache and clean up each entry */
     if (sconf->lock) {
         apr_thread_mutex_lock(sconf->lock);
     }
-    for (hi = apr_hash_first(NULL, co->cacheht); hi; hi=apr_hash_next(hi)) {
-        apr_hash_this(hi, NULL, NULL, (void **)&obj);
-        if (obj) {
+    obj = cache_pop(co->cache_cache);
+    while (obj) {         
+    /* Iterate over the cache and clean up each entry */  
+    /* Free the object if the recount == 0 */
 #ifdef USE_ATOMICS
-            apr_atomic_inc(&obj->refcount);
-            obj->cleanup = 1;
-            if (!apr_atomic_dec(&obj->refcount)) {
+        apr_atomic_inc(&obj->refcount);
+        obj->cleanup = 1;
+        if (!apr_atomic_dec(&obj->refcount)) {
 #else
-            obj->cleanup = 1;
-            if (!obj->refcount) {
+        obj->cleanup = 1;
+        if (!obj->refcount) {
 #endif
-                cleanup_cache_object(obj);
-            }
+            cleanup_cache_object(obj);
         }
+        obj = cache_pop(co->cache_cache);
     }
+
+    /* Cache is empty, free the cache table */        
+    cache_free(co->cache_cache);
+
     if (sconf->lock) {
         apr_thread_mutex_unlock(sconf->lock);
     }
     return APR_SUCCESS;
 }
 /*
  * TODO: enable directives to be overridden in various containers
  */
 static void *create_cache_config(apr_pool_t *p, server_rec *s)
 {
-    int threaded_mpm;
-
     sconf = apr_pcalloc(p, sizeof(mem_cache_conf));
 
-
-    ap_mpm_query(AP_MPMQ_IS_THREADED, &threaded_mpm);
-    if (threaded_mpm) {
-        apr_thread_mutex_create(&sconf->lock, APR_THREAD_MUTEX_DEFAULT, p);
-    }
-    sconf->cacheht = apr_hash_make(p);
-
     sconf->min_cache_object_size = DEFAULT_MIN_CACHE_OBJECT_SIZE;
     sconf->max_cache_object_size = DEFAULT_MAX_CACHE_OBJECT_SIZE;
     /* Number of objects in the cache */
     sconf->max_object_cnt = DEFAULT_MAX_OBJECT_CNT;
     sconf->object_cnt = 0;
     /* Size of the cache in bytes */
     sconf->max_cache_size = DEFAULT_MAX_CACHE_SIZE;
     sconf->cache_size = 0;
-
-    apr_pool_cleanup_register(p, NULL, cleanup_cache_mem, apr_pool_cleanup_null);
+    sconf->cache_cache = NULL;
+    sconf->cache_remove_algorithm = memcache_gdsf_algorithm;
 
     return sconf;
 }
 
 static int create_entity(cache_handle_t *h, request_rec *r,
                          const char *type, 
@@ -317,25 +448,33 @@
     }
 
     /*
      * TODO: Get smarter about managing the cache size. If the cache is 
      * full, we need to garbage collect stale/infrequently referenced
      * objects.
-     */
+     * we have a self-sizing cache now
     if (sconf->object_cnt >= sconf->max_object_cnt) {
         return DECLINED;
     }
+     */
     if (type_e == CACHE_TYPE_HEAP) {
         /* We can safely ignore these measures when caching open fds */
         if (len < sconf->min_cache_object_size || 
             len > sconf->max_cache_object_size) {
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                         "cache_mem: URL %s failed the size check, "
+                         "or is incomplete", 
+                         key);
             return DECLINED;
         }
+        /*
+         * not needed now we have a self-sizing cache.
         if ((sconf->cache_size + len) > sconf->max_cache_size) {
             return DECLINED;
         }
+        */
     } else {
         /* CACHE_TYPE_FILE is only valid for local content 
          * handled by the default handler? 
          * This is not the right check...
          */
         if (!r->filename) {
@@ -361,22 +500,24 @@
     mobj = calloc(1, sizeof(*mobj));
     if (!mobj) {
         cleanup_cache_object(obj);
         return DECLINED;
     }
 
-    /* Reference mem_cache_object_t out of cache_object_t */
-    obj->vobj = mobj;
-    mobj->m_len = len;
-    mobj->type = type_e;
-    obj->complete = 0;
+    /* Finish initing the cache object */
 #ifdef USE_ATOMICS
     apr_atomic_set(&obj->refcount, 1);
-#else
+#else 
     obj->refcount = 1;
 #endif
+    mobj->total_refs = 1;
+    obj->complete = 0;
+    obj->cleanup = 0;
+    obj->vobj = mobj;
+    mobj->m_len = len;
+    mobj->type = type_e;
 
     /* Place the cache_object_t into the hash table.
      * Note: Perhaps we should wait to put the object in the
      * hash table when the object is complete?  I add the object here to
      * avoid multiple threads attempting to cache the same content only
      * to discover at the very end that only one of them will suceed.
@@ -387,17 +528,16 @@
      * initialized...
      * XXX Need a way to insert into the cache w/o such coarse grained locking 
      */
     if (sconf->lock) {
         apr_thread_mutex_lock(sconf->lock);
     }
-    tmp_obj = (cache_object_t *) apr_hash_get(sconf->cacheht, 
-                                              key, 
-                                              APR_HASH_KEY_STRING);
+    tmp_obj = (cache_object_t *) cache_find(sconf->cache_cache, key);
+
     if (!tmp_obj) {
-        apr_hash_set(sconf->cacheht, obj->key, strlen(obj->key), obj);
+        cache_insert(sconf->cache_cache, obj);     
         sconf->object_cnt++;
         sconf->cache_size += len;
     }
     if (sconf->lock) {
         apr_thread_mutex_unlock(sconf->lock);
     }
@@ -408,16 +548,12 @@
          * is further along.
          */
         cleanup_cache_object(obj);
         return DECLINED;
     }
 
-    /* Set the cleanup flag and register the cleanup to cleanup
-     * the cache_object_t if the cache load is aborted.
-     */
-    obj->cleanup = 1;
     apr_pool_cleanup_register(r->pool, obj, decrement_refcount, 
                               apr_pool_cleanup_null);
 
     /* Populate the cache handle */
     h->cache_obj = obj;
     h->read_body = &read_body;
@@ -437,23 +573,24 @@
     if (strcasecmp(type, "mem") && strcasecmp(type, "fd")) {
         return DECLINED;
     }
     if (sconf->lock) {
         apr_thread_mutex_lock(sconf->lock);
     }
-    obj = (cache_object_t *) apr_hash_get(sconf->cacheht, key, 
-                                          APR_HASH_KEY_STRING);
+    obj = (cache_object_t *) cache_find(sconf->cache_cache, key);
     if (obj) {
         if (obj->complete) {
             request_rec *rmain=r, *rtmp;
-
 #ifdef USE_ATOMICS
             apr_atomic_inc(&obj->refcount);
 #else
             obj->refcount++;
 #endif
+            /* cache is worried about overall counts, not 'open' ones */
+            cache_update(sconf->cache_cache, obj);
+
             /* If this is a subrequest, register the cleanup against
              * the main request. This will prevent the cache object 
              * from being cleaned up from under the request after the
              * subrequest is destroyed.
              */
             rtmp = r;
@@ -493,29 +630,30 @@
     cache_object_t *obj = h->cache_obj;
 
     /* Remove the cache object from the cache under protection */
     if (sconf->lock) {
         apr_thread_mutex_lock(sconf->lock);
     }
-    /* Set the cleanup flag. Object will be cleaned up (by decrement_refcount)
-     * when the refcount drops to zero.
+    /* If the object is not already marked for cleanup, remove
+     * it from the cache and mark it for cleanup. Remember,
+     * an object marked for cleanup is by design not in the
+     * hash table.
      */
-    obj->cleanup = 1;
-    obj = (cache_object_t *) apr_hash_get(sconf->cacheht, obj->key,
-                                          APR_HASH_KEY_STRING);
-    if (obj && obj->complete) {
+    if (!obj->cleanup) {
         mem_cache_object_t *mobj = (mem_cache_object_t *) obj->vobj;
-        apr_hash_set(sconf->cacheht, obj->key, strlen(obj->key), NULL);
+        cache_remove(sconf->cache_cache, obj);
         sconf->object_cnt--;
         sconf->cache_size -= mobj->m_len;
+        obj->cleanup = 1;
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, NULL, "gcing a cache entry");
     }
+
     if (sconf->lock) {
         apr_thread_mutex_unlock(sconf->lock);
     }
 
-    h->cache_obj = NULL;
     return OK;
 }
 static apr_status_t serialize_table(cache_header_tbl_t **obj, 
                                     apr_ssize_t *nelts, 
                                     apr_table_t *table)
 {
@@ -577,42 +715,47 @@
 {
     cache_object_t *obj;
 
     if (strcasecmp(type, "mem") && strcasecmp(type, "fd")) {
         return DECLINED;
     }
-
-    /* WIBNIF
-     * apr_hash_set(..,..,..,NULL) returned pointer to the object just removed.
-     * That way, we could free the object w/o doing another call to an
-     * apr_hash function.
+    /* Order of the operations is important to avoid race conditions. 
+     * First, remove the object from the cache. Remember, all additions
+     * deletions from the cache are protected by sconf->lock.
+     * Increment the ref count on the object to indicate our thread
+     * is accessing the object. Then set the cleanup flag on the
+     * object. Remember, the cleanup flag is NEVER set on an
+     * object in the hash table.  If an object has the cleanup
+     * flag set, it is guaranteed to NOT be in the hash table.
      */
-
-    /* First, find the object in the cache */
     if (sconf->lock) {
         apr_thread_mutex_lock(sconf->lock);
     }
-    obj = (cache_object_t *) apr_hash_get(sconf->cacheht, key, 
-                                          APR_HASH_KEY_STRING);
+  
+    obj = cache_find(sconf->cache_cache, key);       
     if (obj) {
-        mem_cache_object_t *mobj = (mem_cache_object_t *) obj->vobj;
-        apr_hash_set(sconf->cacheht, key, APR_HASH_KEY_STRING, NULL);
+        mem_cache_object_t *mobj;
+        cache_remove(sconf->cache_cache, obj);
+        mobj = (mem_cache_object_t *) obj->vobj;
         sconf->object_cnt--;
         sconf->cache_size -= mobj->m_len;
-        /* Set cleanup to ensure decrement_refcount cleans up the obj if it 
-         * is still being referenced by another thread
-         */
-        obj->cleanup = 1;
+
 #ifdef USE_ATOMICS
-        /* Refcount increment MUST be made under protection of the lock */
+        /* Refcount increment in this case MUST be made under 
+         * protection of the lock 
+         */
         apr_atomic_inc(&obj->refcount);
 #else
         if (!obj->refcount) {
             cleanup_cache_object(obj);
+            obj = NULL;
         }
 #endif
+        if (obj) {
+            obj->cleanup = 1;
+        }
     }
     if (sconf->lock) {
         apr_thread_mutex_unlock(sconf->lock);
     }
 #ifdef USE_ATOMICS
     if (obj) {
@@ -625,25 +768,38 @@
 }
 
 static apr_status_t read_headers(cache_handle_t *h, request_rec *r) 
 {
     int rc;
     mem_cache_object_t *mobj = (mem_cache_object_t*) h->cache_obj->vobj;
+    cache_info *info = &(h->cache_obj->info);
+ 
+    info->req_hdrs = apr_table_make(r->pool, mobj->num_req_hdrs);
 
-    r->headers_out = apr_table_make(r->pool,mobj->num_header_out);
+    r->headers_out = apr_table_make(r->pool, mobj->num_header_out);
     r->subprocess_env = apr_table_make(r->pool, mobj->num_subprocess_env);
     r->notes = apr_table_make(r->pool, mobj->num_notes);
+
+    rc = unserialize_table(mobj->req_hdrs,
+                           mobj->num_req_hdrs,
+                           info->req_hdrs);
     rc = unserialize_table( mobj->header_out,
                             mobj->num_header_out, 
                             r->headers_out);
     rc = unserialize_table( mobj->subprocess_env, 
                             mobj->num_subprocess_env, 
                             r->subprocess_env);
     rc = unserialize_table( mobj->notes,
                             mobj->num_notes,
                             r->notes);
+
+    /* Content-Type: header may not be set if content is local since
+     * CACHE_IN runs before header filters....
+     */
+    ap_set_content_type(r, apr_pstrdup(r->pool, h->cache_obj->info.content_type));
+
     return rc;
 }
 
 static apr_status_t read_body(cache_handle_t *h, apr_pool_t *p, apr_bucket_brigade *bb) 
 {
     apr_bucket *b;
@@ -669,12 +825,26 @@
 
 static apr_status_t write_headers(cache_handle_t *h, request_rec *r, cache_info *info)
 {
     cache_object_t *obj = h->cache_obj;
     mem_cache_object_t *mobj = (mem_cache_object_t*) obj->vobj;
     int rc;
+ 
+    /*
+     * The cache needs to keep track of the following information: 
+     * - Date, LastMod, Version, ReqTime, RespTime, ContentLength 
+     * - The original request headers (for Vary) 
+     * - The original response headers (for returning with a cached response) 
+     * - The body of the message
+     */
+    rc = serialize_table(&mobj->req_hdrs,
+                         &mobj->num_req_hdrs,
+                         r->headers_in);
+    if (rc != APR_SUCCESS) {
+        return rc;
+    }
 
     /* Precompute how much storage we need to hold the headers */
     rc = serialize_table(&mobj->header_out, 
                          &mobj->num_header_out, 
                          r->headers_out);   
     if (rc != APR_SUCCESS) {
@@ -696,12 +866,18 @@
     if (info->date) {
         obj->info.date = info->date;
     }
     if (info->lastmod) {
         obj->info.lastmod = info->lastmod;
     }
+    if (info->response_time) {
+        obj->info.response_time = info->response_time;
+    }
+    if (info->request_time) {
+        obj->info.request_time = info->request_time;
+    }
     if (info->expire) {
         obj->info.expire = info->expire;
     }
     if (info->content_type) {
         obj->info.content_type = (char*) calloc(1, strlen(info->content_type) + 1);
         if (!obj->info.content_type) {
@@ -725,12 +901,13 @@
     apr_status_t rv;
     cache_object_t *obj = h->cache_obj;
     mem_cache_object_t *mobj = (mem_cache_object_t*) obj->vobj;
     apr_read_type_e eblock = APR_BLOCK_READ;
     apr_bucket *e;
     char *cur;
+    int eos = 0;
 
     if (mobj->type == CACHE_TYPE_FILE) {
         apr_file_t *file = NULL;
         int fd = 0;
         int other = 0;
 
@@ -738,43 +915,37 @@
          * - the brigade contains one and only one file_bucket &&
          * - the brigade is complete &&
          * - the file_bucket is the last data bucket in the brigade
          */
         APR_BRIGADE_FOREACH(e, b) {
             if (APR_BUCKET_IS_EOS(e)) {
-                obj->complete = 1;
+                eos = 1;
             }
             else if (APR_BUCKET_IS_FILE(e)) {
                 apr_bucket_file *a = e->data;
                 fd++;
                 file = a->fd;
             }
             else {
                 other++;
             }
         }
-        if (fd == 1 && !other && obj->complete) {
+        if (fd == 1 && !other && eos) {
             apr_file_t *tmpfile;
+            const char *name;
             /* Open a new XTHREAD handle to the file */
-            rv = apr_file_open(&tmpfile, r->filename, 
+            apr_file_name_get(&name, file);
+            rv = apr_file_open(&tmpfile, name, 
                                APR_READ | APR_BINARY | APR_XTHREAD | APR_FILE_NOCLEANUP,
                                APR_OS_DEFAULT, r->pool);
             if (rv != APR_SUCCESS) {
                 return rv;
             }
             apr_file_unset_inherit(tmpfile);
             apr_os_file_get(&(mobj->fd), tmpfile);
 
-            obj->cleanup = 0;
-#ifdef USE_ATOMICS
-            (void)apr_atomic_dec(&obj->refcount);
-#else
-            obj->refcount--;    /* Count should be 0 now */
-#endif
-            apr_pool_cleanup_kill(r->pool, obj, decrement_refcount);
-
             /* Open for business */
             obj->complete = 1;
             return APR_SUCCESS;
         }
 
         /* Content not suitable for fd caching. Cache in-memory instead. */
@@ -806,42 +977,73 @@
     /* Iterate accross the brigade and populate the cache storage */
     APR_BRIGADE_FOREACH(e, b) {
         const char *s;
         apr_size_t len;
 
         if (APR_BUCKET_IS_EOS(e)) {
-            obj->cleanup = 0;
-#ifdef USE_ATOMICS
-            (void)apr_atomic_dec(&obj->refcount);
-#else
-            obj->refcount--;    /* Count should be 0 now */
-#endif
-            apr_pool_cleanup_kill(r->pool, obj, decrement_refcount);
-
             /* Open for business */
             obj->complete = 1;
             break;
         }
         rv = apr_bucket_read(e, &s, &len, eblock);
         if (rv != APR_SUCCESS) {
             return rv;
         }
-        /* XXX Check for overflow */
-        if (len ) {
-            memcpy(cur, s, len);
-            cur+=len;
-            obj->count+=len;
+        if (len) {
+            /* Check for buffer overflow */
+           if ((obj->count + len) > mobj->m_len) {
+               return APR_ENOMEM;
+           }
+           else {
+               memcpy(cur, s, len);
+               cur+=len;
+               obj->count+=len;
+           }
         }
         /* This should not happen, but if it does, we are in BIG trouble
          * cause we just stomped all over the heap.
          */
-        AP_DEBUG_ASSERT(obj->count > mobj->m_len);
+        AP_DEBUG_ASSERT(obj->count >= mobj->m_len);
     }
     return APR_SUCCESS;
 }
+/**
+ * Configuration and start-up
+ */
+static int mem_cache_post_config(apr_pool_t *p, apr_pool_t *plog,
+                                 apr_pool_t *ptemp, server_rec *s)
+{
+    int threaded_mpm;
+    ap_mpm_query(AP_MPMQ_IS_THREADED, &threaded_mpm);
+    if (threaded_mpm) {
+        apr_thread_mutex_create(&sconf->lock, APR_THREAD_MUTEX_DEFAULT, p);
+    }
 
+#ifdef USE_ATOMICS
+    apr_atomic_init(p);
+#endif
+    
+    sconf->cache_cache = cache_init(sconf->max_object_cnt,
+                                    sconf->max_cache_size,                                   
+                                    memcache_get_priority,
+                                    sconf->cache_remove_algorithm,
+                                    memcache_get_pos,
+                                    memcache_set_pos,
+                                    memcache_inc_frequency,
+                                    memcache_cache_get_size,
+                                    memcache_cache_get_key,
+                                    memcache_cache_free);
+    apr_pool_cleanup_register(p, sconf, cleanup_cache_mem, apr_pool_cleanup_null);
+
+    if (sconf->cache_cache)
+        return OK;
+
+    return -1;
+
+}
+ 
 static const char 
 *set_max_cache_size(cmd_parms *parms, void *in_struct_ptr, const char *arg)
 {
     apr_size_t val;
 
     if (sscanf(arg, "%d", &val) != 1) {
@@ -881,29 +1083,49 @@
         return "MCacheMaxObjectCount value must be an integer";
     }
     sconf->max_object_cnt = val;
     return NULL;
 }
 
+static const char 
+*set_cache_removal_algorithm(cmd_parms *parms, void *name, const char *arg)
+{
+    if (strcasecmp("LRU", arg)) {
+        sconf->cache_remove_algorithm = memcache_lru_algorithm;
+    }
+    else {
+        if (strcasecmp("GDSF", arg)) {
+            sconf->cache_remove_algorithm = memcache_gdsf_algorithm;
+        }
+        else {
+            return "currently implemented algorithms are LRU and GDSF";
+        }
+    }
+    return NULL;
+}
+
 static const command_rec cache_cmds[] =
 {
     AP_INIT_TAKE1("MCacheSize", set_max_cache_size, NULL, RSRC_CONF,
      "The maximum amount of memory used by the cache in KBytes"),
     AP_INIT_TAKE1("MCacheMaxObjectCount", set_max_object_count, NULL, RSRC_CONF,
      "The maximum number of objects allowed to be placed in the cache"),
     AP_INIT_TAKE1("MCacheMinObjectSize", set_min_cache_object_size, NULL, RSRC_CONF,
      "The minimum size (in bytes) of an object to be placed in the cache"),
     AP_INIT_TAKE1("MCacheMaxObjectSize", set_max_cache_object_size, NULL, RSRC_CONF,
      "The maximum size (in bytes) of an object to be placed in the cache"),
+    AP_INIT_TAKE1("MCacheRemovalAlgorithm", set_cache_removal_algorithm, NULL, RSRC_CONF,
+     "The algorithm used to remove entries from the cache (default: GDSF)"),
     {NULL}
 };
 
 static void register_hooks(apr_pool_t *p)
 {
+    ap_hook_post_config(mem_cache_post_config, NULL, NULL, APR_HOOK_MIDDLE);
     /* cache initializer */
-/*    cache_hook_cache_init(cache_init, NULL, NULL, AP_HOOK_FIRST); */
+    /* cache_hook_init(cache_mem_init, NULL, NULL, APR_HOOK_MIDDLE);  */
     cache_hook_create_entity(create_entity, NULL, NULL, APR_HOOK_MIDDLE);
     cache_hook_open_entity(open_entity,  NULL, NULL, APR_HOOK_MIDDLE);
     cache_hook_remove_url(remove_url, NULL, NULL, APR_HOOK_MIDDLE);
 }
 
 module AP_MODULE_DECLARE_DATA mem_cache_module =
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental: NWGNUdeflate
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUdsk_cach /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUdsk_cach
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUdsk_cach	2002-05-01 06:16:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUdsk_cach	2002-05-08 01:42:28.000000000 +0800
@@ -27,13 +27,12 @@
 			$(AP_WORK)/srclib/include/arch/NetWare \
 			$(AP_WORK)/srclib/apr-util/include \
 			$(AP_WORK)/include \
 			$(AP_WORK)/os/NetWare \
 			$(AP_WORK)/server/mpm/NetWare \
 			$(AP_WORK)/srclib/pcre \
-			../main \
 			$(NWOS) \
 			$(EOLIST)
 
 #
 # These flags will come after CFLAGS
 #
@@ -217,18 +216,13 @@
 # Any additional imports go here
 #
 FILES_nlm_Ximports = \
 	@libc.imp \
 	@$(APR)/aprlib.imp \
 	@httpd.imp \
-	generate_name \
-	ap_cache_hex2usec \
-	ap_cache_usec2hex \
-	cache_hook_create_entity \
-	cache_hook_open_entity \
-	cache_hook_remove_url \
+	@mod_cache.imp \
 	$(EOLIST)
  
 #   
 # Any symbols exported to here
 #
 FILES_nlm_exports = \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmakefile	2002-05-01 06:16:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmakefile	2002-05-08 01:42:28.000000000 +0800
@@ -149,13 +149,12 @@
 XDCDATA         =
 
 #
 # If there is an NLM target, put it here
 #
 TARGET_nlm = \
-	$(OBJDIR)/deflate.nlm \
 	$(OBJDIR)/example.nlm \
 	$(OBJDIR)/mod_cach.nlm \
 	$(OBJDIR)/mem_cach.nlm \
 	$(OBJDIR)/dsk_cach.nlm \
 	$(EOLIST)
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmem_cach /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmem_cach
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmem_cach	2002-05-01 06:16:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmem_cach	2002-06-11 01:24:50.000000000 +0800
@@ -27,13 +27,12 @@
 			$(AP_WORK)/srclib/include/arch/NetWare \
 			$(AP_WORK)/srclib/apr-util/include \
 			$(AP_WORK)/include \
 			$(AP_WORK)/os/NetWare \
 			$(AP_WORK)/server/mpm/NetWare \
 			$(AP_WORK)/srclib/pcre \
-			../main \
 			$(NWOS) \
 			$(EOLIST)
 
 #
 # These flags will come after CFLAGS
 #
@@ -177,12 +176,15 @@
 #
 # These are the OBJ files needed to create the NLM target above.
 # Paths must all use the '/' character
 #
 FILES_nlm_objs = \
 	$(OBJDIR)/mod_mem_cache.o \
+	$(OBJDIR)/cache_hash.o \
+	$(OBJDIR)/cache_pqueue.o \
+	$(OBJDIR)/cache_cache.o \
 	$(EOLIST)
 
 #
 # These are the LIB files needed to create the NLM target above.
 # These will be added as a library command in the link.opt file.
 #
@@ -218,15 +220,13 @@
 # Any additional imports go here
 #
 FILES_nlm_Ximports = \
 	@libc.imp \
 	@$(APR)/aprlib.imp \
 	@httpd.imp \
-	cache_hook_create_entity \
-	cache_hook_open_entity \
-	cache_hook_remove_url \
+	@mod_cache.imp \
 	$(EOLIST)
  
 #   
 # Any symbols exported to here
 #
 FILES_nlm_exports = \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmod_cach /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmod_cach
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/experimental/NWGNUmod_cach	2002-05-01 06:16:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/experimental/NWGNUmod_cach	2002-06-11 01:24:50.000000000 +0800
@@ -227,18 +227,13 @@
 	$(EOLIST)
  
 #   
 # Any symbols exported to here
 #
 FILES_nlm_exports = \
-	generate_name \
-	ap_cache_hex2usec \
-	ap_cache_usec2hex \
-	cache_hook_create_entity \
-	cache_hook_open_entity \
-	cache_hook_remove_url \
+	@mod_cache.imp \
 	cache_module \
 	$(EOLIST)
 	
 #   
 # These are the OBJ files needed to create the LIB target above.
 # Paths must all use the '/' character
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/config.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/config.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/config.m4	2001-05-12 11:48:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/config.m4	2002-05-07 06:23:52.000000000 +0800
@@ -5,7 +5,60 @@
 APACHE_MODPATH_INIT(filters)
 
 APACHE_MODULE(include, Server Side Includes, , , yes)
 
 APR_ADDTO(LT_LDFLAGS,-export-dynamic)
 
+APACHE_MODULE(deflate, Deflate transfer encoding support, , , no, [
+  AC_ARG_WITH(z, APACHE_HELP_STRING(--with-z=DIR,use a specific zlib library),
+  [
+    if test "x$withval" != "xyes" && test "x$withval" != "x"; then
+      ap_zlib_base="$withval"
+    fi
+  ])
+  if test "x$ap_zlib_base" = "x"; then
+    AC_MSG_CHECKING([for zlib location])
+    AC_CACHE_VAL(ap_cv_zlib,[
+      for dir in /usr/local /usr ; do
+        if test -d $dir && test -f $dir/include/zlib.h; then
+          ap_cv_zlib=$dir
+          break
+        fi
+      done
+    ])
+    ap_zlib_base=$ap_cv_zlib
+    if test "x$ap_zlib_base" = "x"; then
+      enable_deflate=no
+      AC_MSG_RESULT([not found])
+    else
+      AC_MSG_RESULT([$ap_zlib_base])
+    fi
+  fi
+  if test "$enable_deflate" != "no"; then
+    ap_save_includes=$INCLUDE
+    ap_save_ldflags=$LDFLAGS
+    ap_save_libs=$LIBS
+    ap_save_cppflags=$CPPFLAGS
+    if test "$ap_zlib_base" != "/usr"; then
+      APR_ADDTO(INCLUDES, [-I${ap_zlib_base}/include])
+      dnl put in CPPFLAGS temporarily so that AC_TRY_LINK below will work
+      CPPFLAGS="$CPPFLAGS -I${ap_zlib_base}/include"
+      APR_ADDTO(LDFLAGS, [-L${ap_zlib_base}/lib])
+      if test "x$ap_platform_runtime_link_flag" != "x"; then
+         APR_ADDTO(LDFLAGS, [$ap_platform_runtime_link_flag${ap_zlib_base}/lib])
+      fi
+    fi
+    APR_ADDTO(LIBS, [-lz])
+    AC_MSG_CHECKING([for zlib library])
+    AC_TRY_LINK([#include <zlib.h>], [return Z_OK;], 
+    [AC_MSG_RESULT(found) 
+     AC_CHECK_HEADERS(zutil.h)],
+    [AC_MSG_RESULT(not found)
+     enable_deflate=no
+     INCLUDES=$ap_save_includes
+     LDFLAGS=$ap_save_ldflags
+     LIBS=$ap_save_libs])
+    CPPFLAGS=$ap_save_cppflags
+  fi
+])
+
 APACHE_MODPATH_FINISH
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters: mod_deflate.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters: mod_deflate.dsp
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters: mod_deflate.exp
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/mod_include.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/mod_include.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/mod_include.c	2002-04-17 21:06:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/mod_include.c	2002-06-15 13:41:48.000000000 +0800
@@ -1072,13 +1072,13 @@
                 expansion = in - 1;
                 if (*in == '{') {
                     ++in;
                     start_of_var_name = in;
                     in = ap_strchr_c(in, '}');
                     if (in == NULL) {
-                        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR,
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR,
                                       0, r, "Missing '}' on variable \"%s\"",
                                       expansion);
                         *next = '\0';
                         return out;
                     }
                     temp_end = in;
@@ -1260,13 +1260,13 @@
                      */
                     if (!is_only_below(parsed_string)) {
                         error_fmt = "unable to include file \"%s\" "
                                     "in parsed file %s";
                     }
                     else {
-                        rr = ap_sub_req_lookup_file(parsed_string, r, f->next);
+                        rr = ap_sub_req_lookup_uri(parsed_string, r, f->next);
                     }
                 }
                 else {
                     rr = ap_sub_req_lookup_uri(parsed_string, r, f->next);
                 }
 
@@ -1333,25 +1333,25 @@
                                          &include_module, r);
 
                 if (!error_fmt && ap_run_sub_req(rr)) {
                     error_fmt = "unable to include \"%s\" in parsed file %s";
                 }
                 if (error_fmt) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|loglevel,
+                    ap_log_rerror(APLOG_MARK, loglevel,
                                   0, r, error_fmt, tag_val, r->filename);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, 
                                         *inserted_head);
                 }
 
                 /* destroy the sub request */
                 if (rr != NULL) {
                     ap_destroy_sub_req(rr);
                 }
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "unknown parameter \"%s\" to tag include in %s",
                             tag, r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
         }
     }
@@ -1422,21 +1422,21 @@
             }
             else if (!strcmp(tag, "encoding")) {
                 if (!strcasecmp(tag_val, "none")) encode = E_NONE;
                 else if (!strcasecmp(tag_val, "url")) encode = E_URL;
                 else if (!strcasecmp(tag_val, "entity")) encode = E_ENTITY;
                 else {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                            "unknown value \"%s\" to parameter \"encoding\" of "
                            "tag echo in %s", tag_val, r->filename);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, 
                                         *inserted_head);
                 }
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "unknown parameter \"%s\" in tag echo of %s",
                             tag, r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
 
         }
@@ -1505,13 +1505,13 @@
                     ctx->flags &= FLAG_SIZE_ABBREV;
                 }
             }
             else {
                 apr_bucket *tmp_buck;
 
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "unknown parameter \"%s\" to tag config in %s",
                               tag, r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
         }
     }
@@ -1557,13 +1557,13 @@
                             "in parsed file %s";
             }
         }
 
         if (error_fmt) {
             ret = -1;
-            ap_log_rerror(APLOG_MARK, APLOG_ERR | (rv ? 0 : APLOG_NOERRNO),
+            ap_log_rerror(APLOG_MARK, APLOG_ERR,
                           rv, r, error_fmt, to_send, r->filename);
         }
 
         if (rr) ap_destroy_sub_req(rr);
         
         return ret;
@@ -1577,22 +1577,22 @@
             memcpy((char *) finfo, (const char *) &rr->finfo,
                    sizeof(rr->finfo));
             ap_destroy_sub_req(rr);
             return 0;
         }
         else {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "unable to get information about \"%s\" "
                         "in parsed file %s",
                         tag_val, r->filename);
             ap_destroy_sub_req(rr);
             return -1;
         }
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                     "unknown parameter \"%s\" to tag %s in %s",
                     tag, directive, r->filename);
         return -1;
     }
 }
 
@@ -1723,13 +1723,13 @@
     regex_t *compiled;
     const apr_size_t nres = sizeof(*ctx->re_result) / sizeof(regmatch_t);
     int regex_error;
 
     compiled = ap_pregcomp(r->pool, rexp, REG_EXTENDED | REG_NOSUB);
     if (compiled == NULL) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "unable to compile pattern \"%s\"", rexp);
         return -1;
     }
     if (!ctx->re_result) {
         ctx->re_result = apr_pcalloc(r->pool, sizeof(*ctx->re_result));
     }
@@ -1887,18 +1887,22 @@
                 }
             }
             else {
                 if (ch == qs) {
                     qs = 0;
                     tkn_fnd = 1;
+                    string++;
                 }
                 else {
                     token->value[next++] = ch;
                 }
             }
         }
+        if (tkn_fnd) {
+            break;
+        }
     }
 
     /* If qs is still set, we have an unmatched quote */
     if (qs) {
         *unmatched = 1;
         next = 0;
@@ -1975,13 +1979,13 @@
             case token_le:
             case token_lt:
                 new->parent = current;
                 current = current->right = new;
                 break;
             default:
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid expression \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             break;
@@ -2004,13 +2008,13 @@
             case token_lbrace:
             case token_not:
                 new->parent = current;
                 current = current->right = new;
                 break;
             default:
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid expression \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             break;
@@ -2020,13 +2024,13 @@
 #ifdef DEBUG_INCLUDE
             memcpy (&debug[debug_pos], "     Token: and/or\n",
                     sizeof ("     Token: and/or\n"));
             debug_pos += sizeof ("     Token: and/or\n");
 #endif
             if (current == (struct parse_node *) NULL) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid expression \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             /* Percolate upwards */
@@ -2046,13 +2050,13 @@
                 case token_lt:
                     current = current->parent;
                     continue;
                 case token_lbrace:
                     break;
                 default:
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                 "Invalid expression \"%s\" in file %s",
                                 expr, r->filename);
                     *was_error = 1;
                     return retval;
                 }
                 break;
@@ -2093,13 +2097,13 @@
                 case token_ge:
                 case token_gt:
                 case token_le:
                 case token_lt:
                     break;
                 default:
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "Invalid expression \"%s\" in file %s",
                                   expr, r->filename);
                     *was_error = 1;
                     return retval;
                 }
                 break;
@@ -2127,13 +2131,13 @@
 #ifdef DEBUG_INCLUDE
             memcpy(&debug[debug_pos], "     Token: eq/ne/ge/gt/le/lt\n",
                     sizeof("     Token: eq/ne/ge/gt/le/lt\n"));
             debug_pos += sizeof("     Token: eq/ne/ge/gt/le/lt\n");
 #endif
             if (current == (struct parse_node *) NULL) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "Invalid expression \"%s\" in file %s",
                               expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             /* Percolate upwards */
@@ -2153,13 +2157,13 @@
                 case token_ne:
                 case token_ge:
                 case token_gt:
                 case token_le:
                 case token_lt:
                 default:
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                 "Invalid expression \"%s\" in file %s",
                                 expr, r->filename);
                     *was_error = 1;
                     return retval;
                 }
                 break;
@@ -2189,13 +2193,13 @@
                     current->token.type = token_group;
                     break;
                 }
                 current = current->parent;
             }
             if (current == (struct parse_node *) NULL) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Unmatched ')' in \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             break;
@@ -2225,13 +2229,13 @@
                 case token_lt:
                     break;
                 case token_string:
                 case token_re:
                 case token_group:
                 default:
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                 "Invalid expression \"%s\" in file %s",
                                 expr, r->filename);
                     *was_error = 1;
                     return retval;
                 }
                 break;
@@ -2270,13 +2274,13 @@
             current->value = (current->token.value[0] != '\0');
             current->done = 1;
             current = current->parent;
             break;
 
         case token_re:
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "No operator before regex of expr \"%s\" in file %s",
                           expr, r->filename);
             *was_error = 1;
             return retval;
 
         case token_and:
@@ -2285,13 +2289,13 @@
             memcpy(&debug[debug_pos], "     Evaluate and/or\n",
                     sizeof("     Evaluate and/or\n"));
             debug_pos += sizeof("     Evaluate and/or\n");
 #endif
             if (current->left  == (struct parse_node *) NULL ||
                 current->right == (struct parse_node *) NULL) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "Invalid expression \"%s\" in file %s",
                               expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             if (!current->left->done) {
@@ -2353,13 +2357,13 @@
 #endif
             if ((current->left == (struct parse_node *) NULL) ||
                 (current->right == (struct parse_node *) NULL) ||
                 (current->left->token.type != token_string) ||
                 ((current->right->token.type != token_string) &&
                  (current->right->token.type != token_re))) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid expression \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             buffer = ap_ssi_parse_string(r, ctx, current->left->token.value,
@@ -2410,13 +2414,13 @@
             debug_pos += sizeof ("     Evaluate ge/gt/le/lt\n");
 #endif
             if ((current->left == (struct parse_node *) NULL) ||
                 (current->right == (struct parse_node *) NULL) ||
                 (current->left->token.type != token_string) ||
                 (current->right->token.type != token_string)) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid expression \"%s\" in file %s",
                             expr, r->filename);
                 *was_error = 1;
                 return retval;
             }
             buffer = ap_ssi_parse_string(r, ctx, current->left->token.value,
@@ -2493,27 +2497,27 @@
 #endif
             current->done = 1;
             current = current->parent;
             break;
 
         case token_lbrace:
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "Unmatched '(' in \"%s\" in file %s",
                         expr, r->filename);
             *was_error = 1;
             return retval;
 
         case token_rbrace:
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "Unmatched ')' in \"%s\" in file %s",
                         expr, r->filename);
             *was_error = 1;
             return retval;
 
         default:
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "bad token type");
             *was_error = 1;
             return retval;
         }
     }
 
@@ -2572,21 +2576,21 @@
     char *expr    = NULL;
     int   expr_ret, was_error, was_unmatched;
     apr_bucket *tmp_buck;
     char debug_buf[MAX_DEBUG_SIZE];
 
     *inserted_head = NULL;
-    if (!ctx->flags & FLAG_PRINTING) {
+    if (!(ctx->flags & FLAG_PRINTING)) {
         ctx->if_nesting_level++;
     }
     else {
         while (1) {
             ap_ssi_get_tag_and_value(ctx, &tag, &tag_val, 0);
             if (tag == NULL) {
                 if (expr == NULL) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "missing expr in if statement: %s", 
                                   r->filename);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, 
                                         *inserted_head);
                     return 1;
                 }
@@ -2629,13 +2633,13 @@
                         *inserted_head = tmp_buck;
                     }
                 }
 #endif
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "unknown parameter \"%s\" to tag if in %s", tag, 
                             r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
 
         }
@@ -2664,13 +2668,13 @@
                 
                 if (ctx->flags & FLAG_COND_TRUE) {
                     ctx->flags &= FLAG_CLEAR_PRINTING;
                     return (0);
                 }
                 if (expr == NULL) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "missing expr in elif statement: %s", 
                                   r->filename);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, 
                                         *inserted_head);
                     return (1);
                 }
@@ -2712,13 +2716,13 @@
                         *inserted_head = tmp_buck;
                     }
                 }
 #endif
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                "unknown parameter \"%s\" to tag if in %s", tag, 
                                r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
         }
     }
@@ -2734,13 +2738,13 @@
     apr_bucket *tmp_buck;
 
     *inserted_head = NULL;
     if (!ctx->if_nesting_level) {
         ap_ssi_get_tag_and_value(ctx, &tag, &tag_val, 1);
         if ((tag != NULL) || (tag_val != NULL)) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "else directive does not take tags in %s", r->filename);
             if (ctx->flags & FLAG_PRINTING) {
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             }
             return -1;
         }
@@ -2768,13 +2772,13 @@
     apr_bucket *tmp_buck;
 
     *inserted_head = NULL;
     if (!ctx->if_nesting_level) {
         ap_ssi_get_tag_and_value(ctx, &tag, &tag_val, 1);
         if ((tag != NULL) || (tag_val != NULL)) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                        "endif directive does not take tags in %s", r->filename);
             CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             return -1;
         }
         else {
             LOG_COND_STATUS(ctx, tmp_buck, head_ptr, *inserted_head, "endif");
@@ -2821,26 +2825,26 @@
             else if (!strcmp(tag, "var")) {
                 var = ap_ssi_parse_string(r, ctx, tag_val, NULL,
                                           MAX_STRING_LEN, 0);
             }
             else if (!strcmp(tag, "value")) {
                 if (var == (char *) NULL) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                            "variable must precede value in set directive in %s",
                            r->filename);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, 
                                         *inserted_head);
                     return (-1);
                 }
                 parsed_string = ap_ssi_parse_string(r, ctx, tag_val, NULL, 
                                                     MAX_STRING_LEN, 0);
                 apr_table_setn(r->subprocess_env, apr_pstrdup(p, var),
                                apr_pstrdup(p, parsed_string));
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "Invalid tag for set directive in %s", r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
                 return -1;
             }
         }
     }
@@ -2893,13 +2897,13 @@
                     *inserted_head = tmp_buck;
                 }
             }
             return 0;
         }
         else {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "printenv directive does not take tags in %s", 
                         r->filename);
             CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
             return -1;
         }
     }
@@ -3059,13 +3063,13 @@
             /* At this point, everything between ctx->head_start_bucket and
              * ctx->tail_start_bucket is an SSI
              * directive, we just have to deal with it now.
              */
             if (get_combined_directive(ctx, r, *bb, tmp_buf,
                                         TMP_BUF_SIZE) != APR_SUCCESS) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                             "mod_include: error copying directive in %s",
                             r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_bkt, dptr, content_head);
 
                 /* DO CLEANUP HERE!!!!! */
                 tmp_dptr = ctx->head_start_bucket;
@@ -3109,13 +3113,13 @@
                 rv = (*handle_func)(ctx, bb, r, f, dptr, &content_head);
                 if ((rv != 0) && (rv != 1)) {
                     return (rv);
                 }
             }
             else {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "unknown directive \"%s\" in parsed doc %s",
                               ctx->combined_tag, r->filename);
                 CREATE_ERROR_BUCKET(ctx, tmp_bkt, dptr, content_head);
             }
 
             /* This chunk of code starts at the first bucket in the chain
@@ -3214,13 +3218,13 @@
             }
             ctx->bytes_parsed = 0;
         }
     }
     else if (ctx->state == PARSED) {         /* Invalid internal condition... */
         apr_bucket *content_head = NULL, *tmp_bkt;
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Invalid mod_include state during file %s", r->filename);
         CREATE_ERROR_BUCKET(ctx, tmp_bkt, APR_BRIGADE_FIRST(*bb), content_head);
     }
     else {                    /* Entire brigade is middle chunk of SSI tag... */
         if (!APR_BRIGADE_EMPTY(ctx->ssi_tag_brigade)) {
             APR_BRIGADE_CONCAT(ctx->ssi_tag_brigade, *bb);
@@ -3346,18 +3350,12 @@
         /* we're not a nested include, so we create an initial
          * environment */
         ap_add_common_vars(r);
         ap_add_cgi_vars(r);
         add_include_vars(r, conf->default_time_fmt);
     }
-    /* XXX: this is bogus, at some point we're going to do a subrequest,
-     * and when we do it we're going to be subjecting code that doesn't
-     * expect to be signal-ready to SIGALRM.  There is no clean way to
-     * fix this, except to put alarm support into BUFF. -djg
-     */
-
     /* Always unset the content-length.  There is no way to know if
      * the content will be modified at some point by send_parsed_content.
      * It is very possible for us to not find any content in the first
      * 9k of the file, but still have to modify the content of the file.
      * If we are going to pass the file through send_parsed_content, then
      * the content-length should just be unset.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/mod_include.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/mod_include.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters/mod_include.h	2002-03-29 16:17:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters/mod_include.h	2002-06-06 12:58:43.000000000 +0800
@@ -57,12 +57,13 @@
  */
 
 #ifndef _MOD_INCLUDE_H
 #define _MOD_INCLUDE_H 1
 
 #include "apr_pools.h"
+#include "apr_optional.h"
 
 #define STARTING_SEQUENCE "<!--#"
 #define ENDING_SEQUENCE "-->"
 
 #define DEFAULT_ERROR_MSG "[an error occurred while processing this directive]"
 #define DEFAULT_TIME_FORMAT "%A, %d-%b-%Y %H:%M:%S %Z"
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/filters: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/filters: NWGNUmakefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_asis.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_asis.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_asis.c	2002-03-29 16:17:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_asis.c	2002-05-17 19:33:09.000000000 +0800
@@ -81,13 +81,13 @@
 	return DECLINED;
 
     r->allowed |= (AP_METHOD_BIT << M_GET);
     if (r->method_number != M_GET)
 	return DECLINED;
     if (r->finfo.filetype == 0) {
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    "File does not exist: %s", r->filename);
 	return HTTP_NOT_FOUND;
     }
 
     if ((rv = apr_file_open(&f, r->filename, APR_READ, 
                 APR_OS_DEFAULT, r->pool)) != APR_SUCCESS) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_autoindex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_autoindex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_autoindex.c	2002-04-22 03:10:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_autoindex.c	2002-06-01 04:50:14.000000000 +0800
@@ -582,13 +582,13 @@
                   "a filename"),
     AP_INIT_TAKE1("ReadmeName", add_readme, NULL, DIR_CMD_PERMS,
                   "a filename"),
     AP_INIT_RAW_ARGS("FancyIndexing", ap_set_deprecated, NULL, OR_ALL,
                  "The FancyIndexing directive is no longer supported.  Use IndexOptions FancyIndexing."),
     AP_INIT_TAKE1("DefaultIcon", ap_set_string_slot,
-                  (void *) APR_XtOffsetOf(autoindex_config_rec, default_icon),
+                  (void *)APR_OFFSETOF(autoindex_config_rec, default_icon),
                   DIR_CMD_PERMS, "an icon URL"),
     {NULL}
 };
 
 static void *create_autoindex_config(apr_pool_t *p, char *dummy)
 {
@@ -2130,24 +2130,30 @@
         return DECLINED;
     }
 
     /* OK, nothing easy.  Trot out the heavy artillery... */
 
     if (allow_opts & OPT_INDEXES) {
+        int errstatus;
+
+        if ((errstatus = ap_discard_request_body(r)) != OK) {
+            return errstatus;
+        }
+
         /* KLUDGE --- make the sub_req lookups happen in the right directory.
          * Fixing this in the sub_req_lookup functions themselves is difficult,
          * and would probably break virtual includes...
          */
 
         if (r->filename[strlen(r->filename) - 1] != '/') {
             r->filename = apr_pstrcat(r->pool, r->filename, "/", NULL);
         }
         return index_directory(r, d);
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Directory index forbidden by rule: %s", r->filename);
         return HTTP_FORBIDDEN;
     }
 }
 
 static void register_hooks(apr_pool_t *p)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgi.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgi.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgi.c	2002-04-22 16:08:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgi.c	2002-06-13 14:36:40.000000000 +0800
@@ -90,35 +90,21 @@
 #include "http_protocol.h"
 #include "http_main.h"
 #include "http_log.h"
 #include "util_script.h"
 #include "ap_mpm.h"
 #include "mod_core.h"
-#include "../filters/mod_include.h"
 #include "mod_cgi.h"
 
 module AP_MODULE_DECLARE_DATA cgi_module;
 
 static APR_OPTIONAL_FN_TYPE(ap_register_include_handler) *cgi_pfn_reg_with_ssi;
 static APR_OPTIONAL_FN_TYPE(ap_ssi_get_tag_and_value) *cgi_pfn_gtv;
 static APR_OPTIONAL_FN_TYPE(ap_ssi_parse_string) *cgi_pfn_ps;
 static APR_OPTIONAL_FN_TYPE(ap_cgi_build_command) *cgi_build_command;
 
-typedef enum {RUN_AS_SSI, RUN_AS_CGI} prog_types;
-
-typedef struct {
-    apr_int32_t          in_pipe;
-    apr_int32_t          out_pipe;
-    apr_int32_t          err_pipe;
-    apr_cmdtype_e        cmd_type;
-    prog_types           prog_type;
-    apr_bucket_brigade **bb;
-    include_ctx_t       *ctx;
-    ap_filter_t         *next;
-} exec_info;
-
 /* Read and discard the data in the brigade produced by a CGI script */
 static void discard_script_output(apr_bucket_brigade *bb);
 
 /* KLUDGE --- for back-combatibility, we don't have to check ExecCGI
  * in ScriptAliased directories, which means we need to know if this
  * request came through ScriptAlias or not... so the Alias module
@@ -135,14 +121,14 @@
 
 #define DEFAULT_LOGBYTES 10385760
 #define DEFAULT_BUFBYTES 1024
 
 typedef struct {
     const char *logname;
-    long logbytes;
-    int bufbytes;
+    long        logbytes;
+    apr_size_t  bufbytes;
 } cgi_server_conf;
 
 static void *create_cgi_config(apr_pool_t *p, server_rec *s)
 {
     cgi_server_conf *c =
     (cgi_server_conf *) apr_pcalloc(p, sizeof(cgi_server_conf));
@@ -153,13 +139,14 @@
 
     return c;
 }
 
 static void *merge_cgi_config(apr_pool_t *p, void *basev, void *overridesv)
 {
-    cgi_server_conf *base = (cgi_server_conf *) basev, *overrides = (cgi_server_conf *) overridesv;
+    cgi_server_conf *base = (cgi_server_conf *) basev,
+                    *overrides = (cgi_server_conf *) overridesv;
 
     return overrides->logname ? overrides : base;
 }
 
 static const char *set_scriptlog(cmd_parms *cmd, void *dummy, const char *arg)
 {
@@ -213,32 +200,32 @@
 static int log_scripterror(request_rec *r, cgi_server_conf * conf, int ret,
 			   apr_status_t rv, char *error)
 {
     apr_file_t *f = NULL;
     apr_finfo_t finfo;
     char time_str[APR_CTIME_LEN];
-    int log_flags = rv ? APLOG_ERR : APLOG_NOERRNO | APLOG_ERR;
+    int log_flags = rv ? APLOG_ERR : APLOG_ERR;
 
     ap_log_rerror(APLOG_MARK, log_flags, rv, r, 
                   "%s: %s", error, r->filename);
 
     /* XXX Very expensive mainline case! Open, then getfileinfo! */
     if (!conf->logname ||
         ((apr_stat(&finfo, conf->logname,
-                   APR_FINFO_SIZE, r->pool) == APR_SUCCESS)
-         &&  (finfo.size > conf->logbytes)) ||
-          (apr_file_open(&f, conf->logname,
-                   APR_APPEND|APR_WRITE|APR_CREATE, APR_OS_DEFAULT, r->pool)
-              != APR_SUCCESS)) {
+                   APR_FINFO_SIZE, r->pool) == APR_SUCCESS) &&
+         (finfo.size > conf->logbytes)) ||
+        (apr_file_open(&f, conf->logname,
+                       APR_APPEND|APR_WRITE|APR_CREATE, APR_OS_DEFAULT,
+                       r->pool) != APR_SUCCESS)) {
 	return ret;
     }
 
     /* "%% [Wed Jun 19 10:53:21 1996] GET /cgi-bin/printenv HTTP/1.0" */
     apr_ctime(time_str, apr_time_now());
     apr_file_printf(f, "%%%% [%s] %s %s%s%s %s\n", time_str, r->method, r->uri,
-	    r->args ? "?" : "", r->args ? r->args : "", r->protocol);
+                    r->args ? "?" : "", r->args ? r->args : "", r->protocol);
     /* "%% 500 /usr/local/apache/cgi-bin */
     apr_file_printf(f, "%%%% %d %s\n", ret, r->filename);
 
     apr_file_printf(f, "%%error\n%s\n", error);
 
     apr_file_close(f);
@@ -255,20 +242,20 @@
     while (apr_file_gets(argsbuffer, HUGE_STRING_LEN,
                          script_err) == APR_SUCCESS) {
         newline = strchr(argsbuffer, '\n');
         if (newline) {
             *newline = '\0';
         }
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r, 
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, 
                       "%s", argsbuffer);            
     }
 }
 
 static int log_script(request_rec *r, cgi_server_conf * conf, int ret,
-		  char *dbuf, const char *sbuf, apr_bucket_brigade *bb, 
-                  apr_file_t *script_err)
+                      char *dbuf, const char *sbuf, apr_bucket_brigade *bb, 
+                      apr_file_t *script_err)
 {
     const apr_array_header_t *hdrs_arr = apr_table_elts(r->headers_in);
     const apr_table_entry_t *hdrs = (const apr_table_entry_t *) hdrs_arr->elts;
     char argsbuffer[HUGE_STRING_LEN];
     apr_file_t *f = NULL;
     apr_bucket *e;
@@ -280,37 +267,38 @@
     apr_finfo_t finfo;
     char time_str[APR_CTIME_LEN];
 
     /* XXX Very expensive mainline case! Open, then getfileinfo! */
     if (!conf->logname ||
         ((apr_stat(&finfo, conf->logname,
-                   APR_FINFO_SIZE, r->pool) == APR_SUCCESS)
-         &&  (finfo.size > conf->logbytes)) ||
-         (apr_file_open(&f, conf->logname,
-                  APR_APPEND|APR_WRITE|APR_CREATE, APR_OS_DEFAULT, r->pool) != APR_SUCCESS)) {
+                   APR_FINFO_SIZE, r->pool) == APR_SUCCESS) &&
+         (finfo.size > conf->logbytes)) ||
+        (apr_file_open(&f, conf->logname,
+                       APR_APPEND|APR_WRITE|APR_CREATE, APR_OS_DEFAULT,
+                       r->pool) != APR_SUCCESS)) {
 	/* Soak up script output */
         discard_script_output(bb);
         log_script_err(r, script_err);
 	return ret;
     }
 
     /* "%% [Wed Jun 19 10:53:21 1996] GET /cgi-bin/printenv HTTP/1.0" */
     apr_ctime(time_str, apr_time_now());
     apr_file_printf(f, "%%%% [%s] %s %s%s%s %s\n", time_str, r->method, r->uri,
-	    r->args ? "?" : "", r->args ? r->args : "", r->protocol);
+                    r->args ? "?" : "", r->args ? r->args : "", r->protocol);
     /* "%% 500 /usr/local/apache/cgi-bin" */
     apr_file_printf(f, "%%%% %d %s\n", ret, r->filename);
 
     apr_file_puts("%request\n", f);
     for (i = 0; i < hdrs_arr->nelts; ++i) {
 	if (!hdrs[i].key)
 	    continue;
 	apr_file_printf(f, "%s: %s\n", hdrs[i].key, hdrs[i].val);
     }
-    if ((r->method_number == M_POST || r->method_number == M_PUT)
-	&& *dbuf) {
+    if ((r->method_number == M_POST || r->method_number == M_PUT) &&
+        *dbuf) {
 	apr_file_printf(f, "\n%s\n", dbuf);
     }
 
     apr_file_puts("%response\n", f);
     hdrs_arr = apr_table_elts(r->err_headers_out);
     hdrs = (const apr_table_entry_t *) hdrs_arr->elts;
@@ -327,13 +315,13 @@
     first = 1;
     APR_BRIGADE_FOREACH(e, bb) {
         if (APR_BUCKET_IS_EOS(e)) {
             break;
         }
         rv = apr_bucket_read(e, &buf, &len, APR_BLOCK_READ);
-        if (!APR_STATUS_IS_SUCCESS(rv) || (len == 0)) {
+        if (rv != APR_SUCCESS || (len == 0)) {
             break;
         }
         if (first) {
             apr_file_puts("%stdout\n", f);
             first = 0;
         }
@@ -342,14 +330,15 @@
     }
 
     if (apr_file_gets(argsbuffer, HUGE_STRING_LEN, script_err) == APR_SUCCESS) {
 	apr_file_puts("%stderr\n", f);
 	apr_file_puts(argsbuffer, f);
 	while (apr_file_gets(argsbuffer, HUGE_STRING_LEN,
-	                     script_err) == APR_SUCCESS)
+                             script_err) == APR_SUCCESS) {
 	    apr_file_puts(argsbuffer, f);
+        }
 	apr_file_puts("\n", f);
     }
 
     apr_brigade_destroy(bb);
     apr_file_close(script_err);
 
@@ -365,39 +354,43 @@
 {
     apr_table_t *e = r->subprocess_env;
 
     if (r->path_info && r->path_info[0] != '\0') {
         request_rec *pa_req;
 
-        apr_table_setn(e, "PATH_INFO", ap_escape_shell_cmd(r->pool, r->path_info));
+        apr_table_setn(e, "PATH_INFO", ap_escape_shell_cmd(r->pool,
+                                                           r->path_info));
 
-        pa_req = ap_sub_req_lookup_uri(ap_escape_uri(r->pool, r->path_info), r, next);
+        pa_req = ap_sub_req_lookup_uri(ap_escape_uri(r->pool, r->path_info),
+                                       r, next);
         if (pa_req->filename) {
             apr_table_setn(e, "PATH_TRANSLATED",
-                           apr_pstrcat(r->pool, pa_req->filename, pa_req->path_info, NULL));
+                           apr_pstrcat(r->pool, pa_req->filename,
+                                       pa_req->path_info, NULL));
         }
         ap_destroy_sub_req(pa_req);
     }
 
     if (r->args) {
         char *arg_copy = apr_pstrdup(r->pool, r->args);
 
         apr_table_setn(e, "QUERY_STRING", r->args);
         ap_unescape_url(arg_copy);
-        apr_table_setn(e, "QUERY_STRING_UNESCAPED", ap_escape_shell_cmd(r->pool, arg_copy));
+        apr_table_setn(e, "QUERY_STRING_UNESCAPED",
+                       ap_escape_shell_cmd(r->pool, arg_copy));
     }
 }
 
 static apr_status_t run_cgi_child(apr_file_t **script_out,
                                   apr_file_t **script_in,
                                   apr_file_t **script_err, 
                                   const char *command,
                                   const char * const argv[],
                                   request_rec *r,
                                   apr_pool_t *p,
-                                  exec_info *e_info)
+                                  cgi_exec_info_t *e_info)
 {
     const char * const *env;
     apr_procattr_t *procattr;
     apr_proc_t *procnew;
     apr_status_t rc = APR_SUCCESS;
 
@@ -442,84 +435,95 @@
 
     /* Transmute ourselves into the script.
      * NB only ISINDEX scripts get decoded arguments.
      */
     if (((rc = apr_procattr_create(&procattr, p)) != APR_SUCCESS) ||
         ((rc = apr_procattr_io_set(procattr,
-                                  e_info->in_pipe,
-                                  e_info->out_pipe,
-                                  e_info->err_pipe)) != APR_SUCCESS) ||
+                                   e_info->in_pipe,
+                                   e_info->out_pipe,
+                                   e_info->err_pipe)) != APR_SUCCESS) ||
         ((rc = apr_procattr_dir_set(procattr, 
-                                  ap_make_dirstr_parent(r->pool, r->filename))) != APR_SUCCESS) ||
+                        ap_make_dirstr_parent(r->pool,
+                                              r->filename))) != APR_SUCCESS) ||
 #ifdef RLIMIT_CPU
-        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_CPU, conf->limit_cpu)) != APR_SUCCESS) ||
+        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_CPU,
+                                      conf->limit_cpu)) != APR_SUCCESS) ||
 #endif
 #if defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_AS)
-        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_MEM, conf->limit_mem)) != APR_SUCCESS) ||
+        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_MEM,
+                                      conf->limit_mem)) != APR_SUCCESS) ||
 #endif
 #ifdef RLIMIT_NPROC
-        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_NPROC, conf->limit_nproc)) != APR_SUCCESS) ||
+        ((rc = apr_procattr_limit_set(procattr, APR_LIMIT_NPROC,
+                                      conf->limit_nproc)) != APR_SUCCESS) ||
 #endif
-        ((rc = apr_procattr_cmdtype_set(procattr, e_info->cmd_type)) != APR_SUCCESS)) {
+        ((rc = apr_procattr_cmdtype_set(procattr,
+                                        e_info->cmd_type)) != APR_SUCCESS) ||
+
+        ((rc = apr_procattr_detach_set(procattr,
+                                        e_info->detached)) != APR_SUCCESS)) {
         /* Something bad happened, tell the world. */
 	ap_log_rerror(APLOG_MARK, APLOG_ERR, rc, r,
 		      "couldn't set child process attributes: %s", r->filename);
     }
     else {
         procnew = apr_pcalloc(p, sizeof(*procnew));
         if (e_info->prog_type == RUN_AS_SSI) {
-            SPLIT_AND_PASS_PRETAG_BUCKETS(*(e_info->bb), e_info->ctx, e_info->next, rc);
+            SPLIT_AND_PASS_PRETAG_BUCKETS(*(e_info->bb), e_info->ctx,
+                                          e_info->next, rc);
             if (rc != APR_SUCCESS) {
                 return rc;
             }
         }
 
-        rc = ap_os_create_privileged_process(r, procnew, command, argv, env, procattr, p);
+        rc = ap_os_create_privileged_process(r, procnew, command, argv, env,
+                                             procattr, p);
     
         if (rc != APR_SUCCESS) {
             /* Bad things happened. Everyone should have cleaned up. */
             ap_log_rerror(APLOG_MARK, APLOG_ERR, rc, r,
-                        "couldn't create child process: %d: %s", rc, r->filename);
+                          "couldn't create child process: %d: %s", rc,
+                          r->filename);
         }
         else {
             apr_pool_note_subprocess(p, procnew, APR_KILL_AFTER_TIMEOUT);
 
             *script_in = procnew->out;
             if (!*script_in)
                 return APR_EBADF;
-            apr_file_pipe_timeout_set(*script_in, (int)(r->server->timeout * APR_USEC_PER_SEC));
+            apr_file_pipe_timeout_set(*script_in, r->server->timeout);
 
             if (e_info->prog_type == RUN_AS_CGI) {
                 *script_out = procnew->in;
                 if (!*script_out)
                     return APR_EBADF;
-                apr_file_pipe_timeout_set(*script_out, (int)(r->server->timeout * APR_USEC_PER_SEC));
+                apr_file_pipe_timeout_set(*script_out, r->server->timeout);
 
                 *script_err = procnew->err;
                 if (!*script_err)
                     return APR_EBADF;
-                apr_file_pipe_timeout_set(*script_err, (int)(r->server->timeout * APR_USEC_PER_SEC));
+                apr_file_pipe_timeout_set(*script_err, r->server->timeout);
             }
         }
     }
 #ifdef DEBUG_CGI
     fclose(dbg);
 #endif
     return (rc);
 }
 
 
 static apr_status_t default_build_command(const char **cmd, const char ***argv,
                                           request_rec *r, apr_pool_t *p,
-                                          int process_cgi, apr_cmdtype_e * type)
+                                          cgi_exec_info_t *e_info)
 {
     int numwords, x, idx;
     char *w;
     const char *args = NULL;
 
-    if (process_cgi) {
+    if (e_info->process_cgi) {
         /* Allow suexec's "/" check to succeed */
         const char *argv0 = strrchr(r->filename, '/');
         if (argv0 != NULL)
             argv0++;
         else
             argv0 = r->filename;
@@ -544,13 +548,13 @@
         }
     }
     /* Everything is - 1 to account for the first parameter 
      * which is the program name.
      */ 
     if (numwords > APACHE_ARG_MAX - 1) {
-        numwords = APACHE_ARG_MAX - 1;	/* Truncate args to prevent overrun */
+        numwords = APACHE_ARG_MAX - 1;    /* Truncate args to prevent overrun */
     }
     *argv = apr_palloc(p, (numwords + 2) * sizeof(char *));
     (*argv)[0] = *cmd;
     for (x = 1, idx = 1; x < numwords; x++) {
         w = ap_getword_nulls(p, &args, '+');
         ap_unescape_url(w);
@@ -569,36 +573,37 @@
     apr_status_t rv;
     APR_BRIGADE_FOREACH(e, bb) {
         if (APR_BUCKET_IS_EOS(e)) {
             break;
         }
         rv = apr_bucket_read(e, &buf, &len, APR_BLOCK_READ);
-        if (!APR_STATUS_IS_SUCCESS(rv)) {
+        if (rv != APR_SUCCESS) {
             break;
         }
     }
 }
 
 static int cgi_handler(request_rec *r)
 {
-    int retval, nph, dbpos = 0;
+    int nph;
+    apr_size_t dbpos = 0;
     const char *argv0;
     const char *command;
     const char **argv;
     char *dbuf = NULL;
     apr_file_t *script_out = NULL, *script_in = NULL, *script_err = NULL;
     apr_bucket_brigade *bb;
     apr_bucket *b;
-    char argsbuffer[HUGE_STRING_LEN];
     int is_included;
+    int seen_eos, child_stopped_reading;
     apr_pool_t *p;
     cgi_server_conf *conf;
     apr_status_t rv;
-    exec_info e_info;
+    cgi_exec_info_t e_info;
 
-    if(strcmp(r->handler,CGI_MAGIC_TYPE) && strcmp(r->handler,"cgi-script"))
+    if(strcmp(r->handler, CGI_MAGIC_TYPE) && strcmp(r->handler, "cgi-script"))
 	return DECLINED;
 
     is_included = !strcmp(r->protocol, "INCLUDED");
 
     p = r->main ? r->main->pool : r->pool;
 
@@ -639,29 +644,27 @@
 	if (!ap_can_exec(&r->finfo))
 	    return log_scripterror(r, conf, HTTP_FORBIDDEN, 0,
 				   "file permissions deny server execution");
     }
 
 */
-    if ((retval = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR)))
-	return retval;
-
     ap_add_common_vars(r);
 
-    e_info.cmd_type  = APR_PROGRAM;
-    e_info.in_pipe   = APR_CHILD_BLOCK;
-    e_info.out_pipe  = APR_CHILD_BLOCK;
-    e_info.err_pipe  = APR_CHILD_BLOCK;
-    e_info.prog_type = RUN_AS_CGI;
-    e_info.bb        = NULL;
-    e_info.ctx       = NULL;
-    e_info.next      = NULL;
+    e_info.process_cgi = 1;
+    e_info.cmd_type    = APR_PROGRAM;
+    e_info.detached    = 0;
+    e_info.in_pipe     = APR_CHILD_BLOCK;
+    e_info.out_pipe    = APR_CHILD_BLOCK;
+    e_info.err_pipe    = APR_CHILD_BLOCK;
+    e_info.prog_type   = RUN_AS_CGI;
+    e_info.bb          = NULL;
+    e_info.ctx         = NULL;
+    e_info.next        = NULL;
 
     /* build the command line */
-    if ((rv = cgi_build_command(&command, &argv, r, p, 1, &e_info.cmd_type)) 
-            != APR_SUCCESS) {
+    if ((rv = cgi_build_command(&command, &argv, r, p, &e_info)) != APR_SUCCESS) {
 	ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
 		      "don't know how to spawn child process: %s", 
                       r->filename);
 	return HTTP_INTERNAL_SERVER_ERROR;
     }
 
@@ -673,66 +676,92 @@
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     /* Transfer any put/post args, CERN style...
      * Note that we already ignore SIGPIPE in the core server.
      */
-    if (ap_should_client_block(r)) {
-	int len_read, dbsize;
-        apr_size_t bytes_written, bytes_to_write;
-        apr_status_t rv;
-
-	if (conf->logname) {
-	    dbuf = apr_pcalloc(r->pool, conf->bufbytes + 1);
-	    dbpos = 0;
-	}
+    bb = apr_brigade_create(r->pool, r->connection->bucket_alloc);
+    seen_eos = 0;
+    child_stopped_reading = 0;
+    if (conf->logname) {
+        dbuf = apr_palloc(r->pool, conf->bufbytes + 1);
+        dbpos = 0;
+    }
+    do {
+        apr_bucket *bucket;
+
+        rv = ap_get_brigade(r->input_filters, bb, AP_MODE_READBYTES,
+                            APR_BLOCK_READ, HUGE_STRING_LEN);
+       
+        if (rv != APR_SUCCESS) {
+            return rv;
+        }
+
+        APR_BRIGADE_FOREACH(bucket, bb) {
+            const char *data;
+            apr_size_t len;
+
+            if (APR_BUCKET_IS_EOS(bucket)) {
+                seen_eos = 1;
+                break;
+            }
 
-	while ((len_read =
-		ap_get_client_block(r, argsbuffer, HUGE_STRING_LEN)) > 0) {
-	    if (conf->logname) {
-		if ((dbpos + len_read) > conf->bufbytes) {
-		    dbsize = conf->bufbytes - dbpos;
+            /* We can't do much with this. */
+            if (APR_BUCKET_IS_FLUSH(bucket)) {
+                continue;
+            }
+
+            /* If the child stopped, we still must read to EOS. */
+            if (child_stopped_reading) {
+                continue;
+            } 
+
+            /* read */
+            apr_bucket_read(bucket, &data, &len, APR_BLOCK_READ);
+            
+            if (conf->logname && dbpos < conf->bufbytes) {
+                int cursize;
+
+                if ((dbpos + len) > conf->bufbytes) {
+                    cursize = conf->bufbytes - dbpos;
 		}
 		else {
-		    dbsize = len_read;
+                    cursize = len;
 		}
-		memcpy(dbuf + dbpos, argsbuffer, dbsize);
-		dbpos += dbsize;
+                memcpy(dbuf + dbpos, data, cursize);
+                dbpos += cursize;
 	    }
+
             /* Keep writing data to the child until done or too much time
              * elapses with no progress or an error occurs.
              */
-            bytes_written = 0;
-            do {
-                bytes_to_write = len_read - bytes_written;
-                rv = apr_file_write(script_out, argsbuffer + bytes_written, 
-                               &bytes_to_write);
-                bytes_written += bytes_to_write;
-            } while (rv == APR_SUCCESS 
-                  && bytes_written < (apr_size_t)len_read);
-	    if (rv != APR_SUCCESS || bytes_written < (apr_size_t)len_read) {
+            rv = apr_file_write_full(script_out, data, len, NULL);
+
+            if (rv != APR_SUCCESS) {
 		/* silly script stopped reading, soak up remaining message */
-		while (ap_get_client_block(r, argsbuffer, HUGE_STRING_LEN) > 0) {
-		    /* dump it */
-		}
-		break;
+                child_stopped_reading = 1;
 	    }
 	}
-	apr_file_flush(script_out);
+        apr_brigade_cleanup(bb);
     }
+    while (!seen_eos);
 
+    if (conf->logname) {
+        dbuf[dbpos] = '\0';
+    }
+    /* Is this flush really needed? */
+    apr_file_flush(script_out);
     apr_file_close(script_out);
 
     /* Handle script return... */
     if (script_in && !nph) {
         conn_rec *c = r->connection;
 	const char *location;
 	char sbuf[MAX_STRING_LEN];
 	int ret;
 
-        bb = apr_brigade_create(r->pool, c->bucket_alloc);
         b = apr_bucket_pipe_create(script_in, c->bucket_alloc);
         APR_BRIGADE_INSERT_TAIL(bb, b);
         b = apr_bucket_eos_create(c->bucket_alloc);
         APR_BRIGADE_INSERT_TAIL(bb, b);
 
 	if ((ret = ap_scan_script_header_err_brigade(r, bb, sbuf))) {
@@ -766,15 +795,13 @@
 	     */
             discard_script_output(bb);
             apr_brigade_destroy(bb);
 	    return HTTP_MOVED_TEMPORARILY;
 	}
 
-	if (!r->header_only) {
-	    ap_pass_brigade(r->output_filters, bb);
-	}
+        ap_pass_brigade(r->output_filters, bb);
 
         log_script_err(r, script_err);
 	apr_file_close(script_err);
     }
 
     if (script_in && nph) {
@@ -797,13 +824,13 @@
 	APR_BRIGADE_INSERT_TAIL(bb, b);
 	b = apr_bucket_eos_create(c->bucket_alloc);
 	APR_BRIGADE_INSERT_TAIL(bb, b);
         ap_pass_brigade(r->output_filters, bb);
     }
 
-    return OK;			/* NOT r->status, even if it has changed. */
+    return OK;                      /* NOT r->status, even if it has changed. */
 }
 
 /*============================================================================
  *============================================================================
  * This is the beginning of the cgi filter code moved from mod_include. This
  *   is the code required to handle the "exec" SSI directive.
@@ -886,39 +913,41 @@
 }
 
 
 static int include_cmd(include_ctx_t *ctx, apr_bucket_brigade **bb,
                        const char *command, request_rec *r, ap_filter_t *f)
 {
-    exec_info      e_info;
+    cgi_exec_info_t  e_info;
     const char   **argv;
     apr_file_t    *script_out = NULL, *script_in = NULL, *script_err = NULL;
     apr_bucket_brigade *bcgi;
     apr_bucket *b;
     apr_status_t rv;
 
-    e_info.cmd_type  = APR_SHELLCMD;
-    e_info.in_pipe   = APR_NO_PIPE;
-    e_info.out_pipe  = APR_FULL_BLOCK;
-    e_info.err_pipe  = APR_NO_PIPE;
-    e_info.prog_type = RUN_AS_SSI;
-    e_info.bb        = bb;
-    e_info.ctx       = ctx;
-    e_info.next      = f->next;
+    e_info.process_cgi = 0;
+    e_info.cmd_type    = APR_SHELLCMD;
+    e_info.detached    = 0;
+    e_info.in_pipe     = APR_NO_PIPE;
+    e_info.out_pipe    = APR_FULL_BLOCK;
+    e_info.err_pipe    = APR_NO_PIPE;
+    e_info.prog_type   = RUN_AS_SSI;
+    e_info.bb          = bb;
+    e_info.ctx         = ctx;
+    e_info.next        = f->next;
 
-    if ((rv = cgi_build_command(&command, &argv, r, r->pool, 0, &e_info.cmd_type)) 
-            != APR_SUCCESS) {
+    if ((rv = cgi_build_command(&command, &argv, r, r->pool, &e_info)) != APR_SUCCESS) {
         ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
                       "don't know how to spawn cmd child process: %s", 
                       r->filename);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     /* run the script in its own process */
     if ((rv = run_cgi_child(&script_out, &script_in, &script_err,
-                      command, argv, r, r->pool, &e_info)) != APR_SUCCESS) {
+                            command, argv, r, r->pool,
+                            &e_info)) != APR_SUCCESS) {
         ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
                       "couldn't spawn child process: %s", r->filename);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     bcgi = apr_brigade_create(r->pool, f->c->bucket_alloc);
@@ -931,67 +960,77 @@
      * because we can rely on the pool to close the pipe for us.
      */
 
     return 0;
 }
 
-static int handle_exec(include_ctx_t *ctx, apr_bucket_brigade **bb, request_rec *r,
-                       ap_filter_t *f, apr_bucket *head_ptr, apr_bucket **inserted_head)
+static int handle_exec(include_ctx_t *ctx, apr_bucket_brigade **bb,
+                       request_rec *r, ap_filter_t *f, apr_bucket *head_ptr,
+                       apr_bucket **inserted_head)
 {
     char *tag     = NULL;
     char *tag_val = NULL;
     char *file = r->filename;
     apr_bucket  *tmp_buck;
     char parsed_string[MAX_STRING_LEN];
 
     *inserted_head = NULL;
     if (ctx->flags & FLAG_PRINTING) {
         if (ctx->flags & FLAG_NO_EXEC) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
-                      "exec used but not allowed in %s", r->filename);
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "exec used but not allowed in %s", r->filename);
             CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
         }
         else {
             while (1) {
                 cgi_pfn_gtv(ctx, &tag, &tag_val, 1);
                 if (tag_val == NULL) {
                     if (tag == NULL) {
-                        return (0);
+                        return 0;
                     }
                     else {
                         return 1;
                     }
                 }
                 if (!strcmp(tag, "cmd")) {
-                    cgi_pfn_ps(r, ctx, tag_val, parsed_string, sizeof(parsed_string), 1);
+                    cgi_pfn_ps(r, ctx, tag_val, parsed_string,
+                               sizeof(parsed_string), 1);
                     if (include_cmd(ctx, bb, parsed_string, r, f) == -1) {
-                        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                     "execution failure for parameter \"%s\" "
                                     "to tag exec in file %s", tag, r->filename);
-                        CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
+                        CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr,
+                                            *inserted_head);
                     }
                 }
                 else if (!strcmp(tag, "cgi")) {
                     apr_status_t retval = APR_SUCCESS;
 
-                    cgi_pfn_ps(r, ctx, tag_val, parsed_string, sizeof(parsed_string), 0);
+                    cgi_pfn_ps(r, ctx, tag_val, parsed_string,
+                               sizeof(parsed_string), 0);
+
                     SPLIT_AND_PASS_PRETAG_BUCKETS(*bb, ctx, f->next, retval);
                     if (retval != APR_SUCCESS) {
                         return retval;
                     }
 
-                    if (include_cgi(parsed_string, r, f->next, head_ptr, inserted_head) == -1) {
-                        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
-                                    "invalid CGI ref \"%s\" in %s", tag_val, file);
-                        CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
+                    if (include_cgi(parsed_string, r, f->next, head_ptr,
+                                    inserted_head) == -1) {
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                                      "invalid CGI ref \"%s\" in %s",
+                                      tag_val, file);
+                        CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr,
+                                            *inserted_head);
                     }
                 }
                 else {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
-                                "unknown parameter \"%s\" to tag exec in %s", tag, file);
-                    CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                                  "unknown parameter \"%s\" to tag exec in %s",
+                                  tag, file);
+                    CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr,
+                                        *inserted_head);
                 }
             }
         }
     }
     return 0;
 }
@@ -1035,13 +1074,13 @@
     ap_hook_post_config(cgi_post_config, aszPre, NULL, APR_HOOK_REALLY_FIRST);
 }
 
 module AP_MODULE_DECLARE_DATA cgi_module =
 {
     STANDARD20_MODULE_STUFF,
-    NULL,			/* dir config creater */
-    NULL,			/* dir merger --- default is to override */
-    create_cgi_config,		/* server config */
-    merge_cgi_config,		/* merge server config */
-    cgi_cmds,			/* command apr_table_t */
-    register_hooks		/* register hooks */
+    NULL,                        /* dir config creater */
+    NULL,                        /* dir merger --- default is to override */
+    create_cgi_config,           /* server config */
+    merge_cgi_config,            /* merge server config */
+    cgi_cmds,                    /* command apr_table_t */
+    register_hooks               /* register hooks */
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgid.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgid.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgid.c	2002-04-22 16:08:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgid.c	2002-06-14 03:41:17.000000000 +0800
@@ -326,22 +326,14 @@
         suexec_config_t *suexec_cfg = apr_pcalloc(r->pool, sizeof(*suexec_cfg));
 
         rc = read(fd, &i, sizeof(int));
         if (rc != sizeof(int)) {
             return 1;
         }
-        rc = read(fd, &suexec_cfg->ugid.uid, sizeof(uid_t));
-        if (rc != sizeof(uid_t)) {
-            return 1;
-        }
-        rc = read(fd, &suexec_cfg->ugid.gid, sizeof(gid_t));
-        if (rc != sizeof(gid_t)) {
-            return 1;
-        }
-        rc = read(fd, &suexec_cfg->active, sizeof(int));
-        if (rc != sizeof(int)) {
+        rc = read(fd, suexec_cfg, sizeof(*suexec_cfg));
+        if (rc != sizeof(*suexec_cfg)) {
             return 1;
         }
         dconf[i] = (void *)suexec_cfg;
     }
 
     r->per_dir_config = (ap_conf_vector_t *)dconf; 
@@ -376,18 +368,26 @@
     } 
     else { 
         temp_core->limit_nproc = NULL; 
     } 
 #endif 
 #endif
-    /* For right now, just make the notes table.  At some point we will need
-     * to actually fill this out, but for now we just don't want suexec to
-     * seg fault.
-     */
+
+    /* basic notes table to avoid segfaults */
     r->notes = apr_table_make(r->pool, 1);
 
+    /* mod_userdir requires the mod_userdir_user note */
+    rc = read(fd, &len, sizeof(len));
+    if ((rc == sizeof(len)) && len) {
+        data = apr_pcalloc(r->pool, len + 1); /* last byte is '\0' */
+        rc = read(fd, data, len);
+        if (rc != len) {
+            return 1;
+        }
+        apr_table_set(r->notes,"mod_userdir_user", (const char *)data);
+    }
     return 0;
 } 
 
 
 
 static void send_req(int fd, request_rec *r, char *argv0, char **env, int req_type) 
@@ -438,15 +438,13 @@
     }     
     if (suexec_mod) {
         suexec_config_t *suexec_cfg = ap_get_module_config(r->per_dir_config,
                                                            suexec_mod);
 
         write(fd, &suexec_mod->module_index, sizeof(int));
-        write(fd, &suexec_cfg->ugid.uid, sizeof(uid_t));
-        write(fd, &suexec_cfg->ugid.gid, sizeof(gid_t));
-        write(fd, &suexec_cfg->active, sizeof(int));
+        write(fd, suexec_cfg, sizeof(*suexec_cfg));
     }
 
 #if 0
 #ifdef RLIMIT_CPU 
     if (conf->limit_cpu) { 
         len = 1; 
@@ -480,12 +478,23 @@
     else { 
         len = 0; 
         write(fd, &len, sizeof(int)); 
     } 
 #endif
 #endif 
+   /* send a minimal notes table */
+   data  = (char *) apr_table_get(r->notes, "mod_userdir_user");
+   if (data != NULL) {
+       len = strlen(data);
+       write(fd, &len, sizeof(len));
+       write(fd, data, len);
+   }
+   else {
+       len = 0;
+       write(fd, &len, sizeof(len));
+   }
 } 
 
 static void daemon_signal_handler(int sig)
 {
     if (sig == SIGHUP) {
         ++daemon_should_exit;
@@ -581,13 +590,13 @@
        
         r = apr_pcalloc(ptrans, sizeof(request_rec)); 
         procnew = apr_pcalloc(ptrans, sizeof(*procnew));
         r->pool = ptrans; 
         rc = get_req(sd2, r, &argv0, &env, &req_type); 
         if (rc) {
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0,
                          main_server,
                          "Error reading request on cgid socket");
             close(sd2);
             continue;
         }
         apr_os_file_put(&r->server->error_log, &errfileno, 0, r->pool);
@@ -793,13 +802,13 @@
 static int log_scripterror(request_rec *r, cgid_server_conf * conf, int ret, 
                            apr_status_t rv, char *error) 
 { 
     apr_file_t *f = NULL; 
     struct stat finfo; 
     char time_str[APR_CTIME_LEN];
-    int log_flags = rv ? APLOG_ERR : APLOG_NOERRNO | APLOG_ERR;
+    int log_flags = rv ? APLOG_ERR : APLOG_ERR;
 
     ap_log_rerror(APLOG_MARK, log_flags, rv, r, 
                 "%s: %s", error, r->filename); 
 
     /* XXX Very expensive mainline case! Open, then getfileinfo! */
     if (!conf->logname || 
@@ -955,13 +964,13 @@
             if (errno == ECONNREFUSED && connect_tries < DEFAULT_CONNECT_ATTEMPTS) {
                 ap_log_rerror(APLOG_MARK, APLOG_DEBUG, errno, r,
                               "connect #%d to cgi daemon failed, sleeping before retry",
                               connect_tries);
                 close(sd);
                 apr_sleep(sliding_timer);
-                if (sliding_timer < 2 * APR_USEC_PER_SEC) {
+                if (sliding_timer < apr_time_from_sec(2)) {
                     sliding_timer *= 2;
                 }
             }
             else {
                 close(sd);
                 return log_scripterror(r, conf, HTTP_SERVICE_UNAVAILABLE, errno, 
@@ -1008,21 +1017,20 @@
 { 
     conn_rec *c = r->connection;
     int retval, nph, dbpos = 0; 
     char *argv0, *dbuf = NULL; 
     apr_bucket_brigade *bb;
     apr_bucket *b;
-    char argsbuffer[HUGE_STRING_LEN]; 
     cgid_server_conf *conf;
     int is_included;
+    int seen_eos, child_stopped_reading;
     int sd;
     char **env; 
     apr_file_t *tempsock;
-    apr_size_t nbytes;
 
-    if(strcmp(r->handler,CGI_MAGIC_TYPE) && strcmp(r->handler,"cgi-script"))
+    if (strcmp(r->handler,CGI_MAGIC_TYPE) && strcmp(r->handler,"cgi-script"))
 	return DECLINED;
 
     if (r->method_number == M_OPTIONS) { 
         /* 99 out of 100 cgid scripts, this is all they support */ 
         r->allowed |= (AP_METHOD_BIT << M_GET); 
         r->allowed |= (AP_METHOD_BIT << M_POST); 
@@ -1091,55 +1099,91 @@
      * use a pipe bucket to send the data to the client.
      * Note that this does not register a cleanup for the socket.  We did
      * that explicitly right after we created the socket.
      */
     apr_os_file_put(&tempsock, &sd, 0, r->pool);
 
-    if ((retval = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR))) 
-        return retval; 
-     
     if ((argv0 = strrchr(r->filename, '/')) != NULL) 
         argv0++; 
     else 
         argv0 = r->filename; 
 
     /* Transfer any put/post args, CERN style... 
      * Note that we already ignore SIGPIPE in the core server. 
      */ 
+    bb = apr_brigade_create(r->pool, r->connection->bucket_alloc);
+    seen_eos = 0;
+    child_stopped_reading = 0;
+    if (conf->logname) {
+        dbuf = apr_palloc(r->pool, conf->bufbytes + 1);
+        dbpos = 0;
+    }
+    do {
+        apr_bucket *bucket;
+        apr_status_t rv;
 
-    if (ap_should_client_block(r)) { 
-        int dbsize, len_read; 
+        rv = ap_get_brigade(r->input_filters, bb, AP_MODE_READBYTES,
+                            APR_BLOCK_READ, HUGE_STRING_LEN);
+       
+        if (rv != APR_SUCCESS) {
+            return rv;
+        }
+ 
+        APR_BRIGADE_FOREACH(bucket, bb) {
+            const char *data;
+            apr_size_t len;
+
+            if (APR_BUCKET_IS_EOS(bucket)) {
+                seen_eos = 1;
+                break;
+            }
 
-        if (conf->logname) { 
-            dbuf = apr_pcalloc(r->pool, conf->bufbytes + 1); 
-            dbpos = 0; 
-        } 
+            /* We can't do much with this. */
+            if (APR_BUCKET_IS_FLUSH(bucket)) {
+                continue;
+            }
 
-        while ((len_read = 
-                ap_get_client_block(r, argsbuffer, HUGE_STRING_LEN)) > 0) { 
-            if (conf->logname) { 
-                if ((dbpos + len_read) > conf->bufbytes) { 
-                    dbsize = conf->bufbytes - dbpos; 
-                } 
-                else { 
-                    dbsize = len_read; 
-                } 
-                memcpy(dbuf + dbpos, argsbuffer, dbsize); 
-                dbpos += dbsize; 
-            } 
-            nbytes = len_read;
-            apr_file_write(tempsock, argsbuffer, &nbytes);
-            if (nbytes < len_read) { 
-                /* silly script stopped reading, soak up remaining message */ 
-                while (ap_get_client_block(r, argsbuffer, HUGE_STRING_LEN) > 0) { 
-                    /* dump it */ 
-                } 
-                break; 
+            /* If the child stopped, we still must read to EOS. */
+            if (child_stopped_reading) {
+                continue;
             } 
-        } 
-    } 
+
+            /* read */
+            apr_bucket_read(bucket, &data, &len, APR_BLOCK_READ);
+            
+            if (conf->logname && dbpos < conf->bufbytes) {
+                int cursize;
+
+                if ((dbpos + len) > conf->bufbytes) {
+                    cursize = conf->bufbytes - dbpos;
+                }
+                else {
+                    cursize = len;
+                }
+                memcpy(dbuf + dbpos, data, cursize);
+                dbpos += cursize;
+            }
+
+            /* Keep writing data to the child until done or too much time
+             * elapses with no progress or an error occurs.
+             */
+            rv = apr_file_write_full(tempsock, data, len, NULL);
+
+            if (rv != APR_SUCCESS) {
+                /* silly script stopped reading, soak up remaining message */
+                child_stopped_reading = 1;
+            }
+        }
+        apr_brigade_cleanup(bb);
+    }
+    while (!seen_eos);
+ 
+    if (conf->logname) {
+        dbuf[dbpos] = '\0';
+    }
+
     /* we're done writing, or maybe we didn't write at all;
      * force EOF on child's stdin so that the cgi detects end (or
      * absence) of data
      */
     shutdown(sd, 1);
 
@@ -1187,21 +1231,19 @@
              */ 
             discard_script_output(bb);
             apr_brigade_destroy(bb);
             return HTTP_MOVED_TEMPORARILY; 
         } 
 
-        if (!r->header_only) {
-            /* Passing our socket down the filter chain in a pipe bucket
-             * gives up the responsibility of closing the socket, so
-             * get rid of the cleanup.
-             */
-            apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
+        /* Passing our socket down the filter chain in a pipe bucket
+         * gives up the responsibility of closing the socket, so
+         * get rid of the cleanup.
+         */
+        apr_pool_cleanup_kill(r->pool, (void *)sd, close_unix_socket);
 
-            ap_pass_brigade(r->output_filters, bb);
-        } 
+        ap_pass_brigade(r->output_filters, bb);
     } 
 
     if (nph) {
         struct ap_filter_t *cur;
         
         /* Passing our socket down the filter chain in a pipe bucket
@@ -1441,13 +1483,13 @@
     apr_bucket  *tmp_buck;
     char parsed_string[MAX_STRING_LEN];
 
     *inserted_head = NULL;
     if (ctx->flags & FLAG_PRINTING) {
         if (ctx->flags & FLAG_NO_EXEC) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "exec used but not allowed in %s", r->filename);
             CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
         }
         else {
             while (1) {
                 cgid_pfn_gtv(ctx, &tag, &tag_val, 1);
@@ -1459,13 +1501,13 @@
                         return 1;
                     }
                 }
                 if (!strcmp(tag, "cmd")) {
                     cgid_pfn_ps(r, ctx, tag_val, parsed_string, sizeof(parsed_string), 1);
                     if (include_cmd(ctx, bb, parsed_string, r, f) == -1) {
-                        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                     "execution failure for parameter \"%s\" "
                                     "to tag exec in file %s", tag, r->filename);
                         CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
                     }
                     /* just in case some stooge changed directories */
                 }
@@ -1476,19 +1518,19 @@
                     SPLIT_AND_PASS_PRETAG_BUCKETS(*bb, ctx, f->next, retval);
                     if (retval != APR_SUCCESS) {
                         return retval;
                     }
 
                     if (include_cgi(parsed_string, r, f->next, head_ptr, inserted_head) == -1) {
-                        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                     "invalid CGI ref \"%s\" in %s", tag_val, file);
                         CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
                     }
                 }
                 else {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                 "unknown parameter \"%s\" to tag exec in %s", tag, file);
                     CREATE_ERROR_BUCKET(ctx, tmp_buck, head_ptr, *inserted_head);
                 }
             }
         }
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgi.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgi.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_cgi.h	2002-04-14 04:42:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_cgi.h	2002-06-06 08:17:50.000000000 +0800
@@ -56,28 +56,45 @@
  * University of Illinois, Urbana-Champaign.
  */
 
 #ifndef _MOD_CGI_H
 #define _MOD_CGI_H 1
 
+#include "mod_include.h"
+
+typedef enum {RUN_AS_SSI, RUN_AS_CGI} prog_types;
+
+typedef struct {
+    apr_int32_t          in_pipe;
+    apr_int32_t          out_pipe;
+    apr_int32_t          err_pipe;
+    int                  process_cgi;
+    apr_cmdtype_e        cmd_type;
+    apr_int32_t          detached;
+    prog_types           prog_type;
+    apr_bucket_brigade **bb;
+    include_ctx_t       *ctx;
+    ap_filter_t         *next;
+} cgi_exec_info_t;
 
 /**
  * Registerable optional function to override CGI behavior;
  * Reprocess the command and arguments to execute the given CGI script.
  * @param cmd Pointer to the command to execute (may be overridden)
  * @param argv Pointer to the arguments to pass (may be overridden)
  * @param r The current request
  * @param p The pool to allocate correct cmd/argv elements within.
  * @param process_cgi Set true if processing r->filename and r->args
  *                    as a CGI invocation, otherwise false
  * @param type Set to APR_SHELLCMD or APR_PROGRAM on entry, may be
  *             changed to invoke the program with alternate semantics.
+ * @param detach Should the child start in detached state?  Default is no. 
  * @remark This callback may be registered by the os-specific module 
  * to correct the command and arguments for apr_proc_create invocation
  * on a given os.  mod_cgi will call the function if registered.
  */
 APR_DECLARE_OPTIONAL_FN(apr_status_t, ap_cgi_build_command, 
                         (const char **cmd, const char ***argv,
                          request_rec *r, apr_pool_t *p, 
-                         int process_cgi, apr_cmdtype_e *type));
+                         cgi_exec_info_t *e_info));
 
 #endif /* _MOD_CGI_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_info.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_info.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_info.c	2002-03-23 21:06:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_info.c	2002-06-14 03:54:52.000000000 +0800
@@ -136,13 +136,13 @@
 
     s = string;
     /* keep space for \0 byte */
     while (*s) {
         if (*s == '<') {
 	    if (close) {
-                ap_rputs("&lt;/,", r);
+                ap_rputs("&lt;/", r);
 	    } else {
                 ap_rputs("&lt;", r);
 	    }
         }
         else if (*s == '>') {
             ap_rputs("&gt;", r);
@@ -355,15 +355,12 @@
 
     r->allowed |= (AP_METHOD_BIT << M_GET);
     if (r->method_number != M_GET)
 	return DECLINED;
 
     ap_set_content_type(r, "text/html");
-    if (r->header_only) {
-        return 0;
-    }
 
     ap_rputs(DOCTYPE_HTML_3_2
 	     "<html><head><title>Server Information</title></head>\n", r);
     ap_rputs("<body><h1 align=\"center\">Apache Server Information</h1>\n", r);
     if (!r->args || strcasecmp(r->args, "list")) {
         if (!r->args) {
@@ -388,17 +385,18 @@
                         ap_get_server_built());
             ap_rprintf(r, "<dt><strong>API Version:</strong> "
                         "<tt>%d:%d</tt></dt>\n",
                         MODULE_MAGIC_NUMBER_MAJOR, MODULE_MAGIC_NUMBER_MINOR);
             ap_rprintf(r, "<dt><strong>Hostname/port:</strong> "
                         "<tt>%s:%u</tt></dt>\n",
-                        serv->server_hostname, serv->port);
+                        ap_get_server_name(r), ap_get_server_port(r));
             ap_rprintf(r, "<dt><strong>Timeouts:</strong> "
                         "<tt>connection: %d &nbsp;&nbsp; "
                         "keep-alive: %d</tt></dt>",
-                        serv->timeout, serv->keep_alive_timeout);
+                        (int)(apr_time_sec(serv->timeout)), 
+                        (int)(apr_time_sec(serv->timeout)));
             ap_mpm_query(AP_MPMQ_MAX_DAEMON_USED, &max_daemons);
             ap_mpm_query(AP_MPMQ_IS_THREADED, &threaded);
             ap_mpm_query(AP_MPMQ_IS_FORKED, &forked);
             ap_rprintf(r, "<dt><strong>MPM Name:</strong> <tt>%s</tt></dt>\n", ap_show_mpm());
             ap_rprintf(r, "<dt><strong>MPM Information:</strong> "
 		       "<tt>Max Daemons: %d Threaded: %s Forked: %s</tt></dt>\n",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_status.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_status.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_status.c	2002-04-22 12:48:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_status.c	2002-06-14 03:54:52.000000000 +0800
@@ -283,13 +283,13 @@
     stat_buffer = apr_palloc(r->pool, server_limit * thread_limit * sizeof(char));
 
     nowtime = apr_time_now();
     tu = ts = tcu = tcs = 0;
 
     if (!ap_exists_scoreboard_image()) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Server status unavailable in inetd mode");
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     r->allowed = (AP_METHOD_BIT << M_GET);
     if (r->method_number != M_GET)
@@ -331,30 +331,29 @@
             }
 
             i++;
         }
     }
 
-    if (r->header_only)
-        return 0;
-
     for (i = 0; i < server_limit; ++i) {
         ps_record = ap_get_scoreboard_process(i);
         for (j = 0; j < thread_limit; ++j) {
             int indx = (i * thread_limit) + j;
 
             ws_record = ap_get_scoreboard_worker(i, j);
             res = ws_record->status;
             stat_buffer[indx] = status_flags[res];
 
             if (!ps_record->quiescing
-                && ps_record->generation == ap_my_generation
                 && ps_record->pid) {
-                if (res == SERVER_READY)
+                if (res == SERVER_READY
+                    && ps_record->generation == ap_my_generation)
                     ready++;
-                else if (res != SERVER_DEAD && res != SERVER_IDLE_KILL)
+                else if (res != SERVER_DEAD &&
+                         res != SERVER_STARTING &&
+                         res != SERVER_IDLE_KILL)
                     busy++;
             }
 
             /* XXX what about the counters for quiescing/seg faulted
              * processes?  should they be counted or not?  GLA
              */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_suexec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_suexec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators/mod_suexec.c	2002-04-25 15:18:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/generators/mod_suexec.c	2002-05-26 04:10:55.000000000 +0800
@@ -135,17 +135,17 @@
     void *reported;
 
     apr_pool_userdata_get(&reported, SUEXEC_POST_CONFIG_USERDATA,
                           s->process->pool);
 
     if ((reported == NULL) && unixd_config.suexec_enabled) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, s,
                      "suEXEC mechanism enabled (wrapper: %s)", SUEXEC_BIN);
 
-        apr_pool_userdata_setn((void *)1, SUEXEC_POST_CONFIG_USERDATA,
-                               apr_pool_cleanup_null, s->process->pool);
+        apr_pool_userdata_set((void *)1, SUEXEC_POST_CONFIG_USERDATA,
+                              apr_pool_cleanup_null, s->process->pool);
     }
 
     return OK;
 }
 #undef SUEXEC_POST_CONFIG_USERDATA
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/generators: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/config2.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/config2.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/config2.m4	2001-10-04 01:47:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/config2.m4	2002-05-21 05:24:04.000000000 +0800
@@ -1,11 +1,20 @@
 dnl modules enabled in this directory by default
 
 APACHE_MODPATH_INIT(http)
 
 http_objects="http_core.lo http_protocol.lo http_request.lo"
 
-dnl mod_http freaks out when built as a DSO
+dnl mod_http should only be built as a static module for now.
+dnl this will hopefully be "fixed" at some point in the future by
+dnl refactoring mod_http and moving some things to the core and
+dnl vice versa so that the core does not depend upon mod_http.
+if test "$enable_http" = "yes"; then
+    enable_http="static"
+elif test "$enable_http" = "shared"; then
+    AC_MSG_ERROR([mod_http can not be built as a shared DSO])
+fi
+
 APACHE_MODULE(http, HTTP protocol handling, $http_objects, , static)
 APACHE_MODULE(mime, mapping of file-extension to MIME, , , yes)
 
 APACHE_MODPATH_FINISH
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http: .deps
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_core.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_core.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_core.c	2002-04-06 04:55:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_core.c	2002-06-13 07:59:30.000000000 +0800
@@ -88,13 +88,13 @@
 {
     const char *err = ap_check_cmd_context(cmd, NOT_IN_DIR_LOC_FILE|NOT_IN_LIMIT);
     if (err != NULL) {
         return err;
     }
 
-    cmd->server->keep_alive_timeout = atoi(arg);
+    cmd->server->keep_alive_timeout = apr_time_from_sec(atoi(arg));
     return NULL;
 }
 
 static const char *set_keep_alive(cmd_parms *cmd, void *dummy,
 				  const char *arg) 
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_protocol.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_protocol.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_protocol.c	2002-04-24 06:15:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_protocol.c	2002-06-18 09:30:34.000000000 +0800
@@ -251,20 +251,20 @@
         r->connection->keepalives++;
 
         /* If they sent a Keep-Alive token, send one back */
         if (ka_sent) {
             if (r->server->keep_alive_max) {
                 apr_table_setn(r->headers_out, "Keep-Alive",
-                               apr_psprintf(r->pool, "timeout=%d, max=%d",
-                                            r->server->keep_alive_timeout,
-                                            left));
+                       apr_psprintf(r->pool, "timeout=%d, max=%d",
+                            (int)apr_time_sec(r->server->keep_alive_timeout),
+                            left));
             }
             else {
                 apr_table_setn(r->headers_out, "Keep-Alive",
-                               apr_psprintf(r->pool, "timeout=%d",
-                                            r->server->keep_alive_timeout));
+                      apr_psprintf(r->pool, "timeout=%d",
+                            (int)apr_time_sec(r->server->keep_alive_timeout)));
             }
             apr_table_mergen(r->headers_out, "Connection", "Keep-Alive");
         }
 
         return 1;
     }
@@ -287,13 +287,13 @@
 }
 
 AP_DECLARE(int) ap_meets_conditions(request_rec *r)
 {
     const char *etag;
     const char *if_match, *if_modified_since, *if_unmodified, *if_nonematch;
-    apr_time_t mtime;
+    apr_int64_t mtime;
 
     /* Check for conditional requests --- note that we only want to do
      * this if we are successful so far and we are not processing a
      * subrequest or an ErrorDocument.
      *
      * The order of the checks is important, since ETag checks are supposed
@@ -306,14 +306,17 @@
     if (!ap_is_HTTP_SUCCESS(r->status) || r->no_local_copy) {
         return OK;
     }
 
     etag = apr_table_get(r->headers_out, "ETag");
 
+    /* All of our comparisons must be in seconds, because that's the
+     * highest time resolution the HTTP specification allows.
+     */
     /* XXX: we should define a "time unset" constant */
-    mtime = (r->mtime != 0) ? r->mtime : apr_time_now();
+    mtime = ((r->mtime != 0) ? r->mtime : apr_time_now()) / APR_USEC_PER_SEC;
 
     /* If an If-Match request-header field was given
      * AND the field value is not "*" (meaning match anything)
      * AND if our strong ETag does not match any entity tag in that field,
      *     respond with a status of 412 (Precondition Failed).
      */
@@ -331,13 +334,13 @@
          *     respond with a status of 412 (Precondition Failed).
          */
         if_unmodified = apr_table_get(r->headers_in, "If-Unmodified-Since");
         if (if_unmodified != NULL) {
             apr_time_t ius = apr_date_parse_http(if_unmodified);
 
-            if ((ius != APR_DATE_BAD) && (mtime > ius)) {
+            if ((ius != APR_DATE_BAD) && (mtime > (ius / APR_USEC_PER_SEC))) {
                 return HTTP_PRECONDITION_FAILED;
             }
         }
     }
 
     /* If an If-None-Match request-header field was given
@@ -384,15 +387,18 @@
      * A date later than the server's current request time is invalid.
      */
     else if ((r->method_number == M_GET)
              && ((if_modified_since =
                   apr_table_get(r->headers_in,
                                 "If-Modified-Since")) != NULL)) {
-        apr_time_t ims = apr_date_parse_http(if_modified_since);
+        apr_int64_t ims, reqtime;
+
+        ims = apr_date_parse_http(if_modified_since) / APR_USEC_PER_SEC;
+        reqtime = r->request_time / APR_USEC_PER_SEC;
 
-        if ((ims >= mtime) && (ims <= r->request_time)) {
+        if ((ims >= mtime) && (ims <= reqtime)) {
             return HTTP_NOT_MODIFIED;
         }
     }
     return OK;
 }
 
@@ -485,13 +491,13 @@
         return *methnum;
         
     if (cur_method_number > METHOD_NUMBER_LAST) {
         /* The method registry  has run out of dynamically
          * assignable method numbers. Log this and return M_INVALID.
          */
-        ap_log_perror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, p,
+        ap_log_perror(APLOG_MARK, APLOG_ERR, 0, p,
                       "Maximum new request methods %d reached while "
                       "registering method %s.",
                       METHOD_NUMBER_LAST, methname);
         return M_INVALID;
     }
 
@@ -733,12 +739,13 @@
     apr_off_t limit_used;
     enum {
         BODY_NONE,
         BODY_LENGTH,
         BODY_CHUNK
     } state;
+    int eos_sent;
 } http_ctx_t;
 
 /* This is the HTTP_INPUT filter for HTTP requests and responses from 
  * proxied servers (mod_proxy).  It handles chunked and content-length 
  * bodies.  This can only be inserted/used after the headers
  * are successfully parsed. 
@@ -760,12 +767,13 @@
     if (!ctx) {
         const char *tenc, *lenp;
         f->ctx = ctx = apr_palloc(f->r->pool, sizeof(*ctx));
         ctx->state = BODY_NONE;
         ctx->remaining = 0;
         ctx->limit_used = 0;
+        ctx->eos_sent = 0;
 
         /* LimitRequestBody does not apply to proxied responses.
          * Consider implementing this check in its own filter. 
          * Would adding a directive to limit the size of proxied 
          * responses be useful?
          */
@@ -783,35 +791,85 @@
             if (!strcasecmp(tenc, "chunked")) {
                 ctx->state = BODY_CHUNK;
             }
         }
         else if (lenp) {
             const char *pos = lenp;
+            int conversion_error = 0;
 
+            /* This ensures that the number can not be negative. */
             while (apr_isdigit(*pos) || apr_isspace(*pos)) {
                 ++pos;
             }
 
             if (*pos == '\0') {
+                char *endstr;
+
+                errno = 0;
                 ctx->state = BODY_LENGTH;
-                ctx->remaining = atol(lenp);
+                ctx->remaining = strtol(lenp, &endstr, 10);
+
+                if (errno || (endstr && *endstr)) {
+                    conversion_error = 1; 
+                }
+            }
+
+            if (*pos != '\0' || conversion_error) {
+                apr_bucket_brigade *bb;
+
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, f->r,
+                              "Invalid Content-Length");
+
+                bb = apr_brigade_create(f->r->pool, f->c->bucket_alloc);
+                e = ap_bucket_error_create(HTTP_REQUEST_ENTITY_TOO_LARGE, NULL,
+                                           f->r->pool, f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                e = apr_bucket_eos_create(f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                ctx->eos_sent = 1;
+                return ap_pass_brigade(f->r->output_filters, bb);
             }
             
             /* If we have a limit in effect and we know the C-L ahead of
              * time, stop it here if it is invalid. 
              */ 
             if (ctx->limit && ctx->limit < ctx->remaining) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, f->r,
+                apr_bucket_brigade *bb;
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, f->r,
                           "Requested content-length of %" APR_OFF_T_FMT 
                           " is larger than the configured limit"
                           " of %" APR_OFF_T_FMT, ctx->remaining, ctx->limit);
-                ap_die(HTTP_REQUEST_ENTITY_TOO_LARGE, f->r);
-                return APR_EGENERAL;
+                bb = apr_brigade_create(f->r->pool, f->c->bucket_alloc);
+                e = ap_bucket_error_create(HTTP_REQUEST_ENTITY_TOO_LARGE, NULL,
+                                           f->r->pool, f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                e = apr_bucket_eos_create(f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                ctx->eos_sent = 1;
+                return ap_pass_brigade(f->r->output_filters, bb);
             }
         }
 
+        /* If we don't have a request entity indicated by the headers, EOS.
+         * (BODY_NONE is a valid intermediate state due to trailers,
+         *  but it isn't a valid starting state.)
+         *
+         * RFC 2616 Section 4.4 note 5 states that connection-close
+         * is invalid for a request entity - request bodies must be
+         * denoted by C-L or T-E: chunked.
+         *
+         * Note that since the proxy uses this filter to handle the
+         * proxied *response*, proxy responses MUST be exempt.
+         */
+        if (ctx->state == BODY_NONE && f->r->proxyreq != PROXYREQ_RESPONSE) {
+            e = apr_bucket_eos_create(f->c->bucket_alloc);
+            APR_BRIGADE_INSERT_TAIL(b, e);
+            ctx->eos_sent = 1;
+            return APR_SUCCESS;
+        }
+
         /* Since we're about to read data, send 100-Continue if needed.
          * Only valid on chunked and C-L bodies where the C-L is > 0. */
         if ((ctx->state == BODY_CHUNK || 
             (ctx->state == BODY_LENGTH && ctx->remaining > 0)) &&
             f->r->expecting_100 && f->r->proto_num >= HTTP_VERSION(1,1)) {
             char *tmp;
@@ -843,23 +901,53 @@
             if (rv != APR_SUCCESS) {
                 return rv;
             }
             apr_brigade_flatten(bb, line, &len);
 
             ctx->remaining = get_chunk_size(line);
+            /* Detect chunksize error (such as overflow) */
+            if (ctx->remaining < 0) {
+                ctx->remaining = 0; /* Reset it in case we have to
+                                     * come back here later */
+                apr_brigade_cleanup(bb);
+                e = ap_bucket_error_create(HTTP_REQUEST_ENTITY_TOO_LARGE, NULL,
+                                           f->r->pool,
+                                           f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                e = apr_bucket_eos_create(f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(bb, e);
+                ctx->eos_sent = 1;
+                return ap_pass_brigade(f->r->output_filters, bb);
+            }
+
+            if (!ctx->remaining) {
+                /* Handle trailers by calling ap_get_mime_headers again! */
+                ctx->state = BODY_NONE;
+                ap_get_mime_headers(f->r);
+                e = apr_bucket_eos_create(f->c->bucket_alloc);
+                APR_BRIGADE_INSERT_TAIL(b, e);
+                ctx->eos_sent = 1;
+                return APR_SUCCESS;
+            }
         } 
     }
 
+    if (ctx->eos_sent) {
+        e = apr_bucket_eos_create(f->c->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(b, e);
+        return APR_SUCCESS;
+    }
+        
     if (!ctx->remaining) {
-        conn_rec *c = f->r->connection;
         switch (ctx->state) {
         case BODY_NONE:
             break;
         case BODY_LENGTH:
-            e = apr_bucket_eos_create(c->bucket_alloc);
+            e = apr_bucket_eos_create(f->c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(b, e);
+            ctx->eos_sent = 1;
             return APR_SUCCESS;
         case BODY_CHUNK:
             {
                 char line[30];
                 apr_bucket_brigade *bb;
                 apr_size_t len = 30;
@@ -881,18 +969,34 @@
                 if (rv != APR_SUCCESS) {
                     return rv;
                 }
                 apr_brigade_flatten(bb, line, &len);
                 ctx->remaining = get_chunk_size(line);
 
+                /* Detect chunksize error (such as overflow) */
+                if (ctx->remaining < 0) {
+                    ctx->remaining = 0; /* Reset it in case we have to
+                                         * come back here later */
+                    apr_brigade_cleanup(bb);
+                    e = ap_bucket_error_create(HTTP_REQUEST_ENTITY_TOO_LARGE,
+                                               NULL, f->r->pool,
+                                               f->c->bucket_alloc);
+                    APR_BRIGADE_INSERT_TAIL(bb, e);
+                    e = apr_bucket_eos_create(f->c->bucket_alloc);
+                    APR_BRIGADE_INSERT_TAIL(bb, e);
+                    ctx->eos_sent = 1;
+                    return ap_pass_brigade(f->r->output_filters, bb);
+                }
+
                 if (!ctx->remaining) {
                     /* Handle trailers by calling ap_get_mime_headers again! */
                     ctx->state = BODY_NONE;
                     ap_get_mime_headers(f->r);
-                    e = apr_bucket_eos_create(c->bucket_alloc);
+                    e = apr_bucket_eos_create(f->c->bucket_alloc);
                     APR_BRIGADE_INSERT_TAIL(b, e);
+                    ctx->eos_sent = 1;
                     return APR_SUCCESS;
                 }
             }
             break;
         }
     }
@@ -926,18 +1030,26 @@
     if (ctx->limit) {
         /* FIXME: Note that we might get slightly confused on chunked inputs
          * as we'd need to compensate for the chunk lengths which may not
          * really count.  This seems to be up for interpretation.  */
         ctx->limit_used += totalread;
         if (ctx->limit < ctx->limit_used) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, f->r,
+            apr_bucket_brigade *bb;
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, f->r,
                           "Read content-length of %" APR_OFF_T_FMT 
                           " is larger than the configured limit"
                           " of %" APR_OFF_T_FMT, ctx->limit_used, ctx->limit);
-            ap_die(HTTP_REQUEST_ENTITY_TOO_LARGE, f->r);
-            return APR_EGENERAL;
+            bb = apr_brigade_create(f->r->pool, f->c->bucket_alloc);
+            e = ap_bucket_error_create(HTTP_REQUEST_ENTITY_TOO_LARGE, NULL,
+                                       f->r->pool,
+                                       f->c->bucket_alloc);
+            APR_BRIGADE_INSERT_TAIL(bb, e);
+            e = apr_bucket_eos_create(f->c->bucket_alloc);
+            APR_BRIGADE_INSERT_TAIL(bb, e);
+            ctx->eos_sent = 1;
+            return ap_pass_brigade(f->r->output_filters, bb);
         }
     }
 
     return APR_SUCCESS;
 }
 
@@ -987,12 +1099,13 @@
  * In other words, don't change this one without checking table_do in alloc.c.
  * It returns true unless there was a write error of some kind.
  */
 static int form_header_field(header_struct *h,
                              const char *fieldname, const char *fieldval)
 {
+#if APR_CHARSET_EBCDIC
     char *headfield;
     apr_size_t len;
     apr_size_t name_len;
     apr_size_t val_len;
     char *next;
 
@@ -1008,12 +1121,18 @@
     next += val_len;
     *next++ = CR;
     *next++ = LF;
     *next = 0;
     ap_xlate_proto_to_ascii(headfield, len);
     apr_brigade_write(h->bb, NULL, NULL, headfield, len);
+#else
+    apr_brigade_puts(h->bb, NULL, NULL, fieldname);
+    apr_brigade_write(h->bb, NULL, NULL, ": ", sizeof(": ") - 1);
+    apr_brigade_puts(h->bb, NULL, NULL, fieldval);
+    apr_brigade_write(h->bb, NULL, NULL, CRLF, sizeof(CRLF) - 1);
+#endif /* APR_CHARSET_EBCDIC */
     return 1;
 }
 
 /*
  * Determine the protocol to use for the response. Potentially downgrade
  * to HTTP/1.0 in some situations and/or turn off keepalives.
@@ -1057,22 +1176,30 @@
 {
     char *date;
     char *tmp;
     const char *server;
     header_struct h;
     apr_size_t len;
+    struct iovec vec[4];
 
     if (r->assbackwards) {
         /* there are no headers to send */
         return;
     }
 
     /* Output the HTTP/1.x Status-Line and the Date and Server fields */
 
-    tmp = apr_pstrcat(r->pool, protocol, " ", r->status_line, CRLF, NULL);
-    len = strlen(tmp);
+    vec[0].iov_base = (void *)protocol;
+    vec[0].iov_len  = strlen(protocol);
+    vec[1].iov_base = (void *)" ";
+    vec[1].iov_len  = sizeof(" ") - 1;
+    vec[2].iov_base = (void *)(r->status_line);
+    vec[2].iov_len  = strlen(r->status_line);
+    vec[3].iov_base = (void *)CRLF;
+    vec[3].iov_len  = sizeof(CRLF) - 1;
+    tmp = apr_pstrcatv(r->pool, vec, 4, &len);
     ap_xlate_proto_to_ascii(tmp, len);
     apr_brigade_write(bb, NULL, NULL, tmp, len);
 
     date = apr_palloc(r->pool, APR_RFC822_DATE_LEN);
     ap_recent_rfc822_date(date, r->request_time);
 
@@ -1337,29 +1464,23 @@
     int headers_sent;
 } header_filter_ctx;
 
 AP_CORE_DECLARE_NONSTD(apr_status_t) ap_http_header_filter(ap_filter_t *f,
                                                            apr_bucket_brigade *b)
 {
-    int i;
     request_rec *r = f->r;
     conn_rec *c = r->connection;
     const char *clheader;
     const char *protocol;
     apr_bucket *e;
     apr_bucket_brigade *b2;
     header_struct h;
     header_filter_ctx *ctx = f->ctx;
 
     AP_DEBUG_ASSERT(!r->main);
 
-    /* Handlers -should- be smart enough not to send content on HEAD requests.
-     * To guard against poorly written handlers, leave the header_filter
-     * installed (but only for HEAD requests) to intercept and discard content
-     * after the headers have been sent.
-     */
     if (r->header_only) {
         if (!ctx) {
             ctx = f->ctx = apr_pcalloc(r->pool, sizeof(header_filter_ctx));
         }
         else if (ctx->headers_sent) {
             apr_brigade_destroy(b);
@@ -1432,12 +1553,13 @@
     if (r->content_encoding) {
         apr_table_setn(r->headers_out, "Content-Encoding",
                        r->content_encoding);
     }
 
     if (!apr_is_empty_table(r->content_languages)) {
+        int i;
         char **languages = (char **)(r->content_languages->elts);
         for (i = 0; i < r->content_languages->nelts; ++i) {
             apr_table_mergen(r->headers_out, "Content-Language", languages[i]);
         }
     }
 
@@ -1569,42 +1691,53 @@
     r->read_body = read_policy;
     r->read_chunked = 0;
     r->remaining = 0;
 
     if (tenc) {
         if (strcasecmp(tenc, "chunked")) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "Unknown Transfer-Encoding %s", tenc);
             return HTTP_NOT_IMPLEMENTED;
         }
         if (r->read_body == REQUEST_CHUNKED_ERROR) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "chunked Transfer-Encoding forbidden: %s", r->uri);
             return (lenp) ? HTTP_BAD_REQUEST : HTTP_LENGTH_REQUIRED;
         }
 
         r->read_chunked = 1;
     }
     else if (lenp) {
         const char *pos = lenp;
+        int conversion_error = 0;
 
         while (apr_isdigit(*pos) || apr_isspace(*pos)) {
             ++pos;
         }
-        if (*pos != '\0') {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
-                          "Invalid Content-Length %s", lenp);
-            return HTTP_BAD_REQUEST;
+
+        if (*pos == '\0') {
+            char *endstr;
+
+            errno = 0;
+            r->remaining = strtol(lenp, &endstr, 10);
+
+            if (errno || (endstr && *endstr)) {
+                conversion_error = 1; 
+            }
         }
 
-        r->remaining = atol(lenp);
+        if (*pos != '\0' || conversion_error) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "Invalid Content-Length");
+            return HTTP_BAD_REQUEST;
+        }
     }
 
     if ((r->read_body == REQUEST_NO_BODY)
         && (r->read_chunked || (r->remaining > 0))) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "%s with body is not allowed for %s", r->method, r->uri);
         return HTTP_REQUEST_ENTITY_TOO_LARGE;
     }
 
 #ifdef AP_DEBUG
     {
@@ -1630,14 +1763,20 @@
     return 1;
 }
 
 static long get_chunk_size(char *b)
 {
     long chunksize = 0;
+    size_t chunkbits = sizeof(long) * 8;
 
-    while (apr_isxdigit(*b)) {
+    /* Skip leading zeros */
+    while (*b == '0') {
+        ++b;
+    }
+
+    while (apr_isxdigit(*b) && (chunkbits > 0)) {
         int xvalue = 0;
 
         if (*b >= '0' && *b <= '9') {
             xvalue = *b - '0';
         }
         else if (*b >= 'A' && *b <= 'F') {
@@ -1645,14 +1784,19 @@
         }
         else if (*b >= 'a' && *b <= 'f') {
             xvalue = *b - 'a' + 0xa;
         }
 
         chunksize = (chunksize << 4) | xvalue;
+        chunkbits -= 4;
         ++b;
     }
+    if (apr_isxdigit(*b) && (chunkbits <= 0)) {
+        /* overflow */
+        return -1;
+    }
 
     return chunksize;
 }
 
 /* get_client_block is called in a loop to get the request message body.
  * This is quite simple if the client includes a content-length
@@ -1751,41 +1895,75 @@
  *    if ((retval = ap_discard_request_body(r)) != OK) {
  *        return retval;
  *    }
  */
 AP_DECLARE(int) ap_discard_request_body(request_rec *r)
 {
-    int rv;
+    apr_bucket_brigade *bb;
+    int rv, seen_eos;
 
-    if (r->read_length == 0) {  /* if not read already */
-        if ((rv = ap_setup_client_block(r, REQUEST_CHUNKED_DECHUNK))) {
-            return rv;
-        }
+    /* Sometimes we'll get in a state where the input handling has
+     * detected an error where we want to drop the connection, so if
+     * that's the case, don't read the data as that is what we're trying
+     * to avoid.
+     *
+     * This function is also a no-op on a subrequest.
+     */
+    if (r->main || ap_status_drops_connection(r->status)) {
+        return OK;
     }
 
-    /* In order to avoid sending 100 Continue when we already know the
-     * final response status, and yet not kill the connection if there is
-     * no request body to be read, we need to duplicate the test from
-     * ap_should_client_block() here negated rather than call it directly.
-     */
-    if ((r->read_length == 0) && (r->read_chunked || (r->remaining > 0))) {
-        char dumpbuf[HUGE_STRING_LEN];
+    bb = apr_brigade_create(r->pool, r->connection->bucket_alloc);
+    seen_eos = 0;
+    do {
+        apr_bucket *bucket;
 
-        if (r->expecting_100) {
-            r->connection->keepalive = -1;
-            return OK;
-        }
+        rv = ap_get_brigade(r->input_filters, bb, AP_MODE_READBYTES,
+                            APR_BLOCK_READ, HUGE_STRING_LEN);
 
-        while ((rv = ap_get_client_block(r, dumpbuf, HUGE_STRING_LEN)) > 0) {
-            continue;
+        if (rv != APR_SUCCESS) {
+            /* FIXME: If we ever have a mapping from filters (apr_status_t)
+             * to HTTP error codes, this would be a good place for them.
+             * 
+             * If we received the special case AP_FILTER_ERROR, it means
+             * that the filters have already handled this error.
+             * Otherwise, we should assume we have a bad request.
+             */
+            if (rv == AP_FILTER_ERROR) {
+                return rv;
+            }
+            else {
+                return HTTP_BAD_REQUEST;
+            }
         }
 
-        if (rv < 0) {
-            return HTTP_BAD_REQUEST;
+        APR_BRIGADE_FOREACH(bucket, bb) {
+            const char *data;
+            apr_size_t len;
+
+            if (APR_BUCKET_IS_EOS(bucket)) {
+                seen_eos = 1;
+                break;
+            }
+
+            /* These are metadata buckets. */
+            if (bucket->length == 0) {
+                continue;
+            }
+
+            /* We MUST read because in case we have an unknown-length
+             * bucket or one that morphs, we want to exhaust it.
+             */
+            rv = apr_bucket_read(bucket, &data, &len, APR_BLOCK_READ);
+            if (rv != APR_SUCCESS) {
+                return HTTP_BAD_REQUEST;
+            }
         }
-    }
+        apr_brigade_cleanup(bb);
+    } while (!seen_eos);
+
     return OK;
 }
 
 static const char *add_optional_notes(request_rec *r,
                                       const char *prefix,
                                       const char *key,
@@ -2597,13 +2775,14 @@
 
 static int ap_set_byterange(request_rec *r);
 
 typedef struct byterange_ctx {
     apr_bucket_brigade *bb;
     int num_ranges;
-    const char *orig_ct;
+    char *boundary;
+    char *bound_head;
 } byterange_ctx;
 
 /*
  * Here we try to be compatible with clients that want multipart/x-byteranges
  * instead of multipart/byteranges (also see above), as per HTTP/1.1. We
  * look for the Request-Range header (e.g. Netscape 2 and 3) as an indication
@@ -2631,82 +2810,68 @@
     byterange_ctx *ctx = f->ctx;
     apr_bucket *e;
     apr_bucket_brigade *bsend;
     apr_off_t range_start;
     apr_off_t range_end;
     char *current;
-    char *bound_head;
     apr_off_t bb_length;
     apr_off_t clength = 0;
     apr_status_t rv;
     int found = 0;
 
     if (!ctx) {
         int num_ranges = ap_set_byterange(r);
 
-        if (num_ranges == -1) {
-            ap_remove_output_filter(f);
-            bsend = apr_brigade_create(r->pool, c->bucket_alloc);
-            e = ap_bucket_error_create(HTTP_RANGE_NOT_SATISFIABLE, NULL, 
-                                       r->pool, c->bucket_alloc);
-            APR_BRIGADE_INSERT_TAIL(bsend, e);
-            e = apr_bucket_eos_create(c->bucket_alloc);
-            APR_BRIGADE_INSERT_TAIL(bsend, e);
-            return ap_pass_brigade(f->next, bsend);
-        }
+        /* We have nothing to do, get out of the way. */
         if (num_ranges == 0) {
             ap_remove_output_filter(f);
             return ap_pass_brigade(f->next, bb);
         }
 
         ctx = f->ctx = apr_pcalloc(r->pool, sizeof(*ctx));
         ctx->num_ranges = num_ranges;
+        /* create a brigade in case we never call ap_save_brigade() */
+        ctx->bb = apr_brigade_create(r->pool, c->bucket_alloc);
+
+        if (ctx->num_ranges > 1) {
+            /* Is ap_make_content_type required here? */
+            const char *orig_ct = ap_make_content_type(r, r->content_type);
+            ctx->boundary = apr_psprintf(r->pool, "%qx%lx",
+                                         r->request_time, (long) getpid());
 
-        if (num_ranges > 1) {
-            ctx->orig_ct = r->content_type;
             ap_set_content_type(r, apr_pstrcat(r->pool, "multipart",
                                                use_range_x(r) ? "/x-" : "/",
                                                "byteranges; boundary=",
-                                               r->boundary, NULL));
-        }
+                                               ctx->boundary, NULL));
 
-        /* create a brigade in case we never call ap_save_brigade() */
-        ctx->bb = apr_brigade_create(r->pool, c->bucket_alloc);
+            ctx->bound_head = apr_pstrcat(r->pool,
+                                    CRLF "--", ctx->boundary,
+                                    CRLF "Content-type: ",
+                                    orig_ct,
+                                    CRLF "Content-range: bytes ",
+                                    NULL);
+            ap_xlate_proto_to_ascii(ctx->bound_head, strlen(ctx->bound_head));
+        }
     }
 
     /* We can't actually deal with byte-ranges until we have the whole brigade
      * because the byte-ranges can be in any order, and according to the RFC,
      * we SHOULD return the data in the same order it was requested.
      */
     if (!APR_BUCKET_IS_EOS(APR_BRIGADE_LAST(bb))) {
         ap_save_brigade(f, &ctx->bb, &bb, r->pool);
         return APR_SUCCESS;
     }
 
-    /* compute this once (it is an invariant) */
-    bound_head = apr_pstrcat(r->pool,
-                             CRLF "--", r->boundary,
-                             CRLF "Content-type: ",
-                             ap_make_content_type(r, ctx->orig_ct),
-                             CRLF "Content-range: bytes ",
-                             NULL);
-    ap_xlate_proto_to_ascii(bound_head, strlen(bound_head));
-
-    /* If we have a saved brigade from a previous run, concat the passed
-     * brigade with our saved brigade.  Otherwise just continue.
-     */
-    if (ctx->bb) {
-        APR_BRIGADE_CONCAT(ctx->bb, bb);
-        bb = ctx->bb;
-        ctx->bb = NULL;     /* ### strictly necessary? call brigade_destroy? */
-    }
+    /* Prepend any earlier saved brigades. */
+    APR_BRIGADE_PREPEND(bb, ctx->bb);
 
     /* It is possible that we won't have a content length yet, so we have to
      * compute the length before we can actually do the byterange work.
      */
-    (void) apr_brigade_length(bb, 1, &bb_length);
+    apr_brigade_length(bb, 1, &bb_length);
     clength = (apr_off_t)bb_length;
 
     /* this brigade holds what we will be sending */
     bsend = apr_brigade_create(r->pool, c->bucket_alloc);
 
     while ((current = ap_getword(r->pool, &r->range, ','))
@@ -2732,16 +2897,24 @@
                           PARTITION_ERR_FMT, range_end+1, clength);
             continue;
         }
 
         found = 1;
 
-        if (ctx->num_ranges > 1) {
+        /* For single range requests, we must produce Content-Range header.
+         * Otherwise, we need to produce the multipart boundaries.
+         */
+        if (ctx->num_ranges == 1) {
+            apr_table_setn(r->headers_out, "Content-Range",
+                           apr_psprintf(r->pool, "bytes " BYTERANGE_FMT,
+                                        range_start, range_end, clength));
+        }
+        else {
             char *ts;
 
-            e = apr_bucket_pool_create(bound_head, strlen(bound_head),
+            e = apr_bucket_pool_create(ctx->bound_head, strlen(ctx->bound_head),
                                        r->pool, c->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(bsend, e);
 
             ts = apr_psprintf(r->pool, BYTERANGE_FMT CRLF CRLF,
                               range_start, range_end, clength);
             ap_xlate_proto_to_ascii(ts, strlen(ts));
@@ -2771,43 +2944,47 @@
         } while (ec != e2);
     }
 
     if (found == 0) {
         ap_remove_output_filter(f);
         r->status = HTTP_OK;
-        return HTTP_RANGE_NOT_SATISFIABLE;
+        /* bsend is assumed to be empty if we get here. */
+        e = ap_bucket_error_create(HTTP_RANGE_NOT_SATISFIABLE, NULL,
+                                   r->pool, c->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(bsend, e);
+        e = apr_bucket_eos_create(c->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(bsend, e);
+        return ap_pass_brigade(f->next, bsend);
     }
 
     if (ctx->num_ranges > 1) {
         char *end;
 
         /* add the final boundary */
-        end = apr_pstrcat(r->pool, CRLF "--", r->boundary, "--" CRLF, NULL);
+        end = apr_pstrcat(r->pool, CRLF "--", ctx->boundary, "--" CRLF, NULL);
         ap_xlate_proto_to_ascii(end, strlen(end));
         e = apr_bucket_pool_create(end, strlen(end), r->pool, c->bucket_alloc);
         APR_BRIGADE_INSERT_TAIL(bsend, e);
     }
 
     e = apr_bucket_eos_create(c->bucket_alloc);
     APR_BRIGADE_INSERT_TAIL(bsend, e);
 
-    /* we're done with the original content */
+    /* we're done with the original content - all of our data is in bsend. */
     apr_brigade_destroy(bb);
 
     /* send our multipart output */
     return ap_pass_brigade(f->next, bsend);
 }
 
 static int ap_set_byterange(request_rec *r)
 {
     const char *range;
     const char *if_range;
     const char *match;
     const char *ct;
-    apr_off_t range_start;
-    apr_off_t range_end;
     int num_ranges;
 
     if (r->assbackwards) {
         return 0;
     }
 
@@ -2855,45 +3032,19 @@
         else if (!(match = apr_table_get(r->headers_out, "Last-Modified"))
                  || (strcmp(if_range, match) != 0)) {
             return 0;
         }
     }
 
-    /* would be nice to pick this up from f->ctx */
-    ct = ap_make_content_type(r, r->content_type);
-
     if (!ap_strchr_c(range, ',')) {
-        int rv;
-        /* A single range */
-
-        /* parse_byterange() modifies the contents, so make a copy */
-        if ((rv = parse_byterange(apr_pstrdup(r->pool, range + 6), r->clength,
-                             &range_start, &range_end)) <= 0) {
-            return rv;
-        }
-        apr_table_setn(r->headers_out, "Content-Range",
-                       apr_psprintf(r->pool, "bytes " BYTERANGE_FMT,
-                                    range_start, range_end, r->clength));
-        apr_table_setn(r->headers_out, "Content-Type", ct);
-
+        /* a single range */
         num_ranges = 1;
     }
     else {
         /* a multiple range */
-
         num_ranges = 2;
-
-        /* ### it would be nice if r->boundary was in f->ctx */
-        r->boundary = apr_psprintf(r->pool, "%qx%lx",
-                                   r->request_time, (long) getpid());
-
-        apr_table_setn(r->headers_out, "Content-Type",
-                       apr_pstrcat(r->pool,
-                                   "multipart", use_range_x(r) ? "/x-" : "/",
-                                   "byteranges; boundary=", r->boundary,
-                                   NULL));
     }
 
     r->status = HTTP_PARTIAL_CONTENT;
     r->range = range + 6;
 
     return num_ranges;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_request.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_request.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/http_request.c	2002-04-29 16:05:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/http_request.c	2002-06-11 06:02:57.000000000 +0800
@@ -114,14 +114,13 @@
     /*
      * The following takes care of Apache redirects to custom response URLs
      * Note that if we are already dealing with the response to some other
      * error condition, we just report on the original error, and give up on
      * any attempt to handle the other thing "intelligently"...
      */
-
-    if (r->status != HTTP_OK) {
+    if (r->status != HTTP_OK && !ap_status_drops_connection(type)) {
         recursive_error = type;
 
         while (r->prev && (r->prev->status != HTTP_OK))
             r = r->prev;        /* Get back to original error */
 
         type = r->status;
@@ -136,21 +135,18 @@
      * we tweak the status.
      */
     if (HTTP_UNAUTHORIZED == r->status && PROXYREQ_PROXY == r->proxyreq) {
         r->status = HTTP_PROXY_AUTHENTICATION_REQUIRED;
     }
 
-    /*
-     * If we want to keep the connection, be sure that the request body
-     * (if any) has been read.
+    /* If we don't want to keep the connection, make sure we mark that the
+     * connection is not eligible for keepalive.  If we want to keep the
+     * connection, be sure that the request body (if any) has been read.
      */
-    if ((r->status != HTTP_NOT_MODIFIED) && (r->status != HTTP_NO_CONTENT)
-        && !ap_status_drops_connection(r->status)
-        && r->connection && (r->connection->keepalive != -1)) {
-
-        (void) ap_discard_request_body(r);
+    if (ap_status_drops_connection(r->status)) {
+        r->connection->keepalive = 0;
     }
 
     /*
      * Two types of custom redirects --- plain text, and URLs. Plain text has
      * a leading '"', so the URL code, here, is triggered on its absence
      */
@@ -194,13 +190,13 @@
         else {
             /*
              * Dumb user has given us a bad url to redirect to --- fake up
              * dying with a recursive server error...
              */
             recursive_error = HTTP_INTERNAL_SERVER_ERROR;
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "Invalid error redirection directive: %s",
                         custom_response);
         }
     }
     ap_send_error_response(r, recursive_error);
 }
@@ -387,13 +383,13 @@
         f = f->next;
     }
 
     ap_add_input_filter("HTTP_IN", NULL, new, new->connection);
 
     apr_table_setn(new->subprocess_env, "REDIRECT_STATUS",
-	apr_itoa(r->pool, r->status));
+                   apr_itoa(r->pool, r->status));
 
     /*
      * XXX: hmm.  This is because mod_setenvif and mod_unique_id really need
      * to do their thing on internal redirects as well.  Perhaps this is a
      * misnamed function.
      */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/mod_mime.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/mod_mime.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http/mod_mime.c	2002-04-25 13:40:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/http/mod_mime.c	2002-05-18 12:13:13.000000000 +0800
@@ -114,14 +114,14 @@
 #define MULTIMATCH_ANY        1
 #define MULTIMATCH_NEGOTIATED 2
 #define MULTIMATCH_HANDLERS   4
 #define MULTIMATCH_FILTERS    8
 
 typedef struct {
-    apr_hash_t  *extension_mappings;  /* Map from extension name to
-                                       * extension_info structure */
+    apr_hash_t *extension_mappings;  /* Map from extension name to
+                                      * extension_info structure */
 
     apr_array_header_t *remove_mappings; /* A simple list, walked once */
 
     char *default_language;     /* Language if no AddLanguage ext found */
 
     int multimatch;       /* Extensions to include in multiview matching
@@ -133,14 +133,16 @@
     char *attr;
     char *val;
     struct param_s *next;
 } param;
 
 typedef struct {
-    char *type;
-    char *subtype;
+    const char *type;
+    apr_size_t type_len;
+    const char *subtype;
+    apr_size_t subtype_len;
     param *param;
 } content_type;
 
 static char tspecial[] = {
     '(', ')', '<', '>', '@', ',', ';', ':',
     '\\', '"', '/', '[', ']', '?', '=',
@@ -148,14 +150,13 @@
 };
 
 module AP_MODULE_DECLARE_DATA mime_module;
 
 static void *create_mime_dir_config(apr_pool_t *p, char *dummy)
 {
-    mime_dir_config *new =
-    (mime_dir_config *) apr_palloc(p, sizeof(mime_dir_config));
+    mime_dir_config *new = apr_palloc(p, sizeof(mime_dir_config));
 
     new->extension_mappings = NULL;
     new->remove_mappings = NULL;
 
     new->default_language = NULL;
 
@@ -208,16 +209,15 @@
 static void remove_items(apr_pool_t *p, apr_array_header_t *remove, 
                          apr_hash_t *mappings)
 {
     attrib_info *suffix = (attrib_info *) remove->elts;
     int i;
     for (i = 0; i < remove->nelts; i++) {
-        extension_info *exinfo =
-            (extension_info*)apr_hash_get(mappings,
-                                          suffix[i].name,
-                                          APR_HASH_KEY_STRING);
+        extension_info *exinfo = apr_hash_get(mappings,
+                                              suffix[i].name,
+                                              APR_HASH_KEY_STRING);
         if (exinfo && *(const char**)((char *)exinfo + suffix[i].offset)) {
             extension_info *copyinfo = exinfo;
             exinfo = (extension_info*)apr_palloc(p, sizeof(*exinfo));
             apr_hash_set(mappings, suffix[i].name, 
                          APR_HASH_KEY_STRING, exinfo);
             memcpy(exinfo, copyinfo, sizeof(*exinfo));
@@ -225,14 +225,14 @@
         }
     }
 }
 
 static void *merge_mime_dir_configs(apr_pool_t *p, void *basev, void *addv)
 {
-    mime_dir_config *base = (mime_dir_config *) basev;
-    mime_dir_config *add = (mime_dir_config *) addv;
+    mime_dir_config *base = (mime_dir_config *)basev;
+    mime_dir_config *add = (mime_dir_config *)addv;
     mime_dir_config *new = apr_palloc(p, sizeof(mime_dir_config));
 
     if (base->extension_mappings && add->extension_mappings) {
         new->extension_mappings = apr_hash_merge(p, add->extension_mappings,
                                                  base->extension_mappings,
                                                  overlay_extension_mappings,
@@ -278,26 +278,27 @@
     int offset = (int) (long) cmd->info;
     char *key = apr_pstrdup(cmd->temp_pool, ext);
     char *value = apr_pstrdup(cmd->pool, value_);
     ap_str_tolower(value);
     ap_str_tolower(key);
 
-    if (*key == '.')
+    if (*key == '.') {
 	++key;
+    }
     if (!m->extension_mappings) {
         m->extension_mappings = apr_hash_make(cmd->pool);
         exinfo = NULL;
     }
-    else
+    else {
         exinfo = (extension_info*)apr_hash_get(m->extension_mappings, key,
                                                APR_HASH_KEY_STRING);
+    }
     if (!exinfo) {
         exinfo = apr_pcalloc(cmd->pool, sizeof(extension_info));
         key = apr_pstrdup(cmd->pool, key);
-        apr_hash_set(m->extension_mappings, key,
-                     APR_HASH_KEY_STRING, exinfo);
+        apr_hash_set(m->extension_mappings, key, APR_HASH_KEY_STRING, exinfo);
     }
     *(const char**)((char *)exinfo + offset) = value;
     return NULL;
 }
 
 /*
@@ -307,18 +308,19 @@
  */
 static const char *remove_extension_info(cmd_parms *cmd, void *m_, 
                                          const char *ext)
 {
     mime_dir_config *m = (mime_dir_config *) m_;
     attrib_info *suffix;
-    if (*ext == '.')
+    if (*ext == '.') {
         ++ext;
+    }
     if (!m->remove_mappings) {
         m->remove_mappings = apr_array_make(cmd->pool, 4, sizeof(*suffix));
     }
-    suffix = (attrib_info *) apr_array_push(m->remove_mappings);
+    suffix = (attrib_info *)apr_array_push(m->remove_mappings);
     suffix->name = apr_pstrdup(cmd->pool, ext);
     ap_str_tolower(suffix->name);
     suffix->offset = (int) (long) cmd->info;
     return NULL;
 }
 
@@ -337,112 +339,123 @@
 static const char *multiviews_match(cmd_parms *cmd, void *m_, 
                                     const char *include)
 {
     mime_dir_config *m = (mime_dir_config *) m_;
 
     if (strcasecmp(include, "Any") == 0) {
-        if (m->multimatch && (m->multimatch & ~MULTIMATCH_ANY))
+        if (m->multimatch && (m->multimatch & ~MULTIMATCH_ANY)) {
             return "Any is incompatible with NegotiatedOnly, "
                    "Filters and Handlers";
+        }
         m->multimatch |= MULTIMATCH_ANY;
     }
     else if (strcasecmp(include, "NegotiatedOnly") == 0) {
-        if (m->multimatch && (m->multimatch & ~MULTIMATCH_NEGOTIATED))
+        if (m->multimatch && (m->multimatch & ~MULTIMATCH_NEGOTIATED)) {
             return "Any is incompatible with NegotiatedOnly, "
                    "Filters and Handlers";
+        }
         m->multimatch |= MULTIMATCH_NEGOTIATED;
     }
     else if (strcasecmp(include, "Filters") == 0) {
         if (m->multimatch && (m->multimatch & (MULTIMATCH_NEGOTIATED 
-                                             | MULTIMATCH_ANY)))
+                                             | MULTIMATCH_ANY))) {
             return "Filters is incompatible with Any and NegotiatedOnly";
+        }
         m->multimatch |= MULTIMATCH_FILTERS;
     }
     else if (strcasecmp(include, "Handlers") == 0) {
         if (m->multimatch && (m->multimatch & (MULTIMATCH_NEGOTIATED 
-                                             | MULTIMATCH_ANY)))
+                                             | MULTIMATCH_ANY))) {
             return "Handlers is incompatible with Any and NegotiatedOnly";
+        }
         m->multimatch |= MULTIMATCH_HANDLERS;
     }
-    else 
+    else {
         return "Unrecognized option";
+    }
 
     return NULL;
 }
 
 static const command_rec mime_cmds[] =
 {
-AP_INIT_ITERATE2("AddCharset", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, charset_type), OR_FILEINFO,
-     "a charset (e.g., iso-2022-jp), followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddEncoding", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, encoding_type), OR_FILEINFO,
-     "an encoding (e.g., gzip), followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddHandler", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, handler), OR_FILEINFO,
-     "a handler name followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddInputFilter", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, input_filters), OR_FILEINFO,
-     "input filter name (or ; delimited names) followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddLanguage", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, language_type), OR_FILEINFO,
-     "a language (e.g., fr), followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddOutputFilter", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, output_filters), OR_FILEINFO, 
-     "output filter name (or ; delimited names) followed by one or more file extensions"),
-AP_INIT_ITERATE2("AddType", add_extension_info, 
-         (void *)APR_XtOffsetOf(extension_info, forced_type), OR_FILEINFO, 
-     "a mime type followed by one or more file extensions"),
-AP_INIT_TAKE1("DefaultLanguage", ap_set_string_slot,
-       (void*)APR_XtOffsetOf(mime_dir_config, default_language), OR_FILEINFO,
-     "language to use for documents with no other language file extension"),
-AP_INIT_ITERATE("MultiviewsMatch", multiviews_match, NULL, OR_FILEINFO,
-     "NegotiatedOnly (default), Handlers and/or Filters, or Any"),
-AP_INIT_ITERATE("RemoveCharset", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, charset_type), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveEncoding", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, encoding_type), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveHandler", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, handler), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveInputFilter", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, input_filters), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveLanguage", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, language_type), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveOutputFilter", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, output_filters), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_ITERATE("RemoveType", remove_extension_info, 
-        (void *)APR_XtOffsetOf(extension_info, forced_type), OR_FILEINFO,
-     "one or more file extensions"),
-AP_INIT_TAKE1("TypesConfig", set_types_config, NULL, RSRC_CONF,
-     "the MIME types config file"),
+    AP_INIT_ITERATE2("AddCharset", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, charset_type), OR_FILEINFO,
+        "a charset (e.g., iso-2022-jp), followed by one or more "
+        "file extensions"),
+    AP_INIT_ITERATE2("AddEncoding", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, encoding_type), OR_FILEINFO,
+        "an encoding (e.g., gzip), followed by one or more file extensions"),
+    AP_INIT_ITERATE2("AddHandler", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, handler), OR_FILEINFO,
+        "a handler name followed by one or more file extensions"),
+    AP_INIT_ITERATE2("AddInputFilter", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, input_filters), OR_FILEINFO,
+        "input filter name (or ; delimited names) followed by one or "
+        "more file extensions"),
+    AP_INIT_ITERATE2("AddLanguage", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, language_type), OR_FILEINFO,
+        "a language (e.g., fr), followed by one or more file extensions"),
+    AP_INIT_ITERATE2("AddOutputFilter", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, output_filters), OR_FILEINFO, 
+        "output filter name (or ; delimited names) followed by one or "
+        "more file extensions"),
+    AP_INIT_ITERATE2("AddType", add_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, forced_type), OR_FILEINFO, 
+        "a mime type followed by one or more file extensions"),
+    AP_INIT_TAKE1("DefaultLanguage", ap_set_string_slot,
+        (void*)APR_OFFSETOF(mime_dir_config, default_language), OR_FILEINFO,
+        "language to use for documents with no other language file extension"),
+    AP_INIT_ITERATE("MultiviewsMatch", multiviews_match, NULL, OR_FILEINFO,
+        "NegotiatedOnly (default), Handlers and/or Filters, or Any"),
+    AP_INIT_ITERATE("RemoveCharset", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, charset_type), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveEncoding", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, encoding_type), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveHandler", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, handler), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveInputFilter", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, input_filters), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveLanguage", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, language_type), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveOutputFilter", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, output_filters), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_ITERATE("RemoveType", remove_extension_info, 
+        (void *)APR_OFFSETOF(extension_info, forced_type), OR_FILEINFO,
+        "one or more file extensions"),
+    AP_INIT_TAKE1("TypesConfig", set_types_config, NULL, RSRC_CONF,
+        "the MIME types config file"),
     {NULL}
 };
 
 static apr_hash_t *mime_type_extensions;
 
 static int mime_post_config(apr_pool_t *p, apr_pool_t *plog, apr_pool_t *ptemp, server_rec *s)
 {
     ap_configfile_t *f;
     char l[MAX_STRING_LEN];
-    const char *types_confname = ap_get_module_config(s->module_config, &mime_module);
+    const char *types_confname = ap_get_module_config(s->module_config,
+                                                      &mime_module);
     apr_status_t status;
 
-    if (!types_confname)
+    if (!types_confname) {
         types_confname = AP_TYPES_CONFIG_FILE;
+    }
 
     types_confname = ap_server_root_relative(p, types_confname);
     if (!types_confname) {
         ap_log_error(APLOG_MARK, APLOG_ERR, APR_EBADPATH, s,
 		     "Invalid mime types config path %s", 
-                     (const char *)ap_get_module_config(s->module_config, &mime_module));
+                     (const char *)ap_get_module_config(s->module_config,
+                                                        &mime_module));
         return HTTP_INTERNAL_SERVER_ERROR;
     }
     if ((status = ap_pcfg_openfile(&f, ptemp, types_confname)) 
                 != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_ERR, status, s,
 		     "could not open mime types config file %s.", 
@@ -452,14 +465,15 @@
 
     mime_type_extensions = apr_hash_make(p);
 
     while (!(ap_cfg_getline(l, MAX_STRING_LEN, f))) {
         const char *ll = l, *ct;
 
-        if (l[0] == '#')
+        if (l[0] == '#') {
             continue;
+        }
         ct = ap_getword_conf(p, &ll);
 
         while (ll[0]) {
             char *ext = ap_getword_conf(p, &ll);
             ap_str_tolower(ext);
             apr_hash_set(mime_type_extensions, ext, APR_HASH_KEY_STRING, ct);
@@ -476,13 +490,14 @@
     }
     if (*s == '\0') {
 	return (s);
     }
 
     /* skip prefixed white space */
-    for (; *s == ' ' || *s == '\t' || *s == '\n'; s++);
+    for (; *s == ' ' || *s == '\t' || *s == '\n'; s++)
+        ;
 
     return (s);
 }
 
 static char *zap_sp_and_dup(apr_pool_t *p, const char *start,
                             const char *end, apr_size_t *len)
@@ -530,75 +545,87 @@
     }
     return (res);
 }
 
 static content_type *analyze_ct(request_rec *r, const char *s)
 {
-    const char *cp, *mp, *tmp;
+    const char *cp, *mp;
     char *attribute, *value;
     int quoted = 0;
     server_rec * ss = r->server;
-    apr_pool_t  * p = r->pool;
+    apr_pool_t * p = r->pool;
 
     content_type *ctp;
     param *pp, *npp;
 
     /* initialize ctp */
-    ctp = (content_type *) apr_palloc(p, sizeof(content_type));
+    ctp = (content_type *)apr_palloc(p, sizeof(content_type));
     ctp->type = NULL;
     ctp->subtype = NULL;
     ctp->param = NULL;
 
     mp = s;
 
     /* getting a type */
-    if (!(cp = ap_strchr_c(mp, '/'))) {
+    cp = mp;
+    while (apr_isspace(*cp)) {
+        cp++;
+    }
+    if (!*cp) {
 	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
 		     "mod_mime: analyze_ct: cannot get media type from '%s'",
 		     (const char *) mp);
 	return (NULL);
     }
-    ctp->type = zap_sp_and_dup(p, mp, cp, NULL);
-    if (ctp->type == NULL || *(ctp->type) == '\0') {
+    ctp->type = cp;
+    do {
+        cp++;
+    } while (*cp && (*cp != '/') && !apr_isspace(*cp) && (*cp != ';'));
+    if (!*cp || (*cp == ';')) {
 	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
-		     "Cannot get media subtype.");
+                     "Cannot get media type from '%s'",
+                     (const char *) mp);
 	return (NULL);
     }
-    for (tmp = ctp->type; *tmp; tmp++) {
-        if ((*tmp == ';') || (*tmp == ' ') || (*tmp == '\t')) {
-            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
-                         "Cannot get media subtype.");
-            return (NULL);
-        }
+    while (apr_isspace(*cp)) {
+        cp++;
+    }
+    if (*cp != '/') {
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
+                     "mod_mime: analyze_ct: cannot get media type from '%s'",
+                     (const char *) mp);
+        return (NULL);
     }
+    ctp->type_len = cp - ctp->type;
 
-    /* getting a subtype */
-    cp++;
-    mp = cp;
+    cp++; /* skip the '/' */
 
-    for (; *cp != ';' && *cp != '\0'; cp++)
-        continue;
-    ctp->subtype = zap_sp_and_dup(p, mp, cp, NULL);
-    if ((ctp->subtype == NULL) || (*(ctp->subtype) == '\0')) {
+    /* getting a subtype */
+    while (apr_isspace(*cp)) {
+        cp++;
+    }
+    if (!*cp) {
 	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
 		     "Cannot get media subtype.");
 	return (NULL);
     }
-    for (tmp = ctp->subtype; *tmp; tmp++) {
-        if ((*tmp == ' ') || (*tmp == '\t')) {
-            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
-                         "Cannot get media subtype.");
-            return (NULL);
-        }
+    ctp->subtype = cp;
+    do {
+        cp++;
+    } while (*cp && !apr_isspace(*cp) && (*cp != ';'));
+    ctp->subtype_len = cp - ctp->subtype;
+    while (apr_isspace(*cp)) {
+        cp++;
     }
+
     if (*cp == '\0') {
         return (ctp);
     }
 
     /* getting parameters */
-    cp++;
+    cp++; /* skip the ';' */
     cp = zap_sp(cp);
     if (cp == NULL || *cp == '\0') {
 	ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ss,
 		     "Cannot get media parameter.");
 	return (NULL);
     }
@@ -742,39 +769,42 @@
 
     if (r->finfo.filetype == APR_DIR) {
         ap_set_content_type(r, DIR_MAGIC_TYPE);
         return OK;
     }
 
-    conf = (mime_dir_config *) ap_get_module_config(r->per_dir_config,
-                                                    &mime_module);
+    conf = (mime_dir_config *)ap_get_module_config(r->per_dir_config,
+                                                   &mime_module);
     exception_list = apr_array_make(r->pool, 2, sizeof(char *));
 
     /* Always drop the path leading up to the file name.
      */
-    if ((fn = strrchr(r->filename, '/')) == NULL)
+    if ((fn = strrchr(r->filename, '/')) == NULL) {
         fn = r->filename;
-    else
+    }
+    else {
         ++fn;
+    }
 
     /* The exception list keeps track of those filename components that
      * are not associated with extensions indicating metadata.
      * The base name is always the first exception (i.e., "txt.html" has
      * a basename of "txt" even though it might look like an extension).
      */
     ext = ap_getword(r->pool, &fn, '.');
-    *((const char **) apr_array_push(exception_list)) = ext;
+    *((const char **)apr_array_push(exception_list)) = ext;
 
     /* Parse filename extensions which can be in any order 
      */
     while (*fn && (ext = ap_getword(r->pool, &fn, '.'))) {
         const extension_info *exinfo = NULL;
         int found;
 
-        if (*ext == '\0')  /* ignore empty extensions "bad..html" */
+        if (*ext == '\0') {  /* ignore empty extensions "bad..html" */
             continue;
+        }
 
         found = 0;
 
         ap_str_tolower(ext);
 
         if (conf->extension_mappings != NULL) {
@@ -799,22 +829,24 @@
 
             if (exinfo->charset_type) {
                 charset = exinfo->charset_type;
                 found = 1;
             }
             if (exinfo->language_type) {
-                if (!r->content_languages)
+                if (!r->content_languages) {
                     r->content_languages = apr_array_make(r->pool, 2,
                                                           sizeof(char *));
-                    *((const char **) apr_array_push(r->content_languages))
-                                          = exinfo->language_type;
+                }
+                *((const char **)apr_array_push(r->content_languages))
+                    = exinfo->language_type;
                 found = 1;
             }
             if (exinfo->encoding_type) {
-                if (!r->content_encoding)
+                if (!r->content_encoding) {
                     r->content_encoding = exinfo->encoding_type;
+                }
                 else {
                     /* XXX should eliminate duplicate entities */
                     r->content_encoding = apr_pstrcat(r->pool,
                                                       r->content_encoding,
                                                       ", ",
                                                       exinfo->encoding_type,
@@ -825,43 +857,48 @@
             /* The following extensions are not 'Found'.  That is, they don't
              * make any contribution to metadata negotation, so they must have
              * been explicitly requested by name. 
              */
             if (exinfo->handler && r->proxyreq == PROXYREQ_NONE) {
                 r->handler = exinfo->handler;
-                if (conf->multimatch & MULTIMATCH_HANDLERS)
+                if (conf->multimatch & MULTIMATCH_HANDLERS) {
                     found = 1;
+                }
             }
             /* XXX Two significant problems; 1, we don't check to see if we are
              * setting redundant filters.    2, we insert these in the types config
              * hook, which may be too early (dunno.)
              */
             if (exinfo->input_filters && r->proxyreq == PROXYREQ_NONE) {
                 const char *filter, *filters = exinfo->input_filters;
                 while (*filters 
                     && (filter = ap_getword(r->pool, &filters, ';'))) {
                     ap_add_input_filter(filter, NULL, r, r->connection);
                 }
-                if (conf->multimatch & MULTIMATCH_FILTERS)
+                if (conf->multimatch & MULTIMATCH_FILTERS) {
                     found = 1;
+                }
             }
             if (exinfo->output_filters && r->proxyreq == PROXYREQ_NONE) {
                 const char *filter, *filters = exinfo->output_filters;
                 while (*filters 
                     && (filter = ap_getword(r->pool, &filters, ';'))) {
                     ap_add_output_filter(filter, NULL, r, r->connection);
                 }
-                if (conf->multimatch & MULTIMATCH_FILTERS)
+                if (conf->multimatch & MULTIMATCH_FILTERS) {
                     found = 1;
+                }
             }
         }
 
-        if (found || (conf->multimatch & MULTIMATCH_ANY))
+        if (found || (conf->multimatch & MULTIMATCH_ANY)) {
             found_metadata = 1;
-        else
+        }
+        else {
             *((const char **) apr_array_push(exception_list)) = ext;
+        }
     }
 
     /*
      * Need to set a notes entry on r for unrecognized elements.
      * Somebody better claim them!  If we did absolutely nothing,
      * skip the notes to alert mod_negotiation we are clueless.
@@ -874,28 +911,42 @@
     if (r->content_type) {
 	content_type *ctp;
 	int override = 0;
 
 	if ((ctp = analyze_ct(r, r->content_type))) {
 	    param *pp = ctp->param;
-	    ap_set_content_type(r, apr_pstrcat(r->pool, ctp->type, "/",
-                                               ctp->subtype, NULL));
+            char *base_content_type = apr_palloc(r->pool, ctp->type_len +
+                                                 ctp->subtype_len +
+                                                 sizeof("/"));
+            char *tmp = base_content_type;
+            memcpy(tmp, ctp->type, ctp->type_len);
+            tmp += ctp->type_len;
+            *tmp++ = '/';
+            memcpy(tmp, ctp->subtype, ctp->subtype_len);
+            tmp += ctp->subtype_len;
+            *tmp = 0;
+            ap_set_content_type(r, base_content_type);
 	    while (pp != NULL) {
 		if (charset && !strcmp(pp->attr, "charset")) {
 		    if (!override) {
-			ap_set_content_type(r, apr_pstrcat(r->pool, r->content_type,
-                                                           "; charset=", charset,
-                                                           NULL));
+                        ap_set_content_type(r,
+                                            apr_pstrcat(r->pool,
+                                                        r->content_type,
+                                                        "; charset=",
+                                                        charset,
+                                                        NULL));
 			override = 1;
 		    }
 		}
 		else {
-		    ap_set_content_type(r, apr_pstrcat(r->pool, r->content_type,
-                                                       "; ", pp->attr,
-                                                       "=", pp->val,
-                                                       NULL));
+                    ap_set_content_type(r,
+                                        apr_pstrcat(r->pool,
+                                                    r->content_type,
+                                                    "; ", pp->attr,
+                                                    "=", pp->val,
+                                                    NULL));
 		}
 		pp = pp->next;
 	    }
 	    if (charset && !override) {
 		ap_set_content_type(r, apr_pstrcat(r->pool, r->content_type,
                                                    "; charset=", charset,
@@ -908,34 +959,36 @@
      * and we have a DefaultLanguage setting in force
      */
 
     if (!r->content_languages && conf->default_language) {
         const char **new;
 
-        if (!r->content_languages)
+        if (!r->content_languages) {
             r->content_languages = apr_array_make(r->pool, 2, sizeof(char *));
-        new = (const char **) apr_array_push(r->content_languages);
+        }
+        new = (const char **)apr_array_push(r->content_languages);
         *new = conf->default_language;
     }
 
-    if (!r->content_type)
+    if (!r->content_type) {
         return DECLINED;
+    }
 
     return OK;
 }
 
 static void register_hooks(apr_pool_t *p)
 {
     ap_hook_post_config(mime_post_config,NULL,NULL,APR_HOOK_MIDDLE);
     ap_hook_type_checker(find_ct,NULL,NULL,APR_HOOK_MIDDLE);
- /* 
-  * this hook seems redundant ... is there any reason a type checker isn't
-  * allowed to do this already?  I'd think that fixups in general would be
-  * the last opportunity to get the filters right.
-  * ap_hook_insert_filter(mime_insert_filters,NULL,NULL,APR_HOOK_MIDDLE);
-  */
+    /* 
+     * this hook seems redundant ... is there any reason a type checker isn't
+     * allowed to do this already?  I'd think that fixups in general would be
+     * the last opportunity to get the filters right.
+     * ap_hook_insert_filter(mime_insert_filters,NULL,NULL,APR_HOOK_MIDDLE);
+     */
 }
 
 module AP_MODULE_DECLARE_DATA mime_module = {
     STANDARD20_MODULE_STUFF,
     create_mime_dir_config,	/* create per-directory config structure */
     merge_mime_dir_configs,	/* merge per-directory config structures */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/http: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/loggers: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/loggers: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/loggers/mod_log_config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/loggers/mod_log_config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/loggers/mod_log_config.c	2002-03-17 02:26:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/loggers/mod_log_config.c	2002-06-09 12:48:41.000000000 +0800
@@ -452,12 +452,23 @@
     apr_size_t retcode;
     char tstr[MAX_STRING_LEN];
     apr_strftime(tstr, &retcode, sizeof(tstr), a, xt);
     return apr_pstrdup(r->pool, tstr);
 }
 
+#define DEFAULT_REQUEST_TIME_SIZE 32
+typedef struct {
+    unsigned t;
+    char timestr[DEFAULT_REQUEST_TIME_SIZE];
+    unsigned t_validate;
+} cached_request_time;
+
+#define TIME_CACHE_SIZE 4
+#define TIME_CACHE_MASK 3
+static cached_request_time request_time_cache[TIME_CACHE_SIZE];
+
 static const char *log_request_time(request_rec *r, char *a)
 {
     apr_time_exp_t xt;
 
     /*
 	hi.  i think getting the time again at the end of the request
@@ -467,43 +478,70 @@
 	process calculates the time to log, but then there's a context
 	switch before it writes and before that process is run again the
 	log rotation occurs) and they should just fix their tools rather
 	than force the server to pay extra cpu cycles.	if you've got
 	a problem with this, you can set the define.  -djg
     */
-#ifdef I_INSIST_ON_EXTRA_CYCLES_FOR_CLF_COMPLIANCE
-    ap_explode_recent_localtime(&xt, apr_time_now());
-#else
-    ap_explode_recent_localtime(&xt, r->request_time);
-#endif
     if (a && *a) {              /* Custom format */
         /* The custom time formatting uses a very large temp buffer
          * on the stack.  To avoid using so much stack space in the
          * common case where we're not using a custom format, the code
          * for the custom format in a separate function.  (That's why
          * log_request_time_custom is not inlined right here.)
          */
+#ifdef I_INSIST_ON_EXTRA_CYCLES_FOR_CLF_COMPLIANCE
+        ap_explode_recent_localtime(&xt, apr_time_now());
+#else
+        ap_explode_recent_localtime(&xt, r->request_time);
+#endif
         return log_request_time_custom(r, a, &xt);
     }
     else {                      /* CLF format */
-	char sign;
-	int timz;
-
-	timz = xt.tm_gmtoff;
-	if (timz < 0) {
-	    timz = -timz;
-	    sign = '-';
-	}
-	else {
-	    sign = '+';
+        /* This code uses the same technique as ap_explode_recent_localtime():
+         * optimistic caching with logic to detect and correct race conditions.
+         * See the comments in server/util_time.c for more information.
+         */
+        cached_request_time* cached_time = apr_palloc(r->pool,
+                                                      sizeof(*cached_time));
+#ifdef I_INSIST_ON_EXTRA_CYCLES_FOR_CLF_COMPLIANCE
+        apr_time_t request_time = apr_time_now();
+#else
+        apr_time_t request_time = r->request_time;
+#endif
+        unsigned t_seconds = (unsigned)(request_time / APR_USEC_PER_SEC);
+        unsigned i = t_seconds & TIME_CACHE_MASK;
+        memcpy(cached_time, &(request_time_cache[i]), sizeof(*cached_time));
+        if ((t_seconds != cached_time->t) ||
+            (t_seconds != cached_time->t_validate)) {
+
+            /* Invalid or old snapshot, so compute the proper time string
+             * and store it in the cache
+             */
+            char sign;
+            int timz;
+
+            ap_explode_recent_localtime(&xt, r->request_time);
+            timz = xt.tm_gmtoff;
+            if (timz < 0) {
+                timz = -timz;
+                sign = '-';
+            }
+            else {
+                sign = '+';
+            }
+            cached_time->t = t_seconds;
+            apr_snprintf(cached_time->timestr, DEFAULT_REQUEST_TIME_SIZE,
+                         "[%02d/%s/%d:%02d:%02d:%02d %c%.2d%.2d]",
+                         xt.tm_mday, apr_month_snames[xt.tm_mon],
+                         xt.tm_year+1900, xt.tm_hour, xt.tm_min, xt.tm_sec,
+                         sign, timz / (60*60), timz % (60*60));
+            cached_time->t_validate = t_seconds;
+            memcpy(&(request_time_cache[i]), cached_time,
+                   sizeof(*cached_time));
 	}
-
-        return apr_psprintf(r->pool, "[%02d/%s/%d:%02d:%02d:%02d %c%.2d%.2d]",
-                xt.tm_mday, apr_month_snames[xt.tm_mon], xt.tm_year+1900,
-                xt.tm_hour, xt.tm_min, xt.tm_sec,
-                sign, timz / (60*60), timz % (60*60));
+        return cached_time->timestr;
     }
 }
 
 static const char *log_request_duration(request_rec *r, char *a)
 {
     return apr_psprintf(r->pool, "%qd", (apr_time_now() - r->request_time) 
@@ -1070,13 +1108,13 @@
         if ((status = apr_file_open(&cls->log_fd, fname, xfer_flags,
                                     xfer_perms, p)) != APR_SUCCESS) {
             ap_log_error(APLOG_MARK, APLOG_ERR, status, s,
                          "could not open transfer log file %s.", fname);
             exit(1);
         }
-        apr_file_set_inherit(cls->log_fd);
+        apr_file_inherit_set(cls->log_fd);
     }
 #ifdef BUFFERED_LOGS
     cls->outcnt = 0;
 #endif
 
     return cls;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/loggers: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/config9.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/config9.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/config9.m4	2001-11-11 09:58:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/config9.m4	2002-05-21 05:00:27.000000000 +0800
@@ -14,13 +14,13 @@
 APACHE_MODULE(alias, translation of requests, , , yes)
 
 APACHE_MODULE(rewrite, regex URL translation, , , most, [
   APR_ADDTO(CFLAGS,-DNO_DBM_REWRITEMAP)
 ])
 
-dnl mod_so should only be built as a static DSO
+dnl mod_so should only be built as a static module
 if test "$enable_so" = "yes"; then
     enable_so="static"
 elif test "$enable_so" = "shared"; then
     AC_MSG_ERROR([mod_so can not be built as a shared DSO])
 fi
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_actions.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_actions.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_actions.c	2002-03-14 04:47:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_actions.c	2002-05-17 19:24:16.000000000 +0800
@@ -204,13 +204,13 @@
     action = r->handler ? r->handler :
 	ap_field_noparam(r->pool, r->content_type);
     if ((t = apr_table_get(conf->action_types,
 		       action ? action : ap_default_type(r)))) {
 	script = t;
 	if (r->finfo.filetype == 0) {
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 			"File does not exist: %s", r->filename);
 	    return HTTP_NOT_FOUND;
 	}
     }
 
     if (script == NULL)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_alias.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_alias.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_alias.c	2002-03-17 02:26:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_alias.c	2002-06-08 14:28:16.000000000 +0800
@@ -80,13 +80,13 @@
 
 typedef struct {
     const char *real;
     const char *fake;
     char *handler;
     regex_t *regexp;
-    int redir_status;		/* 301, 302, 303, 410, etc */
+    int redir_status;                /* 301, 302, 303, 410, etc */
 } alias_entry;
 
 typedef struct {
     apr_array_header_t *aliases;
     apr_array_header_t *redirects;
 } alias_server_conf;
@@ -116,24 +116,26 @@
 }
 
 static void *merge_alias_config(apr_pool_t *p, void *basev, void *overridesv)
 {
     alias_server_conf *a =
     (alias_server_conf *) apr_pcalloc(p, sizeof(alias_server_conf));
-    alias_server_conf *base = (alias_server_conf *) basev, *overrides = (alias_server_conf *) overridesv;
+    alias_server_conf *base = (alias_server_conf *) basev;
+    alias_server_conf *overrides = (alias_server_conf *) overridesv;
 
     a->aliases = apr_array_append(p, overrides->aliases, base->aliases);
     a->redirects = apr_array_append(p, overrides->redirects, base->redirects);
     return a;
 }
 
 static void *merge_alias_dir_config(apr_pool_t *p, void *basev, void *overridesv)
 {
     alias_dir_conf *a =
     (alias_dir_conf *) apr_pcalloc(p, sizeof(alias_dir_conf));
-    alias_dir_conf *base = (alias_dir_conf *) basev, *overrides = (alias_dir_conf *) overridesv;
+    alias_dir_conf *base = (alias_dir_conf *) basev;
+    alias_dir_conf *overrides = (alias_dir_conf *) overridesv;
     a->redirects = apr_array_append(p, overrides->redirects, base->redirects);
     return a;
 }
 
 static const char *add_alias_internal(cmd_parms *cmd, void *dummy,
 				      const char *f, const char *r,
@@ -241,13 +243,13 @@
 				const char *arg3)
 {
     return add_redirect_internal(cmd, dirconf, arg1, arg2, arg3, 0);
 }
 
 static const char *add_redirect2(cmd_parms *cmd, void *dirconf,
-                                const char *arg1, const char *arg2)
+                                 const char *arg1, const char *arg2)
 {
     return add_redirect_internal(cmd, dirconf, arg1, arg2, NULL, 0);
 }
 
 static const char *add_redirect_regex(cmd_parms *cmd, void *dirconf,
 				      const char *arg1, const char *arg2,
@@ -292,16 +294,18 @@
 	    /* any number of '/' in the alias matches any number in
 	     * the supplied URI, but there must be at least one...
 	     */
 	    if (*urip != '/')
 		return 0;
 
-	    while (*aliasp == '/')
+            do {
 		++aliasp;
-	    while (*urip == '/')
+            } while (*aliasp == '/');
+            do {
 		++urip;
+            } while (*urip == '/');
 	}
 	else {
 	    /* Other characters are compared literally */
 	    if (*urip++ != *aliasp++)
 		return 0;
 	}
@@ -317,25 +321,27 @@
      * doubled slashes)
      */
 
     return urip - uri;
 }
 
-static char *try_alias_list(request_rec *r, apr_array_header_t *aliases, int doesc, int *status)
+static char *try_alias_list(request_rec *r, apr_array_header_t *aliases,
+                            int doesc, int *status)
 {
     alias_entry *entries = (alias_entry *) aliases->elts;
     regmatch_t regm[10];
     char *found = NULL;
     int i;
 
     for (i = 0; i < aliases->nelts; ++i) {
 	alias_entry *p = &entries[i];
 	int l;
 
 	if (p->regexp) {
-	    if (!ap_regexec(p->regexp, r->uri, p->regexp->re_nsub + 1, regm, 0)) {
+            if (!ap_regexec(p->regexp, r->uri, p->regexp->re_nsub + 1, regm,
+                            0)) {
 		if (p->real) {
 		    found = ap_pregsub(r->pool, p->real, r->uri,
 				    p->regexp->re_nsub + 1, regm);
 		    if (found && doesc) {
                         apr_uri_t uri;
                         apr_uri_parse(r->pool, found, &uri);
@@ -372,13 +378,13 @@
 		else
 		    found = apr_pstrcat(r->pool, p->real, r->uri + l, NULL);
 	    }
 	}
 
 	if (found) {
-	    if (p->handler) {	/* Set handler, and leave a note for mod_cgi */
+            if (p->handler) {    /* Set handler, and leave a note for mod_cgi */
 		r->handler = p->handler;
 		apr_table_setn(r->notes, "alias-forced-type", r->handler);
 	    }
             /* XXX This is as SLOW as can be, next step, we optimize
              * and merge to whatever part of the found path was already
              * canonicalized.  After I finish eliminating os canonical.
@@ -402,14 +408,15 @@
 {
     ap_conf_vector_t *sconf = r->server->module_config;
     alias_server_conf *serverconf = ap_get_module_config(sconf, &alias_module);
     char *ret;
     int status;
 
-    if (r->uri[0] != '/' && r->uri[0] != '\0')
+    if (r->uri[0] != '/' && r->uri[0] != '\0') {
 	return DECLINED;
+    }
 
     if ((ret = try_alias_list(r, serverconf->redirects, 1, &status)) != NULL) {
 	if (ap_is_HTTP_REDIRECT(status)) {
 	    /* include QUERY_STRING if any */
 	    if (r->args) {
 		ret = apr_pstrcat(r->pool, ret, "?", r->args, NULL);
@@ -440,20 +447,20 @@
     if ((ret = try_alias_list(r, dirconf->redirects, 1, &status)) != NULL) {
         if (ap_is_HTTP_REDIRECT(status)) {
             if (ret[0] == '/') {
                 char *orig_target = ret;
 
                 ret = ap_construct_url(r->pool, ret, r);
-                ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                               "incomplete redirection target of '%s' for "
                               "URI '%s' modified to '%s'",
                               orig_target, r->uri, ret);
             }
             if (!ap_is_url(ret)) {
                 status = HTTP_INTERNAL_SERVER_ERROR;
-                ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                               "cannot redirect '%s' to '%s'; "
                               "target is not a valid absoluteURI or abs_path",
                               r->uri, ret);
             }
             else {
                 apr_table_setn(r->headers_out, "Location", ret);
@@ -464,22 +471,22 @@
 
     return DECLINED;
 }
 
 static void register_hooks(apr_pool_t *p)
 {
-    static const char * const aszPre[]={ "mod_userdir.c",NULL };
+    static const char * const aszSucc[]={ "mod_userdir.c", NULL };
 
-    ap_hook_translate_name(translate_alias_redir,aszPre,NULL,APR_HOOK_MIDDLE);
+    ap_hook_translate_name(translate_alias_redir,NULL,aszSucc,APR_HOOK_MIDDLE);
     ap_hook_fixups(fixup_redir,NULL,NULL,APR_HOOK_MIDDLE);
 }
 
 module AP_MODULE_DECLARE_DATA alias_module =
 {
     STANDARD20_MODULE_STUFF,
-    create_alias_dir_config,	/* dir config creater */
-    merge_alias_dir_config,	/* dir merger --- default is to override */
-    create_alias_config,	/* server config */
-    merge_alias_config,		/* merge server configs */
-    alias_cmds,			/* command apr_table_t */
-    register_hooks		/* register hooks */
+    create_alias_dir_config,       /* dir config creater */
+    merge_alias_dir_config,        /* dir merger --- default is to override */
+    create_alias_config,           /* server config */
+    merge_alias_config,            /* merge server configs */
+    alias_cmds,                    /* command apr_table_t */
+    register_hooks                 /* register hooks */
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_dir.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_dir.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_dir.c	2002-03-18 06:20:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_dir.c	2002-05-16 13:20:46.000000000 +0800
@@ -96,24 +96,23 @@
                     "a list of file names"),
     {NULL}
 };
 
 static void *create_dir_config(apr_pool_t *p, char *dummy)
 {
-    dir_config_rec *new =
-    (dir_config_rec *) apr_pcalloc(p, sizeof(dir_config_rec));
+    dir_config_rec *new = apr_pcalloc(p, sizeof(dir_config_rec));
 
     new->index_names = NULL;
     return (void *) new;
 }
 
 static void *merge_dir_configs(apr_pool_t *p, void *basev, void *addv)
 {
-    dir_config_rec *new = (dir_config_rec *) apr_pcalloc(p, sizeof(dir_config_rec));
-    dir_config_rec *base = (dir_config_rec *) basev;
-    dir_config_rec *add = (dir_config_rec *) addv;
+    dir_config_rec *new = apr_pcalloc(p, sizeof(dir_config_rec));
+    dir_config_rec *base = (dir_config_rec *)basev;
+    dir_config_rec *add = (dir_config_rec *)addv;
 
     new->index_names = add->index_names ? add->index_names : base->index_names;
     return new;
 }
 
 static int fixup_dir(request_rec *r)
@@ -131,13 +130,13 @@
     
     /* In case mod_mime wasn't present, and no handler was assigned. */
     if (!r->handler) {
         r->handler = DIR_MAGIC_TYPE;
     }
 
-    /* Never tollerate path_info on dir requests */
+    /* Never tolerate path_info on dir requests */
     if (r->path_info && *r->path_info) {
         return DECLINED;
     }
 
     /* Redirect requests that are not '/' terminated */
     if (r->uri[0] == '\0' || r->uri[strlen(r->uri) - 1] != '/') 
@@ -145,35 +144,37 @@
         char *ifile;
 
         /* Only redirect non-get requests if we have no note to warn
          * that this browser cannot handle redirs on non-GET requests 
          * (such as Microsoft's WebFolders). 
          */
-        if (r->method_number != M_GET
+        if ((r->method_number != M_GET)
                 && apr_table_get(r->subprocess_env, "redirect-carefully")) {
             return DECLINED;
         }
 
-        if (r->args != NULL)
+        if (r->args != NULL) {
             ifile = apr_pstrcat(r->pool, ap_escape_uri(r->pool, r->uri),
                                 "/", "?", r->args, NULL);
-        else
+        }
+        else {
             ifile = apr_pstrcat(r->pool, ap_escape_uri(r->pool, r->uri),
                                 "/", NULL);
+        }
 
         apr_table_setn(r->headers_out, "Location",
                        ap_construct_url(r->pool, ifile, r));
         return HTTP_MOVED_PERMANENTLY;
     }
 
-    if (strcmp(r->handler,DIR_MAGIC_TYPE)) {
+    if (strcmp(r->handler, DIR_MAGIC_TYPE)) {
         return DECLINED;
     }
 
-    d = (dir_config_rec *) ap_get_module_config(r->per_dir_config,
-                                                &dir_module);
+    d = (dir_config_rec *)ap_get_module_config(r->per_dir_config,
+                                               &dir_module);
 
     if (d->index_names) {
         names_ptr = (char **)d->index_names->elts;
         num_names = d->index_names->nelts;
     }
     else {
@@ -190,50 +191,53 @@
         /* Once upon a time args were handled _after_ the successful redirect.
          * But that redirect might then _refuse_ the given r->args, creating
          * a nasty tangle.  It seems safer to consider the r->args while we
          * determine if name_ptr is our viable index, and therefore set them
          * up correctly on redirect.
          */
-        if (r->args != NULL)
+        if (r->args != NULL) {
             name_ptr = apr_pstrcat(r->pool, name_ptr, "?", r->args, NULL);
+        }
 
         rr = ap_sub_req_lookup_uri(name_ptr, r, NULL);
 
         /* XXX: (filetype == APR_REG) - we can't use a non-file index??? */
         if (rr->status == HTTP_OK && rr->finfo.filetype == APR_REG) {
             ap_internal_fast_redirect(rr, r);
             return OK;
         }
             
         /* If the request returned a redirect, propagate it to the client */
 
-        if (ap_is_HTTP_REDIRECT(rr->status) ||
-            (rr->status == HTTP_NOT_ACCEPTABLE && num_names == 1) ||
-            (rr->status == HTTP_UNAUTHORIZED && num_names == 1)) {
+        if (ap_is_HTTP_REDIRECT(rr->status)
+            || (rr->status == HTTP_NOT_ACCEPTABLE && num_names == 1)
+            || (rr->status == HTTP_UNAUTHORIZED && num_names == 1)) {
 
             apr_pool_join(r->pool, rr->pool);
             error_notfound = rr->status;
             r->notes = apr_table_overlay(r->pool, r->notes, rr->notes);
             r->headers_out = apr_table_overlay(r->pool, r->headers_out,
-                                            rr->headers_out);
+                                               rr->headers_out);
             r->err_headers_out = apr_table_overlay(r->pool, r->err_headers_out,
-                                                rr->err_headers_out);
+                                                   rr->err_headers_out);
             return error_notfound;
         }
 
         /* If the request returned something other than 404 (or 200),
          * it means the module encountered some sort of problem. To be
          * secure, we should return the error, rather than allow autoindex
          * to create a (possibly unsafe) directory index.
          *
          * So we store the error, and if none of the listed files
          * exist, we return the last error response we got, instead
          * of a directory listing.
          */
-        if (rr->status && rr->status != HTTP_NOT_FOUND && rr->status != HTTP_OK)
+        if (rr->status && rr->status != HTTP_NOT_FOUND
+                && rr->status != HTTP_OK) {
             error_notfound = rr->status;
+        }
 
         ap_destroy_sub_req(rr);
     }
 
     if (error_notfound) {
         return error_notfound;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_imap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_imap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_imap.c	2002-04-29 10:36:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_imap.c	2002-05-18 12:13:13.000000000 +0800
@@ -160,21 +160,21 @@
 }
 
 
 static const command_rec imap_cmds[] =
 {
     AP_INIT_TAKE1("ImapMenu", ap_set_string_slot,
-                  (void *) APR_XtOffsetOf(imap_conf_rec, imap_menu), OR_INDEXES,
+                  (void *)APR_OFFSETOF(imap_conf_rec, imap_menu), OR_INDEXES,
                   "the type of menu generated: none, formatted, semiformatted, "
                   "unformatted"),
     AP_INIT_TAKE1("ImapDefault", ap_set_string_slot,
-                  (void *) APR_XtOffsetOf(imap_conf_rec, imap_default), OR_INDEXES,
+                  (void *)APR_OFFSETOF(imap_conf_rec, imap_default), OR_INDEXES,
                   "the action taken if no match: error, nocontent, referer, "
                   "menu, URL"),
     AP_INIT_TAKE1("ImapBase", ap_set_string_slot,
-                  (void *) APR_XtOffsetOf(imap_conf_rec, imap_base), OR_INDEXES,
+                  (void *)APR_OFFSETOF(imap_conf_rec, imap_base), OR_INDEXES,
                   "the base for all URL's: map, referer, URL (or start of)"),
     {NULL}
 };
 
 static int pointinrect(const double point[2], double coords[MAXVERTS][2])
 {
@@ -417,13 +417,13 @@
 	return ap_construct_url(r->pool, "/", r);
     }
 
     /* must be a relative URL to be combined with base */
     if (ap_strchr_c(base, '/') == NULL && (!strncmp(value, "../", 3)
         || !strcmp(value, ".."))) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                     "invalid base directive in map file: %s", r->uri);
         return NULL;
     }
     my_base = apr_pstrdup(r->pool, base);
     string_pos = my_base;
     while (*string_pos) {
@@ -477,13 +477,13 @@
             }
 
             value += 2;         /* jump over the '..' that we found in the
                                    value */
         }
         else if (directory) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                         "invalid directory name in map file: %s", r->uri);
             return NULL;
         }
 
         if (!strncmp(value, "/../", 4) || !strcmp(value, "/..")) {
             value++;            /* step over the '/' if there are more '..'
@@ -884,13 +884,13 @@
     }
 
     return HTTP_INTERNAL_SERVER_ERROR;        /* If we make it this far,
                                                  we failed. They lose! */
 
 need_2_fields:
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		"map file %s, line %d syntax error: requires at "
                 "least two fields", r->uri, imap->line_number);
     /* fall through */
 menu_bail:
     ap_cfg_closefile(imap);
     if (showmenu) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_negotiation.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_negotiation.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_negotiation.c	2002-03-29 16:17:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_negotiation.c	2002-05-17 19:24:16.000000000 +0800
@@ -649,13 +649,13 @@
                 neg->dont_fiddle_headers = 1; 
             }
         }
     }
 
 #ifdef NEG_DEBUG
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
             "dont_fiddle_headers=%d use_rvsa=%d ua_supports_trans=%d "
             "send_alternates=%d, may_choose=%d",
             neg->dont_fiddle_headers, neg->use_rvsa,  
             neg->ua_supports_trans, neg->send_alternates, neg->may_choose);
 #endif
 
@@ -874,24 +874,24 @@
 
     for ( ; *cp && *cp != ':' ; ++cp) {
         *cp = apr_tolower(*cp);
     }
 
     if (!*cp) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Syntax error in type map, no ':' in %s for header %s", 
                       r->filename, header);
         return NULL;
     }
 
     do {
         ++cp;
     } while (*cp && apr_isspace(*cp));
 
     if (!*cp) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "Syntax error in type map --- no header body: %s for %s",
                       r->filename, header);
         return NULL;
     }
 
     return cp;
@@ -974,13 +974,13 @@
                 char *tag = apr_pstrdup(neg->pool, body);
                 char *eol = strchr(tag, '\0');
                 apr_size_t len = MAX_STRING_LEN;
                 while (--eol >= tag && apr_isspace(*eol)) 
                     *eol = '\0';
                 if ((mime_info.body = get_body(buffer, &len, tag, *map)) < 0) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "Syntax error in type map, no end tag '%s'"
                                   "found in %s for Body: content.", 
                                   tag, r->filename);
                      break;
                 }
                 mime_info.bytes = len;
@@ -1229,13 +1229,13 @@
 
     /* We found some file names that matched.  None could be served.
      * Rather than fall out to autoindex or some other mapper, this
      * request must die.
      */
     if (anymatch && !neg->avail_vars->nelts) {
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		      "Negotiation: discovered file(s) matching request: %s"
                       " (None could be negotiated).", 
                       r->filename);
         return HTTP_NOT_FOUND;
     }
 
@@ -2001,13 +2001,13 @@
     * is for the algorithm to operate on the best available precision
     * regardless of who runs it.  Since the above calculation may
     * result in significant variance at 1e-12, rounding would be bogus.
     */
 
 #ifdef NEG_DEBUG
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
            "Variant: file=%s type=%s lang=%s sourceq=%1.3f "
            "mimeq=%1.3f langq=%1.3f charq=%1.3f encq=%1.3f "
            "q=%1.5f definite=%d",            
             (variant->file_name ? variant->file_name : ""),
             (variant->mime_type ? variant->mime_type : ""),
             (variant->content_languages
@@ -2072,13 +2072,13 @@
 
     /* First though, eliminate this variant if it is not
      * acceptable by type, charset, encoding or language.
      */
 
 #ifdef NEG_DEBUG
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
            "Variant: file=%s type=%s lang=%s sourceq=%1.3f "
            "mimeq=%1.3f langq=%1.3f langidx=%d charq=%1.3f encq=%1.3f ",
             (variant->file_name ? variant->file_name : ""),
             (variant->mime_type ? variant->mime_type : ""),
             (variant->content_languages
              ? apr_array_pstrcat(neg->pool, variant->content_languages, ',')
@@ -2728,13 +2728,13 @@
              * HTTP/1.0 specification).
              */
             return HTTP_MULTIPLE_CHOICES;
         }
         
         if (!*bestp) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "no acceptable variant: %s", r->filename);
             return HTTP_NOT_ACCEPTABLE;
         }
     }
 
     /* Variant selection chose a variant */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_rewrite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_rewrite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_rewrite.c	2002-04-22 18:27:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_rewrite.c	2002-06-11 22:43:04.000000000 +0800
@@ -87,12 +87,13 @@
 **      rse@engelschall.com
 **      www.engelschall.com
 */
 
 #include "apr.h"
 #include "apr_strings.h"
+#include "apr_hash.h"
 #include "apr_user.h"
 #include "apr_lib.h"
 #include "apr_signal.h"
 #include "apr_global_mutex.h"
 
 #define APR_WANT_STRFUNC
@@ -177,12 +178,15 @@
      * MODULE-DEFINITION-END
      */
 
     /* the module (predeclaration) */
 module AP_MODULE_DECLARE_DATA rewrite_module;
 
+    /* rewritemap int: handler function registry */
+static apr_hash_t *mapfunc_hash;
+
     /* the cache */
 static cache *cachep;
 
     /* whether proxy module is available or not */
 static int proxy_available;
 
@@ -447,33 +451,25 @@
 #else
         return apr_pstrdup(cmd->pool, "RewriteMap: cannot use NDBM mapfile, "
                           "because no NDBM support is compiled in");
 #endif
     }
     else if (strncmp(a2, "prg:", 4) == 0) {
-        newmap->type = MAPTYPE_PRG;
-        newmap->datafile = a2+4;
-        newmap->checkfile = a2+4;
+        newmap->type      = MAPTYPE_PRG;
+        apr_tokenize_to_argv(a2 + 4, &newmap->argv, cmd->pool);
+        newmap->datafile  = NULL;
+        newmap->checkfile = newmap->argv[0];
+
     }
     else if (strncmp(a2, "int:", 4) == 0) {
         newmap->type      = MAPTYPE_INT;
         newmap->datafile  = NULL;
         newmap->checkfile = NULL;
-        if (strcmp(a2+4, "tolower") == 0) {
-            newmap->func = rewrite_mapfunc_tolower;
-        }
-        else if (strcmp(a2+4, "toupper") == 0) {
-            newmap->func = rewrite_mapfunc_toupper;
-        }
-        else if (strcmp(a2+4, "escape") == 0) {
-            newmap->func = rewrite_mapfunc_escape;
-        }
-        else if (strcmp(a2+4, "unescape") == 0) {
-            newmap->func = rewrite_mapfunc_unescape;
-        }
-        else if (sconf->state == ENGINE_ENABLED) {
+        newmap->func      = (char *(*)(request_rec *,char *))
+                            apr_hash_get(mapfunc_hash, a2+4, strlen(a2+4));
+        if ((sconf->state == ENGINE_ENABLED) && (newmap->func == NULL)) {
             return apr_pstrcat(cmd->pool, "RewriteMap: internal map not found:",
                               a2+4, NULL);
         }
     }
     else {
         newmap->type      = MAPTYPE_TXT;
@@ -484,13 +480,13 @@
     newmap->fpout = NULL;
 
     if (newmap->checkfile && (sconf->state == ENGINE_ENABLED)
         && (apr_stat(&st, newmap->checkfile, APR_FINFO_MIN, 
                      cmd->pool) != APR_SUCCESS)) {
         return apr_pstrcat(cmd->pool,
-                          "RewriteMap: map file or program not found:",
+                          "RewriteMap: map file not found:",
                           newmap->checkfile, NULL);
     }
 
     return NULL;
 }
 
@@ -918,21 +914,37 @@
 }
 
 
 /*
 **
 **  Global Module Initialization
-**  [called from read_config() after all
-**  config commands were already called]
 **
 */
 
-static int init_module(apr_pool_t *p,
-                        apr_pool_t *plog,
-                        apr_pool_t *ptemp,
-                        server_rec *s)
+static int pre_config(apr_pool_t *pconf,
+                      apr_pool_t *plog,
+                      apr_pool_t *ptemp)
+{
+    APR_OPTIONAL_FN_TYPE(ap_register_rewrite_mapfunc) *map_pfn_register;
+
+    /* register int: rewritemap handlers */
+    mapfunc_hash = apr_hash_make(pconf);
+    map_pfn_register = APR_RETRIEVE_OPTIONAL_FN(ap_register_rewrite_mapfunc);
+    if (map_pfn_register) {
+        map_pfn_register("tolower", rewrite_mapfunc_tolower);
+        map_pfn_register("toupper", rewrite_mapfunc_toupper);
+        map_pfn_register("escape", rewrite_mapfunc_escape);
+        map_pfn_register("unescape", rewrite_mapfunc_unescape);
+    }
+    return OK;
+}
+
+static int post_config(apr_pool_t *p,
+                       apr_pool_t *plog,
+                       apr_pool_t *ptemp,
+                       server_rec *s)
 {
     apr_status_t rv;
     void *data;
     int first_time = 0;
     const char *userdata_key = "rewrite_init_module";
 
@@ -951,23 +963,40 @@
                                       APR_LOCK_DEFAULT, p)) != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
                      "mod_rewrite: could not create rewrite_log_lock");
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
-    rewritelock_create(s, p);
+#if APR_USE_SYSVSEM_SERIALIZE
+    rv = unixd_set_global_mutex_perms(rewrite_log_lock);
+    if (rv != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_CRIT, rv, s,
+                     "mod_rewrite: Could not set permissions on "
+                     "rewrite_log_lock; check User and Group directives");
+        return HTTP_INTERNAL_SERVER_ERROR;
+    }
+#endif
+
+    rv = rewritelock_create(s, p);
+    if (rv != APR_SUCCESS) {
+        return HTTP_INTERNAL_SERVER_ERROR;
+    }
+
     apr_pool_cleanup_register(p, (void *)s, rewritelock_remove, apr_pool_cleanup_null);
 
     /* step through the servers and
      * - open each rewriting logfile
      * - open the RewriteMap prg:xxx programs
      */
     for (; s; s = s->next) {
         open_rewritelog(s, p);
-        if (!first_time)
-           run_rewritemap_programs(s, p);
+        if (!first_time) {
+            if (run_rewritemap_programs(s, p) != APR_SUCCESS) {
+                return HTTP_INTERNAL_SERVER_ERROR;
+            }
+        }
     }
     return OK;
 }
 
 
 /*
@@ -1117,13 +1146,13 @@
             /* it should be go on as an internal proxy request */
 
             /* check if the proxy module is enabled, so
              * we can actually use it!
              */
             if (!proxy_available) {
-                ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                              "attempt to make remote request from mod_rewrite "
                              "without proxy enabled: %s", r->filename);
                 return HTTP_FORBIDDEN;
             }
 
             /* make sure the QUERY_STRING and
@@ -1360,13 +1389,13 @@
     /*
      *  only do something under runtime if the engine is really enabled,
      *  for this directory, else return immediately!
      */
     if (!(ap_allow_options(r) & (OPT_SYM_LINKS | OPT_SYM_OWNER))) {
         /* FollowSymLinks is mandatory! */
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                      "Options FollowSymLinks or SymLinksIfOwnerMatch is off "
                      "which implies that RewriteRule directive is forbidden: "
                      "%s", r->filename);
         return HTTP_FORBIDDEN;
     }
     else {
@@ -2778,13 +2807,13 @@
                 else {
                     rewritelog(r, 5, "map lookup FAILED: map=%s key=%s",
                                s->name, key);
                 }
             }
             else if (s->type == MAPTYPE_INT) {
-                if ((value = lookup_map_internal(r, s->func, key)) != NULL) {
+                if ((value = s->func(r, key)) != NULL) {
                     rewritelog(r, 5, "map lookup OK: map=%s key=%s -> val=%s",
                                s->name, key, value);
                     return value;
                 }
                 else {
                     rewritelog(r, 5, "map lookup FAILED: map=%s key=%s",
@@ -2915,12 +2944,13 @@
                                 apr_file_t *fpout, char *key)
 {
     char buf[LONG_STRING_LEN];
     char c;
     int i;
     apr_size_t nbytes;
+    apr_status_t rv;
 
 #ifndef NO_WRITEV
     struct iovec iova[2];
     apr_size_t niov;
 #endif
 
@@ -2933,13 +2963,19 @@
         return NULL;
     }
 
     /* take the lock */
 
     if (rewrite_mapr_lock_acquire) {
-        apr_global_mutex_lock(rewrite_mapr_lock_acquire);
+        rv = apr_global_mutex_lock(rewrite_mapr_lock_acquire);
+        if (rv != APR_SUCCESS) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
+                          "apr_global_mutex_lock(rewrite_mapr_lock_acquire) "
+                          "failed");
+            return NULL; /* Maybe this should be fatal? */
+        }
     }
 
     /* write out the request key */
 #ifdef NO_WRITEV
     nbytes = strlen(key);
     apr_file_write(fpin, key, &nbytes);
@@ -2968,30 +3004,32 @@
         apr_file_read(fpout, &c, &nbytes);
     }
     buf[i] = '\0';
 
     /* give the lock back */
     if (rewrite_mapr_lock_acquire) {
-        apr_global_mutex_unlock(rewrite_mapr_lock_acquire);
+        rv = apr_global_mutex_unlock(rewrite_mapr_lock_acquire);
+        if (rv != APR_SUCCESS) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
+                          "apr_global_mutex_unlock(rewrite_mapr_lock_acquire) "
+                          "failed");
+            return NULL; /* Maybe this should be fatal? */
+        }
     }
 
     if (strcasecmp(buf, "NULL") == 0) {
         return NULL;
     }
     else {
         return apr_pstrdup(r->pool, buf);
     }
 }
 
-static char *lookup_map_internal(request_rec *r,
-                                 char *(*func)(request_rec *, char *),
-                                 char *key)
-{
-    /* currently we just let the function convert
-       the key to a corresponding value */
-    return func(r, key);
+static void ap_register_rewrite_mapfunc(char *name, rewrite_mapfunc_t *func)
+{
+    apr_hash_set(mapfunc_hash, name, strlen(name), (const void *)func);
 }
 
 static char *rewrite_mapfunc_toupper(request_rec *r, char *key)
 {
     char *value, *cp;
 
@@ -3047,13 +3085,13 @@
 
     /* Get [0,1) and then scale to the appropriate range. Note that using
      * a floating point value ensures that we use all bits of the rand()
      * result. Doing an integer modulus would only use the lower-order bits
      * which may not be as uniformly random.
      */
-    return (int)((double)(rand() % RAND_MAX) / RAND_MAX) * (h - l + 1) + l;
+    return (int)(((double)(rand() % RAND_MAX) / RAND_MAX) * (h - l + 1) + l);
 }
 
 static char *select_random_value_part(request_rec *r, char *value)
 {
     char *buf;
     int n, i, k;
@@ -3119,13 +3157,13 @@
     if (conf->rewritelogfp != NULL) {
         return; /* virtual log shared w/ main server */
     }
 
     if (*conf->rewritelogfile == '|') {
         if ((pl = ap_open_piped_log(p, conf->rewritelogfile+1)) == NULL) {
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, s, 
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s, 
                          "mod_rewrite: could not open reliable pipe "
                          "to RewriteLog filter %s", conf->rewritelogfile+1);
             exit(1);
         }
         conf->rewritelogfp = ap_piped_log_write_fd(pl);
     }
@@ -3142,13 +3180,13 @@
                 != APR_SUCCESS) {
             ap_log_error(APLOG_MARK, APLOG_ERR, rc, s, 
                          "mod_rewrite: could not open RewriteLog "
                          "file %s", fname);
             exit(1);
         }
-        apr_file_set_inherit(conf->rewritelogfp);
+        apr_file_inherit_set(conf->rewritelogfp);
     }
     return;
 }
 
 static void rewritelog(request_rec *r, int level, const char *text, ...)
 {
@@ -3162,12 +3200,13 @@
     va_list ap;
     int i;
     apr_size_t nbytes;
     request_rec *req;
     char *ruser;
     const char *rhost;
+    apr_status_t rv;
 
     va_start(ap, text);
     conf = ap_get_module_config(r->server->module_config, &rewrite_module);
     conn = r->connection;
 
     if (conf->rewritelogfp == NULL) {
@@ -3226,16 +3265,26 @@
     apr_snprintf(str3, sizeof(str3),
                 "%s %s [%s/sid#%lx][rid#%lx/%s%s] (%d) %s" APR_EOL_STR, str1,
                 current_logtime(r), ap_get_server_name(r),
                 (unsigned long)(r->server), (unsigned long)r,
                 type, redir, level, str2);
 
-    apr_global_mutex_lock(rewrite_log_lock);
+    rv = apr_global_mutex_lock(rewrite_log_lock);
+    if (rv != APR_SUCCESS) {
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
+                      "apr_global_mutex_lock(rewrite_log_lock) failed");
+        /* XXX: Maybe this should be fatal? */
+    }
     nbytes = strlen(str3);
     apr_file_write(conf->rewritelogfp, str3, &nbytes);
-    apr_global_mutex_unlock(rewrite_log_lock);
+    rv = apr_global_mutex_unlock(rewrite_log_lock);
+    if (rv != APR_SUCCESS) {
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
+                      "apr_global_mutex_unlock(rewrite_log_lock) failed");
+        /* XXX: Maybe this should be fatal? */
+    }
 
     va_end(ap);
     return;
 }
 
 static char *current_logtime(request_rec *r)
@@ -3263,32 +3312,42 @@
 ** |                                                       |
 ** +-------------------------------------------------------+
 */
 
 #define REWRITELOCK_MODE ( APR_UREAD | APR_UWRITE | APR_GREAD | APR_WREAD )
 
-static void rewritelock_create(server_rec *s, apr_pool_t *p)
+static apr_status_t rewritelock_create(server_rec *s, apr_pool_t *p)
 {
     apr_status_t rc;
 
     /* only operate if a lockfile is used */
     if (lockname == NULL || *(lockname) == '\0') {
-        return;
+        return APR_SUCCESS;
     }
 
     /* create the lockfile */
     rc = apr_global_mutex_create(&rewrite_mapr_lock_acquire, lockname,
                                  APR_LOCK_DEFAULT, p);
     if (rc != APR_SUCCESS) {
-        ap_log_error(APLOG_MARK, APLOG_ERR, rc, s,
+        ap_log_error(APLOG_MARK, APLOG_CRIT, rc, s,
                      "mod_rewrite: Parent could not create RewriteLock "
                      "file %s", lockname);
-        exit(1);
+        return rc;
     }
 
-    return;
+#if APR_USE_SYSVSEM_SERIALIZE
+    rc = unixd_set_global_mutex_perms(rewrite_mapr_lock_acquire);
+    if (rc != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_CRIT, rc, s,
+                     "mod_rewrite: Parent could not set permissions "
+                     "on RewriteLock; check User and Group directives");
+        return rc;
+    }
+#endif
+
+    return APR_SUCCESS;
 }
 
 static apr_status_t rewritelock_remove(void *data)
 {
     /* only operate if a lockfile is used */
     if (lockname == NULL || *(lockname) == '\0') {
@@ -3308,13 +3367,13 @@
 ** |                                                       |
 ** |                  program map support
 ** |                                                       |
 ** +-------------------------------------------------------+
 */
 
-static void run_rewritemap_programs(server_rec *s, apr_pool_t *p)
+static apr_status_t run_rewritemap_programs(server_rec *s, apr_pool_t *p)
 {
     rewrite_server_conf *conf;
     apr_file_t *fpin = NULL;
     apr_file_t *fpout = NULL;
     apr_file_t *fperr = NULL;
     apr_array_header_t *rewritemaps;
@@ -3326,67 +3385,69 @@
     conf = ap_get_module_config(s->module_config, &rewrite_module);
 
     /*  If the engine isn't turned on,
      *  don't even try to do anything.
      */
     if (conf->state == ENGINE_DISABLED) {
-        return;
+        return APR_SUCCESS;
     }
 
     rewritemaps = conf->rewritemaps;
     entries = (rewritemap_entry *)rewritemaps->elts;
     for (i = 0; i < rewritemaps->nelts; i++) {
         map = &entries[i];
         if (map->type != MAPTYPE_PRG) {
             continue;
         }
-        if (map->datafile == NULL
-            || *(map->datafile) == '\0'
+        if (map->argv[0] == NULL
+            || *(map->argv[0]) == '\0'
             || map->fpin  != NULL
             || map->fpout != NULL        ) {
             continue;
         }
         fpin  = NULL;
         fpout = NULL;
-        rc = rewritemap_program_child(p, map->datafile,
+        rc = rewritemap_program_child(p, map->argv[0], map->argv,
                                      &fpout, &fpin, &fperr);
         if (rc != APR_SUCCESS || fpin == NULL || fpout == NULL) {
             ap_log_error(APLOG_MARK, APLOG_ERR, rc, s,
-                         "mod_rewrite: could not fork child for "
-                         "RewriteMap process");
-            exit(1);
+                         "mod_rewrite: could not startup RewriteMap "
+                         "program %s", map->datafile);
+            return rc;
         }
         map->fpin  = fpin;
         map->fpout = fpout;
         map->fperr = fperr;
     }
-    return;
+    return APR_SUCCESS;
 }
 
 /* child process code */
-static apr_status_t rewritemap_program_child(apr_pool_t *p, const char *progname,
+static apr_status_t rewritemap_program_child(apr_pool_t *p, 
+                                             const char *progname, char **argv,
                                              apr_file_t **fpout, apr_file_t **fpin,
                                              apr_file_t **fperr)
 {
     apr_status_t rc;
     apr_procattr_t *procattr;
     apr_proc_t *procnew;
 
     if (((rc = apr_procattr_create(&procattr, p)) != APR_SUCCESS) ||
         ((rc = apr_procattr_io_set(procattr, APR_FULL_BLOCK,
                                   APR_FULL_NONBLOCK,
                                   APR_FULL_NONBLOCK)) != APR_SUCCESS) ||
         ((rc = apr_procattr_dir_set(procattr, 
-                                   ap_make_dirstr_parent(p, progname)))
+                                   ap_make_dirstr_parent(p, argv[0])))
          != APR_SUCCESS) ||
         ((rc = apr_procattr_cmdtype_set(procattr, APR_PROGRAM)) != APR_SUCCESS)) {
         /* Something bad happened, give up and go away. */
     }
     else {
         procnew = apr_pcalloc(p, sizeof(*procnew));
-        rc = apr_proc_create(procnew, progname, NULL, NULL, procattr, p);
+        rc = apr_proc_create(procnew, argv[0], (const char **)argv, NULL,
+                             procattr, p);
     
         if (rc == APR_SUCCESS) {
             apr_pool_note_subprocess(p, procnew, APR_KILL_AFTER_TIMEOUT);
 
             if (fpin) {
                 (*fpin) = procnew->in;
@@ -4184,14 +4245,17 @@
                      "(0=none, 1=std, .., 9=max)"),
     { NULL }
 };
 
 static void register_hooks(apr_pool_t *p)
 {
+    APR_REGISTER_OPTIONAL_FN(ap_register_rewrite_mapfunc);
+
     ap_hook_handler(handler_redirect, NULL, NULL, APR_HOOK_MIDDLE);
-    ap_hook_post_config(init_module, NULL, NULL, APR_HOOK_MIDDLE);
+    ap_hook_pre_config(pre_config, NULL, NULL, APR_HOOK_MIDDLE);
+    ap_hook_post_config(post_config, NULL, NULL, APR_HOOK_MIDDLE);
     ap_hook_child_init(init_child, NULL, NULL, APR_HOOK_MIDDLE);
 
     ap_hook_fixups(hook_fixup, NULL, NULL, APR_HOOK_FIRST);
     ap_hook_translate_name(hook_uri2file, NULL, NULL, APR_HOOK_FIRST);
     ap_hook_type_checker(hook_mimetype, NULL, NULL, APR_HOOK_MIDDLE);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_rewrite.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_rewrite.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_rewrite.h	2002-04-06 04:01:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_rewrite.h	2002-05-30 08:02:59.000000000 +0800
@@ -112,12 +112,13 @@
 #include <sys/types.h>
 #endif
 
 #if APR_HAS_THREADS
 #include "apr_thread_mutex.h"
 #endif
+#include "apr_optional.h"
 #include "ap_config.h"
 
     /* Include from the Apache server ... */
 #define CORE_PRIVATE
 #include "httpd.h"
 #include "http_config.h"
@@ -249,12 +250,13 @@
     int   type;                    /* the type of the map */
     apr_file_t *fpin;               /* in  file pointer for program maps */
     apr_file_t *fpout;              /* out file pointer for program maps */
     apr_file_t *fperr;              /* err file pointer for program maps */
     char *(*func)(request_rec *,   /* function pointer for internal maps */
                   char *);
+    char **argv;
 } rewritemap_entry;
 
 typedef struct {
     char    *input;                /* Input string of RewriteCond */
     char    *pattern;              /* the RegExp pattern string */
     regex_t *regexp;
@@ -381,16 +383,19 @@
                                                   rewriterule_entry *new,
                                                   char *str);
 static const char *cmd_rewriterule_setflag(apr_pool_t *p, rewriterule_entry *cfg,
                                            char *key, char *val);
 
     /* initialisation */
-static int init_module(apr_pool_t *p,
-                        apr_pool_t *plog,
-                        apr_pool_t *ptemp,
-                        server_rec *s);
+static int pre_config(apr_pool_t *pconf,
+                      apr_pool_t *plog,
+                      apr_pool_t *ptemp);
+static int post_config(apr_pool_t *pconf,
+                       apr_pool_t *plog,
+                       apr_pool_t *ptemp,
+                       server_rec *s);
 static void init_child(apr_pool_t *p, server_rec *s);
 
     /* runtime hooks */
 static int hook_uri2file   (request_rec *r);
 static int hook_mimetype   (request_rec *r);
 static int hook_fixup      (request_rec *r);
@@ -422,19 +427,23 @@
 static char *lookup_map_txtfile(request_rec *r, const char *file, char *key);
 #ifndef NO_DBM_REWRITEMAP
 static char *lookup_map_dbmfile(request_rec *r, const char *file, char *key);
 #endif
 static char *lookup_map_program(request_rec *r, apr_file_t *fpin,
                                 apr_file_t *fpout, char *key);
-static char *lookup_map_internal(request_rec *r,
-                                 char *(*func)(request_rec *r, char *key),
-                                 char *key);
+
+typedef char *(rewrite_mapfunc_t)(request_rec *r, char *key);
+static void ap_register_rewrite_mapfunc(char *name, rewrite_mapfunc_t *func);
+APR_DECLARE_OPTIONAL_FN(void, ap_register_rewrite_mapfunc,
+                        (char *name, rewrite_mapfunc_t *func));
+
 static char *rewrite_mapfunc_toupper(request_rec *r, char *key);
 static char *rewrite_mapfunc_tolower(request_rec *r, char *key);
 static char *rewrite_mapfunc_escape(request_rec *r, char *key);
 static char *rewrite_mapfunc_unescape(request_rec *r, char *key);
+
 static char *select_random_value_part(request_rec *r, char *value);
 static void  rewrite_rand_init(void);
 static int   rewrite_rand(int l, int h);
 
     /* rewriting logfile support */
 static void  open_rewritelog(server_rec *s, apr_pool_t *p);
@@ -440,18 +449,19 @@
 static void  open_rewritelog(server_rec *s, apr_pool_t *p);
 static void  rewritelog(request_rec *r, int level, const char *text, ...)
                         __attribute__((format(printf,3,4)));
 static char *current_logtime(request_rec *r);
 
     /* rewriting lockfile support */
-static void rewritelock_create(server_rec *s, apr_pool_t *p);
+static apr_status_t rewritelock_create(server_rec *s, apr_pool_t *p);
 static apr_status_t rewritelock_remove(void *data);
 
     /* program map support */
-static void  run_rewritemap_programs(server_rec *s, apr_pool_t *p);
-static apr_status_t rewritemap_program_child(apr_pool_t *p, const char *progname,
+static apr_status_t run_rewritemap_programs(server_rec *s, apr_pool_t *p);
+static apr_status_t rewritemap_program_child(apr_pool_t *p, 
+                                             const char *progname, char **argv,
                                              apr_file_t **fpout, apr_file_t **fpin,
                                              apr_file_t **fperr);
 
     /* env variable support */
 static char *lookup_variable(request_rec *r, char *var);
 static char *lookup_header(request_rec *r, const char *name);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_so.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_so.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_so.c	2002-04-20 02:31:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_so.c	2002-05-17 19:24:16.000000000 +0800
@@ -225,13 +225,13 @@
     sconf = (so_server_conf *)ap_get_module_config(cmd->server->module_config, 
 	                                        &so_module);
     modie = (moduleinfo *)sconf->loaded_modules->elts;
     for (i = 0; i < sconf->loaded_modules->nelts; i++) {
         modi = &modie[i];
         if (modi->name != NULL && strcmp(modi->name, modname) == 0) {
-            ap_log_perror(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0,
+            ap_log_perror(APLOG_MARK, APLOG_WARNING, 0,
                           cmd->pool, "module %s is already loaded, skipping",
                           modname);
             return NULL;
         }
     }
 
@@ -284,13 +284,13 @@
 
         return apr_pstrcat(cmd->pool, "Cannot load ", szModuleFile,
 			  " into server: ",
 			  apr_dso_error(modhandle, my_error, sizeof(my_error)),
 			  NULL);
     }
-    ap_log_perror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, cmd->pool,
+    ap_log_perror(APLOG_MARK, APLOG_DEBUG, 0, cmd->pool,
 		 "loaded module %s", modname);
 
     /*
      * Retrieve the pointer to the module structure through the module name:
      * First with the hidden variant (prefix `AP_') and then with the plain
      * symbol name.
@@ -360,31 +360,31 @@
 	return apr_pstrcat(cmd->pool, "Cannot load ", filename, 
 			  " into server: ", 
 			  apr_dso_error(handle, my_error, sizeof(my_error)),
 			  NULL);
     }
     
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL,
 		 "loaded file %s", filename);
 
     return NULL;
 }
 
 #else /* not NO_DLOPEN */
 
 static const char *load_file(cmd_parms *cmd, void *dummy, const char *filename)
 {
-    ap_log_perror(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, cmd->pool, 
+    ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0, cmd->pool, 
                  "WARNING: LoadFile not supported on this platform");
     return NULL;
 }
 
 static const char *load_module(cmd_parms *cmd, void *dummy, 
 	                       const char *modname, const char *filename)
 {
-    ap_log_perror(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, cmd->pool, 
+    ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0, cmd->pool, 
                  "WARNING: LoadModule not supported on this platform");
     return NULL;
 }
 
 #endif /* NO_DLOPEN */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_speling.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_speling.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_speling.c	2002-03-14 04:47:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_speling.c	2002-05-17 19:24:16.000000000 +0800
@@ -428,13 +428,13 @@
 	    if (r->parsed_uri.query)
 		nuri = apr_pstrcat(r->pool, nuri, "?", r->parsed_uri.query, NULL);
 
             apr_table_setn(r->headers_out, "Location",
 			  ap_construct_url(r->pool, nuri, r));
 
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_INFO, APR_SUCCESS,
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, APR_SUCCESS,
 			  r, 
 			  ref ? "Fixed spelling: %s to %s from %s"
 			      : "Fixed spelling: %s to %s",
 			  r->uri, nuri, ref);
 
             return HTTP_MOVED_PERMANENTLY;
@@ -537,13 +537,13 @@
 
 	    apr_table_mergen(r->subprocess_env, "VARIANTS",
 			    apr_array_pstrcat(p, v, ','));
 	  
 	    apr_pool_destroy(sub_pool);
 
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_INFO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
 			 ref ? "Spelling fix: %s: %d candidates from %s"
 			     : "Spelling fix: %s: %d candidates",
 			 r->uri, candidates->nelts, ref);
 
             return HTTP_MULTIPLE_CHOICES;
         }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_userdir.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_userdir.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/mappers/mod_userdir.c	2002-04-29 15:45:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/mappers/mod_userdir.c	2002-06-15 15:20:59.000000000 +0800
@@ -224,13 +224,12 @@
     ap_conf_vector_t *server_conf;
     const userdir_config *s_cfg;
     char *name = r->uri;
     const char *userdirs;
     const char *w, *dname;
     char *redirect;
-    char *x = NULL;
     apr_finfo_t statbuf;
 
     /*
      * If the URI doesn't match our basic pattern, we've nothing to do with
      * it.
      */
@@ -282,13 +281,13 @@
     /*
      * Special cases all checked, onward to normal substitution processing.
      */
 
     while (*userdirs) {
         const char *userdir = ap_getword_conf(r->pool, &userdirs);
-        char *filename = NULL;
+        char *filename = NULL, *x = NULL;
         apr_status_t rv;
         int is_absolute = ap_os_is_path_absolute(r->pool, userdir);
 
         if (ap_strchr_c(userdir, '*'))
             x = ap_getword(r->pool, &userdir, '*');
 
@@ -314,14 +313,14 @@
                 else
                     filename = apr_pstrcat(r->pool, x, w, userdir, NULL);
             }
             else
                 filename = apr_pstrcat(r->pool, userdir, "/", w, NULL);
         }
-        else if (ap_strchr_c(userdir, ':')) {
-            redirect = apr_pstrcat(r->pool, userdir, "/", w, dname, NULL);
+        else if (x && ap_strchr_c(x, ':')) {
+            redirect = apr_pstrcat(r->pool, x, w, dname, NULL);
             apr_table_setn(r->headers_out, "Location", redirect);
             return HTTP_MOVED_TEMPORARILY;
         }
         else {
 #if APR_HAS_USER
             char *homedir;
@@ -389,15 +388,15 @@
     return ugid;
 }
 #endif /* HAVE_UNIX_SUEXEC */
 
 static void register_hooks(apr_pool_t *p)
 {
-    static const char * const aszSucc[]={ "mod_alias.c",NULL };
+    static const char * const aszPre[]={ "mod_alias.c",NULL };
 
-    ap_hook_translate_name(translate_userdir,NULL,aszSucc,APR_HOOK_MIDDLE);
+    ap_hook_translate_name(translate_userdir,aszPre,NULL,APR_HOOK_MIDDLE);
 #ifdef HAVE_UNIX_SUEXEC
     ap_hook_get_suexec_identity(get_suexec_id_doer,NULL,NULL,APR_HOOK_MIDDLE);
 #endif
 }
 
 module AP_MODULE_DECLARE_DATA userdir_module = {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_cern_meta.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_cern_meta.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_cern_meta.c	2002-03-21 01:41:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_cern_meta.c	2002-05-17 19:33:10.000000000 +0800
@@ -271,13 +271,13 @@
 	    return OK;
 	}
 
 	/* if we see a bogus header don't ignore it. Shout and scream */
 
 	if (!(l = strchr(w, ':'))) {
- 	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+ 	    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 			"malformed header in meta file: %s", r->filename);
 	    return HTTP_INTERNAL_SERVER_ERROR;
 	}
 
 	*l++ = '\0';
 	while (*l && apr_isspace(*l))
@@ -347,13 +347,13 @@
 	real_file = last_slash;
 	real_file++;
 	*last_slash = '\0';
     }
     else {
 	/* no last slash, buh?! */
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    "internal error in mod_cern_meta: %s", r->filename);
 	/* should really barf, but hey, let's be friends... */
 	return DECLINED;
     };
 
     metafilename = apr_pstrcat(r->pool, scrap_book, "/",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_env.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_env.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_env.c	2002-03-14 04:47:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_env.c	2002-05-17 19:33:10.000000000 +0800
@@ -136,13 +136,13 @@
     
     env_var = getenv(arg);
     if (env_var != NULL) {
         apr_table_setn(vars, arg, apr_pstrdup(cmd->pool, env_var));
     }
     else {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, cmd->server,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, cmd->server,
                      "PassEnv variable %s was undefined", arg);
     }
 
     return NULL;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_expires.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_expires.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_expires.c	2002-03-14 04:47:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_expires.c	2002-05-17 19:33:10.000000000 +0800
@@ -430,13 +430,13 @@
 
     if (r->main != NULL)        /* Say no to subrequests */
         return DECLINED;
 
     conf = (expires_dir_config *) ap_get_module_config(r->per_dir_config, &expires_module);
     if (conf == NULL) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                     "internal error: %s", r->filename);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     if (conf->active != ACTIVE_ON)
         return DECLINED;
@@ -487,13 +487,13 @@
         additional = atoi(&code[1]) * APR_USEC_PER_SEC;
         break;
     default:
         /* expecting the add_* routines to be case-hardened this 
          * is just a reminder that module is beta
          */
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                     "internal error: bad expires code: %s", r->filename);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     expires = base + additional;
     apr_table_mergen(r->headers_out, "Cache-Control",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_headers.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_headers.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_headers.c	2002-03-14 04:47:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_headers.c	2002-05-17 19:33:10.000000000 +0800
@@ -557,13 +557,13 @@
 {
     headers_conf *serverconf = ap_get_module_config(f->r->server->module_config,
                                                     &headers_module);
     headers_conf *dirconf = ap_get_module_config(f->r->per_dir_config,
                                                  &headers_module);
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, f->r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, f->r->server,
 		 "headers: ap_headers_output_filter()");
 
     /* do the fixup */
     do_headers_fixup(f->r, hdr_out, serverconf->fixup_out);
     do_headers_fixup(f->r, hdr_out, dirconf->fixup_out);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_mime_magic.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_mime_magic.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_mime_magic.c	2002-03-21 01:41:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_mime_magic.c	2002-05-17 19:33:10.000000000 +0800
@@ -587,13 +587,13 @@
     magic_req_rec *req_dat = (magic_req_rec *)
 		    ap_get_module_config(r->request_config, &mime_magic_module);
     magic_rsl *rsl;
 
     /* make sure we have a list to put it in */
     if (!req_dat) {
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, APR_EINVAL, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, APR_EINVAL, r,
 		    MODNAME ": request config should not be NULL");
 	if (!(req_dat = magic_set_config(r))) {
 	    /* failure */
 	    return -1;
 	}
     }
@@ -689,13 +689,13 @@
 	}
     }
 
     /* clean up and return */
     result[res_pos] = 0;
 #if MIME_MAGIC_DEBUG
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 	     MODNAME ": rsl_strdup() %d chars: %s", res_pos - 1, result);
 #endif
     return result;
 }
 
 /* states for the state-machine algorithm in magic_rsl_to_request() */
@@ -761,13 +761,13 @@
 		    frag = req_dat->tail;
 		    break;
 		}
 		else {
 		    /* should not be possible */
 		    /* abandon malfunctioning module */
-		    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+		    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 				MODNAME ": bad state %d (ws)", state);
 		    return DECLINED;
 		}
 		/* NOTREACHED */
 	    }
 	    else if (state == rsl_type &&
@@ -805,13 +805,13 @@
 		    encoding_len++;
 		    continue;
 		}
 		else {
 		    /* should not be possible */
 		    /* abandon malfunctioning module */
-		    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+		    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 				MODNAME ": bad state %d (ns)", state);
 		    return DECLINED;
 		}
 		/* NOTREACHED */
 	    }
 	    /* NOTREACHED */
@@ -845,13 +845,13 @@
 	r->content_encoding = tmp;
     }
 
     /* detect memory allocation or other errors */
     if (!r->content_type ||
 	(state == rsl_encoding && !r->content_encoding)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       MODNAME ": unexpected state %d; could be caused by bad "
                       "data in magic file",
                       state);
 	return HTTP_INTERNAL_SERVER_ERROR;
     }
 
@@ -1015,34 +1015,34 @@
 	    ++errs;
     }
 
     (void) apr_file_close(f);
 
 #if MIME_MAGIC_DEBUG
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 		MODNAME ": apprentice conf=%x file=%s m=%s m->next=%s last=%s",
 		conf,
 		conf->magicfile ? conf->magicfile : "NULL",
 		conf->magic ? "set" : "NULL",
 		(conf->magic && conf->magic->next) ? "set" : "NULL",
 		conf->last ? "set" : "NULL");
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 		MODNAME ": apprentice read %d lines, %d rules, %d errors",
 		lineno, rule, errs);
 #endif
 
 #if MIME_MAGIC_DEBUG
     prevm = 0;
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 		MODNAME ": apprentice test");
     for (m = conf->magic; m; m = m->next) {
 	if (apr_isprint((((unsigned long) m) >> 24) & 255) &&
 	    apr_isprint((((unsigned long) m) >> 16) & 255) &&
 	    apr_isprint((((unsigned long) m) >> 8) & 255) &&
 	    apr_isprint(((unsigned long) m) & 255)) {
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+	    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 			MODNAME ": apprentice: POINTER CLOBBERED! "
 			"m=\"%c%c%c%c\" line=%d",
 			(((unsigned long) m) >> 24) & 255,
 			(((unsigned long) m) >> 16) & 255,
 			(((unsigned long) m) >> 8) & 255,
 			((unsigned long) m) & 255,
@@ -1083,13 +1083,13 @@
 	case LELONG:
 	    v = (long) v;
 	    break;
 	case STRING:
 	    break;
 	default:
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, s,
+	    ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
 			MODNAME ": can't happen: m->type=%d", m->type);
 	    return -1;
 	}
     return v;
 }
 
@@ -1131,13 +1131,13 @@
 	m->flag |= INDIR;
     }
 
     /* get offset, then skip over it */
     m->offset = (int) strtol(l, &t, 0);
     if (l == t) {
-	ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, serv,
+	ap_log_error(APLOG_MARK, APLOG_ERR, 0, serv,
 		    MODNAME ": offset %s invalid", l);
     }
     l = t;
 
     if (m->flag & INDIR) {
 	m->in.type = LONG;
@@ -1154,13 +1154,13 @@
 		m->in.type = SHORT;
 		break;
 	    case 'b':
 		m->in.type = BYTE;
 		break;
 	    default:
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, serv,
+		ap_log_error(APLOG_MARK, APLOG_ERR, 0, serv,
 			MODNAME ": indirect offset type %c invalid", *l);
 		break;
 	    }
 	    l++;
 	}
 	s = l;
@@ -1171,13 +1171,13 @@
 	    if (*s == '-')
 		m->in.offset = -m->in.offset;
 	}
 	else
 	    t = l;
 	if (*t++ != ')') {
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, serv,
+	    ap_log_error(APLOG_MARK, APLOG_ERR, 0, serv,
 			MODNAME ": missing ')' in indirect offset");
 	}
 	l = t;
     }
 
 
@@ -1245,13 +1245,13 @@
     }
     else if (strncmp(l, "ledate", NLEDATE) == 0) {
 	m->type = LEDATE;
 	l += NLEDATE;
     }
     else {
-	ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, serv,
+	ap_log_error(APLOG_MARK, APLOG_ERR, 0, serv,
 		    MODNAME ": type %s invalid", l);
 	return -1;
     }
     /* New-style anding: "0 byte&0x80 =0x80 dynamically linked" */
     if (*l == '&') {
 	++l;
@@ -1308,13 +1308,13 @@
     else
 	m->nospflag = 0;
     strncpy(m->desc, l, sizeof(m->desc) - 1);
     m->desc[sizeof(m->desc) - 1] = '\0';
 
 #if MIME_MAGIC_DEBUG
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, serv,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, serv,
 		MODNAME ": parse line=%d m=%x next=%x cont=%d desc=%s",
 		lineno, m, m->next, m->cont_level, m->desc);
 #endif /* MIME_MAGIC_DEBUG */
 
     return 0;
 }
@@ -1351,13 +1351,13 @@
     register int val;
 
     while ((c = *s++) != '\0') {
 	if (apr_isspace((unsigned char) c))
 	    break;
 	if (p >= pmax) {
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, serv,
+	    ap_log_error(APLOG_MARK, APLOG_ERR, 0, serv,
 			MODNAME ": string too long: %s", origs);
 	    break;
 	}
 	if (c == '\\') {
 	    switch (c = *s++) {
 
@@ -1497,22 +1497,22 @@
 	(void) magic_rsl_puts(r, MIME_BINARY_UNKNOWN);
 	return DONE;
     case APR_LNK:
 	/* We used stat(), the only possible reason for this is that the
 	 * symlink is broken.
 	 */
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": broken symlink (%s)", fn);
 	return HTTP_INTERNAL_SERVER_ERROR;
     case APR_SOCK:
 	magic_rsl_puts(r, MIME_BINARY_UNKNOWN);
 	return DONE;
     case APR_REG:
 	break;
     default:
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		      MODNAME ": invalid file type %d.", r->finfo.filetype);
 	return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     /*
      * regular file, check next possibility
@@ -1573,13 +1573,13 @@
     union VALUETYPE p;
     magic_server_config_rec *conf = (magic_server_config_rec *)
 		ap_get_module_config(r->server->module_config, &mime_magic_module);
     struct magic *m;
 
 #if MIME_MAGIC_DEBUG
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		MODNAME ": match conf=%x file=%s m=%s m->next=%s last=%s",
 		conf,
 		conf->magicfile ? conf->magicfile : "NULL",
 		conf->magic ? "set" : "NULL",
 		(conf->magic && conf->magic->next) ? "set" : "NULL",
 		conf->last ? "set" : "NULL");
@@ -1588,13 +1588,13 @@
 #if MIME_MAGIC_DEBUG
     for (m = conf->magic; m; m = m->next) {
 	if (apr_isprint((((unsigned long) m) >> 24) & 255) &&
 	    apr_isprint((((unsigned long) m) >> 16) & 255) &&
 	    apr_isprint((((unsigned long) m) >> 8) & 255) &&
 	    apr_isprint(((unsigned long) m) & 255)) {
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			MODNAME ": match: POINTER CLOBBERED! "
 			"m=\"%c%c%c%c\"",
 			(((unsigned long) m) >> 24) & 255,
 			(((unsigned long) m) >> 16) & 255,
 			(((unsigned long) m) >> 8) & 255,
 			((unsigned long) m) & 255);
@@ -1603,13 +1603,13 @@
     }
 #endif
 
     for (m = conf->magic; m; m = m->next) {
 #if MIME_MAGIC_DEBUG
 	rule_counter++;
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    MODNAME ": line=%d desc=%s", m->lineno, m->desc);
 #endif
 
 	/* check if main entry matches */
 	if (!mget(r, &p, s, m, nbytes) ||
 	    !mcheck(r, &p, m)) {
@@ -1623,13 +1623,13 @@
 	    }
 
 	    m_cont = m->next;
 	    while (m_cont && (m_cont->cont_level != 0)) {
 #if MIME_MAGIC_DEBUG
 		rule_counter++;
-		ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+		ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			MODNAME ": line=%d mc=%x mc->next=%x cont=%d desc=%s",
 			    m_cont->lineno, m_cont,
 			    m_cont->next, m_cont->cont_level,
 			    m_cont->desc);
 #endif
 		/*
@@ -1642,13 +1642,13 @@
 	    continue;
 	}
 
 	/* if we get here, the main entry rule was a match */
 	/* this will be the last run through the loop */
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    MODNAME ": rule matched, line=%d type=%d %s",
 		    m->lineno, m->type,
 		    (m->type == STRING) ? m->value.s : "");
 #endif
 
 	/* print the match */
@@ -1666,13 +1666,13 @@
 	 * while (m && m->next && m->next->cont_level != 0 && ( m = m->next
 	 * ))
 	 */
 	m = m->next;
 	while (m && (m->cont_level != 0)) {
 #if MIME_MAGIC_DEBUG
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			MODNAME ": match line=%d cont=%d type=%d %s",
 			m->lineno, m->cont_level, m->type,
 			(m->type == STRING) ? m->value.s : "");
 #endif
 	    if (cont_level >= m->cont_level) {
 		if (cont_level > m->cont_level) {
@@ -1710,19 +1710,19 @@
 	    }
 
 	    /* move to next continuation record */
 	    m = m->next;
 	}
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    MODNAME ": matched after %d rules", rule_counter);
 #endif
 	return 1;		/* all through */
     }
 #if MIME_MAGIC_DEBUG
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		MODNAME ": failed after %d rules", rule_counter);
 #endif
     return 0;			/* no match at all */
 }
 
 static void mprint(request_rec *r, union VALUETYPE *p, struct magic *m)
@@ -1762,13 +1762,13 @@
     case LEDATE:
         apr_ctime(time_str, APR_USEC_PER_SEC * (apr_time_t)*(time_t *)&p->l);
         pp = time_str;
 	(void) magic_rsl_printf(r, m->desc, pp);
 	return;
     default:
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": invalid m->type (%d) in mprint().",
 		    m->type);
 	return;
     }
 
     v = signextend(r->server, m, v) & m->mask;
@@ -1808,13 +1808,13 @@
     case LELONG:
     case LEDATE:
 	p->l = (long)
 	    ((p->hl[3] << 24) | (p->hl[2] << 16) | (p->hl[1] << 8) | (p->hl[0]));
 	return 1;
     default:
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": invalid type %d in mconvert().", m->type);
 	return 0;
     }
 }
 
 
@@ -1860,13 +1860,13 @@
 {
     register unsigned long l = m->value.l;
     register unsigned long v;
     int matched;
 
     if ((m->value.s[0] == 'x') && (m->value.s[1] == '\0')) {
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": BOINK");
 	return 1;
     }
 
     switch (m->type) {
     case BYTE:
@@ -1905,98 +1905,98 @@
 		if ((v = *b++ - *a++) != 0)
 		    break;
 	}
 	break;
     default:
 	/*  bogosity, pretend that it just wasn't a match */
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": invalid type %d in mcheck().", m->type);
 	return 0;
     }
 
     v = signextend(r->server, m, v) & m->mask;
 
     switch (m->reln) {
     case 'x':
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    "%lu == *any* = 1", v);
 #endif
 	matched = 1;
 	break;
 
     case '!':
 	matched = v != l;
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    "%lu != %lu = %d", v, l, matched);
 #endif
 	break;
 
     case '=':
 	matched = v == l;
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    "%lu == %lu = %d", v, l, matched);
 #endif
 	break;
 
     case '>':
 	if (m->flag & UNSIGNED) {
 	    matched = v > l;
 #if MIME_MAGIC_DEBUG
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			"%lu > %lu = %d", v, l, matched);
 #endif
 	}
 	else {
 	    matched = (long) v > (long) l;
 #if MIME_MAGIC_DEBUG
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			"%ld > %ld = %d", v, l, matched);
 #endif
 	}
 	break;
 
     case '<':
 	if (m->flag & UNSIGNED) {
 	    matched = v < l;
 #if MIME_MAGIC_DEBUG
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			"%lu < %lu = %d", v, l, matched);
 #endif
 	}
 	else {
 	    matched = (long) v < (long) l;
 #if MIME_MAGIC_DEBUG
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 			"%ld < %ld = %d", v, l, matched);
 #endif
 	}
 	break;
 
     case '&':
 	matched = (v & l) == l;
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    "((%lx & %lx) == %lx) = %d", v, l, l, matched);
 #endif
 	break;
 
     case '^':
 	matched = (v & l) != l;
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    "((%lx & %lx) != %lx) = %d", v, l, l, matched);
 #endif
 	break;
 
     default:
 	/* bogosity, pretend it didn't match */
 	matched = 0;
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_ERR, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		    MODNAME ": mcheck: can't happen: invalid relation %d.",
 		    m->reln);
 	break;
     }
 
     return matched;
@@ -2340,13 +2340,13 @@
 {
     int suffix_pos, result;
     char *sub_filename;
     request_rec *sub;
 
 #if MIME_MAGIC_DEBUG
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		MODNAME ": revision_suffix checking %s", r->filename);
 #endif /* MIME_MAGIC_DEBUG */
 
     /* check for recognized revision suffix */
     suffix_pos = strlen(r->filename) - 1;
     if (!apr_isdigit(r->filename[suffix_pos])) {
@@ -2359,22 +2359,22 @@
     }
 
     /* perform sub-request for the file name without the suffix */
     result = 0;
     sub_filename = apr_pstrndup(r->pool, r->filename, suffix_pos);
 #if MIME_MAGIC_DEBUG
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		MODNAME ": subrequest lookup for %s", sub_filename);
 #endif /* MIME_MAGIC_DEBUG */
     sub = ap_sub_req_lookup_file(sub_filename, r, NULL);
 
     /* extract content type/encoding/language from sub-request */
     if (sub->content_type) {
 	ap_set_content_type(r, apr_pstrdup(r->pool, sub->content_type));
 #if MIME_MAGIC_DEBUG
-	ap_log_rerror(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
 		    MODNAME ": subrequest %s got %s",
 		    sub_filename, r->content_type);
 #endif /* MIME_MAGIC_DEBUG */
 	if (sub->content_encoding)
 	    r->content_encoding =
 		apr_pstrdup(r->pool, sub->content_encoding);
@@ -2419,20 +2419,20 @@
 	else if (conf->magicfile) {
 	    result = apprentice(s, p);
 	    if (result == -1)
 		return OK;
 #if MIME_MAGIC_DEBUG
 	    prevm = 0;
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+	    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 			MODNAME ": magic_init 1 test");
 	    for (m = conf->magic; m; m = m->next) {
 		if (apr_isprint((((unsigned long) m) >> 24) & 255) &&
 		    apr_isprint((((unsigned long) m) >> 16) & 255) &&
 		    apr_isprint((((unsigned long) m) >> 8) & 255) &&
 		    apr_isprint(((unsigned long) m) & 255)) {
-		    ap_log_error(APLOG_MARK, APLOG_NOERRNO | APLOG_DEBUG, 0, s,
+		    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
 				MODNAME ": magic_init 1: POINTER CLOBBERED! "
 				"m=\"%c%c%c%c\" line=%d",
 				(((unsigned long) m) >> 24) & 255,
 				(((unsigned long) m) >> 16) & 255,
 				(((unsigned long) m) >> 8) & 255,
 				((unsigned long) m) & 255,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_setenvif.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_setenvif.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_setenvif.c	2002-03-14 04:47:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_setenvif.c	2002-05-10 21:51:10.000000000 +0800
@@ -120,12 +120,13 @@
  *
  *    SetEnvIf ^TS* ^[a-z].* HAVE_TS
  */
 
 #include "apr.h"
 #include "apr_strings.h"
+#include "apr_strmatch.h"
 
 #define APR_WANT_STRFUNC
 #include "apr_want.h"
 
 #include "ap_config.h"
 #include "httpd.h"
@@ -146,12 +147,13 @@
 };
 typedef struct {
     char *name;                 /* header name */
     regex_t *pnamereg;          /* compiled header name regex */
     char *regex;                /* regex to match against */
     regex_t *preg;              /* compiled regex */
+    const apr_strmatch_pattern *pattern; /* non-regex pattern to match */
     apr_table_t *features;      /* env vars to set (or unset) */
     enum special special_type;  /* is it a "special" header ? */
     int icase;                  /* ignoring case? */
 } sei_entry;
 
 typedef struct {
@@ -216,16 +218,74 @@
         if (ap_regexec(preg, name, 0, NULL, 0)) {
             return 1;
         }
     }
     return 0;
 }
+
+/* If the input string does not take advantage of regular
+ * expression metacharacters, return a pointer to an equivalent
+ * string that can be searched using apr_strmatch().  (The
+ * returned string will often be the input string.  But if
+ * the input string contains escaped characters, the returned
+ * string will be a copy with the escapes removed.)
+ */
+static const char *non_regex_pattern(apr_pool_t *p, const char *s)
+{
+    const char *src = s;
+    int escapes_found = 0;
+    int in_escape = 0;
+
+    while (*src) {
+        if (in_escape) {
+            in_escape = 0;
+        }
+        else {
+            switch (*src) {
+            case '^':
+            case '.':
+            case '$':
+            case '|':
+            case '(':
+            case ')':
+            case '[':
+            case ']':
+            case '*':
+            case '+':
+            case '?':
+            case '{':
+            case '}':
+                return NULL;
+            case '\\':
+                in_escape = 1;
+                escapes_found = 1;
+            }
+        }
+        src++;
+    }
+    if (!escapes_found) {
+        return s;
+    }
+    else {
+        char *unescaped = (char *)apr_palloc(p, src - s + 1);
+        char *dst = unescaped;
+        src = s;
+        do {
+            if (*src == '\\') {
+                src++;
+            }
+        } while ((*dst++ = *src++));
+        return unescaped;
+    }
+}
+
 static const char *add_setenvif_core(cmd_parms *cmd, void *mconfig,
 				     char *fname, const char *args)
 {
     char *regex;
+    const char *simple_pattern;
     const char *feature;
     sei_cfg_rec *sconf;
     sei_entry *new;
     sei_entry *entries;
     char *var;
     int i;
@@ -276,18 +336,30 @@
 	/* no match, create a new entry */
 
 	new = apr_array_push(sconf->conditionals);
 	new->name = fname;
 	new->regex = regex;
 	new->icase = icase;
-	new->preg = ap_pregcomp(cmd->pool, regex,
-				(REG_EXTENDED | REG_NOSUB
-				 | (icase ? REG_ICASE : 0)));
-	if (new->preg == NULL) {
-	    return apr_pstrcat(cmd->pool, cmd->cmd->name,
-			      " regex could not be compiled.", NULL);
+        if ((simple_pattern = non_regex_pattern(cmd->pool, regex))) {
+            new->pattern = apr_strmatch_precompile(cmd->pool,
+                                                   simple_pattern, 1);
+            if (new->pattern == NULL) {
+                return apr_pstrcat(cmd->pool, cmd->cmd->name,
+                                   " pattern could not be compiled.", NULL);
+            }
+            new->preg = NULL;
+        }
+        else {
+            new->preg = ap_pregcomp(cmd->pool, regex,
+                                    (REG_EXTENDED | REG_NOSUB
+                                     | (icase ? REG_ICASE : 0)));
+            if (new->preg == NULL) {
+                return apr_pstrcat(cmd->pool, cmd->cmd->name,
+                                   " regex could not be compiled.", NULL);
+            }
+            new->pattern = NULL;
 	}
 	new->features = apr_table_make(cmd->pool, 2);
 
 	if (!strcasecmp(fname, "remote_addr")) {
 	    new->special_type = SPECIAL_REMOTE_ADDR;
 	}
@@ -405,12 +477,13 @@
 static int match_headers(request_rec *r)
 {
     sei_cfg_rec *sconf;
     sei_entry *entries;
     const apr_table_entry_t *elts;
     const char *val;
+    apr_size_t val_len = 0;
     int i, j;
     char *last_name;
 
     if (!ap_get_module_config(r->request_config, &setenvif_module)) {
         ap_set_module_config(r->request_config, &setenvif_module,
                              SEI_MAGIC_HEIRLOOM);
@@ -474,25 +547,28 @@
                     val = apr_table_get(r->headers_in, b->name);
                     if (val == NULL) {
                         val = apr_table_get(r->subprocess_env, b->name);
                     }
                 }
 	    }
+            val_len = val ? strlen(val) : 0;
         }
 
 	/*
 	 * A NULL value indicates that the header field or special entity
 	 * wasn't present or is undefined.  Represent that as an empty string
 	 * so that REs like "^$" will work and allow envariable setting
 	 * based on missing or empty field.
 	 */
         if (val == NULL) {
             val = "";
+            val_len = 0;
         }
 
-        if (!ap_regexec(b->preg, val, 0, NULL, 0)) {
+        if ((b->pattern && apr_strmatch(b->pattern, val, val_len)) ||
+            (!b->pattern && !ap_regexec(b->preg, val, 0, NULL, 0))) {
 	    const apr_array_header_t *arr = apr_table_elts(b->features);
             elts = (const apr_table_entry_t *) arr->elts;
 
             for (j = 0; j < arr->nelts; ++j) {
                 if (*(elts[j].val) == '!') {
                     apr_table_unset(r->subprocess_env, elts[j].key);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_unique_id.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_unique_id.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/metadata/mod_unique_id.c	2002-04-26 03:57:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/metadata/mod_unique_id.c	2002-05-18 12:13:13.000000000 +0800
@@ -62,13 +62,13 @@
  * Original author: Dean Gaudet <dgaudet@arctic.org>
  * UUencoding modified by: Alvaro Martinez Echevarria <alvaro@lander.es>
  */
 
 #define APR_WANT_BYTEFUNC   /* for htons() et al */
 #include "apr_want.h"
-#include "apr_general.h"    /* for APR_XtOffsetOf                */
+#include "apr_general.h"    /* for APR_OFFSETOF                */
 #include "apr_network_io.h"
 
 #include "httpd.h"
 #include "http_config.h"
 #include "http_log.h"
 #include "http_protocol.h"  /* for ap_hook_post_read_request */
@@ -180,21 +180,21 @@
     char *ipaddrstr;
     apr_sockaddr_t *sockaddr;
 
     /*
      * Calculate the sizes and offsets in cur_unique_id.
      */
-    unique_id_rec_offset[0] = APR_XtOffsetOf(unique_id_rec, stamp);
+    unique_id_rec_offset[0] = APR_OFFSETOF(unique_id_rec, stamp);
     unique_id_rec_size[0] = sizeof(cur_unique_id.stamp);
-    unique_id_rec_offset[1] = APR_XtOffsetOf(unique_id_rec, in_addr);
+    unique_id_rec_offset[1] = APR_OFFSETOF(unique_id_rec, in_addr);
     unique_id_rec_size[1] = sizeof(cur_unique_id.in_addr);
-    unique_id_rec_offset[2] = APR_XtOffsetOf(unique_id_rec, pid);
+    unique_id_rec_offset[2] = APR_OFFSETOF(unique_id_rec, pid);
     unique_id_rec_size[2] = sizeof(cur_unique_id.pid);
-    unique_id_rec_offset[3] = APR_XtOffsetOf(unique_id_rec, counter);
+    unique_id_rec_offset[3] = APR_OFFSETOF(unique_id_rec, counter);
     unique_id_rec_size[3] = sizeof(cur_unique_id.counter);
-    unique_id_rec_offset[4] = APR_XtOffsetOf(unique_id_rec, thread_index);
+    unique_id_rec_offset[4] = APR_OFFSETOF(unique_id_rec, thread_index);
     unique_id_rec_size[4] = sizeof(cur_unique_id.thread_index);
     unique_id_rec_total_size = unique_id_rec_size[0] + unique_id_rec_size[1] +
                                unique_id_rec_size[2] + unique_id_rec_size[3] +
                                unique_id_rec_size[4];
 
     /*
@@ -231,13 +231,13 @@
         else
 #endif
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     apr_sockaddr_ip_get(&ipaddrstr, sockaddr);
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, main_server,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, main_server,
                 "mod_unique_id: using ip addr %s",
                  ipaddrstr);
 
     /*
      * If the server is pummelled with restart requests we could possibly end
      * up in a situation where we're starting again during the same second
@@ -277,13 +277,13 @@
      * Test our assumption that the pid is 32-bits.  It's possible that
      * 64-bit machines will declare pid_t to be 64 bits but only use 32
      * of them.  It would have been really nice to test this during
      * global_init ... but oh well.
      */
     if ((pid_t)cur_unique_id.pid != pid) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_CRIT, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_CRIT, 0, s,
                     "oh no! pids are greater than 32-bits!  I'm broken!");
     }
 
     cur_unique_id.in_addr = global_in_addr;
 
     /*
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/NWGNUmakefile	2002-05-01 05:54:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/NWGNUmakefile	2002-06-05 03:51:34.000000000 +0800
@@ -12,12 +12,30 @@
 	generators \
 	mappers \
 	metadata \
 	proxy \
 	$(EOLIST) 
 
+# If the ldap-aaa directory exists then build the auth_ldap module
+ifeq "$(wildcard $(AP_WORK)\modules\ldap-aaa)" "$(AP_WORK)\modules\ldap-aaa"
+SUBDIRS += ldap-aaa \
+		   $(EOLIST)
+endif
+
+#If the ldap-cache directory exists then build the ldaputil module
+ifeq "$(wildcard $(AP_WORK)\modules\ldap-cache)" "$(AP_WORK)\modules\ldap-cache"
+SUBDIRS += ldap-cache \
+	       $(EOLIST)
+endif
+
+# If the zlib libraries source exists then build the mod_deflate module
+ifeq "$(wildcard $(AP_WORK)\srclib\zlib)" "$(AP_WORK)\srclib\zlib"
+SUBDIRS += filters \
+	       $(EOLIST)
+endif
+
 #
 # Get the 'head' of the build environment.  This includes default targets and
 # paths to tools
 #
 
 include $(AP_WORK)\build\NWGNUhead.inc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/mod_proxy.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/mod_proxy.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/mod_proxy.c	2002-04-25 01:40:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/mod_proxy.c	2002-06-13 07:59:30.000000000 +0800
@@ -323,13 +323,13 @@
                                          domain, NULL);
     nuri = apr_uri_unparse(r->pool,
                            &r->parsed_uri,
                            APR_URI_UNP_REVEALPASSWORD);
 
     apr_table_set(r->headers_out, "Location", nuri);
-    ap_log_rerror(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                   "Domain missing: %s sent to %s%s%s", r->uri,
                   apr_uri_unparse(r->pool, &r->parsed_uri,
                                   APR_URI_UNP_OMITUSERINFO),
                   ref ? " from " : "", ref ? ref : "");
 
     return HTTP_MOVED_PERMANENTLY;
@@ -391,15 +391,12 @@
         /* set configured max-forwards */
         maxfwd = conf->maxfwd;
     }
     apr_table_set(r->headers_in, "Max-Forwards", 
                   apr_psprintf(r->pool, "%ld", (maxfwd > 0) ? maxfwd : 0));
 
-    if ((rc = ap_setup_client_block(r, REQUEST_CHUNKED_ERROR)))
-        return rc;
-
     url = r->filename + 6;
     p = strchr(url, ':');
     if (p == NULL)
         return HTTP_BAD_REQUEST;
 
     /* If the host doesn't have a domain name, add one and redirect. */
@@ -422,13 +419,13 @@
         struct dirconn_entry *list = (struct dirconn_entry *) conf->dirconn->elts;
 
         for (direct_connect = ii = 0; ii < conf->dirconn->nelts && !direct_connect; ii++) {
             direct_connect = list[ii].matcher(&list[ii], r);
         }
 #if DEBUGGING
-        ap_log_rerror(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_DEBUG, 0, r,
                       (direct_connect) ? "NoProxy for %s" : "UseProxy for %s",
                       r->uri);
 #endif
     }
 
     /* firstly, try a proxy, unless a NoProxy directive is active */
@@ -439,13 +436,13 @@
                 (ents[i].use_regex && ap_regexec(ents[i].regexp, url, 0,NULL, 0)) ||
                 (p2 == NULL && strcasecmp(scheme, ents[i].scheme) == 0) ||
                 (p2 != NULL &&
                  strncasecmp(url, ents[i].scheme, strlen(ents[i].scheme)) == 0)) {
 
                 /* handle the scheme */
-                ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "Trying to run scheme_handler against proxy");
                 access_status = proxy_run_scheme_handler(r, conf, url, ents[i].hostname, ents[i].port);
 
                 /* an error or success */
                 if (access_status != DECLINED && access_status != HTTP_BAD_GATEWAY) {
                     return access_status;
@@ -458,17 +455,17 @@
     /* otherwise, try it direct */
     /* N.B. what if we're behind a firewall, where we must use a proxy or
      * give up??
      */
 
     /* handle the scheme */
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "Trying to run scheme_handler");
     access_status = proxy_run_scheme_handler(r, conf, url, NULL, 0);
     if (DECLINED == access_status) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,
                     "proxy: No protocol handler was valid for the URL %s. "
                     "If you are using a DSO version of mod_proxy, make sure "
                     "the proxy submodules are included in the configuration "
                     "using LoadModule.", r->uri);
         return HTTP_FORBIDDEN;
     }
@@ -759,29 +756,29 @@
         New = apr_array_push(conf->dirconn);
         New->name = apr_pstrdup(parms->pool, arg);
         New->hostaddr = NULL;
 
 	if (ap_proxy_is_ipaddr(New, parms->pool)) {
 #if DEBUGGING
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "Parsed addr %s", inet_ntoa(New->addr));
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "Parsed mask %s", inet_ntoa(New->mask));
 #endif
 	}
 	else if (ap_proxy_is_domainname(New, parms->pool)) {
             ap_str_tolower(New->name);
 #if DEBUGGING
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "Parsed domain %s", New->name);
 #endif
         }
         else if (ap_proxy_is_hostname(New, parms->pool)) {
             ap_str_tolower(New->name);
 #if DEBUGGING
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "Parsed host %s", New->name);
 #endif
         }
         else {
             ap_proxy_is_word(New, parms->pool);
 #if DEBUGGING
@@ -886,13 +883,13 @@
 
     timeout=atoi(arg);
     if (timeout<1) {
         return "Proxy Timeout must be at least 1 second.";
     }
     psf->timeout_set=1;
-    psf->timeout=timeout;
+    psf->timeout=apr_time_from_sec(timeout);
 
     return NULL;    
 }
 
 static const char*
     set_via_opt(cmd_parms *parms, void *dummy, const char *arg)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/mod_proxy.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/mod_proxy.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/mod_proxy.h	2002-04-26 20:29:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/mod_proxy.h	2002-06-15 01:14:57.000000000 +0800
@@ -191,14 +191,14 @@
      * returned from the rest of the system 
      */
     int error_override;
     int error_override_set;
     int preserve_host;
     int preserve_host_set;
-    int timeout;
-    int timeout_set;
+    apr_interval_time_t timeout;
+    apr_interval_time_t timeout_set;
 
 } proxy_server_conf;
 
 typedef struct {
     const char *p;            /* The path */
     int         p_is_fnmatch; /* Is this path an fnmatch candidate? */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_connect.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_connect.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_connect.c	2002-03-14 04:47:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_connect.c	2002-05-17 19:24:16.000000000 +0800
@@ -109,13 +109,13 @@
 int ap_proxy_connect_canon(request_rec *r, char *url)
 {
 
     if (r->method_number != M_CONNECT) {
 	return DECLINED;
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: canonicalising URL %s", url);
 
     return OK;
 }
 
 /* CONNECT handler */
@@ -138,17 +138,17 @@
     apr_uri_t uri;
     const char *connectname;
     int connectport = 0;
 
     /* is this for us? */
     if (r->method_number != M_CONNECT) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		     "proxy: CONNECT: declining URL %s", url);
 	return DECLINED;
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: serving URL %s", url);
 
 
     /*
      * Step One: Determine Who To Connect To
      *
@@ -158,13 +158,13 @@
     /* we break the URL into host, port, uri */
     if (APR_SUCCESS != apr_uri_parse_hostinfo(p, url, &uri)) {
 	return ap_proxyerror(r, HTTP_BAD_REQUEST,
 			     apr_pstrcat(p, "URI cannot be parsed: ", url, NULL));
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: connecting %s to %s:%d", url, uri.hostname, uri.port);
 
     /* do a DNS lookup for the destination host */
     err = apr_sockaddr_info_get(&uri_addr, uri.hostname, APR_UNSPEC, uri.port, 0, p);
 
     /* are we connecting directly, or via a proxy? */
@@ -175,13 +175,13 @@
     }
     else {
 	connectname = uri.hostname;
 	connectport = uri.port;
 	connect_addr = uri_addr;
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: connecting to remote proxy %s on port %d", connectname, connectport);
 
     /* check if ProxyBlock directive on this host */
     if (OK != ap_proxy_checkproxyblock(r, conf, uri_addr)) {
 	return ap_proxyerror(r, HTTP_FORBIDDEN,
 			     "Connect to remote machine blocked");
@@ -259,42 +259,44 @@
     /* If we are connecting through a remote proxy, we need to pass
      * the CONNECT request on to it.
      */
     if (proxyport) {
 	/* FIXME: Error checking ignored.
 	 */
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		     "proxy: CONNECT: sending the CONNECT request to the remote proxy");
         nbytes = apr_snprintf(buffer, sizeof(buffer),
 			      "CONNECT %s HTTP/1.0" CRLF, r->uri);
         apr_send(sock, buffer, &nbytes);
         nbytes = apr_snprintf(buffer, sizeof(buffer),
 			      "Proxy-agent: %s" CRLF CRLF, ap_get_server_version());
         apr_send(sock, buffer, &nbytes);
     }
     else {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		     "proxy: CONNECT: Returning 200 OK Status");
         nbytes = apr_snprintf(buffer, sizeof(buffer),
 			      "HTTP/1.0 200 Connection Established" CRLF);
+        ap_xlate_proto_to_ascii(buffer, nbytes);
         apr_send(client_socket, buffer, &nbytes);
         nbytes = apr_snprintf(buffer, sizeof(buffer),
 			      "Proxy-agent: %s" CRLF CRLF, ap_get_server_version());
+        ap_xlate_proto_to_ascii(buffer, nbytes);
+        apr_send(client_socket, buffer, &nbytes);
 #if 0
         /* This is safer code, but it doesn't work yet.  I'm leaving it 
          * here so that I can fix it later.
          */
-        apr_send(r->connection->client_socket, buffer, &nbytes);
         r->status = HTTP_OK;
         r->header_only = 1;
         apr_table_set(r->headers_out, "Proxy-agent: %s", ap_get_server_version());
         ap_rflush(r);
 #endif
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: setting up poll()");
 
     /*
      * Step Four: Handle Data Transfer
      *
      * Handle two way transfer of data over the socket (this is a tunnel).
@@ -314,26 +316,26 @@
     apr_poll_socket_add(pollfd, client_socket, APR_POLLIN);
 
     /* Add the server side to the poll */
     apr_poll_socket_add(pollfd, sock, APR_POLLIN);
 
     while (1) { /* Infinite loop until error (one side closes the connection) */
-/*	ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server, "proxy: CONNECT: going to sleep (poll)");*/
+/*	ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server, "proxy: CONNECT: going to sleep (poll)");*/
         if ((rv = apr_poll(pollfd, &pollcnt, -1)) != APR_SUCCESS)
         {
 	    apr_socket_close(sock);
             ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r, "proxy: CONNECT: error apr_poll()");
             return HTTP_INTERNAL_SERVER_ERROR;
         }
-/*	ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+/*	ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: CONNECT: woke from select(), i=%d", pollcnt);*/
 
         if (pollcnt) {
 	    apr_poll_revents_get(&pollevent, sock, pollfd);
             if (pollevent & APR_POLLIN) {
-/*		ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+/*		ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "proxy: CONNECT: sock was set");*/
                 nbytes = sizeof(buffer);
                 if (apr_recv(sock, buffer, &nbytes) == APR_SUCCESS) {
                     o = 0;
                     i = nbytes;
                     while(i > 0)
@@ -357,13 +359,13 @@
             else if ((pollevent & APR_POLLERR) || (pollevent & APR_POLLHUP))
 		break;
 
 
             apr_poll_revents_get(&pollevent, client_socket, pollfd);
             if (pollevent & APR_POLLIN) {
-/*		ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+/*		ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "proxy: CONNECT: client was set");*/
                 nbytes = sizeof(buffer);
                 if (apr_recv(client_socket, buffer, &nbytes) == APR_SUCCESS) {
                     o = 0;
                     i = nbytes;
                     while(i > 0)
@@ -382,13 +384,13 @@
 		break;
         }
         else
             break;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
 		 "proxy: CONNECT: finished with poll() - cleaning up");
 
     /*
      * Step Five: Clean Up
      *
      * Close the socket and clean up
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_ftp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_ftp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_ftp.c	2002-04-26 22:43:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_ftp.c	2002-06-15 01:14:57.000000000 +0800
@@ -187,13 +187,13 @@
     }
     else {
         return DECLINED;
     }
     def_port = apr_uri_default_port_for_scheme("ftp");
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: canonicalising URL %s", url);
 
     port = def_port;
     err = ap_proxy_canon_netloc(p, &url, &user, &password, &host, &port);
     if (err)
         return HTTP_BAD_REQUEST;
@@ -274,13 +274,13 @@
     int eos;
 
     if (APR_SUCCESS != (rv = ap_proxy_string_read(ftp_ctrl, bb, response, sizeof(response), &eos))) {
         return -1;
     }
 /*
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL,
                  "proxy: <FTP: %s", response);
 */
     if (!apr_isdigit(response[0]) || !apr_isdigit(response[1]) ||
     !apr_isdigit(response[2]) || (response[3] != ' ' && response[3] != '-'))
         status = 0;
     else
@@ -646,23 +646,23 @@
         ap_cpystrn(message, cmd, sizeof message);
         if ((crlf = strchr(message, '\r')) != NULL ||
             (crlf = strchr(message, '\n')) != NULL)
             *crlf = '\0';
         if (strncmp(message,"PASS ", 5) == 0)
             strcpy(&message[5], "****");
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy:>FTP: %s", message);
     }
 
     rc = ftp_getrc_msg(ftp_ctrl, bb, message, sizeof message);
     if (rc == -1 || rc == 421)
         strcpy(message,"<unable to read result>");
     if ((crlf = strchr(message, '\r')) != NULL ||
         (crlf = strchr(message, '\n')) != NULL)
         *crlf = '\0';
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy:<FTP: %3.3u %s", rc, message);
 
     if (pmessage != NULL)
         *pmessage = ap_pstrdup(r->pool, message);
 
     return rc;
@@ -749,13 +749,13 @@
     r->proxyreq = PROXYREQ_NONE;
     /*
      * Log failed requests if they supplied a password (log username/password
      * guessing attempts)
      */
     if (log_it)
-        ap_log_rerror(APLOG_MARK, APLOG_INFO | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                       "proxy: missing or failed auth to %s",
                       apr_uri_unparse(r->pool,
                                  &r->parsed_uri, APR_URI_UNP_OMITPATHINFO));
 
     apr_table_setn(r->err_headers_out, "WWW-Authenticate",
                    apr_pstrcat(r->pool, "Basic realm=\"",
@@ -808,22 +808,22 @@
     /* stuff for PASV mode */
     int connect = 0, use_port = 0;
     char dates[AP_RFC822_DATE_LEN];
 
     /* is this for us? */
     if (proxyhost) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: declining URL %s - proxyhost %s specified:", url, proxyhost);
         return DECLINED;        /* proxy connections are via HTTP */
     }
     if (strncasecmp(url, "ftp:", 4)) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: declining URL %s - not ftp:", url);
         return DECLINED;        /* only interested in FTP */
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: serving URL %s", url);
 
     /* create space for state information */
     backend = (proxy_conn_rec *) ap_get_module_config(c->conn_config, &proxy_ftp_module);
     if (!backend) {
         backend = ap_pcalloc(c->pool, sizeof(proxy_conn_rec));
@@ -910,13 +910,13 @@
     }
     else {
         user = "anonymous";
         password = "apache-proxy@";
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
        "proxy: FTP: connecting %s to %s:%d", url, connectname, connectport);
 
     /* do a DNS lookup for the destination host */
     err = apr_sockaddr_info_get(&connect_addr, connectname, APR_UNSPEC, connectport, 0, p);
 
     /* check if ProxyBlock directive on this host */
@@ -965,23 +965,20 @@
         return HTTP_INTERNAL_SERVER_ERROR;
 #endif                          /* _OSD_POSIX */
     }
 
     /* Set a timeout on the socket */
     if (conf->timeout_set == 1) {
-        apr_setsocketopt(sock, 
-                         APR_SO_TIMEOUT, 
-                         (int)(conf->timeout * APR_USEC_PER_SEC));
+        apr_setsocketopt(sock, APR_SO_TIMEOUT, (int)conf->timeout);
     }
     else {
         apr_setsocketopt(sock, 
-                         APR_SO_TIMEOUT, 
-                         (int)(r->server->timeout * APR_USEC_PER_SEC));
+                         APR_SO_TIMEOUT, (int)r->server->timeout);
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: socket has been created");
 
 
     /*
      * At this point we have a list of one or more IP addresses of the
      * machine to connect to. If configured, reorder this list so that the
@@ -1000,13 +997,13 @@
             /* FIXME: @@@: We created an APR_INET socket. Now there may be
              * IPv6 (AF_INET6) DNS addresses in the list... IMO the socket
              * should be created with the correct family in the first place.
              * (either do it in this loop, or make at least two attempts
              * with the AF_INET and AF_INET6 elements in the list)
              */
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: FTP: trying to connect to %pI (%s)...", connect_addr, connectname);
 
             /* make the connection out of the socket */
             rv = apr_connect(sock, connect_addr);
 
             /* if an error occurred, loop round and try again */
@@ -1035,26 +1032,26 @@
                                       r->connection->sbh, c->bucket_alloc);
     if (!origin) {
         /*
          * the peer reset the connection already; ap_run_create_connection() closed
          * the socket
          */
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: an error occurred creating a new connection to %pI (%s)", connect_addr, connectname);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     /* if a keepalive connection is floating around, close it first! */
     /* we might support ftp keepalives later, but not now... */
     if (backend->connection) {
         apr_socket_close(origin_sock);
         backend->connection = NULL;
         origin_sock = NULL;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: control connection complete");
 
 
     /*
      * III: Send Control Request -------------------------
      *
@@ -1278,13 +1275,13 @@
             }
 
             if (pstr) {
                 apr_sockaddr_t *epsv_addr;
                 data_port = atoi(pstr + 3);
 
-                ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                        "proxy: FTP: EPSV contacting remote host on port %d",
                              data_port);
 
                 if ((rv = apr_socket_create(&data_sock, APR_INET, SOCK_STREAM, r->pool)) != APR_SUCCESS) {
                     ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
                                   "proxy: FTP: error creating EPSV socket");
@@ -1364,13 +1361,13 @@
 
             if (pstr != NULL && (sscanf(pstr,
                  "%d,%d,%d,%d,%d,%d", &h3, &h2, &h1, &h0, &p1, &p0) == 6)) {
 
                 apr_sockaddr_t *pasv_addr;
                 apr_port_t pasvport = (p1 << 8) + p0;
-                ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                           "proxy: FTP: PASV contacting host %d.%d.%d.%d:%d",
                              h3, h2, h1, h0, pasvport);
 
                 if ((rv = apr_socket_create(&data_sock, APR_INET, SOCK_STREAM, r->pool)) != APR_SUCCESS) {
                     ap_log_rerror(APLOG_MARK, APLOG_ERR, rv, r,
                                   "proxy: error creating PASV socket");
@@ -1534,13 +1531,13 @@
                 ;
             ftpmessage[j] = '\0';
             if (ftpmessage[0] != '\0')
                  size = ftpmessage; /* already pstrdup'ed: no copy necessary */
         }
         else if (rc == 550) {    /* Not a regular file */
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "proxy: FTP: SIZE shows this is a directory");
             dirlisting = 1;
             rc = proxy_ftp_command(apr_pstrcat(p, "CWD ", 
                            ftp_escape_globbingchars(p, path), CRLF, NULL),
                            r, origin, bb, &ftpmessage);
             /* possible results: 250, 421, 500, 501, 502, 530, 550 */
@@ -1667,13 +1664,13 @@
     /* 550 Requested action not taken. */
     if (rc == -1 || rc == 421) {
         return ap_proxyerror(r, HTTP_BAD_GATEWAY,
                              "Error reading from remote server");
     }
     if (rc == 550) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: RETR failed, trying LIST instead");
 
         /* Directory Listings should always be fetched in ASCII mode */
         dirlisting = 1;
         ftp_set_TYPE('A', r, origin, bb, NULL);
 
@@ -1729,35 +1726,35 @@
     /* set content-type */
     if (dirlisting) {
         ap_set_content_type(r, "text/html");
     }
     else {
         if (r->content_type) {
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: Content-Type set to %s", r->content_type);
         }
         else {
             ap_set_content_type(r, ap_default_type(r));
         }
         if (xfer_type != 'A' && size != NULL) {
             /* We "trust" the ftp server to really serve (size) bytes... */
             apr_table_setn(r->headers_out, "Content-Length", size);
-            ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: FTP: Content-Length set to %s", size);
         }
     }
     apr_table_setn(r->headers_out, "Content-Type", r->content_type);
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: Content-Type set to %s", r->content_type);
 
 #if defined(USE_MDTM) && (defined(HAVE_TIMEGM) || defined(HAVE_GMTOFF))
     if (mtime != 0L) {
         char datestr[APR_RFC822_DATE_LEN];
         apr_rfc822_date(datestr, mtime);
         apr_table_set(r->headers_out, "Last-Modified", datestr);
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: FTP: Last-Modified set to %s", datestr);
     }
 #endif /* USE_MDTM */
 
     /* If an encoding has been set by mistake, delete it.
      * @@@ FIXME (e.g., for ftp://user@host/file*.tar.gz,
@@ -1765,13 +1762,13 @@
      */
     if (dirlisting && r->content_encoding != NULL)
         r->content_encoding = NULL;
 
     /* set content-encoding (not for dir listings, they are uncompressed)*/
     if (r->content_encoding != NULL && r->content_encoding[0] != '\0') {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
              "proxy: FTP: Content-Encoding set to %s", r->content_encoding);
         apr_table_setn(r->headers_out, "Content-Encoding", r->content_encoding);
     }
 
     /* wait for connection */
     if (use_port) {
@@ -1796,13 +1793,13 @@
                                     r->connection->sbh, c->bucket_alloc);
     if (!data) {
         /*
          * the peer reset the connection already; ap_run_create_connection() closed
          * the socket
          */
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
           "proxy: FTP: an error occurred creating the transfer connection");
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     /* set up the connection filters */
     ap_run_pre_connection(data, data_sock);
@@ -1823,26 +1820,26 @@
 
     /* send body */
     if (!r->header_only) {
         apr_bucket *e;
         int finish = FALSE;
 
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: start body send");
 
         /* read the body, pass it to the output filters */
         while (ap_get_brigade(data->input_filters, 
                               bb, 
                               AP_MODE_READBYTES, 
                               APR_BLOCK_READ, 
                               conf->io_buffer_size) == APR_SUCCESS) {
 #if DEBUGGING
             {
                 apr_off_t readbytes;
                 apr_brigade_length(bb, 0, &readbytes);
-                ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
                              r->server, "proxy (PID %d): readbytes: %#x",
                              getpid(), readbytes);
             }
 #endif
             /* sanity check */
             if (APR_BRIGADE_EMPTY(bb)) {
@@ -1857,13 +1854,13 @@
                  * backend server from hanging around waiting
                  * for a slow client to eat these bytes
                  */
                 ap_flush_conn(data);
                 apr_socket_close(data_sock);
                 data_sock = NULL;
-                ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "proxy: FTP: data connection closed");
                 /* signal that we must leave */
                 finish = TRUE;
             }
 
             /* if no EOS yet, then we must flush */
@@ -1883,20 +1880,20 @@
 
             /* if we are done, leave */
             if (TRUE == finish) {
                 break;
             }
         }
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: end body send");
 
     }
     if (data_sock) {
         ap_flush_conn(data);
         apr_socket_close(data_sock);
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: FTP: data connection closed");
     }
 
     /* Retrieve the final response for the RETR or LIST commands */
     rc = proxy_ftp_command(NULL, r, origin, bb, &ftpmessage);
     apr_brigade_cleanup(bb);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_http.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_http.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_http.c	2002-04-26 20:29:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_http.c	2002-06-15 01:14:57.000000000 +0800
@@ -103,13 +103,13 @@
     }
     else {
         return DECLINED;
     }
     def_port = apr_uri_default_port_for_scheme(scheme);
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
              "proxy: HTTP: canonicalising URL %s", url);
 
     /* do syntatic check.
      * We break the URL into host, port, path, search
      */
     port = def_port;
@@ -215,13 +215,13 @@
                                          NULL));
     }
     if (!uri->port) {
         uri->port = apr_uri_default_port_for_scheme(uri->scheme);
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                  "proxy: HTTP connecting %s to %s:%d", *url, uri->hostname,
                  uri->port);
 
     /* do a DNS lookup for the destination host */
     /* see memory note above */
     err = apr_sockaddr_info_get(&uri_addr, apr_pstrdup(c->pool, uri->hostname),
@@ -297,16 +297,16 @@
     if (backend->connection) {
         client_socket = ap_get_module_config(backend->connection->conn_config, &core_module);
         if ((backend->connection->id == c->id) &&
             (backend->port == p_conn->port) &&
             (backend->hostname) &&
             (!apr_strnatcasecmp(backend->hostname, p_conn->name))) {
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: keepalive address match (keep original socket)");
         } else {
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: keepalive address mismatch / connection has"
                          " changed (close old socket (%s/%s, %d/%d))", 
                          p_conn->name, backend->hostname, p_conn->port,
                          backend->port);
             apr_socket_close(client_socket);
             backend->connection = NULL;
@@ -316,13 +316,13 @@
     /* get a socket - either a keepalive one, or a new one */
     new = 1;
     if ((backend->connection) && (backend->connection->id == c->id)) {
         apr_size_t buffer_len = 1;
         char test_buffer[1]; 
         apr_status_t socket_status;
-        apr_int32_t current_timeout;
+        apr_short_interval_time_t current_timeout;
 
         /* use previous keepalive socket */
         *origin = backend->connection;
         p_conn->sock = client_socket;
         new = 0;
 
@@ -331,13 +331,13 @@
         /* set no timeout */
         apr_setsocketopt(p_conn->sock, APR_SO_TIMEOUT, 0);
         socket_status = apr_recv(p_conn->sock, test_buffer, &buffer_len);
         /* put back old timeout */
         apr_setsocketopt(p_conn->sock, APR_SO_TIMEOUT, current_timeout);
         if ( APR_STATUS_IS_EOF(socket_status) ) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                          "proxy: HTTP: previous connection is closed");
             new = 1;
         }
     }
     if (new) {
 
@@ -364,47 +364,47 @@
                 return DECLINED;
             } else {
                 return HTTP_BAD_GATEWAY;
             }
         }
 
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: socket is connected");
 
         /* the socket is now open, create a new backend server connection */
         *origin = ap_run_create_connection(c->pool, r->server, p_conn->sock,
                                            r->connection->id,
                                            r->connection->sbh, c->bucket_alloc);
         if (!origin) {
         /* the peer reset the connection already; ap_run_create_connection() 
          * closed the socket
          */
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
                          r->server, "proxy: an error occurred creating a "
                          "new connection to %pI (%s)", p_conn->addr,
                          p_conn->name);
             apr_socket_close(p_conn->sock);
             return HTTP_INTERNAL_SERVER_ERROR;
         }
         backend->connection = *origin;
         backend->hostname = apr_pstrdup(c->pool, p_conn->name);
         backend->port = p_conn->port;
 
         if (backend->is_ssl) {
             if (!ap_proxy_ssl_enable(backend->connection)) {
-                ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0,
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0,
                              r->server, "proxy: failed to enable ssl support "
                              "for %pI (%s)", p_conn->addr, p_conn->name);
                 return HTTP_INTERNAL_SERVER_ERROR;
             }
         }
         else {
             ap_proxy_ssl_disable(backend->connection);
         }
 
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: connection complete to %pI (%s)",
                      p_conn->addr, p_conn->name);
 
         /* set up the connection filters */
         ap_run_pre_connection(*origin, p_conn->sock);
     }
@@ -416,18 +416,17 @@
                                    proxy_http_conn_t *p_conn, conn_rec *origin, 
                                    proxy_server_conf *conf,
                                    apr_uri_t *uri,
                                    char *url, apr_bucket_brigade *bb,
                                    char *server_portstr) {
     conn_rec *c = r->connection;
-    char buffer[HUGE_STRING_LEN];
     char *buf;
     apr_bucket *e;
     const apr_array_header_t *headers_in_array;
     const apr_table_entry_t *headers_in;
-    int counter;
+    int counter, seen_eos;
     apr_status_t status;
 
     /*
      * Send the HTTP/1.1 request to the remote server
      */
 
@@ -447,13 +446,21 @@
     ap_proxy_clear_connection(p, r->headers_in);
     if (p_conn->close) {
         apr_table_setn(r->headers_in, "Connection", "close");
         origin->keepalive = 0;
     }
 
-    buf = apr_pstrcat(p, r->method, " ", url, " HTTP/1.1" CRLF, NULL);
+    if ( apr_table_get(r->subprocess_env,"force-proxy-request-1.0")) {
+        buf = apr_pstrcat(p, r->method, " ", url, " HTTP/1.0" CRLF, NULL);
+    } else {
+        buf = apr_pstrcat(p, r->method, " ", url, " HTTP/1.1" CRLF, NULL);
+    }
+    if ( apr_table_get(r->subprocess_env,"proxy-nokeepalive")) {
+        apr_table_unset(r->headers_in, "Connection");
+        origin->keepalive = 0;
+    }
     ap_xlate_proto_to_ascii(buf, strlen(buf));
     e = apr_bucket_pool_create(buf, strlen(buf), p, c->bucket_alloc);
     APR_BRIGADE_INSERT_TAIL(bb, e);
     if ( conf->preserve_host == 0 ) {
         if (uri->port_str && uri->port != DEFAULT_HTTP_PORT) {
             buf = apr_pstrcat(p, "Host: ", uri->hostname, ":", uri->port_str, CRLF,
@@ -466,13 +473,13 @@
         /* don't want to use r->hostname, as the incoming header might have a 
          * port attached 
          */
         const char* hostname = apr_table_get(r->headers_in,"Host");        
         if (!hostname) {
             hostname =  r->server->server_hostname;
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
                           "proxy: no HTTP 0.9 request (with no host line) "
                           "on incoming request and preserve host set "
                           "forcing hostname to be %s for uri %s", 
                           hostname, 
                           r->uri );
         }
@@ -617,28 +624,48 @@
                      "proxy: request failed to %pI (%s)",
                      p_conn->addr, p_conn->name);
         return status;
     }
 
     /* send the request data, if any. */
-    if (ap_should_client_block(r)) {
-        while ((counter = ap_get_client_block(r, buffer, sizeof(buffer))) > 0) {
-            e = apr_bucket_pool_create(buffer, counter, p, c->bucket_alloc);
-            APR_BRIGADE_INSERT_TAIL(bb, e);
-            e = apr_bucket_flush_create(c->bucket_alloc);
-            APR_BRIGADE_INSERT_TAIL(bb, e);
-            status = ap_pass_brigade(origin->output_filters, bb);
-            if (status != APR_SUCCESS) {
-                ap_log_error(APLOG_MARK, APLOG_ERR, status, r->server,
-                             "proxy: pass request data failed to %pI (%s)",
-                             p_conn->addr, p_conn->name);
-                return status;
+    seen_eos = 0;
+    do {
+        status = ap_get_brigade(r->input_filters, bb, AP_MODE_READBYTES,
+                                APR_BLOCK_READ, HUGE_STRING_LEN);
+
+        if (status != APR_SUCCESS) {
+            return status;
+        }
+
+        /* If this brigade contain EOS, either stop or remove it. */
+        if (APR_BUCKET_IS_EOS(APR_BRIGADE_LAST(bb))) {
+            /* As a shortcut, if this brigade is simply an EOS bucket,
+             * don't send anything down the filter chain.
+             */
+            if (APR_BUCKET_IS_EOS(APR_BRIGADE_FIRST(bb))) {
+                break;
             }
-            apr_brigade_cleanup(bb);
+
+            /* We can't pass this EOS to the output_filters. */
+            APR_BUCKET_REMOVE(APR_BRIGADE_LAST(bb));
+            seen_eos = 1;
         }
-    }
+
+        e = apr_bucket_flush_create(c->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(bb, e);
+
+        status = ap_pass_brigade(origin->output_filters, bb);
+        if (status != APR_SUCCESS) {
+            ap_log_error(APLOG_MARK, APLOG_ERR, status, r->server,
+                         "proxy: pass request data failed to %pI (%s)",
+                         p_conn->addr, p_conn->name);
+            return status;
+        }
+        apr_brigade_cleanup(bb);
+    } while (!seen_eos);
+
     return APR_SUCCESS;
 }
 
 static
 apr_status_t ap_proxy_http_process_response(apr_pool_t * p, request_rec *r,
                                             proxy_http_conn_t *p_conn,
@@ -660,25 +687,29 @@
 
     /* Get response from the remote server, and pass it up the
      * filter chain
      */
 
     rp = ap_proxy_make_fake_req(origin, r);
+    /* In case anyone needs to know, this is a fake request that is really a
+     * response.
+     */
+    rp->proxyreq = PROXYREQ_RESPONSE;
 
     while (received_continue) {
         apr_brigade_cleanup(bb);
 
         len = ap_getline(buffer, sizeof(buffer), rp, 0);
         if (len == 0) {
             /* handle one potential stray CRLF */
             len = ap_getline(buffer, sizeof(buffer), rp, 0);
         }
         if (len <= 0) {
             apr_socket_close(p_conn->sock);
             backend->connection = NULL;
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "proxy: error reading status line from remote "
                           "server %s", p_conn->name);
             return ap_proxyerror(r, HTTP_BAD_GATEWAY,
                                  "Error reading from remote server");
         }
 
@@ -714,13 +745,13 @@
             /* N.B. for HTTP/1.0 clients, we have to fold line-wrapped headers*/
             /* Also, take care with headers with multiple occurences. */
 
             r->headers_out = ap_proxy_read_headers(r, rp, buffer,
                                                    sizeof(buffer), origin);
             if (r->headers_out == NULL) {
-                ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0,
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                              r->server, "proxy: bad HTTP/%d.%d header "
                              "returned by %s (%s)", major, minor, r->uri,
                              r->method);
                 p_conn->close += 1;
                 /*
                  * ap_send_error relies on a headers_out to be present. we
@@ -777,13 +808,13 @@
             p_conn->close += 1;
         }
 
         if ( r->status != HTTP_CONTINUE ) {
             received_continue = 0;
         } else {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL,
                          "proxy: HTTP: received 100 CONTINUE");
         }
 
         /* we must accept 3 kinds of date, but generate only 1 kind of date */
         {
             const char *buf;
@@ -845,13 +876,13 @@
             /* In order for ap_set_keepalive to work properly, we can NOT
              * have any length information stored in the output headers.
              */
             apr_table_unset(r->headers_out,"Transfer-Encoding");
             apr_table_unset(r->headers_out,"Content-Length");
 
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: start body send");
              
             /*
              * if we are overriding the errors, we can't put the content
              * of the page into the brigade
              */
@@ -865,13 +896,13 @@
                                       APR_BLOCK_READ, 
                                       conf->io_buffer_size) == APR_SUCCESS) {
 #if DEBUGGING
                     {
                     apr_off_t readbytes;
                     apr_brigade_length(bb, 0, &readbytes);
-                    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0,
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
                                  r->server, "proxy (PID %d): readbytes: %#x",
                                  getpid(), readbytes);
                     }
 #endif
                     /* sanity check */
                     if (APR_BRIGADE_EMPTY(bb)) {
@@ -904,16 +935,16 @@
                     /* if we are done, leave */
                     if (TRUE == finish) {
                         break;
                     }
                 }
             }
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: end body send");
         } else {
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: header only");
         }
     }
 
     if ( conf->error_override ) {
         /* the code above this checks for 'OK' which is what the hook expects */
@@ -991,25 +1022,25 @@
     proxy_http_conn_t *p_conn = apr_pcalloc(r->connection->pool,
                                            sizeof(*p_conn));
 
     /* is it for us? */
     if (strncasecmp(url, "https:", 6) == 0) {
         if (!ap_proxy_ssl_enable(NULL)) {
-            ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                          "proxy: HTTPS: declining URL %s"
                          " (mod_ssl not configured?)", url);
             return DECLINED;
         }
         is_ssl = 1;
     }
     else if (strncasecmp(url, "http:", 5)) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: HTTP: declining URL %s", url);
         return DECLINED; /* only interested in HTTP */
     }
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
              "proxy: HTTP: serving URL %s", url);
     
     
     /* only use stored info for top-level pages. Sub requests don't share 
      * in keepalives
      */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/proxy/proxy_util.c	2002-04-26 06:12:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/proxy/proxy_util.c	2002-06-15 01:14:57.000000000 +0800
@@ -452,13 +452,13 @@
 
 	    if (!apr_date_checkmask(buffer, "HTTP/#.# ###*")) {
 		/* Nope, it wasn't even an extra HTTP header. Give up. */
 		return NULL;
 	    }
 
-	    ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, r->server,
+	    ap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,
 			 "proxy: Ignoring duplicate HTTP header "
 			 "returned by %s (%s)", r->uri, r->method);
 	    continue;
 	}
 
         *value = '\0';
@@ -621,13 +621,13 @@
 		"</STRONG>", NULL));
 
     /* Allow "error-notes" string to be printed by ap_send_error_response() */
     apr_table_setn(r->notes, "verbose-error-to", apr_pstrdup(r->pool, "*"));
 
     r->status_line = apr_psprintf(r->pool, "%3.3u Proxy Error", statuscode);
-    ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 			 "proxy: %s returned by %s", message, r->uri);
     return statuscode;
 }
 
 static const char *
      proxy_get_host_of_request(request_rec *r)
@@ -645,13 +645,13 @@
 
     url = apr_pstrdup(r->pool, &url[1]);	/* make it point to "//", which is what proxy_canon_netloc expects */
 
     err = ap_proxy_canon_netloc(r->pool, &url, &user, &password, &host, &port);
 
     if (err != NULL)
-	ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
+	ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 		     "%s", err);
 
     r->hostname = host;
 
     return host;		/* ought to return the port, too */
 }
@@ -733,25 +733,25 @@
 	    return 0;
 
 	/* every zero-byte counts as 8 zero-bits */
 	bits = 8 * quads;
 
 	if (bits != 32)		/* no warning for fully qualified IP address */
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 	      "Warning: NetMask not supplied with IP-Addr; guessing: %s/%ld\n",
 		 inet_ntoa(This->addr), bits);
     }
 
     This->mask.s_addr = htonl(APR_INADDR_NONE << (32 - bits));
 
     if (*addr == '\0' && (This->addr.s_addr & ~This->mask.s_addr) != 0) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 	    "Warning: NetMask and IP-Addr disagree in %s/%ld\n",
 		inet_ntoa(This->addr), bits);
 	This->addr.s_addr &= This->mask.s_addr;
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 	    "         Set to %s/%ld\n",
 		inet_ntoa(This->addr), bits);
     }
 
     if (*addr == '\0') {
 	This->matcher = proxy_match_ipaddr;
@@ -777,69 +777,69 @@
     if (4 == sscanf(host, "%d.%d.%d.%d", &ip_addr[0], &ip_addr[1], &ip_addr[2], &ip_addr[3])) {
 	for (addr.s_addr = 0, i = 0; i < 4; ++i)
 	    addr.s_addr |= htonl(ip_addr[i] << (24 - 8 * i));
 
 	if (This->addr.s_addr == (addr.s_addr & This->mask.s_addr)) {
 #if DEBUGGING
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "1)IP-Match: %s[%s] <-> ", host, inet_ntoa(addr));
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "%s/", inet_ntoa(This->addr));
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "%s", inet_ntoa(This->mask));
 #endif
 	    return 1;
 	}
 #if DEBUGGING
 	else {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "1)IP-NoMatch: %s[%s] <-> ", host, inet_ntoa(addr));
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "%s/", inet_ntoa(This->addr));
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "%s", inet_ntoa(This->mask));
 	}
 #endif
     }
     else {
 	struct apr_sockaddr_t *reqaddr;
 
         if (apr_sockaddr_info_get(&reqaddr, host, APR_UNSPEC, 0, 0, r->pool)
 	    != APR_SUCCESS) {
 #if DEBUGGING
-	    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+	    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			 "2)IP-NoMatch: hostname=%s msg=Host not found", 
 			 host);
 #endif
 	    return 0;
 	}
 
 	/* Try to deal with multiple IP addr's for a host */
 	/* FIXME: This needs to be able to deal with IPv6 */
 	while (reqaddr) {
 	    ip = (struct in_addr *) reqaddr->ipaddr_ptr;
 	    if (This->addr.s_addr == (ip->s_addr & This->mask.s_addr)) {
 #if DEBUGGING
-		ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+		ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "3)IP-Match: %s[%s] <-> ", host, 
 			     inet_ntoa(*ip));
-		ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+		ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "%s/", inet_ntoa(This->addr));
-		ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+		ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "%s", inet_ntoa(This->mask));
 #endif
 		return 1;
 	    }
 #if DEBUGGING
 	    else {
-                ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+                ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "3)IP-NoMatch: %s[%s] <-> ", host, 
 			     inet_ntoa(*ip));
-                ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+                ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "%s/", inet_ntoa(This->addr));
-                ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+                ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
 			     "%s", inet_ntoa(This->mask));
 	    }
 #endif
 	    reqaddr = reqaddr->next;
 	}
     }
@@ -860,13 +860,13 @@
     /* rfc1035 says DNS names must consist of "[-a-zA-Z0-9]" and '.' */
     for (i = 0; apr_isalnum(addr[i]) || addr[i] == '-' || addr[i] == '.'; ++i)
         continue;
 
 #if 0
     if (addr[i] == ':') {
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "@@@@ handle optional port in proxy_is_domainname()");
 	/* @@@@ handle optional port */
     }
 #endif
 
     if (addr[i] != '\0')
@@ -982,30 +982,30 @@
 {
     int j;
     /* XXX FIXME: conf->noproxies->elts is part of an opaque structure */
     for (j = 0; j < conf->noproxies->nelts; j++) {
         struct noproxy_entry *npent = (struct noproxy_entry *) conf->noproxies->elts;
         struct apr_sockaddr_t *conf_addr = npent[j].addr;
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                      "proxy: checking remote machine [%s] against [%s]", uri_addr->hostname, npent[j].name);
         if ((npent[j].name && ap_strstr_c(uri_addr->hostname, npent[j].name))
             || npent[j].name[0] == '*') {
-            ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, r->server,
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,
                          "proxy: connect to remote machine %s blocked: name %s matched", uri_addr->hostname, npent[j].name);
             return HTTP_FORBIDDEN;
         }
         while (conf_addr) {
             while (uri_addr) {
                 char *conf_ip;
                 char *uri_ip;
                 apr_sockaddr_ip_get(&conf_ip, conf_addr);
                 apr_sockaddr_ip_get(&uri_ip, uri_addr);
-                ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, r->server,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
                              "proxy: ProxyBlock comparing %s and %s", conf_ip, uri_ip);
                 if (!apr_strnatcasecmp(conf_ip, uri_ip)) {
-                    ap_log_error(APLOG_MARK, APLOG_WARNING|APLOG_NOERRNO, 0, r->server,
+                    ap_log_error(APLOG_MARK, APLOG_WARNING, 0, r->server,
                                  "proxy: connect to remote machine %s blocked: IP %s matched", uri_addr->hostname, conf_ip);
                     return HTTP_FORBIDDEN;
                 }
                 uri_addr = uri_addr->next;
             }
             conf_addr = conf_addr->next;
@@ -1155,21 +1155,19 @@
                          "ProxyReceiveBufferSize, using default");
         }
 #endif
 
         /* Set a timeout on the socket */
         if (conf->timeout_set == 1) {
-            apr_setsocketopt(*newsock, APR_SO_TIMEOUT,
-                             (int)(conf->timeout * APR_USEC_PER_SEC));
+            apr_setsocketopt(*newsock, APR_SO_TIMEOUT, (int)conf->timeout);
         }
         else {
-            apr_setsocketopt(*newsock, APR_SO_TIMEOUT,
-                             (int)(s->timeout * APR_USEC_PER_SEC));
+            apr_setsocketopt(*newsock, APR_SO_TIMEOUT, (int)s->timeout);
         }
 
-        ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
                      "proxy: %s: fam %d socket created to connect to %s",
                      proxy_function, backend_addr->family, backend_name);
 
         /* make the connection out of the socket */
         rv = apr_connect(*newsock, backend_addr);
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/mod_ssl.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/mod_ssl.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/mod_ssl.c	2002-05-01 01:10:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/mod_ssl.c	2002-06-04 15:12:26.000000000 +0800
@@ -138,18 +138,12 @@
     SSL_CMD_ALL(VerifyDepth, TAKE1,
                 "SSL Client verify depth "
                 "(`N' - number of intermediate certificates)")
     SSL_CMD_SRV(SessionCacheTimeout, TAKE1,
                 "SSL Session Cache object lifetime "
                 "(`N' - number of seconds)")
-    SSL_CMD_SRV(Log, TAKE1,
-                "SSL logfile for SSL-related messages "
-                "(`/path/to/file', `|/path/to/program')")
-    SSL_CMD_SRV(LogLevel, TAKE1,
-                "SSL logfile verbosity level "
-                "(`none', `error', `warn', `info', `debug')")
     SSL_CMD_SRV(Protocol, RAW_ARGS,
                 "Enable or disable various SSL protocols"
                 "(`[+-][SSLv2|SSLv3|TLSv1] ...' - see manual)")
 
     /* 
      * Proxy configuration for remote SSL connections
@@ -198,12 +192,18 @@
                "Require the SSL protocol for the per-directory context "
                "(no arguments)")
     SSL_CMD_DIR(Require, AUTHCFG, RAW_ARGS,
                "Require a boolean expression to evaluate to true for granting access"
                "(arbitrary complex boolean expression - see manual)")
 
+    /* Deprecated directives. */
+    AP_INIT_RAW_ARGS("SSLLog", ap_set_deprecated, NULL, OR_ALL, 
+      "SSLLog directive is no longer supported - use ErrorLog."),
+    AP_INIT_RAW_ARGS("SSLLogLevel", ap_set_deprecated, NULL, OR_ALL, 
+      "SSLLogLevel directive is no longer supported - use LogLevel."),
+    
     AP_END_CMD
 };
 
 /*
  *  the various processing hooks
  */
@@ -241,15 +241,15 @@
 {
     SSLSrvConfigRec *sc = mySrvConfig(c->base_server);
 
     SSLConnRec *sslconn = ssl_init_connection_ctx(c);
 
     if (!sc->proxy_enabled) {
-        ssl_log(c->base_server, SSL_LOG_ERROR,
-                "SSL Proxy requested for %s but not enabled "
-                "[Hint: SSLProxyEngine]", sc->vhost_id);
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
+                     "SSL Proxy requested for %s but not enabled "
+                     "[Hint: SSLProxyEngine]", sc->vhost_id);
 
         return 0;
     }
 
     sslconn->is_proxy = 1;
     sslconn->disabled = 0;
@@ -299,23 +299,21 @@
     }
 
     if (sslconn->disabled) {
         return DECLINED;
     }
 
-    sslconn->log_level = sc->log_level;
-
     /*
      * Remember the connection information for
      * later access inside callback functions
      */
 
-    ssl_log(c->base_server, SSL_LOG_INFO,
-            "Connection to child %d established "
-            "(server %s, client %s)", c->id, sc->vhost_id, 
-            c->remote_ip ? c->remote_ip : "unknown");
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, c->base_server,
+                 "Connection to child %ld established "
+                 "(server %s, client %s)", c->id, sc->vhost_id, 
+                 c->remote_ip ? c->remote_ip : "unknown");
 
     /*
      * Seed the Pseudo Random Number Generator (PRNG)
      */
     ssl_rand_seed(c->base_server, c->pool, SSL_RSCTX_CONNECT, "");
 
@@ -324,27 +322,30 @@
     /*
      * Create a new SSL connection with the configured server SSL context and
      * attach this to the socket. Additionally we register this attachment
      * so we can detach later.
      */
     if (!(ssl = SSL_new(mctx->ssl_ctx))) {
-        ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                "Unable to create a new SSL connection from the SSL context");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
+                     "Unable to create a new SSL connection from the SSL "
+                     "context");
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
 
         c->aborted = 1;
 
         return DECLINED; /* XXX */
     }
 
     vhost_md5 = ap_md5_binary(c->pool, sc->vhost_id, sc->vhost_id_len);
 
     if (!SSL_set_session_id_context(ssl, (unsigned char *)vhost_md5,
                                     MD5_DIGESTSIZE*2))
     {
-        ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                "Unable to set session id context to `%s'", vhost_md5);
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
+                     "Unable to set session id context to `%s'", vhost_md5);
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
 
         c->aborted = 1;
 
         return DECLINED; /* XXX */
     }
 
@@ -404,15 +405,16 @@
     int n, err;
     long verify_result;
 
     if (!SSL_is_init_finished(filter->pssl)) {
         if (sslconn->is_proxy) {
             if ((n = SSL_connect(filter->pssl)) <= 0) {
-                ssl_log(c->base_server,
-                        SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_ADD_ERRNO,
-                        "SSL Proxy connect failed");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                             c->base_server,
+                             "SSL Proxy connect failed");
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
                 return ssl_abort(filter, c);
             }
 
             return APR_SUCCESS;
         }
 
@@ -422,14 +424,15 @@
             if (err == SSL_ERROR_ZERO_RETURN) {
                 /*
                  * The case where the connection was closed before any data
                  * was transferred. That's not a real error and can occur
                  * sporadically with some clients.
                  */
-                ssl_log(c->base_server, SSL_LOG_INFO,
-                        "SSL handshake stopped: connection was closed");
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0,
+                             c->base_server,
+                             "SSL handshake stopped: connection was closed");
             }
             else if (err == SSL_ERROR_WANT_READ) {
                 /*
                  * This is in addition to what was present earlier. It is 
                  * borrowed from openssl_state_machine.c [mod_tls].
                  * TBD.
@@ -446,33 +449,37 @@
                 return HTTP_BAD_REQUEST;
             }
             else if ((SSL_get_error(filter->pssl, n) == SSL_ERROR_SYSCALL) &&
                      (errno != EINTR))
             {
                 if (errno > 0) {
-                    ssl_log(c->base_server,
-                            SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_ADD_ERRNO,
-                            "SSL handshake interrupted by system "
-                            "[Hint: Stop button pressed in browser?!]");
+                    ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                                 c->base_server,
+                                 "SSL handshake interrupted by system "
+                                 "[Hint: Stop button pressed in browser?!]");
+                    ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
                 }
                 else {
-                    ssl_log(c->base_server,
-                            SSL_LOG_INFO|SSL_ADD_SSLERR|SSL_ADD_ERRNO,
-                            "Spurious SSL handshake interrupt [Hint: "
-                            "Usually just one of those OpenSSL confusions!?]");
+                    ap_log_error(APLOG_MARK, APLOG_ERR, 0, 
+                                 c->base_server,
+                                 "Spurious SSL handshake interrupt [Hint: "
+                                 "Usually just one of those OpenSSL "
+                                 "confusions!?]");
+                    ssl_log_ssl_error(APLOG_MARK, APLOG_INFO, c->base_server);
                 }
             }
             else {
                 /*
                  * Ok, anything else is a fatal error
                  */
-                ssl_log(c->base_server,
-                        SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_ADD_ERRNO,
-                        "SSL handshake failed (server %s, client %s)",
-                        ssl_util_vhostid(c->pool, c->base_server),
-                        c->remote_ip ? c->remote_ip : "unknown");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, 
+                             c->base_server,
+                             "SSL handshake failed (server %s, client %s)",
+                             ssl_util_vhostid(c->pool, c->base_server),
+                             c->remote_ip ? c->remote_ip : "unknown");
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
             }
 
             return ssl_abort(filter, c);
         }
 
         /*
@@ -491,25 +498,30 @@
                  * "level optional_no_ca is actually against the idea
                  *  of authentication (but can be used to establish 
                  * SSL test pages, etc.)"
                  * optional_no_ca doesn't appear to work as advertised
                  * in 1.x
                  */
-                ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                        "SSL client authentication failed, "
-                        "accepting certificate based on "
-                        "\"SSLVerifyClient optional_no_ca\" configuration");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                             c->base_server,
+                             "SSL client authentication failed, "
+                             "accepting certificate based on "
+                             "\"SSLVerifyClient optional_no_ca\" "
+                             "configuration");
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
             }
             else {
                 const char *error = sslconn->verify_error ?
                     sslconn->verify_error :
                     X509_verify_cert_error_string(verify_result);
 
-                ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                        "SSL client authentication failed: %s",
-                        error ? error : "unknown");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                             c->base_server,
+                             "SSL client authentication failed: %s",
+                             error ? error : "unknown");
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
 
                 return ssl_abort(filter, c);
             }
         }
 
         /*
@@ -524,14 +536,14 @@
          * Make really sure that when a peer certificate
          * is required we really got one... (be paranoid)
          */
         if ((sc->server->auth.verify_mode == SSL_CVERIFY_REQUIRE) &&
             !sslconn->client_cert)
         {
-            ssl_log(c->base_server, SSL_LOG_ERROR,
-                    "No acceptable peer certificate available");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
+                         "No acceptable peer certificate available");
 
             return ssl_abort(filter, c);
         }
     }
 
     return APR_SUCCESS;
@@ -568,13 +580,12 @@
     ssl_io_filter_register(p);
 
     ap_hook_pre_connection(ssl_hook_pre_connection,NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_post_config   (ssl_init_Module,        NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_http_method   (ssl_hook_http_method,   NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_default_port  (ssl_hook_default_port,  NULL,NULL, APR_HOOK_MIDDLE);
-    ap_hook_handler       (ssl_hook_Handler,       NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_pre_config    (ssl_hook_pre_config,    NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_child_init    (ssl_init_Child,         NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_translate_name(ssl_hook_Translate,     NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_check_user_id (ssl_hook_UserCheck,     NULL,NULL, APR_HOOK_FIRST);
     ap_hook_fixups        (ssl_hook_Fixup,         NULL,NULL, APR_HOOK_MIDDLE);
     ap_hook_access_checker(ssl_hook_Access,        NULL,NULL, APR_HOOK_MIDDLE);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/mod_ssl.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/mod_ssl.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/mod_ssl.h	2002-04-09 23:53:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/mod_ssl.h	2002-06-04 15:12:26.000000000 +0800
@@ -201,31 +201,12 @@
 #define myModConfig(srv) (mySrvConfig((srv)))->mc
 
 #define myCtxVarSet(mc,num,val)  mc->rCtx.pV##num = val
 #define myCtxVarGet(mc,num,type) (type)(mc->rCtx.pV##num)
 
 /*
- * SSL Logging
- */
-#define SSL_LOG_NONE    (1<<0)
-#define SSL_LOG_ERROR   (1<<1)
-#define SSL_LOG_WARN    (1<<2)
-#define SSL_LOG_INFO    (1<<3)
-#define SSL_LOG_TRACE   (1<<4)
-#define SSL_LOG_DEBUG   (1<<5)
-#define SSL_LOG_MASK    (SSL_LOG_ERROR|SSL_LOG_WARN|SSL_LOG_INFO|SSL_LOG_TRACE|SSL_LOG_DEBUG)
-
-#define SSL_ADD_NONE     (1<<8)
-#define SSL_ADD_ERRNO    (1<<9)
-#define SSL_ADD_SSLERR   (1<<10)
-#define SSL_NO_TIMESTAMP (1<<11)
-#define SSL_NO_LEVELID   (1<<12)
-#define SSL_NO_NEWLINE   (1<<13)
-#define SSL_INIT         (1<<14)
-
-/*
  * Defaults for the configuration
  */
 #ifndef SSL_SESSION_CACHE_TIMEOUT
 #define SSL_SESSION_CACHE_TIMEOUT  300
 #endif
 
@@ -428,19 +409,17 @@
     const char *client_dn;
     X509 *client_cert;
     ssl_shutdown_type_e shutdown_type;
     const char *verify_info;
     const char *verify_error;
     int verify_depth;
-    int log_level; /* for avoiding expensive logging */
     int is_proxy;
     int disabled;
+    int non_ssl_request;
 } SSLConnRec;
 
-#define SSLConnLogApplies(sslconn, level) (sslconn->log_level >= level)
-
 typedef struct {
     pid_t           pid;
     apr_pool_t     *pPool;
     BOOL            bFixed;
     int             nSessionCacheMode;
     char           *szSessionCacheDataFile;
@@ -525,15 +504,12 @@
 struct SSLSrvConfigRec {
     SSLModConfigRec *mc;
     BOOL             enabled;
     BOOL             proxy_enabled;
     const char      *vhost_id;
     int              vhost_id_len;
-    const char      *log_file_name;
-    apr_file_t      *log_file;
-    int              log_level;
     int              session_cache_timeout;
     modssl_ctx_t    *server;
     modssl_ctx_t    *proxy;
 };
 
 /*
@@ -583,14 +559,12 @@
 const char  *ssl_cmd_SSLCARevocationPath(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLCARevocationFile(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLVerifyClient(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLVerifyDepth(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLSessionCache(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLSessionCacheTimeout(cmd_parms *, void *, const char *);
-const char  *ssl_cmd_SSLLog(cmd_parms *, void *, const char *);
-const char  *ssl_cmd_SSLLogLevel(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLProtocol(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLOptions(cmd_parms *, void *, const char *);
 const char  *ssl_cmd_SSLRequireSSL(cmd_parms *, void *);
 const char  *ssl_cmd_SSLRequire(cmd_parms *, void *, const char *);
 
 const char *ssl_cmd_SSLProxyEngine(cmd_parms *cmd, void *dcfg, int flag);
@@ -701,15 +675,14 @@
 int          ssl_mutex_init(server_rec *, apr_pool_t *);
 int          ssl_mutex_reinit(server_rec *, apr_pool_t *);
 int          ssl_mutex_on(server_rec *);
 int          ssl_mutex_off(server_rec *);
 
 /*  Logfile Support  */
-void         ssl_log_open(server_rec *, server_rec *, apr_pool_t *);
-void         ssl_log(server_rec *, int, const char *, ...);
 void         ssl_die(void);
+void         ssl_log_ssl_error(const char *, int, int, server_rec *);
 
 /*  Variables  */
 void         ssl_var_register(void);
 char        *ssl_var_lookup(apr_pool_t *, server_rec *, conn_rec *, request_rec *, char *);
 void         ssl_var_log_config_register(apr_pool_t *p);
 
@@ -745,10 +718,10 @@
 char        *ssl_util_readfilter(server_rec *, apr_pool_t *, const char *,
                                  const char * const *);
 BOOL         ssl_util_path_check(ssl_pathcheck_t, const char *, apr_pool_t *);
 ssl_algo_t   ssl_util_algotypeof(X509 *, EVP_PKEY *); 
 char        *ssl_util_algotypestr(ssl_algo_t);
 char        *ssl_util_ptxtsub(apr_pool_t *, const char *, const char *, char *);
-void         ssl_util_thread_setup(server_rec *, apr_pool_t *);
+void         ssl_util_thread_setup(apr_pool_t *);
 
 #define APR_SHM_MAXSIZE (64 * 1024 * 1024)
 #endif /* __MOD_SSL_H__ */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl: modules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/README	2002-04-30 14:57:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/README	2002-05-31 03:19:20.000000000 +0800
@@ -1,77 +1,31 @@
-                      _             _ 
-  _ __ ___   ___   __| |    ___ ___| |
- | '_ ` _ \ / _ \ / _` |   / __/ __| | 
- | | | | | | (_) | (_| |   \__ \__ \ | ``mod_ssl combines the flexibility of
- |_| |_| |_|\___/ \__,_|___|___/___/_|   Apache with the security of OpenSSL.''
-                      |_____|                                           
- mod_ssl                               ``Ralf Engelschall has released an
- Apache Interface to OpenSSL             excellent module that integrates
- http://www.modssl.org/                  Apache and SSLeay.''                 
- Version 2.8                                               -- Tim J. Hudson
+SYNOPSIS
 
- SYNOPSIS
-
- This Apache module provides strong cryptography for the Apache 1.3 webserver
+ This Apache module provides strong cryptography for the Apache 2.0 webserver
  via the Secure Sockets Layer (SSL v2/v3) and Transport Layer Security (TLS
  v1) protocols by the help of the SSL/TLS implementation library OpenSSL which
- is based on SSLeay from Eric A. Young and Tim J. Hudson. The mod_ssl package
- was created in April 1998 by Ralf S. Engelschall and was originally derived
- from software developed by Ben Laurie for use in the Apache-SSL HTTP server
- project. 
-
- SOURCES
-
- Here is a short overview of the source files:
-
- * README .................. This file ;)
- # Makefile.in ............. Makefile template for Unix platform
- # config.m4 ............... Autoconf stub for the Apache config mechanism
- # mod_ssl.c ............... main source file containing API structures
- # mod_ssl.h ............... common header file of mod_ssl
- # ssl_engine_config.c ..... module configuration handling
- # ssl_engine_dh.c ......... DSA/DH support
- # ssl_engine_init.c ....... module initialization
- # ssl_engine_io.c ......... I/O support
- # ssl_engine_kernel.c ..... SSL engine kernel
- # ssl_engine_log.c ........ logfile support
- # ssl_engine_mutex.c ...... mutual exclusion support
- # ssl_engine_pphrase.c .... pass-phrase handling
- # ssl_engine_rand.c ....... PRNG support
- # ssl_engine_vars.c ....... Variable Expansion support
- # ssl_expr.c .............. expression handling main source
- # ssl_expr.h .............. expression handling common header
- # ssl_expr_scan.c ......... expression scanner automaton (pre-generated)
- # ssl_expr_scan.l ......... expression scanner source
- # ssl_expr_parse.c ........ expression parser automaton  (pre-generated)
- # ssl_expr_parse.h ........ expression parser header     (pre-generated)
- # ssl_expr_parse.y ........ expression parser source
- # ssl_expr_eval.c ......... expression machine evaluation
- # ssl_scache.c ............ session cache abstraction layer
- # ssl_scache_dbm.c ........ session cache via DBM file
- ~ ssl_scache_shmcb.c ...... session cache via shared memory cyclic buffer
- ~ ssl_scache_shmht.c ...... session cache via shared memory hash table
- # ssl_util.c .............. utility functions
- # ssl_util_ssl.c .......... the OpenSSL companion source
- # ssl_util_ssl.h .......... the OpenSSL companion header
- # ssl_util_table.c ........ the hash table library source
- # ssl_util_table.h ........ the hash table library header
-
- Legend: # = already ported to Apache 2.0 and is cleaned up
-         * = ported to Apache 2.0 but still needs cleaning up
-         ~ = ported to Apache 2.0 but still needs work
-         - = port still not finished
+ is based on SSLeay from Eric A. Young and Tim J. Hudson. 
+
+ The mod_ssl package was created in April 1998 by Ralf S. Engelschall 
+ and was originally derived from software developed by Ben Laurie for 
+ use in the Apache-SSL HTTP server project.  The mod_ssl implementation 
+ for Apache 1.3 continues to be supported by the modssl project 
+ <http://www.modssl.org/>.
+
+SOURCES
+
+ See the top-level LAYOUT file in httpd-2.0 for file descriptions.
 
  The source files are written in clean ANSI C and pass the ``gcc -O -g
  -ggdb3 -Wall -Wshadow -Wpointer-arith -Wcast-align -Wmissing-prototypes
  -Wmissing-declarations -Wnested-externs -Winline'' compiler test
  (assuming `gcc' is GCC 2.95.2 or newer) without any complains. When
  you make changes or additions make sure the source still passes this
  compiler test.
 
- FUNCTIONS
+FUNCTIONS
   
  Inside the source code you will be confronted with the following types of
  functions which can be identified by their prefixes:
 
    ap_xxxx() ............... Apache API function
    ssl_xxxx() .............. mod_ssl function
@@ -79,13 +33,13 @@
    OpenSSL_xxxx() .......... OpenSSL function (SSL library)
    X509_xxxx() ............. OpenSSL function (Crypto library)
    PEM_xxxx() .............. OpenSSL function (Crypto library)
    EVP_xxxx() .............. OpenSSL function (Crypto library)
    RSA_xxxx() .............. OpenSSL function (Crypto library)
 
- DATA STRUCTURES
+DATA STRUCTURES
 
  Inside the source code you will be confronted with the following
  data structures:
 
    server_rec .............. Apache (Virtual) Server
    conn_rec ................ Apache Connection
@@ -105,13 +59,13 @@
  For an overview how these are related and chained together have a look at the
  page in README.dsov.{fig,ps}. It contains overview diagrams for those data
  structures. It's designed for DIN A4 paper size, but you can easily generate
  a smaller version inside XFig by specifing a magnification on the Export
  panel.
 
- EXPERIMENTAL CODE
+EXPERIMENTAL CODE
 
  Experimental code is always encapsulated as following:
 
    | #ifdef SSL_EXPERIMENTAL_xxxx
    | ...
    | #endif
@@ -127,25 +81,27 @@
      The ability to support the new forthcoming OpenSSL ENGINE stuff.
      Until this development branch of OpenSSL is merged into the main
      stream, you have to use openssl-engine-0.9.x.tar.gz for this.
      mod_ssl automatically recognizes this OpenSSL variant and then can
      activate external crypto devices through SSLCryptoDevice directive.
 
- INCOMPATIBILITIES
+INCOMPATIBILITIES
 
  The following intentional incompatibilities exist between mod_ssl 2.x
  from Apache 1.3 and this mod_ssl version for Apache 2.0:
 
  o The complete EAPI-based SSL_VENDOR stuff was removed.
  o The complete EAPI-based SSL_COMPAT stuff was removed.
  o The <IfDefine> variable MOD_SSL is no longer provided automatically 
 
- MAJOR CHANGES 
+MAJOR CHANGES 
 
- The following major changes were made between mod_ssl 2.x
- from Apache 1.3 and this mod_ssl version for Apache 2.0:
+ For a complete history of changes for Apache 2.0 mod_ssl, see the 
+ CHANGES file in the top-level httpd-2.0 directory.  The following 
+ is a condensed summary of the major changes were made between 
+ mod_ssl 2.x from Apache 1.3 and this mod_ssl version for Apache 2.0:
 
  o The DBM based session cache is now based on APR's DBM API only.
  o The shared memory based session cache is now based on APR's APIs.
  o SSL I/O is now implemented in terms of filters rather than BUFF
  o Eliminated ap_global_ctx. Storing Persistant information in 
    process_rec->pool->user_data. The ssl_pphrase_Handle_CB() and 
@@ -165,29 +121,9 @@
  o per-directory SSLCACertificate{File,Path} is now thread-safe but
    requires SSL_set_cert_store patch to OpenSSL
  o RSA sslc is supported via ssl_toolkit_compat.h
  o the ssl_engine_{ds,ext}.c source files are obsolete and no longer
    exist
 
- TODO
+TODO
 
- o SSL renegotiations in combination with POST request
- o Port all remaining code (code inside #if 0...#endif blocks)
- o Do we need SSL_set_read_ahead()?
- o the ssl_expr api is NOT THREAD SAFE.  race conditions exist:
-   -in ssl_expr_comp() if SSLRequire is used in .htaccess
-    (ssl_expr_info is global)
-   -is ssl_expr_eval() if there is an error
-    (ssl_expr_error is global)
- o SSLRequire directive (parsing of) leaks memory
- o Diffie-Hellman-Parameters for temporary keys are hardcoded in
-   ssl_engine_dh.c, while the comment in ssl_engine_kernel.c says:
-   "it is suggested that keys be changed daily or every 500
-    transactions, and more often if possible."
- o ssl_var_lookup could be rewritten to be MUCH faster
- o CRL callback should be pluggable
- o session cache store should be pluggable
- o init functions should return status code rather than ssl_die()
- o ssl_engine_pphrase.c needs to be reworked so it is generic enough
-   to also decrypt proxy keys
- o the shmcb code should just align its memory segment rather than
-   jumping through all the "safe" memcpy and memset hoops
+ See the top-level STATUS file in httpd-2.0 for current efforts and goals.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_config.c	2002-04-03 05:56:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_config.c	2002-05-16 14:09:13.000000000 +0800
@@ -206,15 +206,12 @@
 
     sc->mc                     = NULL;
     sc->enabled                = UNSET;
     sc->proxy_enabled          = UNSET;
     sc->vhost_id               = NULL;  /* set during module init */
     sc->vhost_id_len           = 0;     /* set during module init */
-    sc->log_file_name          = NULL;
-    sc->log_file               = NULL;  /* set during module init */
-    sc->log_level              = SSL_LOG_NONE;
     sc->session_cache_timeout  = UNSET;
 
     modssl_ctx_init_proxy(sc, p);
 
     modssl_ctx_init_server(sc, p);
 
@@ -293,14 +290,12 @@
     SSLSrvConfigRec *add  = (SSLSrvConfigRec *)addv;
     SSLSrvConfigRec *mrg  = ssl_config_server_new(p);
 
     cfgMerge(mc, NULL);
     cfgMergeBool(enabled);
     cfgMergeBool(proxy_enabled);
-    cfgMergeString(log_file_name);
-    cfgMerge(log_level, SSL_LOG_NONE);
     cfgMergeInt(session_cache_timeout);
 
     modssl_ctx_cfg_merge_proxy(base->proxy, add->proxy, mrg->proxy);
 
     modssl_ctx_cfg_merge_server(base->server, add->server, mrg->server);
 
@@ -1049,67 +1044,12 @@
         return "SSLSessionCacheTimeout: Invalid argument";
     }
 
     return NULL;
 }
 
-#define SSL_FLAGS_LOG_CONTEXT \
-    (NOT_IN_LIMIT|NOT_IN_DIRECTORY|NOT_IN_LOCATION|NOT_IN_FILES)
-
-const char *ssl_cmd_SSLLog(cmd_parms *cmd,
-                           void *dcfg,
-                           const char *arg)
-{
-    SSLSrvConfigRec *sc = mySrvConfig(cmd->server);
-    const char *err;
-
-    if ((err = ap_check_cmd_context(cmd, SSL_FLAGS_LOG_CONTEXT))) {
-        return err;
-    }
-
-    sc->log_file_name = arg;
-
-    return NULL;
-}
-
-const char *ssl_cmd_SSLLogLevel(cmd_parms *cmd,
-                                void *dcfg,
-                                const char *level)
-{
-    SSLSrvConfigRec *sc = mySrvConfig(cmd->server);
-    const char *err;
-
-    if ((err = ap_check_cmd_context(cmd, SSL_FLAGS_LOG_CONTEXT))) {
-        return err;
-    }
-
-    if (strcEQ(level, "none")) {
-        sc->log_level = SSL_LOG_NONE;
-    }
-    else if (strcEQ(level, "error")) {
-        sc->log_level = SSL_LOG_ERROR;
-    }
-    else if (strcEQ(level, "warn")) {
-        sc->log_level = SSL_LOG_WARN;
-    }
-    else if (strcEQ(level, "info")) {
-        sc->log_level = SSL_LOG_INFO;
-    }
-    else if (strcEQ(level, "trace")) {
-        sc->log_level = SSL_LOG_TRACE;
-    }
-    else if (strcEQ(level, "debug")) {
-        sc->log_level = SSL_LOG_DEBUG;
-    }
-    else {
-        return "SSLLogLevel: Invalid argument";
-    }
-
-    return NULL;
-}
-
 const char *ssl_cmd_SSLOptions(cmd_parms *cmd,
                                void *dcfg,
                                const char *arg)
 {
     SSLDirConfigRec *dc = (SSLDirConfigRec *)dcfg;
     ssl_opt_t opt;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_init.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_init.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_init.c	2002-04-03 05:57:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_init.c	2002-06-07 20:51:49.000000000 +0800
@@ -95,27 +95,27 @@
 
     for (i=0; version_components[i]; i++) {
         vals[i] = ssl_add_version_component(p, s,
                                             version_components[i]);
     }
 
-    ssl_log(s, SSL_LOG_INFO,
-            "Server: %s, Interface: %s, Library: %s",
-            AP_SERVER_BASEVERSION,
-            vals[1],  /* SSL_VERSION_INTERFACE */
-            vals[2]); /* SSL_VERSION_LIBRARY */
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "Server: %s, Interface: %s, Library: %s",
+                 AP_SERVER_BASEVERSION,
+                 vals[1],  /* SSL_VERSION_INTERFACE */
+                 vals[2]); /* SSL_VERSION_LIBRARY */
 }
 
 
 /*
  *  Initialize SSL library
  */
 static void ssl_init_SSLLibrary(server_rec *s)
 {
-    ssl_log(s, SSL_LOG_INFO,
-            "Init: Initializing %s library", SSL_LIBRARY_NAME);
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "Init: Initializing %s library", SSL_LIBRARY_NAME);
 
     CRYPTO_malloc_init();
     SSL_load_error_strings();
     SSL_library_init();
 }
 
@@ -138,62 +138,71 @@
     SSLModConfigRec *mc = myModConfig(s);
 
     MODSSL_TMP_KEYS_FREE(mc, RSA);
     MODSSL_TMP_KEYS_FREE(mc, DH);
 }
 
-static void ssl_tmp_key_init_rsa(server_rec *s,
-                                 int bits, int idx)
+static int ssl_tmp_key_init_rsa(server_rec *s,
+                                int bits, int idx)
 {
     SSLModConfigRec *mc = myModConfig(s);
 
     if (!(mc->pTmpKeys[idx] =
           RSA_generate_key(bits, RSA_F4, NULL, NULL)))
     {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Init: Failed to generate temporary "
-                "%d bit RSA private key", bits);
-        ssl_die();
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Init: Failed to generate temporary "
+                     "%d bit RSA private key", bits);
+        return !OK;
     }
 
+    return OK;
 }
 
-static void ssl_tmp_key_init_dh(server_rec *s,
-                                int bits, int idx)
+static int ssl_tmp_key_init_dh(server_rec *s,
+                               int bits, int idx)
 {
     SSLModConfigRec *mc = myModConfig(s);
 
     if (!(mc->pTmpKeys[idx] =
           ssl_dh_GetTmpParam(bits)))
     {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Init: Failed to generate temporary "
-                "%d bit DH parameters", bits);
-        ssl_die();
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Init: Failed to generate temporary "
+                     "%d bit DH parameters", bits);
+        return !OK;
     }
+
+    return OK;
 }
 
 #define MODSSL_TMP_KEY_INIT_RSA(s, bits) \
     ssl_tmp_key_init_rsa(s, bits, SSL_TMP_KEY_RSA_##bits)
 
 #define MODSSL_TMP_KEY_INIT_DH(s, bits) \
     ssl_tmp_key_init_dh(s, bits, SSL_TMP_KEY_DH_##bits)
 
-static void ssl_tmp_keys_init(server_rec *s)
+static int ssl_tmp_keys_init(server_rec *s)
 {
-    ssl_log(s, SSL_LOG_INFO,
-            "Init: Generating temporary RSA private keys (512/1024 bits)");
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "Init: Generating temporary RSA private keys (512/1024 bits)");
+
+    if (MODSSL_TMP_KEY_INIT_RSA(s, 512) ||
+        MODSSL_TMP_KEY_INIT_RSA(s, 1024)) {
+        return !OK;
+    }
 
-    MODSSL_TMP_KEY_INIT_RSA(s, 512);
-    MODSSL_TMP_KEY_INIT_RSA(s, 1024);
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "Init: Generating temporary DH parameters (512/1024 bits)");
 
-    ssl_log(s, SSL_LOG_INFO,
-            "Init: Generating temporary DH parameters (512/1024 bits)");
+    if (MODSSL_TMP_KEY_INIT_DH(s, 512) ||
+        MODSSL_TMP_KEY_INIT_DH(s, 1024)) {
+        return !OK;
+    }
 
-    MODSSL_TMP_KEY_INIT_DH(s, 512);
-    MODSSL_TMP_KEY_INIT_DH(s, 1024);
+    return OK;
 }
 
 /*
  *  Per-module initialization
  */
 int ssl_init_Module(apr_pool_t *p, apr_pool_t *plog,
@@ -252,20 +261,18 @@
         }
 
         if (sc->server->pphrase_dialog_type == SSL_PPTYPE_UNSET) {
             sc->server->pphrase_dialog_type = SSL_PPTYPE_BUILTIN;
         }
 
-        /* Open the dedicated SSL logfile */
-        ssl_log_open(base_server, s, p);
     }
 
     ssl_init_SSLLibrary(base_server);
 
 #if APR_HAS_THREADS
-    ssl_util_thread_setup(base_server, p);
+    ssl_util_thread_setup(p);
 #endif
 
     /*
      * Seed the Pseudo Random Number Generator (PRNG)
      * only need ptemp here; nothing inside allocated from the pool
      * needs to live once we return from ssl_rand_seed().
@@ -277,13 +284,15 @@
      * decrypting any encrypted keys via configured SSLPassPhraseDialogs
      * anything that needs to live longer than ptemp needs to also survive
      * restarts, in which case they'll live inside s->process->pool.
      */
     ssl_pphrase_Handle(base_server, ptemp);
 
-    ssl_tmp_keys_init(base_server);
+    if (ssl_tmp_keys_init(base_server)) {
+        return !OK;
+    }
 
     /*
      * SSL external crypto device ("engine") support
      */
 #ifdef SSL_EXPERIMENTAL_ENGINE
     ssl_init_Engine(base_server, p);
@@ -301,14 +310,14 @@
      */
     ssl_scache_init(base_server, p);
 
     /*
      *  initialize servers
      */
-    ssl_log(base_server, SSL_LOG_INFO,
-            "Init: Initializing (virtual) servers for SSL");
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, base_server,
+                 "Init: Initializing (virtual) servers for SSL");
 
     for (s = base_server; s; s = s->next) {
         sc = mySrvConfig(s);
         /*
          * Either now skip this server when SSL is disabled for
          * it or give out some information about what we're
@@ -346,26 +355,26 @@
 {
     SSLModConfigRec *mc = myModConfig(s);
     ENGINE *e;
 
     if (mc->szCryptoDevice) {
         if (!(e = ENGINE_by_id(mc->szCryptoDevice))) {
-            ssl_log(s, SSL_LOG_ERROR,
-                    "Init: Failed to load Crypto Device API `%s'",
-                    mc->szCryptoDevice);
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                         "Init: Failed to load Crypto Device API `%s'",
+                         mc->szCryptoDevice);
             ssl_die();
         }
 
         if (strEQ(mc->szCryptoDevice, "chil")) {
             ENGINE_ctrl(e, ENGINE_CTRL_CHIL_SET_FORKCHECK, 1, 0, 0);
         }
 
         if (!ENGINE_set_default(e, ENGINE_METHOD_ALL)) {
-            ssl_log(s, SSL_LOG_ERROR,
-                    "Init: Failed to enable Crypto Device API `%s'",
-                    mc->szCryptoDevice);
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                         "Init: Failed to enable Crypto Device API `%s'",
+                         mc->szCryptoDevice);
             ssl_die();
         }
 
         ENGINE_free(e);
     }
 }
@@ -378,24 +387,24 @@
 {
     /*
      * check for important parameters and the
      * possibility that the user forgot to set them.
      */
     if (!mctx->pks->cert_files[0]) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "No SSL Certificate set [hint: SSLCertificateFile]");
         ssl_die();
     }
 
     /*
      *  Check for problematic re-initializations
      */
     if (mctx->pks->certs[SSL_AIDX_RSA] ||
         mctx->pks->certs[SSL_AIDX_DSA])
     {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Illegal attempt to re-initialise SSL for server "
                 "(theoretically shouldn't happen!)");
         ssl_die();
     }
 }
 
@@ -410,26 +419,26 @@
     int protocol = mctx->protocol;
 
     /*
      *  Create the new per-server SSL context
      */
     if (protocol == SSL_PROTOCOL_NONE) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "No SSL protocols available [hint: SSLProtocol]");
         ssl_die();
     }
 
     cp = apr_pstrcat(p,
                      (protocol & SSL_PROTOCOL_SSLV2 ? "SSLv2, " : ""),
                      (protocol & SSL_PROTOCOL_SSLV3 ? "SSLv3, " : ""),
                      (protocol & SSL_PROTOCOL_TLSV1 ? "TLSv1, " : ""),
                      NULL);
     cp[strlen(cp)-2] = NUL;
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Creating new SSL context (protocols: %s)", cp);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Creating new SSL context (protocols: %s)", cp);
 
     if (protocol == SSL_PROTOCOL_SSLV2) {
         method = mctx->pkp ?
             SSLv2_client_method() : /* proxy */
             SSLv2_server_method();  /* server */
         ctx = SSL_CTX_new(method);  /* only SSLv2 is left */
@@ -496,14 +505,14 @@
 {
     SSL_CTX *ctx = mctx->ssl_ctx;
 
     SSL_CTX_set_tmp_rsa_callback(ctx, ssl_callback_TmpRSA);
     SSL_CTX_set_tmp_dh_callback(ctx,  ssl_callback_TmpDH);
 
-    if (mctx->sc->log_level >= SSL_LOG_INFO) {
-        /* this callback only logs if SSLLogLevel >= info */
+    if (s->loglevel >= APLOG_DEBUG) {
+        /* this callback only logs if LogLevel >= info */
         SSL_CTX_set_info_callback(ctx, ssl_callback_LogTracingState);
     }
 }
 
 static void ssl_init_ctx_verify(server_rec *s,
                                 apr_pool_t *p,
@@ -539,30 +548,31 @@
     SSL_CTX_set_verify(ctx, verify, ssl_callback_SSLVerify);
 
     /*
      * Configure Client Authentication details
      */
     if (mctx->auth.ca_cert_file || mctx->auth.ca_cert_path) {
-        ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-                "Configuring client authentication");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "Configuring client authentication");
 
         if (!SSL_CTX_load_verify_locations(ctx,
                                            mctx->auth.ca_cert_file,
                                            mctx->auth.ca_cert_path))
         {
-            ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                     "Unable to configure verify locations "
                     "for client authentication");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
             ssl_die();
         }
 
         ca_list = ssl_init_FindCAList(s, ptemp,
                                       mctx->auth.ca_cert_file,
                                       mctx->auth.ca_cert_path);
         if (!ca_list) {
-            ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                     "Unable to determine list of available "
                     "CA certificates for client authentication");
             ssl_die();
         }
 
         SSL_CTX_set_client_CA_list(ctx, (STACK *)ca_list);
@@ -573,16 +583,16 @@
      * should take place. This cannot work.
      */
     if (mctx->auth.verify_mode == SSL_CVERIFY_REQUIRE) {
         ca_list = (STACK_OF(X509_NAME) *)SSL_CTX_get_client_CA_list(ctx);
 
         if (sk_X509_NAME_num(ca_list) == 0) {
-            ssl_log(s, SSL_LOG_WARN,
-                    "Init: Oops, you want to request client authentication, "
-                    "but no CAs are known for verification!? "
-                    "[Hint: SSLCACertificate*]");
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "Init: Oops, you want to request client "
+                         "authentication, but no CAs are known for "
+                         "verification!?  [Hint: SSLCACertificate*]");
         }
     }
 }
 
 static void ssl_init_ctx_cipher_suite(server_rec *s,
                                       apr_pool_t *p,
@@ -596,19 +606,20 @@
      *  Configure SSL Cipher Suite
      */
     if (!suite) {
         return;
     }
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Configuring permitted SSL ciphers [%s]", 
-            suite);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Configuring permitted SSL ciphers [%s]", 
+                 suite);
 
     if (!SSL_CTX_set_cipher_list(ctx, suite)) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to configure permitted SSL ciphers");
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 }
 
 static void ssl_init_ctx_crl(server_rec *s,
                              apr_pool_t *p,
@@ -620,23 +631,24 @@
      */
 
     if (!(mctx->crl_file || mctx->crl_path)) {
         return;
     }
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Configuring certificate revocation facility");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Configuring certificate revocation facility");
 
     mctx->crl =
         SSL_X509_STORE_create((char *)mctx->crl_file,
                               (char *)mctx->crl_path);
 
     if (!mctx->crl) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to configure X.509 CRL storage "
                 "for certificate revocation");
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 }
 
 static void ssl_init_ctx_cert_chain(server_rec *s,
                                     apr_pool_t *p,
@@ -673,21 +685,21 @@
     }
 
     n = SSL_CTX_use_certificate_chain(mctx->ssl_ctx,
                                       (char *)chain, 
                                       skip_first, NULL);
     if (n < 0) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Failed to configure CA certificate chain!");
         ssl_die();
     }
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Configuring server certificate chain "
-            "(%d CA certificate%s)",
-            n, n == 1 ? "" : "s");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Configuring server certificate chain "
+                 "(%d CA certificate%s)",
+                 n, n == 1 ? "" : "s");
 }
 
 static void ssl_init_ctx(server_rec *s,
                          apr_pool_t *p,
                          apr_pool_t *ptemp,
                          modssl_ctx_t *mctx)
@@ -722,25 +734,27 @@
     X509 *cert;
 
     if (!(asn1 = ssl_asn1_table_get(mc->tPublicCert, id))) {
         return FALSE;
     }
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Configuring %s server certificate", type);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Configuring %s server certificate", type);
 
     ptr = asn1->cpData;
     if (!(cert = d2i_X509(NULL, &ptr, asn1->nData))) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to import %s server certificate", type);
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 
     if (SSL_CTX_use_certificate(mctx->ssl_ctx, cert) <= 0) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to configure %s server certificate", type);
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 
     mctx->pks->certs[idx] = cert;
 
     return TRUE;
@@ -759,40 +773,43 @@
     EVP_PKEY *pkey;
 
     if (!(asn1 = ssl_asn1_table_get(mc->tPrivateKey, id))) {
         return FALSE;
     }
 
-    ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-            "Configuring %s server private key", type);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Configuring %s server private key", type);
 
     ptr = asn1->cpData;
     if (!(pkey = d2i_PrivateKey(pkey_type, NULL, &ptr, asn1->nData)))
     {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to import %s server private key", type);
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 
     if (SSL_CTX_use_PrivateKey(mctx->ssl_ctx, pkey) <= 0) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Unable to configure %s server private key", type);
+        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         ssl_die();
     }
 
     /*
      * XXX: wonder if this is still needed, this is old todo doc.
      * (see http://www.psy.uq.edu.au/~ftp/Crypto/ssleay/TODO.html)
      */
     if ((pkey_type == EVP_PKEY_DSA) && mctx->pks->certs[idx]) {
         EVP_PKEY *pubkey = X509_get_pubkey(mctx->pks->certs[idx]);
 
         if (pubkey && EVP_PKEY_missing_parameters(pubkey)) {
             EVP_PKEY_copy_parameters(pubkey, pkey);
-            ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR|SSL_INIT,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                     "Copying DSA parameters from private key to certificate");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
         }
     }
 
     mctx->pks->keys[idx] = pkey;
 
     return TRUE;
@@ -812,51 +829,51 @@
 
     /*
      * Some information about the certificate(s)
      */
 
     if (SSL_X509_isSGC(cert)) {
-        ssl_log(s, SSL_LOG_INFO|SSL_INIT,
-                "%s server certificate enables "
-                "Server Gated Cryptography (SGC)", 
-                ssl_asn1_keystr(type));
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "%s server certificate enables "
+                     "Server Gated Cryptography (SGC)", 
+                     ssl_asn1_keystr(type));
     }
 
     if (SSL_X509_getBC(cert, &is_ca, &pathlen)) {
         if (is_ca) {
-            ssl_log(s, SSL_LOG_WARN|SSL_INIT,
-                    "%s server certificate is a CA certificate "
-                    "(BasicConstraints: CA == TRUE !?)",
-                    ssl_asn1_keystr(type));
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "%s server certificate is a CA certificate "
+                         "(BasicConstraints: CA == TRUE !?)",
+                         ssl_asn1_keystr(type));
         }
 
         if (pathlen > 0) {
-            ssl_log(s, SSL_LOG_WARN|SSL_INIT,
-                    "%s server certificate is not a leaf certificate "
-                    "(BasicConstraints: pathlen == %d > 0 !?)",
-                    ssl_asn1_keystr(type), pathlen);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "%s server certificate is not a leaf certificate "
+                         "(BasicConstraints: pathlen == %d > 0 !?)",
+                         ssl_asn1_keystr(type), pathlen);
         }
     }
 
     if (SSL_X509_getCN(ptemp, cert, &cn)) {
         int fnm_flags = FNM_PERIOD|FNM_CASE_BLIND;
 
         if (apr_is_fnmatch(cn) &&
             (apr_fnmatch(cn, s->server_hostname,
                          fnm_flags) == FNM_NOMATCH))
         {
-            ssl_log(s, SSL_LOG_WARN|SSL_INIT,
-                    "%s server certificate wildcard CommonName (CN) `%s' "
-                    "does NOT match server name!?",
-                    ssl_asn1_keystr(type), cn);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "%s server certificate wildcard CommonName (CN) `%s' "
+                         "does NOT match server name!?",
+                         ssl_asn1_keystr(type), cn);
         }
         else if (strNE(s->server_hostname, cn)) {
-            ssl_log(s, SSL_LOG_WARN|SSL_INIT,
-                    "%s server certificate CommonName (CN) `%s' "
-                    "does NOT match server name!?",
-                    ssl_asn1_keystr(type), cn);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "%s server certificate CommonName (CN) `%s' "
+                         "does NOT match server name!?",
+                         ssl_asn1_keystr(type), cn);
         }
     }
 }
 
 static void ssl_init_server_certs(server_rec *s,
                                   apr_pool_t *p,
@@ -872,26 +889,26 @@
     dsa_id = ssl_asn1_table_keyfmt(ptemp, vhost_id, SSL_AIDX_DSA);
 
     have_rsa = ssl_server_import_cert(s, mctx, rsa_id, SSL_AIDX_RSA);
     have_dsa = ssl_server_import_cert(s, mctx, dsa_id, SSL_AIDX_DSA);
 
     if (!(have_rsa || have_dsa)) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Oops, no RSA or DSA server certificate found?!");
         ssl_die();
     }
 
     for (i = 0; i < SSL_AIDX_MAX; i++) {
         ssl_check_public_cert(s, ptemp, mctx->pks->certs[i], i);
     }
 
     have_rsa = ssl_server_import_key(s, mctx, rsa_id, SSL_AIDX_RSA);
     have_dsa = ssl_server_import_key(s, mctx, dsa_id, SSL_AIDX_DSA);
 
     if (!(have_rsa || have_dsa)) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_INIT,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                 "Oops, no RSA or DSA server private key found?!");
         ssl_die();
     }
 }
 
 static void ssl_init_proxy_certs(server_rec *s,
@@ -918,21 +935,21 @@
 
     if (pkp->cert_path) {
         SSL_X509_INFO_load_path(ptemp, sk, pkp->cert_path);
     }
 
     if ((ncerts = sk_X509_INFO_num(sk)) > 0) {
-        ssl_log(s, SSL_LOG_TRACE|SSL_INIT,
-                "loaded %d client certs for SSL proxy",
-                ncerts);
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "loaded %d client certs for SSL proxy",
+                     ncerts);
 
         pkp->certs = sk;
     }
     else {
-        ssl_log(s, SSL_LOG_WARN|SSL_INIT,
-                "no client certs found for SSL proxy");
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                     "no client certs found for SSL proxy");
         sk_X509_INFO_free(sk);
     }
 }
 
 static void ssl_init_proxy_ctx(server_rec *s,
                                apr_pool_t *p,
@@ -962,14 +979,14 @@
 void ssl_init_ConfigureServer(server_rec *s,
                               apr_pool_t *p,
                               apr_pool_t *ptemp,
                               SSLSrvConfigRec *sc)
 {
     if (sc->enabled) {
-        ssl_log(s, SSL_LOG_INFO|SSL_INIT,
-                "Configuring server for SSL protocol");
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "Configuring server for SSL protocol");
         ssl_init_server_ctx(s, p, ptemp, sc);
     }
 
     if (sc->proxy_enabled) {
         ssl_init_proxy_ctx(s, p, ptemp, sc);
     }
@@ -990,25 +1007,27 @@
      * for the HTTP port or vice versa
      */
     for (s = base_server; s; s = s->next) {
         sc = mySrvConfig(s);
 
         if (sc->enabled && (s->port == DEFAULT_HTTP_PORT)) {
-            ssl_log(base_server, SSL_LOG_WARN,
-                    "Init: (%s) You configured HTTPS(%d) "
-                    "on the standard HTTP(%d) port!",
-                    ssl_util_vhostid(p, s),
-                    DEFAULT_HTTPS_PORT, DEFAULT_HTTP_PORT);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
+                         base_server,
+                         "Init: (%s) You configured HTTPS(%d) "
+                         "on the standard HTTP(%d) port!",
+                         ssl_util_vhostid(p, s),
+                         DEFAULT_HTTPS_PORT, DEFAULT_HTTP_PORT);
         }
 
         if (!sc->enabled && (s->port == DEFAULT_HTTPS_PORT)) {
-            ssl_log(base_server, SSL_LOG_WARN,
-                    "Init: (%s) You configured HTTP(%d) "
-                    "on the standard HTTPS(%d) port!",
-                    ssl_util_vhostid(p, s),
-                    DEFAULT_HTTP_PORT, DEFAULT_HTTPS_PORT);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
+                         base_server,
+                         "Init: (%s) You configured HTTP(%d) "
+                         "on the standard HTTPS(%d) port!",
+                         ssl_util_vhostid(p, s),
+                         DEFAULT_HTTP_PORT, DEFAULT_HTTPS_PORT);
         }
     }
 
     /*
      * Give out warnings when more than one SSL-aware virtual server uses the
      * same IP:port. This doesn't work because mod_ssl then will always use
@@ -1017,41 +1036,42 @@
      */
     table = apr_hash_make(p);
 
     for (s = base_server; s; s = s->next) {
         sc = mySrvConfig(s);
 
-        if (!sc->enabled) {
+        if (!(sc->enabled && s->addrs)) {
             continue;
         }
 
         key = apr_psprintf(p, "%pA:%u",
                            &s->addrs->host_addr, s->addrs->host_port);
         klen = strlen(key);
 
         if ((ps = (server_rec *)apr_hash_get(table, key, klen))) {
-            ssl_log(base_server, SSL_LOG_WARN,
-                    "Init: SSL server IP/port conflict: "
-                    "%s (%s:%d) vs. %s (%s:%d)",
-                    ssl_util_vhostid(p, s), 
-                    (s->defn_name ? s->defn_name : "unknown"),
-                    s->defn_line_number,
-                    ssl_util_vhostid(p, ps),
-                    (ps->defn_name ? ps->defn_name : "unknown"), 
-                    ps->defn_line_number);
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
+                         base_server,
+                         "Init: SSL server IP/port conflict: "
+                         "%s (%s:%d) vs. %s (%s:%d)",
+                         ssl_util_vhostid(p, s), 
+                         (s->defn_name ? s->defn_name : "unknown"),
+                         s->defn_line_number,
+                         ssl_util_vhostid(p, ps),
+                         (ps->defn_name ? ps->defn_name : "unknown"), 
+                         ps->defn_line_number);
             conflict = TRUE;
             continue;
         }
 
         apr_hash_set(table, key, klen, s);
     }
 
     if (conflict) {
-        ssl_log(base_server, SSL_LOG_WARN,
-                "Init: You should not use name-based "
-                "virtual hosts in conjunction with SSL!!");
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, base_server,
+                     "Init: You should not use name-based "
+                     "virtual hosts in conjunction with SSL!!");
     }
 }
 
 static int ssl_init_FindCAList_X509NameCmp(X509_NAME **a, X509_NAME **b)
 {
     return(X509_NAME_cmp(*a, *b));
@@ -1070,15 +1090,15 @@
     }
 
     for (n = 0; n < sk_X509_NAME_num(sk); n++) {
         char name_buf[256];
         X509_NAME *name = sk_X509_NAME_value(sk, n);
 
-        ssl_log(s, SSL_LOG_TRACE,
-                "CA certificate: %s",
-                X509_NAME_oneline(name, name_buf, sizeof(name_buf)));
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "CA certificate: %s",
+                     X509_NAME_oneline(name, name_buf, sizeof(name_buf)));
 
         /*
          * note that SSL_load_client_CA_file() checks for duplicates,
          * but since we call it multiple times when reading a directory
          * we must also check for duplicates ourselves.
          */
@@ -1120,15 +1140,16 @@
      * Process CA certificate path files
      */
     if (ca_path) {
         apr_dir_t *dir;
         apr_finfo_t direntry;
         apr_int32_t finfo_flags = APR_FINFO_MIN|APR_FINFO_NAME;
+        apr_status_t rv;
 
-        if (apr_dir_open(&dir, ca_path, ptemp) != APR_SUCCESS) {
-            ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO|SSL_INIT,
+        if ((rv = apr_dir_open(&dir, ca_path, ptemp)) != APR_SUCCESS) {
+            ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
                     "Failed to open SSLCACertificatePath `%s'",
                     ca_path);
             ssl_die();
         }
 
         while ((apr_dir_read(&direntry, finfo_flags, dir)) == APR_SUCCESS) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_io.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_io.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_io.c	2002-04-07 14:32:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_io.c	2002-06-04 15:12:26.000000000 +0800
@@ -499,14 +499,15 @@
         }
         else if (ssl_err == SSL_ERROR_SSL) {
             /*
              * Log SSL errors
              */
             conn_rec *c = (conn_rec *)SSL_get_app_data(ssl);
-            ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
                     "SSL error on reading data");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
         }
     }
 
     return rc;
 }
 
@@ -531,14 +532,15 @@
         }
         else if (ssl_err == SSL_ERROR_SSL) {
             /*
              * Log SSL errors
              */
             conn_rec *c = (conn_rec *)SSL_get_app_data(ssl);
-            ssl_log(c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
                     "SSL error on writing data");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, c->base_server);
         }
         /*
          * XXX - Just trying to reflect the behaviour in 
          * openssl_state_machine.c [mod_tls]. TBD
          */
         rc = 0;
@@ -562,13 +564,13 @@
 
         /* XXX: probably a better way to determine this */
         if (SSL_total_renegotiations(ctx->pssl)) {
             reason = "likely due to failed renegotiation";
         }
 
-        ssl_log(c->base_server, SSL_LOG_ERROR,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, c->base_server,
                 "failed to write %d of %d bytes (%s)",
                 n > 0 ? len - n : len, len, reason);
 
         return APR_EINVAL;
     }
 
@@ -736,14 +738,23 @@
         *len = bytes;
     }
 
     return APR_SUCCESS;
 }
 
+/* Just use a simple request.  Any request will work for this, because
+ * we use a flag in the conn_rec->conn_vector now.  The fake request just
+ * gets the request back to the Apache core so that a response can be sent.
+ *
+ * We should probably use a 0.9 request, but the BIO bucket code is calling
+ * socket_bucket_read one extra time with all 0.9 requests from the client.
+ * Until that is resolved, continue to use a 1.0 request, just like we
+ * always have.
+ */
 #define HTTP_ON_HTTPS_PORT \
-    "GET /mod_ssl:error:HTTP-request HTTP/1.0"
+    "GET / HTTP/1.0"
 
 #define HTTP_ON_HTTPS_PORT_BUCKET(alloc) \
     apr_bucket_immortal_create(HTTP_ON_HTTPS_PORT, \
                                sizeof(HTTP_ON_HTTPS_PORT) - 1, \
                                alloc)
 
@@ -755,24 +766,29 @@
 }
 
 static apr_status_t ssl_io_filter_error(ap_filter_t *f,
                                         apr_bucket_brigade *bb,
                                         apr_status_t status)
 {
+    SSLConnRec *sslconn = myConnConfig(f->c);
     apr_bucket *bucket;
 
     switch (status) {
       case HTTP_BAD_REQUEST:
             /* log the situation */
-            ssl_log(f->c->base_server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                    "SSL handshake failed: HTTP spoken on HTTPS port; "
-                    "trying to send HTML error page");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                         f->c->base_server,
+                         "SSL handshake failed: HTTP spoken on HTTPS port; "
+                         "trying to send HTML error page");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, f->c->base_server);
+
+            sslconn->non_ssl_request = 1;
+            ssl_io_filter_disable(f);
 
             /* fake the request line */
             bucket = HTTP_ON_HTTPS_PORT_BUCKET(f->c->bucket_alloc);
-            ssl_io_filter_disable(f);
             break;
 
       default:
         return status;
     }
 
@@ -896,13 +912,12 @@
 
     return ret;
 }
 
 void ssl_io_filter_init(conn_rec *c, SSL *ssl)
 {
-    SSLSrvConfigRec *sc = mySrvConfig(c->base_server);
     SSLFilterRec *filter;
 
     filter = apr_palloc(c->pool, sizeof(SSLFilterRec));
 
     filter->pOutputFilter   = ap_add_output_filter(ssl_io_filter,
                                                    filter, NULL, c);
@@ -915,13 +930,13 @@
     SSL_set_bio(ssl, filter->pbioRead, filter->pbioWrite);
     filter->pssl            = ssl;
 
     apr_pool_cleanup_register(c->pool, (void*)filter,
                               ssl_io_filter_cleanup, apr_pool_cleanup_null);
 
-    if (sc->log_level >= SSL_LOG_DEBUG) {
+    if (c->base_server->loglevel >= APLOG_DEBUG) {
         BIO_set_callback(SSL_get_rbio(ssl), ssl_io_data_cb);
         BIO_set_callback_arg(SSL_get_rbio(ssl), (void *)ssl);
     }
 
     return;
 }
@@ -953,13 +968,13 @@
     trunc = 0;
     for(; (len > 0) && ((s[len-1] == ' ') || (s[len-1] == '\0')); len--)
         trunc++;
     rows = (len / DUMP_WIDTH);
     if ((rows * DUMP_WIDTH) < len)
         rows++;
-    ssl_log(srvr, SSL_LOG_DEBUG|SSL_NO_TIMESTAMP|SSL_NO_LEVELID,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, srvr,
             "+-------------------------------------------------------------------------+");
     for(i = 0 ; i< rows; i++) {
         apr_snprintf(tmp, sizeof(tmp), "| %04x: ", i * DUMP_WIDTH);
         apr_cpystrn(buf, tmp, sizeof(buf));
         for (j = 0; j < DUMP_WIDTH; j++) {
             if (((i * DUMP_WIDTH) + j) >= len)
@@ -978,18 +993,19 @@
                 ch = ((unsigned char)*((char *)(s) + i * DUMP_WIDTH + j)) & 0xff;
                 apr_snprintf(tmp, sizeof(tmp), "%c", ((ch >= ' ') && (ch <= '~')) ? ch : '.');
                 apr_cpystrn(buf+strlen(buf), tmp, sizeof(buf)-strlen(buf));
             }
         }
         apr_cpystrn(buf+strlen(buf), " |", sizeof(buf)-strlen(buf));
-        ssl_log(srvr, SSL_LOG_DEBUG|SSL_NO_TIMESTAMP|SSL_NO_LEVELID, "%s", buf);
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, srvr,
+                     "%s", buf);
     }
     if (trunc > 0)
-        ssl_log(srvr, SSL_LOG_DEBUG|SSL_NO_TIMESTAMP|SSL_NO_LEVELID,
-                "| %04x - <SPACES/NULS>", len + trunc);
-    ssl_log(srvr, SSL_LOG_DEBUG|SSL_NO_TIMESTAMP|SSL_NO_LEVELID,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, srvr,
+                "| %04ld - <SPACES/NULS>", len + trunc);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, srvr,
             "+-------------------------------------------------------------------------+");
     return;
 }
 
 long ssl_io_data_cb(BIO *bio, int cmd,
                     MODSSL_BIO_CB_ARG_TYPE *argp,
@@ -1005,25 +1021,25 @@
         return rc;
     s = c->base_server;
 
     if (   cmd == (BIO_CB_WRITE|BIO_CB_RETURN)
         || cmd == (BIO_CB_READ |BIO_CB_RETURN) ) {
         if (rc >= 0) {
-            ssl_log(s, SSL_LOG_DEBUG,
-                    "%s: %s %ld/%d bytes %s BIO#%08X [mem: %08lX] %s",
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                    "%s: %s %ld/%d bytes %s BIO#%p [mem: %p] %s",
                     SSL_LIBRARY_NAME,
                     (cmd == (BIO_CB_WRITE|BIO_CB_RETURN) ? "write" : "read"),
                     rc, argi, (cmd == (BIO_CB_WRITE|BIO_CB_RETURN) ? "to" : "from"),
                     bio, argp,
                     (argp != NULL ? "(BIO dump follows)" : "(Oops, no memory buffer?)"));
             if (argp != NULL)
                 ssl_io_data_dump(s, argp, rc);
         }
         else {
-            ssl_log(s, SSL_LOG_DEBUG,
-                    "%s: I/O error, %d bytes expected to %s on BIO#%08X [mem: %08lX]",
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                    "%s: I/O error, %d bytes expected to %s on BIO#%p [mem: %p]",
                     SSL_LIBRARY_NAME, argi,
                     (cmd == (BIO_CB_WRITE|BIO_CB_RETURN) ? "write" : "read"),
                     bio, argp);
         }
     }
     return rc;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_kernel.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_kernel.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_kernel.c	2002-04-05 10:31:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_kernel.c	2002-06-11 12:54:01.000000000 +0800
@@ -142,19 +142,19 @@
         break;
     }
 
     SSL_smart_shutdown(ssl);
 
     /* and finally log the fact that we've closed the connection */
-    if (SSLConnLogApplies(sslconn, SSL_LOG_INFO)) {
-        ssl_log(conn->base_server, SSL_LOG_INFO,
-                "Connection to child %d closed with %s shutdown"
-                "(server %s, client %s)",
-                conn->id, type,
-                ssl_util_vhostid(conn->pool, conn->base_server),
-                conn->remote_ip ? conn->remote_ip : "unknown");
+    if (conn->base_server->loglevel >= APLOG_INFO) {
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, conn->base_server,
+                     "Connection to child %ld closed with %s shutdown"
+                     "(server %s, client %s)",
+                     conn->id, type,
+                     ssl_util_vhostid(conn->pool, conn->base_server),
+                     conn->remote_ip ? conn->remote_ip : "unknown");
     }
 
     /* deallocate the SSL connection */
     SSL_free(ssl);
     sslconn->ssl = NULL;
     filter->pssl = NULL; /* so filters know we've been shutdown */
@@ -171,27 +171,55 @@
     SSL *ssl;
 
     if (!sslconn) {
         return DECLINED;
     }
 
+    if (sslconn->non_ssl_request) {
+        const char *errmsg;
+        char *thisurl;
+        char *thisport = "";
+        int port = ap_get_server_port(r);
+
+        if (!ap_is_default_port(port, r)) {
+            thisport = apr_psprintf(r->pool, ":%u", port);
+        }
+
+        thisurl = ap_escape_html(r->pool,
+                                 apr_psprintf(r->pool, "https://%s%s/",
+                                              ap_get_server_name(r),
+                                              thisport));
+
+        errmsg = apr_psprintf(r->pool,
+                              "Reason: You're speaking plain HTTP "
+                              "to an SSL-enabled server port.<br />\n"
+                              "Instead use the HTTPS scheme to access "
+                              "this URL, please.<br />\n"
+                              "<blockquote>Hint: "
+                              "<a href=\"%s\"><b>%s</b></a></blockquote>",
+                              thisurl, thisurl);
+
+        apr_table_setn(r->notes, "error-notes", errmsg);
+
+        /* Now that we have caught this error, forget it. we are done
+         * with using SSL on this request.
+         */
+        sslconn->non_ssl_request = 0;
+        
+
+        return HTTP_BAD_REQUEST;
+    }
+
     /*
      * Get the SSL connection structure and perform the
      * delayed interlinking from SSL back to request_rec
      */
     if ((ssl = sslconn->ssl)) {
         SSL_set_app_data2(ssl, r);
     }
 
-    /*
-     * Force the mod_ssl content handler when URL indicates this
-     */
-    if (strEQn(r->uri, "/mod_ssl:", 9)) {
-        r->handler = "mod_ssl:content-handler";
-    }
-
     return DECLINED;
 }
 
 /*
  * Move SetEnvIf information from request_rec to conn_rec/BUFF
  * to allow the close connection handler to use them.
@@ -240,21 +268,21 @@
         return DECLINED;
     }
 
     /*
      * Log information about incoming HTTPS requests
      */
-    if (SSLConnLogApplies(sslconn, SSL_LOG_INFO) && ap_is_initial_req(r)) {
-        ssl_log(r->server, SSL_LOG_INFO,
-                "%s HTTPS request received for child %d (server %s)",
-                (r->connection->keepalives <= 0 ?
-                 "Initial (No.1)" :
-                 apr_psprintf(r->pool, "Subsequent (No.%d)",
-                              r->connection->keepalives+1)),
-                r->connection->id,
-                ssl_util_vhostid(r->pool, r->server));
+    if (r->server->loglevel >= APLOG_INFO && ap_is_initial_req(r)) {
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                     "%s HTTPS request received for child %ld (server %s)",
+                     (r->connection->keepalives <= 0 ?
+                     "Initial (No.1)" :
+                     apr_psprintf(r->pool, "Subsequent (No.%d)",
+                                  r->connection->keepalives+1)),
+                     r->connection->id,
+                     ssl_util_vhostid(r->pool, r->server));
     }
 
     /* SetEnvIf ssl-*-shutdown flags can only be per-server,
      * so they won't change across keepalive requests
      */
     if (sslconn->shutdown_type == SSL_SHUTDOWN_TYPE_UNSET) {
@@ -262,55 +290,12 @@
     }
 
     return DECLINED;
 }
 
 /*
- *  Content Handler
- */
-int ssl_hook_Handler(request_rec *r)
-{
-    if (strNE(r->handler, "mod_ssl:content-handler")) {
-        return DECLINED;
-    }
-
-    if (strNEn(r->uri, "/mod_ssl:", 9)) {
-        return DECLINED;
-    }
-
-    if (strEQ(r->uri, "/mod_ssl:error:HTTP-request")) {
-        const char *errmsg;
-        char *thisurl;
-        char *thisport = "";
-        int port = ap_get_server_port(r);
-
-        if (!ap_is_default_port(port, r)) {
-            thisport = apr_psprintf(r->pool, ":%u", port);
-        }
-
-        thisurl = ap_escape_html(r->pool,
-                                 apr_psprintf(r->pool, "https://%s%s/",
-                                              ap_get_server_name(r),
-                                              thisport));
-
-        errmsg = apr_psprintf(r->pool,
-                              "Reason: You're speaking plain HTTP "
-                              "to an SSL-enabled server port.<br />\n"
-                              "Instead use the HTTPS scheme to access "
-                              "this URL, please.<br />\n"
-                              "<blockquote>Hint: "
-                              "<a href=\"%s\"><b>%s</b></a></blockquote>",
-                              thisurl, thisurl);
-
-        apr_table_setn(r->notes, "error-notes", errmsg);
-    }
-
-    return HTTP_BAD_REQUEST;
-}
-
-/*
  *  Access Handler
  */
 int ssl_hook_Access(request_rec *r)
 {
     SSLDirConfigRec *dc = myDirConfig(r);
     SSLSrvConfigRec *sc = mySrvConfig(r->server);
@@ -334,13 +319,13 @@
     }
 
     /*
      * Support for SSLRequireSSL directive
      */
     if (dc->bSSLRequired && !ssl) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r, 
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, 
                       "access to %s failed, reason: %s",
                       r->filename, "SSL connection required");
 
         /* remember forbidden access for strict require option */
         apr_table_setn(r->notes, "ssl-access-forbidden", "1");
 
@@ -408,15 +393,17 @@
                 cipher_list_old = sk_SSL_CIPHER_dup(cipher_list_old);
             }
         }
 
         /* configure new state */
         if (!modssl_set_cipher_list(ssl, dc->szCipherSuite)) {
-            ssl_log(r->server, SSL_LOG_WARN|SSL_ADD_SSLERR,
-                    "Unable to reconfigure (per-directory) "
-                    "permitted SSL ciphers");
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
+                         r->server,
+                         "Unable to reconfigure (per-directory) "
+                         "permitted SSL ciphers");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, r->server);
 
             if (cipher_list_old) {
                 sk_SSL_CIPHER_free(cipher_list_old);
             }
 
             return HTTP_FORBIDDEN;
@@ -474,14 +461,14 @@
         if (cipher_list_old) {
             sk_SSL_CIPHER_free(cipher_list_old);
         }
 
         /* tracing */
         if (renegotiate) {
-            ssl_log(r->server, SSL_LOG_TRACE,
-                    "Reconfigured cipher suite will force renegotiation");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                         "Reconfigured cipher suite will force renegotiation");
         }
     }
 
     /*
      * override of SSLVerifyDepth
      *
@@ -500,15 +487,15 @@
             sslconn->verify_depth = n = sc->server->auth.verify_depth;
         }
 
         /* determine whether a renegotiation has to be forced */
         if (dc->nVerifyDepth < n) {
             renegotiate = TRUE;
-            ssl_log(r->server, SSL_LOG_TRACE,
-                    "Reduced client verification depth "
-                    "will force renegotiation");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                         "Reduced client verification depth will force "
+                         "renegotiation");
         }
     }
 
     /*
      * override of SSLVerifyClient
      *
@@ -560,16 +547,17 @@
                     (verify_old == SSL_VERIFY_NONE) &&
                     SSL_get_peer_certificate(ssl))
                 {
                     renegotiate_quick = TRUE;
                 }
 
-                ssl_log(r->server, SSL_LOG_TRACE,
-                        "Changed client verification type "
-                        "will force %srenegotiation",
-                        renegotiate_quick ? "quick " : "");
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
+                             r->server,
+                             "Changed client verification type will force "
+                             "%srenegotiation",
+                             renegotiate_quick ? "quick " : "");
              }
         }
     }
 
     /*
      * override SSLCACertificateFile & SSLCACertificatePath
@@ -597,40 +585,41 @@
         const char *ca_file = MODSSL_CFG_CA(szCACertificateFile);
         const char *ca_path = MODSSL_CFG_CA(szCACertificatePath);
 
         cert_store = X509_STORE_new();
 
         if (!X509_STORE_load_locations(cert_store, ca_file, ca_path)) {
-            ssl_log(r->server, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                    "Unable to reconfigure verify locations "
-                    "for client authentication");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                         "Unable to reconfigure verify locations "
+                         "for client authentication");
+            ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, r->server);
 
             X509_STORE_free(cert_store);
 
             return HTTP_FORBIDDEN;
         }
 
         /* SSL_free will free cert_store */
         SSL_set_cert_store(ssl, cert_store);
 
         if (!(ca_list = ssl_init_FindCAList(r->server, r->pool,
                                             ca_file, ca_path)))
         {
-            ssl_log(r->server, SSL_LOG_ERROR,
-                    "Unable to determine list of available "
-                    "CA certificates for client authentication");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                         "Unable to determine list of available "
+                         "CA certificates for client authentication");
 
             return HTTP_FORBIDDEN;
         }
 
         SSL_set_client_CA_list(ssl, ca_list);
         renegotiate = TRUE;
 
-        ssl_log(r->server, SSL_LOG_TRACE,
-                "Changed client verification locations "
-                "will force renegotiation");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                     "Changed client verification locations will force "
+                     "renegotiation");
     }
 #endif /* HAVE_SSL_SET_CERT_STORE */
 
     /* 
      * SSL renegotiations in conjunction with HTTP
      * requests using the POST method are not supported.
@@ -688,16 +677,17 @@
      * BUFF code again. This way the data flows twice through the Apache BUFF, of
      * course. But this way the solution doesn't depend on any Apache specifics
      * and is fully transparent to Apache modules.
      *
      * !! BUT ALL THIS IS STILL NOT RE-IMPLEMENTED FOR APACHE 2.0 !!
      */
-    if (renegotiate && (r->method_number == M_POST)) {
-        ssl_log(r->server, SSL_LOG_ERROR,
-                "SSL Re-negotiation in conjunction "
-                "with POST method not supported!");
+    if (renegotiate && !renegotiate_quick && (r->method_number == M_POST)) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                     "SSL Re-negotiation in conjunction "
+                     "with POST method not supported!\n"
+                     "hint: try SSLOptions +OptRenegotiate");
 
         return HTTP_METHOD_NOT_ALLOWED;
     }
 
     /*
      * now do the renegotiation if anything was actually reconfigured
@@ -711,92 +701,113 @@
          * that the client replies to a Hello Request). But because we insist
          * on a reply (anything else is an error for us) we have to go to the
          * ACCEPT state manually. Using SSL_set_accept_state() doesn't work
          * here because it resets too much of the connection.  So we set the
          * state explicitly and continue the handshake manually.
          */
-        ssl_log(r->server, SSL_LOG_INFO,
-                "Requesting connection re-negotiation");
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                     "Requesting connection re-negotiation");
 
         if (renegotiate_quick) {
             STACK_OF(X509) *cert_stack;
 
             /* perform just a manual re-verification of the peer */
-            ssl_log(r->server, SSL_LOG_TRACE,
-                    "Performing quick renegotiation: "
-                    "just re-verifying the peer");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                         "Performing quick renegotiation: "
+                         "just re-verifying the peer");
 
             cert_stack = (STACK_OF(X509) *)SSL_get_peer_cert_chain(ssl);
 
+            cert = SSL_get_peer_certificate(ssl);
+
+            if (!cert_stack && cert) {
+                /* client cert is in the session cache, but there is
+                 * no chain, since ssl3_get_client_certificate()
+                 * sk_X509_shift-ed the peer cert out of the chain.
+                 * we put it back here for the purpose of quick_renegotiation.
+                 */
+                cert_stack = sk_new_null();
+                sk_X509_push(cert_stack, cert);
+            }
+
             if (!cert_stack || (sk_X509_num(cert_stack) == 0)) {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Cannot find peer certificate chain");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Cannot find peer certificate chain");
 
                 return HTTP_FORBIDDEN;
             }
 
             if (!(cert_store ||
                   (cert_store = SSL_CTX_get_cert_store(ctx))))
             {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Cannot find certificate storage");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Cannot find certificate storage");
 
                 return HTTP_FORBIDDEN;
             }
 
-            cert = sk_X509_value(cert_stack, 0);
+            if (!cert) {
+                cert = sk_X509_value(cert_stack, 0);
+            }
+
             X509_STORE_CTX_init(&cert_store_ctx, cert_store, cert, cert_stack);
             depth = SSL_get_verify_depth(ssl);
 
             if (depth >= 0) {
                 X509_STORE_CTX_set_depth(&cert_store_ctx, depth);
             }
 
             X509_STORE_CTX_set_ex_data(&cert_store_ctx,
                                        SSL_get_ex_data_X509_STORE_CTX_idx(),
                                        (char *)ssl);
 
             if (!modssl_X509_verify_cert(&cert_store_ctx)) {
-                ssl_log(r->server, SSL_LOG_ERROR|SSL_ADD_SSLERR, 
-                        "Re-negotiation verification step failed");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Re-negotiation verification step failed");
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, r->server);
             }
 
             SSL_set_verify_result(ssl, cert_store_ctx.error);
             X509_STORE_CTX_cleanup(&cert_store_ctx);
+
+            if (cert_stack != SSL_get_peer_cert_chain(ssl)) {
+                /* we created this ourselves, so free it */
+                sk_X509_pop_free(cert_stack, X509_free);
+            }
         }
         else {
             request_rec *id = r->main ? r->main : r;
 
             /* do a full renegotiation */
-            ssl_log(r->server, SSL_LOG_TRACE,
-                    "Performing full renegotiation: "
-                    "complete handshake protocol");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, r->server,
+                         "Performing full renegotiation: "
+                         "complete handshake protocol");
 
             SSL_set_session_id_context(ssl,
                                        (unsigned char *)&id,
                                        sizeof(id));
 
             SSL_renegotiate(ssl);
             SSL_do_handshake(ssl);
 
             if (SSL_get_state(ssl) != SSL_ST_OK) {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Re-negotiation request failed");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Re-negotiation request failed");
 
                 return HTTP_FORBIDDEN;
             }
 
-            ssl_log(r->server, SSL_LOG_INFO,
-                    "Awaiting re-negotiation handshake");
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                         "Awaiting re-negotiation handshake");
 
             SSL_set_state(ssl, SSL_ST_ACCEPT);
             SSL_do_handshake(ssl);
 
             if (SSL_get_state(ssl) != SSL_ST_OK) {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Re-negotiation handshake failed: "
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Re-negotiation handshake failed: "
                         "Not accepted by client!?");
 
                 return HTTP_FORBIDDEN;
             }
         }
 
@@ -812,23 +823,23 @@
          * Finally check for acceptable renegotiation results
          */
         if (dc->nVerifyClient != SSL_CVERIFY_NONE) {
             BOOL do_verify = (dc->nVerifyClient == SSL_CVERIFY_REQUIRE);
 
             if (do_verify && (SSL_get_verify_result(ssl) != X509_V_OK)) {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Re-negotiation handshake failed: "
-                        "Client verification failed");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Re-negotiation handshake failed: "
+                             "Client verification failed");
 
                 return HTTP_FORBIDDEN;
             }
 
             if (do_verify && !SSL_get_peer_certificate(ssl)) {
-                ssl_log(r->server, SSL_LOG_ERROR,
-                        "Re-negotiation handshake failed: "
-                        "Client certificate missing");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
+                             "Re-negotiation handshake failed: "
+                             "Client certificate missing");
 
                 return HTTP_FORBIDDEN;
             }
         }
     }
 
@@ -845,32 +856,32 @@
         if (ok < 0) {
             cp = apr_psprintf(r->pool,
                               "Failed to execute "
                               "SSL requirement expression: %s",
                               ssl_expr_get_error());
 
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r, 
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, 
                           "access to %s failed, reason: %s",
                           r->filename, cp);
 
             /* remember forbidden access for strict require option */
             apr_table_setn(r->notes, "ssl-access-forbidden", "1");
 
             return HTTP_FORBIDDEN;
         }
 
         if (ok != 1) {
-            ssl_log(r->server, SSL_LOG_INFO,
-                    "Access to %s denied for %s "
-                    "(requirement expression not fulfilled)",
-                    r->filename, r->connection->remote_ip);
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                         "Access to %s denied for %s "
+                         "(requirement expression not fulfilled)",
+                         r->filename, r->connection->remote_ip);
 
-            ssl_log(r->server, SSL_LOG_INFO,
-                    "Failed expression: %s", req->cpExpr);
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                         "Failed expression: %s", req->cpExpr);
 
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r, 
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r, 
                           "access to %s failed, reason: %s",
                           r->filename,
                           "SSL requirement expression not fulfilled "
                           "(see SSL logfile for more details)");
 
             /* remember forbidden access for strict require option */
@@ -976,14 +987,14 @@
     apr_snprintf(buf1, sizeof(buf1), "%s:password", clientdn);
     ssl_util_uuencode(buf2, buf1, FALSE);
 
     apr_snprintf(buf1, sizeof(buf1), "Basic %s", buf2);
     apr_table_set(r->headers_in, "Authorization", buf1);
 
-    ssl_log(r->server, SSL_LOG_INFO,
-            "Faking HTTP Basic Auth header: \"Authorization: %s\"", buf1);
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, r->server,
+                 "Faking HTTP Basic Auth header: \"Authorization: %s\"", buf1);
 
     return DECLINED;
 }
 
 /* authorization phase */
 int ssl_hook_Auth(request_rec *r)
@@ -1199,14 +1210,14 @@
 RSA *ssl_callback_TmpRSA(SSL *ssl, int export, int keylen)
 {
     conn_rec *c = (conn_rec *)SSL_get_app_data(ssl);
     SSLModConfigRec *mc = myModConfig(c->base_server);
     int idx;
 
-    ssl_log(c->base_server, SSL_LOG_TRACE,
-            "handing out temporary %d bit RSA key", keylen);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, c->base_server,
+                 "handing out temporary %d bit RSA key", keylen);
 
     /* doesn't matter if export flag is on,
      * we won't be asked for keylen > 512 in that case.
      * if we are asked for a keylen > 1024, it is too expensive
      * to generate on the fly.
      * XXX: any reason not to generate 2048 bit keys at startup?
@@ -1231,14 +1242,14 @@
 DH *ssl_callback_TmpDH(SSL *ssl, int export, int keylen)
 {
     conn_rec *c = (conn_rec *)SSL_get_app_data(ssl);
     SSLModConfigRec *mc = myModConfig(c->base_server);
     int idx;
 
-    ssl_log(c->base_server, SSL_LOG_TRACE,
-            "handing out temporary %d bit DH key", keylen);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, c->base_server,
+                 "handing out temporary %d bit DH key", keylen);
 
     switch (keylen) {
       case 512:
         idx = SSL_TMP_KEY_DH_512;
         break;
 
@@ -1272,22 +1283,23 @@
     int errdepth = X509_STORE_CTX_get_error_depth(ctx);
     int depth, verify;
 
     /*
      * Log verification information
      */
-    if (sc->log_level >= SSL_LOG_TRACE) {
+    if (s->loglevel >= APLOG_DEBUG) {
         X509 *cert  = X509_STORE_CTX_get_current_cert(ctx);
         char *sname = X509_NAME_oneline(X509_get_subject_name(cert), NULL, 0);
         char *iname = X509_NAME_oneline(X509_get_issuer_name(cert),  NULL, 0);
 
-        ssl_log(s, SSL_LOG_TRACE,
-                "Certificate Verification: depth: %d, subject: %s, issuer: %s",
-                errdepth,
-                sname ? sname : "-unknown-",
-                iname ? iname : "-unknown-");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "Certificate Verification: "
+                     "depth: %d, subject: %s, issuer: %s",
+                     errdepth,
+                     sname ? sname : "-unknown-",
+                     iname ? iname : "-unknown-");
 
         if (sname) {
             free(sname);
         }
 
         if (iname) {
@@ -1314,15 +1326,16 @@
         return TRUE;
     }
 
     if (ssl_verify_error_is_optional(errnum) &&
         (verify == SSL_CVERIFY_OPTIONAL_NO_CA))
     {
-        ssl_log(s, SSL_LOG_TRACE,
-                "Certificate Verification: Verifiable Issuer is configured as "
-                "optional, therefore we're accepting the certificate");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "Certificate Verification: Verifiable Issuer is "
+                     "configured as optional, therefore we're accepting "
+                     "the certificate");
 
         sslconn->verify_info = "GENEROUS";
         ok = TRUE;
     }
 
     /*
@@ -1335,15 +1348,15 @@
     }
 
     /*
      * If we already know it's not ok, log the real reason
      */
     if (!ok) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Certificate Verification: Error (%d): %s",
-                errnum, X509_verify_cert_error_string(errnum));
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Certificate Verification: Error (%d): %s",
+                     errnum, X509_verify_cert_error_string(errnum));
 
         sslconn->client_dn = NULL;
         sslconn->client_cert = NULL;
         sslconn->verify_error = X509_verify_cert_error_string(errnum);
     }
 
@@ -1355,16 +1368,17 @@
     }
     else {
         depth = mctx->auth.verify_depth;
     }
 
     if (errdepth > depth) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Certificate Verification: Certificate Chain too long "
-                "(chain has %d certificates, but maximum allowed are only %d)",
-                errdepth, depth);
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Certificate Verification: Certificate Chain too long "
+                     "(chain has %d certificates, but maximum allowed are "
+                     "only %d)",
+                     errdepth, depth);
 
         errnum = X509_V_ERR_CERT_CHAIN_TOO_LONG;
         sslconn->verify_error = X509_verify_cert_error_string(errnum);
 
         ok = FALSE;
     }
@@ -1444,13 +1458,13 @@
 
     if ((rc > 0) && crl) {
         /*
          * Log information about CRL
          * (A little bit complicated because of ASN.1 and BIOs...)
          */
-        if (sc->log_level >= SSL_LOG_TRACE) {
+        if (s->loglevel >= APLOG_DEBUG) {
             char buff[512]; /* should be plenty */
             BIO *bio = BIO_new(BIO_s_mem());
 
             BIO_printf(bio, "CA CRL: Issuer: ");
             X509_NAME_print(bio, issuer, 0);
 
@@ -1462,20 +1476,21 @@
 
             n = BIO_read(bio, buff, sizeof(buff));
             buff[n] = '\0';
 
             BIO_free(bio);
 
-            ssl_log(s, SSL_LOG_TRACE, buff);
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s, buff);
         }
 
         /*
          * Verify the signature on this CRL
          */
         if (X509_CRL_verify(crl, X509_get_pubkey(cert)) <= 0) {
-            ssl_log(s, SSL_LOG_WARN, "Invalid signature on CRL");
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "Invalid signature on CRL");
 
             X509_STORE_CTX_set_error(ctx, X509_V_ERR_CRL_SIGNATURE_FAILURE);
             X509_OBJECT_free_contents(&obj);
 
             return FALSE;
         }
@@ -1483,26 +1498,26 @@
         /*
          * Check date of CRL to make sure it's not expired
          */
         i = X509_cmp_current_time(X509_CRL_get_nextUpdate(crl));
 
         if (i == 0) {
-            ssl_log(s, SSL_LOG_WARN,
-                    "Found CRL has invalid nextUpdate field");
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "Found CRL has invalid nextUpdate field");
 
             X509_STORE_CTX_set_error(ctx,
                                      X509_V_ERR_ERROR_IN_CRL_NEXT_UPDATE_FIELD);
             X509_OBJECT_free_contents(&obj);
 
             return FALSE;
         }
 
         if (i < 0) {
-            ssl_log(s, SSL_LOG_WARN,
-                    "Found CRL is expired - "
-                    "revoking all certificates until you get updated CRL");
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                         "Found CRL is expired - "
+                         "revoking all certificates until you get updated CRL");
 
             X509_STORE_CTX_set_error(ctx, X509_V_ERR_CRL_HAS_EXPIRED);
             X509_OBJECT_free_contents(&obj);
 
             return FALSE;
         }
@@ -1529,20 +1544,20 @@
             X509_REVOKED *revoked =
                 sk_X509_REVOKED_value(X509_CRL_get_REVOKED(crl), i);
 
             ASN1_INTEGER *sn = X509_REVOKED_get_serialNumber(revoked);
 
             if (!ASN1_INTEGER_cmp(sn, X509_get_serialNumber(cert))) {
-                if (sc->log_level >= SSL_LOG_INFO) {
+                if (s->loglevel >= APLOG_DEBUG) {
                     char *cp = X509_NAME_oneline(issuer, NULL, 0);
                     long serial = ASN1_INTEGER_get(sn);
 
-                    ssl_log(s, SSL_LOG_INFO,
-                            "Certificate with serial %ld (0x%lX) "
-                            "revoked per CRL from issuer %s",
-                            serial, serial, cp);
+                    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                                 "Certificate with serial %ld (0x%lX) "
+                                 "revoked per CRL from issuer %s",
+                                 serial, serial, cp);
                     free(cp);
                 }
 
                 X509_STORE_CTX_set_error(ctx, X509_V_ERR_CERT_REVOKED);
                 X509_OBJECT_free_contents(&obj);
 
@@ -1565,22 +1580,22 @@
 {
     SSLSrvConfigRec *sc = mySrvConfig(s);
     char name_buf[256];
     X509_NAME *name;
     const char *dn;
 
-    if (sc->log_level < SSL_LOG_TRACE) {
+    if (s->loglevel < APLOG_DEBUG) {
         return;
     }
 
     name = X509_get_subject_name(info->x509);
     dn = X509_NAME_oneline(name, name_buf, sizeof(name_buf));
 
-    ssl_log(s, SSL_LOG_TRACE,
-            SSLPROXY_CERT_CB_LOG_FMT "%s, sending %s", 
-            sc->vhost_id, msg, dn ? dn : "-uknown-");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 SSLPROXY_CERT_CB_LOG_FMT "%s, sending %s", 
+                 sc->vhost_id, msg, dn ? dn : "-uknown-");
 }
 
 /*
  * caller will decrement the cert and key reference
  * so we need to increment here to prevent them from
  * being freed.
@@ -1599,21 +1614,21 @@
     X509_NAME *ca_name, *issuer;
     X509_INFO *info;
     STACK_OF(X509_NAME) *ca_list;
     STACK_OF(X509_INFO) *certs = sc->proxy->pkp->certs;
     int i, j;
     
-    ssl_log(s, SSL_LOG_TRACE, 
-            SSLPROXY_CERT_CB_LOG_FMT "entered",
-            sc->vhost_id);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s, 
+                 SSLPROXY_CERT_CB_LOG_FMT "entered",
+                 sc->vhost_id);
 
     if (!certs || (sk_X509_INFO_num(certs) <= 0)) {
-        ssl_log(s, SSL_LOG_WARN,
-                SSLPROXY_CERT_CB_LOG_FMT
-                "downstream server wanted client certificate "
-                "but none are configured", sc->vhost_id);
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                     SSLPROXY_CERT_CB_LOG_FMT
+                     "downstream server wanted client certificate "
+                     "but none are configured", sc->vhost_id);
         return FALSE;
     }                                                                     
 
     ca_list = SSL_get_client_CA_list(ssl);
 
     if (!ca_list || (sk_X509_NAME_num(ca_list) <= 0)) {
@@ -1644,45 +1659,45 @@
 
                 return TRUE;
             }
         }
     }
 
-    ssl_log(s, SSL_LOG_TRACE,
-            SSLPROXY_CERT_CB_LOG_FMT
-            "no client certificate found!?", sc->vhost_id);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 SSLPROXY_CERT_CB_LOG_FMT
+                 "no client certificate found!?", sc->vhost_id);
 
     return FALSE; 
 }
 
 static void ssl_session_log(server_rec *s,
                             const char *request,
                             unsigned char *id,
                             unsigned int idlen,
                             const char *status,
                             const char *result,
                             long timeout)
 {
-    SSLSrvConfigRec *sc = mySrvConfig(s);
     char buf[SSL_SESSION_ID_STRING_LEN];
     char timeout_str[56] = {'\0'};
 
-    if (sc->log_level < SSL_LOG_TRACE) {
+    if (s->loglevel < APLOG_DEBUG) {
         return;
     }
 
     if (timeout) {
         apr_snprintf(timeout_str, sizeof(timeout_str),
                      "timeout=%lds ", (timeout - time(NULL)));
     }
 
-    ssl_log(s, SSL_LOG_TRACE, "Inter-Process Session Cache: "
-            "request=%s status=%s id=%s %s(session %s)",
-            request, status,
-            SSL_SESSION_id2sz(id, idlen, buf, sizeof(buf)),
-            timeout_str, result);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Inter-Process Session Cache: "
+                 "request=%s status=%s id=%s %s(session %s)",
+                 request, status,
+                 SSL_SESSION_id2sz(id, idlen, buf, sizeof(buf)),
+                 timeout_str, result);
 }
 
 /*
  *  This callback function is executed by OpenSSL whenever a new SSL_SESSION is
  *  added to the internal OpenSSL session cache. We use this hook to spread the
  *  SSL_SESSION also to the inter-process disk-cache to make share it with our
@@ -1823,63 +1838,69 @@
         return;
     }
 
     /*
      * create the various trace messages
      */
-    if (sc->log_level >= SSL_LOG_TRACE) {
+    if (s->loglevel >= APLOG_DEBUG) {
         if (where & SSL_CB_HANDSHAKE_START) {
-            ssl_log(s, SSL_LOG_TRACE,
-                    "%s: Handshake: start", SSL_LIBRARY_NAME);
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Handshake: start", SSL_LIBRARY_NAME);
         }
         else if (where & SSL_CB_HANDSHAKE_DONE) {
-            ssl_log(s, SSL_LOG_TRACE,
-                    "%s: Handshake: done", SSL_LIBRARY_NAME);
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Handshake: done", SSL_LIBRARY_NAME);
         }
         else if (where & SSL_CB_LOOP) {
-            ssl_log(s, SSL_LOG_TRACE, "%s: Loop: %s",
-                    SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Loop: %s",
+                         SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
         }
         else if (where & SSL_CB_READ) {
-            ssl_log(s, SSL_LOG_TRACE, "%s: Read: %s",
-                    SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Read: %s",
+                         SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
         }
         else if (where & SSL_CB_WRITE) {
-            ssl_log(s, SSL_LOG_TRACE, "%s: Write: %s",
-                    SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Write: %s",
+                         SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
         }
         else if (where & SSL_CB_ALERT) {
             char *str = (where & SSL_CB_READ) ? "read" : "write";
-            ssl_log(s, SSL_LOG_TRACE, "%s: Alert: %s:%s:%s\n",
-                    SSL_LIBRARY_NAME, str,
-                    SSL_alert_type_string_long(rc),
-                    SSL_alert_desc_string_long(rc));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "%s: Alert: %s:%s:%s\n",
+                         SSL_LIBRARY_NAME, str,
+                         SSL_alert_type_string_long(rc),
+                         SSL_alert_desc_string_long(rc));
         }
         else if (where & SSL_CB_EXIT) {
             if (rc == 0) {
-                ssl_log(s, SSL_LOG_TRACE, "%s: Exit: failed in %s",
-                        SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                             "%s: Exit: failed in %s",
+                             SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
             }
             else if (rc < 0) {
-                ssl_log(s, SSL_LOG_TRACE, "%s: Exit: error in %s",
-                        SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                             "%s: Exit: error in %s",
+                             SSL_LIBRARY_NAME, SSL_state_string_long(ssl));
             }
         }
     }
 
     /*
      * Because SSL renegotations can happen at any time (not only after
      * SSL_accept()), the best way to log the current connection details is
      * right after a finished handshake.
      */
     if (where & SSL_CB_HANDSHAKE_DONE) {
-        ssl_log(s, SSL_LOG_INFO,
-                "Connection: Client IP: %s, Protocol: %s, "
-                "Cipher: %s (%s/%s bits)",
-                ssl_var_lookup(NULL, s, c, NULL, "REMOTE_ADDR"),
-                ssl_var_lookup(NULL, s, c, NULL, "SSL_PROTOCOL"),
-                ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER"),
-                ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER_USEKEYSIZE"),
-                ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER_ALGKEYSIZE"));
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "Connection: Client IP: %s, Protocol: %s, "
+                     "Cipher: %s (%s/%s bits)",
+                     ssl_var_lookup(NULL, s, c, NULL, "REMOTE_ADDR"),
+                     ssl_var_lookup(NULL, s, c, NULL, "SSL_PROTOCOL"),
+                     ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER"),
+                     ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER_USEKEYSIZE"),
+                     ssl_var_lookup(NULL, s, c, NULL, "SSL_CIPHER_ALGKEYSIZE"));
     }
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_log.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_log.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_log.c	2002-04-30 11:47:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_log.c	2002-05-17 19:24:17.000000000 +0800
@@ -65,81 +65,12 @@
 /*  _________________________________________________________________
 **
 **  Logfile Support
 **  _________________________________________________________________
 */
 
-/*
- * Open the SSL logfile
- */
-void ssl_log_open(server_rec *s_main, server_rec *s, apr_pool_t *p)
-{
-    const char *szLogFile;
-    SSLSrvConfigRec *sc_main = mySrvConfig(s_main);
-    SSLSrvConfigRec *sc = mySrvConfig(s);
-    piped_log *pl;
-
-    /* 
-     * Short-circuit for inherited logfiles in order to save
-     * filedescriptors in mass-vhost situation. Be careful, this works
-     * fine because the close happens implicitly by the pool facility.
-     */
-    if ((s != s_main) &&
-        (sc_main->log_file != NULL) &&
-        ((sc->log_file_name == NULL) ||
-         ((sc->log_file_name != NULL) &&
-          (sc_main->log_file_name != NULL) &&
-          strEQ(sc->log_file_name, sc_main->log_file_name))))
-    {
-        sc->log_file = sc_main->log_file;
-    }
-    else if (sc->log_file_name != NULL) {
-        if (strEQ(sc->log_file_name, "/dev/null"))
-            return;
-        else if (sc->log_file_name[0] == '|') {
-            szLogFile = sc->log_file_name + 1;
-            while (*szLogFile == ' ' || *szLogFile == '\t')
-                szLogFile++;
-            if ((pl = ap_open_piped_log(p, szLogFile)) == NULL) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                        "Cannot open reliable pipe to SSL logfile filter %s", szLogFile);
-                ssl_die();
-            }
-            sc->log_file = ap_piped_log_write_fd(pl); 
-        }
-        else {
-            szLogFile = ap_server_root_relative(p, sc->log_file_name);
-            if (!szLogFile) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                        "Invalid SSL logfile path %s", sc->log_file_name);
-                ssl_die();
-            }
-            if ((apr_file_open(&(sc->log_file), szLogFile, 
-                               APR_WRITE|APR_APPEND|APR_CREATE, APR_OS_DEFAULT, p)) 
-                               != APR_SUCCESS) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                        "Cannot open SSL logfile %s", szLogFile);
-                ssl_die();
-            }
-        }
-    }
-    return;
-}
-
-static struct {
-    int   nLevel;
-    char *szLevel;
-} ssl_log_level2string[] = {
-    { SSL_LOG_ERROR, "error" },
-    { SSL_LOG_WARN,  "warn"  },
-    { SSL_LOG_INFO,  "info"  },
-    { SSL_LOG_TRACE, "trace" },
-    { SSL_LOG_DEBUG, "debug" },
-    { 0, NULL }
-};
-
 static struct {
     char *cpPattern;
     char *cpAnnotation;
 } ssl_log_annotate[] = {
     { "*envelope*bad*decrypt*", "wrong pass phrase!?" },
     { "*CLIENT_HELLO*unknown*protocol*", "speaking not SSL to HTTPS port!?" },
@@ -166,158 +97,40 @@
             break;
         }
     }
     return errstr;
 }
 
-void ssl_log(server_rec *s, int level, const char *msg, ...)
-{
-    char tstr[80];
-    char lstr[256];
-    char vstr[1024];
-    char str[1024];
-    char *nstr;
-    apr_size_t len;
-    apr_time_exp_t t;
-    va_list ap;
-    int add;
-    int i;
-    char *astr;
-    int safe_errno;
-    unsigned long e;
-    SSLSrvConfigRec *sc;
-    char *cpE;
-    char *cpA;
-
-    /*  initialization  */
-    safe_errno = errno;
-    sc = mySrvConfig(s);
-
-    /*  strip out additional flags  */
-    add   = (level & ~SSL_LOG_MASK);
-    level = (level & SSL_LOG_MASK);
-
-    /*  reduce flags when not reasonable in context  */
-    if (add & SSL_ADD_ERRNO && errno == 0)
-        add &= ~SSL_ADD_ERRNO;
-    if (add & SSL_ADD_SSLERR && ERR_peek_error() == 0)
-        add &= ~SSL_ADD_SSLERR;
-
-    /*  we log only levels below, except for errors */
-    if (   sc->log_file == NULL
-        && !(level & SSL_LOG_ERROR))
-        return;
-    if (   level > sc->log_level
-        && !(level & SSL_LOG_ERROR))
-        return;
-
-    /*  determine the time entry string  */
-    if (add & SSL_NO_TIMESTAMP)
-        tstr[0] = NUL;
-    else {
-        apr_time_exp_lt(&t, apr_time_now());
-        apr_strftime(tstr, &len, 80, "[%d/%b/%Y %H:%M:%S", &t);
-        apr_snprintf(tstr + strlen(tstr), 80 - strlen(tstr), " %05d] ", 
-                     (unsigned int)getpid());
-    }
-
-    /*  determine whether newline should be written */
-    if (add & SSL_NO_NEWLINE)
-        nstr = "";
-    else {
-        nstr = APR_EOL_STR;
-    }
-
-    /*  determine level name  */
-    lstr[0] = NUL;
-    if (!(add & SSL_NO_LEVELID)) {
-        for (i = 0; ssl_log_level2string[i].nLevel != 0; i++) {
-            if (ssl_log_level2string[i].nLevel == level) {
-                apr_snprintf(lstr, sizeof(lstr), "[%s]", ssl_log_level2string[i].szLevel);
-                break;
-            }
-        }
-        for (i = strlen(lstr); i <= 7; i++)
-            lstr[i] = ' ';
-        lstr[i] = NUL;
-    }
-
-    if (add & SSL_INIT) {
-        len = strlen(lstr);
-        apr_snprintf(&lstr[len], sizeof(lstr) - len,
-                     "Init: (%s) ", sc->vhost_id);
-    }
-
-    /*  create custom message  */
-    va_start(ap, msg);
-    apr_vsnprintf(vstr, sizeof(vstr), msg, ap);
-    va_end(ap);
-
-    /*  write out SSLog message  */
-    if ((add & SSL_ADD_ERRNO) && (add & SSL_ADD_SSLERR))
-        astr = " (System and " SSL_LIBRARY_NAME " library errors follow)";
-    else if (add & SSL_ADD_ERRNO)
-        astr = " (System error follows)";
-    else if (add & SSL_ADD_SSLERR)
-        astr = " (" SSL_LIBRARY_NAME " library error follows)";
-    else
-        astr = "";
-    if (level <= sc->log_level && sc->log_file != NULL) {
-        apr_snprintf(str, sizeof(str), "%s%s%s%s%s", 
-                     tstr, lstr, vstr, astr, nstr);
-        apr_file_printf(sc->log_file, "%s", str);
-    }
-    if (level & SSL_LOG_ERROR)
-        ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, s,
-                     "mod_ssl: %s%s", vstr, astr);
-
-    /*  write out additional attachment messages  */
-    if (add & SSL_ADD_ERRNO) {
-        if (level <= sc->log_level && sc->log_file != NULL) {
-            apr_snprintf(str, sizeof(str), "%s%sSystem: %s (errno: %d)%s",
-                         tstr, lstr, strerror(safe_errno), safe_errno, nstr);
-            apr_file_printf(sc->log_file, "%s", str);
-        }
-        if (level & SSL_LOG_ERROR)
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, s,
-                         "System: %s (errno: %d)",
-                         strerror(safe_errno), safe_errno);
-    }
-    if (add & SSL_ADD_SSLERR) {
-        while ((e = ERR_get_error())) {
-            cpE = ERR_error_string(e, NULL);
-            cpA = ssl_log_annotation(cpE);
-            if (level <= sc->log_level && sc->log_file != NULL) {
-                apr_snprintf(str, sizeof(str), "%s%s%s: %s%s%s%s%s",
-                             tstr, lstr, SSL_LIBRARY_NAME, cpE,
-                             cpA != NULL ? " [Hint: " : "",
-                             cpA != NULL ? cpA : "", cpA != NULL ? "]" : "",
-                             nstr);
-                apr_file_printf(sc->log_file, "%s", str);
-            }
-            if (level & SSL_LOG_ERROR)
-                ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, s,
-                             "%s: %s%s%s%s", SSL_LIBRARY_NAME, cpE,
-                             cpA != NULL ? " [Hint: " : "",
-                             cpA != NULL ? cpA : "", cpA != NULL ? "]" : "");
-        }
-    }
-    /* make sure the next log starts from a clean base */
-    /* ERR_clear_error(); */
-
-    /*  cleanup and return  */
-    if (sc->log_file != NULL)
-        apr_file_flush(sc->log_file);
-    errno = safe_errno;
-    return;
-}
-
 void ssl_die(void)
 {
     /*
      * This is used for fatal errors and here
      * it is common module practice to really
      * exit from the complete program.
      */
     exit(1);
 }
 
+/*
+ * Prints the SSL library error information.
+ */
+void ssl_log_ssl_error(const char *file, int line, int level, server_rec *s)
+{
+    unsigned long e;
+
+    while ((e = ERR_get_error())) {
+        char *err, *annotation;
+        err = ERR_error_string(e, NULL);
+        annotation = ssl_log_annotation(err);
+
+        if (annotation) {
+            ap_log_error(file, line, level, 0, s,
+                         "SSL Library Error: %ld %s %s",
+                         e, err, annotation); 
+        }
+        else {
+            ap_log_error(file, line, level, 0, s,
+                         "SSL Library Error: %ld %s",
+                         e, err); 
+        }
+    }
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_mutex.c	2002-04-09 23:53:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_mutex.c	2002-05-21 02:33:41.000000000 +0800
@@ -58,27 +58,41 @@
  */
                              /* ``Real programmers confuse
                                   Christmas and Halloween
                                   because DEC 25 = OCT 31.''
                                              -- Unknown     */
 #include "mod_ssl.h"
+#if !defined(OS2) && !defined(WIN32) && !defined(BEOS) && !defined(NETWARE)
+#include "unixd.h"
+#endif
 
 int ssl_mutex_init(server_rec *s, apr_pool_t *p)
 {
     SSLModConfigRec *mc = myModConfig(s);
+    apr_status_t rv;
 
     if (mc->nMutexMode == SSL_MUTEXMODE_NONE) 
         return TRUE;
 
-    if (apr_global_mutex_create(&mc->pMutex, mc->szMutexFile,
-                                APR_LOCK_DEFAULT, p) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR,
-                   "Cannot create SSLMutex file `%s'",
-                    mc->szMutexFile);
+    if ((rv = apr_global_mutex_create(&mc->pMutex, mc->szMutexFile,
+                                APR_LOCK_DEFAULT, p)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot create SSLMutex file `%s'",
+                     mc->szMutexFile);
         return FALSE;
     }
+
+#if APR_USE_SYSVSEM_SERIALIZE
+    rv = unixd_set_global_mutex_perms(mc->pMutex);
+    if (rv != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Could not set permissions on ssl_mutex; check User "
+                     "and Group directives");
+        return FALSE;
+    }
+#endif
     return TRUE;
 }
 
 int ssl_mutex_reinit(server_rec *s, apr_pool_t *p)
 {
     SSLModConfigRec *mc = myModConfig(s);
@@ -92,29 +106,33 @@
     return TRUE;
 }
 
 int ssl_mutex_on(server_rec *s)
 {
     SSLModConfigRec *mc = myModConfig(s);
+    apr_status_t rv;
 
     if (mc->nMutexMode == SSL_MUTEXMODE_NONE)
         return TRUE;
-    if (apr_global_mutex_lock(mc->pMutex) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_WARN, "Failed to acquire global mutex lock");
+    if ((rv = apr_global_mutex_lock(mc->pMutex)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_WARNING, rv, s,
+                     "Failed to acquire global mutex lock");
         return FALSE;
     }
     return TRUE;
 }
 
 int ssl_mutex_off(server_rec *s)
 {
     SSLModConfigRec *mc = myModConfig(s);
+    apr_status_t rv;
 
     if (mc->nMutexMode == SSL_MUTEXMODE_NONE)
         return TRUE;
-    if (apr_global_mutex_unlock(mc->pMutex) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_WARN, "Failed to release global mutex lock");
+    if ((rv = apr_global_mutex_unlock(mc->pMutex)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_WARNING, rv, s,
+                     "Failed to release global mutex lock");
         return FALSE;
     }
     return TRUE;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_pphrase.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_pphrase.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_pphrase.c	2002-03-29 02:50:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_pphrase.c	2002-06-18 03:39:19.000000000 +0800
@@ -186,12 +186,13 @@
     int i, j;
     ssl_algo_t algoCert, algoKey, at;
     char *an;
     char *cp;
     apr_time_t pkey_mtime = 0;
     int isterm = 1;
+    apr_status_t rv;
     /*
      * Start with a fresh pass phrase array
      */
     aPassPhrase       = apr_array_make(p, 2, sizeof(char *));
     nPassPhrase       = 0;
     nPassPhraseDialog = 0;
@@ -203,50 +204,54 @@
         sc = mySrvConfig(pServ);
 
         if (!sc->enabled)
             continue;
 
         cpVHostID = ssl_util_vhostid(p, pServ);
-        ssl_log(pServ, SSL_LOG_INFO|SSL_INIT,
-                "Loading certificate & private key of SSL-aware server");
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, pServ,
+                     "Loading certificate & private key of SSL-aware server");
 
         /*
          * Read in server certificate(s): This is the easy part
          * because this file isn't encrypted in any way.
          */
         if (sc->server->pks->cert_files[0] == NULL) {
-            ssl_log(pServ, SSL_LOG_ERROR|SSL_INIT,
-                    "Server should be SSL-aware but has no certificate configured "
-                    "[Hint: SSLCertificateFile]");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, pServ,
+                         "Server should be SSL-aware but has no certificate "
+                         "configured [Hint: SSLCertificateFile]");
             ssl_die();
         }
         algoCert = SSL_ALGO_UNKNOWN;
         algoKey  = SSL_ALGO_UNKNOWN;
         for (i = 0, j = 0; i < SSL_AIDX_MAX && sc->server->pks->cert_files[i] != NULL; i++) {
 
             apr_cpystrn(szPath, sc->server->pks->cert_files[i], sizeof(szPath));
-            if ( exists_and_readable(szPath, p, NULL) != APR_SUCCESS ) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                        "Init: Can't open server certificate file %s", szPath);
+            if ((rv = exists_and_readable(szPath, p, NULL)) != APR_SUCCESS) {
+                ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                             "Init: Can't open server certificate file %s",
+                             szPath);
                 ssl_die();
             }
             if ((pX509Cert = SSL_read_X509(szPath, NULL, NULL)) == NULL) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR,
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
                         "Init: Unable to read server certificate from file %s", szPath);
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
                 ssl_die();
             }
 
             /*
              * check algorithm type of certificate and make
              * sure only one certificate per type is used.
              */
             at = ssl_util_algotypeof(pX509Cert, NULL);
             an = ssl_util_algotypestr(at);
             if (algoCert & at) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                        "Init: Multiple %s server certificates not allowed", an);
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                             "Init: Multiple %s server certificates not "
+                             "allowed", an);
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
                 ssl_die();
             }
             algoCert |= at;
 
             /*
              * Insert the certificate into global module configuration to let it
@@ -311,15 +316,17 @@
             for (;;) {
                 /*
                  * Try to read the private key file with the help of
                  * the callback function which serves the pass
                  * phrases to OpenSSL
                  */
-                if ( exists_and_readable(szPath, p, &pkey_mtime) != APR_SUCCESS ) {
-                     ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                         "Init: Can't open server private key file %s",szPath);
+                if ((rv = exists_and_readable(szPath, p,
+                                              &pkey_mtime)) != APR_SUCCESS ) {
+                     ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                                  "Init: Can't open server private key file "
+                                  "%s",szPath);
                      ssl_die();
                 }
 
                 /*
                  * if the private key is encrypted and SSLPassPhraseDialog
                  * is configured to "builtin" it isn't possible to prompt for
@@ -347,16 +354,17 @@
                         const char *key_id =
                             ssl_asn1_table_keyfmt(p, cpVHostID, i);
                         ssl_asn1_t *asn1 = 
                             ssl_asn1_table_get(mc->tPrivateKey, key_id);
                     
                         if (asn1 && (asn1->source_mtime == pkey_mtime)) {
-                            ssl_log(pServ, SSL_LOG_INFO,
-                                    "%s reusing existing "
-                                    "%s private key on restart",
-                                    cpVHostID, ssl_asn1_keystr(i));
+                            ap_log_error(APLOG_MARK, APLOG_INFO,
+                                         0, pServ,
+                                         "%s reusing existing "
+                                         "%s private key on restart",
+                                         cpVHostID, ssl_asn1_keystr(i));
                             return;
                         }
                     }
                 }
 
                 cpPassPhraseCur = NULL;
@@ -406,86 +414,101 @@
                         apr_sleep((nPassPhraseRetry-BUILTIN_DIALOG_BACKOFF)
                                     * 5 * APR_USEC_PER_SEC);
                     continue;
                 }
 #ifdef WIN32
                 if (sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN) {
-                    ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                            "Init: PassPhraseDialog BuiltIn not supported in server private key from file %s", szPath);
+                    ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                                 "Init: SSLPassPhraseDialog builtin is not "
+                                 "supported on Win32 (key file "
+                                 "%s)", szPath);
                     ssl_die();
                 }
 #endif /* WIN32 */
 
                 /*
                  * Ok, anything else now means a fatal error.
                  */
                 if (cpPassPhraseCur == NULL) {
                     if (nPassPhraseDialogCur && pkey_mtime &&
                         !(isterm = isatty(fileno(stdout)))) /* XXX: apr_isatty() */
                     {
-                        ssl_log(pServ, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                                "Init: Unable read passphrase "
-                                "[Hint: key introduced or changed before restart?]");
+                        ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                                     pServ,
+                                     "Init: Unable to read pass phrase "
+                                     "[Hint: key introduced or changed "
+                                     "before restart?]");
+                        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, pServ);
                     }
                     else {
-                        ssl_log(pServ, SSL_LOG_ERROR|SSL_ADD_SSLERR, "Init: Private key not found");
+                        ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                                     pServ, "Init: Private key not found");
+                        ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, pServ);
                     }
-                    if (sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN
-                          || sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
+                    if (writetty) {
                         apr_file_printf(writetty, "Apache:mod_ssl:Error: Private key not found.\n");
                         apr_file_printf(writetty, "**Stopped\n");
                     }
                 }
                 else {
-                    ssl_log(pServ, SSL_LOG_ERROR|SSL_ADD_SSLERR, "Init: Pass phrase incorrect");
-                    if (sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN
-                          || sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
+                    ap_log_error(APLOG_MARK, APLOG_ERR, 0,
+                                 pServ, "Init: Pass phrase incorrect");
+                    ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, pServ);
+
+                    if (writetty) {
                         apr_file_printf(writetty, "Apache:mod_ssl:Error: Pass phrase incorrect.\n");
                         apr_file_printf(writetty, "**Stopped\n");
                     }
                 }
                 ssl_die();
             }
 
             if (pPrivateKey == NULL) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                        "Init: Unable to read server private key from file %s [Hint: Perhaps it is in a separate file?  See SSLCertificateKeyFile]", szPath);
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                            "Init: Unable to read server private key from "
+                            "file %s [Hint: Perhaps it is in a separate file? "
+                            "  See SSLCertificateKeyFile]", szPath);
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
                 ssl_die();
             }
 
             /*
              * check algorithm type of private key and make
              * sure only one private key per type is used.
              */
             at = ssl_util_algotypeof(NULL, pPrivateKey);
             an = ssl_util_algotypestr(at);
             if (algoKey & at) {
-                ssl_log(s, SSL_LOG_ERROR|SSL_ADD_SSLERR,
-                        "Init: Multiple %s server private keys not allowed", an);
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                             "Init: Multiple %s server private keys not "
+                             "allowed", an);
+                ssl_log_ssl_error(APLOG_MARK, APLOG_ERR, s);
                 ssl_die();
             }
             algoKey |= at;
 
             /*
              * Log the type of reading
              */
             if (nPassPhraseDialogCur == 0) {
-                ssl_log(pServ, SSL_LOG_TRACE|SSL_INIT, 
-                        "unencrypted %s private key - pass phrase not required", 
-                        an);
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, pServ, 
+                             "unencrypted %s private key - pass phrase not "
+                             "required", an);
             }
             else {
                 if (cpPassPhraseCur != NULL) {
-                    ssl_log(pServ, SSL_LOG_TRACE|SSL_INIT, 
-                            "encrypted %s private key - pass phrase requested", 
-                            an);
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
+                                 pServ, 
+                                 "encrypted %s private key - pass phrase "
+                                 "requested", an);
                 }
                 else {
-                    ssl_log(pServ, SSL_LOG_TRACE|SSL_INIT, 
-                            "encrypted %s private key - pass phrase reused", 
-                            an);
+                    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0,
+                                 pServ, 
+                                 "encrypted %s private key - pass phrase"
+                                 " reused", an);
                 }
             }
 
             /*
              * Ok, when we have one more pass phrase store it
              */
@@ -521,27 +544,26 @@
 
     /*
      * Let the user know when we're successful.
      */
     if (nPassPhraseDialog > 0) {
         sc = mySrvConfig(s);
-        if (sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN
-              || sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
+        if (writetty) {
             apr_file_printf(writetty, "\n");
             apr_file_printf(writetty, "Ok: Pass Phrase Dialog successful.\n");
         }
     }
 
     /*
      * Wipe out the used memory from the
      * pass phrase array and then deallocate it
      */
     if (aPassPhrase->nelts) {
         pphrase_array_clear(aPassPhrase);
-        ssl_log(s, SSL_LOG_INFO,
-                "Init: Wiped out the queried pass phrases from memory");
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "Init: Wiped out the queried pass phrases from memory");
     }
 
     /* Close the pipes if they were opened
      */
     if (readtty) {
         apr_file_close(readtty);
@@ -671,27 +693,27 @@
           || sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
         char *prompt;
         int i;
 
         if (sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
             if (!readtty) {
-                ssl_log(s, SSL_LOG_INFO,
-                        "Init: Creating pass phrase dialog pipe child '%s'",
-                        sc->server->pphrase_dialog_path);
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                             "Init: Creating pass phrase dialog pipe child "
+                             "'%s'", sc->server->pphrase_dialog_path);
 	        if (ssl_pipe_child_create(p, sc->server->pphrase_dialog_path)
                         != APR_SUCCESS) {
-                    ssl_log(s, SSL_LOG_ERROR,
-                            "Init: Failed to create pass phrase pipe '%s'",
-                            sc->server->pphrase_dialog_path);
+                    ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                                 "Init: Failed to create pass phrase pipe '%s'",
+                                 sc->server->pphrase_dialog_path);
                     PEMerr(PEM_F_DEF_CALLBACK,PEM_R_PROBLEMS_GETTING_PASSWORD);
                     memset(buf, 0, (unsigned int)bufsize);
                     return (-1);
                 }
             }
-            ssl_log(s, SSL_LOG_INFO,
-                    "Init: Requesting pass phrase via piped dialog");
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                         "Init: Requesting pass phrase via piped dialog");
         }
         else { /* sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN */ 
 #ifdef WIN32
             PEMerr(PEM_F_DEF_CALLBACK,PEM_R_PROBLEMS_GETTING_PASSWORD);
             memset(buf, 0, (unsigned int)bufsize);
             return (-1);
@@ -701,14 +723,15 @@
              * rather than attempting to temporarily rehook it to the terminal,
              * we print the prompt to stdout before EVP_read_pw_string turns
              * off tty echo
              */
             apr_file_open_stdout(&writetty, p);
 
-            ssl_log(s, SSL_LOG_INFO,
-                    "Init: Requesting pass phrase via builtin terminal dialog");
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                         "Init: Requesting pass phrase via builtin terminal "
+                         "dialog");
 #endif
         }
 
         /*
          * The first time display a header to inform the user about what
          * program he actually speaks to, which module is responsible for
@@ -729,15 +752,15 @@
 
         /*
          * Emulate the OpenSSL internal pass phrase dialog
          * (see crypto/pem/pem_lib.c:def_callback() for details)
          */
         prompt = "Enter pass phrase:";
-        apr_file_puts(prompt, writetty);
 
         for (;;) {
+            apr_file_puts(prompt, writetty);
             if (sc->server->pphrase_dialog_type == SSL_PPTYPE_PIPE) {
                 i = pipe_get_passwd_cb(buf, bufsize, "", FALSE); 
             }  
             else { /* sc->server->pphrase_dialog_type == SSL_PPTYPE_BUILTIN */
                 i = EVP_read_pw_string(buf, bufsize, "", FALSE); 
             }  
@@ -759,15 +782,15 @@
      */
     else if (sc->server->pphrase_dialog_type == SSL_PPTYPE_FILTER) {
         const char *cmd = sc->server->pphrase_dialog_path;
         const char **argv = apr_palloc(p, sizeof(char *) * 4);
         char *result;
 
-        ssl_log(s, SSL_LOG_INFO,
-                "Init: Requesting pass phrase from dialog filter program (%s)",
-                cmd);
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "Init: Requesting pass phrase from dialog filter "
+                     "program (%s)", cmd);
 
         argv[0] = cmd;
         argv[1] = cpVHostID;
         argv[2] = cpAlgoType;
         argv[3] = NULL;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_rand.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_rand.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_rand.c	2002-03-27 11:33:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_rand.c	2002-05-17 19:24:17.000000000 +0800
@@ -154,16 +154,18 @@
                 RAND_seed(stackdata+n, 128);
                 nDone += 128;
 
             }
         }
     }
-    ssl_log(s, SSL_LOG_INFO, "%sSeeding PRNG with %d bytes of entropy", prefix, nDone);
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "%sSeeding PRNG with %d bytes of entropy", prefix, nDone);
 
     if (RAND_status() == 0)
-        ssl_log(s, SSL_LOG_WARN, "%sPRNG still contains not sufficient entropy!", prefix);
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                     "%sPRNG still contains not sufficient entropy!", prefix);
 
     return nDone;
 }
 
 #define BUFSIZE 8192
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_vars.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_vars.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_engine_vars.c	2002-04-18 16:45:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_engine_vars.c	2002-05-29 05:47:31.000000000 +0800
@@ -90,14 +90,13 @@
 char *ssl_var_lookup(apr_pool_t *p, server_rec *s, conn_rec *c, request_rec *r, char *var)
 {
     SSLConnRec *sslconn;
     SSLModConfigRec *mc = myModConfig(s);
     char *result;
     BOOL resdup;
-    time_t tc;
-    struct tm *tm;
+    apr_time_exp_t tm;
 
     result = NULL;
     resdup = TRUE;
 
     /*
      * When no pool is given try to find one
@@ -197,22 +196,20 @@
             result = (char *)ap_get_server_version();
         else if (strcEQ(var, "API_VERSION")) {
             result = apr_psprintf(p, "%d", MODULE_MAGIC_NUMBER);
             resdup = FALSE;
         }
         else if (strcEQ(var, "TIME_YEAR")) {
-            tc = time(NULL);
-            tm = localtime(&tc);
+            apr_time_exp_lt(&tm, apr_time_now());
             result = apr_psprintf(p, "%02d%02d",
-                                 (tm->tm_year / 100) + 19, tm->tm_year % 100);
+                                 (tm.tm_year / 100) + 19, tm.tm_year % 100);
             resdup = FALSE;
         }
 #define MKTIMESTR(format, tmfield) \
-            tc = time(NULL); \
-            tm = localtime(&tc); \
-            result = apr_psprintf(p, format, tm->tmfield); \
+            apr_time_exp_lt(&tm, apr_time_now()); \
+            result = apr_psprintf(p, format, tm.tmfield); \
             resdup = FALSE;
         else if (strcEQ(var, "TIME_MON")) {
             MKTIMESTR("%02d", tm_mon+1)
         }
         else if (strcEQ(var, "TIME_DAY")) {
             MKTIMESTR("%02d", tm_mday)
@@ -227,18 +224,17 @@
             MKTIMESTR("%02d", tm_sec)
         }
         else if (strcEQ(var, "TIME_WDAY")) {
             MKTIMESTR("%d", tm_wday)
         }
         else if (strcEQ(var, "TIME")) {
-            tc = time(NULL);
-            tm = localtime(&tc);
+            apr_time_exp_lt(&tm, apr_time_now());
             result = apr_psprintf(p,
-                        "%02d%02d%02d%02d%02d%02d%02d", (tm->tm_year / 100) + 19,
-                        (tm->tm_year % 100), tm->tm_mon+1, tm->tm_mday,
-                        tm->tm_hour, tm->tm_min, tm->tm_sec);
+                        "%02d%02d%02d%02d%02d%02d%02d", (tm.tm_year / 100) + 19,
+                        (tm.tm_year % 100), tm.tm_mon+1, tm.tm_mday,
+                        tm.tm_hour, tm.tm_min, tm.tm_sec);
             resdup = FALSE;
         }
         /* all other env-variables from the parent Apache process */
         else if (strlen(var) > 4 && strcEQn(var, "ENV:", 4)) {
             result = (char *)apr_table_get(r->notes, var+4);
             if (result == NULL)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_expr_parse.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_expr_parse.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_expr_parse.c	2002-04-13 01:46:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_expr_parse.c	2002-05-10 11:55:41.000000000 +0800
@@ -234,13 +234,13 @@
 #endif
 #else /* not MSDOS, or __TURBOC__ */
 #if defined(_AIX)
 /* I don't know what this was needed for, but it pollutes the namespace.
    So I turned it off.   rms, 2 May 1997.  */
 /* #include <malloc.h>  */
- #pragma alloca
+#pragma alloca
 #define YYSTACK_USE_ALLOCA
 #else /* not MSDOS, or __TURBOC__, or _AIX */
 #if 0
 #ifdef __hpux /* haible@ilog.fr says this works for HPUX 9.05 and up,
 		 and on HPUX 10.  Eventually we can turn this on.  */
 #define YYSTACK_USE_ALLOCA
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_expr_scan.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_expr_scan.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_expr_scan.c	2002-04-13 01:46:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_expr_scan.c	2002-05-10 11:55:41.000000000 +0800
@@ -15,13 +15,13 @@
 #define yyrestart ssl_expr_yyrestart
 #define yytext ssl_expr_yytext
 
 /* A lexical scanner generated by flex */
 
 /* Scanner skeleton version:
- * $Header: /home/cvs/httpd-2.0/modules/ssl/ssl_expr_scan.c,v 1.9 2002/04/12 17:46:09 jwoolley Exp $
+ * $Header: /home/cvs/httpd-2.0/modules/ssl/ssl_expr_scan.c,v 1.10 2002/05/10 03:55:41 wrowe Exp $
  */
 
 #define FLEX_SCANNER
 #define YY_FLEX_MAJOR_VERSION 2
 #define YY_FLEX_MINOR_VERSION 5
 
@@ -55,14 +55,14 @@
 #define YY_USE_CONST
 
 #endif	/* __STDC__ */
 #endif	/* ! __cplusplus */
 
 #ifdef __TURBOC__
- #pragma warn -rch
- #pragma warn -use
+#pragma warn -rch
+#pragma warn -use
 #include <io.h>
 #include <stdlib.h>
 #define YY_USE_CONST
 #define YY_USE_PROTOS
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache.c	2002-03-28 07:25:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache.c	2002-05-26 04:10:55.000000000 +0800
@@ -75,15 +75,15 @@
 
     /*
      * Warn the user that he should use the session cache.
      * But we can operate without it, of course.
      */
     if (mc->nSessionCacheMode == SSL_SCMODE_UNSET) {
-        ssl_log(s, SSL_LOG_WARN,
-                "Init: Session Cache is not configured "
-                "[hint: SSLSessionCache]");
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
+                     "Init: Session Cache is not configured "
+                     "[hint: SSLSessionCache]");
         mc->nSessionCacheMode = SSL_SCMODE_NONE;
         return;
     }
 
     if (mc->nSessionCacheMode == SSL_SCMODE_DBM)
         ssl_scache_dbm_init(s, p);
@@ -91,14 +91,14 @@
              (mc->nSessionCacheMode == SSL_SCMODE_SHMCB)) {
         void *data;
         const char *userdata_key = "ssl_scache_init";
 
         apr_pool_userdata_get(&data, userdata_key, s->process->pool);
         if (!data) {
-            apr_pool_userdata_setn((const void *)1, userdata_key,
-                                   apr_pool_cleanup_null, s->process->pool);
+            apr_pool_userdata_set((const void *)1, userdata_key,
+                                  apr_pool_cleanup_null, s->process->pool);
             return;
         }
         if (mc->nSessionCacheMode == SSL_SCMODE_SHMHT)
             ssl_scache_shmht_init(s, p);
         else if (mc->nSessionCacheMode == SSL_SCMODE_SHMCB)
             ssl_scache_shmcb_init(s, p);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_dbm.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_dbm.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_dbm.c	2002-03-29 01:11:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_dbm.c	2002-05-17 19:24:17.000000000 +0800
@@ -60,26 +60,28 @@
 #include "mod_ssl.h"
 
 void ssl_scache_dbm_init(server_rec *s, apr_pool_t *p)
 {
     SSLModConfigRec *mc = myModConfig(s);
     apr_dbm_t *dbm;
+    apr_status_t rv;
 
     /* for the DBM we need the data file */
     if (mc->szSessionCacheDataFile == NULL) {
-        ssl_log(s, SSL_LOG_ERROR, "SSLSessionCache required");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "SSLSessionCache required");
         ssl_die();
     }
 
     /* open it once to create it and to make sure it _can_ be created */
     ssl_mutex_on(s);
-    if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot create SSLSessionCache DBM file `%s'",
-                mc->szSessionCacheDataFile);
+    if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
+	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot create SSLSessionCache DBM file `%s'",
+                     mc->szSessionCacheDataFile);
         ssl_mutex_off(s);
         return;
     }
     apr_dbm_close(dbm);
 
 #if !defined(OS2) && !defined(WIN32) && !defined(BEOS) && !defined(NETWARE)
@@ -137,12 +139,13 @@
     apr_dbm_t *dbm;
     apr_datum_t dbmkey;
     apr_datum_t dbmval;
     UCHAR ucaData[SSL_SESSION_MAX_DER];
     int nData;
     UCHAR *ucp;
+    apr_status_t rv;
 
     /* streamline session data */
     if ((nData = i2d_SSL_SESSION(sess, NULL)) > sizeof(ucaData))
         return FALSE;
     ucp = ucaData;
     i2d_SSL_SESSION(sess, &ucp);
@@ -167,25 +170,26 @@
         return FALSE;
     memcpy((char *)dbmval.dptr, &expiry, sizeof(time_t));
     memcpy((char *)dbmval.dptr+sizeof(time_t), ucaData, nData);
 
     /* and store it to the DBM file */
     ssl_mutex_on(s);
-    if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot open SSLSessionCache DBM file `%s' for writing (store)",
-                mc->szSessionCacheDataFile);
+    if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
+	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot open SSLSessionCache DBM file `%s' for writing "
+                     "(store)",
+                     mc->szSessionCacheDataFile);
         ssl_mutex_off(s);
         free(dbmval.dptr);
         return FALSE;
     }
-    if (apr_dbm_store(dbm, dbmkey, dbmval) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot store SSL session to DBM file `%s'",
-                mc->szSessionCacheDataFile);
+    if ((rv = apr_dbm_store(dbm, dbmkey, dbmval)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot store SSL session to DBM file `%s'",
+                     mc->szSessionCacheDataFile);
         apr_dbm_close(dbm);
         ssl_mutex_off(s);
         free(dbmval.dptr);
         return FALSE;
     }
     apr_dbm_close(dbm);
@@ -221,17 +225,18 @@
     dbmkey.dsize = idlen;
 
     /* and fetch it from the DBM file 
      * XXX: Should we open the dbm against r->pool so the cleanup will
      * do the apr_dbm_close? This would make the code a bit cleaner.
      */
-    if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot open SSLSessionCache DBM file `%s' for reading (fetch)",
-                mc->szSessionCacheDataFile);
+    if ((rc = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
+	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rc, s,
+                     "Cannot open SSLSessionCache DBM file `%s' for reading "
+                     "(fetch)",
+                     mc->szSessionCacheDataFile);
         return NULL;
     }
     rc = apr_dbm_fetch(dbm, dbmkey, &dbmval);
     if (rc != APR_SUCCESS) {
         apr_dbm_close(dbm);
         return NULL;
@@ -268,24 +273,26 @@
 
 void ssl_scache_dbm_remove(server_rec *s, UCHAR *id, int idlen)
 {
     SSLModConfigRec *mc = myModConfig(s);
     apr_dbm_t *dbm;
     apr_datum_t dbmkey;
+    apr_status_t rv;
 
     /* create DBM key and values */
     dbmkey.dptr  = (char *)id;
     dbmkey.dsize = idlen;
 
     /* and delete it from the DBM file */
     ssl_mutex_on(s);
-    if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot open SSLSessionCache DBM file `%s' for writing (delete)",
-                mc->szSessionCacheDataFile);
+    if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
+	    APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot open SSLSessionCache DBM file `%s' for writing "
+                     "(delete)",
+                     mc->szSessionCacheDataFile);
         ssl_mutex_off(s);
         return;
     }
     apr_dbm_delete(dbm, dbmkey);
     apr_dbm_close(dbm);
     ssl_mutex_off(s);
@@ -307,12 +314,13 @@
     int nDeleted = 0;
     int bDelete;
     apr_datum_t *keylist;
     int keyidx;
     int i;
     time_t tNow;
+    apr_status_t rv;
 
     /*
      * make sure the expiration for still not-accessed session
      * cache entries is done only from time to time
      */
     tNow = time(NULL);
@@ -343,17 +351,19 @@
             apr_pool_destroy(p);
             break;
         }
 
         /* pass 1: scan DBM database */
         keyidx = 0;
-        if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-		APR_DBM_RWCREATE,SSL_DBM_FILE_MODE, p) != APR_SUCCESS) {
-            ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                    "Cannot open SSLSessionCache DBM file `%s' for scanning",
-                    mc->szSessionCacheDataFile);
+        if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile, 
+                               APR_DBM_RWCREATE,SSL_DBM_FILE_MODE,
+                               p)) != APR_SUCCESS) {
+            ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                         "Cannot open SSLSessionCache DBM file `%s' for "
+                         "scanning",
+                         mc->szSessionCacheDataFile);
             apr_pool_destroy(p);
             break;
         }
         apr_dbm_firstkey(dbm, &dbmkey);
         while (dbmkey.dptr != NULL) {
             nElements++;
@@ -379,15 +389,16 @@
         }
         apr_dbm_close(dbm);
 
         /* pass 2: delete expired elements */
         if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
 		APR_DBM_RWCREATE,SSL_DBM_FILE_MODE, p) != APR_SUCCESS) {
-            ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                    "Cannot re-open SSLSessionCache DBM file `%s' for expiring",
-                    mc->szSessionCacheDataFile);
+            ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                         "Cannot re-open SSLSessionCache DBM file `%s' for "
+                         "expiring",
+                         mc->szSessionCacheDataFile);
             apr_pool_destroy(p);
             break;
         }
         for (i = 0; i < keyidx; i++) {
             apr_dbm_delete(dbm, keylist[i]);
             nDeleted++;
@@ -399,38 +410,43 @@
 
         if (keyidx < KEYMAX)
             break;
     }
     ssl_mutex_off(s);
 
-    ssl_log(s, SSL_LOG_TRACE, "Inter-Process Session Cache (DBM) Expiry: "
-            "old: %d, new: %d, removed: %d", nElements, nElements-nDeleted, nDeleted);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Inter-Process Session Cache (DBM) Expiry: "
+                 "old: %d, new: %d, removed: %d",
+                 nElements, nElements-nDeleted, nDeleted);
     return;
 }
 
 void ssl_scache_dbm_status(server_rec *s, apr_pool_t *p, void (*func)(char *, void *), void *arg)
 {
     SSLModConfigRec *mc = myModConfig(s);
     apr_dbm_t *dbm;
     apr_datum_t dbmkey;
     apr_datum_t dbmval;
     int nElem;
     int nSize;
     int nAverage;
+    apr_status_t rv;
 
     nElem = 0;
     nSize = 0;
     ssl_mutex_on(s);
     /*
      * XXX - Check what pool is to be used - TBD
      */
-    if (apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
-	                 APR_DBM_RWCREATE, SSL_DBM_FILE_MODE, mc->pPool) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR|SSL_ADD_ERRNO,
-                "Cannot open SSLSessionCache DBM file `%s' for status retrival",
-                mc->szSessionCacheDataFile);
+    if ((rv = apr_dbm_open(&dbm, mc->szSessionCacheDataFile,
+	                       APR_DBM_RWCREATE, SSL_DBM_FILE_MODE,
+                           mc->pPool)) != APR_SUCCESS) {
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot open SSLSessionCache DBM file `%s' for status "
+                     "retrival",
+                     mc->szSessionCacheDataFile);
         ssl_mutex_off(s);
         return;
     }
     /*
      * XXX - Check the return value of apr_dbm_firstkey, apr_dbm_fetch - TBD
      */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_shmcb.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_shmcb.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_shmcb.c	2002-04-30 14:48:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_shmcb.c	2002-06-07 02:27:42.000000000 +0800
@@ -58,14 +58,14 @@
  */
 
 #include "mod_ssl.h"
 
 /* 
  * This shared memory based SSL session cache implementation was
- * originally written by Geoff Thorpe <geoff@eu.c2.net> for C2Net Europe
- * and as a contribution to Ralf Engelschall's mod_ssl project.
+ * originally written by Geoff Thorpe <geoff@geoffthorpe.net> for C2Net
+ * Europe as a contribution to Ralf Engelschall's mod_ssl project.
  */
 
 /*
  * The shared-memory segment header can be cast to and from the
  * SHMCBHeader type, all other structures need to be initialised by
  * utility functions.
@@ -365,37 +365,40 @@
     apr_status_t rv;
 
     /*
      * Create shared memory segment
      */
     if (mc->szSessionCacheDataFile == NULL) {
-        ssl_log(s, SSL_LOG_ERROR, "SSLSessionCache required");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "SSLSessionCache required");
         ssl_die();
     }
 
     if ((rv = apr_shm_create(&(mc->pSessionCacheDataMM), 
                              mc->nSessionCacheDataSize, 
                              mc->szSessionCacheDataFile,
                              mc->pPool)) != APR_SUCCESS) {
         char buf[100];
-        ssl_log(s, SSL_LOG_ERROR,
-                "Cannot allocate shared memory: (%d)%s", rv,
-                apr_strerror(rv, buf, sizeof(buf)));
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Cannot allocate shared memory: (%d)%s", rv,
+                     apr_strerror(rv, buf, sizeof(buf)));
         ssl_die();
     }
     shm_segment = apr_shm_baseaddr_get(mc->pSessionCacheDataMM);
     shm_segsize = apr_shm_size_get(mc->pSessionCacheDataMM);
 
-    ssl_log(s, SSL_LOG_TRACE, "shmcb_init allocated %u bytes of shared "
-            "memory", shm_segsize);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "shmcb_init allocated %u bytes of shared memory",
+                 shm_segsize);
     if (!shmcb_init_memory(s, shm_segment, shm_segsize)) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Failure initialising 'shmcb' shared memory");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Failure initialising 'shmcb' shared memory");
         ssl_die();
     }
-    ssl_log(s, SSL_LOG_INFO, "Shared memory session cache initialised");
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                 "Shared memory session cache initialised");
 
     /* 
      * Success ... we hack the memory block into place by cheating for
      * now and stealing a member variable the original shared memory
      * cache was using. :-)
      */
@@ -423,16 +426,18 @@
 
     /* We've kludged our pointer into the other cache's member variable. */
     shm_segment = (void *) mc->tSessionCacheDataTable;
     ssl_mutex_on(s);
     if (!shmcb_store_session(s, shm_segment, id, idlen, pSession, timeout))
         /* in this cache engine, "stores" should never fail. */
-        ssl_log(s, SSL_LOG_ERROR, "'shmcb' code was unable to store a "
-                "session in the cache.");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "'shmcb' code was unable to store a "
+                     "session in the cache.");
     else {
-        ssl_log(s, SSL_LOG_TRACE, "shmcb_store successful");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "shmcb_store successful");
         to_return = TRUE;
     }
     ssl_mutex_off(s);
     return to_return;
 }
 
@@ -445,17 +450,20 @@
     /* We've kludged our pointer into the other cache's member variable. */
     shm_segment = (void *) mc->tSessionCacheDataTable;
     ssl_mutex_on(s);
     pSession = shmcb_retrieve_session(s, shm_segment, id, idlen);
     ssl_mutex_off(s);
     if (pSession)
-        ssl_log(s, SSL_LOG_TRACE, "shmcb_retrieve had a hit");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "shmcb_retrieve had a hit");
     else {
-        ssl_log(s, SSL_LOG_TRACE, "shmcb_retrieve had a miss");
-        ssl_log(s, SSL_LOG_INFO, "Client requested a 'session-resume' but "
-                "we have no such session.");
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "shmcb_retrieve had a miss");
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, s,
+                     "Client requested a 'session-resume' but "
+                     "we have no such session.");
     }
     return pSession;
 }
 
 void ssl_scache_shmcb_remove(server_rec *s, UCHAR *id, int idlen)
 {
@@ -486,13 +494,14 @@
     void *shm_segment;
     unsigned int loop, total, cache_total, non_empty_divisions;
     int index_pct, cache_pct;
     double expiry_total;
     time_t average_expiry, now, max_expiry, min_expiry, idxexpiry;
 
-    ssl_log(s, SSL_LOG_TRACE, "inside ssl_scache_shmcb_status");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s, 
+                 "inside ssl_scache_shmcb_status");
 
     /* We've kludged our pointer into the other cache's member variable. */
     shm_segment = (void *) mc->tSessionCacheDataTable;
 
     /* Get the header structure. */
     shmcb_get_header(shm_segment, &header);
@@ -556,13 +565,14 @@
     func(apr_psprintf(p, "total retrieves since starting: <b>%lu</b> hit, "
                      "<b>%lu</b> miss<br>", header->num_retrieves_hit,
                      header->num_retrieves_miss), arg);
     func(apr_psprintf(p, "total removes since starting: <b>%lu</b> hit, "
                      "<b>%lu</b> miss<br>", header->num_removes_hit,
                      header->num_removes_miss), arg);
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_status");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s, 
+                 "leaving shmcb_status");
     return;
 }
 
 /*
 **
 ** Memory manipulation and low-level cache operations 
@@ -575,34 +585,37 @@
 {
     SHMCBHeader *header;
     SHMCBQueue queue;
     SHMCBCache cache;
     unsigned int temp, loop, granularity;
 
-    ssl_log(s, SSL_LOG_TRACE, "entered shmcb_init_memory()");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s, 
+                 "entered shmcb_init_memory()");
 
     /* Calculate some sizes... */
     temp = sizeof(SHMCBHeader);
 
     /* If the segment is ridiculously too small, bail out */
     if (shm_mem_size < (2*temp)) {
-        ssl_log(s, SSL_LOG_ERROR, "shared memory segment too small");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shared memory segment too small");
         return FALSE;
     }
 
     /* Make temp the amount of memory without the header */
     temp = shm_mem_size - temp;
 
     /* Work on the basis that you need 10 bytes index for each session
      * (approx 150 bytes), which is to divide temp by 160 - and then
      * make sure we err on having too index space to burn even when
      * the cache is full, which is a lot less stupid than having
      * having not enough index space to utilise the whole cache!. */
     temp /= 120;
-    ssl_log(s, SSL_LOG_TRACE, "for %u bytes, recommending %u indexes",
-            shm_mem_size, temp);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "for %u bytes, recommending %u indexes",
+                 shm_mem_size, temp);
 
     /* We should divide these indexes evenly amongst the queues. Try
      * to get it so that there are roughly half the number of divisions
      * as there are indexes in each division. */
     granularity = 256;
     while ((temp / granularity) < (2 * granularity))
@@ -611,13 +624,14 @@
     /* So we have 'granularity' divisions, set 'temp' equal to the
      * number of indexes in each division. */
     temp /= granularity;
 
     /* Too small? Bail ... */
     if (temp < 5) {
-        ssl_log(s, SSL_LOG_ERROR, "shared memory segment too small");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shared memory segment too small");
         return FALSE;
     }
 
     /* OK, we're sorted - from here on in, the return should be TRUE */
     header = (SHMCBHeader *)shm_mem;
     header->division_mask = (unsigned char)(granularity - 1);
@@ -636,34 +650,45 @@
     temp -= header->queue_size;
     header->cache_data_offset = (2 * sizeof(unsigned int));
     header->cache_data_size = header->division_size -
                               header->queue_size - header->cache_data_offset;
 
     /* Output trace info */
-    ssl_log(s, SSL_LOG_TRACE, "shmcb_init_memory choices follow");
-    ssl_log(s, SSL_LOG_TRACE, "division_mask = 0x%02X", header->division_mask);
-    ssl_log(s, SSL_LOG_TRACE, "division_offset = %u", header->division_offset);
-    ssl_log(s, SSL_LOG_TRACE, "division_size = %u", header->division_size);
-    ssl_log(s, SSL_LOG_TRACE, "queue_size = %u", header->queue_size);
-    ssl_log(s, SSL_LOG_TRACE, "index_num = %u", header->index_num);
-    ssl_log(s, SSL_LOG_TRACE, "index_offset = %u", header->index_offset);
-    ssl_log(s, SSL_LOG_TRACE, "index_size = %u", header->index_size);
-    ssl_log(s, SSL_LOG_TRACE, "cache_data_offset = %u", header->cache_data_offset);
-    ssl_log(s, SSL_LOG_TRACE, "cache_data_size = %u", header->cache_data_size);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "shmcb_init_memory choices follow");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "division_mask = 0x%02X", header->division_mask);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "division_offset = %u", header->division_offset);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "division_size = %u", header->division_size);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "queue_size = %u", header->queue_size);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "index_num = %u", header->index_num);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "index_offset = %u", header->index_offset);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "index_size = %u", header->index_size);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "cache_data_offset = %u", header->cache_data_offset);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                  "cache_data_size = %u", header->cache_data_size);
 
     /* The header is done, make the caches empty */
     for (loop = 0; loop < granularity; loop++) {
         if (!shmcb_get_division(header, &queue, &cache, loop))
-            ssl_log(s, SSL_LOG_ERROR, "shmcb_init_memory, " "internal error");
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, s, "shmcb_init_memory, " "internal error");
         shmcb_set_safe_uint(cache.first_pos, 0);
         shmcb_set_safe_uint(cache.pos_count, 0);
         shmcb_set_safe_uint(queue.first_pos, 0);
         shmcb_set_safe_uint(queue.pos_count, 0);
     }
 
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_init_memory()");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_init_memory()");
     return TRUE;
 }
 
 static BOOL shmcb_store_session(
     server_rec *s, void *shm_segment, UCHAR *id,
     int idlen, SSL_SESSION * pSession,
@@ -676,43 +701,48 @@
     unsigned char encoded[SSL_SESSION_MAX_DER];
     unsigned char *ptr_encoded;
     unsigned int len_encoded;
     time_t expiry_time;
     unsigned char *session_id = SSL_SESSION_get_session_id(pSession);
 
-    ssl_log(s, SSL_LOG_TRACE, "inside shmcb_store_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "inside shmcb_store_session");
 
     /* Get the header structure, which division this session will fall into etc. */
     shmcb_get_header(shm_segment, &header);
     masked_index = session_id[0] & header->division_mask;
-    ssl_log(s, SSL_LOG_TRACE, "session_id[0]=%u, masked index=%u",
-            session_id[0], masked_index);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "session_id[0]=%u, masked index=%u",
+                 session_id[0], masked_index);
     if (!shmcb_get_division(header, &queue, &cache, (unsigned int)masked_index)) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_store_session, " "internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shmcb_store_session internal error");
         return FALSE;
     }
 
     /* Serialise the session, work out how much we're dealing
      * with. NB: This check could be removed if we're not paranoid
      * or we find some assurance that it will never be necessary. */
     len_encoded = i2d_SSL_SESSION(pSession, NULL);
     if (len_encoded > SSL_SESSION_MAX_DER) {
-        ssl_log(s, SSL_LOG_ERROR, "session is too big (%u bytes)",
-                len_encoded);
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "session is too big (%u bytes)", len_encoded);
         return FALSE;
     }
     ptr_encoded = encoded;
     len_encoded = i2d_SSL_SESSION(pSession, &ptr_encoded);
     expiry_time = timeout;
     if (!shmcb_insert_encoded_session(s, &queue, &cache, encoded,
                                      len_encoded, session_id,
                                      expiry_time)) {
-        ssl_log(s, SSL_LOG_ERROR, "can't store a session!");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "can't store a session!");
         return FALSE;
     }
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_store successfully");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_store successfully");
     header->num_stores++;
     return TRUE;
 }
 
 static SSL_SESSION *shmcb_retrieve_session(
     server_rec *s, void *shm_segment,
@@ -721,39 +751,42 @@
     SHMCBHeader *header;
     SHMCBQueue queue;
     SHMCBCache cache;
     unsigned char masked_index;
     SSL_SESSION *pSession;
 
-    ssl_log(s, SSL_LOG_TRACE, "inside shmcb_retrieve_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "inside shmcb_retrieve_session");
     if (idlen < 2) {
-        ssl_log(s, SSL_LOG_ERROR, "unusably short session_id provided "
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s, "unusably short session_id provided "
                 "(%u bytes)", idlen);
         return FALSE;
     }
 
     /* Get the header structure, which division this session lookup
      * will come from etc. */
     shmcb_get_header(shm_segment, &header);
     masked_index = id[0] & header->division_mask;
-    ssl_log(s, SSL_LOG_TRACE, "id[0]=%u, masked index=%u", id[0],
-            masked_index);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "id[0]=%u, masked index=%u", id[0], masked_index);
     if (!shmcb_get_division(header, &queue, &cache, (unsigned int) masked_index)) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_retrieve_session, " "internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shmcb_retrieve_session internal error");
         header->num_retrieves_miss++;
         return FALSE;
     }
 
     /* Get the session corresponding to the session_id or NULL if it
      * doesn't exist (or is flagged as "removed"). */
     pSession = shmcb_lookup_session_id(s, &queue, &cache, id, idlen);
     if (pSession)
         header->num_retrieves_hit++;
     else
         header->num_retrieves_miss++;
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_retrieve_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_retrieve_session");
     return pSession;
 }
 
 static BOOL shmcb_remove_session(
     server_rec *s, void *shm_segment,
     UCHAR *id, int idlen)
@@ -761,35 +794,37 @@
     SHMCBHeader *header;
     SHMCBQueue queue;
     SHMCBCache cache;
     unsigned char masked_index;
     BOOL res;
 
-    ssl_log(s, SSL_LOG_TRACE, "inside shmcb_remove_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "inside shmcb_remove_session");
     if (id == NULL) {
-        ssl_log(s, SSL_LOG_ERROR, "remove called with NULL session_id!");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s, "remove called with NULL session_id!");
         return FALSE;
     }
 
     /* Get the header structure, which division this session remove
      * will happen in etc. */
     shmcb_get_header(shm_segment, &header);
     masked_index = id[0] & header->division_mask;
-    ssl_log(s, SSL_LOG_TRACE, "id[0]=%u, masked index=%u",
-            id[0], masked_index);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "id[0]=%u, masked index=%u", id[0], masked_index);
     if (!shmcb_get_division(header, &queue, &cache, (unsigned int)masked_index)) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_remove_session, internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s, "shmcb_remove_session, internal error");
         header->num_removes_miss++;
         return FALSE;
     }
     res = shmcb_remove_session_id(s, &queue, &cache, id, idlen);
     if (res)
         header->num_removes_hit++;
     else
         header->num_removes_miss++;
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_remove_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_remove_session");
     return res;
 }
 
 
 /* 
 **
@@ -971,13 +1006,14 @@
 {
     SHMCBIndex *idx;
     time_t now;
     unsigned int loop, index_num, pos_count, new_pos;
     SHMCBHeader *header;
 
-    ssl_log(s, SSL_LOG_TRACE, "entering shmcb_expire_division");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "entering shmcb_expire_division");
 
     /* We must calculate num and space ourselves based on expiry times. */
     now = time(NULL);
     loop = 0;
     new_pos = shmcb_get_safe_uint(queue->first_pos);
 
@@ -994,13 +1030,14 @@
         loop++;
         new_pos = shmcb_cyclic_increment(index_num, new_pos, 1);
     }
 
     /* Find the new_offset and make the expiries happen. */
     if (loop > 0) {
-        ssl_log(s, SSL_LOG_TRACE, "will be expiring %u sessions", loop);
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "will be expiring %u sessions", loop);
         /* We calculate the new_offset by "peeking" (or in the
          * case it's the last entry, "sneaking" ;-). */
         if (loop == pos_count) {
             /* We are expiring everything! This is easy to do... */
             shmcb_set_safe_uint(queue->pos_count, 0);
             shmcb_set_safe_uint(cache->pos_count, 0);
@@ -1018,14 +1055,15 @@
                                shmcb_get_safe_uint(cache->pos_count) -
                                shmcb_cyclic_space(header->cache_data_size,
                                                   shmcb_get_safe_uint(cache->first_pos),
                                                   shmcb_get_safe_uint(&(idx->offset))));
             shmcb_set_safe_uint(cache->first_pos, shmcb_get_safe_uint(&(idx->offset)));
         }
-        ssl_log(s, SSL_LOG_TRACE, "we now have %u sessions",
-                shmcb_get_safe_uint(queue->pos_count));
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "we now have %u sessions",
+                     shmcb_get_safe_uint(queue->pos_count));
     }
     header->num_expiries += loop;
     return loop;
 }
 
 /* Inserts a new encoded session into a queue/cache pair - expiring
@@ -1044,14 +1082,16 @@
 {
     SHMCBHeader *header;
     SHMCBIndex *idx = NULL;
     unsigned int gap, new_pos, loop, new_offset;
     int need;
 
-    ssl_log(s, SSL_LOG_TRACE, "entering shmcb_insert_encoded_session, "
-            "*queue->pos_count = %u", shmcb_get_safe_uint(queue->pos_count));
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "entering shmcb_insert_encoded_session, "
+                 "*queue->pos_count = %u",
+                 shmcb_get_safe_uint(queue->pos_count));
 
     /* If there's entries to expire, ditch them first thing. */
     shmcb_expire_division(s, queue, cache);
     header = cache->header;
     gap = header->cache_data_size - shmcb_get_safe_uint(cache->pos_count);
     if (gap < encoded_len) {
@@ -1065,47 +1105,50 @@
             need = (int) encoded_len - (int) gap -
                 shmcb_cyclic_space(header->cache_data_size,
                                    shmcb_get_safe_uint(cache->first_pos),
                                    shmcb_get_safe_uint(&(idx->offset)));
         }
         if (loop > 0) {
-            ssl_log(s, SSL_LOG_TRACE, "about to scroll %u sessions from %u",
-                    loop, shmcb_get_safe_uint(queue->pos_count));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "about to scroll %u sessions from %u",
+                         loop, shmcb_get_safe_uint(queue->pos_count));
             /* We are removing "loop" items from the cache. */
             shmcb_set_safe_uint(cache->pos_count,
                                 shmcb_get_safe_uint(cache->pos_count) -
                                 shmcb_cyclic_space(header->cache_data_size,
                                                    shmcb_get_safe_uint(cache->first_pos),
                                                    shmcb_get_safe_uint(&(idx->offset))));
             shmcb_set_safe_uint(cache->first_pos, shmcb_get_safe_uint(&(idx->offset)));
             shmcb_set_safe_uint(queue->pos_count, shmcb_get_safe_uint(queue->pos_count) - loop);
             shmcb_set_safe_uint(queue->first_pos, new_pos);
-            ssl_log(s, SSL_LOG_TRACE, "now only have %u sessions",
-                    shmcb_get_safe_uint(queue->pos_count));
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "now only have %u sessions",
+                         shmcb_get_safe_uint(queue->pos_count));
             /* Update the stats!!! */
             header->num_scrolled += loop;
         }
     }
 
     /* probably unecessary checks, but I'll leave them until this code
      * is verified. */
     if (shmcb_get_safe_uint(cache->pos_count) + encoded_len >
         header->cache_data_size) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_insert_encoded_session, "
-                "internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shmcb_insert_encoded_session internal error");
         return FALSE;
     }
     if (shmcb_get_safe_uint(queue->pos_count) == header->index_num) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_insert_encoded_session, "
-                "internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shmcb_insert_encoded_session internal error");
         return FALSE;
     }
-    ssl_log(s, SSL_LOG_TRACE, "we have %u bytes and %u indexes free - "
-            "enough", header->cache_data_size -
-            shmcb_get_safe_uint(cache->pos_count), header->index_num -
-            shmcb_get_safe_uint(queue->pos_count));
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "we have %u bytes and %u indexes free - enough",
+                 header->cache_data_size -
+                 shmcb_get_safe_uint(cache->pos_count), header->index_num -
+                 shmcb_get_safe_uint(queue->pos_count));
 
 
     /* HERE WE ASSUME THAT THE NEW SESSION SHOULD GO ON THE END! I'M NOT
      * CHECKING WHETHER IT SHOULD BE GENUINELY "INSERTED" SOMEWHERE.
      *
      * We either fix that, or find out at a "higher" (read "mod_ssl")
@@ -1124,40 +1167,44 @@
     shmcb_cyclic_ntoc_memcpy(header->cache_data_size, cache->data,
                             new_offset, encoded, encoded_len);
     /* Get the new index that this session is stored in. */
     new_pos = shmcb_cyclic_increment(header->index_num,
                                      shmcb_get_safe_uint(queue->first_pos),
                                      shmcb_get_safe_uint(queue->pos_count));
-    ssl_log(s, SSL_LOG_TRACE, "storing in index %u, at offset %u", new_pos,
-            new_offset);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "storing in index %u, at offset %u",
+                 new_pos, new_offset);
     idx = shmcb_get_index(queue, new_pos);
     if (idx == NULL) {
-        ssl_log(s, SSL_LOG_ERROR, "shmcb_insert_encoded_session, "
-                "internal error");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "shmcb_insert_encoded_session internal error");
         return FALSE;
     }
     shmcb_safe_clear(idx, sizeof(SHMCBIndex));
     shmcb_set_safe_time(&(idx->expires), expiry_time);
     shmcb_set_safe_uint(&(idx->offset), new_offset);
 
     /* idx->removed = (unsigned char)0; */ /* Not needed given the memset above. */
     idx->s_id2 = session_id[1];
-    ssl_log(s, SSL_LOG_TRACE, "session_id[0]=%u, idx->s_id2=%u",
-            session_id[0], session_id[1]);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "session_id[0]=%u, idx->s_id2=%u",
+                 session_id[0], session_id[1]);
 
     /* All that remains is to adjust the cache's and queue's "pos_count"s. */
     shmcb_set_safe_uint(cache->pos_count,
                        shmcb_get_safe_uint(cache->pos_count) + encoded_len);
     shmcb_set_safe_uint(queue->pos_count,
                        shmcb_get_safe_uint(queue->pos_count) + 1);
 
     /* And just for good debugging measure ... */
-    ssl_log(s, SSL_LOG_TRACE, "leaving now with %u bytes in the cache and "
-            "%u indexes", shmcb_get_safe_uint(cache->pos_count),
-            shmcb_get_safe_uint(queue->pos_count));
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_insert_encoded_session");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving now with %u bytes in the cache and %u indexes",
+                 shmcb_get_safe_uint(cache->pos_count),
+                 shmcb_get_safe_uint(queue->pos_count));
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_insert_encoded_session");
     return TRUE;
 }
 
 /* Performs a lookup into a queue/cache pair for a
  * session_id. If found, the session is deserialised
  * and returned, otherwise NULL. */
@@ -1171,25 +1218,28 @@
     SHMCBHeader *header;
     SSL_SESSION *pSession = NULL;
     unsigned int curr_pos, loop, count;
     unsigned char *ptr;
     time_t now;
 
-    ssl_log(s, SSL_LOG_TRACE, "entering shmcb_lookup_session_id");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "entering shmcb_lookup_session_id");
 
     /* If there are entries to expire, ditch them first thing. */
     shmcb_expire_division(s, queue, cache);
     now = time(NULL);
     curr_pos = shmcb_get_safe_uint(queue->first_pos);
     count = shmcb_get_safe_uint(queue->pos_count);
     header = queue->header;
     for (loop = 0; loop < count; loop++) {
-        ssl_log(s, SSL_LOG_TRACE, "loop=%u, count=%u, curr_pos=%u",
-                loop, count, curr_pos);
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "loop=%u, count=%u, curr_pos=%u",
+                     loop, count, curr_pos);
         idx = shmcb_get_index(queue, curr_pos);
-        ssl_log(s, SSL_LOG_TRACE, "idx->s_id2=%u, id[1]=%u, offset=%u",
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "idx->s_id2=%u, id[1]=%u, offset=%u",
                 idx->s_id2, id[1], shmcb_get_safe_uint(&(idx->offset)));
         /* Only look into the session further if;
          * (a) the second byte of the session_id matches,
          * (b) the "removed" flag isn't set,
          * (c) the session hasn't expired yet.
          * We do (c) like this so that it saves us having to
@@ -1199,40 +1249,44 @@
          * removal or disabling of forcibly killed sessions. */
         if ((idx->s_id2 == id[1]) && !idx->removed &&
             (shmcb_get_safe_time(&(idx->expires)) > now)) {
             unsigned int session_id_length;
             unsigned char *session_id;
 
-            ssl_log(s, SSL_LOG_TRACE, "at index %u, found possible "
-                    "session match", curr_pos);
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "at index %u, found possible session match",
+                         curr_pos);
             shmcb_cyclic_cton_memcpy(header->cache_data_size,
                                      tempasn, cache->data,
                                      shmcb_get_safe_uint(&(idx->offset)),
                                      SSL_SESSION_MAX_DER);
             ptr = tempasn;
             pSession = d2i_SSL_SESSION(NULL, &ptr, SSL_SESSION_MAX_DER);
             session_id_length = SSL_SESSION_get_session_id_length(pSession);
             session_id = SSL_SESSION_get_session_id(pSession);
 
             if (pSession == NULL) {
-                ssl_log(s, SSL_LOG_ERROR, "scach2_lookup_"
-                        "session_id, internal error");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                             "scach2_lookup_session_id internal error");
                 return NULL;
             }
             if ((session_id_length == idlen) &&
                 (memcmp(session_id, id, idlen) == 0)) {
-                ssl_log(s, SSL_LOG_TRACE, "a match!");
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                             "a match!");
                 return pSession;
             }
-            ssl_log(s, SSL_LOG_TRACE, "not a match");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "not a match");
             SSL_SESSION_free(pSession);
             pSession = NULL;
         }
         curr_pos = shmcb_cyclic_increment(header->index_num, curr_pos, 1);
     }
-    ssl_log(s, SSL_LOG_TRACE, "no matching sessions were found");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "no matching sessions were found");
     return NULL;
 }
 
 static BOOL shmcb_remove_session_id(
     server_rec *s, SHMCBQueue *queue,
     SHMCBCache *cache, UCHAR *id, unsigned int idlen)
@@ -1242,13 +1296,14 @@
     SHMCBIndex *idx;
     SHMCBHeader *header;
     unsigned int curr_pos, loop, count;
     unsigned char *ptr;
     BOOL to_return = FALSE;
 
-    ssl_log(s, SSL_LOG_TRACE, "entering shmcb_remove_session_id");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "entering shmcb_remove_session_id");
 
     /* If there's entries to expire, ditch them first thing. */
     /* shmcb_expire_division(s, queue, cache); */
 
     /* Regarding the above ... hmmm ... I know my expiry code is slightly
      * "faster" than all this remove stuff ... but if the higher level
@@ -1260,56 +1315,63 @@
      * routine expiry handling. So I've moved the expiry check to *after*
      * this general remove stuff. */
     curr_pos = shmcb_get_safe_uint(queue->first_pos);
     count = shmcb_get_safe_uint(queue->pos_count);
     header = cache->header;
     for (loop = 0; loop < count; loop++) {
-        ssl_log(s, SSL_LOG_TRACE, "loop=%u, count=%u, curr_pos=%u",
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "loop=%u, count=%u, curr_pos=%u",
                 loop, count, curr_pos);
         idx = shmcb_get_index(queue, curr_pos);
-        ssl_log(s, SSL_LOG_TRACE, "idx->s_id2=%u, id[1]=%u", idx->s_id2,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                     "idx->s_id2=%u, id[1]=%u", idx->s_id2,
                 id[1]);
         /* Only look into the session further if the second byte of the
          * session_id matches. */
         if (idx->s_id2 == id[1]) {
             unsigned int session_id_length;
             unsigned char *session_id;
 
-            ssl_log(s, SSL_LOG_TRACE, "at index %u, found possible "
-                    "session match", curr_pos);
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "at index %u, found possible "
+                         "session match", curr_pos);
             shmcb_cyclic_cton_memcpy(header->cache_data_size,
                                      tempasn, cache->data,
                                      shmcb_get_safe_uint(&(idx->offset)),
                                      SSL_SESSION_MAX_DER);
             ptr = tempasn;
             pSession = d2i_SSL_SESSION(NULL, &ptr, SSL_SESSION_MAX_DER);
             if (pSession == NULL) {
-                ssl_log(s, SSL_LOG_ERROR, "shmcb_remove_session_id, "
-                        "internal error");
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                             "shmcb_remove_session_id, internal error");
                 goto end;
             }
             session_id_length = SSL_SESSION_get_session_id_length(pSession);
             session_id = SSL_SESSION_get_session_id(pSession);
 
             if ((session_id_length == idlen) 
                  && (memcmp(id, session_id, idlen) == 0)) {
-                ssl_log(s, SSL_LOG_TRACE, "a match!");
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                            "a match!");
                 /* Scrub out this session "quietly" */
                 idx->removed = (unsigned char) 1;
                 SSL_SESSION_free(pSession);
                 to_return = TRUE;
                 goto end;
             }
-            ssl_log(s, SSL_LOG_TRACE, "not a match");
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                         "not a match");
             SSL_SESSION_free(pSession);
             pSession = NULL;
         }
         curr_pos = shmcb_cyclic_increment(header->index_num, curr_pos, 1);
     }
-    ssl_log(s, SSL_LOG_TRACE, "no matching sessions were found");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "no matching sessions were found");
 
     /* If there's entries to expire, ditch them now. */
     shmcb_expire_division(s, queue, cache);
 end:
-    ssl_log(s, SSL_LOG_TRACE, "leaving shmcb_remove_session_id");
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "leaving shmcb_remove_session_id");
     return to_return;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_shmht.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_shmht.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_scache_shmht.c	2002-03-29 01:11:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_scache_shmht.c	2002-05-17 19:24:17.000000000 +0800
@@ -114,33 +114,35 @@
     apr_status_t rv;
 
     /*
      * Create shared memory segment
      */
     if (mc->szSessionCacheDataFile == NULL) {
-        ssl_log(s, SSL_LOG_ERROR, "SSLSessionCache required");
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "SSLSessionCache required");
         ssl_die();
     }
 
     if ((rv = apr_shm_create(&(mc->pSessionCacheDataMM), 
                    mc->nSessionCacheDataSize, 
                    mc->szSessionCacheDataFile, mc->pPool)) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Cannot allocate shared memory: %d", rv);
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot allocate shared memory");
         ssl_die();
     }
 
     if ((rv = apr_rmm_init(&(mc->pSessionCacheDataRMM), NULL,
                    apr_shm_baseaddr_get(mc->pSessionCacheDataMM),
                    mc->nSessionCacheDataSize, mc->pPool)) != APR_SUCCESS) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Cannot initialize rmm: %d", rv);
+        ap_log_error(APLOG_MARK, APLOG_ERR, rv, s,
+                     "Cannot initialize rmm");
         ssl_die();
     }
-ssl_log(s, SSL_LOG_ERROR, "initialize MM %ld RMM %ld",
-        mc->pSessionCacheDataMM, mc->pSessionCacheDataRMM);
+    ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                 "initialize MM %p RMM %p",
+                 mc->pSessionCacheDataMM, mc->pSessionCacheDataRMM);
 
     /*
      * Create hash table in shared memory segment
      */
     avail = mc->nSessionCacheDataSize;
     n = (avail/2) / 1024;
@@ -152,29 +154,30 @@
      */ 
     if ((ta = table_alloc(n, &ta_errno, 
                           ssl_scache_shmht_malloc,  
                           ssl_scache_shmht_calloc, 
                           ssl_scache_shmht_realloc, 
                           ssl_scache_shmht_free, s )) == NULL) {
-        ssl_log(s, SSL_LOG_ERROR,
-                "Cannot allocate hash table in shared memory: %s",
-                table_strerror(ta_errno));
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, s,
+                     "Cannot allocate hash table in shared memory: %s",
+                     table_strerror(ta_errno));
         ssl_die();
     }
 
     table_attr(ta, TABLE_FLAG_AUTO_ADJUST|TABLE_FLAG_ADJUST_DOWN);
     table_set_data_alignment(ta, sizeof(char *));
     table_clear(ta);
     mc->tSessionCacheDataTable = ta;
 
     /*
      * Log the done work
      */
-    ssl_log(s, SSL_LOG_INFO, 
-            "Init: Created hash-table (%d buckets) "
-            "in shared memory (%d bytes) for SSL session cache", n, avail);
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, s, 
+                 "Init: Created hash-table (%d buckets) "
+                 "in shared memory (%d bytes) for SSL session cache",
+                 n, avail);
     return;
 }
 
 void ssl_scache_shmht_kill(server_rec *s)
 {
     SSLModConfigRec *mc = myModConfig(s);
@@ -334,15 +337,16 @@
                 nDeleted++;
             }
         } while (rc == TABLE_ERROR_NONE); 
         /* (vpKeyThis != vpKey) && (nKeyThis != nKey) */
     }
     ssl_mutex_off(s);
-    ssl_log(s, SSL_LOG_TRACE, "Inter-Process Session Cache (SHMHT) Expiry: "
-            "old: %d, new: %d, removed: %d",
-            nElements, nElements-nDeleted, nDeleted);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, s,
+                 "Inter-Process Session Cache (SHMHT) Expiry: "
+                 "old: %d, new: %d, removed: %d",
+                 nElements, nElements-nDeleted, nDeleted);
     return;
 }
 
 void ssl_scache_shmht_status(server_rec *s, apr_pool_t *p, void (*func)(char *, void *), void *arg)
 {
     SSLModConfigRec *mc = myModConfig(s);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/ssl/ssl_util.c	2002-03-29 01:11:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/ssl/ssl_util.c	2002-06-04 10:19:33.000000000 +0800
@@ -397,78 +397,67 @@
 #if APR_HAS_THREADS
 /*
  * To ensure thread-safetyness in OpenSSL - work in progress
  */
 
 static apr_thread_mutex_t **lock_cs;
-/* FIXME: CRYPTO_NUM_LOCKS may vary between releases - replace with
-   CRYPT_num_locks() [Ben, Jan 2002] */
-static long                 lock_count[CRYPTO_NUM_LOCKS];
+static int                  lock_num_locks;
 
 static void ssl_util_thr_lock(int mode, int type,
-                              MODSSL_CRYPTO_CB_ARG_TYPE *file,
-                              int line)
+                              const char *file, int line)
 {
-    if (mode & CRYPTO_LOCK) {
-        apr_thread_mutex_lock(lock_cs[type]);
-        lock_count[type]++;
-    }
-    else {
-        apr_thread_mutex_unlock(lock_cs[type]);
+    if (type < lock_num_locks) {
+        if (mode & CRYPTO_LOCK) {
+            apr_thread_mutex_lock(lock_cs[type]);
+        }
+        else {
+            apr_thread_mutex_unlock(lock_cs[type]);
+        }
     }
 }
 
 static unsigned long ssl_util_thr_id(void)
 {
+    /* OpenSSL needs this to return an unsigned long.  On OS/390, the pthread 
+     * id is a structure twice that big.  Use the TCB pointer instead as a 
+     * unique unsigned long.
+     */
+#ifdef __MVS__
+    struct PSA {
+        char unmapped[540];
+        unsigned long PSATOLD;
+    } *psaptr = 0;
+
+    return psaptr->PSATOLD;
+#else
     return (unsigned long) apr_os_thread_current();
+#endif
 }
 
 static apr_status_t ssl_util_thread_cleanup(void *data)
 {
-    int i;
-
     CRYPTO_set_locking_callback(NULL);
 
-    for (i = 0; i < CRYPTO_NUM_LOCKS; i++) {
-        apr_thread_mutex_destroy(lock_cs[i]);
-    }
-
+    /* Let the registered mutex cleanups do their own thing 
+     */
     return APR_SUCCESS;
 }
 
-void ssl_util_thread_setup(server_rec *s, apr_pool_t *p)
+void ssl_util_thread_setup(apr_pool_t *p)
 {
-    int i, threaded_mpm;
-    /* This variable is not used? -aaron
-    SSLModConfigRec *mc = myModConfig(s);
-    */
-
-    ap_mpm_query(AP_MPMQ_IS_THREADED, &threaded_mpm);
-
-    if (!threaded_mpm) {
-        return;
-    }
+    int i;
 
-    lock_cs = apr_palloc(p, CRYPTO_NUM_LOCKS * sizeof(apr_thread_mutex_t *));
+    lock_num_locks = CRYPTO_num_locks();
+    lock_cs = apr_palloc(p, lock_num_locks * sizeof(*lock_cs));
 
-    /*
-     * XXX: CRYPTO_NUM_LOCKS == 28
-     * should determine if there are lock types we do not need
-     * for example: debug_malloc, debug_malloc2 (see crypto/cryptlib.c)
-     */
-    for (i = 0; i < CRYPTO_NUM_LOCKS; i++) {
-        lock_count[i] = 0;
-        /* XXX: Can we remove the lock_count now that apr_thread_mutex_t
-         * can support nested (aka recursive) locks? -aaron */
+    for (i = 0; i < lock_num_locks; i++) {
         apr_thread_mutex_create(&(lock_cs[i]), APR_THREAD_MUTEX_DEFAULT, p);
     }
 
     CRYPTO_set_id_callback(ssl_util_thr_id);
 
     CRYPTO_set_locking_callback(ssl_util_thr_lock);
 
-    apr_pool_cleanup_register(p, NULL,
-                              ssl_util_thread_cleanup,
-                              apr_pool_cleanup_null);
-
+    apr_pool_cleanup_register(p, NULL, ssl_util_thread_cleanup,
+                                       apr_pool_cleanup_null);
 }
 #endif
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/test: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/test: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/test/mod_bucketeer.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/test/mod_bucketeer.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/test/mod_bucketeer.c	2002-04-05 13:05:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/modules/test/mod_bucketeer.c	2002-06-01 04:52:28.000000000 +0800
@@ -64,13 +64,13 @@
 #include "http_log.h"
 #include "apr_strings.h"
 #include "apr_general.h"
 #include "util_filter.h"
 #include "apr_buckets.h"
 #include "http_request.h"
-
+#include "http_protocol.h"
 
 static const char bucketeerFilterName[] = "BUCKETEER";
 module AP_MODULE_DECLARE_DATA bucketeer_module;
 
 typedef struct bucketeer_filter_config_t
 {
@@ -83,19 +82,18 @@
 
 static void *create_bucketeer_server_config(apr_pool_t *p, server_rec *s)
 {
     bucketeer_filter_config_t *c = apr_pcalloc(p, sizeof *c);
 
     c->bucketdelimiter = 0x02; /* ^B */
-    c->passdelimiter = 0x10; /* ^P */
-    c->flushdelimiter = 0x06; /* ^F */
+    c->passdelimiter = 0x10;   /* ^P */
+    c->flushdelimiter = 0x06;  /* ^F */
 
     return c;
 }
 
-
 typedef struct bucketeer_ctx_t
 {
     apr_bucket_brigade *bb;
 } bucketeer_ctx_t;
 
 static apr_status_t bucketeer_out_filter(ap_filter_t *f,
@@ -96,27 +94,22 @@
 typedef struct bucketeer_ctx_t
 {
     apr_bucket_brigade *bb;
 } bucketeer_ctx_t;
 
 static apr_status_t bucketeer_out_filter(ap_filter_t *f,
-                                       apr_bucket_brigade *bb)
+                                         apr_bucket_brigade *bb)
 {
     apr_bucket *e;
     request_rec *r = f->r;
     bucketeer_ctx_t *ctx = f->ctx;
-   
-    bucketeer_filter_config_t *c = ap_get_module_config(r->server->module_config,
-                                                    &bucketeer_module);
-
-    /* If we don't have a context, we need to ensure that it is okay to send
-     * the deflated content.  If we have a context, that means we've done
-     * this before and we liked it.
-     * This could be not so nice if we always fail.  But, if we succeed,
-     * we're in better shape.
-     */
+    bucketeer_filter_config_t *c;
+
+    c = ap_get_module_config(r->server->module_config, &bucketeer_module);
+
+    /* If have a context, it means we've done this before successfully. */
     if (!ctx) {  
         if (!r->content_type || strncmp(r->content_type, "text/", 5)) {
             ap_remove_output_filter(f);
             return ap_pass_brigade(f->next, bb);
         }
 
@@ -125,19 +118,15 @@
         ctx->bb = apr_brigade_create(f->r->pool, f->c->bucket_alloc); 
         apr_table_unset(f->r->headers_out, "Content-Length");
     }
 
     APR_BRIGADE_FOREACH(e, bb) {
         const char *data;
-        apr_size_t len;
-
-        apr_size_t i;
-        apr_size_t lastpos;
+        apr_size_t len, i, lastpos;
 
         if (APR_BUCKET_IS_EOS(e)) {
-
             APR_BUCKET_REMOVE(e);
             APR_BRIGADE_INSERT_TAIL(ctx->bb, e);
 
             /* Okay, we've seen the EOS.
              * Time to pass it along down the chain.
              */
@@ -149,51 +138,62 @@
              * Ignore flush buckets for the moment.. 
              * we decide what to stream
              */
             continue;
         }
 
+        if (APR_BUCKET_IS_METADATA(e)) {
+            /* metadata bucket */
+            apr_bucket *cpy;
+            apr_bucket_copy(e, &cpy);
+            APR_BRIGADE_INSERT_TAIL(ctx->bb, cpy);
+            continue;
+        }
+
         /* read */
         apr_bucket_read(e, &data, &len, APR_BLOCK_READ);
-        if (len>0) {
-            lastpos=0;
-            for (i=0; i<len;i++) {
+
+        if (len > 0) {
+            lastpos = 0;
+            for (i = 0; i < len; i++) {
                 if (data[i] == c->flushdelimiter ||
                     data[i] == c->bucketdelimiter ||
-                    data[i] == c->passdelimiter)
-                {
+                    data[i] == c->passdelimiter) {
                     apr_bucket *p;
-                    if ( i-lastpos>0) {
-                        p = apr_bucket_pool_create(apr_pmemdup( f->r->pool,
-                                                            &data[lastpos],
-                                                            i-lastpos),
-                                                    i-lastpos, f->r->pool,
+                    if (i - lastpos > 0) {
+                        p = apr_bucket_pool_create(apr_pmemdup(f->r->pool,
+                                                               &data[lastpos],
+                                                               i - lastpos),
+                                                    i - lastpos,
+                                                    f->r->pool,
                                                     f->c->bucket_alloc);
-                        APR_BRIGADE_INSERT_TAIL(ctx->bb,p);
+                        APR_BRIGADE_INSERT_TAIL(ctx->bb, p);
                     }
-                    lastpos=i+1;
-                    if ( data[i] == c->flushdelimiter) {
+                    lastpos = i + 1;
+                    if (data[i] == c->flushdelimiter) {
                         p = apr_bucket_flush_create(f->c->bucket_alloc);
-                        APR_BRIGADE_INSERT_TAIL(ctx->bb,p);
+                        APR_BRIGADE_INSERT_TAIL(ctx->bb, p);
                     }
-                    if ( data[i] == c->flushdelimiter || data[i] == c->passdelimiter ) {
+                    if (data[i] == c->flushdelimiter ||
+                        data[i] == c->passdelimiter) {
                         ap_pass_brigade(f->next, ctx->bb);
                        /* apr_brigade_cleanup(ctx->bb);*/
                     }
                 }                       
             }
             /* XXX: really should append this to the next 'real' bucket */
-            if ( lastpos < i ) {
+            if (lastpos < i) {
                 apr_bucket *p;
                 p = apr_bucket_pool_create(apr_pmemdup(f->r->pool,
                                                        &data[lastpos],
-                                                       i-lastpos),
-                                           i-lastpos, f->r->pool,
+                                                       i - lastpos),
+                                           i - lastpos,
+                                           f->r->pool,
                                            f->c->bucket_alloc);
-                lastpos=i;
-                APR_BRIGADE_INSERT_TAIL(ctx->bb,p);
+                lastpos = i;
+                APR_BRIGADE_INSERT_TAIL(ctx->bb, p);
             }
         }     
     }
 
     return APR_SUCCESS;
 }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/modules/test: modules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36: modules.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/NWGNUmakefile	2002-04-29 23:10:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/NWGNUmakefile	2002-06-01 01:51:24.000000000 +0800
@@ -197,19 +197,21 @@
 	$(OBJDIR)/mod_access.o \
 	$(OBJDIR)/mod_actions.o \
 	$(OBJDIR)/mod_alias.o \
 	$(OBJDIR)/mod_asis.o \
 	$(OBJDIR)/mod_auth.o \
 	$(OBJDIR)/mod_autoindex.o \
+	$(OBJDIR)/mod_cgi.o \
 	$(OBJDIR)/mod_dir.o \
 	$(OBJDIR)/mod_env.o \
 	$(OBJDIR)/mod_imap.o \
 	$(OBJDIR)/mod_include.o \
 	$(OBJDIR)/mod_log_config.o \
 	$(OBJDIR)/mod_mime.o \
 	$(OBJDIR)/mod_negotiation.o \
+	$(OBJDIR)/mod_netware.o \
 	$(OBJDIR)/mod_nw_ssl.o \
 	$(OBJDIR)/mod_setenvif.o \
 	$(OBJDIR)/mod_so.o \
 	$(OBJDIR)/mod_userdir.o \
 	$(OBJDIR)/modules.o \
 	$(OBJDIR)/mpm_common.o \
@@ -305,14 +307,14 @@
 	-copy $(OBJDIR)\Apache2.nlm     $(INSTALL)\Apache2\*.*
 	-copy ABOUT_APACHE              $(INSTALL)\Apache2\*.*
 	-copy README                    $(INSTALL)\Apache2\*.*
 	-copy STATUS                    $(INSTALL)\Apache2\*.*
 	-copy LICENSE                   $(INSTALL)\Apache2\*.*
 	-copy CHANGES                   $(INSTALL)\Apache2\*.*
-	-copy support\dbmmanage.in      $(INSTALL)\Apache2\dbmmanage.pl
-	-copy support\logresolve.pl.in  $(INSTALL)\Apache2\logresolve.pl
+	-copy support\dbmmanage.in      $(INSTALL)\Apache2\bin\dbmmanage.pl
+	-copy support\logresolve.pl.in  $(INSTALL)\Apache2\bin\logresolve.pl
 	-awk  -f build\mkconfnw.awk docs\conf\httpd-std.conf.in >$(INSTALL)\Apache2\conf\httpd.conf
 	-copy docs\conf\magic           $(INSTALL)\Apache2\conf\magic
 	-copy docs\conf\mime.types      $(INSTALL)\Apache2\conf\mime.types
 	-copy docs\cgi-examples\printenv $(INSTALL)\Apache2\cgi-bin\printenv.pl
 	@echo rem copying the docs directories > xc.bat
 	@echo xcopy docs\error $(INSTALL)\Apache2\error /E >> xc.bat
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos/beosd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/beos/beosd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos/beosd.c	2002-04-09 14:47:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/beos/beosd.c	2002-05-17 19:33:10.000000000 +0800
@@ -121,13 +121,13 @@
 
     status = apr_accept(&csd, lr->sd, ptrans);
     if (status == APR_SUCCESS) { 
         *accepted = csd;
         apr_os_sock_get(&sockdes, csd);
         if (sockdes >= FD_SETSIZE) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                          "new file descriptor %d is too large; you probably need "
                          "to rebuild Apache with a larger FD_SETSIZE "
                          "(currently %d)",
                          sockdes, FD_SETSIZE);
             apr_socket_close(csd);
             return APR_EINTR;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos/os.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/beos/os.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/beos/os.h	2002-03-14 04:47:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/beos/os.h	2002-05-10 11:56:53.000000000 +0800
@@ -59,14 +59,14 @@
 #ifndef APACHE_OS_H
 #define APACHE_OS_H
 
 #include "ap_config.h"
 
 #ifndef PLATFORM
-  #ifdef BONE_VERSION
-  #define PLATFORM "BeOS BONE"
-  #else
-  #define PLATFORM "BeOS R5"
-  #endif
+# ifdef BONE_VERSION
+#  define PLATFORM "BeOS BONE"
+# else
+#  define PLATFORM "BeOS R5"
+# endif
 #endif
 
 #endif	/* !APACHE_OS_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/bs2000/bs2login.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/bs2000/bs2login.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/bs2000/bs2login.c	2002-03-14 04:47:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/bs2000/bs2login.c	2002-05-17 19:33:10.000000000 +0800
@@ -139,13 +139,13 @@
      * Anyway, simply return a fork().
      */
     if (strcmp(os_version.release, "01.0A") == 0 ||
 	strcmp(os_version.release, "02.0A") == 0 ||
 	strcmp(os_version.release, "02.1A") == 0)
     {
-	ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, NULL,
+	ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
 		     "Error: unsupported OS version. "
 		     "You may encounter problems.");
 	forktype = bs2_FORK;
     }
 
     /* The following versions are special:
@@ -214,26 +214,26 @@
      * In the case of one_process, it would fail.
      */
     if (one_process) {
 
 	type = forktype = bs2_noFORK;
 
-	ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, server,
+	ap_log_error(APLOG_MARK, APLOG_ERR, 0, server,
 		     "The debug mode of Apache should only "
 		     "be started by an unprivileged user!");
 	return 0;
     }
 
     /* If no _rini() is required, then return quickly. */
     if (type != bs2_RFORK_RINI && type != bs2_FORK_RINI)
 	return 0;
 
     /* An Account is required for _rini() */
     if (bs2000_account == NULL)
     {
-	ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO, 0, server,
+	ap_log_error(APLOG_MARK, APLOG_ALERT, 0, server,
 		     "No BS2000Account configured - cannot switch to User %s",
 		     user_name);
 	exit(APEXIT_CHILDFATAL);
     }
 
     apr_cpystrn(username, user_name, sizeof username);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/netware/modules.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/netware/modules.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/netware/modules.c	2001-11-14 01:39:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/netware/modules.c	2002-06-01 01:16:08.000000000 +0800
@@ -15,22 +15,23 @@
 extern module access_module;
 extern module auth_module;
 extern module negotiation_module;
 extern module include_module;
 extern module autoindex_module;
 extern module dir_module;
-//extern module cgi_module;
+extern module cgi_module;
 extern module userdir_module;
 extern module alias_module;
 extern module env_module;
 extern module log_config_module;
 extern module asis_module;
 extern module imap_module;
 extern module actions_module;
 extern module setenvif_module;
 extern module nwssl_module;
+extern module netware_module;
 
 module *ap_prelinked_modules[] = {
   &core_module,
   &mpm_netware_module,
   &http_module,
   &so_module,
@@ -38,22 +39,23 @@
   &access_module,
   &auth_module,
   &negotiation_module,
   &include_module,
   &autoindex_module,
   &dir_module,
-//  &cgi_module,
+  &cgi_module,
   &userdir_module,
   &alias_module,
   &env_module,
   &log_config_module,
   &asis_module,
   &imap_module,
   &actions_module,
   &setenvif_module,
   &nwssl_module,
+  &netware_module,
   NULL
 };
 
 module *ap_preloaded_modules[] = {
   &core_module,
   &mpm_netware_module,
@@ -63,18 +65,19 @@
   &access_module,
   &auth_module,
   &negotiation_module,
   &include_module,
   &autoindex_module,
   &dir_module,
-//  &cgi_module,
+  &cgi_module,
   &userdir_module,
   &alias_module,
   &env_module,
   &log_config_module,
   &asis_module,
   &imap_module,
   &actions_module,
   &setenvif_module,
   &nwssl_module,
+  &netware_module,
   NULL
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/netware/util_nw.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/netware/util_nw.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/netware/util_nw.c	2002-03-14 04:47:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/netware/util_nw.c	2002-06-01 01:17:40.000000000 +0800
@@ -67,13 +67,13 @@
     const request_rec *r,
     apr_proc_t *newproc, const char *progname,
     const char * const *args,
     const char * const *env,
     apr_procattr_t *attr, apr_pool_t *p)
 {
-    return APR_ENOTIMPL;
+    return apr_proc_create(newproc, progname, args, env, attr, p);
 }
 
 int  _NonAppCheckUnload( void )
 {
 	return nlmUnloadSignaled();
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2/core_header.def /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/os2/core_header.def
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2/core_header.def	2001-08-18 00:12:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/os2/core_header.def	2002-05-22 22:38:55.000000000 +0800
@@ -11,6 +11,9 @@
 ; And some more for mod_unique_id
   "gethostname"
   "gethostbyname"
   "_swapl"
   "h_errno"
   "inet_ntoa"
+
+; mod_proxy needs this one
+  "inet_addr"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2/core.mk /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/os2/core.mk
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2/core.mk	2001-08-20 18:49:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/os2/core.mk	2002-05-22 22:49:58.000000000 +0800
@@ -1,7 +1,7 @@
 # Some rules for making a shared core dll on OS/2
 
 os2core: httpd.dll $(CORE_IMPLIB)
 	$(LIBTOOL) --mode=link gcc -Zstack 512 $(LDFLAGS) $(EXTRA_LDFLAGS) -o httpd $(CORE_IMPLIB)
 
 httpd.dll: $(PROGRAM_DEPENDENCIES) $(CORE_IMPLIB)
-	$(LINK) -Zdll $(EXTRA_LDFLAGS) -s -o $@ server/exports.lo modules.lo $(PROGRAM_DEPENDENCIES) $(EXTRA_LIBS) server/ApacheCoreOS2.def
+	$(LINK) -Zdll $(EXTRA_LDFLAGS) -s -o $@ server/exports.lo modules.lo $(PROGRAM_DEPENDENCIES) $(AP_LIBS) server/ApacheCoreOS2.def
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/os2: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix/unixd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/unix/unixd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix/unixd.c	2002-04-25 15:18:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/unix/unixd.c	2002-05-26 16:27:10.000000000 +0800
@@ -273,26 +273,26 @@
         }
         else {
             cur = atol(str);
         }
     }
     else {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, cmd->server,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, cmd->server,
                      "Invalid parameters for %s", cmd->cmd->name);
         return;
     }
 
     if (arg2 && (str = ap_getword_conf(cmd->pool, &arg2))) {
         max = atol(str);
     }
 
     /* if we aren't running as root, cannot increase max */
     if (geteuid()) {
         limit->rlim_cur = cur;
         if (max) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, cmd->server,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, cmd->server,
                          "Must be uid 0 to raise maximum %s", cmd->cmd->name);
         }
     }
     else {
         if (cur) {
             limit->rlim_cur = cur;
@@ -300,13 +300,13 @@
         if (max) {
             limit->rlim_max = max;
         }
     }
 #else
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, cmd->server,
+    ap_log_error(APLOG_MARK, APLOG_ERR, 0, cmd->server,
                  "Platform does not support rlimit for %s", cmd->cmd->name);
 #endif
 }
 
 APR_HOOK_STRUCT(
                APR_HOOK_LINK(get_suexec_identity)
@@ -347,22 +347,31 @@
     if (args) {
         while (args[i]) {
             i++;
 	    }
     }
     /* allocate space for 4 new args, the input args, and a null terminator */
-    newargs = apr_palloc(p, sizeof(char *) * (i + 5));
+    newargs = apr_palloc(p, sizeof(char *) * (i + 4));
     newprogname = SUEXEC_BIN;
     newargs[0] = SUEXEC_BIN;
     newargs[1] = execuser;
     newargs[2] = execgroup;
     newargs[3] = apr_pstrdup(p, progname);
 
-    i = 0;
+    /*
+    ** using a shell to execute suexec makes no sense thus
+    ** we force everything to be APR_PROGRAM, and never
+    ** APR_SHELLCMD
+    */
+    if(apr_procattr_cmdtype_set(attr, APR_PROGRAM) != APR_SUCCESS) {
+        return APR_EGENERAL;
+    }
+
+    i = 1;
     do {
-        newargs[i + 4] = args[i];
+        newargs[i + 3] = args[i];
     } while (args[i++]);
 
     return apr_proc_create(newproc, newprogname, newargs, env, attr, p);
 }
 
 AP_DECLARE(apr_status_t) ap_os_create_privileged_process(
@@ -411,12 +420,24 @@
         }
     }
 #endif
     return APR_SUCCESS;
 }
 
+AP_DECLARE(apr_status_t) unixd_set_global_mutex_perms(apr_global_mutex_t *gmutex)
+{
+#if !APR_PROC_MUTEX_IS_GLOBAL
+    apr_os_global_mutex_t osgmutex;
+    apr_os_global_mutex_get(&osgmutex, gmutex);
+    return unixd_set_proc_mutex_perms(osgmutex.proc_mutex);
+#else  /* APR_PROC_MUTEX_IS_GLOBAL */
+    /* In this case, apr_proc_mutex_t and apr_global_mutex_t are the same. */
+    return unixd_set_proc_mutex_perms(gmutex);
+#endif /* APR_PROC_MUTEX_IS_GLOBAL */
+}
+
 AP_DECLARE(apr_status_t) unixd_accept(void **accepted, ap_listen_rec *lr,
                                         apr_pool_t *ptrans)
 {
     apr_socket_t *csd;
     apr_status_t status;
     int sockdes;
@@ -424,13 +445,13 @@
     *accepted = NULL;
     status = apr_accept(&csd, lr->sd, ptrans);
     if (status == APR_SUCCESS) { 
         *accepted = csd;
         apr_os_sock_get(&sockdes, csd);
         if (sockdes >= FD_SETSIZE) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                          "new file descriptor %d is too large; you probably need "
                          "to rebuild Apache with a larger FD_SETSIZE "
                          "(currently %d)",
                          sockdes, FD_SETSIZE);
             apr_socket_close(csd);
             return APR_EINTR;
@@ -534,13 +555,13 @@
         case EINACT:
             ap_log_error(APLOG_MARK, APLOG_EMERG, status, ap_server_conf,
                          "offload device inactive");
             return APR_EGENERAL;
             break;
         default:
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf,
                          "select/accept error (%d)", status);
             return APR_EGENERAL;
 #else
         default:
             ap_log_error(APLOG_MARK, APLOG_ERR, status, ap_server_conf,
                          "apr_accept: (client socket)");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix/unixd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/unix/unixd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/os/unix/unixd.h	2002-04-25 15:18:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/os/unix/unixd.h	2002-05-07 02:19:53.000000000 +0800
@@ -68,12 +68,13 @@
 #ifdef HAVE_SYS_RESOURCE_H
 #include <sys/resource.h>
 #endif
 #include "apr_hooks.h"
 #include "apr_thread_proc.h"
 #include "apr_proc_mutex.h"
+#include "apr_global_mutex.h"
 
 #include <pwd.h>
 #include <grp.h>
 #ifdef APR_HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
@@ -117,12 +118,13 @@
                                          const char *arg);
 #if defined(RLIMIT_CPU) || defined(RLIMIT_DATA) || defined(RLIMIT_VMEM) || defined(RLIMIT_NPROC) || defined(RLIMIT_AS)
 AP_DECLARE(void) unixd_set_rlimit(cmd_parms *cmd, struct rlimit **plimit,
                            const char *arg, const char * arg2, int type);
 #endif
 AP_DECLARE(apr_status_t) unixd_set_proc_mutex_perms(apr_proc_mutex_t *pmutex);
+AP_DECLARE(apr_status_t) unixd_set_global_mutex_perms(apr_global_mutex_t *gmutex);
 AP_DECLARE(apr_status_t) unixd_accept(void **accepted, ap_listen_rec *lr, apr_pool_t *ptrans);
 
 #ifdef HAVE_KILLPG
 #define unixd_killpg(x, y)	(killpg ((x), (y)))
 #define ap_os_killpg(x, y)      (killpg ((x), (y)))
 #else /* HAVE_KILLPG */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/README.platforms /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/README.platforms
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/README.platforms	2002-04-23 20:38:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/README.platforms	2002-05-06 13:25:52.000000000 +0800
@@ -3,35 +3,35 @@
 
   Platform specific notes:
   ------------------------
 
 ================
   Darwin (OS X):
-   Apache 2.0 relies heavily on the use of autoconf and libtool to provide
-   a build environment.  Darwin provides these tools,  but they are
-   an earlier release,  and for the most part,  do not work well.
-   If you are interested in developing under Darwin,  we recommend
-   that you obtain and install replacement versions of what are
-   normally installed on Darwin (and OS X, as of v10.1.4).  If you
-   build your own versions of autoconf 2.52 and libtool 1.4.2,  be
-   aware that there are some Darwin specific patchs to the official
+   Apache 2.0 relies heavily on the use of autoconf and libtool to
+   provide a build environment.  Darwin provides these tools, but
+   they are an earlier release, and for the most part, do not work
+   well.  If you are interested in developing under Darwin, we
+   recommend that you obtain and install replacement versions of what
+   are normally installed on Darwin (and OS X, as of v10.1.4).  If
+   you build your own versions of autoconf 2.52 and libtool 1.4.2, be
+   aware that there are some Darwin specific patches to the official
    code that still must be applied for them to fully work.  A useful
    page to check out is:
 
       http://fink.sourceforge.net/doc/porting/libtool.php
 
    Pier Fumagalli also provides pre-built Darwin packages of the
-   patched autoconf and libtool suites,  available at:
+   patched autoconf and libtool suites, available at:
 
       http://www.apache.org/~pier/macosx/
 
    You will note that GNU libtool should actually be installed as
    glibtool, to avoid conflict with a Darwin program of the same
    name.  Pier's packages have this change already.  All files are
-   installed under /usr/local/ so to use these versions,  be sure that
-   /usr/local/bin is earlier in your PATH.
+   installed under /usr/local/ so to use these versions, and be sure
+   that /usr/local/bin is earlier in your PATH.
 
    There have been some reports that autoconf 2.52 prevents Apache's
    build system from correctly handling passing multi-value envvars
    to the build system (eg: CFLAGS="-g -O3" ./configure),  causing
    errors.  Use of bash does not seem to help in this situation.  If
    this affects you, downgrading to autoconf 2.13 (which is installed
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/config.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/config.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/config.c	2002-03-28 06:42:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/config.c	2002-06-13 07:59:31.000000000 +0800
@@ -372,13 +372,13 @@
 
     result = ap_run_handler(r);
 
     r->handler = old_handler;
 
     if (result == DECLINED && r->handler && r->filename) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_WARNING, 0, r,
             "handler \"%s\" not found for: %s", r->handler, r->filename);
     }
 
     return result == DECLINED ? HTTP_INTERNAL_SERVER_ERROR : result;
 }
 
@@ -419,16 +419,16 @@
     /* This could be called from an AddModule httpd.conf command,
      * after the file has been linked and the module structure within it
      * teased out...
      */
 
     if (m->version != MODULE_MAGIC_NUMBER_MAJOR) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s: module \"%s\" is not compatible with this "
                      "version of Apache.", ap_server_argv0, m->name);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "Please contact the vendor for the correct version.");
         exit(1);
     }
 
     if (m->next == NULL) {
         m->next = ap_top_module;
@@ -437,16 +437,16 @@
 
     if (m->module_index == -1) {
         m->module_index = total_modules++;
         dynamic_modules++;
 
         if (dynamic_modules > DYNAMIC_MODULE_LIMIT) {
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "%s: module \"%s\" could not be loaded, because"
                          " the dynamic", ap_server_argv0, m->name);
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "module limit was reached. Please increase "
                          "DYNAMIC_MODULE_LIMIT and recompile.");
             exit(1);
         }
     }
 
@@ -506,13 +506,13 @@
         while (modp && modp->next != m) {
             modp = modp->next;
         }
 
         if (!modp) {
             /* Uh-oh, this module doesn't exist */
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                          "Cannot remove module %s: not found in module list",
                          m->name);
             return;
         }
 
         /* Eliminate us from the module list */
@@ -596,13 +596,13 @@
      *  Initialise list of loaded modules
      */
     ap_loaded_modules = (module **)apr_palloc(process->pool,
         sizeof(module *) * (total_modules + DYNAMIC_MODULE_LIMIT + 1));
 
     if (ap_loaded_modules == NULL) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "Ouch!  Out of memory in ap_setup_prelinked_modules()!");
     }
 
     for (m = ap_preloaded_modules, m2 = ap_loaded_modules; *m != NULL; )
         *m2++ = *m++;
 
@@ -864,12 +864,13 @@
 static const char *ap_build_config_sub(apr_pool_t *p, apr_pool_t *temp_pool,
                                        const char *l, cmd_parms *parms,
                                        ap_directive_t **current,
                                        ap_directive_t **curr_parent,
                                        ap_directive_t **conftree)
 {
+    const char *retval = NULL;
     const char *args;
     char *cmd_name;
     ap_directive_t *newdir;
     module *mod = ap_top_module;
     const command_rec *cmd;
 
@@ -902,23 +903,22 @@
     newdir->line_num = parms->config_file->line_number;
     newdir->directive = cmd_name;
     newdir->args = apr_pstrdup(p, args);
 
     if ((cmd = ap_find_command_in_modules(cmd_name, &mod)) != NULL) {
         if (cmd->req_override & EXEC_ON_READ) {
-            const char *retval;
             ap_directive_t *sub_tree = NULL;
 
             parms->err_directive = newdir;
             retval = execute_now(cmd_name, args, parms, p, temp_pool,
                                  &sub_tree, *curr_parent);
             if (*current) {
                 (*current)->next = sub_tree;
             }
             else {
-                (*current) = sub_tree;
+                *current = sub_tree;
                 if (*curr_parent) {
                     (*curr_parent)->first_child = (*current);
                 }
                 if (*current) {
                     (*current)->parent = (*curr_parent);
                 }
@@ -976,13 +976,13 @@
         }
     }
     else {
         *current = ap_add_node(curr_parent, *current, newdir, 0);
     }
 
-    return NULL;
+    return retval;
 }
 
 AP_DECLARE(const char *) ap_build_cont_config(apr_pool_t *p,
                                               apr_pool_t *temp_pool,
                                               cmd_parms *parms,
                                               ap_directive_t **current,
@@ -1041,12 +1041,17 @@
                                                      section_vector,
                                                      parms->path,
                                                      mod,
                                                      parms->pool);
             const char *retval;
 
+            /* Once was enough? */
+            if (cmd->req_override & EXEC_ON_READ) {
+                return NULL;
+            }
+
             retval = invoke_cmd(cmd, parms, dir_config, current->args);
             if (retval == NULL) {
                 return NULL;
             }
 
             if (strcmp(retval, DECLINE_CMD) != 0) {
@@ -1375,13 +1380,13 @@
     parms.config_file = ap_pcfg_open_custom(p, "-c/-C directives",
                                             &arr_parms, NULL,
                                             arr_elts_getstr, arr_elts_close);
 
     errmsg = ap_build_config(&parms, p, ptemp, conftree);
     if (errmsg) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "Syntax error in -C/-c directive:" APR_EOL_STR "%s",
                      errmsg);
         exit(1);
     }
 
     ap_cfg_closefile(parms.config_file);
@@ -1481,28 +1486,28 @@
     parms.pool = p;
     parms.temp_pool = ptemp;
     parms.server = s;
     parms.override = (RSRC_CONF | OR_ALL) & ~(OR_AUTHCFG | OR_LIMIT);
 
     if (ap_pcfg_openfile(&cfp, p, fname) != APR_SUCCESS) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s: could not open document config file %s",
                      ap_server_argv0, fname);
         exit(1);
     }
 
     parms.config_file = cfp;
 
     errmsg = ap_build_config(&parms, p, ptemp, conftree);
 
     if (errmsg != NULL) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "Syntax error on line %d of %s:",
                      parms.err_directive->line_num,
                      parms.err_directive->filename);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s", errmsg);
         exit(1);
     }
 
     ap_cfg_closefile(cfp);
 }
@@ -1520,17 +1525,17 @@
     parms.server = s;
     parms.override = (RSRC_CONF | OR_ALL) & ~(OR_AUTHCFG | OR_LIMIT);
     parms.limited = -1;
 
     errmsg = ap_walk_config(conftree, &parms, s->lookup_defaults);
     if (errmsg) {
-        ap_log_perror(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, p,
+        ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0, p,
                      "Syntax error on line %d of %s:",
                      parms.err_directive->line_num,
                      parms.err_directive->filename);
-        ap_log_perror(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, p,
+        ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0, p,
                      "%s", errmsg);
         exit(1);
     }
 }
 
 AP_CORE_DECLARE(int) ap_parse_htaccess(ap_conf_vector_t **result,
@@ -1581,13 +1586,13 @@
             if (errmsg == NULL)
                 errmsg = ap_walk_config(temptree, &parms, dc);
 
             ap_cfg_closefile(f);
 
             if (errmsg) {
-                ap_log_rerror(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ALERT, 0, r,
                               "%s: %s", filename, errmsg);
                 return HTTP_INTERNAL_SERVER_ERROR;
             }
 
             *result = dc;
             break;
@@ -1718,14 +1723,14 @@
     s->server_hostname = NULL;
     s->error_fname = DEFAULT_ERRORLOG;
     s->loglevel = DEFAULT_LOGLEVEL;
     s->limit_req_line = DEFAULT_LIMIT_REQUEST_LINE;
     s->limit_req_fieldsize = DEFAULT_LIMIT_REQUEST_FIELDSIZE;
     s->limit_req_fields = DEFAULT_LIMIT_REQUEST_FIELDS;
-    s->timeout = DEFAULT_TIMEOUT;
-    s->keep_alive_timeout = DEFAULT_KEEPALIVE_TIMEOUT;
+    s->timeout = apr_time_from_sec(DEFAULT_TIMEOUT);
+    s->keep_alive_timeout = apr_time_from_sec(DEFAULT_KEEPALIVE_TIMEOUT);
     s->keep_alive_max = DEFAULT_KEEPALIVE;
     s->keep_alive = 1;
     s->next = NULL;
     s->addrs = apr_pcalloc(p, sizeof(server_addr_rec));
 
     /* NOT virtual host; don't match any real network interface */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/core.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/core.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/core.c	2002-04-26 04:51:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/core.c	2002-06-15 13:49:06.000000000 +0800
@@ -177,12 +177,14 @@
      * Flag for use of inodes in ETags.
      */
     conf->etag_bits = ETAG_UNSET;
     conf->etag_add = ETAG_UNSET;
     conf->etag_remove = ETAG_UNSET;
 
+    conf->enable_mmap = ENABLE_MMAP_UNSET;
+
     return (void *)conf;
 }
 
 /*
  * Overlay one hash table of ct_output_filters onto another
  */
@@ -438,12 +440,16 @@
     }
 
     if (conf->etag_bits != ETAG_NONE) {
         conf->etag_bits &= (~ ETAG_NONE);
     }
 
+    if (new->enable_mmap != ENABLE_MMAP_UNSET) {
+        conf->enable_mmap = new->enable_mmap;
+    }
+
     return (void*)conf;
 }
 
 static void *create_core_server_config(apr_pool_t *a, server_rec *s)
 {
     core_server_config *conf;
@@ -974,19 +980,26 @@
 
     if ((forbidden & NOT_IN_LIMIT) && cmd->limited != -1) {
         return apr_pstrcat(cmd->pool, cmd->cmd->name, gt,
                            " cannot occur within <Limit> section", NULL);
     }
 
-    if ((forbidden & NOT_IN_DIR_LOC_FILE) == NOT_IN_DIR_LOC_FILE
-        && cmd->path != NULL) {
-        return apr_pstrcat(cmd->pool, cmd->cmd->name, gt,
-                           " cannot occur within <Directory/Location/Files> "
-                           "section", NULL);
+    if ((forbidden & NOT_IN_DIR_LOC_FILE) == NOT_IN_DIR_LOC_FILE) {
+        if (cmd->path != NULL) {
+            return apr_pstrcat(cmd->pool, cmd->cmd->name, gt,
+                            " cannot occur within <Directory/Location/Files> "
+                            "section", NULL);
+        }
+        if (cmd->cmd->req_override & EXEC_ON_READ) {
+            /* EXEC_ON_READ must be NOT_IN_DIR_LOC_FILE, if not, it will
+             * (deliberately) segfault below in the individual tests...
+             */
+            return NULL;
+        }
     }
-
+    
     if (((forbidden & NOT_IN_DIRECTORY)
          && ((found = find_parent(cmd->directive, "<Directory"))
              || (found = find_parent(cmd->directive, "<DirectoryMatch"))))
         || ((forbidden & NOT_IN_LOCATION)
             && ((found = find_parent(cmd->directive, "<Location"))
                 || (found = find_parent(cmd->directive, "<LocationMatch"))))
@@ -1074,13 +1087,13 @@
     /* TODO: ap_configtestonly && ap_docrootcheck && */
     /* XXX Shouldn't this be relative to ServerRoot ??? */
     if (apr_filepath_merge((char**)&conf->ap_document_root, NULL, arg,
                            APR_FILEPATH_TRUENAME, cmd->pool) != APR_SUCCESS
         || !ap_is_directory(cmd->pool, arg)) {
         if (cmd->server->is_virtual) {
-            ap_log_perror(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0,
+            ap_log_perror(APLOG_MARK, APLOG_STARTUP, 0,
                           cmd->pool,
                           "Warning: DocumentRoot [%s] does not exist",
                           arg);
             conf->ap_document_root = arg;
         }
         else {
@@ -1146,13 +1159,13 @@
     else
         what = MSG;
 
     /* The entry should be ignored if it is a full URL for a 401 error */
 
     if (error_number == 401 && what == REMOTE_PATH) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, cmd->server,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, cmd->server,
                      "cannot use a full URL in a 401 ErrorDocument "
                      "directive --- ignoring!");
     }
     else { /* Store it... */
         if (conf->response_code_strings == NULL) {
             conf->response_code_strings =
@@ -1419,12 +1432,35 @@
         }
     }
 
     return NULL;
 }
 
+static const char *set_enable_mmap(cmd_parms *cmd, void *d_,
+                                   const char *arg)
+{
+    core_dir_config *d = d_;
+    const char *err = ap_check_cmd_context(cmd, NOT_IN_LIMIT);
+
+    if (err != NULL) {
+        return err;
+    }
+
+    if (strcasecmp(arg, "on") == 0) {
+        d->enable_mmap = ENABLE_MMAP_ON;
+    }
+    else if (strcasecmp(arg, "off") == 0) {
+        d->enable_mmap = ENABLE_MMAP_OFF;
+    }
+    else {
+        return "parameter must be 'on' or 'off'";
+    }
+
+    return NULL;
+}
+
 static const char *satisfy(cmd_parms *cmd, void *c_, const char *arg)
 {
     core_dir_config *c = c_;
 
     if (!strcasecmp(arg, "all")) {
         c->satisfy = SATISFY_ALL;
@@ -2002,13 +2038,13 @@
     const char *err = ap_check_cmd_context(cmd, NOT_IN_DIR_LOC_FILE|NOT_IN_LIMIT);
 
     if (err != NULL) {
         return err;
     }
 
-    cmd->server->timeout = atoi(arg);
+    cmd->server->timeout = apr_time_from_sec(atoi(arg));
     return NULL;
 }
 
 static const char *set_idcheck(cmd_parms *cmd, void *d_, int arg)
 {
     core_dir_config *d = d_;
@@ -2473,13 +2509,13 @@
 }
 
 #if !defined (RLIMIT_CPU) || !(defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined(RLIMIT_AS)) || !defined (RLIMIT_NPROC)
 static const char *no_set_limit(cmd_parms *cmd, void *conf_,
                                 const char *arg, const char *arg2)
 {
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, cmd->server,
+    ap_log_error(APLOG_MARK, APLOG_ERR, 0, cmd->server,
                 "%s not supported on this platform", cmd->cmd->name);
 
     return NULL;
 }
 #endif
 
@@ -2833,13 +2869,13 @@
 AP_INIT_RAW_ARGS("<LocationMatch", urlsection, (void*)1, RSRC_CONF,
   "Container for directives affecting resources accessed through the "
   "specified URL paths"),
 AP_INIT_RAW_ARGS("<FilesMatch", filesection, (void*)1, OR_ALL,
   "Container for directives affecting files matching specified patterns"),
 AP_INIT_TAKE1("AuthType", ap_set_string_slot,
-  (void*)APR_XtOffsetOf(core_dir_config, ap_auth_type), OR_AUTHCFG,
+  (void*)APR_OFFSETOF(core_dir_config, ap_auth_type), OR_AUTHCFG,
   "An HTTP authorization type (e.g., \"Basic\")"),
 AP_INIT_TAKE1("AuthName", set_authname, NULL, OR_AUTHCFG,
   "The authentication realm (e.g. \"Members Only\")"),
 AP_INIT_RAW_ARGS("Require", require, NULL, OR_AUTHCFG,
   "Selects which authenticated users or groups may access a protected space"),
 AP_INIT_TAKE1("Satisfy", satisfy, NULL, OR_AUTHCFG,
@@ -2864,36 +2900,38 @@
 AP_INIT_RAW_ARGS("AllowOverride", set_override, NULL, ACCESS_CONF,
   "Controls what groups of directives can be configured by per-directory "
   "config files"),
 AP_INIT_RAW_ARGS("Options", set_options, NULL, OR_OPTIONS,
   "Set a number of attributes for a given directory"),
 AP_INIT_TAKE1("DefaultType", ap_set_string_slot,
-  (void*)APR_XtOffsetOf (core_dir_config, ap_default_type),
+  (void*)APR_OFFSETOF(core_dir_config, ap_default_type),
   OR_FILEINFO, "the default MIME type for untypable files"),
 AP_INIT_RAW_ARGS("FileETag", set_etag_bits, NULL, OR_FILEINFO,
   "Specify components used to construct a file's ETag"),
+AP_INIT_TAKE1("EnableMMAP", set_enable_mmap, NULL, OR_FILEINFO,
+  "Controls whether memory-mapping may be used to read files"),
 
 /* Old server config file commands */
 
 AP_INIT_TAKE1("Port", ap_set_deprecated, NULL, RSRC_CONF,
   "Port was replaced with Listen in Apache 2.0"),
 AP_INIT_TAKE1("HostnameLookups", set_hostname_lookups, NULL,
   ACCESS_CONF|RSRC_CONF,
   "\"on\" to enable, \"off\" to disable reverse DNS lookups, or \"double\" to "
   "enable double-reverse DNS lookups"),
 AP_INIT_TAKE1("ServerAdmin", set_server_string_slot,
-  (void *)APR_XtOffsetOf (server_rec, server_admin), RSRC_CONF,
+  (void *)APR_OFFSETOF(server_rec, server_admin), RSRC_CONF,
   "The email address of the server administrator"),
 AP_INIT_TAKE1("ServerName", server_hostname_port, NULL, RSRC_CONF,
   "The hostname and port of the server"),
 AP_INIT_TAKE1("ServerSignature", set_signature_flag, NULL, OR_ALL,
   "En-/disable server signature (on|off|email)"),
-AP_INIT_TAKE1("ServerRoot", set_server_root, NULL, RSRC_CONF,
+AP_INIT_TAKE1("ServerRoot", set_server_root, NULL, RSRC_CONF | EXEC_ON_READ,
   "Common directory of server-related files (logs, confs, etc.)"),
 AP_INIT_TAKE1("ErrorLog", set_server_string_slot,
-  (void *)APR_XtOffsetOf (server_rec, error_fname), RSRC_CONF,
+  (void *)APR_OFFSETOF(server_rec, error_fname), RSRC_CONF,
   "The filename of the error log"),
 AP_INIT_RAW_ARGS("ServerAlias", set_server_alias, NULL, RSRC_CONF,
   "A name or names alternately used to access the server"),
 AP_INIT_TAKE1("ServerPath", set_serverpath, NULL, RSRC_CONF,
   "The pathname the server can be reached at"),
 AP_INIT_TAKE1("Timeout", set_timeout, NULL, RSRC_CONF,
@@ -2925,58 +2963,58 @@
 AP_INIT_TAKE1("LimitRequestFieldsize", set_limit_req_fieldsize, NULL,
   RSRC_CONF,
   "Limit on maximum size of an HTTP request header field"),
 AP_INIT_TAKE1("LimitRequestFields", set_limit_req_fields, NULL, RSRC_CONF,
   "Limit (0 = unlimited) on max number of header fields in a request message"),
 AP_INIT_TAKE1("LimitRequestBody", set_limit_req_body,
-  (void*)APR_XtOffsetOf(core_dir_config, limit_req_body), OR_ALL,
+  (void*)APR_OFFSETOF(core_dir_config, limit_req_body), OR_ALL,
   "Limit (in bytes) on maximum size of request message body"),
 AP_INIT_TAKE1("LimitXMLRequestBody", set_limit_xml_req_body, NULL, OR_ALL,
               "Limit (in bytes) on maximum size of an XML-based request "
               "body"),
 
 /* System Resource Controls */
 #ifdef RLIMIT_CPU
 AP_INIT_TAKE12("RLimitCPU", set_limit_cpu,
-  (void*)APR_XtOffsetOf(core_dir_config, limit_cpu),
+  (void*)APR_OFFSETOF(core_dir_config, limit_cpu),
   OR_ALL, "Soft/hard limits for max CPU usage in seconds"),
 #else
 AP_INIT_TAKE12("RLimitCPU", no_set_limit, NULL,
   OR_ALL, "Soft/hard limits for max CPU usage in seconds"),
 #endif
 #if defined (RLIMIT_DATA) || defined (RLIMIT_VMEM) || defined (RLIMIT_AS)
 AP_INIT_TAKE12("RLimitMEM", set_limit_mem,
-  (void*)APR_XtOffsetOf(core_dir_config, limit_mem),
+  (void*)APR_OFFSETOF(core_dir_config, limit_mem),
   OR_ALL, "Soft/hard limits for max memory usage per process"),
 #else
 AP_INIT_TAKE12("RLimitMEM", no_set_limit, NULL,
   OR_ALL, "Soft/hard limits for max memory usage per process"),
 #endif
 #ifdef RLIMIT_NPROC
 AP_INIT_TAKE12("RLimitNPROC", set_limit_nproc,
-  (void*)APR_XtOffsetOf(core_dir_config, limit_nproc),
+  (void*)APR_OFFSETOF(core_dir_config, limit_nproc),
   OR_ALL, "soft/hard limits for max number of processes per uid"),
 #else
 AP_INIT_TAKE12("RLimitNPROC", no_set_limit, NULL,
    OR_ALL, "soft/hard limits for max number of processes per uid"),
 #endif
 
 AP_INIT_TAKE1("ForceType", ap_set_string_slot_lower,
-       (void *)APR_XtOffsetOf(core_dir_config, mime_type), OR_FILEINFO,
+       (void *)APR_OFFSETOF(core_dir_config, mime_type), OR_FILEINFO,
      "a mime type that overrides other configured type"),
 AP_INIT_TAKE1("SetHandler", ap_set_string_slot_lower,
-       (void *)APR_XtOffsetOf(core_dir_config, handler), OR_FILEINFO,
+       (void *)APR_OFFSETOF(core_dir_config, handler), OR_FILEINFO,
    "a handler name that overrides any other configured handler"),
 AP_INIT_TAKE1("SetOutputFilter", ap_set_string_slot,
-       (void *)APR_XtOffsetOf(core_dir_config, output_filters), OR_FILEINFO,
+       (void *)APR_OFFSETOF(core_dir_config, output_filters), OR_FILEINFO,
    "filter (or ; delimited list of filters) to be run on the request content"),
 AP_INIT_TAKE1("SetInputFilter", ap_set_string_slot,
-       (void *)APR_XtOffsetOf(core_dir_config, input_filters), OR_FILEINFO,
+       (void *)APR_OFFSETOF(core_dir_config, input_filters), OR_FILEINFO,
    "filter (or ; delimited list of filters) to be run on the request body"),
 AP_INIT_ITERATE2("AddOutputFilterByType", add_ct_output_filters,
-       (void *)APR_XtOffsetOf(core_dir_config, ct_output_filters), OR_FILEINFO,
+       (void *)APR_OFFSETOF(core_dir_config, ct_output_filters), OR_FILEINFO,
      "output filter name followed by one or more content-types"),
 
 /*
  * These are default configuration directives that mpms can/should
  * pay attention to. If an mpm wishes to use these, they should
  * #defined them in mpm.h.
@@ -3022,13 +3060,13 @@
      * some general-case test
      */
     if (r->proxyreq) {
         return HTTP_FORBIDDEN;
     }
     if (!r->uri || ((r->uri[0] != '/') && strcmp(r->uri, "*"))) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                      "Invalid URI in request %s", r->the_request);
         return HTTP_BAD_REQUEST;
     }
 
     if (r->server->path
         && !strncmp(r->uri, r->server->path, r->server->pathlen)
@@ -3135,25 +3173,12 @@
      *     The current choice of when to compute the md5 here matches the 1.3
      *     support fairly closely (unlike 1.3, we don't handle computing md5
      *     when the charset is translated).
      */
     int bld_content_md5;
 
-    /*
-     * The old way of doing handlers meant that this handler would
-     * match literally anything - this way will require handler to
-     * have a / in the middle, which probably captures the original
-     * intent, but may cause problems at first - Ben 7th Jan 01
-     * Don't try to serve a dir.  Some OSs do weird things with
-     * raw I/O on a dir.
-     */
-    if ((strcmp(r->handler, "default-handler")
-        && !ap_strchr_c(r->handler, '/'))
-        || r->finfo.filetype == APR_DIR)
-        return DECLINED;
-
     d = (core_dir_config *)ap_get_module_config(r->per_dir_config,
                                                 &core_module);
     bld_content_md5 = (d->content_md5 & 1)
                       && r->output_filters->frec->ftype != AP_FTYPE_RESOURCE;
 
     ap_allow_standard_methods(r, MERGE_ALLOW, M_GET, M_OPTIONS, M_POST, -1);
@@ -3164,93 +3189,107 @@
      * the output filters are invoked by the default handler.
      */
     if ((errstatus = ap_discard_request_body(r)) != OK) {
         return errstatus;
     }
 
-    if (r->method_number != M_GET && r->method_number != M_POST) {
-        if (r->method_number == M_INVALID) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
-                          "Invalid method in request %s", r->the_request);
-            return HTTP_NOT_IMPLEMENTED;
+    if (r->method_number == M_GET || r->method_number == M_POST) {
+        if (r->finfo.filetype == 0) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "File does not exist: %s", r->filename);
+            return HTTP_NOT_FOUND;
         }
 
-        if (r->method_number == M_OPTIONS) {
-            return ap_send_http_options(r);
+        /* Don't try to serve a dir.  Some OSs do weird things with
+         * raw I/O on a dir.
+         */
+        if (r->finfo.filetype == APR_DIR) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "Attempt to serve directory: %s", r->filename);
+            return HTTP_NOT_FOUND;
+        }
+
+        if ((r->used_path_info != AP_REQ_ACCEPT_PATH_INFO) &&
+            r->path_info && *r->path_info)
+        {
+            /* default to reject */
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "File does not exist: %s",
+                          apr_pstrcat(r->pool, r->filename, r->path_info, NULL));
+            return HTTP_NOT_FOUND;
+        }
+
+        if ((status = apr_file_open(&fd, r->filename, APR_READ | APR_BINARY, 0,
+                                    r->pool)) != APR_SUCCESS) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, status, r,
+                          "file permissions deny server access: %s", r->filename);
+            return HTTP_FORBIDDEN;
         }
-        return HTTP_METHOD_NOT_ALLOWED;
-    }
-
-    if (r->finfo.filetype == 0) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
-                      "File does not exist: %s", r->filename);
-        return HTTP_NOT_FOUND;
-    }
-
-    if ((r->used_path_info != AP_REQ_ACCEPT_PATH_INFO) &&
-        r->path_info && *r->path_info)
-    {
-        /* default to reject */
-        ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, r,
-                      "File does not exist: %s",
-                      apr_pstrcat(r->pool, r->filename, r->path_info, NULL));
-        return HTTP_NOT_FOUND;
-    }
 
-    if ((status = apr_file_open(&fd, r->filename, APR_READ | APR_BINARY, 0,
-                                r->pool)) != APR_SUCCESS) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR, status, r,
-                      "file permissions deny server access: %s", r->filename);
-        return HTTP_FORBIDDEN;
-    }
-
-    ap_update_mtime(r, r->finfo.mtime);
-    ap_set_last_modified(r);
-    ap_set_etag(r);
-    apr_table_setn(r->headers_out, "Accept-Ranges", "bytes");
-    ap_set_content_length(r, r->finfo.size);
-    if ((errstatus = ap_meets_conditions(r)) != OK) {
-        apr_file_close(fd);
-        return errstatus;
-    }
-
-    if (bld_content_md5) {
-        apr_table_setn(r->headers_out, "Content-MD5",
-                       ap_md5digest(r->pool, fd));
-    }
+        ap_update_mtime(r, r->finfo.mtime);
+        ap_set_last_modified(r);
+        ap_set_etag(r);
+        apr_table_setn(r->headers_out, "Accept-Ranges", "bytes");
+        ap_set_content_length(r, r->finfo.size);
+        if ((errstatus = ap_meets_conditions(r)) != OK) {
+            apr_file_close(fd);
+            return errstatus;
+        }
+
+        if (bld_content_md5) {
+            apr_table_setn(r->headers_out, "Content-MD5",
+                           ap_md5digest(r->pool, fd));
+        }
 
-    bb = apr_brigade_create(r->pool, c->bucket_alloc);
+        bb = apr_brigade_create(r->pool, c->bucket_alloc);
 #if APR_HAS_LARGE_FILES
-    if (r->finfo.size > AP_MAX_SENDFILE) {
-        /* APR_HAS_LARGE_FILES issue; must split into mutiple buckets,
-         * no greater than MAX(apr_size_t), and more granular than that
-         * in case the brigade code/filters attempt to read it directly.
-         */
-        apr_off_t fsize = r->finfo.size;
-        e = apr_bucket_file_create(fd, 0, AP_MAX_SENDFILE, r->pool,
-                                   c->bucket_alloc);
-        while (fsize > AP_MAX_SENDFILE) {
-            apr_bucket *ce;
-            apr_bucket_copy(e, &ce);
-            APR_BRIGADE_INSERT_TAIL(bb, ce);
-            e->start += AP_MAX_SENDFILE;
-            fsize -= AP_MAX_SENDFILE;
+        if (r->finfo.size > AP_MAX_SENDFILE) {
+            /* APR_HAS_LARGE_FILES issue; must split into mutiple buckets,
+             * no greater than MAX(apr_size_t), and more granular than that
+             * in case the brigade code/filters attempt to read it directly.
+             */
+            apr_off_t fsize = r->finfo.size;
+            e = apr_bucket_file_create(fd, 0, AP_MAX_SENDFILE, r->pool,
+                                       c->bucket_alloc);
+            while (fsize > AP_MAX_SENDFILE) {
+                apr_bucket *ce;
+                apr_bucket_copy(e, &ce);
+                APR_BRIGADE_INSERT_TAIL(bb, ce);
+                e->start += AP_MAX_SENDFILE;
+                fsize -= AP_MAX_SENDFILE;
+            }
+            e->length = (apr_size_t)fsize; /* Resize just the last bucket */
         }
-        e->length = (apr_size_t)fsize; /* Resize just the last bucket */
-    }
-    else
+        else
 #endif
-        e = apr_bucket_file_create(fd, 0, (apr_size_t)r->finfo.size,
-                                   r->pool, c->bucket_alloc);
+            e = apr_bucket_file_create(fd, 0, (apr_size_t)r->finfo.size,
+                                       r->pool, c->bucket_alloc);
 
-    APR_BRIGADE_INSERT_TAIL(bb, e);
-    e = apr_bucket_eos_create(c->bucket_alloc);
-    APR_BRIGADE_INSERT_TAIL(bb, e);
+#if APR_HAS_MMAP
+        if (d->enable_mmap == ENABLE_MMAP_OFF) {
+            (void)apr_bucket_file_enable_mmap(e, 0);
+        }
+#endif
+        APR_BRIGADE_INSERT_TAIL(bb, e);
+        e = apr_bucket_eos_create(c->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(bb, e);
 
-    return ap_pass_brigade(r->output_filters, bb);
+        return ap_pass_brigade(r->output_filters, bb);
+    }
+    else {              /* unusual method (not GET or POST) */
+        if (r->method_number == M_INVALID) {
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
+                          "Invalid method in request %s", r->the_request);
+            return HTTP_NOT_IMPLEMENTED;
+        }
 
+        if (r->method_number == M_OPTIONS) {
+            return ap_send_http_options(r);
+        }
+        return HTTP_METHOD_NOT_ALLOWED;
+    }
 }
 
 static int net_time_filter(ap_filter_t *f, apr_bucket_brigade *b,
                            ap_input_mode_t mode, apr_read_type_e block,
                            apr_off_t readbytes)
 {
@@ -3264,20 +3303,20 @@
     }
 
     if (mode != AP_MODE_INIT && mode != AP_MODE_EATCRLF) {
         if (*first_line) {
             apr_setsocketopt(csd, APR_SO_TIMEOUT,
                              (int)(keptalive
-                      ? f->c->base_server->keep_alive_timeout * APR_USEC_PER_SEC
-                      : f->c->base_server->timeout * APR_USEC_PER_SEC));
+                      ? f->c->base_server->keep_alive_timeout
+                      : f->c->base_server->timeout));
             *first_line = 0;
         }
         else {
             if (keptalive) {
                 apr_setsocketopt(csd, APR_SO_TIMEOUT,
-                         (int)(f->c->base_server->timeout * APR_USEC_PER_SEC));
+                                 (int)(f->c->base_server->timeout));
             }
         }
     }
     return ap_get_brigade(f->next, b, mode, block, readbytes);
 }
 
@@ -3285,13 +3324,13 @@
  * Remove all zero length buckets from the brigade.
  */
 #define BRIGADE_NORMALIZE(b) \
 do { \
     apr_bucket *e = APR_BRIGADE_FIRST(b); \
     do {  \
-        if (e->length == 0) { \
+        if (e->length == 0 && !APR_BUCKET_IS_METADATA(e)) { \
             apr_bucket *d; \
             d = APR_BUCKET_NEXT(e); \
             apr_bucket_delete(e); \
             e = d; \
         } \
         e = APR_BUCKET_NEXT(e); \
@@ -3851,12 +3890,13 @@
     return APR_SUCCESS;
 }
 
 static int core_post_config(apr_pool_t *pconf, apr_pool_t *plog, apr_pool_t *ptemp, server_rec *s)
 {
     ap_set_version(pconf);
+    ap_setup_make_content_type(pconf);
     return OK;
 }
 
 static int core_open_logs(apr_pool_t *pconf, apr_pool_t *plog, apr_pool_t *ptemp, server_rec *s)
 {
     ap_open_logs(s, plog);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server: .deps
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/error_bucket.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/error_bucket.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/error_bucket.c	2002-04-20 13:02:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/error_bucket.c	2002-06-03 04:19:54.000000000 +0800
@@ -64,25 +64,32 @@
 {
     *str = NULL;
     *len = 0;
     return APR_SUCCESS;
 }
 
+static void error_bucket_destroy(void *data)
+{
+    ap_bucket_error *h = data;
+
+    if (apr_bucket_shared_destroy(h)) {
+        apr_bucket_free(h);
+    }
+}
+
 AP_DECLARE(apr_bucket *) ap_bucket_error_make(apr_bucket *b, int error,
                                               const char *buf, apr_pool_t *p)
 {
     ap_bucket_error *h;
 
     h = apr_bucket_alloc(sizeof(*h), b->list);
     h->status = error;
     h->data = (buf) ? apr_pstrdup(p, buf) : NULL;
 
-    b->length = 0;
-    b->start  = 0;
+    b = apr_bucket_shared_make(b, h, 0, 0);
     b->type = &ap_bucket_type_error;
-    b->data = h;
     return b;
 }
 
 AP_DECLARE(apr_bucket *) ap_bucket_error_create(int error, const char *buf,
                                                 apr_pool_t *p,
                                                 apr_bucket_alloc_t *list)
@@ -93,13 +100,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return ap_bucket_error_make(b, error, buf, p);
 }
 
 AP_DECLARE_DATA const apr_bucket_type_t ap_bucket_type_error = {
-    "ERROR", 5,
-    apr_bucket_free,
+    "ERROR", 5, APR_BUCKET_METADATA,
+    error_bucket_destroy,
     error_bucket_read,
     apr_bucket_setaside_notimpl,
     apr_bucket_split_notimpl,
-    apr_bucket_copy_notimpl
+    apr_bucket_shared_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/log.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/log.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/log.c	2002-04-22 11:25:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/log.c	2002-06-09 11:44:03.000000000 +0800
@@ -309,13 +309,13 @@
             ap_log_error(APLOG_MARK, APLOG_STARTUP, rc, NULL,
                          "%s: could not open error log file %s.",
                          ap_server_argv0, fname);
             exit(1);
         }
 
-        apr_file_set_inherit(s->error_log);
+        apr_file_inherit_set(s->error_log);
     }
 }
 
 void ap_open_logs(server_rec *s_main, apr_pool_t *p)
 {
     apr_status_t rc = APR_SUCCESS;
@@ -488,13 +488,13 @@
          * quad is the most secure, which is why I'm implementing it
          * first. -djg
          */
         len += apr_snprintf(errstr + len, MAX_STRING_LEN - len,
                             "[client %s] ", r->connection->remote_ip);
     }
-    if (!(level & APLOG_NOERRNO) && (status != 0)) {
+    if (status != 0) {
         char buf[120];
         len += apr_snprintf(errstr + len, MAX_STRING_LEN - len,
                             "(%d)%s: ", status,
                             apr_strerror(status, buf, sizeof(buf)));
     }
     errstrlen = len;
@@ -601,41 +601,88 @@
          * Only warn on first time through for this pid.
          *
          * XXX: Could just write first time through too, although
          *      that may screw up scripts written to do something
          *      based on the last modification time of the pid file.
          */
-        ap_log_perror(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, p,
+        ap_log_perror(APLOG_MARK, APLOG_WARNING, 0, p,
                       apr_psprintf(p, "pid file %s overwritten -- Unclean "
                                    "shutdown of previous Apache run?",
                                    fname));
     }
 
     if ((rv = apr_file_open(&pid_file, fname,
                             APR_WRITE | APR_CREATE | APR_TRUNCATE,
                             APR_UREAD | APR_UWRITE | APR_GREAD | APR_WREAD, p))
         != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_ERR, rv, NULL,
                      "could not create %s", fname);
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                      "%s: could not log pid to file %s",
                      ap_server_argv0, fname);
         exit(1);
     }
     apr_file_printf(pid_file, "%ld" APR_EOL_STR, (long)mypid);
     apr_file_close(pid_file);
     saved_pid = mypid;
 }
 
+AP_DECLARE(apr_status_t) ap_read_pid(apr_pool_t *p, const char *filename,
+                                     pid_t *mypid)
+{
+    const apr_size_t BUFFER_SIZE = sizeof(long) * 3 + 2; /* see apr_ltoa */
+    apr_file_t *pid_file = NULL;
+    apr_status_t rv;
+    const char *fname;
+    char *buf, *endptr;
+    apr_size_t bytes_read;
+
+    if (!filename) {
+        return APR_EGENERAL;
+    }
+
+    fname = ap_server_root_relative(p, filename);
+    if (!fname) {
+        ap_log_error(APLOG_MARK, APLOG_STARTUP|APLOG_CRIT, APR_EBADPATH, 
+                     NULL, "Invalid PID file path %s, ignoring.", filename);
+        return APR_EGENERAL;
+    }
+
+    rv = apr_file_open(&pid_file, fname, APR_READ, APR_OS_DEFAULT, p);
+    if (rv != APR_SUCCESS) {
+        return rv;
+    }
+
+    /* Ensure null-termination, so that strtol doesn't go crazy. */
+    buf = apr_palloc(p, BUFFER_SIZE);
+    buf[BUFFER_SIZE - 1] = '\0';
+
+    rv = apr_file_read_full(pid_file, buf, BUFFER_SIZE - 1, &bytes_read);
+    if (rv != APR_SUCCESS && rv != APR_EOF) {
+        return rv;
+    }
+
+    /* If we fill the buffer, we're probably reading a corrupt pid file.
+     * To be nice, let's also ensure the first char is a digit. */
+    if (bytes_read == BUFFER_SIZE - 1 || !apr_isdigit(*buf)) {
+        return APR_EGENERAL;
+    }
+
+    *mypid = strtol(buf, &endptr, 10);
+
+    apr_file_close(pid_file);
+    return APR_SUCCESS;
+}
+
 AP_DECLARE(void) ap_log_assert(const char *szExp, const char *szFile,
                                int nLine)
 {
     char time_str[APR_CTIME_LEN];
 
     apr_ctime(time_str, apr_time_now());
-    ap_log_error(APLOG_MARK, APLOG_CRIT | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_CRIT, 0, NULL,
                  "[%s] file %s, line %d, assertion \"%s\" failed",
                  time_str, szFile, nLine, szExp);
 #if defined(WIN32)
     DebugBreak();
 #else
     /* unix assert does an abort leading to a core dump */
@@ -660,13 +707,13 @@
         ((status = apr_procattr_child_in_set(procattr,
                                              ap_piped_log_read_fd(pl),
                                              ap_piped_log_write_fd(pl)))
         != APR_SUCCESS)) {
         char buf[120];
         /* Something bad happened, give up and go away. */
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "piped_log_spawn: unable to setup child process '%s': %s",
                      pl->program, apr_strerror(status, buf, sizeof(buf)));
         rc = -1;
     }
     else {
         char **args;
@@ -716,13 +763,13 @@
             break;
         }
         if ((stats = piped_log_spawn(pl)) != APR_SUCCESS) {
             /* what can we do?  This could be the error log we're having
              * problems opening up... */
             char buf[120];
-            ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                          "piped_log_maintenance: unable to respawn '%s': %s",
                          pl->program, apr_strerror(stats, buf, sizeof(buf)));
         }
         break;
 
     case APR_OC_REASON_UNWRITABLE:
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/main.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/main.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/main.c	2002-04-18 00:36:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/main.c	2002-06-13 03:34:56.000000000 +0800
@@ -73,12 +73,13 @@
 #include "http_log.h"
 #include "http_config.h"
 #include "http_vhost.h"
 #include "apr_uri.h"
 #include "util_ebcdic.h"
 #include "ap_mpm.h"
+#include "mpm_common.h"
 
 /* WARNING: Win32 binds http_main.c dynamically to the server. Please place
  *          extern functions and global data in another appropriate module.
  *
  * Most significant main() global data can be found in http_config.c
  */
@@ -226,14 +227,14 @@
 #endif
 
 #ifdef DEFAULT_ERRORLOG
     printf(" -D DEFAULT_ERRORLOG=\"" DEFAULT_ERRORLOG "\"\n");
 #endif
 
-#ifdef TYPES_CONFIG_FILE
-    printf(" -D TYPES_CONFIG_FILE=\"" TYPES_CONFIG_FILE "\"\n");
+#ifdef AP_TYPES_CONFIG_FILE
+    printf(" -D AP_TYPES_CONFIG_FILE=\"" AP_TYPES_CONFIG_FILE "\"\n");
 #endif
 
 #ifdef SERVER_CONFIG_FILE
     printf(" -D SERVER_CONFIG_FILE=\"" SERVER_CONFIG_FILE "\"\n");
 #endif
 }
@@ -288,103 +289,103 @@
         pad[i] = ' ';
     }
 
     pad[i] = '\0';
 
 #ifdef SHARED_CORE
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL ,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL ,
                  "Usage: %s [-R directory] [-D name] [-d directory] [-f file]",
                  bin);
 #else
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "Usage: %s [-D name] [-d directory] [-f file]", bin);
 #endif
 
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "       %s [-C \"directive\"] [-c \"directive\"]", pad);
 
 #ifdef WIN32
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "       %s [-k start|restart|stop|shutdown]", pad);
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "       %s [-k install|config|uninstall] [-n service_name]",
                  pad);
 #endif
-
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
-                 "       %s [-v] [-V] [-h] [-l] [-L] [-t] [-T]", pad);
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+#ifdef AP_MPM_WANT_SIGNAL_SERVER
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
+                 "       %s [-k start|restart|graceful|stop]",
+                 pad);
+#endif
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
+                 "       %s [-v] [-V] [-h] [-l] [-L] [-t]", pad);
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "Options:");
 
 #ifdef SHARED_CORE
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -R directory      : specify an alternate location for "
                  "shared object files");
 #endif
 
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -D name           : define a name for use in "
                  "<IfDefine name> directives");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -d directory      : specify an alternate initial "
                  "ServerRoot");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -f file           : specify an alternate ServerConfigFile");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -C \"directive\"    : process directive before reading "
                  "config files");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -c \"directive\"    : process directive after reading "
                  "config files");
 
 #ifdef WIN32
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -n name           : set service name and use its "
                  "ServerConfigFile");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k start          : tell Apache to start");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k restart        : tell running Apache to do a graceful "
                  "restart");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k stop|shutdown  : tell running Apache to shutdown");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k install        : install an Apache service");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k config         : change startup Options of an Apache "
                  "service");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -k uninstall      : uninstall an Apache service");
 #endif
 
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -e level          : show startup errors of level "
                  "(see LogLevel)");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -E file           : log startup errors to file");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -v                : show version number");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -V                : show compile settings");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -h                : list available command line options "
                  "(this page)");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -l                : list compiled in modules");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -L                : list available configuration "
                  "directives");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                  "  -t -D DUMP_VHOSTS : show parsed settings (currently only "
                  "vhost settings)");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
-                 "  -t                : run syntax check for config files "
-                 "(with docroot check)");
-    ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
-                 "  -T                : run syntax check for config files "
-                 "(without docroot check)");
+    ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
+                 "  -t                : run syntax check for config files");
 
     destroy_and_exit_process(process, 1);
 }
 
 int main(int argc, const char * const argv[])
 {
@@ -401,14 +402,15 @@
     apr_pool_t *ptemp; /* Pool for temporary config stuff, reset often */
     apr_pool_t *pcommands; /* Pool for -D, -C and -c switches */
     apr_getopt_t *opt;
     apr_status_t rv;
     module **mod;
     const char *optarg;
+    APR_OPTIONAL_FN_TYPE(ap_signal_server) *signal_server;
 
-    AP_MONCONTROL(0); /* turn of profiling of startup */
+    AP_MONCONTROL(0); /* turn off profiling of startup */
 
     apr_app_initialize(&argc, &argv, NULL);
 
     process = create_process(argc, argv);
     pglobal = process->pool;
     pconf = process->pconf;
@@ -527,13 +529,13 @@
         case '?':
             usage(process);
         }
     }
 
     /* bad cmdline option?  then we die */
-    if (rv != APR_EOF) {
+    if (rv != APR_EOF || opt->ind < opt->argc) {
         usage(process);
     }
 
     apr_pool_create(&plog, pglobal);
     apr_pool_tag(plog, "plog");
     apr_pool_create(&ptemp, pconf);
@@ -548,39 +550,47 @@
     ap_server_root = def_server_root;
     if (temp_error_log) {
         ap_replace_stderr_log(process->pool, temp_error_log);
     }
     server_conf = ap_read_config(process, ptemp, confname, &ap_conftree);
     if (ap_run_pre_config(pconf, plog, ptemp) != OK) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR| APLOG_NOERRNO, 0,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR, 0,
                      NULL, "Pre-configuration failed\n");
         destroy_and_exit_process(process, 1);
     }
 
     ap_process_config_tree(server_conf, ap_conftree, process->pconf, ptemp);
     ap_fixup_virtual_hosts(pconf, server_conf);
     ap_fini_vhost_config(pconf, server_conf);
     apr_sort_hooks();
     if (configtestonly) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
-                     "Syntax OK\n");
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, "Syntax OK");
         destroy_and_exit_process(process, 0);
     }
 
+    signal_server = APR_RETRIEVE_OPTIONAL_FN(ap_signal_server);
+    if (signal_server) {
+        int exit_status;
+
+        if (signal_server(&exit_status, pconf) != 0) {
+            destroy_and_exit_process(process, exit_status);
+        }
+    }
+
     apr_pool_clear(plog);
 
     /* It is assumed that if you are going to fail the open_logs phase, then
      * you will print out your own message that explains what has gone wrong.
      * The server doesn't need to do that for you.
      */
     if ( ap_run_open_logs(pconf, plog, ptemp, server_conf) != OK) {
         destroy_and_exit_process(process, 1);
     }
 
     if ( ap_run_post_config(pconf, plog, ptemp, server_conf) != OK) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR| APLOG_NOERRNO, 0,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR, 0,
                      NULL, "Configuration Failed\n");
         destroy_and_exit_process(process, 1);
     }
 
     apr_pool_destroy(ptemp);
 
@@ -599,30 +609,30 @@
         ap_conftree = NULL;
         apr_pool_create(&ptemp, pconf);
         apr_pool_tag(ptemp, "ptemp");
         ap_server_root = def_server_root;
         server_conf = ap_read_config(process, ptemp, confname, &ap_conftree);
         if (ap_run_pre_config(pconf, plog, ptemp) != OK) {
-            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR| APLOG_NOERRNO,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR,
                          0, NULL, "Pre-configuration failed\n");
             destroy_and_exit_process(process, 1);
         }
 
         ap_process_config_tree(server_conf, ap_conftree, process->pconf, ptemp);
         ap_fixup_virtual_hosts(pconf, server_conf);
         ap_fini_vhost_config(pconf, server_conf);
         apr_sort_hooks();
         apr_pool_clear(plog);
         if (ap_run_open_logs(pconf, plog, ptemp, server_conf) != OK) {
-            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR| APLOG_NOERRNO,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR,
                          0, NULL, "Unable to open logs\n");
             destroy_and_exit_process(process, 1);
         }
 
         if (ap_run_post_config(pconf, plog, ptemp, server_conf) != OK) {
-            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR | APLOG_NOERRNO,
+            ap_log_error(APLOG_MARK, APLOG_STARTUP |APLOG_ERR,
                          0, NULL, "Configuration Failed\n");
             destroy_and_exit_process(process, 1);
         }
 
         apr_pool_destroy(ptemp);
         apr_pool_lock(pconf, 1);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/beos/beos.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/beos/beos.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/beos/beos.c	2002-04-16 00:56:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/beos/beos.c	2002-05-30 08:21:27.000000000 +0800
@@ -334,13 +334,13 @@
     int csd;
     ap_sb_handle_t *sbh;
 
     (void)apr_os_sock_get(&csd, sock);
     
     if (csd >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                      "filedescriptor (%u) larger than FD_SETSIZE (%u) "
                      "found, you probably need to rebuild Apache with a "
                      "larger FD_SETSIZE", csd, FD_SETSIZE);
         apr_socket_close(sock);
         return;
     }
@@ -381,13 +381,13 @@
     /* block the signals for this thread */
     sigfillset(&sig_mask);
     sigprocmask(SIG_BLOCK, &sig_mask, NULL);
 
     apr_allocator_create(&allocator);
     apr_pool_create_ex(&ptrans, tpool, NULL, allocator);
-    apr_allocator_set_owner(allocator, ptrans);
+    apr_allocator_owner_set(allocator, ptrans);
 
     apr_pool_tag(ptrans, "transaction");
 
     apr_thread_mutex_lock(worker_thread_count_mutex);
     worker_thread_count++;
     apr_thread_mutex_unlock(worker_thread_count_mutex);
@@ -500,13 +500,13 @@
     }
 
     ap_update_child_status_from_indexes(0, child_slot, SERVER_DEAD, (request_rec*)NULL);
 
     apr_bucket_alloc_destroy(bucket_alloc);
 
-    ap_log_error(APLOG_MARK, APLOG_NOTICE | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, NULL,
                  "worker_thread %ld exiting", find_thread(NULL));
     
     apr_thread_mutex_lock(worker_thread_count_mutex);
     worker_thread_count--;
     apr_thread_mutex_unlock(worker_thread_count_mutex);
 
@@ -562,13 +562,13 @@
 
 static void check_restart(void *data)
 {
     if (!restart_pending && !shutdown_pending) {
         int slot = (int)data;
         make_worker(slot);
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_INFO, 0, NULL, 
             "spawning a new worker thread in slot %d", slot);
     }
 }
 
 /* start up a bunch of children */
 static void startup_threads(int number_to_start)
@@ -691,13 +691,13 @@
             }
             else if (is_graceful) {
                 /* Great, we've probably just lost a slot in the
                  * scoreboard.  Somehow we don't know about this
                  * child.
                  */
-                 ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, ap_server_conf,
+                 ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ap_server_conf,
 			                  "long lost child came home! (pid %ld)", pid.pid);
             }
 	    
             /* Don't perform idle maintenance when a child dies,
              * only do it when there's a timeout.  Remember only a
              * finite number of children can die, and it's pretty
@@ -803,13 +803,13 @@
         ap_log_error(APLOG_MARK, APLOG_ALERT, errno, s,
             "couldn't bind UDP socket!");
         return 1;
     }
  
     if ((num_listening_sockets = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, 0, s,
             "no listening sockets available, shutting down");
         return 1;
     }
 
     ap_log_pid(pconf, ap_pid_fname);
 
@@ -909,17 +909,17 @@
         hold_off_on_exponential_spawning = 10;
     }
 
     /*
      * record that we've entered the world !
      */
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		"%s configured -- resuming normal operations",
 		ap_get_server_version());
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
 		"Server built: %s", ap_get_server_built());
 
     restart_pending = shutdown_pending = 0;
 
     /*
      * main_loop until it's all over
@@ -940,13 +940,13 @@
     apr_socket_close(listening_sockets[0]);
 
     if ((one_process || shutdown_pending) && !child_fatal) {
         const char *pidfile = NULL;
         pidfile = ap_server_root_relative (pconf, ap_pid_fname);
         if ( pidfile != NULL && unlink(pidfile) == 0)
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                          "removed PID file %s (pid=%ld)", pidfile, 
                          (long)getpid());
     }
 
     if (one_process) {
         return 1;
@@ -965,34 +965,34 @@
       
         /* use ap_reclaim_child_processes starting with SIGTERM */
         ap_reclaim_child_processes(1);
 
         if (!child_fatal) {         /* already recorded */
             /* record the shutdown in the log */
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                          "caught SIGTERM, shutting down");
         }
     
         return 1;
     }
 
     /* we've been told to restart */
     signal(SIGHUP, SIG_IGN);
 
     if (is_graceful) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    AP_SIG_GRACEFUL_STRING " received.  Doing graceful restart");
     }
     else {
         /* Kill 'em all.  Since the child acts the same on the parents SIGTERM 
          * and a SIGHUP, we may as well use the same signal, because some user
          * pthreads are stealing signals from us left and right.
          */
 	    
         ap_reclaim_child_processes(1);		/* Start with SIGTERM */
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+	    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    "SIGHUP received.  Attempting to restart");
     }
     
     /* just before we go, tidy up the locks we've created to prevent a 
      * potential leak of semaphores... */
     apr_thread_mutex_destroy(worker_thread_count_mutex);
@@ -1064,13 +1064,13 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_to_start = atoi(arg);
     if (ap_threads_to_start < 0) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "StartThreads set to a value less than 0, reset to 1");
         ap_threads_to_start = 1;
     }
     return NULL;
 }
 
@@ -1080,17 +1080,17 @@
     if (err != NULL) {
         return err;
     }
 
     min_spare_threads = atoi(arg);
     if (min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        min_spare_threads = 1;
     }
        
     return NULL;
 }
@@ -1112,24 +1112,24 @@
     if (err != NULL) {
         return err;
     }
 
     ap_thread_limit = atoi(arg);
     if (ap_thread_limit > HARD_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients of %d exceeds compile time limit "
                     "of %d servers,", ap_thread_limit, HARD_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering MaxClients to %d.  To increase, please "
                     "see the", HARD_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " HARD_THREAD_LIMIT define in server/mpm/beos/mpm_default.h.");
        ap_thread_limit = HARD_THREAD_LIMIT;
     } 
     else if (ap_thread_limit < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require MaxClients > 0, setting to %d", HARD_THREAD_LIMIT);
         ap_thread_limit = HARD_THREAD_LIMIT;
     }
     return NULL;
 }
 
@@ -1139,13 +1139,13 @@
     if (err != NULL) {
         return err;
     }
 
     ap_max_requests_per_thread = atoi(arg);
     if (ap_max_requests_per_thread < 0) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "WARNING: MaxRequestsPerThread was set below 0"
                      "reset to 0, but this may not be what you want.");
         ap_max_requests_per_thread = 0;
     }
 
     return NULL;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm: .deps
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/leader.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/leader.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/leader.c	2002-04-28 09:58:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/leader.c	2002-06-07 22:08:04.000000000 +0800
@@ -100,13 +100,12 @@
 #include "http_log.h" 
 #include "http_config.h"        /* for read_config */ 
 #include "http_core.h"          /* for get_remote_host */ 
 #include "http_connection.h"
 #include "ap_mpm.h"
 #include "mpm_common.h"
-#include "pod.h"
 #include "ap_listen.h"
 #include "scoreboard.h" 
 #include "mpm_default.h"
 
 #include <signal.h>
 #include <limits.h>             /* for INT_MAX */
@@ -386,12 +385,15 @@
     int i;
     apr_status_t rv;
 
     if ((rv = apr_thread_mutex_lock(stack->mutex)) != APR_SUCCESS) {
         return rv;
     }
+    if (stack->terminated) {
+        return apr_thread_mutex_unlock(stack->mutex);
+    }
     stack->terminated = 1;
     while (stack->nelts) {
         worker_wakeup_info *wakeup = stack->stack[--stack->nelts];
         /* Acquire and release the idle worker's mutex to ensure
          * that it's actually waiting on its condition variable
          */
@@ -423,12 +425,13 @@
 static void signal_threads(int mode)
 {
     if (terminate_mode == mode) {
         return;
     }
     terminate_mode = mode;
+    workers_may_exit = 1;
 
     worker_stack_term(idle_worker_stack);
 }
 
 AP_DECLARE(apr_status_t) ap_mpm_query(int query_code, int *result)
 {
@@ -477,22 +480,23 @@
 static void clean_child_exit(int code) __attribute__ ((noreturn));
 static void clean_child_exit(int code)
 {
     if (pchild) {
         apr_pool_destroy(pchild);
     }
+    ap_mpm_pod_close(pod);
     exit(code);
 }
 
 /* handle all varieties of core dumping signals */
 static void sig_coredump(int sig)
 {
     apr_filepath_set(ap_coredump_dir, pconf);
     apr_signal(sig, SIG_DFL);
     if (ap_my_pid == parent_pid) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE,
                      0, ap_server_conf,
                      "seg fault or similar nasty error detected "
                      "in the parent process");
         
         /* XXX we can probably add some rudimentary cleanup code here,
          * like getting rid of the pid file.  If any additional bad stuff
@@ -568,12 +572,22 @@
     restart_pending = 1;
     is_graceful = graceful;
 }
 
 static void sig_term(int sig)
 {
+    if (ap_my_pid == parent_pid) {
+        ap_start_shutdown();
+    }
+    else {
+        signal_threads(ST_GRACEFUL);
+    }
+}
+
+static void child_sig_term(int sig)
+{
     ap_start_shutdown();
 }
 
 static void restart(int sig)
 {
     ap_start_restart(sig == AP_SIG_GRACEFUL);
@@ -720,13 +734,13 @@
     ap_sb_handle_t *sbh;
 
     ap_create_sb_handle(&sbh, p, my_child_num, my_thread_num);
     apr_os_sock_get(&csd, sock);
 
     if (csd >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                      "new file descriptor %d is too large; you probably need "
                      "to rebuild Apache with a larger FD_SETSIZE "
                      "(currently %d)", 
                      csd, FD_SETSIZE);
         apr_socket_close(sock);
         return;
@@ -805,13 +819,13 @@
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
     free(ti);
 
     apr_allocator_create(&allocator);
     apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
-    apr_allocator_set_owner(allocator, ptrans);
+    apr_allocator_owner_set(allocator, ptrans);
     bucket_alloc = apr_bucket_alloc_create(tpool);
 
     apr_poll_setup(&pollset, num_listensocks, tpool);
     for(lr = ap_listeners ; lr != NULL ; lr = lr->next)
         apr_poll_socket_add(pollset, lr->sd, APR_POLLIN);
 
@@ -936,12 +950,18 @@
                 worker_stack_awaken_next(idle_worker_stack);
                 process_socket(ptrans, csd, process_slot,
                                thread_slot, bucket_alloc);
                 apr_pool_clear(ptrans);
                 requests_this_child--;
             }
+            if ((ap_mpm_pod_check(pod) == APR_SUCCESS) ||
+                (ap_my_generation !=
+                 ap_scoreboard_image->global->running_generation)) {
+                signal_threads(ST_GRACEFUL);
+                break;
+            }
         }
         else {
             if ((rv = SAFE_ACCEPT(apr_proc_mutex_unlock(accept_mutex)))
                 != APR_SUCCESS) {
                 ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
                              "apr_proc_mutex_unlock failed. Attempting to "
@@ -949,17 +969,17 @@
                 signal_threads(ST_GRACEFUL);
             }
             break;
         }
     }
 
-    workers_may_exit = 1;
-    worker_stack_term(idle_worker_stack);
     dying = 1;
     ap_scoreboard_image->parent[process_slot].quiescing = 1;
 
+    worker_stack_term(idle_worker_stack);
+
     ap_update_child_status_from_indexes(process_slot, thread_slot,
         (dying) ? SERVER_DEAD : SERVER_GRACEFUL, (request_rec *) NULL);
 
     apr_bucket_alloc_destroy(bucket_alloc);
 
     apr_thread_exit(thd, APR_SUCCESS);
@@ -994,13 +1014,13 @@
     int threads_created = 0;
     int loops;
     int prev_threads_created;
 
     idle_worker_stack = worker_stack_create(pchild, ap_threads_per_child);
     if (idle_worker_stack == NULL) {
-        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, 0, ap_server_conf,
                      "worker_stack_create() failed");
         clean_child_exit(APEXIT_CHILDFATAL);
     }
 
     loops = prev_threads_created = 0;
     while (1) {
@@ -1218,47 +1238,14 @@
     else { /* !one_process */
         /* remove SIGTERM from the set of blocked signals...  if one of
          * the other threads in the process needs to take us down
          * (e.g., for MaxRequestsPerChild) it will send us SIGTERM
          */
         unblock_signal(SIGTERM);
-        apr_signal(SIGTERM, dummy_signal_handler);
-        /* Watch for any messages from the parent over the POD */
-        while (1) {
-            rv = ap_mpm_pod_check(pod);
-            if (rv == AP_NORESTART) {
-                /* see if termination was triggered while we slept */
-                switch(terminate_mode) {
-                case ST_GRACEFUL:
-                    rv = AP_GRACEFUL;
-                    break;
-                case ST_UNGRACEFUL:
-                    rv = AP_RESTART;
-                    break;
-                }
-            }
-            if (rv == AP_GRACEFUL || rv == AP_RESTART) {
-                /* make sure the start thread has finished; 
-                 * signal_threads() and join_workers depend on that
-                 */
-                join_start_thread(start_thread_id);
-                signal_threads(rv == AP_GRACEFUL ? ST_GRACEFUL : ST_UNGRACEFUL);
-                break;
-            }
-        }
-
-        if (rv == AP_GRACEFUL) {
-            /* A terminating signal was received. Now join each of the
-             * workers to clean them up.
-             *   If the worker already exited, then the join frees
-             *   their resources and returns.
-             *   If the worker hasn't exited, then this blocks until
-             *   they have (then cleans up).
-             */
-            join_workers(threads);
-        }
+        join_start_thread(start_thread_id);
+        join_workers(threads);
     }
 
     free(threads);
 
     clean_child_exit(resource_shortage ? APEXIT_CHILDSICK : 0);
 }
@@ -1299,13 +1286,13 @@
         /* By default, AIX binds to a single processor.  This bit unbinds
          * children which will then bind to another CPU.
          */
         int status = bindprocessor(BINDPROCESS, (int)getpid(),
                                PROCESSOR_CLASS_ANY);
         if (status != OK)
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, errno, 
+            ap_log_error(APLOG_MARK, APLOG_WARNING, errno, 
                          ap_server_conf,
                          "processor unbind failed %d", status);
 #endif
         RAISE_SIGSTOP(MAKE_CHILD);
 
         apr_signal(SIGTERM, just_die);
@@ -1434,36 +1421,36 @@
         }
     }
     ap_max_daemons_limit = last_non_dead + 1;
 
     if (idle_thread_count > max_spare_threads) {
         /* Kill off one child */
-        ap_mpm_pod_signal(pod, TRUE);
+        ap_mpm_pod_signal(pod);
         idle_spawn_rate = 1;
     }
     else if (idle_thread_count < min_spare_threads) {
         /* terminate the free list */
         if (free_length == 0) {
             /* only report this condition once */
             static int reported = 0;
             
             if (!reported) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, 
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, 
                              ap_server_conf,
                              "server reached MaxClients setting, consider"
                              " raising the MaxClients setting");
                 reported = 1;
             }
             idle_spawn_rate = 1;
         }
         else {
             if (free_length > idle_spawn_rate) {
                 free_length = idle_spawn_rate;
             }
             if (idle_spawn_rate >= 8) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, 
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0, 
                              ap_server_conf,
                              "server seems busy, (you may need "
                              "to increase StartServers, ThreadsPerChild "
                              "or Min/MaxSpareThreads), "
                              "spawning %d children, there are around %d idle "
                              "threads, and %d total children", free_length,
@@ -1534,13 +1521,13 @@
 #endif
             }
             else if (is_graceful) {
                 /* Great, we've probably just lost a slot in the
                  * scoreboard.  Somehow we don't know about this child.
                  */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0,
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                              ap_server_conf,
                              "long lost child came home! (pid %ld)",
                              (long)pid.pid);
             }
             /* Don't perform idle maintenance when a child dies,
              * only do it when there's a timeout.  Remember only a
@@ -1574,13 +1561,13 @@
 
     ap_log_pid(pconf, ap_pid_fname);
 
     first_server_limit = server_limit;
     first_thread_limit = thread_limit;
     if (changed_limit_at_restart) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
                      "WARNING: Attempt to change ServerLimit or ThreadLimit "
                      "ignored during restart");
         changed_limit_at_restart = 0;
     }
     
     /* Initialize cross-process accept lock */
@@ -1645,45 +1632,49 @@
     else {
         /* give the system some time to recover before kicking into
             * exponential mode */
         hold_off_on_exponential_spawning = 10;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                 "%s configured -- resuming normal operations",
                 ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                 "Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     restart_pending = shutdown_pending = 0;
 
     server_main_loop(remaining_children_to_start);
 
     if (shutdown_pending) {
         /* Time to gracefully shut down:
          * Kill child processes, tell them to call child_exit, etc...
          * (By "gracefully" we don't mean graceful in the same sense as 
          * "apachectl graceful" where we allow old connections to finish.)
          */
-        ap_mpm_pod_killpg(pod, ap_daemons_limit, FALSE);
+	if (unixd_killpg(getpgrp(), SIGTERM) < 0) {
+	    ap_log_error(APLOG_MARK, APLOG_WARNING, errno, ap_server_conf, "killpg SIGTERM");
+	}
         ap_reclaim_child_processes(1);                /* Start with SIGTERM */
 
         if (!child_fatal) {
             /* cleanup pid file on normal shutdown */
             const char *pidfile = NULL;
             pidfile = ap_server_root_relative (pconf, ap_pid_fname);
             if ( pidfile != NULL && unlink(pidfile) == 0)
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0,
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0,
                              ap_server_conf,
                              "removed PID file %s (pid=%ld)",
                              pidfile, (long)getpid());
     
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                          ap_server_conf, "caught SIGTERM, shutting down");
         }
         return 1;
     }
 
     /* we've been told to restart */
@@ -1699,32 +1690,32 @@
      * use by any of the children.
      */
     ++ap_my_generation;
     ap_scoreboard_image->global->running_generation = ap_my_generation;
     
     if (is_graceful) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                      AP_SIG_GRACEFUL_STRING " received.  Doing graceful restart");
         /* wake up the children...time to die.  But we'll have more soon */
-        ap_mpm_pod_killpg(pod, ap_daemons_limit, TRUE);
+        ap_mpm_pod_killpg(pod, ap_daemons_limit);
     
 
         /* This is mostly for debugging... so that we know what is still
          * gracefully dealing with existing request.
          */
         
     }
     else {
         /* Kill 'em all.  Since the child acts the same on the parents SIGTERM 
          * and a SIGHUP, we may as well use the same signal, because some user
          * pthreads are stealing signals from us left and right.
          */
-        ap_mpm_pod_killpg(pod, ap_daemons_limit, FALSE);
+        ap_mpm_pod_killpg(pod, ap_daemons_limit);
 
         ap_reclaim_child_processes(1);                /* Start with SIGTERM */
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                     "SIGHUP received.  Attempting to restart");
     }
 
     return 0;
 }
 
@@ -1736,13 +1727,13 @@
     apr_status_t rv;
 
     pconf = p;
     ap_server_conf = s;
 
     if ((num_listensocks = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0,
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0,
                      NULL, "no listening sockets available, shutting down");
         return DONE;
     }
 
     if (!one_process) {
         if ((rv = ap_mpm_pod_open(pconf, &pod))) {
@@ -1876,17 +1867,17 @@
     if (err != NULL) {
         return err;
     }
 
     min_spare_threads = atoi(arg);
     if (min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        min_spare_threads = 1;
     }
        
     return NULL;
 }
@@ -1913,53 +1904,53 @@
     }
 
     /* It is ok to use ap_threads_per_child here because we are
      * sure that it gets set before MaxClients in the pre_config stage. */
     max_clients = atoi(arg);
     if (max_clients < ap_threads_per_child) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) must be at least as large",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " large as ThreadsPerChild (%d). Automatically",
                     ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " increasing MaxClients to %d.",
                     ap_threads_per_child);
        max_clients = ap_threads_per_child;
     }
     ap_daemons_limit = max_clients / ap_threads_per_child;
     if ((max_clients > 0) && (max_clients % ap_threads_per_child)) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) is not an integer multiple",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " of ThreadsPerChild (%d), lowering MaxClients to %d",
                     ap_threads_per_child,
                     ap_daemons_limit * ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " for a maximum of %d child processes,",
                     ap_daemons_limit);
        max_clients = ap_daemons_limit * ap_threads_per_child; 
     }
     if (ap_daemons_limit > server_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients of %d would require %d servers,",
                     max_clients, ap_daemons_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require MaxClients > 0, setting to 1");
         ap_daemons_limit = 1;
     }
     return NULL;
 }
 
@@ -1970,25 +1961,25 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_per_child = atoi(arg);
     if (ap_threads_per_child > thread_limit) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: ThreadsPerChild of %d exceeds ThreadLimit "
                      "value of %d", ap_threads_per_child,
                      thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "threads, lowering ThreadsPerChild to %d. To increase, please"
                      " see the", thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      " ThreadLimit directive.");
         ap_threads_per_child = thread_limit;
     }
     else if (ap_threads_per_child < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadsPerChild > 0, setting to 1");
         ap_threads_per_child = 1;
     }
     return NULL;
 }
 
@@ -2014,21 +2005,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     server_limit = tmp_server_limit;
     
     if (server_limit > MAX_SERVER_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ServerLimit of %d exceeds compile time limit "
                     "of %d servers,", server_limit, MAX_SERVER_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ServerLimit to %d.", MAX_SERVER_LIMIT);
        server_limit = MAX_SERVER_LIMIT;
     } 
     else if (server_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ServerLimit > 0, setting to 1");
 	server_limit = 1;
     }
     return NULL;
 }
 
@@ -2054,21 +2045,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     thread_limit = tmp_thread_limit;
     
     if (thread_limit > MAX_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ThreadLimit of %d exceeds compile time limit "
                     "of %d servers,", thread_limit, MAX_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ThreadLimit to %d.", MAX_THREAD_LIMIT);
        thread_limit = MAX_THREAD_LIMIT;
     } 
     else if (thread_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadLimit > 0, setting to 1");
 	thread_limit = 1;
     }
     return NULL;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/Makefile.in	2002-04-12 12:24:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/Makefile.in	2002-05-22 09:04:59.000000000 +0800
@@ -1,5 +1,5 @@
 
 LTLIBRARY_NAME    = libleader.la
-LTLIBRARY_SOURCES = leader.c pod.c
+LTLIBRARY_SOURCES = leader.c
 
 include $(top_srcdir)/build/ltlib.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/mpm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/mpm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/leader/mpm.h	2002-04-12 12:24:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/leader/mpm.h	2002-05-22 09:04:59.000000000 +0800
@@ -73,12 +73,13 @@
 #define AP_MPM_WANT_SET_LOCKFILE
 #define AP_MPM_WANT_SET_MAX_REQUESTS
 #define AP_MPM_WANT_SET_COREDUMPDIR
 #define AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
 #define AP_MPM_DISABLE_NAGLE_ACCEPTED_SOCK
 
+#define AP_MPM_USES_POD 1
 #define MPM_CHILD_PID(i) (ap_scoreboard_image->parent[i].pid)
 #define MPM_NOTE_CHILD_KILLED(i) (MPM_CHILD_PID(i) = 0)
 #define MPM_ACCEPT_FUNC unixd_accept
 
 extern int ap_threads_per_child;
 extern int ap_max_daemons_limit;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/perchild/perchild.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/perchild/perchild.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/perchild/perchild.c	2002-04-23 02:57:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/perchild/perchild.c	2002-06-14 00:36:19.000000000 +0800
@@ -547,13 +547,13 @@
 
     if ((rv = apr_os_sock_get(&csd, sock)) != APR_SUCCESS) {
         ap_log_error(APLOG_MARK, APLOG_ERR, rv, NULL, "apr_os_sock_get");
     }
 
     if (csd >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                      "new file descriptor %d is too large; you probably need "
                      "to rebuild Apache with a larger FD_SETSIZE "
                      "(currently %d)", 
                      csd, FD_SETSIZE);
         apr_socket_close(sock);
         return;
@@ -600,13 +600,13 @@
         }
     }
     else {
         static int reported = 0;
         
         if (!reported) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0,
                          ap_server_conf,
                          "server reached MaxThreadsPerChild setting, "
                          "consider raising the MaxThreadsPerChild or "
                          "NumServers settings");
             reported = 1;
         }
@@ -1039,13 +1039,13 @@
         /* By default, AIX binds to a single processor.  This bit unbinds
          * children which will then bind to another CPU.
          */
         int status = bindprocessor(BINDPROCESS, (int)getpid(),
                                    PROCESSOR_CLASS_ANY);
         if (status != OK) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, errno, 
+            ap_log_error(APLOG_MARK, APLOG_WARNING, errno, 
                          ap_server_conf, "processor unbind failed %d", status);
         }
 #endif
 
         RAISE_SIGSTOP(MAKE_CHILD);
 
@@ -1187,13 +1187,13 @@
             }
             else if (is_graceful) {
                 /* Great, we've probably just lost a slot in the
                 * child table.  Somehow we don't know about this
                 * child.
                 */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, 
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0, 
                              ap_server_conf,
                              "long lost child came home! (pid %ld)", 
                              (long)pid.pid);
             }
             /* Don't perform idle maintenance when a child dies,
              * only do it when there's a timeout.  Remember only a
@@ -1232,13 +1232,13 @@
 
     ap_log_pid(pconf, ap_pid_fname);
 
     first_server_limit = server_limit;
     first_thread_limit = thread_limit;
     if (changed_limit_at_restart) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
                      "WARNING: Attempt to change ServerLimit or ThreadLimit "
                      "ignored during restart");
         changed_limit_at_restart = 0;
     }
 
     ap_server_conf = s;
@@ -1316,20 +1316,22 @@
     else {
         /* give the system some time to recover before kicking into
          * exponential mode */
         hold_off_on_exponential_spawning = 10;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                  "%s configured -- resuming normal operations",
                  ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                  "Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(process_accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     restart_pending = shutdown_pending = 0;
 
     server_main_loop(remaining_children_to_start);
 
     if (shutdown_pending) {
@@ -1344,19 +1346,19 @@
 
         if (!child_fatal) {
             /* cleanup pid file on normal shutdown */
             const char *pidfile = NULL;
             pidfile = ap_server_root_relative (pconf, ap_pid_fname);
             if (pidfile != NULL && unlink(pidfile) == 0) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0,
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0,
                              ap_server_conf,
                              "removed PID file %s (pid=%ld)",
                              pidfile, (long)getpid());
             }
     
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                          ap_server_conf, "caught SIGTERM, shutting down");
         }
         return 1;
     }
 
     /* we've been told to restart */
@@ -1367,13 +1369,13 @@
         return 1;
     }
 
     if (is_graceful) {
         char char_of_death = '!';
 
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                      ap_server_conf, AP_SIG_GRACEFUL_STRING " received.  "
                      "Doing graceful restart");
 
         /* This is mostly for debugging... so that we know what is still
          * gracefully dealing with existing request.
          */
@@ -1401,13 +1403,13 @@
          */
         if (unixd_killpg(getpgrp(), SIGTERM) < 0) {
             ap_log_error(APLOG_MARK, APLOG_WARNING, errno, ap_server_conf,
                          "killpg SIGTERM");
         }
         ap_reclaim_child_processes(1);      /* Start with SIGTERM */
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                      ap_server_conf, "SIGHUP received.  Attempting to restart");
     }
     return 0;
 }
 
 /* This really should be a post_config hook, but the error log is already
@@ -1418,13 +1420,13 @@
     apr_status_t rv;
 
     pconf = p;
     ap_server_conf = s;
 
     if ((num_listensocks = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0,
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0,
                      NULL, "no listening sockets available, shutting down");
         return DONE;
     }
 
     ap_log_pid(pconf, ap_pid_fname);
 
@@ -1668,13 +1670,13 @@
     else {
         /* sconf is the server config for this vhost, so if our socket
          * is not the same that was set in the config, then the request
          * needs to be passed to another child. */
         if (sconf->sd != child_info_table[child_num].sd) {
             if (pass_request(r) == -1) {
-                ap_log_error(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0,
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0,
                              ap_server_conf, "Could not pass request to proper "
                              "child, request will not be honored.");
             }
             longjmp(jmpbuffer, 1); 
         }
         return OK;
@@ -1711,24 +1713,24 @@
     if (err != NULL) {
         return err;
     }
 
     num_daemons = atoi(arg);
     if (num_daemons > server_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: NumServers of %d exceeds ServerLimit value "
                     "of %d servers,", num_daemons, server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering NumServers to %d.  To increase, please "
                     "see the", server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " ServerLimit directive.");
        num_daemons = server_limit;
     } 
     else if (num_daemons < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require NumServers > 0, setting to 1");
         num_daemons = 1;
     }
     return NULL;
 }
 
@@ -1739,24 +1741,24 @@
     if (err != NULL) {
         return err;
     }
 
     threads_to_start = atoi(arg);
     if (threads_to_start > thread_limit) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: StartThreads of %d exceeds ThreadLimit value"
                      " of %d threads,", threads_to_start,
                      thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      " lowering StartThreads to %d. To increase, please"
                      " see the", thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      " ThreadLimit directive.");
     }
     else if (threads_to_start < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require StartThreads > 0, setting to 1");
         threads_to_start = 1;
     }
     return NULL;
 }
 
@@ -1767,17 +1769,17 @@
     if (err != NULL) {
         return err;
     }
 
     min_spare_threads = atoi(arg);
     if (min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        min_spare_threads = 1;
     }
        
     return NULL;
 }
@@ -1789,15 +1791,15 @@
     if (err != NULL) {
         return err;
     }
 
     max_spare_threads = atoi(arg);
     if (max_spare_threads >= thread_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set higher than");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "ThreadLimit. Resetting to %d", thread_limit);
        max_spare_threads = thread_limit;
     }
     return NULL;
 }
 
@@ -1807,15 +1809,15 @@
     if (err != NULL) {
         return err;
     }
 
     max_threads = atoi(arg);
     if (max_threads > thread_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MaxThreadsPerChild set higher than");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "ThreadLimit. Resetting to %d", thread_limit);
        max_threads = thread_limit;
     }
     return NULL;
 }
 
@@ -1903,21 +1905,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     server_limit = tmp_server_limit;
     
     if (server_limit > MAX_SERVER_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ServerLimit of %d exceeds compile time limit "
                     "of %d servers,", server_limit, MAX_SERVER_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ServerLimit to %d.", MAX_SERVER_LIMIT);
        server_limit = MAX_SERVER_LIMIT;
     } 
     else if (server_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ServerLimit > 0, setting to 1");
 	server_limit = 1;
     }
     return NULL;
 }
 
@@ -1943,21 +1945,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     thread_limit = tmp_thread_limit;
     
     if (thread_limit > MAX_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ThreadLimit of %d exceeds compile time limit "
                     "of %d servers,", thread_limit, MAX_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ThreadLimit to %d.", MAX_THREAD_LIMIT);
        thread_limit = MAX_THREAD_LIMIT;
     } 
     else if (thread_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadLimit > 0, setting to 1");
 	thread_limit = 1;
     }
     return NULL;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/threadpool/mpm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/threadpool/mpm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/threadpool/mpm.h	2002-04-17 07:37:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/threadpool/mpm.h	2002-06-07 07:58:14.000000000 +0800
@@ -71,12 +71,13 @@
 #define AP_MPM_WANT_SET_PIDFILE
 #define AP_MPM_WANT_SET_SCOREBOARD
 #define AP_MPM_WANT_SET_LOCKFILE
 #define AP_MPM_WANT_SET_MAX_REQUESTS
 #define AP_MPM_WANT_SET_COREDUMPDIR
 #define AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
+#define AP_MPM_WANT_SIGNAL_SERVER
 #define AP_MPM_DISABLE_NAGLE_ACCEPTED_SOCK
 
 #define MPM_CHILD_PID(i) (ap_scoreboard_image->parent[i].pid)
 #define MPM_NOTE_CHILD_KILLED(i) (MPM_CHILD_PID(i) = 0)
 #define MPM_ACCEPT_FUNC unixd_accept
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/threadpool/threadpool.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/threadpool/threadpool.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/experimental/threadpool/threadpool.c	2002-04-29 07:28:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/experimental/threadpool/threadpool.c	2002-06-07 22:08:04.000000000 +0800
@@ -537,13 +537,13 @@
 /* handle all varieties of core dumping signals */
 static void sig_coredump(int sig)
 {
     apr_filepath_set(ap_coredump_dir, pconf);
     apr_signal(sig, SIG_DFL);
     if (ap_my_pid == parent_pid) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE,
                      0, ap_server_conf,
                      "seg fault or similar nasty error detected "
                      "in the parent process");
         
         /* XXX we can probably add some rudimentary cleanup code here,
          * like getting rid of the pid file.  If any additional bad stuff
@@ -774,13 +774,13 @@
     ap_sb_handle_t *sbh;
 
     ap_create_sb_handle(&sbh, p, my_child_num, my_thread_num);
     apr_os_sock_get(&csd, sock);
 
     if (csd >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                      "new file descriptor %d is too large; you probably need "
                      "to rebuild Apache with a larger FD_SETSIZE "
                      "(currently %d)", 
                      csd, FD_SETSIZE);
         apr_socket_close(sock);
         return;
@@ -1043,13 +1043,13 @@
     free(ti);
 
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
     apr_allocator_create(&allocator);
     apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
-    apr_allocator_set_owner(allocator, ptrans);
+    apr_allocator_owner_set(allocator, ptrans);
 
     /* XXX: What happens if this is allocated from the
      * single-thread-optimized ptrans pool? -aaron */
     bucket_alloc = apr_bucket_alloc_create(tpool);
 
     wakeup = (worker_wakeup_info *)apr_palloc(tpool, sizeof(*wakeup));
@@ -1156,13 +1156,13 @@
     int threads_created = 0;
     int loops;
     int prev_threads_created;
 
     idle_worker_stack = worker_stack_create(pchild, ap_threads_per_child);
     if (idle_worker_stack == NULL) {
-        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, 0, ap_server_conf,
                      "worker_stack_create() failed");
         clean_child_exit(APEXIT_CHILDFATAL);
     }
 
     loops = prev_threads_created = 0;
     while (1) {
@@ -1506,13 +1506,13 @@
         /* By default, AIX binds to a single processor.  This bit unbinds
          * children which will then bind to another CPU.
          */
         int status = bindprocessor(BINDPROCESS, (int)getpid(),
                                PROCESSOR_CLASS_ANY);
         if (status != OK)
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, errno, 
+            ap_log_error(APLOG_MARK, APLOG_WARNING, errno, 
                          ap_server_conf,
                          "processor unbind failed %d", status);
 #endif
         RAISE_SIGSTOP(MAKE_CHILD);
 
         apr_signal(SIGTERM, just_die);
@@ -1651,26 +1651,26 @@
         /* terminate the free list */
         if (free_length == 0) {
             /* only report this condition once */
             static int reported = 0;
             
             if (!reported) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, 
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, 
                              ap_server_conf,
                              "server reached MaxClients setting, consider"
                              " raising the MaxClients setting");
                 reported = 1;
             }
             idle_spawn_rate = 1;
         }
         else {
             if (free_length > idle_spawn_rate) {
                 free_length = idle_spawn_rate;
             }
             if (idle_spawn_rate >= 8) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, 
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0, 
                              ap_server_conf,
                              "server seems busy, (you may need "
                              "to increase StartServers, ThreadsPerChild "
                              "or Min/MaxSpareThreads), "
                              "spawning %d children, there are around %d idle "
                              "threads, and %d total children", free_length,
@@ -1741,13 +1741,13 @@
 #endif
             }
             else if (is_graceful) {
                 /* Great, we've probably just lost a slot in the
                  * scoreboard.  Somehow we don't know about this child.
                  */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0,
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                              ap_server_conf,
                              "long lost child came home! (pid %ld)",
                              (long)pid.pid);
             }
             /* Don't perform idle maintenance when a child dies,
              * only do it when there's a timeout.  Remember only a
@@ -1781,13 +1781,13 @@
 
     ap_log_pid(pconf, ap_pid_fname);
 
     first_server_limit = server_limit;
     first_thread_limit = thread_limit;
     if (changed_limit_at_restart) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
                      "WARNING: Attempt to change ServerLimit or ThreadLimit "
                      "ignored during restart");
         changed_limit_at_restart = 0;
     }
     
     /* Initialize cross-process accept lock */
@@ -1852,20 +1852,22 @@
     else {
         /* give the system some time to recover before kicking into
             * exponential mode */
         hold_off_on_exponential_spawning = 10;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                 "%s configured -- resuming normal operations",
                 ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                 "Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     restart_pending = shutdown_pending = 0;
 
     server_main_loop(remaining_children_to_start);
 
     if (shutdown_pending) {
@@ -1879,18 +1881,18 @@
 
         if (!child_fatal) {
             /* cleanup pid file on normal shutdown */
             const char *pidfile = NULL;
             pidfile = ap_server_root_relative (pconf, ap_pid_fname);
             if ( pidfile != NULL && unlink(pidfile) == 0)
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0,
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0,
                              ap_server_conf,
                              "removed PID file %s (pid=%ld)",
                              pidfile, (long)getpid());
     
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                          ap_server_conf, "caught SIGTERM, shutting down");
         }
         return 1;
     }
 
     /* we've been told to restart */
@@ -1906,13 +1908,13 @@
      * use by any of the children.
      */
     ++ap_my_generation;
     ap_scoreboard_image->global->running_generation = ap_my_generation;
     
     if (is_graceful) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                      AP_SIG_GRACEFUL_STRING " received.  Doing graceful restart");
         /* wake up the children...time to die.  But we'll have more soon */
         ap_mpm_pod_killpg(pod, ap_daemons_limit, TRUE);
     
 
         /* This is mostly for debugging... so that we know what is still
@@ -1925,13 +1927,13 @@
          * and a SIGHUP, we may as well use the same signal, because some user
          * pthreads are stealing signals from us left and right.
          */
         ap_mpm_pod_killpg(pod, ap_daemons_limit, FALSE);
 
         ap_reclaim_child_processes(1);                /* Start with SIGTERM */
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                     "SIGHUP received.  Attempting to restart");
     }
 
     return 0;
 }
 
@@ -1944,13 +1946,13 @@
     ap_listen_rec *lr;
 
     pconf = p;
     ap_server_conf = s;
 
     if ((num_listensocks = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0,
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0,
                      NULL, "no listening sockets available, shutting down");
         return DONE;
     }
 
 #if APR_O_NONBLOCK_INHERITED
     for(lr = ap_listeners ; lr != NULL ; lr = lr->next) {
@@ -2090,17 +2092,17 @@
     if (err != NULL) {
         return err;
     }
 
     min_spare_threads = atoi(arg);
     if (min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        min_spare_threads = 1;
     }
        
     return NULL;
 }
@@ -2127,53 +2129,53 @@
     }
 
     /* It is ok to use ap_threads_per_child here because we are
      * sure that it gets set before MaxClients in the pre_config stage. */
     max_clients = atoi(arg);
     if (max_clients < ap_threads_per_child) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) must be at least as large",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " large as ThreadsPerChild (%d). Automatically",
                     ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " increasing MaxClients to %d.",
                     ap_threads_per_child);
        max_clients = ap_threads_per_child;
     }
     ap_daemons_limit = max_clients / ap_threads_per_child;
     if ((max_clients > 0) && (max_clients % ap_threads_per_child)) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) is not an integer multiple",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " of ThreadsPerChild (%d), lowering MaxClients to %d",
                     ap_threads_per_child,
                     ap_daemons_limit * ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " for a maximum of %d child processes,",
                     ap_daemons_limit);
        max_clients = ap_daemons_limit * ap_threads_per_child; 
     }
     if (ap_daemons_limit > server_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients of %d would require %d servers,",
                     max_clients, ap_daemons_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require MaxClients > 0, setting to 1");
         ap_daemons_limit = 1;
     }
     return NULL;
 }
 
@@ -2184,25 +2186,25 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_per_child = atoi(arg);
     if (ap_threads_per_child > thread_limit) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: ThreadsPerChild of %d exceeds ThreadLimit "
                      "value of %d", ap_threads_per_child,
                      thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "threads, lowering ThreadsPerChild to %d. To increase, please"
                      " see the", thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      " ThreadLimit directive.");
         ap_threads_per_child = thread_limit;
     }
     else if (ap_threads_per_child < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadsPerChild > 0, setting to 1");
         ap_threads_per_child = 1;
     }
     return NULL;
 }
 
@@ -2228,21 +2230,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     server_limit = tmp_server_limit;
     
     if (server_limit > MAX_SERVER_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ServerLimit of %d exceeds compile time limit "
                     "of %d servers,", server_limit, MAX_SERVER_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ServerLimit to %d.", MAX_SERVER_LIMIT);
        server_limit = MAX_SERVER_LIMIT;
     } 
     else if (server_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ServerLimit > 0, setting to 1");
 	server_limit = 1;
     }
     return NULL;
 }
 
@@ -2268,21 +2270,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     thread_limit = tmp_thread_limit;
     
     if (thread_limit > MAX_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ThreadLimit of %d exceeds compile time limit "
                     "of %d servers,", thread_limit, MAX_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ThreadLimit to %d.", MAX_THREAD_LIMIT);
        thread_limit = MAX_THREAD_LIMIT;
     } 
     else if (thread_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadLimit > 0, setting to 1");
 	thread_limit = 1;
     }
     return NULL;
 }
 
@@ -2305,13 +2307,13 @@
   "Maximum worker threads in a server for this run of Apache"),
 { NULL }
 };
 
 module AP_MODULE_DECLARE_DATA mpm_threadpool_module = {
     MPM20_MODULE_STUFF,
-    NULL,                       /* hook to run before apache parses args */
+    ap_mpm_rewrite_args,        /* hook to run before apache parses args */
     NULL,                       /* create per-directory config structure */
     NULL,                       /* merge per-directory config structures */
     NULL,                       /* create per-server config structure */
     NULL,                       /* merge per-server config structures */
     threadpool_cmds,            /* command apr_table_t */
     threadpool_hooks            /* register_hooks */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/mpmt_os2/mpmt_os2.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/mpmt_os2/mpmt_os2.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/mpmt_os2/mpmt_os2.c	2002-04-14 16:38:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/mpmt_os2/mpmt_os2.c	2002-06-07 22:08:04.000000000 +0800
@@ -203,13 +203,13 @@
     else {
         /* Parent process */
         char restart;
         is_parent_process = TRUE;
 
         if (ap_setup_listeners(ap_server_conf) < 1) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, 0, s,
+            ap_log_error(APLOG_MARK, APLOG_ALERT, 0, s,
                          "no listening sockets available, shutting down");
             return 1;
         }
 
         ap_log_pid(pconf, ap_pid_fname);
 
@@ -218,18 +218,18 @@
         ap_scoreboard_image->global->running_generation = ap_my_generation;
 
         if (!restart) {
             const char *pidfile = ap_server_root_relative(pconf, ap_pid_fname);
 
             if (pidfile != NULL && remove(pidfile) == 0) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, APR_SUCCESS,
+                ap_log_error(APLOG_MARK, APLOG_INFO, APR_SUCCESS,
                              ap_server_conf, "removed PID file %s (pid=%d)",
                              pidfile, getpid());
             }
 
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                          "caught SIGTERM, shutting down");
             return 1;
         }
     }  /* Parent process */
 
     return 0; /* Restart */
@@ -250,13 +250,13 @@
     ULONG rc;
 
     printf("%s \n", ap_get_server_version());
     set_signals();
 
     if (ap_setup_listeners(ap_server_conf) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, 0, s,
                      "no listening sockets available, shutting down");
         return FALSE;
     }
 
     /* Allocate a shared memory block for the array of listeners */
     for (num_listeners = 0, lr = ap_listeners; lr; lr = lr->next) {
@@ -307,20 +307,22 @@
         }
 
         ap_init_scoreboard(sb_mem);
     }
 
     ap_scoreboard_image->global->restart_time = apr_time_now();
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		"%s configured -- resuming normal operations",
 		ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
 		"Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     if (one_process) {
         ap_scoreboard_image->parent[0].pid = getpid();
         ap_mpm_child_main(pconf);
         return FALSE;
     }
@@ -545,17 +547,17 @@
         return err;
     }
 
     ap_min_spare_threads = atoi(arg);
 
     if (ap_min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        ap_min_spare_threads = 1;
     }
        
     return NULL;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/mpmt_os2/mpmt_os2_child.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/mpmt_os2/mpmt_os2_child.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/mpmt_os2/mpmt_os2_child.c	2002-04-17 22:55:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/mpmt_os2/mpmt_os2_child.c	2002-05-17 19:11:39.000000000 +0800
@@ -187,13 +187,13 @@
     }
 
     /* Find our pid in the scoreboard so we know what slot our parent allocated us */
     for (child_slot = 0; ap_scoreboard_image->parent[child_slot].pid != my_pid && child_slot < HARD_SERVER_LIMIT; child_slot++);
 
     if (child_slot == HARD_SERVER_LIMIT) {
-        ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf,
                      "child pid not found in scoreboard, exiting");
         clean_child_exit(APEXIT_CHILDFATAL);
     }
 
     ap_my_generation = ap_scoreboard_image->parent[child_slot].generation;
     memset(ap_scoreboard_image->servers[child_slot], 0, sizeof(worker_score) * HARD_THREAD_LIMIT);
@@ -372,13 +372,13 @@
     if (pReportRec->fHandlerFlags & EH_NESTED_CALL) {
         return XCPT_CONTINUE_SEARCH;
     }
 
     if (pReportRec->ExceptionNum == XCPT_ACCESS_VIOLATION ||
         pReportRec->ExceptionNum == XCPT_INTEGER_DIVIDE_BY_ZERO) {
-        ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf,
                      "caught exception in worker thread, initiating child shutdown pid=%d", getpid());
         for (c=0; c<HARD_THREAD_LIMIT; c++) {
             if (ap_scoreboard_image->servers[child_slot][c].tid == _gettid()) {
                 ap_scoreboard_image->servers[child_slot][c].status = SERVER_DEAD;
                 break;
             }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/netware/mpm_netware.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/netware/mpm_netware.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/netware/mpm_netware.c	2002-04-30 22:32:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/netware/mpm_netware.c	2002-06-07 22:08:05.000000000 +0800
@@ -176,14 +176,13 @@
 
 static int die_now = 0;
 
 static apr_thread_mutex_t *accept_mutex = NULL;
 
 /* Keep track of the number of worker threads currently active */
-static int worker_thread_count;
-static apr_thread_mutex_t *worker_thread_count_mutex;
+static unsigned long worker_thread_count;
 static int request_count;
 
 /*  Structure used to register/deregister a console handler with the OS */
 static int InstallConsoleHandler(void);
 static void RemoveConsoleHandler(void);
 static int CommandLineInterpreter(scr_t screenID, const char *commandLine);
@@ -201,18 +200,19 @@
 #define DBPRINT0(s)
 #define DBPRINT1(s,v1)
 #define DBPRINT2(s,v1,v2)
 #endif
 
 /* a clean exit from a child with proper cleanup */
-static void clean_child_exit(int code, int worker_num) __attribute__ ((noreturn));
-static void clean_child_exit(int code, int worker_num)
+static void clean_child_exit(int code, int worker_num, apr_pool_t *ptrans, apr_bucket_alloc_t *bucket_alloc) __attribute__ ((noreturn));
+static void clean_child_exit(int code, int worker_num, apr_pool_t *ptrans, apr_bucket_alloc_t *bucket_alloc)
 {
-    apr_thread_mutex_lock(worker_thread_count_mutex);
-    worker_thread_count--;
-    apr_thread_mutex_unlock(worker_thread_count_mutex);
+    apr_bucket_alloc_destroy(bucket_alloc);
+    apr_pool_destroy(ptrans);
+
+    atomic_dec (&worker_thread_count);
     if (worker_num >=0)
         ap_update_child_status_from_indexes(0, worker_num, WORKER_DEAD, 
                                             (request_rec *) NULL);
     NXThreadExit((void*)&code);
 }
 
@@ -371,24 +371,18 @@
 
     tv.tv_sec = 1;
     tv.tv_usec = 0;
 
     apr_allocator_create(&allocator);
     apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
-    apr_allocator_set_owner(allocator, ptrans);
+    apr_allocator_owner_set(allocator, ptrans);
     apr_pool_tag(ptrans, "transaction");
 
-    apr_allocator_create(&allocator);
-    apr_pool_create_ex(&pbucket, NULL, NULL, allocator);
-    apr_allocator_set_owner(allocator, pbucket);
-    apr_pool_tag(pbucket, "bucket_allocs");
-    bucket_alloc = apr_bucket_alloc_create(pbucket);
-
-    apr_thread_mutex_lock(worker_thread_count_mutex);
-    worker_thread_count++;
-    apr_thread_mutex_unlock(worker_thread_count_mutex);
+    bucket_alloc = apr_bucket_alloc_create(pmain);
+
+    atomic_inc (&worker_thread_count);
 
     ap_update_child_status_from_indexes(0, my_worker_num, WORKER_READY, 
                                         (request_rec *) NULL);
 
     while (!die_now) {
         /*
@@ -396,13 +390,13 @@
         */
         current_conn = NULL;
         apr_pool_clear(ptrans);
 
         if ((ap_max_requests_per_child > 0
             && requests_this_child++ >= ap_max_requests_per_child)) {
-            clean_child_exit(0, my_worker_num);
+            clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
         }
 
         ap_update_child_status_from_indexes(0, my_worker_num, WORKER_READY, 
                                             (request_rec *) NULL);
 
         /*
@@ -413,13 +407,13 @@
         apr_thread_mutex_lock(accept_mutex);
 
         for (;;) {
             if (shutdown_pending || restart_pending || (ap_scoreboard_image->servers[0][my_worker_num].status == WORKER_IDLE_KILL)) {
                 DBPRINT1 ("\nThread slot %d is shutting down\n", my_worker_num);
                 apr_thread_mutex_unlock(accept_mutex);
-                clean_child_exit(0, my_worker_num);
+                clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
             }
 
             /* If we just satisfied a request on listen port x, assume that more 
                 is coming. Don't bother using select() to determine if there is 
                 more, just try to accept() the next request. */
             if (dont_block && (missed_accept<10)) {
@@ -519,19 +513,19 @@
                         * Ben Hyde noted that temporary ENETDOWN situations
                         * occur in mobile IP.
                         */
                         ap_log_error(APLOG_MARK, APLOG_EMERG, stat, ap_server_conf,
                             "apr_accept: giving up.");
                         apr_thread_mutex_unlock(accept_mutex);
-                        clean_child_exit(APEXIT_CHILDFATAL, my_worker_num);
+                        clean_child_exit(APEXIT_CHILDFATAL, my_worker_num, ptrans, bucket_alloc);
 
                     default:
                         ap_log_error(APLOG_MARK, APLOG_ERR, stat, ap_server_conf,
                             "apr_accept: (client socket)");
                         apr_thread_mutex_unlock(accept_mutex);
-                        clean_child_exit(1, my_worker_num);
+                        clean_child_exit(1, my_worker_num, ptrans, bucket_alloc);
                 }
             }
         }
 
         /* Unlock the mutext so that the next thread can start listening for requests. */
         apr_thread_mutex_unlock(accept_mutex);
@@ -547,13 +541,13 @@
         if (current_conn) {
             ap_process_connection(current_conn, csd);
             ap_lingering_close(current_conn);
         }
         request_count++;
     }
-    clean_child_exit(0, my_worker_num);
+    clean_child_exit(0, my_worker_num, ptrans, bucket_alloc);
 }
 
 
 static int make_child(server_rec *s, int slot)
 {
     int tid;
@@ -703,22 +697,22 @@
         /* terminate the free list */
         if (free_length == 0) {
             /* only report this condition once */
             static int reported = 0;
 
             if (!reported) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, ap_server_conf,
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf,
                     "server reached MaxClients setting, consider"
                     " raising the MaxClients setting");
                 reported = 1;
             }
             idle_spawn_rate = 1;
         }
         else {
             if (idle_spawn_rate >= 8) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                     "server seems busy, (you may need "
                     "to increase StartServers, or Min/MaxSpareServers), "
                     "spawning %d children, there are %d idle, and "
                     "%d total children", idle_spawn_rate,
                     idle_count, total_non_dead);
             }
@@ -847,13 +841,13 @@
 static int setup_listeners(server_rec *s)
 {
     ap_listen_rec *lr;
     int sockdes;
 
     if (ap_setup_listeners(s) < 1 ) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, 0, s,
             "no listening sockets available, shutting down");
         return -1;
     }
 
     listenmaxfd = -1;
     FD_ZERO(&listenfds);
@@ -890,20 +884,19 @@
     apr_status_t status=0;
 
     pconf = _pconf;
     ap_server_conf = s;
 
     if (setup_listeners(s)) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT, status, s,
+        ap_log_error(APLOG_MARK, APLOG_ALERT, status, s,
             "no listening sockets available, shutting down");
         return -1;
     }
 
     restart_pending = shutdown_pending = 0;
     worker_thread_count = 0;
-    apr_thread_mutex_create(&worker_thread_count_mutex, APR_THREAD_MUTEX_DEFAULT, pconf);
     apr_thread_mutex_create(&accept_mutex, APR_THREAD_MUTEX_DEFAULT, pconf);
 
     if (!is_graceful) {
         if (ap_run_pre_mpm(s->process->pool, SB_NOT_SHARED) != OK) {
             return 1;
         }
@@ -920,20 +913,22 @@
     if (ap_threads_max_free < ap_threads_min_free + 1)	/* Don't thrash... */
         ap_threads_max_free = ap_threads_min_free + 1;
     request_count = 0;
 
     startup_workers(ap_threads_to_start);
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		"%s configured -- resuming normal operations",
 		ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
 		"Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     show_server_data();
 
     while (!restart_pending && !shutdown_pending) {
         perform_idle_server_maintenance(pconf);
         if (show_settings)
@@ -944,38 +939,40 @@
 
 
     /* Shutdown the listen sockets so that we don't get stuck in a blocking call. 
     shutdown_listeners();*/
 
     if (shutdown_pending) { /* Got an unload from the console */
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
             "caught SIGTERM, shutting down");
 
         DBPRINT0 ("Shutdown pending. Waiting for threads to terminate...\n");
         while (worker_thread_count > 0)
             apr_thread_yield();
 
+        apr_pool_destroy (pmain);
         return 1;
     }
     else {  /* the only other way out is a restart */
         /* advance to the next generation */
         /* XXX: we really need to make sure this new generation number isn't in
          * use by any of the children.
          */
         ++ap_my_generation;
         ap_scoreboard_image->global->running_generation = ap_my_generation;
 
-    	ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    	ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    "Graceful restart requested, doing restart");
 
         /* Wait for all of the threads to terminate before initiating the restart */
         DBPRINT0 ("Restart pending. Waiting for threads to terminate...\n");
         while (worker_thread_count > 0) {
             apr_thread_yield();
         }
         DBPRINT0 ("restarting...\n");
+        apr_pool_destroy (pmain);
     }
 
     return 0;
 }
 
 static int netware_pre_config(apr_pool_t *p, apr_pool_t *plog, apr_pool_t *ptemp)
@@ -1210,17 +1207,17 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_min_free = atoi(arg);
     if (ap_threads_min_free <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareServers set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        ap_threads_min_free = 1;
     }
        
     return NULL;
 }
@@ -1242,25 +1239,25 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_limit = atoi(arg);
     if (ap_threads_limit > HARD_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxThreads of %d exceeds compile time limit "
                     "of %d threads,", ap_threads_limit, HARD_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering MaxThreads to %d.  To increase, please "
                     "see the", HARD_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                     " HARD_THREAD_LIMIT define in %s.",
                     AP_MPM_HARD_LIMITS_FILE);
        ap_threads_limit = HARD_THREAD_LIMIT;
     } 
     else if (ap_threads_limit < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
             "WARNING: Require MaxThreads > 0, setting to 1");
         ap_threads_limit = 1;
     }
     return NULL;
 }
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork/mpm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/prefork/mpm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork/mpm.h	2002-03-30 00:15:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/prefork/mpm.h	2002-05-23 20:58:37.000000000 +0800
@@ -74,12 +74,13 @@
 #define AP_MPM_WANT_SET_PIDFILE
 #define AP_MPM_WANT_SET_SCOREBOARD
 #define AP_MPM_WANT_SET_LOCKFILE
 #define AP_MPM_WANT_SET_MAX_REQUESTS
 #define AP_MPM_WANT_SET_COREDUMPDIR
 #define AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
+#define AP_MPM_WANT_SIGNAL_SERVER
 #define AP_MPM_DISABLE_NAGLE_ACCEPTED_SOCK
 
 #define AP_MPM_USES_POD 1
 #define MPM_CHILD_PID(i) (ap_scoreboard_image->parent[i].pid)
 #define MPM_NOTE_CHILD_KILLED(i) (MPM_CHILD_PID(i) = 0)
 #define MPM_ACCEPT_FUNC unixd_accept
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork/prefork.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/prefork/prefork.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/prefork/prefork.c	2002-04-09 00:57:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/prefork/prefork.c	2002-06-14 11:11:43.000000000 +0800
@@ -169,12 +169,13 @@
 
 static pid_t ap_my_pid;	/* it seems silly to call getpid all the time */
 static pid_t parent_pid;
 #ifndef MULTITHREAD
 static int my_child_num;
 #endif
+ap_generation_t volatile ap_my_generation=0;
 
 #ifdef TPF
 int tpf_child = 0;
 char tpf_server_name[INETD_SERVNAME_LENGTH+1];
 #endif /* TPF */
 
@@ -236,23 +237,44 @@
 }
 
 static void accept_mutex_on(void)
 {
     apr_status_t rv = apr_proc_mutex_lock(accept_mutex);
     if (rv != APR_SUCCESS) {
-        ap_log_error(APLOG_MARK, APLOG_EMERG, rv, NULL, "couldn't grab the accept mutex");
-        exit(APEXIT_CHILDFATAL);
+        const char *msg = "couldn't grab the accept mutex";
+
+        if (ap_my_generation != 
+            ap_scoreboard_image->global->running_generation) {
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, rv, NULL, msg);
+            clean_child_exit(0);
+        }
+        else {
+            ap_log_error(APLOG_MARK, APLOG_EMERG, rv, NULL, msg);
+            exit(APEXIT_CHILDFATAL);
+        }
     }
 }
 
 static void accept_mutex_off(void)
 {
     apr_status_t rv = apr_proc_mutex_unlock(accept_mutex);
     if (rv != APR_SUCCESS) {
-        ap_log_error(APLOG_MARK, APLOG_EMERG, rv, NULL, "couldn't release the accept mutex");
-        exit(APEXIT_CHILDFATAL);
+        const char *msg = "couldn't release the accept mutex";
+
+        if (ap_my_generation != 
+            ap_scoreboard_image->global->running_generation) {
+            ap_log_error(APLOG_MARK, APLOG_DEBUG, rv, NULL, msg);
+            /* don't exit here... we have a connection to
+             * process, after which point we'll see that the
+             * generation changed and we'll exit cleanly
+             */
+        }
+        else {
+            ap_log_error(APLOG_MARK, APLOG_EMERG, rv, NULL, msg);
+            exit(APEXIT_CHILDFATAL);
+        }
     }
 }
 
 /* On some architectures it's safe to do unserialized accept()s in the single
  * Listen case.  But it's never safe to do it in the case where there's
  * multiple Listen statements.  Define SINGLE_LISTEN_UNSERIALIZED_ACCEPT
@@ -333,13 +355,13 @@
 /* handle all varieties of core dumping signals */
 static void sig_coredump(int sig)
 {
     chdir(ap_coredump_dir);
     apr_signal(sig, SIG_DFL);
     if (ap_my_pid == parent_pid) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE,
                          0, ap_server_conf,
                          "seg fault or similar nasty error detected "
                          "in the parent process");
     }
     kill(getpid(), sig);
     /* At this point we've got sig blocked, because we're still inside
@@ -361,13 +383,12 @@
 }
 
 /* volatile just in case */
 static int volatile shutdown_pending;
 static int volatile restart_pending;
 static int volatile is_graceful;
-ap_generation_t volatile ap_my_generation=0;
 
 static void sig_term(int sig)
 {
     if (shutdown_pending == 1) {
 	/* Um, is this _probably_ not an error, if the user has
 	 * tried to do a shutdown twice quickly, so we won't
@@ -535,13 +556,13 @@
 
     /* Get a sub context for global allocations in this child, so that
      * we can have cleanups occur when the child exits.
      */
     apr_allocator_create(&allocator);
     apr_pool_create_ex(&pchild, pconf, NULL, allocator);
-    apr_allocator_set_owner(allocator, pchild);
+    apr_allocator_owner_set(allocator, pchild);
 
     apr_pool_create(&ptrans, pchild);
     apr_pool_tag(ptrans, "transaction");
 
     /* needs to be done before we switch UIDs so we have permissions */
     ap_reopen_scoreboard(pchild, NULL, 0);
@@ -744,13 +765,13 @@
         /* by default AIX binds to a single processor
          * this bit unbinds children which will then bind to another cpu
          */
 	int status = bindprocessor(BINDPROCESS, (int)getpid(), 
 				   PROCESSOR_CLASS_ANY);
 	if (status != OK) {
-	    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, errno, 
+	    ap_log_error(APLOG_MARK, APLOG_WARNING, errno, 
                          ap_server_conf, "processor unbind failed %d", status);
 	}
 #endif
 	RAISE_SIGSTOP(MAKE_CHILD);
         AP_MONCONTROL(1);
         /* Disable the parent's signal handlers and set up proper handling in
@@ -868,34 +889,34 @@
 	/* terminate the free list */
 	if (free_length == 0) {
 	    /* only report this condition once */
 	    static int reported = 0;
 
 	    if (!reported) {
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, ap_server_conf,
+		ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf,
 			    "server reached MaxClients setting, consider"
 			    " raising the MaxClients setting");
 		reported = 1;
 	    }
 	    idle_spawn_rate = 1;
 	}
 	else {
 	    if (idle_spawn_rate >= 8) {
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+		ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
 		    "server seems busy, (you may need "
 		    "to increase StartServers, or Min/MaxSpareServers), "
 		    "spawning %d children, there are %d idle, and "
 		    "%d total children", idle_spawn_rate,
 		    idle_count, total_non_dead);
 	    }
 	    for (i = 0; i < free_length; ++i) {
 #ifdef TPF
         if (make_child(ap_server_conf, free_slots[i]) == -1) {
             if(free_length == 1) {
                 shutdown_pending = 1;
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_EMERG, 0, ap_server_conf,
+                ap_log_error(APLOG_MARK, APLOG_EMERG, 0, ap_server_conf,
                 "No active child processes: shutting down");
             }
         }
 #else
 		make_child(ap_server_conf, free_slots[i]);
 #endif /* TPF */
@@ -927,13 +948,13 @@
     apr_status_t rv;
 
     ap_log_pid(pconf, ap_pid_fname);
 
     first_server_limit = server_limit;
     if (changed_limit_at_restart) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
                      "WARNING: Attempt to change ServerLimit "
                      "ignored during restart");
         changed_limit_at_restart = 0;
     }
 
     /* Initialize cross-process accept lock */
@@ -1002,20 +1023,22 @@
     else {
 	/* give the system some time to recover before kicking into
 	    * exponential mode */
 	hold_off_on_exponential_spawning = 10;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		"%s configured -- resuming normal operations",
 		ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
 		"Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     restart_pending = shutdown_pending = 0;
 
     while (!restart_pending && !shutdown_pending) {
 	int child_slot;
         apr_exit_why_e exitwhy;
@@ -1062,13 +1085,13 @@
 	    }
 	    else if (is_graceful) {
 		/* Great, we've probably just lost a slot in the
 		    * scoreboard.  Somehow we don't know about this
 		    * child.
 		    */
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 
+		ap_log_error(APLOG_MARK, APLOG_WARNING, 
                             0, ap_server_conf,
 			    "long lost child came home! (pid %ld)", (long)pid.pid);
 	    }
 	    /* Don't perform idle maintenance when a child dies,
 		* only do it when there's a timeout.  Remember only a
 		* finite number of children can die, and it's pretty
@@ -1109,19 +1132,19 @@
 
 	/* cleanup pid file on normal shutdown */
 	{
 	    const char *pidfile = NULL;
 	    pidfile = ap_server_root_relative (pconf, ap_pid_fname);
 	    if ( pidfile != NULL && unlink(pidfile) == 0)
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO,
+		ap_log_error(APLOG_MARK, APLOG_INFO,
 				0, ap_server_conf,
 				"removed PID file %s (pid=%ld)",
 				pidfile, (long)getpid());
 	}
 
-	ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+	ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    "caught SIGTERM, shutting down");
 	return 1;
     }
 
     /* we've been told to restart */
     apr_signal(SIGHUP, SIG_IGN);
@@ -1135,13 +1158,13 @@
      * use by any of the children.
      */
     ++ap_my_generation;
     ap_scoreboard_image->global->running_generation = ap_my_generation;
     
     if (is_graceful) {
-	ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+	ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    "Graceful restart requested, doing restart");
 
 	/* kill off the idle ones */
         ap_mpm_pod_killpg(pod, ap_daemons_limit);
 
 	/* This is mostly for debugging... so that we know what is still
@@ -1158,13 +1181,13 @@
     else {
 	/* Kill 'em off */
 	if (unixd_killpg(getpgrp(), SIGHUP) < 0) {
 	    ap_log_error(APLOG_MARK, APLOG_WARNING, errno, ap_server_conf, "killpg SIGHUP");
 	}
 	ap_reclaim_child_processes(0);		/* Not when just starting up */
-	ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+	ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
 		    "SIGHUP received.  Attempting to restart");
     }
 
     return 0;
 }
 
@@ -1176,13 +1199,13 @@
     apr_status_t rv;
 
     pconf = p;
     ap_server_conf = s;
 
     if ((num_listensocks = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0, 
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0, 
                      NULL, "no listening sockets available, shutting down");
 	return DONE;
     }
 
     if ((rv = ap_mpm_pod_open(pconf, &pod))) {
         ap_log_error(APLOG_MARK, APLOG_CRIT|APLOG_STARTUP, rv, NULL,
@@ -1277,17 +1300,17 @@
     if (err != NULL) {
         return err;
     }
 
     ap_daemons_min_free = atoi(arg);
     if (ap_daemons_min_free <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareServers set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        ap_daemons_min_free = 1;
     }
        
     return NULL;
 }
@@ -1309,24 +1332,24 @@
     if (err != NULL) {
         return err;
     }
 
     ap_daemons_limit = atoi(arg);
     if (ap_daemons_limit > server_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients of %d exceeds ServerLimit value "
                     "of %d servers,", ap_daemons_limit, server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering MaxClients to %d.  To increase, please "
                     "see the ServerLimit", server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                     " directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require MaxClients > 0, setting to 1");
 	ap_daemons_limit = 1;
     }
     return NULL;
 }
 
@@ -1352,21 +1375,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     server_limit = tmp_server_limit;
     
     if (server_limit > MAX_SERVER_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ServerLimit of %d exceeds compile time limit "
                     "of %d servers,", server_limit, MAX_SERVER_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ServerLimit to %d.", MAX_SERVER_LIMIT);
        server_limit = MAX_SERVER_LIMIT;
     } 
     else if (server_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ServerLimit > 0, setting to 1");
 	server_limit = 1;
     }
     return NULL;
 }
 
@@ -1385,13 +1408,13 @@
               "Maximum value of MaxClients for this run of Apache"),
 { NULL }
 };
 
 module AP_MODULE_DECLARE_DATA mpm_prefork_module = {
     MPM20_MODULE_STUFF,
-    NULL,                       /* hook to run before apache parses args */
+    ap_mpm_rewrite_args,        /* hook to run before apache parses args */
     NULL,			/* create per-directory config structure */
     NULL,			/* merge per-directory config structures */
     NULL,			/* create per-server config structure */
     NULL,			/* merge per-server config structures */
     prefork_cmds,		/* command apr_table_t */
     prefork_hooks,		/* register hooks */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/mpm_winnt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/mpm_winnt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/mpm_winnt.c	2002-04-29 05:09:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/mpm_winnt.c	2002-06-06 11:28:37.000000000 +0800
@@ -73,12 +73,13 @@
 #include "ap_config.h"
 #include "ap_listen.h"
 #include "mpm_default.h"
 #include "mpm_winnt.h"
 #include "mpm_common.h"
 #include <malloc.h>
+#include "apr_atomic.h"
 
 /* Limit on the threads per process.  Clients will be locked out if more than
  * this  * HARD_SERVER_LIMIT are needed.
  *
  * We keep this for one reason it keeps the size of the scoreboard file small
  * enough that we can read the whole thing without worrying too much about
@@ -174,24 +175,24 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_per_child = atoi(arg);
     if (ap_threads_per_child > HARD_THREAD_LIMIT) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: ThreadsPerChild of %d exceeds compile time"
                      " limit of %d threads,", ap_threads_per_child, 
                      HARD_THREAD_LIMIT);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      " lowering ThreadsPerChild to %d. To increase, please"
                      " see the  HARD_THREAD_LIMIT define in %s.", 
                      HARD_THREAD_LIMIT, AP_MPM_HARD_LIMITS_FILE);
         ap_threads_per_child = HARD_THREAD_LIMIT;
     }
     else if (ap_threads_per_child < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadsPerChild > 0, setting to 1");
 	ap_threads_per_child = 1;
     }
     return NULL;
 }
 
@@ -212,12 +213,13 @@
      * context->accept_socket may be in a disconnected but reusable 
      * state so -don't- close it.
      */
     if (context) {
         apr_pool_clear(context->ptrans);
         context->next = NULL;
+        ResetEvent(context->Overlapped.hEvent);
         apr_thread_mutex_lock(qlock);
         if (qtail)
             qtail->next = context;
         else
             qhead = context;
         qtail = context;
@@ -245,26 +247,26 @@
      * in the system at once.
      */
     if (!context) {
         if (num_completion_contexts >= ap_threads_per_child) {
             static int reported = 0;
             if (!reported) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, ap_server_conf,
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0, ap_server_conf,
                              "Server ran out of threads to serve requests. Consider "
                              "raising the ThreadsPerChild setting");
                 reported = 1;
             }
             return NULL;
         }
         /* Note:
          * Multiple failures in the next two steps will cause the pchild pool
          * to 'leak' storage. I don't think this is worth fixing...
          */
         context = (PCOMP_CONTEXT) apr_pcalloc(pchild, sizeof(COMP_CONTEXT));
 
-        context->Overlapped.hEvent = CreateEvent(NULL, FALSE, FALSE, NULL); 
+        context->Overlapped.hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);
         if (context->Overlapped.hEvent == NULL) {
             /* Hopefully this is a temporary condition ... */
             ap_log_error(APLOG_MARK,APLOG_WARNING, apr_get_os_error(), ap_server_conf,
                          "mpm_get_completion_context: CreateEvent failed.");
             return NULL;
         }
@@ -277,13 +279,13 @@
             return NULL;
         }
         apr_pool_tag(context->ptrans, "ptrans");
 
         context->accept_socket = INVALID_SOCKET;
         context->ba = apr_bucket_alloc_create(pchild);
-        num_completion_contexts++;
+        apr_atomic_inc(&num_completion_contexts);
     }
 
     return context;
 }
 
 AP_DECLARE(apr_status_t) mpm_post_completion_context(PCOMP_CONTEXT context, 
@@ -554,16 +556,16 @@
                              "set_listeners_noninheritable: SetHandleInformation failed.");
             }
         }
     }
 
     if (my_pid == parent_pid) {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                      "Parent: Marked listeners as not inheritable.");
     } else {
-        ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                      "Child %d: Marked listeners as not inheritable.", my_pid);
     }
     return 1;
 }
 
 /*
@@ -633,13 +635,13 @@
     }
     /* We must 'initialize' the scoreboard to relink all the
      * process-local pointer arrays into the shared memory block.
      */
     ap_init_scoreboard(sb_shared);
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                  "Child %d: Retrieved our scoreboard from the parent.", my_pid);
 }
 
 /* 
  * get_listeners_from_parent()
  * The listen sockets are opened in the parent. This function, which runs
@@ -683,13 +685,13 @@
                          "Child %d: setup_inherited_listeners(), WSASocket failed to open the inherited socket.", my_pid);
             exit(APEXIT_CHILDINIT);
         }
         apr_os_sock_put(&lr->sd, &nsd, s->process->pool);
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                  "Child %d: retrieved %d listeners from parent", my_pid, lcnt);
 
     if (!set_listeners_noninheritable(s->process->pool)) {
         exit(APEXIT_CHILDINIT);
     }
 }
@@ -731,13 +733,13 @@
 static void add_job(int sock)
 {
     joblist *new_job;
 
     new_job = (joblist *) malloc(sizeof(joblist));
     if (new_job == NULL) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "Ouch!  Out of memory in add_job()!");
         return;
     }
     new_job->next = NULL;
     new_job->sock = sock;
 
@@ -920,44 +922,43 @@
  *    connections off the network and calls PostQueuedCompletionStatus() to
  *    queue an io completion packet to the ThreadDispatch IOCompletionPort.
  * winnt_get_connection()
  *    Worker threads block on the ThreadDispatch IOCompletionPort awaiting 
  *    connections to service.
  */
-static void winnt_accept(void *listen_socket) 
+static void winnt_accept(void *lr_) 
 {
+    ap_listen_rec *lr = (ap_listen_rec *)lr_;
     apr_os_sock_info_t sockinfo;
-    PCOMP_CONTEXT context;
+    PCOMP_CONTEXT context = NULL;
     DWORD BytesRead;
     SOCKET nlsd;
-    int lasterror;
+    int rv;
 
-    nlsd = (SOCKET) listen_socket;
+    apr_os_sock_get(&nlsd, lr->sd);
 
     while (!shutdown_in_progress) {
-        context = mpm_get_completion_context();
         if (!context) {
-            /* Hopefully whatever is preventing us from getting a 
-             * completion context is a temporary resource constraint.
-             * Yield the rest of our time slice.
-             */
-            Sleep(0);
-            continue;
+            context = mpm_get_completion_context();
+            if (!context) {
+                /* Temporary resource constraint? */
+                Sleep(0);
+                continue;
+            }
         }
 
-    again:            
         /* Create and initialize the accept socket */
         if (context->accept_socket == INVALID_SOCKET) {
             context->accept_socket = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
             if (context->accept_socket == INVALID_SOCKET) {
                 /* Another temporary condition? */
                 ap_log_error(APLOG_MARK,APLOG_WARNING, apr_get_netos_error(), ap_server_conf,
                              "winnt_accept: Failed to allocate an accept socket. "
                              "Temporary resource constraint? Try again.");
                 Sleep(100);
-                goto again;
+                continue;
             }
         }
 
         /* AcceptEx on the completion context. The completion context will be 
          * signaled when a connection is accepted. 
          */
@@ -965,46 +966,58 @@
                       context->buff,
                       0,
                       PADDED_ADDR_SIZE, 
                       PADDED_ADDR_SIZE,
                       &BytesRead,
                       &context->Overlapped)) {
-            lasterror = apr_get_netos_error();
-            if (lasterror == APR_FROM_OS_ERROR(WSAEINVAL)) {
+            rv = apr_get_netos_error();
+            if (rv == APR_FROM_OS_ERROR(WSAEINVAL)) {
                 /* Hack alert. Occasionally, TransmitFile will not recycle the 
                  * accept socket (usually when the client disconnects early). 
                  * Get a new socket and try the call again.
                  */
                 closesocket(context->accept_socket);
                 context->accept_socket = INVALID_SOCKET;
-                ap_log_error(APLOG_MARK, APLOG_DEBUG, lasterror, ap_server_conf,
+                ap_log_error(APLOG_MARK, APLOG_DEBUG, rv, ap_server_conf,
                        "winnt_accept: AcceptEx failed due to early client "
                        "disconnect. Reallocate the accept socket and try again.");
-                if (shutdown_in_progress)
-                    break;
-                else
-                    goto again;
+                continue;
             }
-            else if (lasterror != APR_FROM_OS_ERROR(ERROR_IO_PENDING)) {
-                ap_log_error(APLOG_MARK,APLOG_ERR, lasterror, ap_server_conf,
+            else if (rv != APR_FROM_OS_ERROR(ERROR_IO_PENDING)) {
+                ap_log_error(APLOG_MARK,APLOG_ERR, rv, ap_server_conf,
                              "winnt_accept: AcceptEx failed. Attempting to recover.");
                 closesocket(context->accept_socket);
                 context->accept_socket = INVALID_SOCKET;
                 Sleep(100);
-                goto again;
+                continue;
             }
 
-            /* Wait for pending i/o */
-            WaitForSingleObject(context->Overlapped.hEvent, INFINITE);
-        }
-
-        /* ### There is a race condition here.  The mainline may hit 
-         * WSATerminate before this thread reawakens.  Look First.
-         */
-        if (shutdown_in_progress) {
-            break;
+            /* Wait for pending i/o. Wake up once per second to check for shutdown */
+            while (1) {
+                rv = WaitForSingleObject(context->Overlapped.hEvent, 1000);
+                if (rv == WAIT_OBJECT_0) {
+                    if (!GetOverlappedResult(context->Overlapped.hEvent, 
+                                             &context->Overlapped, 
+                                             &BytesRead, FALSE)) {
+                        ap_log_error(APLOG_MARK,APLOG_WARNING, GetLastError(), ap_server_conf,
+                                     "winnt_accept: Asynchronous AcceptEx failed.");
+                        closesocket(context->accept_socket);
+                        context->accept_socket = INVALID_SOCKET;
+                    }
+                    break;
+                }
+                /* WAIT_TIMEOUT */
+                if (shutdown_in_progress) {
+                    closesocket(context->accept_socket);
+                    context->accept_socket = INVALID_SOCKET;
+                    break;
+                }
+            }
+            if (context->accept_socket == INVALID_SOCKET) {
+                continue;
+            }
         }
 
         /* Inherit the listen socket settings. Required for 
          * shutdown() to work 
          */
         if (setsockopt(context->accept_socket, SOL_SOCKET,
@@ -1035,32 +1048,34 @@
         /* When a connection is received, send an io completion notification to
          * the ThreadDispatchIOCP. This function could be replaced by
          * mpm_post_completion_context(), but why do an extra function call...
          */
         PostQueuedCompletionStatus(ThreadDispatchIOCP, 0, IOCP_CONNECTION_ACCEPTED,
                                    &context->Overlapped);
+        context = NULL;
     }
-
     if (!shutdown_in_progress) {
         /* Yow, hit an irrecoverable error! Tell the child to die. */
         SetEvent(exit_event);
     }
+    ap_log_error(APLOG_MARK, APLOG_INFO, APR_SUCCESS, ap_server_conf,
+                 "Child %d: Accept thread exiting.", my_pid);
 }
 static PCOMP_CONTEXT winnt_get_connection(PCOMP_CONTEXT context)
 {
     int rc;
     DWORD BytesRead;
     DWORD CompKey;
     LPOVERLAPPED pol;
 
     mpm_recycle_completion_context(context);
 
-    g_blocked_threads++;        
+    apr_atomic_inc(&g_blocked_threads);
     while (1) {
         if (workers_may_exit) {
-            g_blocked_threads--;
+            apr_atomic_dec(&g_blocked_threads);
             return NULL;
         }
         rc = GetQueuedCompletionStatus(ThreadDispatchIOCP, &BytesRead, &CompKey,
                                        &pol, INFINITE);
         if (!rc) {
             rc = apr_get_os_error();
@@ -1071,22 +1086,21 @@
 
         switch (CompKey) {
         case IOCP_CONNECTION_ACCEPTED:
             context = CONTAINING_RECORD(pol, COMP_CONTEXT, Overlapped);
             break;
         case IOCP_SHUTDOWN:
-            g_blocked_threads--;
+            apr_atomic_dec(&g_blocked_threads);
             return NULL;
         default:
-            g_blocked_threads--;
+            apr_atomic_dec(&g_blocked_threads);
             return NULL;
         }
         break;
     }
-
-    g_blocked_threads--;    
+    apr_atomic_dec(&g_blocked_threads);
 
     return context;
 }
 
 /*
  * worker_main()
@@ -1096,19 +1110,19 @@
 static void worker_main(long thread_num)
 {
     static int requests_this_child = 0;
     PCOMP_CONTEXT context = NULL;
     ap_sb_handle_t *sbh;
 
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, APR_SUCCESS, ap_server_conf,
+                 "Child %d: Worker thread %d starting.", my_pid, thread_num);
     while (1) {
         conn_rec *c;
         apr_int32_t disconnected;
 
-        ap_update_child_status_from_indexes(0, thread_num, SERVER_READY, 
-                                            (request_rec *) NULL);
-
+        ap_update_child_status_from_indexes(0, thread_num, SERVER_READY, NULL);
 
         /* Grab a connection off the network */
         if (osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS) {
             context = win9x_get_connection(context);
         }
         else {
@@ -1146,14 +1160,14 @@
         }
     }
 
     ap_update_child_status_from_indexes(0, thread_num, SERVER_DEAD, 
                                         (request_rec *) NULL);
 
-    ap_log_error(APLOG_MARK, APLOG_INFO, APR_SUCCESS, ap_server_conf,
-                 "Child %d: Thread exiting.", my_pid);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, APR_SUCCESS, ap_server_conf,
+                 "Child %d: Worker thread %d exiting.", my_pid, thread_num);
 }
 
 static void cleanup_thread(thread *handles, int *thread_cnt, int thread_to_clean)
 {
     int i;
 
@@ -1167,29 +1181,51 @@
  * child_main() 
  * Entry point for the main control thread for the child process. 
  * This thread creates the accept thread, worker threads and
  * monitors the child process for maintenance and shutdown
  * events.
  */
+static void create_listener_thread()
+{
+    int tid;
+    if (osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS) {
+        _beginthreadex(NULL, 0, (LPTHREAD_START_ROUTINE) win9x_accept,
+                       NULL, 0, &tid);
+    } else {
+        /* Start an accept thread per listener 
+         * XXX: Why would we have a NULL sd in our listeners?
+         */
+        ap_listen_rec *lr;
+        for (lr = ap_listeners; lr; lr = lr->next) {
+            if (lr->sd != NULL) {
+                _beginthreadex(NULL, 1000, (LPTHREAD_START_ROUTINE) winnt_accept,
+                               (void *) lr, 0, &tid);
+            }
+        }
+    }
+}
 static void child_main()
 {
     apr_status_t status;
+    apr_hash_t *ht;
     ap_listen_rec *lr;
     HANDLE child_events[2];
-    int nthreads = ap_threads_per_child;
+    int threads_created = 0;
+    int listener_started = 0;
     int tid;
     thread *child_handles;
     int rv;
     time_t end_time;
     int i;
     int cld;
 
     apr_pool_create(&pchild, pconf);
     apr_pool_tag(pchild, "pchild");
 
     ap_run_child_init(pchild, ap_server_conf);
+    ht = apr_hash_make(pchild);
 
     /* Initialize the child_events */
     max_requests_per_child_event = CreateEvent(NULL, TRUE, FALSE, NULL);
     if (!max_requests_per_child_event) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, apr_get_os_error(), ap_server_conf,
                      "Child %d: Failed to create a max_requests event.", my_pid);
@@ -1230,38 +1266,54 @@
     }
 
     /* 
      * Create the pool of worker threads
      */
     ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
-                 "Child %d: Starting %d worker threads.", my_pid, nthreads);
-    child_handles = (thread) alloca(nthreads * sizeof(int));
-    for (i = 0; i < nthreads; i++) {
-        ap_update_child_status_from_indexes(0, i, SERVER_STARTING, 
-                                            (request_rec *) NULL);
-        child_handles[i] = (thread) _beginthreadex(NULL, 0, (LPTHREAD_START_ROUTINE) worker_main,
-                                                   (void *) i, 0, &tid);
-    }
-
-    /* 
-     * Start the accept thread
-     */
-    if (osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS) {
-        _beginthreadex(NULL, 0, (LPTHREAD_START_ROUTINE) win9x_accept,
-                       (void *) i, 0, &tid);
-    } else {
-        /* Start an accept thread per listener */
-        SOCKET nlsd; /* native listening sock descriptor */
-        ap_listen_rec *lr;
-        for (lr = ap_listeners; lr; lr = lr->next) {
-            if (lr->sd != NULL) {
-                apr_os_sock_get(&nlsd, lr->sd);
-                _beginthreadex(NULL, 1000, (LPTHREAD_START_ROUTINE) winnt_accept,
-                               (void *) nlsd, 0, &tid);
-            }
+                 "Child %d: Starting %d worker threads.", my_pid, ap_threads_per_child);
+    child_handles = (thread) apr_pcalloc(pchild, ap_threads_per_child * sizeof(int));
+    while (1) {
+        for (i = 0; i < ap_threads_per_child; i++) {
+            int *score_idx;
+            int status = ap_scoreboard_image->servers[0][i].status;
+            if (status != SERVER_GRACEFUL && status != SERVER_DEAD) {
+                continue;
+            }
+            ap_update_child_status_from_indexes(0, i, SERVER_STARTING, NULL);
+            child_handles[i] = (thread) _beginthreadex(NULL, 0, (LPTHREAD_START_ROUTINE) worker_main,
+                                                       (void *) i, 0, &tid);
+            if (child_handles[i] == 0) {
+                ap_log_error(APLOG_MARK, APLOG_CRIT, apr_get_os_error(), ap_server_conf,
+                             "Child %d: _beginthreadex failed. Unable to create all worker threads. "
+                             "Created %d of the %d threads requested with the ThreadsPerChild configuration directive.", 
+                             threads_created, ap_threads_per_child);
+                ap_signal_parent(SIGNAL_PARENT_SHUTDOWN);
+                goto shutdown;
+            }
+            threads_created++;
+            /* Save the score board index in ht keyed to the thread handle. We need this 
+             * when cleaning up threads down below...
+             */
+            score_idx = apr_pcalloc(pchild, sizeof(int));
+            *score_idx = i;
+            apr_hash_set(ht, &child_handles[i], sizeof(thread), score_idx);
+        }
+        /* Start the listener only when workers are available */
+        if (!listener_started && threads_created) {
+            create_listener_thread();
+            listener_started = 1;
+        }
+        if (threads_created == ap_threads_per_child) {
+            break;
         }
+        /* Check to see if the child has been told to exit */
+        if (WaitForSingleObject(exit_event, 0) != WAIT_TIMEOUT) {
+            break;
+        }
+        /* wait for previous generation to clean up an entry in the scoreboard */
+        apr_sleep(1 * APR_USEC_PER_SEC);
     }
 
     /* Wait for one of three events:
      * exit_event: 
      *    The exit_event is signaled by the parent process to notify 
      *    the child that it is time to exit.
@@ -1302,50 +1354,57 @@
                          "restart a new child process.", my_pid);
             ap_signal_parent(SIGNAL_PARENT_RESTART);
             break;
         }
     }
 
-    /* Setting is_graceful will cause keep-alive connections to be closed
-     * rather than block on the next network read.
+    /* 
+     * Time to shutdown the child process 
      */
-    is_graceful = 1;
 
-    /* Setting shutdown_in_progress prevents new connections from
-     * being accepted but allows the worker threads to continue
-     * handling connections that have already been accepted.
+ shutdown:
+    /* Setting is_graceful will cause threads handling keep-alive connections 
+     * to close the connection after handling the current request.
      */
-    shutdown_in_progress = 1;
+    is_graceful = 1;
 
-    /* Tell the worker threads they may exit when done handling
-     * a connection.
+    /* Close the listening sockets. Note, we must close the listeners
+     * before closing any accept sockets pending in AcceptEx to prevent
+     * memory leaks in the kernel.
      */
-    workers_may_exit = 1;
-
-    /* Close the listening sockets. */
     for (lr = ap_listeners; lr ; lr = lr->next) {
         apr_socket_close(lr->sd);
     }
+
+    /* Shutdown listener threads and pending AcceptEx socksts 
+     * but allow the worker threads to continue consuming from
+     * the queue of accepted connections.
+     */
+    shutdown_in_progress = 1;
+
     Sleep(1000);
 
+    /* Tell the worker threads to exit */
+    workers_may_exit = 1;
+
     /* Release the start_mutex to let the new process (in the restart
      * scenario) a chance to begin accepting and servicing requests 
      */
     rv = apr_proc_mutex_unlock(start_mutex);
     if (rv == APR_SUCCESS) {
-        ap_log_error(APLOG_MARK,APLOG_NOTICE | APLOG_NOERRNO, rv, ap_server_conf, 
+        ap_log_error(APLOG_MARK,APLOG_NOTICE, rv, ap_server_conf, 
                      "Child %d: Released the start mutex", my_pid);
     }
     else {
         ap_log_error(APLOG_MARK,APLOG_ERR, rv, ap_server_conf, 
                      "Child %d: Failure releasing the start mutex", my_pid);
     }
 
     /* Shutdown the worker threads */
     if (osver.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS) {
-        for (i = 0; i < nthreads; i++) {
+        for (i = 0; i < threads_created; i++) {
             add_job(-1);
         }
     }
     else { /* Windows NT/2000 */
         /* Post worker threads blocked on the ThreadDispatch IOCompletion port */
         while (g_blocked_threads > 0) {
@@ -1365,29 +1424,37 @@
         }
         apr_thread_mutex_unlock(qlock);
     }
 
     /* Give busy worker threads a chance to service their connections */
     ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
-                 "Child %d: Waiting for %d worker threads to exit.", my_pid, nthreads);
+                 "Child %d: Waiting for %d worker threads to exit.", my_pid, threads_created);
     end_time = time(NULL) + 180;
-    while (nthreads) {
-        rv = wait_for_many_objects(nthreads, child_handles, end_time - time(NULL));
+    while (threads_created) {
+        rv = wait_for_many_objects(threads_created, child_handles, end_time - time(NULL));
         if (rv != WAIT_TIMEOUT) {
             rv = rv - WAIT_OBJECT_0;
-            ap_assert((rv >= 0) && (rv < nthreads));
-            cleanup_thread(child_handles, &nthreads, rv);
+            ap_assert((rv >= 0) && (rv < threads_created));
+            cleanup_thread(child_handles, &threads_created, rv);
             continue;
         }
         break;
     }
 
     /* Kill remaining threads off the hard way */
-    for (i = 0; i < nthreads; i++) {
+    if (threads_created) {
+        ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
+                     "Child %d: Terminating %d threads that failed to exit.", my_pid);
+    }
+    for (i = 0; i < threads_created; i++) {
+        int *score_idx;
         TerminateThread(child_handles[i], 1);
         CloseHandle(child_handles[i]);
+        /* Reset the scoreboard entry for the thread we just whacked */
+        score_idx = apr_hash_get(ht, &child_handles[i], sizeof(thread));
+        ap_update_child_status_from_indexes(0, *score_idx, SERVER_DEAD, NULL);        
     }
     ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
                  "Child %d: All worker threads have exited.", my_pid);
 
     CloseHandle(allowed_globals.jobsemaphore);
     apr_thread_mutex_destroy(allowed_globals.jobmutex);
@@ -1436,13 +1503,13 @@
             || (BytesWritten != sizeof(hDup))) {
         ap_log_error(APLOG_MARK, APLOG_CRIT, apr_get_os_error(), ap_server_conf,
                      "Parent: Unable to send the scoreboard handle to the child");
         return -1;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                  "Parent: Sent the scoreboard to the child");
     return 0;
 }
 
 static int send_listeners_to_child(apr_pool_t *p, DWORD dwProcessId, HANDLE hPipeWrite)
 {
@@ -1476,13 +1543,13 @@
             ap_log_error(APLOG_MARK, APLOG_CRIT, apr_get_os_error(), ap_server_conf,
                          "Parent: Unable to write duplicated socket %d to the child.", lr->sd );
             return -1;
         }
     }
 
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
                  "Parent: Sent %d listeners to child %d", lcnt, dwProcessId);
     return 0;
 }
 
 static int create_process(apr_pool_t *p, HANDLE *child_proc, HANDLE *child_exit_event, 
                           DWORD *child_pid)
@@ -1582,13 +1649,13 @@
             CloseHandle(hPipeWrite);
             CloseHandle(hPipeRead);
             CloseHandle(hNullOutput);
             return -1;
         }
         else if (hShareError == INVALID_HANDLE_VALUE) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_CRIT, 0, ap_server_conf,
+            ap_log_error(APLOG_MARK, APLOG_CRIT, 0, ap_server_conf,
                          "Parent: Failed to share error log with child.\n");
             CloseHandle(hPipeWrite);
             CloseHandle(hPipeRead);
             CloseHandle(hNullOutput);
             return -1;
         }
@@ -1817,25 +1884,25 @@
                      "master_main: WaitForMultipeObjects with INFINITE wait exited with WAIT_TIMEOUT");
         shutdown_pending = 1;
     }
     else if (cld == SHUTDOWN_HANDLE) {
         /* shutdown_event signalled */
         shutdown_pending = 1;
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, APR_SUCCESS, s, 
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, APR_SUCCESS, s, 
                      "Parent: Received shutdown signal -- Shutting down the server.");
         if (ResetEvent(shutdown_event) == 0) {
             ap_log_error(APLOG_MARK, APLOG_ERR, apr_get_os_error(), s,
                          "ResetEvent(shutdown_event)");
         }
     }
     else if (cld == RESTART_HANDLE) {
         /* Received a restart event. Prepare the restart_event to be reused 
          * then signal the child process to exit. 
          */
         restart_pending = 1;
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, s, 
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, s, 
                      "Parent: Received restart signal -- Restarting the server.");
         if (ResetEvent(restart_event) == 0) {
             ap_log_error(APLOG_MARK, APLOG_ERR, apr_get_os_error(), s,
                          "Parent: ResetEvent(restart_event) failed.");
         }
         if (SetEvent(child_exit_event) == 0) {
@@ -1856,19 +1923,23 @@
             /* HUH? We did exit, didn't we? */
             exitcode = APEXIT_CHILDFATAL;
         }
         if (   exitcode == APEXIT_CHILDFATAL 
             || exitcode == APEXIT_CHILDINIT
             || exitcode == APEXIT_INIT) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, ap_server_conf, 
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, ap_server_conf, 
                          "Parent: child process exited with status %u -- Aborting.", exitcode);
         }
         else {
+            int i;
             restart_pending = 1;
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, APR_SUCCESS, ap_server_conf, 
                          "Parent: child process exited with status %u -- Restarting.", exitcode);
+            for (i = 0; i < ap_threads_per_child; i++) {
+                ap_update_child_status_from_indexes(0, i, SERVER_DEAD, NULL);
+            }
         }
         CloseHandle(event_handles[CHILD_HANDLE]);
         event_handles[CHILD_HANDLE] = NULL;
     }
     if (restart_pending) {
         ++ap_my_generation;
@@ -1891,19 +1962,19 @@
                 ap_log_error(APLOG_MARK,APLOG_ERR, apr_get_os_error(), ap_server_conf,
                              "Parent: SetEvent for child process %d failed", event_handles[CHILD_HANDLE]);
         }
         if (event_handles[CHILD_HANDLE]) {
             rv = WaitForSingleObject(event_handles[CHILD_HANDLE], timeout);
             if (rv == WAIT_OBJECT_0) {
-                ap_log_error(APLOG_MARK,APLOG_NOTICE|APLOG_NOERRNO, APR_SUCCESS, ap_server_conf,
+                ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf,
                              "Parent: Child process exited successfully.");
                 CloseHandle(event_handles[CHILD_HANDLE]);
                 event_handles[CHILD_HANDLE] = NULL;
             }
             else {
-                ap_log_error(APLOG_MARK,APLOG_NOTICE|APLOG_NOERRNO, APR_SUCCESS, ap_server_conf,
+                ap_log_error(APLOG_MARK,APLOG_NOTICE, APR_SUCCESS, ap_server_conf,
                              "Parent: Forcing termination of child process %d ", event_handles[CHILD_HANDLE]);
                 TerminateProcess(event_handles[CHILD_HANDLE], 1);
                 CloseHandle(event_handles[CHILD_HANDLE]);
                 event_handles[CHILD_HANDLE] = NULL;
             }
         }
@@ -2123,13 +2194,21 @@
         /* Start the NT Service _NOW_ because the WinNT SCM is 
          * expecting us to rapidly assume control of our own 
          * process, the SCM will tell us our service name, and
          * may have extra StartService() command arguments to
          * add for us.
          *
-         * Any other process has a console, so we don't to begin
+         * The SCM will generally invoke the executable with
+         * the c:\win\system32 default directory.  This is very
+         * lethal if folks use ServerRoot /foopath on windows
+         * without a drive letter.  Change to the default root
+         * (path to apache root, above /bin) for safety.
+         */
+        SetCurrentDirectory(def_server_root);
+        
+        /* Any other process has a console, so we don't to begin
          * a Win9x service until the configuration is parsed and
          * any command line errors are reported.
          *
          * We hold the return value so that we can die in pre_config
          * after logging begins, and the failure can land in the log.
          */
@@ -2179,13 +2258,13 @@
                 exit(0);
             }
 
             rv = mpm_merge_service_args(process->pool, mpm_new_argv, 
                                         fixed_args);
             if (rv == APR_SUCCESS) {
-                ap_log_error(APLOG_MARK,APLOG_NOERRNO|APLOG_INFO, 0, NULL,
+                ap_log_error(APLOG_MARK,APLOG_INFO, 0, NULL,
                              "Using ConfigArgs of the installed service "
                              "\"%s\".", service_name);
             }
             else  {
                 ap_log_error(APLOG_MARK,APLOG_WARNING, rv, NULL,
                              "No installed ConfigArgs for the service "
@@ -2215,19 +2294,23 @@
 
     process->argc = mpm_new_argv->nelts; 
     process->argv = (const char * const *) mpm_new_argv->elts;
 }
 
 
-static int winnt_pre_config(apr_pool_t *pconf, apr_pool_t *plog, apr_pool_t *ptemp) 
+static int winnt_pre_config(apr_pool_t *pconf_, apr_pool_t *plog, apr_pool_t *ptemp) 
 {
     /* Handle the following SCM aspects in this phase:
      *
      *   -k runservice [WinNT errors logged from rewrite_args]
      */
 
+    /* Initialize shared static objects. 
+     */
+    pconf = pconf_;
+    
     if (ap_exists_config_define("ONE_PROCESS") ||
         ap_exists_config_define("DEBUG"))
         one_process = -1;
 
     if (!strcasecmp(signal_arg, "runservice")
             && (osver.dwPlatformId == VER_PLATFORM_WIN32_NT)
@@ -2245,22 +2328,17 @@
 
     apr_cpystrn(ap_coredump_dir, ap_server_root, sizeof(ap_coredump_dir));
 
     return OK;
 }
 
-static int winnt_post_config(apr_pool_t *pconf_, apr_pool_t *plog, apr_pool_t *ptemp, server_rec* s)
+static int winnt_post_config(apr_pool_t *pconf, apr_pool_t *plog, apr_pool_t *ptemp, server_rec* s)
 {
     static int restart_num = 0;
     apr_status_t rv = 0;
 
-    /* Initialize shared static objects. 
-     */
-    pconf = pconf_;
-    ap_server_conf = s;
-    
     /* Handle the following SCM aspects in this phase:
      *
      *   -k install
      *   -k config
      *   -k start
      *   -k restart
@@ -2384,12 +2462,16 @@
 
 /* This really should be a post_config hook, but the error log is already
  * redirected by that point, so we need to do this in the open_logs phase.
  */
 static int winnt_open_logs(apr_pool_t *p, apr_pool_t *plog, apr_pool_t *ptemp, server_rec *s)
 {
+    /* Initialize shared static objects. 
+     */
+    ap_server_conf = s;
+
     if (parent_pid != my_pid) {
         return OK;
     }
 
     /* We cannot initialize our listeners if we are restarting
      * (the parent process already has glomed on to them)
@@ -2399,13 +2481,13 @@
     if (!strcasecmp(signal_arg, "restart") 
             || !strcasecmp(signal_arg, "config")) {
         return OK;
     }
 
     if (ap_setup_listeners(s) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0, 
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0, 
                      NULL, "no listening sockets available, shutting down");
         return DONE;
     }
 
     if (!set_listeners_noninheritable(s->process->pool)) {
         return 1;
@@ -2487,13 +2569,13 @@
         if (!restart) 
         {
             /* Shutting down. Clean up... */
             const char *pidfile = ap_server_root_relative (pconf, ap_pid_fname);
 
             if (pidfile != NULL && unlink(pidfile) == 0) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, APR_SUCCESS,
+                ap_log_error(APLOG_MARK, APLOG_INFO, APR_SUCCESS,
                              ap_server_conf, "removed PID file %s (pid=%ld)",
                              pidfile, GetCurrentProcessId());
             }
             apr_proc_mutex_destroy(start_mutex);
 
             CloseHandle(restart_event);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/registry.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/registry.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/registry.c	2002-03-14 04:48:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/registry.c	2002-05-26 04:09:24.000000000 +0800
@@ -208,13 +208,15 @@
 			 NULL,		/* for value */
 			 &nSize);		/* for size of "value" */
 
     if (rv != ERROR_SUCCESS)
 	return_error(rv);
 
-    *ppValue = apr_palloc(p, nSize);
+    *ppValue = apr_palloc(p, nSize + 1);
+    (*ppValue)[nSize] = '\0';
+
     rv = RegQueryValueEx(hKey, 
 			 name,		/* key name */
 			 NULL,		/* reserved */
 			 NULL,		/* type */
 			 *ppValue,      /* for value */
 			 &nSize);	/* for size of "value" */
@@ -255,40 +257,41 @@
 
     if (rv != ERROR_SUCCESS) {
 	return_error(rv);
     }
     else 
     {
-        pValue = apr_palloc(p, nSize);
+        /* Small possiblity the array is either unterminated 
+         * or single NULL terminated.  Avert.
+         */
+        pValue = apr_palloc(p, nSize + 2);
+        pValue[nSize + 1] = '\0';
+        pValue[nSize] = '\0';
+        
         rv = RegQueryValueEx(hKey, 
 			     name,		/* key name */
 			     NULL,		/* reserved */
 			     NULL,		/* type */
 			     pValue,        /* for value */
 			     &nSize);	/* for size of "value" */
 
-        nSize = 1;    /* Element Count */
-        tmp = pValue;
-        while (tmp[0] || tmp[1])
-        {
-            if (!tmp[0])
-                ++nSize;
-            ++tmp;
+        nSize = 0;    /* Element Count */
+        for (tmp = pValue; *tmp; ++tmp) {
+            ++nSize;
+            while (*tmp) {
+                ++tmp;
+            }
         }
-    
+
         *parray = apr_array_make(p, nSize, sizeof(char *));
-        tmp = pValue;
-        newelem = (char **) apr_array_push(*parray);
-        *newelem = tmp;
-        while (tmp[0] || tmp[1])
-        {
-            if (!tmp[0]) {
-                newelem = (char **) apr_array_push(*parray);
-                *newelem = tmp + 1;
+        for (tmp = pValue; *tmp; ++tmp) {
+            newelem = (char **) apr_array_push(*parray);
+            *newelem = tmp;
+            while (*tmp) {
+                ++tmp;
             }
-            ++tmp;
         }
     }    
     
     RegCloseKey(hKey);
 
     return_error(rv);
@@ -343,13 +346,13 @@
 		       0,	/* reserved */
 		       REG_SZ,	/* type */
 		       value,	/* value data */
 		       (DWORD) strlen(value) + 1); /* for size of "value" */
 
     if (rv == ERROR_SUCCESS) {
-	ap_log_error(APLOG_MARK,APLOG_INFO|APLOG_NOERRNO,rv,NULL,
+	ap_log_error(APLOG_MARK,APLOG_INFO,rv,NULL,
 	    "Registry stored HKLM\\" REGKEY "\\%s value %s", key, value);
     }
 
     /* Make sure we close the key even if there was an error storing
      * the data
      */
@@ -415,13 +418,13 @@
 		       0,	     /* reserved */
 		       REG_MULTI_SZ, /* type */
 		       buf,	     /* value data */
 		       (DWORD) bufsize); /* for size of "value" */
 
     if (rv == ERROR_SUCCESS) {
-	ap_log_error(APLOG_MARK,APLOG_INFO|APLOG_NOERRNO,rv,NULL,
+	ap_log_error(APLOG_MARK,APLOG_INFO,rv,NULL,
 	    "Registry stored HKLM\\" REGKEY "\\%s", key);
     }
 
     /* Make sure we close the key even if there was an error storing
      * the data
      */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/service.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/service.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/winnt/service.c	2002-04-18 00:36:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/winnt/service.c	2002-06-05 23:46:30.000000000 +0800
@@ -619,13 +619,13 @@
     apr_status_t rv;
 
     apr_snprintf(conf_key, sizeof(conf_key), SERVICEPARAMS, mpm_service_name);
     rv = ap_registry_get_array(p, conf_key, "ConfigArgs", &svc_args);
     if (rv != APR_SUCCESS) {
         if (rv == ERROR_FILE_NOT_FOUND) {
-            ap_log_error(APLOG_MARK, APLOG_INFO|APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_INFO, 0, NULL,
                          "No ConfigArgs registered for %s, perhaps "
                          "this service is not installed?", 
                          mpm_service_name);
             return APR_SUCCESS;
         }
         else
@@ -1054,18 +1054,16 @@
                          "Service %s is already started!", mpm_display_name);
             CloseServiceHandle(schService);
             CloseServiceHandle(schSCManager);
             return 0;
         }
         
-        argc += 1;
-        start_argv = malloc(argc * sizeof(const char **));
-        start_argv[0] = mpm_service_name;
-        if (argc > 1)
-            memcpy(start_argv + 1, argv, (argc - 1) * sizeof(const char **));
-        
+        start_argv = malloc((argc + 1) * sizeof(const char **));
+        memcpy(start_argv, argv, argc * sizeof(const char **));
+        start_argv[argc] = NULL;
+
         rv = APR_EINIT;
         if (StartService(schService, argc, start_argv)
             && signal_service_transition(schService, 0, /* test only */
                                          SERVICE_START_PENDING, 
                                          SERVICE_RUNNING))
                 rv = APR_SUCCESS;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/worker/mpm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/worker/mpm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/worker/mpm.h	2002-03-30 00:15:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/worker/mpm.h	2002-05-23 20:58:37.000000000 +0800
@@ -71,12 +71,13 @@
 #define AP_MPM_WANT_SET_PIDFILE
 #define AP_MPM_WANT_SET_SCOREBOARD
 #define AP_MPM_WANT_SET_LOCKFILE
 #define AP_MPM_WANT_SET_MAX_REQUESTS
 #define AP_MPM_WANT_SET_COREDUMPDIR
 #define AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
+#define AP_MPM_WANT_SIGNAL_SERVER
 #define AP_MPM_DISABLE_NAGLE_ACCEPTED_SOCK
 
 #define MPM_CHILD_PID(i) (ap_scoreboard_image->parent[i].pid)
 #define MPM_NOTE_CHILD_KILLED(i) (MPM_CHILD_PID(i) = 0)
 #define MPM_ACCEPT_FUNC unixd_accept
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/worker/worker.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/worker/worker.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm/worker/worker.c	2002-05-02 00:05:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm/worker/worker.c	2002-06-07 22:08:05.000000000 +0800
@@ -376,13 +376,13 @@
 /* handle all varieties of core dumping signals */
 static void sig_coredump(int sig)
 {
     apr_filepath_set(ap_coredump_dir, pconf);
     apr_signal(sig, SIG_DFL);
     if (ap_my_pid == parent_pid) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE,
                      0, ap_server_conf,
                      "seg fault or similar nasty error detected "
                      "in the parent process");
         
         /* XXX we can probably add some rudimentary cleanup code here,
          * like getting rid of the pid file.  If any additional bad stuff
@@ -613,13 +613,13 @@
     ap_sb_handle_t *sbh;
 
     ap_create_sb_handle(&sbh, p, my_child_num, my_thread_num);
     apr_os_sock_get(&csd, sock);
 
     if (csd >= FD_SETSIZE) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, NULL,
                      "new file descriptor %d is too large; you probably need "
                      "to rebuild Apache with a larger FD_SETSIZE "
                      "(currently %d)", 
                      csd, FD_SETSIZE);
         apr_socket_close(sock);
         return;
@@ -686,12 +686,13 @@
     apr_pool_t *ptrans;                /* Pool for per-transaction stuff */
     apr_pool_t *recycled_pool = NULL;
     int n;
     apr_pollfd_t *pollset;
     apr_status_t rv;
     ap_listen_rec *lr, *last_lr = ap_listeners;
+    int have_idle_worker = 0;
 
     free(ti);
 
     apr_poll_setup(&pollset, num_listensocks, tpool);
     for(lr = ap_listeners ; lr != NULL ; lr = lr->next)
         apr_poll_socket_add(pollset, lr->sd, APR_POLLIN);
@@ -708,24 +709,28 @@
         /* TODO: requests_this_child should be synchronized - aaron */
         if (requests_this_child <= 0) {
             check_infinite_requests();
         }
         if (listener_may_exit) break;
 
-        rv = ap_queue_info_wait_for_idler(worker_queue_info,
-                                          &recycled_pool);
-        if (APR_STATUS_IS_EOF(rv)) {
-            break; /* we've been signaled to die now */
-        }
-        else if (rv != APR_SUCCESS) {
-            ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
-                         "apr_queue_info_wait failed. Attempting to shutdown "
-                         "process gracefully.");
-            signal_threads(ST_GRACEFUL);
-            break;
+        if (!have_idle_worker) {
+            rv = ap_queue_info_wait_for_idler(worker_queue_info,
+                                              &recycled_pool);
+            if (APR_STATUS_IS_EOF(rv)) {
+                break; /* we've been signaled to die now */
+            }
+            else if (rv != APR_SUCCESS) {
+                ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
+                             "apr_queue_info_wait failed. Attempting to "
+                             " shutdown process gracefully.");
+                signal_threads(ST_GRACEFUL);
+                break;
+            }
+            have_idle_worker = 1;
         }
+            
         /* We've already decremented the idle worker count inside
          * ap_queue_info_wait_for_idler. */
 
         if ((rv = SAFE_ACCEPT(apr_proc_mutex_lock(accept_mutex)))
             != APR_SUCCESS) {
             int level = APLOG_EMERG;
@@ -789,13 +794,13 @@
             /* create a new transaction pool for each accepted socket */
             if (recycled_pool == NULL) {
                 apr_allocator_t *allocator;
 
                 apr_allocator_create(&allocator);
                 apr_pool_create_ex(&ptrans, NULL, NULL, allocator);
-                apr_allocator_set_owner(allocator, ptrans);
+                apr_allocator_owner_set(allocator, ptrans);
             }
             else {
                 ptrans = recycled_pool;
             }
             apr_pool_tag(ptrans, "transaction");
             rv = lr->accept_func(&csd, lr, ptrans);
@@ -830,12 +835,15 @@
                      * socket to a worker 
                      */
                     apr_socket_close(csd);
                     ap_log_error(APLOG_MARK, APLOG_CRIT, rv, ap_server_conf,
                                  "ap_queue_push failed");
                 }
+                else {
+                    have_idle_worker = 0;
+                }
             }
         }
         else {
             if ((rv = SAFE_ACCEPT(apr_proc_mutex_unlock(accept_mutex)))
                 != APR_SUCCESS) {
                 ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
@@ -872,28 +880,32 @@
     int thread_slot = ti->tid;
     apr_socket_t *csd = NULL;
     apr_bucket_alloc_t *bucket_alloc;
     apr_pool_t *last_ptrans = NULL;
     apr_pool_t *ptrans;                /* Pool for per-transaction stuff */
     apr_status_t rv;
+    int is_idle = 0;
 
     free(ti);
 
     ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_STARTING, NULL);
 
     bucket_alloc = apr_bucket_alloc_create(apr_thread_pool_get(thd));
 
     while (!workers_may_exit) {
-        rv = ap_queue_info_set_idle(worker_queue_info, last_ptrans);
-        last_ptrans = NULL;
-        if (rv != APR_SUCCESS) {
-            ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
-                         "ap_queue_info_set_idle failed. Attempting to "
-                         "shutdown process gracefully.");
-            signal_threads(ST_GRACEFUL);
-            break;
+        if (!is_idle) {
+            rv = ap_queue_info_set_idle(worker_queue_info, last_ptrans);
+            last_ptrans = NULL;
+            if (rv != APR_SUCCESS) {
+                ap_log_error(APLOG_MARK, APLOG_EMERG, rv, ap_server_conf,
+                             "ap_queue_info_set_idle failed. Attempting to "
+                             "shutdown process gracefully.");
+                signal_threads(ST_GRACEFUL);
+                break;
+            }
+            is_idle = 1;
         }
 
         ap_update_child_status_from_indexes(process_slot, thread_slot, SERVER_READY, NULL);
 worker_pop:
         if (workers_may_exit) {
             break;
@@ -925,12 +937,13 @@
             else if (!workers_may_exit) {
                 ap_log_error(APLOG_MARK, APLOG_CRIT, rv, ap_server_conf,
                              "ap_queue_pop failed");
             }
             continue;
         }
+        is_idle = 0;
         worker_sockets[thread_slot] = csd;
         process_socket(ptrans, csd, process_slot, thread_slot, bucket_alloc);
         worker_sockets[thread_slot] = NULL;
         requests_this_child--; /* FIXME: should be synchronized - aaron */
         apr_pool_clear(ptrans);
         last_ptrans = ptrans;
@@ -1363,13 +1376,13 @@
         /* By default, AIX binds to a single processor.  This bit unbinds
          * children which will then bind to another CPU.
          */
         int status = bindprocessor(BINDPROCESS, (int)getpid(),
                                PROCESSOR_CLASS_ANY);
         if (status != OK)
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, errno, 
+            ap_log_error(APLOG_MARK, APLOG_WARNING, errno, 
                          ap_server_conf,
                          "processor unbind failed %d", status);
 #endif
         RAISE_SIGSTOP(MAKE_CHILD);
 
         apr_signal(SIGTERM, just_die);
@@ -1508,26 +1521,26 @@
         /* terminate the free list */
         if (free_length == 0) {
             /* only report this condition once */
             static int reported = 0;
             
             if (!reported) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, 
+                ap_log_error(APLOG_MARK, APLOG_ERR, 0, 
                              ap_server_conf,
                              "server reached MaxClients setting, consider"
                              " raising the MaxClients setting");
                 reported = 1;
             }
             idle_spawn_rate = 1;
         }
         else {
             if (free_length > idle_spawn_rate) {
                 free_length = idle_spawn_rate;
             }
             if (idle_spawn_rate >= 8) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, 
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0, 
                              ap_server_conf,
                              "server seems busy, (you may need "
                              "to increase StartServers, ThreadsPerChild "
                              "or Min/MaxSpareThreads), "
                              "spawning %d children, there are around %d idle "
                              "threads, and %d total children", free_length,
@@ -1598,13 +1611,13 @@
 #endif
             }
             else if (is_graceful) {
                 /* Great, we've probably just lost a slot in the
                  * scoreboard.  Somehow we don't know about this child.
                  */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0,
+                ap_log_error(APLOG_MARK, APLOG_WARNING, 0,
                              ap_server_conf,
                              "long lost child came home! (pid %ld)",
                              (long)pid.pid);
             }
             /* Don't perform idle maintenance when a child dies,
              * only do it when there's a timeout.  Remember only a
@@ -1638,13 +1651,13 @@
 
     ap_log_pid(pconf, ap_pid_fname);
 
     first_server_limit = server_limit;
     first_thread_limit = thread_limit;
     if (changed_limit_at_restart) {
-        ap_log_error(APLOG_MARK, APLOG_WARNING | APLOG_NOERRNO, 0, s,
+        ap_log_error(APLOG_MARK, APLOG_WARNING, 0, s,
                      "WARNING: Attempt to change ServerLimit or ThreadLimit "
                      "ignored during restart");
         changed_limit_at_restart = 0;
     }
     
     /* Initialize cross-process accept lock */
@@ -1709,20 +1722,22 @@
     else {
         /* give the system some time to recover before kicking into
             * exponential mode */
         hold_off_on_exponential_spawning = 10;
     }
 
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                 "%s configured -- resuming normal operations",
                 ap_get_server_version());
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, ap_server_conf,
+    ap_log_error(APLOG_MARK, APLOG_INFO, 0, ap_server_conf,
                 "Server built: %s", ap_get_server_built());
 #ifdef AP_MPM_WANT_SET_ACCEPT_LOCK_MECH
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, 0, ap_server_conf,
-		"AcceptMutex: %s", ap_valid_accept_mutex_string);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, ap_server_conf,
+		"AcceptMutex: %s (default: %s)",
+		apr_proc_mutex_name(accept_mutex),
+		apr_proc_mutex_defname());
 #endif
     restart_pending = shutdown_pending = 0;
 
     server_main_loop(remaining_children_to_start);
 
     if (shutdown_pending) {
@@ -1736,18 +1751,18 @@
 
         if (!child_fatal) {
             /* cleanup pid file on normal shutdown */
             const char *pidfile = NULL;
             pidfile = ap_server_root_relative (pconf, ap_pid_fname);
             if ( pidfile != NULL && unlink(pidfile) == 0)
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0,
+                ap_log_error(APLOG_MARK, APLOG_INFO, 0,
                              ap_server_conf,
                              "removed PID file %s (pid=%ld)",
                              pidfile, (long)getpid());
     
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0,
+            ap_log_error(APLOG_MARK, APLOG_NOTICE, 0,
                          ap_server_conf, "caught SIGTERM, shutting down");
         }
         return 1;
     }
 
     /* we've been told to restart */
@@ -1763,13 +1778,13 @@
      * use by any of the children.
      */
     ++ap_my_generation;
     ap_scoreboard_image->global->running_generation = ap_my_generation;
     
     if (is_graceful) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                      AP_SIG_GRACEFUL_STRING " received.  Doing graceful restart");
         /* wake up the children...time to die.  But we'll have more soon */
         ap_mpm_pod_killpg(pod, ap_daemons_limit, TRUE);
     
 
         /* This is mostly for debugging... so that we know what is still
@@ -1782,13 +1797,13 @@
          * and a SIGHUP, we may as well use the same signal, because some user
          * pthreads are stealing signals from us left and right.
          */
         ap_mpm_pod_killpg(pod, ap_daemons_limit, FALSE);
 
         ap_reclaim_child_processes(1);                /* Start with SIGTERM */
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, ap_server_conf,
+        ap_log_error(APLOG_MARK, APLOG_NOTICE, 0, ap_server_conf,
                     "SIGHUP received.  Attempting to restart");
     }
 
     return 0;
 }
 
@@ -1800,13 +1815,13 @@
     apr_status_t rv;
 
     pconf = p;
     ap_server_conf = s;
 
     if ((num_listensocks = ap_setup_listeners(ap_server_conf)) < 1) {
-        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ALERT|APLOG_STARTUP, 0,
+        ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0,
                      NULL, "no listening sockets available, shutting down");
         return DONE;
     }
 
     if (!one_process) {
         if ((rv = ap_mpm_pod_open(pconf, &pod))) {
@@ -1940,17 +1955,17 @@
     if (err != NULL) {
         return err;
     }
 
     min_spare_threads = atoi(arg);
     if (min_spare_threads <= 0) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: detected MinSpareThreads set to non-positive.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Resetting to 1 to avoid almost certain Apache failure.");
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "Please read the documentation.");
        min_spare_threads = 1;
     }
        
     return NULL;
 }
@@ -1977,53 +1992,53 @@
     }
 
     /* It is ok to use ap_threads_per_child here because we are
      * sure that it gets set before MaxClients in the pre_config stage. */
     max_clients = atoi(arg);
     if (max_clients < ap_threads_per_child) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) must be at least as large",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " large as ThreadsPerChild (%d). Automatically",
                     ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " increasing MaxClients to %d.",
                     ap_threads_per_child);
        max_clients = ap_threads_per_child;
     }
     ap_daemons_limit = max_clients / ap_threads_per_child;
     if ((max_clients > 0) && (max_clients % ap_threads_per_child)) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients (%d) is not an integer multiple",
                     max_clients);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " of ThreadsPerChild (%d), lowering MaxClients to %d",
                     ap_threads_per_child,
                     ap_daemons_limit * ap_threads_per_child);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " for a maximum of %d child processes,",
                     ap_daemons_limit);
        max_clients = ap_daemons_limit * ap_threads_per_child; 
     }
     if (ap_daemons_limit > server_limit) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: MaxClients of %d would require %d servers,",
                     max_clients, ap_daemons_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " and would exceed the ServerLimit value of %d.",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " Automatically lowering MaxClients to %d.  To increase,",
                     server_limit);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " please see the ServerLimit directive.");
        ap_daemons_limit = server_limit;
     } 
     else if (ap_daemons_limit < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require MaxClients > 0, setting to 1");
         ap_daemons_limit = 1;
     }
     return NULL;
 }
 
@@ -2034,25 +2049,25 @@
     if (err != NULL) {
         return err;
     }
 
     ap_threads_per_child = atoi(arg);
     if (ap_threads_per_child > thread_limit) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: ThreadsPerChild of %d exceeds ThreadLimit "
                      "value of %d", ap_threads_per_child,
                      thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "threads, lowering ThreadsPerChild to %d. To increase, please"
                      " see the", thread_limit);
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      " ThreadLimit directive.");
         ap_threads_per_child = thread_limit;
     }
     else if (ap_threads_per_child < 1) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadsPerChild > 0, setting to 1");
         ap_threads_per_child = 1;
     }
     return NULL;
 }
 
@@ -2078,21 +2093,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     server_limit = tmp_server_limit;
     
     if (server_limit > MAX_SERVER_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ServerLimit of %d exceeds compile time limit "
                     "of %d servers,", server_limit, MAX_SERVER_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ServerLimit to %d.", MAX_SERVER_LIMIT);
        server_limit = MAX_SERVER_LIMIT;
     } 
     else if (server_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ServerLimit > 0, setting to 1");
 	server_limit = 1;
     }
     return NULL;
 }
 
@@ -2118,21 +2133,21 @@
         changed_limit_at_restart = 1;
         return NULL;
     }
     thread_limit = tmp_thread_limit;
     
     if (thread_limit > MAX_THREAD_LIMIT) {
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     "WARNING: ThreadLimit of %d exceeds compile time limit "
                     "of %d servers,", thread_limit, MAX_THREAD_LIMIT);
-       ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+       ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                     " lowering ThreadLimit to %d.", MAX_THREAD_LIMIT);
        thread_limit = MAX_THREAD_LIMIT;
     } 
     else if (thread_limit < 1) {
-	ap_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL, 
+	ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL, 
                      "WARNING: Require ThreadLimit > 0, setting to 1");
 	thread_limit = 1;
     }
     return NULL;
 }
 
@@ -2155,13 +2170,13 @@
   "Maximum worker threads in a server for this run of Apache"),
 { NULL }
 };
 
 module AP_MODULE_DECLARE_DATA mpm_worker_module = {
     MPM20_MODULE_STUFF,
-    NULL,                       /* hook to run before apache parses args */
+    ap_mpm_rewrite_args,        /* hook to run before apache parses args */
     NULL,                       /* create per-directory config structure */
     NULL,                       /* merge per-directory config structures */
     NULL,                       /* create per-server config structure */
     NULL,                       /* merge per-server config structures */
     worker_cmds,                /* command apr_table_t */
     worker_hooks                /* register_hooks */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm_common.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm_common.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/mpm_common.c	2002-04-09 14:48:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/mpm_common.c	2002-06-09 11:44:03.000000000 +0800
@@ -70,12 +70,14 @@
 #include "apr.h"
 #include "apr_thread_proc.h"
 #include "apr_signal.h"
 #include "apr_strings.h"
 #define APR_WANT_STRFUNC
 #include "apr_want.h"
+#include "apr_getopt.h"
+#include "apr_optional.h"
 
 #include "httpd.h"
 #include "http_config.h"
 #include "http_log.h"
 #include "http_main.h"
 #include "mpm.h"
@@ -140,23 +142,23 @@
                 break;
 
             case 5:     /*  82ms */
             case 6:     /* 344ms */
             case 7:     /* 1.4sec */
                 /* ok, now it's being annoying */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING,
+                ap_log_error(APLOG_MARK, APLOG_WARNING,
                              0, ap_server_conf,
                              "child process %ld still did not exit, "
                              "sending a SIGTERM",
                              (long)pid);
                 kill(pid, SIGTERM);
                 break;
 
             case 8:     /*  6 sec */
                 /* die child scum */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR,
+                ap_log_error(APLOG_MARK, APLOG_ERR,
                              0, ap_server_conf,
                              "child process %ld still did not exit, "
                              "sending a SIGKILL",
                              (long)pid);
 #ifndef BEOS
                 kill(pid, SIGKILL);
@@ -174,13 +176,13 @@
             case 9:     /* 14 sec */
                 /* gave it our best shot, but alas...  If this really
                  * is a child we are trying to kill and it really hasn't
                  * exited, we will likely fail to bind to the port
                  * after the restart.
                  */
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR,
+                ap_log_error(APLOG_MARK, APLOG_ERR,
                              0, ap_server_conf,
                              "could not make child process %ld exit, "
                              "attempting to continue anyway",
                              (long)pid);
                 break;
             }
@@ -239,13 +241,13 @@
 #endif /* AP_MPM_WANT_WAIT_OR_TIMEOUT */
 
 #ifdef AP_MPM_WANT_PROCESS_CHILD_STATUS
 int ap_process_child_status(apr_proc_t *pid, apr_exit_why_e why, int status)
 {
     int signum = status;
-    const char *sigdesc = apr_signal_get_description(signum);
+    const char *sigdesc = apr_signal_description_get(signum);
 
     /* Child died... if it died due to a fatal error,
      * we should simply bail out.  The caller needs to
      * check for bad rc from us and exit, running any
      * appropriate cleanups.
      *
@@ -255,13 +257,13 @@
     if (APR_PROC_CHECK_EXIT(why)) {
         if (status == APEXIT_CHILDSICK) {
             return status;
         }
 
         if (status == APEXIT_CHILDFATAL) {
-            ap_log_error(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO,
+            ap_log_error(APLOG_MARK, APLOG_ALERT,
                          0, ap_server_conf,
                          "Child %" APR_PID_T_FMT
                          " returned a Fatal error..." APR_EOL_STR
                          "Apache is exiting!",
                          pid->pid);
             return APEXIT_CHILDFATAL;
@@ -277,21 +279,21 @@
         case AP_SIG_GRACEFUL:
         case SIGKILL:
             break;
 
         default:
             if (APR_PROC_CHECK_CORE_DUMP(why)) {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+                ap_log_error(APLOG_MARK, APLOG_NOTICE,
                              0, ap_server_conf,
                              "child pid %ld exit signal %s (%d), "
                              "possible coredump in %s",
                              (long)pid->pid, sigdesc, signum,
                              ap_coredump_dir);
             }
             else {
-                ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE,
+                ap_log_error(APLOG_MARK, APLOG_NOTICE,
                              0, ap_server_conf,
                              "child pid %ld exit signal %s (%d)",
                              (long)pid->pid, sigdesc, signum);
             }
         }
     }
@@ -326,13 +328,13 @@
     struct passwd *ent;
 
     if (name[0] == '#')
         return (atoi(&name[1]));
 
     if (!(ent = getpwnam(name))) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP|APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s: bad user name %s", ap_server_argv0, name);
         exit(1);
     }
 
     return (ent->pw_uid);
 }
@@ -344,13 +346,13 @@
     struct group *ent;
 
     if (name[0] == '#')
         return (atoi(&name[1]));
 
     if (!(ent = getgrnam(name))) {
-        ap_log_error(APLOG_MARK, APLOG_STARTUP|APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, 0, NULL,
                      "%s: bad group name %s", ap_server_argv0, name);
         exit(1);
     }
 
     return (ent->gr_gid);
 }
@@ -727,6 +729,154 @@
                            ap_valid_accept_mutex_string, NULL);
     }
     return NULL;
 }
 
 #endif
+
+#ifdef AP_MPM_WANT_SIGNAL_SERVER
+
+static const char *dash_k_arg;
+
+static int send_signal(pid_t pid, int sig)
+{
+    if (kill(pid, sig) < 0) {
+        ap_log_error(APLOG_MARK, APLOG_STARTUP, errno, NULL,
+                     "sending signal to server");
+        return 1;
+    }
+    return 0;
+}
+
+int ap_signal_server(int *exit_status, apr_pool_t *pconf)
+{
+    apr_status_t rv;
+    pid_t otherpid;
+    int running = 0;
+    int have_pid_file = 0;
+    const char *status;
+    
+    *exit_status = 0;
+
+    rv = ap_read_pid(pconf, ap_pid_fname, &otherpid);
+    if (rv != APR_SUCCESS) {
+        if (rv != APR_ENOENT) {
+            ap_log_error(APLOG_MARK, APLOG_STARTUP, rv, NULL,
+                         "Error retrieving pid file %s", ap_pid_fname);
+            *exit_status = 1;
+            return 1;
+        }
+        status = "httpd (no pid file) not running";
+    }
+    else {
+        have_pid_file = 1;
+        if (kill(otherpid, 0) == 0) {
+            running = 1;
+            status = apr_psprintf(pconf, 
+                                  "httpd (pid %" APR_PID_T_FMT ") already "
+                                  "running", otherpid);
+        }
+        else {
+            status = apr_psprintf(pconf,
+                                  "httpd (pid %" APR_PID_T_FMT "?) not running",
+                                  otherpid);
+        }
+    }
+
+    if (!strcmp(dash_k_arg, "start")) {
+        if (running) {
+            printf("%s\n", status);
+            return 1;
+        }
+    }
+
+    if (!strcmp(dash_k_arg, "stop")) {
+        if (!running) {
+            printf("%s\n", status);
+        }
+        else {
+            send_signal(otherpid, SIGTERM);
+        }
+        return 1;
+    }
+
+    if (!strcmp(dash_k_arg, "restart")) {
+        if (!running) {
+            printf("httpd not running, trying to start\n");
+        }
+        else {
+            *exit_status = send_signal(otherpid, SIGHUP);
+            return 1;
+        }
+    }
+
+    if (!strcmp(dash_k_arg, "graceful")) {
+        if (!running) {
+            printf("httpd not running, trying to start\n");
+        }
+        else {
+            *exit_status = send_signal(otherpid, SIGUSR1);
+            return 1;
+        }
+    }
+
+    return 0;
+}
+
+void ap_mpm_rewrite_args(process_rec *process)
+{
+    apr_array_header_t *mpm_new_argv;
+    apr_status_t rv;
+    apr_getopt_t *opt;
+    char optbuf[3];
+    const char *optarg;
+    int fixed_args;
+
+    mpm_new_argv = apr_array_make(process->pool, process->argc,
+                                  sizeof(const char **));
+    *(const char **)apr_array_push(mpm_new_argv) = process->argv[0];
+    fixed_args = mpm_new_argv->nelts;
+    apr_getopt_init(&opt, process->pool, process->argc, process->argv);
+    opt->errfn = NULL;
+    optbuf[0] = '-';
+    /* option char returned by apr_getopt() will be stored in optbuf[1] */
+    optbuf[2] = '\0';
+    while ((rv = apr_getopt(opt, "k:" AP_SERVER_BASEARGS,
+                            optbuf + 1, &optarg)) == APR_SUCCESS) {
+        switch(optbuf[1]) {
+        case 'k':
+            if (!dash_k_arg) {
+                if (!strcmp(optarg, "start") || !strcmp(optarg, "stop") ||
+                    !strcmp(optarg, "restart") || !strcmp(optarg, "graceful")) {
+                    dash_k_arg = optarg;
+                    break;
+                }
+            }
+        default:
+            *(const char **)apr_array_push(mpm_new_argv) =
+                apr_pstrdup(process->pool, optbuf);
+            if (optarg) {
+                *(const char **)apr_array_push(mpm_new_argv) = optarg;
+            }
+        }
+    }
+
+    /* back up to capture the bad argument */
+    if (rv == APR_BADCH || rv == APR_BADARG) {
+        opt->ind--;
+    }
+
+    while (opt->ind < opt->argc) {
+        *(const char **)apr_array_push(mpm_new_argv) =
+            apr_pstrdup(process->pool, opt->argv[opt->ind++]);
+    }
+
+    process->argc = mpm_new_argv->nelts;
+    process->argv = (const char * const *)mpm_new_argv->elts;
+
+    if (dash_k_arg) {
+        APR_REGISTER_OPTIONAL_FN(ap_signal_server);
+    }
+}
+
+#endif /* AP_MPM_WANT_SIGNAL_SERVER */
+
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/protocol.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/protocol.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/protocol.c	2002-04-28 14:24:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/protocol.c	2002-06-11 02:51:38.000000000 +0800
@@ -65,12 +65,13 @@
 
 #include "apr.h"
 #include "apr_strings.h"
 #include "apr_buckets.h"
 #include "apr_lib.h"
 #include "apr_signal.h"
+#include "apr_strmatch.h"
 
 #define APR_WANT_STDIO          /* for sscanf */
 #define APR_WANT_STRFUNC
 #define APR_WANT_MEMFUNC
 #include "apr_want.h"
 
@@ -104,52 +105,82 @@
     APR_HOOK_LINK(http_method)
     APR_HOOK_LINK(default_port)
 )
 
 AP_DECLARE_DATA ap_filter_rec_t *ap_old_write_func = NULL;
 
+
+/* Patterns to match in ap_make_content_type() */
+static const char *needcset[] = {
+    "text/plain",
+    "text/html",
+    NULL
+};
+static const apr_strmatch_pattern **needcset_patterns;
+static const apr_strmatch_pattern *charset_pattern;
+
+AP_DECLARE(void) ap_setup_make_content_type(apr_pool_t *pool)
+{
+    int i;
+    for (i = 0; needcset[i]; i++) {
+        continue;
+    }
+    needcset_patterns = (const apr_strmatch_pattern **)
+        apr_palloc(pool, (i + 1) * sizeof(apr_strmatch_pattern *));
+    for (i = 0; needcset[i]; i++) {
+        needcset_patterns[i] = apr_strmatch_precompile(pool, needcset[i], 0);
+    }
+    needcset_patterns[i] = NULL;
+    charset_pattern = apr_strmatch_precompile(pool, "charset=", 0);
+}
+
 /*
  * Builds the content-type that should be sent to the client from the
  * content-type specified.  The following rules are followed:
  *    - if type is NULL, type is set to ap_default_type(r)
  *    - if charset adding is disabled, stop processing and return type.
  *    - then, if there are no parameters on type, add the default charset
  *    - return type
  */
 AP_DECLARE(const char *)ap_make_content_type(request_rec *r, const char *type)
 {
-    static const char *needcset[] = {
-        "text/plain",
-        "text/html",
-        NULL };
-    const char **pcset;
+    const apr_strmatch_pattern **pcset;
     core_dir_config *conf =
         (core_dir_config *)ap_get_module_config(r->per_dir_config,
                                                 &core_module);
+    apr_size_t type_len;
 
     if (!type) {
         type = ap_default_type(r);
     }
 
     if (conf->add_default_charset != ADD_DEFAULT_CHARSET_ON) {
         return type;
     }
 
-    if (ap_strcasestr(type, "charset=") != NULL) {
+    type_len = strlen(type);
+
+    if (apr_strmatch(charset_pattern, type, type_len) != NULL) {
         /* already has parameter, do nothing */
         /* XXX we don't check the validity */
         ;
     }
     else {
         /* see if it makes sense to add the charset. At present,
          * we only add it if the Content-type is one of needcset[]
          */
-        for (pcset = needcset; *pcset ; pcset++) {
-            if (ap_strcasestr(type, *pcset) != NULL) {
-                type = apr_pstrcat(r->pool, type, "; charset=",
-                                   conf->add_default_charset_name, NULL);
+        for (pcset = needcset_patterns; *pcset ; pcset++) {
+            if (apr_strmatch(*pcset, type, type_len) != NULL) {
+                struct iovec concat[3];
+                concat[0].iov_base = (void *)type;
+                concat[0].iov_len = type_len;
+                concat[1].iov_base = (void *)"; charset=";
+                concat[1].iov_len = sizeof("; charset=") - 1;
+                concat[2].iov_base = (void *)(conf->add_default_charset_name);
+                concat[2].iov_len = strlen(conf->add_default_charset_name);
+                type = apr_pstrcatv(r->pool, concat, 3, NULL);
                 break;
             }
         }
     }
 
     return type;
@@ -183,12 +214,15 @@
      * Last-Modified can't be in the future.
      */
     now = (mtime < r->request_time) ? r->request_time : apr_time_now();
     return (mtime > now) ? now : mtime;
 }
 
+/* Min # of bytes to allocate when reading a request line */
+#define MIN_LINE_ALLOC 80
+
 /* Get a line of protocol input, including any continuation lines
  * caused by MIME folding (or broken clients) if fold != 0, and place it
  * in the buffer s, of size n bytes, without the ending newline.
  *
  * If s is NULL, ap_rgetline_core will allocate necessary memory from r->pool.
  *
@@ -266,22 +300,25 @@
 
         /* Do we have to handle the allocation ourselves? */
         if (do_alloc) {
             /* We'll assume the common case where one bucket is enough. */
             if (!*s) {
                 current_alloc = len;
-                *s = apr_palloc(r->pool, len);
+                if (current_alloc < MIN_LINE_ALLOC) {
+                    current_alloc = MIN_LINE_ALLOC;
+                }
+                *s = apr_palloc(r->pool, current_alloc);
             }
             else if (bytes_handled + len > current_alloc) {
-                /* We resize to the next power of 2. */
-                apr_size_t new_size = current_alloc;
+                /* Increase the buffer size */
+                apr_size_t new_size = current_alloc * 2;
                 char *new_buffer;
 
-                do {
-                    new_size *= 2;
-                } while (bytes_handled + len > new_size);
+                if (bytes_handled + len > new_size) {
+                    new_size = (bytes_handled + len) * 2;
+                }
 
                 new_buffer = apr_palloc(r->pool, new_size);
 
                 /* Copy what we already had. */
                 memcpy(new_buffer, *s, bytes_handled);
                 current_alloc = new_size;
@@ -842,26 +879,26 @@
     r->status          = HTTP_REQUEST_TIME_OUT;  /* Until we get a request */
     r->the_request     = NULL;
 
     /* Get the request... */
     if (!read_request_line(r)) {
         if (r->status == HTTP_REQUEST_URI_TOO_LARGE) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "request failed: URI too long");
             ap_send_error_response(r, 0);
             ap_run_log_transaction(r);
             return r;
         }
 
         return NULL;
     }
 
     if (!r->assbackwards) {
         ap_get_mime_headers(r);
         if (r->status != HTTP_REQUEST_TIME_OUT) {
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "request failed: error reading the headers");
             ap_send_error_response(r, 0);
             ap_run_log_transaction(r);
             return r;
         }
     }
@@ -869,13 +906,13 @@
         if (r->header_only) {
             /*
              * Client asked for headers only with HTTP/0.9, which doesn't send
              * headers! Have to dink things just to make sure the error message
              * comes through...
              */
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                           "client sent invalid HTTP/0.9 request: HEAD %s",
                           r->uri);
             r->header_only = 0;
             r->status = HTTP_BAD_REQUEST;
             ap_send_error_response(r, 0);
             ap_run_log_transaction(r);
@@ -901,13 +938,13 @@
          * hostname, either with a full URL or a Host: header. We therefore
          * need to (as per the 1.1 spec) send an error.  As a special case,
          * HTTP/1.1 mentions twice (S9, S14.23) that a request MUST contain
          * a Host: header, and the server MUST respond with 400 if it doesn't.
          */
         r->status = HTTP_BAD_REQUEST;
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "client sent HTTP/1.1 request without hostname "
                       "(see RFC2616 section 14.23): %s", r->uri);
     }
 
     if (r->status != HTTP_OK) {
         ap_send_error_response(r, 0);
@@ -925,17 +962,16 @@
          */
         if (strcasecmp(expect, "100-continue") == 0) {
             r->expecting_100 = 1;
         }
         else {
             r->status = HTTP_EXPECTATION_FAILED;
-            ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
+            ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                           "client sent an unrecognized expectation value of "
                           "Expect: %s", expect);
             ap_send_error_response(r, 0);
-            (void) ap_discard_request_body(r);
             ap_run_log_transaction(r);
             return r;
         }
     }
 
     ap_add_input_filter_handle(ap_http_input_filter_handle,
@@ -994,22 +1030,27 @@
     APR_BRIGADE_INSERT_TAIL(bb, b);
     ap_pass_brigade(r->output_filters, bb);
 }
 
 void ap_finalize_sub_req_protocol(request_rec *sub)
 {
-    end_output_stream(sub);
+    /* tell the filter chain there is no more content coming */
+    if (!sub->eos_sent) {
+        end_output_stream(sub);
+    }
 }
 
 /* finalize_request_protocol is called at completion of sending the
  * response.  Its sole purpose is to send the terminating protocol
  * information for any wrappers around the response message body
  * (i.e., transfer encodings).  It should have been named finalize_response.
  */
 AP_DECLARE(void) ap_finalize_request_protocol(request_rec *r)
 {
+    (void) ap_discard_request_body(r);
+
     while (r->next) {
         r = r->next;
     }
 
     /* tell the filter chain there is no more content coming */
     if (!r->eos_sent) {
@@ -1027,13 +1068,13 @@
         if (!strcasecmp(type, "Basic"))
             ap_note_basic_auth_failure(r);
         else if (!strcasecmp(type, "Digest"))
             ap_note_digest_auth_failure(r);
     }
     else {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR,
                       0, r, "need AuthType to note auth failure: %s", r->uri);
     }
 }
 
 AP_DECLARE(void) ap_note_basic_auth_failure(request_rec *r)
 {
@@ -1070,25 +1111,25 @@
     const char *t;
 
     if (!(t = ap_auth_type(r)) || strcasecmp(t, "Basic"))
         return DECLINED;
 
     if (!ap_auth_name(r)) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR,
                       0, r, "need AuthName: %s", r->uri);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
 
     if (!auth_line) {
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
 
     if (strcasecmp(ap_getword(r->pool, &auth_line, ' '), "Basic")) {
         /* Client tried to authenticate using wrong auth scheme */
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "client used wrong authentication scheme: %s", r->uri);
         ap_note_basic_auth_failure(r);
         return HTTP_UNAUTHORIZED;
     }
 
     while (*auth_line == ' ' || *auth_line == '\t') {
@@ -1130,12 +1171,13 @@
     apr_read_type_e eblock = APR_NONBLOCK_READ;
 
     ctx = f->ctx;
     if (!ctx) { /* first time through */
         f->ctx = ctx = apr_pcalloc(r->pool, sizeof(struct content_length_ctx));
         ctx->compute_len = 1;   /* Assume we will compute the length */
+        ctx->saved = apr_brigade_create(r->pool, f->c->bucket_alloc);
     }
 
     /* Humm, is this check the best it can be?
      * - protocol >= HTTP/1.1 implies support for chunking
      * - non-keepalive implies the end of byte stream will be signaled
      *    by a connection close
@@ -1214,18 +1256,14 @@
             r->bytes_sent += len;
         }
 
         if (split) {
             ctx->compute_len = 0;  /* Ooops, can't compute the length now */
             ctx->curr_len = 0;
-            if (ctx->saved) {
-                APR_BRIGADE_CONCAT(ctx->saved, split);
-                apr_brigade_destroy(split);
-                split = ctx->saved;
-                ctx->saved = NULL;
-            }
+
+            APR_BRIGADE_PREPEND(split, ctx->saved);
 
             if (flush) {
                 rv = ap_fflush(f->next, split);
             }
             else {
                 rv = ap_pass_brigade(f->next, split);
@@ -1249,18 +1287,13 @@
             return ap_save_brigade(f, &ctx->saved, &b, r->pool);
         }
 
         ap_set_content_length(r, r->bytes_sent);
     }
 
-    if (ctx->saved) {
-        APR_BRIGADE_CONCAT(ctx->saved, b);
-        apr_brigade_destroy(b);
-        b = ctx->saved;
-        ctx->saved = NULL;
-    }
+    APR_BRIGADE_PREPEND(b, ctx->saved);
 
     ctx->curr_len = 0;
     return ap_pass_brigade(f->next, b);
 }
 
 /*
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/request.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/request.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/request.c	2002-04-24 12:20:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/request.c	2002-05-17 19:11:37.000000000 +0800
@@ -123,13 +123,13 @@
                           (request_rec *r), (r), OK, DECLINED)
 
 
 static int decl_die(int status, char *phase, request_rec *r)
 {
     if (status == DECLINED) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_CRIT, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_CRIT, 0, r,
                       "configuration error:  couldn't %s: %s", phase, r->uri);
         return HTTP_INTERNAL_SERVER_ERROR;
     }
     else {
         return status;
     }
@@ -368,13 +368,13 @@
         || r->finfo.filetype == APR_DIR
         || r->finfo.filetype == APR_REG
         || r->finfo.filetype == APR_LNK) {
         return OK;
     }
 
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "object is not a file, directory or symlink: %s",
                   r->filename);
     return HTTP_FORBIDDEN;
 }
 
 /*
@@ -484,26 +484,26 @@
      * modules to proceed, we will permit the not-a-path filename to pass the
      * following two tests.  This behavior may be revoked in future versions
      * of Apache.  We still must catch it later if it's heading for the core
      * handler.  Leave INFO notes here for module debugging.
      */
     if (r->filename == NULL) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                       "Module bug?  Request filename is missing for URI %s",
                       r->uri);
        return OK;
     }
 
     /* Canonicalize the file path without resolving filename case or aliases
      * so we can begin by checking the cache for a recent directory walk.
      * This call will ensure we have an absolute path in the same pass.
      */
     if ((rv = apr_filepath_merge(&entry_dir, NULL, r->filename,
                                  APR_FILEPATH_NOTRELATIVE, r->pool))
                   != APR_SUCCESS) {
-        ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_INFO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_INFO, 0, r,
                       "Module bug?  Request filename path %s is invalid or "
                       "or not absolute for uri %s",
                       r->filename, r->uri);
         return OK;
     }
 
@@ -1026,13 +1026,13 @@
 
             if (thisinfo.filetype == APR_LNK) {
                 /* Is this a possibly acceptable symlink?
                  */
                 if ((res = resolve_symlink(r->filename, &thisinfo,
                                            opts, r->pool)) != OK) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "Symbolic link not allowed: %s",
                                   r->filename);
                     return r->status = res;
                 }
 
                 /* Ok, we are done with the link's info, test the real target
@@ -1040,13 +1040,13 @@
                 if (thisinfo.filetype == APR_REG) {
                     /* That was fun, nothing left for us here
                      */
                     break;
                 }
                 else if (thisinfo.filetype != APR_DIR) {
-                    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+                    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                                   "symlink doesn't point to a file or "
                                   "directory: %s",
                                   r->filename);
                     return r->status = HTTP_FORBIDDEN;
                 }
             }
@@ -1143,13 +1143,13 @@
  x    * APR_DIR test.  But if you accessed /symlink/index.html, for example,
  x    * you would *not* get the 403.
  x
  x   if (r->finfo.filetype != APR_DIR
  x       && (res = resolve_symlink(r->filename, r->info, ap_allow_options(r),
  x                                 r->pool))) {
- x       ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+ x       ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
  x                     "Symbolic link not allowed: %s", r->filename);
  x       return res;
  x   }
  */
 
     /* Save future sub-requestors much angst in processing
@@ -1189,22 +1189,22 @@
                                                      &core_module);
     ap_conf_vector_t **sec_ent = (ap_conf_vector_t **)sconf->sec_url->elts;
     int num_sec = sconf->sec_url->nelts;
     walk_cache_t *cache;
     const char *entry_uri;
 
-    cache = prep_walk_cache(AP_NOTE_LOCATION_WALK, r);
-
     /* No tricks here, there are no <Locations > to parse in this vhost.
      * We won't destroy the cache, just in case _this_ redirect is later
      * redirected again to a vhost with <Location > blocks to optimize.
      */
     if (!num_sec) {
         return OK;
     }
 
+    cache = prep_walk_cache(AP_NOTE_LOCATION_WALK, r);
+
     /* Location and LocationMatch differ on their behaviour w.r.t. multiple
      * slashes.  Location matches multiple slashes with a single slash,
      * LocationMatch doesn't.  An exception, for backwards brokenness is
      * absoluteURIs... in which case neither match multiple slashes.
      */
     if (r->uri[0] != '/') {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/scoreboard.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/scoreboard.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/scoreboard.c	2002-04-04 14:39:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/scoreboard.c	2002-05-17 19:11:37.000000000 +0800
@@ -250,13 +250,13 @@
 {
 #if APR_HAS_SHARED_MEMORY
     if (!detached) {
         return APR_SUCCESS;
     }
     if (apr_shm_size_get(ap_scoreboard_shm) < scoreboard_size) {
-        ap_log_error(APLOG_MARK, APLOG_CRIT | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_CRIT, 0, NULL,
                      "Fatal error: shared scoreboard too small for child!");
         apr_shm_detach(ap_scoreboard_shm);
         ap_scoreboard_shm = NULL;
         return APR_EINVAL;
     }
     /* everything will be cleared shortly */
@@ -320,13 +320,13 @@
     else 
 #endif
     {
         /* A simple malloc will suffice */
         void *sb_mem = calloc(1, scoreboard_size);
         if (sb_mem == NULL) {
-            ap_log_error(APLOG_MARK, APLOG_CRIT | APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_CRIT, 0, NULL,
                          "(%d)%s: cannot allocate scoreboard",
                          errno, strerror(errno));
             return HTTP_INTERNAL_SERVER_ERROR;
         }
         ap_init_scoreboard(sb_mem);
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util.c	2002-04-29 15:20:46.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util.c	2002-05-17 19:11:37.000000000 +0800
@@ -833,13 +833,13 @@
 
        return apr_pstrdup(p,tmp);
 }
 AP_DECLARE(int) ap_cfg_closefile(ap_configfile_t *cfp)
 {
 #ifdef DEBUG
-    ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, NULL, 
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL, 
         "Done with config file %s", cfp->name);
 #endif
     return (cfp->close == NULL) ? 0 : cfp->close(cfp->param);
 }
 
 static apr_status_t cfg_close(void *param)
@@ -876,20 +876,20 @@
     apr_status_t status;
 #ifdef DEBUG
     char buf[120];
 #endif
 
     if (name == NULL) {
-        ap_log_error(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                "Internal error: pcfg_openfile() called with NULL filename");
         return APR_EBADF;
     }
 
     status = apr_file_open(&file, name, APR_READ | APR_BUFFERED, APR_OS_DEFAULT, p);
 #ifdef DEBUG
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL,
                 "Opening config file %s (%s)",
                 name, (status != APR_SUCCESS) ? 
                 apr_strerror(status, buf, sizeof(buf)) : "successful");
 #endif
     if (status != APR_SUCCESS)
         return status;
@@ -901,13 +901,13 @@
     if (finfo.filetype != APR_REG &&
 #if defined(WIN32) || defined(OS2) || defined(NETWARE)
         strcasecmp(apr_filename_of_pathname(name), "nul") != 0) {
 #else
         strcmp(name, "/dev/null") != 0) {
 #endif /* WIN32 || OS2 */
-        ap_log_error(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, NULL,
+        ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                     "Access to file %s denied by server: not a regular file",
                     name);
         apr_file_close(file);
         return APR_EBADF;
     }
 
@@ -952,13 +952,13 @@
     int(*getch)(void *param),
     void *(*getstr) (void *buf, size_t bufsiz, void *param),
     int(*close_func)(void *param))
 {
     ap_configfile_t *new_cfg = apr_palloc(p, sizeof(*new_cfg));
 #ifdef DEBUG
-    ap_log_error(APLOG_MARK, APLOG_DEBUG | APLOG_NOERRNO, 0, NULL, "Opening config handler %s", descr);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL, "Opening config handler %s", descr);
 #endif
     new_cfg->param = param;
     new_cfg->name = descr;
     new_cfg->getch = getch;
     new_cfg->getstr = getstr;
     new_cfg->close = close_func;
@@ -1039,13 +1039,13 @@
         /* Zap leading whitespace by shifting */
         if (src != buf)
 	    for (dst = buf; (*dst++ = *src++) != '\0'; )
 	        ;
 
 #ifdef DEBUG_CFG_LINES
-	ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, NULL, "Read config: %s", buf);
+	ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL, "Read config: %s", buf);
 #endif
 	return 0;
     } else {
 	/* No "get string" function defined; read character by character */
 	register int c;
 	register size_t i = 0;
@@ -1096,13 +1096,13 @@
 		}
 		/* blast trailing whitespace */
 		while (i > 0 && apr_isspace(buf[i - 1]))
 		    --i;
 		buf[i] = '\0';
 #ifdef DEBUG_CFG_LINES
-		ap_log_error(APLOG_MARK, APLOG_DEBUG|APLOG_NOERRNO, 0, NULL, "Read config: %s", buf);
+		ap_log_error(APLOG_MARK, APLOG_DEBUG, 0, NULL, "Read config: %s", buf);
 #endif
 		return 0;
 	    }
 	    buf[i] = c;
 	    ++i;
 	    c = cfp->getch(cfp->param);
@@ -1842,13 +1842,13 @@
         }
     }
 
     if (!server_hostname) 
         server_hostname = apr_pstrdup(a, "127.0.0.1");
 
-    ap_log_perror(APLOG_MARK, APLOG_ALERT|APLOG_NOERRNO|APLOG_STARTUP, 0, a,
+    ap_log_perror(APLOG_MARK, APLOG_ALERT|APLOG_STARTUP, 0, a,
                  "%s: Could not determine the server's fully qualified "
                  "domain name, using %s for ServerName",
                  ap_server_argv0, server_hostname);
              
     return server_hostname;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_filter.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_filter.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_filter.c	2002-03-29 16:17:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_filter.c	2002-05-17 19:11:37.000000000 +0800
@@ -303,23 +303,23 @@
 
     if (frec->ftype < AP_FTYPE_PROTOCOL) {
         if (r) {
             outf = r_filters;
         }
         else {
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                       "a content filter was added without a request: %s", frec->name);
             return NULL;
         }
     }
     else if (frec->ftype < AP_FTYPE_CONNECTION) {
         if (r) {
             outf = p_filters;
         }
         else {
-            ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, NULL,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                          "a protocol filter was added without a request: %s", frec->name);
             return NULL;
         }
     }
     else {
         outf = c_filters;
@@ -409,13 +409,13 @@
         if (node && node->frec) {
             return add_any_filter_handle(node->frec, ctx, r, c, r_filters, 
                                          p_filters, c_filters);
         }
     }
 
-    ap_log_error(APLOG_MARK, APLOG_ERR|APLOG_NOERRNO, 0, NULL,
+    ap_log_error(APLOG_MARK, APLOG_ERR, 0, NULL,
                  "an unknown filter was not added: %s", name);
     return NULL;
 }
 
 AP_DECLARE(ap_filter_t *) ap_add_input_filter(const char *name, void *ctx,
                                               request_rec *r, conn_rec *c)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_script.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_script.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_script.c	2002-04-22 11:25:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_script.c	2002-05-17 19:11:38.000000000 +0800
@@ -452,13 +452,13 @@
     cookie_table = apr_table_make(r->pool, 2);
     apr_table_do(set_cookie_doo_doo, cookie_table, r->err_headers_out, "Set-Cookie", NULL);
 
     while (1) {
 
 	if ((*getsfunc) (w, MAX_STRING_LEN - 1, getsfunc_data) == 0) {
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR|APLOG_TOCLIENT, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_TOCLIENT, 0, r,
 			  "Premature end of script headers: %s", 
                           apr_filename_of_pathname(r->filename));
 	    return HTTP_INTERNAL_SERVER_ERROR;
 	}
 
 	/* Delete terminal (CR?)LF */
@@ -522,13 +522,13 @@
 		if (isprint(*cp) && !isprint(native))
 		    ++maybeEBCDIC;
 		if (!isprint(*cp) && isprint(native))
 		    ++maybeASCII;
             }
 	    if (maybeASCII > maybeEBCDIC) {
-		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r->server,
+		ap_log_error(APLOG_MARK, APLOG_ERR, 0, r->server,
                              "CGI Interface Error: Script headers apparently ASCII: (CGI = %s)",
                              r->filename);
                 inbytes_left = outbytes_left = cp - w;
                 apr_xlate_conv_buffer(ap_hdrs_from_ascii,
                                       w, &inbytes_left, w, &outbytes_left);
 	    }
@@ -545,13 +545,13 @@
 		/* Soak up all the script output - may save an outright kill */
 	        while ((*getsfunc) (w, MAX_STRING_LEN - 1, getsfunc_data)) {
 		    continue;
 		}
 	    }
 
-	    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR|APLOG_TOCLIENT, 0, r,
+	    ap_log_rerror(APLOG_MARK, APLOG_ERR|APLOG_TOCLIENT, 0, r,
 			  "%s: %s", malformed, 
                           apr_filename_of_pathname(r->filename));
 	    return HTTP_INTERNAL_SERVER_ERROR;
 	}
 
 	*l++ = '\0';
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_xml.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_xml.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/util_xml.c	2002-03-14 04:48:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/util_xml.c	2002-06-03 15:53:42.000000000 +0800
@@ -59,13 +59,14 @@
 #include "http_log.h"
 #include "http_core.h"
 
 #include "util_xml.h"
 
 
-#define READ_BLOCKSIZE	2048	/* used for reading input blocks */
+/* used for reading input blocks */
+#define READ_BLOCKSIZE 2048
 
 
 AP_DECLARE(int) ap_xml_parse_input(request_rec * r, apr_xml_doc **pdoc)
 {
     apr_xml_parser *parser;
     int result;
@@ -92,13 +93,13 @@
 	buffer = apr_palloc(r->pool, READ_BLOCKSIZE);
 
 	/* read the body, stuffing it into the parser */
 	while ((len = ap_get_client_block(r, buffer, READ_BLOCKSIZE)) > 0) {
 	    total_read += len;
 	    if (limit_xml_body && total_read > limit_xml_body) {
-		ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+                ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
 			      "XML request body is larger than the configured "
 			      "limit of %lu", (unsigned long)limit_xml_body);
 		goto read_error;
 	    }
 
             status = apr_xml_parser_feed(parser, buffer, len);
@@ -111,22 +112,22 @@
 	}
     }
 
     /* tell the parser that we're done */
     status = apr_xml_parser_done(parser, pdoc);
     if (status) {
-        ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+        ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                       "XML parser error (at end). status=%d", status);
         return HTTP_BAD_REQUEST;
     }
 
     return OK;
 
   parser_error:
     (void) apr_xml_parser_geterror(parser, errbuf, sizeof(errbuf));
-    ap_log_rerror(APLOG_MARK, APLOG_ERR | APLOG_NOERRNO, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "%s", errbuf);
 
     /* FALLTHRU */
 
   read_error:
     /* make sure the parser is terminated */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/vhost.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/vhost.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/server/vhost.c	2002-04-15 10:58:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/server/vhost.c	2002-05-17 19:11:38.000000000 +0800
@@ -336,13 +336,13 @@
         else {
             ++total;
         }
     }
     p += apr_snprintf(p, sizeof(buf) - (p - buf), " %ux%u",
                       total, count[IPHASH_TABLE_SIZE - 1]);
-    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_DEBUG, main_s, buf);
+    ap_log_error(APLOG_MARK, APLOG_DEBUG, main_s, buf);
 }
 #endif
 
 
 /* This hashing function is designed to get good distribution in the cases
  * where the server is handling entire "networks" of servers.  i.e. a
@@ -514,13 +514,13 @@
         name_chain *nc = new_name_chain(p, s, sar);
         nc->next = ic->names;
         ic->names = nc;
         ic->server = s;
         if (sar->host_port != ic->sar->host_port) {
             /* one of the two is a * port, the other isn't */
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, main_s,
+            ap_log_error(APLOG_MARK, APLOG_ERR, 0, main_s,
                          "VirtualHost %s:%u -- mixing * "
                          "ports and non-* ports with "
                          "a NameVirtualHost address is not supported,"
                          " proceeding with undefined results",
                          sar->virthost, sar->host_port);
         }
@@ -535,13 +535,13 @@
 static void remove_unused_name_vhosts(server_rec *main_s, ipaddr_chain **pic)
 {
     while (*pic) {
         ipaddr_chain *ic = *pic;
         
         if (ic->server == NULL) {
-            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING, 0, main_s,
+            ap_log_error(APLOG_MARK, APLOG_WARNING, 0, main_s,
                          "NameVirtualHost %s:%u has no VirtualHosts",
                          ic->sar->virthost, ic->sar->host_port);
             *pic = ic->next;
         }
         else if (ic->names == NULL) {
             /* if server != NULL and names == NULL then we're done
@@ -621,13 +621,13 @@
             if ((sar->host_addr->family == AF_INET &&
                  sar->host_addr->sa.sin.sin_addr.s_addr == DEFAULT_VHOST_ADDR)
                 || !memcmp(sar->host_addr->ipaddr_ptr, inaddr_any, sar->host_addr->ipaddr_len)) {
                 ic = find_default_server(sar->host_port);
                 if (!ic || !add_name_vhost_config(p, main_s, s, sar, ic)) {
                     if (ic && ic->sar->host_port != 0) {
-                        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING,
+                        ap_log_error(APLOG_MARK, APLOG_WARNING,
                                      0, main_s, "_default_ VirtualHost "
                                      "overlap on port %u, the first has "
                                      "precedence", sar->host_port);
                     }
                     ic = new_ipaddr_chain(p, s, sar);
                     ic->next = default_list;
@@ -644,13 +644,13 @@
 
                     ic = new_ipaddr_chain(p, s, sar);
                     ic->next = *iphash_table_tail[bucket];
                     *iphash_table_tail[bucket] = ic;
                 }
                 else if (!add_name_vhost_config(p, main_s, s, sar, ic)) {
-                    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_WARNING,
+                    ap_log_error(APLOG_MARK, APLOG_WARNING,
                                  0, main_s, "VirtualHost %s:%u overlaps "
                                  "with VirtualHost %s:%u, the first has "
                                  "precedence, perhaps you need a "
                                  "NameVirtualHost directive",
                                  sar->virthost, sar->host_port,
                                  ic->sar->virthost, ic->sar->host_port);
@@ -757,22 +757,22 @@
 
     if (!host && port) {
         /* silly looking host ("Host: 123") but that isn't our job
          * here to judge; apr_parse_addr_port() would think we had a port
          * but no address
          */
-        host = apr_psprintf(r->pool, "%d", (int)port);
+        host = apr_itoa(r->pool, (int)port);
     }
     else if (port) {
         /* Don't throw the Host: header's port number away:
 	   save it in parsed_uri -- ap_get_server_port() needs it! */
         /* @@@ XXX there should be a better way to pass the port.
 	 *         Like r->hostname, there should be a r->portno
 	 */
         r->parsed_uri.port = port;
-	r->parsed_uri.port_str = apr_psprintf(r->pool, "%d", (int)port);
+	r->parsed_uri.port_str = apr_itoa(r->pool, (int)port);
     }
 
     /* if the hostname is an IPv6 numeric address string, it was validated 
      * already; otherwise, further validation is needed 
      */
     if (r->hostname[0] != '[') {
@@ -793,13 +793,13 @@
     }
     r->hostname = host;
     return;
 
 bad:
     r->status = HTTP_BAD_REQUEST;
-    ap_log_rerror(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, 0, r,
+    ap_log_rerror(APLOG_MARK, APLOG_ERR, 0, r,
                   "Client sent malformed Host header");
     return;
 }
 
 
 /* return 1 if host matches ServerName or ServerAliases */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/acconfig.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/acconfig.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/acconfig.h	2002-01-08 14:22:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/acconfig.h	2002-05-10 02:56:43.000000000 +0800
@@ -22,12 +22,17 @@
 #undef USE_FLOCK_SERIALIZE
 #undef USE_SYSVSEM_SERIALIZE
 #undef USE_FCNTL_SERIALIZE
 #undef USE_PROC_PTHREAD_SERIALIZE
 #undef USE_PTHREAD_SERIALIZE
 
+#undef POSIXSEM_IS_GLOBAL
+#undef SYSVSEM_IS_GLOBAL
+#undef FCNTL_IS_GLOBAL
+#undef FLOCK_IS_GLOBAL
+
 #undef READDIR_IS_THREAD_SAFE
 #undef GETHOSTBYNAME_IS_THREAD_SAFE
 #undef GETHOSTBYADDR_IS_THREAD_SAFE
 #undef STRERROR_R_RC_INT
 
 #undef HAVE_GMTOFF
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: apr-config
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/apr-config.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/apr-config.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/apr-config.in	2002-04-02 03:30:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/apr-config.in	2002-05-16 01:45:49.000000000 +0800
@@ -88,12 +88,13 @@
   --includes        print include information
   --ldflags         print linker flags
   --libs            print additional libraries to link against
   --srcdir          print APR source directory
   --link-ld         print link switch(es) for linking to APR
   --link-libtool    print the libtool inputs for linking to APR
+  --shlib-path-var  print the name of the shared library path env var
   --apr-la-file     print the path to the .la file, if available
   --apr-so-ext      print the extensions of shared objects on this platform
   --apr-lib-target  print the libtool target information
   --apr-libtool     print the path to APR's libtool
   --help            print this help
 
@@ -182,21 +183,29 @@
         flags="$flags -L$libdir -lapr"
     else
         flags="$flags -L$thisdir -lapr"
     fi
     ;;
     --link-libtool)
+    # If the LA_FILE exists where we think it should be, use it.  If we're
+    # installed and the LA_FILE does not exist, assume to use -L/-l
+    # (the LA_FILE may not have been installed).  If we're building ourselves,
+    # we'll assume that at some point the .la file be created.
     if test -f "$LA_FILE"; then
         flags="$flags $LA_FILE"
     elif test "$location" = "installed"; then
         ### avoid using -L if libdir is a "standard" location like /usr/lib
         flags="$flags -L$libdir -lapr"
     else
-        flags="$flags -L$thisdir -lapr"
+        flags="$flags $LA_FILE"
     fi
     ;;
+    --shlib-path-var)
+    echo "$SHLIBPATH_VAR"
+    exit 0
+    ;;
     --apr-la-file)
     if test -f "$LA_FILE"; then
         flags="$flags $LA_FILE"
     fi
     ;;
     --apr-so-ext)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/apr.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/apr.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/apr.dsp	2002-04-29 23:51:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/apr.dsp	2002-06-09 06:19:50.000000000 +0800
@@ -159,13 +159,12 @@
 
 SOURCE=.\i18n\unix\utf8_ucs2.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\i18n\unix\xlate.c
-# PROP Exclude_From_Build 1
 # End Source File
 # End Group
 # Begin Group "locks"
 
 # PROP Default_Filter ""
 # Begin Source File
@@ -234,12 +233,16 @@
 SOURCE=.\misc\win32\start.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\misc\unix\uuid.c
 # End Source File
+# Begin Source File
+
+SOURCE=.\misc\unix\version.c
+# End Source File
 # End Group
 # Begin Group "mmap"
 
 # PROP Default_Filter ""
 # Begin Source File
 
@@ -418,13 +421,13 @@
 # Begin Source File
 
 SOURCE=.\include\arch\unix\i18n.h
 # End Source File
 # Begin Source File
 
-SOURCE=.\include\arch\unix\inherit.h
+SOURCE=.\include\arch\win32\inherit.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\arch\win32\misc.h
 # End Source File
 # Begin Source File
@@ -460,29 +463,27 @@
 # Begin Source File
 
 SOURCE=.\include\apr.hw
 
 !IF  "$(CFG)" == "apr - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apr.h from apr.hw 
 InputPath=.\include\apr.hw
 
 ".\include\apr.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apr.hw .\include\apr.h > nul 
-	echo Created apr.h from apr.hw 
+	type .\include\apr.hw > .\include\apr.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "apr - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apr.h from apr.hw 
 InputPath=.\include\apr.hw
 
 ".\include\apr.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apr.hw .\include\apr.h > nul 
-	echo Created apr.h from apr.hw 
+	type .\include\apr.hw > .\include\apr.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: APRVARS
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/atomic/netware/apr_atomic.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/atomic/netware/apr_atomic.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/atomic/netware/apr_atomic.c	2002-04-09 14:50:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/atomic/netware/apr_atomic.c	2002-06-11 23:35:25.000000000 +0800
@@ -51,59 +51,14 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
 
 
 #include "apr.h"
-#include "apr_thread_mutex.h"
 #include "apr_atomic.h"
 
-#if APR_HAS_THREADS
-
-#if defined(APR_ATOMIC_NEED_DEFAULT)  || defined(APR_ATOMIC_NEED_CAS_DEFAULT)
-
-#define NUM_ATOMIC_HASH 7
-/* shift by 2 to get rid of alignment issues */
-#define ATOMIC_HASH(x) (int)(((long)x>>2)%NUM_ATOMIC_HASH)
-static apr_thread_mutex_t **hash_mutex;
-
-apr_status_t apr_atomic_init(apr_pool_t *p )
-{
-    int i;
-    apr_status_t rv;
-    hash_mutex =apr_palloc(p,sizeof(apr_thread_mutex_t*) * NUM_ATOMIC_HASH);
-    for (i=0;i<NUM_ATOMIC_HASH;i++) {
-        rv = apr_thread_mutex_create(&(hash_mutex[i]), APR_THREAD_MUTEX_DEFAULT, p);
-        if (rv != APR_SUCCESS)
-           return rv;
-    }
-    return APR_SUCCESS;
-}
-#endif /* APR_ATOMIC_NEED_DEFAULT || APR_ATOMIC_NEED_CAS_DEFAULT */
-
 int apr_atomic_dec(apr_atomic_t *mem) 
 {
     atomic_dec(mem);
     return *mem; 
 }
 
-#if defined(APR_ATOMIC_NEED_CAS_DEFAULT)
-
-apr_uint32_t apr_atomic_cas(volatile apr_uint32_t *mem,long with, long cmp)
-{
-    apr_thread_mutex_t *lock = hash_mutex[ATOMIC_HASH(mem)];
-    long prev;
-
-    if (apr_thread_mutex_lock(lock) == APR_SUCCESS) {
-        prev = *(long*)mem;
-        if ( prev == cmp) {
-            *(long*)mem = with;
-        }
-        apr_thread_mutex_unlock(lock);
-        return prev;
-    }
-    return *(long*)mem;
-}
-#endif /* APR_ATOMIC_NEED_CAS_DEFAULT */
-
-
-#endif /* APR_HAS_THREADS */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/atomic/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/apr_common.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/apr_common.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/apr_common.m4	2002-04-18 17:01:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/apr_common.m4	2002-05-14 15:35:58.000000000 +0800
@@ -46,12 +46,32 @@
     echo "\"[$]arg\" \\" >> $1
   done
   echo '"[$]@"' >> $1
   chmod +x $1
 ])dnl
 
+dnl APR_MKDIR_P_CHECK(fallback-mkdir-p)
+dnl checks whether mkdir -p works
+AC_DEFUN(APR_MKDIR_P_CHECK,[
+  AC_CACHE_CHECK(for working mkdir -p, ac_cv_mkdir_p,[
+    test -d conftestdir && rm -rf conftestdir
+    mkdir -p conftestdir/somedir >/dev/null 2>&1
+    if test -d conftestdir/somedir; then
+      ac_cv_mkdir_p=yes
+    else
+      ac_cv_mkdir_p=no
+    fi
+    rm -rf conftestdir
+  ])
+  if test "$ac_cv_mkdir_p" = "yes"; then
+      mkdir_p="mkdir -p"
+  else
+      mkdir_p="$1"
+  fi
+])
+
 dnl
 dnl APR_SUBDIR_CONFIG(dir [, sub-package-cmdline-args])
 dnl
 AC_DEFUN(APR_SUBDIR_CONFIG, [
   # save our work to this point; this allows the sub-package to use it
   AC_CACHE_SAVE
@@ -456,12 +476,65 @@
 else
   msg="pointer"
 fi
 AC_MSG_RESULT([$msg])
 ] )
 dnl
+dnl APR_CHECK_CRYPT_R_STYLE
+dnl
+dnl  Decide which of a couple of flavors of crypt_r() is necessary for
+dnl  this platform.
+dnl
+AC_DEFUN(APR_CHECK_CRYPT_R_STYLE,[
+AC_CACHE_CHECK(style of crypt_r, ac_cv_crypt_r_style,[
+dnl
+ac_cv_crypt_r_style=none
+dnl
+AC_TRY_COMPILE([
+#include <crypt.h>
+],[
+CRYPTD buffer;
+crypt_r("passwd", "hash", &buffer);
+], ac_cv_crypt_r_style=cryptd)
+dnl
+if test "$ac_cv_crypt_r_style" = "none"; then
+AC_TRY_COMPILE([
+#include <crypt.h>
+],[
+struct crypt_data buffer;
+crypt_r("passwd", "hash", &buffer);
+], ac_cv_crypt_r_style=struct_crypt_data)
+fi
+dnl
+if test "$ac_cv_crypt_r_style" = "none"; then
+dnl same as previous test, but see if defining _GNU_SOURCE helps
+AC_TRY_COMPILE([
+#define _GNU_SOURCE
+#include <crypt.h>
+],[
+struct crypt_data buffer;
+crypt_r("passwd", "hash", &buffer);
+], ac_cv_crypt_r_style=struct_crypt_data_gnu_source)
+fi
+dnl
+])
+if test "$ac_cv_crypt_r_style" = "cryptd"; then
+    AC_DEFINE(CRYPT_R_CRYPTD, 1, [Define if crypt_r has uses CRYPTD])
+fi
+dnl if we don't combine these conditions, CRYPT_R_STRUCT_CRYPT_DATA
+dnl will end up defined twice
+if test "$ac_cv_crypt_r_style" = "struct_crypt_data" -o \
+   "$ac_cv_crypt_r_style" = "struct_crypt_data_gnu_source"; then
+    AC_DEFINE(CRYPT_R_STRUCT_CRYPT_DATA, 1, [Define if crypt_r uses struct crypt_data])
+fi
+if test "$ac_cv_crypt_r_style" = "struct_crypt_data_gnu_source"; then
+    APR_ADDTO(CPPFLAGS, [-D_GNU_SOURCE])
+fi
+])
+
+dnl
 dnl APR_CHECK_ICONV_INBUF
 dnl
 dnl  Decide whether or not the inbuf parameter to iconv() is const.
 dnl
 dnl  We try to compile something without const.  If it fails to 
 dnl  compile, we assume that the system's iconv() has const.  
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/apr_hints.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/apr_hints.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/apr_hints.m4	2002-04-13 21:51:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/apr_hints.m4	2002-05-10 07:27:20.000000000 +0800
@@ -59,12 +59,13 @@
         dnl If using xlc, remember it, and give it the right options.
         if $CC 2>&1 | grep 'xlc' > /dev/null; then
           APR_SETIFNULL(AIX_XLC, [yes])
           APR_ADDTO(CFLAGS, [-qHALT=E])
         fi
 	APR_SETIFNULL(apr_iconv_inbuf_const, [1])
+	APR_SETIFNULL(apr_sysvsem_is_global, [yes])
 	APR_ADDTO(LDFLAGS, [-Wl,-brtl])
         ;;
     *-apollo-*)
 	APR_ADDTO(CPPFLAGS, [-DAPOLLO])
 	;;
     *-dg-dgux*)
@@ -148,12 +149,13 @@
 	;;
     *-apple-rhapsody*)
 	APR_ADDTO(CPPFLAGS, [-DRHAPSODY])
 	;;
     *-apple-darwin*)
 	APR_ADDTO(CPPFLAGS, [-DDARWIN -DSIGPROCMASK_SETS_THREAD_MASK -no-cpp-precomp])
+	APR_SETIFNULL(apr_posixsem_is_global, [yes])
 	;;
     *-dec-osf*)
 	APR_ADDTO(CPPFLAGS, [-DOSF1])
 	;;
     *-nto-qnx*)
 	;;
@@ -352,13 +354,13 @@
 	;;
     *-tandem-oss)
 	APR_ADDTO(CPPFLAGS, [-D_TANDEM_SOURCE -D_XOPEN_SOURCE_EXTENDED=1])
 	;;
     *-ibm-os390)
        APR_SETIFNULL(apr_lock_method, [USE_SYSVSEM_SERIALIZE])
-       APR_SETIFNULL(apr_process_lock_is_global, [yes])
+       APR_SETIFNULL(apr_sysvsem_is_global, [yes])
        APR_SETIFNULL(apr_gethostbyname_is_thread_safe, [yes])
        APR_SETIFNULL(apr_gethostbyaddr_is_thread_safe, [yes])
        APR_ADDTO(CPPFLAGS, [-U_NO_PROTO -DPTHREAD_ATTR_SETDETACHSTATE_ARG2_ADDR -DPTHREAD_SETS_ERRNO -DPTHREAD_DETACH_ARG1_ADDR -DSIGPROCMASK_SETS_THREAD_MASK -DTCP_NODELAY=1])
        ;;
     *-ibm-as400)
        APR_SETIFNULL(apr_lock_method, [USE_SYSVSEM_SERIALIZE])
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/buildcheck.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/buildcheck.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/buildcheck.sh	2001-07-12 15:52:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/buildcheck.sh	2002-05-16 00:47:09.000000000 +0800
@@ -1,12 +1,12 @@
 #! /bin/sh
 
 echo "buildconf: checking installation..."
 
 # autoconf 2.13 or newer
-ac_version=`autoconf --version 2>/dev/null|head -1|sed -e 's/^[^0-9]*//' -e 's/[a-z]* *$//'`
+ac_version=`${AUTOCONF:-autoconf} --version 2>/dev/null|head -1|sed -e 's/^[^0-9]*//' -e 's/[a-z]* *$//'`
 if test -z "$ac_version"; then
 echo "buildconf: autoconf not found."
 echo "           You need autoconf version 2.13 or newer installed"
 echo "           to build Apache from CVS."
 exit 1
 fi
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/find_apr.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/find_apr.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/find_apr.m4	2002-02-23 20:04:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/find_apr.m4	2002-05-17 07:06:30.000000000 +0800
@@ -3,20 +3,22 @@
 dnl
 dnl This macro file can be used by applications to find and use the APR
 dnl library. It provides a standardized mechanism for using APR. It supports
 dnl embedding APR into the application source, or locating an installed
 dnl copy of APR.
 dnl
-dnl APR_FIND_APR([srcdir [, builddir]])
+dnl APR_FIND_APR([srcdir [, builddir, implicit-install-check]])
 dnl
 dnl   where srcdir is the location of the bundled APR source directory, or
 dnl   empty if source is not bundled.
 dnl
 dnl   where blddir is the location where the bundled APR will will be built,
 dnl   or empty if the build will occur in the srcdir.
 dnl
+dnl   where implicit-install-check set to 1 indicates if there is no
+dnl   --with-apr option specified, we will look for installed copies.
 dnl
 dnl Sets the following variables on exit:
 dnl
 dnl   apr_found : "yes", "no", "reconfig"
 dnl
 dnl   apr_config : If the apr-config tool exists, this refers to it. If
@@ -68,25 +70,26 @@
     dnl if --with-apr is used, then the target prefix/directory must be valid
     if test "$apr_found" != "yes"; then
       AC_MSG_ERROR([the --with-apr parameter is incorrect. It must specify an install prefix, a
 build directory, or an apr-config file.])
     fi
   ],[
-    dnl always look in the builtin/default places
-    if apr-config --help > /dev/null 2>&1 ; then
-      apr_found="yes"
-      apr_config="apr-config"
-    else
-      dnl look in some standard places (apparently not in builtin/default)
-      for lookdir in /usr /usr/local /opt/apr ; do
-        if $TEST_X "$lookdir/bin/apr-config"; then
-          apr_found="yes"
-          apr_config="$lookdir/bin/apr-config"
-          break
-        fi
-      done
+    if test -n "$3" && test "$3" = "1"; then
+      if apr-config --help > /dev/null 2>&1 ; then
+        apr_found="yes"
+        apr_config="apr-config"
+      else
+        dnl look in some standard places (apparently not in builtin/default)
+        for lookdir in /usr /usr/local /opt/apr /usr/local/apache2 ; do
+          if $TEST_X "$lookdir/bin/apr-config"; then
+            apr_found="yes"
+            apr_config="$lookdir/bin/apr-config"
+            break
+          fi
+        done
+      fi
     fi
     dnl if we have a bundled source directory, then we may have more work
     if test -d "$1"; then
       apr_temp_abs_srcdir="`cd $1 && pwd`"
       if test "$apr_found" = "yes" \
          && test "`$apr_config --srcdir`" = "$apr_temp_abs_srcdir"; then
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/mkdir.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/mkdir.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/mkdir.sh	2001-02-18 21:36:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/mkdir.sh	2002-05-14 15:21:05.000000000 +0800
@@ -20,12 +20,14 @@
     shift
     pathcomp=
     for d in ${1+"$@"}; do
         pathcomp="$pathcomp$d"
         case "$pathcomp" in
             -* ) pathcomp=./$pathcomp ;;
+            ?: ) pathcomp="$pathcomp/" 
+                 continue ;;
         esac
         if test ! -d "$pathcomp"; then
             echo "mkdir $pathcomp" 1>&2
             mkdir "$pathcomp" || errstatus=$?
         fi
         pathcomp="$pathcomp/"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/nw_export.inc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/nw_export.inc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/nw_export.inc	2002-04-09 23:58:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/nw_export.inc	2002-05-15 19:06:58.000000000 +0800
@@ -65,6 +65,7 @@
 #include "apr_rmm.h"
 #include "apr_sdbm.h"
 #include "apr_sha1.h"
 #include "apr_uri.h"
 #include "apr_xml.h"
 #include "apr_compat.h"
+#include "apr_strmatch.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/NWGNUenvironment.inc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/NWGNUenvironment.inc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build/NWGNUenvironment.inc	2002-03-02 06:25:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/build/NWGNUenvironment.inc	2002-06-12 02:30:16.000000000 +0800
@@ -175,14 +175,14 @@
 ifeq (\, $(findstring \,$(INSTALL)))
 INSTDIRS = $(dest)
 endif
 endif
 
 ifndef INSTALL
-INSTALL = $(APR_WORK)\..\Dist
-INSTDIRS = $(APR_WORK)\..\Dist
+INSTALL = $(APR_WORK)\Dist
+INSTDIRS = $(APR_WORK)\Dist
 endif
 
 INSTDEVDIRS := \
     $(INSTDIRS) \
 	$(INSTALL)\Apache2 \
 	$(INSTALL)\Apache2\include \
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/build: rules.mk
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/buildconf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/buildconf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/buildconf	2002-03-14 04:39:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/buildconf	2002-05-16 00:47:09.000000000 +0800
@@ -95,16 +95,16 @@
 rm -f aclocal.m4
 
 #
 # Generate the autoconf header and ./configure
 #
 echo "Creating include/arch/unix/apr_private.h.in ..."
-autoheader
+${AUTOHEADER:-autoheader}
 
 echo "Creating configure ..."
 ### do some work to toss config.cache?
-autoconf
+${AUTOCONF:-autoconf}
 
 # Remove autoconf 2.5x's cache directory
-rm -rf autom4te.cache
+rm -rf autom4te*.cache
 
 exit 0
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/CHANGES	2002-05-01 18:39:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/CHANGES	2002-06-14 09:24:02.000000000 +0800
@@ -1,18 +1,88 @@
 Changes with APR b1
 
+  *) Removed --disable-atomics flag and added --enable-nonportable-atomics,
+     thereby defaulting to portable binaries on those systems that could
+     be optimized at the expense of portability. PR: 9507  [Aaron Bannert]
+
+  *) Added 2 additional lock functions: apr_proc_mutex_name and
+     apr_proc_mutex_defname which returns the type name of the mutex
+     (eg: "sysvsem") as well as the default mutex type (APR_LOCK_DEFAULT).
+     Mostly useful under Unix were the locktypes are selectable.
+     [Jim Jagielski]
+
+  *) Fixed apr_generate_random_bytes() for Win32 on Win NT or 9x by
+     dropping the 0x40 bit (CRYPT_SILENT) for earlier OS'es.
+     PR 9286  [William Rowe]
+
+  *) Added --with-devrandom=[DEV] configure flag which allows a particular
+     "/dev/random"-compatible device to be specified, overriding the
+     default search path (/dev/random then /dev/arandom then /dev/urandom).
+     Also, if --with-egd=<path> is specified, it now implies
+     --without-devrandom.  [Cliff Woolley]
+
+  *) Darwin/Mac OS X: Don't leave zombie processes when the app calls
+     apr_signal(SIGCHLD, SIG_IGN).  This fixes a problem with Apache's
+     mod_cgid.  PR 9168.  [Jeff Trawick]
+
+  *) Win32: Fix bug where apr_sendfile() was incorrectly returning
+     APR_SUCCESS on a TransmitFile call that was interrupted by
+     the client closing its end of the connection. Always call 
+     GetOverlappedResults() to get results of async TransmitFile()
+     completion notification. [Bill Stoddard] 
+
+  *) Renamed APR_XtOffset -> APR_OFFSET and APR_XtOffsetOf -> APR_OFFSETOF.
+     [Cliff Woolley]
+
+  *) Cygwin: the unix version of apr_file_open() must respect the
+     APR_BINARY flag if the underlying platform requires it (in
+     which case we assume O_BINARY is defined).  PR 9185.
+     [Cliff Woolley]
+
+  *) Linux, AIX: Use crypt_r() instead of crypt() because the native
+     crypt() is not thread-safe.  The misuse of crypt() led to   
+     intermittent failures with Apache basic authentication when crypt 
+     passwords were being used.  [Jeff Trawick]
+
+  *) AIX: Global mutexes don't need an intraprocess mutex when SysV
+     sems are used for the crossprocess mutex.
+     Darwin: The same optimization was applied for Posix sems.
+     [Jeff Trawick]
+
+  *) Fix a problem with global mutexes on OS/390 when something other
+     than the default mechanism (SysV sem) was used.  The mutexes didn't
+     necessarily block out other threads in the same process.
+     [Jeff Trawick]
+
+  *) Fixed apr_strfsize formatting of values over 1 gig
+     [Matsuzaki Yoshinobu <maz@iij.ad.jp>]
+
+  *) Renamed --disable-atomics as --disable-optimized-atomics,
+     since it doesn't really disable the atomics.  [Aaron Bannert]
+
+  *) Converted apr_pcalloc to a macro  [Brian Pane]
+
+  *) Fixed APR_STATUS_IS_ETIMEDOUT macro.
+     [Dagfinn Aarvaag <dagfinn.aarvaag@beepscience.com>]
+
   *) Add --disable-atomics switch to override our handcoded assembly
      optimizations.  Note that this has no effect if your operating
      system has a userspace atomic interface.  [Justin Erenkrantz]
 
   *) Remove Linux atomic support since it does not have a usable
      userspace atomic interface.  [Justin Erenkrantz]
 
   *) Don't require that the DNS can map 127.0.0.1 when checking for
      the presence/usability of getnameinfo().  PR 7642.  [Jeff Trawick]
 
+  *) Remove APR_WANT_SIGNAL from apr_want.h because code must include
+     apr_signal.h in order to get consistent definitions. [Roy Fielding]
+
+  *) Don't try to use /dev/zero and mmap on platforms that don't
+     support that (such as HP-UX).  PR 8537.  [Justin Erenkrantz]
+
   *) Reduce the number of apr_sendfile calls on AIX and OS/390 by
      remembering when the kernel tells us the next one will block.
      [Jeff Trawick]
 
   *) Reduce the number of apr_sendfile calls on FreeBSD by remembering
      when the kernel tells us the next one will block.  [Greg Ames]
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: config.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: config.nice
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: config.status
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/configure	2002-05-02 04:52:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/configure	2002-06-18 11:46:28.000000000 +0800
@@ -992,13 +992,13 @@
   --disable-libtool-lock  avoid locking (might break parallel builds)
   --enable-debug          Turn on debugging and compile time warnings
   --enable-maintainer-mode  Turn on debugging and compile time warnings
   --enable-profile        Turn on profiling for the build (GCC)
   --enable-pool-debug[=yes|no|verbose|verbose-alloc|lifetime|owner|all]    Turn on pools debugging
   --enable-malloc-debug   Switch on malloc_debug for BeOS
-  --disable-atomics            Turn off optimized atomic code
+  --enable-nonportable-atomics  Turn on optimized atomic code which may produce nonportable binaries
   --enable-threads        Enable threading support in APR.
   --enable-dso            Enable dso support
   --enable-other-child    Enable reliable child processes
   --disable-ipv6          Disable IPv6 support in APR.
 
 Optional Packages:
@@ -1008,12 +1008,13 @@
   --with-pic              try to use only PIC/non-PIC objects default=use both
   --with-installbuilddir=<path> location to store APR build files (defaults to '${datadir}/build')
   --without-libtool       avoid using libtool to link the library
   --with-efence[=DIR]     path to Electric Fence installation
   --with-sendfile         Override decision to use sendfile
   --with-egd=<path>       use egd-compatible socket
+  --with-devrandom[=DEV]  use /dev/random or compatible [searches by default]
 
 Some influential environment variables:
   CC          C compiler command
   CFLAGS      C compiler flags
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
@@ -2997,12 +3002,18 @@
   if test -z "$apr_iconv_inbuf_const"; then
     echo "  setting apr_iconv_inbuf_const to \"1\""
     apr_iconv_inbuf_const="1"
   fi
 
 
+  if test -z "$apr_sysvsem_is_global"; then
+    echo "  setting apr_sysvsem_is_global to \"yes\""
+    apr_sysvsem_is_global="yes"
+  fi
+
+
   if test "x$LDFLAGS" = "x"; then
     echo "  setting LDFLAGS to \"-Wl,-brtl\""
     LDFLAGS="-Wl,-brtl"
   else
     apr_addto_bugger="-Wl,-brtl"
     for i in $apr_addto_bugger; do
@@ -3596,12 +3607,18 @@
         echo "  adding \"$i\" to CPPFLAGS"
         CPPFLAGS="$CPPFLAGS $i"
       fi
     done
   fi
 
+
+  if test -z "$apr_posixsem_is_global"; then
+    echo "  setting apr_posixsem_is_global to \"yes\""
+    apr_posixsem_is_global="yes"
+  fi
+
 	;;
     *-dec-osf*)
 
   if test "x$CPPFLAGS" = "x"; then
     echo "  setting CPPFLAGS to \"-DOSF1\""
     CPPFLAGS="-DOSF1"
@@ -5649,15 +5666,15 @@
   if test -z "$apr_lock_method"; then
     echo "  setting apr_lock_method to \"USE_SYSVSEM_SERIALIZE\""
     apr_lock_method="USE_SYSVSEM_SERIALIZE"
   fi
 
 
-  if test -z "$apr_process_lock_is_global"; then
-    echo "  setting apr_process_lock_is_global to \"yes\""
-    apr_process_lock_is_global="yes"
+  if test -z "$apr_sysvsem_is_global"; then
+    echo "  setting apr_sysvsem_is_global to \"yes\""
+    apr_sysvsem_is_global="yes"
   fi
 
 
   if test -z "$apr_gethostbyname_is_thread_safe"; then
     echo "  setting apr_gethostbyname_is_thread_safe to \"yes\""
     apr_gethostbyname_is_thread_safe="yes"
@@ -5781,12 +5798,38 @@
 apr_buildout=$apr_builddir/build
 apr_builders=$apr_srcdir/build
 
 
 MKDIR=$apr_builders/mkdir.sh
 
+
+  echo "$as_me:$LINENO: checking for working mkdir -p" >&5
+echo $ECHO_N "checking for working mkdir -p... $ECHO_C" >&6
+if test "${ac_cv_mkdir_p+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+    test -d conftestdir && rm -rf conftestdir
+    mkdir -p conftestdir/somedir >/dev/null 2>&1
+    if test -d conftestdir/somedir; then
+      ac_cv_mkdir_p=yes
+    else
+      ac_cv_mkdir_p=no
+    fi
+    rm -rf conftestdir
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_mkdir_p" >&5
+echo "${ECHO_T}$ac_cv_mkdir_p" >&6
+  if test "$ac_cv_mkdir_p" = "yes"; then
+      mkdir_p="mkdir -p"
+  else
+      mkdir_p="$apr_builders/mkdir.sh"
+  fi
+
+
 DEFAULT_OSDIR="unix"
 echo "(Default will be ${DEFAULT_OSDIR})"
 
 apr_modules="file_io network_io threadproc misc locks time mmap shmem i18n user memory atomic"
 
 echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \${MAKE}" >&5
@@ -7980,13 +8023,13 @@
 
 # Some flags need to be propagated to the compiler or linker for good
 # libtool support.
 case $host in
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 7986 "configure"' > conftest.$ac_ext
+  echo '#line 8029 "configure"' > conftest.$ac_ext
   if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; then
     case `/usr/bin/file conftest.$ac_objext` in
@@ -8530,13 +8573,13 @@
 # to fail, enabling locking or at least warning the user not to do parallel
 # builds.
 chmod -w .
 save_CFLAGS="$CFLAGS"
 CFLAGS="$CFLAGS -o out/conftest2.$ac_objext"
 compiler_c_o=no
-if { (eval echo configure:8536: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>out/conftest.err; } && test -s out/conftest2.$ac_objext; then
+if { (eval echo configure:8579: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>out/conftest.err; } && test -s out/conftest2.$ac_objext; then
   # The compiler can only warn and ignore the option if not recognized
   # So say no if there are warnings
   if test -s out/conftest.err; then
     lt_cv_compiler_c_o=no
   else
     lt_cv_compiler_c_o=yes
@@ -10361,13 +10404,13 @@
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self=cross
 else
     lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10367 "configure"
+#line 10410 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
 #include <dlfcn.h>
 #endif
 
@@ -10459,13 +10502,13 @@
   	  if test "$cross_compiling" = yes; then :
   lt_cv_dlopen_self_static=cross
 else
     lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat > conftest.$ac_ext <<EOF
-#line 10465 "configure"
+#line 10508 "configure"
 #include "confdefs.h"
 
 #if HAVE_DLFCN_H
 #include <dlfcn.h>
 #endif
 
@@ -11855,20 +11898,22 @@
 
 	;;
 esac
 
 apr_force_atomic_generic=0
 proc_mutex_is_global=0
-user_disabled_atomics=0
+enable_nonportable_atomics=0
 
-# Check whether --enable-atomics or --disable-atomics was given.
-if test "${enable_atomics+set}" = set; then
-  enableval="$enable_atomics"
-   if test "$enableval" = "no"; then
-        user_disabled_atomics=1
+# Check whether --enable-nonportable-atomics or --disable-nonportable-atomics was given.
+if test "${enable_nonportable_atomics+set}" = set; then
+  enableval="$enable_nonportable_atomics"
+
+    if test "$enableval" = "yes"; then
+        enable_nonportable_atomics=1
     fi
+
 fi;
 
 config_subdirs="none"
 INSTALL_SUBDIRS="none"
 case $host in
    i386-ibm-aix* | *-ibm-aix1-2.* | *-ibm-aix3.* | *-ibm-aix4.1 | *-ibm-aix4.1.* | *-ibm-aix4.2 | *-ibm-aix4.2.*)
@@ -12119,13 +12164,13 @@
        ;;
    *sun*)
        case $host_cpu in
          *sparc*)
             OSDIR="solaris_sparc"
             eolstr="\\n"
-            if test "$user_disabled_atomics" = 0; then
+            if test "$enable_nonportable_atomics" = 1; then
               apr_atomic_sparc_compile=apr_atomic_sparc.lo
               sparc_arch=`uname -m`
               is_gnu_as=`${AS} --help 2>/dev/null | grep gnu.org`
               case "$sparc_arch" in
                 sun4c|sun4m|sun4d|sun4t|sun4)
                   apr_force_atomic_generic=1
@@ -16033,12 +16078,73 @@
 
 fi
 
 done
 
 
+if test "$ac_cv_func_mmap" = "yes" &&
+   test "$ac_cv_file__dev_zero" = "yes"; then
+    echo "$as_me:$LINENO: checking for mmap that can map /dev/zero" >&5
+echo $ECHO_N "checking for mmap that can map /dev/zero... $ECHO_C" >&6
+    if test "$cross_compiling" = yes; then
+  ac_cv_file__dev_zero=no
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+#ifdef HAVE_SYS_MMAN_H
+#include <sys/mman.h>
+#endif
+    int main()
+    {
+        int fd;
+        void *m;
+        fd = open("/dev/zero", O_RDWR);
+        if (fd < 0) {
+            return 1;
+        }
+        m = mmap(0, sizeof(void*), PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0);
+        if (m < 0) {  /* aka MAP_FAILED */
+            return 2;
+        }
+        if (munmap(m, sizeof(void*)) < 0) {
+            return 3;
+        }
+        return 0;
+    }
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  :
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+( exit $ac_status )
+ac_cv_file__dev_zero=no
+fi
+rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
+    echo "$as_me:$LINENO: result: $ac_cv_file__dev_zero" >&5
+echo "${ECHO_T}$ac_cv_file__dev_zero" >&6
+fi
+
 haveshmgetanon="0"
 havemmapzero="0"
 havemmapanon="0"
 ac_decision_item='anonymous shared memory allocation method'
 ac_decision_msg='FAILED'
 ac_decision=''
@@ -17769,12 +17875,271 @@
 fi
 echo "$as_me:$LINENO: result: $msg" >&5
 echo "${ECHO_T}$msg" >&6
 
 fi
 
+for ac_func in crypt_r
+do
+as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_func" >&5
+echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
+if eval "test \"\${$as_ac_var+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func (); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char $ac_func ();
+char (*f) ();
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+   int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main ()
+{
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+f = $ac_func;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_var=yes"
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+eval "$as_ac_var=no"
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
+if test `eval echo '${'$as_ac_var'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+  crypt_r="1"
+else
+   crypt_r="0"
+fi
+done
+
+if test "$crypt_r" = "1"; then
+
+echo "$as_me:$LINENO: checking style of crypt_r" >&5
+echo $ECHO_N "checking style of crypt_r... $ECHO_C" >&6
+if test "${ac_cv_crypt_r_style+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+ac_cv_crypt_r_style=none
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <crypt.h>
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+   int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main ()
+{
+
+CRYPTD buffer;
+crypt_r("passwd", "hash", &buffer);
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_crypt_r_style=cryptd
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+if test "$ac_cv_crypt_r_style" = "none"; then
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#include <crypt.h>
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+   int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main ()
+{
+
+struct crypt_data buffer;
+crypt_r("passwd", "hash", &buffer);
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_crypt_r_style=struct_crypt_data
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+fi
+if test "$ac_cv_crypt_r_style" = "none"; then
+cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+#define _GNU_SOURCE
+#include <crypt.h>
+
+#ifdef F77_DUMMY_MAIN
+#  ifdef __cplusplus
+     extern "C"
+#  endif
+   int F77_DUMMY_MAIN() { return 1; }
+#endif
+int
+main ()
+{
+
+struct crypt_data buffer;
+crypt_r("passwd", "hash", &buffer);
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_crypt_r_style=struct_crypt_data_gnu_source
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+fi
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_crypt_r_style" >&5
+echo "${ECHO_T}$ac_cv_crypt_r_style" >&6
+if test "$ac_cv_crypt_r_style" = "cryptd"; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CRYPT_R_CRYPTD 1
+_ACEOF
+
+fi
+if test "$ac_cv_crypt_r_style" = "struct_crypt_data" -o \
+   "$ac_cv_crypt_r_style" = "struct_crypt_data_gnu_source"; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CRYPT_R_STRUCT_CRYPT_DATA 1
+_ACEOF
+
+fi
+if test "$ac_cv_crypt_r_style" = "struct_crypt_data_gnu_source"; then
+
+  if test "x$CPPFLAGS" = "x"; then
+    echo "  setting CPPFLAGS to \"-D_GNU_SOURCE\""
+    CPPFLAGS="-D_GNU_SOURCE"
+  else
+    apr_addto_bugger="-D_GNU_SOURCE"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $CPPFLAGS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to CPPFLAGS"
+        CPPFLAGS="$CPPFLAGS $i"
+      fi
+    done
+  fi
+
+fi
+
+fi
+
 for ac_func in iconv
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
@@ -21937,37 +22302,43 @@
 if test "$ac_cv_sizeof_int" = "4"; then
     int_value=int
 fi
 if test "$ac_cv_sizeof_int" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val)'
     int64_t_fmt='#define APR_INT64_T_FMT "d"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 1'
     int64_value="int"
     long_value=int
 elif test "$ac_cv_sizeof_long" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##L)'
     int64_t_fmt='#define APR_INT64_T_FMT "ld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="long"
     long_value=long
 elif test "$ac_cv_sizeof_long_long" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LL)'
                     int64_t_fmt='#define APR_INT64_T_FMT "lld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 3'
     int64_value="long long"
     long_value="long long"
 elif test "$ac_cv_sizeof_long_double" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LD)'
     int64_t_fmt='#define APR_INT64_T_FMT "Ld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="long double"
     long_value="long double"
 elif test "$ac_cv_sizeof_longlong" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LL)'
     int64_t_fmt='#define APR_INT64_T_FMT "qd"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="__int64"
     long_value="__int64"
 else
             int64_literal='#error Can not determine the proper size for apr_int64_t'
     int64_t_fmt='#error Can not determine the proper size for apr_int64_t'
+    int64_t_fmt_len='#error Can not determine the proper size for apr_int64_t'
 fi
 
 echo "$as_me:$LINENO: checking for INT64_C" >&5
 echo $ECHO_N "checking for INT64_C... $ECHO_C" >&6
 stdint=0
 cat >conftest.$ac_ext <<_ACEOF
@@ -23551,37 +23923,12 @@
 _ACEOF
 
 fi
 done
 
 
-ac_safe=`echo "/dev/zero" | sed 'y%./+-%__p_%'`
-echo "$as_me:$LINENO: checking for /dev/zero" >&5
-echo $ECHO_N "checking for /dev/zero... $ECHO_C" >&6
-if eval "test \"\${ac_cv_file_$ac_safe+set}\" = set"; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-
-  if test -r /dev/zero; then
-    eval "ac_cv_file_$ac_safe=yes"
-  else
-    eval "ac_cv_file_$ac_safe=no"
-  fi
-
-fi
-if eval "test \"`echo '$ac_cv_file_'$ac_safe`\" = yes"; then
-  echo "$as_me:$LINENO: result: yes" >&5
-echo "${ECHO_T}yes" >&6
-  :
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-
-fi
-
-
 for ac_header in semaphore.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
@@ -24862,76 +25209,170 @@
 
 
 
 
 
 
-echo "$as_me:$LINENO: checking if interprocess lock affects threads" >&5
-echo $ECHO_N "checking if interprocess lock affects threads... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking if all interprocess locks affect threads" >&5
+echo $ECHO_N "checking if all interprocess locks affect threads... $ECHO_C" >&6
 if test "x$apr_process_lock_is_global" = "xyes"; then
     proclockglobal="1"
     echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6
 else
     proclockglobal="0"
     echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
 
 
-echo "$as_me:$LINENO: checking for /dev/random" >&5
-echo $ECHO_N "checking for /dev/random... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking if Posix sems affect threads in the same process" >&5
+echo $ECHO_N "checking if Posix sems affect threads in the same process... $ECHO_C" >&6
+if test "x$apr_posixsem_is_global" = "xyes"; then
+  cat >>confdefs.h <<\_ACEOF
+#define POSIXSEM_IS_GLOBAL 1
+_ACEOF
+
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
 
-if test -r "/dev/random"; then
-    cat >>confdefs.h <<\_ACEOF
-#define DEV_RANDOM /dev/random
+echo "$as_me:$LINENO: checking if SysV sems affect threads in the same process" >&5
+echo $ECHO_N "checking if SysV sems affect threads in the same process... $ECHO_C" >&6
+if test "x$apr_sysvsem_is_global" = "xyes"; then
+  cat >>confdefs.h <<\_ACEOF
+#define SYSVSEM_IS_GLOBAL 1
 _ACEOF
 
-    echo "$as_me:$LINENO: result: /dev/random" >&5
-echo "${ECHO_T}/dev/random" >&6
-    rand="1"
-elif test -r "/dev/urandom"; then
-    cat >>confdefs.h <<\_ACEOF
-#define DEV_RANDOM /dev/urandom
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+echo "$as_me:$LINENO: checking if fcntl locks affect threads in the same process" >&5
+echo $ECHO_N "checking if fcntl locks affect threads in the same process... $ECHO_C" >&6
+if test "x$apr_fcntl_is_global" = "xyes"; then
+  cat >>confdefs.h <<\_ACEOF
+#define FCNTL_IS_GLOBAL 1
 _ACEOF
 
-    echo "$as_me:$LINENO: result: /dev/urandom" >&5
-echo "${ECHO_T}/dev/urandom" >&6
-    rand="1"
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
 else
-    case $host in
-        # we have built in support for OS/2
-        *-os2*)
-            echo "$as_me:$LINENO: result: Using OS/2 builtin random" >&5
-echo "${ECHO_T}Using OS/2 builtin random" >&6
-            rand="1"
-            ;;
-        *)
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+echo "$as_me:$LINENO: checking if flock locks affect threads in the same process" >&5
+echo $ECHO_N "checking if flock locks affect threads in the same process... $ECHO_C" >&6
+if test "x$apr_flock_is_global" = "xyes"; then
+  cat >>confdefs.h <<\_ACEOF
+#define FLOCK_IS_GLOBAL 1
+_ACEOF
+
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+echo "$as_me:$LINENO: checking for entropy source" >&5
+echo $ECHO_N "checking for entropy source... $ECHO_C" >&6
+
 
 # Check whether --with-egd or --without-egd was given.
 if test "${with_egd+set}" = set; then
   withval="$with_egd"
    if test "$withval" = "yes"; then
-                  { { echo "$as_me:$LINENO: error: You must specify a default EGD socket path." >&5
+      { { echo "$as_me:$LINENO: error: You must specify a default EGD socket path." >&5
 echo "$as_me: error: You must specify a default EGD socket path." >&2;}
    { (exit 1); exit 1; }; }
-                fi
-                cat >>confdefs.h <<\_ACEOF
+    fi
+    cat >>confdefs.h <<\_ACEOF
 #define HAVE_EGD 1
 _ACEOF
 
-                cat >>confdefs.h <<_ACEOF
+    cat >>confdefs.h <<_ACEOF
 #define EGD_DEFAULT_SOCKET $withval
 _ACEOF
 
-                echo "$as_me:$LINENO: result: EGD-compatible daemon" >&5
+    echo "$as_me:$LINENO: result: EGD-compatible daemon" >&5
 echo "${ECHO_T}EGD-compatible daemon" >&6
-                rand="1"
+    rand="1"
 
 fi;
+
+if test "$rand" != "1"; then
+
+# Check whether --with-devrandom or --without-devrandom was given.
+if test "${with_devrandom+set}" = set; then
+  withval="$with_devrandom"
+   apr_devrandom="$withval"
+else
+   apr_devrandom="yes"
+fi;
+
+  if test "$apr_devrandom" = "yes"; then
+    if test -r "/dev/random"; then
+      cat >>confdefs.h <<\_ACEOF
+#define DEV_RANDOM /dev/random
+_ACEOF
+
+      echo "$as_me:$LINENO: result: /dev/random" >&5
+echo "${ECHO_T}/dev/random" >&6
+      rand="1"
+    elif test -r "/dev/arandom"; then
+      cat >>confdefs.h <<\_ACEOF
+#define DEV_RANDOM /dev/arandom
+_ACEOF
+
+      echo "$as_me:$LINENO: result: /dev/arandom" >&5
+echo "${ECHO_T}/dev/arandom" >&6
+      rand="1"
+    elif test -r "/dev/urandom"; then
+      cat >>confdefs.h <<\_ACEOF
+#define DEV_RANDOM /dev/urandom
+_ACEOF
+
+      echo "$as_me:$LINENO: result: /dev/urandom" >&5
+echo "${ECHO_T}/dev/urandom" >&6
+      rand="1"
+    fi
+  elif test "$apr_devrandom" != "no"; then
+    if test -r "$apr_devrandom"; then
+      cat >>confdefs.h <<\_ACEOF
+#define DEV_RANDOM $apr_devrandom
+_ACEOF
+
+      echo "$as_me:$LINENO: result: $apr_devrandom" >&5
+echo "${ECHO_T}$apr_devrandom" >&6
+      rand="1"
+    else
+      { { echo "$as_me:$LINENO: error: $apr_devrandom not found or unreadable." >&5
+echo "$as_me: error: $apr_devrandom not found or unreadable." >&2;}
+   { (exit 1); exit 1; }; }
+    fi
+  fi
+fi
+
+if test "$rand" != "1"; then
+    case $host in
+        # we have built in support for OS/2
+        *-os2*)
+            echo "$as_me:$LINENO: result: Using OS/2 builtin random" >&5
+echo "${ECHO_T}Using OS/2 builtin random" >&6
+            rand="1"
+            ;;
+        *)
             if test "$rand" != "1"; then
               if test "$ac_cv_lib_truerand_main" = "yes"; then
                 cat >>confdefs.h <<\_ACEOF
 #define HAVE_TRUERAND 1
 _ACEOF
 
@@ -26723,13 +27164,13 @@
     else
         MAKEFILE2="$MAKEFILE2 $dir/$DEFAULT_OSDIR/Makefile "
         SUBDIRS="$SUBDIRS $dir/$DEFAULT_OSDIR "
     fi
 done
 
-if test -d ./test; then
+if test -d $srcdir/test; then
     MAKEFILE3="test/Makefile"
 fi
 
 
 case $host in
 *bsdi*)
@@ -27452,12 +27893,13 @@
 s,@int64_value@,$int64_value,;t t
 s,@off_t_value@,$off_t_value,;t t
 s,@size_t_value@,$size_t_value,;t t
 s,@ssize_t_value@,$ssize_t_value,;t t
 s,@socklen_t_value@,$socklen_t_value,;t t
 s,@int64_t_fmt@,$int64_t_fmt,;t t
+s,@int64_t_fmt_len@,$int64_t_fmt_len,;t t
 s,@ssize_t_fmt@,$ssize_t_fmt,;t t
 s,@size_t_fmt@,$size_t_fmt,;t t
 s,@off_t_fmt@,$off_t_fmt,;t t
 s,@pid_t_fmt@,$pid_t_fmt,;t t
 s,@int64_literal@,$int64_literal,;t t
 s,@stdint@,$stdint,;t t
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/configure.in	2002-05-02 04:43:13.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/configure.in	2002-06-14 09:24:02.000000000 +0800
@@ -72,12 +72,15 @@
 apr_buildout=$apr_builddir/build
 apr_builders=$apr_srcdir/build
 AC_SUBST(apr_builders)
 
 MKDIR=$apr_builders/mkdir.sh
 
+dnl Initialize mkdir -p functionality.
+APR_MKDIR_P_CHECK($apr_builders/mkdir.sh)
+
 dnl These added to allow default directories to be used...
 DEFAULT_OSDIR="unix"
 echo "(Default will be ${DEFAULT_OSDIR})"
 
 apr_modules="file_io network_io threadproc misc locks time mmap shmem i18n user memory atomic"
 
@@ -301,19 +304,21 @@
 dnl this will be set we find a cpu/OS combo
 dnl which is historical and doesn't work with the method
 dnl we are using for the more up to date cpu/OS
 dnl  (ie.. old sparcs)
 apr_force_atomic_generic=0
 proc_mutex_is_global=0
-user_disabled_atomics=0
+enable_nonportable_atomics=0
 
-AC_ARG_ENABLE(atomics,
-  [  --disable-atomics            Turn off optimized atomic code],
-  [ if test "$enableval" = "no"; then
-        user_disabled_atomics=1
-    fi ] )
+AC_ARG_ENABLE(nonportable-atomics,
+[  --enable-nonportable-atomics  Turn on optimized atomic code which may produce nonportable binaries],
+[
+    if test "$enableval" = "yes"; then
+        enable_nonportable_atomics=1
+    fi
+])
 
 config_subdirs="none"
 INSTALL_SUBDIRS="none"
 case $host in
    i386-ibm-aix* | *-ibm-aix[1-2].* | *-ibm-aix3.* | *-ibm-aix4.1 | *-ibm-aix4.1.* | *-ibm-aix4.2 | *-ibm-aix4.2.*)
        OSDIR="aix"
@@ -364,13 +369,13 @@
        ;;
    *sun*)
        case $host_cpu in
          *sparc*)
             OSDIR="solaris_sparc"
             eolstr="\\n"
-            if test "$user_disabled_atomics" = 0; then
+            if test "$enable_nonportable_atomics" = 1; then
               apr_atomic_sparc_compile=apr_atomic_sparc.lo
               sparc_arch=`uname -m`
               is_gnu_as=`${AS} --help 2>/dev/null | grep gnu.org`
               case "$sparc_arch" in
                 sun4c|sun4m|sun4d|sun4t|sun4)
                   apr_force_atomic_generic=1
@@ -592,12 +597,44 @@
 AC_CHECK_HEADERS(sys/ipc.h sys/shm.h sys/file.h)
 AC_CHECK_FUNCS(shmget shmat shmdt shmctl)
 AC_CHECK_HEADERS(kernel/OS.h)
 AC_CHECK_FUNCS(create_area)
 AC_CHECK_HEADERS(os2.h)
 
+dnl Not all systems can mmap /dev/zero (such as HP-UX).  Check for that.
+if test "$ac_cv_func_mmap" = "yes" &&
+   test "$ac_cv_file__dev_zero" = "yes"; then
+    AC_MSG_CHECKING(for mmap that can map /dev/zero)
+    AC_TRY_RUN([
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+#ifdef HAVE_SYS_MMAN_H
+#include <sys/mman.h>
+#endif
+    int main()
+    {
+        int fd;
+        void *m;
+        fd = open("/dev/zero", O_RDWR);
+        if (fd < 0) {
+            return 1;
+        }
+        m = mmap(0, sizeof(void*), PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0);
+        if (m < 0) {  /* aka MAP_FAILED */
+            return 2;
+        }
+        if (munmap(m, sizeof(void*)) < 0) {
+            return 3;
+        }
+        return 0;
+    }], [], [ac_cv_file__dev_zero=no], [ac_cv_file__dev_zero=no])
+
+    AC_MSG_RESULT($ac_cv_file__dev_zero)
+fi
+
 dnl Now we determine which one is our anonymous shmem preference.
 haveshmgetanon="0"
 havemmapzero="0"
 havemmapanon="0"
 APR_BEGIN_DECISION([anonymous shared memory allocation method])
 APR_IFALLYES(header:sys/ipc.h header:sys/shm.h header:sys/file.h dnl
@@ -795,12 +832,16 @@
 AC_CHECK_FUNC(_getch)
 AC_CHECK_FUNCS(gmtime_r localtime_r)
 AC_CHECK_FUNCS(strerror_r, [ strerror_r="1" ], [ strerror_r="0" ])
 if test "$strerror_r" = "1"; then
   APR_CHECK_STRERROR_R_RC
 fi
+AC_CHECK_FUNCS(crypt_r, [ crypt_r="1" ], [ crypt_r="0" ])
+if test "$crypt_r" = "1"; then
+  APR_CHECK_CRYPT_R_STYLE
+fi
 AC_CHECK_FUNCS(iconv, [ iconv="1" ], [ iconv="0" ])
 if test "$iconv" = "1"; then
   APR_CHECK_ICONV_INBUF
 fi
 AC_CHECK_FUNCS(mmap, [ mmap="1" ], [ mmap="0" ])
 if test "$native_mmap_emul" = "1"; then
@@ -976,43 +1017,49 @@
 fi
 dnl # Now we need to find what apr_int64_t (sizeof == 8) will be.
 dnl # The first match is our preference.
 if test "$ac_cv_sizeof_int" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val)'
     int64_t_fmt='#define APR_INT64_T_FMT "d"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 1'
     int64_value="int"
     long_value=int
 elif test "$ac_cv_sizeof_long" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##L)'
     int64_t_fmt='#define APR_INT64_T_FMT "ld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="long"
     long_value=long
 elif test "$ac_cv_sizeof_long_long" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LL)'
     dnl Linux, Solaris, FreeBSD all support ll with printf.
     dnl BSD 4.4 originated 'q'.  Solaris is more popular and 
     dnl doesn't support 'q'.  Solaris wins.  Exceptions can
     dnl go to the OS-dependent section.
     int64_t_fmt='#define APR_INT64_T_FMT "lld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 3'
     int64_value="long long"
     long_value="long long"
 elif test "$ac_cv_sizeof_long_double" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LD)'
     int64_t_fmt='#define APR_INT64_T_FMT "Ld"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="long double"
     long_value="long double"
 elif test "$ac_cv_sizeof_longlong" = "8"; then
     int64_literal='#define APR_INT64_C(val) (val##LL)'
     int64_t_fmt='#define APR_INT64_T_FMT "qd"'
+    int64_t_fmt_len='#define APR_INT64_T_FMT_LEN 2'
     int64_value="__int64"
     long_value="__int64"
 else
     dnl # int64_literal may be overriden if your compiler thinks you have
     dnl # a 64-bit value but APR does not agree.
     int64_literal='#error Can not determine the proper size for apr_int64_t'
     int64_t_fmt='#error Can not determine the proper size for apr_int64_t'
+    int64_t_fmt_len='#error Can not determine the proper size for apr_int64_t'
 fi
 
 dnl # If present, allow the C99 macro INT64_C to override our conversion.
 dnl #
 dnl # HP-UX's ANSI C compiler provides this without any includes, so we
 dnl # will first look for INT64_C without adding stdint.h
@@ -1139,12 +1186,13 @@
 AC_SUBST(int64_value)
 AC_SUBST(off_t_value)
 AC_SUBST(size_t_value)
 AC_SUBST(ssize_t_value)
 AC_SUBST(socklen_t_value)
 AC_SUBST(int64_t_fmt) 
+AC_SUBST(int64_t_fmt_len) 
 AC_SUBST(ssize_t_fmt) 
 AC_SUBST(size_t_fmt)
 AC_SUBST(off_t_fmt) 
 AC_SUBST(pid_t_fmt)
 AC_SUBST(int64_literal) 
 AC_SUBST(stdint) 
@@ -1246,13 +1294,12 @@
 AC_SUBST(struct_rlimit)
 
 dnl #----------------------------- Checking for Locking Characteristics 
 echo $ac_n "${nl}Checking for Locking...${nl}"
 
 AC_CHECK_FUNCS(semget semctl flock)
-APR_CHECK_FILE(/dev/zero)
 AC_CHECK_HEADERS(semaphore.h)
 AC_CHECK_FUNCS(sem_close sem_unlink sem_post sem_wait)
 
 dnl Some systems return ENOSYS from sem_open.
 AC_CACHE_CHECK(for working sem_open,ac_cv_func_sem_open,[
 AC_TRY_RUN([
@@ -1433,52 +1480,107 @@
 AC_SUBST(sysvser)
 AC_SUBST(posixser)
 AC_SUBST(fcntlser)
 AC_SUBST(procpthreadser)
 AC_SUBST(pthreadser)
 
-AC_MSG_CHECKING(if interprocess lock affects threads)
+AC_MSG_CHECKING(if all interprocess locks affect threads)
 if test "x$apr_process_lock_is_global" = "xyes"; then
     proclockglobal="1"
     AC_MSG_RESULT(yes)
 else
     proclockglobal="0"
     AC_MSG_RESULT(no)
 fi
 
 AC_SUBST(proclockglobal)
 
+AC_MSG_CHECKING(if Posix sems affect threads in the same process)
+if test "x$apr_posixsem_is_global" = "xyes"; then
+  AC_DEFINE(POSIXSEM_IS_GLOBAL)
+  AC_MSG_RESULT(yes)
+else
+  AC_MSG_RESULT(no)
+fi
+
+AC_MSG_CHECKING(if SysV sems affect threads in the same process)
+if test "x$apr_sysvsem_is_global" = "xyes"; then
+  AC_DEFINE(SYSVSEM_IS_GLOBAL)
+  AC_MSG_RESULT(yes)
+else
+  AC_MSG_RESULT(no)
+fi
+
+AC_MSG_CHECKING(if fcntl locks affect threads in the same process)
+if test "x$apr_fcntl_is_global" = "xyes"; then
+  AC_DEFINE(FCNTL_IS_GLOBAL)
+  AC_MSG_RESULT(yes)
+else
+  AC_MSG_RESULT(no)
+fi
+
+AC_MSG_CHECKING(if flock locks affect threads in the same process)
+if test "x$apr_flock_is_global" = "xyes"; then
+  AC_DEFINE(FLOCK_IS_GLOBAL)
+  AC_MSG_RESULT(yes)
+else
+  AC_MSG_RESULT(no)
+fi
+
 dnl #----------------------------- Checking for /dev/random 
-AC_MSG_CHECKING(for /dev/random)
+AC_MSG_CHECKING(for entropy source)
 
-if test -r "/dev/random"; then
-    AC_DEFINE(DEV_RANDOM, [/dev/random])
-    AC_MSG_RESULT(/dev/random)
-    rand="1"
-elif test -r "/dev/urandom"; then
-    AC_DEFINE(DEV_RANDOM, [/dev/urandom])
-    AC_MSG_RESULT(/dev/urandom)
+AC_ARG_WITH(egd, 
+  [  --with-egd=<path>       use egd-compatible socket],
+  [ if test "$withval" = "yes"; then
+      AC_ERROR([You must specify a default EGD socket path.])
+    fi
+    AC_DEFINE(HAVE_EGD)
+    AC_DEFINE_UNQUOTED(EGD_DEFAULT_SOCKET, [$withval])
+    AC_MSG_RESULT(EGD-compatible daemon)
     rand="1"
-else
+  ])
+
+if test "$rand" != "1"; then
+  AC_ARG_WITH(devrandom,
+    [  --with-devrandom[[=DEV]]  use /dev/random or compatible [[searches by default]]],
+    [ apr_devrandom="$withval" ], [ apr_devrandom="yes" ])
+
+  if test "$apr_devrandom" = "yes"; then
+    if test -r "/dev/random"; then
+      AC_DEFINE(DEV_RANDOM, [/dev/random])
+      AC_MSG_RESULT(/dev/random)
+      rand="1"
+    elif test -r "/dev/arandom"; then
+      AC_DEFINE(DEV_RANDOM, [/dev/arandom])
+      AC_MSG_RESULT(/dev/arandom)
+      rand="1"
+    elif test -r "/dev/urandom"; then
+      AC_DEFINE(DEV_RANDOM, [/dev/urandom])
+      AC_MSG_RESULT(/dev/urandom)
+      rand="1"
+    fi
+  elif test "$apr_devrandom" != "no"; then
+    if test -r "$apr_devrandom"; then
+      AC_DEFINE(DEV_RANDOM, [$apr_devrandom])
+      AC_MSG_RESULT($apr_devrandom)
+      rand="1"
+    else
+      AC_ERROR([$apr_devrandom not found or unreadable.])
+    fi
+  fi
+fi
+
+if test "$rand" != "1"; then
     case $host in
         # we have built in support for OS/2
         *-os2*)
             AC_MSG_RESULT([Using OS/2 builtin random])
             rand="1"
             ;;
         *)
-            AC_ARG_WITH(egd, 
-              [  --with-egd=<path>       use egd-compatible socket],
-              [ if test "$withval" = "yes"; then
-                  AC_ERROR([You must specify a default EGD socket path.])
-                fi
-                AC_DEFINE(HAVE_EGD)
-                AC_DEFINE_UNQUOTED(EGD_DEFAULT_SOCKET, [$withval])
-                AC_MSG_RESULT(EGD-compatible daemon)
-                rand="1"
-              ])
             if test "$rand" != "1"; then
               if test "$ac_cv_lib_truerand_main" = "yes"; then
                 AC_DEFINE(HAVE_TRUERAND)
                 AC_MSG_RESULT(truerand)
                 rand="1"
               else
@@ -1660,13 +1762,13 @@
     else
         MAKEFILE2="$MAKEFILE2 $dir/$DEFAULT_OSDIR/Makefile "
         SUBDIRS="$SUBDIRS $dir/$DEFAULT_OSDIR "
     fi
 done
 
-if test -d ./test; then
+if test -d $srcdir/test; then
     MAKEFILE3="test/Makefile"
 fi
 AC_SUBST(SUBDIRS)
 
 dnl
 dnl BSD/OS (BSDi) needs to use a different include syntax in the Makefiles
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/docs/doxygen.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/docs/doxygen.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/docs/doxygen.conf	2002-03-19 00:46:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/docs/doxygen.conf	2002-05-09 04:58:01.000000000 +0800
@@ -1,7 +1,7 @@
-PROJECT_NAME="Apache Portable Run-Time"
+PROJECT_NAME="Apache Portable Runtime"
 
 INPUT=.
 QUIET=YES
 RECURSIVE=YES
 FILE_PATTERNS=*.h
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/dso/unix/dso.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/dso/unix/dso.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/dso/unix/dso.c	2002-04-22 21:15:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/dso/unix/dso.c	2002-05-02 21:28:24.000000000 +0800
@@ -123,22 +123,16 @@
 
 #elif defined(DSO_USE_DYLD)
     NSObjectFileImage image;
     NSModule os_handle = NULL;
     char* err_msg = NULL;
     if (NSCreateObjectFileImageFromFile(path, &image) == NSObjectFileImageSuccess) {
-
-/*
- * Under Darwin, we want/need to place dynamically loaded extensions'
- * public symbols into the global symbol table. As long as modules
- * don't have overlapping symbols, we're golden.
- */
-#if defined(NSLINKMODULE_OPTION_NONE)
+#if defined(NSLINKMODULE_OPTION_RETURN_ON_ERROR) && defined(NSLINKMODULE_OPTION_NONE)
         os_handle = NSLinkModule(image, path,
-                                 NSLINKMODULE_OPTION_NONE |
-                                 NSLINKMODULE_OPTION_RETURN_ON_ERROR);
+                                 NSLINKMODULE_OPTION_RETURN_ON_ERROR |
+                                 NSLINKMODULE_OPTION_NONE);
 #else
         os_handle = NSLinkModule(image, path, FALSE);
 #endif
         NSDestroyObjectFileImage(image);
     }
     else if (NSAddLibrary(path) == TRUE) {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/dso/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/dso/win32/dso.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/dso/win32/dso.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/dso/win32/dso.c	2002-03-20 12:25:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/dso/win32/dso.c	2002-05-20 23:23:42.000000000 +0800
@@ -109,15 +109,15 @@
             return ((*res_handle)->load_error = rv);
         }
         /* Prevent ugly popups from killing our app */
 #ifndef _WIN32_WCE
         em = SetErrorMode(SEM_FAILCRITICALERRORS);
 #endif
-        os_handle = LoadLibraryExW(wpath, NULL, LOAD_WITH_ALTERED_SEARCH_PATH);
+        os_handle = LoadLibraryExW(wpath, NULL, 0);
         if (!os_handle)
-            os_handle = LoadLibraryExW(wpath, NULL, 0);
+            os_handle = LoadLibraryExW(wpath, NULL, LOAD_WITH_ALTERED_SEARCH_PATH);
         if (!os_handle)
             rv = apr_get_os_error();
 #ifndef _WIN32_WCE
         SetErrorMode(em);
 #endif
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/netware/filestat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/netware/filestat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/netware/filestat.c	2002-04-23 05:22:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/netware/filestat.c	2002-06-11 23:34:26.000000000 +0800
@@ -56,15 +56,19 @@
 #include "nks/dirio.h"
 #include "apr_file_io.h"
 #include "apr_general.h"
 #include "apr_strings.h"
 #include "apr_errno.h"
 #include "apr_hash.h"
+#define USE_CSTAT_RWLOCK
 #ifdef USE_CSTAT_MUTEX
 #include "apr_thread_mutex.h"
 #endif
+#ifdef USE_CSTAT_RWLOCK
+#include "apr_thread_rwlock.h"
+#endif
 
 static apr_filetype_e filetype_from_mode(mode_t mode)
 {
     apr_filetype_e type = APR_NOFILE;
 
     if (S_ISREG(mode))
@@ -107,24 +111,22 @@
      */
 }
 
 char *case_filename(apr_pool_t *pPool, const char *szFile)
 {
     char *casedFileName = NULL;
-#ifdef WAIT_TO_IMPLEMENT
     char buf[1024];
     NXDirAttrWithName_t	*attrBuf;
     int rc;
 
     attrBuf = (NXDirAttrWithName_t *) &buf;
     rc =NXGetAttr(NULL, szFile, NX_DELEVEL_NAME_ONLY, attrBuf, 1024, 0);
     if (rc == 0) {
         casedFileName = apr_pstrdup(pPool, attrBuf->deName);
     }
     else
-#endif
     {
         char *s;
         s = strrchr(szFile, '/');
         if (!s)
             s = strrchr(szFile, ':');
         if (s) {
@@ -213,125 +215,182 @@
 }
 
 typedef struct apr_stat_entry_t apr_stat_entry_t;
 
 struct apr_stat_entry_t {
     struct stat info;
+    char *casedName;
     apr_time_t expire;
 };
 
 typedef struct apr_stat_cache_t apr_stat_cache_t;
 
 struct apr_stat_cache_t {
     apr_hash_t *statCache;
 #ifdef USE_CSTAT_MUTEX
     apr_thread_mutex_t *statcache_mutex;
 #endif
+#ifdef USE_CSTAT_RWLOCK
+    apr_thread_rwlock_t *statcache_mutex;
+#endif
 };
 
-int cstat (const char *path, struct stat *buf)
+int cstat (const char *path, struct stat *buf, char **casedName, apr_pool_t *pool)
 {
     apr_stat_cache_t *statCacheData = (apr_stat_cache_t *)getStatCache();
     apr_hash_t *statCache = NULL;
 #ifdef USE_CSTAT_MUTEX
     apr_thread_mutex_t *statcache_mutex;
 #endif
+#ifdef USE_CSTAT_RWLOCK
+    apr_thread_rwlock_t *statcache_mutex;
+#endif
     apr_pool_t *gPool = (apr_pool_t *)getGlobalPool();
     apr_stat_entry_t *stat_entry;
     struct stat *info;
     apr_time_t now = apr_time_now();
     char *key;
     int ret;
     int found = 0;
 
-    if (!gPool)
-        return stat(path, buf);
+    *casedName = NULL;
 
-    if (!statCacheData) {
+    /* If there isn't a global pool then just stat the file
+       and return */
+    if (!gPool) {
+        ret = stat(path, buf);
+        if (ret == 0)
+            *casedName = case_filename(pool, path);
+        return ret;
+    }
+
+    /* If we have a statCacheData structure then use it.
+       Otherwise we need to create it and initialized it
+       with a new mutex lock. */
+    if (statCacheData) {
+        statCache = statCacheData->statCache;
+#if defined(USE_CSTAT_MUTEX) || defined(USE_CSTAT_RWLOCK)
+        statcache_mutex = statCacheData->statcache_mutex;
+#endif
+    }
+    else {
         statCacheData = (apr_stat_cache_t *)apr_palloc (gPool, sizeof(apr_stat_cache_t));
         statCache = apr_hash_make(gPool);
 #ifdef USE_CSTAT_MUTEX
         apr_thread_mutex_create(&statcache_mutex, APR_THREAD_MUTEX_DEFAULT, gPool);
         statCacheData->statcache_mutex = statcache_mutex;
 #endif
+#ifdef USE_CSTAT_RWLOCK
+        apr_thread_rwlock_create(&statcache_mutex, gPool);
+        statCacheData->statcache_mutex = statcache_mutex;
+#endif
         statCacheData->statCache = statCache;
         setStatCache((void*)statCacheData);
     }
-    else {
-        statCache = statCacheData->statCache;
-#ifdef USE_CSTAT_MUTEX
-        statcache_mutex = statCacheData->statcache_mutex;
-#endif
-    }
 
+    /* If we have a statCache then try to pull the information
+       from the cache.  Otherwise just stat the file and return.*/
     if (statCache) {
 #ifdef USE_CSTAT_MUTEX
         apr_thread_mutex_lock(statcache_mutex);
 #endif
+#ifdef USE_CSTAT_RWLOCK
+        apr_thread_rwlock_rdlock(statcache_mutex);
+#endif
         stat_entry = (apr_stat_entry_t*) apr_hash_get(statCache, path, APR_HASH_KEY_STRING);
 #ifdef USE_CSTAT_MUTEX
         apr_thread_mutex_unlock(statcache_mutex);
 #endif
+#ifdef USE_CSTAT_RWLOCK
+        apr_thread_rwlock_unlock(statcache_mutex);
+#endif
+        /* If we got an entry then check the expiration time.  If the entry
+           hasn't expired yet then copy the information and return. */
         if (stat_entry) {
             if ((now - stat_entry->expire) <= APR_USEC_PER_SEC) {
                 memcpy (buf, &(stat_entry->info), sizeof(struct stat));
+                if (stat_entry->casedName)
+                    *casedName = apr_pstrdup (pool, stat_entry->casedName);
+                else
+                    *casedName = case_filename(pool, path);
                 found = 1;
             }
         }
 
         if (!found) {
             ret = stat(path, buf);
             if (ret == 0) {
+                *casedName = case_filename(pool, path);
+#ifdef USE_CSTAT_MUTEX
+                apr_thread_mutex_lock(statcache_mutex);
+#endif
+#ifdef USE_CSTAT_RWLOCK
+                apr_thread_rwlock_wrlock(statcache_mutex);
+#endif
+                /* If we don't have a stat_entry then create one, copy
+                   the data and add it to the hash table. */
                 if (!stat_entry) {
                     key = apr_pstrdup (gPool, path);
                     stat_entry = apr_palloc (gPool, sizeof(apr_stat_entry_t));
                     memcpy (&(stat_entry->info), buf, sizeof(struct stat));
+                    if (*casedName)
+                        stat_entry->casedName = apr_pstrdup (gPool, *casedName);
                     stat_entry->expire = now;
-#ifdef USE_CSTAT_MUTEX
-                    apr_thread_mutex_lock(statcache_mutex);
-#endif
                     apr_hash_set(statCache, key, APR_HASH_KEY_STRING, stat_entry);
-#ifdef USE_CSTAT_MUTEX
-                    apr_thread_mutex_unlock(statcache_mutex);
-#endif
                 }
                 else {
+                    /* If we do have a stat_entry then it must have expired.  Just
+                       copy the data and reset the expiration. */
                     memcpy (&(stat_entry->info), buf, sizeof(struct stat));
+
+                    /* If we have a casedName and don't have a cached name or the names don't
+                       compare, then cache the name. */
+                    if (*casedName && (!stat_entry->casedName || strcmp(*casedName, stat_entry->casedName))) {
+                        stat_entry->casedName = apr_pstrdup (gPool, *casedName);
+                    }
                     stat_entry->expire = now;
                 }
+#ifdef USE_CSTAT_MUTEX
+                apr_thread_mutex_unlock(statcache_mutex);
+#endif
+#ifdef USE_CSTAT_RWLOCK
+                apr_thread_rwlock_unlock(statcache_mutex);
+#endif
             }
             else
                 return ret;
         }
     }
     else {
-        return stat(path, buf);
+        ret = stat(path, buf);
+        if (ret == 0)
+            *casedName = case_filename(pool, path);
+        return ret;
     }
     return 0;
 }
 
 APR_DECLARE(apr_status_t) apr_stat(apr_finfo_t *finfo, 
                                    const char *fname, 
                                    apr_int32_t wanted, apr_pool_t *pool)
 {
     struct stat info;
     int srv;
-    char *s;
+    char *casedName = NULL;
 
-    srv = cstat(fname, &info);
+    srv = cstat(fname, &info, &casedName, pool);
 
     if (srv == 0) {
         finfo->pool = pool;
         finfo->fname = fname;
         fill_out_finfo(finfo, &info, wanted);
         if (wanted & APR_FINFO_LINK)
             wanted &= ~APR_FINFO_LINK;
         if (wanted & APR_FINFO_NAME) {
-            s = case_filename(pool, fname);
-            if (s) {
-                finfo->name = s;
+            if (casedName) {
+                finfo->name = casedName;
                 finfo->valid |= APR_FINFO_NAME;
             }
         }
         return (wanted & ~finfo->valid) ? APR_INCOMPLETE : APR_SUCCESS;
     }
     else {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/netware/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/netware/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/netware/pipe.c	2002-04-12 04:49:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/netware/pipe.c	2002-06-04 02:52:45.000000000 +0800
@@ -56,45 +56,26 @@
 #include <nks/fsio.h>
 #include <nks/errno.h>
 
 #include "fileio.h"
 #include "apr_strings.h"
 
-apr_status_t apr_netware_pipe_cleanup(void *thefile)
-{
-    apr_file_t *file = thefile;
-    apr_status_t rv = APR_SUCCESS;
-    int rc;
-
-	rc = close(file->filedes);
-    if (rc == 0) {
-        file->filedes = -1;
-        if (file->thlock) {
-            rv = apr_thread_mutex_destroy(file->thlock);
-        }
-    }
-    else {
-        /* Are there any error conditions other than EINTR or EBADF? */
-        rv = errno;
-    }
-    return rv;
-}
-
 static apr_status_t pipeblock(apr_file_t *thepipe)
 {
 #ifdef USE_FLAGS
     int				err;
 	unsigned long	flags;
 
 	if (fcntl(thepipe->filedes, F_GETFL, &flags) != -1)
 	{
 		flags &= ~FNDELAY;
 		fcntl(thepipe->filedes, F_SETFL, flags);
 	}
 #else
-		fcntl(thepipe->filedes, F_SETFL, FNDELAY);
+        errno = 0;
+		fcntl(thepipe->filedes, F_SETFL, 0);
 #endif
 
     if (errno)
         return errno;
 
     thepipe->blocking = BLK_ON;
@@ -111,25 +92,26 @@
 	if (fcntl(thepipe->filedes, F_GETFL, &flags) != -1)
 	{
 		flags |= FNDELAY;
 		fcntl(thepipe->filedes, F_SETFL, flags);
 	}
 #else
-		fcntl(thepipe->filedes, F_SETFL, 0);
+        errno = 0;
+		fcntl(thepipe->filedes, F_SETFL, FNDELAY);
 #endif
 
     if (errno)
         return errno;
 
     thepipe->blocking = BLK_OFF;
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_file_pipe_timeout_set(apr_file_t *thepipe, apr_interval_time_t timeout)
 {
-    if (thepipe->pipe == 1) {
+    if (thepipe->is_pipe == 1) {
         thepipe->timeout = timeout;
         if (timeout >= 0) {
             if (thepipe->blocking != BLK_OFF) { /* blocking or unknown state */
                 return pipenonblock(thepipe);
             }
         }
@@ -142,62 +124,52 @@
     }
     return APR_EINVAL;
 }
 
 APR_DECLARE(apr_status_t) apr_file_pipe_timeout_get(apr_file_t *thepipe, apr_interval_time_t *timeout)
 {
-    if (thepipe->pipe == 1) {
+    if (thepipe->is_pipe == 1) {
         *timeout = thepipe->timeout;
         return APR_SUCCESS;
     }
     return APR_EINVAL;
 }
 
 APR_DECLARE(apr_status_t) apr_file_pipe_create(apr_file_t **in, apr_file_t **out, apr_pool_t *pool)
 {
-	char        tname[L_tmpnam+1];
 	int     	filedes[2];
 	int 		err;
 
-	if (!tmpnam(tname))
-		return errno;
+    if (pipe(filedes) == -1) {
+        return errno;
+    }
 
-	if (((filedes[0] = pipe_open(tname, O_RDONLY)) != -1)
-		&& ((filedes[1] = pipe_open(tname, O_WRONLY)) != -1))
-	{
-        (*in) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
-        (*out) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
+    (*in) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
+    (*out) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
 
-		(*in)->pool     =
-		(*out)->pool    = pool;
-		(*in)->filedes   = filedes[0];
-		(*out)->filedes  = filedes[1];
-		(*in)->pipe      =
-		(*out)->pipe     = 1;
-		(*out)->fname    = apr_pstrdup(pool, tname);
-		(*in)->fname     = apr_pstrdup(pool, tname);;
-		(*in)->buffered  =
-		(*out)->buffered = 0;
-		(*in)->blocking  =
-		(*out)->blocking = BLK_ON;
-		(*in)->timeout   =
-		(*out)->timeout  = -1;
-		(*in)->ungetchar = -1;
-		(*in)->thlock    =
-		(*out)->thlock   = NULL;
-	}
-	else
-	{
-		if (filedes[0] != -1)
-			close(filedes[0]);
-        return errno;
-	}
+    (*in)->pool     =
+    (*out)->pool    = pool;
+    (*in)->filedes   = filedes[0];
+    (*out)->filedes  = filedes[1];
+    (*in)->is_pipe      =
+    (*out)->is_pipe     = 1;
+    (*out)->fname    = 
+    (*in)->fname     = NULL;
+    (*in)->buffered  =
+    (*out)->buffered = 0;
+    (*in)->blocking  =
+    (*out)->blocking = BLK_ON;
+    (*in)->timeout   =
+    (*out)->timeout  = -1;
+    (*in)->ungetchar = -1;
+    (*in)->thlock    =
+    (*out)->thlock   = NULL;
 
-    apr_pool_cleanup_register((*in)->pool, (void *)(*in), apr_netware_pipe_cleanup,
+    apr_pool_cleanup_register((*in)->pool, (void *)(*in), apr_unix_file_cleanup,
                          apr_pool_cleanup_null);
-    apr_pool_cleanup_register((*out)->pool, (void *)(*out), apr_netware_pipe_cleanup,
+    apr_pool_cleanup_register((*out)->pool, (void *)(*out), apr_unix_file_cleanup,
                          apr_pool_cleanup_null);
 
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_file_namedpipe_create(const char *filename, 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/dir.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/dir.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/dir.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/dir.c	2002-06-11 18:35:20.000000000 +0800
@@ -172,12 +172,20 @@
 {
     return APR_OS2_STATUS(DosCreateDir(path, NULL));
 }
 
 
 
+apr_status_t apr_dir_make_recursive(const char *path, apr_fileperms_t perm,
+                                    apr_pool_t *pool) 
+{
+    return APR_ENOTIMPL;
+}
+
+
+
 APR_DECLARE(apr_status_t) apr_dir_remove(const char *path, apr_pool_t *pool)
 {
     return APR_OS2_STATUS(DosDeleteDir(path));
 }
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/open.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/open.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/open.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/open.c	2002-06-09 06:32:11.000000000 +0800
@@ -264,10 +264,10 @@
 
     return apr_os_file_put(thefile, &fd, 0, pool);
 }
 
 APR_POOL_IMPLEMENT_ACCESSOR(file);
 
-APR_IMPLEMENT_SET_INHERIT(file, flags, pool, apr_file_cleanup)
+APR_IMPLEMENT_INHERIT_SET(file, flags, pool, apr_file_cleanup)
 
-APR_IMPLEMENT_UNSET_INHERIT(file, flags, pool, apr_file_cleanup)
+APR_IMPLEMENT_INHERIT_UNSET(file, flags, pool, apr_file_cleanup)
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/readwrite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/readwrite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/os2/readwrite.c	2002-03-14 04:39:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/os2/readwrite.c	2002-05-23 17:53:53.000000000 +0800
@@ -189,16 +189,23 @@
         apr_thread_mutex_unlock(thefile->mutex);
         return APR_OS2_STATUS(rc);
     } else {
         if (thefile->flags & APR_APPEND) {
             FILELOCK all = { 0, 0x7fffffff };
             ULONG newpos;
-            DosSetFileLocks(thefile->filedes, NULL, &all, -1, 0);
-            DosSetFilePtr(thefile->filedes, 0, FILE_END, &newpos);
-            rc = DosWrite(thefile->filedes, buf, *nbytes, &byteswritten);
-            DosSetFileLocks(thefile->filedes, &all, NULL, -1, 0);
+            rc = DosSetFileLocks(thefile->filedes, NULL, &all, -1, 0);
+
+            if (rc == 0) {
+                rc = DosSetFilePtr(thefile->filedes, 0, FILE_END, &newpos);
+
+                if (rc == 0) {
+                    rc = DosWrite(thefile->filedes, buf, *nbytes, &byteswritten);
+                }
+
+                DosSetFileLocks(thefile->filedes, &all, NULL, -1, 0);
+            }
         } else {
             rc = DosWrite(thefile->filedes, buf, *nbytes, &byteswritten);
         }
 
         if (rc) {
             *nbytes = 0;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/dir.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/dir.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/dir.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/dir.c	2002-06-01 06:28:40.000000000 +0800
@@ -70,12 +70,45 @@
     }
     else {
         return errno;
     }
 } 
 
+#define PATH_SEPARATOR '/'
+
+/* Remove trailing separators that don't affect the meaning of PATH. */
+static const char *path_canonicalize (const char *path, apr_pool_t *pool)
+{
+    /* At some point this could eliminate redundant components.  For
+     * now, it just makes sure there is no trailing slash. */
+    apr_size_t len = strlen (path);
+    apr_size_t orig_len = len;
+    
+    while ((len > 0) && (path[len - 1] == PATH_SEPARATOR))
+        len--;
+    
+    if (len != orig_len)
+        return apr_pstrndup (pool, path, len);
+    else
+        return path;
+}
+
+/* Remove one component off the end of PATH. */
+static char *path_remove_last_component (const char *path, apr_pool_t *pool)
+{
+    const char *newpath = path_canonicalize (path, pool);
+    int i;
+    
+    for (i = (strlen(newpath) - 1); i >= 0; i--) {
+        if (path[i] == PATH_SEPARATOR)
+            break;
+    }
+
+    return apr_pstrndup (pool, path, (i < 0) ? 0 : i);
+}
+
 apr_status_t apr_dir_open(apr_dir_t **new, const char *dirname, apr_pool_t *pool)
 {
     /* On some platforms (e.g., Linux+GNU libc), d_name[] in struct 
      * dirent is declared with enough storage for the name.  On other
      * platforms (e.g., Solaris 8 for Intel), d_name is declared as a
      * one-byte array.  Note: gcc evaluates this at compile time.
@@ -201,12 +234,35 @@
     }
     else {
         return errno;
     }
 }
 
+apr_status_t apr_dir_make_recursive(const char *path, apr_fileperms_t perm,
+                                           apr_pool_t *pool) 
+{
+    apr_status_t apr_err = 0;
+    
+    apr_err = apr_dir_make (path, perm, pool); /* Try to make PATH right out */
+    
+    if (apr_err == EEXIST) /* It's OK if PATH exists */
+        return APR_SUCCESS;
+    
+    if (apr_err == ENOENT) { /* Missing an intermediate dir */
+        char *dir;
+        
+        dir = path_remove_last_component(path, pool);
+        apr_err = apr_dir_make_recursive(dir, perm, pool);
+        
+        if (!apr_err) 
+            apr_err = apr_dir_make (path, perm, pool);
+    }
+
+    return apr_err;
+}
+
 apr_status_t apr_dir_remove(const char *path, apr_pool_t *pool)
 {
     if (rmdir(path) == 0) {
         return APR_SUCCESS;
     }
     else {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/filedup.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/filedup.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/filedup.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/filedup.c	2002-06-09 06:32:11.000000000 +0800
@@ -110,13 +110,13 @@
     (*new_file)->blocking = old_file->blocking; 
 
     /* make sure unget behavior is consistent */
     (*new_file)->ungetchar = old_file->ungetchar;
 
     /* apr_file_dup() clears the inherit attribute, user must call 
-     * apr_file_set_inherit() again on the dupped handle, as necessary.
+     * apr_file_inherit_set() again on the dupped handle, as necessary.
      */
     (*new_file)->flags = old_file->flags & ~APR_INHERIT;
 
     return APR_SUCCESS;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/filepath.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/filepath.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/filepath.c	2002-03-17 11:24:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/filepath.c	2002-06-12 09:42:35.000000000 +0800
@@ -186,16 +186,13 @@
 
     rootlen = strlen(rootpath);
     maxlen = rootlen + strlen(addpath) + 4; /* 4 for slashes at start, after
                                              * root, and at end, plus trailing
                                              * null */
     if (maxlen > APR_PATH_MAX) {
-        if (rootlen >= APR_PATH_MAX) {
-            return APR_ENAMETOOLONG;
-        }
-        maxlen = APR_PATH_MAX;
+        return APR_ENAMETOOLONG;
     }
     path = (char *)apr_palloc(p, maxlen);
 
     if (addpath[0] == '/') 
     {
         /* Ignore the given root path, strip off leading 
@@ -220,14 +217,12 @@
         keptlen = rootlen;
         memcpy(path, rootpath, rootlen);
         
         /* Always '/' terminate the given root path
          */
         if (keptlen && path[keptlen - 1] != '/') {
-            if (keptlen + 1 >= maxlen)
-                return APR_ENAMETOOLONG;
             path[keptlen++] = '/';
         }
         pathlen = keptlen;
     }
 
     while (*addpath) 
@@ -268,15 +263,12 @@
                 if (flags & APR_FILEPATH_SECUREROOTTEST) {
                     return APR_EABOVEROOT;
                 }
 
                 /* Otherwise append another backpath.
                  */
-                if (pathlen + 3 >= maxlen ) {
-                    return APR_ENAMETOOLONG;
-                }
                 memcpy(path + pathlen, "../", 3);
                 pathlen += 3;
             }
             else 
             {
                 /* otherwise crop the prior segment 
@@ -301,15 +293,12 @@
         {
             /* An actual segment, append it to the destination path
              */
             if (*next) {
                 seglen++;
             }
-            if (pathlen + seglen >= maxlen) {
-                return APR_ENAMETOOLONG;
-            }
             memcpy(path + pathlen, addpath, seglen);
             pathlen += seglen;
         }
 
         /* Skip over trailing slash to the next segment
          */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/open.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/open.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/open.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/open.c	2002-06-09 06:32:11.000000000 +0800
@@ -149,12 +149,17 @@
     if (flag & APR_APPEND) {
         oflags |= O_APPEND;
     }
     if (flag & APR_TRUNCATE) {
         oflags |= O_TRUNC;
     }
+#ifdef O_BINARY
+    if (flag & APR_BINARY) {
+        oflags |= O_BINARY;
+    }
+#endif
     
     if (perm == APR_OS_DEFAULT) {
         (*new)->filedes = open(fname, oflags, 0666);
     }
     else {
         (*new)->filedes = open(fname, oflags, apr_unix_perms2mode(perm));
@@ -163,13 +168,13 @@
     if ((*new)->filedes < 0) {
        (*new)->filedes = -1;
        (*new)->eof_hit = 1;
        return errno;
     }
 
-    (*new)->pipe = 0;
+    (*new)->is_pipe = 0;
     (*new)->timeout = -1;
     (*new)->ungetchar = -1;
     (*new)->eof_hit = 0;
     (*new)->filePtr = 0;
     (*new)->bufpos = 0;
     (*new)->dataRead = 0;
@@ -264,11 +269,11 @@
 {
     int fd = STDIN_FILENO;
 
     return apr_os_file_put(thefile, &fd, 0, pool);
 }
 
-APR_IMPLEMENT_SET_INHERIT(file, flags, pool, apr_unix_file_cleanup)
+APR_IMPLEMENT_INHERIT_SET(file, flags, pool, apr_unix_file_cleanup)
 
-APR_IMPLEMENT_UNSET_INHERIT(file, flags, pool, apr_unix_file_cleanup)
+APR_IMPLEMENT_INHERIT_UNSET(file, flags, pool, apr_unix_file_cleanup)
 
 APR_POOL_IMPLEMENT_ACCESSOR(file)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/unix/pipe.c	2002-03-20 16:54:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/unix/pipe.c	2002-06-01 00:18:38.000000000 +0800
@@ -139,13 +139,13 @@
     thepipe->blocking = BLK_OFF;
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_file_pipe_timeout_set(apr_file_t *thepipe, apr_interval_time_t timeout)
 {
-    if (thepipe->pipe == 1) {
+    if (thepipe->is_pipe == 1) {
         thepipe->timeout = timeout;
         if (timeout >= 0) {
             if (thepipe->blocking != BLK_OFF) { /* blocking or unknown state */
                 return pipenonblock(thepipe);
             }
         }
@@ -158,13 +158,13 @@
     }
     return APR_EINVAL;
 }
 
 APR_DECLARE(apr_status_t) apr_file_pipe_timeout_get(apr_file_t *thepipe, apr_interval_time_t *timeout)
 {
-    if (thepipe->pipe == 1) {
+    if (thepipe->is_pipe == 1) {
         *timeout = thepipe->timeout;
         return APR_SUCCESS;
     }
     return APR_EINVAL;
 }
 
@@ -176,32 +176,32 @@
         return errno;
     }
     
     (*in) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
     (*in)->pool = pool;
     (*in)->filedes = filedes[0];
-    (*in)->pipe = 1;
+    (*in)->is_pipe = 1;
     (*in)->fname = NULL;
     (*in)->buffered = 0;
     (*in)->blocking = BLK_ON;
     (*in)->timeout = -1;
     (*in)->ungetchar = -1;
 #if APR_HAS_THREADS
     (*in)->thlock = NULL;
 #endif
 
     (*out) = (apr_file_t *)apr_pcalloc(pool, sizeof(apr_file_t));
     (*out)->pool = pool;
     (*out)->filedes = filedes[1];
-    (*out)->pipe = 1;
+    (*out)->is_pipe = 1;
     (*out)->fname = NULL;
     (*out)->buffered = 0;
     (*out)->blocking = BLK_ON;
     (*out)->timeout = -1;
 #if APR_HAS_THREADS
-    (*in)->thlock = NULL;
+    (*out)->thlock = NULL;
 #endif
 
     apr_pool_cleanup_register((*in)->pool, (void *)(*in), apr_unix_file_cleanup,
                          apr_pool_cleanup_null);
     apr_pool_cleanup_register((*out)->pool, (void *)(*out), apr_unix_file_cleanup,
                          apr_pool_cleanup_null);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/filepath.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/filepath.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/filepath.c	2002-04-24 11:31:46.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/filepath.c	2002-05-03 23:34:45.000000000 +0800
@@ -83,53 +83,64 @@
 #ifdef NETWARE
     char seperator[2] = { 0, 0};
     char server[MAX_SERVER_NAME+1];
     char volume[MAX_VOLUME_NAME+1];
     char path[MAX_PATH_NAME+1];
     char file[MAX_FILE_NAME+1];
+    char *volsep = NULL;
     int elements;
 
+    if (inpath && *inpath)
+        volsep = strchr (*inpath, ':');
+    else
+        return APR_EBADPATH;
+
     seperator[0] = (flags & APR_FILEPATH_NATIVE) ? '\\' : '/';
 
     /* Allocate and initialize each of the segment buffers
     */
     server[0] = volume[0] = path[0] = file[0] = '\0';
 
-    /* Split the inpath into its separate parts. If it fails then
-        we know we have a bad path.
-    */
-    if (deconstruct(testpath, server, volume, path, file, NULL, &elements, PATH_UNDEF)) {
-        if (errno == EINVAL)
-            return APR_EBADPATH;
-    }
-    
-    /* If we got a volume part then continue splitting out the root.
-        Otherwise we either have an incomplete or relative path
+    /* If we don't have a volume separator then don't bother deconstructing
+        the path since we won't use the deconstructed information anyway.
     */
-    if (volume && strlen(volume) > 0) {
-        newpath = apr_pcalloc(p, strlen(server)+strlen(volume)+5);
-        construct(newpath, server, volume, NULL, NULL, NULL, PATH_NETWARE);
-
-        /* NetWare doesn't add the root slash so we need to add it manually.
+    if (volsep) {
+        /* Split the inpath into its separate parts. If it fails then
+            we know we have a bad path.
         */
-        strcat(newpath, seperator);
-        *rootpath = newpath;
-
-        /* Skip the inpath pointer down to the first non-root character
+        if (deconstruct(testpath, server, volume, path, file, NULL, &elements, PATH_UNDEF)) {
+            if (errno == EINVAL)
+                return APR_EBADPATH;
+        }
+    
+        /* If we got a volume part then continue splitting out the root.
+            Otherwise we either have an incomplete or relative path
         */
-        newpath = strchr (*inpath, ':');
-        if (newpath) {
+        if (volume && strlen(volume) > 0) {
+            newpath = apr_pcalloc(p, strlen(server)+strlen(volume)+5);
+            construct(newpath, server, volume, NULL, NULL, NULL, PATH_NETWARE);
+
+            /* NetWare doesn't add the root slash so we need to add it manually.
+            */
+            strcat(newpath, seperator);
+            *rootpath = newpath;
+
+            /* Skip the inpath pointer down to the first non-root character
+            */
+            newpath = volsep;
             do {
                 ++newpath;
             } while (*newpath && ((*newpath == '/') || (*newpath == '\\')));
             *inpath = newpath;
-        }
 
-/* Need to handle APR_FILEPATH_TRUENAME checking here. */
+            /* Need to handle APR_FILEPATH_TRUENAME checking here. */
 
-        return APR_SUCCESS;
+            return APR_SUCCESS;
+        }
+        else
+            return APR_EBADPATH;
     }
     else if ((**inpath == '/') || (**inpath == '\\')) {
         /* if we have a root path without a volume then just split
             in same manner as unix although this path will be
             incomplete.
         */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/open.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/open.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/open.c	2002-03-20 16:54:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/open.c	2002-06-09 06:32:11.000000000 +0800
@@ -65,12 +65,13 @@
 #include <winbase.h>
 #include <string.h>
 #if APR_HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
 #include "misc.h"
+#include "inherit.h"
 
 #if APR_HAS_UNICODE_FS
 apr_status_t utf8_to_unicode_path(apr_wchar_t* retstr, apr_size_t retlen, 
                                   const char* srcstr)
 {
     /* TODO: The computations could preconvert the string to determine
@@ -515,13 +516,23 @@
                                           apr_pool_t *pool)
 {
     (*file) = apr_pcalloc(pool, sizeof(apr_file_t));
     (*file)->pool = pool;
     (*file)->filehand = *thefile;
     (*file)->ungetchar = -1; /* no char avail */
-    (*file)->flags;
+    (*file)->timeout = -1;
+    (*file)->flags = flags;
+    if (flags & APR_APPEND)
+        (*file)->append = 1;
+
+    /* XXX... we pcalloc above so all others are zeroed.
+     * Should we be testing if thefile is a handle to 
+     * a PIPE and set up the mechanics appropriately?
+     *
+     *  (*file)->pipe;
+     */
     return APR_SUCCESS;
 }    
 
 APR_DECLARE(apr_status_t) apr_file_eof(apr_file_t *fptr)
 {
     if (fptr->eof_hit == 1) {
@@ -592,13 +603,9 @@
     return apr_os_file_put(thefile, &file_handle, 0, pool);
 #endif
 }
 
 APR_POOL_IMPLEMENT_ACCESSOR(file);
 
-APR_DECLARE_SET_INHERIT(file) {
-    return;
-}
-
-APR_DECLARE_UNSET_INHERIT(file) {
-    return;
-}
+APR_IMPLEMENT_INHERIT_SET(file, flags, pool, file_cleanup)
+ 
+APR_IMPLEMENT_INHERIT_UNSET(file, flags, pool, file_cleanup)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/file_io/win32/pipe.c	2002-03-20 16:54:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/file_io/win32/pipe.c	2002-05-30 13:25:00.000000000 +0800
@@ -119,13 +119,13 @@
     (*out)->eof_hit = 0;
     (*out)->filePtr = 0;
     (*out)->bufpos = 0;
     (*out)->dataRead = 0;
     (*out)->direction = 0;
 
-    if (!CreatePipe(&(*in)->filehand, &(*out)->filehand, &sa, 0)) {
+    if (!CreatePipe(&(*in)->filehand, &(*out)->filehand, &sa, 65536)) {
         return apr_get_os_error();
     }
 
     apr_pool_cleanup_register((*in)->pool, (void *)(*in), file_cleanup,
                         apr_pool_cleanup_null);
     apr_pool_cleanup_register((*out)->pool, (void *)(*out), file_cleanup,
@@ -211,14 +211,14 @@
         sprintf(name, "\\\\.\\pipe\\%d.%d", getpid(), id++);
 
         (*in)->filehand = CreateNamedPipe(name,
                                           dwOpenMode,
                                           dwPipeMode,
                                           1,            //nMaxInstances,
-                                          8182,         //nOutBufferSize, 
-                                          8192,         //nInBufferSize,                   
+                                          0,            //nOutBufferSize, 
+                                          65536,        //nInBufferSize,                   
                                           1,            //nDefaultTimeOut,                
                                           &sa);
 
         /* Create the write end of the pipe */
         dwOpenMode = FILE_ATTRIBUTE_NORMAL;
         if (bAsyncWrite) {
@@ -234,13 +234,13 @@
                                       OPEN_EXISTING,   // dwCreationDisposition
                                       dwOpenMode,      // Pipe attributes
                                       NULL);           // handle to template file
     }
     else {
         /* Pipes on Win9* are blocking. Live with it. */
-        if (!CreatePipe(&(*in)->filehand, &(*out)->filehand, &sa, 0)) {
+        if (!CreatePipe(&(*in)->filehand, &(*out)->filehand, &sa, 65536)) {
             return apr_get_os_error();
         }
     }
 
     apr_pool_cleanup_register((*in)->pool, (void *)(*in), file_cleanup,
                         apr_pool_cleanup_null);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/i18n/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/i18n/unix/xlate.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/i18n/unix/xlate.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/i18n/unix/xlate.c	2002-04-17 04:25:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/i18n/unix/xlate.c	2002-06-09 02:53:13.000000000 +0800
@@ -273,13 +273,13 @@
                             couldn't handle the pair */
     }
     
     return status;
 }
 
-apr_status_t apr_xlate_get_sb(apr_xlate_t *convset, int *onoff)
+apr_status_t apr_xlate_sb_get(apr_xlate_t *convset, int *onoff)
 {
     *onoff = convset->sbcs_table != NULL;
     return APR_SUCCESS;
 } 
 
 apr_status_t apr_xlate_conv_buffer(apr_xlate_t *convset, const char *inbuf,
@@ -357,7 +357,49 @@
 
 apr_status_t apr_xlate_close(apr_xlate_t *convset)
 {
     return apr_pool_cleanup_run(convset->pool, convset, apr_xlate_cleanup);
 }
 
+#else /* !APR_HAS_XLATE */
+
+APR_DECLARE(apr_status_t) apr_xlate_open(apr_xlate_t **convset, 
+                                         const char *topage,
+                                         const char *frompage, 
+                                         apr_pool_t *pool)
+{
+    return APR_ENOTIMPL;
+}
+
+APR_DECLARE(apr_status_t) apr_xlate_sb_get(apr_xlate_t *convset, int *onoff)
+{
+    return APR_ENOTIMPL;
+}
+
+APR_DECLARE(apr_int32_t) apr_xlate_conv_byte(apr_xlate_t *convset, 
+                                             unsigned char inchar)
+{
+    return (-1);
+}
+
+APR_DECLARE(apr_status_t) apr_xlate_conv_buffer(apr_xlate_t *convset, 
+                                                const char *inbuf,
+                                                apr_size_t *inbytes_left, 
+                                                char *outbuf,
+                                                apr_size_t *outbytes_left)
+{
+    return APR_ENOTIMPL;
+}
+
+APR_DECLARE(apr_status_t) apr_xlate_close(apr_xlate_t *convset)
+{
+    return APR_ENOTIMPL;
+}
+
 #endif /* APR_HAS_XLATE */
+
+/* Deprecated
+ */
+APR_DECLARE(apr_status_t) apr_xlate_get_sb(apr_xlate_t *convset, int *onoff)
+{
+    return apr_xlate_sb_get(convset, onoff);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_allocator.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_allocator.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_allocator.h	2002-04-09 14:56:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_allocator.h	2002-06-09 06:09:50.000000000 +0800
@@ -80,13 +80,15 @@
 typedef struct apr_allocator_t apr_allocator_t;
 /** the structure which holds information about the allocation */
 typedef struct apr_memnode_t apr_memnode_t;
 
 struct apr_memnode_t {
     apr_memnode_t *next;
+    apr_memnode_t **ref;
     apr_uint32_t   index;
+    apr_uint32_t   free_index;
     char          *first_avail;
     char          *endp;
 };
 
 #define APR_MEMNODE_T_SIZE APR_ALIGN_DEFAULT(sizeof(apr_memnode_t))
 
@@ -139,38 +141,68 @@
  */
 /*
  * XXX: see if we can come up with something a bit better.  Currently
  * you can make a pool an owner, but if the pool doesn't use the allocator
  * the allocator will never be destroyed.
  */
+APR_DECLARE(void) apr_allocator_owner_set(apr_allocator_t *allocator,
+                                          apr_pool_t *pool);
+
+/** @deprecated @see apr_allocator_owner_set */
 APR_DECLARE(void) apr_allocator_set_owner(apr_allocator_t *allocator,
                                           apr_pool_t *pool);
 
 /**
  * Get the current owner of the allocator
  * @param allocator The allocator to get the owner from
  */
-APR_DECLARE(apr_pool_t *) apr_allocator_get_owner(apr_allocator_t *allocator);
+APR_DECLARE(apr_pool_t *) apr_allocator_owner_get(apr_allocator_t *allocator);
+
+/** @deprecated @see apr_allocator_owner_get */
+APR_DECLARE(apr_pool_t *) apr_allocator_get_owner(
+                                  apr_allocator_t *allocator);
+
+/**
+ * Set the current threshold at which the allocator should start
+ * giving blocks back to the system.
+ * @param allocator The allocator the set the threshold on
+ * @param size The threshold.  0 == unlimited.
+ */
+APR_DECLARE(void) apr_allocator_max_free_set(apr_allocator_t *allocator,
+                                             apr_size_t size);
+
+/** @deprecated @see apr_allocator_max_free_set */
+APR_DECLARE(void) apr_allocator_set_max_free(apr_allocator_t *allocator,
+                                             apr_size_t size);
 
 #include "apr_thread_mutex.h"
 
 #if APR_HAS_THREADS
 /**
  * Set a mutex for the allocator to use
  * @param allocator The allocator to set the mutex for
  * @param mutex The mutex
  */
+APR_DECLARE(void) apr_allocator_mutex_set(apr_allocator_t *allocator,
+                                          apr_thread_mutex_t *mutex);
+
+/** @deprecated @see apr_allocator_mutex_set */
 APR_DECLARE(void) apr_allocator_set_mutex(apr_allocator_t *allocator,
                                           apr_thread_mutex_t *mutex);
 
 /**
  * Get the mutex currently set for the allocator
  * @param allocator The allocator
  */
+APR_DECLARE(apr_thread_mutex_t *) apr_allocator_mutex_get(
+                                      apr_allocator_t *allocator);
+
+/** @deprecated @see apr_allocator_mutex_get */
 APR_DECLARE(apr_thread_mutex_t *) apr_allocator_get_mutex(
                                       apr_allocator_t *allocator);
+
 #endif /* APR_HAS_THREADS */
 
 /** @} */
 #ifdef __cplusplus
 }
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_atomic.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_atomic.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_atomic.h	2002-05-01 18:41:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_atomic.h	2002-06-11 23:35:25.000000000 +0800
@@ -161,20 +161,17 @@
 
 #define apr_atomic_add(mem, val)     atomic_add(mem,val)
 APR_DECLARE(int) apr_atomic_dec(apr_atomic_t *mem);
 #define apr_atomic_inc(mem)          atomic_inc(mem)
 #define apr_atomic_set(mem, val)     (*mem = val)
 #define apr_atomic_read(mem)         (*mem)
-#if defined(cmpxchg)
 #define apr_atomic_init(pool)        APR_SUCCESS
-#define apr_atomic_cas(mem,with,cmp) cmpxchg(mem,cmp,with)
-#else
-#define APR_ATOMIC_NEED_CAS_DEFAULT 1
-#endif
+#define apr_atomic_cas(mem,with,cmp) atomic_cmpxchg(mem,with,cmp)
+
+#elif defined(__FreeBSD__)
 
-#elif defined(__FreeBSD__) && (__FreeBSD__ >= 5)
 #include <machine/atomic.h>
 
 #define apr_atomic_t apr_uint32_t
 #define apr_atomic_add(mem, val)     atomic_add_int(mem,val)
 #define apr_atomic_dec(mem)          atomic_subtract_int(mem,1)
 #define apr_atomic_inc(mem)          atomic_add_int(mem,1)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_compat.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_compat.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_compat.h	2002-04-29 22:41:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_compat.h	2002-06-09 04:04:26.000000000 +0800
@@ -8,21 +8,12 @@
 /**
  * @defgroup APR_compat 1.3 Compatibility Functions
  * @ingroup APR
  * @{
  */
 
-/* changes between APACHE_2_0_35 and APACHE_2_0_36 */
-
-/** @deprecated @see apr_time_exp_tz */
-#define apr_explode_time apr_time_exp_tz
-/** @deprecated @see apr_time_exp_lt */
-#define apr_explode_localtime apr_time_exp_lt
-/** @deprecated @see apr_group_name_get */
-#define apr_get_groupname apr_group_name_get
-
 /* redefine 1.3.x symbols to those that now live in libapr */
 
 /** @see APR_INLINE */
 #define ap_inline APR_INLINE
 
 /** @deprecated @see apr_md5_ctx_t */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_errno.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_errno.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_errno.h	2002-04-18 04:22:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_errno.h	2002-05-20 21:22:36.000000000 +0800
@@ -969,15 +969,16 @@
                 || (s) == APR_OS_START_SYSERR + WSAECONNREFUSED)
 #define APR_STATUS_IS_EINPROGRESS(s)    ((s) == APR_EINPROGRESS \
                 || (s) == APR_OS_START_SYSERR + WSAEINPROGRESS)
 #define APR_STATUS_IS_ECONNABORTED(s)   ((s) == APR_ECONNABORTED \
                 || (s) == APR_OS_START_SYSERR + WSAECONNABORTED)
 #define APR_STATUS_IS_ECONNRESET(s)     ((s) == APR_ECONNRESET \
+                || (s) == APR_OS_START_SYSERR + ERROR_NETNAME_DELETED \
                 || (s) == APR_OS_START_SYSERR + WSAECONNRESET)
 #define APR_STATUS_IS_ETIMEDOUT(s)      ((s) == APR_ETIMEDOUT \
-                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT) \
+                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT \
                 || (s) == APR_OS_START_SYSERR + WAIT_TIMEOUT)
 #define APR_STATUS_IS_EHOSTUNREACH(s)   ((s) == APR_EHOSTUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAEHOSTUNREACH)
 #define APR_STATUS_IS_ENETUNREACH(s)    ((s) == APR_ENETUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAENETUNREACH)
 #define APR_STATUS_IS_EFTYPE(s)         ((s) == APR_EFTYPE \
@@ -1034,13 +1035,13 @@
                 || (s) == APR_OS_START_SYSERR + WSAEINPROGRESS)
 #define APR_STATUS_IS_ECONNABORTED(s)   ((s) == APR_ECONNABORTED \
                 || (s) == APR_OS_START_SYSERR + WSAECONNABORTED)
 #define APR_STATUS_IS_ECONNRESET(s)     ((s) == APR_ECONNRESET \
                 || (s) == APR_OS_START_SYSERR + WSAECONNRESET)
 #define APR_STATUS_IS_ETIMEDOUT(s)      ((s) == APR_ETIMEDOUT \
-                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT) \
+                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT \
                 || (s) == APR_OS_START_SYSERR + WAIT_TIMEOUT)
 #define APR_STATUS_IS_EHOSTUNREACH(s)   ((s) == APR_EHOSTUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAEHOSTUNREACH)
 #define APR_STATUS_IS_ENETUNREACH(s)    ((s) == APR_ENETUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAENETUNREACH)
 #define APR_STATUS_IS_ENETDOWN(s)       ((s) == APR_OS_START_SYSERR + WSAENETDOWN)
@@ -1076,13 +1077,13 @@
                 || (s) == APR_OS_START_SYSERR + WSAEINPROGRESS)
 #define APR_STATUS_IS_ECONNABORTED(s)   ((s) == APR_ECONNABORTED \
                 || (s) == APR_OS_START_SYSERR + WSAECONNABORTED)
 #define APR_STATUS_IS_ECONNRESET(s)     ((s) == APR_ECONNRESET \
                 || (s) == APR_OS_START_SYSERR + WSAECONNRESET)
 #define APR_STATUS_IS_ETIMEDOUT(s)      ((s) == APR_ETIMEDOUT \
-                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT) \
+                || (s) == APR_OS_START_SYSERR + WSAETIMEDOUT \
                 || (s) == APR_OS_START_SYSERR + WAIT_TIMEOUT)
 #define APR_STATUS_IS_EHOSTUNREACH(s)   ((s) == APR_EHOSTUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAEHOSTUNREACH)
 #define APR_STATUS_IS_ENETUNREACH(s)    ((s) == APR_ENETUNREACH \
                 || (s) == APR_OS_START_SYSERR + WSAENETUNREACH)
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_file_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_file_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_file_io.h	2002-04-19 19:30:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_file_io.h	2002-06-09 06:32:11.000000000 +0800
@@ -115,17 +115,17 @@
 #define APR_SET SEEK_SET
 #define APR_CUR SEEK_CUR
 #define APR_END SEEK_END
 /** @} */
 
 /**
- * @defgroup APR_file_set_attributes File Attribute Flags
+ * @defgroup APR_file_attrs_set File Attribute Flags
  * @{
  */
 
-/* flags for apr_file_set_attributes */
+/* flags for apr_file_attrs_set */
 #define APR_FILE_ATTR_READONLY   0x01          /**< File is read-only */
 #define APR_FILE_ATTR_EXECUTABLE 0x02          /**< File is executable */
 /** @} */
 
 /** File attributes */
 typedef apr_uint32_t apr_fileattrs_t;
@@ -357,14 +357,15 @@
  * @remark apr_file_read will read up to the specified number of bytes, but never 
  *      more.  If there isn't enough data to fill that number of bytes, 
  *      then the process/thread will block until it is available or EOF 
  *      is reached.  If a char was put back into the stream via ungetc, 
  *      it will be the first character returned. 
  *
- *      It is not possible for both bytes to be read and an APR_EOF or other 
- *      error to be returned.
+ *      It is possible for both bytes to be read and an error to be 
+ *      returned.  And if *bytes_read is less than nbytes, an
+ *      accompanying error is _always_ returned.
  *
  *      APR_EINTR is never returned.
  */
 APR_DECLARE(apr_status_t) apr_file_read_full(apr_file_t *thefile, void *buf,
                                         apr_size_t nbytes,
                                         apr_size_t *bytes_read);
@@ -609,12 +610,22 @@
  * @param perm Permissions for the new direcoty.
  * @param cont the pool to use.
  */                        
 APR_DECLARE(apr_status_t) apr_dir_make(const char *path, apr_fileperms_t perm, 
                         apr_pool_t *cont);
 
+/** Creates a new directory on the file system, but behaves like
+ * 'mkdir -p'. Creates intermediate directories as required. No error
+ * will be reported if PATH already exists.
+ * @param path the path for the directory to be created.  (use / on all systems)
+ * @param perm Permissions for the new direcoty.
+ * @param cont the pool to use.  */
+APR_DECLARE(apr_status_t) apr_dir_make_recursive(const char *path,
+                                                 apr_fileperms_t perm,
+                                                 apr_pool_t *pool);
+
 /**
  * Remove directory from the file system.
  * @param path the path for the directory to be removed.  (use / on all systems)
  * @param cont the pool to use.
  */                        
 APR_DECLARE(apr_status_t) apr_dir_remove(const char *path, apr_pool_t *cont);
@@ -652,18 +663,24 @@
 
 /**
  * Set a file to be inherited by child processes.
  * @param file The file to enable inheritance.
  *
  */
-APR_DECLARE(void) apr_file_set_inherit(apr_file_t *file);
+APR_DECLARE(void) apr_file_inherit_set(apr_file_t *file);
 
 /**
  * Unset a file from being inherited by child processes.
  * @param file The file to disable inheritance.
  */
+APR_DECLARE(void) apr_file_inherit_unset(apr_file_t *file);
+
+/** @deprecated @see apr_file_inherit_set */
+APR_DECLARE(void) apr_file_set_inherit(apr_file_t *file);
+
+/** @deprecated @see apr_file_inherit_unset */
 APR_DECLARE(void) apr_file_unset_inherit(apr_file_t *file);
 
 /**
  * Open a temporary file
  * @param fp The apr file to use as a temporary file.
  * @param templ The template to use when creating a temp file.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_general.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_general.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_general.h	2002-04-22 16:44:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_general.h	2002-06-09 04:26:44.000000000 +0800
@@ -109,41 +109,56 @@
 typedef int               apr_signum_t;
 
 /**
  * Finding offsets of elements within structures.
  * Taken from the X code... they've sweated portability of this stuff
  * so we don't have to.  Sigh...
+ * @param p_type pointer type name
+ * @param field  data field within the structure pointed to
+ * @return offset
  */
 
 #if defined(CRAY) || (defined(__arm) && !defined(LINUX))
 #ifdef __STDC__
-#define APR_XtOffset(p_type,field) _Offsetof(p_type,field)
+#define APR_OFFSET(p_type,field) _Offsetof(p_type,field)
 #else
 #ifdef CRAY2
-#define APR_XtOffset(p_type,field) \
+#define APR_OFFSET(p_type,field) \
         (sizeof(int)*((unsigned int)&(((p_type)NULL)->field)))
 
 #else /* !CRAY2 */
 
-#define APR_XtOffset(p_type,field) ((unsigned int)&(((p_type)NULL)->field))
+#define APR_OFFSET(p_type,field) ((unsigned int)&(((p_type)NULL)->field))
 
 #endif /* !CRAY2 */
 #endif /* __STDC__ */
 #else /* ! (CRAY || __arm) */
 
-#define APR_XtOffset(p_type,field) \
+#define APR_OFFSET(p_type,field) \
         ((long) (((char *) (&(((p_type)NULL)->field))) - ((char *) NULL)))
 
 #endif /* !CRAY */
 
+/**
+ * Finding offsets of elements within structures.
+ * @param s_type structure type name
+ * @param field  data field within the structure
+ * @return offset
+ */
 #ifdef offsetof
-#define APR_XtOffsetOf(s_type,field) offsetof(s_type,field)
+#define APR_OFFSETOF(s_type,field) offsetof(s_type,field)
 #else
-#define APR_XtOffsetOf(s_type,field) APR_XtOffset(s_type*,field)
+#define APR_OFFSETOF(s_type,field) APR_OFFSET(s_type*,field)
 #endif
 
+/** @deprecated @see APR_OFFSET */
+#define APR_XtOffset APR_OFFSET
+
+/** @deprecated @see APR_OFFSETOF */
+#define APR_XtOffsetOf APR_OFFSETOF
+
 
 /**
  * A couple of prototypes for functions in case some platform doesn't 
  * have it
  */
 #if (!APR_HAVE_STRCASECMP) && (APR_HAVE_STRICMP) 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include: apr.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.h.in	2002-04-15 13:55:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.h.in	2002-05-07 12:12:44.000000000 +0800
@@ -260,12 +260,13 @@
 
 /* And APR_PID_T_FMT */
 @pid_t_fmt@
 
 /* And APR_INT64_T_FMT */
 @int64_t_fmt@
+@int64_t_fmt_len@
 
 /* are we going to force the generic atomic operations */
 #define APR_FORCE_ATOMIC_GENERIC @apr_force_atomic_generic@
 
 /* Does the proc mutex lock threads too */
 #define APR_PROC_MUTEX_IS_GLOBAL      @proc_mutex_is_global@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.hnw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.hnw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.hnw	2002-04-11 12:36:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.hnw	2002-06-08 05:17:19.000000000 +0800
@@ -156,13 +156,13 @@
 #define APR_HAS_FCNTL_SERIALIZE           0
 #define APR_HAS_PROC_PTHREAD_SERIALIZE    0
 #define APR_HAS_RWLOCK_SERIALIZE          0 
 
 #define APR_HAS_LOCK_CREATE_NP            0
 
-#define APR_PROCESS_LOCK_IS_GLOBAL        0
+#define APR_PROCESS_LOCK_IS_GLOBAL        1
 
 #define APR_FILE_BASED_SHM      0
 
 #define APR_HAVE_CORKABLE_TCP	0
 #define APR_HAVE_GETRLIMIT      0
 #define APR_HAVE_IN_ADDR        1
@@ -186,12 +186,16 @@
 
 
 #if APR_HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
 
+#if APR_HAVE_IPV6
+#include <novtcpip.h>
+#endif
+
 /*  APR Feature Macros */
 #define APR_HAS_SHARED_MEMORY     0
 #define APR_HAS_THREADS           1
 #define APR_HAS_SENDFILE          0
 #define APR_HAS_MMAP              0
 #define APR_HAS_FORK              0
@@ -212,12 +216,20 @@
 #define APR_INADDR_NONE           INADDR_NONE
 
 /* This macro indicates whether or not EBCDIC is the native character set.
  */
 #define APR_CHARSET_EBCDIC        0
 
+/* Is the TCP_NODELAY socket option inherited from listening sockets?
+*/
+#define APR_TCP_NODELAY_INHERITED 1
+
+/* Is the O_NONBLOCK flag inherited from listening sockets?
+*/
+#define APR_O_NONBLOCK_INHERITED  1
+
 /* Typedefs that APR needs. */
 
 typedef  unsigned char     apr_byte_t;
 
 typedef  short             apr_int16_t;
 typedef  unsigned short    apr_uint16_t;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.hw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.hw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr.hw	2002-04-11 12:36:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr.hw	2002-05-06 23:35:20.000000000 +0800
@@ -333,13 +333,12 @@
 #endif
 typedef  int         apr_socklen_t;
 typedef  int         pid_t;
 typedef  int         uid_t;
 typedef  int         gid_t;
 
-typedef struct apr_lock_t        apr_lock_t;
 
 /* Mechanisms to properly type numeric literals */
 
 #define APR_INT64_C(val) (val##i64)
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_inherit.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_inherit.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_inherit.h	2002-03-14 04:39:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_inherit.h	2002-06-09 06:32:11.000000000 +0800
@@ -67,23 +67,24 @@
  * @{
  */
 
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
+
 /**
  * @param name Set Inheritance for this Socket/File Handle
  */
-#define APR_DECLARE_SET_INHERIT(name) \
-    APR_DECLARE(void) apr_##name##_set_inherit(apr_##name##_t *name)
+#define APR_DECLARE_INHERIT_SET(name) \
+    APR_DECLARE(void) apr_##name##_inherit_set(apr_##name##_t *name)
+
 /**
  * @param name Unset Inheritance for this Socket/File Handle
  */
-
-#define APR_DECLARE_UNSET_INHERIT(name) \
-    APR_DECLARE(void) apr_##name##_unset_inherit(apr_##name##_t *name)
+#define APR_DECLARE_INHERIT_UNSET(name) \
+    APR_DECLARE(void) apr_##name##_inherit_unset(apr_##name##_t *name)
 
 #ifdef __cplusplus
 }
 #endif
 /** @} */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_network_io.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_network_io.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_network_io.h	2002-04-11 09:30:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_network_io.h	2002-06-09 13:01:40.000000000 +0800
@@ -808,18 +808,24 @@
 #endif
 
 /**
  * Set a socket to be inherited by child processes.
  * @param socket The socket to enable inheritance.
  */
+APR_DECLARE(void) apr_socket_inherit_set(apr_socket_t *skt);
+
+/** @deprecated @see apr_socket_inherit_set */
 APR_DECLARE(void) apr_socket_set_inherit(apr_socket_t *skt);
 
 /**
  * Unset a socket from being inherited by child processes.
  * @param socket The socket to disable inheritance.
  */
+APR_DECLARE(void) apr_socket_inherit_unset(apr_socket_t *skt);
+
+/** @deprecated @see apr_socket_inherit_unset */
 APR_DECLARE(void) apr_socket_unset_inherit(apr_socket_t *skt);
 
 #ifdef __cplusplus
 }
 #endif
 /** @} */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_pools.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_pools.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_pools.h	2002-04-22 17:05:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_pools.h	2002-06-09 04:27:42.000000000 +0800
@@ -147,13 +147,13 @@
  * |   |   |   |   | x |   |   |   |  Pool owner checking.  On each use of a
  *                                    pool, check if the current thread is the
  *                                    pools owner.  If not, abort().  In
  *                                    combination with the verbose flag above,
  *                                    it will output OWNER in such an event
  *                                    prior to aborting.  Use the debug
- *                                    function apr_pool_set_owner() to switch
+ *                                    function apr_pool_owner_set() to switch
  *                                    a pools ownership.
  *
  * When no debug level was specified, assume general debug mode.
  * If level 0 was specified, debugging is switched off
  * </pre>
  */
@@ -268,31 +268,30 @@
 #else
 #define apr_pool_create(newpool, parent) \
     apr_pool_create_ex(newpool, parent, NULL, NULL)
 #endif
 #endif
 
-/**
- * This function is deprecated.  Use apr_pool_create_ex.
- * @param newpool The new sub-pool
- * @param parent The pool to use as a parent pool
- * @param apr_abort A function to use if the pool cannot allocate more memory.
- * @remark The @a apr_abort function provides a way to quit the program if the
- *      machine is out of memory.  By default, APR will return on error.
- */
+/** @deprecated @see apr_pool_create_ex */
 #if APR_POOL_DEBUG
 #define apr_pool_sub_make(newpool, parent, abort_fn) \
     (void)apr_pool_create_ex_debug(newpool, parent, abort_fn, \
                                    NULL, \
                                    APR_POOL__FILE_LINE__)
 #else
 #define apr_pool_sub_make(newpool, parent, abort_fn) \
     (void)apr_pool_create_ex(newpool, parent, abort_fn, NULL)
 #endif
 
 /**
+ * Find the pools allocator
+ * @param pool The pool to get the allocator from.
+ */
+APR_DECLARE(apr_allocator_t *) apr_pool_allocator_get(apr_pool_t *pool);
+
+/**
  * Clear all memory in the pool and run all the cleanups. This also destroys all
  * subpools.
  * @param p The pool to clear
  * @remark This does not actually free the memory, it just allows the pool
  *         to re-use this memory for the next allocation.
  * @see apr_pool_destroy()
@@ -381,13 +380,17 @@
 /**
  * Allocate a block of memory from a pool and set all of the memory to 0
  * @param p The pool to allocate from
  * @param size The amount of memory to allocate
  * @return The allocated memory
  */
+#if defined(DOXYGEN)
 APR_DECLARE(void *) apr_pcalloc(apr_pool_t *p, apr_size_t size);
+#elif !APR_POOL_DEBUG
+#define apr_pcalloc(p, size) memset(apr_palloc(p, size), 0, size)
+#endif
 
 /**
  * Debug version of apr_pcalloc
  * @param p See: apr_pcalloc
  * @param size See: apr_pcalloc
  * @param file_line Where the function is called from.
@@ -412,27 +415,37 @@
  * @tip If the program wants APR to exit on a memory allocation error,
  *      then this function can be called to set the callback to use (for
  *      performing cleanup and then exiting). If this function is not called,
  *      then APR will return an error and expect the calling program to
  *      deal with the error accordingly.
  */
+APR_DECLARE(void) apr_pool_abort_set(apr_abortfunc_t abortfunc,
+                                     apr_pool_t *pool);
+
+/** @deprecated @see apr_pool_abort_set */
 APR_DECLARE(void) apr_pool_set_abort(apr_abortfunc_t abortfunc,
                                      apr_pool_t *pool);
 
 /**
  * Get the abort function associated with the specified pool.
  * @param pool The pool for retrieving the abort function.
  * @return The abort function for the given pool.
  */
+APR_DECLARE(apr_abortfunc_t) apr_pool_abort_get(apr_pool_t *pool);
+
+/** @deprecated @see apr_pool_abort_get */
 APR_DECLARE(apr_abortfunc_t) apr_pool_get_abort(apr_pool_t *pool);
 
 /**
  * Get the parent pool of the specified pool.
  * @param pool The pool for retrieving the parent pool.
  * @return The parent of the given pool.
  */
+APR_DECLARE(apr_pool_t *) apr_pool_parent_get(apr_pool_t *pool);
+
+/** @deprecated @see apr_pool_parent_get */
 APR_DECLARE(apr_pool_t *) apr_pool_get_parent(apr_pool_t *pool);
 
 /**
  * Determine if pool a is an ancestor of pool b
  * @param a The pool to search
  * @param b The pool to search for
@@ -481,14 +494,20 @@
  * @param key The key to use for association
  * @param cleanup The cleanup program to use to cleanup the data (NULL if none)
  * @param pool The current pool
  * @note same as apr_pool_userdata_set(), except that this version doesn't
  *       make a copy of the key (this function is useful, for example, when
  *       the key is a string literal)
- * @warning The key and the data to be attached to the pool should have
- *       a life span at least as long as the pool itself.
+ * @warning This should NOT be used if the key could change addresses by
+ *       any means between the apr_pool_userdata_setn() call and a
+ *       subsequent apr_pool_userdata_get() on that key, such as if a
+ *       static string is used as a userdata key in a DSO and the DSO could
+ *       be unloaded and reloaded between the _setn() and the _get().  You
+ *       MUST use apr_pool_userdata_set() in such cases.
+ * @warning More generally, the key and the data to be attached to the
+ *       pool should have a life span at least as long as the pool itself.
  *
  */
 APR_DECLARE(apr_status_t) apr_pool_userdata_setn(
     const void *data,
     const char *key,
     apr_status_t (*cleanup)(void *),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_portable.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_portable.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_portable.h	2002-04-09 14:56:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_portable.h	2002-05-08 21:30:11.000000000 +0800
@@ -71,12 +71,13 @@
 #include "apr.h"
 #include "apr_pools.h"
 #include "apr_thread_proc.h"
 #include "apr_file_io.h"
 #include "apr_network_io.h"
 #include "apr_errno.h"
+#include "apr_global_mutex.h"
 #include "apr_proc_mutex.h"
 #include "apr_time.h"
 #include "apr_dso.h"
 #include "apr_shm.h"
 
 #if APR_HAVE_DIRENT_H
@@ -214,12 +215,30 @@
     int family;             /**< always required (APR_INET, APR_INET6, etc. */
     int type;               /**< always required (SOCK_STREAM, SOCK_DGRAM, etc. */
 };
 
 typedef struct apr_os_sock_info_t apr_os_sock_info_t;
 
+#if APR_PROC_MUTEX_IS_GLOBAL
+#define apr_os_global_mutex_t apr_os_proc_mutex_t
+#define apr_os_global_mutex_get apr_os_proc_mutex_get
+#else
+    struct apr_os_global_mutex_t {
+        apr_pool_t *pool;
+        apr_proc_mutex_t *proc_mutex;
+#if APR_HAS_THREADS
+        apr_thread_mutex_t *thread_mutex;
+#endif /* APR_HAS_THREADS */
+    };
+    typedef struct apr_os_global_mutex_t apr_os_global_mutex_t;
+
+APR_DECLARE(apr_status_t) apr_os_global_mutex_get(apr_os_global_mutex_t *ospmutex, 
+                                                apr_global_mutex_t *pmutex);
+#endif
+
+
 /**
  * convert the file from apr type to os specific type.
  * @param thefile The os specific file we are converting to
  * @param file The apr file to convert.
  * @remark On Unix, it is only possible to get a file descriptor from 
  *         an apr file type.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_proc_mutex.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_proc_mutex.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_proc_mutex.h	2002-04-09 14:56:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_proc_mutex.h	2002-06-07 22:04:34.000000000 +0800
@@ -148,12 +148,25 @@
  * Destroy the mutex and free the memory associated with the lock.
  * @param mutex the mutex to destroy.
  */
 APR_DECLARE(apr_status_t) apr_proc_mutex_destroy(apr_proc_mutex_t *mutex);
 
 /**
+ * Display the name of the mutex, as it relates to the actual method used.
+ * This matches the valid options for Apache's AcceptMutex directive
+ * @param mutex the name of the mutex
+ */
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex);
+
+/**
+ * Display the name of the default mutex: APR_LOCK_DEFAULT
+ * @param mutex the name of the default mutex
+ */
+APR_DECLARE(const char *) apr_proc_mutex_defname(void);
+
+/**
  * Get the pool used by this proc_mutex.
  * @return apr_pool_t the pool
  */
 APR_POOL_DECLARE_ACCESSOR(proc_mutex);
 
 #ifdef __cplusplus
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_ring.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_ring.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_ring.h	2002-03-14 04:39:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_ring.h	2002-06-04 05:24:23.000000000 +0800
@@ -60,25 +60,25 @@
  *
  * We'd use Dean's code directly if we could guarantee the
  * availability of inline functions.
  */
 /**
  * @file apr_ring.h
- * @brief APR-Util Rings
+ * @brief APR Rings
  */
 #ifndef APR_RING_H
 #define APR_RING_H
 
 /*
  * for offsetof()
  */
 #include "apr_general.h"
 
 /**
- * @defgroup APR_Util_Rings Rings
- * @ingroup APR_Util
+ * @defgroup APR_Rings Rings
+ * @ingroup APR
  * @{
  */
 
 /**
  * A ring is a kind of doubly-linked list that can be manipulated
  * without knowing where its head is.
@@ -142,13 +142,13 @@
  *
  * @param hp   The head of the ring
  * @param elem The name of the element struct
  * @param link The name of the APR_RING_ENTRY in the element struct
  */
 #define APR_RING_SENTINEL(hp, elem, link)				\
-    (struct elem *)((char *)(hp) - APR_XtOffsetOf(struct elem, link))
+    (struct elem *)((char *)(hp) - APR_OFFSETOF(struct elem, link))
 
 /**
  * The first element of the ring
  * @param hp   The head of the ring
  */
 #define APR_RING_FIRST(hp)	(hp)->next
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_signal.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_signal.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_signal.h	2002-04-27 13:43:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_signal.h	2002-06-09 04:30:13.000000000 +0800
@@ -59,15 +59,15 @@
  * @brief APR Signal Handling
  */
 
 #include "apr.h"
 #include "apr_pools.h"
 
-#define APR_WANT_SIGNAL
-#include "apr_want.h"
-
+#if APR_HAVE_SIGNAL_H
+#include <signal.h>
+#endif
 
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
 
 /**
@@ -111,12 +111,15 @@
 
 /**
  * Get the description for a specific signal number
  * @param signum The signal number
  * @return The description of the signal
  */
+APR_DECLARE(const char *) apr_signal_description_get(int signum);
+
+/** @deprecated @see apr_signal_description_get */
 APR_DECLARE(const char *) apr_signal_get_description(int signum);
 
 /**
  * APR-private function for initializing the signal package
  * @internal
  * @param pglobal The internal, global pool
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_strings.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_strings.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_strings.h	2002-03-14 04:39:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_strings.h	2002-05-12 08:56:26.000000000 +0800
@@ -78,12 +78,14 @@
 #ifndef APR_STRINGS_H
 #define APR_STRINGS_H
 
 #include "apr.h"
 #include "apr_errno.h"
 #include "apr_pools.h"
+#define APR_WANT_IOVEC
+#include "apr_want.h"
 
 #if APR_HAVE_STDARG_H
 #include <stdarg.h>
 #endif
 
 #ifdef __cplusplus
@@ -167,12 +169,23 @@
  * @param ... The strings to concatenate.  The final string must be NULL
  * @return The new string
  */
 APR_DECLARE_NONSTD(char *) apr_pstrcat(apr_pool_t *p, ...);
 
 /**
+ * Concatenate multiple strings specified in a writev-style vector
+ * @param p The pool from which to allocate
+ * @param vec The strings to concatenate
+ * @param nvec The number of strings to concatenate
+ * @param nbytes (output) strlen of new string (pass in NULL to omit)
+ * @return The new string
+ */
+APR_DECLARE_NONSTD(char *) apr_pstrcatv(apr_pool_t *p, const struct iovec *vec,
+                                        apr_size_t nvec, apr_size_t *nbytes);
+
+/**
  * printf-style style printing routine.  The data is output to a string 
  * allocated from a pool
  * @param p The pool to allocate out of
  * @param fmt The format of the string
  * @param ap The arguments to use while printing the data
  * @return The new string
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_tables.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_tables.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_tables.h	2002-03-14 04:39:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_tables.h	2002-06-04 05:48:28.000000000 +0800
@@ -142,13 +142,13 @@
  */
 #define apr_table_elts(t) ((const apr_array_header_t *)(t))
 
 /**
  * Determine if the table is empty
  * @param t The table to check
- * @return True if empty, Falso otherwise
+ * @return True if empty, False otherwise
  */
 #define apr_is_empty_table(t) (((t) == NULL) \
                                || (((apr_array_header_t *)(t))->nelts == 0))
 
 /**
  * Create an array
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_thread_mutex.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_thread_mutex.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_thread_mutex.h	2002-04-09 14:56:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_thread_mutex.h	2002-05-30 05:19:44.000000000 +0800
@@ -76,26 +76,31 @@
  */
 
 typedef struct apr_thread_mutex_t apr_thread_mutex_t;
 
 #define APR_THREAD_MUTEX_DEFAULT  0x0
 #define APR_THREAD_MUTEX_NESTED   0x1
+#define APR_THREAD_MUTEX_UNNESTED 0x2
 
 /* Delayed the include to avoid a circular reference */
 #include "apr_pools.h"
 
 /**
  * Create and initialize a mutex that can be used to synchronize threads.
  * @param mutex the memory address where the newly created mutex will be
  *        stored.
  * @param flags Or'ed value of:
  * <PRE>
- *           APR_THREAD_MUTEX_DEFAULT   normal lock behavior (non-recursive).
+ *           APR_THREAD_MUTEX_DEFAULT   platform-optimal lock behavior.
  *           APR_THREAD_MUTEX_NESTED    enable nested (recursive) locks.
+ *           APR_THREAD_MUTEX_UNNESTED  disable nested locks (non-recursive).
  * </PRE>
  * @param pool the pool from which to allocate the mutex.
+ * @tip Be cautious in using APR_THREAD_MUTEX_DEFAULT.  While this is the
+ * most optimial mutex based on a given platform's performance charateristics,
+ * it will behave as either a nested or an unnested lock.
  */
 APR_DECLARE(apr_status_t) apr_thread_mutex_create(apr_thread_mutex_t **mutex,
                                                   unsigned int flags,
                                                   apr_pool_t *pool);
 /**
  * Acquire the lock for the given mutex. If the mutex is already locked,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_time.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_time.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_time.h	2002-04-15 08:01:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_time.h	2002-06-13 06:23:56.000000000 +0800
@@ -92,12 +92,20 @@
 /** short interval for I/O timeouts, in microseconds */
 typedef apr_int32_t apr_short_interval_time_t;
 
 /** number of microseconds per second */
 #define APR_USEC_PER_SEC APR_TIME_C(1000000)
 
+#define apr_time_usec(time) ((apr_int32_t)(time) % APR_USEC_PER_SEC)
+
+#define apr_time_sec(time) ((apr_int64_t)(time) / APR_USEC_PER_SEC)
+
+#define apr_time_from_sec(sec) ((apr_time_t)(sec) * APR_USEC_PER_SEC)
+
+#define apr_time_make(sec, usec) ((apr_time_t)(sec) * APR_USEC_PER_SEC \
+                                + (apr_time_t)(usec))
 
 /**
  * return the current time
  */
 APR_DECLARE(apr_time_t) apr_time_now(void);
 
@@ -150,12 +158,17 @@
  * @param zone the zone description
  */
 APR_DECLARE(apr_status_t) apr_time_exp_tz(apr_time_exp_t *result,
                                           apr_time_t input,
                                           apr_int32_t offs);
 
+/** @deprecated @see apr_time_exp_tz */
+APR_DECLARE(apr_status_t) apr_explode_time(apr_time_exp_t *result,
+                                           apr_time_t input,
+                                           apr_int32_t offs);
+
 /**
  * convert a time to its human readable components in GMT timezone
  * @param result the exploded time
  * @param input the time to explode
  */
 APR_DECLARE(apr_status_t) apr_time_exp_gmt(apr_time_exp_t *result, 
@@ -164,12 +177,16 @@
 /**
  * convert a time to its human readable components in local timezone
  * @param result the exploded time
  * @param input the time to explode
  */
 APR_DECLARE(apr_status_t) apr_time_exp_lt(apr_time_exp_t *result, 
+                                          apr_time_t input);
+
+/** @deprecated @see apr_time_exp_lt */
+APR_DECLARE(apr_status_t) apr_explode_localtime(apr_time_exp_t *result, 
                                                 apr_time_t input);
 
 /**
  * Convert time value from human readable format to a numeric apr_time_t 
  * e.g. elapsed usec since epoch
  * @param result the resulting imploded time
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_user.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_user.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_user.h	2002-04-22 18:24:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_user.h	2002-06-09 06:09:50.000000000 +0800
@@ -151,13 +151,18 @@
  * Get the group name for a specified groupid
  * @param groupname Pointer to new string containing group name (on output)
  * @param groupid The groupid
  * @param p The pool from which to allocate the string
  * @remark This function is available only if APR_HAS_USER is defined.
  */
-APR_DECLARE(apr_status_t) apr_group_name_get(char **groupname, apr_gid_t groupid, apr_pool_t *p);
+APR_DECLARE(apr_status_t) apr_group_name_get(char **groupname, 
+                                             apr_gid_t groupid, apr_pool_t *p);
+
+/** @deprecated @see apr_group_name_get */
+APR_DECLARE(apr_status_t) apr_get_groupname(char **groupname, 
+                                            apr_gid_t groupid, apr_pool_t *p);
 
 /**
  * Get the groupid for a specified group name
  * @param groupid Pointer to the group id (on output)
  * @param groupname The group name to look up
  * @param p The pool from which to allocate the string
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_version.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_version.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_version.h	2002-04-22 16:44:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_version.h	2002-05-10 19:15:51.000000000 +0800
@@ -73,46 +73,34 @@
  * being used for its actual version.
  *
  * Note that it is possible for an application to detect that it has been
  * compiled against a different version of APR by use of the compile-time
  * constants and the use of the run-time query function.
  *
- * ### we have not defined source/binary compatibility guidelines yet and
- * ### how those map against these (release) version numbers. a strawman
- * ### would be the following text:
+ * APR version numbering follows the guidelines specified in:
  *
- * APR is binary-compatible (an app compiled against one version does not
- * need to be recompiled to work against another version) for the same
- * MAJOR and MINOR versions.
- *
- * APR is source-compatible (an app needs to be recompiled, but will work
- * the same) for the same MAJOR version.
- *
- * If the MAJOR version changes, then an application may need source changes.
- *
- * Note that APR is defined to be forward compatible only, meaning that a
- * given application will be compatible with APR releases moving forward in
- * time. An application may not be compatible with earlier versions of an
- * APR library (even if the major and minor versions match). This restriction
- * is because a later version of APR can introduce new APIs.
+ *     http://apr.apache.org/versioning.html
  */
 
 /* The numeric compile-time version constants. These constants are the
  * authoritative version numbers for APR. 
  */
+
 /** major version 
- * Major API changes that could cause compatibility problems for older programs 
- * such as structure size changes.  No binary compatibility is possible across
- * a change in the major version.
+ * Major API changes that could cause compatibility problems for older
+ * programs such as structure size changes.  No binary compatibility is
+ * possible across a change in the major version.
  */
 #define APR_MAJOR_VERSION       0
+
 /** 
  * Minor API changes that do not cause binary compatibility problems.
  * Should be reset to 0 when upgrading APR_MAJOR_VERSION
  */
 #define APR_MINOR_VERSION       9
+
 /** patch level */
 #define APR_PATCH_VERSION       0
 
 
 /** 
  *  This symbol is defined for internal, "development" copies of APR. This
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_want.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_want.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_want.h	2002-03-14 04:39:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_want.h	2002-04-30 09:25:38.000000000 +0800
@@ -61,13 +61,12 @@
  * Features:
  *
  *   APR_WANT_STRFUNC:  strcmp, strcat, strcpy, etc
  *   APR_WANT_MEMFUNC:  memcmp, memcpy, etc
  *   APR_WANT_STDIO:    <stdio.h> and related bits
  *   APR_WANT_IOVEC:    struct iovec
- *   APR_WANT_SIGNAL:   signal numbers, functions, and types
  *   APR_WANT_BYTEFUNC: htons, htonl, ntohl, ntohs
  *
  * Typical usage:
  *
  *   #define APR_WANT_STRFUNC
  *   #define APR_WANT_MEMFUNC
@@ -126,24 +125,12 @@
 
 #undef APR_WANT_IOVEC
 #endif
 
 /* --------------------------------------------------------------------- */
 
-#ifdef APR_WANT_SIGNAL
-
-#if APR_HAVE_SIGNAL_H
-#include <signal.h>
-#endif
-/* ### some platforms may put this into unistd.h ?? */
-
-#undef APR_WANT_SIGNAL
-#endif
-
-/* --------------------------------------------------------------------- */
-
 #ifdef APR_WANT_BYTEFUNC
 
 /* Single Unix says they are in arpa/inet.h.  Linux has them in
  * netinet/in.h.  FreeBSD has them in arpa/inet.h but requires that
  * netinet/in.h be included first.
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_xlate.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_xlate.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/apr_xlate.h	2002-03-14 04:39:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/apr_xlate.h	2002-06-09 06:09:50.000000000 +0800
@@ -79,13 +79,12 @@
  * apr_xlate_open() et al are provided. 
  *
  * If APR_HAS_XLATE is zero, apr_xlate_open() et al will all return 
  * APR_ENOTIMPL at run-time.
  */
 
-#if APR_HAS_XLATE
 typedef struct apr_xlate_t            apr_xlate_t;
 
 /**
  * Set up for converting text from one charset to another.
  * @param convset The handle to be filled in by this function
  * @param topage The name of the target charset
@@ -127,12 +126,15 @@
 /**
  * Find out whether or not the specified conversion is single-byte-only.
  * @param convset The handle allocated by apr_xlate_open, specifying the 
  *                parameters of conversion
  * @param onoff Output: whether or not the conversion is single-byte-only
  */
+APR_DECLARE(apr_status_t) apr_xlate_sb_get(apr_xlate_t *convset, int *onoff);
+
+/** @deprecated @see apr_xlate_sb_get */
 APR_DECLARE(apr_status_t) apr_xlate_get_sb(apr_xlate_t *convset, int *onoff);
 
 /**
  * Convert a buffer of text from one codepage to another.
  * @param convset The handle allocated by apr_xlate_open, specifying 
  *                the parameters of conversion
@@ -178,44 +180,12 @@
 /**
  * Close a codepage translation handle.
  * @param convset The codepage translation handle to close
  */
 APR_DECLARE(apr_status_t) apr_xlate_close(apr_xlate_t *convset);
 
-#else
-/** 
- * handle for the Translation routines
- * (currently not implemented)
- */
-typedef void                         apr_xlate_t;
-
-/**
- * For platforms where we don't bother with translating between charsets,
- * these are macros which always return failure.
- */
-
-#define apr_xlate_open(convset, topage, frompage, pool) APR_ENOTIMPL
-
-#define apr_xlate_get_sb(convset, onoff) APR_ENOTIMPL
-
-#define apr_xlate_conv_buffer(convset, inbuf, inbytes_left, outbuf, \
-                              outbytes_left) APR_ENOTIMPL
-
-#define apr_xlate_conv_byte(convset, inchar) (-1)
-
-/**
- * The purpose of apr_xlate_conv_char is to translate one character
- * at a time.  This needs to be written carefully so that it works
- * with double-byte character sets. 
- */
-#define apr_xlate_conv_char(convset, inchar, outchar) APR_ENOTIMPL
-
-#define apr_xlate_close(convset) APR_ENOTIMPL
-
-#endif  /* ! APR_HAS_XLATE */
-
 /** @} */
 #ifdef __cplusplus
 }
 #endif
 
 #endif  /* ! APR_XLATE_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/netware/fileio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/netware/fileio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/netware/fileio.h	2002-03-20 16:54:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/netware/fileio.h	2002-06-04 02:52:46.000000000 +0800
@@ -109,13 +109,13 @@
 struct apr_file_t {
     apr_pool_t *pool;
     int filedes;
     char *fname;
     apr_int32_t flags;
     int eof_hit;
-    int pipe;
+    int is_pipe;
     apr_interval_time_t timeout;
     int buffered;
     enum {BLK_UNKNOWN, BLK_OFF, BLK_ON } blocking;
     int ungetchar;    /* Last char provided by an unget op. (-1 = no char)*/
 
     /* Stuff for buffered mode */
@@ -159,10 +159,9 @@
 /* This function compares the drive/volume specifiers for each given path.
  * It returns zero if they match or non-zero if not. 
  */
 apr_status_t filepath_compare_drive(const char *path1, const char *path2, apr_pool_t *p);
 
 apr_status_t apr_unix_file_cleanup(void *);
-apr_status_t apr_netware_pipe_cleanup(void *thefile);
 
 #endif  /* ! FILE_IO_H */
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix: apr_private.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/apr_private.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/apr_private.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/apr_private.h.in	2002-05-02 04:52:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/apr_private.h.in	2002-06-18 11:46:26.000000000 +0800
@@ -22,12 +22,17 @@
 #undef USE_FLOCK_SERIALIZE
 #undef USE_SYSVSEM_SERIALIZE
 #undef USE_FCNTL_SERIALIZE
 #undef USE_PROC_PTHREAD_SERIALIZE
 #undef USE_PTHREAD_SERIALIZE
 
+#undef POSIXSEM_IS_GLOBAL
+#undef SYSVSEM_IS_GLOBAL
+#undef FCNTL_IS_GLOBAL
+#undef FLOCK_IS_GLOBAL
+
 #undef READDIR_IS_THREAD_SAFE
 #undef GETHOSTBYNAME_IS_THREAD_SAFE
 #undef GETHOSTBYADDR_IS_THREAD_SAFE
 #undef STRERROR_R_RC_INT
 
 #undef HAVE_GMTOFF
@@ -52,12 +57,18 @@
 #undef HAVE_TCP_NOPUSH
 
 
 /* Define if the inbuf parm to iconv() is const char ** */
 #undef APR_ICONV_INBUF_CONST
 
+/* Define if crypt_r has uses CRYPTD */
+#undef CRYPT_R_CRYPTD
+
+/* Define if crypt_r uses struct crypt_data */
+#undef CRYPT_R_STRUCT_CRYPT_DATA
+
 /* Define if gethostbyname_r has the glibc style */
 #undef GETHOSTBYNAME_R_GLIBC2
 
 /* Define if gethostbyname_r has the hostent_data for the third argument */
 #undef GETHOSTBYNAME_R_HOSTENT_DATA
 
@@ -76,12 +87,15 @@
 /* Define to 1 if you have the `create_area' function. */
 #undef HAVE_CREATE_AREA
 
 /* Define to 1 if you have the <crypt.h> header file. */
 #undef HAVE_CRYPT_H
 
+/* Define to 1 if you have the `crypt_r' function. */
+#undef HAVE_CRYPT_R
+
 /* Define to 1 if you have the <ctype.h> header file. */
 #undef HAVE_CTYPE_H
 
 /* Define to 1 if you have the <dirent.h> header file. */
 #undef HAVE_DIRENT_H
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/fileio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/fileio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/fileio.h	2002-03-20 16:54:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/fileio.h	2002-06-01 00:18:38.000000000 +0800
@@ -104,31 +104,31 @@
 #endif
 #ifdef BEOS
 #include <kernel/OS.h>
 #endif
 
 #if BEOS_BONE
- #ifndef BONE7
+# ifndef BONE7
   /* prior to BONE/7 fd_set & select were defined in sys/socket.h */
-  #include <sys/socket.h>
- #else
+#  include <sys/socket.h>
+# else
   /* Be moved the fd_set stuff and also the FIONBIO definition... */
-  #include <sys/ioctl.h>
- #endif
+#  include <sys/ioctl.h>
+# endif
 #endif
 /* End System headers */
 
 #define APR_FILE_BUFSIZE 4096
 
 struct apr_file_t {
     apr_pool_t *pool;
     int filedes;
     char *fname;
     apr_int32_t flags;
     int eof_hit;
-    int pipe;
+    int is_pipe;
     apr_interval_time_t timeout;
     int buffered;
     enum {BLK_UNKNOWN, BLK_OFF, BLK_ON } blocking;
     int ungetchar;    /* Last char provided by an unget op. (-1 = no char)*/
 
     /* Stuff for buffered mode */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/inherit.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/inherit.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/inherit.h	2002-03-14 04:39:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/inherit.h	2002-06-09 06:32:11.000000000 +0800
@@ -56,27 +56,37 @@
 #define INHERIT_H
 
 #include "apr_inherit.h"
 
 #define APR_INHERIT    (2^24)    /* Must not conflicts with other bits */
 
-#define APR_IMPLEMENT_SET_INHERIT(name, flag, pool, cleanup)        \
-void apr_##name##_set_inherit(apr_##name##_t *name)                 \
+#define APR_IMPLEMENT_INHERIT_SET(name, flag, pool, cleanup)        \
+void apr_##name##_inherit_set(apr_##name##_t *name)                 \
 {                                                                   \
     if (!(name->flag & APR_INHERIT)) {                              \
         name->flag |= APR_INHERIT;                                  \
         apr_pool_child_cleanup_set(name->pool, (void *)name,        \
                                    cleanup, apr_pool_cleanup_null); \
     }                                                               \
+}                                                                   \
+/* Deprecated */                                                    \
+void apr_##name##_set_inherit(apr_##name##_t *name)                 \
+{                                                                   \
+    apr_##name##_inherit_set(name);                                 \
 }
 
-#define APR_IMPLEMENT_UNSET_INHERIT(name, flag, pool, cleanup)      \
-void apr_##name##_unset_inherit(apr_##name##_t *name)               \
+#define APR_IMPLEMENT_INHERIT_UNSET(name, flag, pool, cleanup)      \
+void apr_##name##_inherit_unset(apr_##name##_t *name)               \
 {                                                                   \
     if (name->flag & APR_INHERIT) {                                 \
         name->flag &= ~APR_INHERIT;                                 \
         apr_pool_child_cleanup_set(name->pool, (void *)name,        \
                                    cleanup, cleanup);               \
     }                                                               \
+}                                                                   \
+/* Deprecated */                                                    \
+void apr_##name##_unset_inherit(apr_##name##_t *name)               \
+{                                                                   \
+    apr_##name##_inherit_unset(name);                               \
 }
 
 #endif	/* ! INHERIT_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/proc_mutex.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/proc_mutex.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/unix/proc_mutex.h	2002-04-09 14:56:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/unix/proc_mutex.h	2002-06-07 22:04:34.000000000 +0800
@@ -73,12 +73,15 @@
 #include <stdio.h>
 #endif
 #if APR_HAVE_FCNTL_H
 #include <fcntl.h>
 #endif
 
+#ifdef HAVE_SYS_IPC_H
+#include <sys/ipc.h>
+#endif
 #ifdef HAVE_SYS_SEM_H
 #include <sys/sem.h>
 #endif
 #ifdef HAVE_SYS_FILE_H
 #include <sys/file.h>
 #endif
@@ -107,12 +110,13 @@
     apr_status_t (*create)(apr_proc_mutex_t *, const char *);
     apr_status_t (*acquire)(apr_proc_mutex_t *);
     apr_status_t (*tryacquire)(apr_proc_mutex_t *);
     apr_status_t (*release)(apr_proc_mutex_t *);
     apr_status_t (*destroy)(apr_proc_mutex_t *);
     apr_status_t (*child_init)(apr_proc_mutex_t **, apr_pool_t *, const char *);
+    const char *name;
 };
 typedef struct apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_lock_methods_t;
 
 /* bit values for flags field in apr_unix_lock_methods_t */
 #define APR_PROCESS_LOCK_MECH_IS_GLOBAL          1
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/win32: inherit.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/win32/networkio.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/win32/networkio.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/win32/networkio.h	2002-04-01 22:13:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/win32/networkio.h	2002-06-06 10:58:16.000000000 +0800
@@ -75,18 +75,36 @@
 struct apr_pollfd_t {
     apr_pool_t *cntxt;
     fd_set *read;
     int numread;
     fd_set *write;
     int numwrite;
-    fd_set *except;
+    fd_set *exception;
     int numexcept;    
 };
 
+#ifdef _WIN32_WCE
+#ifndef WSABUF
+typedef struct _WSABUF {
+    u_long      len;     /* the length of the buffer */
+    char FAR *  buf;     /* the pointer to the buffer */
+} WSABUF, FAR * LPWSABUF;
+#endif
+#endif
+
 apr_status_t status_from_res_error(int);
 
 const char *apr_inet_ntop(int af, const void *src, char *dst, apr_size_t size);
 int apr_inet_pton(int af, const char *src, void *dst);
 void apr_sockaddr_vars_set(apr_sockaddr_t *, int, apr_port_t);
 
+#define apr_is_option_set(mask, option)  ((mask & option) ==option)
+#define apr_set_option(mask, option, on) \
+    do {                                 \
+        if (on)                          \
+            *mask |= option;             \
+        else                             \
+            *mask &= ~option;            \
+    } while (0)
+
 #endif  /* ! NETWORK_IO_H */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/win32/thread_mutex.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/win32/thread_mutex.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/include/arch/win32/thread_mutex.h	2002-04-09 14:56:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/include/arch/win32/thread_mutex.h	2002-05-30 05:19:44.000000000 +0800
@@ -54,13 +54,25 @@
 
 #ifndef THREAD_MUTEX_H
 #define THREAD_MUTEX_H
 
 #include "apr_pools.h"
 
+typedef enum thread_mutex_type {
+    thread_mutex_critical_section,
+    thread_mutex_unnested_event,
+    thread_mutex_nested_mutex
+} thread_mutex_type;
+
+/* handle applies only to unnested_event on all platforms 
+ * and nested_mutex on Win9x only.  Otherwise critical_section 
+ * is used for NT nexted mutexes providing optimal performance.
+ */
 struct apr_thread_mutex_t {
-    apr_pool_t *pool;
-    CRITICAL_SECTION section;
+    apr_pool_t       *pool;
+    thread_mutex_type type;
+    HANDLE            handle;
+    CRITICAL_SECTION  section;
 };
 
 #endif  /* THREAD_MUTEX_H */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/libapr.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/libapr.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/libapr.dsp	2002-04-29 23:51:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/libapr.dsp	2002-06-09 06:19:50.000000000 +0800
@@ -165,13 +165,12 @@
 
 SOURCE=.\i18n\unix\utf8_ucs2.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\i18n\unix\xlate.c
-# PROP Exclude_From_Build 1
 # End Source File
 # End Group
 # Begin Group "locks"
 
 # PROP Default_Filter ""
 # Begin Source File
@@ -240,12 +239,16 @@
 SOURCE=.\misc\win32\start.c
 # End Source File
 # Begin Source File
 
 SOURCE=.\misc\unix\uuid.c
 # End Source File
+# Begin Source File
+
+SOURCE=.\misc\unix\version.c
+# End Source File
 # End Group
 # Begin Group "mmap"
 
 # PROP Default_Filter ""
 # Begin Source File
 
@@ -424,13 +427,13 @@
 # Begin Source File
 
 SOURCE=.\include\arch\unix\i18n.h
 # End Source File
 # Begin Source File
 
-SOURCE=.\include\arch\unix\inherit.h
+SOURCE=.\include\arch\win32\inherit.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\arch\win32\misc.h
 # End Source File
 # Begin Source File
@@ -466,29 +469,27 @@
 # Begin Source File
 
 SOURCE=.\include\apr.hw
 
 !IF  "$(CFG)" == "libapr - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apr.h from apr.hw 
 InputPath=.\include\apr.hw
 
 ".\include\apr.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apr.hw .\include\apr.h > nul 
-	echo Created apr.h from apr.hw 
+	type .\include\apr.hw > .\include\apr.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libapr - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apr.h from apr.hw 
 InputPath=.\include\apr.hw
 
 ".\include\apr.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apr.hw .\include\apr.h > nul 
-	echo Created apr.h from apr.hw 
+	type .\include\apr.hw > .\include\apr.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Binary files /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/libaprnw.mcp.zip and /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/libaprnw.mcp.zip differ
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: libtool
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/beos/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/beos/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/beos/proc_mutex.c	2002-03-14 04:39:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/beos/proc_mutex.c	2002-06-07 22:04:34.000000000 +0800
@@ -154,12 +154,22 @@
         apr_pool_cleanup_kill(mutex->pool, mutex, _proc_mutex_cleanup);
         return APR_SUCCESS;
     }
     return stat;
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex)
+{
+    return "beossem";
+}
+
+APR_DECLARE(const char *) apr_proc_mutex_defname(void)
+{
+    return "beossem";
+}
+
 APR_POOL_IMPLEMENT_ACCESSOR(proc_mutex)
 
 /* Implement OS-specific accessors defined in apr_portable.h */
 
 APR_DECLARE(apr_status_t) apr_os_proc_mutex_get(apr_os_proc_mutex_t *ospmutex,
                                                 apr_proc_mutex_t *pmutex)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/beos/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/beos/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/beos/thread_mutex.c	2002-03-14 04:39:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/beos/thread_mutex.c	2002-05-30 05:19:44.000000000 +0800
@@ -93,12 +93,16 @@
         _thread_mutex_cleanup(new_m);
         return stat;
     }
     new_m->LockCount = 0;
     new_m->Lock = stat;  
     new_m->pool  = pool;
+
+    /* Optimal default is APR_THREAD_MUTEX_UNNESTED, 
+     * no additional checks required for either flag.
+     */
     new_m->nested = flags & APR_THREAD_MUTEX_NESTED;
 
     apr_pool_cleanup_register(new_m->pool, (void *)new_m, _thread_mutex_cleanup,
                               apr_pool_cleanup_null);
 
     (*mutex) = new_m;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/netware/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/netware/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/netware/proc_mutex.c	2002-03-14 04:39:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/netware/proc_mutex.c	2002-06-07 22:04:34.000000000 +0800
@@ -112,12 +112,22 @@
 {
     if (mutex)
         return apr_thread_mutex_destroy(mutex->mutex);
     return APR_ENOLOCK;
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex)
+{
+    return "netwarethread";
+}
+
+APR_DECLARE(const char *) apr_proc_mutex_defname(void)
+{
+    return "netwarethread";
+}
+
 APR_POOL_IMPLEMENT_ACCESSOR(proc_mutex)
 
 /* Implement OS-specific accessors defined in apr_portable.h */
 
 apr_status_t apr_os_proc_mutex_get(apr_os_proc_mutex_t *ospmutex,
                                    apr_proc_mutex_t *pmutex)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/netware/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/netware/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/netware/thread_mutex.c	2002-03-14 04:39:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/netware/thread_mutex.c	2002-05-30 05:19:44.000000000 +0800
@@ -70,20 +70,24 @@
 APR_DECLARE(apr_status_t) apr_thread_mutex_create(apr_thread_mutex_t **mutex,
                                                   unsigned int flags,
                                                   apr_pool_t *pool)
 {
     apr_thread_mutex_t *new_mutex = NULL;
 
+    /* XXX: Implement _UNNESTED flavor and favor _DEFAULT for performance
+     */
+    if (flags & APR_THREAD_MUTEX_UNNESTED) {
+        return APR_ENOTIMPL;
+    }
     new_mutex = (apr_thread_mutex_t *)apr_pcalloc(pool, sizeof(apr_thread_mutex_t));
 	
 	if(new_mutex ==NULL) {
         return APR_ENOMEM;
     }     
     new_mutex->pool = pool;
 
-    /* FIXME: only use recursive locks if (flags & APR_THREAD_MUTEX_NESTED) */
     new_mutex->mutex = NXMutexAlloc(NX_MUTEX_RECURSIVE, NULL, NULL);
     
     if(new_mutex->mutex == NULL)
         return APR_ENOMEM;
 
     apr_pool_cleanup_register(new_mutex->pool, new_mutex, 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/os2/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/os2/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/os2/proc_mutex.c	2002-03-14 04:39:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/os2/proc_mutex.c	2002-06-07 22:04:34.000000000 +0800
@@ -90,12 +90,21 @@
 static apr_status_t proc_mutex_cleanup(void *vmutex)
 {
     apr_proc_mutex_t *mutex = vmutex;
     return apr_proc_mutex_destroy(mutex);
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex)
+{
+    return "os2sem";
+}
+
+APR_DECLARE(const char *) apr_proc_mutex_defname(void)
+{
+    return "os2sem";
+}
 
 
 APR_DECLARE(apr_status_t) apr_proc_mutex_create(apr_proc_mutex_t **mutex,
                                                 const char *fname,
                                                 apr_lockmech_e mech,
                                                 apr_pool_t *pool)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/os2/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/os2/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/os2/thread_mutex.c	2002-03-14 04:39:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/os2/thread_mutex.c	2002-05-30 05:19:44.000000000 +0800
@@ -66,12 +66,15 @@
     apr_thread_mutex_t *mutex = themutex;
     return apr_thread_mutex_destroy(mutex);
 }
 
 
 
+/* XXX: Need to respect APR_THREAD_MUTEX_[UN]NESTED flags argument
+ *      or return APR_ENOTIMPL!!!
+ */
 APR_DECLARE(apr_status_t) apr_thread_mutex_create(apr_thread_mutex_t **mutex,
                                                   unsigned int flags,
                                                   apr_pool_t *pool)
 {
     apr_thread_mutex_t *new_mutex;
     ULONG rc;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/global_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/global_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/global_mutex.c	2002-03-14 04:39:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/global_mutex.c	2002-05-08 21:30:11.000000000 +0800
@@ -54,12 +54,13 @@
 
 #include "apr.h"
 #include "apr_strings.h"
 #include "global_mutex.h"
 #include "apr_proc_mutex.h"
 #include "apr_thread_mutex.h"
+#include "apr_portable.h"
 
 static apr_status_t global_mutex_cleanup(void *data)
 {
     apr_global_mutex_t *m = (apr_global_mutex_t *)data;
     apr_status_t rv;
 
@@ -175,12 +176,23 @@
         }
     }
 #endif /* APR_HAS_THREADS */
     return APR_SUCCESS;
 }
 
+APR_DECLARE(apr_status_t) apr_os_global_mutex_get(apr_os_global_mutex_t *ospmutex,
+                                                apr_global_mutex_t *pmutex)
+{
+    ospmutex->pool = pmutex->pool;
+    ospmutex->proc_mutex = pmutex->proc_mutex;
+#if APR_HAS_THREADS
+    ospmutex->thread_mutex = pmutex->thread_mutex;
+#endif
+    return APR_SUCCESS;
+}
+
 APR_DECLARE(apr_status_t) apr_global_mutex_destroy(apr_global_mutex_t *mutex)
 {
     return apr_pool_cleanup_run(mutex->pool, mutex, global_mutex_cleanup);
 }
 
 APR_POOL_IMPLEMENT_ACCESSOR(global_mutex)
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/proc_mutex.c	2002-04-09 14:56:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/proc_mutex.c	2002-06-07 22:04:34.000000000 +0800
@@ -164,23 +164,24 @@
 {
     return APR_SUCCESS;
 }
 
 const apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_posix_methods =
 {
-#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS
+#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS || defined(POSIXSEM_IS_GLOBAL)
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_posix_create,
     proc_mutex_posix_acquire,
     NULL, /* no tryacquire */
     proc_mutex_posix_release,
     proc_mutex_posix_destroy,
-    proc_mutex_posix_child_init
+    proc_mutex_posix_child_init,
+    "posixsem"
 };
 
 #endif /* Posix sem implementation */
 
 #if APR_HAS_SYSVSEM_SERIALIZE
 
@@ -279,23 +280,24 @@
 {
     return APR_SUCCESS;
 }
 
 const apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_sysv_methods =
 {
-#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS
+#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS || defined(SYSVSEM_IS_GLOBAL)
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_sysv_create,
     proc_mutex_sysv_acquire,
     NULL, /* no tryacquire */
     proc_mutex_sysv_release,
     proc_mutex_sysv_destroy,
-    proc_mutex_sysv_child_init
+    proc_mutex_sysv_child_init,
+    "sysvsem"
 };
 
 #endif /* SysV sem implementation */
 
 #if APR_HAS_PROC_PTHREAD_SERIALIZE
 
@@ -463,13 +465,14 @@
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
     proc_mutex_proc_pthread_create,
     proc_mutex_proc_pthread_acquire,
     NULL, /* no tryacquire */
     proc_mutex_proc_pthread_release,
     proc_mutex_proc_pthread_destroy,
-    proc_mutex_proc_pthread_child_init
+    proc_mutex_proc_pthread_child_init,
+    "pthread"
 };
 
 #endif
 
 #if APR_HAS_FCNTL_SERIALIZE
 
@@ -588,23 +591,24 @@
 {
     return APR_SUCCESS;
 }
 
 const apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_fcntl_methods =
 {
-#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS
+#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS || defined(FCNTL_IS_GLOBAL)
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_fcntl_create,
     proc_mutex_fcntl_acquire,
     NULL, /* no tryacquire */
     proc_mutex_fcntl_release,
     proc_mutex_fcntl_destroy,
-    proc_mutex_fcntl_child_init
+    proc_mutex_fcntl_child_init,
+    "fcntl"
 };
 
 #endif /* fcntl implementation */
 
 #if APR_HAS_FLOCK_SERIALIZE
 
@@ -717,23 +721,24 @@
     *mutex = new_mutex;
     return APR_SUCCESS;
 }
 
 const apr_proc_mutex_unix_lock_methods_t apr_proc_mutex_unix_flock_methods =
 {
-#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS
+#if APR_PROCESS_LOCK_IS_GLOBAL || !APR_HAS_THREADS || defined(FLOCK_IS_GLOBAL)
     APR_PROCESS_LOCK_MECH_IS_GLOBAL,
 #else
     0,
 #endif
     proc_mutex_flock_create,
     proc_mutex_flock_acquire,
     NULL, /* no tryacquire */
     proc_mutex_flock_release,
     proc_mutex_flock_destroy,
-    proc_mutex_flock_child_init
+    proc_mutex_flock_child_init,
+    "flock"
 };
 
 #endif /* flock implementation */
 
 void apr_proc_mutex_unix_setup_lock(void)
 {
@@ -810,12 +815,25 @@
     default:
         return APR_ENOTIMPL;
     }
     return APR_SUCCESS;
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_defname(void)
+{
+    apr_status_t rv;
+    apr_proc_mutex_t mutex;
+
+    if ((rv = proc_mutex_choose_method(&mutex, APR_LOCK_DEFAULT)) != APR_SUCCESS) {
+        return "unknown";
+    }
+    mutex.meth = mutex.inter_meth;
+
+    return apr_proc_mutex_name(&mutex);
+}
+   
 static apr_status_t proc_mutex_create(apr_proc_mutex_t *new_mutex, apr_lockmech_e mech, const char *fname)
 {
     apr_status_t rv;
 
     if ((rv = proc_mutex_choose_method(new_mutex, mech)) != APR_SUCCESS) {
         return rv;
@@ -932,12 +950,17 @@
 
 APR_DECLARE(apr_status_t) apr_proc_mutex_destroy(apr_proc_mutex_t *mutex)
 {
     return mutex->meth->destroy(mutex);
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex)
+{
+    return mutex->meth->name;
+}
+
 APR_POOL_IMPLEMENT_ACCESSOR(proc_mutex)
 
 /* Implement OS-specific accessors defined in apr_portable.h */
 
 APR_DECLARE(apr_status_t) apr_os_proc_mutex_get(apr_os_proc_mutex_t *ospmutex,
                                                 apr_proc_mutex_t *pmutex)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/unix/thread_mutex.c	2002-04-28 11:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/unix/thread_mutex.c	2002-05-30 05:19:44.000000000 +0800
@@ -86,12 +86,16 @@
 
     if (new_mutex == NULL) {
         return APR_ENOMEM;
     }
 
     new_mutex->pool = pool;
+
+    /* Optimal default is APR_THREAD_MUTEX_UNNESTED, 
+     * no additional checks required for either flag.
+     */
     new_mutex->nested = flags & APR_THREAD_MUTEX_NESTED;
 
     if ((rv = pthread_mutexattr_init(&mattr))) {
 #ifdef PTHREAD_SETS_ERRNO
         rv = errno;
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/win32/proc_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/win32/proc_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/win32/proc_mutex.c	2002-03-14 04:39:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/win32/proc_mutex.c	2002-06-07 22:04:34.000000000 +0800
@@ -173,12 +173,22 @@
     if (stat == APR_SUCCESS) {
         apr_pool_cleanup_kill(mutex->pool, mutex, proc_mutex_cleanup);
     }
     return stat;
 }
 
+APR_DECLARE(const char *) apr_proc_mutex_name(apr_proc_mutex_t *mutex)
+{
+    return "win32mutex";
+}
+
+APR_DECLARE(const char *) apr_proc_mutex_defname(void)
+{
+    return "win32mutex";
+}
+
 APR_POOL_IMPLEMENT_ACCESSOR(proc_mutex)
 
 /* Implement OS-specific accessors defined in apr_portable.h */
 
 APR_DECLARE(apr_status_t) apr_os_proc_mutex_get(apr_os_proc_mutex_t *ospmutex,
                                                 apr_proc_mutex_t *mutex)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/win32/thread_mutex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/win32/thread_mutex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/locks/win32/thread_mutex.c	2002-03-14 04:39:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/locks/win32/thread_mutex.c	2002-05-30 05:19:44.000000000 +0800
@@ -62,51 +62,108 @@
 #include "misc.h"
 
 static apr_status_t thread_mutex_cleanup(void *data)
 {
     apr_thread_mutex_t *lock = data;
 
-    DeleteCriticalSection(&lock->section);
+    if (lock->type == thread_mutex_critical_section) {
+        DeleteCriticalSection(&lock->section);
+    }
+    else {
+        if (!CloseHandle(lock->handle)) {
+            return apr_get_os_error();
+        }
+    }
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_create(apr_thread_mutex_t **mutex,
                                                   unsigned int flags,
                                                   apr_pool_t *pool)
 {
     (*mutex) = (apr_thread_mutex_t *)apr_palloc(pool, sizeof(**mutex));
 
     (*mutex)->pool = pool;
-    /* FIXME: Implement nested (aka recursive) locks or use a native
-     * win32 implementation if available. */
-    InitializeCriticalSection(&(*mutex)->section);
+
+    if (flags & APR_THREAD_MUTEX_UNNESTED) {
+        /* Use an auto-reset signaled event, ready to accept one
+         * waiting thread.
+         */
+        (*mutex)->type = thread_mutex_unnested_event;
+        (*mutex)->handle = CreateEvent(NULL, FALSE, TRUE, NULL);
+    }
+    else {
+#if APR_HAS_UNICODE_FS
+        /* Critical Sections are terrific, performance-wise, on NT.
+         * On Win9x, we cannot 'try' on a critical section, so we 
+         * use a [slower] mutex object, instead.
+         */
+        IF_WIN_OS_IS_UNICODE {
+            (*mutex)->type = thread_mutex_critical_section;
+            InitializeCriticalSection(&(*mutex)->section);
+        }
+#endif
+#if APR_HAS_ANSI_FS
+        ELSE_WIN_OS_IS_ANSI {
+            (*mutex)->type = thread_mutex_nested_mutex;
+            (*mutex)->handle = CreateMutex(NULL, FALSE, NULL);
+
+        }
+#endif
+    }
+
     apr_pool_cleanup_register((*mutex)->pool, (*mutex), thread_mutex_cleanup,
                               apr_pool_cleanup_null);
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_lock(apr_thread_mutex_t *mutex)
 {
-    EnterCriticalSection(&mutex->section);
+    if (mutex->type == thread_mutex_critical_section) {
+        EnterCriticalSection(&mutex->section);
+    }
+    else {
+        DWORD rv = WaitForSingleObject(mutex->handle, INFINITE);
+	if ((rv != WAIT_OBJECT_0) && (rv != WAIT_ABANDONED)) {
+            return (rv == WAIT_TIMEOUT) ? APR_EBUSY : apr_get_os_error();
+	}
+    }        
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_trylock(apr_thread_mutex_t *mutex)
 {
-    if (apr_os_level < APR_WIN_NT) {
-        return APR_ENOTIMPL;
-    }
-    if (TryEnterCriticalSection(&mutex->section)) {
-        return APR_SUCCESS;
+    if (mutex->type == thread_mutex_critical_section) {
+        if (!TryEnterCriticalSection(&mutex->section)) {
+            return APR_EBUSY;
+        }
     }
-    return APR_EBUSY;
+    else {
+        DWORD rv = WaitForSingleObject(mutex->handle, 0);
+	if ((rv != WAIT_OBJECT_0) && (rv != WAIT_ABANDONED)) {
+            return (rv == WAIT_TIMEOUT) ? APR_EBUSY : apr_get_os_error();
+	}
+    }        
+    return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_unlock(apr_thread_mutex_t *mutex)
 {
-    LeaveCriticalSection(&mutex->section);
+    if (mutex->type == thread_mutex_critical_section) {
+        LeaveCriticalSection(&mutex->section);
+    }
+    else if (mutex->type == thread_mutex_unnested_event) {
+        if (!SetEvent(mutex->handle)) {
+            return apr_get_os_error();
+        }
+    }
+    else if (mutex->type == thread_mutex_nested_mutex) {
+        if (!ReleaseMutex(mutex->handle)) {
+            return apr_get_os_error();
+        }
+    }
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_thread_mutex_destroy(apr_thread_mutex_t *mutex)
 {
     return apr_pool_cleanup_run(mutex->pool, mutex, thread_mutex_cleanup);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/Makefile.in	2002-04-22 09:24:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/Makefile.in	2002-06-15 14:00:15.000000000 +0800
@@ -56,43 +56,43 @@
 		echo $(RM) -f $(TARGET_LIB) ; \
 		$(RM) -f $(TARGET_LIB) ; \
 	    fi \
 	fi
 
 install: $(TARGET_LIB)
-	if [ ! -d $(includedir) ]; then \
-	    $(top_srcdir)/build/mkdir.sh $(includedir); \
+	if [ ! -d $(DESTDIR)$(includedir) ]; then \
+	    $(top_srcdir)/build/mkdir.sh $(DESTDIR)$(includedir); \
 	fi;
-	cp $(top_srcdir)/include/*.h $(includedir);
+	cp -p $(top_srcdir)/include/*.h $(DESTDIR)$(includedir);
 
 	if test -n "$(top_blddir)"; then \
-	    cp $(top_blddir)/include/*.h $(includedir); \
+	    cp -p $(top_blddir)/include/*.h $(DESTDIR)$(includedir); \
 	fi;
-	if [ ! -d $(libdir) ]; then \
-	    $(top_srcdir)/build/mkdir.sh $(libdir); \
+	if [ ! -d $(DESTDIR)$(libdir) ]; then \
+	    $(top_srcdir)/build/mkdir.sh $(DESTDIR)$(libdir); \
 	fi;
-	$(LIBTOOL) --mode=install cp $(TARGET_LIB) $(libdir)
-	$(LIBTOOL) --mode=install cp APRVARS $(libdir)
-	$(LIBTOOL) --mode=install cp apr.exp $(libdir)
-	if [ ! -d $(installbuilddir) ]; then \
-	   	$(top_srcdir)/build/mkdir.sh $(installbuilddir); \
+	$(LIBTOOL) --mode=install cp $(TARGET_LIB) $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install cp APRVARS $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install cp apr.exp $(DESTDIR)$(libdir)
+	if [ ! -d $(DESTDIR)$(installbuilddir) ]; then \
+	   	$(top_srcdir)/build/mkdir.sh $(DESTDIR)$(installbuilddir); \
 	fi; 
 	if [ -f libtool ]; then \
-		$(LIBTOOL) --mode=install cp libtool $(installbuilddir); \
+		$(LIBTOOL) --mode=install cp libtool $(DESTDIR)$(installbuilddir); \
 	fi;
 	if [ -f shlibtool ]; then \
-		$(LIBTOOL) --mode=install cp shlibtool $(installbuilddir); \
+		$(LIBTOOL) --mode=install cp shlibtool $(DESTDIR)$(installbuilddir); \
 	fi;
-	if [ ! -d $(bindir) ]; then \
-	    $(top_srcdir)/build/mkdir.sh $(bindir); \
+	if [ ! -d $(DESTDIR)$(bindir) ]; then \
+	    $(top_srcdir)/build/mkdir.sh $(DESTDIR)$(bindir); \
 	fi;
-	$(LIBTOOL) --mode=install cp apr-config $(bindir)
-	chmod 755 $(bindir)/apr-config
+	$(LIBTOOL) --mode=install cp apr-config $(DESTDIR)$(bindir)
+	chmod 755 $(DESTDIR)$(bindir)/apr-config
 	@if [ $(INSTALL_SUBDIRS) != "none" ]; then \
             for i in $(INSTALL_SUBDIRS); do \
-	        ( cd $$i ; $(MAKE) install ); \
+	        ( cd $$i ; $(MAKE) DESTDIR=$(DESTDIR) install ); \
 	    done \
 	fi
 
 $(TARGET_LIB):
 	@for i in $(SUBDIRS); do objects="$$objects $$i/*.@so_ext@"; done ; \
 	    tmpcmd="$(LINK) @lib_target@ @lib_target_libs@"; \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/memory/unix/apr_pools.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/memory/unix/apr_pools.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/memory/unix/apr_pools.c	2002-04-01 13:42:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/memory/unix/apr_pools.c	2002-06-13 00:45:21.000000000 +0800
@@ -90,12 +90,14 @@
 /*
  * Allocator
  */
 
 struct apr_allocator_t {
     apr_uint32_t        max_index;
+    apr_uint32_t        max_free_index;
+    apr_uint32_t        current_free_index;
 #if APR_HAS_THREADS
     apr_thread_mutex_t *mutex;
 #endif /* APR_HAS_THREADS */
     apr_pool_t         *owner;
     apr_memnode_t      *free[MAX_INDEX];
 };
@@ -137,41 +139,64 @@
     }
 
     free(allocator);
 }
 
 #if APR_HAS_THREADS
-APR_INLINE
-APR_DECLARE(void) apr_allocator_set_mutex(apr_allocator_t *allocator,
+APR_DECLARE(void) apr_allocator_mutex_set(apr_allocator_t *allocator,
                                           apr_thread_mutex_t *mutex)
 {
     allocator->mutex = mutex;
 }
 
-APR_INLINE
-APR_DECLARE(apr_thread_mutex_t *) apr_allocator_get_mutex(
+APR_DECLARE(apr_thread_mutex_t *) apr_allocator_mutex_get(
                                       apr_allocator_t *allocator)
 {
     return allocator->mutex;
 }
 #endif /* APR_HAS_THREADS */
 
-APR_DECLARE(void) apr_allocator_set_owner(apr_allocator_t *allocator,
+APR_DECLARE(void) apr_allocator_owner_set(apr_allocator_t *allocator,
                                           apr_pool_t *pool)
 {
     allocator->owner = pool;
 }
 
-APR_DECLARE(apr_pool_t *) apr_allocator_get_owner(apr_allocator_t *allocator)
+APR_DECLARE(apr_pool_t *) apr_allocator_owner_get(apr_allocator_t *allocator)
 {
     return allocator->owner;
 }
 
-APR_INLINE
-APR_DECLARE(apr_memnode_t *) apr_allocator_alloc(apr_allocator_t *allocator,
-                                                 apr_size_t size)
+APR_DECLARE(void) apr_allocator_max_free_set(apr_allocator_t *allocator,
+                                             apr_size_t size)
+{
+    apr_uint32_t max_free_index;
+
+#if APR_HAS_THREADS
+    apr_thread_mutex_t *mutex;
+
+    mutex = apr_allocator_mutex_get(allocator);
+    if (mutex != NULL)
+        apr_thread_mutex_lock(mutex);
+#endif /* APR_HAS_THREADS */
+
+    max_free_index = APR_ALIGN(size, BOUNDARY_SIZE) >> BOUNDARY_INDEX;
+    allocator->current_free_index += max_free_index;
+    allocator->current_free_index -= allocator->max_free_index;
+    allocator->max_free_index = max_free_index;
+    if (allocator->current_free_index > max_free_index)
+        allocator->current_free_index = max_free_index;
+
+#if APR_HAS_THREADS
+    if (mutex != NULL)
+        apr_thread_mutex_unlock(mutex);
+#endif
+}
+
+static APR_INLINE
+apr_memnode_t *allocator_alloc(apr_allocator_t *allocator, apr_size_t size)
 {
     apr_memnode_t *node, **ref;
     apr_uint32_t i, index, max_index;
 
     /* Round up the block size to the next boundary, but always
      * allocate at least a certain size (MIN_ALLOC).
@@ -225,12 +250,16 @@
                 }
                 while (*ref == NULL && max_index > 0);
 
                 allocator->max_index = max_index;
             }
 
+            allocator->current_free_index += node->index;
+            if (allocator->current_free_index > allocator->max_free_index)
+                allocator->current_free_index = allocator->max_free_index;
+
 #if APR_HAS_THREADS
             if (allocator->mutex)
                 apr_thread_mutex_unlock(allocator->mutex);
 #endif /* APR_HAS_THREADS */
 
             node->next = NULL;
@@ -261,12 +290,16 @@
         while ((node = *ref) != NULL && index > node->index)
             ref = &node->next;
 
         if (node) {
             *ref = node->next;
 
+            allocator->current_free_index += node->index;
+            if (allocator->current_free_index > allocator->max_free_index)
+                allocator->current_free_index = allocator->max_free_index;
+
 #if APR_HAS_THREADS
             if (allocator->mutex)
                 apr_thread_mutex_unlock(allocator->mutex);
 #endif /* APR_HAS_THREADS */
 
             node->next = NULL;
@@ -292,58 +325,85 @@
     node->first_avail = (char *)node + APR_MEMNODE_T_SIZE;
     node->endp = (char *)node + size;
 
     return node;
 }
 
-APR_INLINE
-APR_DECLARE(void) apr_allocator_free(apr_allocator_t *allocator,
-                                     apr_memnode_t *node)
+static APR_INLINE
+void allocator_free(apr_allocator_t *allocator, apr_memnode_t *node)
 {
-    apr_memnode_t *next;
+    apr_memnode_t *next, *freelist = NULL;
     apr_uint32_t index, max_index;
+    apr_uint32_t max_free_index, current_free_index;
 
 #if APR_HAS_THREADS
     if (allocator->mutex)
         apr_thread_mutex_lock(allocator->mutex);
 #endif /* APR_HAS_THREADS */
 
     max_index = allocator->max_index;
+    max_free_index = allocator->max_free_index;
+    current_free_index = allocator->current_free_index;
 
     /* Walk the list of submitted nodes and free them one by one,
      * shoving them in the right 'size' buckets as we go.
      */
     do {
         next = node->next;
         index = node->index;
 
-        if (index < MAX_INDEX) {
+        if (max_free_index != 0 && index > current_free_index) {
+            node->next = freelist;
+            freelist = node;
+        }
+        else if (index < MAX_INDEX) {
             /* Add the node to the appropiate 'size' bucket.  Adjust
              * the max_index when appropiate.
              */
             if ((node->next = allocator->free[index]) == NULL
                 && index > max_index) {
                 max_index = index;
             }
             allocator->free[index] = node;
+            current_free_index -= index;
         }
         else {
             /* This node is too large to keep in a specific size bucket,
              * just add it to the sink (at index 0).
              */
             node->next = allocator->free[0];
             allocator->free[0] = node;
+            current_free_index -= index;
         }
     } while ((node = next) != NULL);
 
     allocator->max_index = max_index;
+    allocator->current_free_index = current_free_index;
 
 #if APR_HAS_THREADS
     if (allocator->mutex)
         apr_thread_mutex_unlock(allocator->mutex);
 #endif /* APR_HAS_THREADS */
+
+    while (freelist != NULL) {
+        node = freelist;
+        freelist = node->next;
+        free(node);
+    }
+}
+
+APR_DECLARE(apr_memnode_t *) apr_allocator_alloc(apr_allocator_t *allocator,
+                                                 apr_size_t size)
+{
+    return allocator_alloc(allocator, size);
+}
+
+APR_DECLARE(void) apr_allocator_free(apr_allocator_t *allocator,
+                                     apr_memnode_t *node)
+{
+    allocator_free(allocator, node);
 }
 
 
 /*
  * Debug level
  */
@@ -490,17 +550,17 @@
         if ((rv = apr_thread_mutex_create(&mutex,
                                           APR_THREAD_MUTEX_DEFAULT,
                                           global_pool)) != APR_SUCCESS) {
             return rv;
         }
 
-        apr_allocator_set_mutex(global_allocator, mutex);
+        apr_allocator_mutex_set(global_allocator, mutex);
     }
 #endif /* APR_HAS_THREADS */
 
-    apr_allocator_set_owner(global_allocator, global_pool);
+    apr_allocator_owner_set(global_allocator, global_pool);
 
     return APR_SUCCESS;
 }
 
 APR_DECLARE(void) apr_pool_terminate(void)
 {
@@ -541,12 +601,13 @@
 
 APR_DECLARE(void *) apr_palloc(apr_pool_t *pool, apr_size_t size)
 {
     apr_memnode_t *active, *node;
     void *mem;
     char *endp;
+    apr_uint32_t free_index;
 
     size = APR_ALIGN_DEFAULT(size);
     active = pool->active;
 
     /* If the active node has enough bytes left, use it. */
     endp = active->first_avail + size;
@@ -554,27 +615,73 @@
         mem = active->first_avail;
         active->first_avail = endp;
 
         return mem;
     }
 
-    if ((node = apr_allocator_alloc(pool->allocator, size)) == NULL) {
-        if (pool->abort_fn)
-            pool->abort_fn(APR_ENOMEM);
+    node = active->next;
+    endp = node->first_avail + size;
+    if (endp < node->endp) {
+        *node->ref = node->next;
+        node->next->ref = node->ref;
+    }
+    else {
+        if ((node = allocator_alloc(pool->allocator, size)) == NULL) {
+            if (pool->abort_fn)
+                pool->abort_fn(APR_ENOMEM);
 
-        return NULL;
+            return NULL;
+        }
+        endp = node->first_avail + size;
     }
 
-    active->next = pool->active = node;
+    node->free_index = 0;
 
     mem = node->first_avail;
-    node->first_avail += size;
+    node->first_avail = endp;
+
+    node->ref = active->ref;
+    *node->ref = node;
+    node->next = active;
+    active->ref = &node->next;
+
+    pool->active = node;
+
+    free_index = (APR_ALIGN(active->endp - active->first_avail + 1,
+                            BOUNDARY_SIZE) - BOUNDARY_SIZE) >> BOUNDARY_INDEX;
+
+    active->free_index = free_index;
+    node = active->next;
+    if (free_index >= node->free_index)
+        return mem;
+
+    do {
+        node = node->next;
+    }
+    while (free_index < node->free_index);
+
+    *active->ref = active->next;
+    active->next->ref = active->ref;
+
+    active->ref = node->ref;
+    *active->ref = active;
+    active->next = node;
+    node->ref = &active->next;
 
     return mem;
 }
 
+/* Provide an implementation of apr_pcalloc for backward compatibility
+ * with code built before apr_pcalloc was a macro
+ */
+
+#ifdef apr_pcalloc
+#undef apr_pcalloc
+#endif
+
+APR_DECLARE(void *) apr_pcalloc(apr_pool_t *pool, apr_size_t size);
 APR_DECLARE(void *) apr_pcalloc(apr_pool_t *pool, apr_size_t size)
 {
     void *mem;
 
     size = APR_ALIGN_DEFAULT(size);
     if ((mem = apr_palloc(pool, size)) != NULL) {
@@ -613,17 +720,19 @@
     /* Find the node attached to the pool structure, reset it, make
      * it the active node and free the rest of the nodes.
      */
     active = pool->active = pool->self;
     active->first_avail = pool->self_first_avail;
 
-    if (active->next == NULL)
+    if (active->next == active)
         return;
 
-    apr_allocator_free(pool->allocator, active->next);
-    active->next = NULL;
+    *active->ref = NULL;
+    allocator_free(pool->allocator, active->next);
+    active->next = active;
+    active->ref = &active->next;
 }
 
 APR_DECLARE(void) apr_pool_destroy(apr_pool_t *pool)
 {
     apr_memnode_t *active;
     apr_allocator_t *allocator;
@@ -642,13 +751,13 @@
 
     /* Remove the pool from the parents child list */
     if (pool->parent) {
 #if APR_HAS_THREADS
         apr_thread_mutex_t *mutex;
 
-        if ((mutex = apr_allocator_get_mutex(pool->parent->allocator)) != NULL)
+        if ((mutex = apr_allocator_mutex_get(pool->parent->allocator)) != NULL)
             apr_thread_mutex_lock(mutex);
 #endif /* APR_HAS_THREADS */
 
         if ((*pool->ref = pool->sibling) != NULL)
             pool->sibling->ref = pool->ref;
 
@@ -660,33 +769,34 @@
 
     /* Find the block attached to the pool structure.  Save a copy of the
      * allocator pointer, because the pool struct soon will be no more.
      */
     allocator = pool->allocator;
     active = pool->self;
+    *active->ref = NULL;
 
 #if APR_HAS_THREADS
-    if (apr_allocator_get_owner(allocator) == pool) {
+    if (apr_allocator_owner_get(allocator) == pool) {
         /* Make sure to remove the lock, since it is highly likely to
          * be invalid now.
          */
-        apr_allocator_set_mutex(allocator, NULL);
+        apr_allocator_mutex_set(allocator, NULL);
     }
 #endif /* APR_HAS_THREADS */
 
     /* Free all the nodes in the pool (including the node holding the
      * pool struct), by giving them back to the allocator.
      */
-    apr_allocator_free(allocator, active);
+    allocator_free(allocator, active);
 
     /* If this pool happens to be the owner of the allocator, free
      * everything in the allocator (that includes the pool struct
      * and the allocator).  Don't worry about destroying the optional mutex
      * in the allocator, it will have been destroyed by the cleanup function.
      */
-    if (apr_allocator_get_owner(allocator) == pool) {
+    if (apr_allocator_owner_get(allocator) == pool) {
         apr_allocator_destroy(allocator);
     }
 }
 
 APR_DECLARE(apr_status_t) apr_pool_create_ex(apr_pool_t **newpool,
                                              apr_pool_t *parent,
@@ -704,20 +814,23 @@
     if (!abort_fn && parent)
         abort_fn = parent->abort_fn;
 
     if (allocator == NULL)
         allocator = parent->allocator;
 
-    if ((node = apr_allocator_alloc(allocator,
-                                    MIN_ALLOC - APR_MEMNODE_T_SIZE)) == NULL) {
+    if ((node = allocator_alloc(allocator,
+                                MIN_ALLOC - APR_MEMNODE_T_SIZE)) == NULL) {
         if (abort_fn)
             abort_fn(APR_ENOMEM);
 
         return APR_ENOMEM;
     }
 
+    node->next = node;
+    node->ref = &node->next;
+
     pool = (apr_pool_t *)node->first_avail;
     node->first_avail = pool->self_first_avail = (char *)pool + SIZEOF_POOL_T;
 
     pool->allocator = allocator;
     pool->active = pool->self = node;
     pool->abort_fn = abort_fn;
@@ -732,13 +845,13 @@
 #endif /* defined(NETWARE) */
 
     if ((pool->parent = parent) != NULL) {
 #if APR_HAS_THREADS
         apr_thread_mutex_t *mutex;
 
-        if ((mutex = apr_allocator_get_mutex(allocator)) != NULL)
+        if ((mutex = apr_allocator_mutex_get(allocator)) != NULL)
             apr_thread_mutex_lock(mutex);
 #endif /* APR_HAS_THREADS */
 
         if ((pool->sibling = parent->child) != NULL)
             pool->sibling->ref = &pool->sibling;
 
@@ -779,57 +892,99 @@
  * self-contained with no callouts.
  */
 
 struct psprintf_data {
     apr_vformatter_buff_t vbuff;
     apr_memnode_t   *node;
-    apr_allocator_t *allocator;
+    apr_pool_t      *pool;
     apr_byte_t       got_a_new_node;
     apr_memnode_t   *free;
 };
 
 static int psprintf_flush(apr_vformatter_buff_t *vbuff)
 {
     struct psprintf_data *ps = (struct psprintf_data *)vbuff;
     apr_memnode_t *node, *active;
-    apr_size_t cur_len;
+    apr_size_t cur_len, size;
     char *strp;
-    apr_allocator_t *allocator;
+    apr_pool_t *pool;
+    apr_uint32_t free_index;
 
-    allocator = ps->allocator;
-    node = ps->node;
+    pool = ps->pool;
+    active = ps->node;
     strp = ps->vbuff.curpos;
-    cur_len = strp - node->first_avail;
+    cur_len = strp - active->first_avail;
+    size = cur_len << 1;
 
-    if ((active = apr_allocator_alloc(allocator, cur_len << 1)) == NULL)
-        return -1;
+    node = active->next;
+    if (!ps->got_a_new_node && node->first_avail + size < node->endp) {
+        *node->ref = node->next;
+        node->next->ref = node->ref;
+
+        node->ref = active->ref;
+        *node->ref = node;
+        node->next = active;
+        active->ref = &node->next;
+
+        node->free_index = 0;
+
+        pool->active = node;
+
+        free_index = (APR_ALIGN(active->endp - active->first_avail + 1,
+                                BOUNDARY_SIZE) - BOUNDARY_SIZE) >> BOUNDARY_INDEX;
+
+        active->free_index = free_index;
+        node = active->next;
+        if (free_index < node->free_index) {
+            do {
+                node = node->next;
+            }
+            while (free_index < node->free_index);
 
-    memcpy(active->first_avail, node->first_avail, cur_len);
+            *active->ref = active->next;
+            active->next->ref = active->ref;
 
-    if (ps->got_a_new_node) {
-        node->next = ps->free;
-        ps->free = node;
+            active->ref = node->ref;
+            *active->ref = active;
+            active->next = node;
+            node->ref = &active->next;
+        }
+
+        node = pool->active;
     }
+    else {
+        if ((node = allocator_alloc(pool->allocator, size)) == NULL)
+            return -1;
 
-    ps->node = active;
-    ps->vbuff.curpos = active->first_avail + cur_len;
-    ps->vbuff.endpos = active->endp - 1; /* Save a byte for NUL terminator */
-    ps->got_a_new_node = 1;
+        if (ps->got_a_new_node) {
+            active->next = ps->free;
+            ps->free = node;
+        }
+
+        ps->got_a_new_node = 1;
+    }
+
+    memcpy(node->first_avail, active->first_avail, cur_len);
+
+    ps->node = node;
+    ps->vbuff.curpos = node->first_avail + cur_len;
+    ps->vbuff.endpos = node->endp - 1; /* Save a byte for NUL terminator */
 
     return 0;
 }
 
 APR_DECLARE(char *) apr_pvsprintf(apr_pool_t *pool, const char *fmt, va_list ap)
 {
     struct psprintf_data ps;
     char *strp;
     apr_size_t size;
-    apr_memnode_t *active;
+    apr_memnode_t *active, *node;
+    apr_uint32_t free_index;
 
     ps.node = active = pool->active;
-    ps.allocator = pool->allocator;
+    ps.pool = pool;
     ps.vbuff.curpos  = ps.node->first_avail;
 
     /* Save a byte for the NUL terminator */
     ps.vbuff.endpos = ps.node->endp - 1;
     ps.got_a_new_node = 0;
     ps.free = NULL;
@@ -846,21 +1001,54 @@
 
     size = strp - ps.node->first_avail;
     size = APR_ALIGN_DEFAULT(size);
     strp = ps.node->first_avail;
     ps.node->first_avail += size;
 
+    if (ps.free)
+        allocator_free(pool->allocator, ps.free);
+
     /*
      * Link the node in if it's a new one
      */
-    if (ps.got_a_new_node) {
-        active->next = pool->active = ps.node;
+    if (!ps.got_a_new_node)
+        return strp;
+
+    active = pool->active;
+    node = ps.node;
+
+    node->free_index = 0;
+
+    node->ref = active->ref;
+    *node->ref = node;
+    node->next = active;
+    active->ref = &node->next;
+
+    pool->active = node;
+
+    free_index = (APR_ALIGN(active->endp - active->first_avail + 1,
+                            BOUNDARY_SIZE) - BOUNDARY_SIZE) >> BOUNDARY_INDEX;
+
+    active->free_index = free_index;
+    node = active->next;
+
+    if (free_index >= node->free_index)
+        return strp;
+
+    do {
+        node = node->next;
     }
+    while (free_index < node->free_index);
 
-    if (ps.free)
-        apr_allocator_free(ps.allocator, ps.free);
+    *active->ref = active->next;
+    active->next->ref = active->ref;
+
+    active->ref = node->ref;
+    *active->ref = active;
+    active->next = node;
+    node->ref = &active->next;
 
     return strp;
 }
 
 
 #else /* APR_POOL_DEBUG */
@@ -962,12 +1150,13 @@
                 file_line);
         }
     }
 }
 #endif /* (APR_POOL_DEBUG & APR_POOL_DEBUG_VERBOSE_ALL) */
 
+#if (APR_POOL_DEBUG & APR_POOL_DEBUG_LIFETIME)
 static int pool_is_child_of(apr_pool_t *parent, void *data)
 {
     apr_pool_t *pool = (apr_pool_t *)data;
 
     return (pool == parent);
 }
@@ -976,12 +1165,13 @@
 {
     if (parent == NULL)
         return 0;
 
     return apr_pool_walk_tree(parent, pool_is_child_of, pool);
 }
+#endif /* (APR_POOL_DEBUG & APR_POOL_DEBUG_LIFETIME) */
 
 static void apr_pool_check_integrity(apr_pool_t *pool)
 {
     /* Rule of thumb: use of the global pool is always
      * ok, since the only user is apr_pools.c.  Unless
      * people have searched for the top level parent and
@@ -1191,19 +1381,50 @@
     pool->stat_clear++;
 }
 
 APR_DECLARE(void) apr_pool_clear_debug(apr_pool_t *pool,
                                        const char *file_line)
 {
+#if APR_HAS_THREADS
+    apr_thread_mutex_t *mutex = NULL;
+#endif
+
     apr_pool_check_integrity(pool);
 
 #if (APR_POOL_DEBUG & APR_POOL_DEBUG_VERBOSE)
     apr_pool_log_event(pool, "CLEAR", file_line, 1);
 #endif /* (APR_POOL_DEBUG & APR_POOL_DEBUG_VERBOSE) */
 
+#if APR_HAS_THREADS
+    if (pool->parent != NULL)
+        mutex = pool->parent->mutex;
+
+    /* Lock the parent mutex before clearing so that if we have our
+     * own mutex it won't be accessed by apr_pool_walk_tree after
+     * it has been destroyed.
+     */
+    if (mutex != NULL && mutex != pool->mutex) {
+        apr_thread_mutex_lock(mutex);
+    }
+#endif
+
     pool_clear_debug(pool, file_line);
+
+#if APR_HAS_THREADS
+    /* If we had our own mutex, it will have been destroyed by
+     * the registered cleanups.  Recreate the mutex.  Unlock
+     * the mutex we obtained above.
+     */
+    if (mutex != pool->mutex) {
+        (void)apr_thread_mutex_create(&pool->mutex,
+                                      APR_THREAD_MUTEX_NESTED, pool);
+
+        if (mutex != NULL)
+            (void)apr_thread_mutex_unlock(mutex);
+    }
+#endif /* APR_HAS_THREADS */
 }
 
 APR_DECLARE(void) apr_pool_destroy_debug(apr_pool_t *pool,
                                          const char *file_line)
 {
     apr_pool_check_integrity(pool);
@@ -1230,13 +1451,13 @@
         if (mutex)
             apr_thread_mutex_unlock(mutex);
 #endif /* APR_HAS_THREADS */
     }
 
     if (pool->allocator != NULL
-        && apr_allocator_get_owner(pool->allocator) == pool) {
+        && apr_allocator_owner_get(pool->allocator) == pool) {
         apr_allocator_destroy(pool->allocator);
     }
 
     /* Free the pool itself */
     free(pool);
 }
@@ -1512,28 +1733,33 @@
 }
 
 /*
  * Pool Properties
  */
 
-APR_DECLARE(void) apr_pool_set_abort(apr_abortfunc_t abort_fn,
+APR_DECLARE(void) apr_pool_abort_set(apr_abortfunc_t abort_fn,
                                      apr_pool_t *pool)
 {
     pool->abort_fn = abort_fn;
 }
 
-APR_DECLARE(apr_abortfunc_t) apr_pool_get_abort(apr_pool_t *pool)
+APR_DECLARE(apr_abortfunc_t) apr_pool_abort_get(apr_pool_t *pool)
 {
     return pool->abort_fn;
 }
 
-APR_DECLARE(apr_pool_t *) apr_pool_get_parent(apr_pool_t *pool)
+APR_DECLARE(apr_pool_t *) apr_pool_parent_get(apr_pool_t *pool)
 {
     return pool->parent;
 }
 
+APR_DECLARE(apr_allocator_t *) apr_pool_allocator_get(apr_pool_t *pool)
+{
+    return pool->allocator;
+}
+
 /* return TRUE if a is an ancestor of b
  * NULL is considered an ancestor of all pools
  */
 APR_DECLARE(int) apr_pool_is_ancestor(apr_pool_t *a, apr_pool_t *b)
 {
     if (a == NULL)
@@ -1945,6 +2171,63 @@
     return apr_pool_create_ex_debug(newpool, parent,
                                     abort_fn, allocator,
                                     "undefined");
 }
 
 #endif /* APR_POOL_DEBUG */
+
+/* Deprecated */
+APR_DECLARE(void) apr_allocator_set_max_free(apr_allocator_t *allocator,
+                                             apr_size_t size)
+{
+    apr_allocator_max_free_set(allocator, size);
+}
+
+/* Deprecated */
+APR_DECLARE(void) apr_pool_set_abort(apr_abortfunc_t abort_fn,
+                                     apr_pool_t *pool)
+{
+    apr_pool_abort_set(abort_fn, pool);
+}
+
+/* Deprecated */
+APR_DECLARE(apr_abortfunc_t) apr_pool_get_abort(apr_pool_t *pool)
+{
+    return apr_pool_abort_get(pool);
+}
+
+/* Deprecated */
+APR_DECLARE(apr_pool_t *) apr_pool_get_parent(apr_pool_t *pool)
+{
+    return apr_pool_parent_get(pool);
+}
+
+/* Deprecated */
+APR_DECLARE(void) apr_allocator_set_owner(apr_allocator_t *allocator,
+                                          apr_pool_t *pool)
+{
+    apr_allocator_owner_set(allocator, pool);
+}
+
+/* Deprecated */
+APR_DECLARE(apr_pool_t *) apr_allocator_get_owner(
+                                  apr_allocator_t *allocator)
+{
+    return apr_allocator_owner_get(allocator);
+}
+
+#if APR_HAS_THREADS
+/* Deprecated */
+APR_DECLARE(apr_thread_mutex_t *) apr_allocator_get_mutex(
+                                      apr_allocator_t *allocator)
+{
+    return apr_allocator_mutex_get(allocator);
+}
+
+/* Deprecated */
+APR_DECLARE(void) apr_allocator_set_mutex(apr_allocator_t *allocator,
+                                          apr_thread_mutex_t *mutex)
+{
+    apr_allocator_mutex_set(allocator, mutex);
+}
+#endif /* APR_HAS_THREADS */
+
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/memory/unix: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/unix/rand.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/unix/rand.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/unix/rand.c	2002-03-14 04:39:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/unix/rand.c	2002-05-18 12:12:28.000000000 +0800
@@ -132,13 +132,13 @@
         return APR_EINVAL;
     }
 
     memset(&addr, 0, sizeof(struct sockaddr_un));
     addr.sun_family = AF_UNIX;
     memcpy(addr.sun_path, STR(EGD_DEFAULT_SOCKET), egd_path_len);
-    egd_addr_len = APR_XtOffsetOf(struct sockaddr_un, sun_path) + 
+    egd_addr_len = APR_OFFSETOF(struct sockaddr_un, sun_path) + 
                    egd_path_len; 
 
     egd_socket = socket(PF_UNIX, SOCK_STREAM, 0);
 
     if (egd_socket == -1) {
         /* Does socket set errno? */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/unix/start.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/unix/start.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/unix/start.c	2002-04-14 03:27:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/unix/start.c	2002-06-12 09:45:04.000000000 +0800
@@ -93,13 +93,13 @@
         return status;
     
     if (apr_pool_create(&pool, NULL) != APR_SUCCESS) {
         return APR_ENOPOOL;
     }
 
-    apr_pool_tag(pool, "apr_initilialize");
+    apr_pool_tag(pool, "apr_initialize");
 
     apr_signal_init(pool);
 
     return APR_SUCCESS;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/win32/rand.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/win32/rand.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/misc/win32/rand.c	2002-03-14 04:39:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/misc/win32/rand.c	2002-05-30 06:07:58.000000000 +0800
@@ -51,24 +51,28 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
 
 #include "apr_private.h"
 #include "apr_general.h"
+#include "misc.h"
 #include <wincrypt.h>
 
 APR_DECLARE(apr_status_t) apr_generate_random_bytes(unsigned char * buf,
                                                     int length)
 {
     HCRYPTPROV hProv;
     apr_status_t res = APR_SUCCESS;
 
     /* 0x40 bit = CRYPT_SILENT, only introduced in more recent PSDKs 
+     * and will only work for Win2K and later.
      */
-    if (!CryptAcquireContext(&hProv, NULL, NULL, PROV_RSA_FULL,
-                             CRYPT_VERIFYCONTEXT | 0x40)) {
+    DWORD flags = CRYPT_VERIFYCONTEXT
+                | ((apr_os_level >= APR_WIN_2000) ? 0x40 : 0);
+
+    if (!CryptAcquireContext(&hProv, NULL, NULL, PROV_RSA_FULL, flags)) {
 	return apr_get_os_error();
     }
     if (!CryptGenRandom(hProv, length, buf)) {
     	res = apr_get_os_error();
     }
     CryptReleaseContext(hProv, 0);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/mmap/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/os2/sendrecv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/os2/sendrecv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/os2/sendrecv.c	2002-03-14 04:39:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/os2/sendrecv.c	2002-05-08 16:33:10.000000000 +0800
@@ -101,13 +101,13 @@
 APR_DECLARE(apr_status_t) apr_recv(apr_socket_t *sock, char *buf, apr_size_t *len)
 {
     ssize_t rv;
     int fds, err = 0;
 
     do {
-        if (!sock->nonblock || err == SOCEWOULDBLOCK) {
+        if (!sock->nonblock || (err == SOCEWOULDBLOCK && sock->timeout != 0)) {
             fds = sock->socketdes;
             rv = select(&fds, 1, 0, 0, sock->timeout >= 0 ? sock->timeout/1000 : -1);
 
             if (rv != 1) {
                 *len = 0;
                 err = sock_errno();
@@ -121,13 +121,13 @@
                 return APR_OS2_STATUS(err);
             }
         }
 
         rv = recv(sock->socketdes, buf, (*len), 0);
         err = rv < 0 ? sock_errno() : 0;
-    } while (err == SOCEINTR || err == SOCEWOULDBLOCK);
+    } while (err == SOCEINTR || (err == SOCEWOULDBLOCK && sock->timeout != 0));
 
     if (err) {
         *len = 0;
         return APR_OS2_STATUS(err);
     }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/os2/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/os2/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/os2/sockets.c	2002-04-14 16:33:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/os2/sockets.c	2002-06-09 06:32:11.000000000 +0800
@@ -293,9 +293,9 @@
 
     (*sock)->local_port_unknown = (*sock)->local_interface_unknown = 1;
     (*sock)->socketdes = *thesock;
     return APR_SUCCESS;
 }
 
-APR_IMPLEMENT_SET_INHERIT(socket, inherit, cntxt, socket_cleanup)
+APR_IMPLEMENT_INHERIT_SET(socket, inherit, cntxt, socket_cleanup)
 
-APR_IMPLEMENT_UNSET_INHERIT(socket, inherit, cntxt, socket_cleanup)
+APR_IMPLEMENT_INHERIT_UNSET(socket, inherit, cntxt, socket_cleanup)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/inet_ntop.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/inet_ntop.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/inet_ntop.c	2002-02-13 05:57:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/inet_ntop.c	2002-05-05 14:33:37.000000000 +0800
@@ -136,90 +136,110 @@
  * author:
  *	Paul Vixie, 1996.
  */
 static const char *
 inet_ntop6(const unsigned char *src, char *dst, apr_size_t size)
 {
-	/*
-	 * Note that int32_t and int16_t need only be "at least" large enough
-	 * to contain a value of the specified size.  On some systems, like
-	 * Crays, there is no such thing as an integer variable with 16 bits.
-	 * Keep this in mind if you think this function should have been coded
-	 * to use pointer overlays.  All the world's not a VAX.
-	 */
-	char tmp[sizeof "ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255"], *tp;
-	struct { int base, len; } best, cur;
-	unsigned int words[IN6ADDRSZ / INT16SZ];
-	int i;
-
-	/*
-	 * Preprocess:
-	 *	Copy the input (bytewise) array into a wordwise array.
-	 *	Find the longest run of 0x00's in src[] for :: shorthanding.
-	 */
-	memset(words, '\0', sizeof words);
-	for (i = 0; i < IN6ADDRSZ; i++)
-		words[i / 2] |= (src[i] << ((1 - (i % 2)) << 3));
-	best.base = -1;
-	cur.base = -1;
-	for (i = 0; i < (IN6ADDRSZ / INT16SZ); i++) {
-		if (words[i] == 0) {
-			if (cur.base == -1)
-				cur.base = i, cur.len = 1;
-			else
-				cur.len++;
-		} else {
-			if (cur.base != -1) {
-				if (best.base == -1 || cur.len > best.len)
-					best = cur;
-				cur.base = -1;
-			}
+    /*
+     * Note that int32_t and int16_t need only be "at least" large enough
+     * to contain a value of the specified size.  On some systems, like
+     * Crays, there is no such thing as an integer variable with 16 bits.
+     * Keep this in mind if you think this function should have been coded
+     * to use pointer overlays.  All the world's not a VAX.
+     */
+    char tmp[sizeof "ffff:ffff:ffff:ffff:ffff:ffff:255.255.255.255"], *tp;
+    struct { int base, len; } best, cur;
+    unsigned int words[IN6ADDRSZ / INT16SZ];
+    int i;
+    const unsigned char *next_src, *src_end;
+    unsigned int *next_dest;
+
+    /*
+     * Preprocess:
+     *	Copy the input (bytewise) array into a wordwise array.
+     *	Find the longest run of 0x00's in src[] for :: shorthanding.
+     */
+    next_src = src;
+    src_end = src + IN6ADDRSZ;
+    next_dest = words;
+    best.base = -1;
+    cur.base = -1;
+    i = 0;
+    do {
+        unsigned int next_word = (unsigned int)*next_src++;
+        next_word <<= 8;
+        next_word |= (unsigned int)*next_src++;
+        *next_dest++ = next_word;
+
+        if (next_word == 0) {
+            if (cur.base == -1) {
+                cur.base = i;
+                cur.len = 1;
+            }
+            else {
+                cur.len++;
+            }
+        } else {
+            if (cur.base != -1) {
+                if (best.base == -1 || cur.len > best.len) {
+                    best = cur;
 		}
+                cur.base = -1;
+            }
 	}
-	if (cur.base != -1) {
-		if (best.base == -1 || cur.len > best.len)
-			best = cur;
+
+        i++;
+    } while (next_src < src_end);
+
+    if (cur.base != -1) {
+        if (best.base == -1 || cur.len > best.len) {
+            best = cur;
 	}
-	if (best.base != -1 && best.len < 2)
-		best.base = -1;
+    }
+    if (best.base != -1 && best.len < 2) {
+        best.base = -1;
+    }
 
-	/*
-	 * Format the result.
-	 */
-	tp = tmp;
-	for (i = 0; i < (IN6ADDRSZ / INT16SZ); i++) {
-		/* Are we inside the best run of 0x00's? */
-		if (best.base != -1 && i >= best.base &&
-		    i < (best.base + best.len)) {
-			if (i == best.base)
-				*tp++ = ':';
-			continue;
-		}
-		/* Are we following an initial run of 0x00s or any real hex? */
-		if (i != 0)
-			*tp++ = ':';
-		/* Is this address an encapsulated IPv4? */
-		if (i == 6 && best.base == 0 &&
-		    (best.len == 6 || (best.len == 5 && words[5] == 0xffff))) {
-			if (!inet_ntop4(src+12, tp, sizeof tmp - (tp - tmp)))
-				return (NULL);
-			tp += strlen(tp);
-			break;
-		}
-		tp += apr_snprintf(tp, sizeof tmp - (tp - tmp), "%x", words[i]);
+    /*
+     * Format the result.
+     */
+    tp = tmp;
+    for (i = 0; i < (IN6ADDRSZ / INT16SZ);) {
+        /* Are we inside the best run of 0x00's? */
+        if (i == best.base) {
+            *tp++ = ':';
+            i += best.len;
+            continue;
 	}
-	/* Was it a trailing run of 0x00's? */
-	if (best.base != -1 && (best.base + best.len) == (IN6ADDRSZ / INT16SZ))
-		*tp++ = ':';
-	*tp++ = '\0';
-
-	/*
-	 * Check for overflow, copy, and we're done.
-	 */
-	if ((size_t)(tp - tmp) > size) {
-		errno = ENOSPC;
+        /* Are we following an initial run of 0x00s or any real hex? */
+        if (i != 0) {
+            *tp++ = ':';
+        }
+        /* Is this address an encapsulated IPv4? */
+        if (i == 6 && best.base == 0 &&
+            (best.len == 6 || (best.len == 5 && words[5] == 0xffff))) {
+            if (!inet_ntop4(src+12, tp, sizeof tmp - (tp - tmp))) {
 		return (NULL);
+            }
+            tp += strlen(tp);
+            break;
 	}
-	strcpy(dst, tmp);
-	return (dst);
+        tp += apr_snprintf(tp, sizeof tmp - (tp - tmp), "%x", words[i]);
+        i++;
+    }
+    /* Was it a trailing run of 0x00's? */
+    if (best.base != -1 && (best.base + best.len) == (IN6ADDRSZ / INT16SZ)) {
+        *tp++ = ':';
+    }
+    *tp++ = '\0';
+
+    /*
+     * Check for overflow, copy, and we're done.
+     */
+    if ((size_t)(tp - tmp) > size) {
+        errno = ENOSPC;
+        return (NULL);
+    }
+    strcpy(dst, tmp);
+    return (dst);
 }
 #endif
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sendrecv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sendrecv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sendrecv.c	2002-04-26 02:27:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sendrecv.c	2002-05-18 05:19:45.000000000 +0800
@@ -387,22 +387,34 @@
         apr_setsocketopt(sock, APR_TCP_NOPUSH, 0);
         return rv;
     }
 
     nbytes += rv;
 
-    /* If this was a partial write, return now with the partial byte count; 
-     * this is a non-blocking socket.
-     */
-
     if (rv < *len) {
         *len = nbytes;
-        if (sock->timeout) {
-            sock->netmask |= APR_INCOMPLETE_WRITE;
+        arv = apr_setsocketopt(sock, APR_TCP_NOPUSH, 0);
+        if (rv > 0) {
+                
+            /* If this was a partial write, return now with the 
+             * partial byte count;  this is a non-blocking socket.
+             */
+
+            if (sock->timeout) {
+                sock->netmask |= APR_INCOMPLETE_WRITE;
+            }
+            return arv;
+        }
+        else {
+            /* If the file got smaller mid-request, eventually the offset
+             * becomes equal to the new file size and the kernel returns 0.  
+             * Make this an error so the caller knows to log something and
+             * exit.
+             */
+            return APR_EOF;
         }
-        return apr_setsocketopt(sock, APR_TCP_NOPUSH, 0);
     }
 
     /* Now write the footers */
     if (hdtr->numtrailers > 0) {
         apr_size_t trbytes;
         arv = apr_sendv(sock, hdtr->trailers, hdtr->numtrailers, &trbytes);
@@ -475,24 +487,35 @@
                           *offset,       /* where in the file to start */
                           bytes_to_send, /* number of bytes to send */
                           &headerstruct, /* Headers/footers */
                           &nbytes,       /* number of bytes written */
                           flags);        /* undefined, set to 0 */
 
-            if (rv == -1 && errno == EAGAIN) {
-                if (sock->timeout) {
-                    sock->netmask |= APR_INCOMPLETE_WRITE;
+            if (rv == -1) {
+                if (errno == EAGAIN) {
+                    if (sock->timeout) {
+                        sock->netmask |= APR_INCOMPLETE_WRITE;
+                    }
+                    /* FreeBSD's sendfile can return -1/EAGAIN even if it
+                     * sent bytes.  Sanitize the result so we get normal EAGAIN
+                     * semantics w.r.t. bytes sent.
+                     */
+                    if (nbytes) {
+                        /* normal exit for a big file & non-blocking io */
+                        (*len) = nbytes;
+                        return APR_SUCCESS;
+                    }
                 }
-                /* FreeBSD's sendfile can return -1/EAGAIN even if it
-                 * sent bytes.  Sanitize the result so we get normal EAGAIN
-                 * semantics w.r.t. bytes sent.
-                 */
-                if (nbytes) {
-                    /* normal exit for a big file & non-blocking io */
+            }
+            else {       /* rv == 0 (or the kernel is broken) */
+                if (nbytes == 0) {
+                    /* Most likely the file got smaller after the stat.
+                     * Return an error so the caller can do the Right Thing.
+                     */
                     (*len) = nbytes;
-                    return APR_SUCCESS;
+                    return APR_EOF;
                 }
             }
         }    
         else {
             /* just trailer bytes... use writev()
              */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sockets.c	2002-04-17 04:25:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sockets.c	2002-06-09 06:32:11.000000000 +0800
@@ -368,9 +368,9 @@
     }
     (*sock)->local_port_unknown = (*sock)->local_interface_unknown = 1;
     (*sock)->socketdes = *thesock;
     return APR_SUCCESS;
 }
 
-APR_IMPLEMENT_SET_INHERIT(socket, inherit, cntxt, socket_cleanup)
+APR_IMPLEMENT_INHERIT_SET(socket, inherit, cntxt, socket_cleanup)
 
-APR_IMPLEMENT_UNSET_INHERIT(socket, inherit, cntxt, socket_cleanup)
+APR_IMPLEMENT_INHERIT_UNSET(socket, inherit, cntxt, socket_cleanup)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sockopt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sockopt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/unix/sockopt.c	2002-03-14 04:39:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/unix/sockopt.c	2002-05-18 02:10:52.000000000 +0800
@@ -185,13 +185,18 @@
         }
 #else
         return APR_ENOTIMPL;
 #endif
     }
     if (opt & APR_SO_TIMEOUT) { 
-        /* don't do the fcntl foo more than needed */ 
+        /* If our timeout is positive or zero and our last timeout was
+         * negative, then we need to ensure that we are non-blocking.
+         * Conversely, if our timeout is negative and we had a positive
+         * or zero timeout, we must make sure our socket is blocking.
+         * We want to avoid calling fcntl more than necessary on the socket,
+         */
         if (on >= 0 && sock->timeout < 0){
             if (apr_is_option_set(sock->netmask, APR_SO_NONBLOCK) != 1){
                 if ((stat = sononblock(sock->socketdes)) != APR_SUCCESS){
                     return stat;
                 }
             }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/poll.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/poll.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/poll.c	2002-03-14 04:39:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/poll.c	2002-06-04 12:50:44.000000000 +0800
@@ -53,32 +53,35 @@
  */
 
 #include "networkio.h"
 #include "apr_network_io.h"
 #include "apr_general.h"
 #include "apr_lib.h"
+#if APR_HAVE_ERRNO_H
 #include <errno.h>
+#endif
+#if APR_HAVE_TIME_H
 #include <time.h>
-
+#endif
 
 APR_DECLARE(apr_status_t) apr_poll_setup(apr_pollfd_t **new, apr_int32_t num,
                                          apr_pool_t *cont)
 {
     (*new) = (apr_pollfd_t *)apr_palloc(cont, sizeof(apr_pollfd_t) * num);
     if ((*new) == NULL) {
         return APR_ENOMEM;
     }
     (*new)->cntxt = cont;
     (*new)->read = (fd_set *)apr_palloc(cont, sizeof(fd_set));
     (*new)->write = (fd_set *)apr_palloc(cont, sizeof(fd_set));
-    (*new)->except = (fd_set *)apr_palloc(cont, sizeof(fd_set));
+    (*new)->exception = (fd_set *)apr_palloc(cont, sizeof(fd_set));
     FD_ZERO((*new)->read);
     (*new)->numread = 0;
     FD_ZERO((*new)->write);
     (*new)->numwrite = 0;
-    FD_ZERO((*new)->except);
+    FD_ZERO((*new)->exception);
     (*new)->numexcept = 0;
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_poll_socket_add(apr_pollfd_t *aprset,
                                               apr_socket_t *sock,
@@ -112,13 +115,13 @@
         newread = aprset->read;
     }
     if (aprset->numwrite != 0) {
         newwrite = aprset->write;
     }
     if (aprset->numexcept != 0) {
-        newexcept = aprset->except;
+        newexcept = aprset->exception;
     }
 
     if (newread == NULL && newwrite == NULL && newexcept == NULL) {
 #ifdef NETWARE
         delay((DWORD)(timeout / 1000)); /* convert microseconds into milliseconds */
 #else
@@ -161,14 +164,19 @@
      */
     data.len = sizeof(buf);
     data.buf = buf;
 
     if (FD_ISSET(sock->sock, aprset->read)) {
         revents |= APR_POLLIN;
+#ifdef _WIN32_WCE
+        if (recv(sock->sock, data.buf, data.len, 0) == SOCKET_ERROR) 
+#else
         if (WSARecv(sock->sock, &data, 1, &dummy, &flags, NULL, 
-                    NULL) == SOCKET_ERROR) {
+                    NULL) == SOCKET_ERROR) 
+#endif
+            {
             /* This is only legit since we don't return the error */
             dummy = WSAGetLastError();
             switch (dummy) {
                 case WSAECONNRESET:
                 case WSAECONNABORTED:
                 case WSAESHUTDOWN:
@@ -192,13 +200,13 @@
         revents |= APR_POLLOUT;
     }
     /* I am assuming that the except is for out of band data, not a failed
      * connection on a non-blocking socket.  Might be a bad assumption, but
      * it works for now. rbb.
      */
-    if (FD_ISSET(sock->sock, aprset->except)) {
+    if (FD_ISSET(sock->sock, aprset->exception)) {
         revents |= APR_POLLPRI;
     }
 
     (*event) = revents;
     return APR_SUCCESS;
 }
@@ -222,13 +230,13 @@
 {
     if (events & APR_POLLIN) {
         FD_CLR(sock->sock, aprset->read);
         aprset->numread--;
     }
     if (events & APR_POLLPRI) {
-        FD_CLR(sock->sock, aprset->except);
+        FD_CLR(sock->sock, aprset->exception);
         aprset->numexcept--;
     }
     if (events & APR_POLLOUT) {
         FD_CLR(sock->sock, aprset->write);
         aprset->numwrite--;
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sendrecv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sendrecv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sendrecv.c	2002-04-28 04:47:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sendrecv.c	2002-06-04 12:50:44.000000000 +0800
@@ -55,13 +55,15 @@
 #include "networkio.h"
 #include "apr_errno.h"
 #include "apr_general.h"
 #include "apr_network_io.h"
 #include "apr_lib.h"
 #include "fileio.h"
+#if APR_HAVE_TIME_H
 #include <time.h>
+#endif
 
 /* MAX_SEGMENT_SIZE is the maximum amount of data that will be sent to a client
  * in one call of TransmitFile. This number must be small enough to give the 
  * slowest client time to receive the data before the socket timeout triggers.
  * The same problem can exist with apr_send(). In that case, we rely on the
  * application to adjust socket timeouts and max send segment sizes appropriately.
@@ -79,13 +81,18 @@
     int lasterror;
     DWORD dwBytes = 0;
 
     wsaData.len = *len;
     wsaData.buf = (char*) buf;
 
+#ifndef _WIN32_WCE
     rv = WSASend(sock->sock, &wsaData, 1, &dwBytes, 0, NULL, NULL);
+#else
+    rv = send(sock->sock, wsaData.buf, wsaData.len, 0);
+    dwBytes = rv;
+#endif
     if (rv == SOCKET_ERROR) {
         lasterror = apr_get_netos_error();
         return lasterror;
     }
 
     *len = dwBytes;
@@ -103,13 +110,18 @@
     DWORD dwBytes = 0;
     DWORD flags = 0;
 
     wsaData.len = *len;
     wsaData.buf = (char*) buf;
 
+#ifndef _WIN32_WCE
     rv = WSARecv(sock->sock, &wsaData, 1, &dwBytes, &flags, NULL, NULL);
+#else
+    rv = recv(sock->sock, wsaData.buf, wsaData.len, 0);
+    dwBytes = rv;
+#endif
     if (rv == SOCKET_ERROR) {
         lasterror = apr_get_netos_error();
         *len = 0;
         return lasterror;
     }
 
@@ -135,18 +147,27 @@
             return APR_ENOMEM;
     }
     for (i = 0; i < nvec; i++) {
         pWsaBuf[i].buf = vec[i].iov_base;
         pWsaBuf[i].len = vec[i].iov_len;
     }
-
+#ifndef _WIN32_WCE
     rv = WSASend(sock->sock, pWsaBuf, nvec, &dwBytes, 0, NULL, NULL);
     if (rv == SOCKET_ERROR) {
         rc = apr_get_netos_error();
     }
-
+#else
+    for (i = 0; i < nvec; i++) {
+        rv = send(sock->sock, pWsaBuf[i].buf, pWsaBuf[i].len, 0);
+        if (rv == SOCKET_ERROR) {
+            rc = apr_get_netos_error();
+            break;
+        }
+        dwBytes += rv;
+    }
+#endif
     if (nvec > WSABUF_ON_STACK) 
         free(pWsaBuf);
 
     *nbytes = dwBytes;
     return rc;
 }
@@ -248,27 +269,32 @@
     apr_off_t curoff = *offset;
     DWORD dwFlags = 0;
     DWORD nbytes;
     OVERLAPPED overlapped;
     TRANSMIT_FILE_BUFFERS tfb, *ptfb = NULL;
     int ptr = 0;
-    int bytes_to_send = *len;   /* Bytes to send out of the file (not including headers) */
+    int bytes_to_send;   /* Bytes to send out of the file (not including headers) */
+    int disconnected = 0;
+    HANDLE wait_event;
 
     if (apr_os_level < APR_WIN_NT) {
         return APR_ENOTIMPL;
     }
 
-    /* Use len to keep track of number of total bytes sent (including headers) */
-    *len = 0;
-
     /* Initialize the overlapped structure */
     memset(&overlapped,'\0', sizeof(overlapped));
 #ifdef WAIT_FOR_EVENT
-    overlapped.hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);
+    wait_event = overlapped.hEvent = CreateEvent(NULL, FALSE, FALSE, NULL);
+#else
+    wait_event = (HANDLE) sock->sock;
 #endif
 
+    /* Use len to keep track of number of total bytes sent (including headers) */
+    bytes_to_send = *len;
+    *len = 0;
+
     /* Handle the goofy case of sending headers/trailers and a zero byte file */
     if (!bytes_to_send && hdtr) {
         if (hdtr->numheaders) {
             rv = apr_sendv(sock, hdtr->headers, hdtr->numheaders, &nbytes);
             if (rv != APR_SUCCESS)
                 return rv;
@@ -281,14 +307,14 @@
             *len += nbytes;
         }
         return APR_SUCCESS;
     }
 
     /* Collapse the headers into a single buffer */
-    memset(&tfb, '\0', sizeof (tfb));
     if (hdtr && hdtr->numheaders) {
+        memset(&tfb, '\0', sizeof (tfb));
         ptfb = &tfb;
         collapse_iovec((char **)&ptfb->Head, &ptfb->HeadLength, hdtr->headers, 
                        hdtr->numheaders, sock->cntxt);
     }
 
     while (bytes_to_send) {
@@ -297,20 +323,22 @@
         }
         else {
             /* Last call to TransmitFile() */
             nbytes = bytes_to_send;
             /* Collapse the trailers into a single buffer */
             if (hdtr && hdtr->numtrailers) {
+                memset(&tfb, '\0', sizeof (tfb));
                 ptfb = &tfb;
                 collapse_iovec((char**) &ptfb->Tail, &ptfb->TailLength, 
                                hdtr->trailers, hdtr->numtrailers, sock->cntxt);
             }
             /* Disconnect the socket after last send */
             if (flags & APR_SENDFILE_DISCONNECT_SOCKET) {
                 dwFlags |= TF_REUSE_SOCKET;
                 dwFlags |= TF_DISCONNECT;
+                disconnected = 1;
             }
         }
 
         overlapped.Offset = (DWORD)(curoff);
 #if APR_HAS_LARGE_FILES
         overlapped.OffsetHigh = (DWORD)(curoff >> 32);
@@ -321,24 +349,33 @@
                           0,              /* Number of bytes per send. 0=use default */
                           &overlapped,    /* OVERLAPPED structure */
                           ptfb,           /* header and trailer buffers */
                           dwFlags);       /* flags to control various aspects of TransmitFile */
         if (!rv) {
             status = apr_get_netos_error();
-            if (status == APR_FROM_OS_ERROR(ERROR_IO_PENDING)) {
-#ifdef WAIT_FOR_EVENT
-                rv = WaitForSingleObject(overlapped.hEvent, 
-                                         (DWORD)(sock->timeout >= 0 
-                                            ? sock->timeout : INFINITE));
-#else
-                rv = WaitForSingleObject((HANDLE) sock->sock, 
+            if ((status == APR_FROM_OS_ERROR(ERROR_IO_PENDING)) ||
+                (status == APR_FROM_OS_ERROR(WSA_IO_PENDING))) {
+                rv = WaitForSingleObject(wait_event, 
                                          (DWORD)(sock->timeout >= 0 
-                                            ? sock->timeout : INFINITE));
-#endif
-                if (rv == WAIT_OBJECT_0)
+                                                 ? sock->timeout : INFINITE));
+                if (rv == WAIT_OBJECT_0) {
                     status = APR_SUCCESS;
+                    if (!disconnected) {
+                        if (!GetOverlappedResult(wait_event, &overlapped, 
+                                                 &nbytes, FALSE)) {
+                            status = APR_FROM_OS_ERROR(GetLastError());
+                        }
+                        /* Ugly code alert: GetOverlappedResult returns
+                         * a count of all bytes sent. This loop only
+                         * tracks bytes sent out of the file.
+                         */
+                        else if (ptfb) {
+                            nbytes -= (ptfb->HeadLength + ptfb->TailLength);
+                        }
+                    }
+                }
                 else if (rv == WAIT_TIMEOUT)
                     status = APR_FROM_OS_ERROR(WAIT_TIMEOUT);
                 else if (rv == WAIT_ABANDONED) {
                     /* Hummm... WAIT_ABANDONDED is not an error code. It is
                      * a return specific to the Win32 WAIT functions that
                      * indicates that a thread exited while holding a
@@ -351,28 +388,23 @@
                     status = apr_get_os_error();
             }
         }
         if (status != APR_SUCCESS)
             break;
 
-        /* Assume the headers have been sent */
-        if (ptfb != NULL) {
-            *len += ptfb->HeadLength;
-            ptfb->HeadLength = 0;
-            ptfb->Head = NULL;
-        }
         bytes_to_send -= nbytes;
-        *len += nbytes;
         curoff += nbytes;
+        *len += nbytes;
+        /* Adjust len for any headers/trailers sent */
+        if (ptfb) {
+            *len += (ptfb->HeadLength + ptfb->TailLength);
+            ptfb = NULL;
+        }
     }
 
-
     if (status == APR_SUCCESS) {
-        if (ptfb && ptfb->TailLength)
-            *len += ptfb->TailLength;
-
         /* Mark the socket as disconnected, but do not close it.
          * Note: The application must have stored the socket prior to making
          * the call to apr_sendfile in order to either reuse it or close it.
          */
         if (flags & APR_SENDFILE_DISCONNECT_SOCKET) {
             sock->disconnected = 1;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockaddr.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockaddr.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockaddr.c	2002-04-06 06:15:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockaddr.c	2002-06-04 12:50:44.000000000 +0800
@@ -54,12 +54,13 @@
 
 #include "networkio.h"
 #include "apr_network_io.h"
 #include "apr_general.h"
 #include "apr_strings.h"
 #include "apr_lib.h"
+#include "apr_private.h"
 #include <string.h>
 
 static apr_status_t get_local_addr(apr_socket_t *sock)
 {
     sock->local_addr->salen = sizeof(sock->local_addr->sa);
     if (getsockname(sock->sock, (struct sockaddr *)&sock->local_addr->sa,
@@ -71,9 +72,17 @@
         /* XXX assumes sin_port and sin6_port at same offset */
         sock->local_addr->port = ntohs(sock->local_addr->sa.sin.sin_port);
         return APR_SUCCESS;
     }
 }
 
+#ifdef _WIN32_WCE
+/* WCE lacks getservbyname */
+static void *getservbyname(const char *name, const char *proto)
+{
+    return NULL;
+}
+
+#endif
 /* Include this here so we have get_local_addr defined... */
 #include "../unix/sa_common.c"
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockets.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockets.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockets.c	2002-04-02 01:52:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockets.c	2002-06-09 06:32:11.000000000 +0800
@@ -55,12 +55,13 @@
 #include "networkio.h"
 #include "apr_network_io.h"
 #include "apr_general.h"
 #include "apr_lib.h"
 #include "apr_portable.h"
 #include <string.h>
+#include "inherit.h"
 
 static char generic_inaddr_any[16] = {0}; /* big enough for IPv4 or IPv6 */
 
 static apr_status_t socket_cleanup(void *sock)
 {
     apr_socket_t *thesocket = sock;
@@ -139,14 +140,15 @@
     return APR_SUCCESS;
 } 
 
 APR_DECLARE(apr_status_t) apr_shutdown(apr_socket_t *thesocket,
                                        apr_shutdown_how_e how)
 {
-    int winhow;
+    int winhow = 0;
 
+#if SD_RECEIVE
     switch (how) {
         case APR_SHUTDOWN_READ: {
             winhow = SD_RECEIVE;
             break;
         }
         case APR_SHUTDOWN_WRITE: {
@@ -157,12 +159,13 @@
             winhow = SD_BOTH;
             break;
         }
         default:
             return APR_BADARG;
     }
+#endif
     if (shutdown(thesocket->sock, winhow) == 0) {
         return APR_SUCCESS;
     }
     else {
         return apr_get_netos_error();
     }
@@ -242,12 +245,23 @@
     (*new)->remote_addr->port = ntohs((*new)->remote_addr->sa.sin.sin_port);
     if (sock->local_port_unknown) {
         /* not likely for a listening socket, but theoretically possible :) */
         (*new)->local_port_unknown = 1;
     }
 
+#if APR_TCP_NODELAY_INHERITED
+    if (apr_is_option_set(sock->netmask, APR_TCP_NODELAY) == 1) {
+        apr_set_option(&(*new)->netmask, APR_TCP_NODELAY, 1);
+    }
+#endif /* TCP_NODELAY_INHERITED */
+#if APR_O_NONBLOCK_INHERITED
+    if (apr_is_option_set(sock->netmask, APR_SO_NONBLOCK) == 1) {
+        apr_set_option(&(*new)->netmask, APR_SO_NONBLOCK, 1);
+    }
+#endif /* APR_O_NONBLOCK_INHERITED */
+
     if (sock->local_interface_unknown ||
         !memcmp(sock->local_addr->ipaddr_ptr,
                 generic_inaddr_any,
                 sock->local_addr->ipaddr_len)) {
         /* If the interface address inside the listening socket's local_addr wasn't
          * up-to-date, we don't know local interface of the connected socket either.
@@ -407,13 +421,9 @@
     }
     (*sock)->local_port_unknown = (*sock)->local_interface_unknown = 1;
     (*sock)->sock = *thesock;
     return APR_SUCCESS;
 }
 
-APR_DECLARE_SET_INHERIT(socket) {
-    return;
-}
+APR_IMPLEMENT_INHERIT_SET(socket, inherit, cntxt, socket_cleanup)
 
-APR_DECLARE_UNSET_INHERIT(socket) {
-    return;
-}
+APR_IMPLEMENT_INHERIT_UNSET(socket, inherit, cntxt, socket_cleanup)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockopt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockopt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/network_io/win32/sockopt.c	2002-03-14 04:39:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/network_io/win32/sockopt.c	2002-06-06 10:58:16.000000000 +0800
@@ -121,115 +121,96 @@
             setsockopt(sock->sock, SOL_SOCKET, SO_SNDTIMEO, (char *) &zero, sizeof(zero));
         }
         sock->timeout = on;
         break;
     }
     case APR_SO_KEEPALIVE:
-        if (setsockopt(sock->sock, SOL_SOCKET, SO_KEEPALIVE, (void *)&one, sizeof(int)) == -1) {
-            return apr_get_netos_error();
+        if (on != apr_is_option_set(sock->netmask, APR_SO_KEEPALIVE)) {
+            if (setsockopt(sock->sock, SOL_SOCKET, SO_KEEPALIVE, (void *)&one, sizeof(int)) == -1) {
+                return apr_get_netos_error();
+            }
+            apr_set_option(&sock->netmask,APR_SO_KEEPALIVE, on);
         }
         break;
     case APR_SO_DEBUG:
-        if (setsockopt(sock->sock, SOL_SOCKET, SO_DEBUG, (void *)&one, sizeof(int)) == -1) {
-            return apr_get_netos_error();
+        if (on != apr_is_option_set(sock->netmask, APR_SO_DEBUG)) {
+            if (setsockopt(sock->sock, SOL_SOCKET, SO_DEBUG, (void *)&one, sizeof(int)) == -1) {
+                return apr_get_netos_error();
+            }
+            apr_set_option(&sock->netmask, APR_SO_DEBUG, on);
         }
         break;
     case APR_SO_REUSEADDR:
-        if (setsockopt(sock->sock, SOL_SOCKET, SO_REUSEADDR, (void *)&one, sizeof(int)) == -1) {
-            return apr_get_netos_error();
+        if (on != apr_is_option_set(sock->netmask, APR_SO_REUSEADDR)){
+            if (setsockopt(sock->sock, SOL_SOCKET, SO_REUSEADDR, (void *)&one, sizeof(int)) == -1) {
+                return apr_get_netos_error();
+            }
+            apr_set_option(&sock->netmask, APR_SO_REUSEADDR, on);
         }
         break;
     case APR_SO_NONBLOCK:
-        if (on) {
-            if ((stat = sononblock(sock->sock)) != APR_SUCCESS) 
-                return stat;
-        }
-        else {
-            if ((stat = soblock(sock->sock)) != APR_SUCCESS)
-                return stat;
+        if (apr_is_option_set(sock->netmask, APR_SO_NONBLOCK) != on){
+            if (on) {
+                if ((stat = sononblock(sock->sock)) != APR_SUCCESS) 
+                    return stat;
+            }
+            else {
+                if ((stat = soblock(sock->sock)) != APR_SUCCESS)
+                    return stat;
+            }
+            apr_set_option(&sock->netmask, APR_SO_NONBLOCK, on);
         }
         break;
     case APR_SO_LINGER:
     {
-        struct linger li;
-        li.l_onoff = on;
-        li.l_linger = MAX_SECS_TO_LINGER;
-        if (setsockopt(sock->sock, SOL_SOCKET, SO_LINGER, (char *) &li, sizeof(struct linger)) == -1) {
-            return apr_get_netos_error();
+        if (apr_is_option_set(sock->netmask, APR_SO_LINGER) != on){
+            struct linger li;
+            li.l_onoff = on;
+            li.l_linger = MAX_SECS_TO_LINGER;
+            if (setsockopt(sock->sock, SOL_SOCKET, SO_LINGER, (char *) &li, sizeof(struct linger)) == -1) {
+                return apr_get_netos_error();
+            }
+            apr_set_option(&sock->netmask, APR_SO_LINGER, on);
         }
         break;
     }
     case APR_TCP_NODELAY:
-        if (setsockopt(sock->sock, IPPROTO_TCP, TCP_NODELAY, (void *)&on, sizeof(int)) == -1) {
-            return apr_get_netos_error();
+        if (apr_is_option_set(sock->netmask, APR_TCP_NODELAY) != on){
+            if (setsockopt(sock->sock, IPPROTO_TCP, TCP_NODELAY, (void *)&on, sizeof(int)) == -1) {
+                return apr_get_netos_error();
+            }
+            apr_set_option(&sock->netmask, APR_TCP_NODELAY, on);
         }
         break;
     default:
         return APR_EINVAL;
         break;
     }
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_getsocketopt(apr_socket_t *sock,
                                            apr_int32_t opt, apr_int32_t *on)
 {
-#ifdef NETWARE
-    int sol_opt = 0;
-
     switch (opt) {
     case APR_SO_TIMEOUT: 
         /* Convert from milliseconds (windows units) to microseconds 
          * (APR units) */
         *on = (apr_int32_t)(sock->timeout * 1000);
         break;
     case APR_SO_DISCONNECTED:
         *on = sock->disconnected;
         break;
     case APR_SO_KEEPALIVE:
-        sol_opt = SO_KEEPALIVE;
-        break;
     case APR_SO_DEBUG:
-        sol_opt = SO_DEBUG;
-        break;
     case APR_SO_REUSEADDR:
-        sol_opt = SO_REUSEADDR;
-        break;
     case APR_SO_NONBLOCK:
     case APR_SO_LINGER:
     default:
-        return APR_ENOTIMPL;
-        break;
-    }
-    if (sol_opt) {
-        int sz = sizeof(apr_int32_t);
-
-        if (getsockopt(sock->sock, SOL_SOCKET, sol_opt, (char *)on, &sz) == -1) {
-            return apr_get_netos_error();
-        }
-    }
-#else
-    switch (opt) {
-    case APR_SO_TIMEOUT: 
-        /* Convert from milliseconds (windows units) to microseconds 
-         * (APR units) */
-        *on = (apr_int32_t)(sock->timeout * 1000);
-        break;
-    case APR_SO_DISCONNECTED:
-        *on = sock->disconnected;
-        break;
-    case APR_SO_KEEPALIVE:
-    case APR_SO_DEBUG:
-    case APR_SO_REUSEADDR:
-    case APR_SO_NONBLOCK:
-    case APR_SO_LINGER:
-    default:
-        return APR_ENOTIMPL;
-        break;
+        *on = apr_is_option_set(sock->netmask, opt);
     }
-#endif
     return APR_SUCCESS;
 }
 
 
 APR_DECLARE(apr_status_t) apr_gethostname(char *buf, int len,
                                           apr_pool_t *cont)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/NWGNUmakefile	2002-04-12 04:47:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/NWGNUmakefile	2002-06-13 08:40:50.000000000 +0800
@@ -365,15 +365,15 @@
 	$(CC) misc\unix\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
 $(OBJDIR)/%.o: threadproc/netware/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
 	$(CC) threadproc\netware\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
-$(OBJDIR)/%.o: dso/unix/%.c $(OBJDIR)\cc.opt
+$(OBJDIR)/%.o: dso/netware/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
-	$(CC) dso\unix\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
+	$(CC) dso\netware\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
 $(OBJDIR)/%.o: memory/unix/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
 	$(CC) memory\unix\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
 $(OBJDIR)/%.o: mmap/unix/%.c $(OBJDIR)\cc.opt
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/passwd/apr_md5.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/passwd/apr_md5.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/passwd/apr_md5.c	2002-03-14 04:39:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/passwd/apr_md5.c	2002-06-09 02:53:13.000000000 +0800
@@ -213,13 +213,13 @@
 {
     apr_status_t rv;
     int is_sb;
 
     /* TODO: remove the single-byte-only restriction from this code
      */
-    rv = apr_xlate_get_sb(xlate, &is_sb);
+    rv = apr_xlate_sb_get(xlate, &is_sb);
     if (rv != APR_SUCCESS) {
         return rv;
     }
     if (!is_sb) {
         return APR_EINVAL;
     }
@@ -696,13 +696,35 @@
     else {
         /*
          * It's not our algorithm, so feed it to crypt() if possible.
          */
 #if defined(WIN32) || defined(BEOS) || defined(NETWARE)
         apr_cpystrn(sample, passwd, sizeof(sample) - 1);
+#elif defined(CRYPT_R_CRYPTD)
+        CRYPTD buffer;
+
+        crypt_pw = crypt_r(passwd, hash, &buffer);
+        apr_cpystrn(sample, crypt_pw, sizeof(sample) - 1);
+#elif defined(CRYPT_R_STRUCT_CRYPT_DATA)
+        struct crypt_data buffer;
+
+        /* having to clear this seems bogus... GNU doc is
+         * confusing...  user report found from google says
+         * the crypt_data struct had to be cleared to get
+         * the same result as plain crypt()
+         */
+        memset(&buffer, 0, sizeof(buffer));
+        crypt_pw = crypt_r(passwd, hash, &buffer);
+        apr_cpystrn(sample, crypt_pw, sizeof(sample) - 1);
 #else
+        /* XXX if this is a threaded build, we should hold a mutex 
+         *     around the next two lines... but note that on some
+         *     platforms (e.g., Solaris, HP-UX, OS/390) crypt() 
+         *     returns a pointer to thread-specific data so we don't
+         *     want a mutex on those platforms
+         */
         crypt_pw = crypt(passwd, hash);
         apr_cpystrn(sample, crypt_pw, sizeof(sample) - 1);
 #endif
     }
     return (strcmp(sample, hash) == 0) ? APR_SUCCESS : APR_EMISMATCH;
 }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/passwd: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/shmem/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/shmem/win32/shm.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/shmem/win32/shm.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/shmem/win32/shm.c	2002-03-14 04:39:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/shmem/win32/shm.c	2002-06-04 12:41:53.000000000 +0800
@@ -115,18 +115,22 @@
 
     /* Compute the granualar multiple of the pagesize */
     size = memblock * (1 + (reqsize - 1) / memblock);
 
     if (!file) {
         /* Do Anonymous, which will be an inherited handle */
+#ifndef _WIN32_WCE
         hFile = INVALID_HANDLE_VALUE;
         sec.nLength = sizeof(SECURITY_ATTRIBUTES);
         sec.lpSecurityDescriptor = NULL;
         sec.bInheritHandle = TRUE;
-        mapkey = NULL;
         psec = &sec;
+#else
+        psec = NULL;
+#endif
+        mapkey = NULL;
     }
     else {
         /* Do file backed, which is not an inherited handle 
          * While we could open APR_EXCL, it doesn't seem that Unix
          * ever did.  Ignore that error here, but fail later when
          * we discover we aren't the creator of the file map object.
@@ -215,13 +219,21 @@
         mapkey = res_name_from_filename(file, 1, pool);
     }
 
 #if APR_HAS_UNICODE_FS
     IF_WIN_OS_IS_UNICODE
     {
+#ifndef _WIN32_WCE
         hMap = OpenFileMappingW(FILE_MAP_READ | FILE_MAP_WRITE, FALSE, mapkey);
+#else
+        /* The WCE 3.0 lacks OpenFileMapping. So we emulate one with
+         * opening the existing shmem and reading its size from the header 
+         */
+        hMap = CreateFileMappingW(INVALID_HANDLE_VALUE, NULL, 
+                                  PAGE_READWRITE, 0, sizeof(apr_shm_t), mapkey);
+#endif
     }
 #endif
 #if APR_HAS_ANSI_FS
     ELSE_WIN_OS_IS_ANSI
     {
         hMap = OpenFileMappingA(FILE_MAP_READ | FILE_MAP_WRITE, FALSE, mapkey);
@@ -237,19 +249,34 @@
         CloseHandle(hMap);
         return apr_get_os_error();
     }
     
     *m = (apr_shm_t *) apr_palloc(pool, sizeof(apr_shm_t));
     (*m)->pool = pool;
-    (*m)->hMap = hMap;
     (*m)->memblk = base;
-    (*m)->usrmem = (char*)base + sizeof(memblock_t);
     /* Real (*m)->mem->size could be recovered with VirtualQuery */
     (*m)->size = (*m)->memblk->size;
-    (*m)->length = (*m)->memblk->length;
+#if _WIN32_WCE
+    /* Reopen with real size  */
+    UnmapViewOfFile(base);
+    CloseHandle(hMap);
 
+    hMap = CreateFileMappingW(INVALID_HANDLE_VALUE, NULL, 
+                              PAGE_READWRITE, 0, (*m)->size, mapkey);
+    if (!hMap) {
+        return apr_get_os_error();
+    }
+    base = MapViewOfFile(hMap, FILE_MAP_READ | FILE_MAP_WRITE, 0, 0, 0);
+    if (!base) {
+        CloseHandle(hMap);
+        return apr_get_os_error();
+    }    
+#endif
+    (*m)->hMap = hMap;
+    (*m)->length = (*m)->memblk->length;
+    (*m)->usrmem = (char*)base + sizeof(memblock_t);
     apr_pool_cleanup_register((*m)->pool, *m, 
                               shm_cleanup, apr_pool_cleanup_null);
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_shm_detach(apr_shm_t *m)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/STATUS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/STATUS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/STATUS	2002-05-01 08:29:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/STATUS	2002-05-31 08:07:40.000000000 +0800
@@ -1,11 +1,13 @@
 APACHE PORTABLE RUNTIME (APR) LIBRARY STATUS:			-*-text-*-
-Last modified at [$Date: 2002/05/01 00:29:16 $]
+Last modified at [$Date: 2002/05/31 00:07:40 $]
 
 Release:
 
+    0.9.0-dev : in progress
+
     2.0a9   : released December 12, 2000
     2.0a8   : released November 20, 2000
     2.0a7   : released October 8, 2000
     2.0a6   : released August 18, 2000
     2.0a5   : released August 4, 2000
     2.0a4   : released June 7, 2000
@@ -41,18 +43,21 @@
       member was added for that platform.  That's a problem (and
       was when pid was abused as well) since nobody goes and cleans
       up hproc after the process is dead.  Can't do a pool cleanup,
       since apr_proc_create didn't allocate the apr_proc_t storage.
       (Aren't transparent types swell?)  Suggestions?
 
-    * The new lock API is a full replacement for the old API. Before
-      we do a major APR release, we must deprecate the old locks API,
-      lest we support 2 lock APIs in perpetuity.
+    * Almost every API in APR depends on pools, but pool semantics
+      aren't a good match for a lot of applications.  We need to find
+      a way to support alternate allocators polymorphically without
+      a significant performance penalty.
+
+    * extract the MAJOR version from apr_version.h and pass it to
+      libtool for use in applying version numbers to the shared
+      libraries.
 
-    * The new apr_global_mutex_t lock type must be implemented on
-      all platforms.
 
 CURRENT VOTES:
 
     * For the atomics code to be efficient it depends on instructions
       in newer sparc models. Unfortunately this means that binaries
       optimized at build-time for these architectures will not work
@@ -64,13 +69,47 @@
 
       +1: Aaron
       -0: Justin (I think it's warranted and fits with our portability
                   goals, but I'm not going to spend my time supporting it -
                   although I have spent more time on this than I'd like.
                   If someone wants to maintain it, more power to them.  If
-                  no one maintains it, this gets changed to a +1.)
+                  no one maintains it, this gets changed to a +1.),
+          BrianP,cliff,gregames:
+	  	  (All the reasons why we don't want the processor-specific
+                  code in APR are also reasons why I don't want to push
+                  that code up into the apps that use APR.  I'd rather
+                  spend some more time searching for a workable solution
+                  before we give up on atomics.  Perhaps we should let
+                  apps using the atomic API set a preprocessor flag to
+                  choose an "optimal" or "portable" version of the atomic
+                  ops?)
+          Sander (The positive sides of the atomics outweigh the negative
+                  in my opinion.  That said, I am not going to be the
+                  one spending time on this, since asm on various
+                  processors isn't really my game)
+          Jim,rbb:
+	  	  (who thinks we'll need to reformat this vote) Any time
+                  you make use of processor specific code for optimizations
+                  or capability, you run into portability concerns. The
+                  real option is to make atomics a compile-time option.
+                  YES means you use the atomics code, based on the *build*
+                  machine (and therefore carries some dependencies) or
+                  NO which maintains "universal" portabiity, which is
+                  what we have (but the default being NO atomics)
+      -1: IanH, BillS: 
+                  I don't agree. I think APR is the perfect place this kind of thing. 
+                  For platforms that support it is a big win, for ones which don't
+                  they are no worse off than the alternative.
+                  I can't maintain every asm implementation, but I am volunteering
+                  for sparc/x86.  (we could also grab the FreeBSD 
+                  implementations for HW they support)
+                  Unfortunatly I was out of action for a month when half the 
+                  hubub was going on. 
+                  The other alternative for non-native support is maybe to turn 
+                  it into a spin lock
+
 
 RELEASE NON-SHOWSTOPPERS BUT WOULD BE REAL NICE TO WRAP THESE UP:
 
     * The return type of a thread function (void *) is inconsistent with
       the type used in apr_thread_exit()/apr_thread_join() (apr_status_t).
       The thread function's return type should be changed to apr_status_t
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_cpystrn.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_cpystrn.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_cpystrn.c	2002-04-06 03:46:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_cpystrn.c	2002-05-17 22:58:27.000000000 +0800
@@ -240,20 +240,13 @@
 #if !APR_HAVE_STRDUP
 char *strdup(const char *str)
 {
     char *sdup;
     size_t len = strlen(str) + 1;
 
-    if (!(sdup = (char *) malloc(len))) {
-        /* ### whoops! we can't call Apache logging routines here... */
-#if 0
-        apr_log_error(APLOG_MARK, APLOG_STARTUP | APLOG_NOERRNO, 0, NULL,
-                      "Ouch! Out of memory in our strdup()!");
-#endif
-        return NULL;
-    }
+    sdup = (char *) malloc(len);
     memcpy(sdup, str, len);
 
     return sdup;
 }
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_snprintf.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_snprintf.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_snprintf.c	2002-03-16 01:42:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_snprintf.c	2002-05-07 13:20:55.000000000 +0800
@@ -547,13 +547,14 @@
         p = apr_ecvt(num, precision + 1, &decimal_point, is_negative, buf1);
 
     /*
      * Check for Infinity and NaN
      */
     if (apr_isalpha(*p)) {
-        *len = strlen(strcpy(buf, p));
+        *len = strlen(p);
+        memcpy(buf, p, *len + 1);
         *is_negative = FALSE;
         return (buf);
     }
 
     if (format == 'f') {
         if (decimal_point <= 0) {
@@ -807,14 +808,21 @@
             else
                 adjust_precision = adjust_width = NO;
 
             /*
              * Modifier check
              */
+#if defined(APR_INT64_T_FMT_LEN) && (APR_INT64_T_FMT_LEN == 3)
+            if ((*fmt == APR_INT64_T_FMT[0]) &&
+                (fmt[1] == APR_INT64_T_FMT[1])) {
+#elif defined(APR_INT64_T_FMT_LEN) && (APR_INT64_T_FMT_LEN == 2)
+            if (*fmt == APR_INT64_T_FMT[0]) {
+#else
             if (strncmp(fmt, APR_INT64_T_FMT, 
                              sizeof(APR_INT64_T_FMT) - 2) == 0) {
+#endif
                 /* Need to account for trailing 'd' and null in sizeof() */
                 var_type = IS_QUAD;
                 fmt += (sizeof(APR_INT64_T_FMT) - 2);
             }
             else if (*fmt == 'q') {
                 var_type = IS_QUAD;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_strings.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_strings.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings/apr_strings.c	2002-03-14 04:39:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/strings/apr_strings.c	2002-05-14 00:09:22.000000000 +0800
@@ -174,12 +174,50 @@
 
     *cp = '\0';
 
     return res;
 }
 
+APR_DECLARE_NONSTD(char *) apr_pstrcatv(apr_pool_t *a, const struct iovec *vec,
+                                        apr_size_t nvec, apr_size_t *nbytes)
+{
+    apr_size_t i;
+    apr_size_t len;
+    const struct iovec *src;
+    char *res;
+    char *dst;
+
+    /* Pass one --- find length of required string */
+    len = 0;
+    src = vec;
+    for (i = nvec; i; i--) {
+        len += src->iov_len;
+        src++;
+    }
+    if (nbytes) {
+        *nbytes = len;
+    }
+
+    /* Allocate the required string */
+    res = (char *) apr_palloc(a, len + 1);
+    
+    /* Pass two --- copy the argument strings into the result space */
+    src = vec;
+    dst = res;
+    for (i = nvec; i; i--) {
+        memcpy(dst, src->iov_base, src->iov_len);
+        dst += src->iov_len;
+        src++;
+    }
+
+    /* Return the result string */
+    *dst = '\0';
+
+    return res;
+}
+
 #if (!APR_HAVE_MEMCHR)
 void *memchr(const void *s, int c, size_t n)
 {
     const char *cp;
 
     for (cp = s; n > 0; n--, cp++) {
@@ -227,13 +265,13 @@
     }
     else {
 	negative = 0;
     }
     *start = 0;
     do {
-	*--start = '0' + (n % 10);
+	*--start = (char)('0' + (n % 10));
 	n /= 10;
     } while (n);
     if (negative) {
 	*--start = '-';
     }
     return start;
@@ -262,13 +300,13 @@
     }
     return start;
 }
 
 APR_DECLARE(char *) apr_strfsize(apr_off_t size, char *buf)
 {
-    const char ord[] = "KMTPE";
+    const char ord[] = "KMGTPE";
     const char *o = ord;
     int remain;
 
     if (size < 0) {
         return strcpy(buf, "  - ");
     }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/strings: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/tables/apr_tables.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/tables/apr_tables.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/tables/apr_tables.c	2002-03-14 04:39:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/tables/apr_tables.c	2002-06-12 02:07:03.000000000 +0800
@@ -66,15 +66,12 @@
 #include "apr_tables.h"
 #include "apr_strings.h"
 #include "apr_lib.h"
 #if APR_HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
-#ifdef HAVE_MALLOC_H
-#include <malloc.h>
-#endif
 #if APR_HAVE_STRING_H
 #include <string.h>
 #endif
 #if APR_HAVE_STRINGS_H
 #include <strings.h>
 #endif
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/tables: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.dsp	2002-03-15 23:40:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.dsp	2002-05-21 21:58:54.000000000 +0800
@@ -186,10 +186,10 @@
 # Begin Source File
 
 SOURCE=.\Makefile.in
 # End Source File
 # Begin Source File
 
-SOURCE=.\MakeWin32Make.pl
+SOURCE=.\MakeWin32Make.awk
 # End Source File
 # End Target
 # End Project
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.dsw /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.dsw
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.dsw	2002-02-18 14:00:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.dsw	2002-05-31 12:37:27.000000000 +0800
@@ -27,12 +27,27 @@
     Project_Dep_Name apr
     End Project Dependency
 }}}
 
 ###############################################################################
 
+Project: "aprtest"=".\aprtest.dsp" - Package Owner=<4>
+
+Package=<5>
+{{{
+}}}
+
+Package=<4>
+{{{
+    Begin Project Dependency
+    Project_Dep_Name apr
+    End Project Dependency
+}}}
+
+###############################################################################
+
 Project: "libapr"="..\libapr.dsp" - Package Owner=<4>
 
 Package=<5>
 {{{
 }}}
 
@@ -54,23 +69,44 @@
     Project_Dep_Name libapr
     End Project Dependency
 }}}
 
 ###############################################################################
 
-Project: "aprtest"=".\aprtest.dsp" - Package Owner=<4>
+Project: "testapp"=".\testapp.dsp" - Package Owner=<4>
+
+Package=<5>
+{{{
+}}}
+
+Package=<4>
+{{{
+    Begin Project Dependency
+    Project_Dep_Name apr
+    End Project Dependency
+    Begin Project Dependency
+    Project_Dep_Name apr_app
+    End Project Dependency
+}}}
+
+###############################################################################
+
+Project: "testappnt"=".\testappnt.dsp" - Package Owner=<4>
 
 Package=<5>
 {{{
 }}}
 
 Package=<4>
 {{{
     Begin Project Dependency
     Project_Dep_Name apr
     End Project Dependency
+    Begin Project Dependency
+    Project_Dep_Name apr_app
+    End Project Dependency
 }}}
 
 ###############################################################################
 
 Global:
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.win /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.win
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/aprtest.win	2001-07-28 02:37:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/aprtest.win	2002-05-21 21:58:54.000000000 +0800
@@ -8,11 +8,11 @@
 TARGET=ALL
 !ENDIF 
 
 $(TARGET): Makefile
 	$(MAKE) /nologo /f Makefile $(TARGET)
 
-Makefile: Makefile.in MakeWin32Make.pl
-	perl MakeWin32Make.pl
+Makefile: Makefile.in MakeWin32Make.awk
+	awk -f MakeWin32Make.awk <Makefile.in >Makefile
 
 clean:
-        del makefile *.obj *.exe *.idb *.pdb
\ No newline at end of file
+        del Makefile *.obj *.exe *.idb *.pdb
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/Makefile.in	2002-04-22 09:24:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/Makefile.in	2002-05-14 00:35:05.000000000 +0800
@@ -1,9 +1,15 @@
 srcdir = @srcdir@
 VPATH = @srcdir@
 
+NONPORTABLE = \
+	testshm@EXEEXT@ \
+	testprocmutex@EXEEXT@ \
+	testglobalmutex@EXEEXT@ \
+	testregex@EXEEXT@
+
 PROGRAMS = \
 	client@EXEEXT@ \
 	sendfile@EXEEXT@ \
 	server@EXEEXT@ \
 	testfile@EXEEXT@ \
 	testdir@EXEEXT@ \
@@ -16,13 +22,12 @@
 	testlock@EXEEXT@ \
 	testlockperf@EXEEXT@ \
 	testtime@EXEEXT@ \
 	testargs@EXEEXT@ \
 	testud@EXEEXT@ \
 	testmmap@EXEEXT@ \
-	testshm@EXEEXT@ \
 	testshmproducer@EXEEXT@ \
 	testshmconsumer@EXEEXT@ \
 	testpipe@EXEEXT@ \
 	testoc@EXEEXT@ \
 	testuuid@EXEEXT@ \
 	testsockopt@EXEEXT@ \
@@ -31,24 +36,22 @@
 	testpoll@EXEEXT@ \
 	testhash@EXEEXT@ \
 	occhild@EXEEXT@ \
 	teststr@EXEEXT@ \
 	testuser@EXEEXT@ \
 	testsockets@EXEEXT@ \
-	testprocmutex@EXEEXT@ \
-	testglobalmutex@EXEEXT@ \
 	testvsn@EXEEXT@ \
 	testsleep@EXEEXT@ \
 	testrand@EXEEXT@ \
 	testdup@EXEEXT@ \
 	testatomic@EXEEXT@ \
-	testregex@EXEEXT@ \
-	testpools@EXEEXT@
+	testpools@EXEEXT@ \
+	testmutexscope@EXEEXT@
 
 
-TARGETS = $(PROGRAMS)
+TARGETS = $(PROGRAMS) $(NONPORTABLE)
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
 
 LOCAL_LIBS=../libapr.la
 
@@ -185,7 +188,10 @@
 testrand@EXEEXT@: testrand.lo $(LOCAL_LIBS)
 	$(LINK) testrand.lo $(LOCAL_LIBS) $(ALL_LIBS)
 
 testpools@EXEEXT@: testpools.lo $(LOCAL_LIBS)
 	$(LINK) testpools.lo $(LOCAL_LIBS) $(ALL_LIBS)
 
+testmutexscope@EXEEXT@: testmutexscope.lo $(LOCAL_LIBS)
+	$(LINK) testmutexscope.lo $(LOCAL_LIBS) $(ALL_LIBS)
+
 # DO NOT REMOVE
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test: MakeWin32Make.awk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test: MakeWin32Make.pl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test: testapp.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test: testapp.dsp
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test: testappnt.dsp
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/testdso.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/testdso.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/testdso.c	2002-03-14 04:39:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/testdso.c	2002-05-10 11:56:19.000000000 +0800
@@ -64,17 +64,17 @@
 #include <unistd.h>
 #endif
 
 #ifdef NETWARE
 #define LIB_NAME "mod_test.nlm"
 #else
- #ifndef BEOS
- #define LIB_NAME ".libs/mod_test.so"
- #else
- #define LIB_NAME "mod_test.so"
- #endif
+# ifndef BEOS
+#  define LIB_NAME ".libs/mod_test.so"
+# else
+#  define LIB_NAME "mod_test.so"
+# endif
 #endif
 
 int main (int argc, char ** argv)
 {
     apr_dso_handle_t *h = NULL;
     apr_dso_handle_sym_t func1 = NULL;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test: testmutexscope.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/testtime.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/testtime.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/test/testtime.c	2002-04-15 08:01:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/test/testtime.c	2002-06-10 04:25:50.000000000 +0800
@@ -59,12 +59,29 @@
 #include <errno.h>
 #include <stdio.h>
 #include "test_apr.h"
 
 #define STR_SIZE 45
 
+static const char* print_time (apr_pool_t *pool, const apr_time_exp_t *xt)
+{
+    return apr_psprintf (pool,
+                         "%04d-%02d-%02d %02d:%02d:%02d.%06d %+05d [%d %s]%s",
+                         xt->tm_year + 1900,
+                         xt->tm_mon,
+                         xt->tm_mday,
+                         xt->tm_hour,
+                         xt->tm_min,
+                         xt->tm_sec,
+                         xt->tm_usec,
+                         xt->tm_gmtoff,
+                         xt->tm_yday + 1,
+                         apr_day_snames[xt->tm_wday],
+                         (xt->tm_isdst ? " DST" : ""));
+}
+
 int main(void)
 {
     apr_time_t now;
     apr_time_exp_t xt, xt2;
     apr_time_t imp;
     apr_pool_t *p;
@@ -81,25 +98,44 @@
 
     printf("%-60s", "    apr_time_now()");
     now = apr_time_now();
     printf("OK\n");
 
     STD_TEST_NEQ("    apr_time_exp_gmt", apr_time_exp_gmt(&xt, now))
-    
+    printf("        (%s)\n", print_time(p, &xt));
+
     STD_TEST_NEQ("    apr_time_exp_lt", apr_time_exp_lt(&xt2, now))
+    printf("        (%s)\n", print_time(p, &xt2));
 
     STD_TEST_NEQ("    apr_time_exp_get (GMT)", apr_time_exp_get(&imp, &xt))
 
     printf("%-60s", "    checking GMT explode == implode");
-    if (imp != now) {
+    hr_off_64 = (apr_int64_t) xt.tm_gmtoff * APR_USEC_PER_SEC;
+    if (imp != now + hr_off_64) {
 	printf("mismatch\n"
                 "\t\tapr_now()                %" APR_INT64_T_FMT "\n"
                 "\t\tapr_implode() returned   %" APR_INT64_T_FMT "\n"
                 "\t\terror delta was          %" APR_TIME_T_FMT "\n"
-                "\t\tshould have been         0\n",
-                now, imp, imp-now);
+                "\t\tshould have been         %" APR_INT64_T_FMT "\n",
+                now, imp, imp-now, hr_off_64);
+       exit(-1);
+    }
+    printf("OK\n");
+
+    STD_TEST_NEQ("    apr_time_exp_get (localtime)",
+                 apr_time_exp_get(&imp, &xt2))
+
+    printf("%-60s", "    checking localtime explode == implode");
+    hr_off_64 = (apr_int64_t) xt2.tm_gmtoff * APR_USEC_PER_SEC;
+    if (imp != now + hr_off_64) {
+        printf("mismatch\n"
+               "\t\tapr_now()                %" APR_INT64_T_FMT "\n"
+               "\t\tapr_implode() returned   %" APR_INT64_T_FMT "\n"
+               "\t\terror delta was          %" APR_TIME_T_FMT "\n"
+               "\t\tshould have been         %" APR_INT64_T_FMT "\n",
+               now, imp, imp-now, hr_off_64);
 	exit(-1);
     }
     printf("OK\n");
 
     STD_TEST_NEQ("    apr_implode_gmt (GMT)",
                  apr_implode_gmt(&imp, &xt))
@@ -175,12 +211,13 @@
         printf("Failed! :(\n");
         printf("Difference is %" APR_INT64_T_FMT " (should be %"
                APR_INT64_T_FMT")\n", imp - now, hr_off_64);
         exit(-1);
     }
     printf("OK\n");
-    printf("        ( %lld - %lld = %lld )\n", imp, now, imp - now);
- 
+    printf("        ( %" APR_TIME_T_FMT " - %" APR_TIME_T_FMT
+           " = %" APR_INT64_T_FMT " )\n", imp, now, imp - now);
+
     printf("\nTest Complete.\n");
     return 0;
 }    
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/netware/proc.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/netware/proc.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/netware/proc.c	2002-04-12 04:49:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/netware/proc.c	2002-06-11 00:20:52.000000000 +0800
@@ -290,156 +290,50 @@
 									const char *progname, 
 									const char * const *args, 
 									const char * const *env,
                               		apr_procattr_t *attr, 
                               		apr_pool_t *pool)
 {
-    int i, envCount=0;
-    const char **newargs;
-    char **newenv;
-    NXVmId_t newVM;
-    unsigned long flags = NX_VM_SAME_ADDRSPACE;
-    char **sysenv = NULL;
-
-    NXNameSpec_t nameSpec;
-    NXExecEnvSpec_t envSpec;
-
-    /* Set up the info for the NLM to be started */
-    nameSpec.ssType = NX_OBJ_FILE;
-    nameSpec.ssPathCtx = NULL;
-    nameSpec.ssPath = (void*)progname;
-
-    /* Count how many arguments there are and assign them 
-        to the environent */
-    for (i=0;args && args[i];i++);
-    envSpec.esArgc = i;
-    envSpec.esArgv = (void**)args;
-
-    getenv("ENV"); /* just needs to be here for now */
-    sysenv = nxGetEnviron();
-    /* Count how many environment variables there are in the
-        system, add any new environment variables and place
-        them in the environment. */
-    for (i=0;env && env[i];i++);
-    for (envCount=0;sysenv && sysenv[envCount];envCount++);
-    if ((envCount + i) > 0) {
-        newenv = (char **) NXMemAlloc(sizeof(char *) * (envCount+i+1), 0);
-        if (!newenv)
-            return APR_ENOMEM;
-        for (i=0;sysenv && sysenv[i];i++) {
-            newenv[i] = (char*)sysenv[i];
-        }
-        for (i=0;env && env[i];i++) {
-            newenv[envCount+i-1] = (char*)env[i];
-        }
-        newenv[envCount+i] = NULL;
+	wiring_t		wire;
+    int             addr_space;
 
-        envSpec.esEnv = (void**)newenv;
+    wire.infd  = attr->child_in ? attr->child_in->filedes : FD_UNUSED;
+    wire.outfd = attr->child_out ? attr->child_out->filedes : FD_UNUSED;
+    wire.errfd = attr->child_err ? attr->child_err->filedes : FD_UNUSED;
+
+    newproc->in = attr->parent_in;
+    newproc->out = attr->parent_out;
+    newproc->err = attr->parent_err;
+
+    addr_space = attr->detached ? 0 : PROC_CURRENT_SPACE;
+
+    if ((newproc->pid = processve(progname, addr_space, (const char**)env, &wire, 
+        NULL, NULL, (const char **)args)) == 0) {
+        return errno;
     }
-    else
-        envSpec.esEnv = NULL;
 
-    envSpec.esStdin.ssType = NX_OBJ_FIFO;
-    envSpec.esStdin.ssHandle = -1;
-    envSpec.esStdin.ssPathCtx = 0;
     if (attr->child_in) {
         apr_pool_cleanup_kill(apr_file_pool_get(attr->child_in), 
-                              attr->child_in, apr_netware_pipe_cleanup);
-        envSpec.esStdin.ssPath = attr->child_in->fname;
+                              attr->child_in, apr_unix_file_cleanup);
         apr_file_close(attr->child_in);
-        if (attr->parent_in) {
-            close(attr->parent_in->filedes);
-    	    attr->parent_in->filedes = pipe_open(attr->parent_in->fname, O_WRONLY);
-            /* XXX take this out when pipe blocking is fixed */
-    		fcntl(attr->parent_in->filedes, F_SETFL, 0);
-        }
-    }
-    else if (attr->parent_in) {
-        envSpec.esStdin.ssPath = attr->parent_in->fname;
-        close(attr->parent_in->filedes);
-    	attr->parent_in->filedes = pipe_open(attr->parent_in->fname, O_WRONLY);
-        /* XXX take this out when pipe blocking is fixed */
-  		fcntl(attr->parent_in->filedes, F_SETFL, 0);
-    }
-    else {
-        envSpec.esStdin.ssPath = NULL;
     }
-
-    envSpec.esStdout.ssType = NX_OBJ_FIFO;
-    envSpec.esStdout.ssHandle = -1;
-    envSpec.esStdout.ssPathCtx = 0;
     if (attr->child_out) {
-        apr_pool_cleanup_kill(apr_file_pool_get(attr->child_out),
-                              attr->child_out, apr_netware_pipe_cleanup);
-        envSpec.esStdout.ssPath = attr->child_out->fname;
+        apr_pool_cleanup_kill(apr_file_pool_get(attr->child_out), 
+                              attr->child_out, apr_unix_file_cleanup);
         apr_file_close(attr->child_out);
-        if (attr->parent_out) {
-            close(attr->parent_out->filedes);
-    	    attr->parent_out->filedes = pipe_open(attr->parent_out->fname, O_RDONLY);
-            /* XXX take this out when pipe blocking is fixed */
-            fcntl(attr->parent_out->filedes, F_SETFL, 0);
-        }
-    }
-    else if (attr->parent_out) {
-        envSpec.esStdout.ssPath = attr->parent_out->fname;
-        close(attr->parent_out->filedes);
-    	attr->parent_out->filedes = pipe_open(attr->parent_out->fname, O_RDONLY);
-        /* XXX take this out when pipe blocking is fixed */
-        fcntl(attr->parent_out->filedes, F_SETFL, 0);
-    }
-    else {
-        envSpec.esStdout.ssPath = NULL;
     }
-
-    envSpec.esStderr.ssType = NX_OBJ_FIFO;
-    envSpec.esStderr.ssHandle = -1;
-    envSpec.esStderr.ssPathCtx = 0;
     if (attr->child_err) {
-        apr_pool_cleanup_kill(apr_file_pool_get(attr->child_err),
-                              attr->child_err, apr_netware_pipe_cleanup);
-        envSpec.esStderr.ssPath = attr->child_err->fname;
+        apr_pool_cleanup_kill(apr_file_pool_get(attr->child_err), 
+                              attr->child_err, apr_unix_file_cleanup);
         apr_file_close(attr->child_err);
-        if (attr->parent_err) {
-            close(attr->parent_err->filedes);
-    	    attr->parent_err->filedes = pipe_open(attr->parent_err->fname, O_RDONLY);
-            /* XXX take this out when pipe blocking is fixed */
-            fcntl(attr->parent_err->filedes, F_SETFL, 0);
-        }
-    }
-    else if (attr->parent_err) {
-        envSpec.esStderr.ssPath = attr->parent_err->fname;
-        close(attr->parent_err->filedes);
-    	attr->parent_err->filedes = pipe_open(attr->parent_err->fname, O_RDONLY);
-        /* XXX take this out when pipe blocking is fixed */
-        fcntl(attr->parent_err->filedes, F_SETFL, 0);
-    }
-    else {
-        envSpec.esStderr.ssPath = NULL;
     }
 
-    if (attr->detached) {
-        flags = NX_VM_CREATE_DETACHED;
-    }
-    
-    newproc->in = attr->parent_in;
-    newproc->err = attr->parent_err;
-    newproc->out = attr->parent_out;
-    if (NXVmSpawn(&nameSpec, &envSpec, flags, &newVM) != 0) {
-        apr_file_close(attr->parent_in);
-        apr_file_close(attr->parent_out);
-        apr_file_close(attr->parent_err);
-        return errno;
-    }
-    else { 
-        newproc->pid = newVM;
-        apr_pool_cleanup_register(pool, (void *)newproc, apr_netware_proc_cleanup,
-                         apr_pool_cleanup_null);
-    }
-    /*if (sysenv)
-        free(sysenv);
-    */
+
+//    apr_pool_cleanup_register(pool, (void *)newproc, apr_netware_proc_cleanup,
+//        apr_pool_cleanup_null);
+
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_proc_wait_all_procs(apr_proc_t *proc,
                                                   int *exitcode,
                                                   apr_exit_why_e *exitwhy,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/netware/signals.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/netware/signals.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/netware/signals.c	2002-03-14 04:39:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/netware/signals.c	2002-06-09 02:47:56.000000000 +0800
@@ -56,15 +56,12 @@
 #include <nks/thread.h>
 #include "apr_private.h"
 #include "apr_pools.h"
 #include "apr_signal.h"
 #include "apr_strings.h"
 
-#define APR_WANT_SIGNAL
-#include "apr_want.h"
-
 #include <assert.h>
 #if APR_HAS_THREADS && APR_HAVE_PTHREAD_H
 #include <pthread.h>
 #endif
 
 APR_DECLARE(apr_status_t) apr_proc_kill(apr_proc_t *proc, int signum)
@@ -74,13 +71,13 @@
 
 
 void apr_signal_init(apr_pool_t *pglobal)
 {
 }
 
-const char *apr_signal_get_description(int signum)
+const char *apr_signal_description_get(int signum)
 {
     switch (signum)
     {
     case SIGABRT:
         return "Abort";
     case SIGFPE:
@@ -109,6 +106,11 @@
 {
     int rv = 0;
 
     return rv;
 }
 
+/* Deprecated */
+const char *apr_signal_get_description(int signum)
+{
+    return apr_signal_description_get(signum);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/os2/thread.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/os2/thread.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/os2/thread.c	2002-03-20 01:53:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/os2/thread.c	2002-05-23 07:55:27.000000000 +0800
@@ -189,12 +189,13 @@
 }
 
 
 
 void apr_thread_yield()
 {
+    DosSleep(0);
 }
 
 
 
 APR_DECLARE(apr_status_t) apr_os_thread_get(apr_os_thread_t **thethd, apr_thread_t *thd)
 {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/unix/signals.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/unix/signals.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/unix/signals.c	2002-04-20 01:21:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/unix/signals.c	2002-06-09 02:47:56.000000000 +0800
@@ -56,15 +56,12 @@
 #include "threadproc.h"
 #include "apr_private.h"
 #include "apr_pools.h"
 #include "apr_signal.h"
 #include "apr_strings.h"
 
-#define APR_WANT_SIGNAL
-#include "apr_want.h"
-
 #include <assert.h>
 #if APR_HAS_THREADS && APR_HAVE_PTHREAD_H
 #include <pthread.h>
 #endif
 
 APR_DECLARE(apr_status_t) apr_proc_kill(apr_proc_t *proc, int signum)
@@ -87,12 +84,23 @@
     return APR_SUCCESS;
 }
 
 
 #if APR_HAVE_SIGACTION
 
+#ifdef DARWIN
+static void avoid_zombies(int signo)
+{
+    int exit_status;
+
+    while (waitpid(-1, &exit_status, WNOHANG) > 0) {
+        /* do nothing */
+    }
+}
+#endif /* DARWIN */
+
 /*
  * Replace standard signal() with the more reliable sigaction equivalent
  * from W. Richard Stevens' "Advanced Programming in the UNIX Environment"
  * (the version that does not automatically restart system calls).
  */
 APR_DECLARE(apr_sigfunc_t *) apr_signal(int signo, apr_sigfunc_t * func)
@@ -111,13 +119,22 @@
     /* this is required on Tru64 to cause child processes to
      * disappear gracefully - XPG4 compatible 
      */
     if ((signo == SIGCHLD) && (func == SIG_IGN)) {
         act.sa_flags |= SA_NOCLDWAIT;
     }
-   #endif
+#endif
+#ifdef DARWIN
+    /* ignoring SIGCHLD or leaving the default disposition doesn't avoid zombies,
+     * and there is no SA_NOCLDWAIT flag, so catch the signal and reap status in 
+     * the handler to avoid zombies
+     */
+    if ((signo == SIGCHLD) && (func == SIG_IGN)) {
+        act.sa_handler = avoid_zombies;
+    }
+#endif
     if (sigaction(signo, &act, &oact) < 0)
         return SIG_ERR;
     return oact.sa_handler;
 }
 
 #endif /* HAVE_SIGACTION */
@@ -125,13 +142,13 @@
 
 #ifdef SYS_SIGLIST_DECLARED
 
 void apr_signal_init(apr_pool_t *pglobal)
 {
 }
-const char *apr_signal_get_description(int signum)
+const char *apr_signal_description_get(int signum)
 {
     return sys_siglist[signum];
 }
 
 #else /* !SYS_SIGLIST_DECLARED */
 
@@ -264,13 +281,13 @@
 
     for (sig = 0; sig < APR_NUMSIG; ++sig)
         if (signal_description[sig] == NULL)
             signal_description[sig] = apr_psprintf(pglobal, "signal #%d", sig);
 }
 
-const char *apr_signal_get_description(int signum)
+const char *apr_signal_description_get(int signum)
 {
     return
         signum < APR_NUMSIG
         ? signal_description[signum]
         : "unknown signal (number)";
 }
@@ -433,6 +450,12 @@
     }
 #endif
     return rv;
 }
 
 #endif
+
+/* Deprecated */
+const char *apr_signal_get_description(int signum)
+{
+    return apr_signal_description_get(signum);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/win32/proc.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/win32/proc.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/win32/proc.c	2002-04-29 21:40:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/win32/proc.c	2002-06-04 12:53:51.000000000 +0800
@@ -58,16 +58,34 @@
 #include "apr_thread_proc.h"
 #include "apr_file_io.h"
 #include "apr_general.h"
 #include "apr_strings.h"
 #include "apr_portable.h"
 #include <stdlib.h>
+#if APR_HAVE_SIGNAL_H
 #include <signal.h>
+#endif
 #include <string.h>
+#if APR_HAVE_PROCESS_H
 #include <process.h>
+#endif
 
+#ifdef _WIN32_WCE
+#ifndef DETACHED_PROCESS
+#define DETACHED_PROCESS 0
+#endif
+#ifndef CREATE_UNICODE_ENVIRONMENT
+#define CREATE_UNICODE_ENVIRONMENT 0
+#endif
+#ifndef STARTF_USESHOWWINDOW
+#define STARTF_USESHOWWINDOW 0
+#endif
+#ifndef SW_HIDE
+#define SW_HIDE 0
+#endif
+#endif
 /* 
  * some of the ideas expressed herein are based off of Microsoft
  * Knowledge Base article: Q190351
  *
  */
 
@@ -109,12 +127,15 @@
 
     return APR_SUCCESS;
 }
 
 static apr_status_t make_handle_private(apr_file_t *file)
 {
+#ifdef _WIN32_WCE
+    return APR_ENOTIMPL;
+#else
     HANDLE hproc = GetCurrentProcess();
     HANDLE filehand = file->filehand;
 
     /* Create new non-inheritable versions of handles that
      * the child process doesn't care about. Otherwise, the child
      * inherits these handles; resulting in non-closeable handles
@@ -126,17 +147,21 @@
         return apr_get_os_error();
     /* 
      * Close the inerhitable handle we don't need anymore.
      */
     CloseHandle(filehand);
     return APR_SUCCESS;
+#endif
 }
 
 static apr_status_t make_inheritable_duplicate(apr_file_t *original,
                                                apr_file_t *duplicate)
 {
+#ifdef _WIN32_WCE
+    return APR_ENOTIMPL;
+#else
     if (original == NULL)
         return APR_SUCCESS;
 
     /* XXX: Can't use apr_file_dup here because it creates a non-inhertible 
      * handle, and apr_open_file'd apr_file_t's are non-inheritable,
      * so we must assume we need to make an inheritable handle.
@@ -150,12 +175,13 @@
                              hproc, &duplicate->filehand, 0,
                              TRUE, DUPLICATE_SAME_ACCESS))
             return apr_get_os_error();
     }
 
     return APR_SUCCESS;
+#endif
 }
 
 APR_DECLARE(apr_status_t) apr_procattr_io_set(apr_procattr_t *attr,
                                              apr_int32_t in, 
                                              apr_int32_t out,
                                              apr_int32_t err)
@@ -406,12 +432,13 @@
         }
         else {
             cmdline = apr_pstrcat(pool, cmdline, " ", args[i], NULL);
         }
     }
 
+#ifndef _WIN32_WCE
     if (attr->cmdtype == APR_SHELLCMD) {
         char *shellcmd = getenv("COMSPEC");
         if (!shellcmd) {
             return APR_EINVAL;
         }
         if (shellcmd[0] == '"') {
@@ -430,13 +457,15 @@
             cmdline = apr_pstrcat(pool, shellcmd, " /C ", argv0, cmdline, NULL);
         }
         else {
             cmdline = apr_pstrcat(pool, shellcmd, " /C \"", argv0, cmdline, "\"", NULL);
         }
     } 
-    else {
+    else 
+#endif
+    {
         /* Win32 is _different_ than unix.  While unix will find the given
          * program since it's already chdir'ed, Win32 cannot since the parent
          * attempts to open the program with it's own path.
          * ###: This solution isn't much better - it may defeat path searching
          * when the path search was desired.  Open to further discussion.
          */
@@ -610,12 +639,13 @@
         memset(&si, 0, sizeof(si));
         si.cb = sizeof(si);
         if (attr->detached) {
             si.dwFlags |= STARTF_USESHOWWINDOW;
             si.wShowWindow = SW_HIDE;
         }
+#ifndef _WIN32_WCE
         if ((attr->child_in && attr->child_in->filehand)
             || (attr->child_out && attr->child_out->filehand)
             || (attr->child_err && attr->child_err->filehand))
         {
             si.dwFlags |= STARTF_USESTDHANDLES;
             if (attr->child_in)
@@ -630,12 +659,22 @@
                             NULL, NULL,        /* Proc & thread security attributes */
                             TRUE,              /* Inherit handles */
                             dwCreationFlags,   /* Creation flags */
                             pEnvBlock,         /* Environment block */
                             wcwd,              /* Current directory name */
                             &si, &pi);
+#else
+        rv = CreateProcessW(wprg, wcmd,        /* Executable & Command line */
+                            NULL, NULL,        /* Proc & thread security attributes */
+                            FALSE,             /* must be 0 */
+                            dwCreationFlags,   /* Creation flags */
+                            NULL,              /* Environment block must be NULL */
+                            NULL,              /* Current directory name must be NULL*/
+                            NULL,              /* STARTUPINFO not supported */
+                            &pi);
+#endif
     }
 #endif /* APR_HAS_UNICODE_FS */
 #if APR_HAS_ANSI_FS
     ELSE_WIN_OS_IS_ANSI
     {
         STARTUPINFOA si;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/win32/signals.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/win32/signals.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/threadproc/win32/signals.c	2002-03-14 04:39:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/threadproc/win32/signals.c	2002-06-09 02:47:56.000000000 +0800
@@ -78,10 +78,16 @@
     return APR_SUCCESS;
 }
 
 void apr_signal_init(apr_pool_t *pglobal)
 {
 }
-const char *apr_signal_get_description(int signum)
+const char *apr_signal_description_get(int signum)
 {
     return "unknown signal (not supported)";
 }
+
+/* Deprecated */
+const char *apr_signal_get_description(int signum)
+{
+    return apr_signal_description_get(signum);
+}
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/time/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/time/unix/time.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/time/unix/time.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/time/unix/time.c	2002-04-15 08:01:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/time/unix/time.c	2002-06-09 04:04:26.000000000 +0800
@@ -360,6 +360,21 @@
     t2 = mktime(&t);
     server_gmt_offset = (apr_int32_t) difftime(t1, t2);
 #endif
 }
 
 #endif
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_explode_time(apr_time_exp_t *result,
+                                          apr_time_t input,
+                                          apr_int32_t offs)
+{
+    return apr_time_exp_tz(result, input, offs);
+}
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_explode_localtime(apr_time_exp_t *result, 
+                                                apr_time_t input)
+{
+    return apr_time_exp_lt(result, input);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/time/win32/time.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/time/win32/time.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/time/win32/time.c	2002-04-15 08:01:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/time/win32/time.c	2002-06-10 04:25:51.000000000 +0800
@@ -102,22 +102,25 @@
         return;
     }
 
     rc = GetTimeZoneInformation(&tz);
     switch (rc) {
     case TIME_ZONE_ID_UNKNOWN:
-    case TIME_ZONE_ID_STANDARD:
         xt->tm_isdst = 0;
         /* Bias = UTC - local time in minutes 
          * tm_gmtoff is seconds east of UTC
          */
         xt->tm_gmtoff = tz.Bias * -60;
         break;
+    case TIME_ZONE_ID_STANDARD:
+        xt->tm_isdst = 0;
+        xt->tm_gmtoff = (tz.Bias + tz.StandardBias) * -60;
+        break;
     case TIME_ZONE_ID_DAYLIGHT:
         xt->tm_isdst = 1;
-        xt->tm_gmtoff = tz.Bias * -60;
+        xt->tm_gmtoff = (tz.Bias + tz.DaylightBias) * -60;
         break;
     default:
         xt->tm_isdst = 0;
         xt->tm_gmtoff = 0;
     }
     return;
@@ -212,13 +215,12 @@
 
     days = ((days * 24 + xt->tm_hour) * 60 + xt->tm_min) * 60 + xt->tm_sec;
 
     if (days < 0) {
         return APR_EBADDATE;
     }
-    days -= xt->tm_gmtoff;
     *t = days * APR_USEC_PER_SEC + xt->tm_usec;
     return APR_SUCCESS;
 }
 
 APR_DECLARE(apr_status_t) apr_implode_gmt(apr_time_t *t,
                                           apr_time_exp_t *xt)
@@ -276,6 +278,21 @@
 {
     /* One of the few sane situations for a cast, Sleep
      * is in ms, not us, and passed as a DWORD value
      */
     Sleep((DWORD)(t / 1000));
 }
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_explode_time(apr_time_exp_t *result,
+                                          apr_time_t input,
+                                          apr_int32_t offs)
+{
+    return apr_time_exp_tz(result, input, offs);
+}
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_explode_localtime(apr_time_exp_t *result, 
+                                                apr_time_t input)
+{
+    return apr_time_exp_lt(result, input);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/netware/groupinfo.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/netware/groupinfo.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/netware/groupinfo.c	2002-04-22 18:24:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/netware/groupinfo.c	2002-06-09 04:04:26.000000000 +0800
@@ -72,6 +72,13 @@
 }
   
 APR_DECLARE(apr_status_t) apr_get_groupid(apr_gid_t *groupid, const char *groupname, apr_pool_t *p)
 {
     return APR_ENOTIMPL;
 }
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_get_groupname(char **groupname, 
+                                            apr_gid_t groupid, apr_pool_t *p)
+{
+    return apr_group_name_get(groupname, groupid, p);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/unix/groupinfo.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/unix/groupinfo.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/unix/groupinfo.c	2002-04-22 18:24:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/unix/groupinfo.c	2002-06-09 04:04:26.000000000 +0800
@@ -102,6 +102,13 @@
         return errno;
     }
     *groupid = gr->gr_gid;
 #endif
     return APR_SUCCESS;
 }
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_get_groupname(char **groupname, 
+                                            apr_gid_t groupid, apr_pool_t *p)
+{
+    return apr_group_name_get(groupname, groupid, p);
+}
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/unix: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/win32/groupinfo.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/win32/groupinfo.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/win32/groupinfo.c	2002-04-22 18:24:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/win32/groupinfo.c	2002-06-09 04:04:26.000000000 +0800
@@ -60,12 +60,15 @@
 #include <sys/types.h>
 #endif
 
 APR_DECLARE(apr_status_t) apr_get_groupid(apr_gid_t *gid, 
                                          const char *groupname, apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    return APR_ENOTIMPL;
+#else
     SID_NAME_USE sidtype;
     char anydomain[256];
     char *domain;
     DWORD sidlen = 0;
     DWORD domlen = sizeof(anydomain);
     DWORD rv;
@@ -95,34 +98,48 @@
                                anydomain, &domlen, &sidtype);
     }
     if (!sidlen || !rv) {
         return apr_get_os_error();
     }
     return APR_SUCCESS;
+#endif
 }
 
 APR_DECLARE(apr_status_t) apr_group_name_get(char **groupname, apr_gid_t groupid, apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    *groupname = apr_pstrdup(p, "Administrators");
+#else
     SID_NAME_USE type;
     char name[MAX_PATH], domain[MAX_PATH];
     DWORD cbname = sizeof(name), cbdomain = sizeof(domain);
     if (!groupid)
         return APR_EINVAL;
     if (!LookupAccountSid(NULL, groupid, name, &cbname, domain, &cbdomain, &type))
         return apr_get_os_error();
     if (type != SidTypeGroup && type != SidTypeWellKnownGroup 
                              && type != SidTypeAlias)
         return APR_EINVAL;
     *groupname = apr_pstrdup(p, name);
+#endif
     return APR_SUCCESS;
 }
   
 APR_DECLARE(apr_status_t) apr_compare_groups(apr_gid_t left, apr_gid_t right)
 {
     if (!left || !right)
         return APR_EINVAL;
+#ifndef _WIN32_WCE
     if (!IsValidSid(left) || !IsValidSid(right))
         return APR_EINVAL;
     if (!EqualSid(left, right))
         return APR_EMISMATCH;
+#endif
     return APR_SUCCESS;
 }
+
+/* Deprecated */
+APR_DECLARE(apr_status_t) apr_get_groupname(char **groupname, 
+                                            apr_gid_t groupid, apr_pool_t *p)
+{
+    return apr_group_name_get(groupname, groupid, p);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/win32/userinfo.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/win32/userinfo.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr/user/win32/userinfo.c	2002-03-14 04:39:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr/user/win32/userinfo.c	2002-06-04 12:57:22.000000000 +0800
@@ -58,12 +58,13 @@
 #include "apr_user.h"
 #include "fileio.h"
 #if APR_HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
 
+#ifndef _WIN32_WCE
 /* Internal sid binary to string translation, see MSKB Q131320.
  * Several user related operations require our SID to access
  * the registry, but in a string format.  All error handling
  * depends on IsValidSid(), which internally we better test long
  * before we get here!
  */
@@ -94,18 +95,22 @@
     nsa = *GetSidSubAuthorityCount(id);
     for (sa = 0; sa < nsa; ++sa) {
         slen += apr_snprintf(buf + slen, blen - slen, "-%lu",
                              *GetSidSubAuthority(id, sa));
     }
 } 
-
+#endif
 /* Query the ProfileImagePath from the version-specific branch, where the
  * regkey uses the user's name on 9x, and user's sid string on NT.
  */
 APR_DECLARE(apr_status_t) apr_get_home_directory(char **dirname, const char *username, apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    *dirname = apr_pstrdup(p, "/My Documents");
+    return APR_SUCCESS;
+#else
     apr_status_t rv;
     char regkey[MAX_PATH * 2];
     char *fixch;
     DWORD keylen;
     DWORD type;
     HKEY key;
@@ -186,18 +191,22 @@
     }
 #endif /* APR_HAS_ANSI_FS */
     for (fixch = *dirname; *fixch; ++fixch)
         if (*fixch == '\\')
             *fixch = '/';
     return APR_SUCCESS;
+#endif /* _WIN32_WCE */
 }
 
 APR_DECLARE(apr_status_t) apr_current_userid(apr_uid_t *uid,
                                              apr_gid_t *gid,
                                              apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    return APR_ENOTIMPL;
+#else
     HANDLE threadtok;
     DWORD needed;
     TOKEN_USER *usr;
     TOKEN_PRIMARY_GROUP *grp;
     
     if(!OpenProcessToken(GetCurrentProcess(), STANDARD_RIGHTS_READ | READ_CONTROL | TOKEN_QUERY, &threadtok)) {
@@ -219,17 +228,21 @@
         && GetTokenInformation(threadtok, TokenPrimaryGroup, grp, needed, &needed))
         *gid = grp->PrimaryGroup;
     else
         return apr_get_os_error();
 
     return APR_SUCCESS;
+#endif 
 }
 
 APR_DECLARE(apr_status_t) apr_get_userid(apr_uid_t *uid, apr_gid_t *gid,
                                          const char *username, apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    return APR_ENOTIMPL;
+#else
     SID_NAME_USE sidtype;
     char anydomain[256];
     char *domain;
     DWORD sidlen = 0;
     DWORD domlen = sizeof(anydomain);
     DWORD rv;
@@ -262,33 +275,41 @@
         return apr_get_os_error();
     }
     /* There doesn't seem to be a simple way to retrieve the primary group sid
      */
     *gid = NULL;
     return APR_SUCCESS;
+#endif
 }
 
 APR_DECLARE(apr_status_t) apr_get_username(char **username, apr_uid_t userid, apr_pool_t *p)
 {
+#ifdef _WIN32_WCE
+    *username = apr_pstrdup(p, "Administrator");
+    return APR_SUCCESS;
+#else
     SID_NAME_USE type;
     char name[MAX_PATH], domain[MAX_PATH];
     DWORD cbname = sizeof(name), cbdomain = sizeof(domain);
     if (!userid)
         return APR_EINVAL;
     if (!LookupAccountSid(NULL, userid, name, &cbname, domain, &cbdomain, &type))
         return apr_get_os_error();
     if (type != SidTypeUser && type != SidTypeAlias && type != SidTypeWellKnownGroup)
         return APR_EINVAL;
     *username = apr_pstrdup(p, name);
     return APR_SUCCESS;
+#endif
 }
   
 APR_DECLARE(apr_status_t) apr_compare_users(apr_uid_t left, apr_uid_t right)
 {
     if (!left || !right)
         return APR_EINVAL;
+#ifndef _WIN32_WCE
     if (!IsValidSid(left) || !IsValidSid(right))
         return APR_EINVAL;
     if (!EqualSid(left, right))
         return APR_EMISMATCH;
+#endif
     return APR_SUCCESS;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/aprutil.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/aprutil.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/aprutil.dsp	2002-04-01 10:19:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/aprutil.dsp	2002-05-26 00:25:08.000000000 +0800
@@ -142,12 +142,16 @@
 # End Group
 # Begin Group "crypto"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\crypto\apr_md4.c
+# End Source File
+# Begin Source File
+
 SOURCE=.\crypto\apr_sha1.c
 # End Source File
 # End Group
 # Begin Group "dbm"
 
 # PROP Default_Filter ""
@@ -181,12 +185,21 @@
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\hooks\apr_hooks.c
 # End Source File
 # End Group
+# Begin Group "ldap"
+
+# PROP Default_Filter ""
+# Begin Source File
+
+SOURCE=.\ldap\apr_ldap_compat.c
+# PROP Exclude_From_Build 1
+# End Source File
+# End Group
 # Begin Group "misc"
 
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\misc\apr_date.c
@@ -225,12 +238,20 @@
 # End Source File
 # Begin Source File
 
 SOURCE=.\dbm\sdbm\sdbm_tune.h
 # End Source File
 # End Group
+# Begin Group "strmatch"
+
+# PROP Default_Filter ""
+# Begin Source File
+
+SOURCE=.\strmatch\apr_strmatch.c
+# End Source File
+# End Group
 # Begin Group "uri"
 
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\uri\apr_uri.c
@@ -247,95 +268,137 @@
 # End Group
 # Begin Group "Generated Files"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\include\apr_ldap.h.in
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apr_ldap.hnw
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apr_ldap.hw
+
+!IF  "$(CFG)" == "aprutil - Win32 Release"
+
+# Begin Custom Build - Creating apr_ldap.h from apr_ldap.hw 
+InputPath=.\include\apr_ldap.hw
+
+".\include\apr_ldap.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apr_ldap.hw > .\include\apr_ldap.h
+	
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
+
+# Begin Custom Build - Creating apr_ldap.h from apr_ldap.hw 
+InputPath=.\include\apr_ldap.hw
+
+".\include\apr_ldap.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apr_ldap.hw > .\include\apr_ldap.h
+	
+# End Custom Build
+
+!ENDIF 
+
+# PROP Exclude_From_Build 1
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apu.h.in
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apu.hnw
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apu.hw
 
 !IF  "$(CFG)" == "aprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu.h from apu.hw 
 InputPath=.\include\apu.hw
 
 ".\include\apu.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apu.hw .\include\apu.h > nul 
-	echo Created apu.h from apu.hw 
+	type .\include\apu.hw > .\include\apu.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu.h from apu.hw 
 InputPath=.\include\apu.hw
 
 ".\include\apu.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apu.hw .\include\apu.h > nul 
-	echo Created apu.h from apu.hw 
+	type .\include\apu.hw > .\include\apu.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\private\apu_config.h.in
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_config.hw
 
 !IF  "$(CFG)" == "aprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_config.h from apu_config.hw 
 InputPath=.\include\private\apu_config.hw
 
 ".\include\private\apu_config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_config.hw .\include\private\apu_config.h > nul 
-	echo Created apu_config.h from apu_config.hw 
+	type .\include\private\apu_config.hw > .\include\private\apu_config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_config.h from apu_config.hw 
 InputPath=.\include\private\apu_config.hw
 
 ".\include\private\apu_config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_config.hw .\include\private\apu_config.h > nul 
-	echo Created apu_config.h from apu_config.hw 
+	type .\include\private\apu_config.hw > .\include\private\apu_config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\private\apu_select_dbm.h.in
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_select_dbm.hw
 
 !IF  "$(CFG)" == "aprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_select_dbm.h from apu_select_dbm.hw 
 InputPath=.\include\private\apu_select_dbm.hw
 
 ".\include\private\apu_select_dbm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_select_dbm.hw .\include\private\apu_select_dbm.h > nul 
-	echo Created apu_select_dbm.h from apu_select_dbm.hw 
+	type .\include\private\apu_select_dbm.hw > .\include\private\apu_select_dbm.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_select_dbm.h from apu_select_dbm.hw 
 InputPath=.\include\private\apu_select_dbm.hw
 
 ".\include\private\apu_select_dbm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_select_dbm.hw .\include\private\apu_select_dbm.h > nul 
-	echo Created apu_select_dbm.h from apu_select_dbm.hw 
+	type .\include\private\apu_select_dbm.hw > .\include\private\apu_select_dbm.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -347,36 +410,38 @@
 
 # Begin Custom Build - Generating uri_delims.h
 InputPath=.\uri\gen_uri_delims.exe
 
 ".\uri\uri_delims.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\uri\gen_uri_delims.exe >.\uri\uri_delims.h 
-	echo Generated uri_delims.h from gen_uri_delims.exe 
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "aprutil - Win32 Debug"
 
 # Begin Custom Build - Generating uri_delims.h
 InputPath=.\uri\gen_uri_delims.exe
 
 ".\uri\uri_delims.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\uri\gen_uri_delims.exe >.\uri\uri_delims.h 
-	echo Generated uri_delims.h from gen_uri_delims.exe 
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # End Group
 # Begin Group "Public Header Files"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\include\apr_anylock.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apr_base64.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\apr_buckets.h
 # End Source File
@@ -415,12 +480,16 @@
 # Begin Source File
 
 SOURCE=.\include\apr_sha1.h
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apr_strmatch.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apr_uri.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\apr_xml.h
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: apu-config
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/apu-config.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/apu-config.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/apu-config.in	2002-04-20 06:44:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/apu-config.in	2002-05-14 16:07:36.000000000 +0800
@@ -170,19 +170,23 @@
         flags="$flags -L$libdir -laprutil"
     else
         flags="$flags -L$thisdir -laprutil"
     fi
     ;;
     --link-libtool)
+    # If the LA_FILE exists where we think it should be, use it.  If we're
+    # installed and the LA_FILE does not exist, assume to use -L/-l
+    # (the LA_FILE may not have been installed).  If we're building ourselves,
+    # we'll assume that at some point the .la file be created.
     if test -f "$LA_FILE"; then
         flags="$flags $LA_FILE"
     elif test "$location" = "installed"; then
         ### avoid using -L if libdir is a "standard" location like /usr/lib
         flags="$flags -L$libdir -laprutil"
     else
-        flags="$flags -L$thisdir -laprutil"
+        flags="$flags $LA_FILE"
     fi
     ;;
     --apu-la-file)
     if test -f "$LA_FILE"; then
         flags="$flags $LA_FILE"
     fi
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: autom4te.cache
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_brigade.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_brigade.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_brigade.c	2002-04-11 00:44:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_brigade.c	2002-06-17 12:49:34.000000000 +0800
@@ -146,13 +146,13 @@
     if (point == 0) {
         *after_point = APR_BRIGADE_FIRST(b);
         return APR_SUCCESS;
     }
 
     APR_BRIGADE_FOREACH(e, b) {
-        if ((point > (apr_size_t)(-1)) && (e->length == (apr_size_t)(-1))) {
+        if ((e->length == (apr_size_t)(-1)) && (point > (apr_size_t)(-1))) {
             /* XXX: point is too far out to simply split this bucket,
              * we must fix this bucket's size and keep going... */
             rv = apr_bucket_read(e, &s, &len, APR_BLOCK_READ);
             if (rv != APR_SUCCESS) {
                 *after_point = e;
                 return rv;
@@ -245,22 +245,23 @@
         if (str_len + actual > *len) {
             str_len = *len - actual;
         }
 
         /* XXX: It appears that overflow of the final bucket
          * is DISCARDED without any warning to the caller.
+         *
+         * No, we only copy the data up to their requested size.  -- jre
          */
         memcpy(c, str, str_len);
 
         c += str_len;
         actual += str_len;
 
-        /* XXX: Is this a bug in actual == *len or did we intend to
-         * flatten all trailing 0 byte buckets?
-         */
-        if (actual > *len) {
+        /* This could probably be actual == *len, but be safe from stray
+         * photons. */
+        if (actual >= *len) {
             break;
         }
     }
 
     *len = actual;
     return APR_SUCCESS;
@@ -400,62 +401,88 @@
 APU_DECLARE(apr_status_t) apr_brigade_write(apr_bucket_brigade *b,
                                             apr_brigade_flush flush,
                                             void *ctx, 
                                             const char *str, apr_size_t nbyte)
 {
     apr_bucket *e = APR_BRIGADE_LAST(b);
-    char *buf;
+    apr_size_t remaining = APR_BUCKET_BUFF_SIZE;
+    char *buf = NULL;
 
-    if (!APR_BRIGADE_EMPTY(b) && APR_BUCKET_IS_HEAP(e) &&
-        (e->length + nbyte <= ((apr_bucket_heap *)e->data)->alloc_len))
-    {
-        /* there is a sufficiently big buffer bucket available */
+    if (!APR_BRIGADE_EMPTY(b) && APR_BUCKET_IS_HEAP(e)) {
         apr_bucket_heap *h = e->data;
+
+        remaining = h->alloc_len - e->length;
         buf = h->base + e->start + e->length;
     }
-    else {
-        if (nbyte > APR_BUCKET_BUFF_SIZE) {
-            /* too big to buffer */
-            if (flush) {
-                e = apr_bucket_transient_create(str, nbyte, b->bucket_alloc);
-                APR_BRIGADE_INSERT_TAIL(b, e);
-                return flush(b, ctx);
-            }
-            else {
-                e = apr_bucket_heap_create(str, nbyte, NULL, b->bucket_alloc);
-                APR_BRIGADE_INSERT_TAIL(b, e);
-                return APR_SUCCESS;
-            }
+
+    if (nbyte > remaining) {
+        /* either a buffer bucket exists but is full, 
+         * or no buffer bucket exists and the data is too big
+         * to buffer.  In either case, we should flush.  */
+        if (flush) {
+            e = apr_bucket_transient_create(str, nbyte, b->bucket_alloc);
+            APR_BRIGADE_INSERT_TAIL(b, e);
+            return flush(b, ctx);
         }
         else {
-            /* bigger than the current buffer can handle, but we don't
-             * mind making a new buffer */
-            buf = apr_bucket_alloc(APR_BUCKET_BUFF_SIZE, b->bucket_alloc);
-            e = apr_bucket_heap_create(buf, APR_BUCKET_BUFF_SIZE,
-                                       apr_bucket_free, b->bucket_alloc);
+            e = apr_bucket_heap_create(str, nbyte, NULL, b->bucket_alloc);
             APR_BRIGADE_INSERT_TAIL(b, e);
-            e->length = 0;   /* We are writing into the brigade, and
-                              * allocating more memory than we need.  This
-                              * ensures that the bucket thinks it is empty just
-                              * after we create it.  We'll fix the length
-                              * once we put data in it below.
-                              */
+            return APR_SUCCESS;
         }
     }
+    else if (!buf) {
+        /* we don't have a buffer, but the data is small enough
+         * that we don't mind making a new buffer */
+        buf = apr_bucket_alloc(APR_BUCKET_BUFF_SIZE, b->bucket_alloc);
+        e = apr_bucket_heap_create(buf, APR_BUCKET_BUFF_SIZE,
+                                   apr_bucket_free, b->bucket_alloc);
+        APR_BRIGADE_INSERT_TAIL(b, e);
+        e->length = 0;   /* We are writing into the brigade, and
+                          * allocating more memory than we need.  This
+                          * ensures that the bucket thinks it is empty just
+                          * after we create it.  We'll fix the length
+                          * once we put data in it below.
+                          */
+    }
 
+    /* there is a sufficiently big buffer bucket available now */
     memcpy(buf, str, nbyte);
     e->length += nbyte;
 
     return APR_SUCCESS;
 }
 
-APU_DECLARE(apr_status_t) apr_brigade_puts(apr_bucket_brigade *b,
+APU_DECLARE(apr_status_t) apr_brigade_puts(apr_bucket_brigade *bb,
                                            apr_brigade_flush flush, void *ctx,
                                            const char *str)
 {
-    return apr_brigade_write(b, flush, ctx, str, strlen(str));
+    apr_bucket *bkt = APR_BRIGADE_LAST(bb);
+    if (!APR_BRIGADE_EMPTY(bb) && APR_BUCKET_IS_HEAP(bkt)) {
+        /* If there is some space available in a heap bucket
+         * at the end of the brigade, start copying the string
+         */
+        apr_bucket_heap *h = bkt->data;
+        char *buf = h->base + bkt->start + bkt->length;
+        apr_size_t bytes_avail = h->alloc_len - bkt->length;
+        const char *saved_start = str;
+
+        while (bytes_avail && *str) {
+            *buf++ = *str++;
+            bytes_avail--;
+        }
+        bkt->length += (str - saved_start);
+        if (!*str) {
+            return APR_SUCCESS;
+        }
+    }
+
+    /* If the string has not been copied completely to the brigade,
+     * delegate the remaining work to apr_brigade_write(), which
+     * knows how to grow the brigade
+     */
+    return apr_brigade_write(bb, flush, ctx, str, strlen(str));
 }
 
 APU_DECLARE_NONSTD(apr_status_t) apr_brigade_putstrs(apr_bucket_brigade *b, 
                                                      apr_brigade_flush flush,
                                                      void *ctx, ...)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_eos.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_eos.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_eos.c	2002-04-19 02:34:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_eos.c	2002-06-03 03:54:49.000000000 +0800
@@ -61,16 +61,16 @@
     *len = 0;
     return APR_SUCCESS;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_eos_make(apr_bucket *b)
 {
-    b->length    = 0;
-    b->start     = 0;
-    b->data      = NULL;
-    b->type      = &apr_bucket_type_eos;
+    b->length      = 0;
+    b->start       = 0;
+    b->data        = NULL;
+    b->type        = &apr_bucket_type_eos;
     
     return b;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_eos_create(apr_bucket_alloc_t *list)
 {
@@ -80,13 +80,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_eos_make(b);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_eos = {
-    "EOS", 5,
+    "EOS", 5, APR_BUCKET_METADATA,
     apr_bucket_destroy_noop,
     eos_bucket_read,
     apr_bucket_setaside_noop,
     apr_bucket_split_notimpl,
     apr_bucket_simple_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_file.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_file.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_file.c	2002-04-19 02:34:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_file.c	2002-06-03 03:54:49.000000000 +0800
@@ -82,21 +82,24 @@
 static int file_make_mmap(apr_bucket *e, apr_size_t filelength,
                            apr_off_t fileoffset, apr_pool_t *p)
 {
     apr_bucket_file *a = e->data;
     apr_mmap_t *mm;
 
+    if (!a->can_mmap) {
+        return 0;
+    }
+
     if (filelength > APR_MMAP_LIMIT) {
         if (apr_mmap_create(&mm, a->fd, fileoffset, APR_MMAP_LIMIT,
-                            APR_MMAP_READ, p) != APR_SUCCESS) {
+                            APR_MMAP_READ, p) != APR_SUCCESS)
+        {
             return 0;
         }
-        else {
-            apr_bucket_split(e, APR_MMAP_LIMIT);
-            filelength = APR_MMAP_LIMIT;
-        }
+        apr_bucket_split(e, APR_MMAP_LIMIT);
+        filelength = APR_MMAP_LIMIT;
     }
     else if ((filelength < APR_MMAP_THRESHOLD) ||
              (apr_mmap_create(&mm, a->fd, fileoffset, filelength,
                               APR_MMAP_READ, p) != APR_SUCCESS))
     {
         return 0;
@@ -194,12 +197,15 @@
 {
     apr_bucket_file *f;
 
     f = apr_bucket_alloc(sizeof(*f), b->list);
     f->fd = fd;
     f->readpool = p;
+#if APR_HAS_MMAP
+    f->can_mmap = 1;
+#endif
 
     b = apr_bucket_shared_make(b, f, offset, len);
     b->type = &apr_bucket_type_file;
 
     return b;
 }
@@ -214,12 +220,23 @@
     APR_BUCKET_INIT(b);
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_file_make(b, fd, offset, len, p);
 }
 
+#if APR_HAS_MMAP
+APU_DECLARE(apr_status_t) apr_bucket_file_enable_mmap(apr_bucket *e,
+                                                      int enabled)
+{
+    apr_bucket_file *a = e->data;
+    a->can_mmap = enabled;
+    return APR_SUCCESS;
+}
+#endif /* APR_HAS_MMAP */
+
+
 static apr_status_t file_bucket_setaside(apr_bucket *data, apr_pool_t *reqpool)
 {
     apr_bucket_file *a = data->data;
     apr_file_t *fd = NULL;
     apr_file_t *f = a->fd;
     apr_pool_t *curpool = apr_file_pool_get(f);
@@ -244,13 +261,13 @@
     apr_file_dup(&fd, f, reqpool);
     a->fd = fd;
     return APR_SUCCESS;
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_file = {
-    "FILE", 5,
+    "FILE", 5, APR_BUCKET_DATA,
     file_bucket_destroy,
     file_bucket_read,
     file_bucket_setaside,
     apr_bucket_shared_split,
     apr_bucket_shared_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_flush.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_flush.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_flush.c	2002-04-19 02:34:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_flush.c	2002-06-03 03:54:49.000000000 +0800
@@ -61,16 +61,16 @@
     *len = 0;
     return APR_SUCCESS;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_flush_make(apr_bucket *b)
 {
-    b->length    = 0;
-    b->start     = 0;
-    b->data      = NULL;
-    b->type      = &apr_bucket_type_flush;
+    b->length      = 0;
+    b->start       = 0;
+    b->data        = NULL;
+    b->type        = &apr_bucket_type_flush;
     
     return b;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_flush_create(apr_bucket_alloc_t *list)
 {
@@ -80,13 +80,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_flush_make(b);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_flush = {
-    "FLUSH", 5,
+    "FLUSH", 5, APR_BUCKET_METADATA, 
     apr_bucket_destroy_noop,
     flush_bucket_read,
     apr_bucket_setaside_noop,
     apr_bucket_split_notimpl,
     apr_bucket_simple_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_heap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_heap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_heap.c	2002-04-19 02:41:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_heap.c	2002-06-03 03:54:49.000000000 +0800
@@ -122,13 +122,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_heap_make(b, buf, length, free_func);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_heap = {
-    "HEAP", 5,
+    "HEAP", 5, APR_BUCKET_DATA,
     heap_bucket_destroy,
     heap_bucket_read,
     apr_bucket_setaside_noop,
     apr_bucket_shared_split,
     apr_bucket_shared_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_mmap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_mmap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_mmap.c	2002-04-19 14:07:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_mmap.c	2002-06-03 03:54:49.000000000 +0800
@@ -168,13 +168,13 @@
     }
 
     return APR_SUCCESS;
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_mmap = {
-    "MMAP", 5,
+    "MMAP", 5, APR_BUCKET_DATA,
     mmap_bucket_destroy,
     mmap_bucket_read,
     mmap_bucket_setaside,
     apr_bucket_shared_split,
     apr_bucket_shared_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_pipe.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_pipe.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_pipe.c	2002-04-19 02:41:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_pipe.c	2002-06-03 03:54:49.000000000 +0800
@@ -125,17 +125,17 @@
      * core filter may decide to set aside the tail end of a CGI
      * response if the connection is pipelined. This turns out not to
      * be a problem because the core will have read to the end of the
      * stream so the bucket(s) that it sets aside will be the heap
      * buckets created by pipe_bucket_read() above.
      */
-    b->type     = &apr_bucket_type_pipe;
-    b->length   = (apr_size_t)(-1);
-    b->start    = -1;
-    b->data     = p;
-
+    b->type        = &apr_bucket_type_pipe;
+    b->length      = (apr_size_t)(-1);
+    b->start       = -1;
+    b->data        = p;
+    
     return b;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_pipe_create(apr_file_t *p,
                                                  apr_bucket_alloc_t *list)
 {
@@ -145,13 +145,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_pipe_make(b, p);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_pipe = {
-    "PIPE", 5,
+    "PIPE", 5, APR_BUCKET_DATA, 
     apr_bucket_destroy_noop,
     pipe_bucket_read,
     apr_bucket_setaside_notimpl,
     apr_bucket_split_notimpl,
     apr_bucket_copy_notimpl
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_pool.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_pool.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_pool.c	2002-04-19 02:34:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_pool.c	2002-06-03 03:54:49.000000000 +0800
@@ -168,13 +168,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_pool_make(b, buf, length, pool);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_pool = {
-    "POOL", 5,
+    "POOL", 5, APR_BUCKET_DATA,
     pool_bucket_destroy,
     pool_bucket_read,
     apr_bucket_setaside_noop, /* don't need to setaside thanks to the cleanup*/
     apr_bucket_shared_split,
     apr_bucket_shared_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_simple.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_simple.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_simple.c	2002-04-19 02:41:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_simple.c	2002-06-03 03:54:49.000000000 +0800
@@ -154,22 +154,22 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_transient_make(b, buf, length);
 }
 
 const apr_bucket_type_t apr_bucket_type_immortal = {
-    "IMMORTAL", 5,
+    "IMMORTAL", 5, APR_BUCKET_DATA,
     apr_bucket_destroy_noop,
     simple_bucket_read,
     apr_bucket_setaside_noop,
     apr_bucket_simple_split,
     apr_bucket_simple_copy
 };
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_transient = {
-    "TRANSIENT", 5,
+    "TRANSIENT", 5, APR_BUCKET_DATA,
     apr_bucket_destroy_noop, 
     simple_bucket_read,
     transient_bucket_setaside,
     apr_bucket_simple_split,
     apr_bucket_simple_copy
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_socket.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_socket.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/apr_buckets_socket.c	2002-04-19 02:41:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/apr_buckets_socket.c	2002-06-03 03:54:49.000000000 +0800
@@ -120,16 +120,16 @@
      * destroy the socket. We should probably explicitly call apr to
      * destroy it instead.
      *
      * Note that typically the socket is allocated from the connection pool
      * so it will disappear when the connection is finished. 
      */
-    b->type     = &apr_bucket_type_socket;
-    b->length   = (apr_size_t)(-1);
-    b->start    = -1;
-    b->data     = p;
+    b->type        = &apr_bucket_type_socket;
+    b->length      = (apr_size_t)(-1);
+    b->start       = -1;
+    b->data        = p;
 
     return b;
 }
 
 APU_DECLARE(apr_bucket *) apr_bucket_socket_create(apr_socket_t *p,
                                                    apr_bucket_alloc_t *list)
@@ -140,13 +140,13 @@
     b->free = apr_bucket_free;
     b->list = list;
     return apr_bucket_socket_make(b, p);
 }
 
 APU_DECLARE_DATA const apr_bucket_type_t apr_bucket_type_socket = {
-    "SOCKET", 5,
+    "SOCKET", 5, APR_BUCKET_DATA,
     apr_bucket_destroy_noop,
     socket_bucket_read,
     apr_bucket_setaside_notimpl, 
     apr_bucket_split_notimpl,
     apr_bucket_copy_notimpl
 };
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buckets/Makefile.in	2002-03-29 16:12:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buckets/Makefile.in	2002-05-09 06:00:57.000000000 +0800
@@ -1,9 +1,9 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@ 
 
 TARGETS = apr_buckets_file.lo apr_buckets_pool.lo apr_buckets_flush.lo \
           apr_buckets_refcount.lo apr_buckets_heap.lo apr_buckets_simple.lo \
           apr_buckets.lo apr_buckets_mmap.lo apr_buckets_socket.lo \
           apr_buckets_eos.lo apr_buckets_pipe.lo apr_brigade.lo \
           apr_buckets_alloc.lo
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/build/apu-conf.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/build/apu-conf.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/build/apu-conf.m4	2002-04-20 06:06:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/build/apu-conf.m4	2002-05-14 17:14:39.000000000 +0800
@@ -216,13 +216,13 @@
         CPPFLAGS="-I$withval/include"
         LIBS="-L$withval/lib "
 
         AC_MSG_CHECKING(checking for gdbm in $withval)
         AC_CHECK_HEADER(gdbm.h, AC_CHECK_LIB(gdbm, gdbm_open, [apu_have_gdbm=1]))
         if test "$apu_have_gdbm" != "0"; then
-            APR_ADDTO(APRUTIL_EXPORT_LIBS, [-L$withval/lib])
+            APR_ADDTO(APRUTIL_LDFLAGS, [-L$withval/lib])
             APR_ADDTO(APRUTIL_INCLUDES, [-I$withval/include])
         fi
     fi
 ],[
     apu_have_gdbm=0
     AC_CHECK_HEADER(gdbm.h, AC_CHECK_LIB(gdbm, gdbm_open, [apu_have_gdbm=1]))
@@ -375,119 +375,93 @@
 AC_SUBST(apu_db_version)
 
 dnl Since we have already done the AC_CHECK_LIB tests, if we have it, 
 dnl we know the library is there.
 if test "$apu_have_gdbm" = "1"; then
   APR_ADDTO(APRUTIL_EXPORT_LIBS,[-lgdbm])
-  APR_ADDTO(LIBS,[-lgdbm])
+  APR_ADDTO(APRUTIL_LIBS,[-lgdbm])
 fi
 
 if test "$apu_db_version" != "0"; then
   if test -n "$apu_db_lib"; then
     APR_ADDTO(APRUTIL_EXPORT_LIBS,[-l$apu_db_lib])
-    APR_ADDTO(LIBS,[-l$apu_db_lib])
+    APR_ADDTO(APRUTIL_LIBS,[-l$apu_db_lib])
   fi
 fi
 
 ])
 
-dnl APU_SUBDIR_CONFIG
-dnl ### we should use APR's copy of this
-AC_DEFUN(APU_SUBDIR_CONFIG, [
-  # save our work to this point; this allows the sub-package to use it
-  AC_CACHE_SAVE
-
-  echo "configuring package in $1 now"
-  ac_popdir=`pwd`
-  ac_abs_srcdir=`(cd $srcdir/$1 && pwd)`
-  apr_config_subdirs="$1"
-  test -d $1 || $MKDIR $1
-  cd $1
-
-changequote(, )dnl
-      # A "../" for each directory in /$config_subdirs.
-      ac_dots=`echo $apr_config_subdirs|sed -e 's%^\./%%' -e 's%[^/]$%&/%' -e 's%[^/]*/%../%g'`
-changequote([, ])dnl
-
-  # Make the cache file name correct relative to the subdirectory.
-  case "$cache_file" in
-  /*) ac_sub_cache_file=$cache_file ;;
-  *) # Relative path.
-    ac_sub_cache_file="$ac_dots$cache_file" ;;
-  esac
-
-  # The eval makes quoting arguments work.
-  if eval $ac_abs_srcdir/configure $ac_configure_args --cache-file=$ac_sub_cache_file --srcdir=$ac_abs_srcdir $2
-  then :
-    echo "$1 configured properly"
-  else
-    echo "configure failed for $1"
-    exit 1
-  fi
-
-  cd $ac_popdir
-
-  # grab any updates from the sub-package
-  AC_CACHE_LOAD
-])dnl
-
 dnl
 dnl APU_TEST_EXPAT(directory): test if Expat is located in the specified dir
 dnl
 dnl if present: sets expat_include_dir, expat_libs, possibly expat_old
 dnl
 AC_DEFUN(APU_TEST_EXPAT,[
   AC_MSG_CHECKING(for Expat in ifelse($2,,$1,$2))
 
+  expat_libtool=""
+
   if test -r "$1/lib/expat.h.in"; then
     dnl Expat 1.95.* distribution
     expat_include_dir="$1/lib"
-    expat_libs="$1/lib/libexpat.la"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$1/lib/libexpat.la"
   elif test -r "$1/include/expat.h" -a \
     -r "$1/lib/libexpat.la"; then
     dnl Expat 1.95.* installation (with libtool)
     expat_include_dir="$1/include"
-    expat_libs="$1/lib/libexpat.la"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$1/lib/libexpat.la"
   elif test -r "$1/include/expat.h" -a \
     -r "$1/lib/libexpat.a"; then
     dnl Expat 1.95.* installation (without libtool)
     dnl FreeBSD textproc/expat2
     expat_include_dir="$1/include"
-    expat_libs="-L$1/lib -lexpat"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
   elif test -r "$1/xmlparse.h"; then
     dnl maybe an expat-lite. use this dir for both includes and libs
     expat_include_dir="$1"
-    expat_libs="$1/libexpat.la"
+    expat_ldflags="-L$1"
+    expat_libs="-lexpat"
+    expat_libtool="$1/libexpat.la"
     expat_old=yes
   elif test -r "$1/include/xmlparse.h" -a \
        -r "$1/lib/libexpat.a"; then
     dnl previously installed expat
     expat_include_dir="$1/include"
-    expat_libs="-L$1/lib -lexpat"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$1/include/xml/xmlparse.h" -a \
        -r "$1/lib/xml/libexpat.a"; then
     dnl previously installed expat
     expat_include_dir="$1/include/xml"
-    expat_libs="-L$1/lib -lexpat"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$1/include/xmltok/xmlparse.h"; then
     dnl Debian distribution
     expat_include_dir="$1/include/xmltok"
-    expat_libs="-L$1/lib -lxmlparse -lxmltok"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lxmlparse -lxmltok"
     expat_old=yes
   elif test -r "$1/include/xml/xmlparse.h" -a \
        -r "$1/lib/libexpat.a"; then
     dnl FreeBSD textproc/expat package
     expat_include_dir="$1/include/xml"
-    expat_libs="-L$1/lib -lexpat"
+    expat_ldflags="-L$1/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$1/xmlparse/xmlparse.h"; then
     dnl Expat 1.0 or 1.1 source directory
     expat_include_dir="$1/xmlparse"
-    expat_libs="-L$1 -lexpat"
+    expat_ldflags="-L$1"
+    expat_libs="-lexpat"
     expat_old=yes
   fi
   dnl ### test for installed Expat 1.95.* distros
 
   if test -n "$expat_include_dir"; then
     dnl ### more info about what we found there? version? using .la?
@@ -519,52 +493,71 @@
 ])
 
 if test -z "$expat_include_dir"; then
   for d in /usr /usr/local xml/expat-cvs xml/expat $srcdir/xml/expat ; do
     APU_TEST_EXPAT($d)
     if test -n "$expat_include_dir"; then
+      dnl For /usr installs of expat, we can't specify -L/usr/lib
+      if test "$d" = "/usr"; then
+        expat_ldflags=""
+      fi
       break
     fi
   done
 fi
 if test -z "$expat_include_dir"; then
   AC_MSG_ERROR([could not locate Expat. use --with-expat])
 fi
 
+dnl If this expat doesn't use libtool natively, we'll mimic it for our
+dnl dependency library generation.
+if test -z "$expat_libtool"; then
+  expat_libtool="$expat_ldflags $expat_libs" 
+fi
+
 if test -n "$expat_old"; then
   AC_DEFINE(APR_HAVE_OLD_EXPAT, 1, [define if Expat 1.0 or 1.1 was found])
 fi
 
 dnl special-case the bundled distribution (use absolute dirs)
 if test "$expat_include_dir" = "xml/expat/lib" -o "$expat_include_dir" = "xml/expat-cvs/lib"; then
   bundled_subdir="`echo $expat_include_dir | sed -e 's%/lib%%'`"
-  APU_SUBDIR_CONFIG($bundled_subdir)
+  APR_SUBDIR_CONFIG($bundled_subdir)
   expat_include_dir=$top_builddir/$bundled_subdir/lib
-  expat_libs=$top_builddir/$bundled_subdir/lib/libexpat.la
+  expat_ldflags="-L$top_builddir/$bundled_subdir/lib"
+  expat_libs="-lexpat"
+  expat_libtool=$top_builddir/$bundled_subdir/lib/libexpat.la
   APR_XML_SUBDIRS="`echo $bundled_subdir | sed -e 's%xml/%%'`"
+  APR_ADDTO(APRUTIL_EXPORT_LIBS, [$expat_libtool])
 else
 if test "$expat_include_dir" = "$srcdir/xml/expat/include" -o "$expat_include_dir" = "$srcdir/xml/expat/lib"; then
   dnl This is a bit of a hack.  This only works because we know that
   dnl we are working with the bundled version of the software.
   bundled_subdir="xml/expat"
-  APU_SUBDIR_CONFIG($bundled_subdir)
+  APR_SUBDIR_CONFIG($bundled_subdir)
   expat_include_dir=$top_builddir/$bundled_subdir/lib
-  expat_libs=$top_builddir/$bundled_subdir/lib/libexpat.la
+  expat_ldflags="-L$top_builddir/$bundled_subdir/lib"
+  expat_libs="-lexpat"
+  expat_libtool=$top_builddir/$bundled_subdir/lib/libexpat.la
   APR_XML_SUBDIRS="`echo $bundled_subdir | sed -e 's%xml/%%'`"
+  APR_ADDTO(APRUTIL_EXPORT_LIBS, [$expat_libtool])
+else
+  APR_ADDTO(APRUTIL_EXPORT_LIBS, [$expat_libs])
 fi
 fi
 APR_XML_DIR=$bundled_subdir
 APR_XML_EXPAT_OLD=$expat_old
 AC_SUBST(APR_XML_SUBDIRS)
 AC_SUBST(APR_XML_DIR)
 AC_SUBST(APR_XML_EXPAT_OLD)
 
 if test "$expat_include_dir" != "/usr/include"; then
   APR_ADDTO(APRUTIL_INCLUDES, [-I$expat_include_dir])
 fi
-APR_ADDTO(APRUTIL_EXPORT_LIBS, [$expat_libs])
+APR_ADDTO(APRUTIL_LDFLAGS, [$expat_ldflags])
+APR_ADDTO(APRUTIL_LIBS, [$expat_libtool])
 ])
 
 
 dnl 
 dnl Find a particular LDAP library
 dnl
@@ -573,14 +566,14 @@
     ldaplib=$1
     extralib=$2
     unset ac_cv_lib_${ldaplib}_ldap_init
     AC_CHECK_LIB(${ldaplib}, ldap_init, 
       [
 dnl        APR_ADDTO(CPPFLAGS,[-DAPU_HAS_LDAP])
-        APR_ADDTO(LIBS,[-l${ldaplib} ${extralib}])
         APR_ADDTO(APRUTIL_EXPORT_LIBS,[-l${ldaplib} ${extralib}])
+        APR_ADDTO(APRUTIL_LIBS,[-l${ldaplib} ${extralib}])
         AC_CHECK_LIB(${ldaplib}, ldapssl_install_routines, apu_has_ldap_netscape_ssl="define", , ${extralib})
         AC_CHECK_LIB(${ldaplib}, ldap_start_tls_s, apu_has_ldap_starttls="define", , ${extralib})
         apu_has_ldap="define";
       ], , ${extralib})
   fi
 ])
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/build/find_apu.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/build/find_apu.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/build/find_apu.m4	2002-02-15 10:44:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/build/find_apu.m4	2002-05-17 07:06:30.000000000 +0800
@@ -3,18 +3,20 @@
 dnl
 dnl This macro file can be used by applications to find and use the APU
 dnl library. It provides a standardized mechanism for using APU. It supports
 dnl embedding APU into the application source, or locating an installed
 dnl copy of APU.
 dnl
-dnl APR_FIND_APU([srcdir, path])
+dnl APR_FIND_APU([srcdir, path, implicit-install-check])
 dnl
 dnl   where srcdir is the location of the bundled APU source directory, or
 dnl   empty if source is not bundled.
 dnl   where path is the prefix to the location where the bundled APU will
 dnl   will be built.
+dnl   where implicit-install-check set to 1 indicates if there is no
+dnl   --with-apr option specified, we will look for installed copies.
 dnl
 dnl Sets the following variables on exit:
 dnl
 dnl   apu_found : "yes", "no", "reconfig"
 dnl
 dnl   apu_config : If the apu-config tool exists, this refers to it.  If
@@ -67,24 +69,26 @@
     if test "$apu_found" != "yes"; then
       AC_MSG_ERROR([
 The directory given to --with-apr-util does not specify a prefix for an 
 installed APU, nor an APR-util build directory.])
     fi
   ],[
-    if apu-config --help > /dev/null 2>&1 ; then
-      apu_found="yes"
-      apu_config="apu-config"
-    else
-      dnl look in the some standard places (apparently not in builtin/default)
-      for lookdir in /usr /usr/local /opt/apr ; do
-        if test -x "$lookdir/bin/apu-config"; then
-          apu_found="yes"
-          apu_config="$lookdir/bin/apu-config"
-          break
-        fi
-      done
+    if test -n "$3" && test "$3" = "1"; then
+      if apu-config --help > /dev/null 2>&1 ; then
+        apu_found="yes"
+        apu_config="apu-config"
+      else
+        dnl look in the some standard places (apparently not in builtin/default)
+        for lookdir in /usr /usr/local /opt/apr /usr/local/apache2 ; do
+          if test -x "$lookdir/bin/apu-config"; then
+            apu_found="yes"
+            apu_config="$lookdir/bin/apu-config"
+            break
+          fi
+        done
+      fi
     fi
     dnl if we have a bundled source directory, then we may have more work
     if test -d "$1"; then
       apu_temp_abs_srcdir="`cd $1 && pwd`"
       if test "$apu_found" = "yes" \
          && test "`$apu_config --srcdir`" = "$apu_temp_abs_srcdir"; then
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/build: mkdir.sh
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buildconf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buildconf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/buildconf	2002-02-03 23:19:20.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/buildconf	2002-05-16 00:51:52.000000000 +0800
@@ -1,20 +1,20 @@
 #!/bin/sh
 
 # Remove aclocal.m4 as it'll break some builds...
-rm -rf aclocal.m4 autom4te.cache
+rm -rf aclocal.m4 autom4te*.cache
 
 #
 # Generate the autoconf header (include/apu_config.h) and ./configure
 #
 echo "Creating include/private/apu_config.h ..."
-autoheader
+${AUTOHEADER:-autoheader}
 
 echo "Creating configure ..."
 ### do some work to toss config.cache?
-if autoconf; then
+if ${AUTOCONF:-autoconf}; then
   :
 else
   echo "autoconf failed"
   exit 1
 fi
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/CHANGES /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/CHANGES
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/CHANGES	2002-04-16 15:14:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/CHANGES	2002-05-24 05:04:25.000000000 +0800
@@ -1,8 +1,30 @@
 Changes with APR-util b1  
 
+  *) Fixed a segfault in apr_date_parse_rfc() for some date formats
+     where it was trying to overlay a potentially static input
+     string even though it didn't really need to.
+     [Cliff Woolley, Doug MacEachern]
+
+  *) Ensure that apu-config does not print libtool libraries when
+     using --libs.  [Justin Erenkrantz]
+
+  *) Added apr_bucket_file_enable_mmap() function to the bucket
+     API to let an application control whether a file bucket may
+     be turned into an mmap bucket upon read.  (The default remains
+     to do the mmap, but this function lets the app prevent the
+     mmap in contexts where mmap would be a bad idea.  Examples
+     include multiprocessors where mmap doesn't scale well and
+     NFS-mounted filesystems where a bus error can result if
+     a memory-mapped file is removed or truncated.) [Brian Pane]
+
+  *) Added string-matching API (apr_strmatch.h)  [Brian Pane]
+
+  *) Rearrange INCLUDES so that APRUTIL_PRIV_INCLUDES is always
+     first.  [Garrett Rooney <rooneg@electricjellyfish.net>]
+
   *) Add --old-expat option to apu-config to allow users of apr-util to
      determine what expat it should expect to be installed.  If the
      flag is set to yes, it should include xmlparse.h.  If it is set to
      no, it should include expat.h.  [Justin Erenkrantz]
 
   *) Fix exporting of includes in apu-config.  [Justin Erenkrantz]
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: config.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: config.nice
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: config.status
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/configure	2002-05-02 04:52:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/configure	2002-06-18 11:46:33.000000000 +0800
@@ -1369,12 +1372,38 @@
 
 top_builddir="$abs_builddir"
 
 
 
 
+  echo "$as_me:$LINENO: checking for working mkdir -p" >&5
+echo $ECHO_N "checking for working mkdir -p... $ECHO_C" >&6
+if test "${ac_cv_mkdir_p+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+
+    test -d conftestdir && rm -rf conftestdir
+    mkdir -p conftestdir/somedir >/dev/null 2>&1
+    if test -d conftestdir/somedir; then
+      ac_cv_mkdir_p=yes
+    else
+      ac_cv_mkdir_p=no
+    fi
+    rm -rf conftestdir
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_mkdir_p" >&5
+echo "${ECHO_T}$ac_cv_mkdir_p" >&6
+  if test "$ac_cv_mkdir_p" = "yes"; then
+      mkdir_p="mkdir -p"
+  else
+      mkdir_p="$abs_srcdir/build/mkdir.sh"
+  fi
+
+
+
 APRUTIL_INCLUDES=""
 APRUTIL_PRIV_INCLUDES="-I$top_builddir/include -I$top_builddir/include/private"
 if test -n "$USE_VPATH"; then
     APRUTIL_PRIV_INCLUDES="$APRUTIL_PRIV_INCLUDES -I$abs_srcdir/include/private -I$abs_srcdir/include"
 fi
 
@@ -1421,23 +1450,25 @@
 build directory, or an apr-config file." >&2;}
    { (exit 1); exit 1; }; }
     fi
 
 else
 
-        if apr-config --help > /dev/null 2>&1 ; then
-      apr_found="yes"
-      apr_config="apr-config"
-    else
-            for lookdir in /usr /usr/local /opt/apr ; do
-        if $TEST_X "$lookdir/bin/apr-config"; then
-          apr_found="yes"
-          apr_config="$lookdir/bin/apr-config"
-          break
-        fi
-      done
+    if test -n "" && test "" = "1"; then
+      if apr-config --help > /dev/null 2>&1 ; then
+        apr_found="yes"
+        apr_config="apr-config"
+      else
+                for lookdir in /usr /usr/local /opt/apr /usr/local/apache2 ; do
+          if $TEST_X "$lookdir/bin/apr-config"; then
+            apr_found="yes"
+            apr_config="$lookdir/bin/apr-config"
+            break
+          fi
+        done
+      fi
     fi
         if test -d ""; then
       apr_temp_abs_srcdir="`cd  && pwd`"
       if test "$apr_found" = "yes" \
          && test "`$apr_config --srcdir`" = "$apr_temp_abs_srcdir"; then
                         apr_found="no"
@@ -2771,49 +2802,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -3002,49 +3033,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -3233,49 +3264,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -3464,49 +3495,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -3695,49 +3726,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -3926,49 +3957,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -4157,49 +4188,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -4388,49 +4419,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -4620,49 +4651,49 @@
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Lib'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Lib'}'`" >&6
 if test `eval echo '${'$as_ac_Lib'}'` = yes; then
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l${ldaplib} ${extralib}\""
-    LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_EXPORT_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-l${ldaplib} ${extralib}\""
-    APRUTIL_EXPORT_LIBS="-l${ldaplib} ${extralib}"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l${ldaplib} ${extralib}\""
+    APRUTIL_LIBS="-l${ldaplib} ${extralib}"
   else
     apr_addto_bugger="-l${ldaplib} ${extralib}"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
         as_ac_Lib=`echo "ac_cv_lib_${ldaplib}''_ldapssl_install_routines" | $as_tr_sh`
 echo "$as_me:$LINENO: checking for ldapssl_install_routines in -l${ldaplib}" >&5
@@ -5586,28 +5617,28 @@
 
 fi
 
 
         if test "$apu_have_gdbm" != "0"; then
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"-L$withval/lib\""
-    APRUTIL_EXPORT_LIBS="-L$withval/lib"
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"-L$withval/lib\""
+    APRUTIL_LDFLAGS="-L$withval/lib"
   else
     apr_addto_bugger="-L$withval/lib"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LDFLAGS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
       fi
     done
   fi
 
 
   if test "x$APRUTIL_INCLUDES" = "x"; then
@@ -11267,28 +11298,28 @@
         APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-lgdbm\""
-    LIBS="-lgdbm"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-lgdbm\""
+    APRUTIL_LIBS="-lgdbm"
   else
     apr_addto_bugger="-lgdbm"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
 fi
 
@@ -11313,28 +11344,28 @@
         APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
       fi
     done
   fi
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"-l$apu_db_lib\""
-    LIBS="-l$apu_db_lib"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"-l$apu_db_lib\""
+    APRUTIL_LIBS="-l$apu_db_lib"
   else
     apr_addto_bugger="-l$apu_db_lib"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
   fi
 fi
@@ -11358,49 +11389,63 @@
   else
     abs_expatdir="`cd $withval && pwd`"
 
   echo "$as_me:$LINENO: checking for Expat in $withval" >&5
 echo $ECHO_N "checking for Expat in $withval... $ECHO_C" >&6
 
+  expat_libtool=""
+
   if test -r "$abs_expatdir/lib/expat.h.in"; then
         expat_include_dir="$abs_expatdir/lib"
-    expat_libs="$abs_expatdir/lib/libexpat.la"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$abs_expatdir/lib/libexpat.la"
   elif test -r "$abs_expatdir/include/expat.h" -a \
     -r "$abs_expatdir/lib/libexpat.la"; then
         expat_include_dir="$abs_expatdir/include"
-    expat_libs="$abs_expatdir/lib/libexpat.la"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$abs_expatdir/lib/libexpat.la"
   elif test -r "$abs_expatdir/include/expat.h" -a \
     -r "$abs_expatdir/lib/libexpat.a"; then
             expat_include_dir="$abs_expatdir/include"
-    expat_libs="-L$abs_expatdir/lib -lexpat"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
   elif test -r "$abs_expatdir/xmlparse.h"; then
         expat_include_dir="$abs_expatdir"
-    expat_libs="$abs_expatdir/libexpat.la"
+    expat_ldflags="-L$abs_expatdir"
+    expat_libs="-lexpat"
+    expat_libtool="$abs_expatdir/libexpat.la"
     expat_old=yes
   elif test -r "$abs_expatdir/include/xmlparse.h" -a \
        -r "$abs_expatdir/lib/libexpat.a"; then
         expat_include_dir="$abs_expatdir/include"
-    expat_libs="-L$abs_expatdir/lib -lexpat"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$abs_expatdir/include/xml/xmlparse.h" -a \
        -r "$abs_expatdir/lib/xml/libexpat.a"; then
         expat_include_dir="$abs_expatdir/include/xml"
-    expat_libs="-L$abs_expatdir/lib -lexpat"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$abs_expatdir/include/xmltok/xmlparse.h"; then
         expat_include_dir="$abs_expatdir/include/xmltok"
-    expat_libs="-L$abs_expatdir/lib -lxmlparse -lxmltok"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lxmlparse -lxmltok"
     expat_old=yes
   elif test -r "$abs_expatdir/include/xml/xmlparse.h" -a \
        -r "$abs_expatdir/lib/libexpat.a"; then
         expat_include_dir="$abs_expatdir/include/xml"
-    expat_libs="-L$abs_expatdir/lib -lexpat"
+    expat_ldflags="-L$abs_expatdir/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$abs_expatdir/xmlparse/xmlparse.h"; then
         expat_include_dir="$abs_expatdir/xmlparse"
-    expat_libs="-L$abs_expatdir -lexpat"
+    expat_ldflags="-L$abs_expatdir"
+    expat_libs="-lexpat"
     expat_old=yes
   fi
 
   if test -n "$expat_include_dir"; then
         echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6
@@ -11421,71 +11466,92 @@
 if test -z "$expat_include_dir"; then
   for d in /usr /usr/local xml/expat-cvs xml/expat $srcdir/xml/expat ; do
 
   echo "$as_me:$LINENO: checking for Expat in $d" >&5
 echo $ECHO_N "checking for Expat in $d... $ECHO_C" >&6
 
+  expat_libtool=""
+
   if test -r "$d/lib/expat.h.in"; then
         expat_include_dir="$d/lib"
-    expat_libs="$d/lib/libexpat.la"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$d/lib/libexpat.la"
   elif test -r "$d/include/expat.h" -a \
     -r "$d/lib/libexpat.la"; then
         expat_include_dir="$d/include"
-    expat_libs="$d/lib/libexpat.la"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
+    expat_libtool="$d/lib/libexpat.la"
   elif test -r "$d/include/expat.h" -a \
     -r "$d/lib/libexpat.a"; then
             expat_include_dir="$d/include"
-    expat_libs="-L$d/lib -lexpat"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
   elif test -r "$d/xmlparse.h"; then
         expat_include_dir="$d"
-    expat_libs="$d/libexpat.la"
+    expat_ldflags="-L$d"
+    expat_libs="-lexpat"
+    expat_libtool="$d/libexpat.la"
     expat_old=yes
   elif test -r "$d/include/xmlparse.h" -a \
        -r "$d/lib/libexpat.a"; then
         expat_include_dir="$d/include"
-    expat_libs="-L$d/lib -lexpat"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$d/include/xml/xmlparse.h" -a \
        -r "$d/lib/xml/libexpat.a"; then
         expat_include_dir="$d/include/xml"
-    expat_libs="-L$d/lib -lexpat"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$d/include/xmltok/xmlparse.h"; then
         expat_include_dir="$d/include/xmltok"
-    expat_libs="-L$d/lib -lxmlparse -lxmltok"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lxmlparse -lxmltok"
     expat_old=yes
   elif test -r "$d/include/xml/xmlparse.h" -a \
        -r "$d/lib/libexpat.a"; then
         expat_include_dir="$d/include/xml"
-    expat_libs="-L$d/lib -lexpat"
+    expat_ldflags="-L$d/lib"
+    expat_libs="-lexpat"
     expat_old=yes
   elif test -r "$d/xmlparse/xmlparse.h"; then
         expat_include_dir="$d/xmlparse"
-    expat_libs="-L$d -lexpat"
+    expat_ldflags="-L$d"
+    expat_libs="-lexpat"
     expat_old=yes
   fi
 
   if test -n "$expat_include_dir"; then
         echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6
   else
     echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
   fi
 
     if test -n "$expat_include_dir"; then
+            if test "$d" = "/usr"; then
+        expat_ldflags=""
+      fi
       break
     fi
   done
 fi
 if test -z "$expat_include_dir"; then
   { { echo "$as_me:$LINENO: error: could not locate Expat. use --with-expat" >&5
 echo "$as_me: error: could not locate Expat. use --with-expat" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
+if test -z "$expat_libtool"; then
+  expat_libtool="$expat_ldflags $expat_libs"
+fi
+
 if test -n "$expat_old"; then
 
 cat >>confdefs.h <<\_ACEOF
 #define APR_HAVE_OLD_EXPAT 1
 _ACEOF
 
@@ -11549,25 +11615,28 @@
   fi
 fi
 rm -f confcache
 
   echo "configuring package in $bundled_subdir now"
   ac_popdir=`pwd`
-  ac_abs_srcdir=`(cd $srcdir/$bundled_subdir && pwd)`
   apr_config_subdirs="$bundled_subdir"
-  test -d $bundled_subdir || $MKDIR $bundled_subdir
+  test -d $bundled_subdir || $mkdir_p $bundled_subdir
+  ac_abs_srcdir=`(cd $srcdir/$bundled_subdir && pwd)`
   cd $bundled_subdir
 
       # A "../" for each directory in /$config_subdirs.
       ac_dots=`echo $apr_config_subdirs|sed -e 's%^\./%%' -e 's%[^/]$%&/%' -e 's%[^/]*/%../%g'`
 
-  # Make the cache file name correct relative to the subdirectory.
+  # Make the cache file pathname absolute for the subdirs
+  # required to correctly handle subdirs that might actually
+  # be symlinks
   case "$cache_file" in
-  /*) ac_sub_cache_file=$cache_file ;;
-  *) # Relative path.
-    ac_sub_cache_file="$ac_dots$cache_file" ;;
+  /*) # already absolute
+    ac_sub_cache_file=$cache_file ;;
+  *)  # Was relative path.
+    ac_sub_cache_file="$ac_popdir/$cache_file" ;;
   esac
 
   # The eval makes quoting arguments work.
   if eval $ac_abs_srcdir/configure $ac_configure_args --cache-file=$ac_sub_cache_file --srcdir=$ac_abs_srcdir
   then :
     echo "$bundled_subdir configured properly"
@@ -11595,14 +11664,37 @@
 echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
 
   expat_include_dir=$top_builddir/$bundled_subdir/lib
-  expat_libs=$top_builddir/$bundled_subdir/lib/libexpat.la
+  expat_ldflags="-L$top_builddir/$bundled_subdir/lib"
+  expat_libs="-lexpat"
+  expat_libtool=$top_builddir/$bundled_subdir/lib/libexpat.la
   APR_XML_SUBDIRS="`echo $bundled_subdir | sed -e 's%xml/%%'`"
+
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"$expat_libtool\""
+    APRUTIL_EXPORT_LIBS="$expat_libtool"
+  else
+    apr_addto_bugger="$expat_libtool"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_EXPORT_LIBS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+      fi
+    done
+  fi
+
 else
 if test "$expat_include_dir" = "$srcdir/xml/expat/include" -o "$expat_include_dir" = "$srcdir/xml/expat/lib"; then
       bundled_subdir="xml/expat"
 
   # save our work to this point; this allows the sub-package to use it
   cat >confcache <<\_ACEOF
@@ -11659,25 +11751,28 @@
   fi
 fi
 rm -f confcache
 
   echo "configuring package in $bundled_subdir now"
   ac_popdir=`pwd`
-  ac_abs_srcdir=`(cd $srcdir/$bundled_subdir && pwd)`
   apr_config_subdirs="$bundled_subdir"
-  test -d $bundled_subdir || $MKDIR $bundled_subdir
+  test -d $bundled_subdir || $mkdir_p $bundled_subdir
+  ac_abs_srcdir=`(cd $srcdir/$bundled_subdir && pwd)`
   cd $bundled_subdir
 
       # A "../" for each directory in /$config_subdirs.
       ac_dots=`echo $apr_config_subdirs|sed -e 's%^\./%%' -e 's%[^/]$%&/%' -e 's%[^/]*/%../%g'`
 
-  # Make the cache file name correct relative to the subdirectory.
+  # Make the cache file pathname absolute for the subdirs
+  # required to correctly handle subdirs that might actually
+  # be symlinks
   case "$cache_file" in
-  /*) ac_sub_cache_file=$cache_file ;;
-  *) # Relative path.
-    ac_sub_cache_file="$ac_dots$cache_file" ;;
+  /*) # already absolute
+    ac_sub_cache_file=$cache_file ;;
+  *)  # Was relative path.
+    ac_sub_cache_file="$ac_popdir/$cache_file" ;;
   esac
 
   # The eval makes quoting arguments work.
   if eval $ac_abs_srcdir/configure $ac_configure_args --cache-file=$ac_sub_cache_file --srcdir=$ac_abs_srcdir
   then :
     echo "$bundled_subdir configured properly"
@@ -11705,14 +11800,59 @@
 echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
 
   expat_include_dir=$top_builddir/$bundled_subdir/lib
-  expat_libs=$top_builddir/$bundled_subdir/lib/libexpat.la
+  expat_ldflags="-L$top_builddir/$bundled_subdir/lib"
+  expat_libs="-lexpat"
+  expat_libtool=$top_builddir/$bundled_subdir/lib/libexpat.la
   APR_XML_SUBDIRS="`echo $bundled_subdir | sed -e 's%xml/%%'`"
+
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"$expat_libtool\""
+    APRUTIL_EXPORT_LIBS="$expat_libtool"
+  else
+    apr_addto_bugger="$expat_libtool"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_EXPORT_LIBS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+      fi
+    done
+  fi
+
+else
+
+  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
+    echo "  setting APRUTIL_EXPORT_LIBS to \"$expat_libs\""
+    APRUTIL_EXPORT_LIBS="$expat_libs"
+  else
+    apr_addto_bugger="$expat_libs"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_EXPORT_LIBS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
+        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+      fi
+    done
+  fi
+
 fi
 fi
 APR_XML_DIR=$bundled_subdir
 APR_XML_EXPAT_OLD=$expat_old
 
 
@@ -11739,28 +11879,49 @@
       fi
     done
   fi
 
 fi
 
-  if test "x$APRUTIL_EXPORT_LIBS" = "x"; then
-    echo "  setting APRUTIL_EXPORT_LIBS to \"$expat_libs\""
-    APRUTIL_EXPORT_LIBS="$expat_libs"
+  if test "x$APRUTIL_LDFLAGS" = "x"; then
+    echo "  setting APRUTIL_LDFLAGS to \"$expat_ldflags\""
+    APRUTIL_LDFLAGS="$expat_ldflags"
   else
-    apr_addto_bugger="$expat_libs"
+    apr_addto_bugger="$expat_ldflags"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $APRUTIL_EXPORT_LIBS; do
+      for j in $APRUTIL_LDFLAGS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to APRUTIL_EXPORT_LIBS"
-        APRUTIL_EXPORT_LIBS="$APRUTIL_EXPORT_LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LDFLAGS"
+        APRUTIL_LDFLAGS="$APRUTIL_LDFLAGS $i"
+      fi
+    done
+  fi
+
+
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"$expat_libtool\""
+    APRUTIL_LIBS="$expat_libtool"
+  else
+    apr_addto_bugger="$expat_libtool"
+    for i in $apr_addto_bugger; do
+      apr_addto_duplicate="0"
+      for j in $APRUTIL_LIBS; do
+        if test "x$i" = "x$j"; then
+          apr_addto_duplicate="1"
+          break
+        fi
+      done
+      if test $apr_addto_duplicate = "0"; then
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
 
 
@@ -11779,59 +11940,39 @@
     ;;
 esac
 
 
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"$APR_LIBS\""
-    LIBS="$APR_LIBS"
+  if test "x$APRUTIL_LIBS" = "x"; then
+    echo "  setting APRUTIL_LIBS to \"$APR_LIBS\""
+    APRUTIL_LIBS="$APR_LIBS"
   else
     apr_addto_bugger="$APR_LIBS"
     for i in $apr_addto_bugger; do
       apr_addto_duplicate="0"
-      for j in $LIBS; do
+      for j in $APRUTIL_LIBS; do
         if test "x$i" = "x$j"; then
           apr_addto_duplicate="1"
           break
         fi
       done
       if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
+        echo "  adding \"$i\" to APRUTIL_LIBS"
+        APRUTIL_LIBS="$APRUTIL_LIBS $i"
       fi
     done
   fi
 
 
 
 
 
 
 
 
-  if test "x$LIBS" = "x"; then
-    echo "  setting LIBS to \"$APRUTIL_EXPORT_LIBS\""
-    LIBS="$APRUTIL_EXPORT_LIBS"
-  else
-    apr_addto_bugger="$APRUTIL_EXPORT_LIBS"
-    for i in $apr_addto_bugger; do
-      apr_addto_duplicate="0"
-      for j in $LIBS; do
-        if test "x$i" = "x$j"; then
-          apr_addto_duplicate="1"
-          break
-        fi
-      done
-      if test $apr_addto_duplicate = "0"; then
-        echo "  adding \"$i\" to LIBS"
-        LIBS="$LIBS $i"
-      fi
-    done
-  fi
-
 
 case "$host_alias" in
 *bsdi* | BSD/OS)
     # Check whether they've installed GNU make
     if make --version > /dev/null 2>&1; then
         INCLUDE_RULES="include $APR_BUILD_DIR/build/rules.mk"
@@ -11851,13 +11992,13 @@
 
 if test ! -d "$top_builddir/include/private"; then
     mkdir $top_builddir/include
     mkdir $top_builddir/include/private
 fi
 
-MAKEFILES="Makefile buckets/Makefile crypto/Makefile dbm/Makefile dbm/sdbm/Makefile encoding/Makefile hooks/Makefile ldap/Makefile uri/Makefile xml/Makefile misc/Makefile $test_Makefile"
+MAKEFILES="Makefile buckets/Makefile crypto/Makefile dbm/Makefile dbm/sdbm/Makefile encoding/Makefile hooks/Makefile ldap/Makefile uri/Makefile xml/Makefile misc/Makefile strmatch/Makefile $test_Makefile"
 ac_config_files="$ac_config_files export_vars.sh apu-config include/private/apu_select_dbm.h include/apr_ldap.h include/apu.h $MAKEFILES"
 ac_config_commands="$ac_config_commands default"
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
@@ -12455,12 +12596,13 @@
 s,@lib_target@,$lib_target,;t t
 s,@EXTRA_OS_LINK@,$EXTRA_OS_LINK,;t t
 s,@APRUTIL_EXPORT_LIBS@,$APRUTIL_EXPORT_LIBS,;t t
 s,@APRUTIL_PRIV_INCLUDES@,$APRUTIL_PRIV_INCLUDES,;t t
 s,@APRUTIL_INCLUDES@,$APRUTIL_INCLUDES,;t t
 s,@APRUTIL_LDFLAGS@,$APRUTIL_LDFLAGS,;t t
+s,@APRUTIL_LIBS@,$APRUTIL_LIBS,;t t
 s,@INCLUDE_RULES@,$INCLUDE_RULES,;t t
 CEOF
 
 _ACEOF
 
   cat >>$CONFIG_STATUS <<\_ACEOF
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/configure.in	2002-04-16 14:55:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/configure.in	2002-05-14 16:37:17.000000000 +0800
@@ -32,12 +32,15 @@
 dnl note: this is needed for LIBTOOL and exporting the bundled Expat
 dnl
 top_builddir="$abs_builddir"
 AC_SUBST(top_builddir)
 AC_SUBST(abs_srcdir)
 
+dnl Initialize mkdir -p functionality.
+APR_MKDIR_P_CHECK($abs_srcdir/build/mkdir.sh)
+
 dnl
 dnl set up the compilation flags and stuff
 dnl
 
 APRUTIL_INCLUDES=""
 APRUTIL_PRIV_INCLUDES="-I$top_builddir/include -I$top_builddir/include/private"
@@ -78,20 +81,20 @@
 
 AC_SUBST(EXTRA_OS_LINK)
 
 dnl
 dnl Prep all the flags and stuff for compilation and export to other builds
 dnl
-APR_ADDTO(LIBS, [$APR_LIBS])
+APR_ADDTO(APRUTIL_LIBS, [$APR_LIBS])
 
 AC_SUBST(APRUTIL_EXPORT_LIBS)
 AC_SUBST(APRUTIL_PRIV_INCLUDES)
 AC_SUBST(APRUTIL_INCLUDES)
 AC_SUBST(APRUTIL_LDFLAGS)
+AC_SUBST(APRUTIL_LIBS)
 AC_SUBST(LDFLAGS)
-APR_ADDTO(LIBS,[$APRUTIL_EXPORT_LIBS])
 
 dnl
 dnl BSD/OS (BSDi) needs to use a different include syntax in the Makefiles
 dnl
 case "$host_alias" in
 *bsdi* | BSD/OS)
@@ -116,13 +119,13 @@
     mkdir $top_builddir/include
     mkdir $top_builddir/include/private
 fi
 
 dnl
 dnl everthing is done. 
-MAKEFILES="Makefile buckets/Makefile crypto/Makefile dbm/Makefile dbm/sdbm/Makefile encoding/Makefile hooks/Makefile ldap/Makefile uri/Makefile xml/Makefile misc/Makefile $test_Makefile"
+MAKEFILES="Makefile buckets/Makefile crypto/Makefile dbm/Makefile dbm/sdbm/Makefile encoding/Makefile hooks/Makefile ldap/Makefile uri/Makefile xml/Makefile misc/Makefile strmatch/Makefile $test_Makefile"
 AC_OUTPUT([
     export_vars.sh
     apu-config
     include/private/apu_select_dbm.h
     include/apr_ldap.h
     include/apu.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: configure.lineno
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/crypto: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/crypto/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/crypto/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/crypto/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/crypto/Makefile.in	2002-05-09 06:00:57.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_sha1.lo apr_md4.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/dbm/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/dbm/Makefile.in	2002-05-09 06:00:57.000000000 +0800
@@ -1,9 +1,9 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_dbm.lo apr_dbm_berkeleydb.lo apr_dbm_gdbm.lo apr_dbm_sdbm.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm/sdbm: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm/sdbm/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/dbm/sdbm/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/dbm/sdbm/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/dbm/sdbm/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = sdbm.lo sdbm_hash.lo sdbm_lock.lo sdbm_pair.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util: docs
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/encoding: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/encoding/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/encoding/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/encoding/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/encoding/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_base64.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: export_vars.sh
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/hooks: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/hooks/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/hooks/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/hooks/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/hooks/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_hooks.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_buckets.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_buckets.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_buckets.h	2002-04-01 13:41:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_buckets.h	2002-06-03 04:17:52.000000000 +0800
@@ -161,12 +161,28 @@
     /** 
      * The number of functions this bucket understands.  Can not be less than
      * five.
      */
     int num_func;
     /**
+     * Whether the bucket contains metadata (ie, information that
+     * describes the regular contents of the brigade).  The metadata
+     * is not returned by apr_bucket_read() and is not indicated by
+     * the ->length of the apr_bucket itself.  In other words, an
+     * empty bucket is safe to arbitrarily remove if and only if it
+     * contains no metadata.  In this sense, "data" is just raw bytes
+     * that are the "content" of the brigade and "metadata" describes
+     * that data but is not a proper part of it.
+     */
+    enum {
+        /** This bucket type represents actual data to send to the client. */
+        APR_BUCKET_DATA = 0,
+        /** This bucket type represents metadata. */
+        APR_BUCKET_METADATA = 1
+    } is_metadata;
+    /**
      * Free the private data and any resources used by the bucket (if they
      *  aren't shared with another bucket).  This function is required to be
      *  implemented for all bucket types, though it might be a no-op on some
      *  of them (namely ones that never allocate any private data structures).
      * @param data The private data pointer from the bucket to be destroyed
      */
@@ -444,12 +460,20 @@
  * Initialize a new bucket's prev/next pointers
  * @param e The bucket to initialize
  */
 #define APR_BUCKET_INIT(e)	APR_RING_ELEM_INIT((e), link)
 
 /**
+ * Determine if a bucket contains metadata.  An empty bucket is
+ * safe to arbitrarily remove if and only if this is false.
+ * @param e The bucket to inspect
+ * @return true or false
+ */
+#define APR_BUCKET_IS_METADATA(e)    (e->type->is_metadata)
+
+/**
  * Determine if a bucket is a FLUSH bucket
  * @param e The bucket to inspect
  * @return true or false
  */
 #define APR_BUCKET_IS_FLUSH(e)       (e->type == &apr_bucket_type_flush)
 /**
@@ -609,12 +633,17 @@
     apr_bucket_refcount  refcount;
     /** The file this bucket refers to */
     apr_file_t *fd;
     /** The pool into which any needed structures should
      *  be created while reading from this file bucket */
     apr_pool_t *readpool;
+#if APR_HAS_MMAP
+    /** Whether this bucket should be memory-mapped if
+     *  a caller tries to read from it */
+    int can_mmap;
+#endif /* APR_HAS_MMAP */
 };
 
 typedef union apr_bucket_structs apr_bucket_structs;
 /**
  * A union of all bucket structures so we know what
  * the max size is.
@@ -760,81 +789,96 @@
 APU_DECLARE(apr_status_t) apr_brigade_to_iovec(apr_bucket_brigade *b, 
                                                struct iovec *vec, int *nvec);
 
 /**
  * This function writes a list of strings into a bucket brigade. 
  * @param b The bucket brigade to add to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param va A list of strings to add
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code.
  */
 APU_DECLARE(apr_status_t) apr_brigade_vputstrs(apr_bucket_brigade *b,
                                                apr_brigade_flush flush,
                                                void *ctx,
                                                va_list va);
 
 /**
- * This function writes an string into a bucket brigade.
+ * This function writes a string into a bucket brigade.
  * @param b The bucket brigade to add to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param str The string to add
- * @return The number of bytes added to the brigade
+ * @param nbyte The number of bytes to write
+ * @return APR_SUCCESS or error code
  */
 APU_DECLARE(apr_status_t) apr_brigade_write(apr_bucket_brigade *b,
                                             apr_brigade_flush flush, void *ctx,
                                             const char *str, apr_size_t nbyte);
 
 /**
- * This function writes an string into a bucket brigade.
- * @param b The bucket brigade to add to
+ * This function writes a string into a bucket brigade.
+ * @param bb The bucket brigade to add to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param str The string to add
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code
  */
-APU_DECLARE(apr_status_t) apr_brigade_puts(apr_bucket_brigade *b,
+APU_DECLARE(apr_status_t) apr_brigade_puts(apr_bucket_brigade *bb,
                                            apr_brigade_flush flush, void *ctx,
                                            const char *str);
 
 /**
  * This function writes a character into a bucket brigade.
  * @param b The bucket brigade to add to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param c The character to add
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code
  */
 APU_DECLARE(apr_status_t) apr_brigade_putc(apr_bucket_brigade *b,
                                            apr_brigade_flush flush, void *ctx,
                                            const char c);
 
 /**
  * This function writes an unspecified number of strings into a bucket brigade.
  * @param b The bucket brigade to add to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param ... The strings to add
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code
  */
 APU_DECLARE_NONSTD(apr_status_t) apr_brigade_putstrs(apr_bucket_brigade *b,
                                                      apr_brigade_flush flush,
                                                      void *ctx, ...);
 
 /**
  * Evaluate a printf and put the resulting string at the end 
  * of the bucket brigade.
  * @param b The brigade to write to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param fmt The format of the string to write
  * @param ... The arguments to fill out the format
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code
  */
 APU_DECLARE_NONSTD(apr_status_t) apr_brigade_printf(apr_bucket_brigade *b, 
                                                     apr_brigade_flush flush,
                                                     void *ctx,
                                                     const char *fmt, ...)
         __attribute__((format(printf,4,5)));
 
 /**
  * Evaluate a printf and put the resulting string at the end 
  * of the bucket brigade.
  * @param b The brigade to write to
+ * @param flush The flush function to use if the brigade is full
+ * @param ctx The structure to pass to the flush function
  * @param fmt The format of the string to write
  * @param va The arguments to fill out the format
- * @return The number of bytes added to the brigade
+ * @return APR_SUCCESS or error code
  */
 APU_DECLARE(apr_status_t) apr_brigade_vprintf(apr_bucket_brigade *b, 
                                               apr_brigade_flush flush,
                                               void *ctx,
                                               const char *fmt, va_list va);
 
@@ -1372,12 +1416,23 @@
  * @return The new bucket, or NULL if allocation failed
  */
 APU_DECLARE(apr_bucket *) apr_bucket_file_make(apr_bucket *b, apr_file_t *fd,
                                                apr_off_t offset,
                                                apr_size_t len, apr_pool_t *p);
 
+#if APR_HAS_MMAP
+/**
+ * Enable or disable memory-mapping for a FILE bucket (default is enabled)
+ * @param b The bucket
+ * @param enable Whether memory-mapping should be enabled
+ * @return APR_SUCCESS normally, or an error code if the operation fails
+ */
+APU_DECLARE(apr_status_t) apr_bucket_file_enable_mmap(apr_bucket *b,
+                                                      int enabled);
+#endif /* APR_HAS_MMAP */
+
 /** @} */
 #ifdef __cplusplus
 }
 #endif
 
 #endif /* !APR_BUCKETS_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_date.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_date.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_date.h	2002-03-14 04:40:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_date.h	2002-05-24 10:35:02.000000000 +0800
@@ -55,19 +55,17 @@
  * originally written at the National Center for Supercomputing Applications,
  * University of Illinois, Urbana-Champaign.
  */
 
 #ifndef APR_DATE_H
 #define APR_DATE_H
+
 /**
  * @file apr_date.h
  * @brief APR-UTIL date routines
  */
-#ifdef __cplusplus
-extern "C" {
-#endif
 
 /**
  * @defgroup APR_Util_Date Date routines
  * @ingroup APR_Util
  * @{
  */
@@ -76,13 +74,18 @@
  * apr_date.h: prototypes for date parsing utility routines
  */
 
 #include "apu.h"
 #include "apr_time.h"
 
-#define APR_DATE_BAD (apr_time_t)0
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+
+#define APR_DATE_BAD ((apr_time_t)0)
 
 /**
  * Compare a string to a mask
  * @param data The string to compare
  * @mask Mask characters (arbitrary maximum is 256 characters, just in case):
  * <PRE>
@@ -132,13 +135,13 @@
  * </PRE>
  *
  * @param date The date in one of the formats above
  * @return the apr_time_t number of microseconds since 1 Jan 1970 GMT, or
  *         0 if this would be out of range or if the date is invalid.
  */
-APU_DECLARE(apr_time_t) apr_date_parse_rfc(char *date);
+APU_DECLARE(apr_time_t) apr_date_parse_rfc(const char *date);
 
 /** @} */
 #ifdef __cplusplus
 }
 #endif
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include: apr_ldap.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include: apr_strmatch.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_uri.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_uri.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/apr_uri.h	2002-03-14 04:40:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/include/apr_uri.h	2002-06-03 15:47:53.000000000 +0800
@@ -98,20 +98,28 @@
 #define APR_URI_SNEWS_DEFAULT_PORT      563
 #define APR_URI_ACAP_DEFAULT_PORT       674
 #define APR_URI_NFS_DEFAULT_PORT       2049
 #define APR_URI_TIP_DEFAULT_PORT       3372
 #define APR_URI_SIP_DEFAULT_PORT       5060
 
-/* Flags passed to unparse_uri_components(): */
-#define APR_URI_UNP_OMITSITEPART	(1U<<0)	/* suppress "scheme://user@site:port" */
-#define	APR_URI_UNP_OMITUSER		(1U<<1)	/* Just omit user */
-#define	APR_URI_UNP_OMITPASSWORD	(1U<<2)	/* Just omit password */
-#define	APR_URI_UNP_OMITUSERINFO	(APR_URI_UNP_OMITUSER|APR_URI_UNP_OMITPASSWORD)	/* omit "user:password@" part */
-#define	APR_URI_UNP_REVEALPASSWORD	(1U<<3)	/* Show plain text password (default: show XXXXXXXX) */
-#define APR_URI_UNP_OMITPATHINFO	(1U<<4)	/* Show "scheme://user@site:port" only */
-#define APR_URI_UNP_OMITQUERY	        (1U<<5)	/* Omit the "?queryarg" from the path */
+/** Flags passed to unparse_uri_components(): */
+/** suppress "scheme://user@site:port" */
+#define APR_URI_UNP_OMITSITEPART    (1U<<0)
+/** Just omit user */
+#define APR_URI_UNP_OMITUSER        (1U<<1)
+/** Just omit password */
+#define APR_URI_UNP_OMITPASSWORD    (1U<<2)
+/** omit "user:password@" part */
+#define APR_URI_UNP_OMITUSERINFO    (APR_URI_UNP_OMITUSER | \
+                                     APR_URI_UNP_OMITPASSWORD)
+/** Show plain text password (default: show XXXXXXXX) */
+#define APR_URI_UNP_REVEALPASSWORD  (1U<<3)
+/** Show "scheme://user@site:port" only */
+#define APR_URI_UNP_OMITPATHINFO    (1U<<4)
+/** Omit the "?queryarg" from the path */
+#define APR_URI_UNP_OMITQUERY       (1U<<5)
 
 typedef struct apr_uri_t apr_uri_t;
 
 /**
  * A structure to encompass all of the fields in a uri
  */
@@ -175,38 +183,38 @@
  *    APR_URI_UNP_OMITPATHINFO        Show "scheme://user@site:port" only 
  *    APR_URI_UNP_OMITQUERY           Omit "?queryarg" or "#fragment" 
  * </PRE>
  * @return The uri as a string
  */
 APU_DECLARE(char *) apr_uri_unparse(apr_pool_t *p, 
-                                               const apr_uri_t *uptr,
-                                               unsigned flags);
+                                    const apr_uri_t *uptr,
+                                    unsigned flags);
 
 /**
  * Parse a given URI, fill in all supplied fields of a apr_uri_t
  * structure. This eliminates the necessity of extracting host, port,
  * path, query info repeatedly in the modules.
  * @param p The pool to allocate out of
  * @param uri The uri to parse
  * @param uptr The apr_uri_t to fill out
  * @return An HTTP status code
  */
 APU_DECLARE(int) apr_uri_parse(apr_pool_t *p, const char *uri, 
-                                          apr_uri_t *uptr);
+                               apr_uri_t *uptr);
 
 /**
  * Special case for CONNECT parsing: it comes with the hostinfo part only
  * @param p The pool to allocate out of
  * @param hostinfo The hostinfo string to parse
  * @param uptr The apr_uri_t to fill out
  * @return An HTTP status code
  */
 APU_DECLARE(int) apr_uri_parse_hostinfo(apr_pool_t *p, 
-                                                   const char *hostinfo, 
-                                                   apr_uri_t *uptr);
+                                        const char *hostinfo, 
+                                        apr_uri_t *uptr);
 
 /** @} */
 #ifdef __cplusplus
 }
 #endif
 
-#endif /*APR_URI_H*/
+#endif /* APR_URI_H */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include: apu.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/private: apu_config.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/include/private: apu_select_dbm.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/ldap: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/ldap/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/ldap/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/ldap/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/ldap/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_ldap_compat.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/libaprutil.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/libaprutil.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/libaprutil.dsp	2002-04-01 10:19:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/libaprutil.dsp	2002-05-26 00:27:08.000000000 +0800
@@ -148,12 +148,16 @@
 # End Group
 # Begin Group "crypto"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\crypto\apr_md4.c
+# End Source File
+# Begin Source File
+
 SOURCE=.\crypto\apr_sha1.c
 # End Source File
 # End Group
 # Begin Group "dbm"
 
 # PROP Default_Filter ""
@@ -187,12 +191,21 @@
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\hooks\apr_hooks.c
 # End Source File
 # End Group
+# Begin Group "ldap"
+
+# PROP Default_Filter ""
+# Begin Source File
+
+SOURCE=.\ldap\apr_ldap_compat.c
+# PROP Exclude_From_Build 1
+# End Source File
+# End Group
 # Begin Group "misc"
 
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\misc\apr_date.c
@@ -231,12 +244,20 @@
 # End Source File
 # Begin Source File
 
 SOURCE=.\dbm\sdbm\sdbm_tune.h
 # End Source File
 # End Group
+# Begin Group "strmatch"
+
+# PROP Default_Filter ""
+# Begin Source File
+
+SOURCE=.\strmatch\apr_strmatch.c
+# End Source File
+# End Group
 # Begin Group "uri"
 
 # PROP Default_Filter ""
 # Begin Source File
 
 SOURCE=.\uri\apr_uri.c
@@ -253,95 +274,137 @@
 # End Group
 # Begin Group "Generated Files"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\include\apr_ldap.h.in
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apr_ldap.hnw
+# End Source File
+# Begin Source File
+
+SOURCE=.\include\apr_ldap.hw
+
+!IF  "$(CFG)" == "libaprutil - Win32 Release"
+
+# Begin Custom Build - Creating apr_ldap.h from apr_ldap.hw 
+InputPath=.\include\apr_ldap.hw
+
+".\include\apr_ldap.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apr_ldap.hw > .\include\apr_ldap.h
+	
+# End Custom Build
+
+!ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
+
+# Begin Custom Build - Creating apr_ldap.h from apr_ldap.hw 
+InputPath=.\include\apr_ldap.hw
+
+".\include\apr_ldap.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
+	type .\include\apr_ldap.hw > .\include\apr_ldap.h
+	
+# End Custom Build
+
+!ENDIF 
+
+# PROP Exclude_From_Build 1
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apu.h.in
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apu.hnw
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apu.hw
 
 !IF  "$(CFG)" == "libaprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu.h from apu.hw 
 InputPath=.\include\apu.hw
 
 ".\include\apu.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apu.hw .\include\apu.h > nul 
-	echo Created apu.h from apu.hw 
+	type .\include\apu.hw > .\include\apu.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu.h from apu.hw 
 InputPath=.\include\apu.hw
 
 ".\include\apu.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\apu.hw .\include\apu.h > nul 
-	echo Created apu.h from apu.hw 
+	type .\include\apu.hw > .\include\apu.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\private\apu_config.h.in
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_config.hw
 
 !IF  "$(CFG)" == "libaprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_config.h from apu_config.hw 
 InputPath=.\include\private\apu_config.hw
 
 ".\include\private\apu_config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_config.hw .\include\private\apu_config.h > nul 
-	echo Created apu_config.h from apu_config.hw 
+	type .\include\private\apu_config.hw > .\include\private\apu_config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_config.h from apu_config.hw 
 InputPath=.\include\private\apu_config.hw
 
 ".\include\private\apu_config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_config.hw .\include\private\apu_config.h > nul 
-	echo Created apu_config.h from apu_config.hw 
+	type .\include\private\apu_config.hw > .\include\private\apu_config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\private\apu_select_dbm.h.in
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\private\apu_select_dbm.hw
 
 !IF  "$(CFG)" == "libaprutil - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_select_dbm.h from apu_select_dbm.hw 
 InputPath=.\include\private\apu_select_dbm.hw
 
 ".\include\private\apu_select_dbm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_select_dbm.hw .\include\private\apu_select_dbm.h >  nul 
-	echo Created apu_select_dbm.h from apu_select_dbm.hw 
+	type .\include\private\apu_select_dbm.hw > .\include\private\apu_select_dbm.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating apu_select_dbm.h from apu_select_dbm.hw 
 InputPath=.\include\private\apu_select_dbm.hw
 
 ".\include\private\apu_select_dbm.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\include\private\apu_select_dbm.hw .\include\private\apu_select_dbm.h >  nul 
-	echo Created apu_select_dbm.h from apu_select_dbm.hw 
+	type .\include\private\apu_select_dbm.hw > .\include\private\apu_select_dbm.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -353,36 +416,38 @@
 
 # Begin Custom Build - Generating uri_delims.h
 InputPath=.\uri\gen_uri_delims.exe
 
 ".\uri\uri_delims.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\uri\gen_uri_delims.exe >.\uri\uri_delims.h 
-	echo Generated uri_delims.h from gen_uri_delims.exe 
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "libaprutil - Win32 Debug"
 
 # Begin Custom Build - Generating uri_delims.h
 InputPath=.\uri\gen_uri_delims.exe
 
 ".\uri\uri_delims.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\uri\gen_uri_delims.exe >.\uri\uri_delims.h 
-	echo Generated uri_delims.h from gen_uri_delims.exe 
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # End Group
 # Begin Group "Public Header Files"
 
 # PROP Default_Filter ""
 # Begin Source File
 
+SOURCE=.\include\apr_anylock.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apr_base64.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\apr_buckets.h
 # End Source File
@@ -421,12 +486,16 @@
 # Begin Source File
 
 SOURCE=.\include\apr_sha1.h
 # End Source File
 # Begin Source File
 
+SOURCE=.\include\apr_strmatch.h
+# End Source File
+# Begin Source File
+
 SOURCE=.\include\apr_uri.h
 # End Source File
 # Begin Source File
 
 SOURCE=.\include\apr_xml.h
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/Makefile.in	2002-06-15 14:00:15.000000000 +0800
@@ -3,23 +3,25 @@
 #
 CPP = @CPP@
 
 srcdir = @srcdir@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
+APRUTIL_LDFLAGS = @APRUTIL_LDFLAGS@
+APRUTIL_LIBS = @APRUTIL_LIBS@
 
 TARGET_LIB = libaprutil.la
 INSTALL_SUBDIRS = @APR_XML_DIR@
 
 TARGETS = delete-lib $(TARGET_LIB) delete-exports aprutil.exp export_vars.h
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
 
-SUBDIRS = buckets crypto dbm encoding hooks ldap uri xml misc
+SUBDIRS = buckets crypto dbm encoding hooks ldap uri xml misc strmatch
 CLEAN_SUBDIRS = . test
 
 CLEAN_TARGETS =
 DISTCLEAN_TARGETS = config.cache config.log config.status libtool \
 	include/private/apu_config.h include/private/apu_private.h \
 	include/private/apu_select_dbm.h include/apu.h export_vars.sh \
@@ -30,12 +32,13 @@
 prefix=@prefix@
 exec_prefix=@exec_prefix@
 bindir=@bindir@
 libdir=@libdir@
 includedir=@includedir@
 top_srcdir=@top_srcdir@
+top_blddir=@top_builddir@
 
 EXPORT_FILES = $(top_srcdir)/include/*.h
 
 delete-lib:
 	@if test -f $(TARGET_LIB); then \
 	    objects="`find $(SUBDIRS) -name expat -prune -o -name '*.@so_ext@' -a -newer $(TARGET_LIB) -print`" ; \
@@ -44,28 +47,33 @@
 		echo $(RM) -f $(TARGET_LIB) ; \
 		$(RM) -f $(TARGET_LIB) ; \
 	    fi; \
 	fi
 
 install: $(TARGET_LIB)
-	if [ ! -d $(includedir) ]; then \
-	    @APR_SOURCE_DIR@/build/mkdir.sh $(includedir); \
-	fi; \
-	cp include/*.h $(includedir); \
-	if [ ! -d $(libdir) ]; then \
-	    @APR_SOURCE_DIR@/build/mkdir.sh $(libdir); \
-	fi; \
-	$(LIBTOOL) --mode=install cp $(TARGET_LIB) $(libdir); \
-	$(LIBTOOL) --mode=install cp aprutil.exp $(libdir); \
-	if [ ! -d $(bindir) ]; then \
-		@APR_SOURCE_DIR@/build/mkdir.sh $(bindir); \
-	fi; \
-	$(LIBTOOL) --mode=install cp apu-config $(bindir); \
-	chmod 755 $(bindir)/apu-config; \
+	if [ ! -d $(DESTDIR)$(includedir) ]; then \
+	    @APR_SOURCE_DIR@/build/mkdir.sh $(DESTDIR)$(includedir); \
+	fi;
+	cp -p $(top_srcdir)/include/*.h $(DESTDIR)$(includedir)
+
+	if [ -n "$(top_blddir)" ]; then \
+		cp -p $(top_blddir)/include/*.h $(DESTDIR)$(includedir); \
+	fi;
+	
+	if [ ! -d $(DESTDIR)$(libdir) ]; then \
+	    @APR_SOURCE_DIR@/build/mkdir.sh $(DESTDIR)$(libdir); \
+	fi;
+	$(LIBTOOL) --mode=install cp $(TARGET_LIB) $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install cp aprutil.exp $(DESTDIR)$(libdir)
+	if [ ! -d $(DESTDIR)$(bindir) ]; then \
+		@APR_SOURCE_DIR@/build/mkdir.sh $(DESTDIR)$(bindir); \
+	fi;
+	$(LIBTOOL) --mode=install cp apu-config $(DESTDIR)$(bindir)
+	chmod 755 $(DESTDIR)$(bindir)/apu-config
 	list='$(INSTALL_SUBDIRS)'; for i in $$list; do \
-		( cd $$i ; $(MAKE) install ); \
+		( cd $$i ; $(MAKE) DESTDIR=$(DESTDIR) install ); \
 	done
 
 $(TARGET_LIB):
 	@objects="`find $(SUBDIRS) -name expat -prune -o -name 'gen_uri_delims.@so_ext@' -prune -o -name '*.@so_ext@' -print`"; \
 	    tmpcmd="$(LINK) @lib_target@ @EXTRA_OS_LINK@"; \
 	    echo $$tmpcmd; \
@@ -91,12 +99,11 @@
 	@echo "#! libaprutil.so" > $@
 	@echo "* This file was AUTOGENERATED at build time." >> $@
 	@echo "* Please do not edit by hand." >> $@
 	$(CPP) $(ALL_CPPFLAGS) $(ALL_INCLUDES) exports.c | grep "ap_hack_" | sed -e 's/^.*[)]\(.*\);$$/\1/' >> $@
 	$(CPP) $(ALL_CPPFLAGS) $(ALL_INCLUDES) export_vars.h | sed -e 's/^\#[^!]*//' | sed -e '/^$$/d' >> $@
 
-docs:
-	mkdir ./docs
-	perl @APR_SOURCE_DIR@/build/scandoc.pl -i./build/default.pl -p./docs/ ./include/*.h
+dox:
+	doxygen $(top_srcdir)/docs/doxygen.conf
 
 
 .PHONY: delete-lib delete-exports
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/misc/apr_date.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/misc/apr_date.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/misc/apr_date.c	2002-03-18 06:39:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/misc/apr_date.c	2002-05-30 04:42:30.000000000 +0800
@@ -141,14 +141,14 @@
  * Parses an HTTP date in one of three standard forms:
  *
  *     Sun, 06 Nov 1994 08:49:37 GMT  ; RFC 822, updated by RFC 1123
  *     Sunday, 06-Nov-94 08:49:37 GMT ; RFC 850, obsoleted by RFC 1036
  *     Sun Nov  6 08:49:37 1994       ; ANSI C's asctime() format
  *
- * and returns the time_t number of seconds since 1 Jan 1970 GMT, or
- * 0 if this would be out of range or if the date is invalid.
+ * and returns the apr_time_t number of microseconds since 1 Jan 1970 GMT, 
+ * or APR_DATE_BAD if this would be out of range or if the date is invalid.
  *
  * The restricted HTTP syntax is
  * 
  *     HTTP-date    = rfc1123-date | rfc850-date | asctime-date
  *
  *     rfc1123-date = wkday "," SP date1 SP time SP "GMT"
@@ -340,18 +340,32 @@
  *     Sun, 6 Nov 94 08:49 GMT        ; Unknown [drtr@ast.cam.ac.uk]
  *     Sun, 06 Nov 94 8:49:37 GMT     ; Unknown [Elm 70.85]
  *     Sun, 6 Nov 94 8:49:37 GMT      ; Unknown [Elm 70.85] 
  *     Mon,  7 Jan 2002 07:21:22 GMT  ; Unknown [Postfix]
  *
  */
-APU_DECLARE(apr_time_t) apr_date_parse_rfc(char *date)
+
+#define TIMEPARSE(ds,hr10,hr1,min10,min1,sec10,sec1)        \
+    {                                                       \
+        ds.tm_hour = ((hr10 - '0') * 10) + (hr1 - '0');     \
+        ds.tm_min = ((min10 - '0') * 10) + (min1 - '0');    \
+        ds.tm_sec = ((sec10 - '0') * 10) + (sec1 - '0');    \
+    }
+#define TIMEPARSE_STD(ds,timstr)                            \
+    {                                                       \
+        TIMEPARSE(ds, timstr[0],timstr[1],                  \
+                      timstr[3],timstr[4],                  \
+                      timstr[6],timstr[7]);                 \
+    }
+
+APU_DECLARE(apr_time_t) apr_date_parse_rfc(const char *date)
 {
     apr_time_exp_t ds;
     apr_time_t result;
     int mint, mon;
-    char *monstr, *timstr, *gmtstr;
+    const char *monstr, *timstr, *gmtstr;
     static const int months[12] =
     {
     ('J' << 16) | ('a' << 8) | 'n', ('F' << 16) | ('e' << 8) | 'b',
     ('M' << 16) | ('a' << 8) | 'r', ('A' << 16) | ('p' << 8) | 'r',
     ('M' << 16) | ('a' << 8) | 'y', ('J' << 16) | ('u' << 8) | 'n',
     ('J' << 16) | ('u' << 8) | 'l', ('A' << 16) | ('u' << 8) | 'g',
@@ -386,24 +400,28 @@
 
         ds.tm_mday = ((date[0] - '0') * 10) + (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 12;
         gmtstr = date + 20;
+
+        TIMEPARSE_STD(ds, timstr);
     }
     else if (apr_date_checkmask(date, "##-@$$-## ##:##:## *")) {/* RFC 850 format  */
         ds.tm_year = ((date[7] - '0') * 10) + (date[8] - '0');
 
         if (ds.tm_year < 70)
             ds.tm_year += 100;
 
         ds.tm_mday = ((date[0] - '0') * 10) + (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 10;
         gmtstr = date + 19;
+
+        TIMEPARSE_STD(ds, timstr);
     }
     else if (apr_date_checkmask(date, "@$$ ~# ##:##:## ####*")) {
         /* asctime format */
         ds.tm_year = ((date[16] - '0') * 10 + (date[17] - '0') - 19) * 100;
         if (ds.tm_year < 0) 
             return APR_DATE_BAD;
@@ -417,12 +435,14 @@
 
         ds.tm_mday += (date[5] - '0');
 
         monstr = date;
         timstr = date + 7;
         gmtstr = NULL;
+
+        TIMEPARSE_STD(ds, timstr);
     }
     else if (apr_date_checkmask(date, "# @$$ #### ##:##:## *")) {
         /* RFC 1123 format*/
         ds.tm_year = ((date[6] - '0') * 10 + (date[7] - '0') - 19) * 100;
 
         if (ds.tm_year < 0)
@@ -431,12 +451,14 @@
         ds.tm_year += ((date[8] - '0') * 10) + (date[9] - '0');
         ds.tm_mday = (date[0] - '0');
 
         monstr = date + 2;
         timstr = date + 11;
         gmtstr = date + 20;
+
+        TIMEPARSE_STD(ds, timstr);
     }
     else if (apr_date_checkmask(date, "## @$$ ## ##:##:## *")) {
         /* This is the old RFC 1123 date format - many many years ago, people
          * used two-digit years.  Oh, how foolish.  */
         ds.tm_year = ((date[7] - '0') * 10) + (date[8] - '0');
 
@@ -445,12 +467,14 @@
 
         ds.tm_mday = ((date[0] - '0') * 10) + (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 10;
         gmtstr = date + 19;
+
+        TIMEPARSE_STD(ds, timstr);
     } 
     else if (apr_date_checkmask(date, "# @$$ ## ##:##:## *")) {
         /* This is the old RFC 1123 date format - many many years ago, people
          * used two-digit years.  Oh, how foolish.  */
         ds.tm_year = ((date[6] - '0') * 10) + (date[7] - '0');
 
@@ -459,73 +483,74 @@
 
         ds.tm_mday = (date[0] - '0');
 
         monstr = date + 2;
         timstr = date + 9;
         gmtstr = date + 18;
+
+        TIMEPARSE_STD(ds, timstr);
     } 
     else if (apr_date_checkmask(date, "## @$$ ## ##:## *")) {
         /* Loser format.  This is quite bogus.  */
         ds.tm_year = ((date[7] - '0') * 10) + (date[8] - '0');
 
         if (ds.tm_year < 70)
             ds.tm_year += 100;
 
         ds.tm_mday = ((date[0] - '0') * 10) + (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 10;
-        timstr[6] = '0';
-        timstr[7] = '0';
         gmtstr = NULL;
+
+        TIMEPARSE(ds, timstr[0],timstr[1], timstr[3],timstr[4], '0','0');
     } 
     else if (apr_date_checkmask(date, "# @$$ ## ##:## *")) {
         /* Loser format.  This is quite bogus.  */
         ds.tm_year = ((date[6] - '0') * 10) + (date[7] - '0');
 
         if (ds.tm_year < 70)
             ds.tm_year += 100;
 
         ds.tm_mday = (date[0] - '0');
 
         monstr = date + 2;
         timstr = date + 9;
-
-        timstr[6] = '0';
-        timstr[7] = '0';
         gmtstr = NULL;
+
+        TIMEPARSE(ds, timstr[0],timstr[1], timstr[3],timstr[4], '0','0');
     }
     else if (apr_date_checkmask(date, "## @$$ ## #:##:## *")) {
         /* Loser format.  This is quite bogus.  */
         ds.tm_year = ((date[7] - '0') * 10) + (date[8] - '0');
 
         if (ds.tm_year < 70)
             ds.tm_year += 100;
 
         ds.tm_mday = ((date[0] - '0') * 10) + (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 9;
-
-        timstr[0] = '0';
         gmtstr = date + 18;
+
+        TIMEPARSE(ds, '0',timstr[1], timstr[3],timstr[4], timstr[6],timstr[7]);
     }
     else if (apr_date_checkmask(date, "# @$$ ## #:##:## *")) {
          /* Loser format.  This is quite bogus.  */
         ds.tm_year = ((date[6] - '0') * 10) + (date[7] - '0');
 
         if (ds.tm_year < 70)
             ds.tm_year += 100;
 
         ds.tm_mday = (date[0] - '0');
 
         monstr = date + 2;
         timstr = date + 8;
-
-        timstr[0] = '0';
         gmtstr = date + 17;
+
+        TIMEPARSE(ds, '0',timstr[1], timstr[3],timstr[4], timstr[6],timstr[7]);
     }
     else if (apr_date_checkmask(date, " # @$$ #### ##:##:## *")) {   
         /* RFC 1123 format with a space instead of a leading zero. */
         ds.tm_year = ((date[7] - '0') * 10 + (date[8] - '0') - 19) * 100;
 
         if (ds.tm_year < 0)
@@ -535,23 +560,21 @@
 
         ds.tm_mday = (date[1] - '0');
 
         monstr = date + 3;
         timstr = date + 12;
         gmtstr = date + 20;
+
+        TIMEPARSE_STD(ds, timstr);
     }
     else
         return APR_DATE_BAD;
 
     if (ds.tm_mday <= 0 || ds.tm_mday > 31)
         return APR_DATE_BAD;
 
-    ds.tm_hour = ((timstr[0] - '0') * 10) + (timstr[1] - '0');
-    ds.tm_min = ((timstr[3] - '0') * 10) + (timstr[4] - '0');
-    ds.tm_sec = ((timstr[6] - '0') * 10) + (timstr[7] - '0');
-
     if ((ds.tm_hour > 23) || (ds.tm_min > 59) || (ds.tm_sec > 61)) 
         return APR_DATE_BAD;
 
     mint = (monstr[0] << 16) | (monstr[1] << 8) | monstr[2];
     for (mon = 0; mon < 12; mon++)
         if (mint == months[mon])
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/misc: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/misc/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/misc/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/misc/Makefile.in	2002-02-06 20:42:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/misc/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,8 +1,8 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_date.lo apr_rmm.lo
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/NWGNUmakefile	2002-03-30 01:04:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/NWGNUmakefile	2002-05-15 19:08:02.000000000 +0800
@@ -238,12 +238,13 @@
 	$(OBJDIR)/apr_dbm.o \
 	$(OBJDIR)/apr_dbm_sdbm.o \
 	$(OBJDIR)/apr_hooks.o \
 	$(OBJDIR)/apr_md4.o \
 	$(OBJDIR)/apr_rmm.o \
 	$(OBJDIR)/apr_sha1.o \
+	$(OBJDIR)/apr_strmatch.o \
 	$(OBJDIR)/apr_uri.o \
 	$(OBJDIR)/sdbm.o \
 	$(OBJDIR)/sdbm_hash.o \
 	$(OBJDIR)/sdbm_lock.o \
 	$(OBJDIR)/sdbm_pair.o \
 	$(EOLIST)
@@ -291,12 +292,16 @@
 	$(CC) hooks\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
 $(OBJDIR)/%.o: misc/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
 	$(CC) misc\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
+$(OBJDIR)/%.o: strmatch/%.c $(OBJDIR)\cc.opt
+	@echo Compiling $<
+	$(CC) strmatch\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
+
 $(OBJDIR)/%.o: uri/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
 	$(CC) uri\$(<F) -o=$(OBJDIR)\$(@F) @$(OBJDIR)\cc.opt
 
 $(OBJDIR)/%.o: xml/%.c $(OBJDIR)\cc.opt
 	@echo Compiling $<
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/STATUS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/STATUS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/STATUS	2001-12-08 08:43:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/STATUS	2002-05-31 08:13:52.000000000 +0800
@@ -1,28 +1,46 @@
 APRUTIL LIBRARY STATUS:						-*-text-*-
-Last modified at [$Date: 2001/12/08 00:43:54 $]
+Last modified at [$Date: 2002/05/31 00:13:52 $]
 
 Release:
+
+    0.9.0-dev : in progress
+
     2.0a9   : released December 12, 2000
 
 
 RELEASE SHOWSTOPPERS:
 
     * Need apu_compat.h to track the latest renames
       Status: someone want to step up to diff names between 1.3.x 
               and apr/apr-util?  Sounds like a job for a perl script...
 
     * add misc/version.c and related machinery once the pattern is
       laid out in APR.
+      --> APR has completed the model, but still needs some work for
+          passing this information to libtool for versioning the
+	  shared libs. we can (at least) start with the header and
+	  implementation code.
 
     * complete the efforts started by DougM for cleaner fn naming
       conventions: see proposed name changes in renames_pending
       and offer up any additions/vetos/clarifications.
       DougM offered to complete the work with his nifty perl rename
       script at the hackathon. 
 
+    * move md5 from APR into crypto
+      Will Rowe outlined this move in:
+           <5.1.0.14.2.20020511174016.00b8c468@pop3.rowe-clan.net>
+      Justin says:  Requires finding a suitable replacement for md5 in 
+                    apr/uuid for when we don't have random bytes
+		    available.
+      Greg says: showstopper because of the move of functions from one
+                 lib to another
+      Status: Justin +1, Greg +1
+
+
 RELEASE NON-SHOWSTOPPERS BUT WOULD BE REAL NICE TO WRAP THESE UP:
 
     * Solaris's Sun Freeware (sfw) package has a busted gcc/ld setup.
       This gcc passes -L/opt/sfw/lib to /usr/ccs/bin/ld, but does not 
       pass -R.  Therefore, when trying to run the code using a
       library from /opt/sfw/lib (say, libdb), the run-time linker
@@ -34,23 +52,16 @@
 Other bugs that need fixing:
 
 
 
 Other features that need writing:
 
-    * write apr_brigade_(p)getline, per the hackathon
-
     * possibly move test/testdbm* to util/dbu
       Justin says: Do we still want to do this?  testdate is now in test.
       Status: Greg +1 (volunteers)
 
-    * possibly move md5 from APR into crypto
-      Justin says:  Requires finding a suitable replacement for md5 in 
-                    apr/uuid for when we don't have random bytes available.
-      Status: Justin +1 (volunteers)
-
 Documentation that needs writing:
 
     * API documentation
         Status:
 
     * doc the lifetimes of apr_dbm return values
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util: strmatch
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/test: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/test/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/test/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/test/Makefile.in	2002-04-30 22:57:26.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/test/Makefile.in	2002-05-14 16:37:17.000000000 +0800
@@ -1,37 +1,42 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
-PROGRAMS = testdbm testdate testmd4 testxml testrmm
+PROGRAMS = testdbm testdate testmd4 testxml testrmm teststrmatch
 TARGETS = $(PROGRAMS)
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
-LIBS = @APRUTIL_LDFLAGS@ @LIBS@
+PROGRAM_DEPENDENCIES = @APRUTIL_LDFLAGS@ @APRUTIL_LIBS@
 
 test: $(PROGRAMS)
 
 testdbm_OBJECTS = testdbm.lo
 testdbm_LDADD =  ../libaprutil.la
 testdbm: $(testdbm_OBJECTS) $(testdbm_LDADD)
-	$(LINK) $(testdbm_OBJECTS) $(testdbm_LDADD) $(LIBS)
+	$(LINK) $(testdbm_OBJECTS) $(testdbm_LDADD) $(PROGRAM_DEPENDENCIES)
 
 testdate_OBJECTS = testdate.lo
 testdate_LDADD =  ../libaprutil.la
 testdate: $(testdate_OBJECTS) $(testdate_LDADD)
-	$(LINK) $(testdate_OBJECTS) $(testdate_LDADD) $(LIBS)
+	$(LINK) $(testdate_OBJECTS) $(testdate_LDADD) $(PROGRAM_DEPENDENCIES)
 
 testxml_OBJECTS = testxml.lo
 testxml_LDADD =  ../libaprutil.la
 testxml: $(testxml_OBJECTS) $(testxml_LDADD)
-	$(LINK) $(testxml_OBJECTS) $(testxml_LDADD) $(LIBS)
+	$(LINK) $(testxml_OBJECTS) $(testxml_LDADD) $(PROGRAM_DEPENDENCIES)
 
 testmd4_OBJECTS = testmd4.lo
 testmd4_LDADD =  ../libaprutil.la
 testmd4: $(testmd4_OBJECTS) $(testmd4_LDADD)
-	$(LINK) $(testmd4_OBJECTS) $(testmd4_LDADD) $(LIBS)
+	$(LINK) $(testmd4_OBJECTS) $(testmd4_LDADD) $(PROGRAM_DEPENDENCIES)
 
 testrmm_OBJECTS = testrmm.lo
 testrmm_LDADD =  ../libaprutil.la
 testrmm: $(testrmm_OBJECTS) $(testrmm_LDADD)
-	$(LINK) $(testrmm_OBJECTS) $(testrmm_LDADD) $(LIBS)
+	$(LINK) $(testrmm_OBJECTS) $(testrmm_LDADD) $(PROGRAM_DEPENDENCIES)
+
+teststrmatch_OBJECTS = teststrmatch.lo
+teststrmatch_LDADD =  ../libaprutil.la
+teststrmatch: $(teststrmatch_OBJECTS) $(teststrmatch_LDADD)
+	$(LINK) $(teststrmatch_OBJECTS) $(teststrmatch_LDADD) $(PROGRAM_DEPENDENCIES)
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/test: teststrmatch.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/uri/apr_uri.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/uri/apr_uri.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/uri/apr_uri.c	2002-03-14 04:40:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/uri/apr_uri.c	2002-06-03 15:47:53.000000000 +0800
@@ -109,72 +109,85 @@
 };
 
 APU_DECLARE(apr_port_t) apr_uri_default_port_for_scheme(const char *scheme_str)
 {
     schemes_t *scheme;
 
-    for (scheme = schemes; scheme->name != NULL; ++scheme)
-	if (strcasecmp(scheme_str, scheme->name) == 0)
+    for (scheme = schemes; scheme->name != NULL; ++scheme) {
+        if (strcasecmp(scheme_str, scheme->name) == 0) {
 	    return scheme->default_port;
+        }
+    }
 
     return 0;
 }
 
 /* Unparse a apr_uri_t structure to an URI string.
  * Optionally suppress the password for security reasons.
  */
 APU_DECLARE(char *) apr_uri_unparse(apr_pool_t *p, 
-                                               const apr_uri_t *uptr, 
-                                               unsigned flags)
+                                    const apr_uri_t *uptr, 
+                                    unsigned flags)
 {
     char *ret = "";
 
     /* If suppressing the site part, omit both user name & scheme://hostname */
     if (!(flags & APR_URI_UNP_OMITSITEPART)) {
 
-	/* Construct a "user:password@" string, honoring the passed APR_URI_UNP_ flags: */
-	if (uptr->user||uptr->password)
-	    ret = apr_pstrcat (p,
-			(uptr->user     && !(flags & APR_URI_UNP_OMITUSER)) ? uptr->user : "",
-			(uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD)) ? ":" : "",
-			(uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD))
-			   ? ((flags & APR_URI_UNP_REVEALPASSWORD) ? uptr->password : "XXXXXXXX")
-			   : "",
-            ((uptr->user     && !(flags & APR_URI_UNP_OMITUSER)) ||
-             (uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD))) ? "@" : "", 
-            NULL);
+        /* Construct a "user:password@" string, honoring the passed
+         * APR_URI_UNP_ flags: */
+        if (uptr->user || uptr->password) {
+            ret = apr_pstrcat(p,
+                      (uptr->user     && !(flags & APR_URI_UNP_OMITUSER))
+                          ? uptr->user : "",
+                      (uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD))
+                          ? ":" : "",
+                      (uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD))
+                          ? ((flags & APR_URI_UNP_REVEALPASSWORD)
+                              ? uptr->password : "XXXXXXXX")
+                          : "",
+                      ((uptr->user     && !(flags & APR_URI_UNP_OMITUSER)) ||
+                       (uptr->password && !(flags & APR_URI_UNP_OMITPASSWORD)))
+                          ? "@" : "", 
+                      NULL);
+        }
 
 	/* Construct scheme://site string */
 	if (uptr->hostname) {
 	    int is_default_port;
 
 	    is_default_port =
 		(uptr->port_str == NULL ||
 		 uptr->port == 0 ||
 		 uptr->port == apr_uri_default_port_for_scheme(uptr->scheme));
 
-	    ret = apr_pstrcat (p,
-			uptr->scheme, "://", ret, 
-			uptr->hostname ? uptr->hostname : "",
-			is_default_port ? "" : ":",
-			is_default_port ? "" : uptr->port_str,
-			NULL);
+            ret = apr_pstrcat(p,
+                      uptr->scheme, "://", ret, 
+                      uptr->hostname ? uptr->hostname : "",
+                      is_default_port ? "" : ":",
+                      is_default_port ? "" : uptr->port_str,
+                      NULL);
 	}
     }
 
     /* Should we suppress all path info? */
     if (!(flags & APR_URI_UNP_OMITPATHINFO)) {
 	/* Append path, query and fragment strings: */
-	ret = apr_pstrcat (p,
-		ret,
-		uptr->path ? uptr->path : "",
-		(uptr->query    && !(flags & APR_URI_UNP_OMITQUERY)) ? "?" : "",
-		(uptr->query    && !(flags & APR_URI_UNP_OMITQUERY)) ? uptr->query : "",
-		(uptr->fragment && !(flags & APR_URI_UNP_OMITQUERY)) ? "#" : NULL,
-		(uptr->fragment && !(flags & APR_URI_UNP_OMITQUERY)) ? uptr->fragment : NULL,
-		NULL);
+        ret = apr_pstrcat(p,
+                          ret,
+                          (uptr->path)
+                              ? uptr->path : "",
+                          (uptr->query    && !(flags & APR_URI_UNP_OMITQUERY))
+                              ? "?" : "",
+                          (uptr->query    && !(flags & APR_URI_UNP_OMITQUERY))
+                              ? uptr->query : "",
+                          (uptr->fragment && !(flags & APR_URI_UNP_OMITQUERY))
+                              ? "#" : NULL,
+                          (uptr->fragment && !(flags & APR_URI_UNP_OMITQUERY))
+                              ? uptr->fragment : NULL,
+                          NULL);
     }
     return ret;
 }
 
 /* Here is the hand-optimized parse_uri_components().  There are some wild
  * tricks we could pull in assembly language that we don't pull here... like we
@@ -184,17 +197,17 @@
 
 /* We have a apr_table_t that we can index by character and it tells us if the
  * character is one of the interesting delimiters.  Note that we even get
  * compares for NUL for free -- it's just another delimiter.
  */
 
-#define T_COLON		0x01	/* ':' */
-#define T_SLASH		0x02	/* '/' */
-#define T_QUESTION	0x04	/* '?' */
-#define T_HASH		0x08	/* '#' */
-#define T_NUL		0x80	/* '\0' */
+#define T_COLON           0x01        /* ':' */
+#define T_SLASH           0x02        /* '/' */
+#define T_QUESTION        0x04        /* '?' */
+#define T_HASH            0x08        /* '#' */
+#define T_NUL             0x80        /* '\0' */
 
 /* the uri_delims.h file is autogenerated by gen_uri_delims.c */
 #include "uri_delims.h"
 
 /* it works like this:
     if (uri_delims[ch] & NOTEND_foobar) {
@@ -202,26 +215,26 @@
     }
 */
 
 /* Note that we optimize the scheme scanning here, we cheat and let the
  * compiler know that it doesn't have to do the & masking.
  */
-#define NOTEND_SCHEME	(0xff)
-#define NOTEND_HOSTINFO	(T_SLASH | T_QUESTION | T_HASH | T_NUL)
-#define NOTEND_PATH	(T_QUESTION | T_HASH | T_NUL)
+#define NOTEND_SCHEME     (0xff)
+#define NOTEND_HOSTINFO   (T_SLASH | T_QUESTION | T_HASH | T_NUL)
+#define NOTEND_PATH       (T_QUESTION | T_HASH | T_NUL)
 
 /* parse_uri_components():
  * Parse a given URI, fill in all supplied fields of a uri_components
  * structure. This eliminates the necessity of extracting host, port,
  * path, query info repeatedly in the modules.
  * Side effects:
  *  - fills in fields of uri_components *uptr
  *  - none on any of the r->* fields
  */
 APU_DECLARE(int) apr_uri_parse(apr_pool_t *p, const char *uri, 
-                                          apr_uri_t *uptr)
+                               apr_uri_t *uptr)
 {
     const char *s;
     const char *s1;
     const char *hostinfo;
     char *endstr;
     int port;
@@ -272,22 +285,22 @@
     s = uri;
     while ((uri_delims[*(unsigned char *)s] & NOTEND_SCHEME) == 0) {
 	++s;
     }
     /* scheme must be non-empty and followed by :// */
     if (s == uri || s[0] != ':' || s[1] != '/' || s[2] != '/') {
-	goto deal_with_path;	/* backwards predicted taken! */
+        goto deal_with_path;        /* backwards predicted taken! */
     }
 
     uptr->scheme = apr_pstrmemdup(p, uri, s - uri);
     s += 3;
     hostinfo = s;
     while ((uri_delims[*(unsigned char *)s] & NOTEND_HOSTINFO) == 0) {
 	++s;
     }
-    uri = s;	/* whatever follows hostinfo is start of uri */
+    uri = s;        /* whatever follows hostinfo is start of uri */
     uptr->hostinfo = apr_pstrmemdup(p, hostinfo, uri - hostinfo);
 
     /* If there's a username:password@host:port, the @ we want is the last @...
      * too bad there's no memrchr()... For the C purists, note that hostinfo
      * is definately not the first character of the original uri so therefore
      * &hostinfo[-1] < &hostinfo[0] ... and this loop is valid C.
@@ -340,22 +353,22 @@
 /* Special case for CONNECT parsing: it comes with the hostinfo part only */
 /* See the INTERNET-DRAFT document "Tunneling SSL Through a WWW Proxy"
  * currently at http://www.mcom.com/newsref/std/tunneling_ssl.html
  * for the format of the "CONNECT host:port HTTP/1.0" request
  */
 APU_DECLARE(int) apr_uri_parse_hostinfo(apr_pool_t *p, 
-                                                   const char *hostinfo, 
-                                                   apr_uri_t *uptr)
+                                        const char *hostinfo, 
+                                        apr_uri_t *uptr)
 {
     const char *s;
     char *endstr;
 
     /* Initialize the structure. parse_uri() and parse_uri_components()
      * can be called more than once per request.
      */
-    memset (uptr, '\0', sizeof(*uptr));
+    memset(uptr, '\0', sizeof(*uptr));
     uptr->is_initialized = 1;
     uptr->hostinfo = apr_pstrdup(p, hostinfo);
 
     /* We expect hostinfo to point to the first character of
      * the hostname.  There must be a port, separated by a colon
      */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/uri: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/uri/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/uri/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/uri/Makefile.in	2002-02-06 20:42:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/uri/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,9 +1,9 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@ -I.
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@ -I.
 
 TARGETS = uri_delims.h apr_uri.lo
 CLEAN_TARGETS = gen_uri_delims uri_delims.h
 
 # bring in rules.mk for standard functionality
 @INCLUDE_RULES@
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: autom4te.cache
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/buildconf.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/expat/buildconf.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/buildconf.sh	2002-04-27 13:57:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/expat/buildconf.sh	2002-05-16 00:51:52.000000000 +0800
@@ -34,13 +34,13 @@
 $libtoolize --copy --automake
 
 #
 # Generate the autoconf header template (config.h.in) and ./configure
 #
 echo "Creating config.h.in ..."
-autoheader 2>&1 | grep -v "$cross_compile_warning"
+${AUTOHEADER:-autoheader} 2>&1 | grep -v "$cross_compile_warning"
 
 echo "Creating configure ..."
 ### do some work to toss config.cache?
-autoconf 2>&1 | grep -v "$cross_compile_warning"
+${AUTOCONF:-autoconf} 2>&1 | grep -v "$cross_compile_warning"
 
 exit 0
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: config.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: config.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: config.status
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/lib: expat.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/lib: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/lib/xml.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/expat/lib/xml.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat/lib/xml.dsp	2001-08-26 13:21:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/expat/lib/xml.dsp	2002-05-24 23:15:41.000000000 +0800
@@ -161,58 +161,54 @@
 # Begin Source File
 
 SOURCE=.\expat.h.in
 
 !IF  "$(CFG)" == "xml - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating expat.h from expat.h.in 
 InputPath=.\expat.h.in
 
 ".\expat.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\expat.h.in .\expat.h > nul 
-	echo Created expat.h from expat.h.in 
+	type .\expat.h.in > .\expat.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "xml - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating expat.h from expat.h.in 
 InputPath=.\expat.h.in
 
 ".\expat.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\expat.h.in .\expat.h > nul 
-	echo Created expat.h from expat.h.in 
+	type .\expat.h.in > .\expat.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
 SOURCE=.\winconfig.h
 
 !IF  "$(CFG)" == "xml - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating config.h from winconfig.h 
 InputPath=.\winconfig.h
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\winconfig.h .\config.h > nul 
-	echo Created config.h from winconfig.h 
+	type .\winconfig.h > .\config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "xml - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating config.h from winconfig.h 
 InputPath=.\winconfig.h
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\winconfig.h .\config.h > nul 
-	echo Created config.h from winconfig.h 
+	type .\winconfig.h > .\config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: libtool
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/expat: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/apr-util/xml/Makefile.in	2002-02-06 20:42:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/apr-util/xml/Makefile.in	2002-05-09 06:00:58.000000000 +0800
@@ -1,9 +1,9 @@
 VPATH = @srcdir@
 
-INCLUDES = @APR_INCLUDES@ @APRUTIL_INCLUDES@ @APRUTIL_PRIV_INCLUDES@
+INCLUDES = @APRUTIL_PRIV_INCLUDES@ @APR_INCLUDES@ @APRUTIL_INCLUDES@
 
 TARGETS = apr_xml.lo
 
 SUBDIRS = @APR_XML_SUBDIRS@
 
 # bring in rules.mk for standard functionality
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/Makefile.in	2001-12-27 10:28:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/Makefile.in	2002-05-13 16:39:30.000000000 +0800
@@ -1,6 +1,6 @@
 
 SUBDIRS = pcre
-BUILD_SUBDIRS = apr apr-util
-CLEAN_SUBDIRS = apr-util apr
+BUILD_SUBDIRS = $(AP_BUILD_SRCLIB_DIRS)
+CLEAN_SUBDIRS = $(AP_CLEAN_SRCLIB_DIRS)
 
 include $(top_builddir)/build/rules.mk
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: autom4te.cache
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: config.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: config.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: config.status
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: configure.lineno
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: .deps
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/dftables.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/dftables.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/dftables.dsp	2001-08-26 13:21:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/dftables.dsp	2002-05-24 23:16:02.000000000 +0800
@@ -100,29 +100,27 @@
 # Begin Source File
 
 SOURCE=.\config.hw
 
 !IF  "$(CFG)" == "dftables - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "dftables - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -138,29 +136,27 @@
 # Begin Source File
 
 SOURCE=.\pcre.hw
 
 !IF  "$(CFG)" == "dftables - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "dftables - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: Makefile
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: pcre-config
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/pcre.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/pcre.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/pcre.dsp	2001-08-26 13:21:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/pcre.dsp	2002-05-24 23:16:02.000000000 +0800
@@ -86,29 +86,27 @@
 # Begin Source File
 
 SOURCE=.\dftables.exe
 
 !IF  "$(CFG)" == "pcre - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre chartables.c from dftables 
 InputPath=.\dftables.exe
 
 ".\chartables.c" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\dftables.exe >.\chartables.c 
-	Echo Creating pcre chartables.c from dftables 
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "pcre - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre chartables.c from dftables 
 InputPath=.\dftables.exe
 
 ".\chartables.c" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
 	.\dftables.exe >.\chartables.c 
-	Echo Creating pcre chartables.c from dftables 
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -135,29 +133,27 @@
 # Begin Source File
 
 SOURCE=.\config.hw
 
 !IF  "$(CFG)" == "pcre - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "pcre - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
@@ -168,29 +164,27 @@
 # Begin Source File
 
 SOURCE=.\pcre.hw
 
 !IF  "$(CFG)" == "pcre - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "pcre - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre: pcre.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/pcreposix.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/pcreposix.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/srclib/pcre/pcreposix.dsp	2001-08-26 13:21:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/srclib/pcre/pcreposix.dsp	2002-05-24 23:16:02.000000000 +0800
@@ -94,58 +94,54 @@
 # Begin Source File
 
 SOURCE=.\config.hw
 
 !IF  "$(CFG)" == "pcreposix - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "pcreposix - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre config.h from config.hw 
 InputPath=.\config.hw
 
 ".\config.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\config.hw .\config.h >nul 
-	echo Created pcre config.h from config.hw 
+	type .\config.hw > .\config.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
 # Begin Source File
 
 SOURCE=.\pcre.hw
 
 !IF  "$(CFG)" == "pcreposix - Win32 Release"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ELSEIF  "$(CFG)" == "pcreposix - Win32 Debug"
 
-# Begin Custom Build
+# Begin Custom Build - Creating pcre.h from pcre.hw 
 InputPath=.\pcre.hw
 
 ".\pcre.h" : $(SOURCE) "$(INTDIR)" "$(OUTDIR)"
-	copy .\pcre.hw .\pcre.h >nul 
-	echo Created pcre.h from pcre.hw 
+	type .\pcre.hw > .\pcre.h
 	
 # End Custom Build
 
 !ENDIF 
 
 # End Source File
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/ab.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/ab.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/ab.c	2002-04-25 07:28:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/ab.c	2002-06-01 05:33:24.000000000 +0800
@@ -106,13 +106,32 @@
    **      - Prevent blocking calls to apr_recv() (thereby allowing AB to
    **        manage its entire set of socket descriptors).
    **      - Any error returned from apr_recv() that is not EAGAIN or EOF
    **        is now treated as fatal.
    **      Contributed by Aaron Bannert, April 24, 2002
    **
+   ** Version 2.0.36-2
+   **	  Internalized the version string - this string is part
+   **     of the Agent: header and the result output.
+   **
+   ** Version 2.0.37-dev
+   **     Adopted SSL code by Madhu Mathihalli <madhusudan_mathihalli@hp.com>
+   **     [PATCH] ab with SSL support  Posted Wed, 15 Aug 2001 20:55:06 GMT
+   **     Introduces four 'if (int == value)' tests per non-ssl request.
+   **/
+
+/* Note: this version string should start with \d+[\d\.]* and be a valid
+ * string for an HTTP Agent: header when prefixed with 'ApacheBench/'. 
+ * It should reflect the version of AB - and not that of the apache server 
+ * it happens to accompany. And it should be updated or changed whenever 
+ * the results are no longer fundamentally comparable to the results of 
+ * a previous version of ab. Either due to a change in the logic of
+ * ab - or to due to a change in the distribution it is compiled with 
+ * (such as an APR change in for example blocking).
  */
+#define AP_AB_BASEREVISION "2.0.37-dev"    
 
 /*
  * BUGS:
  *
  * - uses strcpy/etc.
  * - has various other poor buffer attacks related to the lazy parsing of
@@ -134,30 +153,25 @@
 #endif
 
 /* affects include files on Solaris */
 #define BSD_COMP
 
 #include "apr.h"
+#include "apr_signal.h"
 #include "apr_strings.h"
 #include "apr_network_io.h"
 #include "apr_file_io.h"
 #include "apr_time.h"
 #include "apr_getopt.h"
 #include "apr_general.h"
-#include <signal.h>
 #include "apr_lib.h"
+#include "apr_portable.h"
 #include "ap_release.h"
 
 #define APR_WANT_STRFUNC
 #include "apr_want.h"
-#if APR_HAVE_STDIO_H
-#include <stdio.h>		/* for EOF */
-#endif
-#if APR_HAVE_STDLIB_H
-#include <stdlib.h>
-#endif
 
 #include "apr_base64.h"
 #ifdef NOT_ASCII
 #include "apr_xlate.h"
 #endif
 #if APR_HAVE_STDIO_H
@@ -172,20 +186,22 @@
 #include <openssl/rsa.h>
 #include <openssl/crypto.h>
 #include <openssl/x509.h>
 #include <openssl/pem.h>
 #include <openssl/err.h>
 #include <openssl/ssl.h>
+#include <openssl/rand.h>
 #else
 /* Libraries for RSAref and SYSSSL */
 #include <rsa.h>
 #include <crypto.h>
 #include <x509.h>
 #include <pem.h>
 #include <err.h>
 #include <ssl.h>
+#include <rand.h>
 #endif
 #endif
 
 #include <math.h>
 #endif
 #if APR_HAVE_CTYPE_H
@@ -305,12 +321,14 @@
 long good = 0, bad = 0;		/* number of good and bad requests */
 long epipe = 0;			/* number of broken pipe writes */
 
 #ifdef USE_SSL
 int ssl = 0;
 SSL_CTX *ctx;
+BIO *bio_out,*bio_err;
+static void write_request(struct connection * c);
 #endif
 
 /* store error cases */
 int err_length = 0, err_conn = 0, err_except = 0;
 int err_response = 0;
 
@@ -363,28 +381,344 @@
 	    s, apr_strerror(rv, buf, sizeof buf), rv);
     if (done)
         printf("Total of %ld requests completed\n" , done);
     exit(rv);
 }
 
+#if defined(USE_SSL) && USE_THREADS
+/*
+ * To ensure thread-safetyness in OpenSSL - work in progress
+ */
+
+static apr_thread_mutex_t **lock_cs;
+static int                  lock_num_locks;
+
+static void ssl_util_thr_lock(int mode, int type,
+                              const char *file, int line)
+{
+    if (type < lock_num_locks) {
+        if (mode & CRYPTO_LOCK) {
+            apr_thread_mutex_lock(lock_cs[type]);
+        }
+        else {
+            apr_thread_mutex_unlock(lock_cs[type]);
+        }
+    }
+}
+
+static unsigned long ssl_util_thr_id(void)
+{
+    /* OpenSSL needs this to return an unsigned long.  On OS/390, the pthread 
+     * id is a structure twice that big.  Use the TCB pointer instead as a 
+     * unique unsigned long.
+     */
+#ifdef __MVS__
+    struct PSA {
+        char unmapped[540];
+        unsigned long PSATOLD;
+    } *psaptr = 0;
+
+    return psaptr->PSATOLD;
+#else
+    return (unsigned long) apr_os_thread_current();
+#endif
+}
+
+static apr_status_t ssl_util_thread_cleanup(void *data)
+{
+    CRYPTO_set_locking_callback(NULL);
+
+    /* Let the registered mutex cleanups do their own thing 
+     */
+    return APR_SUCCESS;
+}
+
+void ssl_util_thread_setup(apr_pool_t *p)
+{
+    int i;
+
+    lock_num_locks = CRYPTO_num_locks();
+    lock_cs = apr_palloc(p, lock_num_locks * sizeof(*lock_cs));
+
+    for (i = 0; i < lock_num_locks; i++) {
+        apr_thread_mutex_create(&(lock_cs[i]), APR_THREAD_MUTEX_DEFAULT, p);
+    }
+
+    CRYPTO_set_id_callback(ssl_util_thr_id);
+
+    CRYPTO_set_locking_callback(ssl_util_thr_lock);
+
+    apr_pool_cleanup_register(p, NULL, ssl_util_thread_cleanup,
+                                       apr_pool_cleanup_null);
+}
+#endif
+
 /* --------------------------------------------------------- */
 /* write out request to a connection - assumes we can write
  * (small) request out in one go into our new socket buffer
  *
  */
+#ifdef USE_SSL
+long ssl_print_cb(BIO *bio,int cmd,const char *argp,int argi,long argl,long ret)
+{
+    BIO *out;
+
+    out=(BIO *)BIO_get_callback_arg(bio);
+    if (out == NULL) return(ret);
+
+    if (cmd == (BIO_CB_READ|BIO_CB_RETURN))
+    {
+        BIO_printf(out,"read from %08X [%08lX] (%d bytes => %ld (0x%X))\n",
+                bio,argp,argi,ret,ret);
+        BIO_dump(out,argp,(int)ret);
+        return(ret);
+    }
+    else if (cmd == (BIO_CB_WRITE|BIO_CB_RETURN))
+    {
+        BIO_printf(out,"write to %08X [%08lX] (%d bytes => %ld (0x%X))\n",
+            bio,argp,argi,ret,ret);
+        BIO_dump(out,argp,(int)ret);
+    }
+    return(ret);
+}
+
+#ifndef RAND_MAX
+#include <limits.h>
+#define RAND_MAX INT_MAX
+#endif
+
+static int ssl_rand_choosenum(int l, int h)
+{
+    int i;
+    char buf[50];
+
+    srand((unsigned int)time(NULL));
+    apr_snprintf(buf, sizeof(buf), "%.0f",
+                 (((double)(rand()%RAND_MAX)/RAND_MAX)*(h-l)));
+    i = atoi(buf)+1;
+    if (i < l) i = l;
+    if (i > h) i = h;
+    return i;
+}
+
+void ssl_rand_seed()
+{
+    int nDone = 0;
+    int n, l;
+    time_t t;
+    pid_t pid;
+    unsigned char stackdata[256];
+
+    /*
+     * seed in the current time (usually just 4 bytes)
+     */
+    t = time(NULL);
+    l = sizeof(time_t);
+    RAND_seed((unsigned char *)&t, l);
+    nDone += l;
+
+    /*
+     * seed in the current process id (usually just 4 bytes)
+     */
+    pid = getpid();
+    l = sizeof(pid_t);
+    RAND_seed((unsigned char *)&pid, l);
+    nDone += l;
+
+    /*
+     * seed in some current state of the run-time stack (128 bytes)
+     */
+    n = ssl_rand_choosenum(0, sizeof(stackdata)-128-1);
+    RAND_seed(stackdata+n, 128);
+    nDone += 128;
+}
+
+int ssl_print_connection_info(bio,ssl)
+BIO *bio;
+SSL *ssl;
+{
+        SSL_CIPHER *c;
+        int alg_bits,bits;
+
+        c=SSL_get_current_cipher(ssl);
+        BIO_printf(bio,"Cipher Suite Protocol   :%s\n", SSL_CIPHER_get_version(c));
+        BIO_printf(bio,"Cipher Suite Name       :%s\n",SSL_CIPHER_get_name(c));
+
+        bits=SSL_CIPHER_get_bits(c,&alg_bits);
+        BIO_printf(bio,"Cipher Suite Cipher Bits:%d (%d)\n",bits,alg_bits);
+
+        return(1);
+}
+
+int ssl_print_cert_info(bio,x509cert)
+BIO *bio;
+X509 *x509cert;
+{
+        X509_NAME *dn;
+        char buf[64];
+
+        BIO_printf(bio,"Certificate version: %d\n",X509_get_version(x509cert)+1);
+
+        BIO_printf(bio,"Valid from: ");
+        ASN1_UTCTIME_print(bio, X509_get_notBefore(x509cert));
+        BIO_printf(bio,"\n");
+
+        BIO_printf(bio,"Valid to  : ");
+        ASN1_UTCTIME_print(bio, X509_get_notAfter(x509cert));
+        BIO_printf(bio,"\n");
+
+        BIO_printf(bio,"Public key is %d bits\n",
+            EVP_PKEY_bits(X509_get_pubkey(x509cert)));
+
+        dn=X509_get_issuer_name(x509cert);
+        X509_NAME_oneline(dn, buf, BUFSIZ);
+        BIO_printf(bio,"The issuer name is %s\n", buf);
+
+        dn=X509_get_subject_name(x509cert);
+        X509_NAME_oneline(dn, buf, BUFSIZ);
+        BIO_printf(bio,"The subject name is %s\n", buf);
+
+        /* dump the extension list too */
+        BIO_printf(bio,"Extension Count: %d\n",X509_get_ext_count(x509cert));
+
+        return(1);
+}
+
+void ssl_start_connect(struct connection * c)
+{
+    BIO *bio;
+    X509 *x509cert;
+    STACK_OF(X509) *sk;
+    int i, count, hdone = 0;
+    char ssl_hostname[80];
+    
+    /* XXX - Verify if it's okay - TBD */
+    if (requests < concurrency)
+        requests = concurrency;
+
+    if (!(started < requests))
+        return;
+
+    c->read = 0;
+    c->bread = 0;
+    c->keepalive = 0;
+    c->cbx = 0;
+    c->gotheader = 0;
+    c->rwrite = 0;
+    if (c->ctx)
+        apr_pool_destroy(c->ctx);
+    apr_pool_create(&c->ctx, cntxt);
+
+    if ((c->ssl=SSL_new(ctx)) == NULL)
+    {
+        BIO_printf(bio_err,"SSL_new failed\n");
+        exit(1);
+    }
+
+    ssl_rand_seed();
+
+    c->start = apr_time_now();
+    memset(ssl_hostname, 0, 80);
+    sprintf(ssl_hostname, "%s:%d", hostname, port);
+
+    if ((bio = BIO_new_connect(ssl_hostname)) == NULL)
+    {
+        BIO_printf(bio_err,"BIO_new_connect failed\n");
+        exit(1);
+    }
+    SSL_set_bio(c->ssl,bio,bio);
+    SSL_set_connect_state(c->ssl);
+
+    if (verbosity >= 4)
+    {
+        BIO_set_callback(bio,ssl_print_cb);
+        BIO_set_callback_arg(bio,bio_err);
+    }
+
+    while (!hdone)
+    {
+        i = SSL_do_handshake(c->ssl);
+
+        switch (SSL_get_error(c->ssl,i))
+        {
+            case SSL_ERROR_NONE:
+                hdone=1;
+                break;
+            case SSL_ERROR_SSL:
+            case SSL_ERROR_SYSCALL:
+                BIO_printf(bio_err,"SSL connection failed\n");
+                err_conn++;
+                c->state = STATE_UNCONNECTED;
+                if (bad++ > 10) {
+                    SSL_free (c->ssl);
+                    BIO_printf(bio_err,"\nTest aborted after 10 failures\n\n");
+                    exit (1);
+                }
+                break;
+            case SSL_ERROR_WANT_READ:
+            case SSL_ERROR_WANT_WRITE:
+            case SSL_ERROR_WANT_CONNECT:
+                BIO_printf(bio_err, "Waiting .. sleep(1)\n");
+                apr_sleep(1 * APR_USEC_PER_SEC);
+                c->state = STATE_CONNECTING;
+                c->rwrite = 0;
+                break;
+            case SSL_ERROR_ZERO_RETURN:
+                BIO_printf(bio_err,"socket closed\n");
+                break;
+        }
+    }
+    
+    if (verbosity >= 2)
+    {
+        BIO_printf(bio_err, "\n");
+        sk = SSL_get_peer_cert_chain(c->ssl);
+        if ((count = sk_X509_num(sk)) > 0)
+        {
+            for (i=1; i<count; i++)
+            {
+                x509cert = (X509 *)sk_X509_value(sk,i);
+                ssl_print_cert_info(bio_out,x509cert);
+                X509_free(x509cert);
+            }
+        }
+
+        x509cert = SSL_get_peer_certificate(c->ssl);
+        if (x509cert == NULL)
+            BIO_printf(bio_out, "Anon DH\n");
+        else
+        {
+            BIO_printf(bio_out, "Peer certificate\n");
+            ssl_print_cert_info(bio_out,x509cert);
+            X509_free(x509cert);
+        }
+
+        ssl_print_connection_info(bio_err,c->ssl);
+        SSL_SESSION_print(bio_err,SSL_get_session(c->ssl));
+    }
+
+    /* connected first time */
+    started++;
+    write_request(c);
+}
+#endif /* USE_SSL */
+
 static void write_request(struct connection * c)
 {
     do {
 	apr_time_t tnow = apr_time_now();
 	apr_size_t l = c->rwrite;
 	apr_status_t e;
 
 	/*
 	 * First time round ?
 	 */
 	if (c->rwrite == 0) {
+#ifdef USE_SSL
+            if (ssl != 1)
+#endif
 	    apr_setsocketopt(c->aprsock, APR_SO_TIMEOUT, 0);
 	    c->connect = tnow;
 	    c->rwrite = reqlen;
 	    c->rwrote = 0;
 	    if (posting)
 		c->rwrite += postlen;
@@ -392,38 +726,58 @@
 	else if (tnow > c->connect + aprtimeout) {
 	    printf("Send request timed out!\n");
 	    close_connection(c);
 	    return;
 	}
 
+#ifdef USE_SSL
+        if (ssl == 1) {
+            apr_size_t e_ssl;
+            e_ssl = SSL_write(c->ssl,request + c->rwrote, l);
+            if (e_ssl != l)
+            {
+                printf("SSL write failed - closing connection\n");
+                close_connection (c);
+                return;
+            }
+            l = e_ssl;
+        }
+        else
+#endif
 	e = apr_send(c->aprsock, request + c->rwrote, &l);
 
 	/*
 	 * Bail early on the most common case
 	 */
 	if (l == c->rwrite)
 	    break;
 
+#ifdef USE_SSL
+        if (ssl != 1)
 	if (e != APR_SUCCESS) {
 	    /*
 	     * Let's hope this traps EWOULDBLOCK too !
 	     */
 	    if (!APR_STATUS_IS_EAGAIN(e)) {
 		epipe++;
 		printf("Send request failed!\n");
 		close_connection(c);
 	    }
 	    return;
 	}
+#endif
 	c->rwrote += l;
 	c->rwrite -= l;
     } while (1);
 
     totalposted += c->rwrite;
     c->state = STATE_READ;
     c->endwrite = apr_time_now();
+#ifdef USE_SSL
+    if (ssl != 1)
+#endif
     apr_poll_socket_add(readbits, c->aprsock, APR_POLLIN);
 }
 
 /* --------------------------------------------------------- */
 
 /* calculate and output results */
@@ -504,15 +858,15 @@
 
     /* avoid divide by zero */
     if (timetaken) {
 	printf("Requests per second:    %.2f [#/sec] (mean)\n", 
                (float) (done / timetaken));
 	printf("Time per request:       %.3f [ms] (mean)\n", 
-               (float) (concurrency * timetaken / done));
+               (float) (1000 * concurrency * timetaken / done));
 	printf("Time per request:       %.3f [ms] (mean, across all concurrent requests)\n",
-	       (float) (timetaken / done));
+	       (float) (1000 * timetaken / done));
 	printf("Transfer rate:          %.2f [Kbytes/sec] received\n",
 	       (float) (totalread / 1024 / timetaken));
 	if (posting > 0) {
 	    printf("                        %.2f kb/s sent\n",
 		   (float) (totalposted / timetaken / 1024));
 	    printf("                        %.2f kb/s total\n",
@@ -632,14 +986,14 @@
 	else
 	    meantot = stats[requests / 2].time;
 
 	printf("\nConnection Times (ms)\n");
 
 	if (confidence) {
-#define CONF_FMT_STRING "%" APR_TIME_T_FMT " %5d %6.1f %" APR_TIME_T_FMT " %" APR_TIME_T_FMT "\n"
-	    printf("            min  mean[+/-sd] median   max\n");
+#define CONF_FMT_STRING "%5" APR_TIME_T_FMT " %4d %5.1f %6" APR_TIME_T_FMT " %7" APR_TIME_T_FMT "\n"
+	    printf("              min  mean[+/-sd] median   max\n");
 	    printf("Connect:    " CONF_FMT_STRING, 
                    mincon, (int) (totalcon + 0.5), sdcon, meancon, maxcon);
 	    printf("Processing: " CONF_FMT_STRING,
 		   mind, (int) (totald + 0.5), sdd, meand, maxd);
 	    printf("Waiting:    " CONF_FMT_STRING,
 	           minwait, (int) (totalwait + 0.5), sdwait, meanwait, maxwait);
@@ -840,12 +1194,19 @@
 
 /* start asnchronous non-blocking connection */
 
 static void start_connect(struct connection * c)
 {
     apr_status_t rv;
+
+#ifdef USE_SSL
+    if (ssl == 1) {
+        ssl_start_connect(c);
+        return;
+    }
+#endif
     
     if (!(started < requests))
 	return;
 
     c->read = 0;
     c->bread = 0;
@@ -929,14 +1290,24 @@
 	    s.time = (c->done - c->start) / 1000;
 	    s.waittime = (c->beginread - c->endwrite) / 1000;
 	    stats[done++] = s;
 	}
     }
 
+#ifdef USE_SSL
+    if (ssl == 1) {
+        SSL_shutdown(c->ssl);
+        SSL_free(c->ssl);
+    }
+    else {
+#endif
     apr_poll_socket_remove(readbits, c->aprsock);
     apr_socket_close(c->aprsock);
+#ifdef USE_SSL
+    }
+#endif
     c->state = STATE_UNCONNECTED;
 
     /* connect again */
     start_connect(c);
     return;
 }
@@ -950,12 +1321,26 @@
     apr_size_t r;
     apr_status_t status;
     char *part;
     char respcode[4];		/* 3 digits and null */
 
     r = sizeof(buffer);
+#ifdef USE_SSL
+    if (ssl == 1)
+    {
+        status = SSL_read (c->ssl, buffer, r);
+        if (status <= 0) {
+            good++; c->read = 0;
+            if (status < 0) printf("SSL read failed - closing connection\n");
+            close_connection(c);
+            return;
+        }
+    r = status;
+    }
+    else {
+#endif
     status = apr_recv(c->aprsock, buffer, &r);
     if (APR_STATUS_IS_EAGAIN(status))
 	return;
     else if (r == 0 && APR_STATUS_IS_EOF(status)) {
 	good++;
 	close_connection(c);
@@ -965,12 +1350,15 @@
     else if (status != APR_SUCCESS) {
         err_except++; /* XXX: is this the right error counter? */
         /* XXX: Should errors here be fatal, or should we allow a
          * certain number of them before completely failing? -aaron */
         apr_err("apr_recv", status);
     }
+#ifdef USE_SSL
+    }
+#endif
 
     totalread += r;
     if (c->read == 0) {
 	c->beginread = apr_time_now();
     }
     c->read += r;
@@ -994,13 +1382,13 @@
 #else
 	memcpy(c->cbuff + c->cbx, buffer, space);
 #endif				/* NOT_ASCII */
 	c->cbx += tocopy;
 	space -= tocopy;
 	c->cbuff[c->cbx] = 0;	/* terminate for benefit of strstr */
-	if (verbosity >= 4) {
+        if (verbosity >= 2) {
 	    printf("LOG: header received:\n%s\n", c->cbuff);
 	}
 	s = strstr(c->cbuff, "\r\n\r\n");
 	/*
 	 * this next line is so that we talk to NCSA 1.5 which blatantly
 	 * breaks the http specifaction
@@ -1169,13 +1557,13 @@
 		"%s" "%s" "%s"
 		"Host: %s%s\r\n"
 		"Accept: */*\r\n"
 		"%s" "\r\n",
 		(posting == 0) ? "GET" : "HEAD",
 		(isproxy) ? fullurl : path,
-		AP_SERVER_BASEREVISION,
+		AP_AB_BASEREVISION,
 		keepalive ? "Connection: Keep-Alive\r\n" : "",
 		cookie, auth, host_field, colonhost, hdrs);
     }
     else {
 	sprintf(request, "POST %s HTTP/1.0\r\n"
 		"User-Agent: ApacheBench/%s\r\n"
@@ -1184,13 +1572,13 @@
 		"Accept: */*\r\n"
 		"Content-length: %" APR_SIZE_T_FMT "\r\n"
 		"Content-type: %s\r\n"
 		"%s"
 		"\r\n",
 		(isproxy) ? fullurl : path,
-		AP_SERVER_BASEREVISION,
+		AP_AB_BASEREVISION,
 		keepalive ? "Connection: Keep-Alive\r\n" : "",
 		cookie, auth,
 		host_field, colonhost, postlen,
 		(content_type[0]) ? content_type : "text/plain", hdrs);
     }
 
@@ -1218,12 +1606,15 @@
 		status, inbytes_left, outbytes_left);
 	exit(1);
     }
 #endif				/* NOT_ASCII */
 
     /* This only needs to be done once */
+#ifdef USE_SSL
+    if (ssl != 1)
+#endif
     if ((rv = apr_sockaddr_info_get(&destsa, connecthost, APR_UNSPEC, connectport, 0, cntxt))
 	!= APR_SUCCESS) {
 	char buf[120];
 	apr_snprintf(buf, sizeof(buf),
 		     "apr_sockaddr_info_get() for %s", connecthost);
 	apr_err(buf, rv);
@@ -1247,12 +1638,17 @@
 	timed = (apr_int32_t)((now - start) / APR_USEC_PER_SEC);
 	if (tlimit && timed > (tlimit * 1000)) {
 	    requests = done;	/* so stats are correct */
 	}
 
 	n = concurrency;
+#ifdef USE_SSL
+        if (ssl == 1)
+            status = APR_SUCCESS;
+        else
+#endif
 	status = apr_poll(readbits, &n, aprtimeout);
 	if (status != APR_SUCCESS)
 	    apr_err("apr_poll", status);
 
 	if (!n) {
 	    err("\nServer timed out\n\n");
@@ -1262,12 +1658,17 @@
 	    /*
 	     * If the connection isn't connected how can we check it?
 	     */
 	    if (con[i].state == STATE_UNCONNECTED)
 		continue;
 
+#ifdef USE_SSL
+            if (ssl == 1)
+                rv = APR_POLLIN;
+            else
+#endif
 	    apr_poll_revents_get(&rv, con[i].aprsock, readbits);
 	    /*
 	     * Notes: APR_POLLHUP is set after FIN is received on some
 	     * systems, so treat that like APR_POLLIN so that we try to read
 	     * again.
 	     *
@@ -1293,12 +1694,15 @@
 	     * When using a select based poll every time we check the bits
 	     * are reset. In 1.3's ab we copied the FD_SET's each time
 	     * through, but here we're going to check the state and if the
 	     * connection is in STATE_READ or STATE_CONNECTING we'll add the
 	     * socket back in as APR_POLLIN.
 	     */
+#ifdef USE_SSL
+            if (ssl != 1)
+#endif
 	    if (con[i].state == STATE_READ || con[i].state == STATE_CONNECTING)
 		apr_poll_socket_add(readbits, con[i].aprsock, APR_POLLIN);
 
 	}
     }
 
@@ -1316,31 +1720,31 @@
 /* ------------------------------------------------------- */
 
 /* display copyright information */
 static void copyright(void)
 {
     if (!use_html) {
-	printf("This is ApacheBench, Version %s\n", AP_SERVER_BASEREVISION " <$Revision: 1.97 $> apache-2.0");
+	printf("This is ApacheBench, Version %s\n", AP_AB_BASEREVISION " <$Revision: 1.105 $> apache-2.0");
 	printf("Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\n");
 	printf("Copyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/\n");
 	printf("\n");
     }
     else {
 	printf("<p>\n");
-	printf(" This is ApacheBench, Version %s <i>&lt;%s&gt;</i> apache-2.0<br>\n", AP_SERVER_BASEREVISION, "$Revision: 1.97 $");
+	printf(" This is ApacheBench, Version %s <i>&lt;%s&gt;</i> apache-2.0<br>\n", AP_AB_BASEREVISION, "$Revision: 1.105 $");
 	printf(" Copyright (c) 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/<br>\n");
 	printf(" Copyright (c) 1998-2002 The Apache Software Foundation, http://www.apache.org/<br>\n");
 	printf("</p>\n<p>\n");
     }
 }
 
 /* display usage information */
 static void usage(const char *progname)
 {
     fprintf(stderr, "Usage: %s [options] [http"
-#if USE_SSL
+#ifdef USE_SSL
 	    "[s]"
 #endif
 	    "://]hostname[:port]/path\n", progname);
     fprintf(stderr, "Options are:\n");
     fprintf(stderr, "    -n requests     Number of requests to perform\n");
     fprintf(stderr, "    -c concurrency  Number of multiple requests to make\n");
@@ -1364,13 +1768,13 @@
     fprintf(stderr, "    -V              Print version number and exit\n");
     fprintf(stderr, "    -k              Use HTTP KeepAlive feature\n");
     fprintf(stderr, "    -d              Do not show percentiles served table.\n");
     fprintf(stderr, "    -S              Do not show confidence estimators and warnings.\n");
     fprintf(stderr, "    -g filename     Output collected data to gnuplot format file.\n");
     fprintf(stderr, "    -e filename     Output CSV file with percentages served\n");
-#if USE_SSL
+#ifdef USE_SSL
     fprintf(stderr, "    -s              Use httpS instead of HTTP (SSL)\n");
 #endif
     fprintf(stderr, "    -h              Display usage information (this message)\n");
     exit(EINVAL);
 }
 
@@ -1385,20 +1789,23 @@
     char *scope_id;
     apr_status_t rv;
 
     /* Save a copy for the proxy */
     fullurl = apr_pstrdup(cntxt, url);
 
-    if (strlen(url) > 7 && strncmp(url, "http://", 7) == 0)
+    if (strlen(url) > 7 && strncmp(url, "http://", 7) == 0) {
 	url += 7;
-    else
 #if USE_SSL
+	ssl = 0;
+#endif
+    }
+    else
+#ifdef USE_SSL
     if (strlen(url) > 8 && strncmp(url, "https://", 8) == 0) {
 	url += 8;
 	ssl = 1;
-	port = 443;
     }
 #else
     if (strlen(url) > 8 && strncmp(url, "https://", 8) == 0) {
 	fprintf(stderr, "SSL not compiled in; no https support\n");
 	exit(1);
     }
@@ -1420,14 +1827,20 @@
     }
     else {
 	host_field = hostname;
     }
 
     if (port == 0) {		/* no port specified */
-	port = 80;
-    };
+#if USE_SSL
+        if (ssl == 1)
+            port = 443;
+        else
+#endif
+            port = 80;
+    }
+
     if ((
 #if USE_SSL
          (ssl == 1) && (port != 443)) || (( ssl == 0 ) && 
 #endif
          (port != 80)))
     {
@@ -1523,19 +1936,19 @@
 	exit(1);
     }
 #endif
 
     apr_getopt_init(&opt, cntxt, argc, argv);
     while ((status = apr_getopt(opt, "n:c:t:T:p:v:kVhwix:y:z:C:H:P:A:g:X:de:Sq"
-#if USE_SSL
+#ifdef USE_SSL
 				"s"
 #endif
 				,&c, &optarg)) == APR_SUCCESS) {
 	switch (c) {
 	case 's':
-#if USE_SSL
+#ifdef USE_SSL
         ssl = 1;
         break;
 #else
         fprintf(stderr, "SSL not compiled in; no https support\n");
         exit(1);
 #endif
@@ -1690,21 +2103,31 @@
 				 * connections. */
     }
     else
 	heartbeatres = 0;
 
 #ifdef USE_SSL
+    CRYPTO_malloc_init();
+    SSL_load_error_strings();
     SSL_library_init();
-    if (!(ctx = SSL_CTX_new(SSLv2_client_method()))) {
+    bio_out=BIO_new_fp(stdout,BIO_NOCLOSE);
+    bio_err=BIO_new_fp(stderr,BIO_NOCLOSE);
+
+    /* TODO: Allow force SSLv2_client_method() (TLSv1?) */
+    if (!(ctx = SSL_CTX_new(SSLv23_client_method()))) {
 	fprintf(stderr, "Could not init SSL CTX");
 	ERR_print_errors_fp(stderr);
 	exit(1);
     }
+    SSL_CTX_set_options(ctx, SSL_OP_ALL);
+#ifdef USE_THREADS
+    ssl_util_thread_setup(cntxt);
+#endif
 #endif
-#if SIGPIPE
-    signal(SIGPIPE, SIG_IGN);	        /* Ignore writes to connections that
+#ifdef SIGPIPE
+    apr_signal(SIGPIPE, SIG_IGN);       /* Ignore writes to connections that
 					 * have been closed at the other end. */
 #endif
     copyright();
     test();
     apr_pool_destroy(cntxt);
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: apachectl
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/apachectl.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/apachectl.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/apachectl.in	2002-04-15 08:41:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/apachectl.in	2002-05-27 19:46:01.000000000 +0800
@@ -4,12 +4,14 @@
 # See license at the end of this file.
 #
 # Apache control script designed to allow an easy command line interface
 # to controlling Apache.  Written by Marc Slemko, 1997/08/23
 # 
 # The exit codes returned are:
+#   XXX this doc is no longer correct now that the interesting
+#   XXX functions are handled by httpd
 #	0 - operation completed successfully
 #	1 - 
 #	2 - usage error
 #	3 - httpd could not be started
 #	4 - httpd could not be stopped
 #	5 - httpd could not be started during a restart
@@ -22,15 +24,12 @@
 #
 ARGV="$@"
 #
 # |||||||||||||||||||| START CONFIGURATION SECTION  ||||||||||||||||||||
 # --------------------                              --------------------
 # 
-# the path to your PID file
-PIDFILE=@exp_runtimedir@/@progname@.pid
-#
 # the path to your httpd binary, including options if necessary
 HTTPD='@exp_sbindir@/@progname@'
 #
 # pick up any necessary environment variables
 if test -f @exp_bindir@/envvars; then
   . @exp_bindir@/envvars
@@ -47,152 +46,38 @@
 #
 # --------------------                              --------------------
 # ||||||||||||||||||||   END CONFIGURATION SECTION  ||||||||||||||||||||
 
 ERROR=0
 if [ "x$ARGV" = "x" ] ; then 
-    ARGS="help"
+    ARGV="-h"
 fi
 
-for ARG in $ARGV $ARGS
-do
-    # check for pidfile
-    if [ -f $PIDFILE ] ; then
-	PID=`cat $PIDFILE`
-	if [ "x$PID" != "x" ] && kill -0 $PID 2>/dev/null ; then
-	    STATUS="@progname@ (pid $PID) running"
-	    RUNNING=1
-	else
-	    STATUS="@progname@ (pid $PID?) not running"
-	    RUNNING=0
-	fi
-    else
-	STATUS="@progname@ (no pid file) not running"
-	RUNNING=0
-    fi
-
-    case $ARG in
-    start)
-	if [ $RUNNING -eq 1 ]; then
-	    echo "$0 $ARG: @progname@ (pid $PID) already running"
-	    continue
-	fi
-	if $HTTPD ; then
-	    echo "$0 $ARG: @progname@ started"
-	else
-	    echo "$0 $ARG: @progname@ could not be started"
-	    ERROR=3
-	fi
-	;;
-    startssl|sslstart|start-SSL)
-        if [ $RUNNING -eq 1 ]; then
-            echo "$0 $ARG: @progname@ (pid $PID) already running"
-            continue
-        fi
-        if $HTTPD -DSSL; then
-            echo "$0 $ARG: @progname@ started"
-        else
-            echo "$0 $ARG: @progname@ could not be started"
-            ERROR=3
-        fi
-        ;;
-    stop)
-	if [ $RUNNING -eq 0 ]; then
-	    echo "$0 $ARG: $STATUS"
-	    continue
-	fi
-	if kill $PID ; then
-	    echo "$0 $ARG: @progname@ stopped"
-	else
-	    echo "$0 $ARG: @progname@ could not be stopped"
-	    ERROR=4
-	fi
-	;;
-    restart)
-	if [ $RUNNING -eq 0 ]; then
-	    echo "$0 $ARG: @progname@ not running, trying to start"
-	    if $HTTPD ; then
-		echo "$0 $ARG: @progname@ started"
-	    else
-		echo "$0 $ARG: @progname@ could not be started"
-		ERROR=5
-	    fi
-	else
-	    if $HTTPD -t >/dev/null 2>&1; then
-		if kill -HUP $PID ; then
-		    echo "$0 $ARG: @progname@ restarted"
-		else
-		    echo "$0 $ARG: @progname@ could not be restarted"
-		    ERROR=6
-		fi
-	    else
-		echo "$0 $ARG: configuration broken, ignoring restart"
-		echo "$0 $ARG: (run 'apachectl configtest' for details)"
-		ERROR=6
-	    fi
-	fi
-	;;
-    graceful)
-	if [ $RUNNING -eq 0 ]; then
-	    echo "$0 $ARG: @progname@ not running, trying to start"
-	    if $HTTPD ; then
-		echo "$0 $ARG: @progname@ started"
-	    else
-		echo "$0 $ARG: @progname@ could not be started"
-		ERROR=5
-	    fi
-	else
-	    if $HTTPD -t >/dev/null 2>&1; then
-		if kill -@AP_SIG_GRACEFUL_SHORT@ $PID ; then
-		    echo "$0 $ARG: @progname@ gracefully restarted"
-		else
-		    echo "$0 $ARG: @progname@ could not be restarted"
-		    ERROR=7
-		fi
-	    else
-		echo "$0 $ARG: configuration broken, ignoring restart"
-		echo "$0 $ARG: (run 'apachectl configtest' for details)"
-		ERROR=7
-	    fi
-	fi
-	;;
-    status)
-	$LYNX $STATUSURL | awk ' /process$/ { print; exit } { print } '
-	;;
-    fullstatus)
-	$LYNX $STATUSURL
-	;;
-    configtest)
-	if $HTTPD -t; then
-	    :
-	else
-	    ERROR=8
-	fi
-	;;
-    *)
-	echo "usage: $0 (start|stop|restart|fullstatus|status|graceful|configtest|help)"
-	cat <<EOF
-
-start      - start @progname@
-startssl   - start @progname@ with SSL enabled
-stop       - stop @progname@
-restart    - restart @progname@ if running by sending a SIGHUP or start if 
-             not running
-fullstatus - dump a full status screen; requires lynx and mod_status enabled
-status     - dump a short status screen; requires lynx and mod_status enabled
-graceful   - do a graceful restart by sending a @AP_SIG_GRACEFUL@ or start if not running
-configtest - do a configuration syntax test
-help       - this screen
-
-EOF
-	ERROR=2
+case $ARGV in
+start|stop|restart|graceful)
+    $HTTPD -k $ARGV
+    ERROR=$?
     ;;
-
-    esac
-
-done
+startssl|sslstart|start-SSL)
+    $HTTPD -k start -DSSL
+    ERROR=$?
+    ;;
+configtest)
+    $HTTPD -t
+    ERROR=$?
+    ;;
+status)
+    $LYNX $STATUSURL | awk ' /process$/ { print; exit } { print } '
+    ;;
+fullstatus)
+    $LYNX $STATUSURL
+    ;;
+*)
+    $HTTPD $ARGV
+    ERROR=$?
+esac
 
 exit $ERROR
 
 # ====================================================================
 # The Apache Software License, Version 1.1
 #
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: apxs
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/apxs.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/apxs.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/apxs.in	2002-04-30 02:09:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/apxs.in	2002-06-14 01:06:04.000000000 +0800
@@ -58,20 +58,24 @@
 package apxs;
 
 ##
 ##  Configuration
 ##
 
-my $prefix         = "@prefix@";
-my $CFG_PREFIX     = $prefix;
+my %config_vars = ();
+
+my $installbuilddir = "@exp_installbuilddir@";
+get_config_vars("$installbuilddir/config_vars.mk",\%config_vars);
 
 # read the configuration variables once
-my %config_vars = ();
-get_config_vars("$prefix/build/config_vars.mk",\%config_vars);
 
+my $prefix         = get_vars("prefix");
+my $CFG_PREFIX     = $prefix;
 my $exec_prefix    = get_vars("exec_prefix");
+my $datadir        = get_vars("datadir");
+my $localstatedir  = get_vars("localstatedir");
 my $CFG_TARGET     = get_vars("progname");
 my $CFG_SYSCONFDIR = get_vars("sysconfdir");
 my $CFG_CFLAGS     = join ' ', map { get_vars($_) }
   qw(SHLTCFLAGS CFLAGS NOTEST_CPPFLAGS EXTRA_CPPFLAGS EXTRA_CFLAGS);
 my $includedir     = get_vars("includedir");
 my $CFG_INCLUDEDIR = eval qq("$includedir");
@@ -220,13 +224,13 @@
 ##
 ##  Initial shared object support check
 ##
 my $httpd = get_vars("sbindir") . "/" . get_vars("progname");
 $httpd = eval qq("$httpd");
 $httpd = eval qq("$httpd");
-my $envvars = get_vars("bindir") . "/envvars";
+my $envvars = get_vars("sbindir") . "/envvars";
 $envvars = eval qq("$envvars");
 $envvars = eval qq("$envvars");
 
 #allow apxs to be run from the source tree, before installation
 if ($0 =~ m:support/apxs$:) {
     ($httpd = $0) =~ s:support/apxs$::;
@@ -264,21 +268,21 @@
     foreach $arg (@_) {
         if (exists $config_vars{$arg} or exists $config_vars{lc $arg}) {
             my $val = exists $config_vars{$arg}
                 ? $config_vars{$arg}
                 : $config_vars{lc $arg};
             $val =~ s/[()]//g;
-            $result .= eval "qq($val)";
+            $result .= eval "qq($val)" if defined $val;
             $result .= ";;";
             $ok = 1;
         }
         if (not $ok) {
             if (exists $internal_vars{$arg} or exists $internal_vars{lc $arg}) {
                 my $val = exists $internal_vars{$arg} ? $arg : lc $arg;
                 $val = eval "\$CFG_$val";
-                $result .= eval "qq($val)";
+                $result .= eval "qq($val)" if defined $val;
                 $result .= ";;";
                 $ok = 1;
             }
             if (not $ok) {
                 error("Invalid query string `$arg'");
                 exit(1);
@@ -321,12 +325,13 @@
     }
 
     my $data = join('', <DATA>);
     $data =~ s|%NAME%|$name|sg;
     $data =~ s|%TARGET%|$CFG_TARGET|sg;
     $data =~ s|%PREFIX%|$prefix|sg;
+    $data =~ s|%INSTALLBUILDDIR%|$installbuilddir|sg;
 
     my ($mkf, $mods, $src) = ($data =~ m|^(.+)-=#=-\n(.+)-=#=-\n(.+)|s);
 
     notice("Creating [DIR]  $name");
     system("mkdir $name");
     notice("Creating [FILE] $name/Makefile");
@@ -415,13 +420,13 @@
         my $lo = $s;
         $lo =~ s|\.c$|.lo|;
         my $la = $s;
         $la =~ s|\.c$|.la|;
         my $o = $s;
         $o =~ s|\.c$|.o|;
-        push(@cmds, "$prefix/build/libtool $ltflags --mode=compile $CFG_CC $cflags -I$CFG_INCLUDEDIR $opt -c -o $lo $s && touch $slo");
+        push(@cmds, "$installbuilddir/libtool $ltflags --mode=compile $CFG_CC $cflags -I$CFG_INCLUDEDIR $opt -c -o $lo $s && touch $slo");
         unshift(@objs, $lo);
     }
 
     #   create link command
     my $o;
     my $lo;	
@@ -440,13 +445,13 @@
         $opt .= " -L$opt_L";
     }
     foreach $opt_l (@opt_l) {
         $opt .= " -l$opt_l";
     }
 
-    push(@cmds, "$prefix/build/libtool $ltflags --mode=link $CFG_CC -o $dso_file -rpath $CFG_LIBEXECDIR -module -avoid-version $opt $lo");
+    push(@cmds, "$installbuilddir/libtool $ltflags --mode=link $CFG_CC -o $dso_file -rpath $CFG_LIBEXECDIR -module -avoid-version $opt $lo");
 
     #   execute the commands
     &execute_cmds(@cmds);
 
     #   allow one-step compilation and installation
     if ($opt_i or $opt_e) {
@@ -471,14 +476,14 @@
             exit(1);
         }
         my $t = $f;
         $t =~ s|^.+/([^/]+)$|$1|;
         $t =~ s|\.la$|\.so|;
         if ($opt_i) {
-	    push(@cmds, "$prefix/build/instdso.sh SH_LIBTOOL='" .
-                 "$prefix/build/libtool' $f $CFG_LIBEXECDIR");
+	    push(@cmds, "$installbuilddir/instdso.sh SH_LIBTOOL='" .
+                 "$installbuilddir/libtool' $f $CFG_LIBEXECDIR");
 	    push(@cmds, "chmod 755 $CFG_LIBEXECDIR/$t");
         }
 
         #   determine module symbolname and filename
         my $filename = '';
         if ($name eq 'unknown') {
@@ -586,16 +591,16 @@
 __DATA__
 ##
 ##  Makefile -- Build procedure for sample %NAME% Apache module
 ##  Autogenerated via ``apxs -n %NAME% -g''.
 ##
 
-builddir=$(shell pwd)
+builddir=.
 top_srcdir=%PREFIX%
 top_builddir=%PREFIX%
-include %PREFIX%/build/special.mk
+include %INSTALLBUILDDIR%/special.mk
 
 #   the used tools
 APXS=apxs
 APACHECTL=apachectl
 
 #   additional defines, includes and libraries
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: dbmmanage
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: envvars-std
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/envvars-std.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/envvars-std.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/envvars-std.in	2001-12-16 05:50:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/envvars-std.in	2002-06-04 00:31:43.000000000 +0800
@@ -1,10 +1,8 @@
 # envvars-std - default environment variables for apachectl
 #
 # This file is generated from envvars-std.in
 #
-# the following lines are automatically uncommented for
-# binary builds
-#binbuild @SHLIBPATH_VAR@="@prefix@/lib/:$@SHLIBPATH_VAR@"
-#binbuild export @SHLIBPATH_VAR@
+@SHLIBPATH_VAR@="@exp_libdir@:$@SHLIBPATH_VAR@"
+export @SHLIBPATH_VAR@
 #
 @OS_SPECIFIC_VARS@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/htdigest.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/htdigest.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/htdigest.c	2002-04-14 03:35:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/htdigest.c	2002-05-11 02:20:29.000000000 +0800
@@ -115,13 +115,13 @@
 	++x;
     y = 0;
 
     while ((line[y++] = line[x++]));
 }
 
-static int getline(char *s, int n, apr_file_t *f)
+static int get_line(char *s, int n, apr_file_t *f)
 {
     register int i = 0;
     char ch;
     apr_status_t rv = APR_EINVAL;
 
     while (i < (n - 1) && 
@@ -274,13 +274,13 @@
 	exit(1);
     }
     strcpy(user, argv[3]);
     strcpy(realm, argv[2]);
 
     found = 0;
-    while (!(getline(line, MAX_STRING_LEN, f))) {
+    while (!(get_line(line, MAX_STRING_LEN, f))) {
 	if (found || (line[0] == '#') || (!line[0])) {
 	    putline(tfp, line);
 	    continue;
 	}
 	strcpy(l, line);
 	getword(w, l, ':');
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/htpasswd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/htpasswd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/htpasswd.c	2002-04-14 03:35:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/htpasswd.c	2002-06-18 10:58:36.000000000 +0800
@@ -131,72 +131,35 @@
 #define ERR_SYNTAX 2
 #define ERR_PWMISMATCH 3
 #define ERR_INTERRUPTED 4
 #define ERR_OVERFLOW 5
 #define ERR_BADUSER 6
 
-/*
- * This needs to be declared statically so the signal handler can
- * access it.
- */
-static char *tempfilename;
-/*
- * If our platform knows about the tmpnam() external buffer size, create
- * a buffer to pass in.  This is needed in a threaded environment, or
- * one that thinks it is (like HP-UX).
- */
-#ifdef L_tmpnam
-static char tname_buf[L_tmpnam];
-#else
-static char *tname_buf = NULL;
-#endif
-
-/*
- * Get a line of input from the user, not including any terminating
- * newline.
- */
-static int getline(char *s, int n, FILE *f)
-{
-    register int i = 0;
-
-    while (1) {
-	s[i] = (char) fgetc(f);
-
-	if (s[i] == CR) {
-	    s[i] = fgetc(f);
-	}
-
-	if ((s[i] == 0x4) || (s[i] == LF) || (i == (n - 1))) {
-	    s[i] = '\0';
-	    return (feof(f) ? 1 : 0);
-	}
-	++i;
-    }
-}
-
-static void putline(FILE *f, char *l)
-{
-    int x;
+#define APHTP_NEWFILE        1
+#define APHTP_NOFILE         2
+#define APHTP_NONINTERACTIVE 4
 
-    for (x = 0; l[x]; x++) {
-	fputc(l[x], f);
-    }
-    fputc('\n', f);
-}
+apr_file_t *errfile;
+apr_file_t *ftemp = NULL;
 
 static void to64(char *s, unsigned long v, int n)
 {
     static unsigned char itoa64[] =         /* 0 ... 63 => ASCII - 64 */
 	"./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
 
     while (--n >= 0) {
 	*s++ = itoa64[v&0x3f];
 	v >>= 6;
     }
 }
 
+static void putline(apr_file_t *f, const char *l)
+{
+    apr_file_puts(l, f);
+}
+
 /*
  * Make a password record from the given information.  A zero return
  * indicates success; failure means that the output buffer contains an
  * error message instead.
  */
 static int mkrecord(char *user, char *record, size_t rlen, char *passwd,
@@ -273,81 +236,71 @@
     strcpy(record, user);
     strcat(record, ":");
     strcat(record, cpw);
     return 0;
 }
 
-static int usage(void)
+static void usage(void)
 {
-    fprintf(stderr, "Usage:\n");
-    fprintf(stderr, "\thtpasswd [-cmdps] passwordfile username\n");
-    fprintf(stderr, "\thtpasswd -b[cmdps] passwordfile username password\n\n");
-    fprintf(stderr, "\thtpasswd -n[mdps] username\n");
-    fprintf(stderr, "\thtpasswd -nb[mdps] username password\n");
-    fprintf(stderr, " -c  Create a new file.\n");
-    fprintf(stderr, " -n  Don't update file; display results on stdout.\n");
-    fprintf(stderr, " -m  Force MD5 encryption of the password"
+    apr_file_printf(errfile, "Usage:\n");
+    apr_file_printf(errfile, "\thtpasswd [-cmdps] passwordfile username\n");
+    apr_file_printf(errfile, "\thtpasswd -b[cmdps] passwordfile username password\n\n");
+    apr_file_printf(errfile, "\thtpasswd -n[mdps] username\n");
+    apr_file_printf(errfile, "\thtpasswd -nb[mdps] username password\n");
+    apr_file_printf(errfile, " -c  Create a new file.\n");
+    apr_file_printf(errfile, " -n  Don't update file; display results on stdout.\n");
+    apr_file_printf(errfile, " -m  Force MD5 encryption of the password"
 #if defined(WIN32) || defined(TPF) || defined(NETWARE)
 	" (default)"
 #endif
 	".\n");
-    fprintf(stderr, " -d  Force CRYPT encryption of the password"
+    apr_file_printf(errfile, " -d  Force CRYPT encryption of the password"
 #if (!(defined(WIN32) || defined(TPF) || defined(NETWARE)))
 	    " (default)"
 #endif
 	    ".\n");
-    fprintf(stderr, " -p  Do not encrypt the password (plaintext).\n");
-    fprintf(stderr, " -s  Force SHA encryption of the password.\n");
-    fprintf(stderr, " -b  Use the password from the command line rather "
+    apr_file_printf(errfile, " -p  Do not encrypt the password (plaintext).\n");
+    apr_file_printf(errfile, " -s  Force SHA encryption of the password.\n");
+    apr_file_printf(errfile, " -b  Use the password from the command line rather "
 	    "than prompting for it.\n");
-    fprintf(stderr,
+    apr_file_printf(errfile,
 	    "On Windows, NetWare and TPF systems the '-m' flag is used by default.\n");
-    fprintf(stderr,
+    apr_file_printf(errfile,
 	    "On all other systems, the '-p' flag will probably not work.\n");
-    return ERR_SYNTAX;
-}
-
-static void interrupted(void)
-{
-    fprintf(stderr, "Interrupted.\n");
-    if (tempfilename != NULL) {
-	unlink(tempfilename);
-    }
-    exit(ERR_INTERRUPTED);
+    exit(ERR_SYNTAX);
 }
 
 /*
  * Check to see if the specified file can be opened for the given
  * access.
  */
-static int accessible(char *fname, char *mode)
+static int accessible(apr_pool_t *pool, char *fname, int mode)
 {
-    FILE *s;
+    apr_file_t *f = NULL;
 
-    s = fopen(fname, mode);
-    if (s == NULL) {
+    if (apr_file_open(&f, fname, mode, APR_OS_DEFAULT, pool) != APR_SUCCESS) {
 	return 0;
     }
-    fclose(s);
+    apr_file_close(f);
     return 1;
 }
 
 /*
  * Return true if a file is readable.
  */
-static int readable(char *fname)
+static int readable(apr_pool_t *pool, char *fname)
 {
-    return accessible(fname, "r");
+    return accessible(pool, fname, APR_READ);
 }
 
 /*
  * Return true if the specified file can be opened for write access.
  */
-static int writable(char *fname)
+static int writable(apr_pool_t *pool, char *fname)
 {
-    return accessible(fname, "a");
+    return accessible(pool, fname, APR_APPEND);
 }
 
 /*
  * Return true if the named file exists, regardless of permissions.
  */
 static int exists(char *fname, apr_pool_t *pool)
@@ -356,94 +309,34 @@
     apr_status_t check;
 
     check = apr_stat(&sbuf, fname, APR_FINFO_TYPE, pool);
     return ((check || sbuf.filetype != APR_REG) ? 0 : 1);
 }
 
-/*
- * Copy from the current position of one file to the current position
- * of another.
- */
-static void copy_file(FILE *target, FILE *source)
-{
-    static char line[MAX_STRING_LEN];
-
-    while (fgets(line, sizeof(line), source) != NULL) {
-	fputs(line, target);
-    }
-}
-
 #ifdef NETWARE
 void nwTerminate()
 {
     pressanykey();
 }
 #endif
 
-/*
- * Let's do it.  We end up doing a lot of file opening and closing,
- * but what do we care?  This application isn't run constantly.
- */
-int main(int argc, const char * const argv[])
+static void check_args(apr_pool_t *pool, int argc, const char *const argv[], 
+                       int *alg, int *mask, char **user, char **pwfilename, 
+                       char **password)
 {
-    FILE *ftemp = NULL;
-    FILE *fpw = NULL;
-    char user[MAX_STRING_LEN];
-    char password[MAX_STRING_LEN];
-    char record[MAX_STRING_LEN];
-    char line[MAX_STRING_LEN];
-    char pwfilename[MAX_STRING_LEN];
     const char *arg;
-    int found = 0;
-    int alg = ALG_CRYPT;
-    int newfile = 0;
-    int nofile = 0;
-    int noninteractive = 0;
-    int i;
     int args_left = 2;
-    apr_pool_t *pool;
-#if APR_CHARSET_EBCDIC
-    apr_status_t rv;
-    apr_xlate_t *to_ascii;
-#endif
-
-    apr_app_initialize(&argc, &argv, NULL);
-    atexit(apr_terminate);
-#ifdef NETWARE
-    atexit(nwTerminate);
-#endif
-    apr_pool_create(&pool, NULL);
-
-#if APR_CHARSET_EBCDIC
-    rv = apr_xlate_open(&to_ascii, "ISO8859-1", APR_DEFAULT_CHARSET, pool);
-    if (rv) {
-        fprintf(stderr, "apr_xlate_open(to ASCII)->%d\n", rv);
-        exit(1);
-    }
-    rv = apr_SHA1InitEBCDIC(to_ascii);
-    if (rv) {
-        fprintf(stderr, "apr_SHA1InitEBCDIC()->%d\n", rv);
-        exit(1);
-    }
-    rv = apr_MD5InitEBCDIC(to_ascii);
-    if (rv) {
-        fprintf(stderr, "apr_MD5InitEBCDIC()->%d\n", rv);
-        exit(1);
-    }
-#endif /*APR_CHARSET_EBCDIC*/
-
-    tempfilename = NULL;
-    apr_signal(SIGINT, (void (*)(int)) interrupted);
+    int i;
 
     /*
      * Preliminary check to make sure they provided at least
      * three arguments, we'll do better argument checking as 
      * we parse the command line.
      */
     if (argc < 3) {
-        return usage();
+        usage();
     }
 
     /*
      * Go through the argument list and pick out any options.  They
      * have to precede any other arguments.
      */
@@ -451,192 +344,234 @@
 	arg = argv[i];
 	if (*arg != '-') {
 	    break;
 	}
 	while (*++arg != '\0') {
 	    if (*arg == 'c') {
-		newfile++;
+                *mask |= APHTP_NEWFILE;
 	    }
 	    else if (*arg == 'n') {
-		nofile++;
+                *mask |= APHTP_NOFILE;
 		args_left--;
 	    }
 	    else if (*arg == 'm') {
-		alg = ALG_APMD5;
+                *alg = ALG_APMD5;
 	    }
 	    else if (*arg == 's') {
-		alg = ALG_APSHA;
+                *alg = ALG_APSHA;
 	    }
 	    else if (*arg == 'p') {
-		alg = ALG_PLAIN;
+                *alg = ALG_PLAIN;
 	    }
 	    else if (*arg == 'd') {
-		alg = ALG_CRYPT;
+                *alg = ALG_CRYPT;
 	    }
 	    else if (*arg == 'b') {
-		noninteractive++;
+                *mask |= APHTP_NONINTERACTIVE;
 		args_left++;
 	    }
 	    else {
-		return usage();
+                usage();
 	    }
 	}
     }
 
+    if (*mask & (APHTP_NEWFILE | APHTP_NOFILE)) {
+        apr_file_printf(errfile, "%s: -c and -n options conflict\n", argv[0]);
+        exit(ERR_SYNTAX);
+    }
     /*
      * Make sure we still have exactly the right number of arguments left
      * (the filename, the username, and possibly the password if -b was
      * specified).
      */
     if ((argc - i) != args_left) {
-	return usage();
-    }
-    if (newfile && nofile) {
-	fprintf(stderr, "%s: -c and -n options conflict\n", argv[0]);
-	return ERR_SYNTAX;
+        usage();
     }
-    if (nofile) {
+
+    if (*mask & APHTP_NOFILE) {
 	i--;
     }
     else {
-	if (strlen(argv[i]) > (sizeof(pwfilename) - 1)) {
-	    fprintf(stderr, "%s: filename too long\n", argv[0]);
-	    return ERR_OVERFLOW;
-	}
-	strcpy(pwfilename, argv[i]);
-	if (strlen(argv[i + 1]) > (sizeof(user) - 1)) {
-	    fprintf(stderr, "%s: username too long (>%" APR_SIZE_T_FMT ")\n",
-	        argv[0], sizeof(user) - 1);
-	    return ERR_OVERFLOW;
+        if (strlen(argv[i]) > (APR_PATH_MAX - 1)) {
+            apr_file_printf(errfile, "%s: filename too long\n", argv[0]);
+            exit(ERR_OVERFLOW);
+        }
+        *pwfilename = apr_pstrdup(pool, argv[i]);
+        if (strlen(argv[i + 1]) > (MAX_STRING_LEN - 1)) {
+            apr_file_printf(errfile, "%s: username too long (> %d)\n",
+                argv[0], MAX_STRING_LEN - 1);
+            exit(ERR_OVERFLOW);
 	}
     }
-    strcpy(user, argv[i + 1]);
-    if ((arg = strchr(user, ':')) != NULL) {
-	fprintf(stderr, "%s: username contains illegal character '%c'\n",
+    *user = apr_pstrdup(pool, argv[i + 1]);
+    if ((arg = strchr(*user, ':')) != NULL) {
+        apr_file_printf(errfile, "%s: username contains illegal character '%c'\n",
 		argv[0], *arg);
-	return ERR_BADUSER;
+        exit(ERR_BADUSER);
     }
-    if (noninteractive) {
-	if (strlen(argv[i + 2]) > (sizeof(password) - 1)) {
-	    fprintf(stderr, "%s: password too long (>%" APR_SIZE_T_FMT ")\n",
-	        argv[0], sizeof(password) - 1);
-	    return ERR_OVERFLOW;
+    if (*mask & APHTP_NONINTERACTIVE) {
+        if (strlen(argv[i + 2]) > (MAX_STRING_LEN - 1)) {
+            apr_file_printf(errfile, "%s: password too long (> %d)\n",
+                argv[0], MAX_STRING_LEN);
+            exit(ERR_OVERFLOW);
 	}
-	strcpy(password, argv[i + 2]);
+        *password = apr_pstrdup(pool, argv[i + 2]);
     }
+}
+
+/*
+ * Let's do it.  We end up doing a lot of file opening and closing,
+ * but what do we care?  This application isn't run constantly.
+ */
+int main(int argc, const char * const argv[])
+{
+    apr_file_t *fpw = NULL;
+    char record[MAX_STRING_LEN];
+    char line[MAX_STRING_LEN];
+    char *password = NULL;
+    char *pwfilename = NULL;
+    char *user = NULL;
+    char tn[] = "htpasswd.tmp.XXXXXX";
+    char scratch[MAX_STRING_LEN];
+    char *str = NULL;
+    int found = 0;
+    int i;
+    int alg = ALG_CRYPT;
+    int mask = 0;
+    apr_pool_t *pool;
+#if APR_CHARSET_EBCDIC
+    apr_status_t rv;
+    apr_xlate_t *to_ascii;
+#endif
+
+    apr_app_initialize(&argc, &argv, NULL);
+    atexit(apr_terminate);
+#ifdef NETWARE
+    atexit(nwTerminate);
+#endif
+    apr_pool_create(&pool, NULL);
+    apr_file_open_stderr(&errfile, pool);
+
+#if APR_CHARSET_EBCDIC
+    rv = apr_xlate_open(&to_ascii, "ISO8859-1", APR_DEFAULT_CHARSET, pool);
+    if (rv) {
+        apr_file_printf(errfile, "apr_xlate_open(to ASCII)->%d\n", rv);
+        exit(1);
+    }
+    rv = apr_SHA1InitEBCDIC(to_ascii);
+    if (rv) {
+        apr_file_printf(errfile, "apr_SHA1InitEBCDIC()->%d\n", rv);
+        exit(1);
+    }
+    rv = apr_MD5InitEBCDIC(to_ascii);
+    if (rv) {
+        apr_file_printf(errfile, "apr_MD5InitEBCDIC()->%d\n", rv);
+        exit(1);
+    }
+#endif /*APR_CHARSET_EBCDIC*/
+
+    check_args(pool, argc, argv, &alg, &mask, &user, &pwfilename, &password);
+
 
 #if defined(WIN32) || defined(NETWARE)
     if (alg == ALG_CRYPT) {
 	alg = ALG_APMD5;
-	fprintf(stderr, "Automatically using MD5 format.\n");
+        apr_file_printf(errfile, "Automatically using MD5 format.\n");
     }
 #endif
 
 #if (!(defined(WIN32) || defined(TPF) || defined(NETWARE)))
     if (alg == ALG_PLAIN) {
-	fprintf(stderr,"Warning: storing passwords as plain text might "
+        apr_file_printf(errfile,"Warning: storing passwords as plain text might "
 		"just not work on this platform.\n");
     }
 #endif
-    if (! nofile) {
+    if (! mask & APHTP_NOFILE) {
 	/*
 	 * Only do the file checks if we're supposed to frob it.
 	 *
 	 * Verify that the file exists if -c was omitted.  We give a special
 	 * message if it doesn't.
 	 */
-	if ((! newfile) && (! exists(pwfilename, pool))) {
-	    fprintf(stderr,
+        if ((! mask & APHTP_NEWFILE) && (! exists(pwfilename, pool))) {
+            apr_file_printf(errfile,
 		    "%s: cannot modify file %s; use '-c' to create it\n",
 		    argv[0], pwfilename);
-	    perror("fopen");
+            perror("apr_file_open");
 	    exit(ERR_FILEPERM);
 	}
 	/*
 	 * Verify that we can read the existing file in the case of an update
 	 * to it (rather than creation of a new one).
 	 */
-	if ((! newfile) && (! readable(pwfilename))) {
-	    fprintf(stderr, "%s: cannot open file %s for read access\n",
+        if ((! mask & APHTP_NEWFILE) && (! readable(pool, pwfilename))) {
+            apr_file_printf(errfile, "%s: cannot open file %s for read access\n",
 		    argv[0], pwfilename);
-	    perror("fopen");
+            perror("apr_file_open");
 	    exit(ERR_FILEPERM);
 	}
 	/*
 	 * Now check to see if we can preserve an existing file in case
 	 * of password verification errors on a -c operation.
 	 */
-	if (newfile && exists(pwfilename, pool) && (! readable(pwfilename))) {
-	    fprintf(stderr, "%s: cannot open file %s for read access\n"
+        if ((mask & APHTP_NEWFILE) && exists(pwfilename, pool) && 
+            (! readable(pool, pwfilename))) {
+            apr_file_printf(errfile, "%s: cannot open file %s for read access\n"
 		    "%s: existing auth data would be lost on "
 		    "password mismatch",
 		    argv[0], pwfilename, argv[0]);
-	    perror("fopen");
+            perror("apr_file_open");
 	    exit(ERR_FILEPERM);
 	}
 	/*
 	 * Now verify that the file is writable!
 	 */
-	if (! writable(pwfilename)) {
-	    fprintf(stderr, "%s: cannot open file %s for write access\n",
+        if (! writable(pool, pwfilename)) {
+            apr_file_printf(errfile, "%s: cannot open file %s for write access\n",
 		    argv[0], pwfilename);
-	    perror("fopen");
+            perror("apr_file_open");
 	    exit(ERR_FILEPERM);
 	}
     }
 
     /*
      * All the file access checks (if any) have been made.  Time to go to work;
      * try to create the record for the username in question.  If that
      * fails, there's no need to waste any time on file manipulations.
      * Any error message text is returned in the record buffer, since
      * the mkrecord() routine doesn't have access to argv[].
      */
     i = mkrecord(user, record, sizeof(record) - 1,
-		 noninteractive ? password : NULL,
-		 alg);
+                 password, alg);
     if (i != 0) {
-	fprintf(stderr, "%s: %s\n", argv[0], record);
+        apr_file_printf(errfile, "%s: %s\n", argv[0], record);
 	exit(i);
     }
-    if (nofile) {
+    if (mask & APHTP_NOFILE) {
 	printf("%s\n", record);
 	exit(0);
     }
 
     /*
      * We can access the files the right way, and we have a record
      * to add or update.  Let's do it..
      */
-    errno = 0;
-    tempfilename = tmpnam(tname_buf);
-    if ((tempfilename == NULL) || (*tempfilename == '\0')) {
-	fprintf(stderr, "%s: unable to generate temporary filename\n",
-		argv[0]);
-	if (errno == 0) {
-	    errno = ENOENT;
-	}
-	perror("tmpnam");
-	exit(ERR_FILEPERM);
-    }
-    ftemp = fopen(tempfilename, "w+");
-    if (ftemp == NULL) {
-	fprintf(stderr, "%s: unable to create temporary file '%s'\n", argv[0],
-		tempfilename);
-	perror("fopen");
+    if (apr_file_mktemp(&ftemp, tn, 0, pool) != APR_SUCCESS) {
+        apr_file_printf(errfile, "%s: unable to create temporary file '%s'\n", 
+                        argv[0], tn);
 	exit(ERR_FILEPERM);
     }
+
     /*
      * If we're not creating a new file, copy records from the existing
      * one to the temporary file until we find the specified user.
      */
-    if (! newfile) {
-	char scratch[MAX_STRING_LEN];
-
-	fpw = fopen(pwfilename, "r");
-	while (! (getline(line, sizeof(line), fpw))) {
+    if (apr_file_open(&fpw, pwfilename, APR_READ, APR_OS_DEFAULT, 
+                      pool) == APR_SUCCESS) {
+        while (! (apr_file_gets(line, sizeof(line), fpw))) {
 	    char *colon;
 
 	    if ((line[0] == '#') || (line[0] == '\0')) {
 		putline(ftemp, line);
 		continue;
 	    }
@@ -649,43 +584,32 @@
 		*colon = '\0';
 	    }
 	    if (strcmp(user, scratch) != 0) {
 		putline(ftemp, line);
 		continue;
 	    }
-	    found++;
-	    break;
+            else {
+                /* We found the user we were looking for, add him to the file.
+                 */
+                apr_file_printf(errfile, "Updating ");
+                putline(ftemp, record);
+            }
 	}
     }
-    if (found) {
-	fprintf(stderr, "Updating ");
-    }
-    else {
-	fprintf(stderr, "Adding ");
+    if (!found) {
+        apr_file_printf(errfile, "Adding ");
+        putline(ftemp, record);
     }
-    fprintf(stderr, "password for user %s\n", user);
-    /*
-     * Now add the user record we created.
-     */
-    putline(ftemp, record);
-    /*
-     * If we're updating an existing file, there may be additional
-     * records beyond the one we're updating, so copy them.
-     */
-    if (! newfile) {
-	copy_file(ftemp, fpw);
-	fclose(fpw);
-    }
-    /*
-     * The temporary file now contains the information that should be
-     * in the actual password file.  Close the open files, re-open them
-     * in the appropriate mode, and copy them file to the real one.
+    apr_file_printf(errfile, "password for user %s\n", user);
+    apr_file_close(fpw);
+
+    /* The temporary file has all the data, just copy it to the new location.
      */
-    fclose(ftemp);
-    fpw = fopen(pwfilename, "w+");
-    ftemp = fopen(tempfilename, "r");
-    copy_file(fpw, ftemp);
-    fclose(fpw);
-    fclose(ftemp);
-    unlink(tempfilename);
+#if defined(OS2) || defined(WIN32)
+    str = apr_psprintf(pool, "copy \"%s\" \"%s\"", tn, pwfilename);
+#else
+    str = apr_psprintf(pool, "cp %s %s", tn, pwfilename);
+#endif
+    system(str);
+    apr_file_close(ftemp);
     return 0;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/list_hooks.pl /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/list_hooks.pl
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/list_hooks.pl	2001-05-27 23:31:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/list_hooks.pl	2002-05-06 20:04:56.000000000 +0800
@@ -1,26 +1,26 @@
 #!/usr/bin/perl -w
 
 use strict;
 
 use Carp;
 
-my $path=shift;
+my $path=shift || '.';
 
 findInDir($path);
 
 foreach my $hook (sort keys %::Hooks) {
     my $h=$::Hooks{$hook};
     for my $x (qw(declared implemented type args)) {
-	croak "$hook datum '$x' missing" if !exists $h->{$x};
+	print "$hook datum '$x' missing\n" if !exists $h->{$x};
     }
     print "$hook\n";
-    print "  declared in $h->{declared}\n";
-    print "  implemented in $h->{implemented}\n";
-    print "  type is $h->{type}\n";
-    print "  $h->{ret} $hook($h->{args})\n";
+    print "  declared in $h->{declared}\n" if defined $h->{declared};
+    print "  implemented in $h->{implemented}\n" if defined $h->{implemented};
+    print "  type is $h->{type}\n" if defined $h->{type};
+    print "  $h->{ret} $hook($h->{args})\n" if defined $h->{args};
     print "\n";
 }
 
 sub findInDir {
     my $path=shift;
 
@@ -58,12 +58,21 @@
 
 	    croak "$name declared twice! ($_)"
 		if exists $::Hooks{$name}->{declared};
 	    $::Hooks{$name}->{declared}=$file;
 	    $::Hooks{$name}->{ret}=$ret;
 	    $::Hooks{$name}->{args}=$args;
+	} elsif(/AP_DECLARE_HOOK\(([^,]+),([^,]+)/) {
+# really we should swallow subsequent lines to get the arguments...
+	    my $name=$2;
+	    my $ret=$1;
+	    croak "$name declared twice! ($_)"
+		if exists $::Hooks{$name}->{declared};
+	    $::Hooks{$name}->{declared}=$file;
+	    $::Hooks{$name}->{ret}=$ret;
+	    $::Hooks{$name}->{args}='???';
 	}
 	if(/AP_IMPLEMENT_HOOK_()(VOID)\(([^,\s]+)/
 	   || /AP_IMPLEMENT(_OPTIONAL|)_HOOK_(.*?)\([^,]+?\s*,\s*([^,\s]+)/) {
 	    my($type,$name)=($1 ? "OPTIONAL $2" : $2,$3);
 
 #	    print "found $name $type in $file\n";
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/logresolve.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/logresolve.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/logresolve.c	2001-08-30 13:52:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/logresolve.c	2002-05-11 02:20:29.000000000 +0800
@@ -63,13 +63,13 @@
 #endif
 #if APR_HAVE_ARPA_INET_H
 #include <arpa/inet.h>
 #endif
 
 static void cgethost(struct in_addr ipnum, char *string, int check);
-static int getline(char *s, int n);
+static int get_line(char *s, int n);
 static void stats(FILE *output);
 
 #ifdef BEOS
 #define NO_ADDRESS NO_DATA
 #endif
 
@@ -279,13 +279,13 @@
 
 
 /*
  * gets a line from stdin
  */
 
-static int getline (char *s, int n)
+static int get_line (char *s, int n)
 {
     char *cp;
 
     if (!fgets(s, n, stdin))
 	return (0);
     cp = strchr(s, '\n');
@@ -329,13 +329,13 @@
 
     for (i = 0; i < BUCKETS; i++)
 	nscache[i] = NULL;
     for (i = 0; i < MAX_ERR + 2; i++)
 	errors[i] = 0;
 
-    while (getline(line, MAXLINE)) {
+    while (get_line(line, MAXLINE)) {
 	if (line[0] == '\0')
 	    continue;
 	entries++;
 	if (!apr_isdigit(line[0])) {	/* short cut */
 	    puts(line);
 	    withname++;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: logresolve.pl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: log_server_status
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: Makefile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/Makefile.in	2002-03-25 17:50:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/Makefile.in	2002-06-15 12:41:52.000000000 +0800
@@ -1,34 +1,32 @@
 DISTCLEAN_TARGETS = apxs apachectl dbmmanage log_server_status \
 	logresolve.pl phf_abuse_log.cgi split-logfile
 
 PROGRAMS = htpasswd htdigest rotatelogs logresolve ab checkgid htdbm
 TARGETS  = $(PROGRAMS)
 
-PROGRAM_LDADD        = $(EXTRA_LDFLAGS) $(UTIL_LDFLAGS) $(PROGRAM_DEPENDENCIES) $(EXTRA_LIBS)
-PROGRAM_DEPENDENCIES = \
-	$(top_builddir)/srclib/apr-util/libaprutil.la \
-	$(top_builddir)/srclib/apr/libapr.la
+PROGRAM_LDADD        = $(UTIL_LDFLAGS) $(PROGRAM_DEPENDENCIES) $(EXTRA_LIBS) $(AP_LIBS)
+PROGRAM_DEPENDENCIES = 
 
 include $(top_builddir)/build/rules.mk
 
 install:
-	@test -d $(bindir) || $(MKINSTALLDIRS) $(bindir)
-	@test -d $(sbindir) || $(MKINSTALLDIRS) $(sbindir)
-	@test -d $(libexecdir) || $(MKINSTALLDIRS) $(libexecdir)
-	@cp -p $(top_builddir)/server/httpd.exp $(libexecdir)
+	@test -d $(DESTDIR)$(bindir) || $(MKINSTALLDIRS) $(DESTDIR)$(bindir)
+	@test -d $(DESTDIR)$(sbindir) || $(MKINSTALLDIRS) $(DESTDIR)$(sbindir)
+	@test -d $(DESTDIR)$(libexecdir) || $(MKINSTALLDIRS) $(DESTDIR)$(libexecdir)
+	@cp -p $(top_builddir)/server/httpd.exp $(DESTDIR)$(libexecdir)
 	@for i in apxs apachectl dbmmanage; do \
 	    if test -f "$(builddir)/$$i"; then \
-	        cp -p $$i $(sbindir); \
-	        chmod 755 $(sbindir)/$$i; \
+	        cp -p $$i $(DESTDIR)$(sbindir); \
+	        chmod 755 $(DESTDIR)$(sbindir)/$$i; \
 	    fi ; \
 	done
 	@if test -f "$(builddir)/envvars-std"; then \
-	    cp -p envvars-std $(sbindir); \
-	    if test ! -f $(sbindir)/envvars; then \
-	        cp -p envvars-std $(sbindir)/envvars ; \
+	    cp -p envvars-std $(DESTDIR)$(sbindir); \
+	    if test ! -f $(DESTDIR)$(sbindir)/envvars; then \
+	        cp -p envvars-std $(DESTDIR)$(sbindir)/envvars ; \
 	    fi ; \
 	fi
 
 htpasswd_OBJECTS = htpasswd.lo
 htpasswd: $(htpasswd_OBJECTS)
 	$(LINK) $(htpasswd_LTFLAGS) $(htpasswd_OBJECTS) $(PROGRAM_LDADD)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/NWGNUmakefile /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/NWGNUmakefile
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/NWGNUmakefile	2002-05-01 05:54:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/NWGNUmakefile	2002-05-30 05:16:46.000000000 +0800
@@ -153,12 +153,13 @@
 TARGET_nlm = \
 	$(OBJDIR)/ab.nlm \
 	$(OBJDIR)/htpasswd.nlm \
 	$(OBJDIR)/htdigest.nlm \
 	$(OBJDIR)/htdbm.nlm \
 	$(OBJDIR)/logres.nlm \
+	$(OBJDIR)/rotlogs.nlm \
 	$(EOLIST)
 
 #
 # If there is an LIB target, put it here
 #
 TARGET_lib = \
@@ -229,13 +230,13 @@
 
 #
 # Updated this target to create necessary directories and copy files to the 
 # correct place.  (See $(AP_WORK)\build\NWGNUhead.inc for examples)
 #
 install :: nlms FORCE
-	copy $(OBJDIR)\*.nlm $(INSTALL)\Apache2\*.*
+	copy $(OBJDIR)\*.nlm $(INSTALL)\Apache2\bin\*.*
 
 #
 # Any specialized rules here
 #
 
 #
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support: NWGNUrotlogs
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: phf_abuse_log.cgi
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/rotatelogs.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/rotatelogs.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/rotatelogs.c	2002-04-14 03:35:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/rotatelogs.c	2002-06-15 01:16:03.000000000 +0800
@@ -91,79 +91,124 @@
 #define MAX_PATH        1024
 #endif
 
 int main (int argc, const char * const argv[])
 {
     char buf[BUFSIZE], buf2[MAX_PATH], errbuf[ERRMSGSZ];
-    int tLogEnd = 0, tRotation, utc_offset = 0;
+    int tLogEnd = 0, tRotation = 0, utc_offset = 0;
+    unsigned int sRotation = 0;
     int nMessCount = 0;
     apr_size_t nRead, nWrite;
     int use_strftime = 0;
-    int now;
+    int now = 0;
     const char *szLogRoot;
     apr_file_t *f_stdin, *nLogFD = NULL, *nLogFDprev = NULL;
     apr_pool_t *pool;
+    char *ptr = NULL;
 
     apr_app_initialize(&argc, &argv, NULL);
     atexit(apr_terminate);
 
     apr_pool_create(&pool, NULL);
     if (argc < 3 || argc > 4) {
         fprintf(stderr,
                 "Usage: %s <logfile> <rotation time in seconds> "
-                "[offset minutes from UTC]\n\n",
+                "[offset minutes from UTC] or <rotation size in megabytes>\n\n",
                 argv[0]);
 #ifdef OS2
         fprintf(stderr,
                 "Add this:\n\nTransferLog \"|%s.exe /some/where 86400\"\n\n",
                 argv[0]);
 #else
         fprintf(stderr,
                 "Add this:\n\nTransferLog \"|%s /some/where 86400\"\n\n",
                 argv[0]);
+        fprintf(stderr,
+                "or \n\nTransferLog \"|%s /some/where 5M\"\n\n", argv[0]);
 #endif
         fprintf(stderr,
                 "to httpd.conf. The generated name will be /some/where.nnnn "
                 "where nnnn is the\nsystem time at which the log nominally "
-                "starts (N.B. this time will always be a\nmultiple of the "
-                "rotation time, so you can synchronize cron scripts with it).\n"
-                "At the end of each rotation time a new log is started.\n");
+                "starts (N.B. if using a rotation time,\nthe time will always "
+                "be a multiple of the rotation time, so you can synchronize\n"
+                "cron scripts with it). At the end of each rotation time or "
+                "when the file size\nis reached a new log is started.\n");
         exit(1);
     }
 
     szLogRoot = argv[1];
-    if (argc >= 4) {
-        utc_offset = atoi(argv[3]) * 60;
+
+    ptr = strchr (argv[2], 'M');
+    if (ptr) {
+        if (*(ptr+1) == '\0') {
+            sRotation = atoi(argv[2]) * 1048576;
+        }
+        if (sRotation == 0) {
+            fprintf(stderr, "Invalid rotation size parameter\n");
+            exit(1);
+        }
     }
-    tRotation = atoi(argv[2]);
-    if (tRotation <= 0) {
-        fprintf(stderr, "Rotation time must be > 0\n");
-        exit(6);
+    else {
+        if (argc >= 4) {
+            utc_offset = atoi(argv[3]) * 60;
+        }
+        tRotation = atoi(argv[2]);
+        if (tRotation <= 0) {
+            fprintf(stderr, "Rotation time must be > 0\n");
+            exit(6);
+        }
     }
 
     use_strftime = (strchr(szLogRoot, '%') != NULL);
     if (apr_file_open_stdin(&f_stdin, pool) != APR_SUCCESS) {
         fprintf(stderr, "Unable to open stdin\n");
         exit(1);
     }
 
     for (;;) {
         nRead = sizeof(buf);
         if (apr_file_read(f_stdin, buf, &nRead) != APR_SUCCESS)
             exit(3);
-        now = (int)(apr_time_now() / APR_USEC_PER_SEC) + utc_offset;
         if (nRead == 0)
             exit(3);
-        if (nLogFD != NULL && (now >= tLogEnd || nRead < 0)) {
-            nLogFDprev = nLogFD;
-            nLogFD = NULL;
+        if (tRotation) {
+            now = (int)(apr_time_now() / APR_USEC_PER_SEC) + utc_offset;
+            if (nLogFD != NULL && (now >= tLogEnd || nRead < 0)) {
+                nLogFDprev = nLogFD;
+                nLogFD = NULL;
+            }
         }
+        else if (sRotation) {
+            apr_finfo_t finfo;
+            apr_off_t current_size = -1;
+
+            if ((nLogFD != NULL) && 
+                (apr_file_info_get(&finfo, APR_FINFO_SIZE, nLogFD) == APR_SUCCESS)) {
+                current_size = finfo.size;
+            }
+
+            if (current_size > sRotation || nRead < 0) {
+                nLogFDprev = nLogFD;
+                nLogFD = NULL;
+            }
+        }
+        else {
+            fprintf(stderr, "No rotation time or size specified\n");
+            exit(2);
+        }
+
         if (nLogFD == NULL) {
-            int tLogStart = (now / tRotation) * tRotation;
+            int tLogStart;
+                
+            if (tRotation)
+                tLogStart = (now / tRotation) * tRotation;
+            else
+                tLogStart = (int)apr_time_sec(apr_time_now());
+
             if (use_strftime) {
-		apr_time_t tNow = tLogStart * APR_USEC_PER_SEC;
+                apr_time_t tNow = apr_time_from_sec(tLogStart);
                 apr_time_exp_t e;
                 apr_size_t rs;
 
                 apr_time_exp_gmt(&e, tNow);
                 apr_strftime(buf2, &rs, sizeof(buf2), szLogRoot, &e);
             }
@@ -187,13 +232,13 @@
                             "Resetting log file due to error opening "
                             "new log file. %10d messages lost.\n",
                             nMessCount);
                     nWrite = strlen(errbuf);
                     apr_file_trunc(nLogFD, 0);
                     if (apr_file_write(nLogFD, errbuf, &nWrite) != APR_SUCCESS) {
-                        fprintf(stderr, "Error witing to the file %s\n", buf2);
+                        fprintf(stderr, "Error writing to the file %s\n", buf2);
                         exit(2);
                     }
                 }
             }
             else if (nLogFDprev) {
                 apr_file_close(nLogFDprev);
@@ -210,13 +255,13 @@
                     "Error writing to log file. "
                     "%10d messages lost.\n",
                     nMessCount);
             nWrite = strlen(errbuf);
             apr_file_trunc(nLogFD, 0);
             if (apr_file_write(nLogFD, errbuf, &nWrite) != APR_SUCCESS) {
-                fprintf(stderr, "Error witing to the file %s\n", buf2);
+                fprintf(stderr, "Error writing to the file %s\n", buf2);
                 exit(2);
             }
         }
         else {
             nMessCount++;
         }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support: split-logfile
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/split-logfile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/split-logfile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/split-logfile.in	2002-03-14 04:48:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/split-logfile.in	2002-06-16 04:35:14.000000000 +0800
@@ -76,12 +76,17 @@
     # If it's blank, the request was handled by the default
     # server, so supply a default name.  This shouldn't
     # happen, but caution rocks.
     #
     $vhost = lc ($vhost) or "access";
     #
+    # if the vhost contains a "/" or "\", it is illegal so just use 
+    # the default log to avoid any security issues due if it is interprted
+    # as a directory separator.
+    if ($vhost =~ m#[/\\]#) { $vhost = "access" }
+    #
     # If the log file for this virtual host isn't opened
     # yet, do it now.
     #
     if (! $is_open{$vhost}) {
         open $vhost, ">>${vhost}.log"
             or die ("Can't open ${vhost}.log");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/suexec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/suexec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/suexec.c	2002-03-14 04:48:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/suexec.c	2002-05-03 04:16:34.000000000 +0800
@@ -378,13 +378,13 @@
             log_err("invalid target user name: (%s)\n", target_uname);
             exit(105);
         }
     }
     else {
         if ((pw = getpwuid(atoi(target_uname))) == NULL) {
-            log_err("invalud target user id: (%s)\n", target_uname);
+            log_err("invalid target user id: (%s)\n", target_uname);
             exit(121);
         }
     }
 
     /*
      * Error out if the target group name is invalid.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.c	2002-04-20 03:19:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.c	2002-06-17 03:02:58.000000000 +0800
@@ -94,13 +94,13 @@
 #define WM_UPDATEMESSAGE       (WM_USER+1)
 #define WM_MANAGEMESSAGE       (WM_USER+2)
 #define WM_TIMER_REFRESH       10
 #define WM_TIMER_RESCAN        11
 #define SERVICE_APACHE_RESTART 128
 #define XBITMAP                16
-#define YBITMAP                16 
+#define YBITMAP                16
 #define MAX_LOADSTRING         100
 #define REFRESH_TIME           2000           /* service refresh time (ms) */
 #define RESCAN_TIME            20000          /* registry rescan time (ms) */
 
 typedef struct _st_APACHE_SERVICE
 {
@@ -117,14 +117,14 @@
     LPSTR   szComputerName;
     HKEY    hRegistry;
 } ST_MONITORED_COMP;
 
 /* Global variables */
 HINSTANCE         g_hInstance = NULL;
-CHAR              *g_szTitle;          /* The title bar text */
-CHAR              *g_szWindowClass;    /* Window Class Name  */
+CHAR             *g_szTitle;          /* The title bar text */
+CHAR             *g_szWindowClass;    /* Window Class Name  */
 HICON             g_icoStop;
 HICON             g_icoRun;
 UINT              g_bUiTaskbarCreated;
 DWORD             g_dwOSVersion;
 BOOL              g_bDlgServiceOn = FALSE;
 BOOL              g_bConsoleRun = FALSE;
@@ -145,80 +145,90 @@
 HANDLE            g_hpipeOutWrite;
 HANDLE            g_hpipeInRead;
 HANDLE            g_hpipeInWrite;
 HANDLE            g_hpipeStdError;
 LANGID            g_LangID;
 PROCESS_INFORMATION g_lpRedirectProc;
-CRITICAL_SECTION    g_stcSection;
+CRITICAL_SECTION  g_stcSection;
 LPSTR             g_szLocalHost;
 
 /* locale language support */
 static CHAR *g_lpMsg[IDS_MSG_LAST - IDS_MSG_FIRST + 1];
 
+
 void am_ClearServicesSt()
 {
     int i;
-    for (i = 0; i < MAX_APACHE_SERVICES; i++)
+    for (i = 0; i < MAX_APACHE_SERVICES; i++) 
     {
-        if (g_stServices[i].szServiceName)
+        if (g_stServices[i].szServiceName) {
             free(g_stServices[i].szServiceName);
-        if (g_stServices[i].szDisplayName)
+        }
+        if (g_stServices[i].szDisplayName) {
             free(g_stServices[i].szDisplayName);
-        if (g_stServices[i].szDescription)
+        }
+        if (g_stServices[i].szDescription) {
             free(g_stServices[i].szDescription);
-        if (g_stServices[i].szImagePath)
+        }
+        if (g_stServices[i].szImagePath) {
             free(g_stServices[i].szImagePath);
-        if (g_stServices[i].szComputerName)
+        }
+        if (g_stServices[i].szComputerName) {
             free(g_stServices[i].szComputerName);
+        }
 
     }
-    ZeroMemory(g_stServices, sizeof(ST_APACHE_SERVICE) * MAX_APACHE_SERVICES);
+    memset(g_stServices, 0, sizeof(ST_APACHE_SERVICE) * MAX_APACHE_SERVICES);
 
 }
 
+
 void am_ClearComputersSt()
 {
     int i;
-    for (i = 0; i < MAX_APACHE_COMPUTERS; i++)
-    {
+    for (i = 0; i < MAX_APACHE_COMPUTERS; i++) {
         if (g_stComputers[i].szComputerName) {
             free(g_stComputers[i].szComputerName);
             RegCloseKey(g_stComputers[i].hRegistry);
         }
     }
-    ZeroMemory(g_stComputers, sizeof(ST_MONITORED_COMP) * MAX_APACHE_COMPUTERS);
+    memset(g_stComputers, 0, sizeof(ST_MONITORED_COMP) * MAX_APACHE_COMPUTERS);
 
 }
 
-BOOL am_IsComputerConnected( LPSTR szComputerName)
+
+BOOL am_IsComputerConnected(LPSTR szComputerName)
 {
     int i = 0;
     while (g_stComputers[i].szComputerName != NULL) {
-        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0)
+        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0) {
             return TRUE;
+        }
         ++i;
     }
     return FALSE;
 }
 
-void am_DisconnectComputer( LPSTR szComputerName)
+
+void am_DisconnectComputer(LPSTR szComputerName)
 {
     int i = 0, j;
     while (g_stComputers[i].szComputerName != NULL) {
-        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0)
+        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0) {
             break;
+        }
         ++i;
     }
     if (g_stComputers[i].szComputerName != NULL) {
         free(g_stComputers[i].szComputerName);
         RegCloseKey(g_stComputers[i].hRegistry);
-        for( j = i; j < MAX_APACHE_COMPUTERS - 1; j++) {
-            g_stComputers[i].szComputerName = g_stComputers[i+1].szComputerName;
+        for (j = i; j < MAX_APACHE_COMPUTERS - 1; j++) {
+            g_stComputers[i].szComputerName= g_stComputers[i+1].szComputerName;
             g_stComputers[i].hRegistry = g_stComputers[i+1].hRegistry;
         }
-        for( i = j; i < MAX_APACHE_COMPUTERS; i++) {
+        for (i = j; i < MAX_APACHE_COMPUTERS; i++) {
             g_stComputers[i].szComputerName = NULL;
             g_stComputers[i].hRegistry = NULL;
         }
     } 
 
 }
@@ -220,35 +230,37 @@
             g_stComputers[i].hRegistry = NULL;
         }
     } 
 
 }
 
+
 void ErrorMessage(LPCSTR szError, BOOL bFatal)
 {
-    LPVOID lpMsgBuf  = NULL;
-    if (szError)
-        MessageBox(NULL, szError, g_lpMsg[IDS_MSG_ERROR-IDS_MSG_FIRST],
-                    MB_OK | (bFatal ? MB_ICONERROR : MB_ICONEXCLAMATION));
-    else
-    {
+    LPVOID lpMsgBuf = NULL;
+    if (szError) {
+        MessageBox(NULL, szError, g_lpMsg[IDS_MSG_ERROR - IDS_MSG_FIRST],
+                   MB_OK | (bFatal ? MB_ICONERROR : MB_ICONEXCLAMATION));
+    }
+    else {
         FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER |
-            FORMAT_MESSAGE_FROM_SYSTEM |
-            FORMAT_MESSAGE_IGNORE_INSERTS,
-            NULL,
-            GetLastError(),
-            g_LangID,
-            (LPSTR) &lpMsgBuf, 0, NULL);
-        MessageBox(NULL, (LPCSTR)lpMsgBuf, g_lpMsg[IDS_MSG_ERROR-IDS_MSG_FIRST],
-                    MB_OK | (bFatal ? MB_ICONERROR : MB_ICONEXCLAMATION));
+                      FORMAT_MESSAGE_FROM_SYSTEM |
+                      FORMAT_MESSAGE_IGNORE_INSERTS,
+                      NULL, GetLastError(), g_LangID,
+                      (LPSTR) &lpMsgBuf, 0, NULL);
+        MessageBox(NULL, (LPCSTR)lpMsgBuf, 
+                   g_lpMsg[IDS_MSG_ERROR - IDS_MSG_FIRST],
+                   MB_OK | (bFatal ? MB_ICONERROR : MB_ICONEXCLAMATION));
         LocalFree(lpMsgBuf);
     }
-    if ( bFatal)
+    if (bFatal) {
         PostQuitMessage(0);
+    }
 }
 
+
 BOOL am_ConnectComputer(LPSTR szComputerName)
 {
     int i = 0;
     HKEY hKeyRemote;
     char szTmp[MAX_PATH];
 
@@ -250,26 +262,28 @@
 {
     int i = 0;
     HKEY hKeyRemote;
     char szTmp[MAX_PATH];
 
     while (g_stComputers[i].szComputerName != NULL) {
-        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0)
+        if (strcmp(g_stComputers[i].szComputerName, szComputerName) == 0) {
             return FALSE;
+        }
         ++i;
     }
-    if (i > MAX_APACHE_COMPUTERS - 1)
+    if (i > MAX_APACHE_COMPUTERS - 1) {
         return FALSE;
-    if (RegConnectRegistry(szComputerName, HKEY_LOCAL_MACHINE, &hKeyRemote) != ERROR_SUCCESS)
-    {
-        sprintf(szTmp, g_lpMsg[IDS_MSG_ECONNECT-IDS_MSG_FIRST], szComputerName);
+    }
+    if (RegConnectRegistry(szComputerName, HKEY_LOCAL_MACHINE, &hKeyRemote) 
+            != ERROR_SUCCESS) {
+        sprintf(szTmp, g_lpMsg[IDS_MSG_ECONNECT - IDS_MSG_FIRST], 
+                szComputerName);
         ErrorMessage(szTmp, FALSE);
         return FALSE;
     }
-    else 
-    {
+    else {
         g_stComputers[i].szComputerName = strdup(szComputerName);
         g_stComputers[i].hRegistry = hKeyRemote;
         return TRUE;
     }
 } 
 
@@ -270,21 +284,23 @@
         g_stComputers[i].szComputerName = strdup(szComputerName);
         g_stComputers[i].hRegistry = hKeyRemote;
         return TRUE;
     }
 } 
 
+
 LPSTR GetStringRes(int id)
 {
-  static CHAR buffer[MAX_PATH];
+    static CHAR buffer[MAX_PATH];
 
-  buffer[0] = 0;
-  LoadString(GetModuleHandle (NULL), id, buffer, MAX_PATH);
-  return buffer;
+    buffer[0] = 0;
+    LoadString(GetModuleHandle(NULL), id, buffer, MAX_PATH);
+    return buffer;
 }
 
+
 BOOL GetSystemOSVersion(LPDWORD dwVersion)
 {
     OSVERSIONINFO osvi;
     /* 
     Try calling GetVersionEx using the OSVERSIONINFOEX structure.
     If that fails, try using the OSVERSIONINFO structure.
@@ -286,118 +302,139 @@
 {
     OSVERSIONINFO osvi;
     /* 
     Try calling GetVersionEx using the OSVERSIONINFOEX structure.
     If that fails, try using the OSVERSIONINFO structure.
     */
-    ZeroMemory(&osvi, sizeof(OSVERSIONINFO));
+    memset(&osvi, 0, sizeof(OSVERSIONINFO));
     osvi.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
-    
-    if (!GetVersionEx(&osvi))
+
+    if (!GetVersionEx(&osvi)) {
         return FALSE;
-    
+    }
+
     switch (osvi.dwPlatformId)
     {
-    case VER_PLATFORM_WIN32_NT:        
-        if (osvi.dwMajorVersion <= 4)
+    case VER_PLATFORM_WIN32_NT:
+        if (osvi.dwMajorVersion <= 4) {
             *dwVersion = OS_VERSION_WINNT;
-        else if (osvi.dwMajorVersion == 5)
+        }
+        else if (osvi.dwMajorVersion == 5) {
             *dwVersion = OS_VERSION_WIN2K;
-        else
+        }
+        else {
             return FALSE;
-        
-        break;        
+        }
+        break;
+
     case VER_PLATFORM_WIN32_WINDOWS:
-            *dwVersion = OS_VERSION_WIN9X;        
+        *dwVersion = OS_VERSION_WIN9X;
         break;
-        
+
     case VER_PLATFORM_WIN32s:
-            *dwVersion = 0;
-        return FALSE;
     default:
+        *dwVersion = 0;
         return FALSE;
-        break;
-   }
-   return TRUE; 
+    }
+    return TRUE; 
 }
 
+
 static VOID ShowNotifyIcon(HWND hWnd, DWORD dwMessage)
 {
-    
     NOTIFYICONDATA nid;
-    int  i = 0, n = 0;
+    int i = 0, n = 0;
 
-    ZeroMemory(&nid,sizeof(nid));
+    memset(&nid, 0, sizeof(nid));
     nid.cbSize = sizeof(NOTIFYICONDATA);
     nid.hWnd = hWnd;
     nid.uID = 0xFF;
     nid.uFlags = NIF_ICON | NIF_MESSAGE | NIF_TIP;
     nid.uCallbackMessage = WM_TRAYMESSAGE;
-    
+
     while (g_stServices[i].szServiceName != NULL)
-    {    
-        if (g_stServices[i].dwPid != 0)
+    {
+        if (g_stServices[i].dwPid != 0) {
             ++n;
+        }
         ++i;
     }
     if (dwMessage != NIM_DELETE)
     {
-        if (n)
+        if (n) {
             nid.hIcon = g_icoRun;
-        else
+        }
+        else {
             nid.hIcon = g_icoStop;
+        }
     }
-    else
+    else {
         nid.hIcon = NULL;
-    if (n == i && n > 0)
-        lstrcpy(nid.szTip, g_lpMsg[IDS_MSG_RUNNINGALL-IDS_MSG_FIRST]);
-    else if (n)
-        sprintf(nid.szTip, g_lpMsg[IDS_MSG_RUNNING-IDS_MSG_FIRST], n, i);
-    else if (i)
-        sprintf(nid.szTip, g_lpMsg[IDS_MSG_RUNNINGNONE-IDS_MSG_FIRST], i);
-    else
-        lstrcpy(nid.szTip, g_lpMsg[IDS_MSG_NOSERVICES-IDS_MSG_FIRST]);
+    }
+    if (n == i && n > 0) {
+        lstrcpy(nid.szTip, g_lpMsg[IDS_MSG_RUNNINGALL - IDS_MSG_FIRST]);
+    }
+    else if (n) {
+        sprintf(nid.szTip, g_lpMsg[IDS_MSG_RUNNING - IDS_MSG_FIRST], n, i);
+    }
+    else if (i) {
+        sprintf(nid.szTip, g_lpMsg[IDS_MSG_RUNNINGNONE - IDS_MSG_FIRST], i);
+    }
+    else {
+        lstrcpy(nid.szTip, g_lpMsg[IDS_MSG_NOSERVICES - IDS_MSG_FIRST]);
+    }
     Shell_NotifyIcon(dwMessage, &nid);
 }
 
-void appendMenuItem(HMENU hMenu, UINT uMenuId, LPSTR szName, BOOL fDefault, BOOL fEnabled)
+
+void appendMenuItem(HMENU hMenu, UINT uMenuId, LPSTR szName, 
+                    BOOL fDefault, BOOL fEnabled)
 {
     MENUITEMINFO mii;
-    
-    ZeroMemory(&mii, sizeof(MENUITEMINFO));
+
+    memset(&mii, 0, sizeof(MENUITEMINFO));
     mii.cbSize = sizeof(MENUITEMINFO);
     mii.fMask = MIIM_ID | MIIM_TYPE | MIIM_STATE;
     if (lstrlen(szName))
     {
         mii.fType = MFT_STRING;
         mii.wID = uMenuId;
-        if (fDefault)
+        if (fDefault) {
             mii.fState = MFS_DEFAULT;
-        if (!fEnabled)
+        }
+        if (!fEnabled) {
             mii.fState |= MFS_DISABLED;
+        }
         mii.dwTypeData = szName;
     }
-    else
+    else {
         mii.fType = MFT_SEPARATOR;
+    }
     InsertMenuItem(hMenu, uMenuId, FALSE, &mii);
 }
 
-void appendServiceMenu(HMENU hMenu, UINT uMenuId, LPSTR szServiceName, BOOL fRunning)
+
+void appendServiceMenu(HMENU hMenu, UINT uMenuId, 
+                       LPSTR szServiceName, BOOL fRunning)
 {
     MENUITEMINFO mii;
-    HMENU        smh;    
+    HMENU smh;
 
     smh = CreatePopupMenu();
 
-    appendMenuItem(smh,  IDM_SM_START + uMenuId, g_lpMsg[IDS_MSG_SSTART-IDS_MSG_FIRST], FALSE, !fRunning);
-    appendMenuItem(smh,  IDM_SM_STOP + uMenuId, g_lpMsg[IDS_MSG_SSTOP-IDS_MSG_FIRST], FALSE, fRunning);
-    appendMenuItem(smh,  IDM_SM_RESTART + uMenuId, g_lpMsg[IDS_MSG_SRESTART-IDS_MSG_FIRST], FALSE, fRunning);
+    appendMenuItem(smh, IDM_SM_START + uMenuId, 
+                   g_lpMsg[IDS_MSG_SSTART - IDS_MSG_FIRST], FALSE, !fRunning);
+    appendMenuItem(smh, IDM_SM_STOP + uMenuId, 
+                   g_lpMsg[IDS_MSG_SSTOP - IDS_MSG_FIRST], FALSE, fRunning);
+    appendMenuItem(smh, IDM_SM_RESTART + uMenuId, 
+                   g_lpMsg[IDS_MSG_SRESTART - IDS_MSG_FIRST], FALSE, fRunning);
 
-    ZeroMemory(&mii, sizeof(MENUITEMINFO));
+    memset(&mii, 0, sizeof(MENUITEMINFO));
     mii.cbSize = sizeof(MENUITEMINFO);
-    mii.fMask = MIIM_ID | MIIM_TYPE | MIIM_STATE | MIIM_SUBMENU | MIIM_CHECKMARKS;
+    mii.fMask = MIIM_ID | MIIM_TYPE | MIIM_STATE | MIIM_SUBMENU 
+              | MIIM_CHECKMARKS;
     mii.fType = MFT_STRING;
     mii.wID = uMenuId;
     mii.hbmpChecked = g_hBmpStart;
     mii.hbmpUnchecked = g_hBmpStop;
     mii.dwTypeData = szServiceName;
     mii.hSubMenu = smh;
@@ -410,20 +448,28 @@
     /* create popup menu */
     HMENU hMenu = CreatePopupMenu();
     POINT pt;
 
     if (hMenu)
     {
-        appendMenuItem(hMenu, IDM_RESTORE, g_lpMsg[IDS_MSG_MNUSHOW-IDS_MSG_FIRST], TRUE, TRUE);
-        if (g_dwOSVersion >= OS_VERSION_WINNT)
-            appendMenuItem(hMenu, IDC_SMANAGER, g_lpMsg[IDS_MSG_MNUSERVICES-IDS_MSG_FIRST], FALSE, TRUE);
+        appendMenuItem(hMenu, IDM_RESTORE, 
+                       g_lpMsg[IDS_MSG_MNUSHOW - IDS_MSG_FIRST], 
+                       TRUE, TRUE);
+        if (g_dwOSVersion >= OS_VERSION_WINNT) {
+            appendMenuItem(hMenu, IDC_SMANAGER, 
+                           g_lpMsg[IDS_MSG_MNUSERVICES - IDS_MSG_FIRST], 
+                           FALSE, TRUE);
+        }
         appendMenuItem(hMenu, 0, "", FALSE, TRUE);
-        appendMenuItem(hMenu, IDM_EXIT,  g_lpMsg[IDS_MSG_MNUEXIT-IDS_MSG_FIRST], FALSE, TRUE);
+        appendMenuItem(hMenu, IDM_EXIT, 
+                       g_lpMsg[IDS_MSG_MNUEXIT - IDS_MSG_FIRST],
+                       FALSE, TRUE);
 
-        if (!SetForegroundWindow(hWnd))
+        if (!SetForegroundWindow(hWnd)) {
             SetForegroundWindow(NULL);
+        }
         GetCursorPos(&pt);
         TrackPopupMenu(hMenu, TPM_LEFTALIGN|TPM_RIGHTBUTTON, 
                        pt.x, pt.y, 0, hWnd, NULL);
         DestroyMenu(hMenu);
     }
 }
@@ -435,21 +482,22 @@
     POINT pt;
     int i = 0;
 
     if (hMenu)
     {
         while (g_stServices[i].szServiceName != NULL)
-        {   
+        {
             appendServiceMenu(hMenu, i, g_stServices[i].szDisplayName,
-                              g_stServices[i].dwPid != 0);               
+                              g_stServices[i].dwPid != 0);
             ++i;
         }
         if (i)
         {
-            if (!SetForegroundWindow(hWnd))
+            if (!SetForegroundWindow(hWnd)) {
                 SetForegroundWindow(NULL);
+            }
             GetCursorPos(&pt);
             TrackPopupMenu(hMenu, TPM_LEFTALIGN|TPM_RIGHTBUTTON, 
                            pt.x, pt.y, 0, hWnd, NULL);
             DestroyMenu(hMenu);
         }
     }
@@ -452,42 +500,42 @@
                            pt.x, pt.y, 0, hWnd, NULL);
             DestroyMenu(hMenu);
         }
     }
 }
 
+
 BOOL CenterWindow(HWND hwndChild)
 {
-   RECT    rChild, rWorkArea;
-   int     wChild, hChild;
-   int     xNew, yNew;
-   BOOL    bResult;
+   RECT rChild, rWorkArea;
+   int wChild, hChild;
+   int xNew, yNew;
+   BOOL bResult;
 
    /* Get the Height and Width of the child window */
    GetWindowRect(hwndChild, &rChild);
    wChild = rChild.right - rChild.left;
    hChild = rChild.bottom - rChild.top;
 
    /* Get the limits of the 'workarea' */
-   bResult = SystemParametersInfo(
-      SPI_GETWORKAREA,
-      sizeof(RECT),
-      &rWorkArea,
-      0);
+   bResult = SystemParametersInfo(SPI_GETWORKAREA, sizeof(RECT),
+                                  &rWorkArea, 0);
    if (!bResult) {
       rWorkArea.left = rWorkArea.top = 0;
       rWorkArea.right = GetSystemMetrics(SM_CXSCREEN);
       rWorkArea.bottom = GetSystemMetrics(SM_CYSCREEN);
    }
 
    /* Calculate new X and Y position*/
-   xNew = (rWorkArea.right - wChild)/2;
-   yNew = (rWorkArea.bottom - hChild)/2;
-   return SetWindowPos (hwndChild, HWND_TOP, xNew, yNew, 0, 0, SWP_NOSIZE | SWP_SHOWWINDOW);
+   xNew = (rWorkArea.right - wChild) / 2;
+   yNew = (rWorkArea.bottom - hChild) / 2;
+   return SetWindowPos(hwndChild, HWND_TOP, xNew, yNew, 0, 0, 
+                       SWP_NOSIZE | SWP_SHOWWINDOW);
 }
 
+
 static void addListBoxItem(HWND hDlg, LPSTR lpStr, HBITMAP hBmp) 
 { 
     int nItem; 
  
     nItem = SendMessage(hDlg, LB_ADDSTRING, 0, (LPARAM)lpStr); 
     SendMessage(hDlg, LB_SETITEMDATA, nItem, (LPARAM)hBmp); 
@@ -490,20 +538,21 @@
     int nItem; 
  
     nItem = SendMessage(hDlg, LB_ADDSTRING, 0, (LPARAM)lpStr); 
     SendMessage(hDlg, LB_SETITEMDATA, nItem, (LPARAM)hBmp); 
 } 
 
+
 static void addListBoxString(HWND hListBox, LPSTR lpStr)
 {
     static int nItems = 0;
-    if (!g_bDlgServiceOn)
+    if (!g_bDlgServiceOn) {
         return;
-
+    }
     ++nItems;
-    if ( nItems > MAX_LOADSTRING)
+    if (nItems > MAX_LOADSTRING) 
     {
         SendMessage(hListBox, LB_RESETCONTENT, 0, 0); 
         nItems = 1;
     }
     ListBox_SetCurSel(hListBox,
                       ListBox_AddString(hListBox, lpStr));
@@ -506,37 +555,41 @@
         nItems = 1;
     }
     ListBox_SetCurSel(hListBox,
                       ListBox_AddString(hListBox, lpStr));
 
 }
+
+
 static DWORD WINAPI ConsoleOutputThread(LPVOID lpThreadParameter)
 {
     static BYTE lpBuffer[MAX_PATH+1];
     int nPtr = 0;
-    BYTE  ch;
+    BYTE ch;
     DWORD dwReaded;
 
     while (ReadFile(g_hpipeOutRead, &ch, 1, &dwReaded, NULL) == TRUE) 
     {
         if (dwReaded > 0) 
         {
             if (ch == '\n' || nPtr >= MAX_PATH) 
             {
                 lpBuffer[nPtr] = '\0';
                 addListBoxString(g_hwndStdoutList, lpBuffer);
-                nPtr  = 0;
+                nPtr = 0;
             } 
             else if (ch == '\t' && nPtr < (MAX_PATH - 4)) 
             {
                 int i;
-                for (i = 0; i < 4; ++i)
+                for (i = 0; i < 4; ++i) {
                     lpBuffer[nPtr++] = ' ';
+                }
             }
-            else if (ch != '\r')
+            else if (ch != '\r') {
                 lpBuffer[nPtr++] = ch;
+            }
         }
     }
     CloseHandle(g_hpipeInWrite);
     CloseHandle(g_hpipeOutRead);
     CloseHandle(g_hpipeStdError);
     return 0;
@@ -553,125 +606,128 @@
     return 0;
 }
 
 
 BOOL RunRedirectedConsole(LPSTR szCmdLine)
 {
-    
-    DWORD  dwThreadId;
+    DWORD dwThreadId;
     HANDLE hProc;
     STARTUPINFO stInfo;
     BOOL bResult;
-    ZeroMemory(&stInfo, sizeof(stInfo));
+
+    memset(&stInfo, 0, sizeof(stInfo));
     stInfo.cb = sizeof(stInfo);
     stInfo.dwFlags = STARTF_USESTDHANDLES|STARTF_USESHOWWINDOW;
     stInfo.wShowWindow = SW_HIDE;
-    
+
     hProc = GetCurrentProcess();
 
-    if (!CreatePipe(&g_hpipeInRead, &g_hpipeInWrite, NULL, MAX_PATH))
+    if (!CreatePipe(&g_hpipeInRead, &g_hpipeInWrite, NULL, MAX_PATH)) {
         ErrorMessage(NULL, TRUE);
-    if (!CreatePipe(&g_hpipeOutRead, &g_hpipeOutWrite, NULL, MAX_PATH*8))
+    }
+    if (!CreatePipe(&g_hpipeOutRead, &g_hpipeOutWrite, NULL, MAX_PATH*8)) {
         ErrorMessage(NULL, TRUE);
-        
+    }
     DuplicateHandle(hProc, g_hpipeInRead, hProc, &g_hpipeInRead, 0, TRUE, 
                     DUPLICATE_CLOSE_SOURCE|DUPLICATE_SAME_ACCESS);
     DuplicateHandle(hProc, g_hpipeOutWrite, hProc, &g_hpipeOutWrite, 0, TRUE, 
                     DUPLICATE_CLOSE_SOURCE|DUPLICATE_SAME_ACCESS);
     DuplicateHandle(hProc, g_hpipeOutWrite, hProc, &g_hpipeStdError, 0, TRUE, 
                     DUPLICATE_SAME_ACCESS);
-    if (!g_hpipeInRead && !g_hpipeOutWrite && !g_hpipeStdError)
+    if (!g_hpipeInRead && !g_hpipeOutWrite && !g_hpipeStdError) {
         ErrorMessage(NULL, TRUE);
-
+    }
     stInfo.hStdInput  = g_hpipeInRead;
     stInfo.hStdOutput = g_hpipeOutWrite;
     stInfo.hStdError  = g_hpipeStdError;
 
     bResult = CreateProcess(NULL,
         szCmdLine,
         NULL,
         NULL,
         TRUE,
         CREATE_SUSPENDED,
         NULL,
-        NULL ,
+        NULL,
         &stInfo,
         &g_lpRedirectProc);
 
 
     CloseHandle(g_hpipeInRead);
     CloseHandle(g_hpipeOutWrite);
     CloseHandle(g_hpipeStdError);
 
     if (!bResult)
-    {     
+    {
         CloseHandle(g_hpipeInWrite);
         CloseHandle(g_hpipeOutRead);
         CloseHandle(g_hpipeStdError);
         return FALSE;
     }
 
-    CloseHandle(CreateThread(NULL, 0, ConsoleOutputThread, 0, 0, &dwThreadId));
+    CloseHandle(CreateThread(NULL, 0, ConsoleOutputThread, 
+                             0, 0, &dwThreadId));
     ResumeThread(g_lpRedirectProc.hThread);
-    CloseHandle(CreateThread(NULL, 0, ConsoleWaitingThread, 0, 0, &dwThreadId));
+    CloseHandle(CreateThread(NULL, 0, ConsoleWaitingThread,
+                             0, 0, &dwThreadId));
 
     return TRUE;
 }
 
-BOOL RunAndForgetConsole(LPSTR szCmdLine,
-                         BOOL  bRedirectConsole)
+
+BOOL RunAndForgetConsole(LPSTR szCmdLine, BOOL bRedirectConsole)
 {
-        
     STARTUPINFO stInfo;
     PROCESS_INFORMATION prInfo;
     BOOL bResult;
-    
-    if (bRedirectConsole)
+
+    if (bRedirectConsole) {
         return RunRedirectedConsole(szCmdLine);
+    }
 
-    
-    ZeroMemory(&stInfo, sizeof(stInfo));
+    memset(&stInfo, 0, sizeof(stInfo));
     stInfo.cb = sizeof(stInfo);
     stInfo.dwFlags = STARTF_USESHOWWINDOW;
     stInfo.wShowWindow = SW_HIDE;
 
     bResult = CreateProcess(NULL,
-        szCmdLine,
-        NULL,
-        NULL,
-        TRUE,
-        CREATE_NEW_CONSOLE,
-        NULL,
-        NULL ,
-        &stInfo,
-        &prInfo);
+                            szCmdLine,
+                            NULL,
+                            NULL,
+                            TRUE,
+                            CREATE_NEW_CONSOLE,
+                            NULL,
+                            NULL,
+                            &stInfo,
+                            &prInfo);
 
-    if (!bResult)
-    {     
+    if (!bResult) {
         return FALSE;
     }
-    if (g_dwOSVersion == OS_VERSION_WIN9X) /* give some time to rescan the status */
+    if (g_dwOSVersion == OS_VERSION_WIN9X) {
+        /* give some time to rescan the status */
         Sleep(2000);
+    }
     CloseHandle(prInfo.hThread);
     CloseHandle(prInfo.hProcess);
     return TRUE;
 }
 
-BOOL ApacheManageService(LPCSTR szServiceName, LPCSTR szImagePath, LPSTR szComputerName, DWORD dwCommand)
+
+BOOL ApacheManageService(LPCSTR szServiceName, LPCSTR szImagePath, 
+                         LPSTR szComputerName, DWORD dwCommand)
 {
-    
-    CHAR      szBuf[MAX_PATH];
-    CHAR      szMsg[MAX_PATH];
-    LPSTR     sPos;
-    BOOL      retValue;
-    BOOL      serviceFlag = TRUE;
+    CHAR szBuf[MAX_PATH];
+    CHAR szMsg[MAX_PATH];
+    LPSTR sPos;
+    BOOL retValue;
+    BOOL serviceFlag = TRUE;
     SC_HANDLE schService;
-    SC_HANDLE schSCManager;    
+    SC_HANDLE schSCManager;
     SERVICE_STATUS schSStatus;
-    LPSTR     *args;
-    int       ticks;
+    int ticks;
 
     if (g_dwOSVersion == OS_VERSION_WIN9X)
     {
         sPos = strstr(szImagePath, "-k start");
         if (sPos)
         {
@@ -678,231 +734,235 @@
             lstrcpyn(szBuf, szImagePath, sPos - szImagePath);
             switch (dwCommand)
             {
             case SERVICE_CONTROL_STOP:
                 lstrcat(szBuf, " -k shutdown -n ");
                 break;
+
             case SERVICE_CONTROL_CONTINUE:
-                sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTART-IDS_MSG_FIRST], szServiceName);
+                sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTART - IDS_MSG_FIRST], 
+                        szServiceName);
                 addListBoxString(g_hwndStdoutList, szMsg);
                 lstrcat(szBuf, " -k start -n ");
                 serviceFlag = FALSE;
                 break;
+
             case SERVICE_APACHE_RESTART:
                 lstrcat(szBuf, " -k restart -n ");
                 break;
+
             default:
                 return FALSE;
             }
             lstrcat(szBuf, szServiceName);
         }
-        else
+        else {
             return FALSE;
+        }
         g_bConsoleRun = TRUE;
         SetCursor(g_hCursorHourglass);
         if (!RunAndForgetConsole(szBuf, serviceFlag))
         {
             ErrorMessage(NULL, FALSE);
             g_bConsoleRun = FALSE;
             SetCursor(g_hCursorArrow);
             return FALSE;
         }
         else if (!serviceFlag)
         {
-            sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTARTED-IDS_MSG_FIRST], szServiceName);
+            sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTARTED - IDS_MSG_FIRST], 
+                    szServiceName);
             addListBoxString(g_hwndStdoutList, szMsg);
             g_bConsoleRun = FALSE;
             SetCursor(g_hCursorArrow);
             return TRUE;
         }
     }
     else
     {
-        /* Apache 2.0 uses '-k runservice' as cmdline parameter */
-        sPos = strstr(szImagePath, "--ntservice");
-        if (!sPos)
-        {
-            sPos = strstr(szImagePath, "-k runservice");
-            serviceFlag = FALSE;
-        }
-        if (sPos)
-            lstrcpyn(szBuf, szImagePath, sPos - szImagePath);
-        else
+        schSCManager = OpenSCManager(szComputerName, NULL,
+                                     SC_MANAGER_ALL_ACCESS);
+        if (!schSCManager) {
             return FALSE;
-        schSCManager = OpenSCManager(
-            szComputerName,
-            NULL,
-            SC_MANAGER_ALL_ACCESS
-           );
-        if (!schSCManager)
-            return FALSE;
-        
-        schService = OpenService(schSCManager, szServiceName, SERVICE_ALL_ACCESS);
+        }
+
+        schService = OpenService(schSCManager, szServiceName, 
+                                 SERVICE_ALL_ACCESS);
         if (schService != NULL)
         {
             retValue = FALSE;
             g_bConsoleRun = TRUE;
             SetCursor(g_hCursorHourglass);
             switch (dwCommand)
             {
-                case SERVICE_CONTROL_STOP:
-                    sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTOP-IDS_MSG_FIRST], szServiceName);
-                    addListBoxString(g_hwndStdoutList, szMsg);
-                    if (ControlService(schService, SERVICE_CONTROL_STOP, &schSStatus)) 
-                    {
-                        Sleep(1000);
-                        while (QueryServiceStatus(schService, &schSStatus)) 
-                        {
-                            if (schSStatus.dwCurrentState == SERVICE_STOP_PENDING)
-                                Sleep(1000);
-                            else
-                                break;
-                        }
-                    }
-                    if (QueryServiceStatus(schService, &schSStatus))
+            case SERVICE_CONTROL_STOP:
+                sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTOP - IDS_MSG_FIRST], 
+                        szServiceName);
+                addListBoxString(g_hwndStdoutList, szMsg);
+                if (ControlService(schService, SERVICE_CONTROL_STOP, 
+                                   &schSStatus)) {
+                    Sleep(1000);
+                    while (QueryServiceStatus(schService, &schSStatus)) 
                     {
-                        if (schSStatus.dwCurrentState == SERVICE_STOPPED)
+                        if (schSStatus.dwCurrentState == SERVICE_STOP_PENDING)
                         {
-                            retValue = TRUE;
-                            sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTOPPED-IDS_MSG_FIRST], szServiceName);
-                            addListBoxString(g_hwndStdoutList, szMsg);
+                            Sleep(1000);
                         }
-                    }
-                break;                
-                case SERVICE_CONTROL_CONTINUE:
-                    sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTART-IDS_MSG_FIRST], szServiceName);
-                    addListBoxString(g_hwndStdoutList, szMsg);
-                    args = (char **)malloc(3 * sizeof(char*));
-                    args[0] = szBuf;
-                    if (serviceFlag)
-                        args[1] = "--ntservice";
-                    else
-                    {
-                        args[1] = "-k";
-                        args[2] = "runservice";
-                    }
-                    if (StartService(schService, serviceFlag ? 2 : 3, args)) 
-                    {
-                        Sleep(1000);
-                        while (QueryServiceStatus(schService, &schSStatus)) 
-                        {
-                            if (schSStatus.dwCurrentState == SERVICE_START_PENDING)
-                                Sleep(1000);
-                            else
-                                break;
+                        else {
+                            break;
                         }
                     }
-                    if (QueryServiceStatus(schService, &schSStatus))
+                }
+                if (QueryServiceStatus(schService, &schSStatus))
+                {
+                    if (schSStatus.dwCurrentState == SERVICE_STOPPED)
                     {
-                        if (schSStatus.dwCurrentState == SERVICE_RUNNING)
-                        {
-                            retValue = TRUE;
-                            sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTARTED-IDS_MSG_FIRST], szServiceName);
-                            addListBoxString(g_hwndStdoutList, szMsg);
-                        }
+                        retValue = TRUE;
+                        sprintf(szMsg, 
+                                g_lpMsg[IDS_MSG_SRVSTOPPED - IDS_MSG_FIRST], 
+                                szServiceName);
+                        addListBoxString(g_hwndStdoutList, szMsg);
                     }
-                    /* is this OK to do? */
-                    free(args);
-                break;                
-                case SERVICE_APACHE_RESTART:
-                    sprintf(szMsg, g_lpMsg[IDS_MSG_SRVRESTART-IDS_MSG_FIRST], szServiceName);
-                    addListBoxString(g_hwndStdoutList, szMsg);
-                    if (ControlService(schService, SERVICE_APACHE_RESTART, &schSStatus)) 
+                }
+                break;
+
+            case SERVICE_CONTROL_CONTINUE:
+                sprintf(szMsg, g_lpMsg[IDS_MSG_SRVSTART - IDS_MSG_FIRST],
+                        szServiceName);
+                addListBoxString(g_hwndStdoutList, szMsg);
+
+                if (StartService(schService, 0, NULL)) 
+                {
+                    Sleep(1000);
+                    while (QueryServiceStatus(schService, &schSStatus)) 
                     {
-                        ticks = 60;
-                        while (schSStatus.dwCurrentState == SERVICE_START_PENDING) 
+                        if (schSStatus.dwCurrentState == SERVICE_START_PENDING)
                         {
                             Sleep(1000);
-                            if (!QueryServiceStatus(schService, &schSStatus))
-                            {
-                                CloseServiceHandle(schService);
-                                CloseServiceHandle(schSCManager);
-                                g_bConsoleRun = FALSE;
-                                SetCursor(g_hCursorArrow);
-                                return FALSE;
-                            }
-                            if (!--ticks)
-                                break;
+                        }
+                        else {
+                            break;
                         }
                     }
+                }
+                if (QueryServiceStatus(schService, &schSStatus))
+                {
                     if (schSStatus.dwCurrentState == SERVICE_RUNNING)
                     {
                         retValue = TRUE;
-                        sprintf(szMsg, g_lpMsg[IDS_MSG_SRVRESTARTED-IDS_MSG_FIRST], szServiceName);
+                        sprintf(szMsg, 
+                                g_lpMsg[IDS_MSG_SRVSTARTED - IDS_MSG_FIRST],
+                                szServiceName);
                         addListBoxString(g_hwndStdoutList, szMsg);
                     }
-                break;                
+                }
+                break;
+
+            case SERVICE_APACHE_RESTART:
+                sprintf(szMsg, g_lpMsg[IDS_MSG_SRVRESTART - IDS_MSG_FIRST],
+                        szServiceName);
+                addListBoxString(g_hwndStdoutList, szMsg);
+                if (ControlService(schService, SERVICE_APACHE_RESTART,
+                                   &schSStatus)) 
+                {
+                    ticks = 60;
+                    while (schSStatus.dwCurrentState == SERVICE_START_PENDING)
+                    {
+                        Sleep(1000);
+                        if (!QueryServiceStatus(schService, &schSStatus))
+                        {
+                            CloseServiceHandle(schService);
+                            CloseServiceHandle(schSCManager);
+                            g_bConsoleRun = FALSE;
+                            SetCursor(g_hCursorArrow);
+                            return FALSE;
+                        }
+                        if (!--ticks) {
+                            break;
+                        }
+                    }
+                }
+                if (schSStatus.dwCurrentState == SERVICE_RUNNING)
+                {
+                    retValue = TRUE;
+                    sprintf(szMsg, 
+                            g_lpMsg[IDS_MSG_SRVRESTARTED - IDS_MSG_FIRST],
+                            szServiceName);
+                    addListBoxString(g_hwndStdoutList, szMsg);
+                }
+                break;
             }
             CloseServiceHandle(schService);
             CloseServiceHandle(schSCManager);
-            if (!retValue)
-                ErrorMessage(g_lpMsg[IDS_MSG_SRVFAILED-IDS_MSG_FIRST], FALSE);
+            if (!retValue) {
+                ErrorMessage(g_lpMsg[IDS_MSG_SRVFAILED - IDS_MSG_FIRST], 
+                             FALSE);
+            }
             g_bConsoleRun = FALSE;
             SetCursor(g_hCursorArrow);
             return retValue;
-            
         }
-        else
+        else {
             g_bRescanServices = TRUE;
-        
+        }
         CloseServiceHandle(schSCManager);
         return FALSE;
     }
-    
+
     return FALSE;
 }
 
-BOOL IsServiceRunning(LPCSTR szServiceName, LPCSTR szComputerName, LPDWORD lpdwPid)
-{
 
-    DWORD                   dwPid;
-    HWND                    hWnd;
-    SC_HANDLE               schService;
-    SC_HANDLE               schSCManager;    
-    SERVICE_STATUS          schSStatus;
+BOOL IsServiceRunning(LPCSTR szServiceName, LPCSTR szComputerName, 
+                      LPDWORD lpdwPid)
+{
+    DWORD dwPid;
+    HWND hWnd;
+    SC_HANDLE schService;
+    SC_HANDLE schSCManager;
+    SERVICE_STATUS schSStatus;
 
     if (g_dwOSVersion == OS_VERSION_WIN9X)
     {
         hWnd = FindWindow("ApacheWin95ServiceMonitor", szServiceName);
-        if (hWnd && GetWindowThreadProcessId(hWnd, &dwPid))
+        if (hWnd && GetWindowThreadProcessId(hWnd, &dwPid)) 
         {
             *lpdwPid = 1;
             return TRUE;
         }
-        else
+        else {
             return FALSE;
+        }
     }
     else
     {
-
         dwPid = 0;
-        schSCManager = OpenSCManager(
-                            szComputerName,
-                            NULL,
-                            SC_MANAGER_ALL_ACCESS
-                           );
-        if (!schSCManager)
+        schSCManager = OpenSCManager(szComputerName, NULL,
+                                     SC_MANAGER_ALL_ACCESS);
+        if (!schSCManager) {
             return FALSE;
+        }
 
-        schService = OpenService(schSCManager, szServiceName, SERVICE_QUERY_STATUS);
+        schService = OpenService(schSCManager, szServiceName, 
+                                 SERVICE_QUERY_STATUS);
         if (schService != NULL)
         {
             if (QueryServiceStatus(schService, &schSStatus))
             {
-                
                 dwPid = schSStatus.dwCurrentState;
-                if (lpdwPid)
+                if (lpdwPid) {
                     *lpdwPid = 1;
+                }
             }
             CloseServiceHandle(schService);
             CloseServiceHandle(schSCManager);
             return dwPid == SERVICE_RUNNING ? TRUE : FALSE;
         }
-        else
+        else {
             g_bRescanServices = TRUE;
-
+        }
         CloseServiceHandle(schSCManager);
         return FALSE;
 
     }
 
     return FALSE;
@@ -911,47 +972,48 @@
 BOOL FindRunningServices(void)
 {
     int i = 0;
     DWORD dwPid;
     BOOL rv = FALSE;
     while (g_stServices[i].szServiceName != NULL)
-    {    
-        if (!IsServiceRunning(g_stServices[i].szServiceName, g_stServices[i].szComputerName, &dwPid))
+    {
+        if (!IsServiceRunning(g_stServices[i].szServiceName, 
+                              g_stServices[i].szComputerName, &dwPid)) {
             dwPid = 0;
-        if (g_stServices[i].dwPid != dwPid)
+        }
+        if (g_stServices[i].dwPid != dwPid) {
             rv = TRUE;
+        }
         g_stServices[i].dwPid = dwPid;
         ++i;
-    }                        
+    }
     return rv;
 }
 
+
 BOOL GetApacheServicesStatus()
 {
-
-    CHAR    szKey[MAX_PATH];
-    CHAR    achKey[MAX_PATH];
-    CHAR    szImagePath[MAX_PATH];
-    CHAR    szBuf[MAX_PATH];
-    CHAR    szTmp[MAX_PATH];
-
-    HKEY    hKey, hSubKey, hKeyRemote;
-    DWORD   retCode, rv, dwKeyType;
-    DWORD   dwBufLen = MAX_PATH;
-    int     i, stPos = 0;
-    int     computers = 0;
+    CHAR szKey[MAX_PATH];
+    CHAR achKey[MAX_PATH];
+    CHAR szImagePath[MAX_PATH];
+    CHAR szBuf[MAX_PATH];
+    CHAR szTmp[MAX_PATH];
+    HKEY hKey, hSubKey, hKeyRemote;
+    DWORD retCode, rv, dwKeyType;
+    DWORD dwBufLen = MAX_PATH;
+    int i, stPos = 0;
+    int computers = 0;
 
     g_bRescanServices = FALSE;
 
-    
     am_ClearServicesSt();
     while (g_stComputers[computers].szComputerName != NULL) {
         hKeyRemote = g_stComputers[computers].hRegistry;
         retCode = RegOpenKeyEx(hKeyRemote,
-                                "System\\CurrentControlSet\\Services\\",
-                                0, KEY_READ, &hKey);
+                               "System\\CurrentControlSet\\Services\\",
+                               0, KEY_READ, &hKey);
         if (retCode != ERROR_SUCCESS)
         {
             ErrorMessage(NULL, FALSE);
             return FALSE;
         }
         for (i = 0, retCode = ERROR_SUCCESS; retCode == ERROR_SUCCESS; i++)
@@ -961,50 +1022,67 @@
             if (retCode == ERROR_SUCCESS)
             {
                 lstrcpy(szKey, "System\\CurrentControlSet\\Services\\");
                 lstrcat(szKey, achKey);
 
                 if (RegOpenKeyEx(hKeyRemote, szKey, 0, 
-                    KEY_QUERY_VALUE, &hSubKey) == ERROR_SUCCESS)
+                                 KEY_QUERY_VALUE, &hSubKey) == ERROR_SUCCESS)
                 {
                     dwBufLen = MAX_PATH;
                     rv = RegQueryValueEx(hSubKey, "ImagePath", NULL,
-                                          &dwKeyType, szImagePath, &dwBufLen);
+                                         &dwKeyType, szImagePath, &dwBufLen);
 
-                    if (rv == ERROR_SUCCESS && (dwKeyType == REG_SZ  || dwKeyType == REG_EXPAND_SZ) && dwBufLen)
+                    if (rv == ERROR_SUCCESS
+                            && (dwKeyType == REG_SZ 
+                             || dwKeyType == REG_EXPAND_SZ)
+                            && dwBufLen)
                     {
                         lstrcpy(szBuf, szImagePath);
                         CharLower(szBuf);
                         /* the service name could be Apache*.exe */
-                        if (strstr(szBuf, "\\apache") != NULL && strstr(szBuf, ".exe") &&
-                        (strstr(szBuf, "--ntservice") != NULL || strstr(szBuf, "-k ") !=NULL))
+                        if ((strstr(szBuf, "\\apache") != NULL)
+                                && strstr(szBuf, ".exe") 
+                                && (strstr(szBuf, "--ntservice") != NULL 
+                                       || strstr(szBuf, "-k ") != NULL))
                         {
                             g_stServices[stPos].szServiceName = strdup(achKey);
-                            g_stServices[stPos].szImagePath = strdup(szImagePath);
-                            g_stServices[stPos].szComputerName = strdup(g_stComputers[computers].szComputerName);
+                            g_stServices[stPos].szImagePath = 
+                                                           strdup(szImagePath);
+                            g_stServices[stPos].szComputerName = 
+                               strdup(g_stComputers[computers].szComputerName);
                             dwBufLen = MAX_PATH;
                             if (RegQueryValueEx(hSubKey, "Description", NULL,
-                                          &dwKeyType, szBuf, &dwBufLen) == ERROR_SUCCESS)
-                                g_stServices[stPos].szDescription = strdup(szBuf);
-
+                                                &dwKeyType, szBuf, &dwBufLen) 
+                                    == ERROR_SUCCESS) {
+                                g_stServices[stPos].szDescription = 
+                                                                 strdup(szBuf);
+                            }
                             dwBufLen = MAX_PATH;
                             if (RegQueryValueEx(hSubKey, "DisplayName", NULL,
-                                          &dwKeyType, szBuf, &dwBufLen) == ERROR_SUCCESS) {
-                                if (strcmp(g_stComputers[computers].szComputerName, g_szLocalHost) != 0) { 
-                                    strcpy(szTmp, g_stComputers[computers].szComputerName + 2);
+                                                &dwKeyType, szBuf, &dwBufLen) 
+                                    == ERROR_SUCCESS) 
+                            {
+                                if (strcmp(g_stComputers[computers]
+                                        .szComputerName, g_szLocalHost) != 0) 
+                                { 
+                                    strcpy(szTmp, g_stComputers[computers]
+                                                      .szComputerName + 2);
                                     strcat(szTmp, "@");
                                     strcat(szTmp, szBuf);
                                 }
-                                else
-                                    strcpy( szTmp, szBuf);
-                                g_stServices[stPos].szDisplayName= strdup(szTmp);
+                                else {
+                                    strcpy(szTmp, szBuf);
+                                }
+                                g_stServices[stPos].szDisplayName 
+                                                        = strdup(szTmp);
 
                             }
                             ++stPos;
-                            if (stPos >= MAX_APACHE_SERVICES)
+                            if (stPos >= MAX_APACHE_SERVICES) {
                                 retCode = !ERROR_SUCCESS;
+                            }
                         }
                     }
                     RegCloseKey(hSubKey);
                 }
             }
         }
@@ -1012,371 +1090,406 @@
     }
     RegCloseKey(hKey);
     FindRunningServices();
     return TRUE;
 }
 
-LRESULT CALLBACK ConnectDlgProc(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)
+
+LRESULT CALLBACK ConnectDlgProc(HWND hDlg, UINT message, 
+                                WPARAM wParam, LPARAM lParam)
 {
     CHAR szCmp[MAX_COMPUTERNAME_LENGTH+4];
     switch (message) 
     { 
- 
-        case WM_INITDIALOG: 
-            ShowWindow(hDlg, SW_HIDE);
-            g_hwndConnectDlg = hDlg;
-            CenterWindow(hDlg);
-            ShowWindow(hDlg, SW_SHOW);
-            SetFocus(GetDlgItem(hDlg, IDC_COMPUTER));
-            return TRUE;
-        case WM_COMMAND: 
-            switch (LOWORD(wParam)) 
-            { 
-                case IDOK: 
-                    ZeroMemory(szCmp, MAX_COMPUTERNAME_LENGTH+4);
-                    strcpy(szCmp, "\\\\");
-                    SendMessage(GetDlgItem(hDlg, IDC_COMPUTER), WM_GETTEXT, 
-                        (WPARAM) MAX_COMPUTERNAME_LENGTH, (LPARAM) szCmp+2); 
-
-                    strupr(szCmp);
-                    if (strlen(szCmp) < 3) {
-                        EndDialog(hDlg, TRUE); 
-                        return TRUE;
-                    }
-                    am_ConnectComputer(szCmp);
-                    SendMessage(g_hwndMain, WM_TIMER, WM_TIMER_RESCAN, 0);                        
-                case IDCANCEL:
-                    EndDialog(hDlg, TRUE); 
-                    return TRUE; 
-                case IDC_LBROWSE:
-                    {
-                        BROWSEINFO      bi;
-                        ITEMIDLIST      *il;
-                        LPMALLOC        pMalloc;
-                        memset(&bi, 0, sizeof(BROWSEINFO));
-                        SHGetSpecialFolderLocation(hDlg, CSIDL_NETWORK, &il);
-
-                        bi.lpszTitle      = "ApacheMonitor :\nSelect Network Computer!";
-                        bi.pszDisplayName = szCmp;
-                        bi.hwndOwner =      hDlg;
-                        bi.ulFlags =        BIF_BROWSEFORCOMPUTER;
-                        bi.lpfn =           NULL;
-                        bi.lParam =         0;
-                        bi.iImage =         0;
-                        bi.pidlRoot =       il;
-                        
-                        if (SHBrowseForFolder(&bi) != NULL) {                     
-                                SendMessage(GetDlgItem(hDlg, IDC_COMPUTER), WM_SETTEXT, 
-                                    (WPARAM) NULL, (LPARAM) szCmp); 
-                        }
-                        if (SHGetMalloc(&pMalloc)) {
-                            pMalloc->lpVtbl->Free(pMalloc, il);
-                            pMalloc->lpVtbl->Release(pMalloc);
-                        }
-                    }
-                    return TRUE;
+    case WM_INITDIALOG: 
+        ShowWindow(hDlg, SW_HIDE);
+        g_hwndConnectDlg = hDlg;
+        CenterWindow(hDlg);
+        ShowWindow(hDlg, SW_SHOW);
+        SetFocus(GetDlgItem(hDlg, IDC_COMPUTER));
+        return TRUE;
+
+    case WM_COMMAND: 
+        switch (LOWORD(wParam)) 
+        { 
+        case IDOK: 
+            memset(szCmp, 0, MAX_COMPUTERNAME_LENGTH+4);
+            strcpy(szCmp, "\\\\");
+            SendMessage(GetDlgItem(hDlg, IDC_COMPUTER), WM_GETTEXT, 
+                        (WPARAM) MAX_COMPUTERNAME_LENGTH, 
+                        (LPARAM) szCmp+2); 
+
+            strupr(szCmp);
+            if (strlen(szCmp) < 3) {
+                EndDialog(hDlg, TRUE); 
+                return TRUE;
+            }
+            am_ConnectComputer(szCmp);
+            SendMessage(g_hwndMain, WM_TIMER, WM_TIMER_RESCAN, 0);
+
+        case IDCANCEL:
+            EndDialog(hDlg, TRUE); 
+            return TRUE; 
+
+        case IDC_LBROWSE:
+        {
+            BROWSEINFO bi;
+            ITEMIDLIST *il;
+            LPMALLOC pMalloc;
+            memset(&bi, 0, sizeof(BROWSEINFO));
+            SHGetSpecialFolderLocation(hDlg, CSIDL_NETWORK, &il);
+
+            bi.lpszTitle      = "ApacheMonitor :\nSelect Network Computer!";
+            bi.pszDisplayName = szCmp;
+            bi.hwndOwner =      hDlg;
+            bi.ulFlags =        BIF_BROWSEFORCOMPUTER;
+            bi.lpfn =           NULL;
+            bi.lParam =         0;
+            bi.iImage =         0;
+            bi.pidlRoot =       il;
+
+            if (SHBrowseForFolder(&bi) != NULL) {
+                SendMessage(GetDlgItem(hDlg, IDC_COMPUTER), 
+                            WM_SETTEXT, 
+                            (WPARAM) NULL, (LPARAM) szCmp); 
+            }
+            if (SHGetMalloc(&pMalloc)) {
+                pMalloc->lpVtbl->Free(pMalloc, il);
+                pMalloc->lpVtbl->Release(pMalloc);
             }
-        break;
-        case WM_QUIT:
-        case WM_CLOSE: 
-            EndDialog(hDlg, TRUE);
             return TRUE;
-        default:
-            return FALSE;
+        }
+        }
+        break;
+
+    case WM_QUIT:
+    case WM_CLOSE: 
+        EndDialog(hDlg, TRUE);
+        return TRUE;
+
+    default:
+        return FALSE;
     }
     return FALSE;
 
 }
 
-LRESULT CALLBACK ServiceDlgProc(HWND hDlg, UINT message, WPARAM wParam, LPARAM lParam)
-{
 
-    CHAR        szBuf[MAX_PATH]; 
-    HWND        hListBox;
-    static      HWND  hStatusBar; 
-    TEXTMETRIC  tm; 
-    int         i, y; 
-    HDC         hdcMem; 
-    RECT        rcBitmap; 
-    UINT        nItem;
+LRESULT CALLBACK ServiceDlgProc(HWND hDlg, UINT message, 
+                                WPARAM wParam, LPARAM lParam)
+{
+    CHAR szBuf[MAX_PATH]; 
+    HWND hListBox;
+    static HWND hStatusBar; 
+    TEXTMETRIC tm; 
+    int i, y; 
+    HDC hdcMem; 
+    RECT rcBitmap; 
+    UINT nItem;
     LPMEASUREITEMSTRUCT lpmis; 
-    LPDRAWITEMSTRUCT    lpdis; 
+    LPDRAWITEMSTRUCT lpdis; 
 
-    ZeroMemory(szBuf, MAX_PATH);
+    memset(szBuf, 0, MAX_PATH);
     switch (message) 
-    { 
- 
-        case WM_INITDIALOG: 
-            ShowWindow(hDlg, SW_HIDE);
-            g_hwndServiceDlg = hDlg;
-            SetWindowText(hDlg, g_szTitle);
-            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
-            SetWindowText(GetDlgItem(hDlg, IDC_SSTART), g_lpMsg[IDS_MSG_SSTART-IDS_MSG_FIRST]);
-            SetWindowText(GetDlgItem(hDlg, IDC_SSTOP), g_lpMsg[IDS_MSG_SSTOP-IDS_MSG_FIRST]);
-            SetWindowText(GetDlgItem(hDlg, IDC_SRESTART), g_lpMsg[IDS_MSG_SRESTART-IDS_MSG_FIRST]);
-            SetWindowText(GetDlgItem(hDlg, IDC_SMANAGER), g_lpMsg[IDS_MSG_SERVICES-IDS_MSG_FIRST]);
-            SetWindowText(GetDlgItem(hDlg, IDC_SCONNECT), g_lpMsg[IDS_MSG_CONNECT-IDS_MSG_FIRST]);
-            SetWindowText(GetDlgItem(hDlg, IDC_SEXIT), g_lpMsg[IDS_MSG_MNUEXIT-IDS_MSG_FIRST]);
-            if (g_dwOSVersion < OS_VERSION_WINNT)
-            {
-                ShowWindow(GetDlgItem(hDlg, IDC_SMANAGER), SW_HIDE);
-                ShowWindow(GetDlgItem(hDlg, IDC_SCONNECT), SW_HIDE);
-                ShowWindow(GetDlgItem(hDlg, IDC_SDISCONN), SW_HIDE);
-            }
-            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-            g_hwndStdoutList = GetDlgItem(hDlg, IDL_STDOUT);
-            hStatusBar = CreateStatusWindow(0x0800 /* SBT_TOOLTIPS */
-                                          | WS_CHILD | WS_VISIBLE,
-                                            "", hDlg, IDC_STATBAR);            
-            if (GetApacheServicesStatus())
-            {
-                i = 0;
-                while (g_stServices[i].szServiceName != NULL)
-                {    
-                    addListBoxItem(hListBox, g_stServices[i].szDisplayName,
-                        g_stServices[i].dwPid == 0 ? g_hBmpStop : g_hBmpStart);
-                    ++i;
-                }
-            }
-            CenterWindow(hDlg);
-            ShowWindow(hDlg, SW_SHOW);
-            SetFocus(hListBox); 
-            SendMessage(hListBox, LB_SETCURSEL, 0, 0); 
-            return TRUE;
-        break;
-        case WM_MANAGEMESSAGE:
-            ApacheManageService(g_stServices[LOWORD(wParam)].szServiceName,
-                        g_stServices[LOWORD(wParam)].szImagePath,
-                        g_stServices[LOWORD(wParam)].szComputerName,
-                        LOWORD(lParam));
-    
-            return TRUE;
-        break;
-        case WM_UPDATEMESSAGE:
-            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-            SendMessage(hListBox, LB_RESETCONTENT, 0, 0); 
-            SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)"");
-            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
-            Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
+    {
+    case WM_INITDIALOG: 
+        ShowWindow(hDlg, SW_HIDE);
+        g_hwndServiceDlg = hDlg;
+        SetWindowText(hDlg, g_szTitle);
+        Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
+        SetWindowText(GetDlgItem(hDlg, IDC_SSTART), 
+                      g_lpMsg[IDS_MSG_SSTART - IDS_MSG_FIRST]);
+        SetWindowText(GetDlgItem(hDlg, IDC_SSTOP), 
+                      g_lpMsg[IDS_MSG_SSTOP - IDS_MSG_FIRST]);
+        SetWindowText(GetDlgItem(hDlg, IDC_SRESTART), 
+                      g_lpMsg[IDS_MSG_SRESTART - IDS_MSG_FIRST]);
+        SetWindowText(GetDlgItem(hDlg, IDC_SMANAGER), 
+                      g_lpMsg[IDS_MSG_SERVICES - IDS_MSG_FIRST]);
+        SetWindowText(GetDlgItem(hDlg, IDC_SCONNECT), 
+                      g_lpMsg[IDS_MSG_CONNECT - IDS_MSG_FIRST]);
+        SetWindowText(GetDlgItem(hDlg, IDC_SEXIT), 
+                      g_lpMsg[IDS_MSG_MNUEXIT - IDS_MSG_FIRST]);
+        if (g_dwOSVersion < OS_VERSION_WINNT)
+        {
+            ShowWindow(GetDlgItem(hDlg, IDC_SMANAGER), SW_HIDE);
+            ShowWindow(GetDlgItem(hDlg, IDC_SCONNECT), SW_HIDE);
+            ShowWindow(GetDlgItem(hDlg, IDC_SDISCONN), SW_HIDE);
+        }
+        hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+        g_hwndStdoutList = GetDlgItem(hDlg, IDL_STDOUT);
+        hStatusBar = CreateStatusWindow(0x0800 /* SBT_TOOLTIPS */
+                                      | WS_CHILD | WS_VISIBLE,
+                                        "", hDlg, IDC_STATBAR);
+        if (GetApacheServicesStatus())
+        {
             i = 0;
             while (g_stServices[i].szServiceName != NULL)
-            {    
-                addListBoxItem(hListBox, g_stServices[i].szDisplayName, 
-                    g_stServices[i].dwPid == 0 ? g_hBmpStop : g_hBmpStart);
+            {
+                addListBoxItem(hListBox, g_stServices[i].szDisplayName,
+                               g_stServices[i].dwPid == 0 ? g_hBmpStop 
+                                                          : g_hBmpStart);
                 ++i;
             }
-            SendMessage(hListBox, LB_SETCURSEL, 0, 0); 
-            /* Dirty hack to bring the window to the foreground */
-            SetWindowPos(hDlg, HWND_TOPMOST, 0, 0, 0, 0,
-                                    SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
-            SetWindowPos(hDlg, HWND_NOTOPMOST, 0, 0, 0, 0,
-                                    SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
-            SetFocus(hListBox); 
-            return TRUE;
+        }
+        CenterWindow(hDlg);
+        ShowWindow(hDlg, SW_SHOW);
+        SetFocus(hListBox); 
+        SendMessage(hListBox, LB_SETCURSEL, 0, 0); 
+        return TRUE;
         break;
-        case WM_MEASUREITEM: 
- 
-            lpmis = (LPMEASUREITEMSTRUCT) lParam; 
-            lpmis->itemHeight = YBITMAP; 
-            return TRUE; 
-        case WM_SETCURSOR:
-            if (g_bConsoleRun)
-                SetCursor(g_hCursorHourglass);
-            else
-                SetCursor(g_hCursorArrow);
-            return TRUE;
-        case WM_DRAWITEM: 
-            lpdis = (LPDRAWITEMSTRUCT) lParam; 
-            if (lpdis->itemID == -1) 
-            { 
-                break; 
-            } 
-            switch (lpdis->itemAction) 
-            { 
-                case ODA_SELECT: 
-                case ODA_DRAWENTIRE: 
-                    g_hBmpPicture = (HBITMAP)SendMessage(lpdis->hwndItem, 
-                        LB_GETITEMDATA, lpdis->itemID, (LPARAM) 0); 
-                        
-                    hdcMem = CreateCompatibleDC(lpdis->hDC); 
-                    g_hBmpOld = SelectObject(hdcMem, g_hBmpPicture); 
- 
-                    BitBlt(lpdis->hDC, 
-                        lpdis->rcItem.left, lpdis->rcItem.top, 
-                        lpdis->rcItem.right - lpdis->rcItem.left, 
-                        lpdis->rcItem.bottom - lpdis->rcItem.top, 
-                        hdcMem, 0, 0, SRCCOPY); 
-                    SendMessage(lpdis->hwndItem, LB_GETTEXT, 
+
+    case WM_MANAGEMESSAGE:
+        ApacheManageService(g_stServices[LOWORD(wParam)].szServiceName,
+                    g_stServices[LOWORD(wParam)].szImagePath,
+                    g_stServices[LOWORD(wParam)].szComputerName,
+                    LOWORD(lParam));
+
+        return TRUE;
+        break;
+
+    case WM_UPDATEMESSAGE:
+        hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+        SendMessage(hListBox, LB_RESETCONTENT, 0, 0); 
+        SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)"");
+        Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
+        Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
+        i = 0;
+        while (g_stServices[i].szServiceName != NULL)
+        {
+            addListBoxItem(hListBox, g_stServices[i].szDisplayName, 
+                g_stServices[i].dwPid == 0 ? g_hBmpStop : g_hBmpStart);
+            ++i;
+        }
+        SendMessage(hListBox, LB_SETCURSEL, 0, 0); 
+        /* Dirty hack to bring the window to the foreground */
+        SetWindowPos(hDlg, HWND_TOPMOST, 0, 0, 0, 0,
+                                SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
+        SetWindowPos(hDlg, HWND_NOTOPMOST, 0, 0, 0, 0,
+                                SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
+        SetFocus(hListBox); 
+        return TRUE;
+        break;
+
+    case WM_MEASUREITEM: 
+        lpmis = (LPMEASUREITEMSTRUCT) lParam; 
+        lpmis->itemHeight = YBITMAP; 
+        return TRUE; 
+
+    case WM_SETCURSOR:
+        if (g_bConsoleRun) {
+            SetCursor(g_hCursorHourglass);
+        }
+        else {
+            SetCursor(g_hCursorArrow);
+        }
+        return TRUE;
+
+    case WM_DRAWITEM: 
+        lpdis = (LPDRAWITEMSTRUCT) lParam; 
+        if (lpdis->itemID == -1) { 
+            break; 
+        } 
+        switch (lpdis->itemAction) 
+        { 
+        case ODA_SELECT: 
+        case ODA_DRAWENTIRE: 
+            g_hBmpPicture = (HBITMAP)SendMessage(lpdis->hwndItem, 
+                                                 LB_GETITEMDATA,
+                                                 lpdis->itemID, (LPARAM) 0);
+
+            hdcMem = CreateCompatibleDC(lpdis->hDC); 
+            g_hBmpOld = SelectObject(hdcMem, g_hBmpPicture); 
+
+            BitBlt(lpdis->hDC, lpdis->rcItem.left, lpdis->rcItem.top,
+                   lpdis->rcItem.right - lpdis->rcItem.left,
+                   lpdis->rcItem.bottom - lpdis->rcItem.top,
+                   hdcMem, 0, 0, SRCCOPY);
+            SendMessage(lpdis->hwndItem, LB_GETTEXT, 
                         lpdis->itemID, (LPARAM) szBuf); 
- 
-                    GetTextMetrics(lpdis->hDC, &tm);  
-                    y = (lpdis->rcItem.bottom + lpdis->rcItem.top - 
-                        tm.tmHeight) / 2; 
-  
-                    SelectObject(hdcMem, g_hBmpOld); 
-                    DeleteDC(hdcMem); 
- 
-                    rcBitmap.left = lpdis->rcItem.left + XBITMAP + 2; 
-                    rcBitmap.top = lpdis->rcItem.top; 
-                    rcBitmap.right = lpdis->rcItem.right; 
-                    rcBitmap.bottom = lpdis->rcItem.top + YBITMAP; 
-
-                    if (lpdis->itemState & ODS_SELECTED) 
-                    { 
-                        if (g_hBmpPicture == g_hBmpStop)
-                        {
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), TRUE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
-                        }
-                        else if (g_hBmpPicture == g_hBmpStart) 
-                        {
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), TRUE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), TRUE);
-                        }
-                        else {
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
-                            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
-                        }
-                        if (strcmp(g_stServices[lpdis->itemID].szComputerName, g_szLocalHost) == 0)
-                            Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
-                        else
-                            Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), TRUE);
-
-                        if (g_stServices[lpdis->itemID].szDescription)
-                            SendMessage(hStatusBar, SB_SETTEXT, 0, 
-                                        (LPARAM)g_stServices[lpdis->itemID].szDescription);
-                        else
-                            SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)"");
-                        
-                        SetTextColor(lpdis->hDC, GetSysColor(COLOR_HIGHLIGHTTEXT)); 
-                        SetBkColor(lpdis->hDC, GetSysColor(COLOR_HIGHLIGHT)); 
-                        FillRect(lpdis->hDC, &rcBitmap, (HBRUSH)(COLOR_HIGHLIGHTTEXT)); 
-                    } 
-                    else
-                    {
-                       SetTextColor(lpdis->hDC, GetSysColor(COLOR_MENUTEXT)); 
-                       SetBkColor(lpdis->hDC, GetSysColor(COLOR_WINDOW)); 
-                       FillRect(lpdis->hDC, &rcBitmap, (HBRUSH)(COLOR_WINDOW+1)); 
-                    }
-                    TextOut(lpdis->hDC, 
-                        XBITMAP + 6, 
-                        y, 
-                        szBuf, 
-                        strlen(szBuf)); 
-                    break; 
- 
-                case ODA_FOCUS: 
-                    break; 
-            } 
-            return TRUE;  
-        case WM_COMMAND: 
-            switch (LOWORD(wParam)) 
-            { 
-                case IDL_SERVICES:
-                    switch (HIWORD(wParam))
-                    {
-                        case LBN_DBLCLK:
-                            /* if started then stop, if stopped then start the service */
-                            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-                            nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
-                            if (nItem != LB_ERR)
-                            {
-                                g_hBmpPicture = (HBITMAP)SendMessage(hListBox, LB_GETITEMDATA,
-                                                               nItem, (LPARAM) 0); 
-                                if (g_hBmpPicture == g_hBmpStop)
-                                {
-                                    SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, SERVICE_CONTROL_CONTINUE);                                    
-                                }
-                                else
-                                    SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, SERVICE_CONTROL_STOP);                                    
 
-                            }
-                            return TRUE;
-                        break;
-                     }
-                break;
-                case IDOK: 
-                    EndDialog(hDlg, TRUE); 
-                    return TRUE; 
-                case IDC_SSTART: 
-                    Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
-                    hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-                    nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
-                    if (nItem != LB_ERR)
-                    {
-                        SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, SERVICE_CONTROL_CONTINUE);                                    
-                    }
+            GetTextMetrics(lpdis->hDC, &tm);
+            y = (lpdis->rcItem.bottom + lpdis->rcItem.top - tm.tmHeight) / 2;
+
+            SelectObject(hdcMem, g_hBmpOld); 
+            DeleteDC(hdcMem); 
+
+            rcBitmap.left = lpdis->rcItem.left + XBITMAP + 2; 
+            rcBitmap.top = lpdis->rcItem.top; 
+            rcBitmap.right = lpdis->rcItem.right; 
+            rcBitmap.bottom = lpdis->rcItem.top + YBITMAP; 
+
+            if (lpdis->itemState & ODS_SELECTED) 
+            { 
+                if (g_hBmpPicture == g_hBmpStop)
+                {
                     Button_Enable(GetDlgItem(hDlg, IDC_SSTART), TRUE);
-                    return TRUE;
-                case IDC_SSTOP: 
                     Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
-                    hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-                    nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
-                    if (nItem != LB_ERR)
-                    {
-                        SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, SERVICE_CONTROL_STOP);                                    
-                    }
+                    Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
+                }
+                else if (g_hBmpPicture == g_hBmpStart) 
+                {
+                    Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
                     Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), TRUE);
-                    return TRUE;
-                case IDC_SRESTART: 
+                    Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), TRUE);
+                }
+                else {
+                    Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
+                    Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
                     Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
-                    hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-                    nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
-                    if (nItem != LB_ERR)
-                    {
-                        SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, SERVICE_APACHE_RESTART);                                    
+                }
+                if (strcmp(g_stServices[lpdis->itemID].szComputerName, 
+                           g_szLocalHost) == 0) {
+                    Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), FALSE);
+                }
+                else {
+                    Button_Enable(GetDlgItem(hDlg, IDC_SDISCONN), TRUE);
+                }
+
+                if (g_stServices[lpdis->itemID].szDescription) {
+                    SendMessage(hStatusBar, SB_SETTEXT, 0, 
+                            (LPARAM)g_stServices[lpdis->itemID].szDescription);
+                }
+                else {
+                    SendMessage(hStatusBar, SB_SETTEXT, 0, (LPARAM)"");
+                }
+                SetTextColor(lpdis->hDC, GetSysColor(COLOR_HIGHLIGHTTEXT)); 
+                SetBkColor(lpdis->hDC, GetSysColor(COLOR_HIGHLIGHT)); 
+                FillRect(lpdis->hDC, &rcBitmap, (HBRUSH)(COLOR_HIGHLIGHTTEXT));
+            } 
+            else
+            {
+               SetTextColor(lpdis->hDC, GetSysColor(COLOR_MENUTEXT)); 
+               SetBkColor(lpdis->hDC, GetSysColor(COLOR_WINDOW)); 
+               FillRect(lpdis->hDC, &rcBitmap, (HBRUSH)(COLOR_WINDOW+1)); 
+            }
+            TextOut(lpdis->hDC, XBITMAP + 6, y, szBuf, strlen(szBuf)); 
+            break; 
+
+        case ODA_FOCUS: 
+            break; 
+        } 
+        return TRUE;
+    case WM_COMMAND: 
+        switch (LOWORD(wParam)) 
+        { 
+        case IDL_SERVICES:
+            switch (HIWORD(wParam))
+            {
+            case LBN_DBLCLK:
+                /* if started then stop, if stopped then start */
+                hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+                nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0);
+                if (nItem != LB_ERR)
+                {
+                    g_hBmpPicture = (HBITMAP)SendMessage(hListBox, 
+                                                         LB_GETITEMDATA,
+                                                         nItem, (LPARAM) 0);
+                    if (g_hBmpPicture == g_hBmpStop) {
+                        SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, 
+                                    SERVICE_CONTROL_CONTINUE);
                     }
-                    Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), TRUE);
-                    return TRUE;
-                case IDC_SMANAGER: 
-                    if (g_dwOSVersion >= OS_VERSION_WIN2K)
-                        ShellExecute(hDlg, "open", "services.msc", "/s", NULL, SW_NORMAL);
-                    else
-                        WinExec("Control.exe SrvMgr.cpl Services", SW_NORMAL);
-                    return TRUE;
-                case IDC_SEXIT: 
-                    EndDialog( hDlg, TRUE);
-                    SendMessage( g_hwndMain, WM_COMMAND, (WPARAM)IDM_EXIT, 0);
-                    return TRUE;
-                case IDC_SCONNECT: 
-                    DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGCONNECT),
-                                    hDlg, (DLGPROC)ConnectDlgProc);
-                    return TRUE;
-                case IDC_SDISCONN: 
-                    hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
-                    nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
-                    if (nItem != LB_ERR) {
-                        am_DisconnectComputer(g_stServices[nItem].szComputerName);
-                        SendMessage(g_hwndMain, WM_TIMER, WM_TIMER_RESCAN, 0);                        
+                    else {
+                        SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, 
+                                    SERVICE_CONTROL_STOP);
                     }
-                    return TRUE;
-             }
-        break;
-        case WM_SIZE:
-            switch (LOWORD(wParam)) 
-            { 
-                case SIZE_MINIMIZED:
-                    EndDialog(hDlg, TRUE); 
-                    return TRUE; 
-                break;
+
+                }
+                return TRUE;
             }
-        break;
-        case WM_QUIT:
-        case WM_CLOSE: 
+            break;
+
+        case IDOK: 
+            EndDialog(hDlg, TRUE); 
+            return TRUE; 
+
+        case IDC_SSTART: 
+            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), FALSE);
+            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+            nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
+            if (nItem != LB_ERR) {
+                SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, 
+                            SERVICE_CONTROL_CONTINUE);
+            }
+            Button_Enable(GetDlgItem(hDlg, IDC_SSTART), TRUE);
+            return TRUE;
+
+        case IDC_SSTOP: 
+            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), FALSE);
+            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+            nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
+            if (nItem != LB_ERR) {
+                SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, 
+                            SERVICE_CONTROL_STOP);
+            }
+            Button_Enable(GetDlgItem(hDlg, IDC_SSTOP), TRUE);
+            return TRUE;
+
+        case IDC_SRESTART: 
+            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), FALSE);
+            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+            nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
+            if (nItem != LB_ERR) {
+                SendMessage(hDlg, WM_MANAGEMESSAGE, nItem, 
+                            SERVICE_APACHE_RESTART);
+            }
+            Button_Enable(GetDlgItem(hDlg, IDC_SRESTART), TRUE);
+            return TRUE;
+
+        case IDC_SMANAGER: 
+            if (g_dwOSVersion >= OS_VERSION_WIN2K) {
+                ShellExecute(hDlg, "open", "services.msc", "/s",
+                             NULL, SW_NORMAL);
+            }
+            else {
+                WinExec("Control.exe SrvMgr.cpl Services", SW_NORMAL);
+            }
+            return TRUE;
+
+        case IDC_SEXIT: 
             EndDialog(hDlg, TRUE);
+            SendMessage(g_hwndMain, WM_COMMAND, (WPARAM)IDM_EXIT, 0);
             return TRUE;
-        default:
-            return FALSE;
+
+        case IDC_SCONNECT: 
+            DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGCONNECT),
+                      hDlg, (DLGPROC)ConnectDlgProc);
+            return TRUE;
+
+        case IDC_SDISCONN: 
+            hListBox = GetDlgItem(hDlg, IDL_SERVICES); 
+            nItem = SendMessage(hListBox, LB_GETCURSEL, 0, 0); 
+            if (nItem != LB_ERR) {
+                am_DisconnectComputer(g_stServices[nItem].szComputerName);
+                SendMessage(g_hwndMain, WM_TIMER, WM_TIMER_RESCAN, 0);
+            }
+            return TRUE;
+        }
+        break;
+
+    case WM_SIZE:
+        switch (LOWORD(wParam)) 
+        { 
+        case SIZE_MINIMIZED:
+            EndDialog(hDlg, TRUE); 
+            return TRUE; 
+            break;
+        }
+        break;
+
+    case WM_QUIT:
+    case WM_CLOSE: 
+        EndDialog(hDlg, TRUE);
+        return TRUE;
+
+    default:
+        return FALSE;
     }
     return FALSE;
 }
 
 
 LRESULT CALLBACK WndProc(HWND hWnd, UINT message,
@@ -1387,162 +1500,189 @@
         /* restore the tray icon on shell restart */
         ShowNotifyIcon(hWnd, NIM_ADD);
         return DefWindowProc(hWnd, message, wParam, lParam);
     }
     switch (message) 
     {
-        case WM_CREATE:
+    case WM_CREATE:
+        GetApacheServicesStatus();
+        ShowNotifyIcon(hWnd, NIM_ADD);
+        SetTimer(hWnd, WM_TIMER_REFRESH, REFRESH_TIME, NULL);
+        SetTimer(hWnd, WM_TIMER_RESCAN,  RESCAN_TIME, NULL);
+        break;
+
+    case WM_TIMER:
+        switch (wParam)
+        {
+        case WM_TIMER_RESCAN:
+        {
+            int nPrev = 0, nNew = 0;
+            EnterCriticalSection(&g_stcSection);
+            if (FindRunningServices() || g_bRescanServices)
+            {
+                ShowNotifyIcon(hWnd, NIM_MODIFY);
+                if (g_hwndServiceDlg)
+                    PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
+            }
+            /* check if services list changed */
+            while (g_stServices[nPrev].szServiceName != NULL)
+                ++nPrev;
             GetApacheServicesStatus();
-            ShowNotifyIcon(hWnd, NIM_ADD);
-            SetTimer(hWnd, WM_TIMER_REFRESH, REFRESH_TIME, NULL);
-            SetTimer(hWnd, WM_TIMER_RESCAN,  RESCAN_TIME, NULL);
-            break;
-        case WM_TIMER:
-            switch (wParam)
+            while (g_stServices[nNew].szServiceName != NULL)
+                ++nNew;
+            if (nPrev != nNew)
             {
-                case WM_TIMER_RESCAN:
-                {
-                    int nPrev = 0, nNew = 0;
-                    EnterCriticalSection(&g_stcSection);
-                    if (FindRunningServices() || g_bRescanServices)
-                    {
-                        ShowNotifyIcon(hWnd, NIM_MODIFY);
-                        if (g_hwndServiceDlg)
-                            PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
-                    }
-                    /* check if services list changed */
-                    while (g_stServices[nPrev].szServiceName != NULL)
-                        ++nPrev;
-                    GetApacheServicesStatus();
-                    while (g_stServices[nNew].szServiceName != NULL)
-                        ++nNew;
-                    if (nPrev != nNew)
-                    {
-                        ShowNotifyIcon(hWnd, NIM_MODIFY);
-                        if (g_hwndServiceDlg)
-                            PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
-                    }
-                    LeaveCriticalSection(&g_stcSection);
-                break;
-                }
-                case WM_TIMER_REFRESH:
-                {
-                    int nPrev = 0, nNew = 0;
-                    EnterCriticalSection(&g_stcSection);
-                    if (g_bRescanServices)
-                    {       
-                        GetApacheServicesStatus();
-                        ShowNotifyIcon(hWnd, NIM_MODIFY);
-                        if (g_hwndServiceDlg)
-                            PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
-                    }
-                    else if (FindRunningServices())
-                    {
-                        ShowNotifyIcon(hWnd, NIM_MODIFY);
-                        if (g_hwndServiceDlg)
-                            PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
-                    }
-                    LeaveCriticalSection(&g_stcSection);
-                    break;
+                ShowNotifyIcon(hWnd, NIM_MODIFY);
+                if (g_hwndServiceDlg) {
+                    PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
                 }
             }
+            LeaveCriticalSection(&g_stcSection);
             break;
-        case WM_QUIT:
-            ShowNotifyIcon(hWnd, NIM_DELETE);
-            break;
-        case WM_TRAYMESSAGE:
-            switch(lParam)
+        }
+
+        case WM_TIMER_REFRESH:
+        {
+            int nPrev = 0, nNew = 0;
+            EnterCriticalSection(&g_stcSection);
+            if (g_bRescanServices)
             {
-                case WM_LBUTTONDBLCLK:
-                   if (!g_bDlgServiceOn)
-                   {
-                       g_bDlgServiceOn = TRUE;
-                       DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGSERVICES),
-                             hWnd, (DLGPROC)ServiceDlgProc);
-                       g_bDlgServiceOn = FALSE;
-                       g_hwndServiceDlg = NULL;
-                   }
-                   else if (IsWindow(g_hwndServiceDlg))
-                   {
-                       /* Dirty hack to bring the window to the foreground */
-                       SetWindowPos(g_hwndServiceDlg, HWND_TOPMOST, 0, 0, 0, 0,
-                                    SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
-                       SetWindowPos(g_hwndServiceDlg, HWND_NOTOPMOST, 0, 0, 0, 0,
-                                    SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
-                       SetFocus(g_hwndServiceDlg);
-                   }
-                break;
-                case WM_LBUTTONUP:
-                    ShowTryServicesMenu(hWnd);
-                break;    
-                case WM_RBUTTONUP:
-                    ShowTryPopupMenu(hWnd);
-                break;    
+                GetApacheServicesStatus();
+                ShowNotifyIcon(hWnd, NIM_MODIFY);
+                if (g_hwndServiceDlg) {
+                    PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
+                }
             }
-            break;
-        case WM_COMMAND:
-            if ((LOWORD(wParam) & IDM_SM_START) == IDM_SM_START)
+            else if (FindRunningServices())
             {
-                ApacheManageService(g_stServices[LOWORD(wParam) - IDM_SM_START].szServiceName,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_START].szImagePath,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_START].szComputerName,
-                                    SERVICE_CONTROL_CONTINUE);                
-                return TRUE;
+                ShowNotifyIcon(hWnd, NIM_MODIFY);
+                if (g_hwndServiceDlg) {
+                    PostMessage(g_hwndServiceDlg, WM_UPDATEMESSAGE, 0, 0);
+                }
             }
-            else if ((LOWORD(wParam) & IDM_SM_STOP) == IDM_SM_STOP)
+            LeaveCriticalSection(&g_stcSection);
+            break;
+        }
+        }
+        break;
+
+    case WM_QUIT:
+        ShowNotifyIcon(hWnd, NIM_DELETE);
+        break;
+
+    case WM_TRAYMESSAGE:
+        switch (lParam)
+        {
+        case WM_LBUTTONDBLCLK:
+            if (!g_bDlgServiceOn)
             {
-                ApacheManageService(g_stServices[LOWORD(wParam) - IDM_SM_STOP].szServiceName,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_STOP].szImagePath,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_STOP].szComputerName,
-                                    SERVICE_CONTROL_STOP);                
-                return TRUE;
+                g_bDlgServiceOn = TRUE;
+                DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGSERVICES),
+                          hWnd, (DLGPROC)ServiceDlgProc);
+                g_bDlgServiceOn = FALSE;
+                g_hwndServiceDlg = NULL;
             }
-            else if ((LOWORD(wParam) & IDM_SM_RESTART) == IDM_SM_RESTART)
+            else if (IsWindow(g_hwndServiceDlg))
             {
-                ApacheManageService(g_stServices[LOWORD(wParam) - IDM_SM_RESTART].szServiceName,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_RESTART].szImagePath,
-                                    g_stServices[LOWORD(wParam) - IDM_SM_RESTART].szComputerName,
-                                    SERVICE_APACHE_RESTART);                
-                return TRUE;
+                /* Dirty hack to bring the window to the foreground */
+                SetWindowPos(g_hwndServiceDlg, HWND_TOPMOST, 0, 0, 0, 0,
+                             SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
+                SetWindowPos(g_hwndServiceDlg, HWND_NOTOPMOST, 0, 0, 0, 0,
+                             SWP_NOSIZE | SWP_NOMOVE | SWP_SHOWWINDOW);
+                SetFocus(g_hwndServiceDlg);
             }
-            switch (LOWORD(wParam))
+            break;
+
+        case WM_LBUTTONUP:
+            ShowTryServicesMenu(hWnd);
+            break;
+
+        case WM_RBUTTONUP:
+            ShowTryPopupMenu(hWnd);
+            break;
+        }
+        break;
+
+    case WM_COMMAND:
+        if ((LOWORD(wParam) & IDM_SM_START) == IDM_SM_START)
+        {
+            ApacheManageService(g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_START].szServiceName,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_START].szImagePath,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_START].szComputerName,
+                                SERVICE_CONTROL_CONTINUE);
+            return TRUE;
+        }
+        else if ((LOWORD(wParam) & IDM_SM_STOP) == IDM_SM_STOP)
+        {
+            ApacheManageService(g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_STOP].szServiceName,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_STOP].szImagePath,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_STOP].szComputerName,
+                                SERVICE_CONTROL_STOP);
+            return TRUE;
+        }
+        else if ((LOWORD(wParam) & IDM_SM_RESTART) == IDM_SM_RESTART)
+        {
+            ApacheManageService(g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_RESTART].szServiceName,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_RESTART].szImagePath,
+                                g_stServices[LOWORD(wParam) 
+                                           - IDM_SM_RESTART].szComputerName,
+                                SERVICE_APACHE_RESTART);
+            return TRUE;
+        }
+        switch (LOWORD(wParam))
+        {
+        case IDM_RESTORE:
+            if (!g_bDlgServiceOn)
             {
-               case IDM_RESTORE:
-                   if (!g_bDlgServiceOn)
-                   {
-                       g_bDlgServiceOn = TRUE;
-                       DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGSERVICES),
-                             hWnd, (DLGPROC)ServiceDlgProc);
-                       g_bDlgServiceOn = FALSE;
-                       g_hwndServiceDlg = NULL;
-                   }
-                   else if (IsWindow(g_hwndServiceDlg))
-                       SetFocus(g_hwndServiceDlg);
-                   break;
-                case IDC_SMANAGER: 
-                    if (g_dwOSVersion >= OS_VERSION_WIN2K)
-                        ShellExecute(NULL, "open", "services.msc", "/s", NULL, SW_NORMAL);
-                    else
-                        WinExec("Control.exe SrvMgr.cpl Services", SW_NORMAL);
-                    return TRUE;
-               case IDM_EXIT:
-                   ShowNotifyIcon(hWnd, NIM_DELETE);
-                   PostQuitMessage(0);
-                   return TRUE;
+                g_bDlgServiceOn = TRUE;
+                DialogBox(g_hInstance, MAKEINTRESOURCE(IDD_DLGSERVICES),
+                          hWnd, (DLGPROC)ServiceDlgProc);
+                g_bDlgServiceOn = FALSE;
+                g_hwndServiceDlg = NULL;
+            }
+            else if (IsWindow(g_hwndServiceDlg)) {
+                SetFocus(g_hwndServiceDlg);
             }
-        default:
-            return DefWindowProc(hWnd, message, wParam, lParam);
+            break;
+
+        case IDC_SMANAGER: 
+            if (g_dwOSVersion >= OS_VERSION_WIN2K) {
+                ShellExecute(NULL, "open", "services.msc", "/s",
+                             NULL, SW_NORMAL);
+            }
+            else {
+                WinExec("Control.exe SrvMgr.cpl Services", SW_NORMAL);
+            }
+            return TRUE;
+
+        case IDM_EXIT:
+            ShowNotifyIcon(hWnd, NIM_DELETE);
+            PostQuitMessage(0);
+            return TRUE;
+        }
+
+    default:
+        return DefWindowProc(hWnd, message, wParam, lParam);
     }
 
     return FALSE;
 }
 
+
 /* Create main invisible window */
 HWND CreateMainWindow(HINSTANCE hInstance)
 {
-    HWND       hWnd = NULL;
+    HWND hWnd = NULL;
     WNDCLASSEX wcex;
 
     if (!GetSystemOSVersion(&g_dwOSVersion))
     {
         ErrorMessage(NULL, TRUE);
         return hWnd;
@@ -1552,104 +1692,106 @@
 
     wcex.style          = CS_HREDRAW | CS_VREDRAW;
     wcex.lpfnWndProc    = (WNDPROC)WndProc;
     wcex.cbClsExtra     = 0;
     wcex.cbWndExtra     = 0;
     wcex.hInstance      = hInstance;
-    wcex.hIcon          = (HICON)LoadImage(hInstance, MAKEINTRESOURCE(IDI_APSRVMON),
-                                           IMAGE_ICON, 32, 32, LR_DEFAULTCOLOR);
+    wcex.hIcon   = (HICON)LoadImage(hInstance, MAKEINTRESOURCE(IDI_APSRVMON),
+                                    IMAGE_ICON, 32, 32, LR_DEFAULTCOLOR);
     wcex.hCursor        = g_hCursorArrow;
     wcex.hbrBackground  = (HBRUSH)(COLOR_WINDOW+1);
     wcex.lpszMenuName   = 0;
     wcex.lpszClassName  = g_szWindowClass;
-    wcex.hIconSm        = (HICON)LoadImage(hInstance, MAKEINTRESOURCE(IDI_APSRVMON),
-                                           IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR);
+    wcex.hIconSm = (HICON)LoadImage(hInstance, MAKEINTRESOURCE(IDI_APSRVMON),
+                                    IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR);
 
-    if (RegisterClassEx(&wcex))
+    if (RegisterClassEx(&wcex)) {
         hWnd = CreateWindow(g_szWindowClass, g_szTitle,
-                             0, 0, 0, 0, 0,
-                             NULL, NULL, hInstance, NULL);
-
+                            0, 0, 0, 0, 0,
+                            NULL, NULL, hInstance, NULL);
+    }
     return hWnd;
 
 }
 
 
-int WINAPI WinMain(HINSTANCE hInstance,
-                    HINSTANCE hPrevInstance,
-                    LPSTR lpCmdLine,
-                    int nCmdShow)
+int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,
+                   LPSTR lpCmdLine, int nCmdShow)
 {
     CHAR szTmp[MAX_LOADSTRING];
     CHAR szCmp[MAX_COMPUTERNAME_LENGTH+4];
-    MSG     msg;
+    MSG msg;
     /* single instance mutex */
     HANDLE hMutex;
     int i;
     DWORD d;
 
     g_LangID = GetUserDefaultLangID();
-    if ((g_LangID & 0xFF) != LANG_ENGLISH)
+    if ((g_LangID & 0xFF) != LANG_ENGLISH) {
         g_LangID = MAKELANGID(LANG_NEUTRAL, SUBLANG_NEUTRAL);
-    
+    }
     for (i = IDS_MSG_FIRST; i <= IDS_MSG_LAST; ++i) {
         LoadString(hInstance, i, szTmp, MAX_LOADSTRING);
         g_lpMsg[i - IDS_MSG_FIRST] = strdup(szTmp);
     }
     LoadString(hInstance, IDS_APMONITORTITLE, szTmp, MAX_LOADSTRING);
     d = MAX_COMPUTERNAME_LENGTH+1;
     strcpy(szCmp, "\\\\");
     GetComputerName(szCmp + 2, &d);
     strupr(szCmp);
     g_szLocalHost = strdup(szCmp);
 
-    ZeroMemory(g_stComputers, sizeof(ST_MONITORED_COMP) * MAX_APACHE_COMPUTERS);
+    memset(g_stComputers, 0, sizeof(ST_MONITORED_COMP) * MAX_APACHE_COMPUTERS);
     g_stComputers[0].szComputerName = strdup(szCmp);
     g_stComputers[0].hRegistry = HKEY_LOCAL_MACHINE;
     g_szTitle = strdup(szTmp);
     LoadString(hInstance, IDS_APMONITORCLASS, szTmp, MAX_LOADSTRING);
     g_szWindowClass = strdup(szTmp);
 
     g_icoStop          = LoadImage(hInstance, MAKEINTRESOURCE(IDI_ICOSTOP),
                                    IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR);
     g_icoRun           = LoadImage(hInstance, MAKEINTRESOURCE(IDI_ICORUN),
                                    IMAGE_ICON, 16, 16, LR_DEFAULTCOLOR);
-    g_hCursorHourglass = LoadImage(NULL, MAKEINTRESOURCE(OCR_WAIT), IMAGE_CURSOR,
-                                   LR_DEFAULTSIZE, LR_DEFAULTSIZE, LR_SHARED);
-    g_hCursorArrow     = LoadImage(NULL, MAKEINTRESOURCE(OCR_NORMAL), IMAGE_CURSOR,
-                                   LR_DEFAULTSIZE, LR_DEFAULTSIZE, LR_SHARED);
+    g_hCursorHourglass = LoadImage(NULL, MAKEINTRESOURCE(OCR_WAIT), 
+                                   IMAGE_CURSOR, LR_DEFAULTSIZE, 
+                                   LR_DEFAULTSIZE, LR_SHARED);
+    g_hCursorArrow     = LoadImage(NULL, MAKEINTRESOURCE(OCR_NORMAL), 
+                                   IMAGE_CURSOR, LR_DEFAULTSIZE, 
+                                   LR_DEFAULTSIZE, LR_SHARED);
     g_hBmpStart        = LoadImage(hInstance, MAKEINTRESOURCE(IDB_BMPRUN),
-                                   IMAGE_BITMAP, XBITMAP, YBITMAP, LR_DEFAULTCOLOR);
+                                   IMAGE_BITMAP, XBITMAP, YBITMAP, 
+                                   LR_DEFAULTCOLOR);
     g_hBmpStop         = LoadImage(hInstance, MAKEINTRESOURCE(IDB_BMPSTOP),
-                                   IMAGE_BITMAP, XBITMAP, YBITMAP, LR_DEFAULTCOLOR);
+                                   IMAGE_BITMAP, XBITMAP, YBITMAP, 
+                                   LR_DEFAULTCOLOR);
 
     hMutex = CreateMutex(NULL, FALSE, "APSRVMON_MUTEX");
     if ((hMutex == NULL) || (GetLastError() == ERROR_ALREADY_EXISTS))
     {
-        ErrorMessage(g_lpMsg[IDS_MSG_APPRUNNING-IDS_MSG_FIRST], FALSE);
-        if (hMutex)
+        ErrorMessage(g_lpMsg[IDS_MSG_APPRUNNING - IDS_MSG_FIRST], FALSE);
+        if (hMutex) {
             CloseHandle(hMutex);
-
+        }
         return 0;
     }
 
-    ZeroMemory(g_stServices, sizeof(ST_APACHE_SERVICE) * MAX_APACHE_SERVICES);
+    memset(g_stServices, 0, sizeof(ST_APACHE_SERVICE) * MAX_APACHE_SERVICES);
     CoInitialize(NULL);
     InitCommonControls();
     g_hInstance = hInstance;
     g_hwndMain = CreateMainWindow(hInstance);
     g_bUiTaskbarCreated = RegisterWindowMessage("TaskbarCreated");
     InitializeCriticalSection(&g_stcSection);
-    g_hwndServiceDlg = NULL;                      
+    g_hwndServiceDlg = NULL;
     if (g_hwndMain != NULL)
     {
         while (GetMessage(&msg, NULL, 0, 0) == TRUE) 
         {
             TranslateMessage(&msg);
             DispatchMessage(&msg);
-        }    
+        }
         am_ClearServicesSt();
     }
     am_ClearComputersSt();
     DeleteCriticalSection(&g_stcSection);
     CloseHandle(hMutex);
     DestroyIcon(g_icoStop);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.dsp /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.dsp
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.dsp	2002-04-09 23:36:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.dsp	2002-05-17 00:40:54.000000000 +0800
@@ -39,25 +39,24 @@
 # PROP Use_MFC 0
 # PROP Use_Debug_Libraries 0
 # PROP Output_Dir "Release"
 # PROP Intermediate_Dir "Release"
 # PROP Ignore_Export_Lib 0
 # PROP Target_Dir ""
-# ADD BASE CPP /nologo /W3 /GX /O2 /D "WIN32" /D "NDEBUG" /D "_WINDOWS" /D "_MBCS" /Yu"stdafx.h" /FD /c
-# ADD CPP /nologo /MD /W3 /GX /O2 /D "WIN32" /D "NDEBUG" /D "_WINDOWS" /D "_MBCS" /D "STRICT" /FD /c
-# SUBTRACT CPP /YX /Yc /Yu
+# ADD BASE CPP /nologo /MD /W3 /GX /O2 /D "WIN32" /D "NDEBUG" /D "_WINDOWS" /D "_MBCS" /FD /c
+# ADD CPP /nologo /MD /W3 /GX /O2 /D "WIN32" /D "NDEBUG" /D "_WINDOWS" /D "_MBCS" /D "STRICT" /Fd"Release/ApacheMonitor" /FD /c
 # ADD BASE MTL /nologo /D "NDEBUG" /mktyplib203 /win32
 # ADD MTL /nologo /D "NDEBUG" /mktyplib203 /win32
 # ADD BASE RSC /l 0x409 /d "NDEBUG"
 # ADD RSC /l 0x409 /d "NDEBUG"
 BSC32=bscmake.exe
 # ADD BASE BSC32 /nologo
 # ADD BSC32 /nologo
 LINK32=link.exe
-# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /machine:I386
-# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib version.lib comctl32.lib /nologo /subsystem:windows /machine:I386
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib comctl32.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib /nologo /subsystem:windows /machine:I386
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib comctl32.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib /nologo /subsystem:windows /map /machine:I386
 
 !ELSEIF  "$(CFG)" == "ApacheMonitor - Win32 Debug"
 
 # PROP BASE Use_MFC 0
 # PROP BASE Use_Debug_Libraries 1
 # PROP BASE Output_Dir "Debug"
@@ -66,25 +65,24 @@
 # PROP Use_MFC 0
 # PROP Use_Debug_Libraries 1
 # PROP Output_Dir "Debug"
 # PROP Intermediate_Dir "Debug"
 # PROP Ignore_Export_Lib 0
 # PROP Target_Dir ""
-# ADD BASE CPP /nologo /W3 /Gm /GX /Zi /Od /D "WIN32" /D "_DEBUG" /D "_WINDOWS" /D "_MBCS" /Yu"stdafx.h" /FD /c
-# ADD CPP /nologo /MDd /W3 /Gm /GX /Zi /Od /D "WIN32" /D "_DEBUG" /D "_WINDOWS" /D "_MBCS" /D "STRICT" /FD /c
-# SUBTRACT CPP /YX /Yc /Yu
+# ADD BASE CPP /nologo /W3 /Gm /GX /Zi /Od /D "WIN32" /D "_DEBUG" /D "_WINDOWS" /D "_MBCS" /FD /c
+# ADD CPP /nologo /MDd /W3 /Gm /GX /Zi /Od /D "WIN32" /D "_DEBUG" /D "_WINDOWS" /D "_MBCS" /D "STRICT" /Fd"Debug/ApacheMonitor" /FD /c
 # ADD BASE MTL /nologo /D "_DEBUG" /mktyplib203 /win32
 # ADD MTL /nologo /D "_DEBUG" /mktyplib203 /win32
 # ADD BASE RSC /l 0x409 /d "_DEBUG"
 # ADD RSC /l 0x409 /d "_DEBUG"
 BSC32=bscmake.exe
 # ADD BASE BSC32 /nologo
 # ADD BSC32 /nologo
 LINK32=link.exe
-# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib /nologo /subsystem:windows /debug /machine:I386 /pdbtype:sept
-# ADD LINK32 kernel32.lib user32.lib gdi32.lib winspool.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib odbc32.lib odbccp32.lib version.lib comctl32.lib /nologo /subsystem:windows /debug /machine:I386 /pdbtype:sept
+# ADD BASE LINK32 kernel32.lib user32.lib gdi32.lib comctl32.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib /nologo /subsystem:windows /debug /machine:I386
+# ADD LINK32 kernel32.lib user32.lib gdi32.lib comctl32.lib comdlg32.lib advapi32.lib shell32.lib ole32.lib /nologo /subsystem:windows /incremental:no /map /debug /machine:I386
 
 !ENDIF 
 
 # Begin Target
 
 # Name "ApacheMonitor - Win32 Release"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.rc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.rc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/ApacheMonitor.rc	2002-04-09 08:12:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/ApacheMonitor.rc	2002-06-18 02:37:11.000000000 +0800
@@ -1,8 +1,68 @@
-#include "apachemonitor.h"
+/* ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ *    if any, must include the following acknowledgment:
+ *       "This product includes software developed by the
+ *        Apache Software Foundation (http://www.apache.org/)."
+ *    Alternately, this acknowledgment may appear in the software itself,
+ *    if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" must
+ *    not be used to endorse or promote products derived from this
+ *    software without prior written permission. For written
+ *    permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ *    nor may "Apache" appear in their name, without prior written
+ *    permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ *
+ * Portions of this software are based upon public domain software
+ * originally written at the National Center for Supercomputing Applications,
+ * University of Illinois, Urbana-Champaign.
+ */
+
 #include <windows.h>
+
+#include "ApacheMonitor.h"
+
 IDI_APSRVMON            ICON    DISCARDABLE     "ApacheMonitor.ico"
 IDI_ICOSTOP             ICON    DISCARDABLE     "apstop.ico"
 IDI_ICORUN              ICON    DISCARDABLE     "aprun.ico"
 
 #include "ApacheMonitorVersion.rc"
 
@@ -17,18 +77,19 @@
     LTEXT           "Service St&atus :",IDC_SSTATUS,3,40,272,8
     LISTBOX         IDL_SERVICES,2,49,285,73,LBS_OWNERDRAWFIXED | 
                     LBS_HASSTRINGS | LBS_USETABSTOPS | LBS_NOINTEGRALHEIGHT | 
                     LBS_DISABLENOSCROLL | WS_VSCROLL | WS_TABSTOP
     LISTBOX         IDL_STDOUT,2,124,285,51,LBS_NOINTEGRALHEIGHT | 
                     LBS_DISABLENOSCROLL | LBS_NOSEL | WS_VSCROLL
-    PUSHBUTTON      "&Start",IDC_SSTART,298,75,50,14
-    PUSHBUTTON      "S&top",IDC_SSTOP,298,91,50,14
-    PUSHBUTTON      "&Restart",IDC_SRESTART,298,107,50,14
-    PUSHBUTTON      "Ser&vices",IDC_SMANAGER,298,123,50,14
+    PUSHBUTTON      "&Start",IDC_SSTART,298,65,50,14
+    PUSHBUTTON      "S&top",IDC_SSTOP,298,81,50,14
+    PUSHBUTTON      "&Restart",IDC_SRESTART,298,97,50,14
+    PUSHBUTTON      "Ser&vices",IDC_SMANAGER,298,113,50,14
     CONTROL         IDB_BMPHEADER,IDC_STATIC,"Static",SS_BITMAP,0,0,349,38
-    PUSHBUTTON      "&Connect",IDC_SCONNECT,298,139,50,14
+    PUSHBUTTON      "&Connect",IDC_SCONNECT,298,129,50,14
+    PUSHBUTTON      "&Disconnect",IDC_SDISCONN,298,145,50,14
     PUSHBUTTON      "E&xit",IDC_SEXIT,298,161,50,14
 END
 
 IDD_DLGCONNECT DIALOGEX 0, 0, 240, 54
 STYLE DS_MODALFRAME | DS_SETFOREGROUND | WS_VISIBLE | WS_CLIPCHILDREN | 
     WS_CAPTION | WS_SYSMENU
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/wintty.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/wintty.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/support/win32/wintty.c	2002-03-14 04:48:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.39/support/win32/wintty.c	2002-05-30 12:47:03.000000000 +0800
@@ -105,16 +105,16 @@
     HANDLE in;
     HANDLE out;
 } feedback_args_t;
 
 int main(int argc, char** argv)
 {
-    char str[1024], *contitle;
+    char str[1024], *contitle = NULL;
     HANDLE hproc, thread;
-    HANDLE hwinsta, hsavewinsta;
-    HANDLE hdesk, hsavedesk;
+    HANDLE hwinsta = NULL, hsavewinsta;
+    HANDLE hdesk = NULL, hsavedesk = NULL;
     HANDLE conin, conout;
     HANDLE hstdin, hstdout, hstderr, hdup;
     feedback_args_t feed;
     DWORD conmode;
     DWORD newinmode = 0, notinmode = 0;
     DWORD newoutmode = 0, notoutmode = 0;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/test: .deps
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/httpd/repos/httpd-2.0.36/test: Makefile
