(buf == NULL || next_ptr >= MAX_PTR) return NULL;