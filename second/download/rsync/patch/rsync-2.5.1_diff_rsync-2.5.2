diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/authenticate.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/authenticate.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/authenticate.c	2001-11-30 08:21:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/authenticate.c	2002-01-24 10:33:45.000000000 +0800
@@ -102,14 +102,14 @@
 		close(fd);
 		return 0;
 	}
 
 	while (!found) {
 		int i = 0;
-		memset(line, 0, sizeof(line));
-		while (i<(sizeof(line)-1)) {
+		memset(line, 0, sizeof line);
+		while ((size_t) i < (sizeof(line)-1)) {
 			if (read(fd, &line[i], 1) != 1) {
 				memset(line, 0, sizeof(line));
 				close(fd);
 				return 0;
 			}
 			if (line[i] == '\r') continue;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/batch.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/batch.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/batch.c	2002-01-03 15:09:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/batch.c	2002-01-24 16:09:46.000000000 +0800
@@ -32,12 +32,13 @@
 	timeptr = localtime(&elapsed_seconds);
 
 	sprintf(batch_file_ext, "%4d%02d%02d%02d%02d%02d",
 		timeptr->tm_year + 1900, timeptr->tm_mon + 1,
 		timeptr->tm_mday, timeptr->tm_hour, timeptr->tm_min,
 		timeptr->tm_sec);
+	rprintf(FINFO,"batch file extension: %s\n", batch_file_ext);
 }
 
 void set_batch_file_ext(char *ext)
 {
 	strcpy(batch_file_ext, ext);
 }
@@ -81,18 +82,22 @@
 {
 	int i;
 	int bytes_to_write;
 
 	/* Write flist info to batch file */
 
-	bytes_to_write = sizeof(unsigned) +
+	bytes_to_write =
+	    sizeof(unsigned) +
 	    sizeof(time_t) +
 	    sizeof(OFF_T) +
 	    sizeof(mode_t) +
-	    sizeof(INO_T) +
-	    (2 * sizeof(dev_t)) + sizeof(uid_t) + sizeof(gid_t);
+	    sizeof(INO64_T) +
+	    sizeof(DEV64_T) +
+	    sizeof(DEV64_T) +
+	    sizeof(uid_t) +
+	    sizeof(gid_t);
 
 	fdb_open = 1;
 	fdb_close = 0;
 
 	for (i = 0; i < flist_count; i++) {
 		write_batch_flist_file((char *) fptr[i], bytes_to_write);
@@ -125,13 +130,13 @@
 
 	if (buf != NULL) {
 		write_batch_flist_file(buf, strlen(buf));
 	}
 }
 
-void write_batch_argvs_file(int orig_argc, int argc, char **argv)
+void write_batch_argvs_file(int argc, char *argv[])
 {
 	int fdb;
 	int i;
 	char buff[256];
 
 	strcat(rsync_argvs_file, batch_file_ext);
@@ -146,29 +151,33 @@
 		close(fdb);
 		exit_cleanup(1);
 	}
 	buff[0] = '\0';
 	/* Write argvs info to batch file */
 
-	for (i = argc - orig_argc; i < argc; i++) {
-		/* FIXME: This apparently crashes if rsync is run with
-		 * just "rsync -F".  I think directly manipulating
-		 * argv[] is probably bogus -- what if -F is part of a
-		 * run of several short options? */
-		if (!strcmp(argv[i], "-F")) {	/* safer to change it here than script */
-			strncat(buff, "-f ", 3);	/* chg to -f + ext to get ready for remote */
-			strncat(buff, batch_file_ext,
-				strlen(batch_file_ext));
+	for (i = 0; i < argc; ++i) {
+		if (i == argc - 2)
+		    continue;
+		/*
+		 * FIXME:
+		 * I think directly manipulating argv[] is probably bogus
+		 */
+		if (!strcmp(argv[i], "--write-batch")) {
+			/* Safer to change it here than script */
+			/* Change to --read-batch + ext * to get ready for remote */
+			strlcat(buff, "--read-batch ", sizeof(buff));
+			strlcat(buff, batch_file_ext, sizeof(buff));
 		} else {
-			strncat(buff, argv[i], strlen(argv[i]));
+			strlcat(buff, argv[i], sizeof(buff));
 		}
 
 		if (i < (argc - 1)) {
-			strncat(buff, " ", 1);
+			strlcat(buff, " ", sizeof(buff));
 		}
 	}
+	strlcat(buff, "\n", sizeof(buff));
 	if (!write(fdb, buff, strlen(buff))) {
 		rprintf(FERROR, "Batch file %s write error: %s\n",
 			rsync_argvs_file, strerror(errno));
 		close(fdb);
 		exit_cleanup(1);
 	}
@@ -286,15 +295,15 @@
 
 	(*fptr) = file;
 
 	read_batch_flist_file((char *) &file->modtime, sizeof(time_t));
 	read_batch_flist_file((char *) &file->length, sizeof(OFF_T));
 	read_batch_flist_file((char *) &file->mode, sizeof(mode_t));
-	read_batch_flist_file((char *) &file->inode, sizeof(INO_T));
-	read_batch_flist_file((char *) &file->dev, sizeof(dev_t));
-	read_batch_flist_file((char *) &file->rdev, sizeof(dev_t));
+	read_batch_flist_file((char *) &file->inode, sizeof(INO64_T));
+	read_batch_flist_file((char *) &file->dev, sizeof(DEV64_T));
+	read_batch_flist_file((char *) &file->rdev, sizeof(DEV64_T));
 	read_batch_flist_file((char *) &file->uid, sizeof(uid_t));
 	read_batch_flist_file((char *) &file->gid, sizeof(gid_t));
 	read_batch_flist_file(char_str_len, sizeof(char_str_len));
 	int_str_len = IVAL(char_str_len, 0);
 	if (int_str_len > 0) {
 		read_batch_flist_file(buff, int_str_len);
@@ -342,13 +351,13 @@
 		file[0].sum = strdup(buff);
 	} else {
 		file[0].sum = NULL;
 	}
 }
 
-void write_batch_csums_file(char *buff, int bytes_to_write)
+void write_batch_csums_file(void *buff, int bytes_to_write)
 {
 
 	static int fdb_open = 1;
 
 	if (fdb_open) {
 		/* Set up file extension */
@@ -383,27 +392,30 @@
 
 }
 
 void write_batch_csum_info(int *flist_entry, int flist_count,
 			   struct sum_struct *s)
 {
-	int i;
-	int int_zero = 0;
+	size_t i;
+	unsigned int int_zero = 0;
 	extern int csum_length;
 
 	fdb_open = 1;
 
 	/* Write csum info to batch file */
 
-	write_batch_csums_file((char *) flist_entry, sizeof(int));
-	write_batch_csums_file((char *) (s ? &s->count : &int_zero),
-			       sizeof(int));
+	/* FIXME: This will break if s->count is ever not exactly an int. */
+	write_batch_csums_file(flist_entry, sizeof(int));
+	if (s)
+		write_batch_csums_file(&s->count, sizeof(int));
+	else
+		write_batch_csums_file(&int_zero, sizeof (int));
+	
 	if (s) {
 		for (i = 0; i < s->count; i++) {
-			write_batch_csums_file((char *) &s->sums[i].sum1,
-					       sizeof(uint32));
+			write_batch_csums_file(&s->sums[i].sum1, sizeof(uint32));
 			if ((*flist_entry == flist_count - 1)
 			    && (i == s->count - 1)) {
 				fdb_close = 1;
 			}
 			write_batch_csums_file(s->sums[i].sum2,
 					       csum_length);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2: clientname.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/clientserver.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/clientserver.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/clientserver.c	2002-01-03 15:09:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/clientserver.c	2002-01-24 12:41:09.000000000 +0800
@@ -165,15 +165,15 @@
 	extern int am_sender;
 	extern int remote_version;
 	extern int am_root;
 
 	if (!allow_access(addr, host, lp_hosts_allow(i), lp_hosts_deny(i))) {
 		rprintf(FERROR,"rsync denied on module %s from %s (%s)\n",
-			name, client_name(fd), client_addr(fd));
+			name, host, addr);
 		io_printf(fd,"@ERROR: access denied to %s from %s (%s)\n",
-			  name, client_name(fd), client_addr(fd));
+			  name, host, addr);
 		return -1;
 	}
 
 	if (!claim_connection(lp_lock_file(i), lp_max_connections(i))) {
 		if (errno) {
 			rprintf(FERROR,"failed to open lock file %s : %s\n",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/config.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/config.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/config.h.in	2002-01-03 15:09:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/config.h.in	2002-01-15 17:53:29.000000000 +0800
@@ -119,12 +119,18 @@
 /* Define if you have the `link' function. */
 #undef HAVE_LINK
 
 /* */
 #undef HAVE_LONGLONG
 
+/* Define if you have the `mallinfo' function. */
+#undef HAVE_MALLINFO
+
+/* Define if you have the <malloc.h> header file. */
+#undef HAVE_MALLOC_H
+
 /* Define if you have the <mcheck.h> header file. */
 #undef HAVE_MCHECK_H
 
 /* Define if you have the `memmove' function. */
 #undef HAVE_MEMMOVE
 
@@ -321,12 +327,15 @@
    (like Motorola and SPARC, unlike Intel and VAX). */
 #undef WORDS_BIGENDIAN
 
 /* Number of bits in a file offset, on hosts where this is settable. */
 #undef _FILE_OFFSET_BITS
 
+/* Define _GNU_SOURCE so that we get all necessary prototypes */
+#undef _GNU_SOURCE
+
 /* Define for large files, on AIX-style hosts. */
 #undef _LARGE_FILES
 
 /* Define to `int' if <sys/types.h> doesn't define. */
 #undef gid_t
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/configure	2002-01-03 15:19:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/configure	2002-01-26 07:19:21.000000000 +0800
@@ -667,12 +667,13 @@
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
   --enable-debug          including debugging symbols and features (default
                           yes)
+  --enable-profile        turn on CPU profiling (default no)
   --disable-largefile     omit support for large files
   --disable-ipv6          don't even try to use IPv6
 
 Optional Packages:
   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
@@ -868,32 +869,32 @@
   else
     CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
   fi
 fi
 for ac_site_file in $CONFIG_SITE; do
   if test -r "$ac_site_file"; then
-    { echo "$as_me:874: loading site script $ac_site_file" >&5
+    { echo "$as_me:875: loading site script $ac_site_file" >&5
 echo "$as_me: loading site script $ac_site_file" >&6;}
     cat "$ac_site_file" >&5
     . "$ac_site_file"
   fi
 done
 
 if test -r "$cache_file"; then
   # Some versions of bash will fail to source /dev/null (special
   # files actually), so we avoid doing that.
   if test -f "$cache_file"; then
-    { echo "$as_me:885: loading cache $cache_file" >&5
+    { echo "$as_me:886: loading cache $cache_file" >&5
 echo "$as_me: loading cache $cache_file" >&6;}
     case $cache_file in
       [\\/]* | ?:[\\/]* ) . $cache_file;;
       *)                      . ./$cache_file;;
     esac
   fi
 else
-  { echo "$as_me:893: creating cache $cache_file" >&5
+  { echo "$as_me:894: creating cache $cache_file" >&5
 echo "$as_me: creating cache $cache_file" >&6;}
   >$cache_file
 fi
 
 # Check that the precious variables saved in the cache have kept the same
 # value.
@@ -903,27 +904,27 @@
   eval ac_old_set=\$ac_cv_env_${ac_var}_set
   eval ac_new_set=\$ac_env_${ac_var}_set
   eval ac_old_val="\$ac_cv_env_${ac_var}_value"
   eval ac_new_val="\$ac_env_${ac_var}_value"
   case $ac_old_set,$ac_new_set in
     set,)
-      { echo "$as_me:909: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+      { echo "$as_me:910: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
 echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,set)
-      { echo "$as_me:913: error: \`$ac_var' was not set in the previous run" >&5
+      { echo "$as_me:914: error: \`$ac_var' was not set in the previous run" >&5
 echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
       ac_cache_corrupted=: ;;
     ,);;
     *)
       if test "x$ac_old_val" != "x$ac_new_val"; then
-        { echo "$as_me:919: error: \`$ac_var' has changed since the previous run:" >&5
+        { echo "$as_me:920: error: \`$ac_var' has changed since the previous run:" >&5
 echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
-        { echo "$as_me:921:   former value:  $ac_old_val" >&5
+        { echo "$as_me:922:   former value:  $ac_old_val" >&5
 echo "$as_me:   former value:  $ac_old_val" >&2;}
-        { echo "$as_me:923:   current value: $ac_new_val" >&5
+        { echo "$as_me:924:   current value: $ac_new_val" >&5
 echo "$as_me:   current value: $ac_new_val" >&2;}
         ac_cache_corrupted=:
       fi;;
   esac
   # Pass precious variables to config.status.  It doesn't matter if
   # we pass some twice (in addition to the command line arguments).
@@ -936,15 +937,15 @@
     *) ac_configure_args="$ac_configure_args $ac_var=$ac_new_val"
        ;;
     esac
   fi
 done
 if $ac_cache_corrupted; then
-  { echo "$as_me:942: error: changes in the environment can compromise the build" >&5
+  { echo "$as_me:943: error: changes in the environment can compromise the build" >&5
 echo "$as_me: error: changes in the environment can compromise the build" >&2;}
-  { { echo "$as_me:944: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
+  { { echo "$as_me:945: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
 echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -958,29 +959,29 @@
   *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
   *)      ECHO_N= ECHO_C='\c' ECHO_T= ;;
 esac
 echo "#! $SHELL" >conftest.sh
 echo  "exit 0"   >>conftest.sh
 chmod +x conftest.sh
-if { (echo "$as_me:964: PATH=\".;.\"; conftest.sh") >&5
+if { (echo "$as_me:965: PATH=\".;.\"; conftest.sh") >&5
   (PATH=".;."; conftest.sh) 2>&5
   ac_status=$?
-  echo "$as_me:967: \$? = $ac_status" >&5
+  echo "$as_me:968: \$? = $ac_status" >&5
   (exit $ac_status); }; then
   ac_path_separator=';'
 else
   ac_path_separator=:
 fi
 PATH_SEPARATOR="$ac_path_separator"
 rm -f conftest.sh
 
 ac_config_headers="$ac_config_headers config.h"
 
-RSYNC_VERSION=2.5.1
+RSYNC_VERSION=2.5.2
 
-{ echo "$as_me:980: Configuring rsync $RSYNC_VERSION" >&5
+{ echo "$as_me:981: Configuring rsync $RSYNC_VERSION" >&5
 echo "$as_me: Configuring rsync $RSYNC_VERSION" >&6;}
 
 cat >>confdefs.h <<EOF
 #define RSYNC_VERSION "$RSYNC_VERSION"
 EOF
 
@@ -1000,87 +1001,87 @@
     ac_aux_dir=$ac_dir
     ac_install_sh="$ac_aux_dir/shtool install -c"
     break
   fi
 done
 if test -z "$ac_aux_dir"; then
-  { { echo "$as_me:1006: error: cannot find install-sh or install.sh in $srcdir $srcdir/.. $srcdir/../.." >&5
+  { { echo "$as_me:1007: error: cannot find install-sh or install.sh in $srcdir $srcdir/.. $srcdir/../.." >&5
 echo "$as_me: error: cannot find install-sh or install.sh in $srcdir $srcdir/.. $srcdir/../.." >&2;}
    { (exit 1); exit 1; }; }
 fi
 ac_config_guess="$SHELL $ac_aux_dir/config.guess"
 ac_config_sub="$SHELL $ac_aux_dir/config.sub"
 ac_configure="$SHELL $ac_aux_dir/configure" # This should be Cygnus configure.
 
 # Make sure we can run config.sub.
 $ac_config_sub sun4 >/dev/null 2>&1 ||
-  { { echo "$as_me:1016: error: cannot run $ac_config_sub" >&5
+  { { echo "$as_me:1017: error: cannot run $ac_config_sub" >&5
 echo "$as_me: error: cannot run $ac_config_sub" >&2;}
    { (exit 1); exit 1; }; }
 
-echo "$as_me:1020: checking build system type" >&5
+echo "$as_me:1021: checking build system type" >&5
 echo $ECHO_N "checking build system type... $ECHO_C" >&6
 if test "${ac_cv_build+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_build_alias=$build_alias
 test -z "$ac_cv_build_alias" &&
   ac_cv_build_alias=`$ac_config_guess`
 test -z "$ac_cv_build_alias" &&
-  { { echo "$as_me:1029: error: cannot guess build type; you must specify one" >&5
+  { { echo "$as_me:1030: error: cannot guess build type; you must specify one" >&5
 echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
    { (exit 1); exit 1; }; }
 ac_cv_build=`$ac_config_sub $ac_cv_build_alias` ||
-  { { echo "$as_me:1033: error: $ac_config_sub $ac_cv_build_alias failed." >&5
+  { { echo "$as_me:1034: error: $ac_config_sub $ac_cv_build_alias failed." >&5
 echo "$as_me: error: $ac_config_sub $ac_cv_build_alias failed." >&2;}
    { (exit 1); exit 1; }; }
 
 fi
-echo "$as_me:1038: result: $ac_cv_build" >&5
+echo "$as_me:1039: result: $ac_cv_build" >&5
 echo "${ECHO_T}$ac_cv_build" >&6
 build=$ac_cv_build
 build_cpu=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
 build_vendor=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
 build_os=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
 
-echo "$as_me:1045: checking host system type" >&5
+echo "$as_me:1046: checking host system type" >&5
 echo $ECHO_N "checking host system type... $ECHO_C" >&6
 if test "${ac_cv_host+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_host_alias=$host_alias
 test -z "$ac_cv_host_alias" &&
   ac_cv_host_alias=$ac_cv_build_alias
 ac_cv_host=`$ac_config_sub $ac_cv_host_alias` ||
-  { { echo "$as_me:1054: error: $ac_config_sub $ac_cv_host_alias failed" >&5
+  { { echo "$as_me:1055: error: $ac_config_sub $ac_cv_host_alias failed" >&5
 echo "$as_me: error: $ac_config_sub $ac_cv_host_alias failed" >&2;}
    { (exit 1); exit 1; }; }
 
 fi
-echo "$as_me:1059: result: $ac_cv_host" >&5
+echo "$as_me:1060: result: $ac_cv_host" >&5
 echo "${ECHO_T}$ac_cv_host" >&6
 host=$ac_cv_host
 host_cpu=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
 host_vendor=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
 host_os=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
 
-echo "$as_me:1066: checking target system type" >&5
+echo "$as_me:1067: checking target system type" >&5
 echo $ECHO_N "checking target system type... $ECHO_C" >&6
 if test "${ac_cv_target+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_target_alias=$target_alias
 test "x$ac_cv_target_alias" = "x" &&
   ac_cv_target_alias=$ac_cv_host_alias
 ac_cv_target=`$ac_config_sub $ac_cv_target_alias` ||
-  { { echo "$as_me:1075: error: $ac_config_sub $ac_cv_target_alias failed" >&5
+  { { echo "$as_me:1076: error: $ac_config_sub $ac_cv_target_alias failed" >&5
 echo "$as_me: error: $ac_config_sub $ac_cv_target_alias failed" >&2;}
    { (exit 1); exit 1; }; }
 
 fi
-echo "$as_me:1080: result: $ac_cv_target" >&5
+echo "$as_me:1081: result: $ac_cv_target" >&5
 echo "${ECHO_T}$ac_cv_target" >&6
 target=$ac_cv_target
 target_cpu=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
 target_vendor=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
 target_os=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
 
@@ -1096,13 +1097,13 @@
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}gcc; ac_word=$2
-echo "$as_me:1102: checking for $ac_word" >&5
+echo "$as_me:1103: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -1111,33 +1112,33 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_CC="${ac_tool_prefix}gcc"
-echo "$as_me:1117: found $ac_dir/$ac_word" >&5
+echo "$as_me:1118: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$as_me:1125: result: $CC" >&5
+  echo "$as_me:1126: result: $CC" >&5
 echo "${ECHO_T}$CC" >&6
 else
-  echo "$as_me:1128: result: no" >&5
+  echo "$as_me:1129: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
 fi
 if test -z "$ac_cv_prog_CC"; then
   ac_ct_CC=$CC
   # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-echo "$as_me:1137: checking for $ac_word" >&5
+echo "$as_me:1138: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$ac_ct_CC"; then
   ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
@@ -1146,37 +1147,37 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_ac_ct_CC="gcc"
-echo "$as_me:1152: found $ac_dir/$ac_word" >&5
+echo "$as_me:1153: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  echo "$as_me:1160: result: $ac_ct_CC" >&5
+  echo "$as_me:1161: result: $ac_ct_CC" >&5
 echo "${ECHO_T}$ac_ct_CC" >&6
 else
-  echo "$as_me:1163: result: no" >&5
+  echo "$as_me:1164: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
   CC=$ac_ct_CC
 else
   CC="$ac_cv_prog_CC"
 fi
 
 if test -z "$CC"; then
   if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
 set dummy ${ac_tool_prefix}cc; ac_word=$2
-echo "$as_me:1176: checking for $ac_word" >&5
+echo "$as_me:1177: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -1185,33 +1186,33 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_CC="${ac_tool_prefix}cc"
-echo "$as_me:1191: found $ac_dir/$ac_word" >&5
+echo "$as_me:1192: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$as_me:1199: result: $CC" >&5
+  echo "$as_me:1200: result: $CC" >&5
 echo "${ECHO_T}$CC" >&6
 else
-  echo "$as_me:1202: result: no" >&5
+  echo "$as_me:1203: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
 fi
 if test -z "$ac_cv_prog_CC"; then
   ac_ct_CC=$CC
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-echo "$as_me:1211: checking for $ac_word" >&5
+echo "$as_me:1212: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$ac_ct_CC"; then
   ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
@@ -1220,37 +1221,37 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_ac_ct_CC="cc"
-echo "$as_me:1226: found $ac_dir/$ac_word" >&5
+echo "$as_me:1227: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  echo "$as_me:1234: result: $ac_ct_CC" >&5
+  echo "$as_me:1235: result: $ac_ct_CC" >&5
 echo "${ECHO_T}$ac_ct_CC" >&6
 else
-  echo "$as_me:1237: result: no" >&5
+  echo "$as_me:1238: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
   CC=$ac_ct_CC
 else
   CC="$ac_cv_prog_CC"
 fi
 
 fi
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-echo "$as_me:1250: checking for $ac_word" >&5
+echo "$as_me:1251: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -1264,13 +1265,13 @@
   $as_executable_p "$ac_dir/$ac_word" || continue
 if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
   ac_prog_rejected=yes
   continue
 fi
 ac_cv_prog_CC="cc"
-echo "$as_me:1270: found $ac_dir/$ac_word" >&5
+echo "$as_me:1271: found $ac_dir/$ac_word" >&5
 break
 done
 
 if test $ac_prog_rejected = yes; then
   # We found a bogon in the path, so make sure we never use it.
   set dummy $ac_cv_prog_CC
@@ -1286,27 +1287,27 @@
   fi
 fi
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$as_me:1292: result: $CC" >&5
+  echo "$as_me:1293: result: $CC" >&5
 echo "${ECHO_T}$CC" >&6
 else
-  echo "$as_me:1295: result: no" >&5
+  echo "$as_me:1296: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
 fi
 if test -z "$CC"; then
   if test -n "$ac_tool_prefix"; then
   for ac_prog in cl
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-echo "$as_me:1306: checking for $ac_word" >&5
+echo "$as_me:1307: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
@@ -1315,37 +1316,37 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-echo "$as_me:1321: found $ac_dir/$ac_word" >&5
+echo "$as_me:1322: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$as_me:1329: result: $CC" >&5
+  echo "$as_me:1330: result: $CC" >&5
 echo "${ECHO_T}$CC" >&6
 else
-  echo "$as_me:1332: result: no" >&5
+  echo "$as_me:1333: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
     test -n "$CC" && break
   done
 fi
 if test -z "$CC"; then
   ac_ct_CC=$CC
   for ac_prog in cl
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo "$as_me:1345: checking for $ac_word" >&5
+echo "$as_me:1346: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$ac_ct_CC"; then
   ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
@@ -1354,61 +1355,61 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_ac_ct_CC="$ac_prog"
-echo "$as_me:1360: found $ac_dir/$ac_word" >&5
+echo "$as_me:1361: found $ac_dir/$ac_word" >&5
 break
 done
 
 fi
 fi
 ac_ct_CC=$ac_cv_prog_ac_ct_CC
 if test -n "$ac_ct_CC"; then
-  echo "$as_me:1368: result: $ac_ct_CC" >&5
+  echo "$as_me:1369: result: $ac_ct_CC" >&5
 echo "${ECHO_T}$ac_ct_CC" >&6
 else
-  echo "$as_me:1371: result: no" >&5
+  echo "$as_me:1372: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
   test -n "$ac_ct_CC" && break
 done
 
   CC=$ac_ct_CC
 fi
 
 fi
 
-test -z "$CC" && { { echo "$as_me:1383: error: no acceptable cc found in \$PATH" >&5
+test -z "$CC" && { { echo "$as_me:1384: error: no acceptable cc found in \$PATH" >&5
 echo "$as_me: error: no acceptable cc found in \$PATH" >&2;}
    { (exit 1); exit 1; }; }
 
 # Provide some information about the compiler.
-echo "$as_me:1388:" \
+echo "$as_me:1389:" \
      "checking for C compiler version" >&5
 ac_compiler=`set X $ac_compile; echo $2`
-{ (eval echo "$as_me:1391: \"$ac_compiler --version </dev/null >&5\"") >&5
+{ (eval echo "$as_me:1392: \"$ac_compiler --version </dev/null >&5\"") >&5
   (eval $ac_compiler --version </dev/null >&5) 2>&5
   ac_status=$?
-  echo "$as_me:1394: \$? = $ac_status" >&5
+  echo "$as_me:1395: \$? = $ac_status" >&5
   (exit $ac_status); }
-{ (eval echo "$as_me:1396: \"$ac_compiler -v </dev/null >&5\"") >&5
+{ (eval echo "$as_me:1397: \"$ac_compiler -v </dev/null >&5\"") >&5
   (eval $ac_compiler -v </dev/null >&5) 2>&5
   ac_status=$?
-  echo "$as_me:1399: \$? = $ac_status" >&5
+  echo "$as_me:1400: \$? = $ac_status" >&5
   (exit $ac_status); }
-{ (eval echo "$as_me:1401: \"$ac_compiler -V </dev/null >&5\"") >&5
+{ (eval echo "$as_me:1402: \"$ac_compiler -V </dev/null >&5\"") >&5
   (eval $ac_compiler -V </dev/null >&5) 2>&5
   ac_status=$?
-  echo "$as_me:1404: \$? = $ac_status" >&5
+  echo "$as_me:1405: \$? = $ac_status" >&5
   (exit $ac_status); }
 
 cat >conftest.$ac_ext <<_ACEOF
-#line 1408 "configure"
+#line 1409 "configure"
 #include "confdefs.h"
 
 int
 main ()
 {
 
@@ -1418,19 +1419,19 @@
 _ACEOF
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files a.out a.exe"
 # Try to create an executable without -o first, disregard a.out.
 # It will help us diagnose broken compilers, and finding out an intuition
 # of exeext.
-echo "$as_me:1424: checking for C compiler default output" >&5
+echo "$as_me:1425: checking for C compiler default output" >&5
 echo $ECHO_N "checking for C compiler default output... $ECHO_C" >&6
 ac_link_default=`echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
-if { (eval echo "$as_me:1427: \"$ac_link_default\"") >&5
+if { (eval echo "$as_me:1428: \"$ac_link_default\"") >&5
   (eval $ac_link_default) 2>&5
   ac_status=$?
-  echo "$as_me:1430: \$? = $ac_status" >&5
+  echo "$as_me:1431: \$? = $ac_status" >&5
   (exit $ac_status); }; then
   # Find the output, starting from the most likely.  This scheme is
 # not robust to junk in `.', hence go to wildcards (a.*) only as a last
 # resort.
 for ac_file in `ls a.exe conftest.exe 2>/dev/null;
                 ls a.out conftest 2>/dev/null;
@@ -1447,65 +1448,65 @@
     * ) break;;
   esac
 done
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-{ { echo "$as_me:1453: error: C compiler cannot create executables" >&5
+{ { echo "$as_me:1454: error: C compiler cannot create executables" >&5
 echo "$as_me: error: C compiler cannot create executables" >&2;}
    { (exit 77); exit 77; }; }
 fi
 
 ac_exeext=$ac_cv_exeext
-echo "$as_me:1459: result: $ac_file" >&5
+echo "$as_me:1460: result: $ac_file" >&5
 echo "${ECHO_T}$ac_file" >&6
 
 # Check the compiler produces executables we can run.  If not, either
 # the compiler is broken, or we cross compile.
-echo "$as_me:1464: checking whether the C compiler works" >&5
+echo "$as_me:1465: checking whether the C compiler works" >&5
 echo $ECHO_N "checking whether the C compiler works... $ECHO_C" >&6
 # FIXME: These cross compiler hacks should be removed for Autoconf 3.0
 # If not cross compiling, check that we can run a simple program.
 if test "$cross_compiling" != yes; then
   if { ac_try='./$ac_file'
-  { (eval echo "$as_me:1470: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1471: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1473: \$? = $ac_status" >&5
+  echo "$as_me:1474: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
     cross_compiling=no
   else
     if test "$cross_compiling" = maybe; then
 	cross_compiling=yes
     else
-	{ { echo "$as_me:1480: error: cannot run C compiled programs.
+	{ { echo "$as_me:1481: error: cannot run C compiled programs.
 If you meant to cross compile, use \`--host'." >&5
 echo "$as_me: error: cannot run C compiled programs.
 If you meant to cross compile, use \`--host'." >&2;}
    { (exit 1); exit 1; }; }
     fi
   fi
 fi
-echo "$as_me:1488: result: yes" >&5
+echo "$as_me:1489: result: yes" >&5
 echo "${ECHO_T}yes" >&6
 
 rm -f a.out a.exe conftest$ac_cv_exeext
 ac_clean_files=$ac_clean_files_save
 # Check the compiler produces executables we can run.  If not, either
 # the compiler is broken, or we cross compile.
-echo "$as_me:1495: checking whether we are cross compiling" >&5
+echo "$as_me:1496: checking whether we are cross compiling" >&5
 echo $ECHO_N "checking whether we are cross compiling... $ECHO_C" >&6
-echo "$as_me:1497: result: $cross_compiling" >&5
+echo "$as_me:1498: result: $cross_compiling" >&5
 echo "${ECHO_T}$cross_compiling" >&6
 
-echo "$as_me:1500: checking for executable suffix" >&5
+echo "$as_me:1501: checking for executable suffix" >&5
 echo $ECHO_N "checking for executable suffix... $ECHO_C" >&6
-if { (eval echo "$as_me:1502: \"$ac_link\"") >&5
+if { (eval echo "$as_me:1503: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:1505: \$? = $ac_status" >&5
+  echo "$as_me:1506: \$? = $ac_status" >&5
   (exit $ac_status); }; then
   # If both `conftest.exe' and `conftest' are `present' (well, observable)
 # catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
 # work properly (i.e., refer to `conftest.exe'), while it won't with
 # `rm'.
 for ac_file in `(ls conftest.exe; ls conftest; ls conftest.*) 2>/dev/null`; do
@@ -1515,75 +1516,75 @@
           export ac_cv_exeext
           break;;
     * ) break;;
   esac
 done
 else
-  { { echo "$as_me:1521: error: cannot compute EXEEXT: cannot compile and link" >&5
+  { { echo "$as_me:1522: error: cannot compute EXEEXT: cannot compile and link" >&5
 echo "$as_me: error: cannot compute EXEEXT: cannot compile and link" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 rm -f conftest$ac_cv_exeext
-echo "$as_me:1527: result: $ac_cv_exeext" >&5
+echo "$as_me:1528: result: $ac_cv_exeext" >&5
 echo "${ECHO_T}$ac_cv_exeext" >&6
 
 rm -f conftest.$ac_ext
 EXEEXT=$ac_cv_exeext
 ac_exeext=$EXEEXT
-echo "$as_me:1533: checking for object suffix" >&5
+echo "$as_me:1534: checking for object suffix" >&5
 echo $ECHO_N "checking for object suffix... $ECHO_C" >&6
 if test "${ac_cv_objext+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 1539 "configure"
+#line 1540 "configure"
 #include "confdefs.h"
 
 int
 main ()
 {
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.o conftest.obj
-if { (eval echo "$as_me:1551: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1552: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1554: \$? = $ac_status" >&5
+  echo "$as_me:1555: \$? = $ac_status" >&5
   (exit $ac_status); }; then
   for ac_file in `(ls conftest.o conftest.obj; ls conftest.*) 2>/dev/null`; do
   case $ac_file in
     *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb ) ;;
     *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
        break;;
   esac
 done
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-{ { echo "$as_me:1566: error: cannot compute OBJEXT: cannot compile" >&5
+{ { echo "$as_me:1567: error: cannot compute OBJEXT: cannot compile" >&5
 echo "$as_me: error: cannot compute OBJEXT: cannot compile" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 rm -f conftest.$ac_cv_objext conftest.$ac_ext
 fi
-echo "$as_me:1573: result: $ac_cv_objext" >&5
+echo "$as_me:1574: result: $ac_cv_objext" >&5
 echo "${ECHO_T}$ac_cv_objext" >&6
 OBJEXT=$ac_cv_objext
 ac_objext=$OBJEXT
-echo "$as_me:1577: checking whether we are using the GNU C compiler" >&5
+echo "$as_me:1578: checking whether we are using the GNU C compiler" >&5
 echo $ECHO_N "checking whether we are using the GNU C compiler... $ECHO_C" >&6
 if test "${ac_cv_c_compiler_gnu+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 1583 "configure"
+#line 1584 "configure"
 #include "confdefs.h"
 
 int
 main ()
 {
 #ifndef __GNUC__
@@ -1592,77 +1593,77 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:1598: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1599: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1601: \$? = $ac_status" >&5
+  echo "$as_me:1602: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:1604: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1605: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1607: \$? = $ac_status" >&5
+  echo "$as_me:1608: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_compiler_gnu=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_compiler_gnu=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 ac_cv_c_compiler_gnu=$ac_compiler_gnu
 
 fi
-echo "$as_me:1619: result: $ac_cv_c_compiler_gnu" >&5
+echo "$as_me:1620: result: $ac_cv_c_compiler_gnu" >&5
 echo "${ECHO_T}$ac_cv_c_compiler_gnu" >&6
 GCC=`test $ac_compiler_gnu = yes && echo yes`
 ac_test_CFLAGS=${CFLAGS+set}
 ac_save_CFLAGS=$CFLAGS
 CFLAGS="-g"
-echo "$as_me:1625: checking whether $CC accepts -g" >&5
+echo "$as_me:1626: checking whether $CC accepts -g" >&5
 echo $ECHO_N "checking whether $CC accepts -g... $ECHO_C" >&6
 if test "${ac_cv_prog_cc_g+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 1631 "configure"
+#line 1632 "configure"
 #include "confdefs.h"
 
 int
 main ()
 {
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:1643: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1644: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1646: \$? = $ac_status" >&5
+  echo "$as_me:1647: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:1649: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1650: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1652: \$? = $ac_status" >&5
+  echo "$as_me:1653: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_prog_cc_g=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_prog_cc_g=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:1662: result: $ac_cv_prog_cc_g" >&5
+echo "$as_me:1663: result: $ac_cv_prog_cc_g" >&5
 echo "${ECHO_T}$ac_cv_prog_cc_g" >&6
 if test "$ac_test_CFLAGS" = set; then
   CFLAGS=$ac_save_CFLAGS
 elif test $ac_cv_prog_cc_g = yes; then
   if test "$GCC" = yes; then
     CFLAGS="-g -O2"
@@ -1683,87 +1684,87 @@
 cat >conftest.$ac_ext <<_ACEOF
 #ifndef __cplusplus
   choke me
 #endif
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:1689: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1690: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1692: \$? = $ac_status" >&5
+  echo "$as_me:1693: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:1695: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1696: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1698: \$? = $ac_status" >&5
+  echo "$as_me:1699: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   for ac_declaration in \
    ''\
    '#include <stdlib.h>' \
    'extern "C" void std::exit (int) throw (); using std::exit;' \
    'extern "C" void std::exit (int); using std::exit;' \
    'extern "C" void exit (int) throw ();' \
    'extern "C" void exit (int);' \
    'void exit (int);'
 do
   cat >conftest.$ac_ext <<_ACEOF
-#line 1710 "configure"
+#line 1711 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 $ac_declaration
 int
 main ()
 {
 exit (42);
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:1723: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1724: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1726: \$? = $ac_status" >&5
+  echo "$as_me:1727: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:1729: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1730: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1732: \$? = $ac_status" >&5
+  echo "$as_me:1733: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   :
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 continue
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
-#line 1742 "configure"
+#line 1743 "configure"
 #include "confdefs.h"
 $ac_declaration
 int
 main ()
 {
 exit (42);
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:1754: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:1755: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:1757: \$? = $ac_status" >&5
+  echo "$as_me:1758: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:1760: \"$ac_try\"") >&5
+  { (eval echo "$as_me:1761: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:1763: \$? = $ac_status" >&5
+  echo "$as_me:1764: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
@@ -1789,13 +1790,13 @@
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-echo "$as_me:1795: checking how to run the C preprocessor" >&5
+echo "$as_me:1796: checking how to run the C preprocessor" >&5
 echo $ECHO_N "checking how to run the C preprocessor... $ECHO_C" >&6
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
 fi
 if test -z "$CPP"; then
@@ -1810,24 +1811,24 @@
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
-#line 1816 "configure"
+#line 1817 "configure"
 #include "confdefs.h"
 #include <assert.h>
                      Syntax error
 _ACEOF
-if { (eval echo "$as_me:1821: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:1822: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:1827: \$? = $ac_status" >&5
+  echo "$as_me:1828: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -1844,23 +1845,23 @@
 fi
 rm -f conftest.err conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
-#line 1850 "configure"
+#line 1851 "configure"
 #include "confdefs.h"
 #include <ac_nonexistent.h>
 _ACEOF
-if { (eval echo "$as_me:1854: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:1855: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:1860: \$? = $ac_status" >&5
+  echo "$as_me:1861: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -1891,34 +1892,34 @@
 
 fi
   CPP=$ac_cv_prog_CPP
 else
   ac_cv_prog_CPP=$CPP
 fi
-echo "$as_me:1897: result: $CPP" >&5
+echo "$as_me:1898: result: $CPP" >&5
 echo "${ECHO_T}$CPP" >&6
 ac_preproc_ok=false
 for ac_c_preproc_warn_flag in '' yes
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
-#line 1907 "configure"
+#line 1908 "configure"
 #include "confdefs.h"
 #include <assert.h>
                      Syntax error
 _ACEOF
-if { (eval echo "$as_me:1912: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:1913: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:1918: \$? = $ac_status" >&5
+  echo "$as_me:1919: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -1935,23 +1936,23 @@
 fi
 rm -f conftest.err conftest.$ac_ext
 
   # OK, works on sane cases.  Now check whether non-existent headers
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
-#line 1941 "configure"
+#line 1942 "configure"
 #include "confdefs.h"
 #include <ac_nonexistent.h>
 _ACEOF
-if { (eval echo "$as_me:1945: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:1946: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:1951: \$? = $ac_status" >&5
+  echo "$as_me:1952: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -1973,13 +1974,13 @@
 done
 # Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
 rm -f conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then
   :
 else
-  { { echo "$as_me:1979: error: C preprocessor \"$CPP\" fails sanity check" >&5
+  { { echo "$as_me:1980: error: C preprocessor \"$CPP\" fails sanity check" >&5
 echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
@@ -1996,13 +1997,13 @@
 # AIX /bin/install
 # AmigaOS /C/install, which installs bootblocks on floppy discs
 # AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
 # AFS /usr/afsws/bin/install, which mishandles nonexistent args
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
 # ./install, which can be erroneously created by make from ./install.sh.
-echo "$as_me:2002: checking for a BSD compatible install" >&5
+echo "$as_me:2003: checking for a BSD compatible install" >&5
 echo $ECHO_N "checking for a BSD compatible install... $ECHO_C" >&6
 if test -z "$INSTALL"; then
 if test "${ac_cv_path_install+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
     ac_save_IFS=$IFS; IFS=$ac_path_separator
@@ -2045,32 +2046,32 @@
     # path for INSTALL within a source directory, because that will
     # break other packages using the cache if that directory is
     # removed, or if the path is relative.
     INSTALL=$ac_install_sh
   fi
 fi
-echo "$as_me:2051: result: $INSTALL" >&5
+echo "$as_me:2052: result: $INSTALL" >&5
 echo "${ECHO_T}$INSTALL" >&6
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
 # It thinks the first close brace ends the variable substitution.
 test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
 
 test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-echo "$as_me:2062: checking for $CC option to accept ANSI C" >&5
+echo "$as_me:2063: checking for $CC option to accept ANSI C" >&5
 echo $ECHO_N "checking for $CC option to accept ANSI C... $ECHO_C" >&6
 if test "${ac_cv_prog_cc_stdc+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_prog_cc_stdc=no
 ac_save_CC=$CC
 cat >conftest.$ac_ext <<_ACEOF
-#line 2070 "configure"
+#line 2071 "configure"
 #include "confdefs.h"
 #include <stdarg.h>
 #include <stdio.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
@@ -2113,22 +2114,22 @@
 # HP-UX older versions	-Aa -D_HPUX_SOURCE
 # SVR4			-Xc -D__EXTENSIONS__
 for ac_arg in "" -qlanglvl=ansi -std1 -Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
 do
   CC="$ac_save_CC $ac_arg"
   rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2119: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2120: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2122: \$? = $ac_status" >&5
+  echo "$as_me:2123: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2125: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2126: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2128: \$? = $ac_status" >&5
+  echo "$as_me:2129: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_prog_cc_stdc=$ac_arg
 break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
@@ -2139,50 +2140,74 @@
 CC=$ac_save_CC
 
 fi
 
 case "x$ac_cv_prog_cc_stdc" in
   x|xno)
-    echo "$as_me:2145: result: none needed" >&5
+    echo "$as_me:2146: result: none needed" >&5
 echo "${ECHO_T}none needed" >&6 ;;
   *)
-    echo "$as_me:2148: result: $ac_cv_prog_cc_stdc" >&5
+    echo "$as_me:2149: result: $ac_cv_prog_cc_stdc" >&5
 echo "${ECHO_T}$ac_cv_prog_cc_stdc" >&6
     CC="$CC $ac_cv_prog_cc_stdc" ;;
 esac
 
+cat >>confdefs.h <<\EOF
+#define _GNU_SOURCE 1
+EOF
+
 if test "$xac_cv_prog_cc_stdc" = xno
 then
-	{ echo "$as_me:2155: WARNING: rsync requires an ANSI C compiler and you don't seem to have one" >&5
+	{ echo "$as_me:2160: WARNING: rsync requires an ANSI C compiler and you don't seem to have one" >&5
 echo "$as_me: WARNING: rsync requires an ANSI C compiler and you don't seem to have one" >&2;}
 fi
 
-# compile with optimisation and without debugging by default, unless
-# --debug is given.  We must decide this before testing the compiler.
+# We must decide this before testing the compiler.
+
+# Please allow this to default to yes, so that your users have more
+# chance of getting a useful stack trace if problems occur.
 
-echo "$as_me:2162: checking whether to include debugging symbols" >&5
+echo "$as_me:2169: checking whether to include debugging symbols" >&5
 echo $ECHO_N "checking whether to include debugging symbols... $ECHO_C" >&6
 # Check whether --enable-debug or --disable-debug was given.
 if test "${enable_debug+set}" = set; then
   enableval="$enable_debug"
 
 fi;
 
 if test x"$enable_debug" = x"no"
 then
-    echo "$as_me:2172: result: no" >&5
+    echo "$as_me:2179: result: no" >&5
 echo "${ECHO_T}no" >&6
     CFLAGS=${CFLAGS-"-O"}
 else
-    echo "$as_me:2176: result: yes" >&5
+    echo "$as_me:2183: result: yes" >&5
 echo "${ECHO_T}yes" >&6
     # leave CFLAGS alone; AC_PROG_CC will try to include -g if it can
         fi
 
+# Check whether --enable-profile or --disable-profile was given.
+if test "${enable_profile+set}" = set; then
+  enableval="$enable_profile"
+
+fi;
+if test x"$enable_profile" = xyes
+then
+	CFLAGS="$CFLAGS -pg"
+fi
+
+# This is needed for our included version of popt.  Kind of silly, but
+# I don't want our version too far out of sync.
 CFLAGS="$CFLAGS -DHAVE_CONFIG_H"
 
+# If GCC, turn on warnings.
+if test "x$GCC" = "xyes"
+then
+	CFLAGS="$CFLAGS -Wall -W"
+fi
+
 # Check whether --with-included-popt or --without-included-popt was given.
 if test "${with_included_popt+set}" = set; then
   withval="$with_included_popt"
 
 fi;
 
@@ -2197,13 +2222,13 @@
 cat >>confdefs.h <<EOF
 #define RSYNC_PATH "$RSYNC_PATH"
 EOF
 
 # Extract the first word of "remsh", so it can be a program name with args.
 set dummy remsh; ac_word=$2
-echo "$as_me:2203: checking for $ac_word" >&5
+echo "$as_me:2228: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_HAVE_REMSH+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$HAVE_REMSH"; then
   ac_cv_prog_HAVE_REMSH="$HAVE_REMSH" # Let the user override the test.
@@ -2212,45 +2237,45 @@
 ac_dummy="$PATH"
 for ac_dir in $ac_dummy; do
   IFS=$ac_save_IFS
   test -z "$ac_dir" && ac_dir=.
   $as_executable_p "$ac_dir/$ac_word" || continue
 ac_cv_prog_HAVE_REMSH="1"
-echo "$as_me:2218: found $ac_dir/$ac_word" >&5
+echo "$as_me:2243: found $ac_dir/$ac_word" >&5
 break
 done
 
   test -z "$ac_cv_prog_HAVE_REMSH" && ac_cv_prog_HAVE_REMSH="0"
 fi
 fi
 HAVE_REMSH=$ac_cv_prog_HAVE_REMSH
 if test -n "$HAVE_REMSH"; then
-  echo "$as_me:2227: result: $HAVE_REMSH" >&5
+  echo "$as_me:2252: result: $HAVE_REMSH" >&5
 echo "${ECHO_T}$HAVE_REMSH" >&6
 else
-  echo "$as_me:2230: result: no" >&5
+  echo "$as_me:2255: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
 cat >>confdefs.h <<EOF
 #define HAVE_REMSH $HAVE_REMSH
 EOF
 
 # arrgh. libc in the current debian stable screws up the largefile
 # stuff, getting byte range locking wrong
-echo "$as_me:2240: checking for broken largefile support" >&5
+echo "$as_me:2265: checking for broken largefile support" >&5
 echo $ECHO_N "checking for broken largefile support... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_BROKEN_LARGEFILE+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_BROKEN_LARGEFILE=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 2250 "configure"
+#line 2275 "configure"
 #include "confdefs.h"
 
 #define _FILE_OFFSET_BITS 64
 #include <stdio.h>
 #include <fcntl.h>
 #include <sys/types.h>
@@ -2276,55 +2301,55 @@
 	unlink("conftest.dat");
 	exit(WEXITSTATUS(status));
 }
 
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:2282: \"$ac_link\"") >&5
+if { (eval echo "$as_me:2307: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:2285: \$? = $ac_status" >&5
+  echo "$as_me:2310: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:2287: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2312: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2290: \$? = $ac_status" >&5
+  echo "$as_me:2315: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_BROKEN_LARGEFILE=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_BROKEN_LARGEFILE=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:2302: result: $rsync_cv_HAVE_BROKEN_LARGEFILE" >&5
+echo "$as_me:2327: result: $rsync_cv_HAVE_BROKEN_LARGEFILE" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_BROKEN_LARGEFILE" >&6
 if test x"$rsync_cv_HAVE_BROKEN_LARGEFILE" != x"yes"; then
    # Check whether --enable-largefile or --disable-largefile was given.
 if test "${enable_largefile+set}" = set; then
   enableval="$enable_largefile"
 
 fi;
 if test "$enable_largefile" != no; then
 
-  echo "$as_me:2312: checking for special C compiler options needed for large files" >&5
+  echo "$as_me:2337: checking for special C compiler options needed for large files" >&5
 echo $ECHO_N "checking for special C compiler options needed for large files... $ECHO_C" >&6
 if test "${ac_cv_sys_largefile_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_sys_largefile_CC=no
      if test "$GCC" != yes; then
        ac_save_CC=$CC
        while :; do
      	 # IRIX 6.2 and later do not support large files by default,
      	 # so use the C compiler's -n32 option if that helps.
          cat >conftest.$ac_ext <<_ACEOF
-#line 2324 "configure"
+#line 2349 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
  /* Check that off_t can represent 2**63 - 1 correctly.
     We can't simply define LARGE_OFF_T to be 9223372036854775807,
     since some C++ compilers masquerading as C compilers
     incorrectly reject 9223372036854775807.  */
@@ -2338,41 +2363,41 @@
 
   ;
   return 0;
 }
 _ACEOF
      	 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2344: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2369: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2347: \$? = $ac_status" >&5
+  echo "$as_me:2372: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2350: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2375: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2353: \$? = $ac_status" >&5
+  echo "$as_me:2378: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext
      	 CC="$CC -n32"
      	 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2363: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2388: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2366: \$? = $ac_status" >&5
+  echo "$as_me:2391: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2369: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2394: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2372: \$? = $ac_status" >&5
+  echo "$as_me:2397: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sys_largefile_CC=' -n32'; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
@@ -2380,27 +2405,27 @@
          break
        done
        CC=$ac_save_CC
        rm -f conftest.$ac_ext
     fi
 fi
-echo "$as_me:2386: result: $ac_cv_sys_largefile_CC" >&5
+echo "$as_me:2411: result: $ac_cv_sys_largefile_CC" >&5
 echo "${ECHO_T}$ac_cv_sys_largefile_CC" >&6
   if test "$ac_cv_sys_largefile_CC" != no; then
     CC=$CC$ac_cv_sys_largefile_CC
   fi
 
-  echo "$as_me:2392: checking for _FILE_OFFSET_BITS value needed for large files" >&5
+  echo "$as_me:2417: checking for _FILE_OFFSET_BITS value needed for large files" >&5
 echo $ECHO_N "checking for _FILE_OFFSET_BITS value needed for large files... $ECHO_C" >&6
 if test "${ac_cv_sys_file_offset_bits+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   while :; do
   ac_cv_sys_file_offset_bits=no
   cat >conftest.$ac_ext <<_ACEOF
-#line 2400 "configure"
+#line 2425 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
  /* Check that off_t can represent 2**63 - 1 correctly.
     We can't simply define LARGE_OFF_T to be 9223372036854775807,
     since some C++ compilers masquerading as C compilers
     incorrectly reject 9223372036854775807.  */
@@ -2414,31 +2439,31 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2420: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2445: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2423: \$? = $ac_status" >&5
+  echo "$as_me:2448: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2426: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2451: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2429: \$? = $ac_status" >&5
+  echo "$as_me:2454: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
-#line 2438 "configure"
+#line 2463 "configure"
 #include "confdefs.h"
 #define _FILE_OFFSET_BITS 64
 #include <sys/types.h>
  /* Check that off_t can represent 2**63 - 1 correctly.
     We can't simply define LARGE_OFF_T to be 9223372036854775807,
     since some C++ compilers masquerading as C compilers
@@ -2453,51 +2478,51 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2459: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2484: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2462: \$? = $ac_status" >&5
+  echo "$as_me:2487: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2465: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2490: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2468: \$? = $ac_status" >&5
+  echo "$as_me:2493: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sys_file_offset_bits=64; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   break
 done
 fi
-echo "$as_me:2479: result: $ac_cv_sys_file_offset_bits" >&5
+echo "$as_me:2504: result: $ac_cv_sys_file_offset_bits" >&5
 echo "${ECHO_T}$ac_cv_sys_file_offset_bits" >&6
 if test "$ac_cv_sys_file_offset_bits" != no; then
 
 cat >>confdefs.h <<EOF
 #define _FILE_OFFSET_BITS $ac_cv_sys_file_offset_bits
 EOF
 
 fi
 rm -f conftest*
-  echo "$as_me:2489: checking for _LARGE_FILES value needed for large files" >&5
+  echo "$as_me:2514: checking for _LARGE_FILES value needed for large files" >&5
 echo $ECHO_N "checking for _LARGE_FILES value needed for large files... $ECHO_C" >&6
 if test "${ac_cv_sys_large_files+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   while :; do
   ac_cv_sys_large_files=no
   cat >conftest.$ac_ext <<_ACEOF
-#line 2497 "configure"
+#line 2522 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
  /* Check that off_t can represent 2**63 - 1 correctly.
     We can't simply define LARGE_OFF_T to be 9223372036854775807,
     since some C++ compilers masquerading as C compilers
     incorrectly reject 9223372036854775807.  */
@@ -2511,31 +2536,31 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2517: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2542: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2520: \$? = $ac_status" >&5
+  echo "$as_me:2545: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2523: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2548: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2526: \$? = $ac_status" >&5
+  echo "$as_me:2551: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
-#line 2535 "configure"
+#line 2560 "configure"
 #include "confdefs.h"
 #define _LARGE_FILES 1
 #include <sys/types.h>
  /* Check that off_t can represent 2**63 - 1 correctly.
     We can't simply define LARGE_OFF_T to be 9223372036854775807,
     since some C++ compilers masquerading as C compilers
@@ -2550,33 +2575,33 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2556: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2581: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2559: \$? = $ac_status" >&5
+  echo "$as_me:2584: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2562: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2587: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2565: \$? = $ac_status" >&5
+  echo "$as_me:2590: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sys_large_files=1; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   break
 done
 fi
-echo "$as_me:2576: result: $ac_cv_sys_large_files" >&5
+echo "$as_me:2601: result: $ac_cv_sys_large_files" >&5
 echo "${ECHO_T}$ac_cv_sys_large_files" >&6
 if test "$ac_cv_sys_large_files" != no; then
 
 cat >>confdefs.h <<EOF
 #define _LARGE_FILES $ac_cv_sys_large_files
 EOF
@@ -2596,21 +2621,21 @@
   enableval="$enable_ipv6"
 
 fi;
 
 if test "x$enable_ipv6" != xno
 then
-	echo "$as_me:2602: checking ipv6 stack type" >&5
+	echo "$as_me:2627: checking ipv6 stack type" >&5
 echo $ECHO_N "checking ipv6 stack type... $ECHO_C" >&6
 	for i in inria kame linux-glibc linux-inet6 toshiba v6d zeta; do
 		case $i in
 		inria)
 			# http://www.kame.net/
 
 cat >conftest.$ac_ext <<_ACEOF
-#line 2610 "configure"
+#line 2635 "configure"
 #include "confdefs.h"
 
 #include <netinet/in.h>
 #ifdef IPV6_INRIA_VERSION
 yes
 #endif
@@ -2627,13 +2652,13 @@
 rm -f conftest*
 
 			;;
 		kame)
 			# http://www.kame.net/
 			cat >conftest.$ac_ext <<_ACEOF
-#line 2633 "configure"
+#line 2658 "configure"
 #include "confdefs.h"
 
 #include <netinet/in.h>
 #ifdef __KAME__
 yes
 #endif
@@ -2650,13 +2675,13 @@
 rm -f conftest*
 
 			;;
 		linux-glibc)
 			# http://www.v6.linux.or.jp/
 			cat >conftest.$ac_ext <<_ACEOF
-#line 2656 "configure"
+#line 2681 "configure"
 #include "confdefs.h"
 
 #include <features.h>
 #if defined(__GLIBC__) && __GLIBC__ >= 2 && __GLIBC_MINOR__ >= 1
 yes
 #endif
@@ -2687,13 +2712,13 @@
 
 				CFLAGS="-I/usr/inet6/include $CFLAGS"
 			fi
 			;;
 		toshiba)
 			cat >conftest.$ac_ext <<_ACEOF
-#line 2693 "configure"
+#line 2718 "configure"
 #include "confdefs.h"
 
 #include <sys/param.h>
 #ifdef _TOSHIBA_INET6
 yes
 #endif
@@ -2711,13 +2736,13 @@
 fi
 rm -f conftest*
 
 			;;
 		v6d)
 			cat >conftest.$ac_ext <<_ACEOF
-#line 2717 "configure"
+#line 2742 "configure"
 #include "confdefs.h"
 
 #include </usr/local/v6/include/sys/v6config.h>
 #ifdef __V6D__
 yes
 #endif
@@ -2735,13 +2760,13 @@
 fi
 rm -f conftest*
 
 			;;
 		zeta)
 			cat >conftest.$ac_ext <<_ACEOF
-#line 2741 "configure"
+#line 2766 "configure"
 #include "confdefs.h"
 
 #include <sys/param.h>
 #ifdef _ZETA_MINAMI_INET6
 yes
 #endif
@@ -2762,24 +2787,24 @@
 			;;
 		esac
 		if test "$ipv6type" != "unknown"; then
 			break
 		fi
 	done
-	echo "$as_me:2768: result: $ipv6type" >&5
+	echo "$as_me:2793: result: $ipv6type" >&5
 echo "${ECHO_T}$ipv6type" >&6
 
-	echo "$as_me:2771: checking for library containing getaddrinfo" >&5
+	echo "$as_me:2796: checking for library containing getaddrinfo" >&5
 echo $ECHO_N "checking for library containing getaddrinfo... $ECHO_C" >&6
 if test "${ac_cv_search_getaddrinfo+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_func_search_save_LIBS=$LIBS
 ac_cv_search_getaddrinfo=no
 cat >conftest.$ac_ext <<_ACEOF
-#line 2779 "configure"
+#line 2804 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -2792,34 +2817,34 @@
 getaddrinfo ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:2798: \"$ac_link\"") >&5
+if { (eval echo "$as_me:2823: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:2801: \$? = $ac_status" >&5
+  echo "$as_me:2826: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:2804: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2829: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2807: \$? = $ac_status" >&5
+  echo "$as_me:2832: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_search_getaddrinfo="none required"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 if test "$ac_cv_search_getaddrinfo" = no; then
   for ac_lib in inet6; do
     LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
     cat >conftest.$ac_ext <<_ACEOF
-#line 2819 "configure"
+#line 2844 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -2832,52 +2857,52 @@
 getaddrinfo ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:2838: \"$ac_link\"") >&5
+if { (eval echo "$as_me:2863: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:2841: \$? = $ac_status" >&5
+  echo "$as_me:2866: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:2844: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2869: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2847: \$? = $ac_status" >&5
+  echo "$as_me:2872: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_search_getaddrinfo="-l$ac_lib"
 break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
   done
 fi
 LIBS=$ac_func_search_save_LIBS
 fi
-echo "$as_me:2860: result: $ac_cv_search_getaddrinfo" >&5
+echo "$as_me:2885: result: $ac_cv_search_getaddrinfo" >&5
 echo "${ECHO_T}$ac_cv_search_getaddrinfo" >&6
 if test "$ac_cv_search_getaddrinfo" != no; then
   test "$ac_cv_search_getaddrinfo" = "none required" || LIBS="$ac_cv_search_getaddrinfo $LIBS"
 
 fi
 
 fi
 
-echo "$as_me:2869: checking whether byte ordering is bigendian" >&5
+echo "$as_me:2894: checking whether byte ordering is bigendian" >&5
 echo $ECHO_N "checking whether byte ordering is bigendian... $ECHO_C" >&6
 if test "${ac_cv_c_bigendian+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_c_bigendian=unknown
 # See if sys/param.h defines the BYTE_ORDER macro.
 cat >conftest.$ac_ext <<_ACEOF
-#line 2877 "configure"
+#line 2902 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
 
 int
 main ()
@@ -2888,26 +2913,26 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2894: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2919: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2897: \$? = $ac_status" >&5
+  echo "$as_me:2922: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2900: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2925: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2903: \$? = $ac_status" >&5
+  echo "$as_me:2928: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   # It does; now see whether it defined to BIG_ENDIAN or not.
 cat >conftest.$ac_ext <<_ACEOF
-#line 2907 "configure"
+#line 2932 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/param.h>
 
 int
 main ()
@@ -2918,22 +2943,22 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:2924: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:2949: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:2927: \$? = $ac_status" >&5
+  echo "$as_me:2952: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:2930: \"$ac_try\"") >&5
+  { (eval echo "$as_me:2955: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2933: \$? = $ac_status" >&5
+  echo "$as_me:2958: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_c_bigendian=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_c_bigendian=no
@@ -2943,18 +2968,18 @@
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 if test $ac_cv_c_bigendian = unknown; then
 if test "$cross_compiling" = yes; then
-  { { echo "$as_me:2949: error: cannot run test program while cross compiling" >&5
+  { { echo "$as_me:2974: error: cannot run test program while cross compiling" >&5
 echo "$as_me: error: cannot run test program while cross compiling" >&2;}
    { (exit 1); exit 1; }; }
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 2954 "configure"
+#line 2979 "configure"
 #include "confdefs.h"
 int
 main ()
 {
   /* Are we little or big endian?  From Harbison&Steele.  */
   union
@@ -2964,53 +2989,53 @@
   } u;
   u.l = 1;
   exit (u.c[sizeof (long) - 1] == 1);
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:2970: \"$ac_link\"") >&5
+if { (eval echo "$as_me:2995: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:2973: \$? = $ac_status" >&5
+  echo "$as_me:2998: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:2975: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3000: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:2978: \$? = $ac_status" >&5
+  echo "$as_me:3003: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_c_bigendian=no
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_c_bigendian=yes
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
 fi
-echo "$as_me:2991: result: $ac_cv_c_bigendian" >&5
+echo "$as_me:3016: result: $ac_cv_c_bigendian" >&5
 echo "${ECHO_T}$ac_cv_c_bigendian" >&6
 if test $ac_cv_c_bigendian = yes; then
 
 cat >>confdefs.h <<\EOF
 #define WORDS_BIGENDIAN 1
 EOF
 
 fi
 
 ac_header_dirent=no
 for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h; do
   as_ac_Header=`echo "ac_cv_header_dirent_$ac_hdr" | $as_tr_sh`
-echo "$as_me:3004: checking for $ac_hdr that defines DIR" >&5
+echo "$as_me:3029: checking for $ac_hdr that defines DIR" >&5
 echo $ECHO_N "checking for $ac_hdr that defines DIR... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3010 "configure"
+#line 3035 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <$ac_hdr>
 
 int
 main ()
@@ -3019,53 +3044,53 @@
 return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3025: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3050: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3028: \$? = $ac_status" >&5
+  echo "$as_me:3053: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3031: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3056: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3034: \$? = $ac_status" >&5
+  echo "$as_me:3059: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_Header=no"
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3044: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3069: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_hdr" | $as_tr_cpp` 1
 EOF
 
 ac_header_dirent=$ac_hdr; break
 fi
 
 done
 # Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
 if test $ac_header_dirent = dirent.h; then
-  echo "$as_me:3057: checking for opendir in -ldir" >&5
+  echo "$as_me:3082: checking for opendir in -ldir" >&5
 echo $ECHO_N "checking for opendir in -ldir... $ECHO_C" >&6
 if test "${ac_cv_lib_dir_opendir+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-ldir  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 3065 "configure"
+#line 3090 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -3078,48 +3103,48 @@
 opendir ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:3084: \"$ac_link\"") >&5
+if { (eval echo "$as_me:3109: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:3087: \$? = $ac_status" >&5
+  echo "$as_me:3112: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:3090: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3115: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3093: \$? = $ac_status" >&5
+  echo "$as_me:3118: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_dir_opendir=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_dir_opendir=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:3104: result: $ac_cv_lib_dir_opendir" >&5
+echo "$as_me:3129: result: $ac_cv_lib_dir_opendir" >&5
 echo "${ECHO_T}$ac_cv_lib_dir_opendir" >&6
 if test $ac_cv_lib_dir_opendir = yes; then
   LIBS="$LIBS -ldir"
 fi
 
 else
-  echo "$as_me:3111: checking for opendir in -lx" >&5
+  echo "$as_me:3136: checking for opendir in -lx" >&5
 echo $ECHO_N "checking for opendir in -lx... $ECHO_C" >&6
 if test "${ac_cv_lib_x_opendir+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lx  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 3119 "configure"
+#line 3144 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -3132,47 +3157,47 @@
 opendir ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:3138: \"$ac_link\"") >&5
+if { (eval echo "$as_me:3163: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:3141: \$? = $ac_status" >&5
+  echo "$as_me:3166: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:3144: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3169: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3147: \$? = $ac_status" >&5
+  echo "$as_me:3172: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_x_opendir=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_x_opendir=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:3158: result: $ac_cv_lib_x_opendir" >&5
+echo "$as_me:3183: result: $ac_cv_lib_x_opendir" >&5
 echo "${ECHO_T}$ac_cv_lib_x_opendir" >&6
 if test $ac_cv_lib_x_opendir = yes; then
   LIBS="$LIBS -lx"
 fi
 
 fi
 
-echo "$as_me:3166: checking whether time.h and sys/time.h may both be included" >&5
+echo "$as_me:3191: checking whether time.h and sys/time.h may both be included" >&5
 echo $ECHO_N "checking whether time.h and sys/time.h may both be included... $ECHO_C" >&6
 if test "${ac_cv_header_time+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3172 "configure"
+#line 3197 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/time.h>
 #include <time.h>
 
 int
@@ -3182,48 +3207,48 @@
 return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3188: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3213: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3191: \$? = $ac_status" >&5
+  echo "$as_me:3216: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3194: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3219: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3197: \$? = $ac_status" >&5
+  echo "$as_me:3222: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_header_time=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_header_time=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3207: result: $ac_cv_header_time" >&5
+echo "$as_me:3232: result: $ac_cv_header_time" >&5
 echo "${ECHO_T}$ac_cv_header_time" >&6
 if test $ac_cv_header_time = yes; then
 
 cat >>confdefs.h <<\EOF
 #define TIME_WITH_SYS_TIME 1
 EOF
 
 fi
 
-echo "$as_me:3217: checking for sys/wait.h that is POSIX.1 compatible" >&5
+echo "$as_me:3242: checking for sys/wait.h that is POSIX.1 compatible" >&5
 echo $ECHO_N "checking for sys/wait.h that is POSIX.1 compatible... $ECHO_C" >&6
 if test "${ac_cv_header_sys_wait_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3223 "configure"
+#line 3248 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/wait.h>
 #ifndef WEXITSTATUS
 # define WEXITSTATUS(stat_val) ((unsigned)(stat_val) >> 8)
 #endif
@@ -3239,61 +3264,61 @@
   s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3245: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3270: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3248: \$? = $ac_status" >&5
+  echo "$as_me:3273: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3251: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3276: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3254: \$? = $ac_status" >&5
+  echo "$as_me:3279: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_header_sys_wait_h=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_header_sys_wait_h=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3264: result: $ac_cv_header_sys_wait_h" >&5
+echo "$as_me:3289: result: $ac_cv_header_sys_wait_h" >&5
 echo "${ECHO_T}$ac_cv_header_sys_wait_h" >&6
 if test $ac_cv_header_sys_wait_h = yes; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_SYS_WAIT_H 1
 EOF
 
 fi
 
 for ac_header in sys/fcntl.h sys/select.h fcntl.h sys/time.h sys/unistd.h unistd.h utime.h grp.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3277: checking for $ac_header" >&5
+echo "$as_me:3302: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3283 "configure"
+#line 3308 "configure"
 #include "confdefs.h"
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:3287: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3312: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3293: \$? = $ac_status" >&5
+  echo "$as_me:3318: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3306,42 +3331,42 @@
   echo "$as_me: failed program was:" >&5
   cat conftest.$ac_ext >&5
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
 fi
-echo "$as_me:3312: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3337: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_header in compat.h sys/param.h ctype.h sys/wait.h sys/ioctl.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3325: checking for $ac_header" >&5
+echo "$as_me:3350: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3331 "configure"
+#line 3356 "configure"
 #include "confdefs.h"
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:3335: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3360: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3341: \$? = $ac_status" >&5
+  echo "$as_me:3366: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3354,42 +3379,42 @@
   echo "$as_me: failed program was:" >&5
   cat conftest.$ac_ext >&5
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
 fi
-echo "$as_me:3360: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3385: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_header in sys/filio.h string.h stdlib.h sys/socket.h sys/mode.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3373: checking for $ac_header" >&5
+echo "$as_me:3398: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3379 "configure"
+#line 3404 "configure"
 #include "confdefs.h"
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:3383: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3408: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3389: \$? = $ac_status" >&5
+  echo "$as_me:3414: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3402,42 +3427,42 @@
   echo "$as_me: failed program was:" >&5
   cat conftest.$ac_ext >&5
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
 fi
-echo "$as_me:3408: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3433: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_header in glob.h alloca.h mcheck.h sys/sysctl.h arpa/inet.h arpa/nameser.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3421: checking for $ac_header" >&5
+echo "$as_me:3446: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3427 "configure"
+#line 3452 "configure"
 #include "confdefs.h"
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:3431: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3456: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3437: \$? = $ac_status" >&5
+  echo "$as_me:3462: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3450,42 +3475,42 @@
   echo "$as_me: failed program was:" >&5
   cat conftest.$ac_ext >&5
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
 fi
-echo "$as_me:3456: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3481: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_header in netdb.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3469: checking for $ac_header" >&5
+echo "$as_me:3494: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3475 "configure"
+#line 3500 "configure"
 #include "confdefs.h"
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:3479: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3504: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3485: \$? = $ac_status" >&5
+  echo "$as_me:3510: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3498,43 +3523,91 @@
   echo "$as_me: failed program was:" >&5
   cat conftest.$ac_ext >&5
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
 fi
-echo "$as_me:3504: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3529: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
-echo "$as_me:3514: checking for ANSI C header files" >&5
+for ac_header in malloc.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:3542: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line 3548 "configure"
+#include "confdefs.h"
+#include <$ac_header>
+_ACEOF
+if { (eval echo "$as_me:3552: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  egrep -v '^ *\+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:3558: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_ext
+fi
+echo "$as_me:3577: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<EOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+EOF
+
+fi
+done
+
+echo "$as_me:3587: checking for ANSI C header files" >&5
 echo $ECHO_N "checking for ANSI C header files... $ECHO_C" >&6
 if test "${ac_cv_header_stdc+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3520 "configure"
+#line 3593 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
 #include <string.h>
 #include <float.h>
 
 _ACEOF
-if { (eval echo "$as_me:3528: \"$ac_cpp conftest.$ac_ext\"") >&5
+if { (eval echo "$as_me:3601: \"$ac_cpp conftest.$ac_ext\"") >&5
   (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
   egrep -v '^ *\+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
-  echo "$as_me:3534: \$? = $ac_status" >&5
+  echo "$as_me:3607: \$? = $ac_status" >&5
   (exit $ac_status); } >/dev/null; then
   if test -s conftest.err; then
     ac_cpp_err=$ac_c_preproc_warn_flag
   else
     ac_cpp_err=
   fi
@@ -3550,13 +3623,13 @@
 fi
 rm -f conftest.err conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
-#line 3556 "configure"
+#line 3629 "configure"
 #include "confdefs.h"
 #include <string.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   egrep "memchr" >/dev/null 2>&1; then
@@ -3568,13 +3641,13 @@
 
 fi
 
 if test $ac_cv_header_stdc = yes; then
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
-#line 3574 "configure"
+#line 3647 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   egrep "free" >/dev/null 2>&1; then
@@ -3589,13 +3662,13 @@
 if test $ac_cv_header_stdc = yes; then
   # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
   if test "$cross_compiling" = yes; then
   :
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3595 "configure"
+#line 3668 "configure"
 #include "confdefs.h"
 #include <ctype.h>
 #if ((' ' & 0x0FF) == 0x020)
 # define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
 # define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
 #else
@@ -3615,34 +3688,34 @@
         || toupper (i) != TOUPPER (i))
       exit(2);
   exit (0);
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:3621: \"$ac_link\"") >&5
+if { (eval echo "$as_me:3694: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:3624: \$? = $ac_status" >&5
+  echo "$as_me:3697: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:3626: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3699: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3629: \$? = $ac_status" >&5
+  echo "$as_me:3702: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   :
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_header_stdc=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
 fi
-echo "$as_me:3642: result: $ac_cv_header_stdc" >&5
+echo "$as_me:3715: result: $ac_cv_header_stdc" >&5
 echo "${ECHO_T}$ac_cv_header_stdc" >&6
 if test $ac_cv_header_stdc = yes; then
 
 cat >>confdefs.h <<\EOF
 #define STDC_HEADERS 1
 EOF
@@ -3652,60 +3725,60 @@
 # On IRIX 5.3, sys/types and inttypes.h are conflicting.
 
 for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \
                   inttypes.h stdint.h unistd.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
-echo "$as_me:3658: checking for $ac_header" >&5
+echo "$as_me:3731: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3664 "configure"
+#line 3737 "configure"
 #include "confdefs.h"
 $ac_includes_default
 #include <$ac_header>
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3670: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3743: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3673: \$? = $ac_status" >&5
+  echo "$as_me:3746: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3676: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3749: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3679: \$? = $ac_status" >&5
+  echo "$as_me:3752: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_Header=no"
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3689: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "$as_me:3762: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
-echo "$as_me:3699: checking for int" >&5
+echo "$as_me:3772: checking for int" >&5
 echo $ECHO_N "checking for int... $ECHO_C" >&6
 if test "${ac_cv_type_int+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3705 "configure"
+#line 3778 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((int *) 0)
@@ -3714,91 +3787,91 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3720: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3793: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3723: \$? = $ac_status" >&5
+  echo "$as_me:3796: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3726: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3799: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3729: \$? = $ac_status" >&5
+  echo "$as_me:3802: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_int=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_int=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3739: result: $ac_cv_type_int" >&5
+echo "$as_me:3812: result: $ac_cv_type_int" >&5
 echo "${ECHO_T}$ac_cv_type_int" >&6
 
-echo "$as_me:3742: checking size of int" >&5
+echo "$as_me:3815: checking size of int" >&5
 echo $ECHO_N "checking size of int... $ECHO_C" >&6
 if test "${ac_cv_sizeof_int+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test "$ac_cv_type_int" = yes; then
   if test "$cross_compiling" = yes; then
   # Depending upon the size, compute the lo and hi bounds.
 cat >conftest.$ac_ext <<_ACEOF
-#line 3751 "configure"
+#line 3824 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (int)) >= 0)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3763: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3836: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3766: \$? = $ac_status" >&5
+  echo "$as_me:3839: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3769: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3842: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3772: \$? = $ac_status" >&5
+  echo "$as_me:3845: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=0 ac_mid=0
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 3777 "configure"
+#line 3850 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (int)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3789: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3862: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3792: \$? = $ac_status" >&5
+  echo "$as_me:3865: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3795: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3868: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3798: \$? = $ac_status" >&5
+  echo "$as_me:3871: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`; ac_mid=`expr 2 '*' $ac_mid + 1`
@@ -3808,34 +3881,34 @@
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=-1 ac_mid=-1
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 3814 "configure"
+#line 3887 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (int)) >= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3826: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3899: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3829: \$? = $ac_status" >&5
+  echo "$as_me:3902: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3832: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3905: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3835: \$? = $ac_status" >&5
+  echo "$as_me:3908: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=`expr $ac_mid - 1`; ac_mid=`expr 2 '*' $ac_mid`
@@ -3845,52 +3918,52 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 # Binary search between lo and hi bounds.
 while test "x$ac_lo" != "x$ac_hi"; do
   ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
   cat >conftest.$ac_ext <<_ACEOF
-#line 3851 "configure"
+#line 3924 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (int)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3863: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:3936: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3866: \$? = $ac_status" >&5
+  echo "$as_me:3939: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3869: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3942: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3872: \$? = $ac_status" >&5
+  echo "$as_me:3945: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
 ac_cv_sizeof_int=$ac_lo
 else
   if test "$cross_compiling" = yes; then
-  { { echo "$as_me:3885: error: cannot run test program while cross compiling" >&5
+  { { echo "$as_me:3958: error: cannot run test program while cross compiling" >&5
 echo "$as_me: error: cannot run test program while cross compiling" >&2;}
    { (exit 1); exit 1; }; }
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3890 "configure"
+#line 3963 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 FILE *f = fopen ("conftest.val", "w");
@@ -3900,21 +3973,21 @@
 fclose (f);
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:3906: \"$ac_link\"") >&5
+if { (eval echo "$as_me:3979: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:3909: \$? = $ac_status" >&5
+  echo "$as_me:3982: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:3911: \"$ac_try\"") >&5
+  { (eval echo "$as_me:3984: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3914: \$? = $ac_status" >&5
+  echo "$as_me:3987: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sizeof_int=`cat conftest.val`
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
@@ -3924,25 +3997,25 @@
 fi
 rm -f conftest.val
 else
   ac_cv_sizeof_int=0
 fi
 fi
-echo "$as_me:3930: result: $ac_cv_sizeof_int" >&5
+echo "$as_me:4003: result: $ac_cv_sizeof_int" >&5
 echo "${ECHO_T}$ac_cv_sizeof_int" >&6
 cat >>confdefs.h <<EOF
 #define SIZEOF_INT $ac_cv_sizeof_int
 EOF
 
-echo "$as_me:3936: checking for long" >&5
+echo "$as_me:4009: checking for long" >&5
 echo $ECHO_N "checking for long... $ECHO_C" >&6
 if test "${ac_cv_type_long+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 3942 "configure"
+#line 4015 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((long *) 0)
@@ -3951,91 +4024,91 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:3957: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4030: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:3960: \$? = $ac_status" >&5
+  echo "$as_me:4033: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:3963: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4036: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:3966: \$? = $ac_status" >&5
+  echo "$as_me:4039: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_long=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_long=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:3976: result: $ac_cv_type_long" >&5
+echo "$as_me:4049: result: $ac_cv_type_long" >&5
 echo "${ECHO_T}$ac_cv_type_long" >&6
 
-echo "$as_me:3979: checking size of long" >&5
+echo "$as_me:4052: checking size of long" >&5
 echo $ECHO_N "checking size of long... $ECHO_C" >&6
 if test "${ac_cv_sizeof_long+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test "$ac_cv_type_long" = yes; then
   if test "$cross_compiling" = yes; then
   # Depending upon the size, compute the lo and hi bounds.
 cat >conftest.$ac_ext <<_ACEOF
-#line 3988 "configure"
+#line 4061 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (long)) >= 0)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4000: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4073: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4003: \$? = $ac_status" >&5
+  echo "$as_me:4076: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4006: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4079: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4009: \$? = $ac_status" >&5
+  echo "$as_me:4082: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=0 ac_mid=0
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 4014 "configure"
+#line 4087 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (long)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4026: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4099: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4029: \$? = $ac_status" >&5
+  echo "$as_me:4102: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4032: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4105: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4035: \$? = $ac_status" >&5
+  echo "$as_me:4108: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`; ac_mid=`expr 2 '*' $ac_mid + 1`
@@ -4045,34 +4118,34 @@
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=-1 ac_mid=-1
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 4051 "configure"
+#line 4124 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (long)) >= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4063: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4136: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4066: \$? = $ac_status" >&5
+  echo "$as_me:4139: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4069: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4142: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4072: \$? = $ac_status" >&5
+  echo "$as_me:4145: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=`expr $ac_mid - 1`; ac_mid=`expr 2 '*' $ac_mid`
@@ -4082,52 +4155,52 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 # Binary search between lo and hi bounds.
 while test "x$ac_lo" != "x$ac_hi"; do
   ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
   cat >conftest.$ac_ext <<_ACEOF
-#line 4088 "configure"
+#line 4161 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (long)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4100: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4173: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4103: \$? = $ac_status" >&5
+  echo "$as_me:4176: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4106: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4179: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4109: \$? = $ac_status" >&5
+  echo "$as_me:4182: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
 ac_cv_sizeof_long=$ac_lo
 else
   if test "$cross_compiling" = yes; then
-  { { echo "$as_me:4122: error: cannot run test program while cross compiling" >&5
+  { { echo "$as_me:4195: error: cannot run test program while cross compiling" >&5
 echo "$as_me: error: cannot run test program while cross compiling" >&2;}
    { (exit 1); exit 1; }; }
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4127 "configure"
+#line 4200 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 FILE *f = fopen ("conftest.val", "w");
@@ -4137,21 +4210,21 @@
 fclose (f);
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:4143: \"$ac_link\"") >&5
+if { (eval echo "$as_me:4216: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:4146: \$? = $ac_status" >&5
+  echo "$as_me:4219: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:4148: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4221: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4151: \$? = $ac_status" >&5
+  echo "$as_me:4224: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sizeof_long=`cat conftest.val`
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
@@ -4161,25 +4234,25 @@
 fi
 rm -f conftest.val
 else
   ac_cv_sizeof_long=0
 fi
 fi
-echo "$as_me:4167: result: $ac_cv_sizeof_long" >&5
+echo "$as_me:4240: result: $ac_cv_sizeof_long" >&5
 echo "${ECHO_T}$ac_cv_sizeof_long" >&6
 cat >>confdefs.h <<EOF
 #define SIZEOF_LONG $ac_cv_sizeof_long
 EOF
 
-echo "$as_me:4173: checking for short" >&5
+echo "$as_me:4246: checking for short" >&5
 echo $ECHO_N "checking for short... $ECHO_C" >&6
 if test "${ac_cv_type_short+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4179 "configure"
+#line 4252 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((short *) 0)
@@ -4188,91 +4261,91 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4194: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4267: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4197: \$? = $ac_status" >&5
+  echo "$as_me:4270: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4200: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4273: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4203: \$? = $ac_status" >&5
+  echo "$as_me:4276: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_short=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_short=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4213: result: $ac_cv_type_short" >&5
+echo "$as_me:4286: result: $ac_cv_type_short" >&5
 echo "${ECHO_T}$ac_cv_type_short" >&6
 
-echo "$as_me:4216: checking size of short" >&5
+echo "$as_me:4289: checking size of short" >&5
 echo $ECHO_N "checking size of short... $ECHO_C" >&6
 if test "${ac_cv_sizeof_short+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test "$ac_cv_type_short" = yes; then
   if test "$cross_compiling" = yes; then
   # Depending upon the size, compute the lo and hi bounds.
 cat >conftest.$ac_ext <<_ACEOF
-#line 4225 "configure"
+#line 4298 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (short)) >= 0)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4237: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4310: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4240: \$? = $ac_status" >&5
+  echo "$as_me:4313: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4243: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4316: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4246: \$? = $ac_status" >&5
+  echo "$as_me:4319: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=0 ac_mid=0
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 4251 "configure"
+#line 4324 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (short)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4263: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4336: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4266: \$? = $ac_status" >&5
+  echo "$as_me:4339: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4269: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4342: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4272: \$? = $ac_status" >&5
+  echo "$as_me:4345: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`; ac_mid=`expr 2 '*' $ac_mid + 1`
@@ -4282,34 +4355,34 @@
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=-1 ac_mid=-1
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
-#line 4288 "configure"
+#line 4361 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (short)) >= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4300: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4373: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4303: \$? = $ac_status" >&5
+  echo "$as_me:4376: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4306: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4379: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4309: \$? = $ac_status" >&5
+  echo "$as_me:4382: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_lo=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_hi=`expr $ac_mid - 1`; ac_mid=`expr 2 '*' $ac_mid`
@@ -4319,52 +4392,52 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 # Binary search between lo and hi bounds.
 while test "x$ac_lo" != "x$ac_hi"; do
   ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
   cat >conftest.$ac_ext <<_ACEOF
-#line 4325 "configure"
+#line 4398 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 int _array_ [1 - 2 * !((sizeof (short)) <= $ac_mid)]
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4337: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4410: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4340: \$? = $ac_status" >&5
+  echo "$as_me:4413: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4343: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4416: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4346: \$? = $ac_status" >&5
+  echo "$as_me:4419: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_hi=$ac_mid
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
 ac_cv_sizeof_short=$ac_lo
 else
   if test "$cross_compiling" = yes; then
-  { { echo "$as_me:4359: error: cannot run test program while cross compiling" >&5
+  { { echo "$as_me:4432: error: cannot run test program while cross compiling" >&5
 echo "$as_me: error: cannot run test program while cross compiling" >&2;}
    { (exit 1); exit 1; }; }
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4364 "configure"
+#line 4437 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 FILE *f = fopen ("conftest.val", "w");
@@ -4374,21 +4447,21 @@
 fclose (f);
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:4380: \"$ac_link\"") >&5
+if { (eval echo "$as_me:4453: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:4383: \$? = $ac_status" >&5
+  echo "$as_me:4456: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:4385: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4458: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4388: \$? = $ac_status" >&5
+  echo "$as_me:4461: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_sizeof_short=`cat conftest.val`
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
@@ -4398,56 +4471,56 @@
 fi
 rm -f conftest.val
 else
   ac_cv_sizeof_short=0
 fi
 fi
-echo "$as_me:4404: result: $ac_cv_sizeof_short" >&5
+echo "$as_me:4477: result: $ac_cv_sizeof_short" >&5
 echo "${ECHO_T}$ac_cv_sizeof_short" >&6
 cat >>confdefs.h <<EOF
 #define SIZEOF_SHORT $ac_cv_sizeof_short
 EOF
 
-echo "$as_me:4410: checking for inline" >&5
+echo "$as_me:4483: checking for inline" >&5
 echo $ECHO_N "checking for inline... $ECHO_C" >&6
 if test "${ac_cv_c_inline+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_c_inline=no
 for ac_kw in inline __inline__ __inline; do
   cat >conftest.$ac_ext <<_ACEOF
-#line 4418 "configure"
+#line 4491 "configure"
 #include "confdefs.h"
 #ifndef __cplusplus
 static $ac_kw int static_foo () {return 0; }
 $ac_kw int foo () {return 0; }
 #endif
 
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4427: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4500: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4430: \$? = $ac_status" >&5
+  echo "$as_me:4503: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4433: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4506: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4436: \$? = $ac_status" >&5
+  echo "$as_me:4509: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_c_inline=$ac_kw; break
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
 
 fi
-echo "$as_me:4447: result: $ac_cv_c_inline" >&5
+echo "$as_me:4520: result: $ac_cv_c_inline" >&5
 echo "${ECHO_T}$ac_cv_c_inline" >&6
 case $ac_cv_c_inline in
   inline | yes) ;;
   no)
 cat >>confdefs.h <<\EOF
 #define inline
@@ -4456,19 +4529,19 @@
   *)  cat >>confdefs.h <<EOF
 #define inline $ac_cv_c_inline
 EOF
  ;;
 esac
 
-echo "$as_me:4462: checking return type of signal handlers" >&5
+echo "$as_me:4535: checking return type of signal handlers" >&5
 echo $ECHO_N "checking return type of signal handlers... $ECHO_C" >&6
 if test "${ac_cv_type_signal+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4468 "configure"
+#line 4541 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <signal.h>
 #ifdef signal
 # undef signal
 #endif
@@ -4484,45 +4557,45 @@
 int i;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4490: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4563: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4493: \$? = $ac_status" >&5
+  echo "$as_me:4566: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4496: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4569: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4499: \$? = $ac_status" >&5
+  echo "$as_me:4572: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_signal=void
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_signal=int
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4509: result: $ac_cv_type_signal" >&5
+echo "$as_me:4582: result: $ac_cv_type_signal" >&5
 echo "${ECHO_T}$ac_cv_type_signal" >&6
 
 cat >>confdefs.h <<EOF
 #define RETSIGTYPE $ac_cv_type_signal
 EOF
 
-echo "$as_me:4516: checking for uid_t in sys/types.h" >&5
+echo "$as_me:4589: checking for uid_t in sys/types.h" >&5
 echo $ECHO_N "checking for uid_t in sys/types.h... $ECHO_C" >&6
 if test "${ac_cv_type_uid_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4522 "configure"
+#line 4595 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   egrep "uid_t" >/dev/null 2>&1; then
@@ -4530,13 +4603,13 @@
 else
   ac_cv_type_uid_t=no
 fi
 rm -f conftest*
 
 fi
-echo "$as_me:4536: result: $ac_cv_type_uid_t" >&5
+echo "$as_me:4609: result: $ac_cv_type_uid_t" >&5
 echo "${ECHO_T}$ac_cv_type_uid_t" >&6
 if test $ac_cv_type_uid_t = no; then
 
 cat >>confdefs.h <<\EOF
 #define uid_t int
 EOF
@@ -4544,19 +4617,19 @@
 cat >>confdefs.h <<\EOF
 #define gid_t int
 EOF
 
 fi
 
-echo "$as_me:4550: checking for mode_t" >&5
+echo "$as_me:4623: checking for mode_t" >&5
 echo $ECHO_N "checking for mode_t... $ECHO_C" >&6
 if test "${ac_cv_type_mode_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4556 "configure"
+#line 4629 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((mode_t *) 0)
@@ -4565,50 +4638,50 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4571: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4644: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4574: \$? = $ac_status" >&5
+  echo "$as_me:4647: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4577: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4650: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4580: \$? = $ac_status" >&5
+  echo "$as_me:4653: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_mode_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_mode_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4590: result: $ac_cv_type_mode_t" >&5
+echo "$as_me:4663: result: $ac_cv_type_mode_t" >&5
 echo "${ECHO_T}$ac_cv_type_mode_t" >&6
 if test $ac_cv_type_mode_t = yes; then
   :
 else
 
 cat >>confdefs.h <<EOF
 #define mode_t int
 EOF
 
 fi
 
-echo "$as_me:4602: checking for off_t" >&5
+echo "$as_me:4675: checking for off_t" >&5
 echo $ECHO_N "checking for off_t... $ECHO_C" >&6
 if test "${ac_cv_type_off_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4608 "configure"
+#line 4681 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((off_t *) 0)
@@ -4617,50 +4690,50 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4623: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4696: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4626: \$? = $ac_status" >&5
+  echo "$as_me:4699: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4629: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4702: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4632: \$? = $ac_status" >&5
+  echo "$as_me:4705: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_off_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_off_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4642: result: $ac_cv_type_off_t" >&5
+echo "$as_me:4715: result: $ac_cv_type_off_t" >&5
 echo "${ECHO_T}$ac_cv_type_off_t" >&6
 if test $ac_cv_type_off_t = yes; then
   :
 else
 
 cat >>confdefs.h <<EOF
 #define off_t long
 EOF
 
 fi
 
-echo "$as_me:4654: checking for size_t" >&5
+echo "$as_me:4727: checking for size_t" >&5
 echo $ECHO_N "checking for size_t... $ECHO_C" >&6
 if test "${ac_cv_type_size_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4660 "configure"
+#line 4733 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((size_t *) 0)
@@ -4669,50 +4742,50 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4675: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4748: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4678: \$? = $ac_status" >&5
+  echo "$as_me:4751: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4681: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4754: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4684: \$? = $ac_status" >&5
+  echo "$as_me:4757: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_size_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_size_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4694: result: $ac_cv_type_size_t" >&5
+echo "$as_me:4767: result: $ac_cv_type_size_t" >&5
 echo "${ECHO_T}$ac_cv_type_size_t" >&6
 if test $ac_cv_type_size_t = yes; then
   :
 else
 
 cat >>confdefs.h <<EOF
 #define size_t unsigned
 EOF
 
 fi
 
-echo "$as_me:4706: checking for pid_t" >&5
+echo "$as_me:4779: checking for pid_t" >&5
 echo $ECHO_N "checking for pid_t... $ECHO_C" >&6
 if test "${ac_cv_type_pid_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4712 "configure"
+#line 4785 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((pid_t *) 0)
@@ -4721,53 +4794,53 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4727: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4800: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4730: \$? = $ac_status" >&5
+  echo "$as_me:4803: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4733: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4806: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4736: \$? = $ac_status" >&5
+  echo "$as_me:4809: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_pid_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_pid_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4746: result: $ac_cv_type_pid_t" >&5
+echo "$as_me:4819: result: $ac_cv_type_pid_t" >&5
 echo "${ECHO_T}$ac_cv_type_pid_t" >&6
 if test $ac_cv_type_pid_t = yes; then
   :
 else
 
 cat >>confdefs.h <<EOF
 #define pid_t int
 EOF
 
 fi
 
-echo "$as_me:4758: checking type of array argument to getgroups" >&5
+echo "$as_me:4831: checking type of array argument to getgroups" >&5
 echo $ECHO_N "checking type of array argument to getgroups... $ECHO_C" >&6
 if test "${ac_cv_type_getgroups+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test "$cross_compiling" = yes; then
   ac_cv_type_getgroups=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4767 "configure"
+#line 4840 "configure"
 #include "confdefs.h"
 /* Thanks to Mike Rendell for this test.  */
 #include <sys/types.h>
 #define NGID 256
 #undef MAX
 #define MAX(x, y) ((x) > (y) ? (x) : (y))
@@ -4787,34 +4860,34 @@
   /* Exit non-zero if getgroups seems to require an array of ints.  This
      happens when gid_t is short but getgroups modifies an array of ints.  */
   exit ((n > 0 && gidset[n] != val.gval) ? 1 : 0);
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:4793: \"$ac_link\"") >&5
+if { (eval echo "$as_me:4866: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:4796: \$? = $ac_status" >&5
+  echo "$as_me:4869: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:4798: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4871: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4801: \$? = $ac_status" >&5
+  echo "$as_me:4874: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_getgroups=gid_t
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_getgroups=int
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 if test $ac_cv_type_getgroups = cross; then
         cat >conftest.$ac_ext <<_ACEOF
-#line 4814 "configure"
+#line 4887 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 
 _ACEOF
 if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
   egrep "getgroups.*int.*gid_t" >/dev/null 2>&1; then
@@ -4823,26 +4896,26 @@
   ac_cv_type_getgroups=int
 fi
 rm -f conftest*
 
 fi
 fi
-echo "$as_me:4829: result: $ac_cv_type_getgroups" >&5
+echo "$as_me:4902: result: $ac_cv_type_getgroups" >&5
 echo "${ECHO_T}$ac_cv_type_getgroups" >&6
 
 cat >>confdefs.h <<EOF
 #define GETGROUPS_T $ac_cv_type_getgroups
 EOF
 
-echo "$as_me:4836: checking for struct stat.st_rdev" >&5
+echo "$as_me:4909: checking for struct stat.st_rdev" >&5
 echo $ECHO_N "checking for struct stat.st_rdev... $ECHO_C" >&6
 if test "${ac_cv_member_struct_stat_st_rdev+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4842 "configure"
+#line 4915 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 static struct stat ac_aggr;
@@ -4850,48 +4923,48 @@
 return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4856: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4929: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4859: \$? = $ac_status" >&5
+  echo "$as_me:4932: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4862: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4935: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4865: \$? = $ac_status" >&5
+  echo "$as_me:4938: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_member_struct_stat_st_rdev=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_member_struct_stat_st_rdev=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4875: result: $ac_cv_member_struct_stat_st_rdev" >&5
+echo "$as_me:4948: result: $ac_cv_member_struct_stat_st_rdev" >&5
 echo "${ECHO_T}$ac_cv_member_struct_stat_st_rdev" >&6
 if test $ac_cv_member_struct_stat_st_rdev = yes; then
 
 cat >>confdefs.h <<EOF
 #define HAVE_STRUCT_STAT_ST_RDEV 1
 EOF
 
 fi
 
-echo "$as_me:4885: checking for ino_t" >&5
+echo "$as_me:4958: checking for ino_t" >&5
 echo $ECHO_N "checking for ino_t... $ECHO_C" >&6
 if test "${ac_cv_type_ino_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4891 "configure"
+#line 4964 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 if ((ino_t *) 0)
@@ -4900,50 +4973,50 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4906: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:4979: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4909: \$? = $ac_status" >&5
+  echo "$as_me:4982: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4912: \"$ac_try\"") >&5
+  { (eval echo "$as_me:4985: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4915: \$? = $ac_status" >&5
+  echo "$as_me:4988: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_ino_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_ino_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4925: result: $ac_cv_type_ino_t" >&5
+echo "$as_me:4998: result: $ac_cv_type_ino_t" >&5
 echo "${ECHO_T}$ac_cv_type_ino_t" >&6
 if test $ac_cv_type_ino_t = yes; then
   :
 else
 
 cat >>confdefs.h <<EOF
 #define ino_t unsigned
 EOF
 
 fi
 
-   echo "$as_me:4937: checking for socklen_t" >&5
+   echo "$as_me:5010: checking for socklen_t" >&5
 echo $ECHO_N "checking for socklen_t... $ECHO_C" >&6
 if test "${ac_cv_type_socklen_t+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 4943 "configure"
+#line 5016 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/socket.h>
 
 int
 main ()
@@ -4954,50 +5027,50 @@
   return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:4960: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:5033: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:4963: \$? = $ac_status" >&5
+  echo "$as_me:5036: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:4966: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5039: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:4969: \$? = $ac_status" >&5
+  echo "$as_me:5042: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_type_socklen_t=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_type_socklen_t=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:4979: result: $ac_cv_type_socklen_t" >&5
+echo "$as_me:5052: result: $ac_cv_type_socklen_t" >&5
 echo "${ECHO_T}$ac_cv_type_socklen_t" >&6
 if test $ac_cv_type_socklen_t = yes; then
   :
 else
 
-      echo "$as_me:4985: checking for socklen_t equivalent" >&5
+      echo "$as_me:5058: checking for socklen_t equivalent" >&5
 echo $ECHO_N "checking for socklen_t equivalent... $ECHO_C" >&6
       if test "${rsync_cv_socklen_t_equiv+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
          # Systems have either "struct sockaddr *" or
          # "void *" as the second argument to getpeername
          rsync_cv_socklen_t_equiv=
          for arg2 in "struct sockaddr" void; do
             for t in int size_t unsigned long "unsigned long"; do
                cat >conftest.$ac_ext <<_ACEOF
-#line 4997 "configure"
+#line 5070 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
 #include <sys/socket.h>
 
                   int getpeername (int, $arg2 *, $t *);
@@ -5011,22 +5084,22 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:5017: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:5090: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:5020: \$? = $ac_status" >&5
+  echo "$as_me:5093: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:5023: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5096: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5026: \$? = $ac_status" >&5
+  echo "$as_me:5099: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
                   rsync_cv_socklen_t_equiv="$t"
                   break
 
 else
@@ -5035,67 +5108,67 @@
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
             done
          done
 
          if test "x$rsync_cv_socklen_t_equiv" = x; then
-            { { echo "$as_me:5041: error: Cannot find a type to use in place of socklen_t" >&5
+            { { echo "$as_me:5114: error: Cannot find a type to use in place of socklen_t" >&5
 echo "$as_me: error: Cannot find a type to use in place of socklen_t" >&2;}
    { (exit 1); exit 1; }; }
          fi
 
 fi
 
-      echo "$as_me:5048: result: $rsync_cv_socklen_t_equiv" >&5
+      echo "$as_me:5121: result: $rsync_cv_socklen_t_equiv" >&5
 echo "${ECHO_T}$rsync_cv_socklen_t_equiv" >&6
 
 cat >>confdefs.h <<EOF
 #define socklen_t $rsync_cv_socklen_t_equiv
 EOF
 
 fi
 
-echo "$as_me:5057: checking for errno in errno.h" >&5
+echo "$as_me:5130: checking for errno in errno.h" >&5
 echo $ECHO_N "checking for errno in errno.h... $ECHO_C" >&6
 if test "${rsync_cv_errno+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
     cat >conftest.$ac_ext <<_ACEOF
-#line 5064 "configure"
+#line 5137 "configure"
 #include "confdefs.h"
 #include <errno.h>
 int
 main ()
 {
 int i = errno
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:5076: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:5149: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:5079: \$? = $ac_status" >&5
+  echo "$as_me:5152: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:5082: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5155: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5085: \$? = $ac_status" >&5
+  echo "$as_me:5158: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_errno=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_have_errno_decl=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:5095: result: $rsync_cv_errno" >&5
+echo "$as_me:5168: result: $rsync_cv_errno" >&5
 echo "${ECHO_T}$rsync_cv_errno" >&6
 if test x"$rsync_cv_errno" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_ERRNO_DECL 1
 EOF
@@ -5111,19 +5184,19 @@
 # only looks in /etc/hosts), so we only look for -lsocket if we need
 # it.
 
 for ac_func in connect
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5117: checking for $ac_func" >&5
+echo "$as_me:5190: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5123 "configure"
+#line 5196 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5148,32 +5221,32 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5154: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5227: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5157: \$? = $ac_status" >&5
+  echo "$as_me:5230: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5160: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5233: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5163: \$? = $ac_status" >&5
+  echo "$as_me:5236: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5173: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:5246: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
@@ -5181,21 +5254,21 @@
 done
 
 if test x"$ac_cv_func_connect" = x"no"; then
     case "$LIBS" in
     *-lnsl*) ;;
     *)
-echo "$as_me:5187: checking for printf in -lnsl_s" >&5
+echo "$as_me:5260: checking for printf in -lnsl_s" >&5
 echo $ECHO_N "checking for printf in -lnsl_s... $ECHO_C" >&6
 if test "${ac_cv_lib_nsl_s_printf+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lnsl_s  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5195 "configure"
+#line 5268 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5208,33 +5281,33 @@
 printf ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5214: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5287: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5217: \$? = $ac_status" >&5
+  echo "$as_me:5290: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5220: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5293: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5223: \$? = $ac_status" >&5
+  echo "$as_me:5296: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_nsl_s_printf=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_nsl_s_printf=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:5234: result: $ac_cv_lib_nsl_s_printf" >&5
+echo "$as_me:5307: result: $ac_cv_lib_nsl_s_printf" >&5
 echo "${ECHO_T}$ac_cv_lib_nsl_s_printf" >&6
 if test $ac_cv_lib_nsl_s_printf = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBNSL_S 1
 EOF
 
@@ -5243,21 +5316,21 @@
 fi
  ;;
     esac
     case "$LIBS" in
     *-lnsl*) ;;
     *)
-echo "$as_me:5249: checking for printf in -lnsl" >&5
+echo "$as_me:5322: checking for printf in -lnsl" >&5
 echo $ECHO_N "checking for printf in -lnsl... $ECHO_C" >&6
 if test "${ac_cv_lib_nsl_printf+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lnsl  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5257 "configure"
+#line 5330 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5270,33 +5343,33 @@
 printf ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5276: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5349: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5279: \$? = $ac_status" >&5
+  echo "$as_me:5352: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5282: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5355: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5285: \$? = $ac_status" >&5
+  echo "$as_me:5358: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_nsl_printf=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_nsl_printf=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:5296: result: $ac_cv_lib_nsl_printf" >&5
+echo "$as_me:5369: result: $ac_cv_lib_nsl_printf" >&5
 echo "${ECHO_T}$ac_cv_lib_nsl_printf" >&6
 if test $ac_cv_lib_nsl_printf = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBNSL 1
 EOF
 
@@ -5305,21 +5378,21 @@
 fi
  ;;
     esac
     case "$LIBS" in
     *-lsocket*) ;;
     *)
-echo "$as_me:5311: checking for connect in -lsocket" >&5
+echo "$as_me:5384: checking for connect in -lsocket" >&5
 echo $ECHO_N "checking for connect in -lsocket... $ECHO_C" >&6
 if test "${ac_cv_lib_socket_connect+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lsocket  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5319 "configure"
+#line 5392 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5332,33 +5405,33 @@
 connect ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5338: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5411: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5341: \$? = $ac_status" >&5
+  echo "$as_me:5414: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5344: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5417: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5347: \$? = $ac_status" >&5
+  echo "$as_me:5420: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_socket_connect=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_socket_connect=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:5358: result: $ac_cv_lib_socket_connect" >&5
+echo "$as_me:5431: result: $ac_cv_lib_socket_connect" >&5
 echo "${ECHO_T}$ac_cv_lib_socket_connect" >&6
 if test $ac_cv_lib_socket_connect = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBSOCKET 1
 EOF
 
@@ -5367,21 +5440,21 @@
 fi
  ;;
     esac
     case "$LIBS" in
     *-linet*) ;;
     *)
-echo "$as_me:5373: checking for connect in -linet" >&5
+echo "$as_me:5446: checking for connect in -linet" >&5
 echo $ECHO_N "checking for connect in -linet... $ECHO_C" >&6
 if test "${ac_cv_lib_inet_connect+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-linet  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5381 "configure"
+#line 5454 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5394,33 +5467,33 @@
 connect ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5400: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5473: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5403: \$? = $ac_status" >&5
+  echo "$as_me:5476: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5406: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5479: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5409: \$? = $ac_status" >&5
+  echo "$as_me:5482: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_inet_connect=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_inet_connect=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:5420: result: $ac_cv_lib_inet_connect" >&5
+echo "$as_me:5493: result: $ac_cv_lib_inet_connect" >&5
 echo "${ECHO_T}$ac_cv_lib_inet_connect" >&6
 if test $ac_cv_lib_inet_connect = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBINET 1
 EOF
 
@@ -5438,21 +5511,21 @@
 #define HAVE_CONNECT 1
 EOF
 
     fi
 fi
 
-echo "$as_me:5444: checking for inet_ntop in -lresolv" >&5
+echo "$as_me:5517: checking for inet_ntop in -lresolv" >&5
 echo $ECHO_N "checking for inet_ntop in -lresolv... $ECHO_C" >&6
 if test "${ac_cv_lib_resolv_inet_ntop+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lresolv  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5452 "configure"
+#line 5525 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5465,56 +5538,53 @@
 inet_ntop ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5471: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5544: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5474: \$? = $ac_status" >&5
+  echo "$as_me:5547: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5477: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5550: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5480: \$? = $ac_status" >&5
+  echo "$as_me:5553: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_resolv_inet_ntop=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_resolv_inet_ntop=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:5491: result: $ac_cv_lib_resolv_inet_ntop" >&5
+echo "$as_me:5564: result: $ac_cv_lib_resolv_inet_ntop" >&5
 echo "${ECHO_T}$ac_cv_lib_resolv_inet_ntop" >&6
 if test $ac_cv_lib_resolv_inet_ntop = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBRESOLV 1
 EOF
 
   LIBS="-lresolv $LIBS"
 
 fi
 
-{ echo "$as_me:5502: Looking in libraries: $LIBS" >&5
-echo "$as_me: Looking in libraries: $LIBS" >&6;}
-
 for ac_func in inet_ntop
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5508: checking for $ac_func" >&5
+echo "$as_me:5578: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5514 "configure"
+#line 5584 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5539,32 +5609,32 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5545: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5615: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5548: \$? = $ac_status" >&5
+  echo "$as_me:5618: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5551: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5621: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5554: \$? = $ac_status" >&5
+  echo "$as_me:5624: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5564: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:5634: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
@@ -5573,19 +5643,19 @@
 fi
 done
 
 for ac_func in inet_pton
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5579: checking for $ac_func" >&5
+echo "$as_me:5649: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5585 "configure"
+#line 5655 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5610,32 +5680,32 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5616: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5686: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5619: \$? = $ac_status" >&5
+  echo "$as_me:5689: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5622: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5692: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5625: \$? = $ac_status" >&5
+  echo "$as_me:5695: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5635: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:5705: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
@@ -5644,19 +5714,19 @@
 fi
 done
 
 for ac_func in getaddrinfo
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5650: checking for $ac_func" >&5
+echo "$as_me:5720: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5656 "configure"
+#line 5726 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5681,32 +5751,32 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5687: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5757: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5690: \$? = $ac_status" >&5
+  echo "$as_me:5760: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5693: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5763: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5696: \$? = $ac_status" >&5
+  echo "$as_me:5766: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5706: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:5776: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
@@ -5715,19 +5785,19 @@
 fi
 done
 
 for ac_func in getnameinfo
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5721: checking for $ac_func" >&5
+echo "$as_me:5791: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5727 "configure"
+#line 5797 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5752,50 +5822,50 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5758: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5828: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5761: \$? = $ac_status" >&5
+  echo "$as_me:5831: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5764: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5834: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5767: \$? = $ac_status" >&5
+  echo "$as_me:5837: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5777: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:5847: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 else
   LIBOBJS="$LIBOBJS lib/getnameinfo.$ac_objext"
 fi
 done
 
-echo "$as_me:5789: checking for struct sockaddr.sa_len" >&5
+echo "$as_me:5859: checking for struct sockaddr.sa_len" >&5
 echo $ECHO_N "checking for struct sockaddr.sa_len... $ECHO_C" >&6
 if test "${ac_cv_member_struct_sockaddr_sa_len+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5795 "configure"
+#line 5865 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
 #include <sys/socket.h>
 
 int
@@ -5806,95 +5876,95 @@
 return 0;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:5812: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:5882: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:5815: \$? = $ac_status" >&5
+  echo "$as_me:5885: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:5818: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5888: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5821: \$? = $ac_status" >&5
+  echo "$as_me:5891: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_member_struct_sockaddr_sa_len=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_member_struct_sockaddr_sa_len=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:5831: result: $ac_cv_member_struct_sockaddr_sa_len" >&5
+echo "$as_me:5901: result: $ac_cv_member_struct_sockaddr_sa_len" >&5
 echo "${ECHO_T}$ac_cv_member_struct_sockaddr_sa_len" >&6
 if test $ac_cv_member_struct_sockaddr_sa_len = yes; then
    cat >>confdefs.h <<\EOF
 #define HAVE_SOCKADDR_LEN 1
 EOF
 
 fi
 
-echo "$as_me:5840: checking struct sockaddr_storage" >&5
+echo "$as_me:5910: checking struct sockaddr_storage" >&5
 echo $ECHO_N "checking struct sockaddr_storage... $ECHO_C" >&6
 cat >conftest.$ac_ext <<_ACEOF
-#line 5843 "configure"
+#line 5913 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <sys/socket.h>
 int
 main ()
 {
 struct sockaddr_storage x;
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:5856: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:5926: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:5859: \$? = $ac_status" >&5
+  echo "$as_me:5929: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:5862: \"$ac_try\"") >&5
+  { (eval echo "$as_me:5932: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5865: \$? = $ac_status" >&5
+  echo "$as_me:5935: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  echo "$as_me:5867: result: yes" >&5
+  echo "$as_me:5937: result: yes" >&5
 echo "${ECHO_T}yes" >&6
 
 cat >>confdefs.h <<\EOF
 #define HAVE_SOCKADDR_STORAGE 1
 EOF
 
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
-echo "$as_me:5877: result: no" >&5
+echo "$as_me:5947: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 
 # if we can't find strcasecmp, look in -lresolv (for Unixware at least)
 #
 
 for ac_func in strcasecmp
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:5888: checking for $ac_func" >&5
+echo "$as_me:5958: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 5894 "configure"
+#line 5964 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -5919,52 +5989,52 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5925: \"$ac_link\"") >&5
+if { (eval echo "$as_me:5995: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5928: \$? = $ac_status" >&5
+  echo "$as_me:5998: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5931: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6001: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5934: \$? = $ac_status" >&5
+  echo "$as_me:6004: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:5944: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:6014: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 if test x"$ac_cv_func_strcasecmp" = x"no"; then
 
-echo "$as_me:5956: checking for strcasecmp in -lresolv" >&5
+echo "$as_me:6026: checking for strcasecmp in -lresolv" >&5
 echo $ECHO_N "checking for strcasecmp in -lresolv... $ECHO_C" >&6
 if test "${ac_cv_lib_resolv_strcasecmp+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lresolv  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 5964 "configure"
+#line 6034 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -5977,57 +6047,57 @@
 strcasecmp ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:5983: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6053: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:5986: \$? = $ac_status" >&5
+  echo "$as_me:6056: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:5989: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6059: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:5992: \$? = $ac_status" >&5
+  echo "$as_me:6062: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_resolv_strcasecmp=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_resolv_strcasecmp=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:6003: result: $ac_cv_lib_resolv_strcasecmp" >&5
+echo "$as_me:6073: result: $ac_cv_lib_resolv_strcasecmp" >&5
 echo "${ECHO_T}$ac_cv_lib_resolv_strcasecmp" >&6
 if test $ac_cv_lib_resolv_strcasecmp = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBRESOLV 1
 EOF
 
   LIBS="-lresolv $LIBS"
 
 fi
 
 fi
 
-echo "$as_me:6016: checking whether utime accepts a null argument" >&5
+echo "$as_me:6086: checking whether utime accepts a null argument" >&5
 echo $ECHO_N "checking whether utime accepts a null argument... $ECHO_C" >&6
 if test "${ac_cv_func_utime_null+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   rm -f conftest.data; >conftest.data
 # Sequent interprets utime(file, 0) to mean use start of epoch.  Wrong.
 if test "$cross_compiling" = yes; then
   ac_cv_func_utime_null=no
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6027 "configure"
+#line 6097 "configure"
 #include "confdefs.h"
 $ac_includes_default
 int
 main ()
 {
 struct stat s, t;
@@ -6038,34 +6108,34 @@
           && t.st_mtime - s.st_mtime < 120));
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6044: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6114: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6047: \$? = $ac_status" >&5
+  echo "$as_me:6117: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6049: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6119: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6052: \$? = $ac_status" >&5
+  echo "$as_me:6122: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_func_utime_null=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_func_utime_null=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 rm -f core core.* *.core
 fi
-echo "$as_me:6065: result: $ac_cv_func_utime_null" >&5
+echo "$as_me:6135: result: $ac_cv_func_utime_null" >&5
 echo "${ECHO_T}$ac_cv_func_utime_null" >&6
 if test $ac_cv_func_utime_null = yes; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_UTIME_NULL 1
 EOF
@@ -6073,19 +6143,19 @@
 fi
 rm -f conftest.data
 
 for ac_func in waitpid wait4 getcwd strdup strerror chown chmod mknod
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:6079: checking for $ac_func" >&5
+echo "$as_me:6149: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6085 "configure"
+#line 6155 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -6110,51 +6180,51 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:6116: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6186: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6119: \$? = $ac_status" >&5
+  echo "$as_me:6189: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:6122: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6192: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6125: \$? = $ac_status" >&5
+  echo "$as_me:6195: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:6135: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:6205: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_func in fchmod fstat strchr readlink link utime utimes strftime
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:6148: checking for $ac_func" >&5
+echo "$as_me:6218: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6154 "configure"
+#line 6224 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -6179,51 +6249,51 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:6185: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6255: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6188: \$? = $ac_status" >&5
+  echo "$as_me:6258: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:6191: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6261: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6194: \$? = $ac_status" >&5
+  echo "$as_me:6264: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:6204: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:6274: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
 for ac_func in memmove lchown vsnprintf snprintf asprintf setsid glob strpbrk
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:6217: checking for $ac_func" >&5
+echo "$as_me:6287: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6223 "configure"
+#line 6293 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -6248,51 +6318,51 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:6254: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6324: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6257: \$? = $ac_status" >&5
+  echo "$as_me:6327: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:6260: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6330: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6263: \$? = $ac_status" >&5
+  echo "$as_me:6333: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:6273: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:6343: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
-for ac_func in strlcat strlcpy mtrace
+for ac_func in strlcat strlcpy mtrace mallinfo
 do
 as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
-echo "$as_me:6286: checking for $ac_func" >&5
+echo "$as_me:6356: checking for $ac_func" >&5
 echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
 if eval "test \"\${$as_ac_var+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6292 "configure"
+#line 6362 "configure"
 #include "confdefs.h"
 /* System header to define __stub macros and hopefully few prototypes,
     which can conflict with char $ac_func (); below.  */
 #include <assert.h>
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -6317,152 +6387,152 @@
 
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:6323: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6393: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6326: \$? = $ac_status" >&5
+  echo "$as_me:6396: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:6329: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6399: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6332: \$? = $ac_status" >&5
+  echo "$as_me:6402: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "$as_ac_var=yes"
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 eval "$as_ac_var=no"
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 fi
-echo "$as_me:6342: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "$as_me:6412: result: `eval echo '${'$as_ac_var'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
 if test `eval echo '${'$as_ac_var'}'` = yes; then
   cat >>confdefs.h <<EOF
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 EOF
 
 fi
 done
 
-echo "$as_me:6352: checking for working socketpair" >&5
+echo "$as_me:6422: checking for working socketpair" >&5
 echo $ECHO_N "checking for working socketpair... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_SOCKETPAIR+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_SOCKETPAIR=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6362 "configure"
+#line 6432 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
 #include <sys/socket.h>
 
 main() {
        int fd[2];
        exit((socketpair(AF_UNIX, SOCK_STREAM, 0, fd) != -1) ? 0 : 1);
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6374: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6444: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6377: \$? = $ac_status" >&5
+  echo "$as_me:6447: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6379: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6449: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6382: \$? = $ac_status" >&5
+  echo "$as_me:6452: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_SOCKETPAIR=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_SOCKETPAIR=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6394: result: $rsync_cv_HAVE_SOCKETPAIR" >&5
+echo "$as_me:6464: result: $rsync_cv_HAVE_SOCKETPAIR" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_SOCKETPAIR" >&6
 if test x"$rsync_cv_HAVE_SOCKETPAIR" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_SOCKETPAIR 1
 EOF
 
 fi
 
-echo "$as_me:6404: checking for working fnmatch" >&5
+echo "$as_me:6474: checking for working fnmatch" >&5
 echo $ECHO_N "checking for working fnmatch... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_FNMATCH+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_FNMATCH=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6414 "configure"
+#line 6484 "configure"
 #include "confdefs.h"
 #include <fnmatch.h>
 main() { exit((fnmatch("*.o", "x.o", FNM_PATHNAME) == 0 &&
                fnmatch("a/b/*", "a/b/c/d", FNM_PATHNAME) != 0) ? 0: 1); }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6421: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6491: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6424: \$? = $ac_status" >&5
+  echo "$as_me:6494: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6426: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6496: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6429: \$? = $ac_status" >&5
+  echo "$as_me:6499: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_FNMATCH=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_FNMATCH=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6441: result: $rsync_cv_HAVE_FNMATCH" >&5
+echo "$as_me:6511: result: $rsync_cv_HAVE_FNMATCH" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_FNMATCH" >&6
 if test x"$rsync_cv_HAVE_FNMATCH" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_FNMATCH 1
 EOF
 
 fi
 
 if test x"$with_included_popt" != x"yes"
 then
 
-echo "$as_me:6454: checking for poptGetContext in -lpopt" >&5
+echo "$as_me:6524: checking for poptGetContext in -lpopt" >&5
 echo $ECHO_N "checking for poptGetContext in -lpopt... $ECHO_C" >&6
 if test "${ac_cv_lib_popt_poptGetContext+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lpopt  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
-#line 6462 "configure"
+#line 6532 "configure"
 #include "confdefs.h"
 
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
 extern "C"
 #endif
@@ -6475,33 +6545,33 @@
 poptGetContext ();
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext conftest$ac_exeext
-if { (eval echo "$as_me:6481: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6551: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6484: \$? = $ac_status" >&5
+  echo "$as_me:6554: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest$ac_exeext'
-  { (eval echo "$as_me:6487: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6557: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6490: \$? = $ac_status" >&5
+  echo "$as_me:6560: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   ac_cv_lib_popt_poptGetContext=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 ac_cv_lib_popt_poptGetContext=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-echo "$as_me:6501: result: $ac_cv_lib_popt_poptGetContext" >&5
+echo "$as_me:6571: result: $ac_cv_lib_popt_poptGetContext" >&5
 echo "${ECHO_T}$ac_cv_lib_popt_poptGetContext" >&6
 if test $ac_cv_lib_popt_poptGetContext = yes; then
   cat >>confdefs.h <<EOF
 #define HAVE_LIBPOPT 1
 EOF
 
@@ -6510,369 +6580,369 @@
 else
   with_included_popt=yes
 fi
 
 fi
 
-echo "$as_me:6516: checking whether to use included libpopt" >&5
+echo "$as_me:6586: checking whether to use included libpopt" >&5
 echo $ECHO_N "checking whether to use included libpopt... $ECHO_C" >&6
 if test x"$with_included_popt" = x"yes"
 then
-    echo "$as_me:6520: result: $srcdir/popt" >&5
+    echo "$as_me:6590: result: $srcdir/popt" >&5
 echo "${ECHO_T}$srcdir/popt" >&6
     BUILD_POPT='$(popt_OBJS)'
     CFLAGS="$CFLAGS -I$srcdir/popt"
 else
-    echo "$as_me:6525: result: no" >&5
+    echo "$as_me:6595: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-echo "$as_me:6529: checking for long long" >&5
+echo "$as_me:6599: checking for long long" >&5
 echo $ECHO_N "checking for long long... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_LONGLONG+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_LONGLONG=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6539 "configure"
+#line 6609 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main() { long long x = 1000000; x *= x; exit(((x/1000000) == 1000000)? 0: 1); }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6545: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6615: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6548: \$? = $ac_status" >&5
+  echo "$as_me:6618: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6550: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6620: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6553: \$? = $ac_status" >&5
+  echo "$as_me:6623: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_LONGLONG=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_LONGLONG=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6565: result: $rsync_cv_HAVE_LONGLONG" >&5
+echo "$as_me:6635: result: $rsync_cv_HAVE_LONGLONG" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_LONGLONG" >&6
 if test x"$rsync_cv_HAVE_LONGLONG" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_LONGLONG 1
 EOF
 
 fi
 
-echo "$as_me:6575: checking for off64_t" >&5
+echo "$as_me:6645: checking for off64_t" >&5
 echo $ECHO_N "checking for off64_t... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_OFF64_T+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_OFF64_T=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6585 "configure"
+#line 6655 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 #include <sys/stat.h>
 main() { struct stat64 st; off64_t s; if (sizeof(off_t) == sizeof(off64_t)) exit(1); exit((lstat64("/dev/null", &st)==0)?0:1); }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6592: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6662: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6595: \$? = $ac_status" >&5
+  echo "$as_me:6665: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6597: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6667: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6600: \$? = $ac_status" >&5
+  echo "$as_me:6670: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_OFF64_T=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_OFF64_T=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6612: result: $rsync_cv_HAVE_OFF64_T" >&5
+echo "$as_me:6682: result: $rsync_cv_HAVE_OFF64_T" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_OFF64_T" >&6
 if test x"$rsync_cv_HAVE_OFF64_T" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_OFF64_T 1
 EOF
 
 fi
 
-echo "$as_me:6622: checking for short ino_t" >&5
+echo "$as_me:6692: checking for short ino_t" >&5
 echo $ECHO_N "checking for short ino_t... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_SHORT_INO_T+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_SHORT_INO_T=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6632 "configure"
+#line 6702 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 main() { if (sizeof(ino_t) < sizeof(unsigned int)) return 0; return 1; }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6640: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6710: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6643: \$? = $ac_status" >&5
+  echo "$as_me:6713: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6645: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6715: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6648: \$? = $ac_status" >&5
+  echo "$as_me:6718: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_SHORT_INO_T=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_SHORT_INO_T=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6660: result: $rsync_cv_HAVE_SHORT_INO_T" >&5
+echo "$as_me:6730: result: $rsync_cv_HAVE_SHORT_INO_T" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_SHORT_INO_T" >&6
 if test x"$rsync_cv_HAVE_SHORT_INO_T" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_SHORT_INO_T 1
 EOF
 
 fi
 
-echo "$as_me:6670: checking for unsigned char" >&5
+echo "$as_me:6740: checking for unsigned char" >&5
 echo $ECHO_N "checking for unsigned char... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_UNSIGNED_CHAR+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_UNSIGNED_CHAR=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6680 "configure"
+#line 6750 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 main() { char c; c=250; exit((c > 0)?0:1); }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6686: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6756: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6689: \$? = $ac_status" >&5
+  echo "$as_me:6759: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6691: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6761: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6694: \$? = $ac_status" >&5
+  echo "$as_me:6764: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_UNSIGNED_CHAR=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_UNSIGNED_CHAR=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6706: result: $rsync_cv_HAVE_UNSIGNED_CHAR" >&5
+echo "$as_me:6776: result: $rsync_cv_HAVE_UNSIGNED_CHAR" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_UNSIGNED_CHAR" >&6
 if test x"$rsync_cv_HAVE_UNSIGNED_CHAR" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_UNSIGNED_CHAR 1
 EOF
 
 fi
 
-echo "$as_me:6716: checking for broken readdir" >&5
+echo "$as_me:6786: checking for broken readdir" >&5
 echo $ECHO_N "checking for broken readdir... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_BROKEN_READDIR+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_BROKEN_READDIR=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6726 "configure"
+#line 6796 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <dirent.h>
 main() { struct dirent *di; DIR *d = opendir("."); di = readdir(d);
 if (di && di->d_name[-2] == '.' && di->d_name[-1] == 0 &&
 di->d_name[0] == 0) exit(0); exit(1);}
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6735: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6805: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6738: \$? = $ac_status" >&5
+  echo "$as_me:6808: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6740: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6810: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6743: \$? = $ac_status" >&5
+  echo "$as_me:6813: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_BROKEN_READDIR=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_BROKEN_READDIR=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6755: result: $rsync_cv_HAVE_BROKEN_READDIR" >&5
+echo "$as_me:6825: result: $rsync_cv_HAVE_BROKEN_READDIR" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_BROKEN_READDIR" >&6
 if test x"$rsync_cv_HAVE_BROKEN_READDIR" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_BROKEN_READDIR 1
 EOF
 
 fi
 
-echo "$as_me:6765: checking for utimbuf" >&5
+echo "$as_me:6835: checking for utimbuf" >&5
 echo $ECHO_N "checking for utimbuf... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_UTIMBUF+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 cat >conftest.$ac_ext <<_ACEOF
-#line 6772 "configure"
+#line 6842 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <utime.h>
 int
 main ()
 {
 struct utimbuf tbuf;  tbuf.actime = 0; tbuf.modtime = 1; exit(utime("foo.c",&tbuf));
   ;
   return 0;
 }
 _ACEOF
 rm -f conftest.$ac_objext
-if { (eval echo "$as_me:6785: \"$ac_compile\"") >&5
+if { (eval echo "$as_me:6855: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>&5
   ac_status=$?
-  echo "$as_me:6788: \$? = $ac_status" >&5
+  echo "$as_me:6858: \$? = $ac_status" >&5
   (exit $ac_status); } &&
          { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:6791: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6861: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6794: \$? = $ac_status" >&5
+  echo "$as_me:6864: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_UTIMBUF=yes
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_UTIMBUF=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 fi
-echo "$as_me:6804: result: $rsync_cv_HAVE_UTIMBUF" >&5
+echo "$as_me:6874: result: $rsync_cv_HAVE_UTIMBUF" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_UTIMBUF" >&6
 if test x"$rsync_cv_HAVE_UTIMBUF" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_UTIMBUF 1
 EOF
 
 fi
 
-echo "$as_me:6814: checking if gettimeofday takes tz argument" >&5
+echo "$as_me:6884: checking if gettimeofday takes tz argument" >&5
 echo $ECHO_N "checking if gettimeofday takes tz argument... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_GETTIMEOFDAY_TZ+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_GETTIMEOFDAY_TZ=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6824 "configure"
+#line 6894 "configure"
 #include "confdefs.h"
 
 #include <sys/time.h>
 #include <unistd.h>
 main() { struct timeval tv; exit(gettimeofday(&tv, NULL));}
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6832: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6902: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6835: \$? = $ac_status" >&5
+  echo "$as_me:6905: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6837: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6907: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6840: \$? = $ac_status" >&5
+  echo "$as_me:6910: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_GETTIMEOFDAY_TZ=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_GETTIMEOFDAY_TZ=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6852: result: $rsync_cv_HAVE_GETTIMEOFDAY_TZ" >&5
+echo "$as_me:6922: result: $rsync_cv_HAVE_GETTIMEOFDAY_TZ" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_GETTIMEOFDAY_TZ" >&6
 if test x"$rsync_cv_HAVE_GETTIMEOFDAY_TZ" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_GETTIMEOFDAY_TZ 1
 EOF
 
 fi
 
-echo "$as_me:6862: checking for C99 vsnprintf" >&5
+echo "$as_me:6932: checking for C99 vsnprintf" >&5
 echo $ECHO_N "checking for C99 vsnprintf... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_C99_VSNPRINTF+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_C99_VSNPRINTF=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6872 "configure"
+#line 6942 "configure"
 #include "confdefs.h"
 
 #include <sys/types.h>
 #include <stdarg.h>
 void foo(const char *format, ...) {
        va_list ap;
@@ -6889,53 +6959,53 @@
        exit(0);
 }
 main() { foo("hello"); }
 
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6895: \"$ac_link\"") >&5
+if { (eval echo "$as_me:6965: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6898: \$? = $ac_status" >&5
+  echo "$as_me:6968: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6900: \"$ac_try\"") >&5
+  { (eval echo "$as_me:6970: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6903: \$? = $ac_status" >&5
+  echo "$as_me:6973: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_C99_VSNPRINTF=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_C99_VSNPRINTF=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6915: result: $rsync_cv_HAVE_C99_VSNPRINTF" >&5
+echo "$as_me:6985: result: $rsync_cv_HAVE_C99_VSNPRINTF" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_C99_VSNPRINTF" >&6
 if test x"$rsync_cv_HAVE_C99_VSNPRINTF" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_C99_VSNPRINTF 1
 EOF
 
 fi
 
-echo "$as_me:6925: checking for secure mkstemp" >&5
+echo "$as_me:6995: checking for secure mkstemp" >&5
 echo $ECHO_N "checking for secure mkstemp... $ECHO_C" >&6
 if test "${rsync_cv_HAVE_SECURE_MKSTEMP+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_HAVE_SECURE_MKSTEMP=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6935 "configure"
+#line 7005 "configure"
 #include "confdefs.h"
 #include <stdlib.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <unistd.h>
 main() {
@@ -6947,150 +7017,150 @@
   if (fstat(fd, &st) != 0) exit(1);
   if ((st.st_mode & 0777) != 0600) exit(1);
   exit(0);
 }
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:6953: \"$ac_link\"") >&5
+if { (eval echo "$as_me:7023: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:6956: \$? = $ac_status" >&5
+  echo "$as_me:7026: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:6958: \"$ac_try\"") >&5
+  { (eval echo "$as_me:7028: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:6961: \$? = $ac_status" >&5
+  echo "$as_me:7031: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_HAVE_SECURE_MKSTEMP=yes
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_HAVE_SECURE_MKSTEMP=no
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:6973: result: $rsync_cv_HAVE_SECURE_MKSTEMP" >&5
+echo "$as_me:7043: result: $rsync_cv_HAVE_SECURE_MKSTEMP" >&5
 echo "${ECHO_T}$rsync_cv_HAVE_SECURE_MKSTEMP" >&6
 if test x"$rsync_cv_HAVE_SECURE_MKSTEMP" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define HAVE_SECURE_MKSTEMP 1
 EOF
 
 fi
 
-echo "$as_me:6983: checking for broken inet_ntoa" >&5
+echo "$as_me:7053: checking for broken inet_ntoa" >&5
 echo $ECHO_N "checking for broken inet_ntoa... $ECHO_C" >&6
 if test "${rsync_cv_REPLACE_INET_NTOA+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_REPLACE_INET_NTOA=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 6993 "configure"
+#line 7063 "configure"
 #include "confdefs.h"
 
 #include <stdio.h>
 #include <sys/types.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
 main() { struct in_addr ip; ip.s_addr = 0x12345678;
 if (strcmp(inet_ntoa(ip),"18.52.86.120") &&
     strcmp(inet_ntoa(ip),"120.86.52.18")) { exit(1); }
 exit(0);}
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:7006: \"$ac_link\"") >&5
+if { (eval echo "$as_me:7076: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:7009: \$? = $ac_status" >&5
+  echo "$as_me:7079: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:7011: \"$ac_try\"") >&5
+  { (eval echo "$as_me:7081: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:7014: \$? = $ac_status" >&5
+  echo "$as_me:7084: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_REPLACE_INET_NTOA=no
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_REPLACE_INET_NTOA=yes
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:7026: result: $rsync_cv_REPLACE_INET_NTOA" >&5
+echo "$as_me:7096: result: $rsync_cv_REPLACE_INET_NTOA" >&5
 echo "${ECHO_T}$rsync_cv_REPLACE_INET_NTOA" >&6
 if test x"$rsync_cv_REPLACE_INET_NTOA" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define REPLACE_INET_NTOA 1
 EOF
 
 fi
 
-echo "$as_me:7036: checking for broken inet_aton" >&5
+echo "$as_me:7106: checking for broken inet_aton" >&5
 echo $ECHO_N "checking for broken inet_aton... $ECHO_C" >&6
 if test "${rsync_cv_REPLACE_INET_ATON+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 if test "$cross_compiling" = yes; then
   rsync_cv_REPLACE_INET_ATON=cross
 else
   cat >conftest.$ac_ext <<_ACEOF
-#line 7046 "configure"
+#line 7116 "configure"
 #include "confdefs.h"
 
 #include <stdio.h>
 #include <sys/types.h>
 #include <netinet/in.h>
 #include <arpa/inet.h>
 main() { struct in_addr ip;
 if (inet_aton("example", &ip) == 0) exit(0); exit(1);}
 _ACEOF
 rm -f conftest$ac_exeext
-if { (eval echo "$as_me:7057: \"$ac_link\"") >&5
+if { (eval echo "$as_me:7127: \"$ac_link\"") >&5
   (eval $ac_link) 2>&5
   ac_status=$?
-  echo "$as_me:7060: \$? = $ac_status" >&5
+  echo "$as_me:7130: \$? = $ac_status" >&5
   (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
-  { (eval echo "$as_me:7062: \"$ac_try\"") >&5
+  { (eval echo "$as_me:7132: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
-  echo "$as_me:7065: \$? = $ac_status" >&5
+  echo "$as_me:7135: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   rsync_cv_REPLACE_INET_ATON=no
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
 rsync_cv_REPLACE_INET_ATON=yes
 fi
 rm -f core core.* *.core conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
 fi
 fi
-echo "$as_me:7077: result: $rsync_cv_REPLACE_INET_ATON" >&5
+echo "$as_me:7147: result: $rsync_cv_REPLACE_INET_ATON" >&5
 echo "${ECHO_T}$rsync_cv_REPLACE_INET_ATON" >&6
 if test x"$rsync_cv_REPLACE_INET_ATON" = x"yes"; then
 
 cat >>confdefs.h <<\EOF
 #define REPLACE_INET_ATON 1
 EOF
 
 fi
 
 #
 # The following test was mostly taken from the tcl/tk plus patches
 #
-echo "$as_me:7090: checking whether -c -o works" >&5
+echo "$as_me:7160: checking whether -c -o works" >&5
 echo $ECHO_N "checking whether -c -o works... $ECHO_C" >&6
 if test "${rsync_cv_DASHC_WORKS_WITH_DASHO+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
 
 rm -rf conftest*
@@ -7103,13 +7173,13 @@
 else
     rsync_cv_DASHC_WORKS_WITH_DASHO=no
 fi
 rm -rf conftest*
 
 fi
-echo "$as_me:7109: result: $rsync_cv_DASHC_WORKS_WITH_DASHO" >&5
+echo "$as_me:7179: result: $rsync_cv_DASHC_WORKS_WITH_DASHO" >&5
 echo "${ECHO_T}$rsync_cv_DASHC_WORKS_WITH_DASHO" >&6
 if test x"$rsync_cv_DASHC_WORKS_WITH_DASHO" = x"yes"; then
     OBJ_SAVE="#"
     OBJ_RESTORE="#"
     CC_SHOBJ_FLAG='-o $@'
 else
@@ -7196,13 +7266,13 @@
 
 DEFS=-DHAVE_CONFIG_H
 
 : ${CONFIG_STATUS=./config.status}
 ac_clean_files_save=$ac_clean_files
 ac_clean_files="$ac_clean_files $CONFIG_STATUS"
-{ echo "$as_me:7202: creating $CONFIG_STATUS" >&5
+{ echo "$as_me:7272: creating $CONFIG_STATUS" >&5
 echo "$as_me: creating $CONFIG_STATUS" >&6;}
 cat >$CONFIG_STATUS <<_ACEOF
 #! $SHELL
 # Generated automatically by configure.
 # Run this file to recreate the current configuration.
 # Compiler output produced by configure, useful for debugging
@@ -7369,13 +7439,13 @@
 EOF
 cat >>$CONFIG_STATUS <<\EOF
   --version | --vers* | -V )
     echo "$ac_cs_version"; exit 0 ;;
   --he | --h)
     # Conflict between --help and --header
-    { { echo "$as_me:7375: error: ambiguous option: $1
+    { { echo "$as_me:7445: error: ambiguous option: $1
 Try \`$0 --help' for more information." >&5
 echo "$as_me: error: ambiguous option: $1
 Try \`$0 --help' for more information." >&2;}
    { (exit 1); exit 1; }; };;
   --help | --hel | -h )
     echo "$ac_cs_usage"; exit 0 ;;
@@ -7388,13 +7458,13 @@
   --header | --heade | --head | --hea )
     shift
     CONFIG_HEADERS="$CONFIG_HEADERS $1"
     ac_need_defaults=false;;
 
   # This is an error.
-  -*) { { echo "$as_me:7394: error: unrecognized option: $1
+  -*) { { echo "$as_me:7464: error: unrecognized option: $1
 Try \`$0 --help' for more information." >&5
 echo "$as_me: error: unrecognized option: $1
 Try \`$0 --help' for more information." >&2;}
    { (exit 1); exit 1; }; } ;;
 
   *) ac_config_targets="$ac_config_targets $1" ;;
@@ -7429,13 +7499,13 @@
   "Makefile" ) CONFIG_FILES="$CONFIG_FILES Makefile" ;;
   "lib/dummy" ) CONFIG_FILES="$CONFIG_FILES lib/dummy" ;;
   "zlib/dummy" ) CONFIG_FILES="$CONFIG_FILES zlib/dummy" ;;
   "popt/dummy" ) CONFIG_FILES="$CONFIG_FILES popt/dummy" ;;
   "shconfig" ) CONFIG_FILES="$CONFIG_FILES shconfig" ;;
   "config.h" ) CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
-  *) { { echo "$as_me:7435: error: invalid argument: $ac_config_target" >&5
+  *) { { echo "$as_me:7505: error: invalid argument: $ac_config_target" >&5
 echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
    { (exit 1); exit 1; }; };;
   esac
 done
 
 # If the user did not use the arguments to specify the items to instantiate,
@@ -7654,13 +7724,13 @@
   case $INSTALL in
   [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
   *) ac_INSTALL=$ac_dots$INSTALL ;;
   esac
 
   if test x"$ac_file" != x-; then
-    { echo "$as_me:7660: creating $ac_file" >&5
+    { echo "$as_me:7730: creating $ac_file" >&5
 echo "$as_me: creating $ac_file" >&6;}
     rm -f "$ac_file"
   fi
   # Let's still pretend it is `configure' which instantiates (i.e., don't
   # use $as_me), people would be surprised to read:
   #    /* config.h.  Generated automatically by config.status.  */
@@ -7672,26 +7742,26 @@
   ac_file_inputs=`IFS=:
     for f in $ac_file_in; do
       case $f in
       -) echo $tmp/stdin ;;
       [\\/$]*)
          # Absolute (can't be DOS-style, as IFS=:)
-         test -f "$f" || { { echo "$as_me:7678: error: cannot find input file: $f" >&5
+         test -f "$f" || { { echo "$as_me:7748: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
          echo $f;;
       *) # Relative
          if test -f "$f"; then
            # Build tree
            echo $f
          elif test -f "$srcdir/$f"; then
            # Source tree
            echo $srcdir/$f
          else
            # /dev/null tree
-           { { echo "$as_me:7691: error: cannot find input file: $f" >&5
+           { { echo "$as_me:7761: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
          fi;;
       esac
     done` || { (exit 1); exit 1; }
 EOF
@@ -7746,37 +7816,37 @@
         ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
   *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
         ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
   * )   ac_file_in=$ac_file.in ;;
   esac
 
-  test x"$ac_file" != x- && { echo "$as_me:7752: creating $ac_file" >&5
+  test x"$ac_file" != x- && { echo "$as_me:7822: creating $ac_file" >&5
 echo "$as_me: creating $ac_file" >&6;}
 
   # First look for the input files in the build tree, otherwise in the
   # src tree.
   ac_file_inputs=`IFS=:
     for f in $ac_file_in; do
       case $f in
       -) echo $tmp/stdin ;;
       [\\/$]*)
          # Absolute (can't be DOS-style, as IFS=:)
-         test -f "$f" || { { echo "$as_me:7763: error: cannot find input file: $f" >&5
+         test -f "$f" || { { echo "$as_me:7833: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
          echo $f;;
       *) # Relative
          if test -f "$f"; then
            # Build tree
            echo $f
          elif test -f "$srcdir/$f"; then
            # Source tree
            echo $srcdir/$f
          else
            # /dev/null tree
-           { { echo "$as_me:7776: error: cannot find input file: $f" >&5
+           { { echo "$as_me:7846: error: cannot find input file: $f" >&5
 echo "$as_me: error: cannot find input file: $f" >&2;}
    { (exit 1); exit 1; }; }
          fi;;
       esac
     done` || { (exit 1); exit 1; }
   # Remove the trailing spaces.
@@ -7887,13 +7957,13 @@
     echo "/* $ac_file.  Generated automatically by configure.  */" >$tmp/config.h
   fi
   cat $tmp/in >>$tmp/config.h
   rm -f $tmp/in
   if test x"$ac_file" != x-; then
     if cmp -s $ac_file $tmp/config.h 2>/dev/null; then
-      { echo "$as_me:7893: $ac_file is unchanged" >&5
+      { echo "$as_me:7963: $ac_file is unchanged" >&5
 echo "$as_me: $ac_file is unchanged" >&6;}
     else
       ac_dir=`$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
          X"$ac_file" : 'X\(//\)[^/]' \| \
          X"$ac_file" : 'X\(//\)$' \| \
          X"$ac_file" : 'X\(/\)' \| \
@@ -7954,6 +8024,12 @@
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
   $ac_cs_success || { (exit 1); exit 1; }
 fi
 
+echo "$as_me:8030: result: " >&5
+echo "${ECHO_T}" >&6
+echo "$as_me:8032: result:     rsync ${RSYNC_VERSION} configuration successful" >&5
+echo "${ECHO_T}    rsync ${RSYNC_VERSION} configuration successful" >&6
+echo "$as_me:8034: result: " >&5
+echo "${ECHO_T}" >&6
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/configure.in	2002-01-03 15:19:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/configure.in	2002-01-26 07:19:21.000000000 +0800
@@ -2,13 +2,13 @@
 
 AC_INIT()
 AC_CONFIG_SRCDIR([byteorder.h])
 AC_CONFIG_HEADER(config.h)
 AC_PREREQ(2.52)
 
-RSYNC_VERSION=2.5.1
+RSYNC_VERSION=2.5.2
 AC_SUBST(RSYNC_VERSION)
 AC_MSG_NOTICE([Configuring rsync $RSYNC_VERSION])
 
 AC_DEFINE_UNQUOTED(RSYNC_VERSION, ["$RSYNC_VERSION"], [rsync release version])
 
 LDFLAGS=${LDFLAGS-""}
@@ -19,19 +19,24 @@
 AC_PROG_CC
 AC_PROG_CPP
 AC_PROG_INSTALL
 AC_PROG_CC_STDC
 AC_SUBST(SHELL)
 
+AC_DEFINE([_GNU_SOURCE], 1,
+          [Define _GNU_SOURCE so that we get all necessary prototypes])
+
 if test "$xac_cv_prog_cc_stdc" = xno
 then
 	AC_MSG_WARN([rsync requires an ANSI C compiler and you don't seem to have one])
 fi
 
-# compile with optimisation and without debugging by default, unless
-# --debug is given.  We must decide this before testing the compiler.
+# We must decide this before testing the compiler.
+
+# Please allow this to default to yes, so that your users have more
+# chance of getting a useful stack trace if problems occur.
 
 AC_MSG_CHECKING([whether to include debugging symbols])
 AC_ARG_ENABLE(debug,
 	AC_HELP_STRING([--enable-debug],
 		[including debugging symbols and features (default yes)]),
 		[], [])
@@ -44,14 +49,35 @@
     AC_MSG_RESULT([yes])
     # leave CFLAGS alone; AC_PROG_CC will try to include -g if it can
     dnl AC_DEFINE(DEBUG, 1, [Define to turn on debugging code that may slow normal operation])
     dnl CFLAGS=${CFLAGS-"-g"}
 fi
 
+
+
+
+AC_ARG_ENABLE(profile,
+	AC_HELP_STRING([--enable-profile],	
+		[turn on CPU profiling (default no)],
+		[], []))
+if test x"$enable_profile" = xyes
+then
+	CFLAGS="$CFLAGS -pg"
+fi
+
+
+# This is needed for our included version of popt.  Kind of silly, but
+# I don't want our version too far out of sync.
 CFLAGS="$CFLAGS -DHAVE_CONFIG_H"
 
+# If GCC, turn on warnings.
+if test "x$GCC" = "xyes"
+then
+	CFLAGS="$CFLAGS -Wall -W"
+fi
+
 AC_ARG_WITH(included-popt,
         [  --with-included-popt    use bundled popt library, not from system])
 
 AC_ARG_WITH(rsync-path,
 	[  --with-rsync-path=PATH  set default --rsync-path to PATH (default: \"rsync\")],
 	[ RSYNC_PATH="$with_rsync_path" ],
@@ -201,12 +227,13 @@
 AC_HEADER_SYS_WAIT
 AC_CHECK_HEADERS(sys/fcntl.h sys/select.h fcntl.h sys/time.h sys/unistd.h unistd.h utime.h grp.h)
 AC_CHECK_HEADERS(compat.h sys/param.h ctype.h sys/wait.h sys/ioctl.h)
 AC_CHECK_HEADERS(sys/filio.h string.h stdlib.h sys/socket.h sys/mode.h)
 AC_CHECK_HEADERS(glob.h alloca.h mcheck.h sys/sysctl.h arpa/inet.h arpa/nameser.h)
 AC_CHECK_HEADERS(netdb.h)
+AC_CHECK_HEADERS(malloc.h)
 
 AC_CHECK_SIZEOF(int)
 AC_CHECK_SIZEOF(long)
 AC_CHECK_SIZEOF(short)
 
 AC_C_INLINE
@@ -265,13 +292,13 @@
         AC_DEFINE(HAVE_CONNECT, 1, [ ])
     fi
 fi
 
 AC_CHECK_LIB(resolv, inet_ntop)
 
-AC_MSG_NOTICE([Looking in libraries: $LIBS])
+dnl AC_MSG_NOTICE([Looking in libraries: $LIBS])
 
 AC_CHECK_FUNCS(inet_ntop, , AC_LIBOBJ(lib/inet_ntop)) 
 AC_CHECK_FUNCS(inet_pton, , AC_LIBOBJ(lib/inet_pton))
 
 AC_CHECK_FUNCS(getaddrinfo, , AC_LIBOBJ(lib/getaddrinfo)) 
 AC_CHECK_FUNCS(getnameinfo, , AC_LIBOBJ(lib/getnameinfo))
@@ -306,13 +333,13 @@
 dnl AC_FUNC_MEMCMP
 
 AC_FUNC_UTIME_NULL
 AC_CHECK_FUNCS(waitpid wait4 getcwd strdup strerror chown chmod mknod)
 AC_CHECK_FUNCS(fchmod fstat strchr readlink link utime utimes strftime)
 AC_CHECK_FUNCS(memmove lchown vsnprintf snprintf asprintf setsid glob strpbrk)
-AC_CHECK_FUNCS(strlcat strlcpy mtrace)
+AC_CHECK_FUNCS(strlcat strlcpy mtrace mallinfo)
 
 AC_CACHE_CHECK([for working socketpair],rsync_cv_HAVE_SOCKETPAIR,[
 AC_TRY_RUN([
 #include <sys/types.h>
 #include <sys/socket.h>
 
@@ -522,6 +549,10 @@
 AC_SUBST(OBJ_RESTORE)
 AC_SUBST(CC_SHOBJ_FLAG)
 AC_SUBST(BUILD_POPT)
 
 AC_CONFIG_FILES([Makefile lib/dummy zlib/dummy popt/dummy shconfig])
 AC_OUTPUT
+
+AC_MSG_RESULT()
+AC_MSG_RESULT([    rsync ${RSYNC_VERSION} configuration successful])
+AC_MSG_RESULT()
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/.cvsignore /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/.cvsignore
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/.cvsignore	2001-11-30 08:21:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/.cvsignore	2002-01-25 10:53:48.000000000 +0800
@@ -1,13 +1,18 @@
 ID
 Makefile
 config.cache
 config.h
 config.log
 config.status
+gmon.out
 rsync
 shconfig
 testdir
 tests-dont-exist
 testtmp
+testtmp.*
 tls
 zlib/dummy
+confdefs.h
+conftest.c
+conftest.log
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1: cvs.log
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/exclude.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/exclude.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/exclude.c	2001-11-30 08:21:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/exclude.c	2002-01-23 12:57:18.000000000 +0800
@@ -296,13 +296,14 @@
 }
 
 
 void recv_exclude_list(int f)
 {
 	char line[MAXPATHLEN];
-	int l;
+	unsigned int l;
+
 	while ((l=read_int(f))) {
 		if (l >= MAXPATHLEN) overflow("recv_exclude_list");
 		read_sbuf(f,line,l);
 		add_exclude(line,0);
 	}
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/fileio.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/fileio.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/fileio.c	1999-03-16 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/fileio.c	2002-01-26 07:07:34.000000000 +0800
@@ -1,8 +1,9 @@
 /* 
    Copyright (C) Andrew Tridgell 1998
+   Copyright (C) 2002 by Martin Pool
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -33,15 +34,15 @@
 	}
 	last_sparse = 0;
 	return 0;
 }
 
 
-static int write_sparse(int f,char *buf,int len)
+static int write_sparse(int f,char *buf,size_t len)
 {
-	int l1=0,l2=0;
+	size_t l1=0, l2=0;
 	int ret;
 
 	for (l1=0;l1<len && buf[l1]==0;l1++) ;
 	for (l2=0;l2<(len-l1) && buf[len-(l2+1)]==0;l2++) ;
 
 	last_byte = buf[len-1];
@@ -53,26 +54,27 @@
 		do_lseek(f,l1,SEEK_CUR);  
 	}
 
 	if (l1 == len) 
 		return len;
 
-	if ((ret=write(f,buf+l1,len-(l1+l2))) != len-(l1+l2)) {
-		if (ret == -1 || ret == 0) return ret;
+	ret = write(f, buf + l1, len - (l1+l2));
+	if (ret == -1 || ret == 0)
+		return ret;
+	else if (ret != (int) (len - (l1+l2))) 
 		return (l1+ret);
-	}
 
 	if (l2 > 0)
 		do_lseek(f,l2,SEEK_CUR);
 	
 	return len;
 }
 
 
 
-int write_file(int f,char *buf,int len)
+int write_file(int f,char *buf,size_t len)
 {
 	int ret = 0;
 
 	if (!sparse_files) {
 		return write(f,buf,len);
 	}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/flist.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/flist.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/flist.c	2002-01-03 15:09:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/flist.c	2002-01-26 07:07:34.000000000 +0800
@@ -1,10 +1,10 @@
 /* 
    Copyright (C) Andrew Tridgell 1996
    Copyright (C) Paul Mackerras 1996
-   Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+   Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -15,13 +15,22 @@
    
    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */
 
-/* generate and receive file lists */
+/** @file flist.c
+ * Generate and receive file lists
+ *
+ * @todo Get rid of the string_area optimization.  Efficiently
+ * allocating blocks is the responsibility of the system's malloc
+ * library, not of rsync.
+ *
+ * @sa http://lists.samba.org/pipermail/rsync/2000-June/002351.html
+ *
+ **/
 
 #include "rsync.h"
 
 extern struct stats stats;
 
 extern int verbose;
@@ -56,32 +65,68 @@
 static struct exclude_struct **local_exclude_list;
 
 static struct file_struct null_file;
 
 static void clean_flist(struct file_list *flist, int strip_root);
 
+
+static int show_build_progress_p(void)
+{
+	extern int do_progress;
+
+	return do_progress && verbose && recurse && !am_server;
+}
+
+/**
+ * True if we're local, etc, and should emit progress emssages.
+ **/
+static void emit_build_progress(const struct file_list *flist)
+{
+	rprintf(FINFO, " %d files...\r", flist->count);
+}
+
+
+static void finish_build_progress(const struct file_list *flist)
+{
+	if (verbose && recurse && !am_server) {
+		/* This overwrites the progress line, if any. */
+		rprintf(FINFO, RSYNC_NAME ": %d files to consider.\n",
+			flist->count);
+	}
+}
+
+
+void show_flist_stats(void)
+{
+	/* Nothing yet */
+}
+
+
 static struct string_area *string_area_new(int size)
 {
 	struct string_area *a;
 
-	if (size <= 0) size = ARENA_SIZE;
+	if (size <= 0)
+		size = ARENA_SIZE;
 	a = malloc(sizeof(*a));
-	if (!a) out_of_memory("string_area_new");
+	if (!a)
+		out_of_memory("string_area_new");
 	a->current = a->base = malloc(size);
-	if (!a->current) out_of_memory("string_area_new buffer");
+	if (!a->current)
+		out_of_memory("string_area_new buffer");
 	a->end = a->base + size;
 	a->next = NULL;
 
 	return a;
 }
 
 static void string_area_free(struct string_area *a)
 {
 	struct string_area *next;
 
-	for ( ; a ; a = next) {
+	for (; a; a = next) {
 		next = a->next;
 		free(a->base);
 	}
 }
 
 static char *string_area_malloc(struct string_area **ap, int size)
@@ -103,13 +148,13 @@
 	a->current += size;
 	return p;
 }
 
 static char *string_area_strdup(struct string_area **ap, const char *src)
 {
-	char* dest = string_area_malloc(ap, strlen(src) + 1);
+	char *dest = string_area_malloc(ap, strlen(src) + 1);
 	return strcpy(dest, src);
 }
 
 static void list_file_entry(struct file_struct *f)
 {
 	char perms[11];
@@ -118,315 +163,391 @@
 		/* this can happen if duplicate names were removed */
 		return;
 
 	permstring(perms, f->mode);
 
 	if (preserve_links && S_ISLNK(f->mode)) {
-		rprintf(FINFO,"%s %11.0f %s %s -> %s\n", 
-			perms, 
-			(double)f->length, timestring(f->modtime), 
+		rprintf(FINFO, "%s %11.0f %s %s -> %s\n",
+			perms,
+			(double) f->length, timestring(f->modtime),
 			f_name(f), f->link);
 	} else {
-		rprintf(FINFO,"%s %11.0f %s %s\n", 
-			perms, 
-			(double)f->length, timestring(f->modtime), f_name(f));
+		rprintf(FINFO, "%s %11.0f %s %s\n",
+			perms,
+			(double) f->length, timestring(f->modtime),
+			f_name(f));
 	}
 }
 
 
-int readlink_stat(const char *Path, STRUCT_STAT *Buffer, char *Linkbuf) 
+int readlink_stat(const char *Path, STRUCT_STAT * Buffer, char *Linkbuf)
 {
 #if SUPPORT_LINKS
 	if (copy_links) {
 		return do_stat(Path, Buffer);
 	}
 	if (do_lstat(Path, Buffer) == -1) {
 		return -1;
 	}
 	if (S_ISLNK(Buffer->st_mode)) {
 		int l;
-		if ((l = readlink((char *) Path, Linkbuf, MAXPATHLEN-1))== -1) {
+		if ((l =
+		     readlink((char *) Path, Linkbuf,
+			      MAXPATHLEN - 1)) == -1) {
 			return -1;
 		}
 		Linkbuf[l] = 0;
 		if (copy_unsafe_links && (topsrcname[0] != '\0') &&
-				    unsafe_symlink(Linkbuf, topsrcname)) {
+		    unsafe_symlink(Linkbuf, topsrcname)) {
 			return do_stat(Path, Buffer);
 		}
 	}
 	return 0;
 #else
 	return do_stat(Path, Buffer);
 #endif
 }
 
-int link_stat(const char *Path, STRUCT_STAT *Buffer) 
+int link_stat(const char *Path, STRUCT_STAT * Buffer)
 {
 #if SUPPORT_LINKS
-    if (copy_links) {
-	return do_stat(Path, Buffer);
-    } else {
-	return do_lstat(Path, Buffer);
-    }
+	if (copy_links) {
+		return do_stat(Path, Buffer);
+	} else {
+		return do_lstat(Path, Buffer);
+	}
 #else
-    return do_stat(Path, Buffer);
+	return do_stat(Path, Buffer);
 #endif
 }
 
 /*
   This function is used to check if a file should be included/excluded
   from the list of files based on its name and type etc
  */
-static int check_exclude_file(int f,char *fname,STRUCT_STAT *st)
+static int check_exclude_file(int f, char *fname, STRUCT_STAT * st)
 {
 	extern int delete_excluded;
 
 	/* f is set to -1 when calculating deletion file list */
 	if ((f == -1) && delete_excluded) {
 		return 0;
 	}
-	if (check_exclude(fname,local_exclude_list,st)) {
+	if (check_exclude(fname, local_exclude_list, st)) {
 		return 1;
 	}
 	return 0;
 }
 
 /* used by the one_file_system code */
 static dev_t filesystem_dev;
 
 static void set_filesystem(char *fname)
 {
-  STRUCT_STAT st;
-  if (link_stat(fname,&st) != 0) return;
-  filesystem_dev = st.st_dev;
+	STRUCT_STAT st;
+	if (link_stat(fname, &st) != 0)
+		return;
+	filesystem_dev = st.st_dev;
 }
 
 
 static int to_wire_mode(mode_t mode)
 {
 	if (S_ISLNK(mode) && (_S_IFLNK != 0120000)) {
 		return (mode & ~(_S_IFMT)) | 0120000;
 	}
-	return (int)mode;
+	return (int) mode;
 }
 
 static mode_t from_wire_mode(int mode)
 {
 	if ((mode & (_S_IFMT)) == 0120000 && (_S_IFLNK != 0120000)) {
 		return (mode & ~(_S_IFMT)) | _S_IFLNK;
 	}
-	return (mode_t)mode;
+	return (mode_t) mode;
 }
 
 
-static void send_directory(int f,struct file_list *flist,char *dir);
+static void send_directory(int f, struct file_list *flist, char *dir);
 
 static char *flist_dir;
 
 
-static void send_file_entry(struct file_struct *file,int f,unsigned base_flags)
+/**
+ * Make sure @p flist is big enough to hold at least @p flist->count
+ * entries.
+ **/
+static void flist_expand(struct file_list *flist)
+{
+	if (flist->count >= flist->malloced) {
+		size_t new_bytes;
+		void *new_ptr;
+		
+		if (flist->malloced < 1000)
+			flist->malloced += 1000;
+		else
+			flist->malloced *= 2;
+
+		new_bytes = sizeof(flist->files[0]) * flist->malloced;
+		
+		new_ptr = realloc(flist->files, new_bytes);
+
+		if (verbose >= 2) {
+			rprintf(FINFO, RSYNC_NAME ": expand file_list to %.0f bytes, did%s move\n",
+				(double) new_bytes,
+				(new_ptr == flist->files) ? " not" : "");
+		}
+		
+		flist->files = (struct file_struct **) new_ptr;
+
+		if (!flist->files)
+			out_of_memory("flist_expand");
+	}
+}
+
+
+static void send_file_entry(struct file_struct *file, int f,
+			    unsigned base_flags)
 {
 	unsigned char flags;
 	static time_t last_time;
 	static mode_t last_mode;
-	static dev_t last_rdev;
+	static DEV64_T last_rdev;
 	static uid_t last_uid;
 	static gid_t last_gid;
 	static char lastname[MAXPATHLEN];
 	char *fname;
-	int l1,l2;
+	int l1, l2;
 
-	if (f == -1) return;
+	if (f == -1)
+		return;
 
 	if (!file) {
-		write_byte(f,0);
+		write_byte(f, 0);
 		return;
 	}
 
 	fname = f_name(file);
 
 	flags = base_flags;
 
-	if (file->mode == last_mode) flags |= SAME_MODE;
-	if (file->rdev == last_rdev) flags |= SAME_RDEV;
-	if (file->uid == last_uid) flags |= SAME_UID;
-	if (file->gid == last_gid) flags |= SAME_GID;
-	if (file->modtime == last_time) flags |= SAME_TIME;
-
-	for (l1=0;lastname[l1] && (fname[l1] == lastname[l1]) && (l1 < 255);l1++) ;  
+	if (file->mode == last_mode)
+		flags |= SAME_MODE;
+	if (file->rdev == last_rdev)
+		flags |= SAME_RDEV;
+	if (file->uid == last_uid)
+		flags |= SAME_UID;
+	if (file->gid == last_gid)
+		flags |= SAME_GID;
+	if (file->modtime == last_time)
+		flags |= SAME_TIME;
+
+	for (l1 = 0;
+	     lastname[l1] && (fname[l1] == lastname[l1]) && (l1 < 255);
+	     l1++);
 	l2 = strlen(fname) - l1;
 
-	if (l1 > 0) flags |= SAME_NAME;
-	if (l2 > 255) flags |= LONG_NAME;
+	if (l1 > 0)
+		flags |= SAME_NAME;
+	if (l2 > 255)
+		flags |= LONG_NAME;
 
 	/* we must make sure we don't send a zero flags byte or the other
 	   end will terminate the flist transfer */
-	if (flags == 0 && !S_ISDIR(file->mode)) flags |= FLAG_DELETE;
-	if (flags == 0) flags |= LONG_NAME;
+	if (flags == 0 && !S_ISDIR(file->mode))
+		flags |= FLAG_DELETE;
+	if (flags == 0)
+		flags |= LONG_NAME;
 
-	write_byte(f,flags);  
+	write_byte(f, flags);
 	if (flags & SAME_NAME)
-		write_byte(f,l1);
+		write_byte(f, l1);
 	if (flags & LONG_NAME)
-		write_int(f,l2);
+		write_int(f, l2);
 	else
-		write_byte(f,l2);
-	write_buf(f,fname+l1,l2);
+		write_byte(f, l2);
+	write_buf(f, fname + l1, l2);
 
-	write_longint(f,file->length);
+	write_longint(f, file->length);
 	if (!(flags & SAME_TIME))
-		write_int(f,(int)file->modtime);
+		write_int(f, (int) file->modtime);
 	if (!(flags & SAME_MODE))
-		write_int(f,to_wire_mode(file->mode));
+		write_int(f, to_wire_mode(file->mode));
 	if (preserve_uid && !(flags & SAME_UID)) {
 		add_uid(file->uid);
-		write_int(f,(int)file->uid);
+		write_int(f, (int) file->uid);
 	}
 	if (preserve_gid && !(flags & SAME_GID)) {
 		add_gid(file->gid);
-		write_int(f,(int)file->gid);
+		write_int(f, (int) file->gid);
 	}
-	if (preserve_devices && IS_DEVICE(file->mode) && !(flags & SAME_RDEV))
-		write_int(f,(int)file->rdev);
+	if (preserve_devices && IS_DEVICE(file->mode)
+	    && !(flags & SAME_RDEV))
+		write_int(f, (int) file->rdev);
 
 #if SUPPORT_LINKS
 	if (preserve_links && S_ISLNK(file->mode)) {
-		write_int(f,strlen(file->link));
-		write_buf(f,file->link,strlen(file->link));
+		write_int(f, strlen(file->link));
+		write_buf(f, file->link, strlen(file->link));
 	}
 #endif
 
 #if SUPPORT_HARD_LINKS
 	if (preserve_hard_links && S_ISREG(file->mode)) {
-		write_int(f,(int)file->dev);
-		write_int(f,(int)file->inode);
+		if (remote_version < 26) {
+			/* 32-bit dev_t and ino_t */
+			write_int(f, (int) file->dev);
+			write_int(f, (int) file->inode);
+		} else {
+			/* 64-bit dev_t and ino_t */
+			write_longint(f, file->dev);
+			write_longint(f, file->inode);
+		}
 	}
 #endif
 
 	if (always_checksum) {
 		if (remote_version < 21) {
-			write_buf(f,file->sum,2);
+			write_buf(f, file->sum, 2);
 		} else {
-			write_buf(f,file->sum,MD4_SUM_LENGTH);
+			write_buf(f, file->sum, MD4_SUM_LENGTH);
 		}
-	}       
+	}
 
 	last_mode = file->mode;
 	last_rdev = file->rdev;
 	last_uid = file->uid;
 	last_gid = file->gid;
 	last_time = file->modtime;
 
-	strlcpy(lastname,fname,MAXPATHLEN);
-	lastname[MAXPATHLEN-1] = 0;
+	strlcpy(lastname, fname, MAXPATHLEN);
+	lastname[MAXPATHLEN - 1] = 0;
 }
 
 
 
 static void receive_file_entry(struct file_struct **fptr,
-			       unsigned flags,int f)
+			       unsigned flags, int f)
 {
 	static time_t last_time;
 	static mode_t last_mode;
-	static dev_t last_rdev;
+	static DEV64_T last_rdev;
 	static uid_t last_uid;
 	static gid_t last_gid;
 	static char lastname[MAXPATHLEN];
 	char thisname[MAXPATHLEN];
-	int l1=0,l2=0;
+	unsigned int l1 = 0, l2 = 0;
 	char *p;
 	struct file_struct *file;
 
 	if (flags & SAME_NAME)
 		l1 = read_byte(f);
-  
+
 	if (flags & LONG_NAME)
 		l2 = read_int(f);
 	else
 		l2 = read_byte(f);
 
-	file = (struct file_struct *)malloc(sizeof(*file));
-	if (!file) out_of_memory("receive_file_entry");
-	memset((char *)file, 0, sizeof(*file));
+	file = (struct file_struct *) malloc(sizeof(*file));
+	if (!file)
+		out_of_memory("receive_file_entry");
+	memset((char *) file, 0, sizeof(*file));
 	(*fptr) = file;
 
-	if (l2 >= MAXPATHLEN-l1) {
-		rprintf(FERROR,"overflow: flags=0x%x l1=%d l2=%d lastname=%s\n",
+	if (l2 >= MAXPATHLEN - l1) {
+		rprintf(FERROR,
+			"overflow: flags=0x%x l1=%d l2=%d lastname=%s\n",
 			flags, l1, l2, lastname);
 		overflow("receive_file_entry");
 	}
 
-	strlcpy(thisname,lastname,l1+1);
-	read_sbuf(f,&thisname[l1],l2);
-	thisname[l1+l2] = 0;
+	strlcpy(thisname, lastname, l1 + 1);
+	read_sbuf(f, &thisname[l1], l2);
+	thisname[l1 + l2] = 0;
 
-	strlcpy(lastname,thisname,MAXPATHLEN);
-	lastname[MAXPATHLEN-1] = 0;
+	strlcpy(lastname, thisname, MAXPATHLEN);
+	lastname[MAXPATHLEN - 1] = 0;
 
 	clean_fname(thisname);
 
 	if (sanitize_paths) {
 		sanitize_path(thisname, NULL);
 	}
 
-	if ((p = strrchr(thisname,'/'))) {
+	if ((p = strrchr(thisname, '/'))) {
 		static char *lastdir;
 		*p = 0;
-		if (lastdir && strcmp(thisname, lastdir)==0) {
+		if (lastdir && strcmp(thisname, lastdir) == 0) {
 			file->dirname = lastdir;
 		} else {
 			file->dirname = strdup(thisname);
 			lastdir = file->dirname;
 		}
-		file->basename = strdup(p+1);
+		file->basename = strdup(p + 1);
 	} else {
 		file->dirname = NULL;
 		file->basename = strdup(thisname);
 	}
 
-	if (!file->basename) out_of_memory("receive_file_entry 1");
+	if (!file->basename)
+		out_of_memory("receive_file_entry 1");
 
 
 	file->flags = flags;
 	file->length = read_longint(f);
-	file->modtime = (flags & SAME_TIME) ? last_time : (time_t)read_int(f);
-	file->mode = (flags & SAME_MODE) ? last_mode : from_wire_mode(read_int(f));
+	file->modtime =
+	    (flags & SAME_TIME) ? last_time : (time_t) read_int(f);
+	file->mode =
+	    (flags & SAME_MODE) ? last_mode : from_wire_mode(read_int(f));
 	if (preserve_uid)
-		file->uid = (flags & SAME_UID) ? last_uid : (uid_t)read_int(f);
+		file->uid =
+		    (flags & SAME_UID) ? last_uid : (uid_t) read_int(f);
 	if (preserve_gid)
-		file->gid = (flags & SAME_GID) ? last_gid : (gid_t)read_int(f);
+		file->gid =
+		    (flags & SAME_GID) ? last_gid : (gid_t) read_int(f);
 	if (preserve_devices && IS_DEVICE(file->mode))
-		file->rdev = (flags & SAME_RDEV) ? last_rdev : (dev_t)read_int(f);
+		file->rdev =
+		    (flags & SAME_RDEV) ? last_rdev : (dev_t) read_int(f);
 
 	if (preserve_links && S_ISLNK(file->mode)) {
 		int l = read_int(f);
-		file->link = (char *)malloc(l+1);
-		if (!file->link) out_of_memory("receive_file_entry 2");
-		read_sbuf(f,file->link,l);
+		if (l < 0) {
+			rprintf(FERROR, "overflow: l=%d\n", l);
+			overflow("receive_file_entry");
+		}
+		file->link = (char *) malloc(l + 1);
+		if (!file->link)
+			out_of_memory("receive_file_entry 2");
+		read_sbuf(f, file->link, l);
 		if (sanitize_paths) {
 			sanitize_path(file->link, file->dirname);
 		}
 	}
-
 #if SUPPORT_HARD_LINKS
 	if (preserve_hard_links && S_ISREG(file->mode)) {
-		file->dev = read_int(f);
-		file->inode = read_int(f);
+		if (remote_version < 26) {
+			file->dev = read_int(f);
+			file->inode = read_int(f);
+		} else {
+			file->dev = read_longint(f);
+			file->inode = read_longint(f);
+		}
 	}
 #endif
-  
+
 	if (always_checksum) {
-		file->sum = (char *)malloc(MD4_SUM_LENGTH);
-		if (!file->sum) out_of_memory("md4 sum");
+		file->sum = (char *) malloc(MD4_SUM_LENGTH);
+		if (!file->sum)
+			out_of_memory("md4 sum");
 		if (remote_version < 21) {
-			read_buf(f,file->sum,2);
+			read_buf(f, file->sum, 2);
 		} else {
-			read_buf(f,file->sum,MD4_SUM_LENGTH);
+			read_buf(f, file->sum, MD4_SUM_LENGTH);
 		}
 	}
-  
+
 	last_mode = file->mode;
 	last_rdev = file->rdev;
 	last_uid = file->uid;
 	last_gid = file->gid;
 	last_time = file->modtime;
 
@@ -439,30 +560,32 @@
 }
 
 
 /* determine if a file in a different filesstem should be skipped
    when one_file_system is set. We bascally only want to include
    the mount points - but they can be hard to find! */
-static int skip_filesystem(char *fname, STRUCT_STAT *st)
+static int skip_filesystem(char *fname, STRUCT_STAT * st)
 {
 	STRUCT_STAT st2;
 	char *p = strrchr(fname, '/');
 
 	/* skip all but directories */
-	if (!S_ISDIR(st->st_mode)) return 1;
+	if (!S_ISDIR(st->st_mode))
+		return 1;
 
 	/* if its not a subdirectory then allow */
-	if (!p) return 0;
+	if (!p)
+		return 0;
 
 	*p = 0;
 	if (link_stat(fname, &st2)) {
 		*p = '/';
 		return 0;
 	}
 	*p = '/';
-	
+
 	return (st2.st_dev != filesystem_dev);
 }
 
 #define STRDUP(ap, p)	(ap ? string_area_strdup(ap, p) : strdup(p))
 /* IRIX cc cares that the operands to the ternary have the same type. */
 #define MALLOC(ap, i)	(ap ? (void*) string_area_malloc(ap, i) : malloc(i))
@@ -477,76 +600,78 @@
 	char *p;
 	char cleaned_name[MAXPATHLEN];
 	char linkbuf[MAXPATHLEN];
 	extern int module_id;
 
 	strlcpy(cleaned_name, fname, MAXPATHLEN);
-	cleaned_name[MAXPATHLEN-1] = 0;
+	cleaned_name[MAXPATHLEN - 1] = 0;
 	clean_fname(cleaned_name);
 	if (sanitize_paths) {
 		sanitize_path(cleaned_name, NULL);
 	}
 	fname = cleaned_name;
 
-	memset(sum,0,SUM_LENGTH);
+	memset(sum, 0, SUM_LENGTH);
 
-	if (readlink_stat(fname,&st,linkbuf) != 0) {
+	if (readlink_stat(fname, &st, linkbuf) != 0) {
 		int save_errno = errno;
 		if ((errno == ENOENT) && copy_links && !noexcludes) {
 			/* symlink pointing nowhere, see if excluded */
-			memset((char *)&st, 0, sizeof(st));
-			if (check_exclude_file(f,fname,&st)) {
+			memset((char *) &st, 0, sizeof(st));
+			if (check_exclude_file(f, fname, &st)) {
 				/* file is excluded anyway, ignore silently */
 				return NULL;
 			}
 		}
 		io_error = 1;
-		rprintf(FERROR,"readlink %s: %s\n",
-			fname,strerror(save_errno));
+		rprintf(FERROR, "readlink %s: %s\n",
+			fname, strerror(save_errno));
 		return NULL;
 	}
 
 	/* we use noexcludes from backup.c */
-	if (noexcludes) goto skip_excludes;
+	if (noexcludes)
+		goto skip_excludes;
 
 	if (S_ISDIR(st.st_mode) && !recurse) {
-		rprintf(FINFO,"skipping directory %s\n",fname);
+		rprintf(FINFO, "skipping directory %s\n", fname);
 		return NULL;
 	}
-	
+
 	if (one_file_system && st.st_dev != filesystem_dev) {
 		if (skip_filesystem(fname, &st))
 			return NULL;
 	}
-	
-	if (check_exclude_file(f,fname,&st))
+
+	if (check_exclude_file(f, fname, &st))
 		return NULL;
 
 
-	if (lp_ignore_nonreadable(module_id) && access(fname, R_OK) != 0) 
+	if (lp_ignore_nonreadable(module_id) && access(fname, R_OK) != 0)
 		return NULL;
 
- skip_excludes:
+      skip_excludes:
 
 	if (verbose > 2)
-		rprintf(FINFO,"make_file(%d,%s)\n",f,fname);
-	
-	file = (struct file_struct *)malloc(sizeof(*file));
-	if (!file) out_of_memory("make_file");
-	memset((char *)file,0,sizeof(*file));
+		rprintf(FINFO, "make_file(%d,%s)\n", f, fname);
+
+	file = (struct file_struct *) malloc(sizeof(*file));
+	if (!file)
+		out_of_memory("make_file");
+	memset((char *) file, 0, sizeof(*file));
 
-	if ((p = strrchr(fname,'/'))) {
+	if ((p = strrchr(fname, '/'))) {
 		static char *lastdir;
 		*p = 0;
-		if (lastdir && strcmp(fname, lastdir)==0) {
+		if (lastdir && strcmp(fname, lastdir) == 0) {
 			file->dirname = lastdir;
 		} else {
 			file->dirname = strdup(fname);
 			lastdir = file->dirname;
 		}
-		file->basename = STRDUP(ap, p+1);
+		file->basename = STRDUP(ap, p + 1);
 		*p = '/';
 	} else {
 		file->dirname = NULL;
 		file->basename = STRDUP(ap, fname);
 	}
 
@@ -554,38 +679,39 @@
 	file->length = st.st_size;
 	file->mode = st.st_mode;
 	file->uid = st.st_uid;
 	file->gid = st.st_gid;
 	file->dev = st.st_dev;
 	file->inode = st.st_ino;
-#ifdef HAVE_ST_RDEV
+#ifdef HAVE_STRUCT_STAT_ST_RDEV
 	file->rdev = st.st_rdev;
 #endif
 
 #if SUPPORT_LINKS
 	if (S_ISLNK(st.st_mode)) {
 		file->link = STRDUP(ap, linkbuf);
 	}
 #endif
 
 	if (always_checksum) {
-		file->sum = (char *)MALLOC(ap, MD4_SUM_LENGTH);
-		if (!file->sum) out_of_memory("md4 sum");
+		file->sum = (char *) MALLOC(ap, MD4_SUM_LENGTH);
+		if (!file->sum)
+			out_of_memory("md4 sum");
 		/* drat. we have to provide a null checksum for non-regular
 		   files in order to be compatible with earlier versions
 		   of rsync */
 		if (S_ISREG(st.st_mode)) {
-			file_checksum(fname,file->sum,st.st_size);
+			file_checksum(fname, file->sum, st.st_size);
 		} else {
 			memset(file->sum, 0, MD4_SUM_LENGTH);
 		}
-	}       
+	}
 
 	if (flist_dir) {
 		static char *lastdir;
-		if (lastdir && strcmp(lastdir, flist_dir)==0) {
+		if (lastdir && strcmp(lastdir, flist_dir) == 0) {
 			file->basedir = lastdir;
 		} else {
 			file->basedir = strdup(flist_dir);
 			lastdir = file->basedir;
 		}
 	} else {
@@ -597,121 +723,124 @@
 
 	return file;
 }
 
 
 
-void send_file_name(int f,struct file_list *flist,char *fname,
-			   int recursive, unsigned base_flags)
+void send_file_name(int f, struct file_list *flist, char *fname,
+		    int recursive, unsigned base_flags)
 {
-  struct file_struct *file;
+	struct file_struct *file;
+
+	file = make_file(f, fname, &flist->string_area, 0);
 
-  file = make_file(f,fname, &flist->string_area, 0);
+	if (!file)
+		return;
+
+	if (show_build_progress_p() & !(flist->count % 100))
+		emit_build_progress(flist);
+
+	flist_expand(flist);
+
+	if (write_batch)	/*  dw  */
+		file->flags = FLAG_DELETE;
 
-  if (!file) return;  
-  
-  if (flist->count >= flist->malloced) {
-	  if (flist->malloced < 1000)
-		  flist->malloced += 1000;
-	  else
-		  flist->malloced *= 2;
-	  flist->files = (struct file_struct **)realloc(flist->files,
-							sizeof(flist->files[0])*
-							flist->malloced);
-	  if (!flist->files)
-		  out_of_memory("send_file_name");
-  }
-
-  if (write_batch) /*  dw  */
-    file->flags = FLAG_DELETE;
-
-  if (strcmp(file->basename,"")) {
-    flist->files[flist->count++] = file;
-    send_file_entry(file,f,base_flags);
-  }
-
-  if (S_ISDIR(file->mode) && recursive) {
-	  struct exclude_struct **last_exclude_list = local_exclude_list;
-	  send_directory(f,flist,f_name(file));
-	  local_exclude_list = last_exclude_list;
-	  return;
-  }
+	if (strcmp(file->basename, "")) {
+		flist->files[flist->count++] = file;
+		send_file_entry(file, f, base_flags);
+	}
+
+	if (S_ISDIR(file->mode) && recursive) {
+		struct exclude_struct **last_exclude_list =
+		    local_exclude_list;
+		send_directory(f, flist, f_name(file));
+		local_exclude_list = last_exclude_list;
+		return;
+	}
 }
 
 
 
-static void send_directory(int f,struct file_list *flist,char *dir)
+static void send_directory(int f, struct file_list *flist, char *dir)
 {
 	DIR *d;
 	struct dirent *di;
 	char fname[MAXPATHLEN];
 	int l;
 	char *p;
 
 	d = opendir(dir);
 	if (!d) {
 		io_error = 1;
-		rprintf(FERROR,"opendir(%s): %s\n",
-			dir,strerror(errno));
+		rprintf(FERROR, "opendir(%s): %s\n", dir, strerror(errno));
 		return;
 	}
 
-	strlcpy(fname,dir,MAXPATHLEN);
+	strlcpy(fname, dir, MAXPATHLEN);
 	l = strlen(fname);
-	if (fname[l-1] != '/') {
-		if (l == MAXPATHLEN-1) {
+	if (fname[l - 1] != '/') {
+		if (l == MAXPATHLEN - 1) {
 			io_error = 1;
-			rprintf(FERROR,"skipping long-named directory %s\n",fname);
+			rprintf(FERROR,
+				"skipping long-named directory %s\n",
+				fname);
 			closedir(d);
 			return;
 		}
-		strlcat(fname,"/", MAXPATHLEN);
+		strlcat(fname, "/", MAXPATHLEN);
 		l++;
 	}
 	p = fname + strlen(fname);
 
 	local_exclude_list = NULL;
 
 	if (cvs_exclude) {
-		if (strlen(fname) + strlen(".cvsignore") <= MAXPATHLEN-1) {
-			strcpy(p,".cvsignore");
-			local_exclude_list = make_exclude_list(fname,NULL,0,0);
+		if (strlen(fname) + strlen(".cvsignore") <= MAXPATHLEN - 1) {
+			strcpy(p, ".cvsignore");
+			local_exclude_list =
+			    make_exclude_list(fname, NULL, 0, 0);
 		} else {
 			io_error = 1;
-			rprintf(FINFO,"cannot cvs-exclude in long-named directory %s\n",fname);
+			rprintf(FINFO,
+				"cannot cvs-exclude in long-named directory %s\n",
+				fname);
 		}
-	}  
-	
-	for (di=readdir(d); di; di=readdir(d)) {
+	}
+
+	for (di = readdir(d); di; di = readdir(d)) {
 		char *dname = d_name(di);
-		if (strcmp(dname,".")==0 ||
-		    strcmp(dname,"..")==0)
+		if (strcmp(dname, ".") == 0 || strcmp(dname, "..") == 0)
 			continue;
-		strlcpy(p,dname,MAXPATHLEN-l);
-		send_file_name(f,flist,fname,recurse,0);
+		strlcpy(p, dname, MAXPATHLEN - l);
+		send_file_name(f, flist, fname, recurse, 0);
 	}
 
 	if (local_exclude_list) {
 		add_exclude_list("!", &local_exclude_list, 0);
 	}
 
 	closedir(d);
 }
 
 
-struct file_list *send_file_list(int f,int argc,char *argv[])
+/*
+ *
+ * I *think* f==-1 means that the list should just be built in memory
+ * and not transmitted.  But who can tell? -- mbp
+ */
+struct file_list *send_file_list(int f, int argc, char *argv[])
 {
-	int i,l;
+	int i, l;
 	STRUCT_STAT st;
-	char *p,*dir,*olddir;
-	char lastpath[MAXPATHLEN]="";
+	char *p, *dir, *olddir;
+	char lastpath[MAXPATHLEN] = "";
 	struct file_list *flist;
 	int64 start_write;
 
 	if (verbose && recurse && !am_server && f != -1) {
-		rprintf(FINFO,"building file list ... ");
+		rprintf(FINFO, RSYNC_NAME ": building file list...\n");
                 if (verbose > 1)
                         rprintf(FINFO, "\n");
 		rflush(FINFO);
 	}
 
 	start_write = stats.total_written;
@@ -719,315 +848,323 @@
 	flist = flist_new();
 
 	if (f != -1) {
 		io_start_buffering(f);
 	}
 
-	for (i=0;i<argc;i++) {
+	for (i = 0; i < argc; i++) {
 		char *fname = topsrcname;
 
-		strlcpy(fname,argv[i],MAXPATHLEN);
+		strlcpy(fname, argv[i], MAXPATHLEN);
 
 		l = strlen(fname);
-		if (l != 1 && fname[l-1] == '/') {
+		if (l != 1 && fname[l - 1] == '/') {
 			if ((l == 2) && (fname[0] == '.')) {
 				/*  Turn ./ into just . rather than ./.
-				    This was put in to avoid a problem with
-				      rsync -aR --delete from ./
-				    The send_file_name() below of ./ was
-				    mysteriously preventing deletes */
+				   This was put in to avoid a problem with
+				   rsync -aR --delete from ./
+				   The send_file_name() below of ./ was
+				   mysteriously preventing deletes */
 				fname[1] = 0;
 			} else {
-				strlcat(fname,".",MAXPATHLEN);
+				strlcat(fname, ".", MAXPATHLEN);
 			}
 		}
 
-		if (link_stat(fname,&st) != 0) {
+		if (link_stat(fname, &st) != 0) {
 			if (f != -1) {
-				io_error=1;
-				rprintf(FERROR,"link_stat %s : %s\n",fname,strerror(errno));
+				io_error = 1;
+				rprintf(FERROR, "link_stat %s : %s\n",
+					fname, strerror(errno));
 			}
 			continue;
 		}
 
 		if (S_ISDIR(st.st_mode) && !recurse) {
-			rprintf(FINFO,"skipping directory %s\n",fname);
+			rprintf(FINFO, "skipping directory %s\n", fname);
 			continue;
 		}
 
 		dir = NULL;
 		olddir = NULL;
 
 		if (!relative_paths) {
-			p = strrchr(fname,'/');
+			p = strrchr(fname, '/');
 			if (p) {
 				*p = 0;
-				if (p == fname) 
+				if (p == fname)
 					dir = "/";
 				else
-					dir = fname;      
-				fname = p+1;      
+					dir = fname;
+				fname = p + 1;
 			}
-		} else if (f != -1 && (p=strrchr(fname,'/'))) {
+		} else if (f != -1 && (p = strrchr(fname, '/'))) {
 			/* this ensures we send the intermediate directories,
 			   thus getting their permissions right */
 			*p = 0;
-			if (strcmp(lastpath,fname)) {
+			if (strcmp(lastpath, fname)) {
 				strlcpy(lastpath, fname, sizeof(lastpath));
 				*p = '/';
-				for (p=fname+1; (p=strchr(p,'/')); p++) {
+				for (p = fname + 1; (p = strchr(p, '/'));
+				     p++) {
 					int copy_links_saved = copy_links;
 					int recurse_saved = recurse;
 					*p = 0;
 					copy_links = copy_unsafe_links;
 					/* set recurse to 1 to prevent make_file
 					   from ignoring directory, but still
 					   turn off the recursive parameter to
 					   send_file_name */
 					recurse = 1;
-					send_file_name(f, flist, fname, 0, 0);
+					send_file_name(f, flist, fname, 0,
+						       0);
 					copy_links = copy_links_saved;
 					recurse = recurse_saved;
 					*p = '/';
 				}
 			} else {
 				*p = '/';
 			}
 		}
-		
+
 		if (!*fname)
 			fname = ".";
-		
+
 		if (dir && *dir) {
 			olddir = push_dir(dir, 1);
 
 			if (!olddir) {
-				io_error=1;
-				rprintf(FERROR,"push_dir %s : %s\n",
-					dir,strerror(errno));
+				io_error = 1;
+				rprintf(FERROR, "push_dir %s : %s\n",
+					dir, strerror(errno));
 				continue;
 			}
 
 			flist_dir = dir;
 		}
-		
+
 		if (one_file_system)
 			set_filesystem(fname);
 
-		send_file_name(f,flist,fname,recurse,FLAG_DELETE);
+		send_file_name(f, flist, fname, recurse, FLAG_DELETE);
 
 		if (olddir != NULL) {
 			flist_dir = NULL;
 			if (pop_dir(olddir) != 0) {
-				rprintf(FERROR,"pop_dir %s : %s\n",
-					dir,strerror(errno));
+				rprintf(FERROR, "pop_dir %s : %s\n",
+					dir, strerror(errno));
 				exit_cleanup(RERR_FILESELECT);
 			}
 		}
 	}
 
 	topsrcname[0] = '\0';
 
 	if (f != -1) {
-		send_file_entry(NULL,f,0);
+		send_file_entry(NULL, f, 0);
 	}
 
-	if (verbose && recurse && !am_server && f != -1)
-		rprintf(FINFO,"done\n");
-	
+	finish_build_progress(flist);
+
 	clean_flist(flist, 0);
-	
+
 	/* now send the uid/gid list. This was introduced in protocol
            version 15 */
 	if (f != -1 && remote_version >= 15) {
 		send_uid_list(f);
 	}
 
 	/* if protocol version is >= 17 then send the io_error flag */
 	if (f != -1 && remote_version >= 17) {
 		extern int module_id;
-		write_int(f, lp_ignore_errors(module_id)? 0 : io_error);
+		write_int(f, lp_ignore_errors(module_id) ? 0 : io_error);
 	}
 
 	if (f != -1) {
-		io_end_buffering(f);
+		io_end_buffering();
 		stats.flist_size = stats.total_written - start_write;
 		stats.num_files = flist->count;
-		if (write_batch) /*  dw  */
-		    write_batch_flist_info(flist->count, flist->files);
+		if (write_batch)	/*  dw  */
+			write_batch_flist_info(flist->count, flist->files);
 	}
 
 	if (verbose > 2)
-		rprintf(FINFO,"send_file_list done\n");
+		rprintf(FINFO, "send_file_list done\n");
 
 	return flist;
 }
 
 
 struct file_list *recv_file_list(int f)
 {
-  struct file_list *flist;
-  unsigned char flags;
-  int64 start_read;
-  extern int list_only;
-
-  if (verbose && recurse && !am_server) {
-    rprintf(FINFO,"receiving file list ... ");
-    rflush(FINFO);
-  }
+	struct file_list *flist;
+	unsigned char flags;
+	int64 start_read;
+	extern int list_only;
 
-  start_read = stats.total_read;
+	if (verbose && recurse && !am_server) {
+		rprintf(FINFO, "receiving file list ... ");
+		rflush(FINFO);
+	}
 
-  flist = (struct file_list *)malloc(sizeof(flist[0]));
-  if (!flist)
-    goto oom;
+	start_read = stats.total_read;
 
-  flist->count=0;
-  flist->malloced=1000;
-  flist->files = (struct file_struct **)malloc(sizeof(flist->files[0])*
-					       flist->malloced);
-  if (!flist->files)
-    goto oom;
+	flist = (struct file_list *) malloc(sizeof(flist[0]));
+	if (!flist)
+		goto oom;
 
+	flist->count = 0;
+	flist->malloced = 1000;
+	flist->files =
+	    (struct file_struct **) malloc(sizeof(flist->files[0]) *
+					   flist->malloced);
+	if (!flist->files)
+		goto oom;
 
-  for (flags=read_byte(f); flags; flags=read_byte(f)) {
-    int i = flist->count;
 
-    if (i >= flist->malloced) {
-	  if (flist->malloced < 1000)
-		  flist->malloced += 1000;
-	  else
-		  flist->malloced *= 2;
-	  flist->files =(struct file_struct **)realloc(flist->files,
-						       sizeof(flist->files[0])*
-						       flist->malloced);
-	  if (!flist->files)
-		  goto oom;
-    }
+	for (flags = read_byte(f); flags; flags = read_byte(f)) {
+		int i = flist->count;
+		
+		flist_expand(flist);
 
-    receive_file_entry(&flist->files[i],flags,f);
+		receive_file_entry(&flist->files[i], flags, f);
 
-    if (S_ISREG(flist->files[i]->mode))
-	    stats.total_size += flist->files[i]->length;
+		if (S_ISREG(flist->files[i]->mode))
+			stats.total_size += flist->files[i]->length;
 
-    flist->count++;
+		flist->count++;
 
-    if (verbose > 2)
-      rprintf(FINFO,"recv_file_name(%s)\n",f_name(flist->files[i]));
-  }
+		if (verbose > 2)
+			rprintf(FINFO, "recv_file_name(%s)\n",
+				f_name(flist->files[i]));
+	}
 
 
-  if (verbose > 2)
-    rprintf(FINFO,"received %d names\n",flist->count);
+	if (verbose > 2)
+		rprintf(FINFO, "received %d names\n", flist->count);
 
-  clean_flist(flist, relative_paths);
+	clean_flist(flist, relative_paths);
 
-  if (verbose && recurse && !am_server) {
-    rprintf(FINFO,"done\n");
-  }
+	if (verbose && recurse && !am_server) {
+		rprintf(FINFO, "done\n");
+	}
 
-  /* now recv the uid/gid list. This was introduced in protocol version 15 */
-  if (f != -1 && remote_version >= 15) {
-	  recv_uid_list(f, flist);
-  }
+	/* now recv the uid/gid list. This was introduced in protocol version 15 */
+	if (f != -1 && remote_version >= 15) {
+		recv_uid_list(f, flist);
+	}
 
-  /* if protocol version is >= 17 then recv the io_error flag */
-  if (f != -1 && remote_version >= 17  && !read_batch) {  /* dw-added readbatch */
-	  extern int module_id;
-	  extern int ignore_errors;
-	  if (lp_ignore_errors(module_id) || ignore_errors) {
-		  read_int(f);
-	  } else {
-		  io_error |= read_int(f);
-	  }
-  }
+	/* if protocol version is >= 17 then recv the io_error flag */
+	if (f != -1 && remote_version >= 17 && !read_batch) {	/* dw-added readbatch */
+		extern int module_id;
+		extern int ignore_errors;
+		if (lp_ignore_errors(module_id) || ignore_errors) {
+			read_int(f);
+		} else {
+			io_error |= read_int(f);
+		}
+	}
 
-  if (list_only) {
-	  int i;
-	  for (i=0;i<flist->count;i++) {
-		  list_file_entry(flist->files[i]);
-	  }
-  }
+	if (list_only) {
+		int i;
+		for (i = 0; i < flist->count; i++) {
+			list_file_entry(flist->files[i]);
+		}
+	}
 
 
-  if (verbose > 2)
-    rprintf(FINFO,"recv_file_list done\n");
+	if (verbose > 2)
+		rprintf(FINFO, "recv_file_list done\n");
 
-  stats.flist_size = stats.total_read - start_read;
-  stats.num_files = flist->count;
+	stats.flist_size = stats.total_read - start_read;
+	stats.num_files = flist->count;
 
-  return flist;
+	return flist;
 
-oom:
-    out_of_memory("recv_file_list");
-    return NULL; /* not reached */
+      oom:
+	out_of_memory("recv_file_list");
+	return NULL;		/* not reached */
 }
 
 
-int file_compare(struct file_struct **f1,struct file_struct **f2)
+/*
+ * XXX: This is currently the hottest function while building the file
+ * list, because building f_name()s every time is expensive.
+ **/
+int file_compare(struct file_struct **f1, struct file_struct **f2)
 {
-	if (!(*f1)->basename && !(*f2)->basename) return 0;
-	if (!(*f1)->basename) return -1;
-	if (!(*f2)->basename) return 1;
+	if (!(*f1)->basename && !(*f2)->basename)
+		return 0;
+	if (!(*f1)->basename)
+		return -1;
+	if (!(*f2)->basename)
+		return 1;
 	if ((*f1)->dirname == (*f2)->dirname)
 		return u_strcmp((*f1)->basename, (*f2)->basename);
-	return u_strcmp(f_name(*f1),f_name(*f2));
+	return u_strcmp(f_name(*f1), f_name(*f2));
 }
 
 
-int flist_find(struct file_list *flist,struct file_struct *f)
+int flist_find(struct file_list *flist, struct file_struct *f)
 {
-	int low=0,high=flist->count-1;
+	int low = 0, high = flist->count - 1;
 
-	if (flist->count <= 0) return -1;
+	if (flist->count <= 0)
+		return -1;
 
 	while (low != high) {
-		int mid = (low+high)/2;
-		int ret = file_compare(&flist->files[flist_up(flist, mid)],&f);
-		if (ret == 0) return flist_up(flist, mid);
+		int mid = (low + high) / 2;
+		int ret =
+		    file_compare(&flist->files[flist_up(flist, mid)], &f);
+		if (ret == 0)
+			return flist_up(flist, mid);
 		if (ret > 0) {
-			high=mid;
+			high = mid;
 		} else {
-			low=mid+1;
+			low = mid + 1;
 		}
 	}
 
-	if (file_compare(&flist->files[flist_up(flist,low)],&f) == 0)
-		return flist_up(flist,low);
+	if (file_compare(&flist->files[flist_up(flist, low)], &f) == 0)
+		return flist_up(flist, low);
 	return -1;
 }
 
 
 /*
  * free up one file
  */
 void free_file(struct file_struct *file)
 {
-	if (!file) return;
-	if (file->basename) free(file->basename);
-	if (file->link) free(file->link);
-	if (file->sum) free(file->sum);
+	if (!file)
+		return;
+	if (file->basename)
+		free(file->basename);
+	if (file->link)
+		free(file->link);
+	if (file->sum)
+		free(file->sum);
 	*file = null_file;
 }
 
 
 /*
  * allocate a new file list
  */
 struct file_list *flist_new()
 {
 	struct file_list *flist;
 
-	flist = (struct file_list *)malloc(sizeof(flist[0]));
-	if (!flist) out_of_memory("send_file_list");
+	flist = (struct file_list *) malloc(sizeof(flist[0]));
+	if (!flist)
+		out_of_memory("send_file_list");
+
+	flist->count = 0;
+	flist->malloced = 0;
+	flist->files = NULL;
 
-	flist->count=0;
-	flist->malloced = 1000;
-	flist->files = (struct file_struct **)malloc(sizeof(flist->files[0])*
-						     flist->malloced);
-	if (!flist->files) out_of_memory("send_file_list");
 #if ARENA_SIZE > 0
 	flist->string_area = string_area_new(0);
 #else
 	flist->string_area = NULL;
 #endif
 	return flist;
@@ -1035,109 +1173,127 @@
 /*
  * free up all elements in a flist
  */
 void flist_free(struct file_list *flist)
 {
 	int i;
-	for (i=1;i<flist->count;i++) {
+	for (i = 1; i < flist->count; i++) {
 		if (!flist->string_area)
 			free_file(flist->files[i]);
 		free(flist->files[i]);
-	}	
-	memset((char *)flist->files, 0, sizeof(flist->files[0])*flist->count);
+	}
+	/* FIXME: I don't think we generally need to blank the flist
+	 * since it's about to be freed.  This will just cause more
+	 * memory traffic.  If you want a freed-memory debugger, you
+	 * know where to get it. */
+	memset((char *) flist->files, 0,
+	       sizeof(flist->files[0]) * flist->count);
 	free(flist->files);
 	if (flist->string_area)
 		string_area_free(flist->string_area);
-	memset((char *)flist, 0, sizeof(*flist));
+	memset((char *) flist, 0, sizeof(*flist));
 	free(flist);
 }
 
 
 /*
  * This routine ensures we don't have any duplicate names in our file list.
  * duplicate names can cause corruption because of the pipelining 
  */
 static void clean_flist(struct file_list *flist, int strip_root)
 {
 	int i;
 
-	if (!flist || flist->count == 0) 
+	if (!flist || flist->count == 0)
 		return;
-  
-	qsort(flist->files,flist->count,
-	      sizeof(flist->files[0]),
-	      (int (*)())file_compare);
 
-	for (i=1;i<flist->count;i++) {
+	qsort(flist->files, flist->count,
+	      sizeof(flist->files[0]), (int (*)()) file_compare);
+
+	for (i = 1; i < flist->count; i++) {
 		if (flist->files[i]->basename &&
-		    flist->files[i-1]->basename &&
+		    flist->files[i - 1]->basename &&
 		    strcmp(f_name(flist->files[i]),
-			   f_name(flist->files[i-1])) == 0) {
+			   f_name(flist->files[i - 1])) == 0) {
 			if (verbose > 1 && !am_server)
-				rprintf(FINFO,"removing duplicate name %s from file list %d\n",
-					f_name(flist->files[i-1]),i-1);
+				rprintf(FINFO,
+					"removing duplicate name %s from file list %d\n",
+					f_name(flist->files[i - 1]),
+					i - 1);
 			/* it's not great that the flist knows the semantics of the
 			 * file memory usage, but i'd rather not add a flag byte
 			 * to that struct. XXX can i use a bit in the flags field? */
 			if (flist->string_area)
 				flist->files[i][0] = null_file;
 			else
 				free_file(flist->files[i]);
-		} 
+		}
 	}
 
+	/* FIXME: There is a bug here when filenames are repeated more
+	 * than once, because we don't handle freed files when doing
+	 * the comparison. */
+
 	if (strip_root) {
 		/* we need to strip off the root directory in the case
 		   of relative paths, but this must be done _after_
 		   the sorting phase */
-		for (i=0;i<flist->count;i++) {
+		for (i = 0; i < flist->count; i++) {
 			if (flist->files[i]->dirname &&
 			    flist->files[i]->dirname[0] == '/') {
 				memmove(&flist->files[i]->dirname[0],
 					&flist->files[i]->dirname[1],
 					strlen(flist->files[i]->dirname));
 			}
-			
-			if (flist->files[i]->dirname && 
+
+			if (flist->files[i]->dirname &&
 			    !flist->files[i]->dirname[0]) {
 				flist->files[i]->dirname = NULL;
 			}
 		}
 	}
 
 
-	if (verbose <= 3) return;
+	if (verbose <= 3)
+		return;
 
-	for (i=0;i<flist->count;i++) {
-		rprintf(FINFO,"[%d] i=%d %s %s mode=0%o len=%.0f\n",
-			(int) getpid(), i, 
+	for (i = 0; i < flist->count; i++) {
+		rprintf(FINFO, "[%d] i=%d %s %s mode=0%o len=%.0f\n",
+			(int) getpid(), i,
 			NS(flist->files[i]->dirname),
 			NS(flist->files[i]->basename),
 			(int) flist->files[i]->mode,
-			(double)flist->files[i]->length);
+			(double) flist->files[i]->length);
 	}
 }
 
 
 /*
  * return the full filename of a flist entry
+ *
+ * This function is too expensive at the moment, because it copies
+ * strings when often we only want to compare them.  In any case,
+ * using strlcat is silly because it will walk the string repeatedly.
  */
 char *f_name(struct file_struct *f)
 {
 	static char names[10][MAXPATHLEN];
 	static int n;
 	char *p = names[n];
 
-	if (!f || !f->basename) return NULL;
+	if (!f || !f->basename)
+		return NULL;
 
-	n = (n+1)%10;
+	n = (n + 1) % 10;
 
 	if (f->dirname) {
-		strlcpy(p, f->dirname, MAXPATHLEN);
-		strlcat(p, "/", MAXPATHLEN);
-		strlcat(p, f->basename, MAXPATHLEN);
+		int off;
+
+		off = strlcpy(p, f->dirname, MAXPATHLEN);
+		off += strlcpy(p + off, "/", MAXPATHLEN - off);
+		off += strlcpy(p + off, f->basename, MAXPATHLEN - off);
 	} else {
 		strlcpy(p, f->basename, MAXPATHLEN);
 	}
 
 	return p;
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/generator.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/generator.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/generator.c	2002-01-03 15:09:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/generator.c	2002-01-25 18:42:23.000000000 +0800
@@ -1,10 +1,13 @@
 /* -*- c-file-style: "linux" -*-
+
+   rsync -- fast file replication program
    
    Copyright (C) 1996-2000 by Andrew Tridgell 
    Copyright (C) Paul Mackerras 1996
+   Copyright (C) 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -25,12 +28,13 @@
 extern int relative_paths;
 extern int preserve_links;
 extern int am_root;
 extern int preserve_devices;
 extern int preserve_hard_links;
 extern int update_only;
+extern int opt_ignore_existing;
 extern int whole_file;
 extern int block_size;
 extern int csum_length;
 extern int ignore_times;
 extern int size_only;
 extern int io_timeout;
@@ -96,31 +100,36 @@
 }
 
 
 /*
   send a sums struct down a fd
   */
-static void send_sums(struct sum_struct *s,int f_out)
+static void send_sums(struct sum_struct *s, int f_out)
 {
-	int i;
-	
-	/* tell the other guy how many we are going to be doing and how many
-	   bytes there are in the last chunk */
-	write_int(f_out,s?s->count:0);
-	write_int(f_out,s?s->n:block_size);
-	write_int(f_out,s?s->remainder:0);
-
-	if (!s) return;
-
-	for (i=0;i<s->count;i++) {
-		write_int(f_out,s->sums[i].sum1);
-		write_buf(f_out,s->sums[i].sum2,csum_length);
+	if (s) {
+		size_t i;
+
+		/* tell the other guy how many we are going to be
+		   doing and how many bytes there are in the last
+		   chunk */
+		write_int(f_out, s->count);
+		write_int(f_out, s->n);
+		write_int(f_out, s->remainder);
+
+		for (i = 0; i < s->count; i++) {
+			write_int(f_out, s->sums[i].sum1);
+			write_buf(f_out, s->sums[i].sum2, csum_length);
+		}
+	} else {
+		/* we don't have checksums */
+		write_int(f_out, 0);
+		write_int(f_out, block_size);
+		write_int(f_out, 0);
 	}
 }
 
-
 /*
   generate a stream of signatures/checksums that describe a buffer
 
   generate approximately one checksum every n bytes
   */
 static struct sum_struct *generate_sums(struct map_struct *buf,OFF_T len,int n)
@@ -372,12 +381,18 @@
 		/* now pretend the file didn't exist */
 		write_int(f_out,i);
 		if (!dry_run) send_sums(NULL,f_out);    
 		return;
 	}
 
+	if (opt_ignore_existing && fnamecmp == fname) { 
+		if (verbose > 1)
+			rprintf(FINFO,"%s exists\n",fname);
+		return;
+	} 
+
 	if (update_only && cmp_modtime(st.st_mtime,file->modtime)>0 && fnamecmp == fname) {
 		if (verbose > 1)
 			rprintf(FINFO,"%s is newer\n",fname);
 		return;
 	}
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/hlink.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/hlink.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/hlink.c	1999-03-16 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/hlink.c	2002-01-23 15:42:30.000000000 +0800
@@ -1,9 +1,10 @@
 /* 
    Copyright (C) Andrew Tridgell 1996
    Copyright (C) Paul Mackerras 1996
+   Copyright (C) 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -20,137 +21,159 @@
 #include "rsync.h"
 
 extern int dry_run;
 extern int verbose;
 
 #if SUPPORT_HARD_LINKS
-static int hlink_compare(struct file_struct *f1,struct file_struct *f2)
+static int hlink_compare(struct file_struct *f1, struct file_struct *f2)
 {
-  if (!S_ISREG(f1->mode) && !S_ISREG(f2->mode)) return 0;
-  if (!S_ISREG(f1->mode)) return -1;
-  if (!S_ISREG(f2->mode)) return 1;
+	if (!S_ISREG(f1->mode) && !S_ISREG(f2->mode))
+		return 0;
+	if (!S_ISREG(f1->mode))
+		return -1;
+	if (!S_ISREG(f2->mode))
+		return 1;
 
-  if (f1->dev != f2->dev) 
-    return (int)(f1->dev>f2->dev?1:-1);
+	if (f1->dev != f2->dev)
+		return (int) (f1->dev > f2->dev ? 1 : -1);
 
-  if (f1->inode != f2->inode) 
-    return (int)(f1->inode>f2->inode?1:-1);
+	if (f1->inode != f2->inode)
+		return (int) (f1->inode > f2->inode ? 1 : -1);
 
-  return file_compare(&f1,&f2);
+	return file_compare(&f1, &f2);
 }
 
 
 static struct file_struct *hlink_list;
 static int hlink_count;
 #endif
 
 void init_hard_links(struct file_list *flist)
 {
 #if SUPPORT_HARD_LINKS
 	int i;
-	if (flist->count < 2) return;
+	if (flist->count < 2)
+		return;
 
-	if (hlink_list) free(hlink_list);
-    
-	if (!(hlink_list = 
-	      (struct file_struct *)malloc(sizeof(hlink_list[0])*flist->count)))
+	if (hlink_list)
+		free(hlink_list);
+
+	if (!(hlink_list =
+	      (struct file_struct *) malloc(sizeof(hlink_list[0]) *
+					    flist->count)))
 		out_of_memory("init_hard_links");
 
 	for (i = 0; i < flist->count; i++)
-		memcpy(&hlink_list[i], flist->files[i], sizeof(hlink_list[0]));
+		memcpy(&hlink_list[i], flist->files[i],
+		       sizeof(hlink_list[0]));
 
-	qsort(hlink_list,flist->count,
-	      sizeof(hlink_list[0]),
-	      (int (*)())hlink_compare);
+	qsort(hlink_list, flist->count,
+	      sizeof(hlink_list[0]), (int (*)()) hlink_compare);
 
-	hlink_count=flist->count;
+	hlink_count = flist->count;
 #endif
 }
 
 /* check if a file should be skipped because it is the same as an
    earlier hard link */
 int check_hard_link(struct file_struct *file)
 {
 #if SUPPORT_HARD_LINKS
-  int low=0,high=hlink_count-1;
-  int ret=0;
+	int low = 0, high = hlink_count - 1;
+	int ret = 0;
+
+	if (!hlink_list || !S_ISREG(file->mode))
+		return 0;
+
+	while (low != high) {
+		int mid = (low + high) / 2;
+		ret = hlink_compare(&hlink_list[mid], file);
+		if (ret == 0) {
+			low = mid;
+			break;
+		}
+		if (ret > 0)
+			high = mid;
+		else
+			low = mid + 1;
+	}
 
-  if (!hlink_list || !S_ISREG(file->mode)) return 0;
+	if (hlink_compare(&hlink_list[low], file) != 0)
+		return 0;
 
-  while (low != high) {
-    int mid = (low+high)/2;
-    ret = hlink_compare(&hlink_list[mid],file);
-    if (ret == 0) {
-	    low = mid;
-	    break;
-    }
-    if (ret > 0) 
-      high=mid;
-    else
-      low=mid+1;
-  }
-
-  if (hlink_compare(&hlink_list[low],file) != 0) return 0;
-
-  if (low > 0 &&
-      S_ISREG(hlink_list[low-1].mode) &&
-      file->dev == hlink_list[low-1].dev &&
-      file->inode == hlink_list[low-1].inode)
-    return 1;
+	if (low > 0 &&
+	    S_ISREG(hlink_list[low - 1].mode) &&
+	    file->dev == hlink_list[low - 1].dev &&
+	    file->inode == hlink_list[low - 1].inode)
+		return 1;
 #endif
 
-  return 0;
+	return 0;
 }
 
 
 #if SUPPORT_HARD_LINKS
 static void hard_link_one(int i)
 {
-	STRUCT_STAT st1,st2;
+	STRUCT_STAT st1, st2;
 
-	if (link_stat(f_name(&hlink_list[i-1]),&st1) != 0) return;
+	if (link_stat(f_name(&hlink_list[i - 1]), &st1) != 0)
+		return;
 
-	if (link_stat(f_name(&hlink_list[i]),&st2) != 0) {
-		if (do_link(f_name(&hlink_list[i-1]),f_name(&hlink_list[i])) != 0) {
+	if (link_stat(f_name(&hlink_list[i]), &st2) != 0) {
+		if (do_link
+		    (f_name(&hlink_list[i - 1]),
+		     f_name(&hlink_list[i])) != 0) {
 			if (verbose > 0)
-				rprintf(FINFO,"link %s => %s : %s\n",
+				rprintf(FINFO, "link %s => %s : %s\n",
 					f_name(&hlink_list[i]),
-					f_name(&hlink_list[i-1]),strerror(errno));
+					f_name(&hlink_list[i - 1]),
+					strerror(errno));
 			return;
 		}
 	} else {
-		if (st2.st_dev == st1.st_dev && st2.st_ino == st1.st_ino) return;
-		
+		if (st2.st_dev == st1.st_dev && st2.st_ino == st1.st_ino)
+			return;
+
 		if (robust_unlink(f_name(&hlink_list[i])) != 0 ||
-		    do_link(f_name(&hlink_list[i-1]),f_name(&hlink_list[i])) != 0) {
+		    do_link(f_name(&hlink_list[i - 1]),
+			    f_name(&hlink_list[i])) != 0) {
 			if (verbose > 0)
-				rprintf(FINFO,"link %s => %s : %s\n",
+				rprintf(FINFO, "link %s => %s : %s\n",
 					f_name(&hlink_list[i]),
-					f_name(&hlink_list[i-1]),strerror(errno));
+					f_name(&hlink_list[i - 1]),
+					strerror(errno));
 			return;
 		}
 	}
 	if (verbose > 0)
-		rprintf(FINFO,"%s => %s\n",
-			f_name(&hlink_list[i]),f_name(&hlink_list[i-1]));
+		rprintf(FINFO, "%s => %s\n",
+			f_name(&hlink_list[i]),
+			f_name(&hlink_list[i - 1]));
 }
 #endif
 
-/* create any hard links in the flist */
-void do_hard_links(struct file_list *flist)
+
+
+/**
+ * Create any hard links in the global hlink_list.  They were put
+ * there by running init_hard_links on the filelist.
+ **/
+void do_hard_links(void)
 {
 #if SUPPORT_HARD_LINKS
 	int i;
-  
-	if (!hlink_list) return;
 
-	for (i=1;i<hlink_count;i++) {
+	if (!hlink_list)
+		return;
+
+	for (i = 1; i < hlink_count; i++) {
 		if (S_ISREG(hlink_list[i].mode) &&
-		    S_ISREG(hlink_list[i-1].mode) &&
-		    hlink_list[i].basename && hlink_list[i-1].basename &&
-		    hlink_list[i].dev == hlink_list[i-1].dev &&
-		    hlink_list[i].inode == hlink_list[i-1].inode) {
+		    S_ISREG(hlink_list[i - 1].mode) &&
+		    hlink_list[i].basename && hlink_list[i - 1].basename &&
+		    hlink_list[i].dev == hlink_list[i - 1].dev &&
+		    hlink_list[i].inode == hlink_list[i - 1].inode) {
 			hard_link_one(i);
-		}	
+		}
 	}
 #endif
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/io.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/io.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/io.c	2001-11-30 08:21:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/io.c	2002-01-26 07:01:50.000000000 +0800
@@ -46,13 +46,13 @@
     version is 24 or less. */
 int kludge_around_eof = False;
 
 
 static int io_error_fd = -1;
 
-static void read_loop(int fd, char *buf, int len);
+static void read_loop(int fd, char *buf, size_t len);
 
 static void check_timeout(void)
 {
 	extern int am_server, am_daemon;
 	time_t t;
 
@@ -83,13 +83,13 @@
 }
 
 /* read some data from the error fd and write it to the write log code */
 static void read_error_fd(void)
 {
 	char buf[200];
-	int n;
+	size_t n;
 	int fd = io_error_fd;
 	int tag, len;
 
         /* io_error_fd is temporarily disabled -- is this meant to
          * prevent indefinite recursion? */
 	io_error_fd = -1;
@@ -100,13 +100,14 @@
 	len = tag & 0xFFFFFF;
 	tag = tag >> 24;
 	tag -= MPLEX_BASE;
 
 	while (len) {
 		n = len;
-		if (n > (sizeof(buf)-1)) n = sizeof(buf)-1;
+		if (n > (sizeof(buf)-1))
+			n = sizeof(buf)-1;
 		read_loop(fd, buf, n);
 		rwrite((enum logcode)tag, buf, n);
 		len -= n;
 	}
 
 	io_error_fd = fd;
@@ -160,13 +161,13 @@
  * actually report an "unexpected EOF" error here.  Since it's a
  * fairly common mistake to try to use rsh when ssh is required, we
  * should trap that: if we fail to read any data at all, we should
  * give a better explanation.  We can tell whether the connection has
  * started by looking e.g. at whether the remote version is known yet.
  */
-static int read_timeout (int fd, char *buf, int len)
+static int read_timeout (int fd, char *buf, size_t len)
 {
 	int n, ret=0;
 
 	io_flush();
 
 	while (ret == 0) {
@@ -233,13 +234,13 @@
 
 
 
 
 /*! Continue trying to read len bytes - don't return until len has
   been read.   */
-static void read_loop (int fd, char *buf, int len)
+static void read_loop (int fd, char *buf, size_t len)
 {
 	while (len) {
 		int n = read_timeout(fd, buf, len);
 
 		buf += n;
 		len -= n;
@@ -250,16 +251,16 @@
 /**
  * Read from the file descriptor handling multiplexing - return number
  * of bytes read.
  * 
  * Never returns <= 0. 
  */
-static int read_unbuffered(int fd, char *buf, int len)
+static int read_unbuffered(int fd, char *buf, size_t len)
 {
-	static int remaining;
-	int tag, ret=0;
+	static size_t remaining;
+	int tag, ret = 0;
 	char line[1024];
 
 	if (!io_multiplexing_in || fd != multiplex_in_fd)
 		return read_timeout(fd, buf, len);
 
 	while (ret == 0) {
@@ -268,37 +269,38 @@
 			read_loop(fd, buf, len);
 			remaining -= len;
 			ret = len;
 			continue;
 		}
 
-		read_loop (fd, line, 4);
+		read_loop(fd, line, 4);
 		tag = IVAL(line, 0);
 
 		remaining = tag & 0xFFFFFF;
 		tag = tag >> 24;
 
-		if (tag == MPLEX_BASE) continue;
+		if (tag == MPLEX_BASE)
+			continue;
 
 		tag -= MPLEX_BASE;
 
 		if (tag != FERROR && tag != FINFO) {
-			rprintf(FERROR,"unexpected tag %d\n", tag);
+			rprintf(FERROR, "unexpected tag %d\n", tag);
 			exit_cleanup(RERR_STREAMIO);
 		}
 
-		if (remaining > sizeof(line)-1) {
-			rprintf(FERROR,"multiplexing overflow %d\n\n", 
+		if (remaining > sizeof(line) - 1) {
+			rprintf(FERROR, "multiplexing overflow %d\n\n",
 				remaining);
 			exit_cleanup(RERR_STREAMIO);
 		}
 
 		read_loop(fd, line, remaining);
 		line[remaining] = 0;
 
-		rprintf((enum logcode)tag,"%s", line);
+		rprintf((enum logcode) tag, "%s", line);
 		remaining = 0;
 	}
 
 	return ret;
 }
 
@@ -300,18 +302,19 @@
 	}
 
 	return ret;
 }
 
 
+
 /* do a buffered read from fd. don't return until all N bytes
    have been read. If all N can't be read then exit with an error */
-static void readfd (int fd, char *buffer, int N)
+static void readfd (int fd, char *buffer, size_t N)
 {
 	int  ret;
-	int total=0;  
+	size_t total=0;  
 	
 	while (total < N) {
 		io_flush();
 
 		ret = read_unbuffered (fd, buffer + total, N-total);
 		total += ret;
@@ -353,18 +356,18 @@
 	}
 #endif
 
 	return ret;
 }
 
-void read_buf(int f,char *buf,int len)
+void read_buf(int f,char *buf,size_t len)
 {
 	readfd(f,buf,len);
 }
 
-void read_sbuf(int f,char *buf,int len)
+void read_sbuf(int f,char *buf,size_t len)
 {
 	read_buf (f,buf,len);
 	buf[len] = 0;
 }
 
 unsigned char read_byte(int f)
@@ -372,15 +375,15 @@
 	unsigned char c;
 	read_buf (f, (char *)&c, 1);
 	return c;
 }
 
 /* write len bytes to fd */
-static void writefd_unbuffered(int fd,char *buf,int len)
+static void writefd_unbuffered(int fd,char *buf,size_t len)
 {
-	int total = 0;
+	size_t total = 0;
 	fd_set w_fds, r_fds;
 	int fd_count, count;
 	struct timeval tv;
 
 	err_list_push();
 
@@ -421,13 +424,14 @@
 
 		if (io_error_fd != -1 && FD_ISSET(io_error_fd, &r_fds)) {
 			read_error_fd();
 		}
 
 		if (FD_ISSET(fd, &w_fds)) {
-			int ret, n = len-total;
+			int ret;
+			size_t n = len-total;
 			ret = write(fd,buf+total,n);
 
 			if (ret == -1 && errno == EINTR) {
 				continue;
 			}
 
@@ -480,16 +484,16 @@
 	if (!io_buffer) out_of_memory("writefd");
 	io_buffer_count = 0;
 }
 
 /* write an message to a multiplexed stream. If this fails then rsync
    exits */
-static void mplex_write(int fd, enum logcode code, char *buf, int len)
+static void mplex_write(int fd, enum logcode code, char *buf, size_t len)
 {
 	char buffer[4096];
-	int n = len;
+	size_t n = len;
 
 	SIVAL(buffer, 0, ((MPLEX_BASE + (int)code)<<24) + len);
 
 	if (n > (sizeof(buffer)-4)) {
 		n = sizeof(buffer)-4;
 	}
@@ -520,35 +524,34 @@
 		writefd_unbuffered(fd, io_buffer, io_buffer_count);
 	}
 	io_buffer_count = 0;
 }
 
 
-/* XXX: fd is ignored, which seems a little strange. */
-void io_end_buffering(int fd)
+void io_end_buffering(void)
 {
 	io_flush();
 	if (!io_multiplexing_out) {
 		free(io_buffer);
 		io_buffer = NULL;
 	}
 }
 
-static void writefd(int fd,char *buf,int len)
+static void writefd(int fd,char *buf,size_t len)
 {
 	stats.total_written += len;
 
 	err_list_push();
 
 	if (!io_buffer || fd != multiplex_out_fd) {
 		writefd_unbuffered(fd, buf, len);
 		return;
 	}
 
 	while (len) {
-		int n = MIN(len, IO_BUFFER_SIZE-io_buffer_count);
+		int n = MIN((int) len, IO_BUFFER_SIZE-io_buffer_count);
 		if (n > 0) {
 			memcpy(io_buffer+io_buffer_count, buf, n);
 			buf += n;
 			len -= n;
 			io_buffer_count += n;
 		}
@@ -584,13 +587,13 @@
 	SIVAL(b,0,(x&0xFFFFFFFF));
 	SIVAL(b,4,((x>>32)&0xFFFFFFFF));
 
 	writefd(f,b,8);
 }
 
-void write_buf(int f,char *buf,int len)
+void write_buf(int f,char *buf,size_t len)
 {
 	writefd(f,buf,len);
 }
 
 /* write a string to the connection */
 static void write_sbuf(int f,char *buf)
@@ -603,13 +606,13 @@
 {
 	write_buf(f,(char *)&c,1);
 }
 
 
 
-int read_line(int f, char *buf, int maxlen)
+int read_line(int f, char *buf, size_t maxlen)
 {
 	while (maxlen) {
 		buf[0] = 0;
 		read_buf(f, buf, 1);
 		if (buf[0] == 0) return 0;
 		if (buf[0] == '\n') {
@@ -661,13 +664,13 @@
 	multiplex_in_fd = fd;
 	io_flush();
 	io_multiplexing_in = 1;
 }
 
 /* write an message to the multiplexed error stream */
-int io_multiplex_write(enum logcode code, char *buf, int len)
+int io_multiplex_write(enum logcode code, char *buf, size_t len)
 {
 	if (!io_multiplexing_out) return 0;
 
 	io_flush();
 	stats.total_written += (len+4);
 	mplex_write(multiplex_out_fd, code, buf, len);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/lib/compat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/lib/compat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/lib/compat.c	2001-11-30 08:21:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/lib/compat.c	2002-01-15 19:32:30.000000000 +0800
@@ -94,14 +94,16 @@
 	return NULL;
 }
 #endif
 
 
 #ifndef HAVE_STRLCPY
-/* like strncpy but does not 0 fill the buffer and always null 
-   terminates. bufsize is the size of the destination buffer */
+/* Like strncpy but does not 0 fill the buffer and always null 
+ * terminates. bufsize is the size of the destination buffer.
+ *
+ * Returns the index of the terminating byte. */
  size_t strlcpy(char *d, const char *s, size_t bufsize)
 {
 	size_t len = strlen(s);
 	size_t ret = len;
 	if (bufsize <= 0) return 0;
 	if (len >= bufsize) len = bufsize-1;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/lib: .cvsignore
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/log.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/log.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/log.c	2001-11-30 08:21:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/log.c	2002-01-24 10:41:38.000000000 +0800
@@ -283,19 +283,20 @@
 {
 	va_list ap;  
 	char buf[1024];
 	int len;
 
 	va_start(ap, format);
+	/* Note: might return -1 */
 	len = vsnprintf(buf, sizeof(buf), format, ap);
 	va_end(ap);
 
 	/* Deal with buffer overruns.  Instead of panicking, just
 	 * truncate the resulting string.  Note that some vsnprintf()s
 	 * return -1 on truncation, e.g., glibc 2.0.6 and earlier. */
-	if (len > sizeof(buf)-1  ||  len < 0) {
+	if ((size_t) len > sizeof(buf)-1  ||  len < 0) {
 		const char ellipsis[] = "[...]";
 
 		/* Reset length, and zero-terminate the end of our buffer */
 		len = sizeof(buf)-1;
 		buf[len] = '\0';
 
@@ -328,24 +329,27 @@
  * Note that since strerror might involve dynamically loading a
  * message catalog we need to call it once before chroot-ing. */
 void rsyserr(enum logcode code, int errcode, const char *format, ...)
 {
 	va_list ap;  
 	char buf[1024];
-	int len, sys_len;
+	int len;
+	size_t sys_len;
         char *sysmsg;
 
 	va_start(ap, format);
+	/* Note: might return <0 */
 	len = vsnprintf(buf, sizeof(buf), format, ap);
 	va_end(ap);
 
-	if (len > sizeof(buf)-1) exit_cleanup(RERR_MESSAGEIO);
+	if ((size_t) len > sizeof(buf)-1)
+		exit_cleanup(RERR_MESSAGEIO);
 
         sysmsg = strerror(errcode);
         sys_len = strlen(sysmsg);
-        if (len + 3 + sys_len > sizeof(buf) - 1)
+        if ((size_t) len + 3 + sys_len > sizeof(buf) - 1)
                 exit_cleanup(RERR_MESSAGEIO);
 
         strcpy(buf + len, ": ");
         len += 2;
         strcpy(buf + len, sysmsg);
         len += sys_len;
@@ -396,18 +400,24 @@
 {
 	extern int module_id;
 	extern char *auth_user;
 	char buf[1024];
 	char buf2[1024];
 	char *p, *s, *n;
-	int l;
+	size_t l;
 	extern struct stats stats;		
 	extern int am_sender;
 	extern int am_daemon;
 	int64 b;
 
+	/* We expand % codes one by one in place in buf.  We don't
+	 * copy in the terminating nul of the inserted strings, but
+	 * rather keep going until we reach the nul of the format.
+	 * Just to make sure we don't clobber that nul and therefore
+	 * accidentally keep going, we zero the buffer now. */
+	memset(buf, 0, sizeof buf);
 	strlcpy(buf, format, sizeof(buf));
 	
 	for (s=&buf[0]; 
 	     s && (p=strchr(s,'%')); ) {
 		n = NULL;
 		s = p + 1;
@@ -459,27 +469,36 @@
 			}
 			snprintf(buf2,sizeof(buf2),"%.0f", (double)b); 
 			n = buf2;
 			break;
 		}
 
-		if (!n) continue;
+		/* n is the string to be inserted in place of this %
+		 * code; l is its length not including the trailing
+		 * NUL */
+		if (!n)
+			continue;
 
 		l = strlen(n);
 
-		if ((l-1) + ((int)(s - &buf[0])) > sizeof(buf)) {
+		if (l + ((int)(s - &buf[0])) >= sizeof(buf)) {
 			rprintf(FERROR,"buffer overflow expanding %%%c - exiting\n",
 				p[0]);
 			exit_cleanup(RERR_MESSAGEIO);
 		}
 
+		/* Shuffle the rest of the string along to make space for n */
 		if (l != 2) {
 			memmove(s+(l-1), s+1, strlen(s+1)+1);
 		}
+
+		/* Copy in n but NOT its nul, because the format sting
+		 * probably continues after this. */
 		memcpy(p, n, l);
 
+		/* Skip over inserted string; continue looking */
 		s = p+l;
 	}
 
 	rprintf(code,"%s\n", buf);
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/main.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/main.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/main.c	2001-11-30 08:21:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/main.c	2002-01-25 18:07:41.000000000 +0800
@@ -1,11 +1,11 @@
 /* -*- c-file-style: "linux" -*-
    
    Copyright (C) 1996-2001 by Andrew Tridgell <tridge@samba.org>
    Copyright (C) Paul Mackerras 1996
-   Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+   Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -24,12 +24,13 @@
 time_t starttime = 0;
 
 struct stats stats;
 
 extern int verbose;
 
+static void show_malloc_stats(void);
 
 /****************************************************************************
 wait for a process to exit, calling io_flush while waiting
 ****************************************************************************/
 void wait_process(pid_t pid, int *status)
 {
@@ -53,12 +54,18 @@
 	extern int am_sender;
 	extern int am_daemon;
 	extern int do_stats;
 	extern int remote_version;
 	int send_stats;
 
+	if (do_stats) {
+		/* These come out from every process */
+		show_malloc_stats();
+		show_flist_stats();
+	}
+
 	if (am_daemon) {
 		log_exit(0, __FILE__, __LINE__);
 		if (f == -1 || !am_sender) return;
 	}
 
 	send_stats = verbose || (remote_version >= 20);
@@ -123,12 +130,44 @@
 
 	fflush(stdout);
 	fflush(stderr);
 }
 
 
+/**
+ * If our C library can get malloc statistics, then show them to FINFO
+ **/
+static void show_malloc_stats(void)
+{
+#ifdef HAVE_MALLINFO
+	struct mallinfo mi;
+	extern int am_server;
+	extern int am_sender;
+	extern int am_daemon;
+
+	mi = mallinfo();
+
+	rprintf(FINFO, RSYNC_NAME "[%d] (%s%s%s) heap statistics:\n",
+		getpid(),
+		am_server ? "server " : "",
+		am_daemon ? "daemon " : "",
+		am_sender ? "sender" : "receiver");
+	rprintf(FINFO, "  arena:     %10d   (bytes from sbrk)\n", mi.arena);
+	rprintf(FINFO, "  ordblks:   %10d   (chunks not in use)\n", mi.ordblks);
+	rprintf(FINFO, "  smblks:    %10d\n", mi.smblks);
+	rprintf(FINFO, "  hblks:     %10d   (chunks from mmap)\n", mi.hblks);
+	rprintf(FINFO, "  hblkhd:    %10d   (bytes from mmap)\n", mi.hblkhd);
+	rprintf(FINFO, "  usmblks:   %10d\n", mi.usmblks);
+	rprintf(FINFO, "  fsmblks:   %10d\n", mi.fsmblks);
+	rprintf(FINFO, "  uordblks:  %10d   (bytes used)\n", mi.uordblks);
+	rprintf(FINFO, "  fordblks:  %10d   (bytes free)\n", mi.fordblks);
+	rprintf(FINFO, "  keepcost:  %10d   (bytes in releasable chunk)\n", mi.keepcost);
+#endif /* HAVE_MALLINFO */
+}
+
+
 /* Start the remote shell.   cmd may be NULL to use the default. */
 static pid_t do_cmd(char *cmd,char *machine,char *user,char *path,int *f_in,int *f_out)
 {
 	char *args[100];
 	int i,argc=0;
 	pid_t ret;
@@ -762,14 +801,16 @@
 	extern int am_server;
 	int ret;
 	extern int read_batch;   /*  dw */
 	extern int write_batch;  /*  dw */
 	extern char *batch_ext;   /*  dw */
 	int orig_argc;  /* dw */
+	char **orig_argv;
 
 	orig_argc = argc;   /* dw */
+	orig_argv = argv;
 
 	signal(SIGUSR1, sigusr1_handler);
 	signal(SIGUSR2, sigusr2_handler);
 	signal(SIGCHLD, sigchld_handler);
 
 	starttime = time(NULL);
@@ -803,13 +844,13 @@
 	   work when there are other child processes.  Also, on all systems
 	   that implement getcwd that way "pwd" can't be found after chroot. */
 	push_dir(NULL,0);
 
 	if (write_batch) { /* dw */
 	    create_batch_file_ext();
-	    write_batch_argvs_file(orig_argc, argc, argv);
+	    write_batch_argvs_file(orig_argc, orig_argv);
 	}
 
 	if (read_batch) { /* dw */
 	    set_batch_file_ext(batch_ext);
 	}
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/Makefile.in	2002-01-03 15:09:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/Makefile.in	2002-01-25 10:13:04.000000000 +0800
@@ -26,13 +26,14 @@
 	lib/permstring.o \
 	@LIBOBJS@
 ZLIBOBJ=zlib/deflate.o zlib/infblock.o zlib/infcodes.o zlib/inffast.o \
 	zlib/inflate.o zlib/inftrees.o zlib/infutil.o zlib/trees.o \
 	zlib/zutil.o zlib/adler32.o 
 OBJS1=rsync.o generator.o receiver.o cleanup.o sender.o exclude.o util.o main.o checksum.o match.o syscall.o log.o backup.o
-OBJS2=options.o flist.o io.o compat.o hlink.o token.o uidlist.o socket.o fileio.o batch.o
+OBJS2=options.o flist.o io.o compat.o hlink.o token.o uidlist.o socket.o fileio.o batch.o \
+	clientname.o
 DAEMON_OBJ = params.o loadparm.o clientserver.o access.o connection.o authenticate.o
 popt_OBJS=popt/findme.o  popt/popt.o  popt/poptconfig.o \
 	popt/popthelp.o popt/poptparse.o
 OBJS=$(OBJS1) $(OBJS2) $(DAEMON_OBJ) $(LIBOBJ) $(ZLIBOBJ) @BUILD_POPT@
 
 tls_OBJ = tls.o syscall.o lib/permstring.o 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/match.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/match.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/match.c	2001-11-30 08:21:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/match.c	2002-01-26 07:07:34.000000000 +0800
@@ -68,13 +68,13 @@
     tag_table = (int *)malloc(sizeof(tag_table[0])*TABLESIZE);
 
   targets = (struct target *)malloc(sizeof(targets[0])*s->count);
   if (!tag_table || !targets) 
     out_of_memory("build_hash_table");
 
-  for (i=0;i<s->count;i++) {
+  for (i=0;i<(int) s->count;i++) {
     targets[i].i = i;
     targets[i].t = gettag(s->sums[i].sum1);
   }
 
   qsort(targets,s->count,sizeof(targets[0]),(int (*)())compare_targets);
 
@@ -172,13 +172,13 @@
 		if (j == NULL_TAG) {
 			goto null_tag;
 		}
 
 		sum = (s1 & 0xffff) | (s2 << 16);
 		tag_hits++;
-		for (; j<s->count && targets[j].t == t; j++) {
+		for (; j < (int) s->count && targets[j].t == t; j++) {
 			int l, i = targets[j].i;
 			
 			if (sum != s->sums[i].sum1) continue;
 			
 			/* also make sure the two blocks are the same length */
 			l = MIN(s->n,len-offset);
@@ -198,13 +198,13 @@
 				false_alarms++;
 				continue;
 			}
 
 			/* we've found a match, but now check to see
                            if last_i can hint at a better match */
-			for (j++; j<s->count && targets[j].t == t; j++) {
+			for (j++; j < (int) s->count && targets[j].t == t; j++) {
 				int i2 = targets[j].i;
 				if (i2 == last_i + 1) {
 					if (sum != s->sums[i2].sum1) break;
 					if (memcmp(sum2,s->sums[i2].sum2,csum_length) != 0) break;
 					/* we've found an adjacent match - the RLL coder 
 					   will be happy */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/NEWS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/NEWS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/NEWS	2002-01-03 15:18:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/NEWS	2002-01-26 07:19:21.000000000 +0800
@@ -1,33 +1,39 @@
-rsync 2.5.1 (2002-01-03)
+rsync 2.5.2 (26 Jan 2002)
 
-  BUG FIXES: 
-   
-    * Fix for segfault in --daemon mode configuration parser.  (Paul
-      Mackerras)
+  SECURITY FIXES:
 
-    * Correct string<->address parsing for both IPv4 and 6.
-      (YOSHIFUJI Hideaki, SUMIKAWA Munechika and Jun-ichiro "itojun"
-      Hagino)
+    * Signedness security patch from Sebastian Krahmer
+      <krahmer@suse.de> -- in some cases we were not sufficiently
+      careful about reading integers from the network.
 
-    * Various fixes for IPv6 support.  (Dave Dykstra)
+  BUG FIXES:
 
-    * rsync.1 typo fix.  (Matt Kraai)
+    * Fix possible string mangling in log files.
 
-    * Test suite typo fixes.  (Tom Schmidt)
+    * Fix for setting local address of outgoing sockets.
 
-    * rsync.1 grammar and clarity improvements.  (Edward
-      Welbourne)
+    * Better handling of hardlinks and devices on platforms with
+      64-bit dev_t or ino_t.
 
-    * Correction to ./configure tests for inet_ntop.  (Jeff Garzik)
+    * Name resolution on machines supporting IPv6 is improved.
+
+    * Fix for device nodes.  (dann frazier)   (Debian #129135)
 
   ENHANCEMENTS:
 
-    * --progress and -P now show estimated data transfer rate (in a
-        multiple of bytes/s) and estimated time to completion.  (Rik
-        Faith)
-   
-    * --no-detach option, required to run as a W32 service and also
-        useful when running on Unix under daemontools, AIX's SRC, or a
-        debugger.  (Max Bowsher, Jos Backus)
+    * With -v, rsync now shows the command used to initiate an ssh/rsh
+      connection.
+
+    * --statistics now shows memory heap usage on platforms that
+        support mallinfo().
 
-    * Clearer error messages for some conditions.
+    * "The Ted T'so school of program optimization": make progress
+      visible and people will think it's faster.  (With --progress,
+      rsync will show you how many files it has seen as it builds the
+      file_list, giving some indication that it has not hung.)
+
+    * Improvements to batch mode support.  This is still experimental
+      but testing would be welcome.   (Jos Backus)
+ 
+    * New --ignore-existing option, patch previously distributed with
+      Vipul's Razor.  (Debian #124286)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/OLDNEWS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/OLDNEWS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/OLDNEWS	2001-12-02 15:17:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/OLDNEWS	2002-01-15 18:47:59.000000000 +0800
@@ -1,6 +1,40 @@
+rsync 2.5.1 (2002-01-03)
+
+  BUG FIXES: 
+   
+    * Fix for segfault in --daemon mode configuration parser.  (Paul
+      Mackerras)
+
+    * Correct string<->address parsing for both IPv4 and 6.
+      (YOSHIFUJI Hideaki, SUMIKAWA Munechika and Jun-ichiro "itojun"
+      Hagino)
+
+    * Various fixes for IPv6 support.  (Dave Dykstra)
+
+    * rsync.1 typo fix.  (Matt Kraai)
+
+    * Test suite typo fixes.  (Tom Schmidt)
+
+    * rsync.1 grammar and clarity improvements.  (Edward
+      Welbourne)
+
+    * Correction to ./configure tests for inet_ntop.  (Jeff Garzik)
+
+  ENHANCEMENTS:
+
+    * --progress and -P now show estimated data transfer rate (in a
+        multiple of bytes/s) and estimated time to completion.  (Rik
+        Faith)
+   
+    * --no-detach option, required to run as a W32 service and also
+        useful when running on Unix under daemontools, AIX's SRC, or a
+        debugger.  (Max Bowsher, Jos Backus)
+
+    * Clearer error messages for some conditions.
+
 rsync 2.5.0 (2001-11-30)
 
   ANNOUNCEMENTS
 
     * Martin Pool <mbp@samba.org> is now a co-maintainer.
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/options.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/options.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/options.c	2002-01-03 15:09:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/options.c	2002-01-25 18:42:23.000000000 +0800
@@ -1,10 +1,10 @@
 /*  -*- c-file-style: "linux" -*-
     
     Copyright (C) 1998-2001 by Andrew Tridgell <tridge@samba.org>
-    Copyright (C) 2000-2001 by Martin Pool <mbp@samba.org>
+    Copyright (C) 2000, 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -62,12 +62,13 @@
 int copy_unsafe_links=0;
 int block_size=BLOCK_SIZE;
 int size_only=0;
 int bwlimit=0;
 int delete_after=0;
 int only_existing=0;
+int opt_ignore_existing=0;
 int max_delete=0;
 int ignore_errors=0;
 #ifdef _WIN32
 int modify_window=2;
 #else
 int modify_window=0;
@@ -119,12 +120,13 @@
 static void print_rsync_version(enum logcode f)
 {
         char const *got_socketpair = "no ";
         char const *hardlinks = "no ";
         char const *links = "no ";
 	char const *ipv6 = "no ";
+	STRUCT_STAT *dumstat;
 
 #ifdef HAVE_SOCKETPAIR
         got_socketpair = "";
 #endif
 
 #if SUPPORT_HARD_LINKS
@@ -139,19 +141,26 @@
 	ipv6 = "";
 #endif       
 
         rprintf(f, "%s  version %s  protocol version %d\n",
                 RSYNC_NAME, RSYNC_VERSION, PROTOCOL_VERSION);
         rprintf(f,
-                "Copyright (C) 1996-2001 by Andrew Tridgell and others\n");
+                "Copyright (C) 1996-2002 by Andrew Tridgell and others\n");
 	rprintf(f, "<http://rsync.samba.org/>\n");
         rprintf(f, "Capabilities: %d-bit files, %ssocketpairs, "
-                "%shard links, %ssymlinks, batchfiles, %sIPv6\n\n",
+                "%shard links, %ssymlinks, batchfiles, %sIPv6,\n",
                 (int) (sizeof(OFF_T) * 8),
                 got_socketpair, hardlinks, links, ipv6);
 
+	/* Note that this field may not have type ino_t.  It depends
+	 * on the complicated interaction between largefile feature
+	 * macros. */
+	rprintf(f, "              %d-bit system inums, %d-bit internal inums\n",
+		(int) (sizeof(dumstat->st_ino) * 8),
+		(int) (sizeof(INO64_T) * 8));
+
 #ifdef NO_INT64
         rprintf(f, "WARNING: no 64-bit integers on this platform!\n");
 #endif
 }
 
 
@@ -197,12 +206,13 @@
   rprintf(F," -x, --one-file-system       don't cross filesystem boundaries\n");
   rprintf(F," -B, --block-size=SIZE       checksum blocking size (default %d)\n",BLOCK_SIZE);  
   rprintf(F," -e, --rsh=COMMAND           specify rsh replacement\n");
   rprintf(F,"     --rsync-path=PATH       specify path to rsync on the remote machine\n");
   rprintf(F," -C, --cvs-exclude           auto ignore files in the same way CVS does\n");
   rprintf(F,"     --existing              only update files that already exist\n");
+  rprintf(F,"     --ignore-existing       ignore files that already exist on the receiving side\n");
   rprintf(F,"     --delete                delete files that don't exist on the sending side\n");
   rprintf(F,"     --delete-excluded       also delete excluded files on the receiving side\n");
   rprintf(F,"     --delete-after          delete after transferring, not before\n");
   rprintf(F,"     --ignore-errors         delete even if there are IO errors\n");
   rprintf(F,"     --max-delete=NUM        don't delete more than NUM files\n");
   rprintf(F,"     --partial               keep partially transferred files\n");
@@ -229,14 +239,14 @@
   rprintf(F,"     --blocking-io           use blocking IO for the remote shell\n");  
   rprintf(F,"     --stats                 give some file transfer stats\n");  
   rprintf(F,"     --progress              show progress during transfer\n");  
   rprintf(F,"     --log-format=FORMAT     log file transfers using specified format\n");  
   rprintf(F,"     --password-file=FILE    get password from FILE\n");
   rprintf(F,"     --bwlimit=KBPS          limit I/O bandwidth, KBytes per second\n");
-  rprintf(F," -f  --read-batch=EXT        read batch file\n");
-  rprintf(F," -F  --write-batch           write batch file\n");
+  rprintf(F,"     --read-batch=EXT        read batch file\n");
+  rprintf(F,"     --write-batch           write batch file\n");
   rprintf(F," -h, --help                  show this help screen\n");
 #ifdef INET6
   rprintf(F," -4                          prefer IPv4\n");
   rprintf(F," -6                          prefer IPv6\n");
 #endif
 
@@ -251,13 +261,13 @@
       OPT_RSYNC_PATH, OPT_FORCE, OPT_TIMEOUT, OPT_DAEMON, OPT_CONFIG, OPT_PORT,
       OPT_INCLUDE, OPT_INCLUDE_FROM, OPT_STATS, OPT_PARTIAL, OPT_PROGRESS,
       OPT_COPY_UNSAFE_LINKS, OPT_SAFE_LINKS, OPT_COMPARE_DEST,
       OPT_LOG_FORMAT, OPT_PASSWORD_FILE, OPT_SIZE_ONLY, OPT_ADDRESS,
       OPT_DELETE_AFTER, OPT_EXISTING, OPT_MAX_DELETE, OPT_BACKUP_DIR, 
       OPT_IGNORE_ERRORS, OPT_BWLIMIT, OPT_BLOCKING_IO,
-      OPT_MODIFY_WINDOW};
+      OPT_MODIFY_WINDOW, OPT_READ_BATCH, OPT_WRITE_BATCH, OPT_IGNORE_EXISTING};
 
 static struct poptOption long_options[] = {
   /* longName, shortName, argInfo, argPtr, value, descrip, argDesc */
   {"version",          0,  POPT_ARG_NONE,   0,             OPT_VERSION},
   {"suffix",           0,  POPT_ARG_STRING, &backup_suffix},
   {"rsync-path",       0,  POPT_ARG_STRING, &rsync_path},
@@ -265,12 +275,13 @@
   {"ignore-times",    'I', POPT_ARG_NONE,   &ignore_times},
   {"size-only",        0,  POPT_ARG_NONE,   &size_only},
   {"modify-window",    0,  POPT_ARG_INT,    &modify_window, OPT_MODIFY_WINDOW},
   {"one-file-system", 'x', POPT_ARG_NONE,   &one_file_system},
   {"delete",           0,  POPT_ARG_NONE,   &delete_mode},
   {"existing",         0,  POPT_ARG_NONE,   &only_existing},
+  {"ignore-existing",  0,  POPT_ARG_NONE,   &opt_ignore_existing},
   {"delete-after",     0,  POPT_ARG_NONE,   &delete_after},
   {"delete-excluded",  0,  POPT_ARG_NONE,   0,              OPT_DELETE_EXCLUDED},
   {"force",            0,  POPT_ARG_NONE,   &force_delete},
   {"numeric-ids",      0,  POPT_ARG_NONE,   &numeric_ids},
   {"exclude",          0,  POPT_ARG_STRING, 0,              OPT_EXCLUDE},
   {"include",          0,  POPT_ARG_STRING, 0,              OPT_INCLUDE},
@@ -282,13 +293,13 @@
   {"dry-run",         'n', POPT_ARG_NONE,   &dry_run},
   {"sparse",          'S', POPT_ARG_NONE,   &sparse_files},
   {"cvs-exclude",     'C', POPT_ARG_NONE,   &cvs_exclude},
   {"update",          'u', POPT_ARG_NONE,   &update_only},
   {"links",           'l', POPT_ARG_NONE,   &preserve_links},
   {"copy-links",      'L', POPT_ARG_NONE,   &copy_links},
-  {"whole",           'W', POPT_ARG_NONE,   &whole_file},
+  {"whole-file",      'W', POPT_ARG_NONE,   &whole_file},
   {"copy-unsafe-links", 0, POPT_ARG_NONE,   &copy_unsafe_links},
   {"perms",           'p', POPT_ARG_NONE,   &preserve_perms},
   {"owner",           'o', POPT_ARG_NONE,   &preserve_uid},
   {"group",           'g', POPT_ARG_NONE,   &preserve_gid},
   {"devices",         'D', POPT_ARG_NONE,   &preserve_devices},
   {"times",           't', POPT_ARG_NONE,   &preserve_times},
@@ -320,14 +331,14 @@
   {"port",             0,  POPT_ARG_INT,    &rsync_port},
   {"log-format",       0,  POPT_ARG_STRING, &log_format},
   {"bwlimit",          0,  POPT_ARG_INT,    &bwlimit},
   {"address",          0,  POPT_ARG_STRING, &bind_address, 0},
   {"backup-dir",       0,  POPT_ARG_STRING, &backup_dir},
   {"hard-links",      'H', POPT_ARG_NONE,   &preserve_hard_links},
-  {"read-batch",      'f', POPT_ARG_STRING, &batch_ext, 'f'},
-  {"write-batch",     'F', POPT_ARG_NONE,   &write_batch, 0},
+  {"read-batch",       0,  POPT_ARG_STRING, &batch_ext, OPT_READ_BATCH},
+  {"write-batch",      0,  POPT_ARG_NONE,   &write_batch},
 #ifdef INET6
   {0,		      '4', POPT_ARG_VAL,    &default_af_hint,   AF_INET },
   {0,		      '6', POPT_ARG_VAL,    &default_af_hint,   AF_INET6 },
 #endif
   {0,0,0,0}
 };
@@ -500,15 +511,14 @@
 
 		case 'P':
 			do_progress = 1;
 			keep_partial = 1;
 			break;
 
-
-		case 'f':
-			/* The filename is stored for us by popt */
+		case OPT_READ_BATCH:
+			/* The filename is stored in batch_ext for us by popt */
 			read_batch = 1;
 			break;
 
 		default:
                         /* FIXME: If --daemon is specified, then errors for later
                          * parameters seem to disappear. */
@@ -539,13 +549,14 @@
 	static char argstr[50];
 	static char bsize[30];
 	static char iotime[30];
 	static char mdelete[30];
 	static char mwindow[30];
 	static char bw[50];
-	static char fext[20]; /* dw */
+	static char fext[20];
+	static char wbatch[14];
 
 	int i, x;
 
 	args[ac++] = "--server";
 
 	if (!am_sender)
@@ -594,14 +605,12 @@
 	if (one_file_system)
 		argstr[x++] = 'x';
 	if (sparse_files)
 		argstr[x++] = 'S';
 	if (do_compression)
 		argstr[x++] = 'z';
-	if (write_batch)
-	    argstr[x++] = 'F'; /* dw */
 
 	/* this is a complete hack - blame Rusty 
 
 	   this is a hack to make the list_only (remote file list)
 	   more useful */
 	if (list_only && !recurse) 
@@ -618,14 +627,19 @@
 
 	if (max_delete && am_sender) {
 		snprintf(mdelete,sizeof(mdelete),"--max-delete=%d",max_delete);
 		args[ac++] = mdelete;
 	}    
 	
+	if (write_batch) {
+		snprintf(wbatch,sizeof(wbatch),"--write-batch");
+		args[ac++] = wbatch;
+	}
+
 	if (batch_ext != NULL) {
-		sprintf(fext,"-f%s",batch_ext);
+		snprintf(fext,sizeof(fext),"--read-batch=%s",batch_ext);
 		args[ac++] = fext;
 	}
 
 	if (io_timeout) {
 		snprintf(iotime,sizeof(iotime),"--timeout=%d",io_timeout);
 		args[ac++] = iotime;
@@ -677,12 +691,15 @@
 	if (numeric_ids)
 		args[ac++] = "--numeric-ids";
 
 	if (only_existing && am_sender)
 		args[ac++] = "--existing";
 
+	if (opt_ignore_existing && am_sender) 
+		args[ac++] = "--ignore-existing";
+
 	if (tmpdir) {
 		args[ac++] = "--temp-dir";
 		args[ac++] = tmpdir;
 	}
 
 	if (backup_dir && am_sender) {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/packaging/lsb: rsync.spec.tmpl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/packaging/redhat/5.0: rsync.spec.tmpl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/packaging/redhat/7.1: rsync.spec.tmpl
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/popt: config.log
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/proto.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/proto.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/proto.h	2001-11-30 08:21:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/proto.h	2002-01-26 07:07:33.000000000 +0800
@@ -6,22 +6,24 @@
 int make_backup(char *fname);
 void create_batch_file_ext();
 void set_batch_file_ext(char *ext);
 void write_batch_flist_file(char *buff, int bytes_to_write);
 void write_batch_flist_info(int flist_count, struct file_struct **fptr);
 void write_char_bufs(char *buf);
-void write_batch_argvs_file(int orig_argc, int argc, char **argv);
+void write_batch_argvs_file(int argc, char *argv[]);
 struct file_list *create_flist_from_batch();
 int read_batch_flist_file(char *buff, int len);
 unsigned char read_batch_flags();
 void read_batch_flist_info(struct file_struct **fptr);
-void write_batch_csums_file(char *buff, int bytes_to_write);
-void close_batch_csums_file() ;
-void write_batch_csum_info(int *flist_entry, int flist_count, struct sum_struct *s);
+void write_batch_csums_file(void *buff, int bytes_to_write);
+void close_batch_csums_file();
+void write_batch_csum_info(int *flist_entry, int flist_count,
+			   struct sum_struct *s);
 int read_batch_csums_file(char *buff, int len);
-void read_batch_csum_info(int flist_entry, struct sum_struct *s, int *checksums_match);
+void read_batch_csum_info(int flist_entry, struct sum_struct *s,
+			  int *checksums_match);
 void write_batch_delta_file(char *buff, int bytes_to_write);
 void close_batch_delta_file();
 int read_batch_delta_file(char *buff, int len);
 void show_flist(int index, struct file_struct **fptr);
 void show_argvs(int argc, char *argv[]);
 uint32 get_checksum1(char *buf1,int len);
@@ -33,12 +35,27 @@
 void sum_end(char *sum);
 void _exit_cleanup(int code, const char *file, int line);
 void cleanup_disable(void);
 void cleanup_set(char *fnametmp, char *fname, struct file_struct *file,
 		 struct map_struct *buf, int fd1, int fd2);
 void cleanup_set_pid(int pid);
+char *client_addr(int fd);
+char *client_name(int fd);
+void client_sockaddr(int fd,
+		     struct sockaddr_storage *ss,
+		     socklen_t *ss_len);
+int lookup_name(int fd, const struct sockaddr_storage *ss,
+		socklen_t ss_len,
+		char *name_buf, size_t name_buf_len,
+		char *port_buf, size_t port_buf_len);
+int compare_addrinfo_sockaddr(const struct addrinfo *ai,
+			      const struct sockaddr_storage *ss);
+int check_name(int fd,
+	       const struct sockaddr_storage *ss,
+	       char *name_buf,
+	       const char *port_buf);
 int start_socket_client(char *host, char *path, int argc, char *argv[]);
 int daemon_main(void);
 void setup_protocol(int f_out,int f_in);
 int claim_connection(char *fname,int max_connections);
 int check_exclude(char *name, struct exclude_struct **local_exclude_list,
 		  STRUCT_STAT *st);
@@ -52,53 +69,54 @@
 void recv_exclude_list(int f);
 char *get_exclude_tok(char *p);
 void add_exclude_line(char *p);
 void add_include_line(char *p);
 void add_cvs_excludes(void);
 int sparse_end(int f);
-int write_file(int f,char *buf,int len);
+int write_file(int f,char *buf,size_t len);
 struct map_struct *map_file(int fd,OFF_T len);
 char *map_ptr(struct map_struct *map,OFF_T offset,int len);
 void unmap_file(struct map_struct *map);
-int readlink_stat(const char *Path, STRUCT_STAT *Buffer, char *Linkbuf) ;
-int link_stat(const char *Path, STRUCT_STAT *Buffer) ;
+void show_flist_stats(void);
+int readlink_stat(const char *Path, STRUCT_STAT * Buffer, char *Linkbuf);
+int link_stat(const char *Path, STRUCT_STAT * Buffer);
 struct file_struct *make_file(int f, char *fname, struct string_area **ap,
 			      int noexcludes);
-void send_file_name(int f,struct file_list *flist,char *fname,
-			   int recursive, unsigned base_flags);
-struct file_list *send_file_list(int f,int argc,char *argv[]);
+void send_file_name(int f, struct file_list *flist, char *fname,
+		    int recursive, unsigned base_flags);
+struct file_list *send_file_list(int f, int argc, char *argv[]);
 struct file_list *recv_file_list(int f);
-int file_compare(struct file_struct **f1,struct file_struct **f2);
-int flist_find(struct file_list *flist,struct file_struct *f);
+int file_compare(struct file_struct **f1, struct file_struct **f2);
+int flist_find(struct file_list *flist, struct file_struct *f);
 void free_file(struct file_struct *file);
 struct file_list *flist_new();
 void flist_free(struct file_list *flist);
 char *f_name(struct file_struct *f);
 void recv_generator(char *fname,struct file_list *flist,int i,int f_out);
 void generate_files(int f,struct file_list *flist,char *local_name,int f_recv);
 void init_hard_links(struct file_list *flist);
 int check_hard_link(struct file_struct *file);
-void do_hard_links(struct file_list *flist);
+void do_hard_links(void);
 void io_set_error_fd(int fd);
 int32 read_int(int f);
 int64 read_longint(int f);
-void read_buf(int f,char *buf,int len);
-void read_sbuf(int f,char *buf,int len);
+void read_buf(int f,char *buf,size_t len);
+void read_sbuf(int f,char *buf,size_t len);
 unsigned char read_byte(int f);
 void io_start_buffering(int fd);
 void io_flush(void);
-void io_end_buffering(int fd);
+void io_end_buffering(void);
 void write_int(int f,int32 x);
 void write_longint(int f, int64 x);
-void write_buf(int f,char *buf,int len);
+void write_buf(int f,char *buf,size_t len);
 void write_byte(int f,unsigned char c);
-int read_line(int f, char *buf, int maxlen);
+int read_line(int f, char *buf, size_t maxlen);
 void io_printf(int fd, const char *format, ...);
 void io_start_multiplex_out(int fd);
 void io_start_multiplex_in(int fd);
-int io_multiplex_write(enum logcode code, char *buf, int len);
+int io_multiplex_write(enum logcode code, char *buf, size_t len);
 void io_multiplexing_close(void);
 char *lp_motd_file(void);
 char *lp_log_file(void);
 char *lp_pid_file(void);
 char *lp_socket_options(void);
 int lp_syslog_facility(void);
@@ -163,24 +181,25 @@
 int delete_file(char *fname);
 int set_perms(char *fname,struct file_struct *file,STRUCT_STAT *st,
 	      int report);
 void sig_int(void);
 void finish_transfer(char *fname, char *fnametmp, struct file_struct *file);
 void send_files(struct file_list *flist,int f_out,int f_in);
+int try_bind_local(int s,
+		   int ai_family, int ai_socktype,
+		   const char *bind_address);
 int open_socket_out(char *host, int port, const char *bind_address,
 		    int af_hint);
 int open_socket_out_wrapped (char *host,
 			     int port,
 			     const char *bind_address,
 			     int af_hint);
 int is_a_socket(int fd);
 void start_accept_loop(int port, int (*fn)(int ));
 void set_socket_options(int fd, char *options);
 void become_daemon(void);
-char *client_addr(int fd);
-char *client_name(int fd);
 int sock_exec(const char *prog);
 int do_unlink(char *fname);
 int do_symlink(char *fname1, char *fname2);
 int do_link(char *fname1, char *fname2);
 int do_lchown(const char *path, uid_t owner, gid_t group);
 int do_mknod(char *pathname, mode_t mode, dev_t dev);
@@ -206,13 +225,14 @@
 void add_gid(gid_t gid);
 void send_uid_list(int f);
 void recv_uid_list(int f, struct file_list *flist);
 void set_nonblocking(int fd);
 void set_blocking(int fd);
 int fd_pair(int fd[2]);
-pid_t piped_child(char **command,int *f_in,int *f_out);
+void print_child_argv(char **cmd);
+pid_t piped_child(char **command, int *f_in, int *f_out);
 pid_t local_child(int argc, char **argv,int *f_in,int *f_out);
 void out_of_memory(char *str);
 void overflow(char *str);
 int set_modtime(char *fname,time_t modtime);
 int create_directory_path(char *fname);
 int copy_file(char *source, char *dest, mode_t mode);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/receiver.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/receiver.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/receiver.c	2001-11-30 08:21:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/receiver.c	2002-01-26 07:07:33.000000000 +0800
@@ -35,14 +35,14 @@
 extern char *tmpdir;
 extern char *compare_dest;
 extern int make_backups;
 extern char *backup_suffix;
 
 static struct delete_list {
-	dev_t dev;
-	INO_T inode;
+	DEV64_T dev;
+	INO64_T inode;
 } *delete_list;
 static int dlist_len, dlist_alloc_len;
 
 /* yuck! This function wouldn't have been necessary if I had the sorting
    algorithm right. Unfortunately fixing the sorting algorithm would introduce
    a backward incompatibility as file list indexes are sent over the link.
@@ -203,13 +203,14 @@
 }
 
 
 static int receive_data(int f_in,struct map_struct *buf,int fd,char *fname,
 			OFF_T total_size)
 {
-	int i,n,remainder,len,count;
+	int i;
+	unsigned int n,remainder,len,count;
 	OFF_T offset = 0;
 	OFF_T offset2;
 	char *data;
 	static char file_sum1[MD4_SUM_LENGTH];
 	static char file_sum2[MD4_SUM_LENGTH];
 	char *map=NULL;
@@ -245,13 +246,13 @@
 			continue;
 		} 
 
 		i = -(i+1);
 		offset2 = i*(OFF_T)n;
 		len = n;
-		if (i == count-1 && remainder != 0)
+		if (i == (int) count-1 && remainder != 0)
 			len = remainder;
 		
 		stats.matched_data += len;
 		
 		if (verbose > 3)
 			rprintf(FINFO,"chunk[%d] of size %d at %.0f offset=%.0f\n",
@@ -261,13 +262,13 @@
 			map = map_ptr(buf,offset2,len);
 		
 			see_token(map, len);
 			sum_update(map,len);
 		}
 		
-		if (fd != -1 && write_file(fd,map,len) != len) {
+		if (fd != -1 && write_file(fd,map,len) != (int) len) {
 			rprintf(FERROR,"write failed on %s : %s\n",
 				fname,strerror(errno));
 			exit_cleanup(RERR_FILEIO);
 		}
 		offset += len;
 	}
@@ -485,13 +486,13 @@
 		if (recurse && delete_mode && !local_name && flist->count>0) {
 			delete_files(flist);
 		}
 	}
 
 	if (preserve_hard_links)
-		do_hard_links(flist);
+		do_hard_links();
 
 	/* now we need to fix any directory permissions that were 
 	   modified during the transfer */
 	for (i = 0; i < flist->count; i++) {
 		file = flist->files[i];
 		if (!file->basename || !S_ISDIR(file->mode)) continue;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.1	2002-01-03 15:09:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.1	2002-01-23 13:59:10.000000000 +0800
@@ -303,14 +303,14 @@
      --blocking-io           use blocking IO for the remote shell
      --stats                 give some file transfer stats
      --progress              show progress during transfer
      --log-format=FORMAT     log file transfers using specified format
      --password-file=FILE    get password from FILE
      --bwlimit=KBPS          limit I/O bandwidth, KBytes per second
- -f, --read-batch=FILE       read batch file
- -F, --write-batch           write batch file
+     --read-batch=FILE       read batch file
+     --write-batch           write batch file
  -h, --help                  show this help screen
 
 
 
 .fi 
  
@@ -910,18 +910,21 @@
 --include "foo/" --include "foo/bar\&.c" --exclude "*" would include
 only foo/bar\&.c (the foo/ directory must be explicitly included or
 it would be excluded by the "*")
 .PP 
 .SH "BATCH MODE" 
 .PP 
+\fBNote:\fP Batch mode should be considered experimental in this version
+of rsync\&.  The interface or behaviour may change before it stabilizes\&.
+.PP 
 The following call generates 4 files that encapsulate the information
 for synchronizing the contents of \fBtarget_dir\fP with the updates found in
 \fBsrc_dir\fP
 .PP 
 .RS 
-$ rsync -F [other rsync options here] \e
+$ rsync --write-batch [other rsync options here] \e
 .br 
 /somewhere/src_dir /somewhere/target_dir
 .RE 
 .PP 
 The generated files are labeled with a common timestamp:
 .PP 
@@ -1103,17 +1106,24 @@
 This program uses the excellent zlib compression library written by
 Jean-loup Gailly and Mark Adler\&.
 .PP 
 .SH "THANKS" 
 .PP 
 Thanks to Richard Brent, Brendan Mackay, Bill Waite, Stephen Rothwell
-and David Bell for helpful suggestions and testing of rsync\&. I\&'ve
-probably missed some people, my apologies if I have\&.
+and David Bell for helpful suggestions, patches and testing of rsync\&.
+I\&'ve probably missed some people, my apologies if I have\&.
+.PP 
+Especial thanks also to: David Dykstra, Jos Backus, Sebastian Krahmer\&.
 .PP 
 .SH "AUTHOR" 
 .PP 
-rsync was written by Andrew Tridgell and Paul Mackerras\&.  
+rsync was written by Andrew Tridgell <tridge@samba\&.org> and Paul
+Mackerras\&.
 .PP 
-rsync is now maintained by Martin Pool <mbp@samba\&.org>\&.
+rsync is now maintained by Martin Pool <mbp@samba\&.org>\&.  
 .PP 
 Mailing lists for support and development are available at
-http://lists\&.samba\&.org
+http://lists\&.samba\&.org 
+.PP 
+If you suspect you have found a security vulnerability in rsync,
+please send it directly to Martin Pool and Andrew Tridgell\&.  For other
+enquiries, please use the mailing list\&.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.h	2002-01-03 15:09:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.h	2002-01-26 07:00:21.000000000 +0800
@@ -1,10 +1,10 @@
 /* 
    Copyright (C) by Andrew Tridgell 1996, 2000
    Copyright (C) Paul Mackerras 1996
-   Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+   Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -46,13 +46,13 @@
 #define SAME_DIR (1<<5)
 #define SAME_NAME SAME_DIR
 #define LONG_NAME (1<<6)
 #define SAME_TIME (1<<7)
 
 /* update this if you make incompatible changes */
-#define PROTOCOL_VERSION 25
+#define PROTOCOL_VERSION 26
 
 /* We refuse to interoperate with versions that are not in this range.
  * Note that we assume we'll work with later versions: the onus is on
  * people writing them to make sure that they don't send us anything
  * we won't understand.
  *
@@ -182,12 +182,16 @@
 #endif
 
 #ifdef HAVE_GLOB_H
 #include <glob.h>
 #endif
 
+#ifdef HAVE_MALLOC_H
+#  include <malloc.h>
+#endif
+
 /* these are needed for the uid/gid mapping code */
 #include <pwd.h>
 #include <grp.h>
 
 #include <stdarg.h>
 #include <netinet/in.h>
@@ -260,23 +264,50 @@
 #define int64 long
 #elif (SIZEOF_INT == 8) 
 #define int64 int
 #elif HAVE_LONGLONG
 #define int64 long long
 #else
+/* As long as it gets... */
 #define int64 off_t
 #define NO_INT64
 #endif
 
-#if HAVE_SHORT_INO_T
-#  define INO_T uint32
-#elif HAVE_INO_T
-#  define INO_T ino_t
-#else
-#  define INO_T unsigned
-#endif
+/* Starting from protocol version 26, we always use 64-bit
+ * ino_t and dev_t internally, even if this platform does not
+ * allow files to have 64-bit inums.  That's because the
+ * receiver needs to find duplicate (dev,ino) tuples to detect
+ * hardlinks, and it might have files coming from a platform
+ * that has 64-bit inums.
+ *
+ * The only exception is if we're on a platform with no 64-bit type at
+ * all.
+ *
+ * Because we use read_longint() to get these off the wire, if you
+ * transfer devices or hardlinks with dev or inum > 2**32 to a machine
+ * with no 64-bit types then you will get an overflow error.  Probably
+ * not many people have that combination of machines, and you can
+ * avoid it by not preserving hardlinks or not transferring device
+ * nodes.  It's not clear that any other behaviour is better.
+ *
+ * Note that if you transfer devices from a 64-bit-devt machine (say,
+ * Solaris) to a 32-bit-devt machine (say, Linux-2.2/x86) then the
+ * device numbers will be truncated.  But it's a kind of silly thing
+ * to do anyhow.
+ *
+ * FIXME: In future, we should probable split the device number into
+ * major/minor, and transfer the two parts as 32-bit ints.  That gives
+ * you somewhat more of a chance that they'll come from a big machine
+ * to a little one in a useful way.
+ *
+ * FIXME: Really we need an unsigned type, and we perhaps ought to
+ * cope with platforms on which this is an unsigned int or even a
+ * struct.  Later.
+ */ 
+#define INO64_T unsigned int64
+#define DEV64_T unsigned int64
 
 #ifndef MIN
 #define MIN(a,b) ((a)<(b)?(a):(b))
 #endif
 
 #ifndef MAX
@@ -301,15 +332,19 @@
 
 struct file_struct {
 	unsigned flags;
 	time_t modtime;
 	OFF_T length;
 	mode_t mode;
-	INO_T inode;
-	dev_t dev;
-	dev_t rdev;
+
+	INO64_T inode;
+	/** Device this file lives upon */
+	DEV64_T dev;
+
+	/** If this is a device node, the device number. */
+	DEV64_T rdev;
 	uid_t uid;
 	gid_t gid;
 	char *basename;
 	char *dirname;
 	char *basedir;
 	char *link;
@@ -339,17 +374,17 @@
 	int i;			/* index of this chunk */
 	uint32 sum1;	        /* simple checksum */
 	char sum2[SUM_LENGTH];	/* checksum  */
 };
 
 struct sum_struct {
-  OFF_T flength;		/* total file length */
-  int count;			/* how many chunks */
-  int remainder;		/* flength % block_length */
-  int n;			/* block_length */
-  struct sum_buf *sums;		/* points to info for each chunk */
+	OFF_T flength;		/* total file length */
+	size_t count;		/* how many chunks */
+	size_t remainder;	/* flength % block_length */
+	size_t n;		/* block_length */
+	struct sum_buf *sums;	/* points to info for each chunk */
 };
 
 struct map_struct {
 	char *p;
 	int fd,p_size,p_len;
 	OFF_T file_size, p_offset, p_fd_offset;
@@ -384,17 +419,18 @@
 {
 	while (!flist->files[i]->basename) i++;
 	return i;
 }
 
 #include "byteorder.h"
-#include "proto.h"
 #include "lib/mdfour.h"
 #include "lib/permstring.h"
 #include "lib/addrinfo.h"
 
+#include "proto.h"
+
 /* We have replacement versions of these if they're missing. */
 #ifndef HAVE_ASPRINTF
 int asprintf(char **ptr, const char *format, ...);
 #endif
 
 #ifndef HAVE_VASPRINTF
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.yo /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.yo
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/rsync.yo	2002-01-03 15:09:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/rsync.yo	2002-01-25 18:42:23.000000000 +0800
@@ -1,8 +1,8 @@
 mailto(rsync-bugs@samba.org)
-manpage(rsync)(1)(14 Dec 2001)()()
+manpage(rsync)(1)(25 Jan 2002)()()
 manpagename(rsync)(faster, flexible replacement for rcp)
 manpagesynopsis()
 
 rsync [OPTION]... SRC [SRC]... [USER@]HOST:DEST
 
 rsync [OPTION]... [USER@]HOST:SRC DEST
@@ -242,12 +242,13 @@
  -x, --one-file-system       don't cross filesystem boundaries
  -B, --block-size=SIZE       checksum blocking size (default 700)
  -e, --rsh=COMMAND           specify rsh replacement
      --rsync-path=PATH       specify path to rsync on the remote machine
  -C, --cvs-exclude           auto ignore files in the same way CVS does
      --existing              only update files that already exist
+     --ignore-existing       ignore files that already exist on the receiving side
      --delete                delete files that don't exist on the sending side
      --delete-excluded       also delete excluded files on the receiving side
      --delete-after          delete after transferring, not before
      --ignore-errors         delete even if there are IO errors
      --max-delete=NUM        don't delete more than NUM files
      --partial               keep partially transferred files
@@ -274,14 +275,14 @@
      --blocking-io           use blocking IO for the remote shell
      --stats                 give some file transfer stats
      --progress              show progress during transfer
      --log-format=FORMAT     log file transfers using specified format
      --password-file=FILE    get password from FILE
      --bwlimit=KBPS          limit I/O bandwidth, KBytes per second
- -f, --read-batch=FILE       read batch file
- -F, --write-batch           write batch file
+     --read-batch=FILE       read batch file
+     --write-batch           write batch file
  -h, --help                  show this help screen
 
 
 )
 
 manpageoptions()
@@ -449,12 +450,16 @@
 boundaries  when recursing.  This  is useful for transferring the
 contents of only one filesystem.
 
 dit(bf(--existing)) This tells rsync not to create any new files -
 only update files that already exist on the destination.
 
+dit(bf(--ignore-existing))
+This tells rsync not to update files that already exist on 
+the destination. 
+
 dit(bf(--max-delete=NUM)) This tells rsync not to delete more than NUM
 files or directories. This is useful when mirroring very large trees
 to prevent disasters.
 
 dit(bf(--delete)) This tells rsync to delete any files on the receiving
 side that aren't on the sending side.   Files that are excluded from
@@ -790,18 +795,21 @@
   only foo/bar.c (the foo/ directory must be explicitly included or
   it would be excluded by the "*")
 )
 
 manpagesection(BATCH MODE)
 
+bf(Note:) Batch mode should be considered experimental in this version
+of rsync.  The interface or behaviour may change before it stabilizes.
+
 The following call generates 4 files that encapsulate the information
 for synchronizing the contents of bf(target_dir) with the updates found in
 bf(src_dir)
 
 quote(
-$ rsync -F [other rsync options here] \nl()
+$ rsync --write-batch [other rsync options here] \nl()
            /somewhere/src_dir /somewhere/target_dir
 )
 
 The generated files are labeled with a common timestamp:
 
 itemize(
@@ -959,18 +967,25 @@
 This program uses the excellent zlib compression library written by
 Jean-loup Gailly and Mark Adler.
 
 manpagesection(THANKS)
 
 Thanks to Richard Brent, Brendan Mackay, Bill Waite, Stephen Rothwell
-and David Bell for helpful suggestions and testing of rsync. I've
-probably missed some people, my apologies if I have.
+and David Bell for helpful suggestions, patches and testing of rsync.
+I've probably missed some people, my apologies if I have.
+
+Especial thanks also to: David Dykstra, Jos Backus, Sebastian Krahmer.
 
 
 manpageauthor()
 
-rsync was written by Andrew Tridgell and Paul Mackerras.  
+rsync was written by Andrew Tridgell <tridge@samba.org> and Paul
+Mackerras.
 
-rsync is now maintained by Martin Pool <mbp@samba.org>.
+rsync is now maintained by Martin Pool <mbp@samba.org>.  
 
 Mailing lists for support and development are available at
-url(http://lists.samba.org)(lists.samba.org)
+url(http://lists.samba.org)(lists.samba.org) 
+
+If you suspect you have found a security vulnerability in rsync,
+please send it directly to Martin Pool and Andrew Tridgell.  For other
+enquiries, please use the mailing list.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/runtests.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/runtests.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/runtests.sh	2002-01-03 15:09:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/runtests.sh	2002-01-11 16:01:05.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 
-# Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+# Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
 
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License version
 # 2 as published by the Free Software Foundation.
 #
 # This program is distributed in the hope that it will be useful, but
@@ -157,57 +157,79 @@
 
 skipped=0
 missing=0
 passed=0
 failed=0
 
-scratchdir="`pwd`"/testtmp
-echo "    scratchdir=$scratchdir"
+# Prefix for scratch directory.  We create separate directories for
+# each test case, so that they can be left behind in case of failure
+# to aid investigation.
+scratchbase="`pwd`"/testtmp
+echo "    scratchbase=$scratchbase"
 
 suitedir="$srcdir/testsuite"
 
 export scratchdir suitedir
 
-clean_scratch() {
+prep_scratch() {
     [ -d "$scratchdir" ] && rm -rf "$scratchdir"
     mkdir "$scratchdir"
+    return 0
+}
+
+discard_scratch() {
+    [ -d "$scratchdir" ] && rm -rf "$scratchdir"
+    return 0
 }
 
 if [ "x$whichtests" = x ]
 then
     whichtests="*.test"
 fi
 
 for testscript in $suitedir/$whichtests
 do
-    testbase=`echo $testscript | sed 's!.*/!!'`
+    testbase=`echo $testscript | sed 's!.*/!!' | sed -e 's/.test\$//'`
+    scratchdir="$scratchbase.$testbase"
 
-    echo "----- $testbase starting"
-    clean_scratch
+    prep_scratch
 
-    if sh $RUNSHFLAGS "$testscript" >"$scratchdir/test.log"  2>&1
-    then
-	echo "----- $testbase completed successfully"
+    set +e
+    sh $RUNSHFLAGS "$testscript" >"$scratchdir/test.log" 2>&1
+    result=$?
+    set -e
+
+    case $result in
+    0)
+	echo "PASS    $testbase"
 	passed=`expr $passed + 1`
-    else 
-	case $? in
-	77)
-	    echo "----- $testbase skipped"
-	    skipped=`expr $skipped + 1`
-	    ;;
-	*)
-	    echo "----- $testbase failed: log follows"
-	    cat "$scratchdir/test.log"
-	    echo "----- $testbase log ends"
-	    failed=`expr $failed + 1`
-	    if [ "x$nopersist" = "xyes" ]
-	    then
-		exit 1
-	    fi
-	esac
-    fi
+	discard_scratch
+	;;
+    77)
+	echo "SKIP    $testbase"
+	skipped=`expr $skipped + 1`
+	discard_scratch
+	;;
+    78)
+        # It failed, but we expected that.  don't dump out error logs, 
+	# because most users won't want to see them.  But do leave
+	# the working directory around.
+	echo "XFAIL   $testbase"
+	failed=`expr $failed + 1`
+	;;
+    *)
+	echo "FAIL    $testbase"
+	echo "----- $testbase failed: log follows"
+	cat "$scratchdir/test.log"
+	echo "----- $testbase log ends"
+	failed=`expr $failed + 1`
+	if [ "x$nopersist" = "xyes" ]
+	then
+	    exit 1
+	fi
+    esac
 done
 
 echo '------------------------------------------------------------'
 echo "----- overall results:"
 echo "      $passed passed"
 [ "$failed" -gt 0 ]  && echo "      $failed failed"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/sender.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/sender.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/sender.c	2001-11-30 08:21:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/sender.c	2002-01-26 07:07:33.000000000 +0800
@@ -52,20 +52,20 @@
 	if (s->count == 0) 
 		return(s);
 
 	s->sums = (struct sum_buf *)malloc(sizeof(s->sums[0])*s->count);
 	if (!s->sums) out_of_memory("receive_sums");
 
-	for (i=0;i<s->count;i++) {
+	for (i=0; i < (int) s->count;i++) {
 		s->sums[i].sum1 = read_int(f);
 		read_buf(f,s->sums[i].sum2,csum_length);
 
 		s->sums[i].offset = offset;
 		s->sums[i].i = i;
 
-		if (i == s->count-1 && s->remainder != 0) {
+		if (i == (int) s->count-1 && s->remainder != 0) {
 			s->sums[i].len = s->remainder;
 		} else {
 			s->sums[i].len = s->n;
 		}
 		offset += s->sums[i].len;
 
@@ -156,19 +156,20 @@
 			continue;
 		}
 
 		initial_stats = stats;
 
 		s = receive_sums(f_in);
-		if (write_batch) /* dw */
-		    write_batch_csum_info(&i,flist->count,s);
 		if (!s) {
 			io_error = 1;
 			rprintf(FERROR,"receive_sums failed\n");
 			return;
 		}
+
+		if (write_batch)
+		    write_batch_csum_info(&i,flist->count,s);
 	  
 		if (!read_batch) {
 			fd = do_open(fname, O_RDONLY, 0);
 			if (fd == -1) {
 				io_error = 1;
 				rprintf(FERROR,"send_files failed to open %s: %s\n",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/socket.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/socket.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/socket.c	2002-01-03 15:09:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/socket.c	2002-01-25 10:13:05.000000000 +0800
@@ -1,10 +1,12 @@
 /* -*- c-file-style: "linux" -*-
    
+   rsync -- fast file replication program
+   
    Copyright (C) 1992-2001 by Andrew Tridgell <tridge@samba.org>
-   Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+   Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -19,16 +21,22 @@
 */
 
 /**
  * @file socket.c
  * 
  * Socket functions used in rsync.
+ *
+ * This file is now converted to use the new-style getaddrinfo()
+ * interface, which supports IPv6 but is also supported on recent
+ * IPv4-only machines.  On systems that don't have that interface, we
+ * emulate it using the KAME implementation.
  **/
 
 #include "rsync.h"
 
+
 /* Establish a proxy connection on an open socket to a web roxy by
  * using the CONNECT method. */
 static int establish_proxy_connection(int fd, char *host, int port)
 {
 	char buffer[1024];
 	char *cp;
@@ -31,13 +39,13 @@
 static int establish_proxy_connection(int fd, char *host, int port)
 {
 	char buffer[1024];
 	char *cp;
 
 	snprintf(buffer, sizeof(buffer), "CONNECT %s:%d HTTP/1.0\r\n\r\n", host, port);
-	if (write(fd, buffer, strlen(buffer)) != strlen(buffer)) {
+	if (write(fd, buffer, strlen(buffer)) != (int) strlen(buffer)) {
 		rprintf(FERROR, "failed to write to proxy: %s\n",
 			strerror(errno));
 		return -1;
 	}
 
 	for (cp = buffer; cp < &buffer[sizeof(buffer) - 1]; cp++) {
@@ -102,13 +110,13 @@
 	struct addrinfo bhints, *bres_all, *r;
 
 	memset(&bhints, 0, sizeof(bhints));
 	bhints.ai_family = ai_family;
 	bhints.ai_socktype = ai_socktype;
 	bhints.ai_flags = AI_PASSIVE;
-	if (getaddrinfo(bind_address, NULL, &bhints, &bres_all) == -1) {
+	if ((error = getaddrinfo(bind_address, NULL, &bhints, &bres_all))) {
 		rprintf(FERROR, RSYNC_NAME ": getaddrinfo %s: %s\n",
 			bind_address, gai_strerror(error));
 		return -1;
 	}
 
 	for (r = bres_all; r; r = r->ai_next) {
@@ -147,13 +155,12 @@
 int open_socket_out(char *host, int port, const char *bind_address,
 		    int af_hint)
 {
 	int type = SOCK_STREAM;
 	int error;
 	int s;
-	int result;
 	struct addrinfo hints, *res0, *res;
 	char portbuf[10];
 	char *h;
 	int proxied = 0;
 	char buffer[1024];
 	char *cp;
@@ -379,13 +386,13 @@
 	/* now accept incoming connections - forking a new process
 	   for each incoming connection */
 	while (1) {
 		fd_set fds;
 		int fd;
 		struct sockaddr_storage addr;
-		int addrlen = sizeof(addr);
+		socklen_t addrlen = sizeof addr;
 
 		/* close log file before the potentially very long select so
 		   file can be trimmed by another process instead of growing
 		   forever */
 		log_close();
 
@@ -556,135 +563,12 @@
 	for (i=0;i<3;i++) {
 		close(i); 
 		open("/dev/null", O_RDWR);
 	}
 }
 
-/**
- * Return the IP addr of the client as a string 
- **/
-char *client_addr(int fd)
-{
-	struct sockaddr_storage ss;
-	int     length = sizeof(ss);
-	static char addr_buf[100];
-	static int initialised;
-
-	if (initialised) return addr_buf;
-
-	initialised = 1;
-
-	if (getpeername(fd, (struct sockaddr *)&ss, &length)) {
-		exit_cleanup(RERR_SOCKETIO);
-	}
-
-	getnameinfo((struct sockaddr *)&ss, length,
-		addr_buf, sizeof(addr_buf), NULL, 0, NI_NUMERICHOST);
-	return addr_buf;
-}
-
-
-static int get_sockaddr_family(const struct sockaddr_storage *ss)
-{
-	return ((struct sockaddr *) ss)->sa_family;
-}
-
-
-/**
- * Return the DNS name of the client 
- **/
-char *client_name(int fd)
-{
-	struct sockaddr_storage ss;
-	int     length = sizeof(ss);
-	static char name_buf[100];
-	static char port_buf[100];
-	char *def = "UNKNOWN";
-	static int initialised;
-	struct addrinfo hints, *res, *res0;
-	int error;
-
-	if (initialised) return name_buf;
-
-	initialised = 1;
-
-	strcpy(name_buf,def);
-
-	if (getpeername(fd, (struct sockaddr *)&ss, &length)) {
-		/* FIXME: Can we really not continue? */
-		rprintf(FERROR, RSYNC_NAME ": getpeername on fd%d failed: %s\n",
-			fd, strerror(errno));
-		exit_cleanup(RERR_SOCKETIO);
-	}
-
-#ifdef INET6
-        if (get_sockaddr_family(&ss) == AF_INET6 && 
-	    IN6_IS_ADDR_V4MAPPED(&((struct sockaddr_in6 *)&ss)->sin6_addr)) {
-		struct sockaddr_in6 sin6;
-		struct sockaddr_in *sin;
-
-		memcpy(&sin6, &ss, sizeof(sin6));
-		sin = (struct sockaddr_in *)&ss;
-		memset(sin, 0, sizeof(*sin));
-		sin->sin_family = AF_INET;
-		length = sizeof(struct sockaddr_in);
-#ifdef HAVE_SOCKADDR_LEN
-		sin->sin_len = length;
-#endif
-		sin->sin_port = sin6.sin6_port;
-		memcpy(&sin->sin_addr, &sin6.sin6_addr.s6_addr[12],
-			sizeof(sin->sin_addr));
-        }
-#endif
-
-	/* reverse lookup */
-	if (getnameinfo((struct sockaddr *)&ss, length,
-			name_buf, sizeof(name_buf), port_buf, sizeof(port_buf),
-			NI_NAMEREQD | NI_NUMERICSERV) != 0) {
-		strcpy(name_buf, def);
-		rprintf(FERROR, "reverse name lookup failed\n");
-	}
-
-	/* forward lookup */
-	memset(&hints, 0, sizeof(hints));
-	hints.ai_family = PF_UNSPEC;
-	hints.ai_flags = AI_CANONNAME;
-	hints.ai_socktype = SOCK_STREAM;
-	error = getaddrinfo(name_buf, port_buf, &hints, &res0);
-	if (error) {
-		strcpy(name_buf, def);
-		rprintf(FERROR,
-			RSYNC_NAME ": forward name lookup for %s failed: %s\n",
-			port_buf,
-			gai_strerror(error));
-		return name_buf;
-	}
-
-	/* XXX sin6_flowinfo and other fields */
-	for (res = res0; res; res = res->ai_next) {
-		if (res->ai_family != get_sockaddr_family(&ss))
-			continue;
-		if (res->ai_addrlen != length)
-			continue;
-		if (memcmp(res->ai_addr, &ss, res->ai_addrlen) == 0)
-			break;
-	}
-
-	/* TODO: Do a  forward lookup as well to prevent spoofing */
-
-	if (res == NULL) {
-		strcpy(name_buf, def);
-		rprintf(FERROR, RSYNC_NAME ": "
-			"reverse name lookup mismatch on fd%d - spoofed address?\n",
-			fd);
-	}
-
-	freeaddrinfo(res0);
-	return name_buf;
-}
-
 
 /*******************************************************************
 this is like socketpair but uses tcp. It is used by the Samba
 regression test code
 The function guarantees that nobody else can attach to the socket,
 or if they do that this function fails and the socket gets closed
@@ -747,38 +631,44 @@
 	if (fd[1] != -1) close(fd[1]);
 	if (listener != -1) close(listener);
 	return -1;
 }
 
 
-/*******************************************************************
-run a program on a local tcp socket, this is used to launch smbd
-when regression testing
-the return value is a socket which is attached to a subprocess
-running "prog". stdin and stdout are attached. stderr is left
-attached to the original stderr
- ******************************************************************/
+
+/**
+ * Run a program on a local tcp socket, so that we can talk to it's
+ * stdin and stdout.  This is used to fake a connection to a daemon
+ * for testing -- not for the normal case of running SSH.
+ *
+ * @return a socket which is attached to a subprocess running
+ * "prog". stdin and stdout are attached. stderr is left attached to
+ * the original stderr
+ **/
 int sock_exec(const char *prog)
 {
 	int fd[2];
+	
 	if (socketpair_tcp(fd) != 0) {
 		rprintf (FERROR, RSYNC_NAME
 			 ": socketpair_tcp failed (%s)\n",
 			 strerror(errno));
 		return -1;
 	}
 	if (fork() == 0) {
 		close(fd[0]);
 		close(0);
 		close(1);
 		dup(fd[1]);
 		dup(fd[1]);
-		if (verbose > 3)
+		if (verbose > 3) {
+			/* Can't use rprintf because we've forked. */
 			fprintf (stderr,
 				 RSYNC_NAME ": execute socket program \"%s\"\n",
 				 prog);
+		}
 		exit (system (prog));
 	}
 	close (fd[1]);
 	return fd[0];
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/syscall.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/syscall.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/syscall.c	2001-11-30 08:21:09.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/syscall.c	2002-01-14 08:16:51.000000000 +0800
@@ -129,13 +129,13 @@
 			return -1;
 		}
 		return fd;
 	}
 #else
 	if (!mktemp(template)) return -1;
-	return open(template, O_RDWR|O_EXCL|O_CREAT, perms);
+	return do_open(template, O_RDWR|O_EXCL|O_CREAT, perms);
 #endif
 }
 
 int do_stat(const char *fname, STRUCT_STAT *st)
 {
 #if HAVE_OFF64_T
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite: devices.test
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite: duplicates.test
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite: hardlinks.test
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/testsuite/rsync.fns /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite/rsync.fns
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/testsuite/rsync.fns	2002-01-03 15:09:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite/rsync.fns	2002-01-25 18:55:59.000000000 +0800
@@ -132,41 +132,41 @@
 
 ###########################
 # Run a test (in '$1') then compare directories $2 and $3 to see if
 # there are any difference.  If there are, explain them.
 
 checkit() {
-    log=${LOG}
     failed=
-    # the log accumulates all output; we only display it if there 
-    # is a problem.
 
-    echo "Running: \"$1\""  >${log}
-    echo "">>${log}
-    eval "$1"  >>${log} 2>&1
+    # We can just write everything to stdout/stderr, because the
+    # wrapper hides it unless there is a problem.
+
+    echo "Running: \"$1\""  
+    eval "$1" 
     status=$?
     if [ $status != 0 ]; then
 	failed="YES";
     fi
 
-    echo "-------------">>${log}
-    echo "check how the files compare with diff:">>${log}
-    echo "">>${log}
-    diff -cr $2 $3 >>${log} 2>&1 || failed=YES
-    echo "-------------">>${log}
-    echo "check how the directory listings compare with diff:">>${log}
-    echo "">>${log}
-    ( cd "$2" && rsync_ls_lR . ) > ${TMP}/ls-from 2>>${log}
-    ( cd "$3" && rsync_ls_lR . ) > ${TMP}/ls-to  2>>${log}
-    diff -c ${TMP}/ls-from ${TMP}/ls-to >>${log} 2>&1 || failed=YES
+    echo "-------------"
+    echo "check how the files compare with diff:"
+    echo ""
+    for f in `cd "$2"; find . -type f -print `
+    do 
+        diff -u "$2"/"$f" "$3"/"$f" || failed=YES
+    done
+
+    echo "-------------"
+    echo "check how the directory listings compare with diff:"
+    echo ""
+    ( cd "$2" && rsync_ls_lR . ) > ${TMP}/ls-from 
+    ( cd "$3" && rsync_ls_lR . ) > ${TMP}/ls-to 
+    diff -c ${TMP}/ls-from ${TMP}/ls-to || failed=YES
     if [ -z "${failed}" ] ; then
-	rm $log
 	return 0
     else
-	cat ${log}
-	rm ${log}
 	return 1
     fi
 }
 
 
 # In fact, we need a more general feature of capturing all stderr/log files,
@@ -223,8 +223,21 @@
 
 test_fail() {
     echo "$@" >&2
     exit 1
 }
 
+test_skipped() {
+    echo "$@" >&2
+    exit 77
+}
+
+# It failed, but we expected that.  don't dump out error logs, 
+# because most users won't want to see them.  But do leave
+# the working directory around.
+test_xfail() {
+    echo "$@" >&2
+    exit 78
+}
+
 # be reproducible
 umask 077
\ No newline at end of file
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/testsuite/symlink-ignore.test /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite/symlink-ignore.test
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/testsuite/symlink-ignore.test	2001-12-14 13:55:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/testsuite/symlink-ignore.test	2002-01-24 13:54:47.000000000 +0800
@@ -15,15 +15,15 @@
 build_symlinks || test_fail "failed to build symlinks"
 
 # Copy recursively, but without -l or -L or -a, and all the symlinks
 # should be missing.
 "$rsync_bin" -r "$fromdir/" "$todir" || test_fail "rsync returned $?"
 
-[ -e "$todir/referent" ] || test_fail "referent was not copied"
-[ -e "$todir/from" ] && test_fail "extra level of directories"
-[ -e "$todir/dangling" ] && test_fail "dangling symlink was copied"
-[ -e "$todir/relative" ] && test_fail "relative symlink was copied" 
-[ -e "$todir/absolute" ] && test_fail "absolute symlink was copied"
+[ -f "${todir}/referent" ] || test_fail "referent was not copied"
+[ -d "${todir}/from" ] && test_fail "extra level of directories"
+[ -L "${todir}/dangling" ] && test_fail "dangling symlink was copied"
+[ -L "${todir}/relative" ] && test_fail "relative symlink was copied" 
+[ -L "${todir}/absolute" ] && test_fail "absolute symlink was copied"
 
 exit 0
 # last [] may have failed but if we get here then we've one
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/tls.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/tls.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/tls.c	2002-01-03 15:09:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/tls.c	2002-01-11 15:09:22.000000000 +0800
@@ -1,9 +1,9 @@
 /* -*- c-file-style: "linux" -*-
  *
- * Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+ * Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
  * 
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of the GNU General Public License version
  * 2 as published by the Free Software Foundation.
  * 
  * This program is distributed in the hope that it will be useful,
@@ -114,15 +114,16 @@
 	
 	/* TODO: Perhaps escape special characters in fname? */
 	
 	
 	/* NB: need to pass size as a double because it might be be
 	 * too large for a long. */
-	printf("%s %12.0f %6d.%-6d %s %s%s\n",
+	printf("%s %12.0f %6d.%-6d %6d %s %s%s\n",
 	       permbuf, (double) buf.st_size,
 	       buf.st_uid, buf.st_gid,
+	       buf.st_nlink,
 	       datebuf, fname, linkbuf);
 }
 
 
 int main (int argc, char *argv[])
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/TODO /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/TODO
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/TODO	2002-01-03 15:09:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/TODO	2002-01-25 17:45:45.000000000 +0800
@@ -29,20 +29,151 @@
 --files-from
 
   Avoids traversal.  Better option than a pile of --include statements
   for people who want to generate the file list using a find(1)
   command or a script.
 
+File list structure in memory
+
+  Rather than one big array, perhaps have a tree in memory mirroring
+  the directory tree.  
+
+  This might make sorting much faster!  (I'm not sure it's a big CPU
+  problem, mind you.)  
+
+  It might also reduce memory use in storing repeated directory names
+  -- again I'm not sure this is a problem.
+
 Performance
 
   Traverse just one directory at a time.  Tridge says it's possible.
- 
-  Can possibly also be smarter about memory use while looking for hard
-  links by reducing the refcount as we find alternative names.  In
-  fact at the moment the code seems to make a whole second copy of the
-  file list, which seems unnecessary.
+
+  At the moment rsync reads the whole file list into memory at the
+  start, which makes us use a lot of memory and also not pipeline
+  network access as much as we could.
+
+
+Handling duplicate names
+
+  We need to be careful of duplicate names getting into the file list.
+  See clean_flist().  This could happen if multiple arguments include
+  the same file.  Bad.
+
+  I think duplicates are only a problem if they're both flowing
+  through the pipeline at the same time.  For example we might have
+  updated the first occurrence after reading the checksums for the
+  second.  So possibly we just need to make sure that we don't have
+  both in the pipeline at the same time.  
+
+  Possibly if we did one directory at a time that would be sufficient.
+
+  Alternatively we could pre-process the arguments to make sure no
+  duplicates will ever be inserted.  There could be some bad cases
+  when we're collapsing symlinks.
+
+  We could have a hash table.
+
+  The root of the problem is that we do not want more than one file
+  list entry referring to the same file.  At first glance there are
+  several ways this could happen: symlinks, hardlinks, and repeated
+  names on the command line.
+
+  If names are repeated on the command line, they may be present in
+  different forms, perhaps by traversing directory paths in different
+  ways, traversing paths including symlinks.  Also we need to allow
+  for expansion of globs by rsync.
+
+  At the moment, clean_flist() requires having the entire file list in
+  memory.  Duplicate names are detected just by a string comparison.
+
+  We don't need to worry about hard links causing duplicates because
+  files are never updated in place.  Similarly for symlinks.
+
+  I think even if we're using a different symlink mode we don't need
+  to worry.
+
+  Unless we're really clever this will introduce a protocol
+  incompatibility, so we need to be able to accept the old format as
+  well.
+
+
+Memory accounting
+
+  At exit, show how much memory was used for the file list, etc.
+
+  Also we do a wierd exponential-growth allocation in flist.c.  I'm
+  not sure this makes sense with modern mallocs.  At any rate it will
+  make us allocate a huge amount of memory for large file lists.
+
+
+Hard-link handling
+
+  At the moment hardlink handling is very expensive, so it's off by
+  default.  It does not need to be so.  
+
+  Since most of the solutions are rather intertwined with the file
+  list it is probably better to fix that first, although fixing
+  hardlinks is possibly simpler.
+
+  We can rule out hardlinked directories since they will probably
+  screw us up in all kinds of ways.  They simply should not be used.
+
+  At the moment rsync only cares about hardlinks to regular files.  I
+  guess you could also use them for sockets, devices and other beasts,
+  but I have not seen them.
+
+  When trying to reproduce hard links, we only need to worry about
+  files that have more than one name (nlinks>1 && !S_ISDIR). 
+
+  The basic point of this is to discover alternate names that refer to
+  the same file.  All operations, including creating the file and
+  writing modifications to it need only to be done for the first name.
+  For all later names, we just create the link and then leave it
+  alone.
+
+  If hard links are to be preserved:
+
+    Before the generator/receiver fork, the list of files is received
+    from the sender (recv_file_list), and a table for detecting hard
+    links is built.
+
+    The generator looks for hard links within the file list and does
+    not send checksums for them, though it does send other metadata.
+
+    The sender sends the device number and inode with file entries, so
+    that files are uniquely identified.
+
+    The receiver goes through and creates hard links (do_hard_links)
+    after all data has been written, but before directory permissions
+    are set.
+
+  At the moment device and inum are sent as 4-byte integers, which
+  will probably cause problems on large filesystems.  On Linux the
+  kernel uses 64-bit ino_t's internally, and people will soon have
+  filesystems big enough to use them.  We ought to follow NFS4 in
+  using 64-bit device and inode identification, perhaps with a
+  protocol version bump.
+
+  Once we've seen all the names for a particular file, we no longer
+  need to think about it and we can deallocate the memory.
+
+  We can also have the case where there are links to a file that are
+  not in the tree being transferred.  There's nothing we can do about
+  that.  Because we rename the destination into place after writing,
+  any hardlinks to the old file are always going to be orphaned.  In
+  fact that is almost necessary because otherwise we'd get really
+  confused if we were generating checksums for one name of a file and
+  modifying another.
+
+  At the moment the code seems to make a whole second copy of the file
+  list, which seems unnecessary.
+
+  We should have a test case that exercises hard links.  Since it
+  might be hard to compare ./tls output where the inodes change we
+  might need a little program to check whether several names refer to
+  the same file.
 
 IPv6
 
   Implement suggestions from http://www.kame.net/newsletter/19980604/
   and ftp://ftp.iij.ad.jp/pub/RFC/rfc2553.txt
 
@@ -97,16 +228,32 @@
 logging
 
   Perhaps flush stdout after each filename, so that people trying to
   monitor progress in a log file can do so more easily.  See
   http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=48108
 
+  At the connections that just get a list of modules are not logged,
+  but they should be.
+
 rsyncd over ssh
 
   There are already some patches to do this.
 
+proxy authentication
+
+  Allow RSYNC_PROXY to be http://user:pass@proxy.foo:3128/, and do
+  HTTP Basic Proxy-Authentication.  
+
+  Multiple schemes are possible, up to and including the insanity that
+  is NTLM, but Basic probably covers most cases.
+
+SOCKS
+
+  Add --with-socks, and then perhaps a command-line option to put them
+  on or off.  This might be more reliable than LD_PRELOAD hacks.
+
 PLATFORMS ------------------------------------------------------------
 
 Win32
 
   Don't detach, because this messes up --srvany.
 
@@ -134,26 +281,20 @@
   HP-UX variants (via HP?)
 
   SCO
 
 NICE -----------------------------------------------------------------
 
-SIGHUP
-
-  Re-read config file (just exec() ourselves) rather than exiting.
-
 --no-detach and --no-fork options
 
   Very useful for debugging.  Also good when running under a
   daemon-monitoring process that tries to restart the service when the
   parent exits.
 
 hang/timeout friendliness
 
-  On 
-
 verbose output
   
   Indicate whether files are new, updated, or deleted
 
 internationalization
 
@@ -169,6 +310,7 @@
    Write a small emulation of interactive ftp as a Pythonn program
    that calls rsync.  Commands such as "cd", "ls", "ls *.c" etc map
    fairly directly into rsync commands: it just needs to remember the
    current host, directory and so on.  We can probably even do
    completion of remote filenames.
 
+%K%
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/util.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/util.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.1/util.c	2002-01-03 15:09:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rsync/repos/rsync-2.5.2/util.c	2002-01-26 07:07:33.000000000 +0800
@@ -1,11 +1,11 @@
 /*  -*- c-file-style: "linux" -*-
     
     Copyright (C) 1996-2000 by Andrew Tridgell 
     Copyright (C) Paul Mackerras 1996
-    Copyright (C) 2001 by Martin Pool <mbp@samba.org>
+    Copyright (C) 2001, 2002 by Martin Pool <mbp@samba.org>
    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
@@ -81,75 +81,99 @@
 	}
 	
 	return ret;
 }
 
 
+void print_child_argv(char **cmd)
+{
+	rprintf(FINFO, RSYNC_NAME ": open connection using ");
+	for (; *cmd; cmd++) {
+		/* Look for characters that ought to be quoted.  This
+		* is not a great quoting algorithm, but it's
+		* sufficient for a log message. */
+		if (strspn(*cmd, "abcdefghijklmnopqrstuvwxyz"
+			   "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
+			   "0123456789"
+			   ",.-_=+@/") != strlen(*cmd)) {
+			rprintf(FINFO, "\"%s\" ", *cmd);
+		} else {
+			rprintf(FINFO, "%s ", *cmd);
+		}
+	}
+	rprintf(FINFO, "\n");
+}
+
+
 /* this is derived from CVS code 
 
    note that in the child STDIN is set to blocking and STDOUT
    is set to non-blocking. This is necessary as rsh relies on stdin being blocking
    and ssh relies on stdout being non-blocking
 
    if blocking_io is set then use blocking io on both fds. That can be
    used to cope with badly broken rsh implementations like the one on
    solaris.
  */
-pid_t piped_child(char **command,int *f_in,int *f_out)
+pid_t piped_child(char **command, int *f_in, int *f_out)
 {
-  pid_t pid;
-  int to_child_pipe[2];
-  int from_child_pipe[2];
-  extern int blocking_io;
-
-  if (fd_pair(to_child_pipe) < 0 ||
-      fd_pair(from_child_pipe) < 0) {
-    rprintf(FERROR,"pipe: %s\n",strerror(errno));
-    exit_cleanup(RERR_IPC);
-  }
-
-
-  pid = do_fork();
-  if (pid == -1) {
-    rprintf(FERROR,"fork: %s\n",strerror(errno));
-    exit_cleanup(RERR_IPC);
-  }
-
-  if (pid == 0)
-    {
-      extern int orig_umask;
-      if (dup2(to_child_pipe[0], STDIN_FILENO) < 0 ||
-	  close(to_child_pipe[1]) < 0 ||
-	  close(from_child_pipe[0]) < 0 ||
-	  dup2(from_child_pipe[1], STDOUT_FILENO) < 0) {
-	rprintf(FERROR,"Failed to dup/close : %s\n",strerror(errno));
-	exit_cleanup(RERR_IPC);
-      }
-      if (to_child_pipe[0] != STDIN_FILENO) close(to_child_pipe[0]);
-      if (from_child_pipe[1] != STDOUT_FILENO) close(from_child_pipe[1]);
-      umask(orig_umask);
-      set_blocking(STDIN_FILENO);
-      if (blocking_io) {
-	set_blocking(STDOUT_FILENO);
-      }
-      execvp(command[0], command);
-      rprintf(FERROR,"Failed to exec %s : %s\n",
-	      command[0],strerror(errno));
-      exit_cleanup(RERR_IPC);
-    }
-
-  if (close(from_child_pipe[1]) < 0 ||
-      close(to_child_pipe[0]) < 0) {
-    rprintf(FERROR,"Failed to close : %s\n",strerror(errno));   
-    exit_cleanup(RERR_IPC);
-  }
+	pid_t pid;
+	int to_child_pipe[2];
+	int from_child_pipe[2];
+	extern int blocking_io;
+	
+	if (verbose > 0) {
+		print_child_argv(command);
+	}
+
+	if (fd_pair(to_child_pipe) < 0 || fd_pair(from_child_pipe) < 0) {
+		rprintf(FERROR, "pipe: %s\n", strerror(errno));
+		exit_cleanup(RERR_IPC);
+	}
+
+
+	pid = do_fork();
+	if (pid == -1) {
+		rprintf(FERROR, "fork: %s\n", strerror(errno));
+		exit_cleanup(RERR_IPC);
+	}
+
+	if (pid == 0) {
+		extern int orig_umask;
+		if (dup2(to_child_pipe[0], STDIN_FILENO) < 0 ||
+		    close(to_child_pipe[1]) < 0 ||
+		    close(from_child_pipe[0]) < 0 ||
+		    dup2(from_child_pipe[1], STDOUT_FILENO) < 0) {
+			rprintf(FERROR, "Failed to dup/close : %s\n",
+				strerror(errno));
+			exit_cleanup(RERR_IPC);
+		}
+		if (to_child_pipe[0] != STDIN_FILENO)
+			close(to_child_pipe[0]);
+		if (from_child_pipe[1] != STDOUT_FILENO)
+			close(from_child_pipe[1]);
+		umask(orig_umask);
+		set_blocking(STDIN_FILENO);
+		if (blocking_io) {
+			set_blocking(STDOUT_FILENO);
+		}
+		execvp(command[0], command);
+		rprintf(FERROR, "Failed to exec %s : %s\n",
+			command[0], strerror(errno));
+		exit_cleanup(RERR_IPC);
+	}
 
-  *f_in = from_child_pipe[0];
-  *f_out = to_child_pipe[1];
+	if (close(from_child_pipe[1]) < 0 || close(to_child_pipe[0]) < 0) {
+		rprintf(FERROR, "Failed to close : %s\n", strerror(errno));
+		exit_cleanup(RERR_IPC);
+	}
 
-  return pid;
+	*f_in = from_child_pipe[0];
+	*f_out = to_child_pipe[1];
+
+	return pid;
 }
 
 pid_t local_child(int argc, char **argv,int *f_in,int *f_out)
 {
 	pid_t pid;
 	int to_child_pipe[2];
@@ -170,16 +194,13 @@
 	}
 
 	if (pid == 0) {
 		extern int am_sender;
 		extern int am_server;
 
-		if (read_batch)
-		    am_sender = 0;
-		else
-		    am_sender = !am_sender;
+		am_sender = read_batch ? 0 : !am_sender;
 		am_server = 1;		
 
 		if (dup2(to_child_pipe[0], STDIN_FILENO) < 0 ||
 		    close(to_child_pipe[1]) < 0 ||
 		    close(from_child_pipe[0]) < 0 ||
 		    dup2(from_child_pipe[1], STDOUT_FILENO) < 0) {
@@ -272,13 +293,13 @@
 
 /* Write LEN bytes at PTR to descriptor DESC, retrying if interrupted.
    Return LEN upon success, write's (negative) error code otherwise.  
 
    derived from GNU C's cccp.c.
 */
-static int full_write(int desc, char *ptr, int len)
+static int full_write(int desc, char *ptr, size_t len)
 {
 	int total_written;
 	
 	total_written = 0;
 	while (len > 0) {
 		int written = write (desc, ptr, len);
@@ -298,17 +319,17 @@
 
 /* Read LEN bytes at PTR from descriptor DESC, retrying if interrupted.
    Return the actual number of bytes read, zero for EOF, or negative
    for an error.  
 
    derived from GNU C's cccp.c. */
-static int safe_read(int desc, char *ptr, int len)
+static int safe_read(int desc, char *ptr, size_t len)
 {
 	int n_chars;
  
-	if (len <= 0)
+	if (len == 0)
 		return len;
  
 #ifdef EINTR
 	do {
 		n_chars = read(desc, ptr, len);
 	} while (n_chars < 0 && errno == EINTR);
@@ -535,13 +556,13 @@
 	glob(argv[*argc], 0, NULL, &globbuf);
 	if (globbuf.gl_pathc == 0) {
 		(*argc)++;
 		globfree(&globbuf);
 		return;
 	}
-	for (i=0; i<(maxargs - (*argc)) && i<globbuf.gl_pathc;i++) {
+	for (i=0; i<(maxargs - (*argc)) && i < (int) globbuf.gl_pathc;i++) {
 		if (i == 0) free(argv[*argc]);
 		argv[(*argc) + i] = strdup(globbuf.gl_pathv[i]);
 		if (!argv[(*argc) + i]) out_of_memory("glob_expand");
 	}
 	globfree(&globbuf);
 	(*argc) += i;
@@ -833,13 +854,13 @@
 static void rprint_progress(OFF_T ofs, OFF_T size, struct timeval *now,
 			    int is_last)
 {
     int           pct  = (ofs == size) ? 100 : (int)((100.0*ofs)/size);
     unsigned long diff = msdiff(&start_time, now);
     double        rate = diff ? (double) (ofs-start_ofs) * 1000.0 / diff / 1024.0 : 0;
-    const char    *units, *rem_units;
+    const char    *units;
     double        remain = rate ? (double) (size-ofs) / rate / 1000.0: 0.0;
     int 	  remain_h, remain_m, remain_s;
 
     if (rate > 1024*1024) {
 	    rate /= 1024.0 * 1024.0;
 	    units = "GB/s";
