<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="0.9.5" language="C++" filename="usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/gumtree/collectd_repos_function_536_collectd-5.5.3.cpp" pos:tabs="8"><function><specifier pos:line="1" pos:column="1">static<pos:position pos:line="1" pos:column="7"/></specifier> <type><name pos:line="1" pos:column="8">int<pos:position pos:line="1" pos:column="11"/></name></type> <name pos:line="1" pos:column="12">get_reference_temperature<pos:position pos:line="1" pos:column="37"/></name><parameter_list pos:line="1" pos:column="37">(<parameter><decl><type><name pos:line="1" pos:column="38">double<pos:position pos:line="1" pos:column="44"/></name> <modifier pos:line="1" pos:column="45">*<pos:position pos:line="1" pos:column="46"/></modifier></type> <name pos:line="1" pos:column="47">result<pos:position pos:line="1" pos:column="53"/></name></decl></parameter>)<pos:position pos:line="1" pos:column="54"/></parameter_list>
<block pos:line="2" pos:column="1">{
    <decl_stmt><decl><type><name pos:line="3" pos:column="5">temperature_list_t<pos:position pos:line="3" pos:column="23"/></name> <modifier pos:line="3" pos:column="24">*<pos:position pos:line="3" pos:column="25"/></modifier></type> <name pos:line="3" pos:column="26">list<pos:position pos:line="3" pos:column="30"/></name> <init pos:line="3" pos:column="31">= <expr><name pos:line="3" pos:column="33">temp_list<pos:position pos:line="3" pos:column="42"/></name></expr></init></decl>;<pos:position pos:line="3" pos:column="43"/></decl_stmt>

    <decl_stmt><decl><type><name pos:line="5" pos:column="5">gauge_t<pos:position pos:line="5" pos:column="12"/></name> <modifier pos:line="5" pos:column="13">*<pos:position pos:line="5" pos:column="14"/></modifier></type> <name pos:line="5" pos:column="15">values<pos:position pos:line="5" pos:column="21"/></name> <init pos:line="5" pos:column="22">= <expr><name pos:line="5" pos:column="24">NULL<pos:position pos:line="5" pos:column="28"/></name></expr></init></decl>;<pos:position pos:line="5" pos:column="29"/></decl_stmt>   <comment type="block" format="doxygen" pos:line="5" pos:column="32">/**&lt; rate values */</comment>
    <decl_stmt><decl><type><name pos:line="6" pos:column="5">size_t<pos:position pos:line="6" pos:column="11"/></name></type>    <name pos:line="6" pos:column="15">values_num<pos:position pos:line="6" pos:column="25"/></name> <init pos:line="6" pos:column="26">= <expr><literal type="number" pos:line="6" pos:column="28">0<pos:position pos:line="6" pos:column="29"/></literal></expr></init></decl>;<pos:position pos:line="6" pos:column="30"/></decl_stmt>  <comment type="block" format="doxygen" pos:line="6" pos:column="32">/**&lt; number of rate values */</comment>
    <decl_stmt><decl><type><name pos:line="7" pos:column="5">int<pos:position pos:line="7" pos:column="8"/></name></type> <name pos:line="7" pos:column="9">i<pos:position pos:line="7" pos:column="10"/></name></decl>;<pos:position pos:line="7" pos:column="11"/></decl_stmt>

    <decl_stmt><decl><type><name pos:line="9" pos:column="5">gauge_t<pos:position pos:line="9" pos:column="12"/></name></type> <name><name pos:line="9" pos:column="13">values_history<pos:position pos:line="9" pos:column="27"/></name><index pos:line="9" pos:column="27">[<expr><name pos:line="9" pos:column="28">REF_TEMP_AVG_NUM<pos:position pos:line="9" pos:column="44"/></name></expr>]<pos:position pos:line="9" pos:column="45"/></index></name></decl>;<pos:position pos:line="9" pos:column="46"/></decl_stmt>

    <decl_stmt><decl><type><name pos:line="11" pos:column="5">double<pos:position pos:line="11" pos:column="11"/></name></type> <name pos:line="11" pos:column="12">avg_sum<pos:position pos:line="11" pos:column="19"/></name></decl>;<pos:position pos:line="11" pos:column="20"/></decl_stmt>  <comment type="block" format="doxygen" pos:line="11" pos:column="22">/**&lt; Value sum for computing average */</comment>
    <decl_stmt><decl><type><name pos:line="12" pos:column="5">int<pos:position pos:line="12" pos:column="8"/></name></type>    <name pos:line="12" pos:column="12">avg_num<pos:position pos:line="12" pos:column="19"/></name></decl>;<pos:position pos:line="12" pos:column="20"/></decl_stmt>  <comment type="block" format="doxygen" pos:line="12" pos:column="22">/**&lt; Number of values for computing average */</comment>
    <decl_stmt><decl><type><name pos:line="13" pos:column="5">double<pos:position pos:line="13" pos:column="11"/></name></type> <name pos:line="13" pos:column="12">average<pos:position pos:line="13" pos:column="19"/></name></decl>;<pos:position pos:line="13" pos:column="20"/></decl_stmt>  <comment type="block" format="doxygen" pos:line="13" pos:column="22">/**&lt; Resulting value average */</comment>

    <expr_stmt><expr><operator pos:line="15" pos:column="5">*<pos:position pos:line="15" pos:column="6"/></operator><name pos:line="15" pos:column="6">result<pos:position pos:line="15" pos:column="12"/></name> <operator pos:line="15" pos:column="13">=<pos:position pos:line="15" pos:column="14"/></operator> <name pos:line="15" pos:column="15">NAN<pos:position pos:line="15" pos:column="18"/></name></expr>;<pos:position pos:line="15" pos:column="19"/></expr_stmt>

    <while pos:line="17" pos:column="5">while<condition pos:line="17" pos:column="10">(<expr><name pos:line="17" pos:column="11">list<pos:position pos:line="17" pos:column="15"/></name> <operator pos:line="17" pos:column="16">!=<pos:position pos:line="17" pos:column="18"/></operator> <name pos:line="17" pos:column="19">NULL<pos:position pos:line="17" pos:column="23"/></name></expr>)<pos:position pos:line="17" pos:column="24"/></condition>
    <block pos:line="18" pos:column="5">{
        <expr_stmt><expr><name pos:line="19" pos:column="9">avg_sum<pos:position pos:line="19" pos:column="16"/></name> <operator pos:line="19" pos:column="17">=<pos:position pos:line="19" pos:column="18"/></operator> <literal type="number" pos:line="19" pos:column="19">0.0<pos:position pos:line="19" pos:column="22"/></literal></expr>;<pos:position pos:line="19" pos:column="23"/></expr_stmt>
        <expr_stmt><expr><name pos:line="20" pos:column="9">avg_num<pos:position pos:line="20" pos:column="16"/></name> <operator pos:line="20" pos:column="17">=<pos:position pos:line="20" pos:column="18"/></operator> <literal type="number" pos:line="20" pos:column="19">0<pos:position pos:line="20" pos:column="20"/></literal></expr>;<pos:position pos:line="20" pos:column="21"/></expr_stmt>

        <comment type="block" pos:line="22" pos:column="9">/* First time need to read current rate to learn how many values are
           there (typically for temperature it would be just one).
           We do not expect dynamic changing of number of temperarure values
           in runtime yet (are there any such cases?). */</comment>
        <if pos:line="26" pos:column="9">if<condition pos:line="26" pos:column="11">(<expr><operator pos:line="26" pos:column="12">!<pos:position pos:line="26" pos:column="13"/></operator><name><name pos:line="26" pos:column="13">list<pos:position pos:line="26" pos:column="17"/></name><operator pos:line="26" pos:column="17">-&gt;<pos:position pos:line="26" pos:column="22"/></operator><name pos:line="26" pos:column="19">initialized<pos:position pos:line="26" pos:column="30"/></name></name></expr>)<pos:position pos:line="26" pos:column="31"/></condition><then pos:line="26" pos:column="31">
        <block pos:line="27" pos:column="9">{
            <if pos:line="28" pos:column="13">if<condition pos:line="28" pos:column="15">(<expr><call><name pos:line="28" pos:column="16">uc_get_rate_by_name<pos:position pos:line="28" pos:column="35"/></name><argument_list pos:line="28" pos:column="35">(<argument><expr><name><name pos:line="28" pos:column="36">list<pos:position pos:line="28" pos:column="40"/></name><operator pos:line="28" pos:column="40">-&gt;<pos:position pos:line="28" pos:column="45"/></operator><name pos:line="28" pos:column="42">sensor_name<pos:position pos:line="28" pos:column="53"/></name></name></expr></argument>,
                                   <argument><expr><operator pos:line="29" pos:column="36">&amp;<pos:position pos:line="29" pos:column="41"/></operator><name pos:line="29" pos:column="37">values<pos:position pos:line="29" pos:column="43"/></name></expr></argument>,
                                   <argument><expr><operator pos:line="30" pos:column="36">&amp;<pos:position pos:line="30" pos:column="41"/></operator><name pos:line="30" pos:column="37">values_num<pos:position pos:line="30" pos:column="47"/></name></expr></argument>)<pos:position pos:line="30" pos:column="48"/></argument_list></call></expr>)<pos:position pos:line="30" pos:column="49"/></condition><then pos:line="30" pos:column="49">
            <block pos:line="31" pos:column="13">{
                <expr_stmt><expr><call><name pos:line="32" pos:column="17">DEBUG<pos:position pos:line="32" pos:column="22"/></name> <argument_list pos:line="32" pos:column="23">(<argument><expr><literal type="string" pos:line="32" pos:column="24">"barometer: get_reference_temperature - rate \"%s\" not found yet"<pos:position pos:line="32" pos:column="90"/></literal></expr></argument>,
                       <argument><expr><name><name pos:line="33" pos:column="24">list<pos:position pos:line="33" pos:column="28"/></name><operator pos:line="33" pos:column="28">-&gt;<pos:position pos:line="33" pos:column="33"/></operator><name pos:line="33" pos:column="30">sensor_name<pos:position pos:line="33" pos:column="41"/></name></name></expr></argument>)<pos:position pos:line="33" pos:column="42"/></argument_list></call></expr>;<pos:position pos:line="33" pos:column="43"/></expr_stmt>
                <expr_stmt><expr><name pos:line="34" pos:column="17">list<pos:position pos:line="34" pos:column="21"/></name> <operator pos:line="34" pos:column="22">=<pos:position pos:line="34" pos:column="23"/></operator> <name><name pos:line="34" pos:column="24">list<pos:position pos:line="34" pos:column="28"/></name><operator pos:line="34" pos:column="28">-&gt;<pos:position pos:line="34" pos:column="33"/></operator><name pos:line="34" pos:column="30">next<pos:position pos:line="34" pos:column="34"/></name></name></expr>;<pos:position pos:line="34" pos:column="35"/></expr_stmt>
                <continue pos:line="35" pos:column="17">continue;<pos:position pos:line="35" pos:column="26"/></continue>
            }<pos:position pos:line="36" pos:column="14"/></block></then></if>

            <expr_stmt><expr><call><name pos:line="38" pos:column="13">DEBUG<pos:position pos:line="38" pos:column="18"/></name> <argument_list pos:line="38" pos:column="19">(<argument><expr><literal type="string" pos:line="38" pos:column="20">"barometer: get_reference_temperature - initialize \"%s\", %zu vals"<pos:position pos:line="38" pos:column="88"/></literal></expr></argument>,
                   <argument><expr><name><name pos:line="39" pos:column="20">list<pos:position pos:line="39" pos:column="24"/></name><operator pos:line="39" pos:column="24">-&gt;<pos:position pos:line="39" pos:column="29"/></operator><name pos:line="39" pos:column="26">sensor_name<pos:position pos:line="39" pos:column="37"/></name></name></expr></argument>,
                   <argument><expr><name pos:line="40" pos:column="20">values_num<pos:position pos:line="40" pos:column="30"/></name></expr></argument>)<pos:position pos:line="40" pos:column="31"/></argument_list></call></expr>;<pos:position pos:line="40" pos:column="32"/></expr_stmt>

            <expr_stmt><expr><name><name pos:line="42" pos:column="13">list<pos:position pos:line="42" pos:column="17"/></name><operator pos:line="42" pos:column="17">-&gt;<pos:position pos:line="42" pos:column="22"/></operator><name pos:line="42" pos:column="19">initialized<pos:position pos:line="42" pos:column="30"/></name></name> <operator pos:line="42" pos:column="31">=<pos:position pos:line="42" pos:column="32"/></operator> <literal type="number" pos:line="42" pos:column="33">1<pos:position pos:line="42" pos:column="34"/></literal></expr>;<pos:position pos:line="42" pos:column="35"/></expr_stmt>
            <expr_stmt><expr><name><name pos:line="43" pos:column="13">list<pos:position pos:line="43" pos:column="17"/></name><operator pos:line="43" pos:column="17">-&gt;<pos:position pos:line="43" pos:column="22"/></operator><name pos:line="43" pos:column="19">num_values<pos:position pos:line="43" pos:column="29"/></name></name> <operator pos:line="43" pos:column="30">=<pos:position pos:line="43" pos:column="31"/></operator> <name pos:line="43" pos:column="32">values_num<pos:position pos:line="43" pos:column="42"/></name></expr>;<pos:position pos:line="43" pos:column="43"/></expr_stmt>

            <for pos:line="45" pos:column="13">for<control pos:line="45" pos:column="16">(<init><expr><name pos:line="45" pos:column="17">i<pos:position pos:line="45" pos:column="18"/></name><operator pos:line="45" pos:column="18">=<pos:position pos:line="45" pos:column="19"/></operator><literal type="number" pos:line="45" pos:column="19">0<pos:position pos:line="45" pos:column="20"/></literal></expr>;<pos:position pos:line="45" pos:column="21"/></init> <condition><expr><name pos:line="45" pos:column="22">i<pos:position pos:line="45" pos:column="23"/></name><operator pos:line="45" pos:column="23">&lt;<pos:position pos:line="45" pos:column="27"/></operator><name pos:line="45" pos:column="24">values_num<pos:position pos:line="45" pos:column="34"/></name></expr>;<pos:position pos:line="45" pos:column="35"/></condition> <incr><expr><operator pos:line="45" pos:column="36">++<pos:position pos:line="45" pos:column="38"/></operator><name pos:line="45" pos:column="38">i<pos:position pos:line="45" pos:column="39"/></name></expr></incr>)<pos:position pos:line="45" pos:column="40"/></control>
            <block pos:line="46" pos:column="13">{
                <expr_stmt><expr><call><name pos:line="47" pos:column="17">DEBUG<pos:position pos:line="47" pos:column="22"/></name> <argument_list pos:line="47" pos:column="23">(<argument><expr><literal type="string" pos:line="47" pos:column="24">"barometer: get_reference_temperature - rate %d: %lf **"<pos:position pos:line="47" pos:column="80"/></literal></expr></argument>,
                       <argument><expr><name pos:line="48" pos:column="24">i<pos:position pos:line="48" pos:column="25"/></name></expr></argument>,
                       <argument><expr><name><name pos:line="49" pos:column="24">values<pos:position pos:line="49" pos:column="30"/></name><index pos:line="49" pos:column="30">[<expr><name pos:line="49" pos:column="31">i<pos:position pos:line="49" pos:column="32"/></name></expr>]<pos:position pos:line="49" pos:column="33"/></index></name></expr></argument>)<pos:position pos:line="49" pos:column="34"/></argument_list></call></expr>;<pos:position pos:line="49" pos:column="35"/></expr_stmt>
                <if pos:line="50" pos:column="17">if<condition pos:line="50" pos:column="19">(<expr><operator pos:line="50" pos:column="20">!<pos:position pos:line="50" pos:column="21"/></operator><call><name pos:line="50" pos:column="21">isnan<pos:position pos:line="50" pos:column="26"/></name><argument_list pos:line="50" pos:column="26">(<argument><expr><name><name pos:line="50" pos:column="27">values<pos:position pos:line="50" pos:column="33"/></name><index pos:line="50" pos:column="33">[<expr><name pos:line="50" pos:column="34">i<pos:position pos:line="50" pos:column="35"/></name></expr>]<pos:position pos:line="50" pos:column="36"/></index></name></expr></argument>)<pos:position pos:line="50" pos:column="37"/></argument_list></call></expr>)<pos:position pos:line="50" pos:column="38"/></condition><then pos:line="50" pos:column="38">
                <block pos:line="51" pos:column="17">{
                    <expr_stmt><expr><name pos:line="52" pos:column="21">avg_sum<pos:position pos:line="52" pos:column="28"/></name> <operator pos:line="52" pos:column="29">+=<pos:position pos:line="52" pos:column="31"/></operator> <name><name pos:line="52" pos:column="32">values<pos:position pos:line="52" pos:column="38"/></name><index pos:line="52" pos:column="38">[<expr><name pos:line="52" pos:column="39">i<pos:position pos:line="52" pos:column="40"/></name></expr>]<pos:position pos:line="52" pos:column="41"/></index></name></expr>;<pos:position pos:line="52" pos:column="42"/></expr_stmt>
                    <expr_stmt><expr><operator pos:line="53" pos:column="21">++<pos:position pos:line="53" pos:column="23"/></operator><name pos:line="53" pos:column="23">avg_num<pos:position pos:line="53" pos:column="30"/></name></expr>;<pos:position pos:line="53" pos:column="31"/></expr_stmt>
                }<pos:position pos:line="54" pos:column="18"/></block></then></if>
            }<pos:position pos:line="55" pos:column="14"/></block></for>
            <expr_stmt><expr><call><name pos:line="56" pos:column="13">free<pos:position pos:line="56" pos:column="17"/></name><argument_list pos:line="56" pos:column="17">(<argument><expr><name pos:line="56" pos:column="18">values<pos:position pos:line="56" pos:column="24"/></name></expr></argument>)<pos:position pos:line="56" pos:column="25"/></argument_list></call></expr>;<pos:position pos:line="56" pos:column="26"/></expr_stmt>
            <expr_stmt><expr><name pos:line="57" pos:column="13">values<pos:position pos:line="57" pos:column="19"/></name> <operator pos:line="57" pos:column="20">=<pos:position pos:line="57" pos:column="21"/></operator> <name pos:line="57" pos:column="22">NULL<pos:position pos:line="57" pos:column="26"/></name></expr>;<pos:position pos:line="57" pos:column="27"/></expr_stmt>
        }<pos:position pos:line="58" pos:column="10"/></block></then></if>

        <comment type="block" pos:line="60" pos:column="9">/* It is OK to get here the first time as well, in the worst case
           the history will full of NANs. */</comment>
        <if pos:line="62" pos:column="9">if<condition pos:line="62" pos:column="11">(<expr><call><name pos:line="62" pos:column="12">uc_get_history_by_name<pos:position pos:line="62" pos:column="34"/></name><argument_list pos:line="62" pos:column="34">(<argument><expr><name><name pos:line="62" pos:column="35">list<pos:position pos:line="62" pos:column="39"/></name><operator pos:line="62" pos:column="39">-&gt;<pos:position pos:line="62" pos:column="44"/></operator><name pos:line="62" pos:column="41">sensor_name<pos:position pos:line="62" pos:column="52"/></name></name></expr></argument>,
                                  <argument><expr><name pos:line="63" pos:column="35">values_history<pos:position pos:line="63" pos:column="49"/></name></expr></argument>,
                                  <argument><expr><name pos:line="64" pos:column="35">REF_TEMP_AVG_NUM<pos:position pos:line="64" pos:column="51"/></name></expr></argument>,
                                  <argument><expr><name><name pos:line="65" pos:column="35">list<pos:position pos:line="65" pos:column="39"/></name><operator pos:line="65" pos:column="39">-&gt;<pos:position pos:line="65" pos:column="44"/></operator><name pos:line="65" pos:column="41">num_values<pos:position pos:line="65" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="65" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="65" pos:column="53"/></condition><then pos:line="65" pos:column="53">
        <block pos:line="66" pos:column="9">{
            <expr_stmt><expr><call><name pos:line="67" pos:column="13">ERROR<pos:position pos:line="67" pos:column="18"/></name> <argument_list pos:line="67" pos:column="19">(<argument><expr><literal type="string" pos:line="67" pos:column="20">"barometer: get_reference_temperature - history \"%s\" lost"<pos:position pos:line="67" pos:column="80"/></literal></expr></argument>,
                   <argument><expr><name><name pos:line="68" pos:column="20">list<pos:position pos:line="68" pos:column="24"/></name><operator pos:line="68" pos:column="24">-&gt;<pos:position pos:line="68" pos:column="29"/></operator><name pos:line="68" pos:column="26">sensor_name<pos:position pos:line="68" pos:column="37"/></name></name></expr></argument>)<pos:position pos:line="68" pos:column="38"/></argument_list></call></expr>;<pos:position pos:line="68" pos:column="39"/></expr_stmt>
            <expr_stmt><expr><name><name pos:line="69" pos:column="13">list<pos:position pos:line="69" pos:column="17"/></name><operator pos:line="69" pos:column="17">-&gt;<pos:position pos:line="69" pos:column="22"/></operator><name pos:line="69" pos:column="19">initialized<pos:position pos:line="69" pos:column="30"/></name></name> <operator pos:line="69" pos:column="31">=<pos:position pos:line="69" pos:column="32"/></operator> <literal type="number" pos:line="69" pos:column="33">0<pos:position pos:line="69" pos:column="34"/></literal></expr>;<pos:position pos:line="69" pos:column="35"/></expr_stmt>
            <expr_stmt><expr><name><name pos:line="70" pos:column="13">list<pos:position pos:line="70" pos:column="17"/></name><operator pos:line="70" pos:column="17">-&gt;<pos:position pos:line="70" pos:column="22"/></operator><name pos:line="70" pos:column="19">num_values<pos:position pos:line="70" pos:column="29"/></name></name> <operator pos:line="70" pos:column="30">=<pos:position pos:line="70" pos:column="31"/></operator> <literal type="number" pos:line="70" pos:column="32">0<pos:position pos:line="70" pos:column="33"/></literal></expr>;<pos:position pos:line="70" pos:column="34"/></expr_stmt>
            <expr_stmt><expr><name pos:line="71" pos:column="13">list<pos:position pos:line="71" pos:column="17"/></name> <operator pos:line="71" pos:column="18">=<pos:position pos:line="71" pos:column="19"/></operator> <name><name pos:line="71" pos:column="20">list<pos:position pos:line="71" pos:column="24"/></name><operator pos:line="71" pos:column="24">-&gt;<pos:position pos:line="71" pos:column="29"/></operator><name pos:line="71" pos:column="26">next<pos:position pos:line="71" pos:column="30"/></name></name></expr>;<pos:position pos:line="71" pos:column="31"/></expr_stmt>
            <continue pos:line="72" pos:column="13">continue;<pos:position pos:line="72" pos:column="22"/></continue>
        }<pos:position pos:line="73" pos:column="10"/></block></then></if>

        <for pos:line="75" pos:column="9">for<control pos:line="75" pos:column="12">(<init><expr><name pos:line="75" pos:column="13">i<pos:position pos:line="75" pos:column="14"/></name><operator pos:line="75" pos:column="14">=<pos:position pos:line="75" pos:column="15"/></operator><literal type="number" pos:line="75" pos:column="15">0<pos:position pos:line="75" pos:column="16"/></literal></expr>;<pos:position pos:line="75" pos:column="17"/></init> <condition><expr><name pos:line="75" pos:column="18">i<pos:position pos:line="75" pos:column="19"/></name><operator pos:line="75" pos:column="19">&lt;<pos:position pos:line="75" pos:column="23"/></operator><name pos:line="75" pos:column="20">REF_TEMP_AVG_NUM<pos:position pos:line="75" pos:column="36"/></name><operator pos:line="75" pos:column="36">*<pos:position pos:line="75" pos:column="37"/></operator><name><name pos:line="75" pos:column="37">list<pos:position pos:line="75" pos:column="41"/></name><operator pos:line="75" pos:column="41">-&gt;<pos:position pos:line="75" pos:column="46"/></operator><name pos:line="75" pos:column="43">num_values<pos:position pos:line="75" pos:column="53"/></name></name></expr>;<pos:position pos:line="75" pos:column="54"/></condition> <incr><expr><operator pos:line="75" pos:column="55">++<pos:position pos:line="75" pos:column="57"/></operator><name pos:line="75" pos:column="57">i<pos:position pos:line="75" pos:column="58"/></name></expr></incr>)<pos:position pos:line="75" pos:column="59"/></control>
        <block pos:line="76" pos:column="9">{
            <expr_stmt><expr><call><name pos:line="77" pos:column="13">DEBUG<pos:position pos:line="77" pos:column="18"/></name> <argument_list pos:line="77" pos:column="19">(<argument><expr><literal type="string" pos:line="77" pos:column="20">"barometer: get_reference_temperature - history %d: %lf"<pos:position pos:line="77" pos:column="76"/></literal></expr></argument>,
                   <argument><expr><name pos:line="78" pos:column="20">i<pos:position pos:line="78" pos:column="21"/></name></expr></argument>,
                   <argument><expr><name><name pos:line="79" pos:column="20">values_history<pos:position pos:line="79" pos:column="34"/></name><index pos:line="79" pos:column="34">[<expr><name pos:line="79" pos:column="35">i<pos:position pos:line="79" pos:column="36"/></name></expr>]<pos:position pos:line="79" pos:column="37"/></index></name></expr></argument>)<pos:position pos:line="79" pos:column="38"/></argument_list></call></expr>;<pos:position pos:line="79" pos:column="39"/></expr_stmt>
            <if pos:line="80" pos:column="13">if<condition pos:line="80" pos:column="15">(<expr><operator pos:line="80" pos:column="16">!<pos:position pos:line="80" pos:column="17"/></operator><call><name pos:line="80" pos:column="17">isnan<pos:position pos:line="80" pos:column="22"/></name><argument_list pos:line="80" pos:column="22">(<argument><expr><name><name pos:line="80" pos:column="23">values_history<pos:position pos:line="80" pos:column="37"/></name><index pos:line="80" pos:column="37">[<expr><name pos:line="80" pos:column="38">i<pos:position pos:line="80" pos:column="39"/></name></expr>]<pos:position pos:line="80" pos:column="40"/></index></name></expr></argument>)<pos:position pos:line="80" pos:column="41"/></argument_list></call></expr>)<pos:position pos:line="80" pos:column="42"/></condition><then pos:line="80" pos:column="42">
            <block pos:line="81" pos:column="13">{
                <expr_stmt><expr><name pos:line="82" pos:column="17">avg_sum<pos:position pos:line="82" pos:column="24"/></name> <operator pos:line="82" pos:column="25">+=<pos:position pos:line="82" pos:column="27"/></operator> <name><name pos:line="82" pos:column="28">values_history<pos:position pos:line="82" pos:column="42"/></name><index pos:line="82" pos:column="42">[<expr><name pos:line="82" pos:column="43">i<pos:position pos:line="82" pos:column="44"/></name></expr>]<pos:position pos:line="82" pos:column="45"/></index></name></expr>;<pos:position pos:line="82" pos:column="46"/></expr_stmt>
                <expr_stmt><expr><operator pos:line="83" pos:column="17">++<pos:position pos:line="83" pos:column="19"/></operator><name pos:line="83" pos:column="19">avg_num<pos:position pos:line="83" pos:column="26"/></name></expr>;<pos:position pos:line="83" pos:column="27"/></expr_stmt>
            }<pos:position pos:line="84" pos:column="14"/></block></then></if>
        }<pos:position pos:line="85" pos:column="10"/></block></for>

        <if pos:line="87" pos:column="9">if<condition pos:line="87" pos:column="11">(<expr><name pos:line="87" pos:column="12">avg_num<pos:position pos:line="87" pos:column="19"/></name> <operator pos:line="87" pos:column="20">==<pos:position pos:line="87" pos:column="22"/></operator> <literal type="number" pos:line="87" pos:column="23">0<pos:position pos:line="87" pos:column="24"/></literal></expr>)<pos:position pos:line="87" pos:column="25"/></condition><then pos:line="87" pos:column="25">   <comment type="block" pos:line="87" pos:column="28">/* still no history? fallback to current */</comment>
        <block pos:line="88" pos:column="9">{
            <if pos:line="89" pos:column="13">if<condition pos:line="89" pos:column="15">(<expr><call><name pos:line="89" pos:column="16">uc_get_rate_by_name<pos:position pos:line="89" pos:column="35"/></name><argument_list pos:line="89" pos:column="35">(<argument><expr><name><name pos:line="89" pos:column="36">list<pos:position pos:line="89" pos:column="40"/></name><operator pos:line="89" pos:column="40">-&gt;<pos:position pos:line="89" pos:column="45"/></operator><name pos:line="89" pos:column="42">sensor_name<pos:position pos:line="89" pos:column="53"/></name></name></expr></argument>,
                                   <argument><expr><operator pos:line="90" pos:column="36">&amp;<pos:position pos:line="90" pos:column="41"/></operator><name pos:line="90" pos:column="37">values<pos:position pos:line="90" pos:column="43"/></name></expr></argument>,
                                   <argument><expr><operator pos:line="91" pos:column="36">&amp;<pos:position pos:line="91" pos:column="41"/></operator><name pos:line="91" pos:column="37">values_num<pos:position pos:line="91" pos:column="47"/></name></expr></argument>)<pos:position pos:line="91" pos:column="48"/></argument_list></call></expr>)<pos:position pos:line="91" pos:column="49"/></condition><then pos:line="91" pos:column="49">
            <block pos:line="92" pos:column="13">{
                <expr_stmt><expr><call><name pos:line="93" pos:column="17">ERROR<pos:position pos:line="93" pos:column="22"/></name> <argument_list pos:line="93" pos:column="23">(<argument><expr><literal type="string" pos:line="93" pos:column="24">"barometer: get_reference_temperature - rate \"%s\" lost"<pos:position pos:line="93" pos:column="81"/></literal></expr></argument>,
                       <argument><expr><name><name pos:line="94" pos:column="24">list<pos:position pos:line="94" pos:column="28"/></name><operator pos:line="94" pos:column="28">-&gt;<pos:position pos:line="94" pos:column="33"/></operator><name pos:line="94" pos:column="30">sensor_name<pos:position pos:line="94" pos:column="41"/></name></name></expr></argument>)<pos:position pos:line="94" pos:column="42"/></argument_list></call></expr>;<pos:position pos:line="94" pos:column="43"/></expr_stmt>
                <expr_stmt><expr><name><name pos:line="95" pos:column="17">list<pos:position pos:line="95" pos:column="21"/></name><operator pos:line="95" pos:column="21">-&gt;<pos:position pos:line="95" pos:column="26"/></operator><name pos:line="95" pos:column="23">initialized<pos:position pos:line="95" pos:column="34"/></name></name> <operator pos:line="95" pos:column="35">=<pos:position pos:line="95" pos:column="36"/></operator> <literal type="number" pos:line="95" pos:column="37">0<pos:position pos:line="95" pos:column="38"/></literal></expr>;<pos:position pos:line="95" pos:column="39"/></expr_stmt>
                <expr_stmt><expr><name><name pos:line="96" pos:column="17">list<pos:position pos:line="96" pos:column="21"/></name><operator pos:line="96" pos:column="21">-&gt;<pos:position pos:line="96" pos:column="26"/></operator><name pos:line="96" pos:column="23">num_values<pos:position pos:line="96" pos:column="33"/></name></name> <operator pos:line="96" pos:column="34">=<pos:position pos:line="96" pos:column="35"/></operator> <literal type="number" pos:line="96" pos:column="36">0<pos:position pos:line="96" pos:column="37"/></literal></expr>;<pos:position pos:line="96" pos:column="38"/></expr_stmt>
                <expr_stmt><expr><name pos:line="97" pos:column="17">list<pos:position pos:line="97" pos:column="21"/></name> <operator pos:line="97" pos:column="22">=<pos:position pos:line="97" pos:column="23"/></operator> <name><name pos:line="97" pos:column="24">list<pos:position pos:line="97" pos:column="28"/></name><operator pos:line="97" pos:column="28">-&gt;<pos:position pos:line="97" pos:column="33"/></operator><name pos:line="97" pos:column="30">next<pos:position pos:line="97" pos:column="34"/></name></name></expr>;<pos:position pos:line="97" pos:column="35"/></expr_stmt>
                <continue pos:line="98" pos:column="17">continue;<pos:position pos:line="98" pos:column="26"/></continue>
            }<pos:position pos:line="99" pos:column="14"/></block></then></if>

            <for pos:line="101" pos:column="13">for<control pos:line="101" pos:column="16">(<init><expr><name pos:line="101" pos:column="17">i<pos:position pos:line="101" pos:column="18"/></name><operator pos:line="101" pos:column="18">=<pos:position pos:line="101" pos:column="19"/></operator><literal type="number" pos:line="101" pos:column="19">0<pos:position pos:line="101" pos:column="20"/></literal></expr>;<pos:position pos:line="101" pos:column="21"/></init> <condition><expr><name pos:line="101" pos:column="22">i<pos:position pos:line="101" pos:column="23"/></name><operator pos:line="101" pos:column="23">&lt;<pos:position pos:line="101" pos:column="27"/></operator><name pos:line="101" pos:column="24">values_num<pos:position pos:line="101" pos:column="34"/></name></expr>;<pos:position pos:line="101" pos:column="35"/></condition> <incr><expr><operator pos:line="101" pos:column="36">++<pos:position pos:line="101" pos:column="38"/></operator><name pos:line="101" pos:column="38">i<pos:position pos:line="101" pos:column="39"/></name></expr></incr>)<pos:position pos:line="101" pos:column="40"/></control>
            <block pos:line="102" pos:column="13">{
                <expr_stmt><expr><call><name pos:line="103" pos:column="17">DEBUG<pos:position pos:line="103" pos:column="22"/></name> <argument_list pos:line="103" pos:column="23">(<argument><expr><literal type="string" pos:line="103" pos:column="24">"barometer: get_reference_temperature - rate last %d: %lf **"<pos:position pos:line="103" pos:column="85"/></literal></expr></argument>,
                       <argument><expr><name pos:line="104" pos:column="24">i<pos:position pos:line="104" pos:column="25"/></name></expr></argument>,
                       <argument><expr><name><name pos:line="105" pos:column="24">values<pos:position pos:line="105" pos:column="30"/></name><index pos:line="105" pos:column="30">[<expr><name pos:line="105" pos:column="31">i<pos:position pos:line="105" pos:column="32"/></name></expr>]<pos:position pos:line="105" pos:column="33"/></index></name></expr></argument>)<pos:position pos:line="105" pos:column="34"/></argument_list></call></expr>;<pos:position pos:line="105" pos:column="35"/></expr_stmt>
                <if pos:line="106" pos:column="17">if<condition pos:line="106" pos:column="19">(<expr><operator pos:line="106" pos:column="20">!<pos:position pos:line="106" pos:column="21"/></operator><call><name pos:line="106" pos:column="21">isnan<pos:position pos:line="106" pos:column="26"/></name><argument_list pos:line="106" pos:column="26">(<argument><expr><name><name pos:line="106" pos:column="27">values<pos:position pos:line="106" pos:column="33"/></name><index pos:line="106" pos:column="33">[<expr><name pos:line="106" pos:column="34">i<pos:position pos:line="106" pos:column="35"/></name></expr>]<pos:position pos:line="106" pos:column="36"/></index></name></expr></argument>)<pos:position pos:line="106" pos:column="37"/></argument_list></call></expr>)<pos:position pos:line="106" pos:column="38"/></condition><then pos:line="106" pos:column="38">
                <block pos:line="107" pos:column="17">{
                    <expr_stmt><expr><name pos:line="108" pos:column="21">avg_sum<pos:position pos:line="108" pos:column="28"/></name> <operator pos:line="108" pos:column="29">+=<pos:position pos:line="108" pos:column="31"/></operator> <name><name pos:line="108" pos:column="32">values<pos:position pos:line="108" pos:column="38"/></name><index pos:line="108" pos:column="38">[<expr><name pos:line="108" pos:column="39">i<pos:position pos:line="108" pos:column="40"/></name></expr>]<pos:position pos:line="108" pos:column="41"/></index></name></expr>;<pos:position pos:line="108" pos:column="42"/></expr_stmt>
                    <expr_stmt><expr><operator pos:line="109" pos:column="21">++<pos:position pos:line="109" pos:column="23"/></operator><name pos:line="109" pos:column="23">avg_num<pos:position pos:line="109" pos:column="30"/></name></expr>;<pos:position pos:line="109" pos:column="31"/></expr_stmt>
                }<pos:position pos:line="110" pos:column="18"/></block></then></if>
            }<pos:position pos:line="111" pos:column="14"/></block></for>
            <expr_stmt><expr><call><name pos:line="112" pos:column="13">free<pos:position pos:line="112" pos:column="17"/></name><argument_list pos:line="112" pos:column="17">(<argument><expr><name pos:line="112" pos:column="18">values<pos:position pos:line="112" pos:column="24"/></name></expr></argument>)<pos:position pos:line="112" pos:column="25"/></argument_list></call></expr>;<pos:position pos:line="112" pos:column="26"/></expr_stmt>
            <expr_stmt><expr><name pos:line="113" pos:column="13">values<pos:position pos:line="113" pos:column="19"/></name> <operator pos:line="113" pos:column="20">=<pos:position pos:line="113" pos:column="21"/></operator> <name pos:line="113" pos:column="22">NULL<pos:position pos:line="113" pos:column="26"/></name></expr>;<pos:position pos:line="113" pos:column="27"/></expr_stmt>
        }<pos:position pos:line="114" pos:column="10"/></block></then></if>

        <if pos:line="116" pos:column="9">if<condition pos:line="116" pos:column="11">(<expr><name pos:line="116" pos:column="12">avg_num<pos:position pos:line="116" pos:column="19"/></name> <operator pos:line="116" pos:column="20">==<pos:position pos:line="116" pos:column="22"/></operator> <literal type="number" pos:line="116" pos:column="23">0<pos:position pos:line="116" pos:column="24"/></literal></expr>)<pos:position pos:line="116" pos:column="25"/></condition><then pos:line="116" pos:column="25">
        <block pos:line="117" pos:column="9">{
            <expr_stmt><expr><call><name pos:line="118" pos:column="13">ERROR<pos:position pos:line="118" pos:column="18"/></name> <argument_list pos:line="118" pos:column="19">(<argument><expr><literal type="string" pos:line="118" pos:column="20">"barometer: get_reference_temperature - could not read \"%s\""<pos:position pos:line="118" pos:column="82"/></literal></expr></argument>,
                   <argument><expr><name><name pos:line="119" pos:column="20">list<pos:position pos:line="119" pos:column="24"/></name><operator pos:line="119" pos:column="24">-&gt;<pos:position pos:line="119" pos:column="29"/></operator><name pos:line="119" pos:column="26">sensor_name<pos:position pos:line="119" pos:column="37"/></name></name></expr></argument>)<pos:position pos:line="119" pos:column="38"/></argument_list></call></expr>;<pos:position pos:line="119" pos:column="39"/></expr_stmt>
            <expr_stmt><expr><name><name pos:line="120" pos:column="13">list<pos:position pos:line="120" pos:column="17"/></name><operator pos:line="120" pos:column="17">-&gt;<pos:position pos:line="120" pos:column="22"/></operator><name pos:line="120" pos:column="19">initialized<pos:position pos:line="120" pos:column="30"/></name></name> <operator pos:line="120" pos:column="31">=<pos:position pos:line="120" pos:column="32"/></operator> <literal type="number" pos:line="120" pos:column="33">0<pos:position pos:line="120" pos:column="34"/></literal></expr>;<pos:position pos:line="120" pos:column="35"/></expr_stmt>
            <expr_stmt><expr><name><name pos:line="121" pos:column="13">list<pos:position pos:line="121" pos:column="17"/></name><operator pos:line="121" pos:column="17">-&gt;<pos:position pos:line="121" pos:column="22"/></operator><name pos:line="121" pos:column="19">num_values<pos:position pos:line="121" pos:column="29"/></name></name> <operator pos:line="121" pos:column="30">=<pos:position pos:line="121" pos:column="31"/></operator> <literal type="number" pos:line="121" pos:column="32">0<pos:position pos:line="121" pos:column="33"/></literal></expr>;<pos:position pos:line="121" pos:column="34"/></expr_stmt>
        }<pos:position pos:line="122" pos:column="10"/></block></then>
        <else pos:line="123" pos:column="9">else
        <block pos:line="124" pos:column="9">{
            <expr_stmt><expr><name pos:line="125" pos:column="13">average<pos:position pos:line="125" pos:column="20"/></name> <operator pos:line="125" pos:column="21">=<pos:position pos:line="125" pos:column="22"/></operator> <name pos:line="125" pos:column="23">avg_sum<pos:position pos:line="125" pos:column="30"/></name> <operator pos:line="125" pos:column="31">/<pos:position pos:line="125" pos:column="32"/></operator> <operator pos:line="125" pos:column="33">(<pos:position pos:line="125" pos:column="34"/></operator><name pos:line="125" pos:column="34">double<pos:position pos:line="125" pos:column="40"/></name><operator pos:line="125" pos:column="40">)<pos:position pos:line="125" pos:column="41"/></operator> <name pos:line="125" pos:column="42">avg_num<pos:position pos:line="125" pos:column="49"/></name></expr>;<pos:position pos:line="125" pos:column="50"/></expr_stmt>
            <if pos:line="126" pos:column="13">if<condition pos:line="126" pos:column="15">(<expr><call><name pos:line="126" pos:column="16">isnan<pos:position pos:line="126" pos:column="21"/></name><argument_list pos:line="126" pos:column="21">(<argument><expr><operator pos:line="126" pos:column="22">*<pos:position pos:line="126" pos:column="23"/></operator><name pos:line="126" pos:column="23">result<pos:position pos:line="126" pos:column="29"/></name></expr></argument>)<pos:position pos:line="126" pos:column="30"/></argument_list></call></expr>)<pos:position pos:line="126" pos:column="31"/></condition><then pos:line="126" pos:column="31">
                <block type="pseudo"><expr_stmt><expr><operator pos:line="127" pos:column="17">*<pos:position pos:line="127" pos:column="18"/></operator><name pos:line="127" pos:column="18">result<pos:position pos:line="127" pos:column="24"/></name><operator pos:line="127" pos:column="24">=<pos:position pos:line="127" pos:column="25"/></operator><name pos:line="127" pos:column="25">average<pos:position pos:line="127" pos:column="32"/></name></expr>;<pos:position pos:line="127" pos:column="33"/></expr_stmt></block></then>
            <elseif pos:line="128" pos:column="13">else <if pos:line="128" pos:column="18">if<condition pos:line="128" pos:column="20">(<expr><operator pos:line="128" pos:column="21">*<pos:position pos:line="128" pos:column="22"/></operator><name pos:line="128" pos:column="22">result<pos:position pos:line="128" pos:column="28"/></name><operator pos:line="128" pos:column="28">&gt;<pos:position pos:line="128" pos:column="32"/></operator><name pos:line="128" pos:column="29">average<pos:position pos:line="128" pos:column="36"/></name></expr>)<pos:position pos:line="128" pos:column="37"/></condition><then pos:line="128" pos:column="37">
                <block type="pseudo"><expr_stmt><expr><operator pos:line="129" pos:column="17">*<pos:position pos:line="129" pos:column="18"/></operator><name pos:line="129" pos:column="18">result<pos:position pos:line="129" pos:column="24"/></name><operator pos:line="129" pos:column="24">=<pos:position pos:line="129" pos:column="25"/></operator><name pos:line="129" pos:column="25">average<pos:position pos:line="129" pos:column="32"/></name></expr>;<pos:position pos:line="129" pos:column="33"/></expr_stmt></block></then></if></elseif></if>
        }<pos:position pos:line="130" pos:column="10"/></block></else></if>
        <expr_stmt><expr><name pos:line="131" pos:column="9">list<pos:position pos:line="131" pos:column="13"/></name> <operator pos:line="131" pos:column="14">=<pos:position pos:line="131" pos:column="15"/></operator> <name><name pos:line="131" pos:column="16">list<pos:position pos:line="131" pos:column="20"/></name><operator pos:line="131" pos:column="20">-&gt;<pos:position pos:line="131" pos:column="25"/></operator><name pos:line="131" pos:column="22">next<pos:position pos:line="131" pos:column="26"/></name></name></expr>;<pos:position pos:line="131" pos:column="27"/></expr_stmt>
    }<pos:position pos:line="132" pos:column="6"/></block></while>  <comment type="block" pos:line="132" pos:column="8">/* while sensor list */</comment>

    <if pos:line="134" pos:column="5">if<condition pos:line="134" pos:column="7">(<expr><operator pos:line="134" pos:column="8">*<pos:position pos:line="134" pos:column="9"/></operator><name pos:line="134" pos:column="9">result<pos:position pos:line="134" pos:column="15"/></name> <operator pos:line="134" pos:column="16">==<pos:position pos:line="134" pos:column="18"/></operator> <name pos:line="134" pos:column="19">NAN<pos:position pos:line="134" pos:column="22"/></name></expr>)<pos:position pos:line="134" pos:column="23"/></condition><then pos:line="134" pos:column="23">
    <block pos:line="135" pos:column="5">{
        <expr_stmt><expr><call><name pos:line="136" pos:column="9">ERROR<pos:position pos:line="136" pos:column="14"/></name><argument_list pos:line="136" pos:column="14">(<argument><expr><literal type="string" pos:line="136" pos:column="15">"barometer: get_reference_temperature - no sensor available (yet?)"<pos:position pos:line="136" pos:column="82"/></literal></expr></argument>)<pos:position pos:line="136" pos:column="83"/></argument_list></call></expr>;<pos:position pos:line="136" pos:column="84"/></expr_stmt>
        <return pos:line="137" pos:column="9">return <expr><operator pos:line="137" pos:column="16">-<pos:position pos:line="137" pos:column="17"/></operator><literal type="number" pos:line="137" pos:column="17">1<pos:position pos:line="137" pos:column="18"/></literal></expr>;<pos:position pos:line="137" pos:column="19"/></return>
    }<pos:position pos:line="138" pos:column="6"/></block></then></if>
    <expr_stmt><expr><call><name pos:line="139" pos:column="5">DEBUG<pos:position pos:line="139" pos:column="10"/></name> <argument_list pos:line="139" pos:column="11">(<argument><expr><literal type="string" pos:line="139" pos:column="12">"barometer: get_reference_temperature - temp is %lf"<pos:position pos:line="139" pos:column="64"/></literal></expr></argument>, <argument><expr><operator pos:line="139" pos:column="66">*<pos:position pos:line="139" pos:column="67"/></operator><name pos:line="139" pos:column="67">result<pos:position pos:line="139" pos:column="73"/></name></expr></argument>)<pos:position pos:line="139" pos:column="74"/></argument_list></call></expr>;<pos:position pos:line="139" pos:column="75"/></expr_stmt>
    <return pos:line="140" pos:column="5">return <expr><literal type="number" pos:line="140" pos:column="12">0<pos:position pos:line="140" pos:column="13"/></literal></expr>;<pos:position pos:line="140" pos:column="14"/></return>
}<pos:position pos:line="141" pos:column="2"/></block></function></unit>
