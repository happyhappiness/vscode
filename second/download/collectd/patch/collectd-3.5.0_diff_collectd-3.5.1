diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/ChangeLog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/ChangeLog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/ChangeLog	2005-12-16 22:39:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/ChangeLog	2005-12-19 06:20:39.000000000 +0800
@@ -1,7 +1,11 @@
-2005-12-07, Version 3.5.0 (Revision 326)
+2005-12-18, Version 3.5.1
+	* The PID-file is now deleted correctly when shutting down the daemon.
+	* SIGINT and SIGTERM are now handled correctly.
+
+2005-12-16, Version 3.5.0 (Revision 326)
 	* A bug in the `load' module under Solaris has been fixed.
 	* The `users' module has been contributed by Sebastian Harl. It counts
 	  currently logged in users.
 	* The CPU module now works under FreeBSD without the use of
 	  `libstatgrab', however SMP support is missing.
 	* The default directories for the RRD files and the PID file now
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/collectd.spec /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/collectd.spec
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/collectd.spec	2005-12-16 22:39:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/collectd.spec	2005-12-19 06:20:40.000000000 +0800
@@ -1,9 +1,9 @@
 Summary:	Statistics collection daemon for filling RRD files.
 Name:           collectd
-Version:	3.5.0
+Version:	3.5.1
 Release:	1
 Source:		http://verplant.org/collectd/%{name}-%{version}.tar.gz
 License:	GPL
 Group:		System Environment/Daemons
 BuildRoot:	%{_tmppath}/%{name}-%{version}-root
 BuildPrereq:	lm_sensors-devel, rrdtool-devel
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/configure	2005-12-16 22:39:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/configure	2005-12-19 06:20:39.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.59 for collectd 3.5.0.
+# Generated by GNU Autoconf 2.59 for collectd 3.5.1.
 #
 # Copyright (C) 2003 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
 ## M4sh Initialization.  ##
@@ -418,14 +418,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='collectd'
 PACKAGE_TARNAME='collectd'
-PACKAGE_VERSION='3.5.0'
-PACKAGE_STRING='collectd 3.5.0'
+PACKAGE_VERSION='3.5.1'
+PACKAGE_STRING='collectd 3.5.1'
 PACKAGE_BUGREPORT=''
 
 ac_unique_file="src/collectd.c"
 ac_default_prefix="/opt/collectd"
 # Factoring default headers for most tests.
 ac_includes_default="\
@@ -951,13 +951,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures collectd 3.5.0 to adapt to many kinds of systems.
+\`configure' configures collectd 3.5.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -1017,13 +1017,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of collectd 3.5.0:";;
+     short | recursive ) echo "Configuration of collectd 3.5.1:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -1181,13 +1181,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-collectd configure 3.5.0
+collectd configure 3.5.1
 generated by GNU Autoconf 2.59
 
 Copyright (C) 2003 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -1195,13 +1195,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by collectd $as_me 3.5.0, which was
+It was created by collectd $as_me 3.5.1, which was
 generated by GNU Autoconf 2.59.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1841,13 +1841,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='collectd'
- VERSION='3.5.0'
+ VERSION='3.5.1'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -29815,13 +29815,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by collectd $as_me 3.5.0, which was
+This file was extended by collectd $as_me 3.5.1, which was
 generated by GNU Autoconf 2.59.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -29878,13 +29878,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-collectd config.status 3.5.0
+collectd config.status 3.5.1
 configured by $0, generated by GNU Autoconf 2.59,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright (C) 2003 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/configure.in	2005-12-16 22:39:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/configure.in	2005-12-19 06:20:39.000000000 +0800
@@ -1,8 +1,8 @@
 dnl Process this file with autoconf to produce a configure script.
-AC_INIT(collectd, 3.5.0)
+AC_INIT(collectd, 3.5.1)
 AC_CONFIG_SRCDIR(src/collectd.c)
 AC_CONFIG_HEADERS(src/config.h)
 AM_INIT_AUTOMAKE(dist-bzip2)
 AC_LANG(C)
 
 AC_PREFIX_DEFAULT("/opt/collectd")
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/debian/changelog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/debian/changelog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/debian/changelog	2005-12-16 22:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/debian/changelog	2005-12-19 06:20:40.000000000 +0800
@@ -1,6 +1,12 @@
+collectd (3.5.1-1) unstable; urgency=low
+
+  * New upstream version
+
+ -- Florian Forster <octo@verplant.org>  Sun, 18 Dec 2005 23:09:11 +0200
+
 collectd (3.5.0-1) unstable; urgency=low
 
   * New upstream version
   * Added dependency to `cpufreqd | powernowd | cpudyn' to `collectd-cpufreq' 
   * Added `collectd-users'
   * Added `--localstatedir=/var' to `./configure'
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/src/collectd.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/src/collectd.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/src/collectd.1	2005-12-16 22:40:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/src/collectd.1	2005-12-19 06:20:41.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD 1"
-.TH COLLECTD 1 "2005-12-16" "3.5.0" "collectd"
+.TH COLLECTD 1 "2005-12-18" "3.5.0" "collectd"
 .SH "NAME"
 collectd \- System statistics collection daemon
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd \fI[options]\fR
 .SH "DESCRIPTION"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/src/collectd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/src/collectd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.0/src/collectd.c	2005-12-16 22:40:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.5.1/src/collectd.c	2005-12-19 06:20:41.000000000 +0800
@@ -41,22 +41,27 @@
 
 /*
  * exported variables
  */
 time_t curtime;
 
-#ifdef HAVE_LIBRRD
+#if HAVE_LIBRRD
 int operating_mode;
 #endif
 
-void sigIntHandler (int signal)
+static void sigIntHandler (int signal)
+{
+	loop++;
+}
+
+static void sigTermHandler (int signal)
 {
 	loop++;
 }
 
-int change_basedir (char *dir)
+static int change_basedir (char *dir)
 {
 	int dirlen = strlen (dir);
 	
 	while ((dirlen > 0) && (dir[dirlen - 1] == '/'))
 		dir[--dirlen] = '\0';
 
@@ -210,16 +215,17 @@
 		if (type     != NULL) free (type);     type     = NULL;
 		if (instance != NULL) free (instance); instance = NULL;
 		if (values   != NULL) free (values);   values   = NULL;
 	}
 	
 	return (0);
-}
+} /* static int start_server (void) */
 #endif /* HAVE_LIBRRD */
 
-int pidfile_create (char *file)
+#if COLLECT_DAEMON
+static int pidfile_create (const char *file)
 {
 	FILE *fh;
 
 	if (file == NULL)
 		file = PIDFILE;
 
@@ -230,37 +236,45 @@
 	}
 
 	fprintf (fh, "%d\n", getpid());
 	fclose(fh);
 
 	return (0);
-}
+} /* static int pidfile_create (const char *file) */
+#endif /* COLLECT_DAEMON */
 
-int pidfile_remove (void)
+#if COLLECT_DAEMON
+static int pidfile_remove (const char *file)
 {
-      return (unlink (PIDFILE));
-}
+	if (file == NULL) {
+		file = PIDFILE;
+	}
+	return (unlink (file));
+} /* static int pidfile_remove (const char *file) */
+#endif /* COLLECT_DAEMON */
 
 int main (int argc, char **argv)
 {
-	struct sigaction sigIntAction, sigChldAction;
+	struct sigaction sigIntAction;
+	struct sigaction sigTermAction;
 #if COLLECT_DAEMON
+	struct sigaction sigChldAction;
 	pid_t pid;
 #endif
 
 	char *configfile = CONFIGFILE;
 	char *pidfile    = PIDFILE;
 	char *plugindir  = PLUGINDIR;
 	char *datadir    = PKGLOCALSTATEDIR;
 
 	int daemonize = 1;
 
-#ifdef HAVE_LIBRRD
+#if HAVE_LIBRRD
 	operating_mode = MODE_LOCAL;
 #endif
-	
+
 	/* open syslog */
 	openlog (PACKAGE, LOG_CONS | LOG_PID, LOG_DAEMON);
 
 	/* read options */
 	while (1)
 	{
@@ -337,24 +351,18 @@
 	{
 		fprintf (stderr, "Error: Unable to change to directory `%s'.\n", datadir);
 		return (1);
 	}
 
 	/*
-	 * install signal handlers
+	 * fork off child
 	 */
-	sigIntAction.sa_handler = sigIntHandler;
-	sigaction (SIGINT, &sigIntAction, NULL);
-
+#if COLLECT_DAEMON
 	sigChldAction.sa_handler = SIG_IGN;
 	sigaction (SIGCHLD, &sigChldAction, NULL);
 
-	/*
-	 * fork off child
-	 */
-#if COLLECT_DAEMON
 	if (daemonize)
 	{
 		if ((pid = fork ()) == -1)
 		{
 			/* error */
 			fprintf (stderr, "fork: %s", strerror (errno));
@@ -395,24 +403,35 @@
 			return (1);
 		}
 	} /* if (daemonize) */
 #endif /* COLLECT_DAEMON */
 
 	/*
+	 * install signal handlers
+	 */
+	sigIntAction.sa_handler = sigIntHandler;
+	sigaction (SIGINT, &sigIntAction, NULL);
+
+	sigIntAction.sa_handler = sigTermHandler;
+	sigaction (SIGTERM, &sigTermAction, NULL);
+
+	/*
 	 * run the actual loops
 	 */
-#ifdef HAVE_LIBRRD
+#if HAVE_LIBRRD
 	if (operating_mode == MODE_SERVER)
 		start_server ();
 	else /* if (operating_mode == MODE_CLIENT || operating_mode == MODE_LOCAL) */
 #endif
 		start_client ();
 
 	/* close syslog */
 	syslog (LOG_INFO, "Exiting normally");
 	closelog ();
 
+#if COLLECT_DAEMON
 	if (daemonize)
-		pidfile_remove();
+		pidfile_remove(pidfile);
+#endif /* COLLECT_DAEMON */
 
 	return (0);
-}
+} /* int main (int argc, char **argv) */
