diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/ChangeLog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/ChangeLog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/ChangeLog	2007-10-27 17:04:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/ChangeLog	2007-11-09 04:54:18.000000000 +0800
@@ -1,33 +1,48 @@
+2007-11-08, Version 4.2.1
+	* tcpconns plugin: Don't complain about a missing file if IPv6 is not
+	  enabled on the host.
+	* snmp plugin: Fix a memory leak.
+
 2007-10-27, Version 4.2.0
 	* collectd: The new config option `Include' lets you include other
 	  configfiles and thus split up your config into smaller parts. This
 	  may be especially interesting for the snmp plugin to keep the data
 	  definitions separate from the host definitions.
 	* ipvs plugin: The new `ipvs' plugin collects IPVS connection statistics
 	  (number of connections, octets and packets for each service and
 	  destination). Thanks to Sebastian Harl for this plugin.
 	* memcached plugin: The new `memcached' plugin connects to a memcached
 	  daemon process and collects statistics of this distributed caching
 	  system. Thanks to Antony Dovgal for contributing this plugin.
 	* nginx plugin: The new `nginx' plugin reads the status page of an
-	  nginx daemon and saves the handeled connections and requests.
+	  nginx daemon and saves the handled connections and requests.
 	* perl plugin: Many changes, including the added `EnableDebugger'
 	  config option which lets you debug your Perl plugins more easily.
 	* rrdtool plugin: Use the thread-safe RRD-library if available. Try to
 	  be more thread-safe otherwise by locking calls to the library.
 	* snmp plugin: Added the options `Scale' and `Shift' to Data-blocks to
 	  correct the values returned by SNMP-agents. If a <data> block is
 	  defined as `table' the instance is now optional. The sequence number
 	  is used as the type-instance in this case. The new `InstancePrefix'
-	  option allows to add arbitary prefixes to the type-instance.
+	  option allows to add arbitrary prefixes to the type-instance.
 	* tcpconns plugin: The new `tcpconns' plugin collects the number of
 	  certain TCP connections and what state they're in. This can be used
 	  to see how many connections your FTP server has to handle or how
 	  many outgoing connections your mailserver has open.
 
+2007-11-08, Version 4.1.4
+	* Build system: Improve detection of the rrd library, especially if
+	  it's in a non-standard location.
+	* Build system: A bug when parsing the argument for
+	  `--with-libnetsnmp' has been fixed.
+	* collectd: Implement `strerror_r' if the libc doesn't provide it.
+	* rrdtool plugin: Fix a bug in the shutdown sequence that might cause
+	  a deadlock or delay when shutting down the daemon.
+	* snmp plugin: Fix a memory leak.
+
 2007-10-24, Version 4.1.3
 	* collectd: A build issue under Solaris has been resolved by renaming
 	  data types.
 	* rrdtool plugin: Use the thread-safe RRD-library if available. Try to
 	  be more thread-safe otherwise by locking calls to the library.
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/configure	2007-10-27 17:15:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/configure	2007-11-09 04:56:05.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.61 for collectd 4.2.0.
+# Generated by GNU Autoconf 2.61 for collectd 4.2.1.
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
@@ -723,14 +723,14 @@
 MAKEFLAGS=
 SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='collectd'
 PACKAGE_TARNAME='collectd'
-PACKAGE_VERSION='4.2.0'
-PACKAGE_STRING='collectd 4.2.0'
+PACKAGE_VERSION='4.2.1'
+PACKAGE_STRING='collectd 4.2.1'
 PACKAGE_BUGREPORT=''
 
 ac_unique_file="src/collectd.c"
 ac_default_prefix="/opt/collectd"
 # Factoring default headers for most tests.
 ac_includes_default="\
@@ -1565,13 +1565,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures collectd 4.2.0 to adapt to many kinds of systems.
+\`configure' configures collectd 4.2.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -1635,13 +1635,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of collectd 4.2.0:";;
+     short | recursive ) echo "Configuration of collectd 4.2.1:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -1825,13 +1825,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-collectd configure 4.2.0
+collectd configure 4.2.1
 generated by GNU Autoconf 2.61
 
 Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -1839,13 +1839,13 @@
   exit
 fi
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by collectd $as_me 4.2.0, which was
+It was created by collectd $as_me 4.2.1, which was
 generated by GNU Autoconf 2.61.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 exec 5>>config.log
@@ -2512,13 +2512,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='collectd'
- VERSION='4.2.0'
+ VERSION='4.2.1'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -38085,13 +38085,13 @@
 exec 6>&1
 
 # Save the log message, to keep $[0] and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by collectd $as_me 4.2.0, which was
+This file was extended by collectd $as_me 4.2.1, which was
 generated by GNU Autoconf 2.61.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -38138,13 +38138,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-collectd config.status 4.2.0
+collectd config.status 4.2.1
 configured by $0, generated by GNU Autoconf 2.61,
   with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright (C) 2006 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/collection.cgi /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/collection.cgi
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/collection.cgi	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/collection.cgi	2007-11-09 01:51:45.000000000 +0800
@@ -206,14 +206,14 @@
     @tmp = grep { ($_ !~ m/^\./) && (-d "$dir/$_") } (readdir ($dh));
     closedir ($dh);
 
     for (@tmp)
     {
       my ($plugin, $instance) = split (m/-/, $_, 2);
-      $plugins{$plugin} = [] if (!$plugins{$plugin});
-      push (@{$plugins{$plugin}}, $instance) if (defined ($instance));
+      $plugins{$plugin} = [] if (!exists $plugins{$plugin});
+      push (@{$plugins{$plugin}}, $instance);
     }
   } # for (@DataDirs)
 
   return (%plugins);
 } # _find_plugins
 
@@ -264,15 +264,17 @@
     }
 
     $ret->{$plugin} = {};
 
     for (@$plugin_instances)
     {
-      my $plugin_instance = $_;
+      my $plugin_instance = defined ($_) ? $_ : '-';
       my %types = _find_types ($host, $plugin,
-	($plugin_instance ne '-') ? $plugin_instance : undef);
+	($plugin_instance ne '-')
+	? $plugin_instance
+	: undef);
 
       $ret->{$plugin}{$plugin_instance} = {};
 
       for (keys %types)
       {
 	my $type = $_;
@@ -1286,12 +1288,24 @@
     "LINE1:temp_avg#$FullRed:Temperature",
     'GPRINT:temp_min:MIN:%4.1lf Min,',
     'GPRINT:temp_avg:AVERAGE:%4.1lf Avg,',
     'GPRINT:temp_max:MAX:%4.1lf Max,',
     'GPRINT:temp_avg:LAST:%4.1lf Last\l'
     ],
+    humidity => ['-v', 'Percent',
+    'DEF:temp_avg={file}:value:AVERAGE',
+    'DEF:temp_min={file}:value:MIN',
+    'DEF:temp_max={file}:value:MAX',
+    "AREA:temp_max#$HalfGreen",
+    "AREA:temp_min#$Canvas",
+    "LINE1:temp_avg#$FullGreen:Temperature",
+    'GPRINT:temp_min:MIN:%4.1lf%% Min,',
+    'GPRINT:temp_avg:AVERAGE:%4.1lf%% Avg,',
+    'GPRINT:temp_max:MAX:%4.1lf%% Max,',
+    'GPRINT:temp_avg:LAST:%4.1lf%% Last\l'
+    ],
     if_errors => ['-v', 'Errors/s',
     'DEF:tx_min={file}:tx:MIN',
     'DEF:tx_avg={file}:tx:AVERAGE',
     'DEF:tx_max={file}:tx:MAX',
     'DEF:rx_min={file}:rx:MIN',
     'DEF:rx_avg={file}:rx:AVERAGE',
@@ -1878,12 +1892,24 @@
     "AREA:ping_min#$Canvas",
     "LINE1:ping_avg#$FullBlue:Ping",
     'GPRINT:ping_min:MIN:%4.1lf ms Min,',
     'GPRINT:ping_avg:AVERAGE:%4.1lf ms Avg,',
     'GPRINT:ping_max:MAX:%4.1lf ms Max,',
     'GPRINT:ping_avg:LAST:%4.1lf ms Last'],
+    power => ['-v', 'Watt',
+    'DEF:avg={file}:value:AVERAGE',
+    'DEF:min={file}:value:MIN',
+    'DEF:max={file}:value:MAX',
+    "AREA:max#$HalfBlue",
+    "AREA:min#$Canvas",
+    "LINE1:avg#$FullBlue:Watt",
+    'GPRINT:min:MIN:%5.1lf%sW Min,',
+    'GPRINT:avg:AVERAGE:%5.1lf%sW Avg,',
+    'GPRINT:max:MAX:%5.1lf%sW Max,',
+    'GPRINT:avg:LAST:%5.1lf%sW Last\l'
+    ],
     processes => [
     "DEF:running_avg={file}:running:AVERAGE",
     "DEF:running_min={file}:running:MIN",
     "DEF:running_max={file}:running:MAX",
     "DEF:sleeping_avg={file}:sleeping:AVERAGE",
     "DEF:sleeping_min={file}:sleeping:MIN",
@@ -1940,24 +1966,33 @@
     "LINE1:sleeping_acc#$FullBlue:Sleeping",
     'GPRINT:sleeping_min:MIN:%5.1lf Min,',
     'GPRINT:sleeping_avg:AVERAGE:%5.1lf Average,',
     'GPRINT:sleeping_max:MAX:%5.1lf Max,',
     'GPRINT:sleeping_avg:LAST:%5.1lf Last\l'
     ],
-    ps_rss => [
-    'DEF:avg={file}:byte:AVERAGE',
-    'DEF:min={file}:byte:MIN',
-    'DEF:max={file}:byte:MAX',
-    "AREA:avg#$HalfBlue",
-    "LINE1:avg#$FullBlue:RSS",
-    'GPRINT:min:MIN:%5.1lf%s Min,',
-    'GPRINT:avg:AVERAGE:%5.1lf%s Avg,',
-    'GPRINT:max:MAX:%5.1lf%s Max,',
-    'GPRINT:avg:LAST:%5.1lf%s Last\l'
+    ps_count => ['-v', 'Processes',
+    'DEF:procs_avg={file}:processes:AVERAGE',
+    'DEF:procs_min={file}:processes:MIN',
+    'DEF:procs_max={file}:processes:MAX',
+    'DEF:thrds_avg={file}:threads:AVERAGE',
+    'DEF:thrds_min={file}:threads:MIN',
+    'DEF:thrds_max={file}:threads:MAX',
+    "AREA:thrds_avg#$HalfBlue",
+    "AREA:procs_avg#$HalfRed",
+    "LINE1:thrds_avg#$FullBlue:Threads  ",
+    'GPRINT:thrds_min:MIN:%5.1lf Min,',
+    'GPRINT:thrds_avg:AVERAGE:%5.1lf Avg,',
+    'GPRINT:thrds_max:MAX:%5.1lf Max,',
+    'GPRINT:thrds_avg:LAST:%5.1lf Last\l',
+    "LINE1:procs_avg#$FullRed:Processes",
+    'GPRINT:procs_min:MIN:%5.1lf Min,',
+    'GPRINT:procs_avg:AVERAGE:%5.1lf Avg,',
+    'GPRINT:procs_max:MAX:%5.1lf Max,',
+    'GPRINT:procs_avg:LAST:%5.1lf Last\l'
     ],
-    ps_cputime => [
+    ps_cputime => ['-v', 'Jiffies',
     'DEF:user_avg_raw={file}:user:AVERAGE',
     'DEF:user_min_raw={file}:user:MIN',
     'DEF:user_max_raw={file}:user:MAX',
     'DEF:syst_avg_raw={file}:syst:AVERAGE',
     'DEF:syst_min_raw={file}:syst:MIN',
     'DEF:syst_max_raw={file}:syst:MAX',
@@ -1978,33 +2013,13 @@
     "LINE1:syst_avg#$FullRed:System",
     'GPRINT:syst_min:MIN:%5.1lf%s Min,',
     'GPRINT:syst_avg:AVERAGE:%5.1lf%s Avg,',
     'GPRINT:syst_max:MAX:%5.1lf%s Max,',
     'GPRINT:syst_avg:LAST:%5.1lf%s Last\l'
     ],
-    ps_count => [
-    'DEF:procs_avg={file}:processes:AVERAGE',
-    'DEF:procs_min={file}:processes:MIN',
-    'DEF:procs_max={file}:processes:MAX',
-    'DEF:thrds_avg={file}:threads:AVERAGE',
-    'DEF:thrds_min={file}:threads:MIN',
-    'DEF:thrds_max={file}:threads:MAX',
-    "AREA:thrds_avg#$HalfBlue",
-    "AREA:procs_avg#$HalfRed",
-    "LINE1:thrds_avg#$FullBlue:Threads  ",
-    'GPRINT:thrds_min:MIN:%5.1lf Min,',
-    'GPRINT:thrds_avg:AVERAGE:%5.1lf Avg,',
-    'GPRINT:thrds_max:MAX:%5.1lf Max,',
-    'GPRINT:thrds_avg:LAST:%5.1lf Last\l',
-    "LINE1:procs_avg#$FullRed:Processes",
-    'GPRINT:procs_min:MIN:%5.1lf Min,',
-    'GPRINT:procs_avg:AVERAGE:%5.1lf Avg,',
-    'GPRINT:procs_max:MAX:%5.1lf Max,',
-    'GPRINT:procs_avg:LAST:%5.1lf Last\l'
-    ],
-    ps_pagefaults => [
+    ps_pagefaults => ['-v', 'Pagefaults/s',
     'DEF:minor_avg={file}:minflt:AVERAGE',
     'DEF:minor_min={file}:minflt:MIN',
     'DEF:minor_max={file}:minflt:MAX',
     'DEF:major_avg={file}:majflt:AVERAGE',
     'DEF:major_min={file}:majflt:MIN',
     'DEF:major_max={file}:majflt:MAX',
@@ -2019,12 +2034,23 @@
     "LINE1:major_avg#$FullRed:Major",
     'GPRINT:major_min:MIN:%5.1lf%s Min,',
     'GPRINT:major_avg:AVERAGE:%5.1lf%s Avg,',
     'GPRINT:major_max:MAX:%5.1lf%s Max,',
     'GPRINT:major_avg:LAST:%5.1lf%s Last\l'
     ],
+    ps_rss => ['-v', 'Bytes',
+    'DEF:avg={file}:value:AVERAGE',
+    'DEF:min={file}:value:MIN',
+    'DEF:max={file}:value:MAX',
+    "AREA:avg#$HalfBlue",
+    "LINE1:avg#$FullBlue:RSS",
+    'GPRINT:min:MIN:%5.1lf%s Min,',
+    'GPRINT:avg:AVERAGE:%5.1lf%s Avg,',
+    'GPRINT:max:MAX:%5.1lf%s Max,',
+    'GPRINT:avg:LAST:%5.1lf%s Last\l'
+    ],
     ps_state => ['-v', 'Processes',
     'DEF:avg={file}:value:AVERAGE',
     'DEF:min={file}:value:MIN',
     'DEF:max={file}:value:MAX',
     "AREA:max#$HalfBlue",
     "AREA:min#$Canvas",
@@ -2136,13 +2162,13 @@
     "LINE1:temp_avg#$FullRed:Temperature",
     'GPRINT:temp_min:MIN:%4.1lf Min,',
     'GPRINT:temp_avg:AVERAGE:%4.1lf Avg,',
     'GPRINT:temp_max:MAX:%4.1lf Max,',
     'GPRINT:temp_avg:LAST:%4.1lf Last\l'
     ],
-    timeleft => [
+    timeleft => ['-v', 'Minutes',
     'DEF:avg={file}:timeleft:AVERAGE',
     'DEF:min={file}:timeleft:MIN',
     'DEF:max={file}:timeleft:MAX',
     "AREA:max#$HalfBlue",
     "AREA:min#$Canvas",
     "LINE1:avg#$FullBlue:Time left [min]",
@@ -2220,13 +2246,13 @@
     "LINE1:multimeter_avg#$FullBlue:Multimeter",
     'GPRINT:multimeter_min:MIN:%4.1lf Min,',
     'GPRINT:multimeter_avg:AVERAGE:%4.1lf Average,',
     'GPRINT:multimeter_max:MAX:%4.1lf Max,',
     'GPRINT:multimeter_avg:LAST:%4.1lf Last\l'
     ],
-    users => [
+    users => ['-v', 'Users',
     'DEF:users_avg={file}:users:AVERAGE',
     'DEF:users_min={file}:users:MIN',
     'DEF:users_max={file}:users:MAX',
     "AREA:users_max#$HalfBlue",
     "AREA:users_min#$Canvas",
     "LINE1:users_avg#$FullBlue:Users",
@@ -2454,12 +2480,14 @@
   my $opts = {};
   my $sources = [];
 
   $opts->{'title'} = "$host/$plugin"
   . (defined ($plugin_instance) ? "-$plugin_instance" : '') . "/$type";
 
+  $opts->{'rrd_opts'} = ['-v', 'Percent'];
+
   my @files = ();
 
   $opts->{'colors'} =
   {
     'idle'      => 'ffffff',
     'nice'      => '00e000',
@@ -2711,12 +2739,13 @@
 
   my $opts = {};
   my $sources = [];
 
   $opts->{'title'} = "$host/$plugin"
   . (defined ($plugin_instance) ? "-$plugin_instance" : '') . "/$type";
+  $opts->{'rrd_opts'} = ['-v', 'Processes'];
 
   my @files = ();
 
   $opts->{'colors'} =
   {
     'Running'      => '00e000',
@@ -2770,12 +2799,13 @@
   my $opts = {};
   my $sources = [];
 
   $opts->{'title'} = "$host/$plugin"
   . (defined ($plugin_instance) ? "-$plugin_instance" : '') . "/$type";
   $opts->{'number_format'} = '%5.1lf%s';
+  $opts->{'rrd_opts'} = ['-v', 'Bytes'];
 
   my @files = ();
 
   $opts->{'colors'} =
   {
     'Free'     => '00e000',
@@ -2848,13 +2878,13 @@
     LAST_ACK	  => '000080',
     LISTEN	  => 'ff0000',
     CLOSING	  => '000000'
   };
 
   _custom_sort_arrayref ($type_instances,
-    [qw(ESTABLISHED SYN_SENT SYN_RECV FIN_WAIT1 FIN_WAIT2 TIME_WAIT CLOSE
+    [reverse qw(ESTABLISHED SYN_SENT SYN_RECV FIN_WAIT1 FIN_WAIT2 TIME_WAIT CLOSE
     CLOSE_WAIT LAST_ACK CLOSING LISTEN)]);
 
   for (@$type_instances)
   {
     my $inst = $_;
     my $file = '';
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib: exec-munin.conf
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib: exec-munin.px
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/fedora/collectd.spec /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/fedora/collectd.spec
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/fedora/collectd.spec	2007-10-25 01:21:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/fedora/collectd.spec	2007-11-09 01:51:45.000000000 +0800
@@ -1,16 +1,20 @@
 Summary:	Statistics collection daemon for filling RRD files.
 Name:           collectd
-Version:	4.0.6
-Release:	0.fc7
+Version:	4.2.0
+Release:	1.fc6
 Source:		http://collectd.org/files/%{name}-%{version}.tar.gz
 License:	GPL
 Group:		System Environment/Daemons
 BuildRoot:	%{_tmppath}/%{name}-%{version}-root
-BuildPrereq:	lm_sensors-devel, mysql-devel, rrdtool-devel
+BuildPrereq:	lm_sensors-devel
+BuildPrereq:	mysql-devel
+BuildPrereq:	rrdtool-devel
+BuildPrereq:	net-snmp-devel
 Requires:	rrdtool
+Requires:	perl-Regexp-Common
 Packager:	Florian octo Forster <octo@verplant.org>
 Vendor:		Florian octo Forster <octo@verplant.org>
 
 %description
 collectd is a small daemon written in C for performance.  It reads various
 system  statistics  and updates  RRD files,  creating  them if neccessary.
@@ -60,12 +64,13 @@
 make install DESTDIR=$RPM_BUILD_ROOT
 mkdir -p $RPM_BUILD_ROOT/etc/rc.d/init.d
 mkdir -p $RPM_BUILD_ROOT/var/www/cgi-bin
 cp src/collectd.conf $RPM_BUILD_ROOT/etc/collectd.conf
 cp contrib/fedora/init.d-collectd $RPM_BUILD_ROOT/etc/rc.d/init.d/collectd
 cp contrib/collection.cgi $RPM_BUILD_ROOT/var/www/cgi-bin
+cp contrib/collection.conf $RPM_BUILD_ROOT/etc/collection.conf
 mkdir -p $RPM_BUILD_ROOT/var/lib/collectd
 
 %clean
 rm -rf $RPM_BUILD_ROOT
 
 %post
@@ -87,24 +92,32 @@
 exit 0
 
 %files
 %defattr(-,root,root)
 %doc AUTHORS COPYING ChangeLog INSTALL NEWS README
 %attr(0644,root,root) %config(noreplace) /etc/collectd.conf
+%attr(0644,root,root) %config(noreplace) /etc/collection.conf
 %attr(0755,root,root) /etc/rc.d/init.d/collectd
 %attr(0755,root,root) /var/www/cgi-bin/collection.cgi
 %attr(0755,root,root) %{_sbindir}/collectd
 %attr(0755,root,root) %{_bindir}/collectd-nagios
 %attr(0644,root,root) %{_mandir}/man1/*
 %attr(0644,root,root) %{_mandir}/man5/*
 
+%attr(0644,root,root) /usr/lib/perl5/5.8.8/i386-linux-thread-multi/perllocal.pod
+%attr(0644,root,root) /usr/lib/perl5/site_perl/5.8.8/Collectd.pm
+%attr(0644,root,root) /usr/lib/perl5/site_perl/5.8.8/Collectd/Unixsock.pm
+%attr(0644,root,root) /usr/lib/perl5/site_perl/5.8.8/i386-linux-thread-multi/auto/Collectd/.packlist
+%attr(0644,root,root) %{_mandir}/man3/Collectd::Unixsock.3pm.gz
+
 %attr(0644,root,root) %{_libdir}/%{name}/apcups.so*
 %attr(0644,root,root) %{_libdir}/%{name}/apcups.la
 
-%attr(0644,root,root) %{_libdir}/%{name}/apple_sensors.so*
-%attr(0644,root,root) %{_libdir}/%{name}/apple_sensors.la
+# FIXME!!!
+#%attr(0644,root,root) %{_libdir}/%{name}/apple_sensors.so*
+#%attr(0644,root,root) %{_libdir}/%{name}/apple_sensors.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/battery.so*
 %attr(0644,root,root) %{_libdir}/%{name}/battery.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/cpufreq.so*
 %attr(0644,root,root) %{_libdir}/%{name}/cpufreq.la
@@ -145,32 +158,39 @@
 %attr(0644,root,root) %{_libdir}/%{name}/load.so*
 %attr(0644,root,root) %{_libdir}/%{name}/load.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/logfile.so*
 %attr(0644,root,root) %{_libdir}/%{name}/logfile.la
 
-%attr(0644,root,root) %{_libdir}/%{name}/mbmon.so
+%attr(0644,root,root) %{_libdir}/%{name}/mbmon.so*
 %attr(0644,root,root) %{_libdir}/%{name}/mbmon.la
 
+%attr(0644,root,root) %{_libdir}/%{name}/memcached.so*
+%attr(0644,root,root) %{_libdir}/%{name}/memcached.la
+
 %attr(0644,root,root) %{_libdir}/%{name}/memory.so*
 %attr(0644,root,root) %{_libdir}/%{name}/memory.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/multimeter.so*
 %attr(0644,root,root) %{_libdir}/%{name}/multimeter.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/network.so*
 %attr(0644,root,root) %{_libdir}/%{name}/network.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/nfs.so*
 %attr(0644,root,root) %{_libdir}/%{name}/nfs.la
 
+%attr(0644,root,root) %{_libdir}/%{name}/nginx.so*
+%attr(0644,root,root) %{_libdir}/%{name}/nginx.la
+
 %attr(0644,root,root) %{_libdir}/%{name}/ntpd.so*
 %attr(0644,root,root) %{_libdir}/%{name}/ntpd.la
 
-%attr(0644,root,root) %{_libdir}/%{name}/nut.so*
-%attr(0644,root,root) %{_libdir}/%{name}/nut.la
+# FIXME!!!
+#%attr(0644,root,root) %{_libdir}/%{name}/nut.so*
+#%attr(0644,root,root) %{_libdir}/%{name}/nut.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/perl.so*
 %attr(0644,root,root) %{_libdir}/%{name}/perl.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/ping.so*
 %attr(0644,root,root) %{_libdir}/%{name}/ping.la
@@ -184,17 +204,24 @@
 %attr(0644,root,root) %{_libdir}/%{name}/serial.so*
 %attr(0644,root,root) %{_libdir}/%{name}/serial.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/swap.so*
 %attr(0644,root,root) %{_libdir}/%{name}/swap.la
 
+%attr(0644,root,root) %{_libdir}/%{name}/snmp.so*
+%attr(0644,root,root) %{_libdir}/%{name}/snmp.la
+
 %attr(0644,root,root) %{_libdir}/%{name}/syslog.so*
 %attr(0644,root,root) %{_libdir}/%{name}/syslog.la
 
-%attr(0644,root,root) %{_libdir}/%{name}/tape.so*
-%attr(0644,root,root) %{_libdir}/%{name}/tape.la
+# FIXME!!!
+#%attr(0644,root,root) %{_libdir}/%{name}/tape.so*
+#%attr(0644,root,root) %{_libdir}/%{name}/tape.la
+
+%attr(0644,root,root) %{_libdir}/%{name}/tcpconns.so*
+%attr(0644,root,root) %{_libdir}/%{name}/tcpconns.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/unixsock.so*
 %attr(0644,root,root) %{_libdir}/%{name}/unixsock.la
 
 %attr(0644,root,root) %{_libdir}/%{name}/users.so*
 %attr(0644,root,root) %{_libdir}/%{name}/users.la
@@ -223,17 +250,21 @@
 
 %files sensors
 %attr(0644,root,root) %{_libdir}/%{name}/sensors.so*
 %attr(0644,root,root) %{_libdir}/%{name}/sensors.la
 
 %changelog
+* Wed Oct 31 2007 Iain Lea <iain@bricbrac.de> 4.2.0
+- New major release
+- Changes to support 4.2.0 (ie. contrib/collection.conf)
+
 * Mon Aug 06 2007 Kjell Randa <Kjell.Randa@broadpark.no> 4.0.6
 - New upstream version
 
 * Wed Jul 25 2007 Kjell Randa <Kjell.Randa@broadpark.no> 4.0.5
-- New major releas
+- New major release
 - Changes to support 4.0.5 
 
 * Wed Jan 11 2007 Iain Lea <iain@bricbrac.de> 3.11.0-0
 - fixed spec file to build correctly on fedora core
 - added improved init.d script to work with chkconfig
 - added %post and %postun to call chkconfig automatically
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/README	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/README	2007-11-09 01:51:45.000000000 +0800
@@ -35,12 +35,21 @@
   Starting with version 4, collection.cgi requires a small config file, which
 should look something like this:
 
   datadir: "/var/lib/collectd/rrd/"
   libdir: "/usr/lib/collectd/"
 
+exec-munin.px
+-------------
+  Script to be used with the exec-plugin (see collectd-exec(5) for details)
+which executes munin plugins, parses the output and translates it to a format
+the exec-plugin understands. The features are limited - changing the munin
+plugins to use the output format understood by the exec-plugin is recommended.
+See the embedded POD documentation for more details:
+ $ perldoc contrib/exec-munin.px
+
 exec-smartctl
 -------------
   Sample script for the exec plugin. Please refer to the documentation in the
 file - you will have to adapt it to your needs anyway.
 
 extractDS.px
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/snmp-data.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/snmp-data.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/contrib/snmp-data.conf	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/contrib/snmp-data.conf	2007-11-09 01:51:45.000000000 +0800
@@ -41,71 +41,275 @@
     </Data>
 
     #
     # UPS-MIB
     # Statistics about your UPS using the UPS-MIB from the RFC1628.
     #
+    # Battery branch
+    <Data "upsmib_timeleft_battery">
+    	Type "timeleft"
+	Table false
+	Instance "battery"
+	Values ".1.3.6.1.2.1.33.1.2.3.0"
+    </Data>
     <Data "upsmib_charge_battery">
     	Type "percent"
 	Table false
 	Instance "charge-battery"
 	Values ".1.3.6.1.2.1.33.1.2.4.0"
     </Data>
     <Data "upsmib_voltage_battery">
     	Type "voltage"
 	Table false
 	Instance "battery"
 	Values ".1.3.6.1.2.1.33.1.2.5.0"
+	Scale 0.1
+    </Data>
+    <Data "upsmib_current_battery">
+    	Type "current"
+	Table false
+	Instance "battery"
+	Values ".1.3.6.1.2.1.33.1.2.6.0"
+	Scale 0.1
+    </Data>
+    <Data "upsmib_temperature_battery">
+    	Type "temperature"
+	Table false
+	Instance "battery"
+	Values ".1.3.6.1.2.1.33.1.2.7.0"
+    </Data>
+    # Input branch
+    <Data "upsmib_frequency_input">
+    	Type "frequency"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.2.1.33.1.3.3.1.2"
+	Scale 0.1
     </Data>
     <Data "upsmib_voltage_input">
     	Type "voltage"
 	Table true
 	InstancePrefix "input"
 	Values ".1.3.6.1.2.1.33.1.3.3.1.3"
     </Data>
+    <Data "upsmib_current_input">
+    	Type "current"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.2.1.33.1.3.3.1.4"
+	Scale 0.1
+    </Data>
+    <Data "upsmib_power_input">
+    	Type "power"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.2.1.33.1.3.3.1.5"
+    </Data>
+    # Output branch
+    <Data "upsmib_frequency_output">
+    	Type "frequency"
+	Table false
+	Instance "output"
+	Values ".1.3.6.1.2.1.33.1.4.2.0"
+	Scale 0.1
+    </Data>
     <Data "upsmib_voltage_output">
     	Type "voltage"
 	Table true
 	InstancePrefix "output"
 	Values ".1.3.6.1.2.1.33.1.4.4.1.2"
     </Data>
+    <Data "upsmib_current_output">
+    	Type "current"
+	Table true
+	InstancePrefix "output"
+	Values ".1.3.6.1.2.1.33.1.4.4.1.3"
+	Scale 0.1
+    </Data>
+    <Data "upsmib_power_output">
+    	Type "power"
+	Table true
+	InstancePrefix "output"
+	Values ".1.3.6.1.2.1.33.1.4.4.1.4"
+    </Data>
+    <Data "upsmib_load_output">
+    	Type "percent"
+	Table true
+	InstancePrefix "load-output"
+	Values ".1.3.6.1.2.1.33.1.4.4.1.5"
+    </Data>
+    # Bypass branch
+    <Data "upsmib_frequency_bypass">
+    	Type "frequency"
+	Table false
+	Instance "output"
+	Values ".1.3.6.1.2.1.33.1.5.1.0"
+	Scale 0.1
+    </Data>
     <Data "upsmib_voltage_bypass">
     	Type "voltage"
 	Table true
 	InstancePrefix "bypass"
 	Values ".1.3.6.1.2.1.33.1.5.3.1.2"
     </Data>
-    <Data "upsmib_current_battery">
+    <Data "upsmib_current_bypass">
     	Type "current"
+	Table true
+	InstancePrefix "bypass"
+	Values ".1.3.6.1.2.1.33.1.5.3.1.3"
+	Scale 0.1
+    </Data>
+    <Data "upsmib_power_bypass">
+    	Type "power"
+	Table true
+	InstancePrefix "bypass"
+	Values ".1.3.6.1.2.1.33.1.5.3.1.4"
+    </Data>
+    # Special definitions for broken UPSes
+    <Data "upsmib_voltage_battery_unscaled">
+    	Type "voltage"
 	Table false
 	Instance "battery"
-	Values ".1.3.6.1.2.1.33.1.2.6.0"
+	Values ".1.3.6.1.2.1.33.1.2.5.0"
     </Data>
-    <Data "upsmib_current_input">
+    <Data "upsmib_current_input_unscaled">
     	Type "current"
 	Table true
 	InstancePrefix "input"
 	Values ".1.3.6.1.2.1.33.1.3.3.1.4"
     </Data>
-    <Data "upsmib_current_output">
+    <Data "upsmib_current_output_unscaled">
     	Type "current"
 	Table true
 	InstancePrefix "output"
 	Values ".1.3.6.1.2.1.33.1.4.4.1.3"
     </Data>
-    <Data "upsmib_current_bypass">
+
+    #
+    # Riello UPS
+    # Temperatures for UPSes by Riello, <http://www.riello-ups.de/>
+    #
+    <Data "riello_temperature_system">
+    	Type "temperature"
+	Table false
+	Instance "system"
+	Values ".1.3.6.1.4.1.5491.1.51.1.5.4.0"
+    </Data>
+    <Data "riello_temperature_rectifier">
+    	Type "temperature"
+	Table false
+	Instance "rectifier"
+	Values ".1.3.6.1.4.1.5491.1.51.1.5.5.0"
+    </Data>
+    <Data "riello_temperature_inverter">
+    	Type "temperature"
+	Table false
+	Instance "inverter"
+	Values ".1.3.6.1.4.1.5491.1.51.1.5.6.0"
+    </Data>
+
+    #
+    # PowerPlus UPS, manufactured by Gamatronic, <http://www.gamatronic.com/>,
+    # distributed in Germany by AdPoS, <http://adpos-usv.de/>
+    #
+    # Global inputs
+    <Data "powerplus_voltage_input">
+    	Type "voltage"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.4.1.6050.5.4.1.1.2"
+    </Data>
+    <Data "powerplus_current_input">
     	Type "current"
 	Table true
-	InstancePrefix "bypass"
-	Values ".1.3.6.1.2.1.33.1.5.3.1.3"
+	InstancePrefix "input"
+	Values ".1.3.6.1.4.1.6050.5.4.1.1.3"
     </Data>
-    <Data "upsmib_temperature_battery">
-    	Type "temperature"
+    <Data "powerplus_power_apparent_input">
+    	Type "power"
+	Table true
+	InstancePrefix "apparent-input"
+	Values ".1.3.6.1.4.1.6050.5.4.1.1.4"
+	Scale 100.0
+    </Data>
+    <Data "powerplus_power_active_input">
+    	Type "power"
+	Table true
+	InstancePrefix "active-input"
+	Values ".1.3.6.1.4.1.6050.5.4.1.1.5"
+	Scale 100.0
+    </Data>
+    <Data "powerplus_performance_factor_input">
+    	Type "percent"
+	Table true
+	InstancePrefix "performance_factor-input"
+	Values ".1.3.6.1.4.1.6050.5.4.1.1.6"
+    </Data>
+    # Global outputs
+    <Data "powerplus_voltage_output">
+    	Type "voltage"
+	Table true
+	InstancePrefix "output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.2"
+    </Data>
+    <Data "powerplus_current_output">
+    	Type "current"
+	Table true
+	InstancePrefix "output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.3"
+    </Data>
+    <Data "powerplus_power_apparent_output">
+    	Type "power"
+	Table true
+	InstancePrefix "apparent-output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.4"
+	Scale 100.0
+    </Data>
+    <Data "powerplus_power_active_output">
+    	Type "power"
+	Table true
+	InstancePrefix "active-output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.5"
+	Scale 100.0
+    </Data>
+    <Data "powerplus_load_level_output">
+    	Type "percent"
+	Table true
+	InstancePrefix "load_level-output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.6"
+    </Data>
+    <Data "powerplus_active_load_level_output">
+    	Type "percent"
+	Table true
+	InstancePrefix "active_load_level-output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.7"
+    </Data>
+    <Data "powerplus_performance_factor_output">
+    	Type "percent"
+	Table true
+	InstancePrefix "performance_factor-output"
+	Values ".1.3.6.1.4.1.6050.5.5.1.1.8"
+    </Data>
+    # Global DC
+    <Data "powerplus_global_dc_positive">
+    	Type "voltage"
 	Table false
-	Instance "battery"
-	Values ".1.3.6.1.2.1.33.1.2.7.0"
+	Instance "dc_positive-global"
+	Values ".1.3.6.1.4.1.6050.5.6.1.0"
+    </Data>
+    <Data "powerplus_global_dc_negative">
+    	Type "voltage"
+	Table false
+	Instance "dc_negative-global"
+	Values ".1.3.6.1.4.1.6050.5.6.2.0"
+    </Data>
+    <Data "powerplus_global_dc_total">
+    	Type "voltage"
+	Table false
+	Instance "dc_total-global"
+	Values ".1.3.6.1.4.1.6050.5.6.3.0"
     </Data>
 
     #
     # NetApp
     # Some simple statistics of storage systems by NetApp.
     #
@@ -202,7 +406,50 @@
     	Type "temperature"
 	Table true
 	Instance ".1.3.6.1.4.1.5040.1.2.3.3.2.1.1.2"
 	Values ".1.3.6.1.4.1.5040.1.2.3.1.4.1.1"
 	Scale 0.1
     </Data>
+
+    #
+    # Infratec
+    # Rack monitoring devices by Infratec, <http://www.infratec-ag.de/>
+    #
+    # Model H2-17
+    <Data "infratec_h2_17_temperature">
+    	Type "temperature"
+	Table true
+	Instance ".1.3.6.1.4.1.4519.10.4.1.1.2"
+	Values ".1.3.6.1.4.1.4519.10.4.1.1.3"
+    </Data>
+    <Data "infratec_h2_17_humidity">
+    	Type "humidity"
+	Table true
+	Instance ".1.3.6.1.4.1.4519.10.5.1.1.2"
+	Values ".1.3.6.1.4.1.4519.10.5.1.1.3"
+    </Data>
+    <Data "infratec_h2_17_voltage">
+    	Type "voltage"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.4.1.4519.10.6.1.1.3"
+    </Data>
+    # Model H2-30
+    <Data "infratec_h2_30_temperature">
+    	Type "temperature"
+	Table true
+	Instance ".1.3.6.1.4.1.1909.10.4.1.1.2"
+	Values ".1.3.6.1.4.1.1909.10.4.1.1.3"
+    </Data>
+    <Data "infratec_h2_30_humidity">
+    	Type "humidity"
+	Table true
+	Instance ".1.3.6.1.4.1.1909.10.5.1.1.2"
+	Values ".1.3.6.1.4.1.1909.10.5.1.1.3"
+    </Data>
+    <Data "infratec_h2_30_voltage">
+    	Type "voltage"
+	Table true
+	InstancePrefix "input"
+	Values ".1.3.6.1.4.1.1909.10.6.1.1.3"
+    </Data>
 </Plugin>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/apcups.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/apcups.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/apcups.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/apcups.c	2007-11-01 07:59:58.000000000 +0800
@@ -133,13 +133,13 @@
 	ai_hints.ai_socktype = SOCK_STREAM;
 
 	status = getaddrinfo (host, port_str, &ai_hints, &ai_return);
 	if (status != 0)
 	{
 		char errbuf[1024];
-		DEBUG ("getaddrinfo failed: %s",
+		INFO ("getaddrinfo failed: %s",
 				(status == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
 				: gai_strerror (status));
 		return (-1);
 	}
 
@@ -164,13 +164,13 @@
 
 	freeaddrinfo (ai_return);
 
 	if (status != 0) /* `connect(2)' failed */
 	{
 		char errbuf[1024];
-		DEBUG ("connect failed: %s",
+		INFO ("connect failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		close (sd);
 		return (-1);
 	}
 
 	DEBUG ("Done opening a socket %i", sd);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.1	2007-10-27 17:20:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.1	2007-11-09 04:59:38.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD 1"
-.TH COLLECTD 1 "2007-10-24" "4.2.0" "collectd"
+.TH COLLECTD 1 "2007-10-24" "4.2.1" "collectd"
 .SH "NAME"
 collectd \- System statistics collection daemon
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd \fI[options]\fR
 .SH "DESCRIPTION"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.conf.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.conf.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.conf.5	2007-10-27 17:20:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.conf.5	2007-11-09 04:59:39.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD.CONF 5"
-.TH COLLECTD.CONF 5 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD.CONF 5 "2007-11-08" "4.2.1" "collectd"
 .SH "NAME"
 collectd.conf \- Configuration for the system statistics collection daemon \fBcollectd\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 3
 \&  BaseDir "/path/to/data/"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.conf.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.conf.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.conf.in	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.conf.in	2007-11-09 01:51:45.000000000 +0800
@@ -37,12 +37,13 @@
 @BUILD_PLUGIN_MEMORY_TRUE@LoadPlugin memory
 @BUILD_PLUGIN_MULTIMETER_TRUE@LoadPlugin multimeter
 @BUILD_PLUGIN_MYSQL_TRUE@LoadPlugin mysql
 @BUILD_PLUGIN_NETLINK_TRUE@LoadPlugin netlink
 @BUILD_PLUGIN_NETWORK_TRUE@LoadPlugin network
 @BUILD_PLUGIN_NFS_TRUE@LoadPlugin nfs
+@BUILD_PLUGIN_NGINX_TRUE@LoadPlugin nginx
 @BUILD_PLUGIN_NTPD_TRUE@LoadPlugin ntpd
 @BUILD_PLUGIN_NUT_TRUE@LoadPlugin nut
 @BUILD_PLUGIN_PERL_TRUE@LoadPlugin perl
 @BUILD_PLUGIN_PING_TRUE@LoadPlugin ping
 @BUILD_PLUGIN_PROCESSES_TRUE@LoadPlugin processes
 @BUILD_PLUGIN_RRDTOOL_TRUE@LoadPlugin rrdtool
@@ -157,12 +158,19 @@
 #	Listen "239.192.74.66" "25826"
 #	TimeToLive "128"
 #	Forward false
 #	CacheFlush 1800
 #</Plugin>
 
+#<Plugin nginx>
+#	URL "http://localhost/status?auto"
+#	User "www-user"
+#	Password "secret"
+#	CACert "/etc/ssl/ca.crt"
+#</Plugin>
+
 #<Plugin ntpd>
 #	Host "localhost"
 #	Port 123
 #</Plugin>
 
 #<Plugin nut>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-email.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-email.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-email.5	2007-10-27 17:20:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-email.5	2007-11-09 04:59:39.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EMAIL 5"
-.TH COLLECTD-EMAIL 5 "2007-10-24" "4.2.0" "collectd"
+.TH COLLECTD-EMAIL 5 "2007-10-24" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-email \- Documentation of collectd's \f(CW\*(C`email plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-exec.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-exec.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-exec.5	2007-10-27 17:20:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-exec.5	2007-11-09 04:59:39.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EXEC 5"
-.TH COLLECTD-EXEC 5 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD-EXEC 5 "2007-11-08" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-exec \- Documentation of collectd's \f(CW\*(C`exec plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 7
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd.h	2007-10-26 23:13:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd.h	2007-11-01 07:59:58.000000000 +0800
@@ -192,17 +192,12 @@
 #endif
 
 #ifndef PLUGINDIR
 #define PLUGINDIR PREFIX "/lib/" PACKAGE_NAME
 #endif
 
-#define MODE_SERVER 0x01
-#define MODE_CLIENT 0x02
-#define MODE_LOCAL  0x04
-#define MODE_LOG    0x08
-
 #ifndef COLLECTD_GRP_NAME
 # define COLLECTD_GRP_NAME "collectd"
 #endif
 
 #define STATIC_ARRAY_LEN(array) (sizeof (array) / sizeof ((array)[0]))
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-nagios.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-nagios.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-nagios.1	2007-10-27 17:20:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-nagios.1	2007-11-09 04:59:38.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-NAGIOS 1"
-.TH COLLECTD-NAGIOS 1 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD-NAGIOS 1 "2007-10-27" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-nagios \- Nagios plugin for querying collectd
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd-nagios \fB\-s\fR \fIsocket\fR \fB\-n\fR \fIvalue_spec\fR \fB\-H\fR \fIhostname\fR \fI[options]\fR
 .SH "DESCRIPTION"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-perl.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-perl.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-perl.5	2007-10-27 17:20:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-perl.5	2007-11-09 04:59:39.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-PERL 5"
-.TH COLLECTD-PERL 5 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD-PERL 5 "2007-11-08" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-perl \- Documentation of collectd's \f(CW\*(C`perl plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  LoadPlugin perl
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-snmp.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-snmp.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-snmp.5	2007-10-27 17:20:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-snmp.5	2007-11-09 04:59:39.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-SNMP 5"
-.TH COLLECTD-SNMP 5 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD-SNMP 5 "2007-11-08" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-snmp \- Documentation of collectd's \f(CW\*(C`snmp plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 23
 \&  LoadPlugin snmp
@@ -163,13 +163,13 @@
 .Vb 21
 \&    <Host "some.switch.mydomain.org">
 \&      Address "192.168.0.2"
 \&      Version 1
 \&      Community "community_string"
 \&      Collect "std_traffic"
-\&      Inverval 120
+\&      Interval 120
 \&    </Host>
 \&    <Host "some.server.mydomain.org">
 \&      Address "192.168.0.42"
 \&      Version 2
 \&      Community "another_string"
 \&      Collect "std_traffic" "hr_users"
@@ -196,15 +196,14 @@
 and ten threads are used.
 .SH "CONFIGURATION"
 .IX Header "CONFIGURATION"
 Since the aim of the \f(CW\*(C`snmp plugin\*(C'\fR is to provide a generic interface to \s-1SNMP\s0,
 it's configuration is not trivial and may take some time.
 .PP
-Since the \f(CW\*(C`Net\-SNMP\*(C'\fR library is used you can use all the environment
-variables that are interpreted by that package. See \fIsnmpcmd\fR\|(1) for more
-details.
+Since the \f(CW\*(C`Net\-SNMP\*(C'\fR library is used you can use all the environment variables
+that are interpreted by that package. See \fIsnmpcmd\fR\|(1) for more details.
 .PP
 There are two types of blocks that can be contained in the
 \&\f(CW\*(C`<Plugin\ snmp>\*(C'\fR block: \fBData\fR and \fBHost\fR:
 .Sh "The \fBData\fP block"
 .IX Subsection "The Data block"
 The \fBData\fR block defines a list of values or a table of values that are to be
@@ -319,13 +318,13 @@
 stored by collectd.
 .IP "\fBAddress\fR \fIIP-Address\fR|\fIHostname\fR" 4
 .IX Item "Address IP-Address|Hostname"
 Set the address to connect to.
 .IP "\fBVersion\fR \fB1\fR|\fB2\fR" 4
 .IX Item "Version 1|2"
-Set the \s-1SNMP\s0 version to use. When giving \fB2\fR version 2c is actually used.
+Set the \s-1SNMP\s0 version to use. When giving \fB2\fR version \f(CW\*(C`2c\*(C'\fR is actually used.
 Version 3 is not supported by this plugin.
 .IP "\fBCommunity\fR \fICommunity\fR" 4
 .IX Item "Community Community"
 Pass \fICommunity\fR to the host.
 .IP "\fBCollect\fR \fIData\fR [\fIData\fR ...]" 4
 .IX Item "Collect Data [Data ...]"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-snmp.pod /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-snmp.pod
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-snmp.pod	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-snmp.pod	2007-11-09 01:51:45.000000000 +0800
@@ -30,13 +30,13 @@
 
     <Host "some.switch.mydomain.org">
       Address "192.168.0.2"
       Version 1
       Community "community_string"
       Collect "std_traffic"
-      Inverval 120
+      Interval 120
     </Host>
     <Host "some.server.mydomain.org">
       Address "192.168.0.42"
       Version 2
       Community "another_string"
       Collect "std_traffic" "hr_users"
@@ -64,15 +64,14 @@
 
 =head1 CONFIGURATION
 
 Since the aim of the C<snmp plugin> is to provide a generic interface to SNMP,
 it's configuration is not trivial and may take some time.
 
-Since the C<Net-SNMP> library is used you can use all the environment
-variables that are interpreted by that package. See L<snmpcmd(1)> for more
-details.
+Since the C<Net-SNMP> library is used you can use all the environment variables
+that are interpreted by that package. See L<snmpcmd(1)> for more details.
 
 There are two types of blocks that can be contained in the
 C<E<lt>PluginE<nbsp>snmpE<gt>> block: B<Data> and B<Host>:
 
 =head2 The B<Data> block
 
@@ -204,13 +203,13 @@
 =item B<Address> I<IP-Address>|I<Hostname>
 
 Set the address to connect to.
 
 =item B<Version> B<1>|B<2>
 
-Set the SNMP version to use. When giving B<2> version 2c is actually used.
+Set the SNMP version to use. When giving B<2> version C<2c> is actually used.
 Version 3 is not supported by this plugin.
 
 =item B<Community> I<Community>
 
 Pass I<Community> to the host.
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-unixsock.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-unixsock.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/collectd-unixsock.5	2007-10-27 17:20:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/collectd-unixsock.5	2007-11-09 04:59:40.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-UNIXSOCK 5"
-.TH COLLECTD-UNIXSOCK 5 "2007-10-27" "4.2.0" "collectd"
+.TH COLLECTD-UNIXSOCK 5 "2007-11-08" "4.2.1" "collectd"
 .SH "NAME"
 collectd\-unixsock \- Documentation of collectd's \f(CW\*(C`unixsock plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/exec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/exec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/exec.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/exec.c	2007-11-08 22:00:13.000000000 +0800
@@ -292,12 +292,13 @@
   if (fh == NULL)
   {
     char errbuf[1024];
     ERROR ("exec plugin: fdopen (%i) failed: %s", fd,
 	sstrerror (errno, errbuf, sizeof (errbuf)));
     kill (pl->pid, SIGTERM);
+    pl->pid = 0;
     close (fd);
     pthread_exit ((void *) 1);
   }
 
   while (fgets (buffer, sizeof (buffer), fh) != NULL)
   {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/hddtemp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/hddtemp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/hddtemp.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/hddtemp.c	2007-11-01 07:59:58.000000000 +0800
@@ -141,13 +141,13 @@
 		}
 
 		/* connect to the hddtemp daemon */
 		if (connect (fd, (struct sockaddr *) ai_ptr->ai_addr, ai_ptr->ai_addrlen))
 		{
 			char errbuf[1024];
-			DEBUG ("hddtemp: connect (%s, %s): %s", host, port,
+			INFO ("hddtemp: connect (%s, %s): %s", host, port,
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			close (fd);
 			fd = -1;
 			continue;
 		}
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/mbmon.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/mbmon.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/mbmon.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/mbmon.c	2007-11-01 07:59:58.000000000 +0800
@@ -129,13 +129,13 @@
 		}
 
 		/* connect to the mbmon daemon */
 		if (connect (fd, (struct sockaddr *) ai_ptr->ai_addr, ai_ptr->ai_addrlen))
 		{
 			char errbuf[1024];
-			DEBUG ("mbmon: connect (%s, %s): %s", host, port,
+			INFO ("mbmon: connect (%s, %s): %s", host, port,
 					sstrerror (errno, errbuf,
 						sizeof (errbuf)));
 			close (fd);
 			fd = -1;
 			continue;
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/ntpd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/ntpd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/ntpd.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/ntpd.c	2007-11-01 07:59:58.000000000 +0800
@@ -490,13 +490,13 @@
 		if ((status < 0) && ((errno == EAGAIN) || (errno == EINTR)))
 			continue;
 
 		if (status < 0)
 		{
 			char errbuf[1024];
-			DEBUG ("recv(2) failed: %s",
+			INFO ("recv(2) failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			DEBUG ("Closing socket #%i", sd);
 			close (sd);
 			sock_descr = sd = -1;
 			return (-1);
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/perl.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/perl.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/perl.c	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/perl.c	2007-11-09 01:51:45.000000000 +0800
@@ -828,12 +828,16 @@
 	PL_exit_flags |= PERL_EXIT_DESTRUCT_END;
 
 	if (0 != perl_parse (perl, xs_init, argc, argv, NULL)) {
 		log_err ("module_register: Unable to bootstrap Collectd.");
 		exit (1);
 	}
+
+	/* Set $0 to "collectd" because perl_parse() has to set it to "-e". */
+	Perl_sv_setpv (perl, Perl_get_sv (perl, "0", 0), "collectd");
+
 	perl_run (perl);
 
 	plugin_register_log ("perl", perl_log);
 	plugin_register_init ("perl", perl_init);
 
 	plugin_register_read ("perl", perl_read);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/plugin.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/plugin.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/plugin.h	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/plugin.h	2007-11-08 22:00:07.000000000 +0800
@@ -190,13 +190,17 @@
 
 void plugin_log (int level, const char *format, ...);
 #define ERROR(...)   plugin_log (LOG_ERR,     __VA_ARGS__)
 #define WARNING(...) plugin_log (LOG_WARNING, __VA_ARGS__)
 #define NOTICE(...)  plugin_log (LOG_NOTICE,  __VA_ARGS__)
 #define INFO(...)    plugin_log (LOG_INFO,    __VA_ARGS__)
-#define DEBUG(...)   plugin_log (LOG_DEBUG,   __VA_ARGS__)
+#if COLLECT_DEBUG
+# define DEBUG(...)  plugin_log (LOG_DEBUG,   __VA_ARGS__)
+#else /* COLLECT_DEBUG */
+# define DEBUG(...)  /* noop */
+#endif /* ! COLLECT_DEBUG */
 
 /* TODO: Move plugin_{complain,relief} into `utils_complain.[ch]'. -octo */
 void plugin_complain (int level, complain_t *c, const char *format, ...);
 void plugin_relief (int level, complain_t *c, const char *format, ...);
 
 const data_set_t *plugin_get_ds (const char *name);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/snmp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/snmp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/snmp.c	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/snmp.c	2007-11-09 01:51:45.000000000 +0800
@@ -653,30 +653,16 @@
 } /* int csnmp_config */
 
 /* End of the config stuff. Now the interesting part begins */
 
 static void csnmp_host_close_session (host_definition_t *host)
 {
-  int status;
-
   if (host->sess_handle == NULL)
     return;
 
-  status = snmp_sess_close (host->sess_handle);
-
-  if (status != 0)
-  {
-    char *errstr = NULL;
-
-    snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
-
-    ERROR ("snmp plugin: host %s: snmp_sess_close failed: %s",
-	host->name, (errstr == NULL) ? "Unknown problem" : errstr);
-    sfree (errstr);
-  }
-
+  snmp_sess_close (host->sess_handle);
   host->sess_handle = NULL;
 } /* void csnmp_host_close_session */
 
 static void csnmp_host_open_session (host_definition_t *host)
 {
   struct snmp_session sess;
@@ -1104,40 +1090,57 @@
       break;
     }
 
     for (i = 0; i < oid_list_len; i++)
       snmp_add_null_var (req, oid_list[i].oid, oid_list[i].oid_len);
 
+    res = NULL;
     status = snmp_sess_synch_response (host->sess_handle, req, &res);
 
-    if (status != STAT_SUCCESS)
+    if ((status != STAT_SUCCESS) || (res == NULL))
     {
       char *errstr = NULL;
 
       snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
       ERROR ("snmp plugin: host %s: snmp_sess_synch_response failed: %s",
 	  host->name, (errstr == NULL) ? "Unknown problem" : errstr);
+
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
+      sfree (errstr);
       csnmp_host_close_session (host);
 
       status = -1;
       break;
     }
     status = 0;
     assert (res != NULL);
 
     vb = res->variables;
     if (vb == NULL)
     {
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
       status = -1;
       break;
     }
 
     /* Check if all values (and possibly the instance) have left their
      * subtree */
     if (csnmp_check_res_left_subtree (host, data, res) != 0)
+    {
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
       break;
+    }
 
     /* if an instance-OID is configured.. */
     if (data->instance.oid.oid_len > 0)
     {
       /* Allocate a new `csnmp_list_instances_t', insert the instance name and
        * add it to the list */
@@ -1311,23 +1314,30 @@
     sfree (vl.values);
     return (-1);
   }
 
   for (i = 0; i < data->values_len; i++)
     snmp_add_null_var (req, data->values[i].oid, data->values[i].oid_len);
+
+  res = NULL;
   status = snmp_sess_synch_response (host->sess_handle, req, &res);
 
-  if (status != STAT_SUCCESS)
+  if ((status != STAT_SUCCESS) || (res == NULL))
   {
     char *errstr = NULL;
 
     snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
     ERROR ("snmp plugin: host %s: snmp_sess_synch_response failed: %s",
 	host->name, (errstr == NULL) ? "Unknown problem" : errstr);
-    csnmp_host_close_session (host);
+
+    if (res != NULL)
+      snmp_free_pdu (res);
+    res = NULL;
+
     sfree (errstr);
+    csnmp_host_close_session (host);
 
     return (-1);
   }
 
   vl.time = time (NULL);
 
@@ -1344,13 +1354,15 @@
       if (snmp_oid_compare (data->values[i].oid, data->values[i].oid_len,
 	    vb->name, vb->name_length) == 0)
 	vl.values[i] = csnmp_value_list_to_value (vb, ds->ds[i].type,
 	    data->scale, data->shift);
   } /* for (res->variables) */
 
-  snmp_free_pdu (res);
+  if (res != NULL)
+    snmp_free_pdu (res);
+  res = NULL;
 
   DEBUG ("snmp plugin: -> plugin_dispatch_values (%s, &vl);", data->type);
   plugin_dispatch_values (data->type, &vl);
   sfree (vl.values);
 
   return (0);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/tcpconns.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/tcpconns.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/tcpconns.c	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/tcpconns.c	2007-11-09 01:51:45.000000000 +0800
@@ -333,18 +333,13 @@
 {
   FILE *fh;
   char buffer[1024];
 
   fh = fopen (file, "r");
   if (fh == NULL)
-  {
-    char errbuf[1024];
-    ERROR ("tcpconns plugin: fopen (%s) failed: %s",
-	file, sstrerror (errno, errbuf, sizeof (errbuf)));
     return (-1);
-  }
 
   while (fgets (buffer, sizeof (buffer), fh) != NULL)
   {
     conn_handle_line (buffer);
   } /* while (fgets) */
 
@@ -408,18 +403,31 @@
 
   return (0);
 } /* int conn_init */
 
 static int conn_read (void)
 {
+  int errors_num = 0;
+
   conn_reset_port_entry ();
 
-  conn_read_file ("/proc/net/tcp");
-  conn_read_file ("/proc/net/tcp6");
+  if (conn_read_file ("/proc/net/tcp") != 0)
+    errors_num++;
+  if (conn_read_file ("/proc/net/tcp6") != 0)
+    errors_num++;
 
-  conn_submit_all ();
+  if (errors_num < 2)
+  {
+    conn_submit_all ();
+  }
+  else
+  {
+    ERROR ("tcpconns plugin: Neither /proc/net/tcp nor /proc/net/tcp6 "
+	"coult be read.");
+    return (-1);
+  }
 
   return (0);
 } /* int conn_read */
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_SYSCTLBYNAME
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/types.db /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/types.db
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/src/types.db	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/src/types.db	2007-11-09 01:51:45.000000000 +0800
@@ -3,14 +3,14 @@
 apache_requests		count:COUNTER:0:134217728
 apache_scoreboard	count:GAUGE:0:65535
 bitrate			value:GAUGE:0:4294967295
 charge			value:GAUGE:0:U
 connections		value:COUNTER:0:U
 counter			value:COUNTER:U:U
-cpu			value:COUNTER:0:4294967295
 cpufreq			value:GAUGE:0:U
+cpu			value:COUNTER:0:4294967295
 current			value:GAUGE:U:U
 delay			seconds:GAUGE:-1000000:1000000
 df			used:GAUGE:0:1125899906842623, free:GAUGE:0:1125899906842623
 disk_merged		read:COUNTER:0:4294967295, write:COUNTER:0:4294967295
 disk_octets		read:COUNTER:0:17179869183, write:COUNTER:0:17179869183
 disk_ops		read:COUNTER:0:4294967295, write:COUNTER:0:4294967295
@@ -24,13 +24,13 @@
 email_size		value:GAUGE:0:U
 entropy			entropy:GAUGE:0:4294967295
 fanspeed		value:GAUGE:0:U
 frequency		frequency:GAUGE:0:U
 frequency_offset	ppm:GAUGE:-1000000:1000000
 gauge			value:GAUGE:U:U
-humitidy		value:GAUGE:0:100
+humidity		value:GAUGE:0:100
 if_collisions		value:COUNTER:0:4294967295
 if_dropped		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_errors		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_multicast		value:COUNTER:0:4294967295
 if_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_packets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
@@ -60,22 +60,23 @@
 power			value:GAUGE:0:U
 ps_count		processes:GAUGE:0:1000000, threads:GAUGE:0:1000000
 ps_cputime		user:COUNTER:0:16000000, syst:COUNTER:0:16000000
 ps_pagefaults		minflt:COUNTER:0:9223372036854775807, majflt:COUNTER:0:9223372036854775807
 ps_rss			value:GAUGE:0:9223372036854775807
 ps_state		value:GAUGE:0:65535
+serial_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
+signal_noise		value:GAUGE:U:0
+signal_power		value:GAUGE:U:0
+signal_quality		value:GAUGE:0:U
 spam_score		value:GAUGE:U:U
+swap			value:GAUGE:0:1099511627776
 tcp_connections		value:GAUGE:0:4294967295
 temperature		value:GAUGE:-273.15:U
 time_dispersion		seconds:GAUGE:-1000000:1000000
-time_offset		seconds:GAUGE:-1000000:1000000
 timeleft		timeleft:GAUGE:0:3600
-voltage			value:GAUGE:U:U
-serial_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
-swap			value:GAUGE:0:1099511627776
+time_offset		seconds:GAUGE:-1000000:1000000
 users			users:GAUGE:0:65535
-vs_threads		value:GAUGE:0:65535
-vs_processes		value:GAUGE:0:65535
+voltage_threshold	value:GAUGE:U:U, threshold:GAUGE:U:U
+voltage			value:GAUGE:U:U
 vs_memory		value:GAUGE:0:9223372036854775807
-signal_quality		value:GAUGE:0:U
-signal_power		value:GAUGE:U:0
-signal_noise		value:GAUGE:U:0
+vs_processes		value:GAUGE:0:65535
+vs_threads		value:GAUGE:0:65535
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/version-gen.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/version-gen.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.0/version-gen.sh	2007-10-27 17:04:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.2.1/version-gen.sh	2007-11-09 04:54:22.000000000 +0800
@@ -1,9 +1,9 @@
 #!/bin/sh
 
-DEFAULT_VERSION="4.2.0.git"
+DEFAULT_VERSION="4.2.1.git"
 
 VERSION="$( git describe 2> /dev/null | sed -e 's/^collectd-//' )"
 
 if test -z "$VERSION"; then
 	VERSION="$DEFAULT_VERSION"
 fi
