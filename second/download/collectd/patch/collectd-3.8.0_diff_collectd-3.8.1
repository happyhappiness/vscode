diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/ChangeLog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/ChangeLog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/ChangeLog	2006-03-10 05:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/ChangeLog	2006-03-14 05:03:59.000000000 +0800
@@ -1,6 +1,10 @@
+2006-03-13, Version 3.8.1
+	* Fixes for building collectd unter FreeBSD, Mac OS X and Solaris.
+	* Fixes in the debian `postinst' and `init.d' scripts.
+
 2006-03-09, Version 3.8.0
 	* The `ping' plugin no longer uses `libping' but a self written
 	  library named `liboping'. With this library it's possible to ping
 	  multiple IPv4 and IPv6 addresses and hostnames - in parallel.
 
 2006-02-18, Version 3.7.2
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/collectd.spec /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/collectd.spec
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/collectd.spec	2006-03-10 05:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/collectd.spec	2006-03-14 05:03:59.000000000 +0800
@@ -1,9 +1,9 @@
 Summary:	Statistics collection daemon for filling RRD files.
 Name:           collectd
-Version:	3.7.2
+Version:	3.8.1
 Release:	1
 Source:		http://verplant.org/collectd/%{name}-%{version}.tar.gz
 License:	GPL
 Group:		System Environment/Daemons
 BuildRoot:	%{_tmppath}/%{name}-%{version}-root
 BuildPrereq:	lm_sensors-devel, mysqlclient10-devel | mysql-devel, rrdtool-devel
@@ -85,12 +85,15 @@
 %attr(0444,root,root) %{_libdir}/%{name}/mysql.so*
 
 %files sensors
 %attr(0444,root,root) %{_libdir}/%{name}/sensors.so*
 
 %changelog
+* Thu Mar 13 2006 Florian octo Forster <octo@verplant.org> 3.8.1-1
+- New upstream version
+
 * Thu Mar 09 2006 Florian octo Forster <octo@verplant.org> 3.8.0-1
 - New upstream version
 
 * Sat Feb 18 2006 Florian octo Forster <octo@verplant.org> 3.7.2-1
 - Include `tape.so' so the build doesn't terminate because of missing files..
 - New upstream version
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/configure	2006-03-10 05:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/configure	2006-03-14 05:03:59.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.59 for collectd 3.8.0.
+# Generated by GNU Autoconf 2.59 for collectd 3.8.1.
 #
 # Copyright (C) 2003 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
 ## M4sh Initialization.  ##
@@ -418,14 +418,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='collectd'
 PACKAGE_TARNAME='collectd'
-PACKAGE_VERSION='3.8.0'
-PACKAGE_STRING='collectd 3.8.0'
+PACKAGE_VERSION='3.8.1'
+PACKAGE_STRING='collectd 3.8.1'
 PACKAGE_BUGREPORT=''
 
 ac_unique_file="src/collectd.c"
 ac_default_prefix="/opt/collectd"
 # Factoring default headers for most tests.
 ac_includes_default="\
@@ -951,13 +951,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures collectd 3.8.0 to adapt to many kinds of systems.
+\`configure' configures collectd 3.8.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -1017,13 +1017,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of collectd 3.8.0:";;
+     short | recursive ) echo "Configuration of collectd 3.8.1:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -1193,13 +1193,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-collectd configure 3.8.0
+collectd configure 3.8.1
 generated by GNU Autoconf 2.59
 
 Copyright (C) 2003 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -1207,13 +1207,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by collectd $as_me 3.8.0, which was
+It was created by collectd $as_me 3.8.1, which was
 generated by GNU Autoconf 2.59.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1853,13 +1853,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='collectd'
- VERSION='3.8.0'
+ VERSION='3.8.1'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -18756,12 +18756,177 @@
 subdirs="$subdirs libltdl src/libconfig"
 
 
 #
 # Checks for header files.
 #
+echo "$as_me:$LINENO: checking for ANSI C header files" >&5
+echo $ECHO_N "checking for ANSI C header files... $ECHO_C" >&6
+if test "${ac_cv_header_stdc+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_header_stdc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_header_stdc=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <string.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "memchr" >/dev/null 2>&1; then
+  :
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <stdlib.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "free" >/dev/null 2>&1; then
+  :
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+  if test "$cross_compiling" = yes; then
+  :
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <ctype.h>
+#if ((' ' & 0x0FF) == 0x020)
+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#else
+# define ISLOWER(c) \
+		   (('a' <= (c) && (c) <= 'i') \
+		     || ('j' <= (c) && (c) <= 'r') \
+		     || ('s' <= (c) && (c) <= 'z'))
+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
+#endif
+
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int
+main ()
+{
+  int i;
+  for (i = 0; i < 256; i++)
+    if (XOR (islower (i), ISLOWER (i))
+	|| toupper (i) != TOUPPER (i))
+      exit(2);
+  exit (0);
+}
+_ACEOF
+rm -f conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  :
+else
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+( exit $ac_status )
+ac_cv_header_stdc=no
+fi
+rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+fi
+fi
+echo "$as_me:$LINENO: result: $ac_cv_header_stdc" >&5
+echo "${ECHO_T}$ac_cv_header_stdc" >&6
+if test $ac_cv_header_stdc = yes; then
+
+cat >>confdefs.h <<\_ACEOF
+#define STDC_HEADERS 1
+_ACEOF
+
+fi
+
 echo "$as_me:$LINENO: checking for sys/wait.h that is POSIX.1 compatible" >&5
 echo $ECHO_N "checking for sys/wait.h that is POSIX.1 compatible... $ECHO_C" >&6
 if test "${ac_cv_header_sys_wait_h+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat >conftest.$ac_ext <<_ACEOF
@@ -19152,13 +19317,13 @@
 
 fi
 
 fi
 
 
-for ac_header in errno.h
+for ac_header in stdint.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -19301,13 +19466,13 @@
 
 fi
 
 done
 
 
-for ac_header in syslog.h
+for ac_header in errno.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -19450,13 +19615,13 @@
 
 fi
 
 done
 
 
-for ac_header in fcntl.h
+for ac_header in syslog.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -19599,13 +19764,13 @@
 
 fi
 
 done
 
 
-for ac_header in signal.h
+for ac_header in fcntl.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -19748,13 +19913,13 @@
 
 fi
 
 done
 
 
-for ac_header in assert.h
+for ac_header in signal.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -19897,13 +20062,13 @@
 
 fi
 
 done
 
 
-for ac_header in sys/types.h
+for ac_header in assert.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20046,13 +20211,13 @@
 
 fi
 
 done
 
 
-for ac_header in sys/socket.h
+for ac_header in sys/types.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20195,13 +20360,13 @@
 
 fi
 
 done
 
 
-for ac_header in sys/select.h
+for ac_header in sys/socket.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20344,13 +20509,13 @@
 
 fi
 
 done
 
 
-for ac_header in netdb.h
+for ac_header in sys/select.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20493,13 +20658,13 @@
 
 fi
 
 done
 
 
-for ac_header in arpa/inet.h
+for ac_header in netdb.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20642,13 +20807,13 @@
 
 fi
 
 done
 
 
-for ac_header in netinet/in.h
+for ac_header in arpa/inet.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
@@ -20948,26 +21113,525 @@
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo "$as_me:$LINENO: checking for $ac_header" >&5
 echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
 if eval "test \"\${$as_ac_Header+set}\" = set"; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
-fi
-echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
-echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $ac_header usability" >&5
+echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $ac_header presence" >&5
+echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <$ac_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ----------------------------------- ##
+## Report this to the collectd lists.  ##
+## ----------------------------------- ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=\$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+# For ping library
+
+for ac_header in netinet/in_systm.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+
+
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in netinet/in.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+
+
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in netinet/ip.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in netinet/ip_icmp.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in netinet/ip_var.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_Header=no"
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in netinet/ip6.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  # Is the header compilable?
-echo "$as_me:$LINENO: checking $ac_header usability" >&5
-echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
+  cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
-$ac_includes_default
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+
 #include <$ac_header>
 _ACEOF
 rm -f conftest.$ac_objext
 if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
   (eval $ac_compile) 2>conftest.er1
   ac_status=$?
@@ -20985,106 +21649,98 @@
 	 { ac_try='test -s conftest.$ac_objext'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
-  ac_header_compiler=yes
+  eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-ac_header_compiler=no
+eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
-echo "${ECHO_T}$ac_header_compiler" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
 
-# Is the header present?
-echo "$as_me:$LINENO: checking $ac_header presence" >&5
-echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6
-cat >conftest.$ac_ext <<_ACEOF
+fi
+
+done
+
+
+for ac_header in netinet/icmp6.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
 cat confdefs.h >>conftest.$ac_ext
 cat >>conftest.$ac_ext <<_ACEOF
 /* end confdefs.h.  */
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+
+
 #include <$ac_header>
 _ACEOF
-if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
   ac_status=$?
   grep -v '^ *+' conftest.er1 >conftest.err
   rm -f conftest.er1
   cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } >/dev/null; then
-  if test -s conftest.err; then
-    ac_cpp_err=$ac_c_preproc_warn_flag
-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag
-  else
-    ac_cpp_err=
-  fi
-else
-  ac_cpp_err=yes
-fi
-if test -z "$ac_cpp_err"; then
-  ac_header_preproc=yes
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
-  ac_header_preproc=no
+eval "$as_ac_Header=no"
 fi
-rm -f conftest.err conftest.$ac_ext
-echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
-echo "${ECHO_T}$ac_header_preproc" >&6
-
-# So?  What about this header?
-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in
-  yes:no: )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
-echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
-    ac_header_preproc=yes
-    ;;
-  no:yes:* )
-    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
-echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
-echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
-echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
-echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
-echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
-    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
-echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
-    (
-      cat <<\_ASBOX
-## ----------------------------------- ##
-## Report this to the collectd lists.  ##
-## ----------------------------------- ##
-_ASBOX
-    ) |
-      sed "s/^/$as_me: WARNING:     /" >&2
-    ;;
-esac
-echo "$as_me:$LINENO: checking for $ac_header" >&5
-echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
-if eval "test \"\${$as_ac_Header+set}\" = set"; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  eval "$as_ac_Header=\$ac_header_preproc"
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
 echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
-
-fi
 if test `eval echo '${'$as_ac_Header'}'` = yes; then
   cat >>confdefs.h <<_ACEOF
 #define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
 
 fi
@@ -26570,12 +27226,115 @@
 #define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
 _ACEOF
 
 fi
 done
 
+
+for ac_func in getfsstat
+do
+as_ac_var=`echo "ac_cv_func_$ac_func" | $as_tr_sh`
+echo "$as_me:$LINENO: checking for $ac_func" >&5
+echo $ECHO_N "checking for $ac_func... $ECHO_C" >&6
+if eval "test \"\${$as_ac_var+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.
+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */
+#define $ac_func innocuous_$ac_func
+
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func (); below.
+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+    <limits.h> exists even on freestanding compilers.  */
+
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+
+#undef $ac_func
+
+/* Override any gcc2 internal prototype to avoid an error.  */
+#ifdef __cplusplus
+extern "C"
+{
+#endif
+/* We use char because int might match the return type of a gcc2
+   builtin and then its argument prototype would still apply.  */
+char $ac_func ();
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+char (*f) () = $ac_func;
+#endif
+#ifdef __cplusplus
+}
+#endif
+
+int
+main ()
+{
+return f != $ac_func;
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext conftest$ac_exeext
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest$ac_exeext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  eval "$as_ac_var=yes"
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+eval "$as_ac_var=no"
+fi
+rm -f conftest.err conftest.$ac_objext \
+      conftest$ac_exeext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_var'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_var'}'`" >&6
+if test `eval echo '${'$as_ac_var'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+# Check for different versions of `getmntent' here..
 # getmntent is in -lsun on Irix 4, -lseq on Dynix/PTX, -lgen on Unixware.
 echo "$as_me:$LINENO: checking for getmntent in -lsun" >&5
 echo $ECHO_N "checking for getmntent in -lsun... $ECHO_C" >&6
 if test "${ac_cv_lib_sun_getmntent+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
@@ -26876,12 +27635,37 @@
 _ACEOF
 
 fi
 done
 
 
+if test "x$ac_cv_lib_sun_getmntent" = "xyes"
+then
+
+cat >>confdefs.h <<\_ACEOF
+#define HAVE_SUN_GETMNTENT 1
+_ACEOF
+
+fi
+if test "x$ac_cv_lib_seq_getmntent" = "xyes"
+then
+
+cat >>confdefs.h <<\_ACEOF
+#define HAVE_SEQ_GETMNTENT 1
+_ACEOF
+
+fi
+if test "x$ac_cv_lib_gen_getmntent" = "xyes"
+then
+
+cat >>confdefs.h <<\_ACEOF
+#define HAVE_GEN_GETMNTENT 1
+_ACEOF
+
+fi
+
 if test "x$ac_cv_func_getmntent" = "xyes"; then
 	saveCFLAGS="$CFLAGS"
 	CFLAGS="-Wall -Werror $CFLAGS"
 	echo "$as_me:$LINENO: checking whether getmntent takes one argument" >&5
 echo $ECHO_N "checking whether getmntent takes one argument... $ECHO_C" >&6
 if test "${fu_cv_getmntent1+set}" = set; then
@@ -30458,13 +31242,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by collectd $as_me 3.8.0, which was
+This file was extended by collectd $as_me 3.8.1, which was
 generated by GNU Autoconf 2.59.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -30521,13 +31305,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-collectd config.status 3.8.0
+collectd config.status 3.8.1
 configured by $0, generated by GNU Autoconf 2.59,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright (C) 2003 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/configure.in	2006-03-10 05:43:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/configure.in	2006-03-14 05:03:59.000000000 +0800
@@ -1,8 +1,8 @@
 dnl Process this file with autoconf to produce a configure script.
-AC_INIT(collectd, 3.8.0)
+AC_INIT(collectd, 3.8.1)
 AC_CONFIG_SRCDIR(src/collectd.c)
 AC_CONFIG_HEADERS(src/config.h)
 AM_INIT_AUTOMAKE(dist-bzip2)
 AC_LANG(C)
 
 AC_PREFIX_DEFAULT("/opt/collectd")
@@ -27,28 +27,114 @@
 #AC_PROG_RANLIB
 AC_CONFIG_SUBDIRS(libltdl src/libconfig)
 
 #
 # Checks for header files.
 #
+AC_HEADER_STDC
 AC_HEADER_SYS_WAIT
 AC_HEADER_DIRENT
+AC_CHECK_HEADERS(stdint.h)
 AC_CHECK_HEADERS(errno.h)
 AC_CHECK_HEADERS(syslog.h)
 AC_CHECK_HEADERS(fcntl.h)
 AC_CHECK_HEADERS(signal.h)
 AC_CHECK_HEADERS(assert.h)
 AC_CHECK_HEADERS(sys/types.h)
 AC_CHECK_HEADERS(sys/socket.h)
 AC_CHECK_HEADERS(sys/select.h)
 AC_CHECK_HEADERS(netdb.h)
 AC_CHECK_HEADERS(arpa/inet.h)
-AC_CHECK_HEADERS(netinet/in.h)
 AC_CHECK_HEADERS(sys/resource.h)
 AC_CHECK_HEADERS(sys/param.h)
 
+# For ping library
+AC_CHECK_HEADERS(netinet/in_systm.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/in.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/ip.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/ip_icmp.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/ip_var.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/ip6.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+])
+AC_CHECK_HEADERS(netinet/icmp6.h, [], [],
+[#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+])
+
 # For cpu modules
 AC_CHECK_HEADERS(sys/sysctl.h sys/dkstat.h)
 
 # For load module
 AC_CHECK_HEADERS(sys/loadavg.h)
 
@@ -120,13 +206,32 @@
 # For quota module
 AC_CHECK_FUNCS(quotactl)
 AC_CHECK_FUNCS(getgrgid getpwuid)
 
 # For mount interface
 AC_CHECK_FUNCS(getfsent getvfsent listmntent)
+AC_CHECK_FUNCS(getfsstat)
+
+# Check for different versions of `getmntent' here..
 AC_FUNC_GETMNTENT
+if test "x$ac_cv_lib_sun_getmntent" = "xyes"
+then
+	AC_DEFINE(HAVE_SUN_GETMNTENT, 1,
+		  [Define if the function getmntent exists. It's the version from libsun.])
+fi
+if test "x$ac_cv_lib_seq_getmntent" = "xyes"
+then
+	AC_DEFINE(HAVE_SEQ_GETMNTENT, 1,
+		  [Define if the function getmntent exists. It's the version from libseq.])
+fi
+if test "x$ac_cv_lib_gen_getmntent" = "xyes"
+then
+	AC_DEFINE(HAVE_GEN_GETMNTENT, 1,
+		  [Define if the function getmntent exists. It's the version from libgen.])
+fi
+
 if test "x$ac_cv_func_getmntent" = "xyes"; then
 	saveCFLAGS="$CFLAGS"
 	CFLAGS="-Wall -Werror $CFLAGS"
 	AC_CACHE_CHECK([whether getmntent takes one argument],
 		[fu_cv_getmntent1],
 		AC_COMPILE_IFELSE(
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/changelog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/changelog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/changelog	2006-03-10 05:43:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/changelog	2006-03-14 05:04:00.000000000 +0800
@@ -1,6 +1,18 @@
+collectd (3.8.1-1) unstable; urgency=low
+
+  * New upstream version
+
+ -- Florian Forster <octo@verplant.org>  Mon, 13 Mar 2006 21:09:09 +0200
+
+collectd (3.8.0-2) unstable; urgency=low
+
+  * Much improved init script. Thanks to Sebastian for his work :)
+
+ -- Florian Forster <octo@verplant.org>  Sat, 11 Mar 2006 16:09:44 +0200
+
 collectd (3.8.0-1) unstable; urgency=low
 
   * New upstream version
 
  -- Florian Forster <octo@verplant.org>  Thu, 09 Mar 2006 18:18:10 +0200
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/collectd.init.d /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/collectd.init.d
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/collectd.init.d	2006-03-10 05:43:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/collectd.init.d	2006-03-14 05:04:00.000000000 +0800
@@ -1,12 +1,11 @@
-#!/bin/sh
+#!/bin/bash
 #
 # collectd	Initscript for collectd
 #		http://verplant.org/collectd/
-# Author:	Florian Forster <octo@verplant.org>
-# Extended to support multiple running instances of collectd:
+# Authors:	Florian Forster <octo@verplant.org>
 #		Sebastian Harl <sh@tokkee.org>
 #
 
 set -e
 
 PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
@@ -29,37 +28,47 @@
 fi
 
 #
 #	Function that starts the daemon/service.
 #
 d_start() {
-	i=1
+	i=0
 	
-	if [[ ! -d "$CONFIGDIR" && -e "$FALLBACKCONF" ]]
+	if [ ! -d "$CONFIGDIR" -a -e "$FALLBACKCONF" ]
 	then
 		start-stop-daemon --start --quiet --exec $DAEMON \
 			-- -C "$FALLBACKCONF"
 	else
-		echo -n " ("
-		for CONFIG in `cd $CONFIGDIR; ls *.conf 2> /dev/null`; do
-			CONF="$CONFIGDIR/$CONFIG"
-			NAME=${CONFIG%%.conf}
-			PIDFILE=$( grep PIDFile $CONF | awk '{print $2}' )
-
-			if [ 1 != $i ]; then
-				echo -n " "
+		for FILE in `ls $CONFIGDIR/*.conf 2>/dev/null`
+		do
+			NAME=`basename "$FILE" .conf`
+
+			if [ $i == 0 ]
+			then
+				echo -n " (";
+			else
+				echo -n ", ";
+			fi
+			
+			$DAEMON -C "$FILE" 2>/dev/null
+			if [ $? == 0 ]
+			then
+				echo -n "$NAME";
+			else
+				echo -n "$NAME failed";
 			fi
 
-			start-stop-daemon --start --quiet \
-				--pidfile $PIDFILE --startas $DAEMON \
-				-- -C "$CONFIGDIR/$CONFIG"
-			echo -n "$NAME"
-
-			let i++
+			i=$(($i+1))
 		done
-		echo -n ")"
+
+		if [ $i == 0 ]
+		then
+			echo -n "[no config found]";
+		else
+			echo -n ")"
+		fi
 	fi
 }
 
 #
 #	Function that stops the daemon/service.
 #
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/collectd.postinst /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/collectd.postinst
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/collectd.postinst	2006-03-10 05:43:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/collectd.postinst	2006-03-14 05:04:00.000000000 +0800
@@ -16,13 +16,13 @@
 #
 
 case "$1" in
 	configure)
 		[ -d /etc/collectd ] || mkdir -p /etc/collectd
 		
-		if [ -e /etc/collectd.conf && ! -e /etc/collectd/default.conf ]; then
+		if [ -e /etc/collectd.conf -a ! -e /etc/collectd/default.conf ]; then
 			mv /etc/collectd.conf /etc/collectd/default.conf
 		fi
 	;;
 
 	abort-upgrade|abort-remove|abort-deconfigure)
 	;;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/control /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/control
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/debian/control	2006-03-10 05:43:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/debian/control	2006-03-14 05:04:00.000000000 +0800
@@ -5,13 +5,13 @@
 Build-Depends: debhelper (>= 4.0.0), autotools-dev, librrd0-dev | librrd2-dev, libsensors-dev, libmysqlclient14-dev
 Standards-Version: 3.6.1
 
 Package: collectd
 Architecture: any
 Depends: libc6, librrd0 | librrd2
-Suggests: collectd-mysql, collectd-sensors
+Suggests: collectd-mysql, collectd-sensors, librrds-perl
 Description: Statistics collection daemon for filling RRD files.
  collectd is a small daemon written in C for performance. It reads various
  system statistics and updates RRD files, creating them if neccessary. Since
  the daemon doesn't need to startup every time it wants to update the files
  it's very fast and easy on the system. Also, the statistics are very fine
  grained since the files are updated every 10 seconds.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/collectd.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/collectd.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/collectd.1	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/collectd.1	2006-03-14 05:04:01.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD 1"
-.TH COLLECTD 1 "2006-01-29" "3.7.2" "collectd"
+.TH COLLECTD 1 "2006-03-13" "3.8.1" "collectd"
 .SH "NAME"
 collectd \- System statistics collection daemon
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd \fI[options]\fR
 .SH "DESCRIPTION"
@@ -198,15 +198,15 @@
 written in \s-1RRD\s0 files that reside in \fIDataDir\fR. This is the default mode when
 collectd is linked against \f(CW\*(C`librrd\*(C'\fR.
 .PP
 The other two modes, \fBclient mode\fR and \fBserver mode\fR, are used to send data
 over a network and receive it again.
 .PP
-In \fBclient mode\fR the daemon collectd the data locally and send it's result to
-one or more network addresses. No \s-1RRD\s0 files are written in this case. This is
-the only mode available if collectd is not linked against \f(CW\*(C`librrd\*(C'\fR.
+In \fBclient mode\fR the daemon collects the data locally and sends it's results
+to one or more network addresses. No \s-1RRD\s0 files are written in this case. This
+is the only mode available if collectd is not linked against \f(CW\*(C`librrd\*(C'\fR.
 .PP
 If started in \fBserver mode\fR the daemon will listen on one or more interfaces
 and write the data it receives to \s-1RRD\s0 files. No data is collected locally.
 .PP
 Please refer to \fIcollectd.conf\fR\|(5) for the configuration options and default
 values.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/common.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/common.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/common.c	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/common.c	2006-03-14 05:04:01.000000000 +0800
@@ -53,12 +53,15 @@
 }
 
 char *sstrdup (const char *s)
 {
 	char *r;
 
+	if (s == NULL)
+		return (NULL);
+
 	if((r = strdup (s)) == NULL)
 	{
 		DBG ("Not enough memory.");
 		exit(3);
 	}
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/config.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/config.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/config.h.in	2006-03-10 05:43:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/config.h.in	2006-03-14 05:04:00.000000000 +0800
@@ -109,18 +109,24 @@
 /* Define to 1 if you have the <fshelp.h> header file. */
 #undef HAVE_FSHELP_H
 
 /* Define to 1 if you have the <fs_info.h> header file. */
 #undef HAVE_FS_INFO_H
 
+/* Define if the function getmntent exists. It's the version from libgen. */
+#undef HAVE_GEN_GETMNTENT
+
 /* Define to 1 if you have the `getaddrinfo' function. */
 #undef HAVE_GETADDRINFO
 
 /* Define to 1 if you have the `getfsent' function. */
 #undef HAVE_GETFSENT
 
+/* Define to 1 if you have the `getfsstat' function. */
+#undef HAVE_GETFSSTAT
+
 /* Define to 1 if you have the `getgrgid' function. */
 #undef HAVE_GETGRGID
 
 /* Define to 1 if you have the `getloadavg' function. */
 #undef HAVE_GETLOADAVG
 
@@ -220,15 +226,33 @@
 /* Define to 1 if you have the <ndir.h> header file, and it defines `DIR'. */
 #undef HAVE_NDIR_H
 
 /* Define to 1 if you have the <netdb.h> header file. */
 #undef HAVE_NETDB_H
 
+/* Define to 1 if you have the <netinet/icmp6.h> header file. */
+#undef HAVE_NETINET_ICMP6_H
+
 /* Define to 1 if you have the <netinet/in.h> header file. */
 #undef HAVE_NETINET_IN_H
 
+/* Define to 1 if you have the <netinet/in_systm.h> header file. */
+#undef HAVE_NETINET_IN_SYSTM_H
+
+/* Define to 1 if you have the <netinet/ip6.h> header file. */
+#undef HAVE_NETINET_IP6_H
+
+/* Define to 1 if you have the <netinet/ip.h> header file. */
+#undef HAVE_NETINET_IP_H
+
+/* Define to 1 if you have the <netinet/ip_icmp.h> header file. */
+#undef HAVE_NETINET_IP_ICMP_H
+
+/* Define to 1 if you have the <netinet/ip_var.h> header file. */
+#undef HAVE_NETINET_IP_VAR_H
+
 /* Define to 1 if you have the `openlog' function. */
 #undef HAVE_OPENLOG
 
 /* Define to 1 if you have the <paths.h> header file. */
 #undef HAVE_PATHS_H
 
@@ -244,12 +268,15 @@
 /* Define to 1 if you have the `select' function. */
 #undef HAVE_SELECT
 
 /* Define to 1 if you have the <sensors/sensors.h> header file. */
 #undef HAVE_SENSORS_SENSORS_H
 
+/* Define if the function getmntent exists. It's the version from libseq. */
+#undef HAVE_SEQ_GETMNTENT
+
 /* Define to 1 if you have the <signal.h> header file. */
 #undef HAVE_SIGNAL_H
 
 /* Define to 1 if you have the `socket' function. */
 #undef HAVE_SOCKET
 
@@ -304,12 +331,15 @@
 /* Define to 1 if you have the `strstr' function. */
 #undef HAVE_STRSTR
 
 /* Define to 1 if you have the `strtol' function. */
 #undef HAVE_STRTOL
 
+/* Define if the function getmntent exists. It's the version from libsun. */
+#undef HAVE_SUN_GETMNTENT
+
 /* Define to 1 if you have the `sysctlbyname' function. */
 #undef HAVE_SYSCTLBYNAME
 
 /* Define to 1 if you have the `syslog' function. */
 #undef HAVE_SYSLOG
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/liboping/liboping.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/liboping/liboping.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/liboping/liboping.c	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/liboping/liboping.c	2006-03-14 05:04:01.000000000 +0800
@@ -14,40 +14,73 @@
  *
  * You should have received a copy of the GNU General Public License
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
  */
 
-#include <stdlib.h>
-#include <stdio.h>
-#include <unistd.h>
-#include <errno.h>
-#include <string.h>
-
-#include <assert.h>
-
-#include <sys/types.h>
-#include <sys/stat.h>
-#include <fcntl.h>
-
-#include <sys/socket.h>
-#include <netdb.h>
-
-#include <netinet/in_systm.h>
-#include <netinet/in.h>
-#include <netinet/ip.h>
-#include <netinet/ip_icmp.h>
-#ifdef HAVE_NETINET_IP_VAR_H
-# include <netinet/ip_var.h>
+#if HAVE_CONFIG_H
+# include <config.h>
+#endif
+
+#if STDC_HEADERS
+# include <stdlib.h>
+# include <stdio.h>
+# include <string.h>
+# include <errno.h>
+# include <assert.h>
+#else
+# error "You don't have the standard C99 header files installed"
+#endif /* STDC_HEADERS */
+
+#if HAVE_UNISTD_H
+# include <unistd.h>
 #endif
 
-#include <netinet/ip6.h>
-#include <netinet/icmp6.h>
+#if HAVE_FCNTL_H
+# include <fcntl.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_SYS_STAT_H
+# include <sys/stat.h>
+#endif
 
-#include <sys/time.h>
-#include <time.h>
+#if TIME_WITH_SYS_TIME
+# include <sys/time.h>
+# include <time.h>
+#endif
+
+#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
+#if HAVE_NETDB_H
+# include <netdb.h>
+#endif
+
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_IP_ICMP_H
+# include <netinet/ip_icmp.h>
+#endif
+#ifdef HAVE_NETINET_IP_VAR_H
+# include <netinet/ip_var.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+#if HAVE_NETINET_ICMP6_H
+# include <netinet/icmp6.h>
+#endif
 
 #include "liboping.h"
 
 #if DEBUG
 # define dprintf(...) printf ("%s[%4i]: %-20s: ", __FILE__, __LINE__, __FUNCTION__); printf (__VA_ARGS__)
 #else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/liboping/liboping.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/liboping/liboping.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/liboping/liboping.h	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/liboping/liboping.h	2006-03-14 05:04:01.000000000 +0800
@@ -17,14 +17,25 @@
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
  */
 
 #ifndef OCTO_PING_H
 #define OCTO_PING_H 1
 
-#include <stdlib.h>
-#include <unistd.h>
+#if HAVE_CONFIG_H
+# include <config.h>
+#endif
+
+#if HAVE_STDLIB_H
+# include <stdlib.h>
+#endif
+#if HAVE_UNISTD_H
+# include <unistd.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
 
 /*
  * Type definitions
  */
 typedef struct pinghost
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/network.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/network.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/network.c	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/network.c	2006-03-14 05:04:01.000000000 +0800
@@ -36,12 +36,20 @@
 #include "configfile.h"
 #include "utils_debug.h"
 
 /* 1500 - 40 - 8  =  Ethernet packet - IPv6 header - UDP header */
 /* #define BUFF_SIZE 1452 */
 
+#ifndef IPV6_ADD_MEMBERSHIP
+# ifdef IPV6_JOIN_GROUP
+#  define IPV6_ADD_MEMBERSHIP IPV6_JOIN_GROUP
+# else
+#  error "Neither IP_ADD_MEMBERSHIP nor IPV6_JOIN_GROUP is defined"
+# endif
+#endif /* !IP_ADD_MEMBERSHIP */
+
 #define BUFF_SIZE 4096
 
 #ifdef HAVE_LIBRRD
 extern int operating_mode;
 #else
 static int operating_mode = MODE_CLIENT;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/utils_mount.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/utils_mount.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.0/src/utils_mount.c	2006-03-10 05:43:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-3.8.1/src/utils_mount.c	2006-03-14 05:04:01.000000000 +0800
@@ -29,20 +29,49 @@
 #define XFS_SUPER_MAGIC_STR "XFSB"
 #define XFS_SUPER_MAGIC2_STR "BSFX"
 #endif
 #include "utils_debug.h"
 #include "utils_mount.h"
 
-
+#if HAVE_GETFSSTAT
+#  if HAVE_SYS_PARAM_H
+#    include <sys/param.h>
+#  endif
+#  if HAVE_SYS_UCRED_H
+#    include <sys/ucred.h>
+#  endif
+#  if HAVE_SYS_MOUNT_H
+#    include <sys/mount.h>
+#  endif
+#endif /* HAVE_GETMNTINFO */
+
+#if HAVE_MNTENT_H
+#  include <mntent.h>
+#endif
+#if HAVE_SYS_MNTTAB_H
+#  include <sys/mnttab.h>
+#endif
+
+#ifndef MNTTAB
+#  if defined(_PATH_MOUNTED)
+#    define MNTTAB _PATH_MOUNTED
+#  elif defined(MNT_MNTTAB)
+#    define MNTTAB MNT_MNTTAB
+#  elif defined(MNTTABNAME)
+#    define MNTTAB MNTTABNAME
+#  elif defined(KMTAB)
+#    define MNTTAB KMTAB
+#  else
+#    define MNTTAB "/etc/mnttab"
+#  endif
+#endif
 
 /* *** *** *** ********************************************* *** *** *** */
 /* *** *** *** *** *** ***   private functions   *** *** *** *** *** *** */
 /* *** *** *** ********************************************* *** *** *** */
 
-
-
 /* stolen from quota-3.13 (quota-tools) */
 
 #define PROC_PARTITIONS "/proc/partitions"
 #define DEVLABELDIR     "/dev"
 #define UUID   1
 #define VOL    2
@@ -286,59 +315,60 @@
 
 	bad_uuid:
 		DBG("Found an invalid UUID: %s", s);
 	return NULL;
 }
 
-static char *
-get_spec_by_volume_label(const char *s)
+static char *get_spec_by_volume_label(const char *s)
 {
-        return get_spec_by_x(VOL, s);
+        return get_spec_by_x (VOL, s);
 }
 
-static char *
-get_device_name(const char *item)
+static char *get_device_name(const char *optstr)
 {
 	char *rc;
 
-	if(!strncmp(item, "UUID=", 5)) {
-		DBG("TODO: check UUID= code!");
-		rc = get_spec_by_uuid(item + 5);
-	} else if(!strncmp(item, "LABEL=", 6)) {
-		DBG("TODO: check LABEL= code!");
-		rc = get_spec_by_volume_label(item + 6);
-	} else {
-		rc = sstrdup(item);
+	if (optstr == NULL)
+	{
+		return (NULL);
 	}
-	if(!rc) {
-		DBG("Error checking device name: %s", item);
+	else if (strncmp (optstr, "UUID=", 5) == 0)
+	{
+		DBG ("TODO: check UUID= code!");
+		rc = get_spec_by_uuid (optstr + 5);
+	}
+	else if (strncmp (optstr, "LABEL=", 6) == 0)
+	{
+		DBG ("TODO: check LABEL= code!");
+		rc = get_spec_by_volume_label (optstr + 6);
+	}
+	else
+	{
+		rc = sstrdup (optstr);
 	}
-	return rc;
-}
-
-
 
-#if HAVE_GETVFSENT
-static void
-cu_mount_getvfsmnt(FILE *mntf, cu_mount_t **list)
-{
-	DBG("TODO: getvfsmnt");
-	*list = NULL;
+	if(!rc)
+	{
+		DBG ("Error checking device name: optstr = %s", optstr);
+	}
+	return rc;
 }
-#endif /* HAVE_GETVFSENT */
 
-
-
-#if HAVE_LISTMNTENT
-static cu_mount_t *
-cu_mount_listmntent(struct tabmntent *mntlist, cu_mount_t **list)
+/* What weird OS is this..? I can't find any info with google :/ -octo */
+#if HAVE_LISTMNTENT && 0
+static cu_mount_t *cu_mount_listmntent (void)
 {
 	cu_mount_t *last = *list;
 	struct tabmntent *p;
 	struct mntent *mnt;
 
+	struct tabmntent *mntlist;
+	if(listmntent(&mntlist, MNTTAB, NULL, NULL) < 0) {
+		DBG("calling listmntent() failed: %s", strerror(errno));
+	}
+
 	for(p = mntlist; p; p = p->next) {
 		char *loop = NULL, *device = NULL;
 
 		mnt = p->ment;
 		loop = cu_mount_getoptionvalue(mnt->mnt_opts, "loop=");
 		if(loop == NULL) {   /* no loop= mount */
@@ -368,247 +398,245 @@
 		last->type = sstrdup(mnt->mnt_type);
 		last->options = sstrdup(mnt->mnt_opts);
 		last->next = NULL;
 	} /* for(p = mntlist; p; p = p->next) */
 
 	return(last);
-} /* static cu_mount_t *cu_mount_listmntent(struct tabmntent *mntlist,
-	cu_mount_t **list) */
-#endif /* HAVE_LISTMNTENT */
+} /* cu_mount_t *cu_mount_listmntent(void) */
+/* #endif HAVE_LISTMNTENT */
 
+/* 4.4BSD and Mac OS X */
+#elif HAVE_GETFSSTAT
+static cu_mount_t *cu_mount_getfsstat (void)
+{
+	int bufsize;
+	struct statfs *buf;
+
+	int num;
+	int i;
 
+	cu_mount_t *first = NULL;
+	cu_mount_t *last  = NULL;
+	cu_mount_t *new   = NULL;
+
+	/* Get the number of mounted file systems */
+	if ((bufsize = getfsstat (NULL, 0, MNT_NOWAIT)) < 1)
+		return (NULL);
+
+	if ((buf = (struct statfs *) malloc (bufsize * sizeof (struct statfs))) == NULL)
+		return (NULL);
+	memset (buf, '\0', bufsize * sizeof (struct statfs));
 
-#if HAVE_GETMNTENT
-static cu_mount_t *
-cu_mount_getmntent(FILE *mntf, cu_mount_t **list)
+	/* FIXME: If `bufsize' in bytes or structures? */
+	if ((num = getfsstat (buf, bufsize, MNT_NOWAIT)) < 1)
+	{
+		free (buf);
+		return (NULL);
+	}
+
+	for (i = 0; i < num; i++)
+	{
+		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+			break;
+		memset (new, '\0', sizeof (cu_mount_t));
+		
+		/* Copy values from `struct mnttab' */
+		new->dir         = sstrdup (buf[i].f_mntonname);
+		new->spec_device = sstrdup (buf[i].f_mntfromname);
+		new->type        = sstrdup (buf[i].f_fstypename);
+		new->options     = NULL;
+		new->device      = get_device_name (new->options);
+		new->next = NULL;
+
+		/* Append to list */
+		if (first == NULL)
+		{
+			first = new;
+			last  = new;
+		}
+		else
+		{
+			last->next = new;
+			last       = new;
+		}
+	}
+
+	free (buf);
+
+	return (first);
+}
+/* #endif HAVE_GETFSSTAT */
+
+/* Solaris (SunOS 10): int getmntent(FILE *fp, struct mnttab *mp); */
+#elif HAVE_GEN_GETMNTENT
+static cu_mount_t *cu_mount_gen_getmntent (void)
 {
-	cu_mount_t *last = *list;
-#if HAVE_GETMNTENT1
-	struct mntent *mnt = NULL;
-#endif
-#if HAVE_GETMNTENT2
-	struct mntent real_mnt;
-	struct mntent *mnt = &real_mnt;
-#endif
+	struct mnttab mt;
+	FILE *fp;
 
-#if HAVE_GETMNTENT1
-	while((mnt = getmntent(mntf)) != NULL) {
-#endif
-#if HAVE_GETMNTENT2
-	while(getmntent(mntf, &real_mnt) == 0) {
-#endif
-		char *loop = NULL, *device = NULL;
+	cu_mount_t *first = NULL;
+	cu_mount_t *last  = NULL;
+	cu_mount_t *new   = NULL;
 
-#if 0
-		DBG("------------------ BEGIN");
-		DBG("mnt->mnt_fsname %s", mnt->mnt_fsname);
-		DBG("mnt->mnt_dir    %s", mnt->mnt_dir);
-		DBG("mnt->mnt_type   %s", mnt->mnt_type);
-		DBG("mnt->mnt_opts   %s", mnt->mnt_opts);
-		DBG("mnt->mnt_freq   %d", mnt->mnt_freq);
-		DBG("mnt->mnt_passno %d", mnt->mnt_passno);
-#endif
+	if ((fp = fopen (MNTTAB, "r")) == NULL)
+		return (NULL);
 
-		loop = cu_mount_getoptionvalue(mnt->mnt_opts, "loop=");
-		if(loop == NULL) {   /* no loop= mount */
-			device = get_device_name(mnt->mnt_fsname);
-			if(device == NULL) {
-				DBG("can't get devicename for fs (%s) %s (%s)"
-					": ignored", mnt->mnt_type,
-					mnt->mnt_dir, mnt->mnt_fsname);
-				continue;
-			}
-		} else {
-			device = loop;
-		}
+	while (getmntent (fp, &mt) == 0)
+	{
+		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+			break;
+		memset (new, '\0', sizeof (cu_mount_t));
+		
+		/* Copy values from `struct mnttab' */
+		new->dir         = sstrdup (mt.mnt_mountp);
+		new->spec_device = sstrdup (mt.mnt_special);
+		new->type        = sstrdup (mt.mnt_fstype);
+		new->options     = sstrdup (mt.mnt_mntopts);
+		new->device      = get_device_name (new->options);
+		new->next = NULL;
 
-#if 0
-		DBG("device: %s", device);
-		DBG("------------------ END");
-#endif
-		if(*list == NULL) {
-			*list = (cu_mount_t *)smalloc(sizeof(cu_mount_t));
-			last = *list;
-		} else {
-			while(last->next != NULL) { /* is last really last? */
-				last = last->next;
-			}
-			last->next = (cu_mount_t *)smalloc(sizeof(cu_mount_t));
-			last = last->next;
+		/* Append to list */
+		if (first == NULL)
+		{
+			first = new;
+			last  = new;
 		}
-		last->dir = sstrdup(mnt->mnt_dir);
-		last->spec_device = sstrdup(mnt->mnt_fsname);
-		last->device = device;
-		last->type = sstrdup(mnt->mnt_type);
-		last->options = sstrdup(mnt->mnt_opts);
-		last->next = NULL;
-#if HAVE_GETMNTENT2
-	} /* while(getmntent(mntf, &real_mnt) == 0) */
-#endif
-#if HAVE_GETMNTENT1
-	} /* while((mnt = getmntent(mntf)) != NULL) */
-#endif
+		else
+		{
+			last->next = new;
+			last       = new;
+		}
+	}
 
-	return last;
-} /* static cu_mount_t *cu_mount_getmntent(FILE *mntf, cu_mount_t **list) */
-#endif /* HAVE_GETMNTENT */
+	fclose (fp);
 
+	return (first);
+} /* static cu_mount_t *cu_mount_gen_getmntent (void) */
+/* #endif HAVE_GEN_GETMNTENT */
 
+#elif HAVE_SEQ_GETMNTENT
+#warn "This version of `getmntent' hat not yet been implemented!"
+/* #endif HAVE_SEQ_GETMNTENT */
 
-/* *** *** *** ******************************************** *** *** *** */
-/* *** *** *** *** *** ***   public functions   *** *** *** *** *** *** */
-/* *** *** *** ******************************************** *** *** *** */
+#elif HAVE_SUN_GETMNTENT
+#warn "This version of `getmntent' hat not yet been implemented!"
+/* #endif HAVE_SUN_GETMNTENT */
+
+#elif HAVE_GETMNTENT
+static cu_mount_t *cu_mount_getmntent (void)
+{
+	FILE *fp;
+	struct mntent *me;
 
+	cu_mount_t *first = NULL;
+	cu_mount_t *last  = NULL;
+	cu_mount_t *new   = NULL;
 
+	if ((fp = setmntent (MNTTAB, "r")) == NULL)
+		return (NULL);
 
-cu_mount_t *
-cu_mount_getlist(cu_mount_t **list)
-{
-	cu_mount_t *last = NULL;
+	while ((me = getmntent (fp)) != NULL)
+	{
+		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+			break;
+		memset (new, '\0', sizeof (cu_mount_t));
+		
+		/* Copy values from `struct mntent *' */
+		new->dir         = sstrdup (me->mnt_dir);
+		new->spec_device = sstrdup (me->mnt_fsname);
+		new->type        = sstrdup (me->mnt_type);
+		new->options     = sstrdup (me->mnt_opts);
+		new->device      = get_device_name (new->options);
+		new->next        = NULL;
+
+		/* Append to list */
+		if (first == NULL)
+		{
+			first = new;
+			last  = new;
+		}
+		else
+		{
+			last->next = new;
+			last       = new;
+		}
+	}
 
-	/* see lib/mountlist.c of coreutils for all (ugly) details! */
+	endmntent (fp);
 
-/*
-   there are two implementations of getmntent():
-     * one argument getmntent:
-           FILE *setmntent(const char *filename, const char *type);
-           struct mntent *getmntent(FILE *fp);
-           int endmntent(FILE *fp);
-     * two argument getmntent:
-           FILE *fopen(const char *path, const char *mode);
-           int getmntent(FILE *fp, struct mnttab *mnt);
-           int fclose(FILE *fp);
-   and a third (linux/gnu style) version called getmntent_r, which is not used
-   here (enough trouble with the two versions above).
-*/
-#if HAVE_GETMNTENT
-# if HAVE_GETMNTENT1
-#  define setmntent setmntent
-#  define endmntent endmntent
-# else
-#  if HAVE_GETMNTENT2
-#   define setmntent fopen
-#   define endmntent fclose
-#  else
-#   error HAVE_GETMNTENT defined, but neither HAVE_GETMNTENT1 nor HAVE_GETMNTENT2
-#  endif /* HAVE_GETMNTENT2 */
-# endif /* HAVE_GETMNTENT1 */
+	return (first);
+}
 #endif /* HAVE_GETMNTENT */
 
-	/* the indentation is wrong. is there a better way to do this? */
+/* *** *** *** ******************************************** *** *** *** */
+/* *** *** *** *** *** ***   public functions   *** *** *** *** *** *** */
+/* *** *** *** ******************************************** *** *** *** */
 
-#if HAVE_GETMNTENT && defined(_PATH_MOUNTED)
-	{
-	FILE *mntf = NULL;
-	if((mntf = setmntent(_PATH_MOUNTED, "r")) == NULL) {
-		DBG("opening %s failed: %s", _PATH_MOUNTED, strerror(errno));
-#endif
-#if HAVE_GETMNTENT && defined(MNT_MNTTAB)
-	{
-	FILE *mntf = NULL;
-	if((mntf = setmntent(MNT_MNTTAB, "r")) == NULL) {
-		DBG("opening %s failed: %s", MNT_MNTTAB, strerror(errno));
-#endif
-#if HAVE_GETMNTENT && defined(MNTTABNAME)
-	{
-	FILE *mntf = NULL;
-	if((mntf = setmntent(MNTTABNAME, "r")) == NULL) {
-		DBG("opening %s failed: %s", MNTTABNAME, strerror(errno));
-#endif
-#if HAVE_LISTMNTENT
-	{
-	struct tabmntent *mntlist;
-	if(listmntent(&mntlist, KMTAB, NULL, NULL) < 0) {
-		DBG("calling listmntent() failed: %s", strerror(errno));
-#endif
-#if HAVE_GETVFSENT && defined(VFSTAB)
-	/* this is as bad as the next one, read next comment */
-	{
-	FILE *mntf = NULL;
-	if((mntf = fopen(VFSTAB, "r")) == NULL) {
-		DBG("opening %s failed: %s", VFSTAB, strerror(errno));
-#endif
-#if HAVE_GETMNTENT && defined(_PATH_MNTTAB)
-	/* _PATH_MNTTAB is usually /etc/fstab and so this should be really
-	   the very last thing to try, because it does not provide a list
-	   of currently mounted filesystems... */
-	{
-	FILE *mntf = NULL;
-	if((mntf = setmntent(_PATH_MNTTAB, "r")) == NULL) {
-		DBG("opening %s failed: %s", _PATH_MNTTAB, strerror(errno));
-#endif
+cu_mount_t *cu_mount_getlist(cu_mount_t **list)
+{
+	cu_mount_t *new;
+	cu_mount_t *first = NULL;
+	cu_mount_t *last  = NULL;
 
-	/* give up */
-	DBG("failed get local mountpoints");
-	return(NULL);
-
-#if HAVE_GETMNTENT && defined(_PATH_MNTTAB)
-	} else { last = cu_mount_getmntent(mntf, list); }
-	(void)endmntent(mntf);
-	}
-#endif
-#if HAVE_GETVFSENT && defined(VFSTAB)
-	} else { last = cu_mount_getvfsmnt(mntf, list); }
-	(void)fclose(mntf);
-	}
-#endif
-#if HAVE_LISTMNTENT
-	} else { last = cu_mount_listmntent(mntlist, list); }
-	freemntlist(mntlist);
-	}
-#endif
-#if HAVE_GETMNTENT && defined(MNTTABNAME)
-	} else { last = cu_mount_getmntent(mntf, list); }
-	(void)endmntent(mntf);
+	if (list == NULL)
+		return (NULL);
+
+	if (*list != NULL)
+	{
+		first = *list;
+		last  =  first;
+		while (last->next != NULL)
+			last = last->next;
 	}
+
+#if HAVE_LISTMNTENT && 0
+	new = cu_mount_listmntent ();
+#elif HAVE_GETFSSTAT
+	new = cu_mount_getfsstat ();
+#elif HAVE_GEN_GETMNTENT
+	new = cu_mount_gen_getmntent ();
+#elif HAVE_GETMNTENT
+	new = cu_mount_getmntent ();
+#else
+	new = NULL;
 #endif
-#if HAVE_GETMNTENT && defined(MNT_MNTTAB)
-	} else { last = cu_mount_getmntent(mntf, list); }
-	(void)endmntent(mntf);
+
+	if (first != NULL)
+	{
+		last->next = new;
 	}
-#endif
-#if HAVE_GETMNTENT && defined(_PATH_MOUNTED)
-	} else { last = cu_mount_getmntent(mntf, list); }
-	(void)endmntent(mntf);
+	else
+	{
+		first = new;
+		last  = new;
+		*list = first;
 	}
-#endif
-	return(last);
-} /* cu_mount_t *cu_mount_getlist(cu_mount_t **list) */
 
+	while ((last != NULL) && (last->next != NULL))
+		last = last->next;
 
+	return (last);
+} /* cu_mount_t *cu_mount_getlist(cu_mount_t **list) */
 
-void
-cu_mount_freelist(cu_mount_t *list)
+void cu_mount_freelist (cu_mount_t *list)
 {
-	cu_mount_t *l = list, *p = NULL;
-
-	while(l != NULL) {
-		while(l->next != NULL) {
-			p = l;
-			l = l->next;
-		}
-		if(p != NULL) {
-			p->next = NULL;
-		}
-		sfree(l->dir);
-		sfree(l->spec_device);
-		sfree(l->device);
-		sfree(l->type);
-		sfree(l->options);
-		p = NULL;
-		if(l != list) {
-			sfree(l);
-			l = list;
-		} else {
-			sfree(l);
-			l = NULL; /* done by sfree already */
-		}
-	} /* while(l != NULL) */
-} /* void cu_mount_freelist(cu_mount_t *list) */
+	cu_mount_t *this;
+	cu_mount_t *next;
 
+	for (this = list; this != NULL; this = next)
+	{
+		next = this->next;
 
+		sfree (this->dir);
+		sfree (this->spec_device);
+		sfree (this->device);
+		sfree (this->type);
+		sfree (this->options);
+		sfree (this);
+	}
+} /* void cu_mount_freelist(cu_mount_t *list) */
 
 char *
 cu_mount_checkoption(char *line, char *keyword, int full)
 {
 	char *line2, *l2;
 	int l = strlen(keyword);
