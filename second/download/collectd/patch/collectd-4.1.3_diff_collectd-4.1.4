diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/ChangeLog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/ChangeLog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/ChangeLog	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/ChangeLog	2007-11-08 22:00:28.000000000 +0800
@@ -1,6 +1,16 @@
+2007-11-08, Version 4.1.4
+	* Build system: Improve detection of the rrd library, especially if
+	  it's in a non-standard location.
+	* Build system: A bug when parsing the argument for
+	  `--with-libnetsnmp' has been fixed.
+	* collectd: Implement `strerror_r' if the libc doesn't provide it.
+	* rrdtool plugin: Fix a bug in the shutdown sequence that might cause
+	  a deadlock or delay when shutting down the daemon.
+	* snmp plugin: Fix a memory leak.
+
 2007-10-24, Version 4.1.3
 	* collectd: A build issue under Solaris has been resolved by renaming
 	  data types.
 	* rrdtool plugin: Use the threadsafe RRD-library if available. Try to
 	  be more threadsafe otherwise by locking calls to the library.
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/configure	2007-10-25 02:58:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/configure	2007-11-09 00:42:58.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.61 for collectd 4.1.3.
+# Generated by GNU Autoconf 2.61 for collectd 4.1.4.
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
 # gives unlimited permission to copy, distribute and modify it.
 ## --------------------- ##
@@ -723,14 +723,14 @@
 MAKEFLAGS=
 SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='collectd'
 PACKAGE_TARNAME='collectd'
-PACKAGE_VERSION='4.1.3'
-PACKAGE_STRING='collectd 4.1.3'
+PACKAGE_VERSION='4.1.4'
+PACKAGE_STRING='collectd 4.1.4'
 PACKAGE_BUGREPORT=''
 
 ac_unique_file="src/collectd.c"
 ac_default_prefix="/opt/collectd"
 # Factoring default headers for most tests.
 ac_includes_default="\
@@ -1552,13 +1552,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures collectd 4.1.3 to adapt to many kinds of systems.
+\`configure' configures collectd 4.1.4 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -1622,13 +1622,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of collectd 4.1.3:";;
+     short | recursive ) echo "Configuration of collectd 4.1.4:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -1806,13 +1806,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-collectd configure 4.1.3
+collectd configure 4.1.4
 generated by GNU Autoconf 2.61
 
 Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -1820,13 +1820,13 @@
   exit
 fi
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by collectd $as_me 4.1.3, which was
+It was created by collectd $as_me 4.1.4, which was
 generated by GNU Autoconf 2.61.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 exec 5>>config.log
@@ -2493,13 +2493,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='collectd'
- VERSION='4.1.3'
+ VERSION='4.1.4'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -30147,16 +30147,16 @@
 else
   with_rrdtool="yes"
 fi
 
 if test "x$with_rrdtool" = "xyes"
 then
-	SAVE_CFLAGS="$CFLAGS"
+	SAVE_CPPFLAGS="$CPPFLAGS"
 	SAVE_LDFLAGS="$LDFLAGS"
 
-	CFLAGS="$CFLAGS $librrd_cflags"
+	CPPFLAGS="$CPPFLAGS $librrd_cflags"
 	LDFLAGS="$LDFLAGS $librrd_ldflags"
 
 
 for ac_header in rrd.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
@@ -30296,17 +30296,23 @@
   with_rrdtool="no (rrd.h not found)"
 fi
 
 done
 
 
-	CFLAGS="$SAVE_CFLAGS"
+	CPPFLAGS="$SAVE_CPPFLAGS"
 	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_rrdtool" = "xyes"
 then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+
+	CPPFLAGS="$CPPFLAGS $librrd_cflags"
+	LDFLAGS="$LDFLAGS $librrd_ldflags"
+
 	{ echo "$as_me:$LINENO: checking for rrd_update_r in -lrrd_th" >&5
 echo $ECHO_N "checking for rrd_update_r in -lrrd_th... $ECHO_C" >&6; }
 if test "${ac_cv_lib_rrd_th_rrd_update_r+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
@@ -30441,12 +30447,15 @@
 fi
 
 
 	-lm
 fi
 
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_rrdtool" = "xyes"
 then
 	BUILD_WITH_LIBRRD_CFLAGS="$librrd_cflags"
 	BUILD_WITH_LIBRRD_LDFLAGS="$librrd_ldflags"
 
@@ -33318,13 +33327,13 @@
 # Check whether --with-libnetsnmp was given.
 if test "${with_libnetsnmp+set}" = set; then
   withval=$with_libnetsnmp;
  	if test "x$withval" = "xno"
 	then
 		with_libnetsnmp="no"
-	else if "x$withval" = "xyes"
+	else if test "x$withval" = "xyes"
 	then
 		with_libnetsnmp="yes"
 	else
 	       	if test -x "$withval"
 		then
 			with_snmp_config="$withval"
@@ -37581,13 +37590,13 @@
 exec 6>&1
 
 # Save the log message, to keep $[0] and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by collectd $as_me 4.1.3, which was
+This file was extended by collectd $as_me 4.1.4, which was
 generated by GNU Autoconf 2.61.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -37634,13 +37643,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-collectd config.status 4.1.3
+collectd config.status 4.1.4
 configured by $0, generated by GNU Autoconf 2.61,
   with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright (C) 2006 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/configure.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/configure.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/configure.in	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/configure.in	2007-11-08 22:00:22.000000000 +0800
@@ -680,25 +680,31 @@
 		librrd_ldflags="-L$withval/lib"
 		with_rrdtool="yes"
 	fi
 ], [with_rrdtool="yes"])
 if test "x$with_rrdtool" = "xyes"
 then
-	SAVE_CFLAGS="$CFLAGS"
+	SAVE_CPPFLAGS="$CPPFLAGS"
 	SAVE_LDFLAGS="$LDFLAGS"
 
-	CFLAGS="$CFLAGS $librrd_cflags"
+	CPPFLAGS="$CPPFLAGS $librrd_cflags"
 	LDFLAGS="$LDFLAGS $librrd_ldflags"
 
 	AC_CHECK_HEADERS(rrd.h,, [with_rrdtool="no (rrd.h not found)"])
 
-	CFLAGS="$SAVE_CFLAGS"
+	CPPFLAGS="$SAVE_CPPFLAGS"
 	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_rrdtool" = "xyes"
 then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+
+	CPPFLAGS="$CPPFLAGS $librrd_cflags"
+	LDFLAGS="$LDFLAGS $librrd_ldflags"
+
 	AC_CHECK_LIB(rrd_th, rrd_update_r,
 	[with_rrdtool="yes"
 	 librrd_ldflags="$librrd_ldflags -lrrd_th -lm"
 	],
 	[librrd_threadsafe="no"
 	 AC_CHECK_LIB(rrd, rrd_update,
@@ -706,12 +712,15 @@
 	  librrd_ldflags="$librrd_ldflags -lrrd -lm"
 	 ],
 	 [with_rrdtool="no (symbol 'rrd_update' not found)"],
 	 [-lm])
 	]
 	[-lm])
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_rrdtool" = "xyes"
 then
 	BUILD_WITH_LIBRRD_CFLAGS="$librrd_cflags"
 	BUILD_WITH_LIBRRD_LDFLAGS="$librrd_ldflags"
 	AC_SUBST(BUILD_WITH_LIBRRD_CFLAGS)
@@ -1254,13 +1263,13 @@
 with_snmp_libs=""
 AC_ARG_WITH(libnetsnmp, [AS_HELP_STRING([--with-libnetsnmp@<:@=PREFIX@:>@], [Path to the Net-SNMPD library.])],
 [
  	if test "x$withval" = "xno"
 	then
 		with_libnetsnmp="no"
-	else if "x$withval" = "xyes"
+	else if test "x$withval" = "xyes"
 	then
 		with_libnetsnmp="yes"
 	else
 	       	if test -x "$withval"
 		then
 			with_snmp_config="$withval"
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib: exec-munin.conf
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib: exec-munin.px
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/contrib/PerlLib/Collectd.pm /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib/PerlLib/Collectd.pm
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/contrib/PerlLib/Collectd.pm	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib/PerlLib/Collectd.pm	2007-11-08 22:00:28.000000000 +0800
@@ -41,12 +41,12 @@
 	push @{$EXPORT_TAGS{'all'}}, grep {! $seen{$_}++ } @{$EXPORT_TAGS{$_}}
 		foreach keys %EXPORT_TAGS;
 }
 
 Exporter::export_ok_tags('all');
 
-bootstrap Collectd "4.1.3";
+bootstrap Collectd "4.1.4";
 
 1;
 
 # vim: set sw=4 ts=4 tw=78 noexpandtab :
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/contrib/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/contrib/README	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/contrib/README	2007-11-08 22:00:22.000000000 +0800
@@ -35,12 +35,21 @@
   Starting with version 4, collection.cgi requires a small config file, which
 should look something like this:
 
   datadir: "/var/lib/collectd/rrd/"
   libdir: "/usr/lib/collectd/"
 
+exec-munin.px
+-------------
+  Script to be used with the exec-plugin (see collectd-exec(5) for details)
+which executes munin plugins, parses the output and translates it to a format
+the exec-plugin understands. The features are limited - changing the munin
+plugins to use the output format understood by the exec-plugin is recommended.
+See the embedded POD documentation for more details:
+ $ perldoc contrib/exec-munin.px
+
 extractDS.px
 ------------
   Creates a new RRD-file with only one data-source (DS) of the source-RRD-
 file. That is very handy when you realise that you have bundled up DSes in one
 RRD-file that should have been in multiple RRD-files instead. Is is used by
 `migrate-3-4.px' to split up the cpu-, nfs-, swap-files and possibly others.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/README	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/README	2007-11-08 22:00:22.000000000 +0800
@@ -303,12 +303,35 @@
 
   * CoreFoundation.framework and IOKit.framework
     For compiling on Darwin in general and the `apple_sensors' plugin in
     particular.
 
 
+Configuring / Compiling / Installing
+------------------------------------
+
+  To configure, build and install collectd with the default settings, run
+  `./configure && make && make install'.  For detailed, generic instructions
+  see INSTALL. For a complete list of configure options and their description,
+  run `./configure --help'.
+  
+  By default, the configure script will check for all build dependencies and
+  disable all plugins whose requirements cannot be fulfilled (any other plugin
+  will be enabled). To enable a plugin, install missing dependencies (see
+  section `Prerequisites' above) and rerun `configure'. If you specify the
+  `--enable-<plugin>' configure option, you can force the plugin to be built.
+  This will most likely fail though unless you're working in a very unusual
+  setup and you really know what you're doing.
+
+  By default, collectd will be installed into `/opt/collectd'. You can adjust
+  this setting by specifying the `--prefix' configure option - see INSTALL for
+  details. If you pass DESTDIR=<path> to `make install', <path> will be
+  prefixed to all installation directories. This might be useful when creating
+  packages for collectd.
+
+
 Crosscompiling
 --------------
 
   To compile correctly collectd needs to be able to initialize static
   variables to NAN (Not A Number). Some C libraries, especially the GNU
   libc, have a problem with that.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/apcups.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/apcups.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/apcups.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/apcups.c	2007-11-01 07:59:58.000000000 +0800
@@ -133,13 +133,13 @@
 	ai_hints.ai_socktype = SOCK_STREAM;
 
 	status = getaddrinfo (host, port_str, &ai_hints, &ai_return);
 	if (status != 0)
 	{
 		char errbuf[1024];
-		DEBUG ("getaddrinfo failed: %s",
+		INFO ("getaddrinfo failed: %s",
 				(status == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
 				: gai_strerror (status));
 		return (-1);
 	}
 
@@ -164,13 +164,13 @@
 
 	freeaddrinfo (ai_return);
 
 	if (status != 0) /* `connect(2)' failed */
 	{
 		char errbuf[1024];
-		DEBUG ("connect failed: %s",
+		INFO ("connect failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		close (sd);
 		return (-1);
 	}
 
 	DEBUG ("Done opening a socket %i", sd);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.1	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.1	2007-11-09 01:31:15.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD 1"
-.TH COLLECTD 1 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD 1 "2007-10-24" "4.1.4" "collectd"
 .SH "NAME"
 collectd \- System statistics collection daemon
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd \fI[options]\fR
 .SH "DESCRIPTION"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.conf.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.conf.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.conf.5	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.conf.5	2007-11-09 01:31:16.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD.CONF 5"
-.TH COLLECTD.CONF 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD.CONF 5 "2007-11-08" "4.1.4" "collectd"
 .SH "NAME"
 collectd.conf \- Configuration for the system statistics collection daemon \fBcollectd\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 3
 \&  BaseDir "/path/to/data/"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-email.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-email.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-email.5	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-email.5	2007-11-09 01:31:16.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EMAIL 5"
-.TH COLLECTD-EMAIL 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-EMAIL 5 "2007-10-24" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-email \- Documentation of collectd's \f(CW\*(C`email plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-exec.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-exec.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-exec.5	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-exec.5	2007-11-09 01:31:16.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EXEC 5"
-.TH COLLECTD-EXEC 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-EXEC 5 "2007-11-08" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-exec \- Documentation of collectd's \f(CW\*(C`exec plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 7
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd.h	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd.h	2007-11-01 07:59:58.000000000 +0800
@@ -150,15 +150,12 @@
 #endif
 
 #if HAVE_KSTAT_H
 # include <kstat.h>
 #endif
 
-#if HAVE_RRD_H
-# include <rrd.h>
-#endif
 #if HAVE_PTH_H
 # include <pth.h>
 #endif
 #if HAVE_STATGRAB_H
 # include <statgrab.h>
 #endif
@@ -195,17 +192,12 @@
 #endif
 
 #ifndef PLUGINDIR
 #define PLUGINDIR PREFIX "/lib/" PACKAGE_NAME
 #endif
 
-#define MODE_SERVER 0x01
-#define MODE_CLIENT 0x02
-#define MODE_LOCAL  0x04
-#define MODE_LOG    0x08
-
 #ifndef COLLECTD_GRP_NAME
 # define COLLECTD_GRP_NAME "collectd"
 #endif
 
 #define STATIC_ARRAY_LEN(array) (sizeof (array) / sizeof ((array)[0]))
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-nagios.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-nagios.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-nagios.1	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-nagios.1	2007-11-09 01:31:16.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-NAGIOS 1"
-.TH COLLECTD-NAGIOS 1 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-NAGIOS 1 "2007-10-27" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-nagios \- Nagios plugin for querying collectd
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 collectd-nagios \fB\-s\fR \fIsocket\fR \fB\-n\fR \fIvalue_spec\fR \fB\-H\fR \fIhostname\fR \fI[options]\fR
 .SH "DESCRIPTION"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-perl.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-perl.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-perl.5	2007-10-25 03:05:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-perl.5	2007-11-09 01:31:18.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-PERL 5"
-.TH COLLECTD-PERL 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-PERL 5 "2007-11-08" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-perl \- Documentation of collectd's \f(CW\*(C`perl plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-snmp.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-snmp.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-snmp.5	2007-10-25 03:05:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-snmp.5	2007-11-09 01:31:18.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-SNMP 5"
-.TH COLLECTD-SNMP 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-SNMP 5 "2007-11-08" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-snmp \- Documentation of collectd's \f(CW\*(C`snmp plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 21
 \&  LoadPlugin snmp
@@ -161,13 +161,13 @@
 .Vb 21
 \&    <Host "some.switch.mydomain.org">
 \&      Address "192.168.0.2"
 \&      Version 1
 \&      Community "community_string"
 \&      Collect "std_traffic"
-\&      Inverval 120
+\&      Interval 120
 \&    </Host>
 \&    <Host "some.server.mydomain.org">
 \&      Address "192.168.0.42"
 \&      Version 2
 \&      Community "another_string"
 \&      Collect "std_traffic" "hr_users"
@@ -194,15 +194,14 @@
 and ten threads are used.
 .SH "CONFIGURATION"
 .IX Header "CONFIGURATION"
 Since the aim of the \f(CW\*(C`snmp plugin\*(C'\fR is to provide a generic interface to \s-1SNMP\s0,
 it's configuration is not trivial and may take some time.
 .PP
-Since the \f(CW\*(C`Net\-SNMP\*(C'\fR library is used you cann use all the environment
-variables that are interpreted by that package. See \fIsnmpcmd\fR\|(1) for more
-details.
+Since the \f(CW\*(C`Net\-SNMP\*(C'\fR library is used you can use all the environment variables
+that are interpreted by that package. See \fIsnmpcmd\fR\|(1) for more details.
 .PP
 There are two types of blocks that can be contained in the
 \&\f(CW\*(C`<Plugin\ snmp>\*(C'\fR block: \fBData\fR and \fBHost\fR:
 .Sh "The \fBData\fP block"
 .IX Subsection "The Data block"
 The \fBData\fR block defines a list of values or a table of values that are to be
@@ -285,13 +284,13 @@
 stored by collectd.
 .IP "\fBAddress\fR \fIIP-Address\fR|\fIHostname\fR" 4
 .IX Item "Address IP-Address|Hostname"
 Set the address to connect to.
 .IP "\fBVersion\fR \fB1\fR|\fB2\fR" 4
 .IX Item "Version 1|2"
-Set the \s-1SNMP\s0 version to use. When giving \fB2\fR version 2c is actually used.
+Set the \s-1SNMP\s0 version to use. When giving \fB2\fR version \f(CW\*(C`2c\*(C'\fR is actually used.
 Version 3 is not supported by this plugin.
 .IP "\fBCommunity\fR \fICommunity\fR" 4
 .IX Item "Community Community"
 Pass \fICommunity\fR to the host.
 .IP "\fBCollect\fR \fIData\fR [\fIData\fR ...]" 4
 .IX Item "Collect Data [Data ...]"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-unixsock.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-unixsock.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/collectd-unixsock.5	2007-10-25 03:05:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/collectd-unixsock.5	2007-11-09 01:31:18.000000000 +0800
@@ -126,13 +126,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-UNIXSOCK 5"
-.TH COLLECTD-UNIXSOCK 5 "2007-10-24" "4.1.3" "collectd"
+.TH COLLECTD-UNIXSOCK 5 "2007-11-08" "4.1.4" "collectd"
 .SH "NAME"
 collectd\-unixsock \- Documentation of collectd's \f(CW\*(C`unixsock plugin\*(C'\fR
 .SH "SYNOPSIS"
 .IX Header "SYNOPSIS"
 .Vb 8
 \&  # See collectd.conf(5)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/common.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/common.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/common.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/common.c	2007-10-27 17:09:25.000000000 +0800
@@ -45,12 +45,16 @@
 #endif
 
 #if !HAVE_GETPWNAM_R
 static pthread_mutex_t getpwnam_r_lock = PTHREAD_MUTEX_INITIALIZER;
 #endif
 
+#if !HAVE_STRERROR_R
+static pthread_mutex_t strerror_r_lock = PTHREAD_MUTEX_INITIALIZER;
+#endif
+
 void sstrncpy (char *d, const char *s, int len)
 {
 	strncpy (d, s, len);
 	d[len - 1] = '\0';
 }
 
@@ -73,26 +77,41 @@
 /* Even though Posix requires "strerror_r" to return an "int",
  * some systems (e.g. the GNU libc) return a "char *" _and_
  * ignore the second argument ... -tokkee */
 char *sstrerror (int errnum, char *buf, size_t buflen)
 {
 	buf[0] = '\0';
-#ifdef STRERROR_R_CHAR_P
+
+#if !HAVE_STRERROR_R
+	{
+		char *temp;
+
+		pthread_mutex_lock (&strerror_r_lock);
+
+		temp = strerror (errnum);
+		strncpy (buf, temp, buflen);
+
+		pthread_mutex_unlock (&strerror_r_lock);
+	}
+/* #endif !HAVE_STRERROR_R */
+
+#elif STRERROR_R_CHAR_P
 	{
 		char *temp;
 		temp = strerror_r (errnum, buf, buflen);
 		if (buf[0] == '\0')
 		{
 			if ((temp != NULL) && (temp != buf) && (temp[0] != '\0'))
 				strncpy (buf, temp, buflen);
 			else
 				strncpy (buf, "strerror_r did not return "
 						"an error message", buflen);
-			buf[buflen - 1] = '\0';
 		}
 	}
+/* #endif STRERROR_R_CHAR_P */
+
 #else
 	if (strerror_r (errnum, buf, buflen) != 0)
 	{
 		snprintf (buf, buflen, "Error #%i; "
 				"Additionally, strerror_r failed.",
 				errnum);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/exec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/exec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/exec.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/exec.c	2007-11-08 22:00:13.000000000 +0800
@@ -292,12 +292,13 @@
   if (fh == NULL)
   {
     char errbuf[1024];
     ERROR ("exec plugin: fdopen (%i) failed: %s", fd,
 	sstrerror (errno, errbuf, sizeof (errbuf)));
     kill (pl->pid, SIGTERM);
+    pl->pid = 0;
     close (fd);
     pthread_exit ((void *) 1);
   }
 
   while (fgets (buffer, sizeof (buffer), fh) != NULL)
   {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/hddtemp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/hddtemp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/hddtemp.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/hddtemp.c	2007-11-01 07:59:58.000000000 +0800
@@ -141,13 +141,13 @@
 		}
 
 		/* connect to the hddtemp daemon */
 		if (connect (fd, (struct sockaddr *) ai_ptr->ai_addr, ai_ptr->ai_addrlen))
 		{
 			char errbuf[1024];
-			DEBUG ("hddtemp: connect (%s, %s): %s", host, port,
+			INFO ("hddtemp: connect (%s, %s): %s", host, port,
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			close (fd);
 			fd = -1;
 			continue;
 		}
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/mbmon.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/mbmon.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/mbmon.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/mbmon.c	2007-11-01 07:59:58.000000000 +0800
@@ -129,13 +129,13 @@
 		}
 
 		/* connect to the mbmon daemon */
 		if (connect (fd, (struct sockaddr *) ai_ptr->ai_addr, ai_ptr->ai_addrlen))
 		{
 			char errbuf[1024];
-			DEBUG ("mbmon: connect (%s, %s): %s", host, port,
+			INFO ("mbmon: connect (%s, %s): %s", host, port,
 					sstrerror (errno, errbuf,
 						sizeof (errbuf)));
 			close (fd);
 			fd = -1;
 			continue;
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/ntpd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/ntpd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/ntpd.c	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/ntpd.c	2007-11-01 07:59:58.000000000 +0800
@@ -490,13 +490,13 @@
 		if ((status < 0) && ((errno == EAGAIN) || (errno == EINTR)))
 			continue;
 
 		if (status < 0)
 		{
 			char errbuf[1024];
-			DEBUG ("recv(2) failed: %s",
+			INFO ("recv(2) failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			DEBUG ("Closing socket #%i", sd);
 			close (sd);
 			sock_descr = sd = -1;
 			return (-1);
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/plugin.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/plugin.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/plugin.h	2007-10-25 01:21:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/plugin.h	2007-11-08 22:00:07.000000000 +0800
@@ -190,13 +190,17 @@
 
 void plugin_log (int level, const char *format, ...);
 #define ERROR(...)   plugin_log (LOG_ERR,     __VA_ARGS__)
 #define WARNING(...) plugin_log (LOG_WARNING, __VA_ARGS__)
 #define NOTICE(...)  plugin_log (LOG_NOTICE,  __VA_ARGS__)
 #define INFO(...)    plugin_log (LOG_INFO,    __VA_ARGS__)
-#define DEBUG(...)   plugin_log (LOG_DEBUG,   __VA_ARGS__)
+#if COLLECT_DEBUG
+# define DEBUG(...)  plugin_log (LOG_DEBUG,   __VA_ARGS__)
+#else /* COLLECT_DEBUG */
+# define DEBUG(...)  /* noop */
+#endif /* ! COLLECT_DEBUG */
 
 /* TODO: Move plugin_{complain,relief} into `utils_complain.[ch]'. -octo */
 void plugin_complain (int level, complain_t *c, const char *format, ...);
 void plugin_relief (int level, complain_t *c, const char *format, ...);
 
 const data_set_t *plugin_get_ds (const char *name);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/rrdtool.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/rrdtool.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/rrdtool.c	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/rrdtool.c	2007-11-08 22:00:22.000000000 +0800
@@ -21,12 +21,14 @@
 
 #include "collectd.h"
 #include "plugin.h"
 #include "common.h"
 #include "utils_avltree.h"
 
+#include <rrd.h>
+
 #if HAVE_PTHREAD_H
 # include <pthread.h>
 #endif
 
 /*
  * Private types
@@ -1048,25 +1050,25 @@
 static int rrd_shutdown (void)
 {
 	pthread_mutex_lock (&cache_lock);
 	rrd_cache_flush (-1);
 	pthread_mutex_unlock (&cache_lock);
 
+	pthread_mutex_lock (&queue_lock);
+	do_shutdown = 1;
+	pthread_cond_signal (&queue_cond);
+	pthread_mutex_unlock (&queue_lock);
+
 	/* Wait for all the values to be written to disk before returning. */
 	if (queue_thread != 0)
 	{
 		pthread_join (queue_thread, NULL);
 		queue_thread = 0;
 		DEBUG ("rrdtool plugin: queue_thread exited.");
 	}
 
-	pthread_mutex_lock (&queue_lock);
-	do_shutdown = 1;
-	pthread_cond_signal (&queue_cond);
-	pthread_mutex_unlock (&queue_lock);
-
 	return (0);
 } /* int rrd_shutdown */
 
 static int rrd_init (void)
 {
 	int status;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/snmp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/snmp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/snmp.c	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/snmp.c	2007-11-08 22:00:29.000000000 +0800
@@ -590,30 +590,16 @@
 } /* int csnmp_config */
 
 /* End of the config stuff. Now the interesting part begins */
 
 static void csnmp_host_close_session (host_definition_t *host)
 {
-  int status;
-
   if (host->sess_handle == NULL)
     return;
 
-  status = snmp_sess_close (host->sess_handle);
-
-  if (status != 0)
-  {
-    char *errstr = NULL;
-
-    snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
-
-    ERROR ("snmp plugin: host %s: snmp_sess_close failed: %s",
-	host->name, (errstr == NULL) ? "Unknown problem" : errstr);
-    sfree (errstr);
-  }
-
+  snmp_sess_close (host->sess_handle);
   host->sess_handle = NULL;
 } /* void csnmp_host_close_session */
 
 static void csnmp_host_open_session (host_definition_t *host)
 {
   struct snmp_session sess;
@@ -845,47 +831,68 @@
       break;
     }
 
     for (i = 0; i < oid_list_len; i++)
       snmp_add_null_var (req, oid_list[i].oid, oid_list[i].oid_len);
 
+    res = NULL;
     status = snmp_sess_synch_response (host->sess_handle, req, &res);
 
-    if (status != STAT_SUCCESS)
+    if ((status != STAT_SUCCESS) || (res == NULL))
     {
       char *errstr = NULL;
 
       snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
       ERROR ("snmp plugin: host %s: snmp_sess_synch_response failed: %s",
 	  host->name, (errstr == NULL) ? "Unknown problem" : errstr);
+
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
+      sfree (errstr);
       csnmp_host_close_session (host);
 
       status = -1;
       break;
     }
     status = 0;
     assert (res != NULL);
 
     vb = res->variables;
     if (vb == NULL)
     {
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
       status = -1;
       break;
     }
 
     /* Check if we left the subtree */
     if (snmp_oid_ncompare (data->instance.oid.oid, data->instance.oid.oid_len,
 	  vb->name, vb->name_length,
 	  data->instance.oid.oid_len) != 0)
+    {
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
       break;
+    }
 
     /* Allocate a new `csnmp_list_instances_t', insert the instance name and
      * add it to the list */
     il = (csnmp_list_instances_t *) malloc (sizeof (csnmp_list_instances_t));
     if (il == NULL)
     {
+      if (res != NULL)
+	snmp_free_pdu (res);
+      res = NULL;
+
       status = -1;
       break;
     }
     il->subid = vb->name[vb->name_length - 1];
     il->next = NULL;
 
@@ -1078,23 +1085,30 @@
     sfree (vl.values);
     return (-1);
   }
 
   for (i = 0; i < data->values_len; i++)
     snmp_add_null_var (req, data->values[i].oid, data->values[i].oid_len);
+
+  res = NULL;
   status = snmp_sess_synch_response (host->sess_handle, req, &res);
 
-  if (status != STAT_SUCCESS)
+  if ((status != STAT_SUCCESS) || (res == NULL))
   {
     char *errstr = NULL;
 
     snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
     ERROR ("snmp plugin: host %s: snmp_sess_synch_response failed: %s",
 	host->name, (errstr == NULL) ? "Unknown problem" : errstr);
-    csnmp_host_close_session (host);
+
+    if (res != NULL)
+      snmp_free_pdu (res);
+    res = NULL;
+
     sfree (errstr);
+    csnmp_host_close_session (host);
 
     return (-1);
   }
 
   vl.time = time (NULL);
 
@@ -1110,13 +1124,15 @@
     for (i = 0; i < data->values_len; i++)
       if (snmp_oid_compare (data->values[i].oid, data->values[i].oid_len,
 	    vb->name, vb->name_length) == 0)
 	vl.values[i] = csnmp_value_list_to_value (vb, ds->ds[i].type);
   } /* for (res->variables) */
 
-  snmp_free_pdu (res);
+  if (res != NULL)
+    snmp_free_pdu (res);
+  res = NULL;
 
   DEBUG ("snmp plugin: -> plugin_dispatch_values (%s, &vl);", data->type);
   plugin_dispatch_values (data->type, &vl);
   sfree (vl.values);
 
   return (0);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/types.db /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/types.db
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.3/src/types.db	2007-10-25 02:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-4.1.4/src/types.db	2007-11-08 22:00:22.000000000 +0800
@@ -2,14 +2,14 @@
 apache_connections	count:GAUGE:0:65535
 apache_requests		count:COUNTER:0:134217728
 apache_scoreboard	count:GAUGE:0:65535
 bitrate			value:GAUGE:0:4294967295
 charge			value:GAUGE:0:U
 counter			value:COUNTER:U:U
-cpu			value:COUNTER:0:4294967295
 cpufreq			value:GAUGE:0:U
+cpu			value:COUNTER:0:4294967295
 current			value:GAUGE:U:U
 delay			seconds:GAUGE:-1000000:1000000
 df			used:GAUGE:0:1125899906842623, free:GAUGE:0:1125899906842623
 disk_merged		read:COUNTER:0:4294967295, write:COUNTER:0:4294967295
 disk_octets		read:COUNTER:0:17179869183, write:COUNTER:0:17179869183
 disk_ops		read:COUNTER:0:4294967295, write:COUNTER:0:4294967295
@@ -23,13 +23,13 @@
 email_size		value:GAUGE:0:U
 entropy			entropy:GAUGE:0:4294967295
 fanspeed		value:GAUGE:0:U
 frequency		frequency:GAUGE:0:U
 frequency_offset	ppm:GAUGE:-1000000:1000000
 gauge			value:GAUGE:U:U
-humitidy		value:GAUGE:0:100
+humidity		value:GAUGE:0:100
 if_collisions		value:COUNTER:0:4294967295
 if_dropped		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_errors		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_multicast		value:COUNTER:0:4294967295
 if_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
 if_packets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
@@ -48,25 +48,26 @@
 mysql_threads		running:GAUGE:0:U, connected:GAUGE:0:U, cached:GAUGE:0:U, created:COUNTER:0:U
 nfs_procedure		value:COUNTER:0:4294967295
 percent			percent:GAUGE:0:100.1
 ping			ping:GAUGE:0:65535
 power			value:GAUGE:0:U
 ps_count		processes:GAUGE:0:1000000, threads:GAUGE:0:1000000
-ps_cputime		user:COUNTER:0:1000000, syst:COUNTER:0:1000000
+ps_cputime		user:COUNTER:0:16000000, syst:COUNTER:0:16000000
 ps_pagefaults		minflt:COUNTER:0:9223372036854775807, majflt:COUNTER:0:9223372036854775807
 ps_rss			value:GAUGE:0:9223372036854775807
 ps_state		value:GAUGE:0:65535
+serial_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
+signal_noise		value:GAUGE:U:0
+signal_power		value:GAUGE:U:0
+signal_quality		value:GAUGE:0:U
 spam_score		value:GAUGE:U:U
+swap			value:GAUGE:0:1099511627776
 temperature		value:GAUGE:-273.15:U
 time_dispersion		seconds:GAUGE:-1000000:1000000
-time_offset		seconds:GAUGE:-1000000:1000000
 timeleft		timeleft:GAUGE:0:3600
-voltage			value:GAUGE:U:U
-serial_octets		rx:COUNTER:0:4294967295, tx:COUNTER:0:4294967295
-swap			value:GAUGE:0:1099511627776
+time_offset		seconds:GAUGE:-1000000:1000000
 users			users:GAUGE:0:65535
-vs_threads		value:GAUGE:0:65535
-vs_processes		value:GAUGE:0:65535
+voltage_threshold	value:GAUGE:U:U, threshold:GAUGE:U:U
+voltage			value:GAUGE:U:U
 vs_memory		value:GAUGE:0:9223372036854775807
-signal_quality		value:GAUGE:0:U
-signal_power		value:GAUGE:U:0
-signal_noise		value:GAUGE:U:0
+vs_processes		value:GAUGE:0:65535
+vs_threads		value:GAUGE:0:65535
