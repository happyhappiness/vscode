diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/aclocal.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/aclocal.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/aclocal.m4	2016-11-29 00:09:15.572026114 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/aclocal.m4	2016-09-11 16:10:32.795028191 +0800
@@ -97,348 +97,12 @@
 AC_SUBST([ARGZ_H])
 ])
 
 # Prerequisites of lib/argz.c.
 AC_DEFUN([gl_PREREQ_ARGZ], [:])
 
-# Configure paths for GLIB
-# Owen Taylor     1997-2001
-
-dnl AM_PATH_GLIB_2_0([MINIMUM-VERSION, [ACTION-IF-FOUND [, ACTION-IF-NOT-FOUND [, MODULES]]]])
-dnl Test for GLIB, and define GLIB_CFLAGS and GLIB_LIBS, if gmodule, gobject,
-dnl gthread, or gio is specified in MODULES, pass to pkg-config
-dnl
-AC_DEFUN([AM_PATH_GLIB_2_0],
-[dnl 
-dnl Get the cflags and libraries from pkg-config
-dnl
-AC_ARG_ENABLE(glibtest, [  --disable-glibtest      do not try to compile and run a test GLIB program],
-		    , enable_glibtest=yes)
-
-  pkg_config_args=glib-2.0
-  for module in . $4
-  do
-      case "$module" in
-         gmodule) 
-             pkg_config_args="$pkg_config_args gmodule-2.0"
-         ;;
-         gmodule-no-export) 
-             pkg_config_args="$pkg_config_args gmodule-no-export-2.0"
-         ;;
-         gobject) 
-             pkg_config_args="$pkg_config_args gobject-2.0"
-         ;;
-         gthread) 
-             pkg_config_args="$pkg_config_args gthread-2.0"
-         ;;
-         gio*) 
-             pkg_config_args="$pkg_config_args $module-2.0"
-         ;;
-      esac
-  done
-
-  PKG_PROG_PKG_CONFIG([0.16])
-
-  no_glib=""
-
-  if test "x$PKG_CONFIG" = x ; then
-    no_glib=yes
-    PKG_CONFIG=no
-  fi
-
-  min_glib_version=ifelse([$1], ,2.0.0,$1)
-  AC_MSG_CHECKING(for GLIB - version >= $min_glib_version)
-
-  if test x$PKG_CONFIG != xno ; then
-    ## don't try to run the test against uninstalled libtool libs
-    if $PKG_CONFIG --uninstalled $pkg_config_args; then
-	  echo "Will use uninstalled version of GLib found in PKG_CONFIG_PATH"
-	  enable_glibtest=no
-    fi
-
-    if $PKG_CONFIG --atleast-version $min_glib_version $pkg_config_args; then
-	  :
-    else
-	  no_glib=yes
-    fi
-  fi
-
-  if test x"$no_glib" = x ; then
-    GLIB_GENMARSHAL=`$PKG_CONFIG --variable=glib_genmarshal glib-2.0`
-    GOBJECT_QUERY=`$PKG_CONFIG --variable=gobject_query glib-2.0`
-    GLIB_MKENUMS=`$PKG_CONFIG --variable=glib_mkenums glib-2.0`
-    GLIB_COMPILE_RESOURCES=`$PKG_CONFIG --variable=glib_compile_resources gio-2.0`
-
-    GLIB_CFLAGS=`$PKG_CONFIG --cflags $pkg_config_args`
-    GLIB_LIBS=`$PKG_CONFIG --libs $pkg_config_args`
-    glib_config_major_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\1/'`
-    glib_config_minor_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\2/'`
-    glib_config_micro_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([[0-9]]*\).\([[0-9]]*\).\([[0-9]]*\)/\3/'`
-    if test "x$enable_glibtest" = "xyes" ; then
-      ac_save_CFLAGS="$CFLAGS"
-      ac_save_LIBS="$LIBS"
-      CFLAGS="$CFLAGS $GLIB_CFLAGS"
-      LIBS="$GLIB_LIBS $LIBS"
-dnl
-dnl Now check if the installed GLIB is sufficiently new. (Also sanity
-dnl checks the results of pkg-config to some extent)
-dnl
-      rm -f conf.glibtest
-      AC_TRY_RUN([
-#include <glib.h>
-#include <stdio.h>
-#include <stdlib.h>
-
-int 
-main ()
-{
-  unsigned int major, minor, micro;
-
-  fclose (fopen ("conf.glibtest", "w"));
-
-  if (sscanf("$min_glib_version", "%u.%u.%u", &major, &minor, &micro) != 3) {
-     printf("%s, bad version string\n", "$min_glib_version");
-     exit(1);
-   }
-
-  if ((glib_major_version != $glib_config_major_version) ||
-      (glib_minor_version != $glib_config_minor_version) ||
-      (glib_micro_version != $glib_config_micro_version))
-    {
-      printf("\n*** 'pkg-config --modversion glib-2.0' returned %d.%d.%d, but GLIB (%d.%d.%d)\n", 
-             $glib_config_major_version, $glib_config_minor_version, $glib_config_micro_version,
-             glib_major_version, glib_minor_version, glib_micro_version);
-      printf ("*** was found! If pkg-config was correct, then it is best\n");
-      printf ("*** to remove the old version of GLib. You may also be able to fix the error\n");
-      printf("*** by modifying your LD_LIBRARY_PATH enviroment variable, or by editing\n");
-      printf("*** /etc/ld.so.conf. Make sure you have run ldconfig if that is\n");
-      printf("*** required on your system.\n");
-      printf("*** If pkg-config was wrong, set the environment variable PKG_CONFIG_PATH\n");
-      printf("*** to point to the correct configuration files\n");
-    } 
-  else if ((glib_major_version != GLIB_MAJOR_VERSION) ||
-	   (glib_minor_version != GLIB_MINOR_VERSION) ||
-           (glib_micro_version != GLIB_MICRO_VERSION))
-    {
-      printf("*** GLIB header files (version %d.%d.%d) do not match\n",
-	     GLIB_MAJOR_VERSION, GLIB_MINOR_VERSION, GLIB_MICRO_VERSION);
-      printf("*** library (version %d.%d.%d)\n",
-	     glib_major_version, glib_minor_version, glib_micro_version);
-    }
-  else
-    {
-      if ((glib_major_version > major) ||
-        ((glib_major_version == major) && (glib_minor_version > minor)) ||
-        ((glib_major_version == major) && (glib_minor_version == minor) && (glib_micro_version >= micro)))
-      {
-        return 0;
-       }
-     else
-      {
-        printf("\n*** An old version of GLIB (%u.%u.%u) was found.\n",
-               glib_major_version, glib_minor_version, glib_micro_version);
-        printf("*** You need a version of GLIB newer than %u.%u.%u. The latest version of\n",
-	       major, minor, micro);
-        printf("*** GLIB is always available from ftp://ftp.gtk.org.\n");
-        printf("***\n");
-        printf("*** If you have already installed a sufficiently new version, this error\n");
-        printf("*** probably means that the wrong copy of the pkg-config shell script is\n");
-        printf("*** being found. The easiest way to fix this is to remove the old version\n");
-        printf("*** of GLIB, but you can also set the PKG_CONFIG environment to point to the\n");
-        printf("*** correct copy of pkg-config. (In this case, you will have to\n");
-        printf("*** modify your LD_LIBRARY_PATH enviroment variable, or edit /etc/ld.so.conf\n");
-        printf("*** so that the correct libraries are found at run-time))\n");
-      }
-    }
-  return 1;
-}
-],, no_glib=yes,[echo $ac_n "cross compiling; assumed OK... $ac_c"])
-       CFLAGS="$ac_save_CFLAGS"
-       LIBS="$ac_save_LIBS"
-     fi
-  fi
-  if test "x$no_glib" = x ; then
-     AC_MSG_RESULT(yes (version $glib_config_major_version.$glib_config_minor_version.$glib_config_micro_version))
-     ifelse([$2], , :, [$2])     
-  else
-     AC_MSG_RESULT(no)
-     if test "$PKG_CONFIG" = "no" ; then
-       echo "*** A new enough version of pkg-config was not found."
-       echo "*** See http://www.freedesktop.org/software/pkgconfig/"
-     else
-       if test -f conf.glibtest ; then
-        :
-       else
-          echo "*** Could not run GLIB test program, checking why..."
-          ac_save_CFLAGS="$CFLAGS"
-          ac_save_LIBS="$LIBS"
-          CFLAGS="$CFLAGS $GLIB_CFLAGS"
-          LIBS="$LIBS $GLIB_LIBS"
-          AC_TRY_LINK([
-#include <glib.h>
-#include <stdio.h>
-],      [ return ((glib_major_version) || (glib_minor_version) || (glib_micro_version)); ],
-        [ echo "*** The test program compiled, but did not run. This usually means"
-          echo "*** that the run-time linker is not finding GLIB or finding the wrong"
-          echo "*** version of GLIB. If it is not finding GLIB, you'll need to set your"
-          echo "*** LD_LIBRARY_PATH environment variable, or edit /etc/ld.so.conf to point"
-          echo "*** to the installed location  Also, make sure you have run ldconfig if that"
-          echo "*** is required on your system"
-	  echo "***"
-          echo "*** If you have an old version installed, it is best to remove it, although"
-          echo "*** you may also be able to get things to work by modifying LD_LIBRARY_PATH" ],
-        [ echo "*** The test program failed to compile or link. See the file config.log for the"
-          echo "*** exact error that occured. This usually means GLIB is incorrectly installed."])
-          CFLAGS="$ac_save_CFLAGS"
-          LIBS="$ac_save_LIBS"
-       fi
-     fi
-     GLIB_CFLAGS=""
-     GLIB_LIBS=""
-     GLIB_GENMARSHAL=""
-     GOBJECT_QUERY=""
-     GLIB_MKENUMS=""
-     GLIB_COMPILE_RESOURCES=""
-     ifelse([$3], , :, [$3])
-  fi
-  AC_SUBST(GLIB_CFLAGS)
-  AC_SUBST(GLIB_LIBS)
-  AC_SUBST(GLIB_GENMARSHAL)
-  AC_SUBST(GOBJECT_QUERY)
-  AC_SUBST(GLIB_MKENUMS)
-  AC_SUBST(GLIB_COMPILE_RESOURCES)
-  rm -f conf.glibtest
-])
-
-dnl Autoconf macros for libgcrypt
-dnl       Copyright (C) 2002, 2004 Free Software Foundation, Inc.
-dnl
-dnl This file is free software; as a special exception the author gives
-dnl unlimited permission to copy and/or distribute it, with or without
-dnl modifications, as long as this notice is preserved.
-dnl
-dnl This file is distributed in the hope that it will be useful, but
-dnl WITHOUT ANY WARRANTY, to the extent permitted by law; without even the
-dnl implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
-
-
-dnl AM_PATH_LIBGCRYPT([MINIMUM-VERSION,
-dnl                   [ACTION-IF-FOUND [, ACTION-IF-NOT-FOUND ]]])
-dnl Test for libgcrypt and define LIBGCRYPT_CFLAGS and LIBGCRYPT_LIBS.
-dnl MINIMUN-VERSION is a string with the version number optionalliy prefixed
-dnl with the API version to also check the API compatibility. Example:
-dnl a MINIMUN-VERSION of 1:1.2.5 won't pass the test unless the installed
-dnl version of libgcrypt is at least 1.2.5 *and* the API number is 1.  Using
-dnl this features allows to prevent build against newer versions of libgcrypt
-dnl with a changed API.
-dnl
-AC_DEFUN([AM_PATH_LIBGCRYPT],
-[ AC_ARG_WITH(libgcrypt-prefix,
-            AC_HELP_STRING([--with-libgcrypt-prefix=PFX],
-                           [prefix where LIBGCRYPT is installed (optional)]),
-     libgcrypt_config_prefix="$withval", libgcrypt_config_prefix="")
-  if test x$libgcrypt_config_prefix != x ; then
-     if test x${LIBGCRYPT_CONFIG+set} != xset ; then
-        LIBGCRYPT_CONFIG=$libgcrypt_config_prefix/bin/libgcrypt-config
-     fi
-  fi
-
-  AC_PATH_TOOL(LIBGCRYPT_CONFIG, libgcrypt-config, no)
-  tmp=ifelse([$1], ,1:1.2.0,$1)
-  if echo "$tmp" | grep ':' >/dev/null 2>/dev/null ; then
-     req_libgcrypt_api=`echo "$tmp"     | sed 's/\(.*\):\(.*\)/\1/'`
-     min_libgcrypt_version=`echo "$tmp" | sed 's/\(.*\):\(.*\)/\2/'`
-  else
-     req_libgcrypt_api=0
-     min_libgcrypt_version="$tmp"
-  fi
-
-  AC_MSG_CHECKING(for LIBGCRYPT - version >= $min_libgcrypt_version)
-  ok=no
-  if test "$LIBGCRYPT_CONFIG" != "no" ; then
-    req_major=`echo $min_libgcrypt_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\1/'`
-    req_minor=`echo $min_libgcrypt_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\2/'`
-    req_micro=`echo $min_libgcrypt_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\)/\3/'`
-    libgcrypt_config_version=`$LIBGCRYPT_CONFIG --version`
-    major=`echo $libgcrypt_config_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\).*/\1/'`
-    minor=`echo $libgcrypt_config_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\).*/\2/'`
-    micro=`echo $libgcrypt_config_version | \
-               sed 's/\([[0-9]]*\)\.\([[0-9]]*\)\.\([[0-9]]*\).*/\3/'`
-    if test "$major" -gt "$req_major"; then
-        ok=yes
-    else
-        if test "$major" -eq "$req_major"; then
-            if test "$minor" -gt "$req_minor"; then
-               ok=yes
-            else
-               if test "$minor" -eq "$req_minor"; then
-                   if test "$micro" -ge "$req_micro"; then
-                     ok=yes
-                   fi
-               fi
-            fi
-        fi
-    fi
-  fi
-  if test $ok = yes; then
-    AC_MSG_RESULT([yes ($libgcrypt_config_version)])
-  else
-    AC_MSG_RESULT(no)
-  fi
-  if test $ok = yes; then
-     # If we have a recent libgcrypt, we should also check that the
-     # API is compatible
-     if test "$req_libgcrypt_api" -gt 0 ; then
-        tmp=`$LIBGCRYPT_CONFIG --api-version 2>/dev/null || echo 0`
-        if test "$tmp" -gt 0 ; then
-           AC_MSG_CHECKING([LIBGCRYPT API version])
-           if test "$req_libgcrypt_api" -eq "$tmp" ; then
-             AC_MSG_RESULT([okay])
-           else
-             ok=no
-             AC_MSG_RESULT([does not match. want=$req_libgcrypt_api got=$tmp])
-           fi
-        fi
-     fi
-  fi
-  if test $ok = yes; then
-    LIBGCRYPT_CFLAGS=`$LIBGCRYPT_CONFIG --cflags`
-    LIBGCRYPT_LIBS=`$LIBGCRYPT_CONFIG --libs`
-    ifelse([$2], , :, [$2])
-    if test x"$host" != x ; then
-      libgcrypt_config_host=`$LIBGCRYPT_CONFIG --host 2>/dev/null || echo none`
-      if test x"$libgcrypt_config_host" != xnone ; then
-        if test x"$libgcrypt_config_host" != x"$host" ; then
-  AC_MSG_WARN([[
-***
-*** The config script $LIBGCRYPT_CONFIG was
-*** built for $libgcrypt_config_host and thus may not match the
-*** used host $host.
-*** You may want to use the configure option --with-libgcrypt-prefix
-*** to specify a matching config script.
-***]])
-        fi
-      fi
-    fi
-  else
-    LIBGCRYPT_CFLAGS=""
-    LIBGCRYPT_LIBS=""
-    ifelse([$3], , :, [$3])
-  fi
-  AC_SUBST(LIBGCRYPT_CFLAGS)
-  AC_SUBST(LIBGCRYPT_LIBS)
-])
-
 # libtool.m4 - Configure libtool for the host system. -*-Autoconf-*-
 #
 #   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005,
 #                 2006, 2007, 2008, 2009, 2010, 2011 Free Software
 #                 Foundation, Inc.
 #   Written by Gordon Matzigkeit, 1996
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/AUTHORS /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/AUTHORS
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/AUTHORS	2016-11-29 00:08:22.375470135 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/AUTHORS	2016-09-11 16:10:25.239038754 +0800
@@ -1,15 +1,37 @@
 Permanent project members
 =========================
 
 Florian "octo" Forster <octo at verplant.org>
  - Initial author.
 
+Marc Fournier <marc.fournier at camptocamp.com>
+ - Various fixes to the varnish plugin.
+ - RPM specfile maintenance.
+ - libmnl support in the netlink plugin.
+ - linux support in the zfs_arc plugin.
+ - openldap plugin.
+ - continuous integration system.
+
+Pierre-Yves Ritschard <pyr at spootnik.org>
+ - Write-Riemann plugin.
+ - Write-Graphite plugin: Notification support.
+ - Write-Kafka plugin.
+ - Log-Logstash plugin.
+ - Normalization in the CPU plugin.
+ - Relative values in the Load plugin.
+
+Ruben Kerkhof <ruben at rubenkerkhof.com>
+ - Bugfixes and enhancements in many places all around the project.
+ - Fedora and EPEL packages.
+
 Sebastian "tokkee" Harl <sh at tokkee.org>
  - Bugfixes and enhancements in many places all around the project.
+ - grpc plugin.
  - perl plugin.
+ - postgresql plugin.
  - users plugin.
  - vserver plugin.
  - Debian package.
 
 
 Contributors (sorted alphabetically)
@@ -72,15 +94,22 @@
  - Improvements to the write_mongodb plugin.
 
 Christophe Kalt <collectd at klb.taranis.org>
  - The version 3 `log' mode.
  - Many Solaris related hints and fixes.
 
+Claudius Zingerli <gitmail at zeuz.ch>
+ - chrony plugin.
+
 Cyril Feraudet <cyril at feraudet.com>
  - ethstat plugin.
 
+Dagobert Michelsen <dam at opencsw.org>
+ - zone plugin.
+ - Many Solaris related hints and fixes.
+
 Dan Berrange <berrange at redhat.com>
  - uuid plugin.
 
 Dan Ryder <daryder at cisco.com>
  - ceph plugin.
 
@@ -112,12 +141,15 @@
 Flavio Stanchina <flavio at stanchina.net>
  - mbmon plugin.
 
 Franck Lombardi
  - UNIX socket code for the memcached plugin.
 
+Gergely Nagy <algernon at madhouse-project.org>
+ - Write-Riemann plugin.
+
 Jason Pepas <cell at ices.utexas.edu>
  - nfs plugin.
 
 J. Javier Maestro <jjmaestro at ieee.org>
  - Write-Graphite plugin: UDP support and LogSendErrors flag.
 
@@ -128,12 +160,15 @@
 Jérôme Renard <jerome.renard at gmail.com>
  - varnish plugin.
 
 Jiri Tyr <jiri.tyr at gmail.com>
  - fhcount plugin.
 
+Julien Ammous <j.ammous at gmail.com>
+ - Lua plugin.
+
 Kevin Bowling <kbowling at llnw.com>
  - write_tsdb plugin for http://opentsdb.net/
 
 Kimo Rosenbaum <kimor79 at yahoo.com>
  - openldap plugin.
 
@@ -159,24 +194,20 @@
    + load
    + memory
    + processes
    + swap
  - Various AIX-related fixes and hacks.
 
-Marc Fournier <marc.fournier at camptocamp.com>
- - Various fixes to the varnish plugin.
- - RPM specfile update.
- - libmnl support in the netlink plugin.
- - linux support in the zfs_arc plugin.
- - openldap plugin.
-
 Marco Chiappero <marco at absence.it>
  - uptime plugin.
  - ip6tables support in the iptables plugin.
  - openvpn plugin (support for more status file formats)
 
+Mathijs Möhlmann <collectd at mmrc.nl>
+ - zone plugin.
+
 Michael Hanselmann <public at hansmi.ch>
  - md plugin.
 
 Michael Schenck <mschenck at digitalocean.com>
  - IO time support to disk plugin.
 
@@ -188,12 +219,15 @@
  - thermal plugin.
  - Streamlines recursive directory traversion.
 
 Mirko Buffoni <briareos at eswat.org>
  - Port/Socket selection in the MySQL plugin.
 
+Nicolas Jourden <nicolas.jourden at laposte.net>
+ - gps plugin.
+
 Niki W. Waibel <niki.waibel at newlogic.com>
  - Initial autotools fixes.
  - libltdl code.
  - getmnt-wizardry.
 
 Oleg King <king2 at kaluga.ru>
@@ -212,30 +246,26 @@
 
 Paul Sadauskas <psadauskas at gmail.com>
  - tokyotyrant plugin.
  - `ReportByDevice' option of the df plugin.
  - write_http plugin.
 
+Pavel Rochnyack <pavel2000 at ngs.ru>
+ - xencpu plugin.
+ - Bugfixes and enhancements in many places all around the project.
+
 Peter Holik <peter at holik.at>
  - cpufreq plugin.
  - multimeter plugin.
  - irq plugin.
  - Some bugfixes in the exec plugin.
  - Notifications in the ipmi plugin.
 
 Phoenix Kayo <kayo.k11.4 at gmail.com>
  - pinba plugin.
 
-Pierre-Yves Ritschard <pyr at spootnik.org>
- - Write-Riemann plugin.
- - Write-Graphite plugin: Notification support.
- - Write-Kafka plugin.
- - Log-Logstash plugin.
- - Normalization in the CPU plugin.
- - Relative values in the Load plugin.
-
 Piotr Hosowicz <the55 at wp.pl>
  - SMF manifest for collectd.
 
 Richard W. M. Jones <rjones at redhat.com>
  - virt plugin.
  - uuid plugin.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/Makefile.in	2016-11-29 00:09:17.420045552 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/Makefile.in	2016-09-11 16:10:45.407010771 +0800
@@ -107,12 +107,14 @@
     *) (install-info --version) >/dev/null 2>&1;; \
   esac
 am__tagged_files = $(HEADERS) $(SOURCES) $(TAGS_FILES) $(LISP)
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -124,40 +126,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -165,16 +188,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -195,22 +214,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -224,19 +244,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -259,24 +278,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -286,12 +312,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -311,28 +339,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -345,13 +383,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/org/collectd/java/GenericJMXConfConnection.java /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/org/collectd/java/GenericJMXConfConnection.java
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/org/collectd/java/GenericJMXConfConnection.java	2016-11-29 00:08:22.379470177 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/org/collectd/java/GenericJMXConfConnection.java	2016-09-11 16:10:25.243038749 +0800
@@ -49,13 +49,14 @@
 {
   private String _username = null;
   private String _password = null;
   private String _host = null;
   private String _instance_prefix = null;
   private String _service_url = null;
-  private MBeanServerConnection _jmx_connection = null;
+  private JMXConnector _jmx_connector = null;
+  private MBeanServerConnection _mbean_connection = null;
   private List<GenericJMXConfMBean> _mbeans = null;
 
   /*
    * private methods
    */
   private String getConfigString (OConfigItem ci) /* {{{ */
@@ -89,61 +90,80 @@
       return (this._host);
     }
 
     return Collectd.getHostname();
   } /* }}} String getHost */
 
-private void connect () /* {{{ */
-{
-  JMXServiceURL service_url;
-  JMXConnector connector;
-  Map environment;
-
-  if (_jmx_connection != null)
-    return;
-
-  environment = null;
-  if (this._password != null)
-  {
-    String[] credentials;
-
-    if (this._username == null)
-      this._username = new String ("monitorRole");
-
-    credentials = new String[] { this._username, this._password };
-
-    environment = new HashMap ();
-    environment.put (JMXConnector.CREDENTIALS, credentials);
-    environment.put(JMXConnectorFactory.PROTOCOL_PROVIDER_CLASS_LOADER, this.getClass().getClassLoader());
-  }
-
-  try
-  {
-    service_url = new JMXServiceURL (this._service_url);
-    connector = JMXConnectorFactory.connect (service_url, environment);
-    _jmx_connection = connector.getMBeanServerConnection ();
-  }
-  catch (Exception e)
-  {
-    Collectd.logError ("GenericJMXConfConnection: "
-        + "Creating MBean server connection failed: " + e);
-    return;
-  }
-} /* }}} void connect */
-
-/*
- * public methods
- *
- * <Connection>
- *   Host "tomcat0.mycompany"
- *   ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:17264/jmxrmi"
- *   Collect "java.lang:type=GarbageCollector,name=Copy"
- *   Collect "java.lang:type=Memory"
- * </Connection>
- *
- */
+  private void connect () /* {{{ */
+  {
+    JMXServiceURL service_url;
+    Map<String,Object> environment;
+
+    // already connected
+    if (this._jmx_connector != null) {
+      return;
+    }
+
+    environment = null;
+    if (this._password != null)
+    {
+      String[] credentials;
+
+      if (this._username == null)
+        this._username = new String ("monitorRole");
+
+      credentials = new String[] { this._username, this._password };
+
+      environment = new HashMap<String,Object> ();
+      environment.put (JMXConnector.CREDENTIALS, credentials);
+      environment.put (JMXConnectorFactory.PROTOCOL_PROVIDER_CLASS_LOADER, this.getClass().getClassLoader());
+    }
+
+    try
+    {
+      service_url = new JMXServiceURL (this._service_url);
+      this._jmx_connector = JMXConnectorFactory.connect (service_url, environment);
+      this._mbean_connection = _jmx_connector.getMBeanServerConnection ();
+    }
+    catch (Exception e)
+    {
+      Collectd.logError ("GenericJMXConfConnection: "
+          + "Creating MBean server connection failed: " + e);
+      disconnect ();
+      return;
+    }
+  } /* }}} void connect */
+
+  private void disconnect () /* {{{ */
+  {
+    try
+    {
+      if (this._jmx_connector != null) {
+        this._jmx_connector.close();
+      }
+    }
+    catch (Exception e)
+    {
+      // It's fine if close throws an exception
+    }
+
+    this._jmx_connector = null;
+    this._mbean_connection = null;
+  } /* }}} void disconnect */
+
+  /*
+   * public methods
+   *
+   * <Connection>
+   *   Host "tomcat0.mycompany"
+   *   ServiceURL "service:jmx:rmi:///jndi/rmi://localhost:17264/jmxrmi"
+   *   Collect "java.lang:type=GarbageCollector,name=Copy"
+   *   Collect "java.lang:type=Memory"
+   * </Connection>
+   *
+   */
   public GenericJMXConfConnection (OConfigItem ci) /* {{{ */
     throws IllegalArgumentException
   {
     List<OConfigItem> children;
     Iterator<OConfigItem> iter;
 
@@ -214,15 +234,16 @@
   } /* }}} GenericJMXConfConnection (OConfigItem ci) */
 
   public void query () /* {{{ */
   {
     PluginData pd;
 
+    // try to connect
     connect ();
 
-    if (this._jmx_connection == null)
+    if (this._mbean_connection == null)
       return;
 
     Collectd.logDebug ("GenericJMXConfConnection.query: "
         + "Reading " + this._mbeans.size () + " mbeans from "
         + ((this._host != null) ? this._host : "(null)"));
 
@@ -231,17 +252,17 @@
     pd.setPlugin ("GenericJMX");
 
     for (int i = 0; i < this._mbeans.size (); i++)
     {
       int status;
 
-      status = this._mbeans.get (i).query (this._jmx_connection, pd,
+      status = this._mbeans.get (i).query (this._mbean_connection, pd,
           this._instance_prefix);
       if (status != 0)
       {
-        this._jmx_connection = null;
+        disconnect ();
         return;
       }
     } /* for */
   } /* }}} void query */
 
   public String toString ()
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/org/collectd/java/GenericJMXConfValue.java /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/org/collectd/java/GenericJMXConfValue.java
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/java/org/collectd/java/GenericJMXConfValue.java	2016-11-29 00:08:22.379470177 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/java/org/collectd/java/GenericJMXConfValue.java	2016-09-11 16:10:25.243038749 +0800
@@ -25,23 +25,25 @@
  */
 
 package org.collectd.java;
 
 import java.util.Arrays;
 import java.util.List;
+import java.util.Collection;
 import java.util.Set;
 import java.util.Iterator;
 import java.util.ArrayList;
 
 import java.math.BigDecimal;
 import java.math.BigInteger;
 
 import javax.management.MBeanServerConnection;
 import javax.management.ObjectName;
 import javax.management.openmbean.OpenType;
 import javax.management.openmbean.CompositeData;
+import javax.management.openmbean.TabularData;
 import javax.management.openmbean.InvalidKeyException;
 
 import org.collectd.api.Collectd;
 import org.collectd.api.DataSet;
 import org.collectd.api.DataSource;
 import org.collectd.api.ValueList;
@@ -65,12 +67,13 @@
 {
   private String _ds_name;
   private DataSet _ds;
   private List<String> _attributes;
   private String _instance_prefix;
   private List<String> _instance_from;
+  private String _plugin_name;
   private boolean _is_table;
 
   /**
    * Converts a generic (OpenType) object to a number.
    *
    * Returns null if a conversion is not possible or not implemented.
@@ -292,12 +295,51 @@
       return (value);
     }
     else
     {
       if (value instanceof CompositeData)
         return (queryAttributeRecursive ((CompositeData) value, attrName));
+      else if (value instanceof TabularData)
+        return (queryAttributeRecursive ((TabularData) value, attrName));
+      else
+        return (null);
+    }
+  } /* }}} queryAttributeRecursive */
+
+  private Object queryAttributeRecursive (TabularData parent, /* {{{ */
+      List<String> attrName)
+  {
+    String key;
+    Object value = null;
+
+    key = attrName.remove (0);
+
+    @SuppressWarnings("unchecked")
+    Collection<CompositeData> table = (Collection<CompositeData>) parent.values();
+    for (CompositeData compositeData : table)
+    {
+      if (key.equals(compositeData.get("key")))
+      {
+        value = compositeData.get("value");
+      }
+    }
+    if (null == value)
+    {
+      return (null);
+    }
+
+    if (attrName.size () == 0)
+    {
+      return (value);
+    }
+    else
+    {
+      if (value instanceof CompositeData)
+        return (queryAttributeRecursive ((CompositeData) value, attrName));
+      else if (value instanceof TabularData)
+        return (queryAttributeRecursive ((TabularData) value, attrName));
       else
         return (null);
     }
   } /* }}} queryAttributeRecursive */
 
   private Object queryAttribute (MBeanServerConnection conn, /* {{{ */
@@ -338,23 +380,25 @@
       return (value);
     }
     else
     {
       if (value instanceof CompositeData)
         return (queryAttributeRecursive((CompositeData) value, attrNameList));
+      else if (value instanceof TabularData)
+        return (queryAttributeRecursive((TabularData) value, attrNameList));
       else if (value instanceof OpenType)
       {
         OpenType ot = (OpenType) value;
         Collectd.logNotice ("GenericJMXConfValue: Handling of OpenType \""
             + ot.getTypeName () + "\" is not yet implemented.");
         return (null);
       }
       else
       {
         Collectd.logError ("GenericJMXConfValue: Received object of "
-            + "unknown class.");
+            + "unknown class. " + attrName + " " + ((value == null)?"null":value.getClass().getName()));
         return (null);
       }
     }
   } /* }}} Object queryAttribute */
 
   private String join (String separator, List<String> list) /* {{{ */
@@ -433,12 +477,13 @@
 
     this._ds_name = null;
     this._ds = null;
     this._attributes = new ArrayList<String> ();
     this._instance_prefix = null;
     this._instance_from = new ArrayList<String> ();
+    this._plugin_name = null;
     this._is_table = false;
 
     /*
      * <Value>
      *   Type "memory"
      *   Table true|false
@@ -482,12 +527,18 @@
       else if (child.getKey ().equalsIgnoreCase ("InstanceFrom"))
       {
         String tmp = getConfigString (child);
         if (tmp != null)
           this._instance_from.add (tmp);
       }
+      else if (child.getKey ().equalsIgnoreCase ("PluginName"))
+      {
+        String tmp = getConfigString (child);
+        if (tmp != null)
+          this._plugin_name = tmp;
+      }
       else
         throw (new IllegalArgumentException ("Unknown option: "
               + child.getKey ()));
     }
 
     if (this._ds_name == null)
@@ -535,12 +586,16 @@
       this._ds = null;
       return;
     }
 
     vl = new ValueList (pd);
     vl.setType (this._ds_name);
+    if (this._plugin_name != null)
+    {
+      vl.setPlugin (this._plugin_name);
+    }
 
     /*
      * Build the instnace prefix from the fixed string prefix and the
      * properties of the objName.
      */
     instanceList = new ArrayList<String> ();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/Makefile.in	2016-11-29 00:09:17.376045089 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/Makefile.in	2016-09-11 16:10:45.367010826 +0800
@@ -168,12 +168,14 @@
     fi; \
     dir1=`echo "$$dir1" | sed -e "$$sed_rest"`; \
   done; \
   reldir="$$dir2"
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -185,40 +187,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -226,16 +249,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -256,22 +275,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -285,19 +305,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -320,24 +339,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -347,12 +373,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -372,28 +400,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -406,13 +444,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/perl/lib/Collectd/Unixsock.pm /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/perl/lib/Collectd/Unixsock.pm
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/bindings/perl/lib/Collectd/Unixsock.pm	2016-11-29 00:08:22.383470218 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/bindings/perl/lib/Collectd/Unixsock.pm	2016-09-11 16:10:25.243038749 +0800
@@ -134,19 +134,19 @@
 
 	return $ident;
 } # _parse_identifier
 
 sub _escape_argument
 {
-	local $_ = shift;
+    my $arg = shift;
 
-	return $_ if /^\w+$/;
+	return $arg if $arg =~ /^\w+$/;
 
-	s#\\#\\\\#g;
-	s#"#\\"#g;
-	return "\"$_\"";
+	$arg =~ s#\\#\\\\#g;
+	$arg =~ s#"#\\"#g;
+	return "\"$arg\"";
 }
 
 # Send a command on a socket, including any required argument escaping.
 # Return a single line of result.
 sub _socket_command {
 	my ($self, $command, $args) = @_;
@@ -190,12 +190,38 @@
 		_debug "<- $entry\n";
         $callback->($entry, $cbdata);
 	}
 	return $cbdata;
 }
 
+# Send a raw message on a socket.
+# Returns true upon success and false otherwise.
+sub _send_message
+{
+	my ($self, $msg) = @_;
+	
+	my $fh = $self->{'sock'} or confess ('object has no filehandle');
+	
+	$msg .= "\n" unless $msg =~/\n$/;
+	
+	#1024 is default buffer size at unixsock.c us_handle_client()
+	warn "Collectd::Unixsock->_send_message(\$msg): message is too long!" if length($msg) > 1024;
+	
+	_debug "-> $msg";
+	$fh->print($msg);
+
+	$msg = <$fh>;
+	chomp ($msg);
+	_debug "<- $msg\n";
+
+	my ($status, $error) = split / /, $msg, 2;
+	return 1 if $status == 0;
+
+	$self->{error} = $error;
+	return;
+}
 
 =head1 PUBLIC METHODS
 
 =over 4
 
 =item I<$self> = Collectd::Unixsock->B<new> ([I<$path>]);
@@ -327,24 +353,14 @@
 	}
 
 	$msg = 'PUTVAL '
 	. _escape_argument ($identifier)
 	. $interval
 	. ' ' . _escape_argument ($values) . "\n";
-	_debug "-> $msg";
-	$fh->print($msg);
 
-	$msg = <$fh>;
-	chomp $msg;
-	_debug "<- $msg\n";
-
-	($status, $msg) = split / /, $msg, 2;
-	return 1 if $status == 0;
-
-	$self->{error} = $msg;
-	return;
+	return $self->_send_message($msg);
 } # putval
 
 =item I<$res> = I<$self>-E<gt>B<listval_filter> ( C<%identifier> )
 
 Queries a list of values from the daemon while restricting the results to
 certain hosts, plugins etc. The argument may be anything that passes for an
@@ -497,24 +513,13 @@
 	$args{time} ||= time;
 	
 	$msg = 'PUTNOTIF '
 	. join (' ', map { $_ . '=' . _escape_argument ($args{$_}) } keys %args)
 	. "\n";
 
-	_debug "-> $msg";
-	$fh->print($msg);
-
-	$msg = <$fh>;
-	chomp $msg;
-	_debug "<- $msg\n";
-
-	($status, $msg) = split / /, $msg, 2;
-	return 1 if $status == 0;
-
-	$self->{error} = $msg;
-	return;
+	return $self->_send_message($msg);
 } # putnotif
 
 =item I<$self>-E<gt>B<flush> (B<timeout> =E<gt> I<$timeout>, B<plugins> =E<gt> [...], B<identifier>  =E<gt> [...]);
 
 Flush cached data.
 
@@ -546,13 +551,12 @@
 {
 	my $self  = shift;
 	my %args = @_;
 
 	my $fh = $self->{sock} or confess;
 
-	my $status = 0;
 	my $msg    = "FLUSH";
 
     $msg .= " timeout=$args{timeout}" if defined $args{timeout};
 
 	if ($args{plugins})
 	{
@@ -561,42 +565,37 @@
 			$msg .= " plugin=" . $plugin;
 		}
 	}
 
 	if ($args{identifier})
 	{
+		my $pre = $msg;
 		for my $identifier (@{$args{identifier}})
 		{
 			my $ident_str;
 
 			if (ref ($identifier) ne 'HASH')
 			{
 				cluck ("The argument of the `identifier' "
 					. "option must be an array of hashrefs.");
 				return;
 			}
 
 			$ident_str = _create_identifier ($identifier) or return;
-			$msg .= ' identifier=' . _escape_argument ($ident_str);
+			$ident_str = ' identifier=' . _escape_argument ($ident_str);
+
+			if (length($msg)+length($ident_str) >= 1023) { #1024 - 1 byte for \n
+				$self->_send_message($msg) or return;
+				$msg = $pre;
+			}
+            
+			$msg .= $ident_str;
 		}
 	}
-
-	$msg .= "\n";
-
-	_debug "-> $msg";
-	$fh->print($msg);
-
-	$msg = <$fh>;
-	chomp ($msg);
-	_debug "<- $msg\n";
-
-	($status, $msg) = split / /, $msg, 2;
-	return 1 if $status == 0;
-
-	$self->{error} = $msg;
-	return;
+    
+	return $self->_send_message($msg);
 }
 
 sub error
 {
 	return shift->{error};
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/ChangeLog /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/ChangeLog
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/ChangeLog	2016-11-29 00:08:22.379470177 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/ChangeLog	2016-09-11 16:10:25.239038754 +0800
@@ -1,57 +1,163 @@
-2016-11-28, Version 5.5.3
-	* collectd: Write threads are stopped before shutdown callbacks are
-	  called. Thanks to Florian Forster. #1110
-	* collectd: A compile error on AIX has been fixed: "MSG_DONTWAIT" is not
-	  available on AIX. Thanks to Chao Yang.
-	* libcollectdclient: Lines printed to "STDERR" are now guarded by the
-	  environment variable "COLLECTD_TRACE". Thanks to Florian Forster. #105
-	* collectd.conf(5): Various typos have been fixed. Thanks to Marc
-	  Fournier.
-	* Build system: Detection of the Java environment has been made
-	  deterministic to allow for reproducible builds. Thanks to Marc
-	  Fournier. #1523
-	* APC UPS plugin: Unavailable metrics are now skipped instead of
-	  reported as 0 (zero). Thanks to Florian Forster. #2025
-	* Battery plugin: The minimum value has been removed from the power type
-	  to allow the plugin to report discharging batteries as negative power.
-	  Thanks to Florian Forster.
-	* DBI, Oracle and PostgreSQL plugins: An error message when the type
-	  instance is truncated has been added. Thanks to Florian Forster. #4
-	* cURL-JSON plugin: A possible segmentation fault when parsing
-	  unexpected JSON has been fixed. Thanks to Florian Forster. #1896
-	* DF plugin: Compilation with xfsprogs ≥ 4.7.0 has been fixed. Thanks
-	  to Thomas Deutschmann. #1877
-	* Modbus plugin: Build issues on FreeBSD have been fixed. Thanks to
-	  Florian Forster.
-	* Network plugin: An error message has been corrected. Thanks to Florian
+2016-09-11, Version 5.6.0
+	* Build system: An option to to avoid building the DF plugin against XFS
+	  has been added. Thanks to Ruben Kerkhof. #1878
+	* Build system: Autoconf ≥ 2.60, a C99-capable compiler and pkg-config
+	  are now required. Thanks to Ruben Kerkhof.
+	* Build system: Building with "-Werror" is now optional. Thanks to Ruben
+	  Kerkhof. #1222
+	* Build system: Many compilation issues on non-Linux platforms have been
+	  fixed, leading to wider plugin support. Thanks to Ruben Kerkhof,
+	  Dagobert Michelsen, Havard Eidnes and Robert Viduya.
+	* Build system: The configuration summary now also ends up in
+	  config.log. Thanks to Sebastian Harl.
+	* collectd: All command-line options now override global options from
+	  the config file. Thanks to Sebastian Harl. #366
+	* collectd: A number of unit tests for commonly used functions have been
+	  added. Thanks to Florian Forster.
+	* collectd: Plugins start up and read timeouts are now logged. Thanks to
+	  Marc Fournier. #1293, #1254
+	* collectd: Support for a timeout has been added to "FLUSH" callbacks.
+	  Thanks to Manuel Luis Sanmartín Rozada.
+	* collectd: The "-T" command line switch now reports more errors. Thanks
+	  to Corey Kosak. #1642
+	* collectd: The max size of value list elements ("DATA_MAX_NAME_LEN")
+	  has been doubled and is now configurable at build time. Thanks to Amy
+	  Lin, Florian Forster and Radu Brumariu. #1120
+	* Set target: The "MetaData" option has been added. Thanks to Yves
+	  Mettier and Kevin Bowling. #1106, #1656, #1913
+	* AMQP, Write_HTTP, Write_Kafka plugins: Support for libyajl < 2 has
+	  been added. Thanks to Florian Forster.
+	* APC UPS plugin: Parsing of end markers has been fixed. Thanks to
+	  Florian Forster #617
+	* APC UPS plugin: The "PersistentConnection" option has been added.
+	  Thanks to Florian Forster #617
+	* ceph, DNS, Exec, IPTables, Ping, turbostat plugins: When running
+	  unprivileged, these plugins will now warn about insuffiscient
+	  permissions or capabilities(7). Thanks to Marc Fournier. #1530
+	* Chrony plugin: This new plugin collects NTP data from the chrony NTP
+	  server. Thanks to Claudius Zingerli. #1548
+	* cpusleep plugin: This new plugin measures time spent by CPU in deep
+	  sleep mode. Thanks to Rinigus. #1826
+	* CPU plugin: The "ReportNumCpu" option has been added. Thanks to Fabien
+	  Wernli.
+	* cURL, cURL-JSON, cURL-XML plugins: The new "Statistics" reports
+	  various per-HTTP connection timers. Thanks to Sebastian Harl. #1004
+	* DBI plugin: The "Interval" option has been added to "Database" blocks.
+	  Thanks to Michal Bebjak.
+	* Disk plugin: Support for FreeBSD has been added. Thanks to Xin Li,
+	  Brad Davis, Ruben Kerfhof and Kevin Bowling.
+	* Empty Counter match: Support for derives has been implemented. Thanks
+	  to Florian Forster. #1813
+	* GenericJMX plugin: Support for TabularData and the "PluginName" option
+	  have been added. Thanks to David Crane. #1290, #1291
+	* GPS plugin: This new plugin reports the number of sattelites seen by
+	  and precision of a GPS receiver. Thanks to Nicolas Jourden. #1346
+	* gRPC plugin: This new client and server plugin allows sending and
+	  receiving metrics using the gRPC protocol. Comparable to the UnixSock
+	  plugin, but using TCP and TLS. Thanks to Sebastian Harl and Florian
 	  Forster.
-	* Network plugin: Handling of errors form secure memory initialization
-	  has been improved: the plugin fails gracefully now instead of calling
-	  "abort()". Thanks to Sebastian Harl.
-	* Network plugin: The gcrypt library is only initialized when it is
-	  actually required due to the network plugin's configuration. Thanks to
-	  Florian Forster. #1902
-	* Ping plugin: The init callback has been changed to be idempotent,
-	  fixing errors being reported on Solaris. Thanks to Florian Forster.
-	  #869
-	* PostgreSQL plugin: The query_plans and query_plans_by_table queries
-	  have been improved to return 0 (zero) instead of "NULL" when not
-	  available. Thanks to Bernd Zeimetz. #1905
-	* PowerDNS plugin: The "recursor command" has been fixed so PowerDNS can
-	  correctly parse all requested fields. Thanks to Ruben Kerkhof.
-	* Python plugin: Handling of data sets with multiple data sources of
-	  different type has been fixed. Thanks to Sebastian Harl.
-	* RRDCacheD plugin: Reconnection behavior after failed operations has
-	  been added. Thanks to Sebastian Harl. Debian#657877
-	* Write Graphite and AMQP plugins: A bug that could lead to a missing
-	  null-termination has been fixed. Thanks to Markus Linnala.
-	* Write Kafka plugin: Support for librdkafka 0.9.0 has been added.
+	* Interface plugin: Reporting dropped packets has been added. Thanks to
+	  Marc Falzon. #1555
+	* Interface plugin: The "ReportInactive" has been added, letting users
+	  skip inactive network interfaces. Thanks to Rinigus. #1791
+	* Interface plugin: The new, Solaris-only "UniqueName" option has been
+	  added. Thanks to Yoga Ramalingam. #1416
+	* Lua plugin: This new language binding allows writing plugins using the
+	  Lua programming language. Thanks to Julien Ammous, Florian Forster and
+	  Ruben Kerkhof.
+	* Memory plugin: Reporting of ARC memory on Solaris has been added.
+	  Thanks to Brian ONeill.
+	* MQTT plugin: This new plugin sends metrics to and/or receives metrics
+	  from an MQTT broker. Thanks to Marc Falzon, Jan-Piet Mens, Nicholas
+	  Humfrey and Florian Forster. #805, #1124
+	* MySQL plugin: Connection to the database server can now be done over
+	  SSL. Thanks to Brian Lalor. #1256
+	* MySQL plugin: Monitoring slow queries has been added. Thanks to skob.
+	  #1773
+	* MySQL plugin: mysql_bpool_pages-flushed has been renamed to
+	  mysql_bpool_counters-pages_flushed because the value is cumulative.
+	  Thanks to Marek Becka.
+	* MySQL plugin: Support for Galera statistics has been added. Thanks to
+	  Rachid Zarouali. #1849
+	* MySQL plugin: Support for InnoDB metrics was improved. Thanks to Aman
+	  Gupta. #1111
+	* MySQL plugin: The "mysql_sort" type has been split into 3 different
+	  types. Thanks to Pavel Rochnyack. #1592
+	* Network plugin: Decryption error logging has been improved. Thanks to
+	  Pavel Rochnyack. #1735
+	* Notify Nagios plugin: This new plugin sends notifications to Nagios as
+	  a passive check result. Thanks to Florian Forster.
+	* NTPd plugin: The plugin now detects if the ntp daemon reports
+	  nanoseconds instead of microseconds. Thanks to Matwey V. Kornilov.
+	  #1783
+	* OpenLDAP plugin: Several connection-related improvements have been
+	  made. Thanks to Marc Fournier. #1308
+	* OpenLDAP plugin: Support for "simple authentication" has been added.
+	  Thanks to Marek Becka. #1087
+	* Ping plugin: The "Size" option has been added, allowing the ICMP data
+	  payload size to be configured. Thanks to Witold Baryluk. #1395
+	* PostgreSQL, DBI, Oracle plugins: The new "PluginInstanceFrom" option
+	  has been added. Thanks to Pavel Rochnyack. #1707
+	* PowerDNS plugin: The recursor metrics have been updated to 3.7.3 and
+	  missing rr types have been added. Thanks to Ruben Kerkhof.
+	* Processes plugin: Counting of context switches was added for Linux.
+	  Thanks to Manuel Luis Sanmartín Rozada. #1036
+	* Processes plugin: Improve reliability of thread counts on Linux.
+	  Thanks to Manuel Luis Sanmartín Rozada.
+	* Python plugin: Minimal Python version requirement has been bumped to
+	  2.6. Thanks to Ruben Kerkhof. #1864
+	* Redis plugin: Several additional metrics are now collected. Thanks to
+	  Marc Falzon and Matteo Contrini. #1807, #1483
+	* Sensors plugin: The "UseLabels" option has been added. Thanks to
+	  Christian Fetzer.
+	* SMART plugin: The new "IgnoreSleepMode" option has been added. Thanks
+	  to Scott Talbert. #1770
+	* SMART plugin: The new "UseSerial" option allows identifying devices in
+	  a stable way. Thanks to Scott Talbert. #1794
+	* SNMP plugin: The "IpAddress" can now be used for instances. Thanks to
+	  Vincent Bernat. #1397
+	* StatsD plugin: Latency calculation histogram is now able to shrink
+	  automatically to optimal size. Thanks to Pavel Rochnyack. #1622
+	* StatsD plugin: The "CounterSum" option has been added. Thanks to
+	  Florian Forster. #929, #1282, #1311
+	* UUID plugin: The plugin now also looks in in smbios system table and
+	  "/sys/class/dmi". Thanks to Ruben Kerkhof. #1490
+	* virt plugin: The "PluginInstanceFormat" option has been added. Thanks
+	  to Ruben Kerkhof. #1100
+	* Write Graphite plugin: The "ReconnectInterval" option has been added.
+	  Thanks to Toni Moreno and Florian Forster.
+	* Write HTTP plugin: A KairosDB formatter has been added. Thanks to
+	  Aurélien Rougemont. #1809
+	* Write HTTP plugin: Notifications are now handled by this plugin.
 	  Thanks to Florian Forster.
-	* Write Riemann plugin: Build issues on Solaris have been fixed. Thanks
-	  to Florian Forster.
+	* Write HTTP plugin: The "LogHttpError" option has been added. Thanks to
+	  vzubko.
+	* Write HTTP plugin: The new "Headers" option allows setting custom HTTP
+	  headers in outgoing requests. Thanks to Brandon Arp. #1634
+	* Write Kafka plugin: Key handling has been made more comprehensive and
+	  reliable. Thanks to Florian Forster, Pierre-Yves Ritschard and Vincent
+	  Bernat. #1765, #1695, #1393
+	* Write Redis plugin: The "Database", "MaxSetSize", "Prefix" and
+	  "StoreRates" options have been added. Thanks to Brian Kelly and
+	  Sebastian Pfahl.
+	* Write Riemann plugin: The new "BatchFlushTimeout" and "Timeout" option
+	  have been added. Thanks to Pierre-Yves Ritschard and Gergely Nagy.
+	* Write Riemann plugin: This plugin now requires the riemann-c-client
+	  library, version 1.6.0+. This adds support for submitting values to
+	  Riemann over TLS. Thanks to Gergely Nagy. #986
+	* Write TSDB, Write Sensu, Write Riemann, Write Graphite, Write TSDB
+	  plugin: TCP keepalive is now enabled, helping graceful recovery from
+	  unclean network disconnections. Thanks to Marc Fournier. #1549
+	* XenCPU plugin: This new plugin collects XEN Hypervisor CPU stats.
+	  Thanks to Pavel Rochnyack. #1608
+	* ZFS ARC plugin: Several new statistics have been added and a couple of
+	  obsolete ones removed. Thanks to Brad Davis, Brian ONeill and Ruben
+	  Kerkhof.
+	* Zone plugin: This new plugin reads per-zone CPU usage on Solaris.
+	  Thanks to Mathijs Mohlmann and Dagobert Michelsen.
 
 2016-07-25, Version 5.5.2
 	* collectd: A division by zero has been fixed in the
 	  "plugin_dispatch_multivalue()" function. Thanks to Corey Kosak.
 	* collectd: The address of the Free Software Foundation has been fixed
 	  in GPL license headers. Thanks to Ruben Kerkhof.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/configure	2016-11-29 00:09:18.624058221 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/configure	2016-09-11 16:10:36.267023370 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.69 for collectd 5.5.3.
+# Generated by GNU Autoconf 2.69 for collectd 5.6.0.
 #
 #
 # Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -588,18 +588,18 @@
 MFLAGS=
 MAKEFLAGS=
 
 # Identity of this package.
 PACKAGE_NAME='collectd'
 PACKAGE_TARNAME='collectd'
-PACKAGE_VERSION='5.5.3'
-PACKAGE_STRING='collectd 5.5.3'
+PACKAGE_VERSION='5.6.0'
+PACKAGE_STRING='collectd 5.6.0'
 PACKAGE_BUGREPORT=''
 PACKAGE_URL=''
 
-ac_unique_file="src/"
+ac_unique_file="src/target_set.c"
 : "${ARFLAGS=cr} ${AR_FLAGS=cr}"
 # Factoring default headers for most tests.
 ac_includes_default="\
 #include <stdio.h>
 #ifdef HAVE_SYS_TYPES_H
 # include <sys/types.h>
@@ -639,12 +639,14 @@
 ac_subst_vars='am__EXEEXT_FALSE
 am__EXEEXT_TRUE
 ltdl_LTLIBOBJS
 ltdl_LIBOBJS
 LTLIBOBJS
 LIBOBJS
+AM_CXXFLAGS
+AM_CFLAGS
 LCC_VERSION_STRING
 LCC_VERSION_EXTRA
 LCC_VERSION_PATCH
 LCC_VERSION_MINOR
 LCC_VERSION_MAJOR
 PERL_BINDINGS_OPTIONS
@@ -655,16 +657,20 @@
 DEFAULT_LOG_LEVEL
 LOAD_PLUGIN_LOG_LOGSTASH
 LOAD_PLUGIN_LOGFILE
 LOAD_PLUGIN_SYSLOG
 BUILD_PLUGIN_ZOOKEEPER_FALSE
 BUILD_PLUGIN_ZOOKEEPER_TRUE
+BUILD_PLUGIN_ZONE_FALSE
+BUILD_PLUGIN_ZONE_TRUE
 BUILD_PLUGIN_ZFS_ARC_FALSE
 BUILD_PLUGIN_ZFS_ARC_TRUE
 BUILD_PLUGIN_XMMS_FALSE
 BUILD_PLUGIN_XMMS_TRUE
+BUILD_PLUGIN_XENCPU_FALSE
+BUILD_PLUGIN_XENCPU_TRUE
 BUILD_PLUGIN_WRITE_TSDB_FALSE
 BUILD_PLUGIN_WRITE_TSDB_TRUE
 BUILD_PLUGIN_WRITE_SENSU_FALSE
 BUILD_PLUGIN_WRITE_SENSU_TRUE
 BUILD_PLUGIN_WRITE_RIEMANN_FALSE
 BUILD_PLUGIN_WRITE_RIEMANN_TRUE
@@ -785,12 +791,14 @@
 BUILD_PLUGIN_NUT_FALSE
 BUILD_PLUGIN_NUT_TRUE
 BUILD_PLUGIN_NUMA_FALSE
 BUILD_PLUGIN_NUMA_TRUE
 BUILD_PLUGIN_NTPD_FALSE
 BUILD_PLUGIN_NTPD_TRUE
+BUILD_PLUGIN_NOTIFY_NAGIOS_FALSE
+BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE
 BUILD_PLUGIN_NOTIFY_EMAIL_FALSE
 BUILD_PLUGIN_NOTIFY_EMAIL_TRUE
 BUILD_PLUGIN_NOTIFY_DESKTOP_FALSE
 BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE
 BUILD_PLUGIN_NGINX_FALSE
 BUILD_PLUGIN_NGINX_TRUE
@@ -803,12 +811,14 @@
 BUILD_PLUGIN_NETAPP_FALSE
 BUILD_PLUGIN_NETAPP_TRUE
 BUILD_PLUGIN_MYSQL_FALSE
 BUILD_PLUGIN_MYSQL_TRUE
 BUILD_PLUGIN_MULTIMETER_FALSE
 BUILD_PLUGIN_MULTIMETER_TRUE
+BUILD_PLUGIN_MQTT_FALSE
+BUILD_PLUGIN_MQTT_TRUE
 BUILD_PLUGIN_MODBUS_FALSE
 BUILD_PLUGIN_MODBUS_TRUE
 BUILD_PLUGIN_MIC_FALSE
 BUILD_PLUGIN_MIC_TRUE
 BUILD_PLUGIN_MEMORY_FALSE
 BUILD_PLUGIN_MEMORY_TRUE
@@ -831,18 +841,20 @@
 BUILD_PLUGIN_MATCH_EMPTY_COUNTER_FALSE
 BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE
 BUILD_PLUGIN_MADWIFI_FALSE
 BUILD_PLUGIN_MADWIFI_TRUE
 BUILD_PLUGIN_LVM_FALSE
 BUILD_PLUGIN_LVM_TRUE
+BUILD_PLUGIN_LUA_FALSE
+BUILD_PLUGIN_LUA_TRUE
 BUILD_PLUGIN_LPAR_FALSE
 BUILD_PLUGIN_LPAR_TRUE
-BUILD_PLUGIN_LOG_LOGSTASH_FALSE
-BUILD_PLUGIN_LOG_LOGSTASH_TRUE
 BUILD_PLUGIN_LOGFILE_FALSE
 BUILD_PLUGIN_LOGFILE_TRUE
+BUILD_PLUGIN_LOG_LOGSTASH_FALSE
+BUILD_PLUGIN_LOG_LOGSTASH_TRUE
 BUILD_PLUGIN_LOAD_FALSE
 BUILD_PLUGIN_LOAD_TRUE
 BUILD_PLUGIN_JAVA_FALSE
 BUILD_PLUGIN_JAVA_TRUE
 BUILD_PLUGIN_IRQ_FALSE
 BUILD_PLUGIN_IRQ_TRUE
@@ -855,12 +867,16 @@
 BUILD_PLUGIN_IPC_FALSE
 BUILD_PLUGIN_IPC_TRUE
 BUILD_PLUGIN_INTERFACE_FALSE
 BUILD_PLUGIN_INTERFACE_TRUE
 BUILD_PLUGIN_HDDTEMP_FALSE
 BUILD_PLUGIN_HDDTEMP_TRUE
+BUILD_PLUGIN_GRPC_FALSE
+BUILD_PLUGIN_GRPC_TRUE
+BUILD_PLUGIN_GPS_FALSE
+BUILD_PLUGIN_GPS_TRUE
 BUILD_PLUGIN_GMOND_FALSE
 BUILD_PLUGIN_GMOND_TRUE
 BUILD_PLUGIN_FSCACHE_FALSE
 BUILD_PLUGIN_FSCACHE_TRUE
 BUILD_PLUGIN_FILECOUNT_FALSE
 BUILD_PLUGIN_FILECOUNT_TRUE
@@ -871,40 +887,44 @@
 BUILD_PLUGIN_ETHSTAT_FALSE
 BUILD_PLUGIN_ETHSTAT_TRUE
 BUILD_PLUGIN_ENTROPY_FALSE
 BUILD_PLUGIN_ENTROPY_TRUE
 BUILD_PLUGIN_EMAIL_FALSE
 BUILD_PLUGIN_EMAIL_TRUE
-BUILD_PLUGIN_DNS_FALSE
-BUILD_PLUGIN_DNS_TRUE
 BUILD_PLUGIN_DRBD_FALSE
 BUILD_PLUGIN_DRBD_TRUE
+BUILD_PLUGIN_DNS_FALSE
+BUILD_PLUGIN_DNS_TRUE
 BUILD_PLUGIN_DISK_FALSE
 BUILD_PLUGIN_DISK_TRUE
 BUILD_PLUGIN_DF_FALSE
 BUILD_PLUGIN_DF_TRUE
 BUILD_PLUGIN_DBI_FALSE
 BUILD_PLUGIN_DBI_TRUE
-BUILD_PLUGIN_CGROUPS_FALSE
-BUILD_PLUGIN_CGROUPS_TRUE
 BUILD_PLUGIN_CURL_XML_FALSE
 BUILD_PLUGIN_CURL_XML_TRUE
 BUILD_PLUGIN_CURL_JSON_FALSE
 BUILD_PLUGIN_CURL_JSON_TRUE
 BUILD_PLUGIN_CURL_FALSE
 BUILD_PLUGIN_CURL_TRUE
 BUILD_PLUGIN_CSV_FALSE
 BUILD_PLUGIN_CSV_TRUE
-BUILD_PLUGIN_CPU_FALSE
-BUILD_PLUGIN_CPU_TRUE
+BUILD_PLUGIN_CPUSLEEP_FALSE
+BUILD_PLUGIN_CPUSLEEP_TRUE
 BUILD_PLUGIN_CPUFREQ_FALSE
 BUILD_PLUGIN_CPUFREQ_TRUE
+BUILD_PLUGIN_CPU_FALSE
+BUILD_PLUGIN_CPU_TRUE
 BUILD_PLUGIN_CONTEXTSWITCH_FALSE
 BUILD_PLUGIN_CONTEXTSWITCH_TRUE
 BUILD_PLUGIN_CONNTRACK_FALSE
 BUILD_PLUGIN_CONNTRACK_TRUE
+BUILD_PLUGIN_CHRONY_FALSE
+BUILD_PLUGIN_CHRONY_TRUE
+BUILD_PLUGIN_CGROUPS_FALSE
+BUILD_PLUGIN_CGROUPS_TRUE
 BUILD_PLUGIN_CEPH_FALSE
 BUILD_PLUGIN_CEPH_TRUE
 BUILD_PLUGIN_BIND_FALSE
 BUILD_PLUGIN_BIND_TRUE
 BUILD_PLUGIN_BATTERY_FALSE
 BUILD_PLUGIN_BATTERY_TRUE
@@ -921,18 +941,22 @@
 BUILD_PLUGIN_APACHE_FALSE
 BUILD_PLUGIN_APACHE_TRUE
 BUILD_PLUGIN_AMQP_FALSE
 BUILD_PLUGIN_AMQP_TRUE
 BUILD_PLUGIN_AGGREGATION_FALSE
 BUILD_PLUGIN_AGGREGATION_TRUE
+BUILD_FEATURE_WERROR_FALSE
+BUILD_FEATURE_WERROR_TRUE
 BUILD_FEATURE_GETIFADDRS_FALSE
 BUILD_FEATURE_GETIFADDRS_TRUE
 BUILD_FEATURE_DAEMON_FALSE
 BUILD_FEATURE_DAEMON_TRUE
 BUILD_FEATURE_DEBUG_FALSE
 BUILD_FEATURE_DEBUG_TRUE
+LIBRIEMANN_CLIENT_LIBS
+LIBRIEMANN_CLIENT_CFLAGS
 LIBNOTIFY_LIBS
 LIBNOTIFY_CFLAGS
 BUILD_WITH_LIBATASMART_FALSE
 BUILD_WITH_LIBATASMART_TRUE
 BUILD_WITH_LIBATASMART_LIBS
 BUILD_WITH_LIBATASMART_LDFLAGS
@@ -954,12 +978,14 @@
 BUILD_WITH_LIBYAJL_LDFLAGS
 BUILD_WITH_LIBYAJL_CPPFLAGS
 BUILD_WITH_LIBXMMS_FALSE
 BUILD_WITH_LIBXMMS_TRUE
 BUILD_WITH_LIBXMMS_LIBS
 BUILD_WITH_LIBXMMS_CFLAGS
+LIBXENCTL_LDFLAGS
+LIBXENCTL_CPPFLAGS
 BUILD_WITH_LIBUPSCLIENT_LIBS
 BUILD_WITH_LIBUPSCLIENT_CFLAGS
 BUILD_WITH_LIBUDEV_FALSE
 BUILD_WITH_LIBUDEV_TRUE
 BUILD_WITH_LIBUDEV_LIBS
 BUILD_WITH_LIBUDEV_LDFLAGS
@@ -970,22 +996,14 @@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS
 BUILD_WITH_LIBSTATGRAB_LDFLAGS
 BUILD_WITH_LIBSTATGRAB_CFLAGS
 BUILD_WITH_LIBSTATGRAB_FALSE
 BUILD_WITH_LIBSTATGRAB_TRUE
-BUILD_WITH_LIBSIGROK_FALSE
-BUILD_WITH_LIBSIGROK_TRUE
-BUILD_WITH_LIBSIGROK_LDFLAGS
-BUILD_WITH_LIBSIGROK_CFLAGS
-GLIB_COMPILE_RESOURCES
-GLIB_MKENUMS
-GOBJECT_QUERY
-GLIB_GENMARSHAL
-GLIB_LIBS
-GLIB_CFLAGS
+LIBSIGROK_LIBS
+LIBSIGROK_CFLAGS
 BUILD_WITH_LM_SENSORS_FALSE
 BUILD_WITH_LM_SENSORS_TRUE
 BUILD_WITH_LIBSENSORS_LDFLAGS
 BUILD_WITH_LIBSENSORS_CFLAGS
 BUILD_WITH_LIBRRD_LIBS
 BUILD_WITH_LIBRRD_LDFLAGS
@@ -1003,17 +1021,26 @@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS
 BUILD_WITH_LIBRABBITMQ_FALSE
 BUILD_WITH_LIBRABBITMQ_TRUE
 BUILD_WITH_LIBRABBITMQ_LIBS
 BUILD_WITH_LIBRABBITMQ_LDFLAGS
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS
-BUILD_WITH_PYTHON_LIBS
-BUILD_WITH_PYTHON_LDFLAGS
-BUILD_WITH_PYTHON_CPPFLAGS
-BUILD_WITH_LIBPTHREAD_FALSE
-BUILD_WITH_LIBPTHREAD_TRUE
+PYTHON_CONFIG
+LIBPYTHON_LIBS
+LIBPYTHON_LDFLAGS
+LIBPYTHON_CPPFLAGS
+BUILD_WITH_LIBPROTOBUF_C_LIBS
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS
+PROTOBUF_C_LIBS
+PROTOBUF_C_CFLAGS
+BUILD_WITH_LIBPROTOBUF_LIBS
+BUILD_WITH_LIBPROTOBUF_LDFLAGS
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS
+PROTOBUF_LIBS
+PROTOBUF_CFLAGS
 BUILD_WITH_LIBPQ_FALSE
 BUILD_WITH_LIBPQ_TRUE
 BUILD_WITH_LIBPQ_LDFLAGS
 BUILD_WITH_LIBPQ_CPPFLAGS
 HAVE_BROKEN_PERL_LOAD_MODULE_FALSE
 HAVE_BROKEN_PERL_LOAD_MODULE_TRUE
@@ -1022,25 +1049,25 @@
 PERL_LIBS
 PERL_CFLAGS
 PERL
 BUILD_WITH_LIBPCAP_FALSE
 BUILD_WITH_LIBPCAP_TRUE
 BUILD_WITH_LIBOWCAPI_LIBS
+BUILD_WITH_LIBOWCAPI_LDFLAGS
 BUILD_WITH_LIBOWCAPI_CPPFLAGS
 BUILD_WITH_ORACLE_LIBS
-BUILD_WITH_ORACLE_CFLAGS
+BUILD_WITH_ORACLE_CPPFLAGS
 BUILD_WITH_LIBOPING_FALSE
 BUILD_WITH_LIBOPING_TRUE
 BUILD_WITH_LIBOPING_LDFLAGS
 BUILD_WITH_LIBOPING_CPPFLAGS
 BUILD_WITH_OWN_LIBOCONFIG_FALSE
 BUILD_WITH_OWN_LIBOCONFIG_TRUE
-BUILD_WITH_LIBNETSNMP_FALSE
-BUILD_WITH_LIBNETSNMP_TRUE
-BUILD_WITH_LIBSNMP_LIBS
-BUILD_WITH_LIBSNMP_CFLAGS
+BUILD_WITH_LIBNETSNMP_LIBS
+BUILD_WITH_LIBNETSNMP_LDFLAGS
+BUILD_WITH_LIBNETSNMP_CPPFLAGS
 BUILD_WITH_LIBNETAPP_FALSE
 BUILD_WITH_LIBNETAPP_TRUE
 LIBNETAPP_LIBS
 LIBNETAPP_LDFLAGS
 LIBNETAPP_CPPFLAGS
 BUILD_WITH_LIBMNL_FALSE
@@ -1048,12 +1075,15 @@
 BUILD_WITH_LIBMNL_LIBS
 BUILD_WITH_LIBMNL_CFLAGS
 BUILD_WITH_LIBMYSQL_FALSE
 BUILD_WITH_LIBMYSQL_TRUE
 BUILD_WITH_LIBMYSQL_LIBS
 BUILD_WITH_LIBMYSQL_CFLAGS
+BUILD_WITH_LIBMOSQUITTO_LIBS
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS
 BUILD_WITH_LIBMONGOC_FALSE
 BUILD_WITH_LIBMONGOC_TRUE
 BUILD_WITH_LIBMONGOC_LDFLAGS
 BUILD_WITH_LIBMONGOC_CPPFLAGS
 BUILD_WITH_LIBMODBUS_LIBS
 BUILD_WITH_LIBMODBUS_CFLAGS
@@ -1064,12 +1094,17 @@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS
 BUILD_WITH_LIBLVM2APP_FALSE
 BUILD_WITH_LIBLVM2APP_TRUE
 BUILD_WITH_LIBLVM2APP_LIBS
 BUILD_WITH_LIBLVM2APP_LDFLAGS
 BUILD_WITH_LIBLVM2APP_CPPFLAGS
+BUILD_WITH_LIBLUA_LIBS
+BUILD_WITH_LIBLUA_CFLAGS
+LUA_LIBS
+LUA_CFLAGS
+LIBLUA_PKG_CONFIG_NAME
 BUILD_WITH_LIBLDAP_FALSE
 BUILD_WITH_LIBLDAP_TRUE
 BUILD_WITH_LIBLDAP_LDFLAGS
 BUILD_WITH_LIBLDAP_CPPFLAGS
 BUILD_WITH_JAVA_FALSE
 BUILD_WITH_JAVA_TRUE
@@ -1080,36 +1115,43 @@
 JAR
 JAVAC
 BUILD_WITH_LIBIPTC_LDFLAGS
 BUILD_WITH_LIBIPTC_CPPFLAGS
 BUILD_WITH_LIBIPTC_FALSE
 BUILD_WITH_LIBIPTC_TRUE
+BUILD_WITH_LIBGRPCPP_LIBS
+BUILD_WITH_LIBGRPCPP_LDFLAGS
+BUILD_WITH_LIBGRPCPP_CPPFLAGS
+GRPCPP_LIBS
+GRPCPP_CFLAGS
+BUILD_WITH_LIBGPS_FALSE
+BUILD_WITH_LIBGPS_TRUE
+BUILD_WITH_LIBGPS_LIBS
+BUILD_WITH_LIBGPS_LDFLAGS
+BUILD_WITH_LIBGPS_CFLAGS
 BUILD_WITH_LIBGCRYPT_FALSE
 BUILD_WITH_LIBGCRYPT_TRUE
 GCRYPT_LIBS
 GCRYPT_LDFLAGS
 GCRYPT_CPPFLAGS
-LIBGCRYPT_LIBS
-LIBGCRYPT_CFLAGS
-LIBGCRYPT_CONFIG
 BUILD_WITH_LIBGANGLIA_FALSE
 BUILD_WITH_LIBGANGLIA_TRUE
 GANGLIA_LIBS
 GANGLIA_LDFLAGS
 GANGLIA_CPPFLAGS
 BUILD_WITH_LIBESMTP_FALSE
 BUILD_WITH_LIBESMTP_TRUE
 BUILD_WITH_LIBDBI_FALSE
 BUILD_WITH_LIBDBI_TRUE
 BUILD_WITH_LIBDBI_LIBS
 BUILD_WITH_LIBDBI_LDFLAGS
 BUILD_WITH_LIBDBI_CPPFLAGS
-BUILD_WITH_LIBCURL_FALSE
-BUILD_WITH_LIBCURL_TRUE
 BUILD_WITH_LIBCURL_LIBS
 BUILD_WITH_LIBCURL_CFLAGS
+BUILD_WITH_LIBCURL_FALSE
+BUILD_WITH_LIBCURL_TRUE
 BUILD_WITH_LIBHIREDIS_FALSE
 BUILD_WITH_LIBHIREDIS_TRUE
 BUILD_WITH_LIBHIREDIS_LDFLAGS
 BUILD_WITH_LIBHIREDIS_CPPFLAGS
 BUILD_WITH_LIBAQUAERO5_FALSE
 BUILD_WITH_LIBAQUAERO5_TRUE
@@ -1128,14 +1170,17 @@
 BUILD_WITH_LIBDEVINFO_FALSE
 BUILD_WITH_LIBDEVINFO_TRUE
 BUILD_WITH_LIBKSTAT_FALSE
 BUILD_WITH_LIBKSTAT_TRUE
 BUILD_WITH_PERFSTAT_FALSE
 BUILD_WITH_PERFSTAT_TRUE
+PTHREAD_LIBS
 BUILD_WITH_LIBHAL_LIBS
 BUILD_WITH_LIBHAL_CFLAGS
+HAL_LIBS
+HAL_CFLAGS
 BUILD_WITH_LIBRESOLV_FALSE
 BUILD_WITH_LIBRESOLV_TRUE
 BUILD_WITH_LIBPOSIX4_FALSE
 BUILD_WITH_LIBPOSIX4_TRUE
 BUILD_WITH_LIBRT_FALSE
 BUILD_WITH_LIBRT_TRUE
@@ -1145,37 +1190,49 @@
 IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE
 BUILD_FEATURE_STANDARDS_FALSE
 BUILD_FEATURE_STANDARDS_TRUE
 pkgconfigdir
 KERNEL_CFLAGS
 KERNEL_DIR
-BUILD_FREEBSD_FALSE
-BUILD_FREEBSD_TRUE
-BUILD_AIX_FALSE
-BUILD_AIX_TRUE
-BUILD_OPENBSD_FALSE
-BUILD_OPENBSD_TRUE
-BUILD_DARWIN_FALSE
-BUILD_DARWIN_TRUE
 BUILD_SOLARIS_FALSE
 BUILD_SOLARIS_TRUE
+BUILD_OPENBSD_FALSE
+BUILD_OPENBSD_TRUE
 BUILD_LINUX_FALSE
 BUILD_LINUX_TRUE
-HAVE_PROTOC_C_FALSE
-HAVE_PROTOC_C_TRUE
-have_protoc_c
+BUILD_FREEBSD_FALSE
+BUILD_FREEBSD_TRUE
+BUILD_DARWIN_FALSE
+BUILD_DARWIN_TRUE
+BUILD_AIX_FALSE
+BUILD_AIX_TRUE
+PROTOC_C
+HAVE_GRPC_CPP_FALSE
+HAVE_GRPC_CPP_TRUE
+GRPC_CPP_PLUGIN
+HAVE_PROTOC3_FALSE
+HAVE_PROTOC3_TRUE
+PROTOC
 PKG_CONFIG_LIBDIR
 PKG_CONFIG_PATH
 PKG_CONFIG
+VALGRIND
 YFLAGS
 YACC
 LEXLIB
 LEX_OUTPUT_ROOT
 LEX
 COMPILER_IS_GCC_FALSE
 COMPILER_IS_GCC_TRUE
+am__fastdepCXX_FALSE
+am__fastdepCXX_TRUE
+CXXDEPMODE
+CXXCPP
+ac_ct_CXX
+CXXFLAGS
+CXX
 AM_BACKSLASH
 AM_DEFAULT_VERBOSITY
 AM_DEFAULT_V
 AM_V
 am__fastdepCC_FALSE
 am__fastdepCC_TRUE
@@ -1321,108 +1378,118 @@
 with_ltdl_lib
 enable_ltdl_install
 enable_dependency_tracking
 enable_silent_rules
 enable_largefile
 enable_standards
+enable_xfs
 with_nan_emulation
 with_fp_layout
 with_useragent
+with_data_max_name_len
 with_libaquaero5
 with_libhiredis
 with_libcurl
 with_libdbi
 with_libesmtp
 with_libganglia
 with_libgcrypt
-with_libgcrypt_prefix
+with_libgps
+with_libgrpc__
 with_libiptc
 with_java
 with_libldap
 with_liblvm2app
 with_libmemcached
 with_libmodbus
 with_libmongoc
+with_libmosquitto
 with_libmysql
 with_libmnl
 with_libnetapp
 with_libnetsnmp
 with_liboconfig
 with_liboping
 with_oracle
 with_libowcapi
 with_libpcap
 with_libperl
 with_libpq
-with_libpthread
-with_python
+with_libprotobuf
+with_libprotobuf_c
+with_libpython
 with_librabbitmq
 with_librdkafka
 with_librouteros
 with_librrd
 with_libsensors
-with_libsigrok
-enable_glibtest
 with_libstatgrab
 with_libtokyotyrant
 with_libudev
 with_libupsclient
+with_libxenctrl
 with_libxmms
 with_libyajl
 with_mic
 with_libvarnish
 with_libatasmart
 enable_debug
 enable_daemon
 enable_getifaddrs
+enable_werror
 enable_all_plugins
 enable_aggregation
 enable_amqp
 enable_apache
 enable_apcups
 enable_apple_sensors
 enable_aquaero
 enable_ascent
 enable_barometer
 enable_battery
 enable_bind
 enable_ceph
+enable_cgroups
+enable_chrony
 enable_conntrack
 enable_contextswitch
-enable_cpufreq
 enable_cpu
+enable_cpufreq
+enable_cpusleep
 enable_csv
 enable_curl
 enable_curl_json
 enable_curl_xml
-enable_cgroups
 enable_dbi
 enable_df
 enable_disk
-enable_drbd
 enable_dns
+enable_drbd
 enable_email
 enable_entropy
 enable_ethstat
 enable_exec
 enable_fhcount
 enable_filecount
 enable_fscache
 enable_gmond
+enable_gps
+enable_grpc
 enable_hddtemp
 enable_interface
 enable_ipc
 enable_ipmi
 enable_iptables
 enable_ipvs
 enable_irq
 enable_java
 enable_load
-enable_logfile
 enable_log_logstash
+enable_logfile
 enable_lpar
+enable_lua
 enable_lvm
 enable_madwifi
 enable_match_empty_counter
 enable_match_hashed
 enable_match_regex
 enable_match_timediff
@@ -1431,21 +1498,23 @@
 enable_md
 enable_memcachec
 enable_memcached
 enable_memory
 enable_mic
 enable_modbus
+enable_mqtt
 enable_multimeter
 enable_mysql
 enable_netapp
 enable_netlink
 enable_network
 enable_nfs
 enable_nginx
 enable_notify_desktop
 enable_notify_email
+enable_notify_nagios
 enable_ntpd
 enable_numa
 enable_nut
 enable_olsrd
 enable_onewire
 enable_openldap
@@ -1503,39 +1572,67 @@
 enable_write_log
 enable_write_mongodb
 enable_write_redis
 enable_write_riemann
 enable_write_sensu
 enable_write_tsdb
+enable_xencpu
 enable_xmms
 enable_zfs_arc
+enable_zone
 enable_zookeeper
 with_perl_bindings
 '
       ac_precious_vars='build_alias
 host_alias
 target_alias
 CC
 CFLAGS
 LDFLAGS
 LIBS
 CPPFLAGS
 CPP
+CXX
+CXXFLAGS
+CCC
+CXXCPP
 YACC
 YFLAGS
 PKG_CONFIG
 PKG_CONFIG_PATH
 PKG_CONFIG_LIBDIR
+PROTOC
+GRPC_CPP_PLUGIN
+PROTOC_C
 KERNEL_DIR
+HAL_CFLAGS
+HAL_LIBS
+GRPCPP_CFLAGS
+GRPCPP_LIBS
+LIBLUA_PKG_CONFIG_NAME
+LUA_CFLAGS
+LUA_LIBS
 LIBNETAPP_CPPFLAGS
 LIBNETAPP_LDFLAGS
 LIBNETAPP_LIBS
+PROTOBUF_CFLAGS
+PROTOBUF_LIBS
+PROTOBUF_C_CFLAGS
+PROTOBUF_C_LIBS
+LIBPYTHON_CPPFLAGS
+LIBPYTHON_LDFLAGS
+LIBPYTHON_LIBS
+PYTHON_CONFIG
 RRD_CFLAGS
 RRD_LIBS
+LIBSIGROK_CFLAGS
+LIBSIGROK_LIBS
 LIBNOTIFY_CFLAGS
-LIBNOTIFY_LIBS'
+LIBNOTIFY_LIBS
+LIBRIEMANN_CLIENT_CFLAGS
+LIBRIEMANN_CLIENT_LIBS'
 ac_subdirs_all='libltdl'
 
 # Initialize some variables set by options.
 ac_init_help=
 ac_init_version=false
 ac_unrecognized_opts=
@@ -2070,13 +2167,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures collectd 5.5.3 to adapt to many kinds of systems.
+\`configure' configures collectd 5.6.0 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -2140,13 +2237,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of collectd 5.5.3:";;
+     short | recursive ) echo "Configuration of collectd 5.6.0:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-option-checking  ignore unrecognized --enable/--with options
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
@@ -2162,67 +2259,73 @@
   --disable-dependency-tracking
                           speeds up one-time build
   --enable-silent-rules   less verbose build output (undo: "make V=1")
   --disable-silent-rules  verbose build output (undo: "make V=0")
   --disable-largefile     omit support for large files
   --enable-standards      Enable standards compliance mode
-  --disable-glibtest      do not try to compile and run a test GLIB program
+  --enable-xfs            xfs support in df plugin [default=yes]
 
 collectd features:
   --enable-debug          enable debugging (disabled by def)
   --disable-daemon        disable daemon mode (enabled by def)
   --enable-getifaddrs     enable getifaddrs under Linux (disabled by def)
+  --disable-werror        disable building with -Werror (enabled by def)
 
 collectd plugins:
   --enable-all-plugins    enable all plugins (auto by def)
 
   --enable-aggregation    Aggregation plugin
   --enable-amqp           AMQP output plugin
   --enable-apache         Apache httpd statistics
   --enable-apcups         Statistics of UPSes by APC
-  --enable-apple_sensors  Apple's hardware sensors
-  --enable-aquaero        Aquaero's hardware sensors
+  --enable-apple_sensors  Apple hardware sensors
+  --enable-aquaero        Aquaero hardware sensors
   --enable-ascent         AscentEmu player statistics
   --enable-barometer      Barometer sensor on I2C
   --enable-battery        Battery statistics
   --enable-bind           ISC Bind nameserver statistics
   --enable-ceph           Ceph daemon statistics
+  --enable-cgroups        CGroups CPU usage accounting
+  --enable-chrony         Chrony statistics
   --enable-conntrack      nf_conntrack statistics
   --enable-contextswitch  context switch statistics
-  --enable-cpufreq        CPU frequency statistics
   --enable-cpu            CPU usage statistics
+  --enable-cpufreq        CPU frequency statistics
+  --enable-cpusleep       CPU sleep statistics
   --enable-csv            CSV output plugin
   --enable-curl           CURL generic web statistics
   --enable-curl_json      CouchDB statistics
   --enable-curl_xml       CURL generic xml statistics
-  --enable-cgroups        CGroups CPU usage accounting
   --enable-dbi            General database statistics
   --enable-df             Filesystem usage statistics
   --enable-disk           Disk usage statistics
-  --enable-drbd           DRBD statistics
   --enable-dns            DNS traffic analysis
+  --enable-drbd           DRBD statistics
   --enable-email          EMail statistics
   --enable-entropy        Entropy statistics
   --enable-ethstat        Stats from NIC driver
   --enable-exec           Execution of external programs
   --enable-fhcount        File handles statistics
   --enable-filecount      Count files in directories
   --enable-fscache        fscache statistics
   --enable-gmond          Ganglia plugin
+  --enable-gps            GPS plugin
+  --enable-grpc           gRPC plugin
   --enable-hddtemp        Query hddtempd
   --enable-interface      Interface traffic statistics
   --enable-ipc            IPC statistics
   --enable-ipmi           IPMI sensor statistics
   --enable-iptables       IPTables rule counters
   --enable-ipvs           IPVS connection statistics
   --enable-irq            IRQ statistics
   --enable-java           Embed the Java Virtual Machine
   --enable-load           System load
-  --enable-logfile        File logging plugin
   --enable-log_logstash   Logstash json_event compatible logging
+  --enable-logfile        File logging plugin
   --enable-lpar           AIX logical partitions statistics
+  --enable-lua            Lua plugin
   --enable-lvm            LVM statistics
   --enable-madwifi        Madwifi wireless statistics
   --enable-match_empty_counter
                           The empty counter match
   --enable-match_hashed   The hashed match
   --enable-match_regex    The regex match
@@ -2232,21 +2335,23 @@
   --enable-md             md (Linux software RAID) devices
   --enable-memcachec      memcachec statistics
   --enable-memcached      memcached statistics
   --enable-memory         Memory usage
   --enable-mic            Intel Many Integrated Core stats
   --enable-modbus         Modbus plugin
+  --enable-mqtt           MQTT output plugin
   --enable-multimeter     Read multimeter values
   --enable-mysql          MySQL statistics
   --enable-netapp         NetApp plugin
   --enable-netlink        Enhanced Linux network statistics
   --enable-network        Network communication plugin
   --enable-nfs            NFS statistics
   --enable-nginx          nginx statistics
   --enable-notify_desktop Desktop notifications
   --enable-notify_email   Email notifier
+  --enable-notify_nagios  Nagios notification plugin
   --enable-ntpd           NTPd statistics
   --enable-numa           NUMA virtual memory statistics
   --enable-nut            Network UPS tools statistics
   --enable-olsrd          olsrd statistics
   --enable-onewire        OneWire sensor statistics
   --enable-openldap       OpenLDAP statistics
@@ -2306,14 +2411,16 @@
   --enable-write_log      Log output plugin
   --enable-write_mongodb  MongoDB output plugin
   --enable-write_redis    Redis output plugin
   --enable-write_riemann  Riemann output plugin
   --enable-write_sensu    Sensu output plugin
   --enable-write_tsdb     TSDB output plugin
+  --enable-xencpu         Xen Host CPU usage
   --enable-xmms           XMMS statistics
   --enable-zfs_arc        ZFS ARC statistics
+  --enable-zone           Solaris container statistics
   --enable-zookeeper      Zookeeper statistics
 
 Optional Packages:
   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
   --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
   --with-pic[=PKGS]       try to use only PIC/non-PIC objects [default=use
@@ -2326,12 +2433,14 @@
   --with-ltdl-lib=DIR     use the libltdl.la installed in DIR
   --with-nan-emulation    use emulated NAN. For crosscompiling only.
   --with-fp-layout        set the memory layout of doubles. For crosscompiling
                           only.
   --with-useragent[=AGENT]
                           User agent to use on http requests
+  --with-data-max-name-len[=VALUE]
+                          Maximum length of data buffers
 
 collectd additional packages:
   --with-libaquaero5[=PREFIX]
                           Path to aquatools-ng source code.
   --with-libhiredis[=PREFIX]
                           Path to libhiredis.
@@ -2340,25 +2449,28 @@
   --with-libesmtp[=PREFIX]
                           Path to libesmtp.
   --with-libganglia[=PREFIX]
                           Path to libganglia.
   --with-libgcrypt[=PREFIX]
                           Path to libgcrypt.
-  --with-libgcrypt-prefix=PFX
-                          prefix where LIBGCRYPT is installed (optional)
+  --with-libgps[=PREFIX]  Path to libgps.
+  --with-libgrpc++[=PREFIX]
+                          Path to libgrpc++.
   --with-libiptc[=PREFIX] Path to libiptc.
   --with-java[=PREFIX]    Path to Java home.
   --with-libldap[=PREFIX] Path to libldap.
   --with-liblvm2app[=PREFIX]
                           Path to liblvm2app.
   --with-libmemcached[=PREFIX]
                           Path to libmemcached.
   --with-libmodbus[=PREFIX]
                           Path to the modbus library.
   --with-libmongoc[=PREFIX]
                           Path to libmongoc.
+  --with-libmosquitto[=PREFIX]
+                          Path to libmosquitto.
   --with-libmysql[=PREFIX]
                           Path to libmysql.
   --with-libmnl[=PREFIX]  Path to libmnl.
   --with-libnetapp[=PREFIX]
                           Path to libnetapp.
   --with-libnetsnmp[=PREFIX]
@@ -2371,33 +2483,36 @@
                           Path to Oracle.
   --with-libowcapi[=PREFIX]
                           Path to libowcapi.
   --with-libpcap[=PREFIX] Path to libpcap.
   --with-libperl[=PREFIX] Path to libperl.
   --with-libpq[=PREFIX]   Path to libpq.
-  --with-libpthread=[=PREFIX]
-                          Path to libpthread.
-  --with-python[=PREFIX]  Path to the python interpreter.
+  --with-libprotobuf[=PREFIX]
+                          Path to libprotobuf.
+  --with-libprotobuf-c[=PREFIX]
+                          Path to libprotobuf-c.
+  --with-libpython        if we should build with libpython [default=yes]
+
   --with-librabbitmq[=PREFIX]
                           Path to librabbitmq.
   --with-librdkafka[=PREFIX]
                           Path to librdkafka.
   --with-librouteros[=PREFIX]
                           Path to librouteros.
   --with-librrd[=PREFIX]  Path to rrdtool.
   --with-libsensors[=PREFIX]
                           Path to lm_sensors.
-  --with-libsigrok[=PREFIX]
-                          Path to libsigrok.
   --with-libstatgrab[=PREFIX]
                           Path to libstatgrab.
   --with-libtokyotyrant[=PREFIX]
                           Path to libtokyotyrant.
   --with-libudev[=PREFIX] Path to libudev.
   --with-libupsclient[=PREFIX]
                           Path to the upsclient library.
+  --with-libxenctrl[=PREFIX]
+                          Path to libxenctrl.
   --with-libxmms[=PREFIX] Path to libxmms.
   --with-libyajl[=PREFIX] Path to libyajl.
   --with-mic[=PREFIX]     Path to Intel MIC Access API.
   --with-libvarnish[=PREFIX]
                           Path to libvarnish.
   --with-libatasmart[=PREFIX]
@@ -2411,36 +2526,76 @@
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
   LIBS        libraries to pass to the linker, e.g. -l<library>
   CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if
               you have headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  CXX         C++ compiler command
+  CXXFLAGS    C++ compiler flags
+  CXXCPP      C++ preprocessor
   YACC        The `Yet Another Compiler Compiler' implementation to use.
               Defaults to the first program found out of: `bison -y', `byacc',
               `yacc'.
   YFLAGS      The list of arguments that will be passed by default to $YACC.
               This script will default YFLAGS to the empty string to avoid a
               default value of `-d' given by some make applications.
   PKG_CONFIG  path to pkg-config utility
   PKG_CONFIG_PATH
               directories to add to pkg-config's search path
   PKG_CONFIG_LIBDIR
               path overriding pkg-config's built-in search path
+  PROTOC      path to the protoc binary
+  GRPC_CPP_PLUGIN
+              path to the grpc_cpp_plugin binary
+  PROTOC_C    path to the protoc-c binary
   KERNEL_DIR  path to Linux kernel sources
+  HAL_CFLAGS  C compiler flags for HAL, overriding pkg-config
+  HAL_LIBS    linker flags for HAL, overriding pkg-config
+  GRPCPP_CFLAGS
+              C compiler flags for GRPCPP, overriding pkg-config
+  GRPCPP_LIBS linker flags for GRPCPP, overriding pkg-config
+  LIBLUA_PKG_CONFIG_NAME
+              Name of liblua used by pkg-config
+  LUA_CFLAGS  C compiler flags for LUA, overriding pkg-config
+  LUA_LIBS    linker flags for LUA, overriding pkg-config
   LIBNETAPP_CPPFLAGS
               C preprocessor flags required to build with libnetapp
   LIBNETAPP_LDFLAGS
               Linker flags required to build with libnetapp
   LIBNETAPP_LIBS
               Other libraries required to link against libnetapp
+  PROTOBUF_CFLAGS
+              C compiler flags for PROTOBUF, overriding pkg-config
+  PROTOBUF_LIBS
+              linker flags for PROTOBUF, overriding pkg-config
+  PROTOBUF_C_CFLAGS
+              C compiler flags for PROTOBUF_C, overriding pkg-config
+  PROTOBUF_C_LIBS
+              linker flags for PROTOBUF_C, overriding pkg-config
+  LIBPYTHON_CPPFLAGS
+              Preprocessor flags for libpython
+  LIBPYTHON_LDFLAGS
+              Linker flags for libpython
+  LIBPYTHON_LIBS
+              Libraries for libpython
+  PYTHON_CONFIG
+              path to python-config
   RRD_CFLAGS  C compiler flags for RRD, overriding pkg-config
   RRD_LIBS    linker flags for RRD, overriding pkg-config
+  LIBSIGROK_CFLAGS
+              C compiler flags for LIBSIGROK, overriding pkg-config
+  LIBSIGROK_LIBS
+              linker flags for LIBSIGROK, overriding pkg-config
   LIBNOTIFY_CFLAGS
               C compiler flags for LIBNOTIFY, overriding pkg-config
   LIBNOTIFY_LIBS
               linker flags for LIBNOTIFY, overriding pkg-config
+  LIBRIEMANN_CLIENT_CFLAGS
+              C compiler flags for LIBRIEMANN_CLIENT, overriding pkg-config
+  LIBRIEMANN_CLIENT_LIBS
+              linker flags for LIBRIEMANN_CLIENT, overriding pkg-config
 
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
 
 Report bugs to the package provider.
 _ACEOF
@@ -2502,13 +2657,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-collectd configure 5.5.3
+collectd configure 5.6.0
 generated by GNU Autoconf 2.69
 
 Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2877,12 +3032,133 @@
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
   eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_type
 
+# ac_fn_cxx_try_compile LINENO
+# ----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_compile
+
+# ac_fn_cxx_try_cpp LINENO
+# ------------------------
+# Try to preprocess conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_cpp ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if { { ac_try="$ac_cpp conftest.$ac_ext"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_cpp conftest.$ac_ext") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } > conftest.i && {
+	 test -z "$ac_cxx_preproc_warn_flag$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+    ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_cpp
+
+# ac_fn_cxx_try_link LINENO
+# -------------------------
+# Try to link conftest.$ac_ext, and return whether this succeeded.
+ac_fn_cxx_try_link ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext conftest$ac_exeext
+  if { { ac_try="$ac_link"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_link") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_cxx_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest$ac_exeext && {
+	 test "$cross_compiling" = yes ||
+	 test -x conftest$ac_exeext
+       }; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  # Delete the IPA/IPO (Inter Procedural Analysis/Optimization) information
+  # created by the PGI compiler (conftest_ipa8_conftest.oo), as it would
+  # interfere with the next link command; also delete a directory that is
+  # left behind by Apple's compiler.  We do this before executing the actions.
+  rm -rf conftest.dSYM conftest_ipa8_conftest.oo
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_cxx_try_link
+
 # ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES
 # -------------------------------------------------------
 # Tests whether HEADER exists, giving a warning if it cannot be compiled using
 # the include files in INCLUDES and setting the cache variable VAR
 # accordingly.
 ac_fn_c_check_header_mongrel ()
@@ -2964,66 +3240,12 @@
 $as_echo "$ac_res" >&6; }
 fi
   eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_header_mongrel
 
-# ac_fn_c_find_uintX_t LINENO BITS VAR
-# ------------------------------------
-# Finds an unsigned integer type with width BITS, setting cache variable VAR
-# accordingly.
-ac_fn_c_find_uintX_t ()
-{
-  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for uint$2_t" >&5
-$as_echo_n "checking for uint$2_t... " >&6; }
-if eval \${$3+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  eval "$3=no"
-     # Order is important - never check a type that is potentially smaller
-     # than half of the expected target width.
-     for ac_type in uint$2_t 'unsigned int' 'unsigned long int' \
-	 'unsigned long long int' 'unsigned short int' 'unsigned char'; do
-       cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
-static int test_array [1 - 2 * !((($ac_type) -1 >> ($2 / 2 - 1)) >> ($2 / 2 - 1) == 3)];
-test_array [0] = 0;
-return test_array [0];
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  case $ac_type in #(
-  uint$2_t) :
-    eval "$3=yes" ;; #(
-  *) :
-    eval "$3=\$ac_type" ;;
-esac
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-       if eval test \"x\$"$3"\" = x"no"; then :
-
-else
-  break
-fi
-     done
-fi
-eval ac_res=\$$3
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
-
-} # ac_fn_c_find_uintX_t
-
 # ac_fn_c_check_member LINENO AGGR MEMBER VAR INCLUDES
 # ----------------------------------------------------
 # Tries to find if the field MEMBER exists in type AGGR, after including
 # INCLUDES, setting cache variable VAR accordingly.
 ac_fn_c_check_member ()
 {
@@ -3074,17 +3296,104 @@
 eval ac_res=\$$4
 	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
 $as_echo "$ac_res" >&6; }
   eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
 
 } # ac_fn_c_check_member
+
+# ac_fn_cxx_check_header_mongrel LINENO HEADER VAR INCLUDES
+# ---------------------------------------------------------
+# Tests whether HEADER exists, giving a warning if it cannot be compiled using
+# the include files in INCLUDES and setting the cache variable VAR
+# accordingly.
+ac_fn_cxx_check_header_mongrel ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  if eval \${$3+:} false; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+else
+  # Is the header compilable?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 usability" >&5
+$as_echo_n "checking $2 usability... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$4
+#include <$2>
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_header_compiler=yes
+else
+  ac_header_compiler=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler" >&5
+$as_echo "$ac_header_compiler" >&6; }
+
+# Is the header present?
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking $2 presence" >&5
+$as_echo_n "checking $2 presence... " >&6; }
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <$2>
+_ACEOF
+if ac_fn_cxx_try_cpp "$LINENO"; then :
+  ac_header_preproc=yes
+else
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc" >&5
+$as_echo "$ac_header_preproc" >&6; }
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_cxx_preproc_warn_flag in #((
+  yes:no: )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&5
+$as_echo "$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+  no:yes:* )
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled" >&5
+$as_echo "$as_me: WARNING: $2: present but cannot be compiled" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?" >&5
+$as_echo "$as_me: WARNING: $2:     check for missing prerequisite headers?" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation" >&5
+$as_echo "$as_me: WARNING: $2: see the Autoconf documentation" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&5
+$as_echo "$as_me: WARNING: $2:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result" >&5
+$as_echo "$as_me: WARNING: $2: proceeding with the compiler's result" >&2;}
+    ;;
+esac
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $2" >&5
+$as_echo_n "checking for $2... " >&6; }
+if eval \${$3+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  eval "$3=\$ac_header_compiler"
+fi
+eval ac_res=\$$3
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+
+} # ac_fn_cxx_check_header_mongrel
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by collectd $as_me 5.5.3, which was
+It was created by collectd $as_me 5.6.0, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 exec 5>>config.log
@@ -13549,13 +13858,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='collectd'
- VERSION='5.5.3'
+ VERSION='5.6.0'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -14106,630 +14415,475 @@
 fi
 
 
 #
 # Checks for programs.
 #
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
+   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C99" >&5
+$as_echo_n "checking for $CC option to accept ISO C99... " >&6; }
+if ${ac_cv_prog_cc_c99+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_cv_prog_cc_c99=no
+ac_save_CC=$CC
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdbool.h>
+#include <stdlib.h>
+#include <wchar.h>
+#include <stdio.h>
+
+// Check varargs macros.  These examples are taken from C99 6.10.3.5.
+#define debug(...) fprintf (stderr, __VA_ARGS__)
+#define showlist(...) puts (#__VA_ARGS__)
+#define report(test,...) ((test) ? puts (#test) : printf (__VA_ARGS__))
+static void
+test_varargs_macros (void)
+{
+  int x = 1234;
+  int y = 5678;
+  debug ("Flag");
+  debug ("X = %d\n", x);
+  showlist (The first, second, and third items.);
+  report (x>y, "x is %d but y is %d", x, y);
+}
+
+// Check long long types.
+#define BIG64 18446744073709551615ull
+#define BIG32 4294967295ul
+#define BIG_OK (BIG64 / BIG32 == 4294967297ull && BIG64 % BIG32 == 0)
+#if !BIG_OK
+  your preprocessor is broken;
+#endif
+#if BIG_OK
+#else
+  your preprocessor is broken;
+#endif
+static long long int bignum = -9223372036854775807LL;
+static unsigned long long int ubignum = BIG64;
+
+struct incomplete_array
+{
+  int datasize;
+  double data[];
+};
+
+struct named_init {
+  int number;
+  const wchar_t *name;
+  double average;
+};
+
+typedef const char *ccp;
+
+static inline int
+test_restrict (ccp restrict text)
+{
+  // See if C++-style comments work.
+  // Iterate through items via the restricted pointer.
+  // Also check for declarations in for loops.
+  for (unsigned int i = 0; *(text+i) != '\0'; ++i)
+    continue;
+  return 0;
+}
+
+// Check varargs and va_copy.
+static void
+test_varargs (const char *format, ...)
+{
+  va_list args;
+  va_start (args, format);
+  va_list args_copy;
+  va_copy (args_copy, args);
+
+  const char *str;
+  int number;
+  float fnumber;
+
+  while (*format)
+    {
+      switch (*format++)
+	{
+	case 's': // string
+	  str = va_arg (args_copy, const char *);
+	  break;
+	case 'd': // int
+	  number = va_arg (args_copy, int);
+	  break;
+	case 'f': // float
+	  fnumber = va_arg (args_copy, double);
+	  break;
+	default:
+	  break;
+	}
+    }
+  va_end (args_copy);
+  va_end (args);
+}
+
+int
+main ()
+{
+
+  // Check bool.
+  _Bool success = false;
+
+  // Check restrict.
+  if (test_restrict ("String literal") == 0)
+    success = true;
+  char *restrict newvar = "Another string";
+
+  // Check varargs.
+  test_varargs ("s, d' f .", "string", 65, 34.234);
+  test_varargs_macros ();
+
+  // Check flexible array members.
+  struct incomplete_array *ia =
+    malloc (sizeof (struct incomplete_array) + (sizeof (double) * 10));
+  ia->datasize = 10;
+  for (int i = 0; i < ia->datasize; ++i)
+    ia->data[i] = i * 1.234;
+
+  // Check named initializers.
+  struct named_init ni = {
+    .number = 34,
+    .name = L"Test wide string",
+    .average = 543.34343,
+  };
+
+  ni.number = 58;
+
+  int dynamic_array[ni.number];
+  dynamic_array[ni.number - 1] = 543;
+
+  // work around unused variable warnings
+  return (!success || bignum == 0LL || ubignum == 0uLL || newvar[0] == 'x'
+	  || dynamic_array[ni.number - 1] != 543);
+
+  ;
+  return 0;
+}
+_ACEOF
+for ac_arg in '' -std=gnu99 -std=c99 -c99 -AC99 -D_STDC_C99= -qlanglvl=extc99
+do
+  CC="$ac_save_CC $ac_arg"
+  if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_prog_cc_c99=$ac_arg
+fi
+rm -f core conftest.err conftest.$ac_objext
+  test "x$ac_cv_prog_cc_c99" != "xno" && break
+done
+rm -f conftest.$ac_ext
+CC=$ac_save_CC
+
+fi
+# AC_CACHE_VAL
+case "x$ac_cv_prog_cc_c99" in
+  x)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
+$as_echo "none needed" >&6; } ;;
+  xno)
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
+$as_echo "unsupported" >&6; } ;;
+  *)
+    CC="$CC $ac_cv_prog_cc_c99"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c99" >&5
+$as_echo "$ac_cv_prog_cc_c99" >&6; } ;;
+esac
+if test "x$ac_cv_prog_cc_c99" != xno; then :
+
+fi
+
+
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+if test -z "$CXX"; then
+  if test -n "$CCC"; then
+    CXX=$CCC
+  else
+    if test -n "$ac_tool_prefix"; then
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CC+:} false; then :
+if ${ac_cv_prog_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  if test -n "$CXX"; then
+  ac_cv_prog_CXX="$CXX" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
   done
 IFS=$as_save_IFS
 
 fi
 fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
-$as_echo "$CC" >&6; }
+CXX=$ac_cv_prog_CXX
+if test -n "$CXX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXX" >&5
+$as_echo "$CXX" >&6; }
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
 
+    test -n "$CXX" && break
+  done
 fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
+if test -z "$CXX"; then
+  ac_ct_CXX=$CXX
+  for ac_prog in g++ c++ gpp aCC CC cxx cc++ cl.exe FCC KCC RCC xlC_r xlC
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
 $as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_CC+:} false; then :
+if ${ac_cv_prog_ac_ct_CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+  if test -n "$ac_ct_CXX"; then
+  ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
   if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="gcc"
+    ac_cv_prog_ac_ct_CXX="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
   done
 IFS=$as_save_IFS
 
 fi
 fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
+ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
+if test -n "$ac_ct_CXX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CXX" >&5
+$as_echo "$ac_ct_CXX" >&6; }
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
 
-  if test "x$ac_ct_CC" = x; then
-    CC=""
+
+  test -n "$ac_ct_CXX" && break
+done
+
+  if test "x$ac_ct_CXX" = x; then
+    CXX="g++"
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
 { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
 $as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
 ac_tool_warned=yes ;;
 esac
-    CC=$ac_ct_CC
+    CXX=$ac_ct_CXX
   fi
-else
-  CC="$ac_cv_prog_CC"
 fi
 
-if test -z "$CC"; then
-          if test -n "$ac_tool_prefix"; then
-    # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
   fi
+fi
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for C++ compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
 done
-  done
-IFS=$as_save_IFS
 
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
-$as_echo "$CC" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C++ compiler" >&5
+$as_echo_n "checking whether we are using the GNU C++ compiler... " >&6; }
+if ${ac_cv_cxx_compiler_gnu+:} false; then :
+  $as_echo_n "(cached) " >&6
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
 
-  fi
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
+else
+  ac_compiler_gnu=no
 fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CC+:} false; then :
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_cxx_compiler_gnu" >&5
+$as_echo "$ac_cv_cxx_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GXX=yes
+else
+  GXX=
+fi
+ac_test_CXXFLAGS=${CXXFLAGS+set}
+ac_save_CXXFLAGS=$CXXFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -g" >&5
+$as_echo_n "checking whether $CXX accepts -g... " >&6; }
+if ${ac_cv_prog_cxx_g+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  ac_save_cxx_werror_flag=$ac_cxx_werror_flag
+   ac_cxx_werror_flag=yes
+   ac_cv_prog_cxx_g=no
+   CXXFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_prog_cxx_g=yes
 else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl.exe
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_CC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $CC" >&5
-$as_echo "$CC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl.exe
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_ac_ct_CC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_ct_CC" >&5
-$as_echo "$ac_ct_CC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
-
-
-  test -n "$ac_ct_CC" && break
-done
-
-  if test "x$ac_ct_CC" = x; then
-    CC=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    CC=$ac_ct_CC
-  fi
-fi
-
-fi
-
-
-test -z "$CC" && { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "no acceptable C compiler found in \$PATH
-See \`config.log' for more details" "$LINENO" 5; }
-
-# Provide some information about the compiler.
-$as_echo "$as_me:${as_lineno-$LINENO}: checking for C compiler version" >&5
-set X $ac_compile
-ac_compiler=$2
-for ac_option in --version -v -V -qversion; do
-  { { ac_try="$ac_compiler $ac_option >&5"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
-  ac_status=$?
-  if test -s conftest.err; then
-    sed '10a\
-... rest of stderr output deleted ...
-         10q' conftest.err >conftest.er1
-    cat conftest.er1 >&5
-  fi
-  rm -f conftest.er1 conftest.err
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }
-done
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU C compiler" >&5
-$as_echo_n "checking whether we are using the GNU C compiler... " >&6; }
-if ${ac_cv_c_compiler_gnu+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-#ifndef __GNUC__
-       choke me
-#endif
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_compiler_gnu=yes
-else
-  ac_compiler_gnu=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-ac_cv_c_compiler_gnu=$ac_compiler_gnu
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_compiler_gnu" >&5
-$as_echo "$ac_cv_c_compiler_gnu" >&6; }
-if test $ac_compiler_gnu = yes; then
-  GCC=yes
-else
-  GCC=
-fi
-ac_test_CFLAGS=${CFLAGS+set}
-ac_save_CFLAGS=$CFLAGS
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC accepts -g" >&5
-$as_echo_n "checking whether $CC accepts -g... " >&6; }
-if ${ac_cv_prog_cc_g+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_save_c_werror_flag=$ac_c_werror_flag
-   ac_c_werror_flag=yes
-   ac_cv_prog_cc_g=no
-   CFLAGS="-g"
-   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-int
-main ()
-{
-
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_g=yes
-else
-  CFLAGS=""
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+  CXXFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
 int
 main ()
 {
 
   ;
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
 
 else
-  ac_c_werror_flag=$ac_save_c_werror_flag
-	 CFLAGS="-g"
+  ac_cxx_werror_flag=$ac_save_cxx_werror_flag
+	 CXXFLAGS="-g"
 	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 int
 main ()
 {
 
   ;
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_g=yes
+if ac_fn_cxx_try_compile "$LINENO"; then :
+  ac_cv_prog_cxx_g=yes
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-   ac_c_werror_flag=$ac_save_c_werror_flag
+   ac_cxx_werror_flag=$ac_save_cxx_werror_flag
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_g" >&5
-$as_echo "$ac_cv_prog_cc_g" >&6; }
-if test "$ac_test_CFLAGS" = set; then
-  CFLAGS=$ac_save_CFLAGS
-elif test $ac_cv_prog_cc_g = yes; then
-  if test "$GCC" = yes; then
-    CFLAGS="-g -O2"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cxx_g" >&5
+$as_echo "$ac_cv_prog_cxx_g" >&6; }
+if test "$ac_test_CXXFLAGS" = set; then
+  CXXFLAGS=$ac_save_CXXFLAGS
+elif test $ac_cv_prog_cxx_g = yes; then
+  if test "$GXX" = yes; then
+    CXXFLAGS="-g -O2"
   else
-    CFLAGS="-g"
+    CXXFLAGS="-g"
   fi
 else
-  if test "$GCC" = yes; then
-    CFLAGS="-O2"
+  if test "$GXX" = yes; then
+    CXXFLAGS="-O2"
   else
-    CFLAGS=
+    CXXFLAGS=
   fi
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $CC option to accept ISO C89" >&5
-$as_echo_n "checking for $CC option to accept ISO C89... " >&6; }
-if ${ac_cv_prog_cc_c89+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_prog_cc_c89=no
-ac_save_CC=$CC
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdarg.h>
-#include <stdio.h>
-struct stat;
-/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
-struct buf { int x; };
-FILE * (*rcsopen) (struct buf *, struct stat *, int);
-static char *e (p, i)
-     char **p;
-     int i;
-{
-  return p[i];
-}
-static char *f (char * (*g) (char **, int), char **p, ...)
-{
-  char *s;
-  va_list v;
-  va_start (v,p);
-  s = g (p, va_arg (v,int));
-  va_end (v);
-  return s;
-}
-
-/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
-   function prototypes and stuff, but not '\xHH' hex character constants.
-   These don't provoke an error unfortunately, instead are silently treated
-   as 'x'.  The following induces an error, until -std is added to get
-   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
-   array size at least.  It's necessary to write '\x00'==0 to get something
-   that's true only with -std.  */
-int osf4_cc_array ['\x00' == 0 ? 1 : -1];
-
-/* IBM C 6 for AIX is almost-ANSI by default, but it replaces macro parameters
-   inside strings and character constants.  */
-#define FOO(x) 'x'
-int xlc6_cc_array[FOO(a) == 'x' ? 1 : -1];
-
-int test (int i, double x);
-struct s1 {int (*f) (int a);};
-struct s2 {int (*f) (double a);};
-int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
-int argc;
-char **argv;
-int
-main ()
-{
-return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
-  ;
-  return 0;
-}
-_ACEOF
-for ac_arg in '' -qlanglvl=extc89 -qlanglvl=ansi -std \
-	-Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
-do
-  CC="$ac_save_CC $ac_arg"
-  if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_prog_cc_c89=$ac_arg
-fi
-rm -f core conftest.err conftest.$ac_objext
-  test "x$ac_cv_prog_cc_c89" != "xno" && break
-done
-rm -f conftest.$ac_ext
-CC=$ac_save_CC
-
-fi
-# AC_CACHE_VAL
-case "x$ac_cv_prog_cc_c89" in
-  x)
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: none needed" >&5
-$as_echo "none needed" >&6; } ;;
-  xno)
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported" >&5
-$as_echo "unsupported" >&6; } ;;
-  *)
-    CC="$CC $ac_cv_prog_cc_c89"
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_cc_c89" >&5
-$as_echo "$ac_cv_prog_cc_c89" >&6; } ;;
-esac
-if test "x$ac_cv_prog_cc_c89" != xno; then :
-
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC understands -c and -o together" >&5
-$as_echo_n "checking whether $CC understands -c and -o together... " >&6; }
-if ${am_cv_prog_cc_c_o+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-  # Make sure it works both with $CC and with simple cc.
-  # Following AC_PROG_CC_C_O, we do the test twice because some
-  # compilers refuse to overwrite an existing .o file with -o,
-  # though they will create one.
-  am_cv_prog_cc_c_o=yes
-  for am_i in 1 2; do
-    if { echo "$as_me:$LINENO: $CC -c conftest.$ac_ext -o conftest2.$ac_objext" >&5
-   ($CC -c conftest.$ac_ext -o conftest2.$ac_objext) >&5 2>&5
-   ac_status=$?
-   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-   (exit $ac_status); } \
-         && test -f conftest2.$ac_objext; then
-      : OK
-    else
-      am_cv_prog_cc_c_o=no
-      break
-    fi
-  done
-  rm -f core conftest*
-  unset am_i
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_prog_cc_c_o" >&5
-$as_echo "$am_cv_prog_cc_c_o" >&6; }
-if test "$am_cv_prog_cc_c_o" != yes; then
-   # Losing compiler, so override with the script.
-   # FIXME: It is wrong to rewrite CC.
-   # But if we don't then we get into trouble of one sort or another.
-   # A longer-term fix would be to have automake use am__CC in this case,
-   # and then we could set am__CC="\$(top_srcdir)/compile \$(CC)"
-   CC="$am_aux_dir/compile $CC"
-fi
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
+func_stripname_cnf ()
+{
+  case ${2} in
+  .*) func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%\\\\${2}\$%%"`;;
+  *)  func_stripname_result=`$ECHO "${3}" | $SED "s%^${1}%%; s%${2}\$%%"`;;
+  esac
+} # func_stripname_cnf
 
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
-$as_echo_n "checking how to run the C preprocessor... " >&6; }
-# On Suns, sometimes $CPP names a directory.
-if test -n "$CPP" && test -d "$CPP"; then
-  CPP=
-fi
-if test -z "$CPP"; then
-  if ${ac_cv_prog_CPP+:} false; then :
+      if test -n "$CXX" && ( test "X$CXX" != "Xno" &&
+    ( (test "X$CXX" = "Xg++" && `g++ -v >/dev/null 2>&1` ) ||
+    (test "X$CXX" != "Xg++"))) ; then
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C++ preprocessor" >&5
+$as_echo_n "checking how to run the C++ preprocessor... " >&6; }
+if test -z "$CXXCPP"; then
+  if ${ac_cv_prog_CXXCPP+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-      # Double quotes because CPP needs to be expanded
-    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
+      # Double quotes because CXXCPP needs to be expanded
+    for CXXCPP in "$CXX -E" "/lib/cpp"
     do
       ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
+for ac_cxx_preproc_warn_flag in '' yes
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
   # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
@@ -14740,13 +14894,13 @@
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
 		     Syntax error
 _ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
 else
   # Broken: fails on valid input.
 continue
 fi
 rm -f conftest.err conftest.i conftest.$ac_ext
@@ -14754,13 +14908,13 @@
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
   # Passes both tests.
 ac_preproc_ok=:
 break
@@ -14772,23 +14926,23 @@
 rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
   break
 fi
 
     done
-    ac_cv_prog_CPP=$CPP
+    ac_cv_prog_CXXCPP=$CXXCPP
 
 fi
-  CPP=$ac_cv_prog_CPP
+  CXXCPP=$ac_cv_prog_CXXCPP
 else
-  ac_cv_prog_CPP=$CPP
+  ac_cv_prog_CXXCPP=$CXXCPP
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
-$as_echo "$CPP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CXXCPP" >&5
+$as_echo "$CXXCPP" >&6; }
 ac_preproc_ok=false
-for ac_c_preproc_warn_flag in '' yes
+for ac_cxx_preproc_warn_flag in '' yes
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
   # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
   # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
@@ -14799,13 +14953,13 @@
 # include <limits.h>
 #else
 # include <assert.h>
 #endif
 		     Syntax error
 _ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
+if ac_fn_cxx_try_cpp "$LINENO"; then :
 
 else
   # Broken: fails on valid input.
 continue
 fi
 rm -f conftest.err conftest.i conftest.$ac_ext
@@ -14813,13 +14967,13 @@
   # OK, works on sane cases.  Now check whether nonexistent headers
   # can be detected and how.
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <ac_nonexistent.h>
 _ACEOF
-if ac_fn_c_try_cpp "$LINENO"; then :
+if ac_fn_cxx_try_cpp "$LINENO"; then :
   # Broken: success on invalid input.
 continue
 else
   # Passes both tests.
 ac_preproc_ok=:
 break
@@ -14831,7260 +14985,20581 @@
 rm -f conftest.i conftest.err conftest.$ac_ext
 if $ac_preproc_ok; then :
 
 else
   { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
 $as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+as_fn_error $? "C++ preprocessor \"$CXXCPP\" fails sanity check
 See \`config.log' for more details" "$LINENO" 5; }
 fi
 
 ac_ext=c
 ac_cpp='$CPP $CPPFLAGS'
 ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
-$as_echo_n "checking for egrep... " >&6; }
-if ${ac_cv_path_EGREP+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
-   then ac_cv_path_EGREP="$GREP -E"
-   else
-     if test -z "$EGREP"; then
-  ac_path_EGREP_found=false
-  # Loop through the user's path and test for each of PROGNAME-LIST
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_prog in egrep; do
-    for ac_exec_ext in '' $ac_executable_extensions; do
-      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      as_fn_executable_p "$ac_path_EGREP" || continue
-# Check for GNU ac_path_EGREP and select it if it is found.
-  # Check for GNU $ac_path_EGREP
-case `"$ac_path_EGREP" --version 2>&1` in
-*GNU*)
-  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
-*)
-  ac_count=0
-  $as_echo_n 0123456789 >"conftest.in"
-  while :
-  do
-    cat "conftest.in" "conftest.in" >"conftest.tmp"
-    mv "conftest.tmp" "conftest.in"
-    cp "conftest.in" "conftest.nl"
-    $as_echo 'EGREP' >> "conftest.nl"
-    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
-    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
-    as_fn_arith $ac_count + 1 && ac_count=$as_val
-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
-      # Best one so far, save it but keep looking for a better one
-      ac_cv_path_EGREP="$ac_path_EGREP"
-      ac_path_EGREP_max=$ac_count
-    fi
-    # 10*(2^10) chars as input seems more than enough
-    test $ac_count -gt 10 && break
-  done
-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
-esac
-
-      $ac_path_EGREP_found && break 3
-    done
-  done
-  done
-IFS=$as_save_IFS
-  if test -z "$ac_cv_path_EGREP"; then
-    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
-  fi
 else
-  ac_cv_path_EGREP=$EGREP
+  _lt_caught_CXX_error=yes
 fi
 
-   fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
-$as_echo "$ac_cv_path_EGREP" >&6; }
- EGREP="$ac_cv_path_EGREP"
+ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+archive_cmds_need_lc_CXX=no
+allow_undefined_flag_CXX=
+always_export_symbols_CXX=no
+archive_expsym_cmds_CXX=
+compiler_needs_object_CXX=no
+export_dynamic_flag_spec_CXX=
+hardcode_direct_CXX=no
+hardcode_direct_absolute_CXX=no
+hardcode_libdir_flag_spec_CXX=
+hardcode_libdir_separator_CXX=
+hardcode_minus_L_CXX=no
+hardcode_shlibpath_var_CXX=unsupported
+hardcode_automatic_CXX=no
+inherit_rpath_CXX=no
+module_cmds_CXX=
+module_expsym_cmds_CXX=
+link_all_deplibs_CXX=unknown
+old_archive_cmds_CXX=$old_archive_cmds
+reload_flag_CXX=$reload_flag
+reload_cmds_CXX=$reload_cmds
+no_undefined_flag_CXX=
+whole_archive_flag_spec_CXX=
+enable_shared_with_static_runtimes_CXX=no
 
+# Source file extension for C++ test sources.
+ac_ext=cpp
 
+# Object file extension for compiled C++ test sources.
+objext=o
+objext_CXX=$objext
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
-$as_echo_n "checking whether ln -s works... " >&6; }
-LN_S=$as_ln_s
-if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
-$as_echo "no, using $LN_S" >&6; }
-fi
+# No sense in running all these tests if we already determined that
+# the CXX compiler isn't working.  Some variables (like enable_shared)
+# are currently assumed to apply to all compilers on this platform,
+# and will be corrupted by setting them based on a non-working compiler.
+if test "$_lt_caught_CXX_error" != yes; then
+  # Code to be used in simple compile tests
+  lt_simple_compile_test_code="int some_variable = 0;"
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
-$as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
-set x ${MAKE-make}
-ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
-if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat >conftest.make <<\_ACEOF
-SHELL = /bin/sh
-all:
-	@echo '@@@%%%=$(MAKE)=@@@%%%'
-_ACEOF
-# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
-case `${MAKE-make} -f conftest.make 2>/dev/null` in
-  *@@@%%%=?*=@@@%%%*)
-    eval ac_cv_prog_make_${ac_make}_set=yes;;
-  *)
-    eval ac_cv_prog_make_${ac_make}_set=no;;
-esac
-rm -f conftest.make
-fi
-if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-  SET_MAKE=
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-  SET_MAKE="MAKE=${MAKE-make}"
-fi
+  # Code to be used in simple link tests
+  lt_simple_link_test_code='int main(int, char *[]) { return(0); }'
 
+  # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 
- if test "x$GCC" = "xyes"; then
-  COMPILER_IS_GCC_TRUE=
-  COMPILER_IS_GCC_FALSE='#'
-else
-  COMPILER_IS_GCC_TRUE='#'
-  COMPILER_IS_GCC_FALSE=
-fi
 
 
-# Check whether --enable-static was given.
-if test "${enable_static+set}" = set; then :
-  enableval=$enable_static; p=${PACKAGE-default}
-    case $enableval in
-    yes) enable_static=yes ;;
-    no) enable_static=no ;;
-    *)
-     enable_static=no
-      # Look at the argument we got.  We use all the common list separators.
-      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
-      for pkg in $enableval; do
-	IFS="$lt_save_ifs"
-	if test "X$pkg" = "X$p"; then
-	  enable_static=yes
-	fi
-      done
-      IFS="$lt_save_ifs"
-      ;;
-    esac
-else
-  enable_static=no
-fi
 
 
 
+# If no C compiler was specified, use CC.
+LTCC=${LTCC-"$CC"}
 
+# If no C compiler flags were specified, use CFLAGS.
+LTCFLAGS=${LTCFLAGS-"$CFLAGS"}
 
+# Allow CC to be a program name with arguments.
+compiler=$CC
 
 
-for ac_prog in flex lex
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_LEX+:} false; then :
-  $as_echo_n "(cached) " >&6
+  # save warnings/boilerplate of simple test code
+  ac_outfile=conftest.$ac_objext
+echo "$lt_simple_compile_test_code" >conftest.$ac_ext
+eval "$ac_compile" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$RM conftest*
+
+  ac_outfile=conftest.$ac_objext
+echo "$lt_simple_link_test_code" >conftest.$ac_ext
+eval "$ac_link" 2>&1 >/dev/null | $SED '/^$/d; /^ *+/d' >conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$RM -r conftest*
+
+
+  # Allow CC to be a program name with arguments.
+  lt_save_CC=$CC
+  lt_save_CFLAGS=$CFLAGS
+  lt_save_LD=$LD
+  lt_save_GCC=$GCC
+  GCC=$GXX
+  lt_save_with_gnu_ld=$with_gnu_ld
+  lt_save_path_LD=$lt_cv_path_LD
+  if test -n "${lt_cv_prog_gnu_ldcxx+set}"; then
+    lt_cv_prog_gnu_ld=$lt_cv_prog_gnu_ldcxx
+  else
+    $as_unset lt_cv_prog_gnu_ld
+  fi
+  if test -n "${lt_cv_path_LDCXX+set}"; then
+    lt_cv_path_LD=$lt_cv_path_LDCXX
+  else
+    $as_unset lt_cv_path_LD
+  fi
+  test -z "${LDCXX+set}" || LD=$LDCXX
+  CC=${CXX-"c++"}
+  CFLAGS=$CXXFLAGS
+  compiler=$CC
+  compiler_CXX=$CC
+  for cc_temp in $compiler""; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$ECHO "$cc_temp" | $SED "s%.*/%%; s%^$host_alias-%%"`
+
+
+  if test -n "$compiler"; then
+    # We don't want -fno-exception when compiling C++ code, so set the
+    # no_builtin_flag separately
+    if test "$GXX" = yes; then
+      lt_prog_compiler_no_builtin_flag_CXX=' -fno-builtin'
+    else
+      lt_prog_compiler_no_builtin_flag_CXX=
+    fi
+
+    if test "$GXX" = yes; then
+      # Set up default GNU C++ configuration
+
+
+
+# Check whether --with-gnu-ld was given.
+if test "${with_gnu_ld+set}" = set; then :
+  withval=$with_gnu_ld; test "$withval" = no || with_gnu_ld=yes
 else
-  if test -n "$LEX"; then
-  ac_cv_prog_LEX="$LEX" # Let the user override the test.
+  with_gnu_ld=no
+fi
+
+ac_prog=ld
+if test "$GCC" = yes; then
+  # Check if gcc -print-prog-name=ld gives a path.
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for ld used by $CC" >&5
+$as_echo_n "checking for ld used by $CC... " >&6; }
+  case $host in
+  *-*-mingw*)
+    # gcc leaves a trailing carriage return which upsets mingw
+    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\015'` ;;
+  *)
+    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;
+  esac
+  case $ac_prog in
+    # Accept absolute paths.
+    [\\/]* | ?:[\\/]*)
+      re_direlt='/[^/][^/]*/\.\./'
+      # Canonicalize the pathname of ld
+      ac_prog=`$ECHO "$ac_prog"| $SED 's%\\\\%/%g'`
+      while $ECHO "$ac_prog" | $GREP "$re_direlt" > /dev/null 2>&1; do
+	ac_prog=`$ECHO $ac_prog| $SED "s%$re_direlt%/%"`
+      done
+      test -z "$LD" && LD="$ac_prog"
+      ;;
+  "")
+    # If it fails, then pretend we aren't using GCC.
+    ac_prog=ld
+    ;;
+  *)
+    # If it is relative, then search for the first ld in PATH.
+    with_gnu_ld=unknown
+    ;;
+  esac
+elif test "$with_gnu_ld" = yes; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GNU ld" >&5
+$as_echo_n "checking for GNU ld... " >&6; }
 else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_LEX="$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for non-GNU ld" >&5
+$as_echo_n "checking for non-GNU ld... " >&6; }
+fi
+if ${lt_cv_path_LD+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$LD"; then
+  lt_save_ifs="$IFS"; IFS=$PATH_SEPARATOR
+  for ac_dir in $PATH; do
+    IFS="$lt_save_ifs"
+    test -z "$ac_dir" && ac_dir=.
+    if test -f "$ac_dir/$ac_prog" || test -f "$ac_dir/$ac_prog$ac_exeext"; then
+      lt_cv_path_LD="$ac_dir/$ac_prog"
+      # Check to see if the program is GNU ld.  I'd rather use --version,
+      # but apparently some variants of GNU ld only accept -v.
+      # Break only if it was the GNU/non-GNU ld that we prefer.
+      case `"$lt_cv_path_LD" -v 2>&1 </dev/null` in
+      *GNU* | *'with BFD'*)
+	test "$with_gnu_ld" != no && break
+	;;
+      *)
+	test "$with_gnu_ld" != yes && break
+	;;
+      esac
+    fi
   done
-IFS=$as_save_IFS
-
+  IFS="$lt_save_ifs"
+else
+  lt_cv_path_LD="$LD" # Let the user override the test with a path.
 fi
 fi
-LEX=$ac_cv_prog_LEX
-if test -n "$LEX"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LEX" >&5
-$as_echo "$LEX" >&6; }
+
+LD="$lt_cv_path_LD"
+if test -n "$LD"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LD" >&5
+$as_echo "$LD" >&6; }
 else
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
+test -z "$LD" && as_fn_error $? "no acceptable ld found in \$PATH" "$LINENO" 5
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if the linker ($LD) is GNU ld" >&5
+$as_echo_n "checking if the linker ($LD) is GNU ld... " >&6; }
+if ${lt_cv_prog_gnu_ld+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  # I'd rather use --version here, but apparently some GNU lds only accept -v.
+case `$LD -v 2>&1 </dev/null` in
+*GNU* | *'with BFD'*)
+  lt_cv_prog_gnu_ld=yes
+  ;;
+*)
+  lt_cv_prog_gnu_ld=no
+  ;;
+esac
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_gnu_ld" >&5
+$as_echo "$lt_cv_prog_gnu_ld" >&6; }
+with_gnu_ld=$lt_cv_prog_gnu_ld
 
 
-  test -n "$LEX" && break
-done
-test -n "$LEX" || LEX=":"
 
-if test "x$LEX" != "x:"; then
-  cat >conftest.l <<_ACEOF
-%%
-a { ECHO; }
-b { REJECT; }
-c { yymore (); }
-d { yyless (1); }
-e { /* IRIX 6.5 flex 2.5.4 underquotes its yyless argument.  */
-    yyless ((input () != 0)); }
-f { unput (yytext[0]); }
-. { BEGIN INITIAL; }
-%%
-#ifdef YYTEXT_POINTER
-extern char *yytext;
-#endif
-int
-main (void)
-{
-  return ! yylex () + ! yywrap ();
-}
-_ACEOF
-{ { ac_try="$LEX conftest.l"
-case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
-$as_echo "$ac_try_echo"; } >&5
-  (eval "$LEX conftest.l") 2>&5
-  ac_status=$?
-  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
-  test $ac_status = 0; }
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking lex output file root" >&5
-$as_echo_n "checking lex output file root... " >&6; }
-if ${ac_cv_prog_lex_root+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
 
-if test -f lex.yy.c; then
-  ac_cv_prog_lex_root=lex.yy
-elif test -f lexyy.c; then
-  ac_cv_prog_lex_root=lexyy
-else
-  as_fn_error $? "cannot find output from $LEX; giving up" "$LINENO" 5
-fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_lex_root" >&5
-$as_echo "$ac_cv_prog_lex_root" >&6; }
-LEX_OUTPUT_ROOT=$ac_cv_prog_lex_root
 
-if test -z "${LEXLIB+set}"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking lex library" >&5
-$as_echo_n "checking lex library... " >&6; }
-if ${ac_cv_lib_lex+:} false; then :
+
+
+      # Check if GNU C++ uses GNU ld as the underlying linker, since the
+      # archiving commands below assume that GNU ld is being used.
+      if test "$with_gnu_ld" = yes; then
+        archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+
+        hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
+        export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+
+        # If archive_cmds runs LD, not CC, wlarc should be empty
+        # XXX I think wlarc can be eliminated in ltcf-cxx, but I need to
+        #     investigate it a little bit more. (MM)
+        wlarc='${wl}'
+
+        # ancient GNU ld didn't support --whole-archive et. al.
+        if eval "`$CC -print-prog-name=ld` --help 2>&1" |
+	  $GREP 'no-whole-archive' > /dev/null; then
+          whole_archive_flag_spec_CXX="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+        else
+          whole_archive_flag_spec_CXX=
+        fi
+      else
+        with_gnu_ld=no
+        wlarc=
+
+        # A generic and very simple default shared library creation
+        # command for GNU C++ for the case where it uses the native
+        # linker, instead of GNU ld.  If possible, this setting should
+        # overridden to take advantage of the native linker features on
+        # the platform it is being used on.
+        archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+      fi
+
+      # Commands to make compiler produce verbose output that lists
+      # what "hidden" libraries, object files and flags are used when
+      # linking a shared library.
+      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
+
+    else
+      GXX=no
+      with_gnu_ld=no
+      wlarc=
+    fi
+
+    # PORTME: fill in a description of your system's C++ link characteristics
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
+    ld_shlibs_CXX=yes
+    case $host_os in
+      aix3*)
+        # FIXME: insert proper C++ library support
+        ld_shlibs_CXX=no
+        ;;
+      aix[4-9]*)
+        if test "$host_cpu" = ia64; then
+          # On IA64, the linker does run time linking by default, so we don't
+          # have to do anything special.
+          aix_use_runtimelinking=no
+          exp_sym_flag='-Bexport'
+          no_entry_flag=""
+        else
+          aix_use_runtimelinking=no
+
+          # Test if we are trying to use run time linking or normal
+          # AIX style linking. If -brtl is somewhere in LDFLAGS, we
+          # need to do runtime linking.
+          case $host_os in aix4.[23]|aix4.[23].*|aix[5-9]*)
+	    for ld_flag in $LDFLAGS; do
+	      case $ld_flag in
+	      *-brtl*)
+	        aix_use_runtimelinking=yes
+	        break
+	        ;;
+	      esac
+	    done
+	    ;;
+          esac
+
+          exp_sym_flag='-bexport'
+          no_entry_flag='-bnoentry'
+        fi
+
+        # When large executables or shared objects are built, AIX ld can
+        # have problems creating the table of contents.  If linking a library
+        # or program results in "error TOC overflow" add -mminimal-toc to
+        # CXXFLAGS/CFLAGS for g++/gcc.  In the cases where that is not
+        # enough to fix the problem, add -Wl,-bbigtoc to LDFLAGS.
+
+        archive_cmds_CXX=''
+        hardcode_direct_CXX=yes
+        hardcode_direct_absolute_CXX=yes
+        hardcode_libdir_separator_CXX=':'
+        link_all_deplibs_CXX=yes
+        file_list_spec_CXX='${wl}-f,'
+
+        if test "$GXX" = yes; then
+          case $host_os in aix4.[012]|aix4.[012].*)
+          # We only want to do this on AIX 4.2 and lower, the check
+          # below for broken collect2 doesn't work under 4.3+
+	  collect2name=`${CC} -print-prog-name=collect2`
+	  if test -f "$collect2name" &&
+	     strings "$collect2name" | $GREP resolve_lib_name >/dev/null
+	  then
+	    # We have reworked collect2
+	    :
+	  else
+	    # We have old collect2
+	    hardcode_direct_CXX=unsupported
+	    # It fails to find uninstalled libraries when the uninstalled
+	    # path is not listed in the libpath.  Setting hardcode_minus_L
+	    # to unsupported forces relinking
+	    hardcode_minus_L_CXX=yes
+	    hardcode_libdir_flag_spec_CXX='-L$libdir'
+	    hardcode_libdir_separator_CXX=
+	  fi
+          esac
+          shared_flag='-shared'
+	  if test "$aix_use_runtimelinking" = yes; then
+	    shared_flag="$shared_flag "'${wl}-G'
+	  fi
+        else
+          # not using gcc
+          if test "$host_cpu" = ia64; then
+	  # VisualAge C++, Version 5.5 for AIX 5L for IA-64, Beta 3 Release
+	  # chokes on -Wl,-G. The following line is correct:
+	  shared_flag='-G'
+          else
+	    if test "$aix_use_runtimelinking" = yes; then
+	      shared_flag='${wl}-G'
+	    else
+	      shared_flag='${wl}-bM:SRE'
+	    fi
+          fi
+        fi
+
+        export_dynamic_flag_spec_CXX='${wl}-bexpall'
+        # It seems that -bexpall does not export symbols beginning with
+        # underscore (_), so it is better to generate a list of symbols to
+	# export.
+        always_export_symbols_CXX=yes
+        if test "$aix_use_runtimelinking" = yes; then
+          # Warning - without using the other runtime loading flags (-brtl),
+          # -berok will link without error, but may produce a broken library.
+          allow_undefined_flag_CXX='-berok'
+          # Determine the default libpath from the value encoded in an empty
+          # executable.
+          if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath__CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-
-    ac_save_LIBS=$LIBS
-    ac_cv_lib_lex='none needed'
-    for ac_lib in '' -lfl -ll; do
-      LIBS="$ac_lib $ac_save_LIBS"
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-`cat $LEX_OUTPUT_ROOT.c`
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
 _ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_lex=$ac_lib
+if ac_fn_cxx_try_link "$LINENO"; then :
+
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath__CXX=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-      test "$ac_cv_lib_lex" != 'none needed' && break
-    done
-    LIBS=$ac_save_LIBS
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX="/usr/lib:/lib"
+  fi
 
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_lex" >&5
-$as_echo "$ac_cv_lib_lex" >&6; }
-  test "$ac_cv_lib_lex" != 'none needed' && LEXLIB=$ac_cv_lib_lex
+
+  aix_libpath=$lt_cv_aix_libpath__CXX
 fi
 
+          hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether yytext is a pointer" >&5
-$as_echo_n "checking whether yytext is a pointer... " >&6; }
-if ${ac_cv_prog_lex_yytext_pointer+:} false; then :
+          archive_expsym_cmds_CXX='$CC -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags `if test "x${allow_undefined_flag}" != "x"; then func_echo_all "${wl}${allow_undefined_flag}"; else :; fi` '"\${wl}$exp_sym_flag:\$export_symbols $shared_flag"
+        else
+          if test "$host_cpu" = ia64; then
+	    hardcode_libdir_flag_spec_CXX='${wl}-R $libdir:/usr/lib:/lib'
+	    allow_undefined_flag_CXX="-z nodefs"
+	    archive_expsym_cmds_CXX="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs '"\${wl}$no_entry_flag"' $compiler_flags ${wl}${allow_undefined_flag} '"\${wl}$exp_sym_flag:\$export_symbols"
+          else
+	    # Determine the default libpath from the value encoded in an
+	    # empty executable.
+	    if test "${lt_cv_aix_libpath+set}" = set; then
+  aix_libpath=$lt_cv_aix_libpath
+else
+  if ${lt_cv_aix_libpath__CXX+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  # POSIX says lex can declare yytext either as a pointer or an array; the
-# default is implementation-dependent.  Figure out which it is, since
-# not all implementations provide the %pointer and %array declarations.
-ac_cv_prog_lex_yytext_pointer=no
-ac_save_LIBS=$LIBS
-LIBS="$LEXLIB $ac_save_LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
-  #define YYTEXT_POINTER 1
-`cat $LEX_OUTPUT_ROOT.c`
+int
+main ()
+{
+
+  ;
+  return 0;
+}
 _ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_prog_lex_yytext_pointer=yes
+if ac_fn_cxx_try_link "$LINENO"; then :
+
+  lt_aix_libpath_sed='
+      /Import File Strings/,/^$/ {
+	  /^0/ {
+	      s/^0  *\([^ ]*\) *$/\1/
+	      p
+	  }
+      }'
+  lt_cv_aix_libpath__CXX=`dump -H conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  # Check for a 64-bit object if we didn't find anything.
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX=`dump -HX64 conftest$ac_exeext 2>/dev/null | $SED -n -e "$lt_aix_libpath_sed"`
+  fi
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_save_LIBS
+  if test -z "$lt_cv_aix_libpath__CXX"; then
+    lt_cv_aix_libpath__CXX="/usr/lib:/lib"
+  fi
 
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_lex_yytext_pointer" >&5
-$as_echo "$ac_cv_prog_lex_yytext_pointer" >&6; }
-if test $ac_cv_prog_lex_yytext_pointer = yes; then
-
-$as_echo "#define YYTEXT_POINTER 1" >>confdefs.h
 
+  aix_libpath=$lt_cv_aix_libpath__CXX
 fi
-rm -f conftest.l $LEX_OUTPUT_ROOT.c
 
-fi
-for ac_prog in 'bison -y' byacc
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_YACC+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$YACC"; then
-  ac_cv_prog_YACC="$YACC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_YACC="$ac_prog"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
+	    hardcode_libdir_flag_spec_CXX='${wl}-blibpath:$libdir:'"$aix_libpath"
+	    # Warning - without using the other run time loading flags,
+	    # -berok will link without error, but may produce a broken library.
+	    no_undefined_flag_CXX=' ${wl}-bernotok'
+	    allow_undefined_flag_CXX=' ${wl}-berok'
+	    if test "$with_gnu_ld" = yes; then
+	      # We only use this code for GNU lds that support --whole-archive.
+	      whole_archive_flag_spec_CXX='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    else
+	      # Exported symbols can be pulled into shared objects from archives
+	      whole_archive_flag_spec_CXX='$convenience'
+	    fi
+	    archive_cmds_need_lc_CXX=yes
+	    # This is similar to how AIX traditionally builds its shared
+	    # libraries.
+	    archive_expsym_cmds_CXX="\$CC $shared_flag"' -o $output_objdir/$soname $libobjs $deplibs ${wl}-bnoentry $compiler_flags ${wl}-bE:$export_symbols${allow_undefined_flag}~$AR $AR_FLAGS $output_objdir/$libname$release.a $output_objdir/$soname'
+          fi
+        fi
+        ;;
 
-fi
-fi
-YACC=$ac_cv_prog_YACC
-if test -n "$YACC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $YACC" >&5
-$as_echo "$YACC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
+      beos*)
+	if $LD --help 2>&1 | $GREP ': supported targets:.* elf' > /dev/null; then
+	  allow_undefined_flag_CXX=unsupported
+	  # Joseph Beckenbach <jrb3@best.com> says some releases of gcc
+	  # support --undefined.  This deserves some investigation.  FIXME
+	  archive_cmds_CXX='$CC -nostart $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	else
+	  ld_shlibs_CXX=no
+	fi
+	;;
 
+      chorus*)
+        case $cc_basename in
+          *)
+	  # FIXME: insert proper C++ library support
+	  ld_shlibs_CXX=no
+	  ;;
+        esac
+        ;;
 
-  test -n "$YACC" && break
-done
-test -n "$YACC" || YACC="yacc"
+      cygwin* | mingw* | pw32* | cegcc*)
+	case $GXX,$cc_basename in
+	,cl* | no,cl*)
+	  # Native MSVC
+	  # hardcode_libdir_flag_spec is actually meaningless, as there is
+	  # no search path for DLLs.
+	  hardcode_libdir_flag_spec_CXX=' '
+	  allow_undefined_flag_CXX=unsupported
+	  always_export_symbols_CXX=yes
+	  file_list_spec_CXX='@'
+	  # Tell ltmain to make .lib files, not .a files.
+	  libext=lib
+	  # Tell ltmain to make .dll files, not .so files.
+	  shrext_cmds=".dll"
+	  # FIXME: Setting linknames here is a bad hack.
+	  archive_cmds_CXX='$CC -o $output_objdir/$soname $libobjs $compiler_flags $deplibs -Wl,-dll~linknames='
+	  archive_expsym_cmds_CXX='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      $SED -n -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' -e '1\\\!p' < $export_symbols > $output_objdir/$soname.exp;
+	    else
+	      $SED -e 's/\\\\\\\(.*\\\\\\\)/-link\\\ -EXPORT:\\\\\\\1/' < $export_symbols > $output_objdir/$soname.exp;
+	    fi~
+	    $CC -o $tool_output_objdir$soname $libobjs $compiler_flags $deplibs "@$tool_output_objdir$soname.exp" -Wl,-DLL,-IMPLIB:"$tool_output_objdir$libname.dll.lib"~
+	    linknames='
+	  # The linker will not automatically build a static lib if we build a DLL.
+	  # _LT_TAGVAR(old_archive_from_new_cmds, CXX)='true'
+	  enable_shared_with_static_runtimes_CXX=yes
+	  # Don't use ranlib
+	  old_postinstall_cmds_CXX='chmod 644 $oldlib'
+	  postlink_cmds_CXX='lt_outputfile="@OUTPUT@"~
+	    lt_tool_outputfile="@TOOL_OUTPUT@"~
+	    case $lt_outputfile in
+	      *.exe|*.EXE) ;;
+	      *)
+		lt_outputfile="$lt_outputfile.exe"
+		lt_tool_outputfile="$lt_tool_outputfile.exe"
+		;;
+	    esac~
+	    func_to_tool_file "$lt_outputfile"~
+	    if test "$MANIFEST_TOOL" != ":" && test -f "$lt_outputfile.manifest"; then
+	      $MANIFEST_TOOL -manifest "$lt_tool_outputfile.manifest" -outputresource:"$lt_tool_outputfile" || exit 1;
+	      $RM "$lt_outputfile.manifest";
+	    fi'
+	  ;;
+	*)
+	  # g++
+	  # _LT_TAGVAR(hardcode_libdir_flag_spec, CXX) is actually meaningless,
+	  # as there is no search path for DLLs.
+	  hardcode_libdir_flag_spec_CXX='-L$libdir'
+	  export_dynamic_flag_spec_CXX='${wl}--export-all-symbols'
+	  allow_undefined_flag_CXX=unsupported
+	  always_export_symbols_CXX=no
+	  enable_shared_with_static_runtimes_CXX=yes
+
+	  if $LD --help 2>&1 | $GREP 'auto-import' > /dev/null; then
+	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	    # If the export-symbols file already is a .def file (1st line
+	    # is EXPORTS), use it as is; otherwise, prepend...
+	    archive_expsym_cmds_CXX='if test "x`$SED 1q $export_symbols`" = xEXPORTS; then
+	      cp $export_symbols $output_objdir/$soname.def;
+	    else
+	      echo EXPORTS > $output_objdir/$soname.def;
+	      cat $export_symbols >> $output_objdir/$soname.def;
+	    fi~
+	    $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--enable-auto-image-base -Xlinker --out-implib -Xlinker $lib'
+	  else
+	    ld_shlibs_CXX=no
+	  fi
+	  ;;
+	esac
+	;;
+      darwin* | rhapsody*)
 
 
-# Warn when pkg.m4 is missing
+  archive_cmds_need_lc_CXX=no
+  hardcode_direct_CXX=no
+  hardcode_automatic_CXX=yes
+  hardcode_shlibpath_var_CXX=unsupported
+  if test "$lt_cv_ld_force_load" = "yes"; then
+    whole_archive_flag_spec_CXX='`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience ${wl}-force_load,$conv\"; done; func_echo_all \"$new_convenience\"`'
 
+  else
+    whole_archive_flag_spec_CXX=''
+  fi
+  link_all_deplibs_CXX=yes
+  allow_undefined_flag_CXX="$_lt_dar_allow_undefined"
+  case $cc_basename in
+     ifort*) _lt_dar_can_shared=yes ;;
+     *) _lt_dar_can_shared=$GCC ;;
+  esac
+  if test "$_lt_dar_can_shared" = "yes"; then
+    output_verbose_link_cmd=func_echo_all
+    archive_cmds_CXX="\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring $_lt_dar_single_mod${_lt_dsymutil}"
+    module_cmds_CXX="\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dsymutil}"
+    archive_expsym_cmds_CXX="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \$libobjs \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring ${_lt_dar_single_mod}${_lt_dar_export_syms}${_lt_dsymutil}"
+    module_expsym_cmds_CXX="sed -e 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC \$allow_undefined_flag -o \$lib -bundle \$libobjs \$deplibs \$compiler_flags${_lt_dar_export_syms}${_lt_dsymutil}"
+       if test "$lt_cv_apple_cc_single_mod" != "yes"; then
+      archive_cmds_CXX="\$CC -r -keep_private_externs -nostdlib -o \${lib}-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \${lib}-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring${_lt_dsymutil}"
+      archive_expsym_cmds_CXX="sed 's,^,_,' < \$export_symbols > \$output_objdir/\${libname}-symbols.expsym~\$CC -r -keep_private_externs -nostdlib -o \${lib}-master.o \$libobjs~\$CC -dynamiclib \$allow_undefined_flag -o \$lib \${lib}-master.o \$deplibs \$compiler_flags -install_name \$rpath/\$soname \$verstring${_lt_dar_export_syms}${_lt_dsymutil}"
+    fi
 
+  else
+  ld_shlibs_CXX=no
+  fi
 
+	;;
 
+      dgux*)
+        case $cc_basename in
+          ec++*)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          ghcx*)
+	    # Green Hills C++ Compiler
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          *)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+        esac
+        ;;
 
+      freebsd2.*)
+        # C++ shared libraries reported to be fairly broken before
+	# switch to ELF
+        ld_shlibs_CXX=no
+        ;;
 
+      freebsd-elf*)
+        archive_cmds_need_lc_CXX=no
+        ;;
 
+      freebsd* | dragonfly*)
+        # FreeBSD 3 and later use GNU C++ and GNU ld with standard ELF
+        # conventions
+        ld_shlibs_CXX=yes
+        ;;
 
+      haiku*)
+        archive_cmds_CXX='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+        link_all_deplibs_CXX=yes
+        ;;
 
-if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
-	if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
-set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
+      hpux9*)
+        hardcode_libdir_flag_spec_CXX='${wl}+b ${wl}$libdir'
+        hardcode_libdir_separator_CXX=:
+        export_dynamic_flag_spec_CXX='${wl}-E'
+        hardcode_direct_CXX=yes
+        hardcode_minus_L_CXX=yes # Not in the search PATH,
+				             # but as the default
+				             # location of the library.
 
-  ;;
-esac
-fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
-if test -n "$PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
-$as_echo "$PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
+        case $cc_basename in
+          CC*)
+            # FIXME: insert proper C++ library support
+            ld_shlibs_CXX=no
+            ;;
+          aCC*)
+            archive_cmds_CXX='$RM $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+            # Commands to make compiler produce verbose output that lists
+            # what "hidden" libraries, object files and flags are used when
+            # linking a shared library.
+            #
+            # There doesn't appear to be a way to prevent this compiler from
+            # explicitly linking system object files so we need to strip them
+            # from the output so that they don't get included in the library
+            # dependencies.
+            output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $EGREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+            ;;
+          *)
+            if test "$GXX" = yes; then
+              archive_cmds_CXX='$RM $output_objdir/$soname~$CC -shared -nostdlib $pic_flag ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+            else
+              # FIXME: insert proper C++ library support
+              ld_shlibs_CXX=no
+            fi
+            ;;
+        esac
+        ;;
 
+      hpux10*|hpux11*)
+        if test $with_gnu_ld = no; then
+	  hardcode_libdir_flag_spec_CXX='${wl}+b ${wl}$libdir'
+	  hardcode_libdir_separator_CXX=:
 
-fi
-if test -z "$ac_cv_path_PKG_CONFIG"; then
-  ac_pt_PKG_CONFIG=$PKG_CONFIG
-  # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $ac_pt_PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
+          case $host_cpu in
+            hppa*64*|ia64*)
+              ;;
+            *)
+	      export_dynamic_flag_spec_CXX='${wl}-E'
+              ;;
+          esac
+        fi
+        case $host_cpu in
+          hppa*64*|ia64*)
+            hardcode_direct_CXX=no
+            hardcode_shlibpath_var_CXX=no
+            ;;
+          *)
+            hardcode_direct_CXX=yes
+            hardcode_direct_absolute_CXX=yes
+            hardcode_minus_L_CXX=yes # Not in the search PATH,
+					         # but as the default
+					         # location of the library.
+            ;;
+        esac
 
-  ;;
-esac
-fi
-ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
-if test -n "$ac_pt_PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
-$as_echo "$ac_pt_PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
+        case $cc_basename in
+          CC*)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          aCC*)
+	    case $host_cpu in
+	      hppa*64*)
+	        archive_cmds_CXX='$CC -b ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        ;;
+	      ia64*)
+	        archive_cmds_CXX='$CC -b ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        ;;
+	      *)
+	        archive_cmds_CXX='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	        ;;
+	    esac
+	    # Commands to make compiler produce verbose output that lists
+	    # what "hidden" libraries, object files and flags are used when
+	    # linking a shared library.
+	    #
+	    # There doesn't appear to be a way to prevent this compiler from
+	    # explicitly linking system object files so we need to strip them
+	    # from the output so that they don't get included in the library
+	    # dependencies.
+	    output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2>&1) | $GREP "\-L"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+	    ;;
+          *)
+	    if test "$GXX" = yes; then
+	      if test $with_gnu_ld = no; then
+	        case $host_cpu in
+	          hppa*64*)
+	            archive_cmds_CXX='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            ;;
+	          ia64*)
+	            archive_cmds_CXX='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+nodefaultrpath -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            ;;
+	          *)
+	            archive_cmds_CXX='$CC -shared -nostdlib $pic_flag ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	            ;;
+	        esac
+	      fi
+	    else
+	      # FIXME: insert proper C++ library support
+	      ld_shlibs_CXX=no
+	    fi
+	    ;;
+        esac
+        ;;
 
-  if test "x$ac_pt_PKG_CONFIG" = x; then
-    PKG_CONFIG=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    PKG_CONFIG=$ac_pt_PKG_CONFIG
-  fi
-else
-  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
-fi
+      interix[3-9]*)
+	hardcode_direct_CXX=no
+	hardcode_shlibpath_var_CXX=no
+	hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+	export_dynamic_flag_spec_CXX='${wl}-E'
+	# Hack: On Interix 3.x, we cannot compile PIC because of a broken gcc.
+	# Instead, shared libraries are loaded at an image base (0x10000000 by
+	# default) and relocated if they conflict, which is a slow very memory
+	# consuming and fragmenting process.  To avoid this, we pick a random,
+	# 256 KiB-aligned image base between 0x50000000 and 0x6FFC0000 at link
+	# time.  Moving up from 0x10000000 also allows more sbrk(2) space.
+	archive_cmds_CXX='$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+	archive_expsym_cmds_CXX='sed "s,^,_," $export_symbols >$output_objdir/$soname.expsym~$CC -shared $pic_flag $libobjs $deplibs $compiler_flags ${wl}-h,$soname ${wl}--retain-symbols-file,$output_objdir/$soname.expsym ${wl}--image-base,`expr ${RANDOM-$$} % 4096 / 2 \* 262144 + 1342177280` -o $lib'
+	;;
+      irix5* | irix6*)
+        case $cc_basename in
+          CC*)
+	    # SGI C++
+	    archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+
+	    # Archives containing C++ object files must be created using
+	    # "CC -ar", where "CC" is the IRIX C++ compiler.  This is
+	    # necessary to make sure instantiated templates are included
+	    # in the archive.
+	    old_archive_cmds_CXX='$CC -ar -WR,-u -o $oldlib $oldobjs'
+	    ;;
+          *)
+	    if test "$GXX" = yes; then
+	      if test "$with_gnu_ld" = no; then
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+	      else
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` -o $lib'
+	      fi
+	    fi
+	    link_all_deplibs_CXX=yes
+	    ;;
+        esac
+        hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
+        hardcode_libdir_separator_CXX=:
+        inherit_rpath_CXX=yes
+        ;;
 
-fi
-if test -n "$PKG_CONFIG"; then
-	_pkg_min_version=0.9.0
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
-$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
-	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-		PKG_CONFIG=""
-	fi
-fi
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+        case $cc_basename in
+          KCC*)
+	    # Kuck and Associates, Inc. (KAI) C++ Compiler
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if bison is the parser generator" >&5
-$as_echo_n "checking if bison is the parser generator... " >&6; }
-if ${collectd_cv_prog_bison+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if $YACC --version 2>/dev/null | $EGREP -q '^bison '; then :
-  collectd_cv_prog_bison=yes
-else
-  collectd_cv_prog_bison=no
+	    # KCC will only create a shared library if the output file
+	    # ends with ".so" (or ".sl" for HP-UX), so rename the library
+	    # to its proper name (with version) after linking.
+	    archive_cmds_CXX='tempext=`echo $shared_ext | $SED -e '\''s/\([^()0-9A-Za-z{}]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	    archive_expsym_cmds_CXX='tempext=`echo $shared_ext | $SED -e '\''s/\([^()0-9A-Za-z{}]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib ${wl}-retain-symbols-file,$export_symbols; mv \$templib $lib'
+	    # Commands to make compiler produce verbose output that lists
+	    # what "hidden" libraries, object files and flags are used when
+	    # linking a shared library.
+	    #
+	    # There doesn't appear to be a way to prevent this compiler from
+	    # explicitly linking system object files so we need to strip them
+	    # from the output so that they don't get included in the library
+	    # dependencies.
+	    output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1 | $GREP "ld"`; rm -f libconftest$shared_ext; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+
+	    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+
+	    # Archives containing C++ object files must be created using
+	    # "CC -Bstatic", where "CC" is the KAI C++ compiler.
+	    old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs'
+	    ;;
+	  icpc* | ecpc* )
+	    # Intel C++
+	    with_gnu_ld=yes
+	    # version 8.0 and above of icpc choke on multiply defined symbols
+	    # if we add $predep_objects and $postdep_objects, however 7.1 and
+	    # earlier do not add the objects themselves.
+	    case `$CC -V 2>&1` in
+	      *"Version 7."*)
+	        archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+		archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+		;;
+	      *)  # Version 8.0 or newer
+	        tmp_idyn=
+	        case $host_cpu in
+		  ia64*) tmp_idyn=' -i_dynamic';;
+		esac
+	        archive_cmds_CXX='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+		archive_expsym_cmds_CXX='$CC -shared'"$tmp_idyn"' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+		;;
+	    esac
+	    archive_cmds_need_lc_CXX=no
+	    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+	    whole_archive_flag_spec_CXX='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
+	    ;;
+          pgCC* | pgcpp*)
+            # Portland Group C++ compiler
+	    case `$CC -V` in
+	    *pgCC\ [1-5].* | *pgcpp\ [1-5].*)
+	      prelink_cmds_CXX='tpldir=Template.dir~
+		rm -rf $tpldir~
+		$CC --prelink_objects --instantiation_dir $tpldir $objs $libobjs $compile_deplibs~
+		compile_command="$compile_command `find $tpldir -name \*.o | sort | $NL2SP`"'
+	      old_archive_cmds_CXX='tpldir=Template.dir~
+		rm -rf $tpldir~
+		$CC --prelink_objects --instantiation_dir $tpldir $oldobjs$old_deplibs~
+		$AR $AR_FLAGS $oldlib$oldobjs$old_deplibs `find $tpldir -name \*.o | sort | $NL2SP`~
+		$RANLIB $oldlib'
+	      archive_cmds_CXX='tpldir=Template.dir~
+		rm -rf $tpldir~
+		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+	      archive_expsym_cmds_CXX='tpldir=Template.dir~
+		rm -rf $tpldir~
+		$CC --prelink_objects --instantiation_dir $tpldir $predep_objects $libobjs $deplibs $convenience $postdep_objects~
+		$CC -shared $pic_flag $predep_objects $libobjs $deplibs `find $tpldir -name \*.o | sort | $NL2SP` $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+	      ;;
+	    *) # Version 6 and above use weak symbols
+	      archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+	      archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+	      ;;
+	    esac
 
-fi
+	    hardcode_libdir_flag_spec_CXX='${wl}--rpath ${wl}$libdir'
+	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+	    whole_archive_flag_spec_CXX='${wl}--whole-archive`for conv in $convenience\"\"; do test  -n \"$conv\" && new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+            ;;
+	  cxx*)
+	    # Compaq C++
+	    archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	    archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname  -o $lib ${wl}-retain-symbols-file $wl$export_symbols'
+
+	    runpath_var=LD_RUN_PATH
+	    hardcode_libdir_flag_spec_CXX='-rpath $libdir'
+	    hardcode_libdir_separator_CXX=:
+
+	    # Commands to make compiler produce verbose output that lists
+	    # what "hidden" libraries, object files and flags are used when
+	    # linking a shared library.
+	    #
+	    # There doesn't appear to be a way to prevent this compiler from
+	    # explicitly linking system object files so we need to strip them
+	    # from the output so that they don't get included in the library
+	    # dependencies.
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld .*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "X$list" | $Xsed'
+	    ;;
+	  xl* | mpixl* | bgxl*)
+	    # IBM XL 8.0 on PPC, with GNU ld
+	    hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
+	    export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+	    archive_cmds_CXX='$CC -qmkshrobj $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	    if test "x$supports_anon_versioning" = xyes; then
+	      archive_expsym_cmds_CXX='echo "{ global:" > $output_objdir/$libname.ver~
+		cat $export_symbols | sed -e "s/\(.*\)/\1;/" >> $output_objdir/$libname.ver~
+		echo "local: *; };" >> $output_objdir/$libname.ver~
+		$CC -qmkshrobj $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+	    fi
+	    ;;
+	  *)
+	    case `$CC -V 2>&1 | sed 5q` in
+	    *Sun\ C*)
+	      # Sun C++ 5.9
+	      no_undefined_flag_CXX=' -zdefs'
+	      archive_cmds_CXX='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	      archive_expsym_cmds_CXX='$CC -G${allow_undefined_flag} -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file ${wl}$export_symbols'
+	      hardcode_libdir_flag_spec_CXX='-R$libdir'
+	      whole_archive_flag_spec_CXX='${wl}--whole-archive`new_convenience=; for conv in $convenience\"\"; do test -z \"$conv\" || new_convenience=\"$new_convenience,$conv\"; done; func_echo_all \"$new_convenience\"` ${wl}--no-whole-archive'
+	      compiler_needs_object_CXX=yes
+
+	      # Not sure whether something based on
+	      # $CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2>&1
+	      # would be better.
+	      output_verbose_link_cmd='func_echo_all'
+
+	      # Archives containing C++ object files must be created using
+	      # "CC -xar", where "CC" is the Sun C++ compiler.  This is
+	      # necessary to make sure instantiated templates are included
+	      # in the archive.
+	      old_archive_cmds_CXX='$CC -xar -o $oldlib $oldobjs'
+	      ;;
+	    esac
+	    ;;
+	esac
+	;;
 
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $collectd_cv_prog_bison" >&5
-$as_echo "$collectd_cv_prog_bison" >&6; }
+      lynxos*)
+        # FIXME: insert proper C++ library support
+	ld_shlibs_CXX=no
+	;;
 
-if test "x$collectd_cv_prog_bison" = "xno" && test ! -f "${srcdir}/src/liboconfig/parser.c"
-then
-	as_fn_error $? "bison is missing and you do not have ${srcdir}/src/liboconfig/parser.c. Please install bison" "$LINENO" 5
-fi
+      m88k*)
+        # FIXME: insert proper C++ library support
+        ld_shlibs_CXX=no
+	;;
 
-# Extract the first word of "protoc-c", so it can be a program name with args.
-set dummy protoc-c; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_prog_have_protoc_c+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test -n "$have_protoc_c"; then
-  ac_cv_prog_have_protoc_c="$have_protoc_c" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_have_protoc_c="yes"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
+      mvs*)
+        case $cc_basename in
+          cxx*)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+	  *)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+	esac
+	;;
 
-  test -z "$ac_cv_prog_have_protoc_c" && ac_cv_prog_have_protoc_c="no"
-fi
-fi
-have_protoc_c=$ac_cv_prog_have_protoc_c
-if test -n "$have_protoc_c"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $have_protoc_c" >&5
-$as_echo "$have_protoc_c" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-fi
+      netbsd*)
+        if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
+	  archive_cmds_CXX='$LD -Bshareable  -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags'
+	  wlarc=
+	  hardcode_libdir_flag_spec_CXX='-R$libdir'
+	  hardcode_direct_CXX=yes
+	  hardcode_shlibpath_var_CXX=no
+	fi
+	# Workaround some broken pre-1.5 toolchains
+	output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP conftest.$objext | $SED -e "s:-lgcc -lc -lgcc::"'
+	;;
 
+      *nto* | *qnx*)
+        ld_shlibs_CXX=yes
+	;;
 
-if test "x$have_protoc_c" = "xno"
-then
-	have_protoc_c="no (protoc-c compiler not found)"
-fi
+      openbsd2*)
+        # C++ shared libraries are fairly broken
+	ld_shlibs_CXX=no
+	;;
 
-if test "x$have_protoc_c" = "xyes"
-then
-	for ac_header in protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
- have_protoc_c="yes"; break
-else
-  have_protoc_c="no (<google/protobuf-c/protobuf-c.h> not found)"
-fi
+      openbsd*)
+	if test -f /usr/libexec/ld.so; then
+	  hardcode_direct_CXX=yes
+	  hardcode_shlibpath_var_CXX=no
+	  hardcode_direct_absolute_CXX=yes
+	  archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+	  hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+	  if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+	    archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file,$export_symbols -o $lib'
+	    export_dynamic_flag_spec_CXX='${wl}-E'
+	    whole_archive_flag_spec_CXX="$wlarc"'--whole-archive$convenience '"$wlarc"'--no-whole-archive'
+	  fi
+	  output_verbose_link_cmd=func_echo_all
+	else
+	  ld_shlibs_CXX=no
+	fi
+	;;
 
-done
+      osf3* | osf4* | osf5*)
+        case $cc_basename in
+          KCC*)
+	    # Kuck and Associates, Inc. (KAI) C++ Compiler
 
-fi
-if test "x$have_protoc_c" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for protobuf_c_message_pack in -lprotobuf-c" >&5
-$as_echo_n "checking for protobuf_c_message_pack in -lprotobuf-c... " >&6; }
-if ${ac_cv_lib_protobuf_c_protobuf_c_message_pack+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lprotobuf-c  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	    # KCC will only create a shared library if the output file
+	    # ends with ".so" (or ".sl" for HP-UX), so rename the library
+	    # to its proper name (with version) after linking.
+	    archive_cmds_CXX='tempext=`echo $shared_ext | $SED -e '\''s/\([^()0-9A-Za-z{}]\)/\\\\\1/g'\''`; templib=`echo "$lib" | $SED -e "s/\${tempext}\..*/.so/"`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+
+	    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+	    hardcode_libdir_separator_CXX=:
+
+	    # Archives containing C++ object files must be created using
+	    # the KAI C++ compiler.
+	    case $host in
+	      osf3*) old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs' ;;
+	      *) old_archive_cmds_CXX='$CC -o $oldlib $oldobjs' ;;
+	    esac
+	    ;;
+          RCC*)
+	    # Rational C++ 2.4.1
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          cxx*)
+	    case $host in
+	      osf3*)
+	        allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
+	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n "$verstring" && func_echo_all "${wl}-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	        hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
+		;;
+	      *)
+	        allow_undefined_flag_CXX=' -expect_unresolved \*'
+	        archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n "$verstring" && func_echo_all "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib'
+	        archive_expsym_cmds_CXX='for i in `cat $export_symbols`; do printf "%s %s\\n" -exported_symbol "\$i" >> $lib.exp; done~
+	          echo "-hidden">> $lib.exp~
+	          $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname ${wl}-input ${wl}$lib.exp  `test -n "$verstring" && $ECHO "-set_version $verstring"` -update_registry ${output_objdir}/so_locations -o $lib~
+	          $RM $lib.exp'
+	        hardcode_libdir_flag_spec_CXX='-rpath $libdir'
+		;;
+	    esac
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char protobuf_c_message_pack ();
-int
-main ()
-{
-return protobuf_c_message_pack ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_protobuf_c_protobuf_c_message_pack=yes
-else
-  ac_cv_lib_protobuf_c_protobuf_c_message_pack=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_protobuf_c_protobuf_c_message_pack" >&5
-$as_echo "$ac_cv_lib_protobuf_c_protobuf_c_message_pack" >&6; }
-if test "x$ac_cv_lib_protobuf_c_protobuf_c_message_pack" = xyes; then :
-  have_protoc_c="yes"
-else
-  have_protoc_c="no (libprotobuf-c not found)"
-fi
+	    hardcode_libdir_separator_CXX=:
 
+	    # Commands to make compiler produce verbose output that lists
+	    # what "hidden" libraries, object files and flags are used when
+	    # linking a shared library.
+	    #
+	    # There doesn't appear to be a way to prevent this compiler from
+	    # explicitly linking system object files so we need to strip them
+	    # from the output so that they don't get included in the library
+	    # dependencies.
+	    output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP "ld" | $GREP -v "ld:"`; templist=`func_echo_all "$templist" | $SED "s/\(^.*ld.*\)\( .*ld.*$\)/\1/"`; list=""; for z in $templist; do case $z in conftest.$objext) list="$list $z";; *.$objext);; *) list="$list $z";;esac; done; func_echo_all "$list"'
+	    ;;
+	  *)
+	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
+	      allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
+	      case $host in
+	        osf3*)
+	          archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+		  ;;
+	        *)
+	          archive_cmds_CXX='$CC -shared $pic_flag -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n "$verstring" && func_echo_all "${wl}-set_version ${wl}$verstring"` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
+		  ;;
+	      esac
+
+	      hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
+	      hardcode_libdir_separator_CXX=:
+
+	      # Commands to make compiler produce verbose output that lists
+	      # what "hidden" libraries, object files and flags are used when
+	      # linking a shared library.
+	      output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
 
-fi
- if test "x$have_protoc_c" = "xyes"; then
-  HAVE_PROTOC_C_TRUE=
-  HAVE_PROTOC_C_FALSE='#'
-else
-  HAVE_PROTOC_C_TRUE='#'
-  HAVE_PROTOC_C_FALSE=
-fi
+	    else
+	      # FIXME: insert proper C++ library support
+	      ld_shlibs_CXX=no
+	    fi
+	    ;;
+        esac
+        ;;
 
+      psos*)
+        # FIXME: insert proper C++ library support
+        ld_shlibs_CXX=no
+        ;;
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kernel type ($host_os)" >&5
-$as_echo_n "checking for kernel type ($host_os)... " >&6; }
-case $host_os in
-	*linux*)
+      sunos4*)
+        case $cc_basename in
+          CC*)
+	    # Sun C++ 4.x
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          lcc*)
+	    # Lucid
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          *)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+        esac
+        ;;
 
-$as_echo "#define KERNEL_LINUX 1" >>confdefs.h
+      solaris*)
+        case $cc_basename in
+          CC* | sunCC*)
+	    # Sun C++ 4.2, 5.x and Centerline C++
+            archive_cmds_need_lc_CXX=yes
+	    no_undefined_flag_CXX=' -zdefs'
+	    archive_cmds_CXX='$CC -G${allow_undefined_flag}  -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
+	    archive_expsym_cmds_CXX='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+	      $CC -G${allow_undefined_flag} ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+
+	    hardcode_libdir_flag_spec_CXX='-R$libdir'
+	    hardcode_shlibpath_var_CXX=no
+	    case $host_os in
+	      solaris2.[0-5] | solaris2.[0-5].*) ;;
+	      *)
+		# The compiler driver will combine and reorder linker options,
+		# but understands `-z linker_flag'.
+	        # Supported since Solaris 2.6 (maybe 2.5.1?)
+		whole_archive_flag_spec_CXX='-z allextract$convenience -z defaultextract'
+	        ;;
+	    esac
+	    link_all_deplibs_CXX=yes
 
-	ac_system="Linux"
-	;;
-	*solaris*)
+	    output_verbose_link_cmd='func_echo_all'
 
-$as_echo "#define KERNEL_SOLARIS 1" >>confdefs.h
+	    # Archives containing C++ object files must be created using
+	    # "CC -xar", where "CC" is the Sun C++ compiler.  This is
+	    # necessary to make sure instantiated templates are included
+	    # in the archive.
+	    old_archive_cmds_CXX='$CC -xar -o $oldlib $oldobjs'
+	    ;;
+          gcx*)
+	    # Green Hills C++ Compiler
+	    archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 
-	ac_system="Solaris"
+	    # The C++ compiler must be used to create the archive.
+	    old_archive_cmds_CXX='$CC $LDFLAGS -archive -o $oldlib $oldobjs'
+	    ;;
+          *)
+	    # GNU C++ compiler with Solaris linker
+	    if test "$GXX" = yes && test "$with_gnu_ld" = no; then
+	      no_undefined_flag_CXX=' ${wl}-z ${wl}defs'
+	      if $CC --version | $GREP -v '^2\.7' > /dev/null; then
+	        archive_cmds_CXX='$CC -shared $pic_flag -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        archive_expsym_cmds_CXX='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+		  $CC -shared $pic_flag -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+
+	        # Commands to make compiler produce verbose output that lists
+	        # what "hidden" libraries, object files and flags are used when
+	        # linking a shared library.
+	        output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
+	      else
+	        # g++ 2.7 appears to require `-G' NOT `-shared' on this
+	        # platform.
+	        archive_cmds_CXX='$CC -G -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	        archive_expsym_cmds_CXX='echo "{ global:" > $lib.exp~cat $export_symbols | $SED -e "s/\(.*\)/\1;/" >> $lib.exp~echo "local: *; };" >> $lib.exp~
+		  $CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$RM $lib.exp'
+
+	        # Commands to make compiler produce verbose output that lists
+	        # what "hidden" libraries, object files and flags are used when
+	        # linking a shared library.
+	        output_verbose_link_cmd='$CC -G $CFLAGS -v conftest.$objext 2>&1 | $GREP -v "^Configured with:" | $GREP "\-L"'
+	      fi
+
+	      hardcode_libdir_flag_spec_CXX='${wl}-R $wl$libdir'
+	      case $host_os in
+		solaris2.[0-5] | solaris2.[0-5].*) ;;
+		*)
+		  whole_archive_flag_spec_CXX='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+		  ;;
+	      esac
+	    fi
+	    ;;
+        esac
 	;;
-	*darwin*)
 
-$as_echo "#define KERNEL_DARWIN 1" >>confdefs.h
+    sysv4*uw2* | sysv5OpenUNIX* | sysv5UnixWare7.[01].[10]* | unixware7* | sco3.2v5.0.[024]*)
+      no_undefined_flag_CXX='${wl}-z,text'
+      archive_cmds_need_lc_CXX=no
+      hardcode_shlibpath_var_CXX=no
+      runpath_var='LD_RUN_PATH'
 
-	ac_system="Darwin"
-	;;
-	*openbsd*)
+      case $cc_basename in
+        CC*)
+	  archive_cmds_CXX='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_expsym_cmds_CXX='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	*)
+	  archive_cmds_CXX='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  archive_expsym_cmds_CXX='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+      esac
+      ;;
 
-$as_echo "#define KERNEL_OPENBSD 1" >>confdefs.h
+      sysv5* | sco3.2v5* | sco5v6*)
+	# Note: We can NOT use -z defs as we might desire, because we do not
+	# link with -lc, and that would cause any symbols used from libc to
+	# always be unresolved, which means just about no library would
+	# ever link correctly.  If we're not using GNU ld we use -z text
+	# though, which does catch some bad symbols but isn't as heavy-handed
+	# as -z defs.
+	no_undefined_flag_CXX='${wl}-z,text'
+	allow_undefined_flag_CXX='${wl}-z,nodefs'
+	archive_cmds_need_lc_CXX=no
+	hardcode_shlibpath_var_CXX=no
+	hardcode_libdir_flag_spec_CXX='${wl}-R,$libdir'
+	hardcode_libdir_separator_CXX=':'
+	link_all_deplibs_CXX=yes
+	export_dynamic_flag_spec_CXX='${wl}-Bexport'
+	runpath_var='LD_RUN_PATH'
 
-	ac_system="OpenBSD"
+	case $cc_basename in
+          CC*)
+	    archive_cmds_CXX='$CC -G ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    archive_expsym_cmds_CXX='$CC -G ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    old_archive_cmds_CXX='$CC -Tprelink_objects $oldobjs~
+	      '"$old_archive_cmds_CXX"
+	    reload_cmds_CXX='$CC -Tprelink_objects $reload_objs~
+	      '"$reload_cmds_CXX"
+	    ;;
+	  *)
+	    archive_cmds_CXX='$CC -shared ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    archive_expsym_cmds_CXX='$CC -shared ${wl}-Bexport:$export_symbols ${wl}-h,$soname -o $lib $libobjs $deplibs $compiler_flags'
+	    ;;
+	esac
+      ;;
+
+      tandem*)
+        case $cc_basename in
+          NCC*)
+	    # NonStop-UX NCC 3.20
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+          *)
+	    # FIXME: insert proper C++ library support
+	    ld_shlibs_CXX=no
+	    ;;
+        esac
 	;;
-	*aix*)
 
-$as_echo "#define KERNEL_AIX 1" >>confdefs.h
+      vxworks*)
+        # FIXME: insert proper C++ library support
+        ld_shlibs_CXX=no
+        ;;
 
-	ac_system="AIX"
+      *)
+        # FIXME: insert proper C++ library support
+        ld_shlibs_CXX=no
 	;;
-	*freebsd*)
+    esac
 
-$as_echo "#define KERNEL_FREEBSD 1" >>confdefs.h
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
+$as_echo "$ld_shlibs_CXX" >&6; }
+    test "$ld_shlibs_CXX" = no && can_build_shared=no
+
+    GCC_CXX="$GXX"
+    LD_CXX="$LD"
+
+    ## CAVEAT EMPTOR:
+    ## There is no encapsulation within the following macros, do not change
+    ## the running order or otherwise move them around unless you know exactly
+    ## what you are doing...
+    # Dependencies to place before and after the object being linked:
+predep_objects_CXX=
+postdep_objects_CXX=
+predeps_CXX=
+postdeps_CXX=
+compiler_lib_search_path_CXX=
+
+cat > conftest.$ac_ext <<_LT_EOF
+class Foo
+{
+public:
+  Foo (void) { a = 0; }
+private:
+  int a;
+};
+_LT_EOF
 
-	ac_system="FreeBSD"
-	;;
-	*)
-	ac_system="unknown"
+
+_lt_libdeps_save_CFLAGS=$CFLAGS
+case "$CC $CFLAGS " in #(
+*\ -flto*\ *) CFLAGS="$CFLAGS -fno-lto" ;;
+*\ -fwhopr*\ *) CFLAGS="$CFLAGS -fno-whopr" ;;
+*\ -fuse-linker-plugin*\ *) CFLAGS="$CFLAGS -fno-use-linker-plugin" ;;
 esac
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_system" >&5
-$as_echo "$ac_system" >&6; }
 
- if test "x$ac_system" = "xLinux"; then
-  BUILD_LINUX_TRUE=
-  BUILD_LINUX_FALSE='#'
-else
-  BUILD_LINUX_TRUE='#'
-  BUILD_LINUX_FALSE=
-fi
+if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  # Parse the compiler output and extract the necessary
+  # objects, libraries and library flags.
 
- if test "x$ac_system" = "xSolaris"; then
-  BUILD_SOLARIS_TRUE=
-  BUILD_SOLARIS_FALSE='#'
-else
-  BUILD_SOLARIS_TRUE='#'
-  BUILD_SOLARIS_FALSE=
-fi
+  # Sentinel used to keep track of whether or not we are before
+  # the conftest object file.
+  pre_test_object_deps_done=no
+
+  for p in `eval "$output_verbose_link_cmd"`; do
+    case ${prev}${p} in
+
+    -L* | -R* | -l*)
+       # Some compilers place space between "-{L,R}" and the path.
+       # Remove the space.
+       if test $p = "-L" ||
+          test $p = "-R"; then
+	 prev=$p
+	 continue
+       fi
 
- if test "x$ac_system" = "xDarwin"; then
-  BUILD_DARWIN_TRUE=
-  BUILD_DARWIN_FALSE='#'
-else
-  BUILD_DARWIN_TRUE='#'
-  BUILD_DARWIN_FALSE=
-fi
+       # Expand the sysroot to ease extracting the directories later.
+       if test -z "$prev"; then
+         case $p in
+         -L*) func_stripname_cnf '-L' '' "$p"; prev=-L; p=$func_stripname_result ;;
+         -R*) func_stripname_cnf '-R' '' "$p"; prev=-R; p=$func_stripname_result ;;
+         -l*) func_stripname_cnf '-l' '' "$p"; prev=-l; p=$func_stripname_result ;;
+         esac
+       fi
+       case $p in
+       =*) func_stripname_cnf '=' '' "$p"; p=$lt_sysroot$func_stripname_result ;;
+       esac
+       if test "$pre_test_object_deps_done" = no; then
+	 case ${prev} in
+	 -L | -R)
+	   # Internal compiler library paths should come after those
+	   # provided the user.  The postdeps already come after the
+	   # user supplied libs so there is no need to process them.
+	   if test -z "$compiler_lib_search_path_CXX"; then
+	     compiler_lib_search_path_CXX="${prev}${p}"
+	   else
+	     compiler_lib_search_path_CXX="${compiler_lib_search_path_CXX} ${prev}${p}"
+	   fi
+	   ;;
+	 # The "-l" case would never come before the object being
+	 # linked, so don't bother handling this case.
+	 esac
+       else
+	 if test -z "$postdeps_CXX"; then
+	   postdeps_CXX="${prev}${p}"
+	 else
+	   postdeps_CXX="${postdeps_CXX} ${prev}${p}"
+	 fi
+       fi
+       prev=
+       ;;
 
- if test "x$ac_system" = "xOpenBSD"; then
-  BUILD_OPENBSD_TRUE=
-  BUILD_OPENBSD_FALSE='#'
-else
-  BUILD_OPENBSD_TRUE='#'
-  BUILD_OPENBSD_FALSE=
-fi
+    *.lto.$objext) ;; # Ignore GCC LTO objects
+    *.$objext)
+       # This assumes that the test object file only shows up
+       # once in the compiler output.
+       if test "$p" = "conftest.$objext"; then
+	 pre_test_object_deps_done=yes
+	 continue
+       fi
 
- if test "x$ac_system" = "xAIX"; then
-  BUILD_AIX_TRUE=
-  BUILD_AIX_FALSE='#'
-else
-  BUILD_AIX_TRUE='#'
-  BUILD_AIX_FALSE=
-fi
+       if test "$pre_test_object_deps_done" = no; then
+	 if test -z "$predep_objects_CXX"; then
+	   predep_objects_CXX="$p"
+	 else
+	   predep_objects_CXX="$predep_objects_CXX $p"
+	 fi
+       else
+	 if test -z "$postdep_objects_CXX"; then
+	   postdep_objects_CXX="$p"
+	 else
+	   postdep_objects_CXX="$postdep_objects_CXX $p"
+	 fi
+       fi
+       ;;
 
- if test "x$ac_system" = "xFreeBSD"; then
-  BUILD_FREEBSD_TRUE=
-  BUILD_FREEBSD_FALSE='#'
+    *) ;; # Ignore the rest.
+
+    esac
+  done
+
+  # Clean up.
+  rm -f a.out a.exe
 else
-  BUILD_FREEBSD_TRUE='#'
-  BUILD_FREEBSD_FALSE=
+  echo "libtool.m4: error: problem compiling CXX test program"
 fi
 
+$RM -f confest.$objext
+CFLAGS=$_lt_libdeps_save_CFLAGS
 
-if test "x$ac_system" = "xLinux"
-then
+# PORTME: override above test on systems where it is broken
+case $host_os in
+interix[3-9]*)
+  # Interix 3.5 installs completely hosed .la files for C++, so rather than
+  # hack all around it, let's just trust "g++" to DTRT.
+  predep_objects_CXX=
+  postdep_objects_CXX=
+  postdeps_CXX=
+  ;;
+
+linux*)
+  case `$CC -V 2>&1 | sed 5q` in
+  *Sun\ C*)
+    # Sun C++ 5.9
+
+    # The more standards-conforming stlport4 library is
+    # incompatible with the Cstd library. Avoid specifying
+    # it if it's in CXXFLAGS. Ignore libCrun as
+    # -library=stlport4 depends on it.
+    case " $CXX $CXXFLAGS " in
+    *" -library=stlport4 "*)
+      solaris_use_stlport4=yes
+      ;;
+    esac
 
-	if test -z "$KERNEL_DIR"
-	then
-		KERNEL_DIR="/lib/modules/`uname -r`/source"
-	fi
+    if test "$solaris_use_stlport4" != yes; then
+      postdeps_CXX='-library=Cstd -library=Crun'
+    fi
+    ;;
+  esac
+  ;;
 
-	KERNEL_CFLAGS="-I$KERNEL_DIR/include"
+solaris*)
+  case $cc_basename in
+  CC* | sunCC*)
+    # The more standards-conforming stlport4 library is
+    # incompatible with the Cstd library. Avoid specifying
+    # it if it's in CXXFLAGS. Ignore libCrun as
+    # -library=stlport4 depends on it.
+    case " $CXX $CXXFLAGS " in
+    *" -library=stlport4 "*)
+      solaris_use_stlport4=yes
+      ;;
+    esac
 
-fi
+    # Adding this requires a known-good setup of shared libraries for
+    # Sun compiler versions before 5.6, else PIC objects from an old
+    # archive will be linked into the output, leading to subtle bugs.
+    if test "$solaris_use_stlport4" != yes; then
+      postdeps_CXX='-library=Cstd -library=Crun'
+    fi
+    ;;
+  esac
+  ;;
+esac
 
-if test "x$ac_system" = "xSolaris"
-then
 
-$as_echo "#define _POSIX_PTHREAD_SEMANTICS 1" >>confdefs.h
+case " $postdeps_CXX " in
+*" -lc "*) archive_cmds_need_lc_CXX=no ;;
+esac
+ compiler_lib_search_dirs_CXX=
+if test -n "${compiler_lib_search_path_CXX}"; then
+ compiler_lib_search_dirs_CXX=`echo " ${compiler_lib_search_path_CXX}" | ${SED} -e 's! -L! !g' -e 's!^ !!'`
+fi
 
 
-$as_echo "#define _REENTRANT 1" >>confdefs.h
 
 
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether compiler builds 64bit binaries" >&5
-$as_echo_n "checking whether compiler builds 64bit binaries... " >&6; }
-	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-			   #ifndef _LP64
-			   # error "Compiler not in 64bit mode."
-			   #endif
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-else
 
-			    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-			    { $as_echo "$as_me:${as_lineno-$LINENO}: Solaris detected. Please consider building a 64-bit binary." >&5
-$as_echo "$as_me: Solaris detected. Please consider building a 64-bit binary." >&6;}
 
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
 
-if test "x$ac_system" = "xAIX"
-then
 
-$as_echo "#define _THREAD_SAFE_ERRNO 1" >>confdefs.h
 
-fi
 
-# Where to install .pc files.
-pkgconfigdir="${libdir}/pkgconfig"
 
 
-# Check for standards compliance mode
-# Check whether --enable-standards was given.
-if test "${enable_standards+set}" = set; then :
-  enableval=$enable_standards; enable_standards="$enableval"
-else
-  enable_standards="no"
-fi
 
-if test "x$enable_standards" = "xyes"
-then
 
-$as_echo "#define _ISOC99_SOURCE 1" >>confdefs.h
 
 
-$as_echo "#define _POSIX_C_SOURCE 200809L" >>confdefs.h
 
 
-$as_echo "#define _XOPEN_SOURCE 700" >>confdefs.h
 
 
-$as_echo "#define _REENTRANT 1" >>confdefs.h
 
-	if test "x$GCC" = "xyes"
-	then
-		CFLAGS="$CFLAGS -std=c99"
-	fi
-fi
- if test "x$enable_standards" = "xyes"; then
-  BUILD_FEATURE_STANDARDS_TRUE=
-  BUILD_FEATURE_STANDARDS_FALSE='#'
-else
-  BUILD_FEATURE_STANDARDS_TRUE='#'
-  BUILD_FEATURE_STANDARDS_FALSE=
-fi
 
 
-#
-# Checks for header files.
-#
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
-$as_echo_n "checking for ANSI C header files... " >&6; }
-if ${ac_cv_header_stdc+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <stdlib.h>
-#include <stdarg.h>
-#include <string.h>
-#include <float.h>
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_header_stdc=yes
-else
-  ac_cv_header_stdc=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
-if test $ac_cv_header_stdc = yes; then
-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <string.h>
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "memchr" >/dev/null 2>&1; then :
 
-else
-  ac_cv_header_stdc=no
-fi
-rm -f conftest*
+    lt_prog_compiler_wl_CXX=
+lt_prog_compiler_pic_CXX=
+lt_prog_compiler_static_CXX=
 
-fi
 
-if test $ac_cv_header_stdc = yes; then
-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  # C++ specific cases for pic, static, wl, etc.
+  if test "$GXX" = yes; then
+    lt_prog_compiler_wl_CXX='-Wl,'
+    lt_prog_compiler_static_CXX='-static'
+
+    case $host_os in
+    aix*)
+      # All AIX code is PIC.
+      if test "$host_cpu" = ia64; then
+	# AIX 5 now supports IA64 processor
+	lt_prog_compiler_static_CXX='-Bstatic'
+      fi
+      ;;
+
+    amigaos*)
+      case $host_cpu in
+      powerpc)
+            # see comment about AmigaOS4 .so support
+            lt_prog_compiler_pic_CXX='-fPIC'
+        ;;
+      m68k)
+            # FIXME: we need at least 68020 code to build shared libraries, but
+            # adding the `-m68020' flag to GCC prevents building anything better,
+            # like `-m68040'.
+            lt_prog_compiler_pic_CXX='-m68020 -resident32 -malways-restore-a4'
+        ;;
+      esac
+      ;;
+
+    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+      # PIC is the default for these OSes.
+      ;;
+    mingw* | cygwin* | os2* | pw32* | cegcc*)
+      # This hack is so that the source file can tell whether it is being
+      # built for inclusion in a dll (and should export symbols for example).
+      # Although the cygwin gcc ignores -fPIC, still need this for old-style
+      # (--disable-auto-import) libraries
+      lt_prog_compiler_pic_CXX='-DDLL_EXPORT'
+      ;;
+    darwin* | rhapsody*)
+      # PIC is the default on this platform
+      # Common symbols not allowed in MH_DYLIB files
+      lt_prog_compiler_pic_CXX='-fno-common'
+      ;;
+    *djgpp*)
+      # DJGPP does not support shared libraries at all
+      lt_prog_compiler_pic_CXX=
+      ;;
+    haiku*)
+      # PIC is the default for Haiku.
+      # The "-static" flag exists, but is broken.
+      lt_prog_compiler_static_CXX=
+      ;;
+    interix[3-9]*)
+      # Interix 3.x gcc -fpic/-fPIC options generate broken code.
+      # Instead, we relocate shared libraries at runtime.
+      ;;
+    sysv4*MP*)
+      if test -d /usr/nec; then
+	lt_prog_compiler_pic_CXX=-Kconform_pic
+      fi
+      ;;
+    hpux*)
+      # PIC is the default for 64-bit PA HP-UX, but not for 32-bit
+      # PA HP-UX.  On IA64 HP-UX, PIC is the default but the pic flag
+      # sets the default TLS model and affects inlining.
+      case $host_cpu in
+      hppa*64*)
+	;;
+      *)
+	lt_prog_compiler_pic_CXX='-fPIC'
+	;;
+      esac
+      ;;
+    *qnx* | *nto*)
+      # QNX uses GNU C++, but need to define -shared option too, otherwise
+      # it will coredump.
+      lt_prog_compiler_pic_CXX='-fPIC -shared'
+      ;;
+    *)
+      lt_prog_compiler_pic_CXX='-fPIC'
+      ;;
+    esac
+  else
+    case $host_os in
+      aix[4-9]*)
+	# All AIX code is PIC.
+	if test "$host_cpu" = ia64; then
+	  # AIX 5 now supports IA64 processor
+	  lt_prog_compiler_static_CXX='-Bstatic'
+	else
+	  lt_prog_compiler_static_CXX='-bnso -bI:/lib/syscalls.exp'
+	fi
+	;;
+      chorus*)
+	case $cc_basename in
+	cxch68*)
+	  # Green Hills C++ Compiler
+	  # _LT_TAGVAR(lt_prog_compiler_static, CXX)="--no_auto_instantiation -u __main -u __premain -u _abort -r $COOL_DIR/lib/libOrb.a $MVME_DIR/lib/CC/libC.a $MVME_DIR/lib/classix/libcx.s.a"
+	  ;;
+	esac
+	;;
+      mingw* | cygwin* | os2* | pw32* | cegcc*)
+	# This hack is so that the source file can tell whether it is being
+	# built for inclusion in a dll (and should export symbols for example).
+	lt_prog_compiler_pic_CXX='-DDLL_EXPORT'
+	;;
+      dgux*)
+	case $cc_basename in
+	  ec++*)
+	    lt_prog_compiler_pic_CXX='-KPIC'
+	    ;;
+	  ghcx*)
+	    # Green Hills C++ Compiler
+	    lt_prog_compiler_pic_CXX='-pic'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      freebsd* | dragonfly*)
+	# FreeBSD uses GNU C++
+	;;
+      hpux9* | hpux10* | hpux11*)
+	case $cc_basename in
+	  CC*)
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_static_CXX='${wl}-a ${wl}archive'
+	    if test "$host_cpu" != ia64; then
+	      lt_prog_compiler_pic_CXX='+Z'
+	    fi
+	    ;;
+	  aCC*)
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_static_CXX='${wl}-a ${wl}archive'
+	    case $host_cpu in
+	    hppa*64*|ia64*)
+	      # +Z the default
+	      ;;
+	    *)
+	      lt_prog_compiler_pic_CXX='+Z'
+	      ;;
+	    esac
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      interix*)
+	# This is c89, which is MS Visual C++ (no shared libs)
+	# Anyone wants to do a port?
+	;;
+      irix5* | irix6* | nonstopux*)
+	case $cc_basename in
+	  CC*)
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_static_CXX='-non_shared'
+	    # CC pic flag -KPIC is the default.
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+	case $cc_basename in
+	  KCC*)
+	    # KAI C++ Compiler
+	    lt_prog_compiler_wl_CXX='--backend -Wl,'
+	    lt_prog_compiler_pic_CXX='-fPIC'
+	    ;;
+	  ecpc* )
+	    # old Intel C++ for x86_64 which still supported -KPIC.
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-KPIC'
+	    lt_prog_compiler_static_CXX='-static'
+	    ;;
+	  icpc* )
+	    # Intel C++, used to be incompatible with GCC.
+	    # ICC 10 doesn't accept -KPIC any more.
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-fPIC'
+	    lt_prog_compiler_static_CXX='-static'
+	    ;;
+	  pgCC* | pgcpp*)
+	    # Portland Group C++ compiler
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-fpic'
+	    lt_prog_compiler_static_CXX='-Bstatic'
+	    ;;
+	  cxx*)
+	    # Compaq C++
+	    # Make sure the PIC flag is empty.  It appears that all Alpha
+	    # Linux and Compaq Tru64 Unix objects are PIC.
+	    lt_prog_compiler_pic_CXX=
+	    lt_prog_compiler_static_CXX='-non_shared'
+	    ;;
+	  xlc* | xlC* | bgxl[cC]* | mpixl[cC]*)
+	    # IBM XL 8.0, 9.0 on PPC and BlueGene
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-qpic'
+	    lt_prog_compiler_static_CXX='-qstaticlink'
+	    ;;
+	  *)
+	    case `$CC -V 2>&1 | sed 5q` in
+	    *Sun\ C*)
+	      # Sun C++ 5.9
+	      lt_prog_compiler_pic_CXX='-KPIC'
+	      lt_prog_compiler_static_CXX='-Bstatic'
+	      lt_prog_compiler_wl_CXX='-Qoption ld '
+	      ;;
+	    esac
+	    ;;
+	esac
+	;;
+      lynxos*)
+	;;
+      m88k*)
+	;;
+      mvs*)
+	case $cc_basename in
+	  cxx*)
+	    lt_prog_compiler_pic_CXX='-W c,exportall'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      netbsd* | netbsdelf*-gnu)
+	;;
+      *qnx* | *nto*)
+        # QNX uses GNU C++, but need to define -shared option too, otherwise
+        # it will coredump.
+        lt_prog_compiler_pic_CXX='-fPIC -shared'
+        ;;
+      osf3* | osf4* | osf5*)
+	case $cc_basename in
+	  KCC*)
+	    lt_prog_compiler_wl_CXX='--backend -Wl,'
+	    ;;
+	  RCC*)
+	    # Rational C++ 2.4.1
+	    lt_prog_compiler_pic_CXX='-pic'
+	    ;;
+	  cxx*)
+	    # Digital/Compaq C++
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    # Make sure the PIC flag is empty.  It appears that all Alpha
+	    # Linux and Compaq Tru64 Unix objects are PIC.
+	    lt_prog_compiler_pic_CXX=
+	    lt_prog_compiler_static_CXX='-non_shared'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      psos*)
+	;;
+      solaris*)
+	case $cc_basename in
+	  CC* | sunCC*)
+	    # Sun C++ 4.2, 5.x and Centerline C++
+	    lt_prog_compiler_pic_CXX='-KPIC'
+	    lt_prog_compiler_static_CXX='-Bstatic'
+	    lt_prog_compiler_wl_CXX='-Qoption ld '
+	    ;;
+	  gcx*)
+	    # Green Hills C++ Compiler
+	    lt_prog_compiler_pic_CXX='-PIC'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      sunos4*)
+	case $cc_basename in
+	  CC*)
+	    # Sun C++ 4.x
+	    lt_prog_compiler_pic_CXX='-pic'
+	    lt_prog_compiler_static_CXX='-Bstatic'
+	    ;;
+	  lcc*)
+	    # Lucid
+	    lt_prog_compiler_pic_CXX='-pic'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      sysv5* | unixware* | sco3.2v5* | sco5v6* | OpenUNIX*)
+	case $cc_basename in
+	  CC*)
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-KPIC'
+	    lt_prog_compiler_static_CXX='-Bstatic'
+	    ;;
+	esac
+	;;
+      tandem*)
+	case $cc_basename in
+	  NCC*)
+	    # NonStop-UX NCC 3.20
+	    lt_prog_compiler_pic_CXX='-KPIC'
+	    ;;
+	  *)
+	    ;;
+	esac
+	;;
+      vxworks*)
+	;;
+      *)
+	lt_prog_compiler_can_build_shared_CXX=no
+	;;
+    esac
+  fi
+
+case $host_os in
+  # For platforms which do not support PIC, -DPIC is meaningless:
+  *djgpp*)
+    lt_prog_compiler_pic_CXX=
+    ;;
+  *)
+    lt_prog_compiler_pic_CXX="$lt_prog_compiler_pic_CXX -DPIC"
+    ;;
+esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $compiler option to produce PIC" >&5
+$as_echo_n "checking for $compiler option to produce PIC... " >&6; }
+if ${lt_cv_prog_compiler_pic_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic_CXX=$lt_prog_compiler_pic_CXX
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_pic_CXX" >&6; }
+lt_prog_compiler_pic_CXX=$lt_cv_prog_compiler_pic_CXX
+
+#
+# Check to make sure the PIC flag actually works.
+#
+if test -n "$lt_prog_compiler_pic_CXX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works" >&5
+$as_echo_n "checking if $compiler PIC flag $lt_prog_compiler_pic_CXX works... " >&6; }
+if ${lt_cv_prog_compiler_pic_works_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_pic_works_CXX=no
+   ac_outfile=conftest.$ac_objext
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+   lt_compiler_flag="$lt_prog_compiler_pic_CXX -DPIC"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   # The option is referenced via a variable to avoid confusing sed.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>conftest.err)
+   ac_status=$?
+   cat conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s "$ac_outfile"; then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings other than the usual output.
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' >conftest.exp
+     $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+     if test ! -s conftest.er2 || diff conftest.exp conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_pic_works_CXX=yes
+     fi
+   fi
+   $RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_pic_works_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_pic_works_CXX" >&6; }
+
+if test x"$lt_cv_prog_compiler_pic_works_CXX" = xyes; then
+    case $lt_prog_compiler_pic_CXX in
+     "" | " "*) ;;
+     *) lt_prog_compiler_pic_CXX=" $lt_prog_compiler_pic_CXX" ;;
+     esac
+else
+    lt_prog_compiler_pic_CXX=
+     lt_prog_compiler_can_build_shared_CXX=no
+fi
+
+fi
+
+
+
+
+
+#
+# Check to make sure the static flag actually works.
+#
+wl=$lt_prog_compiler_wl_CXX eval lt_tmp_static_flag=\"$lt_prog_compiler_static_CXX\"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler static flag $lt_tmp_static_flag works" >&5
+$as_echo_n "checking if $compiler static flag $lt_tmp_static_flag works... " >&6; }
+if ${lt_cv_prog_compiler_static_works_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_static_works_CXX=no
+   save_LDFLAGS="$LDFLAGS"
+   LDFLAGS="$LDFLAGS $lt_tmp_static_flag"
+   echo "$lt_simple_link_test_code" > conftest.$ac_ext
+   if (eval $ac_link 2>conftest.err) && test -s conftest$ac_exeext; then
+     # The linker can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     if test -s conftest.err; then
+       # Append any errors to the config.log.
+       cat conftest.err 1>&5
+       $ECHO "$_lt_linker_boilerplate" | $SED '/^$/d' > conftest.exp
+       $SED '/^$/d; /^ *+/d' conftest.err >conftest.er2
+       if diff conftest.exp conftest.er2 >/dev/null; then
+         lt_cv_prog_compiler_static_works_CXX=yes
+       fi
+     else
+       lt_cv_prog_compiler_static_works_CXX=yes
+     fi
+   fi
+   $RM -r conftest*
+   LDFLAGS="$save_LDFLAGS"
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_static_works_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_static_works_CXX" >&6; }
+
+if test x"$lt_cv_prog_compiler_static_works_CXX" = xyes; then
+    :
+else
+    lt_prog_compiler_static_CXX=
+fi
+
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_c_o_CXX=no
+   $RM -r conftest 2>/dev/null
+   mkdir conftest
+   cd conftest
+   mkdir out
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+
+   lt_compiler_flag="-o out/conftest2.$ac_objext"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>out/conftest.err)
+   ac_status=$?
+   cat out/conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s out/conftest2.$ac_objext
+   then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
+     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
+     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_c_o_CXX=yes
+     fi
+   fi
+   chmod u+w . 2>&5
+   $RM conftest*
+   # SGI C++ compiler will create directory out/ii_files/ for
+   # template instantiation
+   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
+   $RM out/* && rmdir out
+   cd ..
+   $RM -r conftest
+   $RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_c_o_CXX" >&6; }
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking if $compiler supports -c -o file.$ac_objext" >&5
+$as_echo_n "checking if $compiler supports -c -o file.$ac_objext... " >&6; }
+if ${lt_cv_prog_compiler_c_o_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_prog_compiler_c_o_CXX=no
+   $RM -r conftest 2>/dev/null
+   mkdir conftest
+   cd conftest
+   mkdir out
+   echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+
+   lt_compiler_flag="-o out/conftest2.$ac_objext"
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing "conftest.", or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   lt_compile=`echo "$ac_compile" | $SED \
+   -e 's:.*FLAGS}\{0,1\} :&$lt_compiler_flag :; t' \
+   -e 's: [^ ]*conftest\.: $lt_compiler_flag&:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo "\"\$as_me:$LINENO: $lt_compile\"" >&5)
+   (eval "$lt_compile" 2>out/conftest.err)
+   ac_status=$?
+   cat out/conftest.err >&5
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   if (exit $ac_status) && test -s out/conftest2.$ac_objext
+   then
+     # The compiler can only warn and ignore the option if not recognized
+     # So say no if there are warnings
+     $ECHO "$_lt_compiler_boilerplate" | $SED '/^$/d' > out/conftest.exp
+     $SED '/^$/d; /^ *+/d' out/conftest.err >out/conftest.er2
+     if test ! -s out/conftest.er2 || diff out/conftest.exp out/conftest.er2 >/dev/null; then
+       lt_cv_prog_compiler_c_o_CXX=yes
+     fi
+   fi
+   chmod u+w . 2>&5
+   $RM conftest*
+   # SGI C++ compiler will create directory out/ii_files/ for
+   # template instantiation
+   test -d out/ii_files && $RM out/ii_files/* && rmdir out/ii_files
+   $RM out/* && rmdir out
+   cd ..
+   $RM -r conftest
+   $RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_prog_compiler_c_o_CXX" >&5
+$as_echo "$lt_cv_prog_compiler_c_o_CXX" >&6; }
+
+
+
+
+hard_links="nottested"
+if test "$lt_cv_prog_compiler_c_o_CXX" = no && test "$need_locks" != no; then
+  # do not overwrite the value of need_locks provided by the user
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if we can lock with hard links" >&5
+$as_echo_n "checking if we can lock with hard links... " >&6; }
+  hard_links=yes
+  $RM conftest*
+  ln conftest.a conftest.b 2>/dev/null && hard_links=no
+  touch conftest.a
+  ln conftest.a conftest.b 2>&5 || hard_links=no
+  ln conftest.a conftest.b 2>/dev/null && hard_links=no
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $hard_links" >&5
+$as_echo "$hard_links" >&6; }
+  if test "$hard_links" = no; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&5
+$as_echo "$as_me: WARNING: \`$CC' does not support \`-c -o', so \`make -j' may be unsafe" >&2;}
+    need_locks=warn
+  fi
+else
+  need_locks=no
+fi
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether the $compiler linker ($LD) supports shared libraries" >&5
+$as_echo_n "checking whether the $compiler linker ($LD) supports shared libraries... " >&6; }
+
+  export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+  exclude_expsyms_CXX='_GLOBAL_OFFSET_TABLE_|_GLOBAL__F[ID]_.*'
+  case $host_os in
+  aix[4-9]*)
+    # If we're using GNU nm, then we don't want the "-C" option.
+    # -C means demangle to AIX nm, but means don't demangle with GNU nm
+    # Also, AIX nm treats weak defined symbols like other global defined
+    # symbols, whereas GNU nm marks them as "W".
+    if $NM -V 2>&1 | $GREP 'GNU' > /dev/null; then
+      export_symbols_cmds_CXX='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B") || (\$ 2 == "W")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+    else
+      export_symbols_cmds_CXX='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\$ 2 == "T") || (\$ 2 == "D") || (\$ 2 == "B")) && (substr(\$ 3,1,1) != ".")) { print \$ 3 } }'\'' | sort -u > $export_symbols'
+    fi
+    ;;
+  pw32*)
+    export_symbols_cmds_CXX="$ltdll_cmds"
+    ;;
+  cygwin* | mingw* | cegcc*)
+    case $cc_basename in
+    cl*)
+      exclude_expsyms_CXX='_NULL_IMPORT_DESCRIPTOR|_IMPORT_DESCRIPTOR_.*'
+      ;;
+    *)
+      export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS][ ]/s/.*[ ]\([^ ]*\)/\1 DATA/;s/^.*[ ]__nm__\([^ ]*\)[ ][^ ]*/\1 DATA/;/^I[ ]/d;/^[AITW][ ]/s/.* //'\'' | sort | uniq > $export_symbols'
+      exclude_expsyms_CXX='[_]+GLOBAL_OFFSET_TABLE_|[_]+GLOBAL__[FID]_.*|[_]+head_[A-Za-z0-9_]+_dll|[A-Za-z0-9_]+_dll_iname'
+      ;;
+    esac
+    ;;
+  linux* | k*bsd*-gnu | gnu*)
+    link_all_deplibs_CXX=no
+    ;;
+  *)
+    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
+    ;;
+  esac
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ld_shlibs_CXX" >&5
+$as_echo "$ld_shlibs_CXX" >&6; }
+test "$ld_shlibs_CXX" = no && can_build_shared=no
+
+with_gnu_ld_CXX=$with_gnu_ld
+
+
+
+
+
+
+#
+# Do we need to explicitly link libc?
+#
+case "x$archive_cmds_need_lc_CXX" in
+x|xyes)
+  # Assume -lc should be added
+  archive_cmds_need_lc_CXX=yes
+
+  if test "$enable_shared" = yes && test "$GCC" = yes; then
+    case $archive_cmds_CXX in
+    *'~'*)
+      # FIXME: we may have to deal with multi-command sequences.
+      ;;
+    '$CC '*)
+      # Test whether the compiler implicitly links with -lc since on some
+      # systems, -lgcc has to come before -lc. If gcc already passes -lc
+      # to ld, don't add -lc before -lgcc.
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether -lc should be explicitly linked in" >&5
+$as_echo_n "checking whether -lc should be explicitly linked in... " >&6; }
+if ${lt_cv_archive_cmds_need_lc_CXX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  $RM conftest*
+	echo "$lt_simple_compile_test_code" > conftest.$ac_ext
+
+	if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } 2>conftest.err; then
+	  soname=conftest
+	  lib=conftest
+	  libobjs=conftest.$ac_objext
+	  deplibs=
+	  wl=$lt_prog_compiler_wl_CXX
+	  pic_flag=$lt_prog_compiler_pic_CXX
+	  compiler_flags=-v
+	  linker_flags=-v
+	  verstring=
+	  output_objdir=.
+	  libname=conftest
+	  lt_save_allow_undefined_flag=$allow_undefined_flag_CXX
+	  allow_undefined_flag_CXX=
+	  if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$archive_cmds_CXX 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1\""; } >&5
+  (eval $archive_cmds_CXX 2\>\&1 \| $GREP \" -lc \" \>/dev/null 2\>\&1) 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+	  then
+	    lt_cv_archive_cmds_need_lc_CXX=no
+	  else
+	    lt_cv_archive_cmds_need_lc_CXX=yes
+	  fi
+	  allow_undefined_flag_CXX=$lt_save_allow_undefined_flag
+	else
+	  cat conftest.err 1>&5
+	fi
+	$RM conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $lt_cv_archive_cmds_need_lc_CXX" >&5
+$as_echo "$lt_cv_archive_cmds_need_lc_CXX" >&6; }
+      archive_cmds_need_lc_CXX=$lt_cv_archive_cmds_need_lc_CXX
+      ;;
+    esac
+  fi
+  ;;
+esac
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking dynamic linker characteristics" >&5
+$as_echo_n "checking dynamic linker characteristics... " >&6; }
+
+library_names_spec=
+libname_spec='lib$name'
+soname_spec=
+shrext_cmds=".so"
+postinstall_cmds=
+postuninstall_cmds=
+finish_cmds=
+finish_eval=
+shlibpath_var=
+shlibpath_overrides_runpath=unknown
+version_type=none
+dynamic_linker="$host_os ld.so"
+sys_lib_dlsearch_path_spec="/lib /usr/lib"
+need_lib_prefix=unknown
+hardcode_into_libs=no
+
+# when you set need_version to no, make sure it does not cause -set_version
+# flags to be left without arguments
+need_version=unknown
+
+case $host_os in
+aix3*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
+  shlibpath_var=LIBPATH
+
+  # AIX 3 has no versioning support, so we append a major version to the name.
+  soname_spec='${libname}${release}${shared_ext}$major'
+  ;;
+
+aix[4-9]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  hardcode_into_libs=yes
+  if test "$host_cpu" = ia64; then
+    # AIX 5 supports IA64
+    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
+    shlibpath_var=LD_LIBRARY_PATH
+  else
+    # With GCC up to 2.95.x, collect2 would create an import file
+    # for dependence libraries.  The import file would start with
+    # the line `#! .'.  This would cause the generated library to
+    # depend on `.', always an invalid library.  This was fixed in
+    # development snapshots of GCC prior to 3.0.
+    case $host_os in
+      aix4 | aix4.[01] | aix4.[01].*)
+      if { echo '#if __GNUC__ > 2 || (__GNUC__ == 2 && __GNUC_MINOR__ >= 97)'
+	   echo ' yes '
+	   echo '#endif'; } | ${CC} -E - | $GREP yes > /dev/null; then
+	:
+      else
+	can_build_shared=no
+      fi
+      ;;
+    esac
+    # AIX (on Power*) has no versioning support, so currently we can not hardcode correct
+    # soname into executable. Probably we can add versioning support to
+    # collect2, so additional links can be useful in future.
+    if test "$aix_use_runtimelinking" = yes; then
+      # If using run time linking (on AIX 4.2 or later) use lib<name>.so
+      # instead of lib<name>.a to let people know that these are not
+      # typical AIX shared libraries.
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    else
+      # We preserve .a as extension for shared libraries through AIX4.2
+      # and later when we are not doing run time linking.
+      library_names_spec='${libname}${release}.a $libname.a'
+      soname_spec='${libname}${release}${shared_ext}$major'
+    fi
+    shlibpath_var=LIBPATH
+  fi
+  ;;
+
+amigaos*)
+  case $host_cpu in
+  powerpc)
+    # Since July 2007 AmigaOS4 officially supports .so libraries.
+    # When compiling the executable, add -use-dynld -Lsobjs: to the compileline.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    ;;
+  m68k)
+    library_names_spec='$libname.ixlibrary $libname.a'
+    # Create ${libname}_ixlibrary.a entries in /sys/libs.
+    finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`func_echo_all "$lib" | $SED '\''s%^.*/\([^/]*\)\.ixlibrary$%\1%'\''`; test $RM /sys/libs/${libname}_ixlibrary.a; $show "cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a"; cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a || exit 1; done'
+    ;;
+  esac
+  ;;
+
+beos*)
+  library_names_spec='${libname}${shared_ext}'
+  dynamic_linker="$host_os ld.so"
+  shlibpath_var=LIBRARY_PATH
+  ;;
+
+bsdi[45]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  sys_lib_search_path_spec="/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib"
+  sys_lib_dlsearch_path_spec="/shlib /usr/lib /usr/local/lib"
+  # the default ld.so.conf also contains /usr/contrib/lib and
+  # /usr/X11R6/lib (/usr/X11 is a link to /usr/X11R6), but let us allow
+  # libtool to hard-code these into programs
+  ;;
+
+cygwin* | mingw* | pw32* | cegcc*)
+  version_type=windows
+  shrext_cmds=".dll"
+  need_version=no
+  need_lib_prefix=no
+
+  case $GCC,$cc_basename in
+  yes,*)
+    # gcc
+    library_names_spec='$libname.dll.a'
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname~
+      chmod a+x \$dldir/$dlname~
+      if test -n '\''$stripme'\'' && test -n '\''$striplib'\''; then
+        eval '\''$striplib \$dldir/$dlname'\'' || exit \$?;
+      fi'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+
+    case $host_os in
+    cygwin*)
+      # Cygwin DLLs use 'cyg' prefix rather than 'lib'
+      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+
+      ;;
+    mingw* | cegcc*)
+      # MinGW DLLs use traditional 'lib' prefix
+      soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      ;;
+    pw32*)
+      # pw32 DLLs use 'pw' prefix rather than 'lib'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      ;;
+    esac
+    dynamic_linker='Win32 ld.exe'
+    ;;
+
+  *,cl*)
+    # Native MSVC
+    libname_spec='$name'
+    soname_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+    library_names_spec='${libname}.dll.lib'
+
+    case $build_os in
+    mingw*)
+      sys_lib_search_path_spec=
+      lt_save_ifs=$IFS
+      IFS=';'
+      for lt_path in $LIB
+      do
+        IFS=$lt_save_ifs
+        # Let DOS variable expansion print the short 8.3 style file name.
+        lt_path=`cd "$lt_path" 2>/dev/null && cmd //C "for %i in (".") do @echo %~si"`
+        sys_lib_search_path_spec="$sys_lib_search_path_spec $lt_path"
+      done
+      IFS=$lt_save_ifs
+      # Convert to MSYS style.
+      sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | sed -e 's|\\\\|/|g' -e 's| \\([a-zA-Z]\\):| /\\1|g' -e 's|^ ||'`
+      ;;
+    cygwin*)
+      # Convert to unix form, then to dos form, then back to unix form
+      # but this time dos style (no spaces!) so that the unix form looks
+      # like /cygdrive/c/PROGRA~1:/cygdr...
+      sys_lib_search_path_spec=`cygpath --path --unix "$LIB"`
+      sys_lib_search_path_spec=`cygpath --path --dos "$sys_lib_search_path_spec" 2>/dev/null`
+      sys_lib_search_path_spec=`cygpath --path --unix "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      ;;
+    *)
+      sys_lib_search_path_spec="$LIB"
+      if $ECHO "$sys_lib_search_path_spec" | $GREP ';[c-zC-Z]:/' >/dev/null; then
+        # It is most probably a Windows format PATH.
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`$ECHO "$sys_lib_search_path_spec" | $SED -e "s/$PATH_SEPARATOR/ /g"`
+      fi
+      # FIXME: find the short name or the path components, as spaces are
+      # common. (e.g. "Program Files" -> "PROGRA~1")
+      ;;
+    esac
+
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\${base_file}'\''i; echo \$dlname'\''`~
+      dldir=$destdir/`dirname \$dlpath`~
+      test -d \$dldir || mkdir -p \$dldir~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2>&1 -c '\''. $file; echo \$dlname'\''`~
+      dlpath=$dir/\$dldll~
+       $RM \$dlpath'
+    shlibpath_overrides_runpath=yes
+    dynamic_linker='Win32 link.exe'
+    ;;
+
+  *)
+    # Assume MSVC wrapper
+    library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
+    dynamic_linker='Win32 ld.exe'
+    ;;
+  esac
+  # FIXME: first we should search . and the directory the executable is in
+  shlibpath_var=PATH
+  ;;
+
+darwin* | rhapsody*)
+  dynamic_linker="$host_os dyld"
+  version_type=darwin
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  soname_spec='${libname}${release}${major}$shared_ext'
+  shlibpath_overrides_runpath=yes
+  shlibpath_var=DYLD_LIBRARY_PATH
+  shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
+
+  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
+  ;;
+
+dgux*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  ;;
+
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
+  if test -x /usr/bin/objformat; then
+    objformat=`/usr/bin/objformat`
+  else
+    case $host_os in
+    freebsd[23].*) objformat=aout ;;
+    *) objformat=elf ;;
+    esac
+  fi
+  version_type=freebsd-$objformat
+  case $version_type in
+    freebsd-elf*)
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+      need_version=no
+      need_lib_prefix=no
+      ;;
+    freebsd-*)
+      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
+      need_version=yes
+      ;;
+  esac
+  shlibpath_var=LD_LIBRARY_PATH
+  case $host_os in
+  freebsd2.*)
+    shlibpath_overrides_runpath=yes
+    ;;
+  freebsd3.[01]* | freebsdelf3.[01]*)
+    shlibpath_overrides_runpath=yes
+    hardcode_into_libs=yes
+    ;;
+  freebsd3.[2-9]* | freebsdelf3.[2-9]* | \
+  freebsd4.[0-5] | freebsdelf4.[0-5] | freebsd4.1.1 | freebsdelf4.1.1)
+    shlibpath_overrides_runpath=no
+    hardcode_into_libs=yes
+    ;;
+  *) # from 4.6 on, and DragonFly
+    shlibpath_overrides_runpath=yes
+    hardcode_into_libs=yes
+    ;;
+  esac
+  ;;
+
+haiku*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  dynamic_linker="$host_os runtime_loader"
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  sys_lib_dlsearch_path_spec='/boot/home/config/lib /boot/common/lib /boot/system/lib'
+  hardcode_into_libs=yes
+  ;;
+
+hpux9* | hpux10* | hpux11*)
+  # Give a soname corresponding to the major version so that dld.sl refuses to
+  # link against other versions.
+  version_type=sunos
+  need_lib_prefix=no
+  need_version=no
+  case $host_cpu in
+  ia64*)
+    shrext_cmds='.so'
+    hardcode_into_libs=yes
+    dynamic_linker="$host_os dld.so"
+    shlibpath_var=LD_LIBRARY_PATH
+    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    if test "X$HPUX_IA64_MODE" = X32; then
+      sys_lib_search_path_spec="/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib"
+    else
+      sys_lib_search_path_spec="/usr/lib/hpux64 /usr/local/lib/hpux64"
+    fi
+    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+    ;;
+  hppa*64*)
+    shrext_cmds='.sl'
+    hardcode_into_libs=yes
+    dynamic_linker="$host_os dld.sl"
+    shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
+    shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    sys_lib_search_path_spec="/usr/lib/pa20_64 /usr/ccs/lib/pa20_64"
+    sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+    ;;
+  *)
+    shrext_cmds='.sl'
+    dynamic_linker="$host_os dld.sl"
+    shlibpath_var=SHLIB_PATH
+    shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    ;;
+  esac
+  # HP-UX runs *really* slowly unless shared libraries are mode 555, ...
+  postinstall_cmds='chmod 555 $lib'
+  # or fails outright, so override atomically:
+  install_override_mode=555
+  ;;
+
+interix[3-9]*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  dynamic_linker='Interix 3.x ld.so.1 (PE, like ELF)'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
+
+irix5* | irix6* | nonstopux*)
+  case $host_os in
+    nonstopux*) version_type=nonstopux ;;
+    *)
+	if test "$lt_cv_prog_gnu_ld" = yes; then
+		version_type=linux # correct to gnu/linux during the next big refactor
+	else
+		version_type=irix
+	fi ;;
+  esac
+  need_lib_prefix=no
+  need_version=no
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
+  case $host_os in
+  irix5* | nonstopux*)
+    libsuff= shlibsuff=
+    ;;
+  *)
+    case $LD in # libtool.m4 will add one of these switches to LD
+    *-32|*"-32 "|*-melf32bsmip|*"-melf32bsmip ")
+      libsuff= shlibsuff= libmagic=32-bit;;
+    *-n32|*"-n32 "|*-melf32bmipn32|*"-melf32bmipn32 ")
+      libsuff=32 shlibsuff=N32 libmagic=N32;;
+    *-64|*"-64 "|*-melf64bmip|*"-melf64bmip ")
+      libsuff=64 shlibsuff=64 libmagic=64-bit;;
+    *) libsuff= shlibsuff= libmagic=never-match;;
+    esac
+    ;;
+  esac
+  shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
+  shlibpath_overrides_runpath=no
+  sys_lib_search_path_spec="/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}"
+  sys_lib_dlsearch_path_spec="/usr/lib${libsuff} /lib${libsuff}"
+  hardcode_into_libs=yes
+  ;;
+
+# No shared lib support for Linux oldld, aout, or coff.
+linux*oldld* | linux*aout* | linux*coff*)
+  dynamic_linker=no
+  ;;
+
+# This must be glibc/ELF.
+linux* | k*bsd*-gnu | kopensolaris*-gnu | gnu*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -n $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+
+  # Some binutils ld are patched to set DT_RUNPATH
+  if ${lt_cv_shlibpath_overrides_runpath+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  lt_cv_shlibpath_overrides_runpath=no
+    save_LDFLAGS=$LDFLAGS
+    save_libdir=$libdir
+    eval "libdir=/foo; wl=\"$lt_prog_compiler_wl_CXX\"; \
+	 LDFLAGS=\"\$LDFLAGS $hardcode_libdir_flag_spec_CXX\""
+    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  if  ($OBJDUMP -p conftest$ac_exeext) 2>/dev/null | grep "RUNPATH.*$libdir" >/dev/null; then :
+  lt_cv_shlibpath_overrides_runpath=yes
+fi
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+    LDFLAGS=$save_LDFLAGS
+    libdir=$save_libdir
+
+fi
+
+  shlibpath_overrides_runpath=$lt_cv_shlibpath_overrides_runpath
+
+  # This implies no fast_install, which is unacceptable.
+  # Some rework will be needed to allow for fast_install
+  # before this can be enabled.
+  hardcode_into_libs=yes
+
+  # Append ld.so.conf contents to the search path
+  if test -f /etc/ld.so.conf; then
+    lt_ld_extra=`awk '/^include / { system(sprintf("cd /etc; cat %s 2>/dev/null", \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' < /etc/ld.so.conf | $SED -e 's/#.*//;/^[	 ]*hwcap[	 ]/d;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;s/"//g;/^$/d' | tr '\n' ' '`
+    sys_lib_dlsearch_path_spec="/lib /usr/lib $lt_ld_extra"
+  fi
+
+  # We used to test for /lib/ld.so.1 and disable shared libraries on
+  # powerpc, because MkLinux only supported shared libraries with the
+  # GNU dynamic linker.  Since this was broken with cross compilers,
+  # most powerpc-linux boxes support dynamic linking these days and
+  # people can always --disable-shared, the test was removed, and we
+  # assume the GNU/Linux dynamic linker is in use.
+  dynamic_linker='GNU/Linux ld.so'
+  ;;
+
+netbsdelf*-gnu)
+  version_type=linux
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='NetBSD ld.elf_so'
+  ;;
+
+netbsd*)
+  version_type=sunos
+  need_lib_prefix=no
+  need_version=no
+  if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+    finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+    dynamic_linker='NetBSD (a.out) ld.so'
+  else
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    dynamic_linker='NetBSD ld.elf_so'
+  fi
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  ;;
+
+newsos6)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  ;;
+
+*nto* | *qnx*)
+  version_type=qnx
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='ldqnx.so'
+  ;;
+
+openbsd*)
+  version_type=sunos
+  sys_lib_dlsearch_path_spec="/usr/lib"
+  need_lib_prefix=no
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*)	need_version=yes ;;
+    *)				need_version=no  ;;
+  esac
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  if test -z "`echo __ELF__ | $CC -E - | $GREP __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    case $host_os in
+      openbsd2.[89] | openbsd2.[89].*)
+	shlibpath_overrides_runpath=no
+	;;
+      *)
+	shlibpath_overrides_runpath=yes
+	;;
+      esac
+  else
+    shlibpath_overrides_runpath=yes
+  fi
+  ;;
+
+os2*)
+  libname_spec='$name'
+  shrext_cmds=".dll"
+  need_lib_prefix=no
+  library_names_spec='$libname${shared_ext} $libname.a'
+  dynamic_linker='OS/2 ld.exe'
+  shlibpath_var=LIBPATH
+  ;;
+
+osf3* | osf4* | osf5*)
+  version_type=osf
+  need_lib_prefix=no
+  need_version=no
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  sys_lib_search_path_spec="/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib"
+  sys_lib_dlsearch_path_spec="$sys_lib_search_path_spec"
+  ;;
+
+rdos*)
+  dynamic_linker=no
+  ;;
+
+solaris*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  # ldd complains unless libraries are executable
+  postinstall_cmds='chmod +x $lib'
+  ;;
+
+sunos4*)
+  version_type=sunos
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
+  finish_cmds='PATH="\$PATH:/usr/etc" ldconfig $libdir'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  if test "$with_gnu_ld" = yes; then
+    need_lib_prefix=no
+  fi
+  need_version=yes
+  ;;
+
+sysv4 | sysv4.3*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  case $host_vendor in
+    sni)
+      shlibpath_overrides_runpath=no
+      need_lib_prefix=no
+      runpath_var=LD_RUN_PATH
+      ;;
+    siemens)
+      need_lib_prefix=no
+      ;;
+    motorola)
+      need_lib_prefix=no
+      need_version=no
+      shlibpath_overrides_runpath=no
+      sys_lib_search_path_spec='/lib /usr/lib /usr/ccs/lib'
+      ;;
+  esac
+  ;;
+
+sysv4*MP*)
+  if test -d /usr/nec ;then
+    version_type=linux # correct to gnu/linux during the next big refactor
+    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
+    soname_spec='$libname${shared_ext}.$major'
+    shlibpath_var=LD_LIBRARY_PATH
+  fi
+  ;;
+
+sysv5* | sco3.2v5* | sco5v6* | unixware* | OpenUNIX* | sysv4*uw2*)
+  version_type=freebsd-elf
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=yes
+  hardcode_into_libs=yes
+  if test "$with_gnu_ld" = yes; then
+    sys_lib_search_path_spec='/usr/local/lib /usr/gnu/lib /usr/ccs/lib /usr/lib /lib'
+  else
+    sys_lib_search_path_spec='/usr/ccs/lib /usr/lib'
+    case $host_os in
+      sco3.2v5*)
+        sys_lib_search_path_spec="$sys_lib_search_path_spec /lib"
+	;;
+    esac
+  fi
+  sys_lib_dlsearch_path_spec='/usr/lib'
+  ;;
+
+tpf*)
+  # TPF is a cross-target only.  Preferred cross-host = GNU/Linux.
+  version_type=linux # correct to gnu/linux during the next big refactor
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  ;;
+
+uts4*)
+  version_type=linux # correct to gnu/linux during the next big refactor
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  ;;
+
+*)
+  dynamic_linker=no
+  ;;
+esac
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $dynamic_linker" >&5
+$as_echo "$dynamic_linker" >&6; }
+test "$dynamic_linker" = no && can_build_shared=no
+
+variables_saved_for_relink="PATH $shlibpath_var $runpath_var"
+if test "$GCC" = yes; then
+  variables_saved_for_relink="$variables_saved_for_relink GCC_EXEC_PREFIX COMPILER_PATH LIBRARY_PATH"
+fi
+
+if test "${lt_cv_sys_lib_search_path_spec+set}" = set; then
+  sys_lib_search_path_spec="$lt_cv_sys_lib_search_path_spec"
+fi
+if test "${lt_cv_sys_lib_dlsearch_path_spec+set}" = set; then
+  sys_lib_dlsearch_path_spec="$lt_cv_sys_lib_dlsearch_path_spec"
+fi
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking how to hardcode library paths into programs" >&5
+$as_echo_n "checking how to hardcode library paths into programs... " >&6; }
+hardcode_action_CXX=
+if test -n "$hardcode_libdir_flag_spec_CXX" ||
+   test -n "$runpath_var_CXX" ||
+   test "X$hardcode_automatic_CXX" = "Xyes" ; then
+
+  # We can hardcode non-existent directories.
+  if test "$hardcode_direct_CXX" != no &&
+     # If the only mechanism to avoid hardcoding is shlibpath_var, we
+     # have to relink, otherwise we might link with an installed library
+     # when we should be linking with a yet-to-be-installed one
+     ## test "$_LT_TAGVAR(hardcode_shlibpath_var, CXX)" != no &&
+     test "$hardcode_minus_L_CXX" != no; then
+    # Linking always hardcodes the temporary library directory.
+    hardcode_action_CXX=relink
+  else
+    # We can link without hardcoding, and we can hardcode nonexisting dirs.
+    hardcode_action_CXX=immediate
+  fi
+else
+  # We cannot hardcode anything, or else we can only hardcode existing
+  # directories.
+  hardcode_action_CXX=unsupported
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $hardcode_action_CXX" >&5
+$as_echo "$hardcode_action_CXX" >&6; }
+
+if test "$hardcode_action_CXX" = relink ||
+   test "$inherit_rpath_CXX" = yes; then
+  # Fast installation is not supported
+  enable_fast_install=no
+elif test "$shlibpath_overrides_runpath" = yes ||
+     test "$enable_shared" = no; then
+  # Fast installation is not necessary
+  enable_fast_install=needless
+fi
+
+
+
+
+
+
+
+  fi # test -n "$compiler"
+
+  CC=$lt_save_CC
+  CFLAGS=$lt_save_CFLAGS
+  LDCXX=$LD
+  LD=$lt_save_LD
+  GCC=$lt_save_GCC
+  with_gnu_ld=$lt_save_with_gnu_ld
+  lt_cv_path_LDCXX=$lt_cv_path_LD
+  lt_cv_path_LD=$lt_save_path_LD
+  lt_cv_prog_gnu_ldcxx=$lt_cv_prog_gnu_ld
+  lt_cv_prog_gnu_ld=$lt_save_with_gnu_ld
+fi # test "$_lt_caught_CXX_error" != yes
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+depcc="$CXX"  am_compiler_list=
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
+$as_echo_n "checking dependency style of $depcc... " >&6; }
+if ${am_cv_CXX_dependencies_compiler_type+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
+  rm -rf conftest.dir
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CXX_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  am__universal=false
+  case " $depcc " in #(
+     *\ -arch\ *\ -arch\ *) am__universal=true ;;
+     esac
+
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
+    am__obj=sub/conftest.${OBJEXT-o}
+    am__minus_obj="-o $am__obj"
+    case $depmode in
+    gcc)
+      # This depmode causes a compiler race in universal mode.
+      test "$am__universal" = false || continue
+      ;;
+    nosideeffect)
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
+      # This compiler won't grok '-c -o', but also, the minuso test has
+      # not run yet.  These depmodes are late enough in the game, and
+      # so weak that their functioning should not be impacted.
+      am__obj=conftest.${OBJEXT-o}
+      am__minus_obj=
+      ;;
+    none) break ;;
+    esac
+    if depmode=$depmode \
+       source=sub/conftest.c object=$am__obj \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_CXX_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CXX_dependencies_compiler_type=none
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_CXX_dependencies_compiler_type" >&5
+$as_echo "$am_cv_CXX_dependencies_compiler_type" >&6; }
+CXXDEPMODE=depmode=$am_cv_CXX_dependencies_compiler_type
+
+ if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CXX_dependencies_compiler_type" = gcc3; then
+  am__fastdepCXX_TRUE=
+  am__fastdepCXX_FALSE='#'
+else
+  am__fastdepCXX_TRUE='#'
+  am__fastdepCXX_FALSE=
+fi
+
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor" >&5
+$as_echo_n "checking how to run the C preprocessor... " >&6; }
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+  if ${ac_cv_prog_CPP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+      # Double quotes because CPP needs to be expanded
+    for CPP in "$CC -E" "$CC -E -traditional-cpp" "/lib/cpp"
+    do
+      ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+  break
+fi
+
+    done
+    ac_cv_prog_CPP=$CPP
+
+fi
+  CPP=$ac_cv_prog_CPP
+else
+  ac_cv_prog_CPP=$CPP
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $CPP" >&5
+$as_echo "$CPP" >&6; }
+ac_preproc_ok=false
+for ac_c_preproc_warn_flag in '' yes
+do
+  # Use a header file that comes with gcc, so configuring glibc
+  # with a fresh cross-compiler works.
+  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
+  # <limits.h> exists even on freestanding compilers.
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp. "Syntax error" is here to catch this case.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#ifdef __STDC__
+# include <limits.h>
+#else
+# include <assert.h>
+#endif
+		     Syntax error
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+
+else
+  # Broken: fails on valid input.
+continue
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+  # OK, works on sane cases.  Now check whether nonexistent headers
+  # can be detected and how.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ac_nonexistent.h>
+_ACEOF
+if ac_fn_c_try_cpp "$LINENO"; then :
+  # Broken: success on invalid input.
+continue
+else
+  # Passes both tests.
+ac_preproc_ok=:
+break
+fi
+rm -f conftest.err conftest.i conftest.$ac_ext
+
+done
+# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.
+rm -f conftest.i conftest.err conftest.$ac_ext
+if $ac_preproc_ok; then :
+
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "C preprocessor \"$CPP\" fails sanity check
+See \`config.log' for more details" "$LINENO" 5; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+$as_echo_n "checking for egrep... " >&6; }
+if ${ac_cv_path_EGREP+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1
+   then ac_cv_path_EGREP="$GREP -E"
+   else
+     if test -z "$EGREP"; then
+  ac_path_EGREP_found=false
+  # Loop through the user's path and test for each of PROGNAME-LIST
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_prog in egrep; do
+    for ac_exec_ext in '' $ac_executable_extensions; do
+      ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
+      as_fn_executable_p "$ac_path_EGREP" || continue
+# Check for GNU ac_path_EGREP and select it if it is found.
+  # Check for GNU $ac_path_EGREP
+case `"$ac_path_EGREP" --version 2>&1` in
+*GNU*)
+  ac_cv_path_EGREP="$ac_path_EGREP" ac_path_EGREP_found=:;;
+*)
+  ac_count=0
+  $as_echo_n 0123456789 >"conftest.in"
+  while :
+  do
+    cat "conftest.in" "conftest.in" >"conftest.tmp"
+    mv "conftest.tmp" "conftest.in"
+    cp "conftest.in" "conftest.nl"
+    $as_echo 'EGREP' >> "conftest.nl"
+    "$ac_path_EGREP" 'EGREP$' < "conftest.nl" >"conftest.out" 2>/dev/null || break
+    diff "conftest.out" "conftest.nl" >/dev/null 2>&1 || break
+    as_fn_arith $ac_count + 1 && ac_count=$as_val
+    if test $ac_count -gt ${ac_path_EGREP_max-0}; then
+      # Best one so far, save it but keep looking for a better one
+      ac_cv_path_EGREP="$ac_path_EGREP"
+      ac_path_EGREP_max=$ac_count
+    fi
+    # 10*(2^10) chars as input seems more than enough
+    test $ac_count -gt 10 && break
+  done
+  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;
+esac
+
+      $ac_path_EGREP_found && break 3
+    done
+  done
+  done
+IFS=$as_save_IFS
+  if test -z "$ac_cv_path_EGREP"; then
+    as_fn_error $? "no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin" "$LINENO" 5
+  fi
+else
+  ac_cv_path_EGREP=$EGREP
+fi
+
+   fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP" >&5
+$as_echo "$ac_cv_path_EGREP" >&6; }
+ EGREP="$ac_cv_path_EGREP"
+
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
+$as_echo_n "checking whether ln -s works... " >&6; }
+LN_S=$as_ln_s
+if test "$LN_S" = "ln -s"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
+$as_echo "no, using $LN_S" >&6; }
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+$as_echo_n "checking whether ${MAKE-make} sets \$(MAKE)... " >&6; }
+set x ${MAKE-make}
+ac_make=`$as_echo "$2" | sed 's/+/p/g; s/[^a-zA-Z0-9_]/_/g'`
+if eval \${ac_cv_prog_make_${ac_make}_set+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat >conftest.make <<\_ACEOF
+SHELL = /bin/sh
+all:
+	@echo '@@@%%%=$(MAKE)=@@@%%%'
+_ACEOF
+# GNU make sometimes prints "make[1]: Entering ...", which would confuse us.
+case `${MAKE-make} -f conftest.make 2>/dev/null` in
+  *@@@%%%=?*=@@@%%%*)
+    eval ac_cv_prog_make_${ac_make}_set=yes;;
+  *)
+    eval ac_cv_prog_make_${ac_make}_set=no;;
+esac
+rm -f conftest.make
+fi
+if eval test \$ac_cv_prog_make_${ac_make}_set = yes; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+  SET_MAKE=
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+  SET_MAKE="MAKE=${MAKE-make}"
+fi
+
+
+ if test "x$GCC" = "xyes"; then
+  COMPILER_IS_GCC_TRUE=
+  COMPILER_IS_GCC_FALSE='#'
+else
+  COMPILER_IS_GCC_TRUE='#'
+  COMPILER_IS_GCC_FALSE=
+fi
+
+
+# Check whether --enable-static was given.
+if test "${enable_static+set}" = set; then :
+  enableval=$enable_static; p=${PACKAGE-default}
+    case $enableval in
+    yes) enable_static=yes ;;
+    no) enable_static=no ;;
+    *)
+     enable_static=no
+      # Look at the argument we got.  We use all the common list separators.
+      lt_save_ifs="$IFS"; IFS="${IFS}$PATH_SEPARATOR,"
+      for pkg in $enableval; do
+	IFS="$lt_save_ifs"
+	if test "X$pkg" = "X$p"; then
+	  enable_static=yes
+	fi
+      done
+      IFS="$lt_save_ifs"
+      ;;
+    esac
+else
+  enable_static=no
+fi
+
+
+
+
+
+
+
+for ac_prog in flex lex
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_LEX+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$LEX"; then
+  ac_cv_prog_LEX="$LEX" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_LEX="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+LEX=$ac_cv_prog_LEX
+if test -n "$LEX"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LEX" >&5
+$as_echo "$LEX" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$LEX" && break
+done
+test -n "$LEX" || LEX=":"
+
+if test "x$LEX" != "x:"; then
+  cat >conftest.l <<_ACEOF
+%%
+a { ECHO; }
+b { REJECT; }
+c { yymore (); }
+d { yyless (1); }
+e { /* IRIX 6.5 flex 2.5.4 underquotes its yyless argument.  */
+    yyless ((input () != 0)); }
+f { unput (yytext[0]); }
+. { BEGIN INITIAL; }
+%%
+#ifdef YYTEXT_POINTER
+extern char *yytext;
+#endif
+int
+main (void)
+{
+  return ! yylex () + ! yywrap ();
+}
+_ACEOF
+{ { ac_try="$LEX conftest.l"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$LEX conftest.l") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking lex output file root" >&5
+$as_echo_n "checking lex output file root... " >&6; }
+if ${ac_cv_prog_lex_root+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+if test -f lex.yy.c; then
+  ac_cv_prog_lex_root=lex.yy
+elif test -f lexyy.c; then
+  ac_cv_prog_lex_root=lexyy
+else
+  as_fn_error $? "cannot find output from $LEX; giving up" "$LINENO" 5
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_lex_root" >&5
+$as_echo "$ac_cv_prog_lex_root" >&6; }
+LEX_OUTPUT_ROOT=$ac_cv_prog_lex_root
+
+if test -z "${LEXLIB+set}"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking lex library" >&5
+$as_echo_n "checking lex library... " >&6; }
+if ${ac_cv_lib_lex+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    ac_save_LIBS=$LIBS
+    ac_cv_lib_lex='none needed'
+    for ac_lib in '' -lfl -ll; do
+      LIBS="$ac_lib $ac_save_LIBS"
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+`cat $LEX_OUTPUT_ROOT.c`
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_lex=$ac_lib
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+      test "$ac_cv_lib_lex" != 'none needed' && break
+    done
+    LIBS=$ac_save_LIBS
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_lex" >&5
+$as_echo "$ac_cv_lib_lex" >&6; }
+  test "$ac_cv_lib_lex" != 'none needed' && LEXLIB=$ac_cv_lib_lex
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether yytext is a pointer" >&5
+$as_echo_n "checking whether yytext is a pointer... " >&6; }
+if ${ac_cv_prog_lex_yytext_pointer+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  # POSIX says lex can declare yytext either as a pointer or an array; the
+# default is implementation-dependent.  Figure out which it is, since
+# not all implementations provide the %pointer and %array declarations.
+ac_cv_prog_lex_yytext_pointer=no
+ac_save_LIBS=$LIBS
+LIBS="$LEXLIB $ac_save_LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+  #define YYTEXT_POINTER 1
+`cat $LEX_OUTPUT_ROOT.c`
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_prog_lex_yytext_pointer=yes
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_save_LIBS
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_lex_yytext_pointer" >&5
+$as_echo "$ac_cv_prog_lex_yytext_pointer" >&6; }
+if test $ac_cv_prog_lex_yytext_pointer = yes; then
+
+$as_echo "#define YYTEXT_POINTER 1" >>confdefs.h
+
+fi
+rm -f conftest.l $LEX_OUTPUT_ROOT.c
+
+fi
+for ac_prog in 'bison -y' byacc
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_prog_YACC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test -n "$YACC"; then
+  ac_cv_prog_YACC="$YACC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_YACC="$ac_prog"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+fi
+fi
+YACC=$ac_cv_prog_YACC
+if test -n "$YACC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $YACC" >&5
+$as_echo "$YACC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+  test -n "$YACC" && break
+done
+test -n "$YACC" || YACC="yacc"
+
+
+# Extract the first word of "valgrind", so it can be a program name with args.
+set dummy valgrind; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_VALGRIND+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $VALGRIND in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_VALGRIND="$VALGRIND" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_VALGRIND="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+VALGRIND=$ac_cv_path_VALGRIND
+if test -n "$VALGRIND"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $VALGRIND" >&5
+$as_echo "$VALGRIND" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+
+# Warn when pkg.m4 is missing
+
+
+
+
+
+
+
+
+
+if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
+	if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
+set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+PKG_CONFIG=$ac_cv_path_PKG_CONFIG
+if test -n "$PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
+$as_echo "$PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test -z "$ac_cv_path_PKG_CONFIG"; then
+  ac_pt_PKG_CONFIG=$PKG_CONFIG
+  # Extract the first word of "pkg-config", so it can be a program name with args.
+set dummy pkg-config; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $ac_pt_PKG_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
+if test -n "$ac_pt_PKG_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
+$as_echo "$ac_pt_PKG_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+  if test "x$ac_pt_PKG_CONFIG" = x; then
+    PKG_CONFIG=""
+  else
+    case $cross_compiling:$ac_tool_warned in
+yes:)
+{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
+$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
+ac_tool_warned=yes ;;
+esac
+    PKG_CONFIG=$ac_pt_PKG_CONFIG
+  fi
+else
+  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
+fi
+
+fi
+if test -n "$PKG_CONFIG"; then
+	_pkg_min_version=0.9.0
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
+$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
+	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+		PKG_CONFIG=""
+	fi
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if bison is the parser generator" >&5
+$as_echo_n "checking if bison is the parser generator... " >&6; }
+if ${collectd_cv_prog_bison+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if $YACC --version 2>/dev/null | $EGREP -q '^bison '; then :
+  collectd_cv_prog_bison=yes
+else
+  collectd_cv_prog_bison=no
+
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $collectd_cv_prog_bison" >&5
+$as_echo "$collectd_cv_prog_bison" >&6; }
+
+if test "x$collectd_cv_prog_bison" = "xno" && test ! -f "${srcdir}/src/liboconfig/parser.c"
+then
+	as_fn_error $? "bison is missing and you do not have ${srcdir}/src/liboconfig/parser.c. Please install bison" "$LINENO" 5
+fi
+
+
+# Extract the first word of "protoc", so it can be a program name with args.
+set dummy protoc; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PROTOC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PROTOC in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PROTOC="$PROTOC" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PROTOC="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+PROTOC=$ac_cv_path_PROTOC
+if test -n "$PROTOC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PROTOC" >&5
+$as_echo "$PROTOC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+have_protoc3="no"
+if test "x$PROTOC" != "x"; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for protoc 3.0.0+" >&5
+$as_echo_n "checking for protoc 3.0.0+... " >&6; }
+	if $PROTOC --version | $EGREP libprotoc.3 >/dev/null; then
+		protoc3="yes (`$PROTOC --version`)"
+		have_protoc3="yes"
+	else
+		protoc3="no (`$PROTOC --version`)"
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $protoc3" >&5
+$as_echo "$protoc3" >&6; }
+fi
+ if test "x$have_protoc3" = "xyes"; then
+  HAVE_PROTOC3_TRUE=
+  HAVE_PROTOC3_FALSE='#'
+else
+  HAVE_PROTOC3_TRUE='#'
+  HAVE_PROTOC3_FALSE=
+fi
+
+
+
+# Extract the first word of "grpc_cpp_plugin", so it can be a program name with args.
+set dummy grpc_cpp_plugin; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_GRPC_CPP_PLUGIN+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $GRPC_CPP_PLUGIN in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_GRPC_CPP_PLUGIN="$GRPC_CPP_PLUGIN" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_GRPC_CPP_PLUGIN="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+GRPC_CPP_PLUGIN=$ac_cv_path_GRPC_CPP_PLUGIN
+if test -n "$GRPC_CPP_PLUGIN"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $GRPC_CPP_PLUGIN" >&5
+$as_echo "$GRPC_CPP_PLUGIN" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+ if test "x$GRPC_CPP_PLUGIN" != "x"; then
+  HAVE_GRPC_CPP_TRUE=
+  HAVE_GRPC_CPP_FALSE='#'
+else
+  HAVE_GRPC_CPP_TRUE='#'
+  HAVE_GRPC_CPP_FALSE=
+fi
+
+
+
+# Extract the first word of "protoc-c", so it can be a program name with args.
+set dummy protoc-c; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PROTOC_C+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PROTOC_C in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PROTOC_C="$PROTOC_C" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PROTOC_C="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+PROTOC_C=$ac_cv_path_PROTOC_C
+if test -n "$PROTOC_C"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PROTOC_C" >&5
+$as_echo "$PROTOC_C" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+if test "x$PROTOC_C" = "x"
+then
+  have_protoc_c="no (protoc-c compiler not found)"
+else
+  have_protoc_c="yes"
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kernel type ($host_os)" >&5
+$as_echo_n "checking for kernel type ($host_os)... " >&6; }
+case $host_os in
+	*linux*)
+
+$as_echo "#define KERNEL_LINUX 1" >>confdefs.h
+
+	ac_system="Linux"
+	;;
+	*solaris*)
+
+$as_echo "#define KERNEL_SOLARIS 1" >>confdefs.h
+
+	ac_system="Solaris"
+	;;
+	*darwin*)
+
+$as_echo "#define KERNEL_DARWIN 1" >>confdefs.h
+
+	ac_system="Darwin"
+	;;
+	*openbsd*)
+
+$as_echo "#define KERNEL_OPENBSD 1" >>confdefs.h
+
+	ac_system="OpenBSD"
+	;;
+	*netbsd*)
+
+$as_echo "#define KERNEL_NETBSD 1" >>confdefs.h
+
+	ac_system="NetBSD"
+	;;
+	*aix*)
+
+$as_echo "#define KERNEL_AIX 1" >>confdefs.h
+
+	ac_system="AIX"
+	;;
+	*freebsd*)
+
+$as_echo "#define KERNEL_FREEBSD 1" >>confdefs.h
+
+	ac_system="FreeBSD"
+	;;
+	*)
+	ac_system="unknown"
+esac
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_system" >&5
+$as_echo "$ac_system" >&6; }
+
+ if test "x$ac_system" = "xAIX"; then
+  BUILD_AIX_TRUE=
+  BUILD_AIX_FALSE='#'
+else
+  BUILD_AIX_TRUE='#'
+  BUILD_AIX_FALSE=
+fi
+
+ if test "x$ac_system" = "xDarwin"; then
+  BUILD_DARWIN_TRUE=
+  BUILD_DARWIN_FALSE='#'
+else
+  BUILD_DARWIN_TRUE='#'
+  BUILD_DARWIN_FALSE=
+fi
+
+ if test "x$ac_system" = "xFreeBSD"; then
+  BUILD_FREEBSD_TRUE=
+  BUILD_FREEBSD_FALSE='#'
+else
+  BUILD_FREEBSD_TRUE='#'
+  BUILD_FREEBSD_FALSE=
+fi
+
+ if test "x$ac_system" = "xLinux"; then
+  BUILD_LINUX_TRUE=
+  BUILD_LINUX_FALSE='#'
+else
+  BUILD_LINUX_TRUE='#'
+  BUILD_LINUX_FALSE=
+fi
+
+ if test "x$ac_system" = "xOpenBSD"; then
+  BUILD_OPENBSD_TRUE=
+  BUILD_OPENBSD_FALSE='#'
+else
+  BUILD_OPENBSD_TRUE='#'
+  BUILD_OPENBSD_FALSE=
+fi
+
+ if test "x$ac_system" = "xSolaris"; then
+  BUILD_SOLARIS_TRUE=
+  BUILD_SOLARIS_FALSE='#'
+else
+  BUILD_SOLARIS_TRUE='#'
+  BUILD_SOLARIS_FALSE=
+fi
+
+
+if test "x$ac_system" = "xLinux"
+then
+
+	if test -z "$KERNEL_DIR"
+	then
+		KERNEL_DIR="/lib/modules/`uname -r`/source"
+	fi
+
+	KERNEL_CFLAGS="-I$KERNEL_DIR/include"
+
+fi
+
+if test "x$ac_system" = "xSolaris"
+then
+
+$as_echo "#define _POSIX_PTHREAD_SEMANTICS 1" >>confdefs.h
+
+
+$as_echo "#define _REENTRANT 1" >>confdefs.h
+
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether compiler builds 64bit binaries" >&5
+$as_echo_n "checking whether compiler builds 64bit binaries... " >&6; }
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+			   #ifndef _LP64
+			   # error "Compiler not in 64bit mode."
+			   #endif
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+else
+
+			    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+			    { $as_echo "$as_me:${as_lineno-$LINENO}: Solaris detected. Please consider building a 64-bit binary." >&5
+$as_echo "$as_me: Solaris detected. Please consider building a 64-bit binary." >&6;}
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+
+if test "x$ac_system" = "xAIX"
+then
+
+$as_echo "#define _THREAD_SAFE_ERRNO 1" >>confdefs.h
+
+fi
+
+# Where to install .pc files.
+pkgconfigdir="${libdir}/pkgconfig"
+
+
+# Check for standards compliance mode
+# Check whether --enable-standards was given.
+if test "${enable_standards+set}" = set; then :
+  enableval=$enable_standards; enable_standards="$enableval"
+else
+  enable_standards="no"
+fi
+
+if test "x$enable_standards" = "xyes"
+then
+
+$as_echo "#define _ISOC99_SOURCE 1" >>confdefs.h
+
+
+$as_echo "#define _POSIX_C_SOURCE 200809L" >>confdefs.h
+
+
+$as_echo "#define _XOPEN_SOURCE 700" >>confdefs.h
+
+
+$as_echo "#define _REENTRANT 1" >>confdefs.h
+
+	if test "x$GCC" = "xyes"
+	then
+		CFLAGS="$CFLAGS -std=c99"
+	fi
+fi
+ if test "x$enable_standards" = "xyes"; then
+  BUILD_FEATURE_STANDARDS_TRUE=
+  BUILD_FEATURE_STANDARDS_FALSE='#'
+else
+  BUILD_FEATURE_STANDARDS_TRUE='#'
+  BUILD_FEATURE_STANDARDS_FALSE=
+fi
+
+
+#
+# Checks for header files.
+#
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ANSI C header files" >&5
+$as_echo_n "checking for ANSI C header files... " >&6; }
+if ${ac_cv_header_stdc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_stdc=yes
+else
+  ac_cv_header_stdc=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <string.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "memchr" >/dev/null 2>&1; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <stdlib.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "free" >/dev/null 2>&1; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+  if test "$cross_compiling" = yes; then :
+  :
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <ctype.h>
+#include <stdlib.h>
+#if ((' ' & 0x0FF) == 0x020)
+# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#else
+# define ISLOWER(c) \
+		   (('a' <= (c) && (c) <= 'i') \
+		     || ('j' <= (c) && (c) <= 'r') \
+		     || ('s' <= (c) && (c) <= 'z'))
+# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
+#endif
+
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int
+main ()
+{
+  int i;
+  for (i = 0; i < 256; i++)
+    if (XOR (islower (i), ISLOWER (i))
+	|| toupper (i) != TOUPPER (i))
+      return 2;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+
+else
+  ac_cv_header_stdc=no
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+fi
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
+$as_echo "$ac_cv_header_stdc" >&6; }
+if test $ac_cv_header_stdc = yes; then
+
+$as_echo "#define STDC_HEADERS 1" >>confdefs.h
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sys/wait.h that is POSIX.1 compatible" >&5
+$as_echo_n "checking for sys/wait.h that is POSIX.1 compatible... " >&6; }
+if ${ac_cv_header_sys_wait_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+#include <sys/wait.h>
+#ifndef WEXITSTATUS
+# define WEXITSTATUS(stat_val) ((unsigned int) (stat_val) >> 8)
+#endif
+#ifndef WIFEXITED
+# define WIFEXITED(stat_val) (((stat_val) & 255) == 0)
+#endif
+
+int
+main ()
+{
+  int s;
+  wait (&s);
+  s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_sys_wait_h=yes
+else
+  ac_cv_header_sys_wait_h=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_sys_wait_h" >&5
+$as_echo "$ac_cv_header_sys_wait_h" >&6; }
+if test $ac_cv_header_sys_wait_h = yes; then
+
+$as_echo "#define HAVE_SYS_WAIT_H 1" >>confdefs.h
+
+fi
+
+ac_header_dirent=no
+for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h; do
+  as_ac_Header=`$as_echo "ac_cv_header_dirent_$ac_hdr" | $as_tr_sh`
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_hdr that defines DIR" >&5
+$as_echo_n "checking for $ac_hdr that defines DIR... " >&6; }
+if eval \${$as_ac_Header+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+#include <$ac_hdr>
+
+int
+main ()
+{
+if ((DIR *) 0)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  eval "$as_ac_Header=yes"
+else
+  eval "$as_ac_Header=no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+eval ac_res=\$$as_ac_Header
+	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
+$as_echo "$ac_res" >&6; }
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_hdr" | $as_tr_cpp` 1
+_ACEOF
+
+ac_header_dirent=$ac_hdr; break
+fi
+
+done
+# Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
+if test $ac_header_dirent = dirent.h; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
+$as_echo_n "checking for library containing opendir... " >&6; }
+if ${ac_cv_search_opendir+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char opendir ();
+int
+main ()
+{
+return opendir ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' dir; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_search_opendir=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_opendir+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_opendir+:} false; then :
+
+else
+  ac_cv_search_opendir=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_opendir" >&5
+$as_echo "$ac_cv_search_opendir" >&6; }
+ac_res=$ac_cv_search_opendir
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
+$as_echo_n "checking for library containing opendir... " >&6; }
+if ${ac_cv_search_opendir+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char opendir ();
+int
+main ()
+{
+return opendir ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' x; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_search_opendir=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_opendir+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_opendir+:} false; then :
+
+else
+  ac_cv_search_opendir=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_opendir" >&5
+$as_echo "$ac_cv_search_opendir" >&6; }
+ac_res=$ac_cv_search_opendir
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+
+fi
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for stdbool.h that conforms to C99" >&5
+$as_echo_n "checking for stdbool.h that conforms to C99... " >&6; }
+if ${ac_cv_header_stdbool_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+             #include <stdbool.h>
+             #ifndef bool
+              "error: bool is not defined"
+             #endif
+             #ifndef false
+              "error: false is not defined"
+             #endif
+             #if false
+              "error: false is not 0"
+             #endif
+             #ifndef true
+              "error: true is not defined"
+             #endif
+             #if true != 1
+              "error: true is not 1"
+             #endif
+             #ifndef __bool_true_false_are_defined
+              "error: __bool_true_false_are_defined is not defined"
+             #endif
+
+             struct s { _Bool s: 1; _Bool t; } s;
+
+             char a[true == 1 ? 1 : -1];
+             char b[false == 0 ? 1 : -1];
+             char c[__bool_true_false_are_defined == 1 ? 1 : -1];
+             char d[(bool) 0.5 == true ? 1 : -1];
+             /* See body of main program for 'e'.  */
+             char f[(_Bool) 0.0 == false ? 1 : -1];
+             char g[true];
+             char h[sizeof (_Bool)];
+             char i[sizeof s.t];
+             enum { j = false, k = true, l = false * true, m = true * 256 };
+             /* The following fails for
+                HP aC++/ANSI C B3910B A.05.55 [Dec 04 2003]. */
+             _Bool n[m];
+             char o[sizeof n == m * sizeof n[0] ? 1 : -1];
+             char p[-1 - (_Bool) 0 < 0 && -1 - (bool) 0 < 0 ? 1 : -1];
+             /* Catch a bug in an HP-UX C compiler.  See
+                http://gcc.gnu.org/ml/gcc-patches/2003-12/msg02303.html
+                http://lists.gnu.org/archive/html/bug-coreutils/2005-11/msg00161.html
+              */
+             _Bool q = true;
+             _Bool *pq = &q;
+
+int
+main ()
+{
+
+             bool e = &s;
+             *pq |= q;
+             *pq |= ! q;
+             /* Refer to every declared value, to avoid compiler optimizations.  */
+             return (!a + !b + !c + !d + !e + !f + !g + !h + !i + !!j + !k + !!l
+                     + !m + !n + !o + !p + !q + !pq);
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_stdbool_h=yes
+else
+  ac_cv_header_stdbool_h=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdbool_h" >&5
+$as_echo "$ac_cv_header_stdbool_h" >&6; }
+   ac_fn_c_check_type "$LINENO" "_Bool" "ac_cv_type__Bool" "$ac_includes_default"
+if test "x$ac_cv_type__Bool" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE__BOOL 1
+_ACEOF
+
+
+fi
+
+
+if test $ac_cv_header_stdbool_h = yes; then
+
+$as_echo "#define HAVE_STDBOOL_H 1" >>confdefs.h
+
+fi
+
+
+for ac_header in stdio.h errno.h math.h stdarg.h syslog.h fcntl.h signal.h assert.h sys/types.h sys/socket.h sys/select.h poll.h netdb.h arpa/inet.h sys/resource.h sys/param.h kstat.h regex.h sys/ioctl.h endian.h sys/isa_defs.h fnmatch.h libgen.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+# For entropy plugin on newer NetBSD
+for ac_header in sys/rndio.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "sys/rndio.h" "ac_cv_header_sys_rndio_h" "#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+
+"
+if test "x$ac_cv_header_sys_rndio_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_RNDIO_H 1
+_ACEOF
+
+fi
+
+done
+
+
+# For ping library
+for ac_header in netinet/in_systm.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/in_systm.h" "ac_cv_header_netinet_in_systm_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_in_systm_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IN_SYSTM_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/in.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/in.h" "ac_cv_header_netinet_in_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_in_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IN_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/ip.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/ip.h" "ac_cv_header_netinet_ip_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_ip_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IP_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/ip_icmp.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/ip_icmp.h" "ac_cv_header_netinet_ip_icmp_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_ip_icmp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IP_ICMP_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/ip_var.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/ip_var.h" "ac_cv_header_netinet_ip_var_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_ip_var_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IP_VAR_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/ip6.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/ip6.h" "ac_cv_header_netinet_ip6_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_ip6_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IP6_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/icmp6.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/icmp6.h" "ac_cv_header_netinet_icmp6_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_icmp6_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_ICMP6_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/tcp.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/tcp.h" "ac_cv_header_netinet_tcp_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_tcp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_TCP_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/udp.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/udp.h" "ac_cv_header_netinet_udp_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_udp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_UDP_H 1
+_ACEOF
+
+fi
+
+done
+
+
+have_ip6_ext="no"
+ac_fn_c_check_type "$LINENO" "struct ip6_ext" "ac_cv_type_struct_ip6_ext" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+
+"
+if test "x$ac_cv_type_struct_ip6_ext" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IP6_EXT 1
+_ACEOF
+
+have_ip6_ext="yes"
+else
+  have_ip6_ext="no"
+fi
+
+
+if test "x$have_ip6_ext" = "xno"; then
+	SAVE_CFLAGS="$CFLAGS"
+	CFLAGS="$CFLAGS -DSOLARIS2=8"
+
+	ac_fn_c_check_type "$LINENO" "struct ip6_ext" "ac_cv_type_struct_ip6_ext" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP6_H
+# include <netinet/ip6.h>
+#endif
+
+"
+if test "x$ac_cv_type_struct_ip6_ext" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IP6_EXT 1
+_ACEOF
+
+have_ip6_ext="yes, with -DSOLARIS2=8"
+else
+  have_ip6_ext="no"
+fi
+
+
+	if test "x$have_ip6_ext" = "xno"; then
+		CFLAGS="$SAVE_CFLAGS"
+	fi
+fi
+
+# For cpu modules
+for ac_header in sys/dkstat.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "sys/dkstat.h" "ac_cv_header_sys_dkstat_h" "$ac_includes_default"
+if test "x$ac_cv_header_sys_dkstat_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_DKSTAT_H 1
+_ACEOF
+
+fi
+
+done
+
+if test "x$ac_system" = "xDarwin"
+then
+	for ac_header in mach/mach_init.h mach/host_priv.h mach/mach_error.h mach/mach_host.h mach/mach_port.h mach/mach_types.h mach/message.h mach/processor_set.h mach/processor.h mach/processor_info.h mach/task.h mach/thread_act.h mach/vm_region.h mach/vm_map.h mach/vm_prot.h mach/vm_statistics.h mach/kern_return.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+	for ac_header in CoreFoundation/CoreFoundation.h IOKit/IOKitLib.h IOKit/IOTypes.h IOKit/ps/IOPSKeys.h IOKit/IOBSD.h IOKit/storage/IOBlockStorageDriver.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+	# For the battery plugin
+	for ac_header in IOKit/ps/IOPowerSources.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "IOKit/ps/IOPowerSources.h" "ac_cv_header_IOKit_ps_IOPowerSources_h" "
+#if HAVE_IOKIT_IOKITLIB_H
+#  include <IOKit/IOKitLib.h>
+#endif
+#if HAVE_IOKIT_IOTYPES_H
+#  include <IOKit/IOTypes.h>
+#endif
+
+"
+if test "x$ac_cv_header_IOKit_ps_IOPowerSources_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_IOKIT_PS_IOPOWERSOURCES_H 1
+_ACEOF
+
+fi
+
+done
+
+
+fi
+
+for ac_header in sys/sysctl.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "sys/sysctl.h" "ac_cv_header_sys_sysctl_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+
+"
+if test "x$ac_cv_header_sys_sysctl_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_SYSCTL_H 1
+_ACEOF
+
+fi
+
+done
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysctl kern.cp_times" >&5
+$as_echo_n "checking for sysctl kern.cp_times... " >&6; }
+if test -x /sbin/sysctl
+then
+	/sbin/sysctl kern.cp_times >/dev/null 2>&1
+	if test $? -eq 0
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE_SYSCTL_KERN_CP_TIMES 1" >>confdefs.h
+
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	fi
+else
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysctl kern.cp_time" >&5
+$as_echo_n "checking for sysctl kern.cp_time... " >&6; }
+if test -x /sbin/sysctl
+then
+	/sbin/sysctl kern.cp_time >/dev/null 2>&1
+	if test $? -eq 0
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+$as_echo "#define HAVE_SYSCTL_KERN_CP_TIME 1" >>confdefs.h
+
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	fi
+else
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+# For hddtemp module
+for ac_header in linux/major.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "linux/major.h" "ac_cv_header_linux_major_h" "$ac_includes_default"
+if test "x$ac_cv_header_linux_major_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_MAJOR_H 1
+_ACEOF
+
+fi
+
+done
+
+
+# For md module (Linux only)
+if test "x$ac_system" = "xLinux"
+then
+	for ac_header in linux/raid/md_u.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/raid/md_u.h" "ac_cv_header_linux_raid_md_u_h" "
+#include <sys/ioctl.h>
+#include <linux/major.h>
+#include <linux/types.h>
+
+"
+if test "x$ac_cv_header_linux_raid_md_u_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_RAID_MD_U_H 1
+_ACEOF
+ have_linux_raid_md_u_h="yes"
+else
+  have_linux_raid_md_u_h="no"
+fi
+
+done
+
+	for ac_header in sys/sysmacros.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "sys/sysmacros.h" "ac_cv_header_sys_sysmacros_h" "$ac_includes_default"
+if test "x$ac_cv_header_sys_sysmacros_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_SYSMACROS_H 1
+_ACEOF
+
+fi
+
+done
+
+else
+	have_linux_raid_md_u_h="no"
+fi
+
+# For the wireless module
+have_linux_wireless_h="no"
+if test "x$ac_system" = "xLinux"
+then
+  for ac_header in linux/wireless.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/wireless.h" "ac_cv_header_linux_wireless_h" "
+#include <dirent.h>
+#include <sys/ioctl.h>
+#include <sys/socket.h>
+
+"
+if test "x$ac_cv_header_linux_wireless_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_WIRELESS_H 1
+_ACEOF
+ have_linux_wireless_h="yes"
+else
+  have_linux_wireless_h="no"
+fi
+
+done
+
+fi
+
+# For the swap module
+have_sys_swap_h="yes"
+for ac_header in sys/swap.h vm/anon.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
+#undef _FILE_OFFSET_BITS
+#undef _LARGEFILE64_SOURCE
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+
+"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  have_sys_swap_h="no"
+fi
+
+done
+
+
+# For load module
+# For the processes plugin
+# For users module
+for ac_header in sys/loadavg.h linux/config.h utmp.h utmpx.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+# For interface plugin
+for ac_header in ifaddrs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "ifaddrs.h" "ac_cv_header_ifaddrs_h" "$ac_includes_default"
+if test "x$ac_cv_header_ifaddrs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_IFADDRS_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in net/if.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "net/if.h" "ac_cv_header_net_if_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+#  include <sys/socket.h>
+#endif
+
+"
+if test "x$ac_cv_header_net_if_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_IF_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in linux/if.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/if.h" "ac_cv_header_linux_if_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+#  include <sys/socket.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_if_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_IF_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in linux/inet_diag.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/inet_diag.h" "ac_cv_header_linux_inet_diag_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+#  include <sys/socket.h>
+#endif
+#if HAVE_LINUX_INET_DIAG_H
+# include <linux/inet_diag.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_inet_diag_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_INET_DIAG_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in linux/netdevice.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/netdevice.h" "ac_cv_header_linux_netdevice_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+#  include <sys/socket.h>
+#endif
+#if HAVE_LINUX_IF_H
+# include <linux/if.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_netdevice_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_NETDEVICE_H 1
+_ACEOF
+
+fi
+
+done
+
+
+# For ethstat module
+for ac_header in linux/sockios.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/sockios.h" "ac_cv_header_linux_sockios_h" "
+#if HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#if HAVE_NET_IF_H
+# include <net/if.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_sockios_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_SOCKIOS_H 1
+_ACEOF
+ have_linux_sockios_h="yes"
+else
+  have_linux_sockios_h="no"
+fi
+
+done
+
+for ac_header in linux/ethtool.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/ethtool.h" "ac_cv_header_linux_ethtool_h" "
+#if HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#if HAVE_NET_IF_H
+# include <net/if.h>
+#endif
+#if HAVE_LINUX_SOCKIOS_H
+# include <linux/sockios.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_ethtool_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_ETHTOOL_H 1
+_ACEOF
+ have_linux_ethtool_h="yes"
+else
+  have_linux_ethtool_h="no"
+fi
+
+done
+
+
+# For ipvs module
+have_linux_ip_vs_h="no"
+have_net_ip_vs_h="no"
+have_ip_vs_h="no"
+ip_vs_h_needs_kernel_cflags="no"
+if test "x$ac_system" = "xLinux"
+then
+	for ac_header in linux/ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "linux/ip_vs.h" "ac_cv_header_linux_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_linux_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_IP_VS_H 1
+_ACEOF
+ have_linux_ip_vs_h="yes"
+fi
+
+done
+
+	for ac_header in net/ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "net/ip_vs.h" "ac_cv_header_net_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_net_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_IP_VS_H 1
+_ACEOF
+ have_net_ip_vs_h="yes"
+fi
+
+done
+
+	for ac_header in ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "ip_vs.h" "ac_cv_header_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_IP_VS_H 1
+_ACEOF
+ have_ip_vs_h="yes"
+fi
+
+done
+
+
+	if test "x$have_linux_ip_vs_h$have_net_ip_vs_h$have_ip_vs_h" = "xnonono" && test -d "$KERNEL_DIR"
+	then
+		SAVE_CFLAGS="$CFLAGS"
+		CFLAGS="$CFLAGS $KERNEL_CFLAGS"
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: Did not find ip_vs.h. Trying again using headers from $KERNEL_DIR." >&5
+$as_echo "$as_me: Did not find ip_vs.h. Trying again using headers from $KERNEL_DIR." >&6;}
+
+		for ac_header in linux/ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "linux/ip_vs.h" "ac_cv_header_linux_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_linux_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_IP_VS_H 1
+_ACEOF
+ have_linux_ip_vs_h="yes"
+fi
+
+done
+
+		for ac_header in net/ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "net/ip_vs.h" "ac_cv_header_net_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_net_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_IP_VS_H 1
+_ACEOF
+ have_net_ip_vs_h="yes"
+fi
+
+done
+
+		for ac_header in ip_vs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "ip_vs.h" "ac_cv_header_ip_vs_h" "$ac_includes_default"
+if test "x$ac_cv_header_ip_vs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_IP_VS_H 1
+_ACEOF
+ have_ip_vs_h="yes"
+fi
+
+done
+
+
+		if test "x$have_linux_ip_vs_h" = "xyes" || test "x$have_net_ip_vs_h" = "xyes" || test "x$have_ip_vs_h" = "xyes"
+		then
+			ip_vs_h_needs_kernel_cflags="yes"
+		fi
+
+		CFLAGS="$SAVE_CFLAGS"
+	fi
+fi
+ if test "x$ip_vs_h_needs_kernel_cflags" = "xyes"; then
+  IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE=
+  IP_VS_H_NEEDS_KERNEL_CFLAGS_FALSE='#'
+else
+  IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE='#'
+  IP_VS_H_NEEDS_KERNEL_CFLAGS_FALSE=
+fi
+
+
+# For quota module
+for ac_header in sys/ucred.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "sys/ucred.h" "ac_cv_header_sys_ucred_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+
+"
+if test "x$ac_cv_header_sys_ucred_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_UCRED_H 1
+_ACEOF
+
+fi
+
+done
+
+
+# For mount interface
+for ac_header in sys/mount.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "sys/mount.h" "ac_cv_header_sys_mount_h" "
+#if HAVE_SYS_TYPES_H
+#  include <sys/types.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+
+"
+if test "x$ac_cv_header_sys_mount_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_MOUNT_H 1
+_ACEOF
+
+fi
+
+done
+
+
+# For the email plugin
+for ac_header in linux/un.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "linux/un.h" "ac_cv_header_linux_un_h" "
+#if HAVE_SYS_SOCKET_H
+#	include <sys/socket.h>
+#endif
+
+"
+if test "x$ac_cv_header_linux_un_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LINUX_UN_H 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in  \
+  ctype.h \
+  fs_info.h \
+  fshelp.h \
+  grp.h \
+  kvm.h \
+  limits.h \
+  locale.h \
+  mntent.h \
+  mnttab.h \
+  paths.h \
+  pwd.h \
+  sys/fs_types.h \
+  sys/fstyp.h \
+  sys/mntent.h \
+  sys/mnttab.h \
+  sys/statfs.h \
+  sys/statvfs.h \
+  sys/un.h \
+  sys/vfs.h \
+  sys/vfstab.h \
+  sys/vmmeter.h \
+  wordexp.h \
+
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+# --enable-xfs {{{
+# Check whether --enable-xfs was given.
+if test "${enable_xfs+set}" = set; then :
+  enableval=$enable_xfs;
+else
+  enable_xfs="auto"
+
+fi
+
+
+if test "x$enable_xfs" != "xno"; then
+  for ac_header in xfs/xqm.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "xfs/xqm.h" "ac_cv_header_xfs_xqm_h" "#define _GNU_SOURCE
+
+"
+if test "x$ac_cv_header_xfs_xqm_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_XFS_XQM_H 1
+_ACEOF
+
+else
+
+      if test "x$enable_xfs" = "xyes"; then
+        as_fn_error $? "xfs/xqm.h not found" "$LINENO" 5
+      fi
+
+fi
+
+done
+
+fi
+
+# }}}
+
+# For the dns plugin
+for ac_header in arpa/nameser.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "arpa/nameser.h" "ac_cv_header_arpa_nameser_h" "$ac_includes_default"
+if test "x$ac_cv_header_arpa_nameser_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_ARPA_NAMESER_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in arpa/nameser_compat.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "arpa/nameser_compat.h" "ac_cv_header_arpa_nameser_compat_h" "
+#if HAVE_ARPA_NAMESER_H
+# include <arpa/nameser.h>
+#endif
+
+"
+if test "x$ac_cv_header_arpa_nameser_compat_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_ARPA_NAMESER_COMPAT_H 1
+_ACEOF
+
+fi
+
+done
+
+
+for ac_header in net/if_arp.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "net/if_arp.h" "ac_cv_header_net_if_arp_h" "#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
+
+"
+if test "x$ac_cv_header_net_if_arp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_IF_ARP_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in net/ppp_defs.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "net/ppp_defs.h" "ac_cv_header_net_ppp_defs_h" "$ac_includes_default"
+if test "x$ac_cv_header_net_ppp_defs_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_PPP_DEFS_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in net/if_ppp.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "net/if_ppp.h" "ac_cv_header_net_if_ppp_h" "#if HAVE_NET_PPP_DEFS_H
+# include <net/ppp_defs.h>
+#endif
+
+"
+if test "x$ac_cv_header_net_if_ppp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_IF_PPP_H 1
+_ACEOF
+
+fi
+
+done
+
+for ac_header in netinet/if_ether.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "netinet/if_ether.h" "ac_cv_header_netinet_if_ether_h" "#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
+#if HAVE_NET_IF_H
+# include <net/if.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+"
+if test "x$ac_cv_header_netinet_if_ether_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NETINET_IF_ETHER_H 1
+_ACEOF
+
+fi
+
+done
+
+
+have_net_pfvar_h="no"
+for ac_header in net/pfvar.h
+do :
+  ac_fn_c_check_header_compile "$LINENO" "net/pfvar.h" "ac_cv_header_net_pfvar_h" "
+#if HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
+#if HAVE_NET_IF_H
+# include <net/if.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+
+"
+if test "x$ac_cv_header_net_pfvar_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NET_PFVAR_H 1
+_ACEOF
+ have_net_pfvar_h="yes"
+else
+  have_net_pfvar_h="no"
+fi
+
+done
+
+
+# For the multimeter plugin
+have_termios_h="no"
+for ac_header in termios.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "termios.h" "ac_cv_header_termios_h" "$ac_includes_default"
+if test "x$ac_cv_header_termios_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_TERMIOS_H 1
+_ACEOF
+ have_termios_h="yes"
+fi
+
+done
+
+
+# For cpusleep plugin
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether clock_boottime and clock_monotonic are supported" >&5
+$as_echo_n "checking whether clock_boottime and clock_monotonic are supported... " >&6; }
+if ${c_cv_have_clock_boottime_monotonic+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <time.h>
+
+int
+main ()
+{
+
+ struct timespec b, m;
+ clock_gettime(CLOCK_BOOTTIME, &b );
+ clock_gettime(CLOCK_MONOTONIC, &m );
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_clock_boottime_monotonic="yes"
+else
+  c_cv_have_clock_boottime_monotonic="no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_clock_boottime_monotonic" >&5
+$as_echo "$c_cv_have_clock_boottime_monotonic" >&6; }
+
+
+# For the turbostat plugin
+have_asm_msrindex_h="no"
+for ac_header in asm/msr-index.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "asm/msr-index.h" "ac_cv_header_asm_msr_index_h" "$ac_includes_default"
+if test "x$ac_cv_header_asm_msr_index_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_ASM_MSR_INDEX_H 1
+_ACEOF
+ have_asm_msrindex_h="yes"
+fi
+
+done
+
+
+if test "x$have_asm_msrindex_h" = "xyes"
+then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether asm/msr-index.h has MSR_PKG_C10_RESIDENCY" >&5
+$as_echo_n "checking whether asm/msr-index.h has MSR_PKG_C10_RESIDENCY... " >&6; }
+if ${c_cv_have_usable_asm_msrindex_h+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include<asm/msr-index.h>
+
+int
+main ()
+{
+
+int y = MSR_PKG_C10_RESIDENCY;
+return(y);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_usable_asm_msrindex_h="yes"
+else
+  c_cv_have_usable_asm_msrindex_h="no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_usable_asm_msrindex_h" >&5
+$as_echo "$c_cv_have_usable_asm_msrindex_h" >&6; }
+fi
+
+have_cpuid_h="no"
+for ac_header in cpuid.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "cpuid.h" "ac_cv_header_cpuid_h" "$ac_includes_default"
+if test "x$ac_cv_header_cpuid_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_CPUID_H 1
+_ACEOF
+ have_cpuid_h="yes"
+fi
+
+done
+
+
+for ac_header in sys/capability.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "sys/capability.h" "ac_cv_header_sys_capability_h" "$ac_includes_default"
+if test "x$ac_cv_header_sys_capability_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYS_CAPABILITY_H 1
+_ACEOF
+
+fi
+
+done
+
+#
+# Checks for typedefs, structures, and compiler characteristics.
+#
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
+$as_echo_n "checking for an ANSI C-conforming const... " >&6; }
+if ${ac_cv_c_const+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+#ifndef __cplusplus
+  /* Ultrix mips cc rejects this sort of thing.  */
+  typedef int charset[2];
+  const charset cs = { 0, 0 };
+  /* SunOS 4.1.1 cc rejects this.  */
+  char const *const *pcpcc;
+  char **ppc;
+  /* NEC SVR4.0.2 mips cc rejects this.  */
+  struct point {int x, y;};
+  static struct point const zero = {0,0};
+  /* AIX XL C 1.02.0.0 rejects this.
+     It does not let you subtract one const X* pointer from another in
+     an arm of an if-expression whose if-part is not a constant
+     expression */
+  const char *g = "string";
+  pcpcc = &g + (g ? g-g : 0);
+  /* HPUX 7.0 cc rejects these. */
+  ++pcpcc;
+  ppc = (char**) pcpcc;
+  pcpcc = (char const *const *) ppc;
+  { /* SCO 3.2v4 cc rejects this sort of thing.  */
+    char tx;
+    char *t = &tx;
+    char const *s = 0 ? (char *) 0 : (char const *) 0;
+
+    *t++ = 0;
+    if (s) return 0;
+  }
+  { /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
+    int x[] = {25, 17};
+    const int *foo = &x[0];
+    ++foo;
+  }
+  { /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
+    typedef const int *iptr;
+    iptr p = 0;
+    ++p;
+  }
+  { /* AIX XL C 1.02.0.0 rejects this sort of thing, saying
+       "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
+    struct s { int j; const int *ap[3]; } bx;
+    struct s *b = &bx; b->j = 5;
+  }
+  { /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
+    const int foo = 10;
+    if (!foo) return 0;
+  }
+  return !cs[0] && !zero.x;
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_c_const=yes
+else
+  ac_cv_c_const=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_const" >&5
+$as_echo "$ac_cv_c_const" >&6; }
+if test $ac_cv_c_const = no; then
+
+$as_echo "#define const /**/" >>confdefs.h
+
+fi
+
+ac_fn_c_check_type "$LINENO" "pid_t" "ac_cv_type_pid_t" "$ac_includes_default"
+if test "x$ac_cv_type_pid_t" = xyes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define pid_t int
+_ACEOF
+
+fi
+
+ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
+if test "x$ac_cv_type_size_t" = xyes; then :
+
+else
+
+cat >>confdefs.h <<_ACEOF
+#define size_t unsigned int
+_ACEOF
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for uid_t in sys/types.h" >&5
+$as_echo_n "checking for uid_t in sys/types.h... " >&6; }
+if ${ac_cv_type_uid_t+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+
+_ACEOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  $EGREP "uid_t" >/dev/null 2>&1; then :
+  ac_cv_type_uid_t=yes
+else
+  ac_cv_type_uid_t=no
+fi
+rm -f conftest*
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_uid_t" >&5
+$as_echo "$ac_cv_type_uid_t" >&6; }
+if test $ac_cv_type_uid_t = no; then
+
+$as_echo "#define uid_t int" >>confdefs.h
+
+
+$as_echo "#define gid_t int" >>confdefs.h
+
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether time.h and sys/time.h may both be included" >&5
+$as_echo_n "checking whether time.h and sys/time.h may both be included... " >&6; }
+if ${ac_cv_header_time+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <sys/types.h>
+#include <sys/time.h>
+#include <time.h>
+
+int
+main ()
+{
+if ((struct tm *) 0)
+return 0;
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_header_time=yes
+else
+  ac_cv_header_time=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_time" >&5
+$as_echo "$ac_cv_header_time" >&6; }
+if test $ac_cv_header_time = yes; then
+
+$as_echo "#define TIME_WITH_SYS_TIME 1" >>confdefs.h
+
+fi
+
+
+#
+# Checks for library functions.
+#
+for ac_func in gettimeofday select strdup strtol getaddrinfo getnameinfo strchr memcpy strstr strcmp strncmp strncpy strlen strncasecmp strcasecmp openlog closelog sysconf setenv if_indextoname setlocale asprintf
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+ac_fn_c_check_decl "$LINENO" "strerror_r" "ac_cv_have_decl_strerror_r" "$ac_includes_default"
+if test "x$ac_cv_have_decl_strerror_r" = xyes; then :
+  ac_have_decl=1
+else
+  ac_have_decl=0
+fi
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_DECL_STRERROR_R $ac_have_decl
+_ACEOF
+
+for ac_func in strerror_r
+do :
+  ac_fn_c_check_func "$LINENO" "strerror_r" "ac_cv_func_strerror_r"
+if test "x$ac_cv_func_strerror_r" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STRERROR_R 1
+_ACEOF
+
+fi
+done
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strerror_r returns char *" >&5
+$as_echo_n "checking whether strerror_r returns char *... " >&6; }
+if ${ac_cv_func_strerror_r_char_p+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+
+    ac_cv_func_strerror_r_char_p=no
+    if test $ac_cv_have_decl_strerror_r = yes; then
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$ac_includes_default
+int
+main ()
+{
+
+	  char buf[100];
+	  char x = *strerror_r (0, buf, sizeof buf);
+	  char *p = strerror_r (0, buf, sizeof buf);
+	  return !p || x;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  ac_cv_func_strerror_r_char_p=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+    else
+      # strerror_r is not declared.  Choose between
+      # systems that have relatively inaccessible declarations for the
+      # function.  BeOS and DEC UNIX 4.0 fall in this category, but the
+      # former has a strerror_r that returns char*, while the latter
+      # has a strerror_r that returns `int'.
+      # This test should segfault on the DEC system.
+      if test "$cross_compiling" = yes; then :
+  :
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+$ac_includes_default
+	extern char *strerror_r ();
+int
+main ()
+{
+char buf[100];
+	  char x = *strerror_r (0, buf, sizeof buf);
+	  return ! isalpha (x);
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  ac_cv_func_strerror_r_char_p=yes
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+    fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_strerror_r_char_p" >&5
+$as_echo "$ac_cv_func_strerror_r_char_p" >&6; }
+if test $ac_cv_func_strerror_r_char_p = yes; then
+
+$as_echo "#define STRERROR_R_CHAR_P 1" >>confdefs.h
+
+fi
+
+
+test_cxx_flags() {
+	ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+	cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+		int main(void){}
+
+_ACEOF
+	$CXX -c conftest.cpp $CXXFLAGS $@ > /dev/null 2> /dev/null
+	ret=$?
+	rm -f conftest.o
+	ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+	return $ret
+}
+
+SAVE_CFLAGS="$CFLAGS"
+# Emulate behavior of src/Makefile.am
+if test "x$GCC" = "xyes"
+then
+	CFLAGS="$CFLAGS -Wall -Werror"
+fi
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for strtok_r" >&5
+$as_echo_n "checking for strtok_r... " >&6; }
+if ${c_cv_have_strtok_r_default+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+
+int
+main ()
+{
+
+      char buffer[] = "foo,bar,baz";
+      char *token;
+      char *dummy;
+      char *saveptr;
+
+      dummy = buffer;
+      saveptr = NULL;
+      while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
+      {
+        dummy = NULL;
+        printf ("token = %s;\n", token);
+      }
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  c_cv_have_strtok_r_default="yes"
+else
+  c_cv_have_strtok_r_default="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strtok_r_default" >&5
+$as_echo "$c_cv_have_strtok_r_default" >&6; }
+
+if test "x$c_cv_have_strtok_r_default" = "xno"
+then
+  CFLAGS="$CFLAGS -D_REENTRANT=1"
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if strtok_r needs _REENTRANT" >&5
+$as_echo_n "checking if strtok_r needs _REENTRANT... " >&6; }
+if ${c_cv_have_strtok_r_reentrant+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+
+int
+main ()
+{
+
+        char buffer[] = "foo,bar,baz";
+        char *token;
+        char *dummy;
+        char *saveptr;
+
+        dummy = buffer;
+        saveptr = NULL;
+        while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
+        {
+          dummy = NULL;
+          printf ("token = %s;\n", token);
+        }
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  c_cv_have_strtok_r_reentrant="yes"
+else
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "strtok_r isn't available. Please file a bugreport!
+See \`config.log' for more details" "$LINENO" 5; }
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strtok_r_reentrant" >&5
+$as_echo "$c_cv_have_strtok_r_reentrant" >&6; }
+fi
+
+CFLAGS="$SAVE_CFLAGS"
+if test "x$c_cv_have_strtok_r_reentrant" = "xyes"
+then
+	CFLAGS="$CFLAGS -D_REENTRANT=1"
+fi
+
+for ac_func in getpwnam_r getgrnam_r setgroups regcomp regerror regexec regfree
+do :
+  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
+ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
+if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+done
+
+
+socket_needs_socket="no"
+for ac_func in socket
+do :
+  ac_fn_c_check_func "$LINENO" "socket" "ac_cv_func_socket"
+if test "x$ac_cv_func_socket" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SOCKET 1
+_ACEOF
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for socket in -lsocket" >&5
+$as_echo_n "checking for socket in -lsocket... " >&6; }
+if ${ac_cv_lib_socket_socket+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lsocket  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char socket ();
+int
+main ()
+{
+return socket ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_socket_socket=yes
+else
+  ac_cv_lib_socket_socket=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_socket" >&5
+$as_echo "$ac_cv_lib_socket_socket" >&6; }
+if test "x$ac_cv_lib_socket_socket" = xyes; then :
+  socket_needs_socket="yes"
+else
+  as_fn_error $? "cannot find socket" "$LINENO" 5
+fi
+
+fi
+done
+
+ if test "x$socket_needs_socket" = "xyes"; then
+  BUILD_WITH_LIBSOCKET_TRUE=
+  BUILD_WITH_LIBSOCKET_FALSE='#'
+else
+  BUILD_WITH_LIBSOCKET_TRUE='#'
+  BUILD_WITH_LIBSOCKET_FALSE=
+fi
+
+
+clock_gettime_needs_rt="no"
+clock_gettime_needs_posix4="no"
+have_clock_gettime="no"
+for ac_func in clock_gettime
+do :
+  ac_fn_c_check_func "$LINENO" "clock_gettime" "ac_cv_func_clock_gettime"
+if test "x$ac_cv_func_clock_gettime" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_CLOCK_GETTIME 1
+_ACEOF
+ have_clock_gettime="yes"
+fi
+done
+
+if test "x$have_clock_gettime" = "xno"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for clock_gettime in -lrt" >&5
+$as_echo_n "checking for clock_gettime in -lrt... " >&6; }
+if ${ac_cv_lib_rt_clock_gettime+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lrt  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char clock_gettime ();
+int
+main ()
+{
+return clock_gettime ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_rt_clock_gettime=yes
+else
+  ac_cv_lib_rt_clock_gettime=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_clock_gettime" >&5
+$as_echo "$ac_cv_lib_rt_clock_gettime" >&6; }
+if test "x$ac_cv_lib_rt_clock_gettime" = xyes; then :
+  clock_gettime_needs_rt="yes"
+					 have_clock_gettime="yes"
+fi
+
+fi
+if test "x$have_clock_gettime" = "xno"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for clock_gettime in -lposix4" >&5
+$as_echo_n "checking for clock_gettime in -lposix4... " >&6; }
+if ${ac_cv_lib_posix4_clock_gettime+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lposix4  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char clock_gettime ();
+int
+main ()
+{
+return clock_gettime ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_posix4_clock_gettime=yes
+else
+  ac_cv_lib_posix4_clock_gettime=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_posix4_clock_gettime" >&5
+$as_echo "$ac_cv_lib_posix4_clock_gettime" >&6; }
+if test "x$ac_cv_lib_posix4_clock_gettime" = xyes; then :
+  clock_gettime_needs_posix4="yes"
+					     have_clock_gettime="yes"
+fi
+
+fi
+if test "x$have_clock_gettime" = "xyes"
+then
+
+$as_echo "#define HAVE_CLOCK_GETTIME 1" >>confdefs.h
+
+fi
+
+nanosleep_needs_rt="no"
+nanosleep_needs_posix4="no"
+for ac_func in nanosleep
+do :
+  ac_fn_c_check_func "$LINENO" "nanosleep" "ac_cv_func_nanosleep"
+if test "x$ac_cv_func_nanosleep" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_NANOSLEEP 1
+_ACEOF
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nanosleep in -lrt" >&5
+$as_echo_n "checking for nanosleep in -lrt... " >&6; }
+if ${ac_cv_lib_rt_nanosleep+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lrt  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char nanosleep ();
+int
+main ()
+{
+return nanosleep ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_rt_nanosleep=yes
+else
+  ac_cv_lib_rt_nanosleep=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_nanosleep" >&5
+$as_echo "$ac_cv_lib_rt_nanosleep" >&6; }
+if test "x$ac_cv_lib_rt_nanosleep" = xyes; then :
+  nanosleep_needs_rt="yes"
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nanosleep in -lposix4" >&5
+$as_echo_n "checking for nanosleep in -lposix4... " >&6; }
+if ${ac_cv_lib_posix4_nanosleep+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lposix4  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char nanosleep ();
+int
+main ()
+{
+return nanosleep ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_posix4_nanosleep=yes
+else
+  ac_cv_lib_posix4_nanosleep=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_posix4_nanosleep" >&5
+$as_echo "$ac_cv_lib_posix4_nanosleep" >&6; }
+if test "x$ac_cv_lib_posix4_nanosleep" = xyes; then :
+  nanosleep_needs_posix4="yes"
+else
+  as_fn_error $? "cannot find nanosleep" "$LINENO" 5
+fi
+
+fi
+
+fi
+done
+
+
+ if test "x$clock_gettime_needs_rt" = "xyes" || test "x$nanosleep_needs_rt" = "xyes"; then
+  BUILD_WITH_LIBRT_TRUE=
+  BUILD_WITH_LIBRT_FALSE='#'
+else
+  BUILD_WITH_LIBRT_TRUE='#'
+  BUILD_WITH_LIBRT_FALSE=
+fi
+
+ if test "x$clock_gettime_needs_posix4" = "xyes" || test "x$nanosleep_needs_posix4" = "xyes"; then
+  BUILD_WITH_LIBPOSIX4_TRUE=
+  BUILD_WITH_LIBPOSIX4_FALSE='#'
+else
+  BUILD_WITH_LIBPOSIX4_TRUE='#'
+  BUILD_WITH_LIBPOSIX4_FALSE=
+fi
+
+
+for ac_func in sysctl
+do :
+  ac_fn_c_check_func "$LINENO" "sysctl" "ac_cv_func_sysctl"
+if test "x$ac_cv_func_sysctl" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYSCTL 1
+_ACEOF
+ have_sysctl="yes"
+else
+  have_sysctl="no"
+fi
+done
+
+for ac_func in sysctlbyname
+do :
+  ac_fn_c_check_func "$LINENO" "sysctlbyname" "ac_cv_func_sysctlbyname"
+if test "x$ac_cv_func_sysctlbyname" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYSCTLBYNAME 1
+_ACEOF
+ have_sysctlbyname="yes"
+else
+  have_sysctlbyname="no"
+fi
+done
+
+for ac_func in host_statistics
+do :
+  ac_fn_c_check_func "$LINENO" "host_statistics" "ac_cv_func_host_statistics"
+if test "x$ac_cv_func_host_statistics" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_HOST_STATISTICS 1
+_ACEOF
+ have_host_statistics="yes"
+else
+  have_host_statistics="no"
+fi
+done
+
+for ac_func in processor_info
+do :
+  ac_fn_c_check_func "$LINENO" "processor_info" "ac_cv_func_processor_info"
+if test "x$ac_cv_func_processor_info" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PROCESSOR_INFO 1
+_ACEOF
+ have_processor_info="yes"
+else
+  have_processor_info="no"
+fi
+done
+
+for ac_func in thread_info
+do :
+  ac_fn_c_check_func "$LINENO" "thread_info" "ac_cv_func_thread_info"
+if test "x$ac_cv_func_thread_info" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_THREAD_INFO 1
+_ACEOF
+ have_thread_info="yes"
+else
+  have_thread_info="no"
+fi
+done
+
+for ac_func in statfs
+do :
+  ac_fn_c_check_func "$LINENO" "statfs" "ac_cv_func_statfs"
+if test "x$ac_cv_func_statfs" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STATFS 1
+_ACEOF
+ have_statfs="yes"
+else
+  have_statfs="no"
+fi
+done
+
+for ac_func in statvfs
+do :
+  ac_fn_c_check_func "$LINENO" "statvfs" "ac_cv_func_statvfs"
+if test "x$ac_cv_func_statvfs" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STATVFS 1
+_ACEOF
+ have_statvfs="yes"
+else
+  have_statvfs="no"
+fi
+done
+
+for ac_func in getifaddrs
+do :
+  ac_fn_c_check_func "$LINENO" "getifaddrs" "ac_cv_func_getifaddrs"
+if test "x$ac_cv_func_getifaddrs" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETIFADDRS 1
+_ACEOF
+ have_getifaddrs="yes"
+else
+  have_getifaddrs="no"
+fi
+done
+
+for ac_func in getloadavg
+do :
+  ac_fn_c_check_func "$LINENO" "getloadavg" "ac_cv_func_getloadavg"
+if test "x$ac_cv_func_getloadavg" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETLOADAVG 1
+_ACEOF
+ have_getloadavg="yes"
+else
+  have_getloadavg="no"
+fi
+done
+
+for ac_func in syslog
+do :
+  ac_fn_c_check_func "$LINENO" "syslog" "ac_cv_func_syslog"
+if test "x$ac_cv_func_syslog" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SYSLOG 1
+_ACEOF
+ have_syslog="yes"
+else
+  have_syslog="no"
+fi
+done
+
+for ac_func in getutent
+do :
+  ac_fn_c_check_func "$LINENO" "getutent" "ac_cv_func_getutent"
+if test "x$ac_cv_func_getutent" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETUTENT 1
+_ACEOF
+ have_getutent="yes"
+else
+  have_getutent="no"
+fi
+done
+
+for ac_func in getutxent
+do :
+  ac_fn_c_check_func "$LINENO" "getutxent" "ac_cv_func_getutxent"
+if test "x$ac_cv_func_getutxent" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETUTXENT 1
+_ACEOF
+ have_getutxent="yes"
+else
+  have_getutxent="no"
+fi
+done
+
+
+# Check for strptime {{{
+if test "x$GCC" = "xyes"
+then
+	SAVE_CFLAGS="$CFLAGS"
+	CFLAGS="$CFLAGS -Wall -Wextra -Werror"
+fi
+
+for ac_func in strptime
+do :
+  ac_fn_c_check_func "$LINENO" "strptime" "ac_cv_func_strptime"
+if test "x$ac_cv_func_strptime" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_STRPTIME 1
+_ACEOF
+ have_strptime="yes"
+else
+  have_strptime="no"
+fi
+done
+
+if test "x$have_strptime" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strptime is exported by default" >&5
+$as_echo_n "checking whether strptime is exported by default... " >&6; }
+if ${c_cv_have_strptime_default+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <time.h>
+
+int
+main ()
+{
+
+ struct tm stm;
+ (void) strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_strptime_default="yes"
+else
+  c_cv_have_strptime_default="no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strptime_default" >&5
+$as_echo "$c_cv_have_strptime_default" >&6; }
+fi
+if test "x$have_strptime" = "xyes" && test "x$c_cv_have_strptime_default" = "xno"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strptime needs standards mode" >&5
+$as_echo_n "checking whether strptime needs standards mode... " >&6; }
+if ${c_cv_have_strptime_standards+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#ifndef _ISOC99_SOURCE
+# define _ISOC99_SOURCE 1
+#endif
+#ifndef _POSIX_C_SOURCE
+# define _POSIX_C_SOURCE 200112L
+#endif
+#ifndef _XOPEN_SOURCE
+# define _XOPEN_SOURCE 500
+#endif
+#include <time.h>
+
+int
+main ()
+{
+
+ struct tm stm;
+ (void) strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_strptime_standards="yes"
+else
+  c_cv_have_strptime_standards="no"
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strptime_standards" >&5
+$as_echo "$c_cv_have_strptime_standards" >&6; }
+
+	if test "x$c_cv_have_strptime_standards" = "xyes"
+	then
+
+$as_echo "#define STRPTIME_NEEDS_STANDARDS 1" >>confdefs.h
+
+	else
+		have_strptime="no"
+	fi
+fi
+
+if test "x$GCC" = "xyes"
+then
+	CFLAGS="$SAVE_CFLAGS"
+fi
+# }}} Check for strptime
+
+for ac_func in swapctl
+do :
+  ac_fn_c_check_func "$LINENO" "swapctl" "ac_cv_func_swapctl"
+if test "x$ac_cv_func_swapctl" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_SWAPCTL 1
+_ACEOF
+ have_swapctl="yes"
+else
+  have_swapctl="no"
+fi
+done
+
+if test "x$have_swapctl" = "xyes"; then
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether swapctl takes two arguments" >&5
+$as_echo_n "checking whether swapctl takes two arguments... " >&6; }
+if ${c_cv_have_swapctl_two_args+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
+#  undef _FILE_OFFSET_BITS
+#  undef _LARGEFILE64_SOURCE
+#endif
+#include <sys/stat.h>
+#include <sys/param.h>
+#include <sys/swap.h>
+#include <unistd.h>
+
+int
+main ()
+{
+
+int num = swapctl(0, NULL);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_swapctl_two_args="yes"
+else
+  c_cv_have_swapctl_two_args="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_swapctl_two_args" >&5
+$as_echo "$c_cv_have_swapctl_two_args" >&6; }
+        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether swapctl takes three arguments" >&5
+$as_echo_n "checking whether swapctl takes three arguments... " >&6; }
+if ${c_cv_have_swapctl_three_args+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
+#  undef _FILE_OFFSET_BITS
+#  undef _LARGEFILE64_SOURCE
+#endif
+#include <sys/stat.h>
+#include <sys/param.h>
+#include <sys/swap.h>
+#include <unistd.h>
+
+int
+main ()
+{
+
+int num = swapctl(0, NULL, 0);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_swapctl_three_args="yes"
+else
+  c_cv_have_swapctl_three_args="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_swapctl_three_args" >&5
+$as_echo "$c_cv_have_swapctl_three_args" >&6; }
+fi
+# Check for different versions of `swapctl' here..
+if test "x$have_swapctl" = "xyes"; then
+        if test "x$c_cv_have_swapctl_two_args" = "xyes"; then
+
+$as_echo "#define HAVE_SWAPCTL_TWO_ARGS 1" >>confdefs.h
+
+        fi
+        if test "x$c_cv_have_swapctl_three_args" = "xyes"; then
+
+$as_echo "#define HAVE_SWAPCTL_THREE_ARGS 1" >>confdefs.h
+
+        fi
+fi
+
+# Check for NAN
+
+# Check whether --with-nan-emulation was given.
+if test "${with_nan_emulation+set}" = set; then :
+  withval=$with_nan_emulation;
+ if test "x$withval" = "xno"; then
+	 nan_type="none"
+ else if test "x$withval" = "xyes"; then
+	 nan_type="zero"
+ else
+	 nan_type="$withval"
+ fi; fi
+
+else
+  nan_type="none"
+fi
+
+if test "x$nan_type" = "xnone"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN is defined by default" >&5
+$as_echo_n "checking whether NAN is defined by default... " >&6; }
+if ${c_cv_have_nan_default+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <math.h>
+static double foo = NAN;
+
+int
+main ()
+{
+
+       if (isnan (foo))
+        return 0;
+       else
+	return 1;
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_nan_default="yes"
+else
+  c_cv_have_nan_default="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_default" >&5
+$as_echo "$c_cv_have_nan_default" >&6; }
+  if test "x$c_cv_have_nan_default" = "xyes"
+  then
+    nan_type="default"
+  fi
+fi
+if test "x$nan_type" = "xnone"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN is defined by __USE_ISOC99" >&5
+$as_echo_n "checking whether NAN is defined by __USE_ISOC99... " >&6; }
+if ${c_cv_have_nan_isoc+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#define __USE_ISOC99 1
+#include <math.h>
+static double foo = NAN;
+
+int
+main ()
+{
+
+       if (isnan (foo))
+        return 0;
+       else
+	return 1;
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_nan_isoc="yes"
+else
+  c_cv_have_nan_isoc="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_isoc" >&5
+$as_echo "$c_cv_have_nan_isoc" >&6; }
+  if test "x$c_cv_have_nan_isoc" = "xyes"
+  then
+    nan_type="isoc99"
+  fi
+fi
+if test "x$nan_type" = "xnone"; then
+  SAVE_LDFLAGS=$LDFLAGS
+  LDFLAGS="$LDFLAGS -lm"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN can be defined by 0/0" >&5
+$as_echo_n "checking whether NAN can be defined by 0/0... " >&6; }
+if ${c_cv_have_nan_zero+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <math.h>
+#ifdef NAN
+# undef NAN
+#endif
+#define NAN (0.0 / 0.0)
+#ifndef isnan
+# define isnan(f) ((f) != (f))
+#endif
+static double foo = NAN;
+
+int
+main ()
+{
+
+       if (isnan (foo))
+        return 0;
+       else
+	return 1;
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  c_cv_have_nan_zero="yes"
+else
+  c_cv_have_nan_zero="no"
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_zero" >&5
+$as_echo "$c_cv_have_nan_zero" >&6; }
+  LDFLAGS=$SAVE_LDFLAGS
+  if test "x$c_cv_have_nan_zero" = "xyes"
+  then
+    nan_type="zero"
+  fi
+fi
+
+if test "x$nan_type" = "xdefault"; then
+
+$as_echo "#define NAN_STATIC_DEFAULT 1" >>confdefs.h
+
+else if test "x$nan_type" = "xisoc99"; then
+
+$as_echo "#define NAN_STATIC_ISOC 1" >>confdefs.h
+
+else if test "x$nan_type" = "xzero"; then
+
+$as_echo "#define NAN_ZERO_ZERO 1" >>confdefs.h
+
+else
+  as_fn_error $? "Didn't find out how to statically initialize variables to NAN. Sorry." "$LINENO" 5
+fi; fi; fi
+
+
+# Check whether --with-fp-layout was given.
+if test "${with_fp_layout+set}" = set; then :
+  withval=$with_fp_layout;
+ if test "x$withval" = "xnothing"; then
+ 	fp_layout_type="nothing"
+ else if test "x$withval" = "xendianflip"; then
+ 	fp_layout_type="endianflip"
+ else if test "x$withval" = "xintswap"; then
+ 	fp_layout_type="intswap"
+ else
+ 	as_fn_error $? "Invalid argument for --with-fp-layout. Valid arguments are: nothing, endianflip, intswap" "$LINENO" 5;
+fi; fi; fi
+
+else
+  fp_layout_type="unknown"
+fi
+
+
+if test "x$fp_layout_type" = "xunknown"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if doubles are stored in x86 representation" >&5
+$as_echo_n "checking if doubles are stored in x86 representation... " >&6; }
+if ${c_cv_fp_layout_need_nothing+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H
+# include <inttypes.h>
+#endif
+#if HAVE_STDBOOL_H
+# include <stdbool.h>
+#endif
+
+int
+main ()
+{
+
+	uint64_t i0;
+	uint64_t i1;
+	uint8_t c[8];
+	double d;
+
+	d = 8.642135e130;
+	memcpy ((void *) &i0, (void *) &d, 8);
+
+	i1 = i0;
+	memcpy ((void *) c, (void *) &i1, 8);
+
+	if ((c[0] == 0x2f) && (c[1] == 0x25)
+			&& (c[2] == 0xc0) && (c[3] == 0xc7)
+			&& (c[4] == 0x43) && (c[5] == 0x2b)
+			&& (c[6] == 0x1f) && (c[7] == 0x5b))
+		return (0);
+	else
+		return (1);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  c_cv_fp_layout_need_nothing="yes"
+else
+  c_cv_fp_layout_need_nothing="no"
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_nothing" >&5
+$as_echo "$c_cv_fp_layout_need_nothing" >&6; }
+  if test "x$c_cv_fp_layout_need_nothing" = "xyes"; then
+    fp_layout_type="nothing"
+  fi
+fi
+if test "x$fp_layout_type" = "xunknown"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if endianflip converts to x86 representation" >&5
+$as_echo_n "checking if endianflip converts to x86 representation... " >&6; }
+if ${c_cv_fp_layout_need_endianflip+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H
+# include <inttypes.h>
+#endif
+#if HAVE_STDBOOL_H
+# include <stdbool.h>
+#endif
+#define endianflip(A) ((((uint64_t)(A) & 0xff00000000000000LL) >> 56) | \
+                       (((uint64_t)(A) & 0x00ff000000000000LL) >> 40) | \
+                       (((uint64_t)(A) & 0x0000ff0000000000LL) >> 24) | \
+                       (((uint64_t)(A) & 0x000000ff00000000LL) >> 8)  | \
+                       (((uint64_t)(A) & 0x00000000ff000000LL) << 8)  | \
+                       (((uint64_t)(A) & 0x0000000000ff0000LL) << 24) | \
+                       (((uint64_t)(A) & 0x000000000000ff00LL) << 40) | \
+                       (((uint64_t)(A) & 0x00000000000000ffLL) << 56))
+
+int
+main ()
+{
+
+	uint64_t i0;
+	uint64_t i1;
+	uint8_t c[8];
+	double d;
+
+	d = 8.642135e130;
+	memcpy ((void *) &i0, (void *) &d, 8);
+
+	i1 = endianflip (i0);
+	memcpy ((void *) c, (void *) &i1, 8);
+
+	if ((c[0] == 0x2f) && (c[1] == 0x25)
+			&& (c[2] == 0xc0) && (c[3] == 0xc7)
+			&& (c[4] == 0x43) && (c[5] == 0x2b)
+			&& (c[6] == 0x1f) && (c[7] == 0x5b))
+		return (0);
+	else
+		return (1);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  c_cv_fp_layout_need_endianflip="yes"
+else
+  c_cv_fp_layout_need_endianflip="no"
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_endianflip" >&5
+$as_echo "$c_cv_fp_layout_need_endianflip" >&6; }
+  if test "x$c_cv_fp_layout_need_endianflip" = "xyes"; then
+    fp_layout_type="endianflip"
+  fi
+fi
+if test "x$fp_layout_type" = "xunknown"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if intswap converts to x86 representation" >&5
+$as_echo_n "checking if intswap converts to x86 representation... " >&6; }
+if ${c_cv_fp_layout_need_intswap+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "$cross_compiling" = yes; then :
+  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
+$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
+as_fn_error $? "cannot run test program while cross compiling
+See \`config.log' for more details" "$LINENO" 5; }
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <stdlib.h>
+#include <stdio.h>
+#include <string.h>
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H
+# include <inttypes.h>
+#endif
+#if HAVE_STDBOOL_H
+# include <stdbool.h>
+#endif
+#define intswap(A)    ((((uint64_t)(A) & 0xffffffff00000000LL) >> 32) | \
+                       (((uint64_t)(A) & 0x00000000ffffffffLL) << 32))
+
+int
+main ()
+{
+
+	uint64_t i0;
+	uint64_t i1;
+	uint8_t c[8];
+	double d;
+
+	d = 8.642135e130;
+	memcpy ((void *) &i0, (void *) &d, 8);
+
+	i1 = intswap (i0);
+	memcpy ((void *) c, (void *) &i1, 8);
+
+	if ((c[0] == 0x2f) && (c[1] == 0x25)
+			&& (c[2] == 0xc0) && (c[3] == 0xc7)
+			&& (c[4] == 0x43) && (c[5] == 0x2b)
+			&& (c[6] == 0x1f) && (c[7] == 0x5b))
+		return (0);
+	else
+		return (1);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_run "$LINENO"; then :
+  c_cv_fp_layout_need_intswap="yes"
+else
+  c_cv_fp_layout_need_intswap="no"
+
+fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
+  conftest.$ac_objext conftest.beam conftest.$ac_ext
+fi
+
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_intswap" >&5
+$as_echo "$c_cv_fp_layout_need_intswap" >&6; }
+  if test "x$c_cv_fp_layout_need_intswap" = "xyes"; then
+    fp_layout_type="intswap"
+  fi
+fi
+
+if test "x$fp_layout_type" = "xnothing"; then
+
+$as_echo "#define FP_LAYOUT_NEED_NOTHING 1" >>confdefs.h
+
+else if test "x$fp_layout_type" = "xendianflip"; then
+
+$as_echo "#define FP_LAYOUT_NEED_ENDIANFLIP 1" >>confdefs.h
+
+else if test "x$fp_layout_type" = "xintswap"; then
+
+$as_echo "#define FP_LAYOUT_NEED_INTSWAP 1" >>confdefs.h
+
+else
+  as_fn_error $? "Didn't find out how doubles are stored in memory. Sorry." "$LINENO" 5
+fi; fi; fi
+
+# --with-useragent {{{
+
+# Check whether --with-useragent was given.
+if test "${with_useragent+set}" = set; then :
+  withval=$with_useragent;
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+
+cat >>confdefs.h <<_ACEOF
+#define COLLECTD_USERAGENT "$withval"
+_ACEOF
+
+    fi
+
+fi
+
+
+# }}}
+
+# --with-data-max-name-len {{{
+
+# Check whether --with-data-max-name-len was given.
+if test "${with_data_max_name_len+set}" = set; then :
+  withval=$with_data_max_name_len;
+    if test "x$withval" != "x" && test $withval -gt 0
+    then
+
+cat >>confdefs.h <<_ACEOF
+#define DATA_MAX_NAME_LEN $withval
+_ACEOF
+
+    else
+        as_fn_error $? "DATA_MAX_NAME_LEN must be a positive integer -- $withval given" "$LINENO" 5
+    fi
+
+else
+
+$as_echo "#define DATA_MAX_NAME_LEN 128" >>confdefs.h
+
+
+fi
+
+# }}}
+
+have_getfsstat="no"
+for ac_func in getfsstat
+do :
+  ac_fn_c_check_func "$LINENO" "getfsstat" "ac_cv_func_getfsstat"
+if test "x$ac_cv_func_getfsstat" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETFSSTAT 1
+_ACEOF
+ have_getfsstat="yes"
+fi
+done
+
+have_getvfsstat="no"
+for ac_func in getvfsstat
+do :
+  ac_fn_c_check_func "$LINENO" "getvfsstat" "ac_cv_func_getvfsstat"
+if test "x$ac_cv_func_getvfsstat" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETVFSSTAT 1
+_ACEOF
+ have_getvfsstat="yes"
+fi
+done
+
+have_listmntent="no"
+for ac_func in listmntent
+do :
+  ac_fn_c_check_func "$LINENO" "listmntent" "ac_cv_func_listmntent"
+if test "x$ac_cv_func_listmntent" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LISTMNTENT 1
+_ACEOF
+ have_listmntent="yes"
+fi
+done
+
+have_getmntent_r="no"
+for ac_func in getmntent_r
+do :
+  ac_fn_c_check_func "$LINENO" "getmntent_r" "ac_cv_func_getmntent_r"
+if test "x$ac_cv_func_getmntent_r" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETMNTENT_R 1
+_ACEOF
+ have_getmntent_r="yes"
+fi
+done
+
+
+have_getmntent="no"
+for ac_func in getmntent
+do :
+  ac_fn_c_check_func "$LINENO" "getmntent" "ac_cv_func_getmntent"
+if test "x$ac_cv_func_getmntent" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GETMNTENT 1
+_ACEOF
+ have_getmntent="c"
+fi
+done
+
+if test "x$have_getmntent" = "xno"; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lsun" >&5
+$as_echo_n "checking for getmntent in -lsun... " >&6; }
+if ${ac_cv_lib_sun_getmntent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lsun  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char getmntent ();
+int
+main ()
+{
+return getmntent ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_sun_getmntent=yes
+else
+  ac_cv_lib_sun_getmntent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sun_getmntent" >&5
+$as_echo "$ac_cv_lib_sun_getmntent" >&6; }
+if test "x$ac_cv_lib_sun_getmntent" = xyes; then :
+  have_getmntent="sun"
+fi
+
+fi
+if test "x$have_getmntent" = "xno"; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lseq" >&5
+$as_echo_n "checking for getmntent in -lseq... " >&6; }
+if ${ac_cv_lib_seq_getmntent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lseq  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char getmntent ();
+int
+main ()
+{
+return getmntent ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_seq_getmntent=yes
+else
+  ac_cv_lib_seq_getmntent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_seq_getmntent" >&5
+$as_echo "$ac_cv_lib_seq_getmntent" >&6; }
+if test "x$ac_cv_lib_seq_getmntent" = xyes; then :
+  have_getmntent="seq"
+fi
+
+fi
+if test "x$have_getmntent" = "xno"; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lgen" >&5
+$as_echo_n "checking for getmntent in -lgen... " >&6; }
+if ${ac_cv_lib_gen_getmntent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lgen  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char getmntent ();
+int
+main ()
+{
+return getmntent ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_gen_getmntent=yes
+else
+  ac_cv_lib_gen_getmntent=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gen_getmntent" >&5
+$as_echo "$ac_cv_lib_gen_getmntent" >&6; }
+if test "x$ac_cv_lib_gen_getmntent" = xyes; then :
+  have_getmntent="gen"
+fi
+
+fi
+
+if test "x$have_getmntent" = "xc"; then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether getmntent takes one argument" >&5
+$as_echo_n "checking whether getmntent takes one argument... " >&6; }
+if ${c_cv_have_one_getmntent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include "$srcdir/src/utils_mount.h"
+
+int
+main ()
+{
+
+FILE *fh;
+struct mntent *me;
+fh = setmntent ("/etc/mtab", "r");
+me = getmntent (fh);
+return(me->mnt_passno);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_one_getmntent="yes"
+else
+  c_cv_have_one_getmntent="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_one_getmntent" >&5
+$as_echo "$c_cv_have_one_getmntent" >&6; }
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether getmntent takes two arguments" >&5
+$as_echo_n "checking whether getmntent takes two arguments... " >&6; }
+if ${c_cv_have_two_getmntent+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include "$srcdir/src/utils_mount.h"
+
+int
+main ()
+{
+
+				 FILE *fh;
+				 struct mnttab mt;
+				 int status;
+				 fh = fopen ("/etc/mnttab", "r");
+				 status = getmntent (fh, &mt);
+				 return(status);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_compile "$LINENO"; then :
+  c_cv_have_two_getmntent="yes"
+else
+  c_cv_have_two_getmntent="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_two_getmntent" >&5
+$as_echo "$c_cv_have_two_getmntent" >&6; }
+fi
+
+# Check for different versions of `getmntent' here..
+
+if test "x$have_getmntent" = "xc"; then
+	if test "x$c_cv_have_one_getmntent" = "xyes"; then
+
+$as_echo "#define HAVE_ONE_GETMNTENT 1" >>confdefs.h
+
+	fi
+	if test "x$c_cv_have_two_getmntent" = "xyes"; then
+
+$as_echo "#define HAVE_TWO_GETMNTENT 1" >>confdefs.h
+
+	fi
+fi
+if test "x$have_getmntent" = "xsun"; then
+
+$as_echo "#define HAVE_SUN_GETMNTENT 1" >>confdefs.h
+
+fi
+if test "x$have_getmntent" = "xseq"; then
+
+$as_echo "#define HAVE_SEQ_GETMNTENT 1" >>confdefs.h
+
+fi
+if test "x$have_getmntent" = "xgen"; then
+
+$as_echo "#define HAVE_GEN_GETMNTENT 1" >>confdefs.h
+
+fi
+
+# Check for htonll
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if have htonll defined" >&5
+$as_echo_n "checking if have htonll defined... " >&6; }
+if ${c_cv_have_htonll+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <sys/types.h>
+#include <netinet/in.h>
+#if HAVE_INTTYPES_H
+# include <inttypes.h>
+#endif
+
+int
+main ()
+{
+
+          return htonll(0);
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  c_cv_have_htonll="yes"
+else
+  c_cv_have_htonll="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_htonll" >&5
+$as_echo "$c_cv_have_htonll" >&6; }
+if test "x$c_cv_have_htonll" = "xyes"
+then
+
+$as_echo "#define HAVE_HTONLL 1" >>confdefs.h
+
+fi
+
+# Check for structures
+ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_ibytes" "ac_cv_member_struct_if_data_ifi_ibytes" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <net/if.h>
+
+"
+if test "x$ac_cv_member_struct_if_data_ifi_ibytes" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IF_DATA_IFI_IBYTES 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+
+fi
+ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_opackets" "ac_cv_member_struct_if_data_ifi_opackets" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <net/if.h>
+
+"
+if test "x$ac_cv_member_struct_if_data_ifi_opackets" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IF_DATA_IFI_OPACKETS 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+
+fi
+ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_ierrors" "ac_cv_member_struct_if_data_ifi_ierrors" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <net/if.h>
+
+"
+if test "x$ac_cv_member_struct_if_data_ifi_ierrors" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IF_DATA_IFI_IERRORS 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+
+fi
+
+ac_fn_c_check_member "$LINENO" "struct net_device_stats" "rx_bytes" "ac_cv_member_struct_net_device_stats_rx_bytes" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <linux/if.h>
+	#include <linux/netdevice.h>
+
+"
+if test "x$ac_cv_member_struct_net_device_stats_rx_bytes" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_NET_DEVICE_STATS_RX_BYTES 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
+
+fi
+ac_fn_c_check_member "$LINENO" "struct net_device_stats" "tx_packets" "ac_cv_member_struct_net_device_stats_tx_packets" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <linux/if.h>
+	#include <linux/netdevice.h>
+
+"
+if test "x$ac_cv_member_struct_net_device_stats_tx_packets" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_NET_DEVICE_STATS_TX_PACKETS 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
+
+fi
+ac_fn_c_check_member "$LINENO" "struct net_device_stats" "rx_errors" "ac_cv_member_struct_net_device_stats_rx_errors" "
+	#include <sys/types.h>
+	#include <sys/socket.h>
+	#include <linux/if.h>
+	#include <linux/netdevice.h>
+
+"
+if test "x$ac_cv_member_struct_net_device_stats_rx_errors" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_NET_DEVICE_STATS_RX_ERRORS 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
+
+fi
+
+ac_fn_c_check_member "$LINENO" "struct inet_diag_req" "id" "ac_cv_member_struct_inet_diag_req_id" "
+	#include <linux/inet_diag.h>
+
+"
+if test "x$ac_cv_member_struct_inet_diag_req_id" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_INET_DIAG_REQ_ID 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_LINUX_INET_DIAG_REQ 1" >>confdefs.h
+
+fi
+ac_fn_c_check_member "$LINENO" "struct inet_diag_req" "idiag_states" "ac_cv_member_struct_inet_diag_req_idiag_states" "
+	#include <linux/inet_diag.h>
+
+"
+if test "x$ac_cv_member_struct_inet_diag_req_idiag_states" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_INET_DIAG_REQ_IDIAG_STATES 1
+_ACEOF
+
+
+$as_echo "#define HAVE_STRUCT_LINUX_INET_DIAG_REQ 1" >>confdefs.h
+
+fi
+
+
+
+ac_fn_c_check_member "$LINENO" "struct ip_mreqn" "imr_ifindex" "ac_cv_member_struct_ip_mreqn_imr_ifindex" "
+	#include <netinet/in.h>
+	#include <net/if.h>
+
+"
+if test "x$ac_cv_member_struct_ip_mreqn_imr_ifindex" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_IP_MREQN_IMR_IFINDEX 1
+_ACEOF
+
+
+fi
+
+
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_pid" "ac_cv_member_struct_kinfo_proc_ki_pid" "
+#include <kvm.h>
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <sys/user.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc_ki_pid" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC_KI_PID 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc_freebsd="yes"
+
+else
+
+		have_struct_kinfo_proc_freebsd="no"
+
+fi
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_rssize" "ac_cv_member_struct_kinfo_proc_ki_rssize" "
+#include <kvm.h>
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <sys/user.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc_ki_rssize" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC_KI_RSSIZE 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc_freebsd="yes"
+
+else
+
+		have_struct_kinfo_proc_freebsd="no"
+
+fi
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_rusage" "ac_cv_member_struct_kinfo_proc_ki_rusage" "
+#include <kvm.h>
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <sys/user.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc_ki_rusage" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC_KI_RUSAGE 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc_freebsd="yes"
+
+else
+
+		have_struct_kinfo_proc_freebsd="no"
+
+fi
+
+
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "p_pid" "ac_cv_member_struct_kinfo_proc_p_pid" "
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <kvm.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc_p_pid" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC_P_PID 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC_OPENBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc_openbsd="yes"
+
+else
+
+		have_struct_kinfo_proc_openbsd="no"
+
+fi
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "p_vm_rssize" "ac_cv_member_struct_kinfo_proc_p_vm_rssize" "
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <kvm.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc_p_vm_rssize" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC_P_VM_RSSIZE 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC_OPENBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc_openbsd="yes"
+
+else
+
+		have_struct_kinfo_proc_openbsd="no"
+
+fi
+
+
+
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc2" "p_pid" "ac_cv_member_struct_kinfo_proc2_p_pid" "
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <kvm.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc2_p_pid" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC2_P_PID 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC2_NETBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc2_netbsd="yes"
+
+else
+
+		have_struct_kinfo_proc2_netbsd="no"
+
+fi
+ac_fn_c_check_member "$LINENO" "struct kinfo_proc2" "p_uru_maxrss" "ac_cv_member_struct_kinfo_proc2_p_uru_maxrss" "
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <kvm.h>
+
+"
+if test "x$ac_cv_member_struct_kinfo_proc2_p_uru_maxrss" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_KINFO_PROC2_P_URU_MAXRSS 1
+_ACEOF
+
+
+
+$as_echo "#define HAVE_STRUCT_KINFO_PROC2_NETBSD 1" >>confdefs.h
+
+		have_struct_kinfo_proc2_netbsd="yes"
+
+else
+
+		have_struct_kinfo_proc2_netbsd="no"
+
+fi
+
+
+
+
+ac_fn_c_check_member "$LINENO" "struct udphdr" "uh_dport" "ac_cv_member_struct_udphdr_uh_dport" "#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_UDP_H
+# include <netinet/udp.h>
+#endif
+
+"
+if test "x$ac_cv_member_struct_udphdr_uh_dport" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_UDPHDR_UH_DPORT 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_member "$LINENO" "struct udphdr" "uh_sport" "ac_cv_member_struct_udphdr_uh_sport" "#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_UDP_H
+# include <netinet/udp.h>
+#endif
+
+"
+if test "x$ac_cv_member_struct_udphdr_uh_sport" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_UDPHDR_UH_SPORT 1
+_ACEOF
+
+
+fi
+
+ac_fn_c_check_member "$LINENO" "struct udphdr" "dest" "ac_cv_member_struct_udphdr_dest" "#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_UDP_H
+# include <netinet/udp.h>
+#endif
+
+"
+if test "x$ac_cv_member_struct_udphdr_dest" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_UDPHDR_DEST 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_member "$LINENO" "struct udphdr" "source" "ac_cv_member_struct_udphdr_source" "#define _BSD_SOURCE
+#define _DEFAULT_SOURCE
+#if HAVE_STDINT_H
+# include <stdint.h>
+#endif
+#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_NETINET_IN_SYSTM_H
+# include <netinet/in_systm.h>
+#endif
+#if HAVE_NETINET_IN_H
+# include <netinet/in.h>
+#endif
+#if HAVE_NETINET_IP_H
+# include <netinet/ip.h>
+#endif
+#if HAVE_NETINET_UDP_H
+# include <netinet/udp.h>
+#endif
+
+"
+if test "x$ac_cv_member_struct_udphdr_source" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_STRUCT_UDPHDR_SOURCE 1
+_ACEOF
+
+
+fi
+
+
+ac_fn_c_check_member "$LINENO" "kstat_io_t" "nwritten" "ac_cv_member_kstat_io_t_nwritten" "
+#if HAVE_KSTAT_H
+# include <kstat.h>
+#endif
+
+"
+if test "x$ac_cv_member_kstat_io_t_nwritten" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_KSTAT_IO_T_NWRITTEN 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_member "$LINENO" "kstat_io_t" "writes" "ac_cv_member_kstat_io_t_writes" "
+#if HAVE_KSTAT_H
+# include <kstat.h>
+#endif
+
+"
+if test "x$ac_cv_member_kstat_io_t_writes" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_KSTAT_IO_T_WRITES 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_member "$LINENO" "kstat_io_t" "nwrites" "ac_cv_member_kstat_io_t_nwrites" "
+#if HAVE_KSTAT_H
+# include <kstat.h>
+#endif
+
+"
+if test "x$ac_cv_member_kstat_io_t_nwrites" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_KSTAT_IO_T_NWRITES 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_member "$LINENO" "kstat_io_t" "wtime" "ac_cv_member_kstat_io_t_wtime" "
+#if HAVE_KSTAT_H
+# include <kstat.h>
+#endif
+
+"
+if test "x$ac_cv_member_kstat_io_t_wtime" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_KSTAT_IO_T_WTIME 1
+_ACEOF
+
+
+fi
+
+
+#
+# Checks for libraries begin here
+#
+
+with_libresolv="yes"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_search in -lresolv" >&5
+$as_echo_n "checking for res_search in -lresolv... " >&6; }
+if ${ac_cv_lib_resolv_res_search+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lresolv  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char res_search ();
+int
+main ()
+{
+return res_search ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_resolv_res_search=yes
+else
+  ac_cv_lib_resolv_res_search=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_res_search" >&5
+$as_echo "$ac_cv_lib_resolv_res_search" >&6; }
+if test "x$ac_cv_lib_resolv_res_search" = xyes; then :
+
+
+$as_echo "#define HAVE_LIBRESOLV 1" >>confdefs.h
+
+
+else
+  with_libresolv="no"
+fi
+
+ if test "x$with_libresolv" = "xyes"; then
+  BUILD_WITH_LIBRESOLV_TRUE=
+  BUILD_WITH_LIBRESOLV_FALSE='#'
+else
+  BUILD_WITH_LIBRESOLV_TRUE='#'
+  BUILD_WITH_LIBRESOLV_FALSE=
+fi
+
+
+with_libhal="no"
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for HAL" >&5
+$as_echo_n "checking for HAL... " >&6; }
+
+if test -n "$HAL_CFLAGS"; then
+    pkg_cv_HAL_CFLAGS="$HAL_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"hal\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "hal") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_HAL_CFLAGS=`$PKG_CONFIG --cflags "hal" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$HAL_LIBS"; then
+    pkg_cv_HAL_LIBS="$HAL_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"hal\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "hal") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_HAL_LIBS=`$PKG_CONFIG --libs "hal" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        HAL_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "hal" 2>&1`
+        else
+	        HAL_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "hal" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$HAL_PKG_ERRORS" >&5
+
+	 :
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	 :
+
+else
+	HAL_CFLAGS=$pkg_cv_HAL_CFLAGS
+	HAL_LIBS=$pkg_cv_HAL_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+
+    SAVE_LIBS="$LIBS"
+    LIBS="$HAL_LIBS $LIBS"
+    { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libhal_device_property_exists in -lhal" >&5
+$as_echo_n "checking for libhal_device_property_exists in -lhal... " >&6; }
+if ${ac_cv_lib_hal_libhal_device_property_exists+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lhal  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char libhal_device_property_exists ();
+int
+main ()
+{
+return libhal_device_property_exists ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_hal_libhal_device_property_exists=yes
+else
+  ac_cv_lib_hal_libhal_device_property_exists=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_hal_libhal_device_property_exists" >&5
+$as_echo "$ac_cv_lib_hal_libhal_device_property_exists" >&6; }
+if test "x$ac_cv_lib_hal_libhal_device_property_exists" = xyes; then :
+
+        SAVE_CPPFLAGS="$CPPFLAGS"
+        CPPFLAGS="$HAL_CFLAGS $CPPFLAGS"
+        for ac_header in libhal.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "libhal.h" "ac_cv_header_libhal_h" "$ac_includes_default"
+if test "x$ac_cv_header_libhal_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBHAL_H 1
+_ACEOF
+
+          with_libhal="yes"
+          BUILD_WITH_LIBHAL_CFLAGS="$HAL_CFLAGS"
+          BUILD_WITH_LIBHAL_LIBS="$HAL_LIBS"
+
+fi
+
+done
+
+        CPPFLAGS="$SAVE_CPPFLAGS"
+
+else
+   :
+
+fi
+
+    LIBS="$SAVE_LIBS"
+
+fi
+
+
+
+
+SAVE_LIBS="$LIBS"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_create in -lpthread" >&5
+$as_echo_n "checking for pthread_create in -lpthread... " >&6; }
+if ${ac_cv_lib_pthread_pthread_create+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lpthread
+ $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char pthread_create ();
+int
+main ()
+{
+return pthread_create ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_pthread_pthread_create=yes
+else
+  ac_cv_lib_pthread_pthread_create=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_create" >&5
+$as_echo "$ac_cv_lib_pthread_pthread_create" >&6; }
+if test "x$ac_cv_lib_pthread_pthread_create" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBPTHREAD 1
+_ACEOF
+
+  LIBS="-lpthread $LIBS"
+
+else
+  as_fn_error $? "Symbol 'pthread_create' not found in libpthread\"" "$LINENO" 5
+fi
+
+PTHREAD_LIBS="$LIBS"
+LIBS="$SAVE_LIBS"
+
+for ac_header in pthread.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "pthread.h" "ac_cv_header_pthread_h" "$ac_includes_default"
+if test "x$ac_cv_header_pthread_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PTHREAD_H 1
+_ACEOF
+
+else
+  as_fn_error $? "pthread.h not found" "$LINENO" 5
+
+fi
+
+done
+
+
+
+
+
+if test "x$ac_system" = "xAIX"
+then
+	with_perfstat="yes"
+	with_procinfo="yes"
+else
+	with_perfstat="no (AIX only)"
+	with_procinfo="no (AIX only)"
+fi
+
+if test "x$with_perfstat" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for perfstat_reset in -lperfstat" >&5
+$as_echo_n "checking for perfstat_reset in -lperfstat... " >&6; }
+if ${ac_cv_lib_perfstat_perfstat_reset+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lperfstat  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char perfstat_reset ();
+int
+main ()
+{
+return perfstat_reset ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_perfstat_perfstat_reset=yes
+else
+  ac_cv_lib_perfstat_perfstat_reset=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_perfstat_perfstat_reset" >&5
+$as_echo "$ac_cv_lib_perfstat_perfstat_reset" >&6; }
+if test "x$ac_cv_lib_perfstat_perfstat_reset" = xyes; then :
+  with_perfstat="yes"
+else
+  with_perfstat="no (perfstat not found)"
+fi
+
+#	AC_CHECK_HEADERS(sys/protosw.h libperfstat.h,, [with_perfstat="no (perfstat not found)"])
+fi
+if test "x$with_perfstat" = "xyes"
+then
+
+$as_echo "#define HAVE_PERFSTAT 1" >>confdefs.h
+
+	 # struct members pertaining to donation have been added to libperfstat somewhere between AIX5.3ML5 and AIX5.3ML9
+	 ac_fn_c_check_member "$LINENO" "perfstat_partition_type_t" "b.donate_enabled" "ac_cv_member_perfstat_partition_type_t_b_donate_enabled" "#include <libperfstat.h
+"
+if test "x$ac_cv_member_perfstat_partition_type_t_b_donate_enabled" = xyes; then :
+
+fi
+
+	 if test "x$av_cv_member_perfstat_partition_type_t_b_donate_enabled" = "xyes"
+	 then
+
+$as_echo "#define PERFSTAT_SUPPORTS_DONATION 1" >>confdefs.h
+
+	 fi
+fi
+ if test "x$with_perfstat" = "xyes"; then
+  BUILD_WITH_PERFSTAT_TRUE=
+  BUILD_WITH_PERFSTAT_FALSE='#'
+else
+  BUILD_WITH_PERFSTAT_TRUE='#'
+  BUILD_WITH_PERFSTAT_FALSE=
+fi
+
+
+# Processes plugin under AIX.
+if test "x$with_procinfo" = "xyes"
+then
+	for ac_header in procinfo.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "procinfo.h" "ac_cv_header_procinfo_h" "$ac_includes_default"
+if test "x$ac_cv_header_procinfo_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_PROCINFO_H 1
+_ACEOF
+
+else
+  with_procinfo="no (procinfo.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_procinfo" = "xyes"
+then
+
+$as_echo "#define HAVE_PROCINFO_H 1" >>confdefs.h
+
+fi
+
+if test "x$ac_system" = "xSolaris"
+then
+	with_kstat="yes"
+	with_devinfo="yes"
+else
+	with_kstat="no (Solaris only)"
+	with_devinfo="no (Solaris only)"
+fi
+
+if test "x$with_kstat" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kstat_open in -lkstat" >&5
+$as_echo_n "checking for kstat_open in -lkstat... " >&6; }
+if ${ac_cv_lib_kstat_kstat_open+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lkstat  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char kstat_open ();
+int
+main ()
+{
+return kstat_open ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_kstat_kstat_open=yes
+else
+  ac_cv_lib_kstat_kstat_open=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kstat_kstat_open" >&5
+$as_echo "$ac_cv_lib_kstat_kstat_open" >&6; }
+if test "x$ac_cv_lib_kstat_kstat_open" = xyes; then :
+  with_kstat="yes"
+else
+  with_kstat="no (libkstat not found)"
+fi
+
+fi
+if test "x$with_kstat" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for di_init in -ldevinfo" >&5
+$as_echo_n "checking for di_init in -ldevinfo... " >&6; }
+if ${ac_cv_lib_devinfo_di_init+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldevinfo  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char di_init ();
+int
+main ()
+{
+return di_init ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_devinfo_di_init=yes
+else
+  ac_cv_lib_devinfo_di_init=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_devinfo_di_init" >&5
+$as_echo "$ac_cv_lib_devinfo_di_init" >&6; }
+if test "x$ac_cv_lib_devinfo_di_init" = xyes; then :
+  with_devinfo="yes"
+else
+  with_devinfo="no (not found)"
+fi
+
+	for ac_header in kstat.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "kstat.h" "ac_cv_header_kstat_h" "$ac_includes_default"
+if test "x$ac_cv_header_kstat_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_KSTAT_H 1
+_ACEOF
+
+else
+  with_kstat="no (kstat.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_kstat" = "xyes"
+then
+
+$as_echo "#define HAVE_LIBKSTAT 1" >>confdefs.h
+
+fi
+ if test "x$with_kstat" = "xyes"; then
+  BUILD_WITH_LIBKSTAT_TRUE=
+  BUILD_WITH_LIBKSTAT_FALSE='#'
+else
+  BUILD_WITH_LIBKSTAT_TRUE='#'
+  BUILD_WITH_LIBKSTAT_FALSE=
+fi
+
+ if test "x$with_devinfo" = "xyes"; then
+  BUILD_WITH_LIBDEVINFO_TRUE=
+  BUILD_WITH_LIBDEVINFO_FALSE='#'
+else
+  BUILD_WITH_LIBDEVINFO_TRUE='#'
+  BUILD_WITH_LIBDEVINFO_FALSE=
+fi
+
+
+with_libiokit="no"
+if test "x$ac_system" = "xDarwin"
+then
+	with_libiokit="yes"
+else
+	with_libiokit="no"
+fi
+ if test "x$with_libiokit" = "xyes"; then
+  BUILD_WITH_LIBIOKIT_TRUE=
+  BUILD_WITH_LIBIOKIT_FALSE='#'
+else
+  BUILD_WITH_LIBIOKIT_TRUE='#'
+  BUILD_WITH_LIBIOKIT_FALSE=
+fi
+
+
+with_libkvm="no"
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_getprocs in -lkvm" >&5
+$as_echo_n "checking for kvm_getprocs in -lkvm... " >&6; }
+if ${ac_cv_lib_kvm_kvm_getprocs+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lkvm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char kvm_getprocs ();
+int
+main ()
+{
+return kvm_getprocs ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_kvm_kvm_getprocs=yes
+else
+  ac_cv_lib_kvm_kvm_getprocs=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_getprocs" >&5
+$as_echo "$ac_cv_lib_kvm_kvm_getprocs" >&6; }
+if test "x$ac_cv_lib_kvm_kvm_getprocs" = xyes; then :
+  with_kvm_getprocs="yes"
+else
+  with_kvm_getprocs="no"
+fi
+
+if test "x$with_kvm_getprocs" = "xyes"
+then
+
+$as_echo "#define HAVE_LIBKVM_GETPROCS 1" >>confdefs.h
+
+	with_libkvm="yes"
+fi
+ if test "x$with_kvm_getprocs" = "xyes"; then
+  BUILD_WITH_LIBKVM_GETPROCS_TRUE=
+  BUILD_WITH_LIBKVM_GETPROCS_FALSE='#'
+else
+  BUILD_WITH_LIBKVM_GETPROCS_TRUE='#'
+  BUILD_WITH_LIBKVM_GETPROCS_FALSE=
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_getswapinfo in -lkvm" >&5
+$as_echo_n "checking for kvm_getswapinfo in -lkvm... " >&6; }
+if ${ac_cv_lib_kvm_kvm_getswapinfo+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lkvm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char kvm_getswapinfo ();
+int
+main ()
+{
+return kvm_getswapinfo ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_kvm_kvm_getswapinfo=yes
+else
+  ac_cv_lib_kvm_kvm_getswapinfo=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_getswapinfo" >&5
+$as_echo "$ac_cv_lib_kvm_kvm_getswapinfo" >&6; }
+if test "x$ac_cv_lib_kvm_kvm_getswapinfo" = xyes; then :
+  with_kvm_getswapinfo="yes"
+else
+  with_kvm_getswapinfo="no"
+fi
+
+if test "x$with_kvm_getswapinfo" = "xyes"
+then
+
+$as_echo "#define HAVE_LIBKVM_GETSWAPINFO 1" >>confdefs.h
+
+	with_libkvm="yes"
+fi
+ if test "x$with_kvm_getswapinfo" = "xyes"; then
+  BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE=
+  BUILD_WITH_LIBKVM_GETSWAPINFO_FALSE='#'
+else
+  BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE='#'
+  BUILD_WITH_LIBKVM_GETSWAPINFO_FALSE=
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_nlist in -lkvm" >&5
+$as_echo_n "checking for kvm_nlist in -lkvm... " >&6; }
+if ${ac_cv_lib_kvm_kvm_nlist+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lkvm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char kvm_nlist ();
+int
+main ()
+{
+return kvm_nlist ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_kvm_kvm_nlist=yes
+else
+  ac_cv_lib_kvm_kvm_nlist=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_nlist" >&5
+$as_echo "$ac_cv_lib_kvm_kvm_nlist" >&6; }
+if test "x$ac_cv_lib_kvm_kvm_nlist" = xyes; then :
+  with_kvm_nlist="yes"
+else
+  with_kvm_nlist="no"
+fi
+
+if test "x$with_kvm_nlist" = "xyes"
+then
+	for ac_header in bsd/nlist.h nlist.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+fi
+
+done
+
+
+$as_echo "#define HAVE_LIBKVM_NLIST 1" >>confdefs.h
+
+	with_libkvm="yes"
+fi
+ if test "x$with_kvm_nlist" = "xyes"; then
+  BUILD_WITH_LIBKVM_NLIST_TRUE=
+  BUILD_WITH_LIBKVM_NLIST_FALSE='#'
+else
+  BUILD_WITH_LIBKVM_NLIST_TRUE='#'
+  BUILD_WITH_LIBKVM_NLIST_FALSE=
+fi
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_openfiles in -lkvm" >&5
+$as_echo_n "checking for kvm_openfiles in -lkvm... " >&6; }
+if ${ac_cv_lib_kvm_kvm_openfiles+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lkvm  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char kvm_openfiles ();
+int
+main ()
+{
+return kvm_openfiles ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_kvm_kvm_openfiles=yes
+else
+  ac_cv_lib_kvm_kvm_openfiles=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_openfiles" >&5
+$as_echo "$ac_cv_lib_kvm_kvm_openfiles" >&6; }
+if test "x$ac_cv_lib_kvm_kvm_openfiles" = xyes; then :
+  with_kvm_openfiles="yes"
+else
+  with_kvm_openfiles="no"
+fi
+
+if test "x$with_kvm_openfiles" = "xyes"
+then
+
+$as_echo "#define HAVE_LIBKVM_NLIST 1" >>confdefs.h
+
+	with_libkvm="yes"
+fi
+ if test "x$with_kvm_openfiles" = "xyes"; then
+  BUILD_WITH_LIBKVM_OPENFILES_TRUE=
+  BUILD_WITH_LIBKVM_OPENFILES_FALSE='#'
+else
+  BUILD_WITH_LIBKVM_OPENFILES_TRUE='#'
+  BUILD_WITH_LIBKVM_OPENFILES_FALSE=
+fi
+
+
+# --with-libaquaero5 {{{
+
+# Check whether --with-libaquaero5 was given.
+if test "${with_libaquaero5+set}" = set; then :
+  withval=$with_libaquaero5;
+ if test "x$withval" = "xyes"
+ then
+	 with_libaquaero5="yes"
+ else if test "x$withval" = "xno"
+ then
+	 with_libaquaero5="no"
+ else
+	 with_libaquaero5="yes"
+	 LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS -I$withval/src"
+	 LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS -L$withval/obj"
+ fi; fi
+
+else
+  with_libaquaero5="yes"
+fi
+
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+
+CPPFLAGS="$CPPFLAGS $LIBAQUAERO5_CFLAGS"
+LDFLAGS="$LDFLAGS $LIBAQUAERO5_LDFLAGS"
+
+if test "x$with_libaquaero5" = "xyes"
+then
+	if test "x$LIBAQUAERO5_CFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libaquaero5 CPPFLAGS: $LIBAQUAERO5_CFLAGS" >&5
+$as_echo "$as_me: libaquaero5 CPPFLAGS: $LIBAQUAERO5_CFLAGS" >&6;}
+	fi
+	for ac_header in libaquaero5.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "libaquaero5.h" "ac_cv_header_libaquaero5_h" "$ac_includes_default"
+if test "x$ac_cv_header_libaquaero5_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBAQUAERO5_H 1
+_ACEOF
+ with_libaquaero5="yes"
+else
+  with_libaquaero5="no (libaquaero5.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_libaquaero5" = "xyes"
+then
+	if test "x$LIBAQUAERO5_LDFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libaquaero5 LDFLAGS: $LIBAQUAERO5_LDFLAGS" >&5
+$as_echo "$as_me: libaquaero5 LDFLAGS: $LIBAQUAERO5_LDFLAGS" >&6;}
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libaquaero5_poll in -laquaero5" >&5
+$as_echo_n "checking for libaquaero5_poll in -laquaero5... " >&6; }
+if ${ac_cv_lib_aquaero5_libaquaero5_poll+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-laquaero5  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char libaquaero5_poll ();
+int
+main ()
+{
+return libaquaero5_poll ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_aquaero5_libaquaero5_poll=yes
+else
+  ac_cv_lib_aquaero5_libaquaero5_poll=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_aquaero5_libaquaero5_poll" >&5
+$as_echo "$ac_cv_lib_aquaero5_libaquaero5_poll" >&6; }
+if test "x$ac_cv_lib_aquaero5_libaquaero5_poll" = xyes; then :
+  with_libaquaero5="yes"
+else
+  with_libaquaero5="no (symbol 'libaquaero5_poll' not found)"
+fi
+
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+
+if test "x$with_libaquaero5" = "xyes"
+then
+	BUILD_WITH_LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS"
+	BUILD_WITH_LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS"
+
+
+fi
+ if test "x$with_libaquaero5" = "xyes"; then
+  BUILD_WITH_LIBAQUAERO5_TRUE=
+  BUILD_WITH_LIBAQUAERO5_FALSE='#'
+else
+  BUILD_WITH_LIBAQUAERO5_TRUE='#'
+  BUILD_WITH_LIBAQUAERO5_FALSE=
+fi
+
+# }}}
+
+# --with-libhiredis {{{
+
+# Check whether --with-libhiredis was given.
+if test "${with_libhiredis+set}" = set; then :
+  withval=$with_libhiredis;
+ if test "x$withval" = "xyes"
+ then
+	 with_libhiredis="yes"
+ else if test "x$withval" = "xno"
+ then
+	 with_libhiredis="no"
+ else
+	 with_libhiredis="yes"
+	 LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS -I$withval/include"
+	 LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS -L$withval/lib"
+ fi; fi
+
+else
+  with_libhiredis="yes"
+fi
+
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+
+CPPFLAGS="$CPPFLAGS $LIBHIREDIS_CPPFLAGS"
+LDFLAGS="$LDFLAGS $LIBHIREDIS_LDFLAGS"
+
+if test "x$with_libhiredis" = "xyes"
+then
+	if test "x$LIBHIREDIS_CPPFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libhiredis CPPFLAGS: $LIBHIREDIS_CPPFLAGS" >&5
+$as_echo "$as_me: libhiredis CPPFLAGS: $LIBHIREDIS_CPPFLAGS" >&6;}
+	fi
+	for ac_header in hiredis/hiredis.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "hiredis/hiredis.h" "ac_cv_header_hiredis_hiredis_h" "$ac_includes_default"
+if test "x$ac_cv_header_hiredis_hiredis_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_HIREDIS_HIREDIS_H 1
+_ACEOF
+ with_libhiredis="yes"
+else
+  with_libhiredis="no (hiredis.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_libhiredis" = "xyes"
+then
+	if test "x$LIBHIREDIS_LDFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libhiredis LDFLAGS: $LIBHIREDIS_LDFLAGS" >&5
+$as_echo "$as_me: libhiredis LDFLAGS: $LIBHIREDIS_LDFLAGS" >&6;}
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for redisCommand in -lhiredis" >&5
+$as_echo_n "checking for redisCommand in -lhiredis... " >&6; }
+if ${ac_cv_lib_hiredis_redisCommand+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lhiredis  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char redisCommand ();
+int
+main ()
+{
+return redisCommand ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_hiredis_redisCommand=yes
+else
+  ac_cv_lib_hiredis_redisCommand=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_hiredis_redisCommand" >&5
+$as_echo "$ac_cv_lib_hiredis_redisCommand" >&6; }
+if test "x$ac_cv_lib_hiredis_redisCommand" = xyes; then :
+  with_libhiredis="yes"
+else
+  with_libhiredis="no (symbol 'redisCommand' not found)"
+fi
+
+
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+
+if test "x$with_libhiredis" = "xyes"
+then
+	BUILD_WITH_LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS"
+	BUILD_WITH_LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS"
+
+
+fi
+ if test "x$with_libhiredis" = "xyes"; then
+  BUILD_WITH_LIBHIREDIS_TRUE=
+  BUILD_WITH_LIBHIREDIS_FALSE='#'
+else
+  BUILD_WITH_LIBHIREDIS_TRUE='#'
+  BUILD_WITH_LIBHIREDIS_FALSE=
+fi
+
+# }}}
+
+# --with-libcurl {{{
+with_curl_config="curl-config"
+with_curl_cflags=""
+with_curl_libs=""
+
+# Check whether --with-libcurl was given.
+if test "${with_libcurl+set}" = set; then :
+  withval=$with_libcurl;
+	if test "x$withval" = "xno"
+	then
+		with_libcurl="no"
+	else if test "x$withval" = "xyes"
+	then
+		with_libcurl="yes"
+	else
+		if test -f "$withval" && test -x "$withval"
+		then
+			with_curl_config="$withval"
+			with_libcurl="yes"
+		else if test -x "$withval/bin/curl-config"
+		then
+			with_curl_config="$withval/bin/curl-config"
+			with_libcurl="yes"
+		fi; fi
+		with_libcurl="yes"
+	fi; fi
+
+else
+
+	with_libcurl="yes"
+
+fi
+
+if test "x$with_libcurl" = "xyes"
+then
+	with_curl_cflags=`$with_curl_config --cflags 2>/dev/null`
+	curl_config_status=$?
+
+	if test $curl_config_status -ne 0
+	then
+		with_libcurl="no ($with_curl_config failed)"
+	else
+		SAVE_CPPFLAGS="$CPPFLAGS"
+		CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+
+		for ac_header in curl/curl.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "curl/curl.h" "ac_cv_header_curl_curl_h" "$ac_includes_default"
+if test "x$ac_cv_header_curl_curl_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_CURL_CURL_H 1
+_ACEOF
+
+else
+  with_libcurl="no (curl/curl.h not found)"
+fi
+
+done
+
+
+		CPPFLAGS="$SAVE_CPPFLAGS"
+	fi
+fi
+if test "x$with_libcurl" = "xyes"
+then
+	with_curl_libs=`$with_curl_config --libs 2>/dev/null`
+	curl_config_status=$?
+
+	if test $curl_config_status -ne 0
+	then
+		with_libcurl="no ($with_curl_config failed)"
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_easy_init in -lcurl" >&5
+$as_echo_n "checking for curl_easy_init in -lcurl... " >&6; }
+if ${ac_cv_lib_curl_curl_easy_init+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lcurl $with_curl_libs $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char curl_easy_init ();
+int
+main ()
+{
+return curl_easy_init ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_curl_curl_easy_init=yes
+else
+  ac_cv_lib_curl_curl_easy_init=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_easy_init" >&5
+$as_echo "$ac_cv_lib_curl_curl_easy_init" >&6; }
+if test "x$ac_cv_lib_curl_curl_easy_init" = xyes; then :
+  with_libcurl="yes"
+else
+  with_libcurl="no (symbol 'curl_easy_init' not found)"
+fi
+
+		ac_fn_c_check_decl "$LINENO" "CURLOPT_USERNAME" "ac_cv_have_decl_CURLOPT_USERNAME" "#include <curl/curl.h>
+"
+if test "x$ac_cv_have_decl_CURLOPT_USERNAME" = xyes; then :
+  have_curlopt_username="yes"
+else
+  have_curlopt_username="no"
+fi
+
+		ac_fn_c_check_decl "$LINENO" "CURLOPT_TIMEOUT_MS" "ac_cv_have_decl_CURLOPT_TIMEOUT_MS" "#include <curl/curl.h>
+"
+if test "x$ac_cv_have_decl_CURLOPT_TIMEOUT_MS" = xyes; then :
+  have_curlopt_timeout="yes"
+else
+  have_curlopt_timeout="no"
+fi
+
+	fi
+fi
+if test "x$with_libcurl" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+	LDFLAGS="$LDFLAGS $with_curl_libs"
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for CURLINFO_APPCONNECT_TIME" >&5
+$as_echo_n "checking for CURLINFO_APPCONNECT_TIME... " >&6; }
+if ${c_cv_have_curlinfo_appconnect_time+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+#include <curl/curl.h>
+
+int
+main ()
+{
+
+int val = CURLINFO_APPCONNECT_TIME;
+return val;
+
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  c_cv_have_curlinfo_appconnect_time="yes"
+else
+  c_cv_have_curlinfo_appconnect_time="no"
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_curlinfo_appconnect_time" >&5
+$as_echo "$c_cv_have_curlinfo_appconnect_time" >&6; }
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+fi
+ if test "x$with_libcurl" = "xyes"; then
+  BUILD_WITH_LIBCURL_TRUE=
+  BUILD_WITH_LIBCURL_FALSE='#'
+else
+  BUILD_WITH_LIBCURL_TRUE='#'
+  BUILD_WITH_LIBCURL_FALSE=
+fi
+
+if test "x$c_cv_have_curlinfo_appconnect_time" = "xyes"
+then
+
+$as_echo "#define HAVE_CURLINFO_APPCONNECT_TIME 1" >>confdefs.h
+
+fi
+
+if test "x$with_libcurl" = "xyes"
+then
+	BUILD_WITH_LIBCURL_CFLAGS="$with_curl_cflags"
+	BUILD_WITH_LIBCURL_LIBS="$with_curl_libs"
+
+
+
+	if test "x$have_curlopt_username" = "xyes"
+	then
+
+$as_echo "#define HAVE_CURLOPT_USERNAME 1" >>confdefs.h
+
+	fi
+
+	if test "x$have_curlopt_timeout" = "xyes"
+	then
+
+$as_echo "#define HAVE_CURLOPT_TIMEOUT_MS 1" >>confdefs.h
+
+	fi
+fi
+# }}}
+
+# --with-libdbi {{{
+with_libdbi_cppflags=""
+with_libdbi_ldflags=""
+
+# Check whether --with-libdbi was given.
+if test "${with_libdbi+set}" = set; then :
+  withval=$with_libdbi;
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libdbi_cppflags="-I$withval/include"
+		with_libdbi_ldflags="-L$withval/lib"
+		with_libdbi="yes"
+	else
+		with_libdbi="$withval"
+	fi
+
+else
+
+	with_libdbi="yes"
+
+fi
+
+if test "x$with_libdbi" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
+
+	for ac_header in dbi/dbi.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "dbi/dbi.h" "ac_cv_header_dbi_dbi_h" "$ac_includes_default"
+if test "x$ac_cv_header_dbi_dbi_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_DBI_DBI_H 1
+_ACEOF
+ with_libdbi="yes"
+else
+  with_libdbi="no (dbi/dbi.h not found)"
+fi
+
+done
+
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libdbi" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
+	LDFLAGS="$LDFLAGS $with_libdbi_ldflags"
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dbi_initialize in -ldbi" >&5
+$as_echo_n "checking for dbi_initialize in -ldbi... " >&6; }
+if ${ac_cv_lib_dbi_dbi_initialize+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ldbi  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char dbi_initialize ();
+int
+main ()
+{
+return dbi_initialize ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_dbi_dbi_initialize=yes
+else
+  ac_cv_lib_dbi_dbi_initialize=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dbi_dbi_initialize" >&5
+$as_echo "$ac_cv_lib_dbi_dbi_initialize" >&6; }
+if test "x$ac_cv_lib_dbi_dbi_initialize" = xyes; then :
+  with_libdbi="yes"
+else
+  with_libdbi="no (Symbol 'dbi_initialize' not found)"
+fi
+
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+fi
+if test "x$with_libdbi" = "xyes"
+then
+	BUILD_WITH_LIBDBI_CPPFLAGS="$with_libdbi_cppflags"
+	BUILD_WITH_LIBDBI_LDFLAGS="$with_libdbi_ldflags"
+	BUILD_WITH_LIBDBI_LIBS="-ldbi"
+
+
+
+fi
+ if test "x$with_libdbi" = "xyes"; then
+  BUILD_WITH_LIBDBI_TRUE=
+  BUILD_WITH_LIBDBI_FALSE='#'
+else
+  BUILD_WITH_LIBDBI_TRUE='#'
+  BUILD_WITH_LIBDBI_FALSE=
+fi
+
+# }}}
+
+# --with-libesmtp {{{
+
+# Check whether --with-libesmtp was given.
+if test "${with_libesmtp+set}" = set; then :
+  withval=$with_libesmtp;
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		LDFLAGS="$LDFLAGS -L$withval/lib"
+		CPPFLAGS="$CPPFLAGS -I$withval/include -D_THREAD_SAFE"
+		with_libesmtp="yes"
+	else
+		with_libesmtp="$withval"
+	fi
+
+else
+
+	with_libesmtp="yes"
+
+fi
+
+if test "x$with_libesmtp" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for smtp_create_session in -lesmtp" >&5
+$as_echo_n "checking for smtp_create_session in -lesmtp... " >&6; }
+if ${ac_cv_lib_esmtp_smtp_create_session+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lesmtp  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char smtp_create_session ();
+int
+main ()
+{
+return smtp_create_session ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_esmtp_smtp_create_session=yes
+else
+  ac_cv_lib_esmtp_smtp_create_session=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_esmtp_smtp_create_session" >&5
+$as_echo "$ac_cv_lib_esmtp_smtp_create_session" >&6; }
+if test "x$ac_cv_lib_esmtp_smtp_create_session" = xyes; then :
+
+
+$as_echo "#define HAVE_LIBESMTP 1" >>confdefs.h
+
+
+else
+  with_libesmtp="no (libesmtp not found)"
+fi
+
+fi
+if test "x$with_libesmtp" = "xyes"
+then
+	for ac_header in libesmtp.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "libesmtp.h" "ac_cv_header_libesmtp_h" "$ac_includes_default"
+if test "x$ac_cv_header_libesmtp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LIBESMTP_H 1
+_ACEOF
+
+
+$as_echo "#define HAVE_LIBESMTP_H 1" >>confdefs.h
+
+
+else
+  with_libesmtp="no (libesmtp.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_libesmtp" = "xyes"
+then
+	collect_libesmtp=1
+else
+	collect_libesmtp=0
+fi
+
+cat >>confdefs.h <<_ACEOF
+#define COLLECT_LIBESMTP $collect_libesmtp
+_ACEOF
+
+ if test "x$with_libesmtp" = "xyes"; then
+  BUILD_WITH_LIBESMTP_TRUE=
+  BUILD_WITH_LIBESMTP_FALSE='#'
+else
+  BUILD_WITH_LIBESMTP_TRUE='#'
+  BUILD_WITH_LIBESMTP_FALSE=
+fi
+
+# }}}
+
+# --with-libganglia {{{
+
+# Check whether --with-libganglia was given.
+if test "${with_libganglia+set}" = set; then :
+  withval=$with_libganglia;
+ if test -f "$withval" && test -x "$withval"
+ then
+	 with_libganglia_config="$withval"
+	 with_libganglia="yes"
+ else if test -f "$withval/bin/ganglia-config" && test -x "$withval/bin/ganglia-config"
+ then
+	 with_libganglia_config="$withval/bin/ganglia-config"
+	 with_libganglia="yes"
+ else if test -d "$withval"
+ then
+	 GANGLIA_CPPFLAGS="-I$withval/include"
+	 GANGLIA_LDFLAGS="-L$withval/lib"
+	 with_libganglia="yes"
+ else
+	 with_libganglia="$withval"
+ fi; fi; fi
+
+else
+
+ with_libganglia="yes"
+
+fi
+
+
+if test "x$with_libganglia" = "xyes"
+then
+	if test "x$with_libganglia_config" != "x"
+	then
+		if test "x$GANGLIA_CPPFLAGS" = "x"
+		then
+			GANGLIA_CPPFLAGS=`"$with_libganglia_config" --cflags 2>/dev/null`
+		fi
+
+		if test "x$GANGLIA_LDFLAGS" = "x"
+		then
+			GANGLIA_LDFLAGS=`"$with_libganglia_config" --ldflags 2>/dev/null`
+		fi
+
+		if test "x$GANGLIA_LIBS" = "x"
+		then
+			GANGLIA_LIBS=`"$with_libganglia_config" --libs 2>/dev/null`
+		fi
+	else
+		GANGLIA_LIBS="-lganglia"
+	fi
+fi
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+CPPFLAGS="$CPPFLAGS $GANGLIA_CPPFLAGS"
+LDFLAGS="$LDFLAGS $GANGLIA_LDFLAGS"
+
+if test "x$with_libganglia" = "xyes"
+then
+	for ac_header in gm_protocol.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "gm_protocol.h" "ac_cv_header_gm_protocol_h" "$ac_includes_default"
+if test "x$ac_cv_header_gm_protocol_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GM_PROTOCOL_H 1
+_ACEOF
+
+
+$as_echo "#define HAVE_GM_PROTOCOL_H 1" >>confdefs.h
+
+
+else
+  with_libganglia="no (gm_protocol.h not found)"
+fi
+
+done
+
+fi
+
+if test "x$with_libganglia" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for xdr_Ganglia_value_msg in -lganglia" >&5
+$as_echo_n "checking for xdr_Ganglia_value_msg in -lganglia... " >&6; }
+if ${ac_cv_lib_ganglia_xdr_Ganglia_value_msg+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lganglia  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char xdr_Ganglia_value_msg ();
+int
+main ()
+{
+return xdr_Ganglia_value_msg ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_ganglia_xdr_Ganglia_value_msg=yes
+else
+  ac_cv_lib_ganglia_xdr_Ganglia_value_msg=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ganglia_xdr_Ganglia_value_msg" >&5
+$as_echo "$ac_cv_lib_ganglia_xdr_Ganglia_value_msg" >&6; }
+if test "x$ac_cv_lib_ganglia_xdr_Ganglia_value_msg" = xyes; then :
+
+
+$as_echo "#define HAVE_LIBGANGLIA 1" >>confdefs.h
+
+
+else
+  with_libganglia="no (symbol xdr_Ganglia_value_msg not found)"
+fi
+
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+
+
+
+
+ if test "x$with_libganglia" = "xyes"; then
+  BUILD_WITH_LIBGANGLIA_TRUE=
+  BUILD_WITH_LIBGANGLIA_FALSE='#'
+else
+  BUILD_WITH_LIBGANGLIA_TRUE='#'
+  BUILD_WITH_LIBGANGLIA_FALSE=
+fi
+
+# }}}
+
+# --with-libgcrypt {{{
+GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS"
+GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS"
+GCRYPT_LIBS="$GCRYPT_LIBS"
+
+# Check whether --with-libgcrypt was given.
+if test "${with_libgcrypt+set}" = set; then :
+  withval=$with_libgcrypt;
+ if test -f "$withval" && test -x "$withval"
+ then
+	 with_libgcrypt_config="$withval"
+	 with_libgcrypt="yes"
+ else if test -f "$withval/bin/gcrypt-config" && test -x "$withval/bin/gcrypt-config"
+ then
+	 with_libgcrypt_config="$withval/bin/gcrypt-config"
+	 with_libgcrypt="yes"
+ else if test -d "$withval"
+ then
+	 GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS -I$withval/include"
+	 GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS -L$withval/lib"
+	 with_libgcrypt="yes"
+ else
+	 with_libgcrypt_config="gcrypt-config"
+	 with_libgcrypt="$withval"
+ fi; fi; fi
+
+else
+
+ with_libgcrypt_config="libgcrypt-config"
+ with_libgcrypt="yes"
+
+fi
+
+
+if test "x$with_libgcrypt" = "xyes" && test "x$with_libgcrypt_config" != "x"
+then
+	if test "x$GCRYPT_CPPFLAGS" = "x"
+	then
+		GCRYPT_CPPFLAGS=`"$with_libgcrypt_config" --cflags 2>/dev/null`
+	fi
+
+	if test "x$GCRYPT_LIBS" = "x"
+	then
+		GCRYPT_LIBS=`"$with_libgcrypt_config" --libs 2>/dev/null`
+	fi
+fi
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$CPPFLAGS $GCRYPT_CPPFLAGS"
+LDFLAGS="$LDFLAGS $GCRYPT_LDFLAGS"
+LIBS="$LIBS $GCRYPT_LIBS"
+
+if test "x$with_libgcrypt" = "xyes"
+then
+	if test "x$GCRYPT_CPPFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: gcrypt CPPFLAGS: $GCRYPT_CPPFLAGS" >&5
+$as_echo "$as_me: gcrypt CPPFLAGS: $GCRYPT_CPPFLAGS" >&6;}
+	fi
+	for ac_header in gcrypt.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "gcrypt.h" "ac_cv_header_gcrypt_h" "$ac_includes_default"
+if test "x$ac_cv_header_gcrypt_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GCRYPT_H 1
+_ACEOF
+ with_libgcrypt="yes"
+else
+  with_libgcrypt="no (gcrypt.h not found)"
+fi
+
+done
+
+fi
+
+if test "x$with_libgcrypt" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for gcry_md_hash_buffer in -lgcrypt" >&5
+$as_echo_n "checking for gcry_md_hash_buffer in -lgcrypt... " >&6; }
+if ${ac_cv_lib_gcrypt_gcry_md_hash_buffer+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lgcrypt  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char gcry_md_hash_buffer ();
+int
+main ()
+{
+return gcry_md_hash_buffer ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_gcrypt_gcry_md_hash_buffer=yes
+else
+  ac_cv_lib_gcrypt_gcry_md_hash_buffer=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gcrypt_gcry_md_hash_buffer" >&5
+$as_echo "$ac_cv_lib_gcrypt_gcry_md_hash_buffer" >&6; }
+if test "x$ac_cv_lib_gcrypt_gcry_md_hash_buffer" = xyes; then :
+  with_libgcrypt="yes"
+else
+  with_libgcrypt="no (symbol gcry_md_hash_buffer not found)"
+fi
+
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
+
+if test "x$with_libgcrypt" = "xyes"
+then
+
+$as_echo "#define HAVE_LIBGCRYPT 1" >>confdefs.h
+
+fi
+
+
+
+
+ if test "x$with_libgcrypt" = "xyes"; then
+  BUILD_WITH_LIBGCRYPT_TRUE=
+  BUILD_WITH_LIBGCRYPT_FALSE='#'
+else
+  BUILD_WITH_LIBGCRYPT_TRUE='#'
+  BUILD_WITH_LIBGCRYPT_FALSE=
+fi
+
+# }}}
+
+# --with-libgps {{{
+with_libgps_cflags=""
+with_libgps_ldflags=""
+
+# Check whether --with-libgps was given.
+if test "${with_libgps+set}" = set; then :
+  withval=$with_libgps;
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libgps_cflags="-I$withval/include"
+		with_libgps_ldflags="-L$withval/lib"
+		with_libgps="yes"
+	else
+		with_libgps="$withval"
+	fi
+
+else
+
+	with_libgps="yes"
+
+fi
+
+if test "x$with_libgps" = "xyes"
+then
+	SAVE_CFLAGS="$CFLAGS"
+	CFLAGS="$CFLAGS $with_libgps_cflags"
+
+	for ac_header in gps.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "gps.h" "ac_cv_header_gps_h" "$ac_includes_default"
+if test "x$ac_cv_header_gps_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GPS_H 1
+_ACEOF
+ with_libgps="yes"
+else
+  with_libgps="no (gps.h not found)"
+fi
+
+done
+
+
+	CFLAGS="$SAVE_CFLAGS"
+fi
+if test "x$with_libgps" = "xyes"
+then
+	SAVE_CFLAGS="$CFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CFLAGS="$CFLAGS $with_libgps_cflags"
+	LDFLAGS="$LDFLAGS $with_libgps_ldflags"
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for gps_open in -lgps" >&5
+$as_echo_n "checking for gps_open in -lgps... " >&6; }
+if ${ac_cv_lib_gps_gps_open+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lgps  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char gps_open ();
+int
+main ()
+{
+return gps_open ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_gps_gps_open=yes
+else
+  ac_cv_lib_gps_gps_open=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gps_gps_open" >&5
+$as_echo "$ac_cv_lib_gps_gps_open" >&6; }
+if test "x$ac_cv_lib_gps_gps_open" = xyes; then :
+  with_libgps="yes"
+else
+  with_libgps="no (symbol gps_open not found)"
+fi
+
+
+	CFLAGS="$SAVE_CFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+fi
+if test "x$with_libgps" = "xyes"
+then
+	BUILD_WITH_LIBGPS_CFLAGS="$with_libgps_cflags"
+	BUILD_WITH_LIBGPS_LDFLAGS="$with_libgps_ldflags"
+	BUILD_WITH_LIBGPS_LIBS="-lgps"
+
+
+
+fi
+ if test "x$with_libgps" = "xyes"; then
+  BUILD_WITH_LIBGPS_TRUE=
+  BUILD_WITH_LIBGPS_FALSE='#'
+else
+  BUILD_WITH_LIBGPS_TRUE='#'
+  BUILD_WITH_LIBGPS_FALSE=
+fi
+
+# }}}
+
+# --with-libgrpc++ {{{
+with_libgrpcpp_cppflags=""
+with_libgrpcpp_ldflags=""
+
+# Check whether --with-libgrpc++ was given.
+if test "${with_libgrpc__+set}" = set; then :
+  withval=$with_libgrpc__;
+    with_grpcpp="$withval"
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libgrpcpp_cppflags="-I$withval/include"
+      with_libgrpcpp_ldflags="-L$withval/lib"
+      with_libgrpcpp="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libgrpcpp="no (disabled on command line)"
+    fi
+
+else
+  withval="yes"
+
+fi
+
+if test "x$withval" = "xyes"
+then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for GRPCPP" >&5
+$as_echo_n "checking for GRPCPP... " >&6; }
+
+if test -n "$GRPCPP_CFLAGS"; then
+    pkg_cv_GRPCPP_CFLAGS="$GRPCPP_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"grpc++\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "grpc++") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GRPCPP_CFLAGS=`$PKG_CONFIG --cflags "grpc++" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$GRPCPP_LIBS"; then
+    pkg_cv_GRPCPP_LIBS="$GRPCPP_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"grpc++\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "grpc++") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_GRPCPP_LIBS=`$PKG_CONFIG --libs "grpc++" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        GRPCPP_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "grpc++" 2>&1`
+        else
+	        GRPCPP_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "grpc++" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$GRPCPP_PKG_ERRORS" >&5
+
+	with_libgrpcpp="no (pkg-config could not find libgrpc++)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_libgrpcpp="no (pkg-config could not find libgrpc++)"
+
+else
+	GRPCPP_CFLAGS=$pkg_cv_GRPCPP_CFLAGS
+	GRPCPP_LIBS=$pkg_cv_GRPCPP_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_libgrpcpp="yes"
+fi
+fi
+
+if test "x$withval" != "xno"
+then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CXX accepts -std=c++11" >&5
+$as_echo_n "checking whether $CXX accepts -std=c++11... " >&6; }
+  if test_cxx_flags -std=c++11; then
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+    with_libgrpcpp="no (requires C++11 support)"
+  fi
+fi
+
+if test "x$with_libgrpcpp" = "xyes"
+then
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+
+for ac_header in grpc++/grpc++.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "grpc++/grpc++.h" "ac_cv_header_grpcpp_grpcpp_h" "$ac_includes_default"
+if test "x$ac_cv_header_grpcpp_grpcpp_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GRPC___GRPC___H 1
+_ACEOF
+
+else
+  with_libgrpcpp="no (<grpc++/grpc++.h> not found)"
+
+fi
+
+done
+
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+fi
+if test "x$with_libgrpcpp" = "xyes"
+then
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+  LDFLAGS="$with_libgrpcpp_ldflags"
+  if test "x$GRPCPP_LIBS" = "x"
+  then
+    LIBS="-lgrpc++"
+  else
+    LIBS="$GRPCPP_LIBS"
+  fi
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
-#include <stdlib.h>
+#include <grpc++/grpc++.h>
+int
+main ()
+{
+grpc::ServerBuilder sb;
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+
+      with_libgrpcpp="yes"
+      if test "x$GRPCPP_LIBS" = "x"
+      then
+        GRPCPP_LIBS="-lgrpc++"
+      fi
+
+else
+  with_libgrpcpp="no (libgrpc++ not found)"
+
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+fi
+BUILD_WITH_LIBGRPCPP_CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS"
+BUILD_WITH_LIBGRPCPP_LDFLAGS="$with_libgrpcpp_ldflags"
+BUILD_WITH_LIBGRPCPP_LIBS="$GRPCPP_LIBS"
+
+
+
+# }}}
+
+# --with-libiptc {{{
+
+# Check whether --with-libiptc was given.
+if test "${with_libiptc+set}" = set; then :
+  withval=$with_libiptc;
+	if test "x$withval" = "xyes"
+	then
+		with_libiptc="pkgconfig"
+	else if test "x$withval" = "xno"
+	then
+		with_libiptc="no"
+	else
+		with_libiptc="yes"
+		with_libiptc_cflags="-I$withval/include"
+		with_libiptc_libs="-L$withval/lib"
+	fi; fi
+
+else
+
+	if test "x$ac_system" = "xLinux"
+	then
+		with_libiptc="pkgconfig"
+	else
+		with_libiptc="no (Linux only)"
+	fi
+
+fi
+
+
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	$PKG_CONFIG --exists 'libiptc' 2>/dev/null
+	if test $? -ne 0
+	then
+		with_libiptc="no (pkg-config doesn't know libiptc)"
+	fi
+fi
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	with_libiptc_cflags="`$PKG_CONFIG --cflags 'libiptc'`"
+	if test $? -ne 0
+	then
+		with_libiptc="no ($PKG_CONFIG failed)"
+	fi
+	with_libiptc_libs="`$PKG_CONFIG --libs 'libiptc'`"
+	if test $? -ne 0
+	then
+		with_libiptc="no ($PKG_CONFIG failed)"
+	fi
+fi
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+CPPFLAGS="$CPPFLAGS $with_libiptc_cflags"
+
+# check whether the header file for libiptc is available.
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	for ac_header in libiptc/libiptc.h libiptc/libip6tc.h
+do :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
+  cat >>confdefs.h <<_ACEOF
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  with_libiptc="no (header file missing)"
+fi
+
+done
+
+fi
+# If the header file is available, check for the required type declaractions.
+# They may be missing in old versions of libiptc. In that case, they will be
+# declared in the iptables plugin.
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	ac_fn_c_check_type "$LINENO" "iptc_handle_t" "ac_cv_type_iptc_handle_t" "$ac_includes_default"
+if test "x$ac_cv_type_iptc_handle_t" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_IPTC_HANDLE_T 1
+_ACEOF
+
+
+fi
+ac_fn_c_check_type "$LINENO" "ip6tc_handle_t" "ac_cv_type_ip6tc_handle_t" "$ac_includes_default"
+if test "x$ac_cv_type_ip6tc_handle_t" = xyes; then :
+
+cat >>confdefs.h <<_ACEOF
+#define HAVE_IP6TC_HANDLE_T 1
+_ACEOF
+
+
+fi
+
+fi
+# Check for the iptc_init symbol in the library.
+# This could be in iptc or ip4tc
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	SAVE_LIBS="$LIBS"
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing iptc_init" >&5
+$as_echo_n "checking for library containing iptc_init... " >&6; }
+if ${ac_cv_search_iptc_init+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_func_search_save_LIBS=$LIBS
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char iptc_init ();
+int
+main ()
+{
+return iptc_init ();
+  ;
+  return 0;
+}
+_ACEOF
+for ac_lib in '' iptc ip4tc; do
+  if test -z "$ac_lib"; then
+    ac_res="none required"
+  else
+    ac_res=-l$ac_lib
+    LIBS="-l$ac_lib $with_libiptc_libs $ac_func_search_save_LIBS"
+  fi
+  if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_search_iptc_init=$ac_res
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext
+  if ${ac_cv_search_iptc_init+:} false; then :
+  break
+fi
+done
+if ${ac_cv_search_iptc_init+:} false; then :
+
+else
+  ac_cv_search_iptc_init=no
+fi
+rm conftest.$ac_ext
+LIBS=$ac_func_search_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_iptc_init" >&5
+$as_echo "$ac_cv_search_iptc_init" >&6; }
+ac_res=$ac_cv_search_iptc_init
+if test "$ac_res" != no; then :
+  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
+  with_libiptc="pkgconfig"
+else
+  with_libiptc="no"
+fi
+
+	LIBS="$SAVE_LIBS"
+fi
+if test "x$with_libiptc" = "xpkgconfig"
+then
+	with_libiptc="yes"
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+
+ if test "x$with_libiptc" = "xyes"; then
+  BUILD_WITH_LIBIPTC_TRUE=
+  BUILD_WITH_LIBIPTC_FALSE='#'
+else
+  BUILD_WITH_LIBIPTC_TRUE='#'
+  BUILD_WITH_LIBIPTC_FALSE=
+fi
+
+if test "x$with_libiptc" = "xyes"
+then
+	BUILD_WITH_LIBIPTC_CPPFLAGS="$with_libiptc_cflags"
+	BUILD_WITH_LIBIPTC_LDFLAGS="$with_libiptc_libs"
+
+
+fi
+# }}}
+
+# --with-java {{{
+with_java_home="$JAVA_HOME"
+if test "x$with_java_home" = "x"
+then
+	with_java_home="/usr/lib/jvm"
+fi
+JAVAC="$JAVAC"
+JAR="$JAR"
+
+# Check whether --with-java was given.
+if test "${with_java+set}" = set; then :
+  withval=$with_java;
+	if test "x$withval" = "xno"
+	then
+		with_java="no"
+	else if test "x$withval" = "xyes"
+	then
+		with_java="yes"
+	else
+		with_java_home="$withval"
+		with_java="yes"
+	fi; fi
+
+else
+  with_java="yes"
+fi
+
+if test "x$with_java" = "xyes"
+then
+	if test -d "$with_java_home"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jni.h" >&5
+$as_echo_n "checking for jni.h... " >&6; }
+		TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
+		if test "x$TMPVAR" != "x"
+		then
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
+$as_echo "found in $TMPVAR" >&6; }
+			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
+		else
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
+$as_echo "not found" >&6; }
+		fi
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jni_md.h" >&5
+$as_echo_n "checking for jni_md.h... " >&6; }
+		TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
+		if test "x$TMPVAR" != "x"
+		then
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
+$as_echo "found in $TMPVAR" >&6; }
+			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
+		else
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
+$as_echo "not found" >&6; }
+		fi
+
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libjvm.so" >&5
+$as_echo_n "checking for libjvm.so... " >&6; }
+		TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
+		if test "x$TMPVAR" != "x"
+		then
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
+$as_echo "found in $TMPVAR" >&6; }
+			JAVA_LDFLAGS="$JAVA_LDFLAGS -L$TMPVAR -Wl,-rpath -Wl,$TMPVAR"
+		else
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
+$as_echo "not found" >&6; }
+		fi
+
+		if test "x$JAVAC" = "x"
+		then
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for javac" >&5
+$as_echo_n "checking for javac... " >&6; }
+			TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | head -n 1`
+			if test "x$TMPVAR" != "x"
+			then
+				JAVAC="$TMPVAR"
+				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAVAC" >&5
+$as_echo "$JAVAC" >&6; }
+			else
+				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
+$as_echo "not found" >&6; }
+			fi
+		fi
+		if test "x$JAR" = "x"
+		then
+			{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jar" >&5
+$as_echo_n "checking for jar... " >&6; }
+			TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | head -n 1`
+			if test "x$TMPVAR" != "x"
+			then
+				JAR="$TMPVAR"
+				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAR" >&5
+$as_echo "$JAR" >&6; }
+			else
+				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
+$as_echo "not found" >&6; }
+			fi
+		fi
+	else if test "x$with_java_home" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: JAVA_HOME: No such directory: $with_java_home" >&5
+$as_echo "$as_me: WARNING: JAVA_HOME: No such directory: $with_java_home" >&2;}
+	fi; fi
+fi
+
+if test "x$JAVA_CPPFLAGS" != "x"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_CPPFLAGS set to: $JAVA_CPPFLAGS" >&5
+$as_echo "$as_me: Building with JAVA_CPPFLAGS set to: $JAVA_CPPFLAGS" >&6;}
+fi
+if test "x$JAVA_CFLAGS" != "x"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_CFLAGS set to: $JAVA_CFLAGS" >&5
+$as_echo "$as_me: Building with JAVA_CFLAGS set to: $JAVA_CFLAGS" >&6;}
+fi
+if test "x$JAVA_LDFLAGS" != "x"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_LDFLAGS set to: $JAVA_LDFLAGS" >&5
+$as_echo "$as_me: Building with JAVA_LDFLAGS set to: $JAVA_LDFLAGS" >&6;}
+fi
+if test "x$JAVA_LIBS" != "x"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_LIBS set to: $JAVA_LIBS" >&5
+$as_echo "$as_me: Building with JAVA_LIBS set to: $JAVA_LIBS" >&6;}
+fi
+if test "x$JAVAC" = "x"
+then
+	with_javac_path="$PATH"
+	if test "x$with_java_home" != "x"
+	then
+		with_javac_path="$with_java_home:with_javac_path"
+		if test -d "$with_java_home/bin"
+		then
+			with_javac_path="$with_java_home/bin:with_javac_path"
+		fi
+	fi
+
+	# Extract the first word of "javac", so it can be a program name with args.
+set dummy javac; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_JAVAC+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $JAVAC in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_JAVAC="$JAVAC" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in "$with_javac_path"
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_JAVAC="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+JAVAC=$ac_cv_path_JAVAC
+if test -n "$JAVAC"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAVAC" >&5
+$as_echo "$JAVAC" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test "x$JAVAC" = "x"
+then
+	with_java="no (javac not found)"
+fi
+if test "x$JAR" = "x"
+then
+	with_jar_path="$PATH"
+	if test "x$with_java_home" != "x"
+	then
+		with_jar_path="$with_java_home:$with_jar_path"
+		if test -d "$with_java_home/bin"
+		then
+			with_jar_path="$with_java_home/bin:$with_jar_path"
+		fi
+	fi
+
+	# Extract the first word of "jar", so it can be a program name with args.
+set dummy jar; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_JAR+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $JAR in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_JAR="$JAR" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in "$with_jar_path"
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_JAR="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
+
+  ;;
+esac
+fi
+JAR=$ac_cv_path_JAR
+if test -n "$JAR"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAR" >&5
+$as_echo "$JAR" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+fi
+
+
+fi
+if test "x$JAR" = "x"
+then
+	with_java="no (jar not found)"
+fi
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_CFLAGS="$CFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
+CPPFLAGS="$CPPFLAGS $JAVA_CPPFLAGS"
+CFLAGS="$CFLAGS $JAVA_CFLAGS"
+LDFLAGS="$LDFLAGS $JAVA_LDFLAGS"
+LIBS="$LIBS $JAVA_LIBS"
+
+if test "x$with_java" = "xyes"
+then
+	for ac_header in jni.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "jni.h" "ac_cv_header_jni_h" "$ac_includes_default"
+if test "x$ac_cv_header_jni_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_JNI_H 1
+_ACEOF
+
+else
+  with_java="no (jni.h not found)"
+fi
+
+done
+
+fi
+if test "x$with_java" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for JNI_CreateJavaVM in -ljvm" >&5
+$as_echo_n "checking for JNI_CreateJavaVM in -ljvm... " >&6; }
+if ${ac_cv_lib_jvm_JNI_CreateJavaVM+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-ljvm $JAVA_LIBS $PTHREAD_LIBS $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char JNI_CreateJavaVM ();
+int
+main ()
+{
+return JNI_CreateJavaVM ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_jvm_JNI_CreateJavaVM=yes
+else
+  ac_cv_lib_jvm_JNI_CreateJavaVM=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_jvm_JNI_CreateJavaVM" >&5
+$as_echo "$ac_cv_lib_jvm_JNI_CreateJavaVM" >&6; }
+if test "x$ac_cv_lib_jvm_JNI_CreateJavaVM" = xyes; then :
+  with_java="yes"
+else
+  with_java="no (Symbol 'JNI_CreateJavaVM' not found)"
+fi
+
+fi
+if test "x$with_java" = "xyes"
+then
+	JAVA_LIBS="$JAVA_LIBS -ljvm"
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_LIBS set to: $JAVA_LIBS" >&5
+$as_echo "$as_me: Building with JAVA_LIBS set to: $JAVA_LIBS" >&6;}
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+CFLAGS="$SAVE_CFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
+
+
+
+
+
+ if test "x$with_java" = "xyes"; then
+  BUILD_WITH_JAVA_TRUE=
+  BUILD_WITH_JAVA_FALSE='#'
+else
+  BUILD_WITH_JAVA_TRUE='#'
+  BUILD_WITH_JAVA_FALSE=
+fi
+
+# }}}
+
+# --with-libldap {{{
+
+# Check whether --with-libldap was given.
+if test "${with_libldap+set}" = set; then :
+  withval=$with_libldap;
+ if test "x$withval" = "xyes"
+ then
+	 with_libldap="yes"
+ else if test "x$withval" = "xno"
+ then
+	 with_libldap="no"
+ else
+	 with_libldap="yes"
+	 LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS -I$withval/include"
+	 LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS -L$withval/lib"
+ fi; fi
+
+else
+  with_libldap="yes"
+fi
+
+
+SAVE_CPPFLAGS="$CPPFLAGS"
+SAVE_LDFLAGS="$LDFLAGS"
+
+CPPFLAGS="$CPPFLAGS $LIBLDAP_CPPFLAGS"
+LDFLAGS="$LDFLAGS $LIBLDAP_LDFLAGS"
+
+if test "x$with_libldap" = "xyes"
+then
+	if test "x$LIBLDAP_CPPFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libldap CPPFLAGS: $LIBLDAP_CPPFLAGS" >&5
+$as_echo "$as_me: libldap CPPFLAGS: $LIBLDAP_CPPFLAGS" >&6;}
+	fi
+	for ac_header in ldap.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "ldap.h" "ac_cv_header_ldap_h" "$ac_includes_default"
+if test "x$ac_cv_header_ldap_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_LDAP_H 1
+_ACEOF
+ with_libldap="yes"
+else
+  with_libldap="no ('ldap.h' not found)"
+fi
+
+done
+
+fi
+if test "x$with_libldap" = "xyes"
+then
+	if test "x$LIBLDAP_LDFLAGS" != "x"
+	then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: libldap LDFLAGS: $LIBLDAP_LDFLAGS" >&5
+$as_echo "$as_me: libldap LDFLAGS: $LIBLDAP_LDFLAGS" >&6;}
+	fi
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ldap_initialize in -lldap" >&5
+$as_echo_n "checking for ldap_initialize in -lldap... " >&6; }
+if ${ac_cv_lib_ldap_ldap_initialize+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lldap  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char ldap_initialize ();
+int
+main ()
+{
+return ldap_initialize ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_ldap_ldap_initialize=yes
+else
+  ac_cv_lib_ldap_ldap_initialize=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ldap_ldap_initialize" >&5
+$as_echo "$ac_cv_lib_ldap_ldap_initialize" >&6; }
+if test "x$ac_cv_lib_ldap_ldap_initialize" = xyes; then :
+  with_libldap="yes"
+else
+  with_libldap="no (symbol 'ldap_initialize' not found)"
+fi
+
+
+fi
+
+CPPFLAGS="$SAVE_CPPFLAGS"
+LDFLAGS="$SAVE_LDFLAGS"
+
+if test "x$with_libldap" = "xyes"
+then
+	BUILD_WITH_LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS"
+	BUILD_WITH_LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS"
+
+
+fi
+ if test "x$with_libldap" = "xyes"; then
+  BUILD_WITH_LIBLDAP_TRUE=
+  BUILD_WITH_LIBLDAP_FALSE='#'
+else
+  BUILD_WITH_LIBLDAP_TRUE='#'
+  BUILD_WITH_LIBLDAP_FALSE=
+fi
+
+# }}}
+
+# --with-liblua {{{
+
+if test "x$LIBLUA_PKG_CONFIG_NAME" != "x"
+then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"\$LIBLUA_PKG_CONFIG_NAME\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "$LIBLUA_PKG_CONFIG_NAME") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "$LIBLUA_PKG_CONFIG_NAME" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"\$LIBLUA_PKG_CONFIG_NAME\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "$LIBLUA_PKG_CONFIG_NAME") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "$LIBLUA_PKG_CONFIG_NAME" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "$LIBLUA_PKG_CONFIG_NAME" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "$LIBLUA_PKG_CONFIG_NAME" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+else
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "free" >/dev/null 2>&1; then :
 
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_header_stdc=no
+  pkg_failed=yes
 fi
-rm -f conftest*
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-if test $ac_cv_header_stdc = yes; then
-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
-  if test "$cross_compiling" = yes; then :
-  :
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <ctype.h>
-#include <stdlib.h>
-#if ((' ' & 0x0FF) == 0x020)
-# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
-#else
-# define ISLOWER(c) \
-		   (('a' <= (c) && (c) <= 'i') \
-		     || ('j' <= (c) && (c) <= 'r') \
-		     || ('s' <= (c) && (c) <= 'z'))
-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
-#endif
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
-int
-main ()
-{
-  int i;
-  for (i = 0; i < 256; i++)
-    if (XOR (islower (i), ISLOWER (i))
-	|| toupper (i) != TOUPPER (i))
-      return 2;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_header_stdc=no
+  pkg_failed=yes
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
+ else
+    pkg_failed=untried
 fi
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc" >&5
-$as_echo "$ac_cv_header_stdc" >&6; }
-if test $ac_cv_header_stdc = yes; then
 
-$as_echo "#define STDC_HEADERS 1" >>confdefs.h
 
-fi
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sys/wait.h that is POSIX.1 compatible" >&5
-$as_echo_n "checking for sys/wait.h that is POSIX.1 compatible... " >&6; }
-if ${ac_cv_header_sys_wait_h+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-#include <sys/wait.h>
-#ifndef WEXITSTATUS
-# define WEXITSTATUS(stat_val) ((unsigned int) (stat_val) >> 8)
-#endif
-#ifndef WIFEXITED
-# define WIFEXITED(stat_val) (((stat_val) & 255) == 0)
-#endif
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-int
-main ()
-{
-  int s;
-  wait (&s);
-  s = WIFEXITED (s) ? WEXITSTATUS (s) : 1;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_header_sys_wait_h=yes
 else
-  ac_cv_header_sys_wait_h=no
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_sys_wait_h" >&5
-$as_echo "$ac_cv_header_sys_wait_h" >&6; }
-if test $ac_cv_header_sys_wait_h = yes; then
 
-$as_echo "#define HAVE_SYS_WAIT_H 1" >>confdefs.h
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-ac_header_dirent=no
-for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h; do
-  as_ac_Header=`$as_echo "ac_cv_header_dirent_$ac_hdr" | $as_tr_sh`
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_hdr that defines DIR" >&5
-$as_echo_n "checking for $ac_hdr that defines DIR... " >&6; }
-if eval \${$as_ac_Header+:} false; then :
-  $as_echo_n "(cached) " >&6
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-#include <$ac_hdr>
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-int
-main ()
-{
-if ((DIR *) 0)
-return 0;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  eval "$as_ac_Header=yes"
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  eval "$as_ac_Header=no"
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-eval ac_res=\$$as_ac_Header
-	       { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_res" >&5
-$as_echo "$ac_res" >&6; }
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_hdr" | $as_tr_cpp` 1
-_ACEOF
 
-ac_header_dirent=$ac_hdr; break
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-done
-# Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
-if test $ac_header_dirent = dirent.h; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
-$as_echo_n "checking for library containing opendir... " >&6; }
-if ${ac_cv_search_opendir+:} false; then :
-  $as_echo_n "(cached) " >&6
 else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char opendir ();
-int
-main ()
-{
-return opendir ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' dir; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_opendir=$ac_res
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_opendir+:} false; then :
-  break
+ else
+    pkg_failed=untried
 fi
-done
-if ${ac_cv_search_opendir+:} false; then :
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  ac_cv_search_opendir=no
+        _pkg_short_errors_supported=no
 fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_opendir" >&5
-$as_echo "$ac_cv_search_opendir" >&6; }
-ac_res=$ac_cv_search_opendir
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
 
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
+
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing opendir" >&5
-$as_echo_n "checking for library containing opendir... " >&6; }
-if ${ac_cv_search_opendir+:} false; then :
-  $as_echo_n "(cached) " >&6
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+
+
 else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char opendir ();
-int
-main ()
-{
-return opendir ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' x; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib  $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_opendir=$ac_res
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_opendir+:} false; then :
-  break
+
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-done
-if ${ac_cv_search_opendir+:} false; then :
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_search_opendir=no
+  pkg_failed=yes
 fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_opendir" >&5
-$as_echo "$ac_cv_search_opendir" >&6; }
-ac_res=$ac_cv_search_opendir
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for stdbool.h that conforms to C99" >&5
-$as_echo_n "checking for stdbool.h that conforms to C99... " >&6; }
-if ${ac_cv_header_stdbool_h+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-             #include <stdbool.h>
-             #ifndef bool
-              "error: bool is not defined"
-             #endif
-             #ifndef false
-              "error: false is not defined"
-             #endif
-             #if false
-              "error: false is not 0"
-             #endif
-             #ifndef true
-              "error: true is not defined"
-             #endif
-             #if true != 1
-              "error: true is not 1"
-             #endif
-             #ifndef __bool_true_false_are_defined
-              "error: __bool_true_false_are_defined is not defined"
-             #endif
 
-             struct s { _Bool s: 1; _Bool t; } s;
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-             char a[true == 1 ? 1 : -1];
-             char b[false == 0 ? 1 : -1];
-             char c[__bool_true_false_are_defined == 1 ? 1 : -1];
-             char d[(bool) 0.5 == true ? 1 : -1];
-             /* See body of main program for 'e'.  */
-             char f[(_Bool) 0.0 == false ? 1 : -1];
-             char g[true];
-             char h[sizeof (_Bool)];
-             char i[sizeof s.t];
-             enum { j = false, k = true, l = false * true, m = true * 256 };
-             /* The following fails for
-                HP aC++/ANSI C B3910B A.05.55 [Dec 04 2003]. */
-             _Bool n[m];
-             char o[sizeof n == m * sizeof n[0] ? 1 : -1];
-             char p[-1 - (_Bool) 0 < 0 && -1 - (bool) 0 < 0 ? 1 : -1];
-             /* Catch a bug in an HP-UX C compiler.  See
-                http://gcc.gnu.org/ml/gcc-patches/2003-12/msg02303.html
-                http://lists.gnu.org/archive/html/bug-coreutils/2005-11/msg00161.html
-              */
-             _Bool q = true;
-             _Bool *pq = &q;
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-int
-main ()
-{
 
-             bool e = &s;
-             *pq |= q;
-             *pq |= ! q;
-             /* Refer to every declared value, to avoid compiler optimizations.  */
-             return (!a + !b + !c + !d + !e + !f + !g + !h + !i + !!j + !k + !!l
-                     + !m + !n + !o + !p + !q + !pq);
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_header_stdbool_h=yes
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_header_stdbool_h=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdbool_h" >&5
-$as_echo "$ac_cv_header_stdbool_h" >&6; }
-   ac_fn_c_check_type "$LINENO" "_Bool" "ac_cv_type__Bool" "$ac_includes_default"
-if test "x$ac_cv_type__Bool" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE__BOOL 1
-_ACEOF
 
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-if test $ac_cv_header_stdbool_h = yes; then
 
-$as_echo "#define HAVE_STDBOOL_H 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-for ac_header in stdio.h errno.h math.h stdarg.h syslog.h fcntl.h signal.h assert.h sys/types.h sys/socket.h sys/select.h poll.h netdb.h arpa/inet.h sys/resource.h sys/param.h kstat.h regex.h sys/ioctl.h endian.h sys/isa_defs.h fnmatch.h libgen.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
 
-fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-done
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-# For ping library
-for ac_header in netinet/in_systm.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/in_systm.h" "ac_cv_header_netinet_in_systm_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_in_systm_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IN_SYSTM_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in netinet/in.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/in.h" "ac_cv_header_netinet_in_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_in_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IN_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-for ac_header in netinet/ip.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/ip.h" "ac_cv_header_netinet_ip_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-"
-if test "x$ac_cv_header_netinet_ip_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IP_H 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in netinet/ip_icmp.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/ip_icmp.h" "ac_cv_header_netinet_ip_icmp_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_ip_icmp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IP_ICMP_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_header in netinet/ip_var.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/ip_var.h" "ac_cv_header_netinet_ip_var_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-"
-if test "x$ac_cv_header_netinet_ip_var_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IP_VAR_H 1
-_ACEOF
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-for ac_header in netinet/ip6.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/ip6.h" "ac_cv_header_netinet_ip6_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-"
-if test "x$ac_cv_header_netinet_ip6_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IP6_H 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in netinet/icmp6.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/icmp6.h" "ac_cv_header_netinet_icmp6_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP6_H
-# include <netinet/ip6.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_icmp6_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_ICMP6_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
-for ac_header in netinet/tcp.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/tcp.h" "ac_cv_header_netinet_tcp_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_tcp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_TCP_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in netinet/udp.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/udp.h" "ac_cv_header_netinet_udp_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_udp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_UDP_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-have_ip6_ext="no"
-ac_fn_c_check_type "$LINENO" "struct ip6_ext" "ac_cv_type_struct_ip6_ext" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP6_H
-# include <netinet/ip6.h>
-#endif
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-"
-if test "x$ac_cv_type_struct_ip6_ext" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IP6_EXT 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-have_ip6_ext="yes"
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_ip6_ext="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$have_ip6_ext" = "xno"; then
-	SAVE_CFLAGS="$CFLAGS"
-	CFLAGS="$CFLAGS -DSOLARIS2=8"
 
-	ac_fn_c_check_type "$LINENO" "struct ip6_ext" "ac_cv_type_struct_ip6_ext" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP6_H
-# include <netinet/ip6.h>
-#endif
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-"
-if test "x$ac_cv_type_struct_ip6_ext" = xyes; then :
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IP6_EXT 1
-_ACEOF
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-have_ip6_ext="yes, with -DSOLARIS2=8"
 else
-  have_ip6_ext="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-	if test "x$have_ip6_ext" = "xno"; then
-		CFLAGS="$SAVE_CFLAGS"
-	fi
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-# For cpu modules
-for ac_header in sys/dkstat.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "sys/dkstat.h" "ac_cv_header_sys_dkstat_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_dkstat_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_DKSTAT_H 1
-_ACEOF
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-if test "x$ac_system" = "xDarwin"
-then
-	for ac_header in mach/mach_init.h mach/host_priv.h mach/mach_error.h mach/mach_host.h mach/mach_port.h mach/mach_types.h mach/message.h mach/processor_set.h mach/processor.h mach/processor_info.h mach/task.h mach/thread_act.h mach/vm_region.h mach/vm_map.h mach/vm_prot.h mach/vm_statistics.h mach/kern_return.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-	for ac_header in CoreFoundation/CoreFoundation.h IOKit/IOKitLib.h IOKit/IOTypes.h IOKit/ps/IOPSKeys.h IOKit/IOBSD.h IOKit/storage/IOBlockStorageDriver.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
-	# For the battery plugin
-	for ac_header in IOKit/ps/IOPowerSources.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "IOKit/ps/IOPowerSources.h" "ac_cv_header_IOKit_ps_IOPowerSources_h" "
-#if HAVE_IOKIT_IOKITLIB_H
-#  include <IOKit/IOKitLib.h>
-#endif
-#if HAVE_IOKIT_IOTYPES_H
-#  include <IOKit/IOTypes.h>
-#endif
 
-"
-if test "x$ac_cv_header_IOKit_ps_IOPowerSources_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_IOKIT_PS_IOPOWERSOURCES_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-for ac_header in sys/sysctl.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "sys/sysctl.h" "ac_cv_header_sys_sysctl_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-# include <sys/param.h>
-#endif
 
-"
-if test "x$ac_cv_header_sys_sysctl_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_SYSCTL_H 1
-_ACEOF
 
-fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-done
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sysctl kern.cp_times" >&5
-$as_echo_n "checking for sysctl kern.cp_times... " >&6; }
-if test -x /sbin/sysctl
-then
-	/sbin/sysctl kern.cp_times 2>/dev/null
-	if test $? -eq 0
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
 
-$as_echo "#define HAVE_SYSCTL_KERN_CP_TIMES 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
 	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
 	fi
-else
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-fi
-
-# For hddtemp module
-for ac_header in linux/major.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "linux/major.h" "ac_cv_header_linux_major_h" "$ac_includes_default"
-if test "x$ac_cv_header_linux_major_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_MAJOR_H 1
-_ACEOF
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-# For md module (Linux only)
-if test "x$ac_system" = "xLinux"
-then
-	for ac_header in linux/raid/md_u.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/raid/md_u.h" "ac_cv_header_linux_raid_md_u_h" "
-#include <sys/ioctl.h>
-#include <linux/major.h>
-#include <linux/types.h>
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-"
-if test "x$ac_cv_header_linux_raid_md_u_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_RAID_MD_U_H 1
-_ACEOF
- have_linux_raid_md_u_h="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_linux_raid_md_u_h="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-	for ac_header in sys/sysmacros.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "sys/sysmacros.h" "ac_cv_header_sys_sysmacros_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_sysmacros_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_SYSMACROS_H 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-	have_linux_raid_md_u_h="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-# For the swap module
-have_linux_wireless_h="no"
-if test "x$ac_system" = "xLinux"
-then
-  for ac_header in linux/wireless.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/wireless.h" "ac_cv_header_linux_wireless_h" "
-#include <dirent.h>
-#include <sys/ioctl.h>
-#include <sys/socket.h>
 
-"
-if test "x$ac_cv_header_linux_wireless_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_WIRELESS_H 1
-_ACEOF
- have_linux_wireless_h="yes"
 else
-  have_linux_wireless_h="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-# For the swap module
-have_sys_swap_h="yes"
-for ac_header in sys/swap.h vm/anon.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "
-#undef _FILE_OFFSET_BITS
-#undef _LARGEFILE64_SOURCE
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-# include <sys/param.h>
-#endif
 
-"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_sys_swap_h="no"
+  pkg_failed=yes
 fi
-
-done
-
-
-# For load module
-# For the processes plugin
-# For users module
-for ac_header in sys/loadavg.h linux/config.h utmp.h utmpx.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-# For interface plugin
-for ac_header in ifaddrs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "ifaddrs.h" "ac_cv_header_ifaddrs_h" "$ac_includes_default"
-if test "x$ac_cv_header_ifaddrs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_IFADDRS_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
-for ac_header in net/if.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "net/if.h" "ac_cv_header_net_if_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#  include <sys/socket.h>
-#endif
 
-"
-if test "x$ac_cv_header_net_if_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_IF_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in linux/if.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/if.h" "ac_cv_header_linux_if_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#  include <sys/socket.h>
-#endif
 
-"
-if test "x$ac_cv_header_linux_if_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_IF_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
-
-for ac_header in linux/inet_diag.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/inet_diag.h" "ac_cv_header_linux_inet_diag_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#  include <sys/socket.h>
-#endif
-#if HAVE_LINUX_INET_DIAG_H
-# include <linux/inet_diag.h>
-#endif
+	with_liblua="no (pkg-config cannot find liblua)"
 
-"
-if test "x$ac_cv_header_linux_inet_diag_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_INET_DIAG_H 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-for ac_header in linux/netdevice.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/netdevice.h" "ac_cv_header_linux_netdevice_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-#  include <sys/socket.h>
-#endif
-#if HAVE_LINUX_IF_H
-# include <linux/if.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-"
-if test "x$ac_cv_header_linux_netdevice_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_NETDEVICE_H 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-# For ethstat module
-for ac_header in linux/sockios.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/sockios.h" "ac_cv_header_linux_sockios_h" "
-#if HAVE_SYS_IOCTL_H
-# include <sys/ioctl.h>
-#endif
-#if HAVE_NET_IF_H
-# include <net/if.h>
-#endif
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-"
-if test "x$ac_cv_header_linux_sockios_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_SOCKIOS_H 1
-_ACEOF
- have_linux_sockios_h="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  have_linux_sockios_h="no"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_header in linux/ethtool.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/ethtool.h" "ac_cv_header_linux_ethtool_h" "
-#if HAVE_SYS_IOCTL_H
-# include <sys/ioctl.h>
-#endif
-#if HAVE_NET_IF_H
-# include <net/if.h>
-#endif
-#if HAVE_LINUX_SOCKIOS_H
-# include <linux/sockios.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-"
-if test "x$ac_cv_header_linux_ethtool_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_ETHTOOL_H 1
-_ACEOF
- have_linux_ethtool_h="yes"
 else
-  have_linux_ethtool_h="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
-
 
-# For ipvs module
-have_linux_ip_vs_h="no"
-have_net_ip_vs_h="no"
-have_ip_vs_h="no"
-ip_vs_h_needs_kernel_cflags="no"
-if test "x$ac_system" = "xLinux"
-then
-	for ac_header in linux/ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "linux/ip_vs.h" "ac_cv_header_linux_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_linux_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_IP_VS_H 1
-_ACEOF
- have_linux_ip_vs_h="yes"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-	for ac_header in net/ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "net/ip_vs.h" "ac_cv_header_net_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_net_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_IP_VS_H 1
-_ACEOF
- have_net_ip_vs_h="yes"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-	for ac_header in ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "ip_vs.h" "ac_cv_header_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_IP_VS_H 1
-_ACEOF
- have_ip_vs_h="yes"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	if test "x$have_linux_ip_vs_h$have_net_ip_vs_h$have_ip_vs_h" = "xnonono" && test -d "$KERNEL_DIR"
-	then
-		SAVE_CFLAGS="$CFLAGS"
-		CFLAGS="$CFLAGS $KERNEL_CFLAGS"
 
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: Did not find ip_vs.h. Trying again using headers from $KERNEL_DIR." >&5
-$as_echo "$as_me: Did not find ip_vs.h. Trying again using headers from $KERNEL_DIR." >&6;}
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-		for ac_header in linux/ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "linux/ip_vs.h" "ac_cv_header_linux_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_linux_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_IP_VS_H 1
-_ACEOF
- have_linux_ip_vs_h="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-		for ac_header in net/ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "net/ip_vs.h" "ac_cv_header_net_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_net_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_IP_VS_H 1
-_ACEOF
- have_net_ip_vs_h="yes"
-fi
 
-done
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-		for ac_header in ip_vs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "ip_vs.h" "ac_cv_header_ip_vs_h" "$ac_includes_default"
-if test "x$ac_cv_header_ip_vs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_IP_VS_H 1
-_ACEOF
- have_ip_vs_h="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
 
-		if test "x$have_linux_ip_vs_h" = "xyes" || test "x$have_net_ip_vs_h" = "xyes" || test "x$have_ip_vs_h" = "xyes"
-		then
-			ip_vs_h_needs_kernel_cflags="yes"
-		fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-		CFLAGS="$SAVE_CFLAGS"
-	fi
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
- if test "x$ip_vs_h_needs_kernel_cflags" = "xyes"; then
-  IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE=
-  IP_VS_H_NEEDS_KERNEL_CFLAGS_FALSE='#'
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE='#'
-  IP_VS_H_NEEDS_KERNEL_CFLAGS_FALSE=
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-# For quota module
-for ac_header in sys/ucred.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "sys/ucred.h" "ac_cv_header_sys_ucred_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-# include <sys/param.h>
-#endif
 
-"
-if test "x$ac_cv_header_sys_ucred_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_UCRED_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-# For mount interface
-for ac_header in sys/mount.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "sys/mount.h" "ac_cv_header_sys_mount_h" "
-#if HAVE_SYS_TYPES_H
-#  include <sys/types.h>
-#endif
-#if HAVE_SYS_PARAM_H
-# include <sys/param.h>
-#endif
 
-"
-if test "x$ac_cv_header_sys_mount_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_MOUNT_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-# For the email plugin
-for ac_header in linux/un.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "linux/un.h" "ac_cv_header_linux_un_h" "
-#if HAVE_SYS_SOCKET_H
-#	include <sys/socket.h>
-#endif
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
 
-"
-if test "x$ac_cv_header_linux_un_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LINUX_UN_H 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-for ac_header in  \
-  ctype.h \
-  fs_info.h \
-  fshelp.h \
-  grp.h \
-  kvm.h \
-  limits.h \
-  locale.h \
-  mntent.h \
-  mnttab.h \
-  paths.h \
-  pwd.h \
-  sys/fs_types.h \
-  sys/fstyp.h \
-  sys/mntent.h \
-  sys/mnttab.h \
-  sys/statfs.h \
-  sys/statvfs.h \
-  sys/un.h \
-  sys/vfs.h \
-  sys/vfstab.h \
-  sys/vmmeter.h \
-  wordexp.h \
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-for ac_header in xfs/xqm.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "xfs/xqm.h" "ac_cv_header_xfs_xqm_h" "
-#define _GNU_SOURCE
 
-"
-if test "x$ac_cv_header_xfs_xqm_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_XFS_XQM_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-# For the dns plugin
-for ac_header in arpa/nameser.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "arpa/nameser.h" "ac_cv_header_arpa_nameser_h" "$ac_includes_default"
-if test "x$ac_cv_header_arpa_nameser_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_ARPA_NAMESER_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_header in arpa/nameser_compat.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "arpa/nameser_compat.h" "ac_cv_header_arpa_nameser_compat_h" "
-#if HAVE_ARPA_NAMESER_H
-# include <arpa/nameser.h>
-#endif
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-"
-if test "x$ac_cv_header_arpa_nameser_compat_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_ARPA_NAMESER_COMPAT_H 1
-_ACEOF
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-for ac_header in net/if_arp.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "net/if_arp.h" "ac_cv_header_net_if_arp_h" "#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 
-"
-if test "x$ac_cv_header_net_if_arp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_IF_ARP_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in net/ppp_defs.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "net/ppp_defs.h" "ac_cv_header_net_ppp_defs_h" "$ac_includes_default"
-if test "x$ac_cv_header_net_ppp_defs_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_PPP_DEFS_H 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
-for ac_header in net/if_ppp.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "net/if_ppp.h" "ac_cv_header_net_if_ppp_h" "#if HAVE_NET_PPP_DEFS_H
-# include <net/ppp_defs.h>
-#endif
 
-"
-if test "x$ac_cv_header_net_if_ppp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_IF_PPP_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-for ac_header in netinet/if_ether.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "netinet/if_ether.h" "ac_cv_header_netinet_if_ether_h" "#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
-#if HAVE_NET_IF_H
-# include <net/if.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
 
-"
-if test "x$ac_cv_header_netinet_if_ether_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IF_ETHER_H 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
-
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_header in netinet/ip_compat.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "netinet/ip_compat.h" "ac_cv_header_netinet_ip_compat_h" "$ac_includes_default"
-if test "x$ac_cv_header_netinet_ip_compat_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NETINET_IP_COMPAT_H 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-have_net_pfvar_h="no"
-for ac_header in net/pfvar.h
-do :
-  ac_fn_c_check_header_compile "$LINENO" "net/pfvar.h" "ac_cv_header_net_pfvar_h" "
-#if HAVE_SYS_IOCTL_H
-# include <sys/ioctl.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
-#if HAVE_NET_IF_H
-# include <net/if.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
 
-"
-if test "x$ac_cv_header_net_pfvar_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NET_PFVAR_H 1
-_ACEOF
- have_net_pfvar_h="yes"
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_net_pfvar_h="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-# For the multimeter plugin
-have_termios_h="no"
-for ac_header in termios.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "termios.h" "ac_cv_header_termios_h" "$ac_includes_default"
-if test "x$ac_cv_header_termios_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_TERMIOS_H 1
-_ACEOF
- have_termios_h="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-# For the turbostat plugin
-have_asm_msrindex_h="no"
-for ac_header in asm/msr-index.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "asm/msr-index.h" "ac_cv_header_asm_msr_index_h" "$ac_includes_default"
-if test "x$ac_cv_header_asm_msr_index_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_ASM_MSR_INDEX_H 1
-_ACEOF
- have_asm_msrindex_h="yes"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
-if test "x$have_asm_msrindex_h" = "xyes"
-then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether asm/msr-index.h has MSR_PKG_C10_RESIDENCY" >&5
-$as_echo_n "checking whether asm/msr-index.h has MSR_PKG_C10_RESIDENCY... " >&6; }
-if ${c_cv_have_usable_asm_msrindex_h+:} false; then :
-  $as_echo_n "(cached) " >&6
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#include<asm/msr-index.h>
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-int y = MSR_PKG_C10_RESIDENCY;
-return(y);
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_usable_asm_msrindex_h="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_have_usable_asm_msrindex_h="no"
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_usable_asm_msrindex_h" >&5
-$as_echo "$c_cv_have_usable_asm_msrindex_h" >&6; }
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-have_cpuid_h="no"
-for ac_header in cpuid.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "cpuid.h" "ac_cv_header_cpuid_h" "$ac_includes_default"
-if test "x$ac_cv_header_cpuid_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_CPUID_H 1
-_ACEOF
- have_cpuid_h="yes"
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
 
 
-for ac_header in sys/capability.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "sys/capability.h" "ac_cv_header_sys_capability_h" "$ac_includes_default"
-if test "x$ac_cv_header_sys_capability_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYS_CAPABILITY_H 1
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
-#
-# Checks for typedefs, structures, and compiler characteristics.
-#
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for an ANSI C-conforming const" >&5
-$as_echo_n "checking for an ANSI C-conforming const... " >&6; }
-if ${ac_cv_c_const+:} false; then :
-  $as_echo_n "(cached) " >&6
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-int
-main ()
-{
 
-#ifndef __cplusplus
-  /* Ultrix mips cc rejects this sort of thing.  */
-  typedef int charset[2];
-  const charset cs = { 0, 0 };
-  /* SunOS 4.1.1 cc rejects this.  */
-  char const *const *pcpcc;
-  char **ppc;
-  /* NEC SVR4.0.2 mips cc rejects this.  */
-  struct point {int x, y;};
-  static struct point const zero = {0,0};
-  /* AIX XL C 1.02.0.0 rejects this.
-     It does not let you subtract one const X* pointer from another in
-     an arm of an if-expression whose if-part is not a constant
-     expression */
-  const char *g = "string";
-  pcpcc = &g + (g ? g-g : 0);
-  /* HPUX 7.0 cc rejects these. */
-  ++pcpcc;
-  ppc = (char**) pcpcc;
-  pcpcc = (char const *const *) ppc;
-  { /* SCO 3.2v4 cc rejects this sort of thing.  */
-    char tx;
-    char *t = &tx;
-    char const *s = 0 ? (char *) 0 : (char const *) 0;
 
-    *t++ = 0;
-    if (s) return 0;
-  }
-  { /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
-    int x[] = {25, 17};
-    const int *foo = &x[0];
-    ++foo;
-  }
-  { /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
-    typedef const int *iptr;
-    iptr p = 0;
-    ++p;
-  }
-  { /* AIX XL C 1.02.0.0 rejects this sort of thing, saying
-       "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
-    struct s { int j; const int *ap[3]; } bx;
-    struct s *b = &bx; b->j = 5;
-  }
-  { /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
-    const int foo = 10;
-    if (!foo) return 0;
-  }
-  return !cs[0] && !zero.x;
-#endif
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_const=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_c_const=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_const" >&5
-$as_echo "$ac_cv_c_const" >&6; }
-if test $ac_cv_c_const = no; then
 
-$as_echo "#define const /**/" >>confdefs.h
 
-fi
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for inline" >&5
-$as_echo_n "checking for inline... " >&6; }
-if ${ac_cv_c_inline+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_cv_c_inline=no
-for ac_kw in inline __inline__ __inline; do
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#ifndef __cplusplus
-typedef int foo_t;
-static $ac_kw foo_t static_foo () {return 0; }
-$ac_kw foo_t foo () {return 0; }
-#endif
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_c_inline=$ac_kw
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  test "$ac_cv_c_inline" != no && break
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_c_inline" >&5
-$as_echo "$ac_cv_c_inline" >&6; }
 
-case $ac_cv_c_inline in
-  inline | yes) ;;
-  *)
-    case $ac_cv_c_inline in
-      no) ac_val=;;
-      *) ac_val=$ac_cv_c_inline;;
-    esac
-    cat >>confdefs.h <<_ACEOF
-#ifndef __cplusplus
-#define inline $ac_val
-#endif
-_ACEOF
-    ;;
-esac
 
-ac_fn_c_check_type "$LINENO" "off_t" "ac_cv_type_off_t" "$ac_includes_default"
-if test "x$ac_cv_type_off_t" = xyes; then :
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-else
 
-cat >>confdefs.h <<_ACEOF
-#define off_t long int
-_ACEOF
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-ac_fn_c_check_type "$LINENO" "pid_t" "ac_cv_type_pid_t" "$ac_includes_default"
-if test "x$ac_cv_type_pid_t" = xyes; then :
 
-else
 
-cat >>confdefs.h <<_ACEOF
-#define pid_t int
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-ac_fn_c_check_type "$LINENO" "size_t" "ac_cv_type_size_t" "$ac_includes_default"
-if test "x$ac_cv_type_size_t" = xyes; then :
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-cat >>confdefs.h <<_ACEOF
-#define size_t unsigned int
-_ACEOF
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-ac_fn_c_check_type "$LINENO" "ssize_t" "ac_cv_type_ssize_t" "$ac_includes_default"
-if test "x$ac_cv_type_ssize_t" = xyes; then :
 
-else
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-cat >>confdefs.h <<_ACEOF
-#define ssize_t int
-_ACEOF
 
-fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for uid_t in sys/types.h" >&5
-$as_echo_n "checking for uid_t in sys/types.h... " >&6; }
-if ${ac_cv_type_uid_t+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "uid_t" >/dev/null 2>&1; then :
-  ac_cv_type_uid_t=yes
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_type_uid_t=no
+  pkg_failed=yes
 fi
-rm -f conftest*
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_type_uid_t" >&5
-$as_echo "$ac_cv_type_uid_t" >&6; }
-if test $ac_cv_type_uid_t = no; then
 
-$as_echo "#define uid_t int" >>confdefs.h
 
 
-$as_echo "#define gid_t int" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-ac_fn_c_find_uintX_t "$LINENO" "32" "ac_cv_c_uint32_t"
-case $ac_cv_c_uint32_t in #(
-  no|yes) ;; #(
-  *)
-
-$as_echo "#define _UINT32_T 1" >>confdefs.h
 
 
-cat >>confdefs.h <<_ACEOF
-#define uint32_t $ac_cv_c_uint32_t
-_ACEOF
-;;
-  esac
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether time.h and sys/time.h may both be included" >&5
-$as_echo_n "checking whether time.h and sys/time.h may both be included... " >&6; }
-if ${ac_cv_header_time+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sys/types.h>
-#include <sys/time.h>
-#include <time.h>
-
-int
-main ()
-{
-if ((struct tm *) 0)
-return 0;
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_header_time=yes
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_header_time=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_time" >&5
-$as_echo "$ac_cv_header_time" >&6; }
-if test $ac_cv_header_time = yes; then
 
-$as_echo "#define TIME_WITH_SYS_TIME 1" >>confdefs.h
 
-fi
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-#
-# Checks for library functions.
-#
-if test $ac_cv_c_compiler_gnu = yes; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC needs -traditional" >&5
-$as_echo_n "checking whether $CC needs -traditional... " >&6; }
-if ${ac_cv_prog_gcc_traditional+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-    ac_pattern="Autoconf.*'x'"
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <sgtty.h>
-Autoconf TIOCGETP
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "$ac_pattern" >/dev/null 2>&1; then :
-  ac_cv_prog_gcc_traditional=yes
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  ac_cv_prog_gcc_traditional=no
+        _pkg_short_errors_supported=no
 fi
-rm -f conftest*
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  if test $ac_cv_prog_gcc_traditional = no; then
-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-#include <termio.h>
-Autoconf TCGETA
-_ACEOF
-if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
-  $EGREP "$ac_pattern" >/dev/null 2>&1; then :
-  ac_cv_prog_gcc_traditional=yes
-fi
-rm -f conftest*
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  fi
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_gcc_traditional" >&5
-$as_echo "$ac_cv_prog_gcc_traditional" >&6; }
-  if test $ac_cv_prog_gcc_traditional = yes; then
-    CC="$CC -traditional"
-  fi
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-for ac_func in gettimeofday select strdup strtol getaddrinfo getnameinfo strchr memcpy strstr strcmp strncmp strncpy strlen strncasecmp strcasecmp openlog closelog sysconf setenv if_indextoname setlocale
-do :
-  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
 
-fi
-done
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-ac_fn_c_check_decl "$LINENO" "strerror_r" "ac_cv_have_decl_strerror_r" "$ac_includes_default"
-if test "x$ac_cv_have_decl_strerror_r" = xyes; then :
-  ac_have_decl=1
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_have_decl=0
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_DECL_STRERROR_R $ac_have_decl
-_ACEOF
 
-for ac_func in strerror_r
-do :
-  ac_fn_c_check_func "$LINENO" "strerror_r" "ac_cv_func_strerror_r"
-if test "x$ac_cv_func_strerror_r" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_STRERROR_R 1
-_ACEOF
 
-fi
-done
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strerror_r returns char *" >&5
-$as_echo_n "checking whether strerror_r returns char *... " >&6; }
-if ${ac_cv_func_strerror_r_char_p+:} false; then :
-  $as_echo_n "(cached) " >&6
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-    ac_cv_func_strerror_r_char_p=no
-    if test $ac_cv_have_decl_strerror_r = yes; then
-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-int
-main ()
-{
+	with_liblua="no (pkg-config cannot find liblua)"
 
-	  char buf[100];
-	  char x = *strerror_r (0, buf, sizeof buf);
-	  char *p = strerror_r (0, buf, sizeof buf);
-	  return !p || x;
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  ac_cv_func_strerror_r_char_p=yes
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-    else
-      # strerror_r is not declared.  Choose between
-      # systems that have relatively inaccessible declarations for the
-      # function.  BeOS and DEC UNIX 4.0 fall in this category, but the
-      # former has a strerror_r that returns char*, while the latter
-      # has a strerror_r that returns `int'.
-      # This test should segfault on the DEC system.
-      if test "$cross_compiling" = yes; then :
-  :
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-$ac_includes_default
-	extern char *strerror_r ();
-int
-main ()
-{
-char buf[100];
-	  char x = *strerror_r (0, buf, sizeof buf);
-	  return ! isalpha (x);
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  ac_cv_func_strerror_r_char_p=yes
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-    fi
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_func_strerror_r_char_p" >&5
-$as_echo "$ac_cv_func_strerror_r_char_p" >&6; }
-if test $ac_cv_func_strerror_r_char_p = yes; then
 
-$as_echo "#define STRERROR_R_CHAR_P 1" >>confdefs.h
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-SAVE_CFLAGS="$CFLAGS"
-# Emulate behavior of src/Makefile.am
-if test "x$GCC" = "xyes"
-then
-	CFLAGS="$CFLAGS -Wall -Werror"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for strtok_r" >&5
-$as_echo_n "checking for strtok_r... " >&6; }
-if ${c_cv_have_strtok_r_default+:} false; then :
-  $as_echo_n "(cached) " >&6
+
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-      char buffer[] = "foo,bar,baz";
-      char *token;
-      char *dummy;
-      char *saveptr;
 
-      dummy = buffer;
-      saveptr = NULL;
-      while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
-      {
-        dummy = NULL;
-        printf ("token = %s;\n", token);
-      }
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  c_cv_have_strtok_r_default="yes"
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_strtok_r_default="no"
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strtok_r_default" >&5
-$as_echo "$c_cv_have_strtok_r_default" >&6; }
 
-if test "x$c_cv_have_strtok_r_default" = "xno"
-then
-  CFLAGS="$CFLAGS -D_REENTRANT=1"
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if strtok_r needs _REENTRANT" >&5
-$as_echo_n "checking if strtok_r needs _REENTRANT... " >&6; }
-if ${c_cv_have_strtok_r_reentrant+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-int
-main ()
-{
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-        char buffer[] = "foo,bar,baz";
-        char *token;
-        char *dummy;
-        char *saveptr;
 
-        dummy = buffer;
-        saveptr = NULL;
-        while ((token = strtok_r (dummy, ",", &saveptr)) != NULL)
-        {
-          dummy = NULL;
-          printf ("token = %s;\n", token);
-        }
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  c_cv_have_strtok_r_reentrant="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "strtok_r isn't available. Please file a bugreport!
-See \`config.log' for more details" "$LINENO" 5; }
-
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strtok_r_reentrant" >&5
-$as_echo "$c_cv_have_strtok_r_reentrant" >&6; }
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-
-CFLAGS="$SAVE_CFLAGS"
-if test "x$c_cv_have_strtok_r_reentrant" = "xyes"
-then
-	CFLAGS="$CFLAGS -D_REENTRANT=1"
+ else
+    pkg_failed=untried
 fi
 
-for ac_func in getpwnam_r getgrnam_r setgroups regcomp regerror regexec regfree
-do :
-  as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
-ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
-if eval test \"x\$"$as_ac_var"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_func" | $as_tr_cpp` 1
-_ACEOF
 
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-socket_needs_socket="no"
-for ac_func in socket
-do :
-  ac_fn_c_check_func "$LINENO" "socket" "ac_cv_func_socket"
-if test "x$ac_cv_func_socket" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SOCKET 1
-_ACEOF
 
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for socket in -lsocket" >&5
-$as_echo_n "checking for socket in -lsocket... " >&6; }
-if ${ac_cv_lib_socket_socket+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lsocket  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char socket ();
-int
-main ()
-{
-return socket ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_socket_socket=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_socket_socket=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_socket" >&5
-$as_echo "$ac_cv_lib_socket_socket" >&6; }
-if test "x$ac_cv_lib_socket_socket" = xyes; then :
-  socket_needs_socket="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  as_fn_error $? "cannot find socket" "$LINENO" 5
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
-done
 
- if test "x$socket_needs_socket" = "xyes"; then
-  BUILD_WITH_LIBSOCKET_TRUE=
-  BUILD_WITH_LIBSOCKET_FALSE='#'
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBSOCKET_TRUE='#'
-  BUILD_WITH_LIBSOCKET_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-clock_gettime_needs_rt="no"
-clock_gettime_needs_posix4="no"
-have_clock_gettime="no"
-for ac_func in clock_gettime
-do :
-  ac_fn_c_check_func "$LINENO" "clock_gettime" "ac_cv_func_clock_gettime"
-if test "x$ac_cv_func_clock_gettime" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_CLOCK_GETTIME 1
-_ACEOF
- have_clock_gettime="yes"
-fi
-done
 
-if test "x$have_clock_gettime" = "xno"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for clock_gettime in -lrt" >&5
-$as_echo_n "checking for clock_gettime in -lrt... " >&6; }
-if ${ac_cv_lib_rt_clock_gettime+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lrt  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char clock_gettime ();
-int
-main ()
-{
-return clock_gettime ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_rt_clock_gettime=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_rt_clock_gettime=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_clock_gettime" >&5
-$as_echo "$ac_cv_lib_rt_clock_gettime" >&6; }
-if test "x$ac_cv_lib_rt_clock_gettime" = xyes; then :
-  clock_gettime_needs_rt="yes"
-					 have_clock_gettime="yes"
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
-if test "x$have_clock_gettime" = "xno"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for clock_gettime in -lposix4" >&5
-$as_echo_n "checking for clock_gettime in -lposix4... " >&6; }
-if ${ac_cv_lib_posix4_clock_gettime+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lposix4  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char clock_gettime ();
-int
-main ()
-{
-return clock_gettime ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_posix4_clock_gettime=yes
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_posix4_clock_gettime=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_posix4_clock_gettime" >&5
-$as_echo "$ac_cv_lib_posix4_clock_gettime" >&6; }
-if test "x$ac_cv_lib_posix4_clock_gettime" = xyes; then :
-  clock_gettime_needs_posix4="yes"
-					     have_clock_gettime="yes"
+ else
+    pkg_failed=untried
 fi
 
-fi
-if test "x$have_clock_gettime" = "xyes"
-then
 
-$as_echo "#define HAVE_CLOCK_GETTIME 1" >>confdefs.h
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: cannot find clock_gettime" >&5
-$as_echo "$as_me: WARNING: cannot find clock_gettime" >&2;}
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-nanosleep_needs_rt="no"
-nanosleep_needs_posix4="no"
-for ac_func in nanosleep
-do :
-  ac_fn_c_check_func "$LINENO" "nanosleep" "ac_cv_func_nanosleep"
-if test "x$ac_cv_func_nanosleep" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_NANOSLEEP 1
-_ACEOF
 
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nanosleep in -lrt" >&5
-$as_echo_n "checking for nanosleep in -lrt... " >&6; }
-if ${ac_cv_lib_rt_nanosleep+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lrt  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char nanosleep ();
-int
-main ()
-{
-return nanosleep ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_rt_nanosleep=yes
-else
-  ac_cv_lib_rt_nanosleep=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_rt_nanosleep" >&5
-$as_echo "$ac_cv_lib_rt_nanosleep" >&6; }
-if test "x$ac_cv_lib_rt_nanosleep" = xyes; then :
-  nanosleep_needs_rt="yes"
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for nanosleep in -lposix4" >&5
-$as_echo_n "checking for nanosleep in -lposix4... " >&6; }
-if ${ac_cv_lib_posix4_nanosleep+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lposix4  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char nanosleep ();
-int
-main ()
-{
-return nanosleep ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_posix4_nanosleep=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_posix4_nanosleep=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_posix4_nanosleep" >&5
-$as_echo "$ac_cv_lib_posix4_nanosleep" >&6; }
-if test "x$ac_cv_lib_posix4_nanosleep" = xyes; then :
-  nanosleep_needs_posix4="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  as_fn_error $? "cannot find nanosleep" "$LINENO" 5
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
 
-fi
-done
 
 
- if test "x$clock_gettime_needs_rt" = "xyes" || test "x$nanosleep_needs_rt" = "xyes"; then
-  BUILD_WITH_LIBRT_TRUE=
-  BUILD_WITH_LIBRT_FALSE='#'
-else
-  BUILD_WITH_LIBRT_TRUE='#'
-  BUILD_WITH_LIBRT_FALSE=
-fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
- if test "x$clock_gettime_needs_posix4" = "xyes" || test "x$nanosleep_needs_posix4" = "xyes"; then
-  BUILD_WITH_LIBPOSIX4_TRUE=
-  BUILD_WITH_LIBPOSIX4_FALSE='#'
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBPOSIX4_TRUE='#'
-  BUILD_WITH_LIBPOSIX4_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_func in sysctl
-do :
-  ac_fn_c_check_func "$LINENO" "sysctl" "ac_cv_func_sysctl"
-if test "x$ac_cv_func_sysctl" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYSCTL 1
-_ACEOF
- have_sysctl="yes"
-else
-  have_sysctl="no"
-fi
-done
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_func in sysctlbyname
-do :
-  ac_fn_c_check_func "$LINENO" "sysctlbyname" "ac_cv_func_sysctlbyname"
-if test "x$ac_cv_func_sysctlbyname" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYSCTLBYNAME 1
-_ACEOF
- have_sysctlbyname="yes"
 else
-  have_sysctlbyname="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-done
 
-for ac_func in host_statistics
-do :
-  ac_fn_c_check_func "$LINENO" "host_statistics" "ac_cv_func_host_statistics"
-if test "x$ac_cv_func_host_statistics" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_HOST_STATISTICS 1
-_ACEOF
- have_host_statistics="yes"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_host_statistics="no"
+  pkg_failed=yes
 fi
-done
-
-for ac_func in processor_info
-do :
-  ac_fn_c_check_func "$LINENO" "processor_info" "ac_cv_func_processor_info"
-if test "x$ac_cv_func_processor_info" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_PROCESSOR_INFO 1
-_ACEOF
- have_processor_info="yes"
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_processor_info="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-done
 
-for ac_func in thread_info
-do :
-  ac_fn_c_check_func "$LINENO" "thread_info" "ac_cv_func_thread_info"
-if test "x$ac_cv_func_thread_info" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_THREAD_INFO 1
-_ACEOF
- have_thread_info="yes"
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  have_thread_info="no"
+        _pkg_short_errors_supported=no
 fi
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-for ac_func in statfs
-do :
-  ac_fn_c_check_func "$LINENO" "statfs" "ac_cv_func_statfs"
-if test "x$ac_cv_func_statfs" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_STATFS 1
-_ACEOF
- have_statfs="yes"
 else
-  have_statfs="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-done
 
-for ac_func in statvfs
-do :
-  ac_fn_c_check_func "$LINENO" "statvfs" "ac_cv_func_statvfs"
-if test "x$ac_cv_func_statvfs" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_STATVFS 1
-_ACEOF
- have_statvfs="yes"
+
 else
-  have_statvfs="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-done
 
-for ac_func in getifaddrs
-do :
-  ac_fn_c_check_func "$LINENO" "getifaddrs" "ac_cv_func_getifaddrs"
-if test "x$ac_cv_func_getifaddrs" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETIFADDRS 1
-_ACEOF
- have_getifaddrs="yes"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_getifaddrs="no"
+  pkg_failed=yes
 fi
-done
-
-for ac_func in getloadavg
-do :
-  ac_fn_c_check_func "$LINENO" "getloadavg" "ac_cv_func_getloadavg"
-if test "x$ac_cv_func_getloadavg" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETLOADAVG 1
-_ACEOF
- have_getloadavg="yes"
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_getloadavg="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-done
 
-for ac_func in syslog
-do :
-  ac_fn_c_check_func "$LINENO" "syslog" "ac_cv_func_syslog"
-if test "x$ac_cv_func_syslog" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SYSLOG 1
-_ACEOF
- have_syslog="yes"
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  have_syslog="no"
+        _pkg_short_errors_supported=no
 fi
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-for ac_func in getutent
-do :
-  ac_fn_c_check_func "$LINENO" "getutent" "ac_cv_func_getutent"
-if test "x$ac_cv_func_getutent" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETUTENT 1
-_ACEOF
- have_getutent="yes"
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_getutent="no"
+  pkg_failed=yes
 fi
-done
-
-for ac_func in getutxent
-do :
-  ac_fn_c_check_func "$LINENO" "getutxent" "ac_cv_func_getutxent"
-if test "x$ac_cv_func_getutxent" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETUTXENT 1
-_ACEOF
- have_getutxent="yes"
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  have_getutxent="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-done
 
 
-# Check for strptime {{{
-if test "x$GCC" = "xyes"
-then
-	SAVE_CFLAGS="$CFLAGS"
-	CFLAGS="$CFLAGS -Wall -Wextra -Werror"
-fi
 
-for ac_func in strptime
-do :
-  ac_fn_c_check_func "$LINENO" "strptime" "ac_cv_func_strptime"
-if test "x$ac_cv_func_strptime" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_STRPTIME 1
-_ACEOF
- have_strptime="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  have_strptime="no"
+        _pkg_short_errors_supported=no
 fi
-done
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-if test "x$have_strptime" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strptime is exported by default" >&5
-$as_echo_n "checking whether strptime is exported by default... " >&6; }
-if ${c_cv_have_strptime_default+:} false; then :
-  $as_echo_n "(cached) " >&6
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#include <time.h>
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
- struct tm stm;
- (void) strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_strptime_default="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_have_strptime_default="no"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strptime_default" >&5
-$as_echo "$c_cv_have_strptime_default" >&6; }
+ else
+    pkg_failed=untried
 fi
-if test "x$have_strptime" = "xyes" && test "x$c_cv_have_strptime_default" = "xno"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether strptime needs standards mode" >&5
-$as_echo_n "checking whether strptime needs standards mode... " >&6; }
-if ${c_cv_have_strptime_standards+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#ifndef _ISOC99_SOURCE
-# define _ISOC99_SOURCE 1
-#endif
-#ifndef _POSIX_C_SOURCE
-# define _POSIX_C_SOURCE 200112L
-#endif
-#ifndef _XOPEN_SOURCE
-# define _XOPEN_SOURCE 500
-#endif
-#include <time.h>
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-int
-main ()
-{
 
- struct tm stm;
- (void) strptime ("2010-12-30%13:42:42", "%Y-%m-%dT%T", &stm);
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_strptime_standards="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_strptime_standards="no"
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+        _pkg_short_errors_supported=no
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_strptime_standards" >&5
-$as_echo "$c_cv_have_strptime_standards" >&6; }
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-	if test "x$c_cv_have_strptime_standards" = "xyes"
-	then
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define STRPTIME_NEEDS_STANDARDS 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-	else
-		have_strptime="no"
-	fi
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$GCC" = "xyes"
-then
-	CFLAGS="$SAVE_CFLAGS"
-fi
-# }}} Check for strptime
 
-for ac_func in swapctl
-do :
-  ac_fn_c_check_func "$LINENO" "swapctl" "ac_cv_func_swapctl"
-if test "x$ac_cv_func_swapctl" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_SWAPCTL 1
-_ACEOF
- have_swapctl="yes"
 else
-  have_swapctl="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-done
 
-if test "x$have_swapctl" = "xyes"; then
-        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether swapctl takes two arguments" >&5
-$as_echo_n "checking whether swapctl takes two arguments... " >&6; }
-if ${c_cv_have_swapctl_two_args+:} false; then :
-  $as_echo_n "(cached) " >&6
+
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
-#  undef _FILE_OFFSET_BITS
-#  undef _LARGEFILE64_SOURCE
-#endif
-#include <sys/stat.h>
-#include <sys/param.h>
-#include <sys/swap.h>
-#include <unistd.h>
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-int num = swapctl(0, NULL);
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_swapctl_two_args="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_have_swapctl_two_args="no"
-
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_swapctl_two_args" >&5
-$as_echo "$c_cv_have_swapctl_two_args" >&6; }
-        { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether swapctl takes three arguments" >&5
-$as_echo_n "checking whether swapctl takes three arguments... " >&6; }
-if ${c_cv_have_swapctl_three_args+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#if HAVE_SYS_SWAP_H && !defined(_LP64) && _FILE_OFFSET_BITS == 64
-#  undef _FILE_OFFSET_BITS
-#  undef _LARGEFILE64_SOURCE
-#endif
-#include <sys/stat.h>
-#include <sys/param.h>
-#include <sys/swap.h>
-#include <unistd.h>
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-int
-main ()
-{
 
-int num = swapctl(0, NULL, 0);
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_swapctl_three_args="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_swapctl_three_args="no"
-
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_swapctl_three_args" >&5
-$as_echo "$c_cv_have_swapctl_three_args" >&6; }
+        _pkg_short_errors_supported=no
 fi
-# Check for different versions of `swapctl' here..
-if test "x$have_swapctl" = "xyes"; then
-        if test "x$c_cv_have_swapctl_two_args" = "xyes"; then
-
-$as_echo "#define HAVE_SWAPCTL_TWO_ARGS 1" >>confdefs.h
-
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
         fi
-        if test "x$c_cv_have_swapctl_three_args" = "xyes"; then
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-$as_echo "#define HAVE_SWAPCTL_THREE_ARGS 1" >>confdefs.h
 
-        fi
-fi
 
-# Check for NAN
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-# Check whether --with-nan-emulation was given.
-if test "${with_nan_emulation+set}" = set; then :
-  withval=$with_nan_emulation;
- if test "x$withval" = "xno"; then
-	 nan_type="none"
- else if test "x$withval" = "xyes"; then
-	 nan_type="zero"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
  else
-	 nan_type="$withval"
- fi; fi
-
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  nan_type="none"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-if test "x$nan_type" = "xnone"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN is defined by default" >&5
-$as_echo_n "checking whether NAN is defined by default... " >&6; }
-if ${c_cv_have_nan_default+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-#include <stdlib.h>
-#include <math.h>
-static double foo = NAN;
 
-int
-main ()
-{
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-       if (isnan (foo))
-        return 0;
-       else
-	return 1;
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_nan_default="yes"
-else
-  c_cv_have_nan_default="no"
 
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_default" >&5
-$as_echo "$c_cv_have_nan_default" >&6; }
-  if test "x$c_cv_have_nan_default" = "xyes"
-  then
-    nan_type="default"
-  fi
+ else
+    pkg_failed=untried
 fi
-if test "x$nan_type" = "xnone"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN is defined by __USE_ISOC99" >&5
-$as_echo_n "checking whether NAN is defined by __USE_ISOC99... " >&6; }
-if ${c_cv_have_nan_isoc+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <stdlib.h>
-#define __USE_ISOC99 1
-#include <math.h>
-static double foo = NAN;
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-int
-main ()
-{
 
-       if (isnan (foo))
-        return 0;
-       else
-	return 1;
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_nan_isoc="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_nan_isoc="no"
-
+        _pkg_short_errors_supported=no
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_isoc" >&5
-$as_echo "$c_cv_have_nan_isoc" >&6; }
-  if test "x$c_cv_have_nan_isoc" = "xyes"
-  then
-    nan_type="isoc99"
-  fi
-fi
-if test "x$nan_type" = "xnone"; then
-  SAVE_LDFLAGS=$LDFLAGS
-  LDFLAGS="$LDFLAGS -lm"
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NAN can be defined by 0/0" >&5
-$as_echo_n "checking whether NAN can be defined by 0/0... " >&6; }
-if ${c_cv_have_nan_zero+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then :
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run test program while cross compiling
-See \`config.log' for more details" "$LINENO" 5; }
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#include <stdlib.h>
-#include <math.h>
-#ifdef NAN
-# undef NAN
-#endif
-#define NAN (0.0 / 0.0)
-#ifndef isnan
-# define isnan(f) ((f) != (f))
-#endif
-static double foo = NAN;
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-       if (isnan (foo))
-        return 0;
-       else
-	return 1;
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  c_cv_have_nan_zero="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_have_nan_zero="no"
-
+  pkg_failed=yes
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
+ else
+    pkg_failed=untried
 fi
-
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_nan_zero" >&5
-$as_echo "$c_cv_have_nan_zero" >&6; }
-  LDFLAGS=$SAVE_LDFLAGS
-  if test "x$c_cv_have_nan_zero" = "xyes"
-  then
-    nan_type="zero"
-  fi
+ else
+    pkg_failed=untried
 fi
 
-if test "x$nan_type" = "xdefault"; then
 
-$as_echo "#define NAN_STATIC_DEFAULT 1" >>confdefs.h
 
-else if test "x$nan_type" = "xisoc99"; then
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-$as_echo "#define NAN_STATIC_ISOC 1" >>confdefs.h
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-else if test "x$nan_type" = "xzero"; then
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define NAN_ZERO_ZERO 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-  as_fn_error $? "Didn't find out how to statically initialize variables to NAN. Sorry." "$LINENO" 5
-fi; fi; fi
-
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-# Check whether --with-fp-layout was given.
-if test "${with_fp_layout+set}" = set; then :
-  withval=$with_fp_layout;
- if test "x$withval" = "xnothing"; then
- 	fp_layout_type="nothing"
- else if test "x$withval" = "xendianflip"; then
- 	fp_layout_type="endianflip"
- else if test "x$withval" = "xintswap"; then
- 	fp_layout_type="intswap"
- else
- 	as_fn_error $? "Invalid argument for --with-fp-layout. Valid arguments are: nothing, endianflip, intswap" "$LINENO" 5;
-fi; fi; fi
 
 else
-  fp_layout_type="unknown"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-if test "x$fp_layout_type" = "xunknown"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if doubles are stored in x86 representation" >&5
-$as_echo_n "checking if doubles are stored in x86 representation... " >&6; }
-if ${c_cv_fp_layout_need_nothing+:} false; then :
-  $as_echo_n "(cached) " >&6
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  if test "$cross_compiling" = yes; then :
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run test program while cross compiling
-See \`config.log' for more details" "$LINENO" 5; }
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_INTTYPES_H
-# include <inttypes.h>
-#endif
-#if HAVE_STDBOOL_H
-# include <stdbool.h>
-#endif
 
-int
-main ()
-{
 
-	uint64_t i0;
-	uint64_t i1;
-	uint8_t c[8];
-	double d;
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	d = 8.642135e130;
-	memcpy ((void *) &i0, (void *) &d, 8);
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-	i1 = i0;
-	memcpy ((void *) c, (void *) &i1, 8);
 
-	if ((c[0] == 0x2f) && (c[1] == 0x25)
-			&& (c[2] == 0xc0) && (c[3] == 0xc7)
-			&& (c[4] == 0x43) && (c[5] == 0x2b)
-			&& (c[6] == 0x1f) && (c[7] == 0x5b))
-		return (0);
-	else
-		return (1);
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  c_cv_fp_layout_need_nothing="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_fp_layout_need_nothing="no"
-
+  pkg_failed=yes
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
+ else
+    pkg_failed=untried
 fi
-
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_nothing" >&5
-$as_echo "$c_cv_fp_layout_need_nothing" >&6; }
-  if test "x$c_cv_fp_layout_need_nothing" = "xyes"; then
-    fp_layout_type="nothing"
-  fi
+ else
+    pkg_failed=untried
 fi
-if test "x$fp_layout_type" = "xunknown"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if endianflip converts to x86 representation" >&5
-$as_echo_n "checking if endianflip converts to x86 representation... " >&6; }
-if ${c_cv_fp_layout_need_endianflip+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then :
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run test program while cross compiling
-See \`config.log' for more details" "$LINENO" 5; }
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_INTTYPES_H
-# include <inttypes.h>
-#endif
-#if HAVE_STDBOOL_H
-# include <stdbool.h>
-#endif
-#define endianflip(A) ((((uint64_t)(A) & 0xff00000000000000LL) >> 56) | \
-                       (((uint64_t)(A) & 0x00ff000000000000LL) >> 40) | \
-                       (((uint64_t)(A) & 0x0000ff0000000000LL) >> 24) | \
-                       (((uint64_t)(A) & 0x000000ff00000000LL) >> 8)  | \
-                       (((uint64_t)(A) & 0x00000000ff000000LL) << 8)  | \
-                       (((uint64_t)(A) & 0x0000000000ff0000LL) << 24) | \
-                       (((uint64_t)(A) & 0x000000000000ff00LL) << 40) | \
-                       (((uint64_t)(A) & 0x00000000000000ffLL) << 56))
-
-int
-main ()
-{
 
-	uint64_t i0;
-	uint64_t i1;
-	uint8_t c[8];
-	double d;
 
-	d = 8.642135e130;
-	memcpy ((void *) &i0, (void *) &d, 8);
 
-	i1 = endianflip (i0);
-	memcpy ((void *) c, (void *) &i1, 8);
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	if ((c[0] == 0x2f) && (c[1] == 0x25)
-			&& (c[2] == 0xc0) && (c[3] == 0xc7)
-			&& (c[4] == 0x43) && (c[5] == 0x2b)
-			&& (c[6] == 0x1f) && (c[7] == 0x5b))
-		return (0);
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
 	else
-		return (1);
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  c_cv_fp_layout_need_endianflip="yes"
-else
-  c_cv_fp_layout_need_endianflip="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
 
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_endianflip" >&5
-$as_echo "$c_cv_fp_layout_need_endianflip" >&6; }
-  if test "x$c_cv_fp_layout_need_endianflip" = "xyes"; then
-    fp_layout_type="endianflip"
-  fi
+ else
+    pkg_failed=untried
 fi
-if test "x$fp_layout_type" = "xunknown"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if intswap converts to x86 representation" >&5
-$as_echo_n "checking if intswap converts to x86 representation... " >&6; }
-if ${c_cv_fp_layout_need_intswap+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "$cross_compiling" = yes; then :
-  { { $as_echo "$as_me:${as_lineno-$LINENO}: error: in \`$ac_pwd':" >&5
-$as_echo "$as_me: error: in \`$ac_pwd':" >&2;}
-as_fn_error $? "cannot run test program while cross compiling
-See \`config.log' for more details" "$LINENO" 5; }
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_INTTYPES_H
-# include <inttypes.h>
-#endif
-#if HAVE_STDBOOL_H
-# include <stdbool.h>
-#endif
-#define intswap(A)    ((((uint64_t)(A) & 0xffffffff00000000LL) >> 32) | \
-                       (((uint64_t)(A) & 0x00000000ffffffffLL) << 32))
-
-int
-main ()
-{
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-	uint64_t i0;
-	uint64_t i1;
-	uint8_t c[8];
-	double d;
 
-	d = 8.642135e130;
-	memcpy ((void *) &i0, (void *) &d, 8);
 
-	i1 = intswap (i0);
-	memcpy ((void *) c, (void *) &i1, 8);
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	if ((c[0] == 0x2f) && (c[1] == 0x25)
-			&& (c[2] == 0xc0) && (c[3] == 0xc7)
-			&& (c[4] == 0x43) && (c[5] == 0x2b)
-			&& (c[6] == 0x1f) && (c[7] == 0x5b))
-		return (0);
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
 	else
-		return (1);
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-  c_cv_fp_layout_need_intswap="yes"
-else
-  c_cv_fp_layout_need_intswap="no"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_fp_layout_need_intswap" >&5
-$as_echo "$c_cv_fp_layout_need_intswap" >&6; }
-  if test "x$c_cv_fp_layout_need_intswap" = "xyes"; then
-    fp_layout_type="intswap"
-  fi
+
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$fp_layout_type" = "xnothing"; then
 
-$as_echo "#define FP_LAYOUT_NEED_NOTHING 1" >>confdefs.h
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-else if test "x$fp_layout_type" = "xendianflip"; then
 
-$as_echo "#define FP_LAYOUT_NEED_ENDIANFLIP 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-else if test "x$fp_layout_type" = "xintswap"; then
 
-$as_echo "#define FP_LAYOUT_NEED_INTSWAP 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  as_fn_error $? "Didn't find out how doubles are stored in memory. Sorry." "$LINENO" 5
-fi; fi; fi
-
-# --with-useragent {{{
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-# Check whether --with-useragent was given.
-if test "${with_useragent+set}" = set; then :
-  withval=$with_useragent;
-    if test "x$withval" != "xno" && test "x$withval" != "xyes"
-    then
 
-cat >>confdefs.h <<_ACEOF
-#define COLLECTD_USERAGENT "$withval"
-_ACEOF
 
-    fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-# }}}
 
-have_getfsstat="no"
-for ac_func in getfsstat
-do :
-  ac_fn_c_check_func "$LINENO" "getfsstat" "ac_cv_func_getfsstat"
-if test "x$ac_cv_func_getfsstat" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETFSSTAT 1
-_ACEOF
- have_getfsstat="yes"
-fi
-done
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-have_getvfsstat="no"
-for ac_func in getvfsstat
-do :
-  ac_fn_c_check_func "$LINENO" "getvfsstat" "ac_cv_func_getvfsstat"
-if test "x$ac_cv_func_getvfsstat" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETVFSSTAT 1
-_ACEOF
- have_getvfsstat="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-done
-
-have_listmntent="no"
-for ac_func in listmntent
-do :
-  ac_fn_c_check_func "$LINENO" "listmntent" "ac_cv_func_listmntent"
-if test "x$ac_cv_func_listmntent" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LISTMNTENT 1
-_ACEOF
- have_listmntent="yes"
+ else
+    pkg_failed=untried
 fi
-done
-
-have_getmntent_r="no"
-for ac_func in getmntent_r
-do :
-  ac_fn_c_check_func "$LINENO" "getmntent_r" "ac_cv_func_getmntent_r"
-if test "x$ac_cv_func_getmntent_r" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETMNTENT_R 1
-_ACEOF
- have_getmntent_r="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-done
 
 
-have_getmntent="no"
-for ac_func in getmntent
-do :
-  ac_fn_c_check_func "$LINENO" "getmntent" "ac_cv_func_getmntent"
-if test "x$ac_cv_func_getmntent" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GETMNTENT 1
-_ACEOF
- have_getmntent="c"
-fi
-done
 
-if test "x$have_getmntent" = "xno"; then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lsun" >&5
-$as_echo_n "checking for getmntent in -lsun... " >&6; }
-if ${ac_cv_lib_sun_getmntent+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lsun  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char getmntent ();
-int
-main ()
-{
-return getmntent ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_sun_getmntent=yes
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  ac_cv_lib_sun_getmntent=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sun_getmntent" >&5
-$as_echo "$ac_cv_lib_sun_getmntent" >&6; }
-if test "x$ac_cv_lib_sun_getmntent" = xyes; then :
-  have_getmntent="sun"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-fi
-if test "x$have_getmntent" = "xno"; then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lseq" >&5
-$as_echo_n "checking for getmntent in -lseq... " >&6; }
-if ${ac_cv_lib_seq_getmntent+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lseq  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char getmntent ();
-int
-main ()
-{
-return getmntent ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_seq_getmntent=yes
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_seq_getmntent=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_seq_getmntent" >&5
-$as_echo "$ac_cv_lib_seq_getmntent" >&6; }
-if test "x$ac_cv_lib_seq_getmntent" = xyes; then :
-  have_getmntent="seq"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
-if test "x$have_getmntent" = "xno"; then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for getmntent in -lgen" >&5
-$as_echo_n "checking for getmntent in -lgen... " >&6; }
-if ${ac_cv_lib_gen_getmntent+:} false; then :
-  $as_echo_n "(cached) " >&6
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lgen  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char getmntent ();
-int
-main ()
-{
-return getmntent ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_gen_getmntent=yes
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_gen_getmntent=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gen_getmntent" >&5
-$as_echo "$ac_cv_lib_gen_getmntent" >&6; }
-if test "x$ac_cv_lib_gen_getmntent" = xyes; then :
-  have_getmntent="gen"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-if test "x$have_getmntent" = "xc"; then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether getmntent takes one argument" >&5
-$as_echo_n "checking whether getmntent takes one argument... " >&6; }
-if ${c_cv_have_one_getmntent+:} false; then :
-  $as_echo_n "(cached) " >&6
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-#include "$srcdir/src/utils_mount.h"
 
-int
-main ()
-{
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-FILE *fh;
-struct mntent *me;
-fh = setmntent ("/etc/mtab", "r");
-me = getmntent (fh);
-return(me->mnt_passno);
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_one_getmntent="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  c_cv_have_one_getmntent="no"
-
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_one_getmntent" >&5
-$as_echo "$c_cv_have_one_getmntent" >&6; }
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether getmntent takes two arguments" >&5
-$as_echo_n "checking whether getmntent takes two arguments... " >&6; }
-if ${c_cv_have_two_getmntent+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include "$srcdir/src/utils_mount.h"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-int
-main ()
-{
 
-				 FILE *fh;
-				 struct mnttab mt;
-				 int status;
-				 fh = fopen ("/etc/mnttab", "r");
-				 status = getmntent (fh, &mt);
-				 return(status);
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  c_cv_have_two_getmntent="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_two_getmntent="no"
-
+        _pkg_short_errors_supported=no
 fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_two_getmntent" >&5
-$as_echo "$c_cv_have_two_getmntent" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
+
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-# Check for different versions of `getmntent' here..
 
-if test "x$have_getmntent" = "xc"; then
-	if test "x$c_cv_have_one_getmntent" = "xyes"; then
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-$as_echo "#define HAVE_ONE_GETMNTENT 1" >>confdefs.h
 
-	fi
-	if test "x$c_cv_have_two_getmntent" = "xyes"; then
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-$as_echo "#define HAVE_TWO_GETMNTENT 1" >>confdefs.h
 
-	fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-if test "x$have_getmntent" = "xsun"; then
 
-$as_echo "#define HAVE_SUN_GETMNTENT 1" >>confdefs.h
 
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-if test "x$have_getmntent" = "xseq"; then
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-$as_echo "#define HAVE_SEQ_GETMNTENT 1" >>confdefs.h
 
-fi
-if test "x$have_getmntent" = "xgen"; then
 
-$as_echo "#define HAVE_GEN_GETMNTENT 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-
-# Check for htonll
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking if have htonll defined" >&5
-$as_echo_n "checking if have htonll defined... " >&6; }
-if ${c_cv_have_htonll+:} false; then :
-  $as_echo_n "(cached) " >&6
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <sys/types.h>
-#include <netinet/in.h>
-#if HAVE_INTTYPES_H
-# include <inttypes.h>
-#endif
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-int
-main ()
-{
 
-          return htonll(0);
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  c_cv_have_htonll="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  c_cv_have_htonll="no"
-
+        _pkg_short_errors_supported=no
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $c_cv_have_htonll" >&5
-$as_echo "$c_cv_have_htonll" >&6; }
-if test "x$c_cv_have_htonll" = "xyes"
-then
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define HAVE_HTONLL 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-# Check for structures
-ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_ibytes" "ac_cv_member_struct_if_data_ifi_ibytes" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <net/if.h>
-
-"
-if test "x$ac_cv_member_struct_if_data_ifi_ibytes" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IF_DATA_IFI_IBYTES 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_opackets" "ac_cv_member_struct_if_data_ifi_opackets" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <net/if.h>
-
-"
-if test "x$ac_cv_member_struct_if_data_ifi_opackets" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IF_DATA_IFI_OPACKETS 1
-_ACEOF
 
 
-$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-ac_fn_c_check_member "$LINENO" "struct if_data" "ifi_ierrors" "ac_cv_member_struct_if_data_ifi_ierrors" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <net/if.h>
-
-"
-if test "x$ac_cv_member_struct_if_data_ifi_ierrors" = xyes; then :
-
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IF_DATA_IFI_IERRORS 1
-_ACEOF
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define HAVE_STRUCT_IF_DATA 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-ac_fn_c_check_member "$LINENO" "struct net_device_stats" "rx_bytes" "ac_cv_member_struct_net_device_stats_rx_bytes" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <linux/if.h>
-	#include <linux/netdevice.h>
-
-"
-if test "x$ac_cv_member_struct_net_device_stats_rx_bytes" = xyes; then :
-
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_NET_DEVICE_STATS_RX_BYTES 1
-_ACEOF
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-ac_fn_c_check_member "$LINENO" "struct net_device_stats" "tx_packets" "ac_cv_member_struct_net_device_stats_tx_packets" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <linux/if.h>
-	#include <linux/netdevice.h>
 
-"
-if test "x$ac_cv_member_struct_net_device_stats_tx_packets" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_NET_DEVICE_STATS_TX_PACKETS 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct net_device_stats" "rx_errors" "ac_cv_member_struct_net_device_stats_rx_errors" "
-	#include <sys/types.h>
-	#include <sys/socket.h>
-	#include <linux/if.h>
-	#include <linux/netdevice.h>
-
-"
-if test "x$ac_cv_member_struct_net_device_stats_rx_errors" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_NET_DEVICE_STATS_RX_ERRORS 1
-_ACEOF
 
 
-$as_echo "#define HAVE_STRUCT_NET_DEVICE_STATS 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-ac_fn_c_check_member "$LINENO" "struct inet_diag_req" "id" "ac_cv_member_struct_inet_diag_req_id" "
-	#include <linux/inet_diag.h>
-
-"
-if test "x$ac_cv_member_struct_inet_diag_req_id" = xyes; then :
-
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_INET_DIAG_REQ_ID 1
-_ACEOF
 
 
-$as_echo "#define HAVE_STRUCT_LINUX_INET_DIAG_REQ 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct inet_diag_req" "idiag_states" "ac_cv_member_struct_inet_diag_req_idiag_states" "
-	#include <linux/inet_diag.h>
-
-"
-if test "x$ac_cv_member_struct_inet_diag_req_idiag_states" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_INET_DIAG_REQ_IDIAG_STATES 1
-_ACEOF
 
 
-$as_echo "#define HAVE_STRUCT_LINUX_INET_DIAG_REQ 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
 
-ac_fn_c_check_member "$LINENO" "struct ip_mreqn" "imr_ifindex" "ac_cv_member_struct_ip_mreqn_imr_ifindex" "
-	#include <netinet/in.h>
-	#include <net/if.h>
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-"
-if test "x$ac_cv_member_struct_ip_mreqn_imr_ifindex" = xyes; then :
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_IP_MREQN_IMR_IFINDEX 1
-_ACEOF
 
 
-fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_pid" "ac_cv_member_struct_kinfo_proc_ki_pid" "
-#include <kvm.h>
-#include <sys/param.h>
-#include <sys/sysctl.h>
-#include <sys/user.h>
+	with_liblua="no (pkg-config cannot find liblua)"
 
-"
-if test "x$ac_cv_member_struct_kinfo_proc_ki_pid" = xyes; then :
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_KINFO_PROC_KI_PID 1
-_ACEOF
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
 
-		have_struct_kinfo_proc_freebsd="yes"
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-
-		have_struct_kinfo_proc_freebsd="no"
-
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_rssize" "ac_cv_member_struct_kinfo_proc_ki_rssize" "
-#include <kvm.h>
-#include <sys/param.h>
-#include <sys/sysctl.h>
-#include <sys/user.h>
 
-"
-if test "x$ac_cv_member_struct_kinfo_proc_ki_rssize" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_KINFO_PROC_KI_RSSIZE 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
+	with_liblua="no (pkg-config cannot find liblua)"
 
-		have_struct_kinfo_proc_freebsd="yes"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-
-		have_struct_kinfo_proc_freebsd="no"
-
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "ki_rusage" "ac_cv_member_struct_kinfo_proc_ki_rusage" "
-#include <kvm.h>
-#include <sys/param.h>
-#include <sys/sysctl.h>
-#include <sys/user.h>
 
-"
-if test "x$ac_cv_member_struct_kinfo_proc_ki_rusage" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_KINFO_PROC_KI_RUSAGE 1
-_ACEOF
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-$as_echo "#define HAVE_STRUCT_KINFO_PROC_FREEBSD 1" >>confdefs.h
 
-		have_struct_kinfo_proc_freebsd="yes"
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-
-		have_struct_kinfo_proc_freebsd="no"
-
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "p_pid" "ac_cv_member_struct_kinfo_proc_p_pid" "
-#include <sys/param.h>
-#include <sys/sysctl.h>
-#include <kvm.h>
-
-"
-if test "x$ac_cv_member_struct_kinfo_proc_p_pid" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_KINFO_PROC_P_PID 1
-_ACEOF
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-$as_echo "#define HAVE_STRUCT_KINFO_PROC_OPENBSD 1" >>confdefs.h
 
-		have_struct_kinfo_proc_openbsd="yes"
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-
-		have_struct_kinfo_proc_openbsd="no"
-
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct kinfo_proc" "p_vm_rssize" "ac_cv_member_struct_kinfo_proc_p_vm_rssize" "
-#include <sys/param.h>
-#include <sys/sysctl.h>
-#include <kvm.h>
 
-"
-if test "x$ac_cv_member_struct_kinfo_proc_p_vm_rssize" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_KINFO_PROC_P_VM_RSSIZE 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-$as_echo "#define HAVE_STRUCT_KINFO_PROC_OPENBSD 1" >>confdefs.h
+	with_liblua="no (pkg-config cannot find liblua)"
 
-		have_struct_kinfo_proc_openbsd="yes"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-
-		have_struct_kinfo_proc_openbsd="no"
-
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-ac_fn_c_check_member "$LINENO" "struct udphdr" "uh_dport" "ac_cv_member_struct_udphdr_uh_dport" "#define _BSD_SOURCE
-#define _DEFAULT_SOURCE
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
-#if HAVE_NETINET_UDP_H
-# include <netinet/udp.h>
-#endif
-
-"
-if test "x$ac_cv_member_struct_udphdr_uh_dport" = xyes; then :
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_UDPHDR_UH_DPORT 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "struct udphdr" "uh_sport" "ac_cv_member_struct_udphdr_uh_sport" "#define _BSD_SOURCE
-#define _DEFAULT_SOURCE
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
-#if HAVE_NETINET_UDP_H
-# include <netinet/udp.h>
-#endif
 
-"
-if test "x$ac_cv_member_struct_udphdr_uh_sport" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_UDPHDR_UH_SPORT 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-ac_fn_c_check_member "$LINENO" "struct udphdr" "dest" "ac_cv_member_struct_udphdr_dest" "#define _BSD_SOURCE
-#define _DEFAULT_SOURCE
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
-#if HAVE_NETINET_UDP_H
-# include <netinet/udp.h>
-#endif
+	with_liblua="no (pkg-config cannot find liblua)"
 
-"
-if test "x$ac_cv_member_struct_udphdr_dest" = xyes; then :
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_UDPHDR_DEST 1
-_ACEOF
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-ac_fn_c_check_member "$LINENO" "struct udphdr" "source" "ac_cv_member_struct_udphdr_source" "#define _BSD_SOURCE
-#define _DEFAULT_SOURCE
-#if HAVE_STDINT_H
-# include <stdint.h>
-#endif
-#if HAVE_SYS_TYPES_H
-# include <sys/types.h>
-#endif
-#if HAVE_NETINET_IN_SYSTM_H
-# include <netinet/in_systm.h>
-#endif
-#if HAVE_NETINET_IN_H
-# include <netinet/in.h>
-#endif
-#if HAVE_NETINET_IP_H
-# include <netinet/ip.h>
-#endif
-#if HAVE_NETINET_UDP_H
-# include <netinet/udp.h>
-#endif
 
-"
-if test "x$ac_cv_member_struct_udphdr_source" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_STRUCT_UDPHDR_SOURCE 1
-_ACEOF
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-ac_fn_c_check_member "$LINENO" "kstat_io_t" "nwritten" "ac_cv_member_kstat_io_t_nwritten" "
-#if HAVE_KSTAT_H
-# include <kstat.h>
-#endif
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-"
-if test "x$ac_cv_member_kstat_io_t_nwritten" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_KSTAT_IO_T_NWRITTEN 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.3\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.3") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.3" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "kstat_io_t" "writes" "ac_cv_member_kstat_io_t_writes" "
-#if HAVE_KSTAT_H
-# include <kstat.h>
-#endif
 
-"
-if test "x$ac_cv_member_kstat_io_t_writes" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_KSTAT_IO_T_WRITES 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-ac_fn_c_check_member "$LINENO" "kstat_io_t" "nwrites" "ac_cv_member_kstat_io_t_nwrites" "
-#if HAVE_KSTAT_H
-# include <kstat.h>
-#endif
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.3" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.3" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-"
-if test "x$ac_cv_member_kstat_io_t_nwrites" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_KSTAT_IO_T_NWRITES 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-ac_fn_c_check_member "$LINENO" "kstat_io_t" "wtime" "ac_cv_member_kstat_io_t_wtime" "
-#if HAVE_KSTAT_H
-# include <kstat.h>
-#endif
 
-"
-if test "x$ac_cv_member_kstat_io_t_wtime" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_KSTAT_IO_T_WTIME 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-#
-# Checks for libraries begin here
-#
 
-with_libresolv="yes"
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for res_search in -lresolv" >&5
-$as_echo_n "checking for res_search in -lresolv... " >&6; }
-if ${ac_cv_lib_resolv_res_search+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lresolv  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char res_search ();
-int
-main ()
-{
-return res_search ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_resolv_res_search=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_resolv_res_search=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_resolv_res_search" >&5
-$as_echo "$ac_cv_lib_resolv_res_search" >&6; }
-if test "x$ac_cv_lib_resolv_res_search" = xyes; then :
 
 
-$as_echo "#define HAVE_LIBRESOLV 1" >>confdefs.h
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_libresolv="no"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
- if test "x$with_libresolv" = "xyes"; then
-  BUILD_WITH_LIBRESOLV_TRUE=
-  BUILD_WITH_LIBRESOLV_FALSE='#'
-else
-  BUILD_WITH_LIBRESOLV_TRUE='#'
-  BUILD_WITH_LIBRESOLV_FALSE=
-fi
 
 
-with_libhal="yes"
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libhal_device_property_exists in -lhal" >&5
-$as_echo_n "checking for libhal_device_property_exists in -lhal... " >&6; }
-if ${ac_cv_lib_hal_libhal_device_property_exists+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lhal  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char libhal_device_property_exists ();
-int
-main ()
-{
-return libhal_device_property_exists ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_hal_libhal_device_property_exists=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_hal_libhal_device_property_exists=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_hal_libhal_device_property_exists" >&5
-$as_echo "$ac_cv_lib_hal_libhal_device_property_exists" >&6; }
-if test "x$ac_cv_lib_hal_libhal_device_property_exists" = xyes; then :
-
-$as_echo "#define HAVE_LIBHAL 1" >>confdefs.h
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libhal="no"
+  pkg_failed=yes
 fi
-
-if test "x$with_libhal" = "xyes"; then
-	if test "x$PKG_CONFIG" != "x"; then
-		BUILD_WITH_LIBHAL_CFLAGS="`$PKG_CONFIG --cflags hal`"
-		BUILD_WITH_LIBHAL_LIBS="`$PKG_CONFIG --libs hal`"
-
-
-	fi
+ else
+    pkg_failed=untried
 fi
 
 
 
-if test "x$ac_system" = "xAIX"
-then
-	with_perfstat="yes"
-	with_procinfo="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-	with_perfstat="no (AIX only)"
-	with_procinfo="no (AIX only)"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-if test "x$with_perfstat" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for perfstat_reset in -lperfstat" >&5
-$as_echo_n "checking for perfstat_reset in -lperfstat... " >&6; }
-if ${ac_cv_lib_perfstat_perfstat_reset+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lperfstat  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char perfstat_reset ();
-int
-main ()
-{
-return perfstat_reset ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_perfstat_perfstat_reset=yes
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_perfstat_perfstat_reset=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_perfstat_perfstat_reset" >&5
-$as_echo "$ac_cv_lib_perfstat_perfstat_reset" >&6; }
-if test "x$ac_cv_lib_perfstat_perfstat_reset" = xyes; then :
-  with_perfstat="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_perfstat="no (perfstat not found)"
+  pkg_failed=yes
 fi
-
-#	AC_CHECK_HEADERS(sys/protosw.h libperfstat.h,, [with_perfstat="no (perfstat not found)"])
+ else
+    pkg_failed=untried
 fi
-if test "x$with_perfstat" = "xyes"
-then
-
-$as_echo "#define HAVE_PERFSTAT 1" >>confdefs.h
-
-	 # struct members pertaining to donation have been added to libperfstat somewhere between AIX5.3ML5 and AIX5.3ML9
-	 ac_fn_c_check_member "$LINENO" "perfstat_partition_type_t" "b.donate_enabled" "ac_cv_member_perfstat_partition_type_t_b_donate_enabled" "#include <libperfstat.h
-"
-if test "x$ac_cv_member_perfstat_partition_type_t_b_donate_enabled" = xyes; then :
 
-fi
 
-	 if test "x$av_cv_member_perfstat_partition_type_t_b_donate_enabled" = "xyes"
-	 then
 
-$as_echo "#define PERFSTAT_SUPPORTS_DONATION 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	 fi
-fi
- if test "x$with_perfstat" = "xyes"; then
-  BUILD_WITH_PERFSTAT_TRUE=
-  BUILD_WITH_PERFSTAT_FALSE='#'
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_PERFSTAT_TRUE='#'
-  BUILD_WITH_PERFSTAT_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-# Processes plugin under AIX.
-if test "x$with_procinfo" = "xyes"
-then
-	for ac_header in procinfo.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "procinfo.h" "ac_cv_header_procinfo_h" "$ac_includes_default"
-if test "x$ac_cv_header_procinfo_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_PROCINFO_H 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-  with_procinfo="no (procinfo.h not found)"
-fi
-
-done
-
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-if test "x$with_procinfo" = "xyes"
-then
 
-$as_echo "#define HAVE_PROCINFO_H 1" >>confdefs.h
 
-fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-if test "x$ac_system" = "xSolaris"
-then
-	with_kstat="yes"
-	with_devinfo="yes"
-else
-	with_kstat="no (Solaris only)"
-	with_devinfo="no (Solaris only)"
-fi
 
-if test "x$with_kstat" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kstat_open in -lkstat" >&5
-$as_echo_n "checking for kstat_open in -lkstat... " >&6; }
-if ${ac_cv_lib_kstat_kstat_open+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkstat  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char kstat_open ();
-int
-main ()
-{
-return kstat_open ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_kstat_kstat_open=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_kstat_kstat_open=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kstat_kstat_open" >&5
-$as_echo "$ac_cv_lib_kstat_kstat_open" >&6; }
-if test "x$ac_cv_lib_kstat_kstat_open" = xyes; then :
-  with_kstat="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_kstat="no (libkstat not found)"
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
-if test "x$with_kstat" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for di_init in -ldevinfo" >&5
-$as_echo_n "checking for di_init in -ldevinfo... " >&6; }
-if ${ac_cv_lib_devinfo_di_init+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldevinfo  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char di_init ();
-int
-main ()
-{
-return di_init ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_devinfo_di_init=yes
-else
-  ac_cv_lib_devinfo_di_init=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_devinfo_di_init" >&5
-$as_echo "$ac_cv_lib_devinfo_di_init" >&6; }
-if test "x$ac_cv_lib_devinfo_di_init" = xyes; then :
-  with_devinfo="yes"
-else
-  with_devinfo="no (not found)"
-fi
 
-	for ac_header in kstat.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "kstat.h" "ac_cv_header_kstat_h" "$ac_includes_default"
-if test "x$ac_cv_header_kstat_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_KSTAT_H 1
-_ACEOF
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_kstat="no (kstat.h not found)"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
-
-fi
-if test "x$with_kstat" = "xyes"
-then
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define HAVE_LIBKSTAT 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-fi
- if test "x$with_kstat" = "xyes"; then
-  BUILD_WITH_LIBKSTAT_TRUE=
-  BUILD_WITH_LIBKSTAT_FALSE='#'
 else
-  BUILD_WITH_LIBKSTAT_TRUE='#'
-  BUILD_WITH_LIBKSTAT_FALSE=
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
- if test "x$with_devinfo" = "xyes"; then
-  BUILD_WITH_LIBDEVINFO_TRUE=
-  BUILD_WITH_LIBDEVINFO_FALSE='#'
+
 else
-  BUILD_WITH_LIBDEVINFO_TRUE='#'
-  BUILD_WITH_LIBDEVINFO_FALSE=
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-with_libiokit="no"
-if test "x$ac_system" = "xDarwin"
-then
-	with_libiokit="yes"
-else
-	with_libiokit="no"
-fi
- if test "x$with_libiokit" = "xyes"; then
-  BUILD_WITH_LIBIOKIT_TRUE=
-  BUILD_WITH_LIBIOKIT_FALSE='#'
-else
-  BUILD_WITH_LIBIOKIT_TRUE='#'
-  BUILD_WITH_LIBIOKIT_FALSE=
-fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-with_libkvm="no"
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_getprocs in -lkvm" >&5
-$as_echo_n "checking for kvm_getprocs in -lkvm... " >&6; }
-if ${ac_cv_lib_kvm_kvm_getprocs+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkvm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char kvm_getprocs ();
-int
-main ()
-{
-return kvm_getprocs ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_kvm_kvm_getprocs=yes
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_kvm_kvm_getprocs=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_getprocs" >&5
-$as_echo "$ac_cv_lib_kvm_kvm_getprocs" >&6; }
-if test "x$ac_cv_lib_kvm_kvm_getprocs" = xyes; then :
-  with_kvm_getprocs="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_kvm_getprocs="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-if test "x$with_kvm_getprocs" = "xyes"
-then
 
-$as_echo "#define HAVE_LIBKVM_GETPROCS 1" >>confdefs.h
 
-	with_libkvm="yes"
-fi
- if test "x$with_kvm_getprocs" = "xyes"; then
-  BUILD_WITH_LIBKVM_GETPROCS_TRUE=
-  BUILD_WITH_LIBKVM_GETPROCS_FALSE='#'
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBKVM_GETPROCS_TRUE='#'
-  BUILD_WITH_LIBKVM_GETPROCS_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_getswapinfo in -lkvm" >&5
-$as_echo_n "checking for kvm_getswapinfo in -lkvm... " >&6; }
-if ${ac_cv_lib_kvm_kvm_getswapinfo+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkvm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char kvm_getswapinfo ();
-int
-main ()
-{
-return kvm_getswapinfo ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_kvm_kvm_getswapinfo=yes
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_kvm_kvm_getswapinfo=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_getswapinfo" >&5
-$as_echo "$ac_cv_lib_kvm_kvm_getswapinfo" >&6; }
-if test "x$ac_cv_lib_kvm_kvm_getswapinfo" = xyes; then :
-  with_kvm_getswapinfo="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_kvm_getswapinfo="no"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-if test "x$with_kvm_getswapinfo" = "xyes"
-then
 
-$as_echo "#define HAVE_LIBKVM_GETSWAPINFO 1" >>confdefs.h
 
-	with_libkvm="yes"
-fi
- if test "x$with_kvm_getswapinfo" = "xyes"; then
-  BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE=
-  BUILD_WITH_LIBKVM_GETSWAPINFO_FALSE='#'
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE='#'
-  BUILD_WITH_LIBKVM_GETSWAPINFO_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_nlist in -lkvm" >&5
-$as_echo_n "checking for kvm_nlist in -lkvm... " >&6; }
-if ${ac_cv_lib_kvm_kvm_nlist+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkvm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char kvm_nlist ();
-int
-main ()
-{
-return kvm_nlist ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_kvm_kvm_nlist=yes
-else
-  ac_cv_lib_kvm_kvm_nlist=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_nlist" >&5
-$as_echo "$ac_cv_lib_kvm_kvm_nlist" >&6; }
-if test "x$ac_cv_lib_kvm_kvm_nlist" = xyes; then :
-  with_kvm_nlist="yes"
 else
-  with_kvm_nlist="no"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$with_kvm_nlist" = "xyes"
-then
-	for ac_header in bsd/nlist.h nlist.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
-fi
 
-done
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
 
-$as_echo "#define HAVE_LIBKVM_NLIST 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-	with_libkvm="yes"
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
- if test "x$with_kvm_nlist" = "xyes"; then
-  BUILD_WITH_LIBKVM_NLIST_TRUE=
-  BUILD_WITH_LIBKVM_NLIST_FALSE='#'
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  BUILD_WITH_LIBKVM_NLIST_TRUE='#'
-  BUILD_WITH_LIBKVM_NLIST_FALSE=
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for kvm_openfiles in -lkvm" >&5
-$as_echo_n "checking for kvm_openfiles in -lkvm... " >&6; }
-if ${ac_cv_lib_kvm_kvm_openfiles+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lkvm  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char kvm_openfiles ();
-int
-main ()
-{
-return kvm_openfiles ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_kvm_kvm_openfiles=yes
-else
-  ac_cv_lib_kvm_kvm_openfiles=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_kvm_kvm_openfiles" >&5
-$as_echo "$ac_cv_lib_kvm_kvm_openfiles" >&6; }
-if test "x$ac_cv_lib_kvm_kvm_openfiles" = xyes; then :
-  with_kvm_openfiles="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_kvm_openfiles="no"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-if test "x$with_kvm_openfiles" = "xyes"
-then
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define HAVE_LIBKVM_NLIST 1" >>confdefs.h
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-	with_libkvm="yes"
-fi
- if test "x$with_kvm_openfiles" = "xyes"; then
-  BUILD_WITH_LIBKVM_OPENFILES_TRUE=
-  BUILD_WITH_LIBKVM_OPENFILES_FALSE='#'
 else
-  BUILD_WITH_LIBKVM_OPENFILES_TRUE='#'
-  BUILD_WITH_LIBKVM_OPENFILES_FALSE=
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-# --with-libaquaero5 {{{
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-# Check whether --with-libaquaero5 was given.
-if test "${with_libaquaero5+set}" = set; then :
-  withval=$with_libaquaero5;
- if test "x$withval" = "xyes"
- then
-	 with_libaquaero5="yes"
- else if test "x$withval" = "xno"
- then
-	 with_libaquaero5="no"
- else
-	 with_libaquaero5="yes"
-	 LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS -I$withval/src"
-	 LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS -L$withval/obj"
- fi; fi
 
 else
-  with_libaquaero5="yes"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-CPPFLAGS="$CPPFLAGS $LIBAQUAERO5_CFLAGS"
-LDFLAGS="$LDFLAGS $LIBAQUAERO5_LDFLAGS"
 
-if test "x$with_libaquaero5" = "xyes"
-then
-	if test "x$LIBAQUAERO5_CFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libaquaero5 CPPFLAGS: $LIBAQUAERO5_CFLAGS" >&5
-$as_echo "$as_me: libaquaero5 CPPFLAGS: $LIBAQUAERO5_CFLAGS" >&6;}
-	fi
-	for ac_header in libaquaero5.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "libaquaero5.h" "ac_cv_header_libaquaero5_h" "$ac_includes_default"
-if test "x$ac_cv_header_libaquaero5_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBAQUAERO5_H 1
-_ACEOF
- with_libaquaero5="yes"
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libaquaero5="no (libaquaero5.h not found)"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-if test "x$with_libaquaero5" = "xyes"
-then
-	if test "x$LIBAQUAERO5_LDFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libaquaero5 LDFLAGS: $LIBAQUAERO5_LDFLAGS" >&5
-$as_echo "$as_me: libaquaero5 LDFLAGS: $LIBAQUAERO5_LDFLAGS" >&6;}
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
 	fi
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libaquaero5_poll in -laquaero5" >&5
-$as_echo_n "checking for libaquaero5_poll in -laquaero5... " >&6; }
-if ${ac_cv_lib_aquaero5_libaquaero5_poll+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-laquaero5  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char libaquaero5_poll ();
-int
-main ()
-{
-return libaquaero5_poll ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_aquaero5_libaquaero5_poll=yes
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_aquaero5_libaquaero5_poll=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_aquaero5_libaquaero5_poll" >&5
-$as_echo "$ac_cv_lib_aquaero5_libaquaero5_poll" >&6; }
-if test "x$ac_cv_lib_aquaero5_libaquaero5_poll" = xyes; then :
-  with_libaquaero5="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libaquaero5="no (symbol 'libaquaero5_poll' not found)"
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
 
-if test "x$with_libaquaero5" = "xyes"
-then
-	BUILD_WITH_LIBAQUAERO5_CFLAGS="$LIBAQUAERO5_CFLAGS"
-	BUILD_WITH_LIBAQUAERO5_LDFLAGS="$LIBAQUAERO5_LDFLAGS"
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-fi
- if test "x$with_libaquaero5" = "xyes"; then
-  BUILD_WITH_LIBAQUAERO5_TRUE=
-  BUILD_WITH_LIBAQUAERO5_FALSE='#'
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBAQUAERO5_TRUE='#'
-  BUILD_WITH_LIBAQUAERO5_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-# }}}
 
-# --with-libhiredis {{{
 
-# Check whether --with-libhiredis was given.
-if test "${with_libhiredis+set}" = set; then :
-  withval=$with_libhiredis;
- if test "x$withval" = "xyes"
- then
-	 with_libhiredis="yes"
- else if test "x$withval" = "xno"
- then
-	 with_libhiredis="no"
- else
-	 with_libhiredis="yes"
-	 LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS -I$withval/include"
-	 LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS -L$withval/lib"
- fi; fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libhiredis="yes"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
 
-CPPFLAGS="$CPPFLAGS $LIBHIREDIS_CPPFLAGS"
-LDFLAGS="$LDFLAGS $LIBHIREDIS_LDFLAGS"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-if test "x$with_libhiredis" = "xyes"
-then
-	if test "x$LIBHIREDIS_CPPFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libhiredis CPPFLAGS: $LIBHIREDIS_CPPFLAGS" >&5
-$as_echo "$as_me: libhiredis CPPFLAGS: $LIBHIREDIS_CPPFLAGS" >&6;}
-	fi
-	for ac_header in hiredis/hiredis.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "hiredis/hiredis.h" "ac_cv_header_hiredis_hiredis_h" "$ac_includes_default"
-if test "x$ac_cv_header_hiredis_hiredis_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_HIREDIS_HIREDIS_H 1
-_ACEOF
- with_libhiredis="yes"
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_libhiredis="no (hiredis.h not found)"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-done
+	with_liblua="no (pkg-config cannot find liblua)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-fi
-if test "x$with_libhiredis" = "xyes"
-then
-	if test "x$LIBHIREDIS_LDFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libhiredis LDFLAGS: $LIBHIREDIS_LDFLAGS" >&5
-$as_echo "$as_me: libhiredis LDFLAGS: $LIBHIREDIS_LDFLAGS" >&6;}
-	fi
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for redisCommand in -lhiredis" >&5
-$as_echo_n "checking for redisCommand in -lhiredis... " >&6; }
-if ${ac_cv_lib_hiredis_redisCommand+:} false; then :
-  $as_echo_n "(cached) " >&6
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lhiredis  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char redisCommand ();
-int
-main ()
-{
-return redisCommand ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_hiredis_redisCommand=yes
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_hiredis_redisCommand=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_hiredis_redisCommand" >&5
-$as_echo "$ac_cv_lib_hiredis_redisCommand" >&6; }
-if test "x$ac_cv_lib_hiredis_redisCommand" = xyes; then :
-  with_libhiredis="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libhiredis="no (symbol 'redisCommand' not found)"
+  pkg_failed=yes
 fi
-
-
+ else
+    pkg_failed=untried
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
 
-if test "x$with_libhiredis" = "xyes"
-then
-	BUILD_WITH_LIBHIREDIS_CPPFLAGS="$LIBHIREDIS_CPPFLAGS"
-	BUILD_WITH_LIBHIREDIS_LDFLAGS="$LIBHIREDIS_LDFLAGS"
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-fi
- if test "x$with_libhiredis" = "xyes"; then
-  BUILD_WITH_LIBHIREDIS_TRUE=
-  BUILD_WITH_LIBHIREDIS_FALSE='#'
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBHIREDIS_TRUE='#'
-  BUILD_WITH_LIBHIREDIS_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-# }}}
-
-# --with-libcurl {{{
-with_curl_config="curl-config"
-with_curl_cflags=""
-with_curl_libs=""
+	with_liblua="no (pkg-config cannot find liblua)"
 
-# Check whether --with-libcurl was given.
-if test "${with_libcurl+set}" = set; then :
-  withval=$with_libcurl;
-	if test "x$withval" = "xno"
-	then
-		with_libcurl="no"
-	else if test "x$withval" = "xyes"
-	then
-		with_libcurl="yes"
-	else
-		if test -f "$withval" && test -x "$withval"
-		then
-			with_curl_config="$withval"
-			with_libcurl="yes"
-		else if test -x "$withval/bin/curl-config"
-		then
-			with_curl_config="$withval/bin/curl-config"
-			with_libcurl="yes"
-		fi; fi
-		with_libcurl="yes"
-	fi; fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-	with_libcurl="yes"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$with_libcurl" = "xyes"
-then
-	with_curl_cflags=`$with_curl_config --cflags 2>/dev/null`
-	curl_config_status=$?
 
-	if test $curl_config_status -ne 0
-	then
-		with_libcurl="no ($with_curl_config failed)"
-	else
-		SAVE_CPPFLAGS="$CPPFLAGS"
-		CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-		for ac_header in curl/curl.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "curl/curl.h" "ac_cv_header_curl_curl_h" "$ac_includes_default"
-if test "x$ac_cv_header_curl_curl_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_CURL_CURL_H 1
-_ACEOF
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libcurl="no (curl/curl.h not found)"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-done
 
 
-		CPPFLAGS="$SAVE_CPPFLAGS"
-	fi
-fi
-if test "x$with_libcurl" = "xyes"
-then
-	with_curl_libs=`$with_curl_config --libs 2>/dev/null`
-	curl_config_status=$?
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	if test $curl_config_status -ne 0
-	then
-		with_libcurl="no ($with_curl_config failed)"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for curl_easy_init in -lcurl" >&5
-$as_echo_n "checking for curl_easy_init in -lcurl... " >&6; }
-if ${ac_cv_lib_curl_curl_easy_init+:} false; then :
-  $as_echo_n "(cached) " >&6
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lcurl $with_curl_libs $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char curl_easy_init ();
-int
-main ()
-{
-return curl_easy_init ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_curl_curl_easy_init=yes
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_curl_curl_easy_init=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_curl_curl_easy_init" >&5
-$as_echo "$ac_cv_lib_curl_curl_easy_init" >&6; }
-if test "x$ac_cv_lib_curl_curl_easy_init" = xyes; then :
-  with_libcurl="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libcurl="no (symbol 'curl_easy_init' not found)"
+  pkg_failed=yes
 fi
-
-		ac_fn_c_check_decl "$LINENO" "CURLOPT_USERNAME" "ac_cv_have_decl_CURLOPT_USERNAME" "#include <curl/curl.h>
-"
-if test "x$ac_cv_have_decl_CURLOPT_USERNAME" = xyes; then :
-  have_curlopt_username="yes"
-else
-  have_curlopt_username="no"
+ else
+    pkg_failed=untried
 fi
 
-		ac_fn_c_check_decl "$LINENO" "CURLOPT_TIMEOUT_MS" "ac_cv_have_decl_CURLOPT_TIMEOUT_MS" "#include <curl/curl.h>
-"
-if test "x$ac_cv_have_decl_CURLOPT_TIMEOUT_MS" = xyes; then :
-  have_curlopt_timeout="yes"
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  have_curlopt_timeout="no"
+        _pkg_short_errors_supported=no
 fi
-
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
 	fi
-fi
-if test "x$with_libcurl" = "xyes"
-then
-	BUILD_WITH_LIBCURL_CFLAGS="$with_curl_cflags"
-	BUILD_WITH_LIBCURL_LIBS="$with_curl_libs"
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
+	with_liblua="no (pkg-config cannot find liblua)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-	if test "x$have_curlopt_username" = "xyes"
-	then
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-$as_echo "#define HAVE_CURLOPT_USERNAME 1" >>confdefs.h
 
-	fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-	if test "x$have_curlopt_timeout" = "xyes"
-	then
 
-$as_echo "#define HAVE_CURLOPT_TIMEOUT_MS 1" >>confdefs.h
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-	fi
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
- if test "x$with_libcurl" = "xyes"; then
-  BUILD_WITH_LIBCURL_TRUE=
-  BUILD_WITH_LIBCURL_FALSE='#'
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  BUILD_WITH_LIBCURL_TRUE='#'
-  BUILD_WITH_LIBCURL_FALSE=
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-# }}}
 
-# --with-libdbi {{{
-with_libdbi_cppflags=""
-with_libdbi_ldflags=""
 
-# Check whether --with-libdbi was given.
-if test "${with_libdbi+set}" = set; then :
-  withval=$with_libdbi;
-	if test "x$withval" != "xno" && test "x$withval" != "xyes"
-	then
-		with_libdbi_cppflags="-I$withval/include"
-		with_libdbi_ldflags="-L$withval/lib"
-		with_libdbi="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
 	else
-		with_libdbi="$withval"
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-else
+	with_liblua="no (pkg-config cannot find liblua)"
 
-	with_libdbi="yes"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$with_libdbi" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
 
-	for ac_header in dbi/dbi.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "dbi/dbi.h" "ac_cv_header_dbi_dbi_h" "$ac_includes_default"
-if test "x$ac_cv_header_dbi_dbi_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_DBI_DBI_H 1
-_ACEOF
- with_libdbi="yes"
 else
-  with_libdbi="no (dbi/dbi.h not found)"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
-
 
-	CPPFLAGS="$SAVE_CPPFLAGS"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-if test "x$with_libdbi" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	SAVE_LDFLAGS="$LDFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libdbi_cppflags"
-	LDFLAGS="$LDFLAGS $with_libdbi_ldflags"
 
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for dbi_initialize in -ldbi" >&5
-$as_echo_n "checking for dbi_initialize in -ldbi... " >&6; }
-if ${ac_cv_lib_dbi_dbi_initialize+:} false; then :
-  $as_echo_n "(cached) " >&6
+
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ldbi  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char dbi_initialize ();
-int
-main ()
-{
-return dbi_initialize ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_dbi_dbi_initialize=yes
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_dbi_dbi_initialize=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dbi_dbi_initialize" >&5
-$as_echo "$ac_cv_lib_dbi_dbi_initialize" >&6; }
-if test "x$ac_cv_lib_dbi_dbi_initialize" = xyes; then :
-  with_libdbi="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libdbi="no (Symbol 'dbi_initialize' not found)"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-	CPPFLAGS="$SAVE_CPPFLAGS"
-	LDFLAGS="$SAVE_LDFLAGS"
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-if test "x$with_libdbi" = "xyes"
-then
-	BUILD_WITH_LIBDBI_CPPFLAGS="$with_libdbi_cppflags"
-	BUILD_WITH_LIBDBI_LDFLAGS="$with_libdbi_ldflags"
-	BUILD_WITH_LIBDBI_LIBS="-ldbi"
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
+
 
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
- if test "x$with_libdbi" = "xyes"; then
-  BUILD_WITH_LIBDBI_TRUE=
-  BUILD_WITH_LIBDBI_FALSE='#'
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  BUILD_WITH_LIBDBI_TRUE='#'
-  BUILD_WITH_LIBDBI_FALSE=
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-# }}}
 
-# --with-libesmtp {{{
 
-# Check whether --with-libesmtp was given.
-if test "${with_libesmtp+set}" = set; then :
-  withval=$with_libesmtp;
-	if test "x$withval" != "xno" && test "x$withval" != "xyes"
-	then
-		LDFLAGS="$LDFLAGS -L$withval/lib"
-		CPPFLAGS="$CPPFLAGS -I$withval/include -D_THREAD_SAFE"
-		with_libesmtp="yes"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
 	else
-		with_libesmtp="$withval"
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-else
 
-	with_libesmtp="yes"
 
-fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-if test "x$with_libesmtp" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for smtp_create_session in -lesmtp" >&5
-$as_echo_n "checking for smtp_create_session in -lesmtp... " >&6; }
-if ${ac_cv_lib_esmtp_smtp_create_session+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lesmtp  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char smtp_create_session ();
-int
-main ()
-{
-return smtp_create_session ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_esmtp_smtp_create_session=yes
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_esmtp_smtp_create_session=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_esmtp_smtp_create_session" >&5
-$as_echo "$ac_cv_lib_esmtp_smtp_create_session" >&6; }
-if test "x$ac_cv_lib_esmtp_smtp_create_session" = xyes; then :
 
 
-$as_echo "#define HAVE_LIBESMTP 1" >>confdefs.h
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_libesmtp="no (libesmtp not found)"
-fi
-
+        _pkg_short_errors_supported=no
 fi
-if test "x$with_libesmtp" = "xyes"
-then
-	for ac_header in libesmtp.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "libesmtp.h" "ac_cv_header_libesmtp_h" "$ac_includes_default"
-if test "x$ac_cv_header_libesmtp_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBESMTP_H 1
-_ACEOF
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
-$as_echo "#define HAVE_LIBESMTP_H 1" >>confdefs.h
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libesmtp="no (libesmtp.h not found)"
+  pkg_failed=yes
 fi
-
-done
-
+ else
+    pkg_failed=untried
 fi
-if test "x$with_libesmtp" = "xyes"
-then
-	collect_libesmtp=1
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-	collect_libesmtp=0
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-cat >>confdefs.h <<_ACEOF
-#define COLLECT_LIBESMTP $collect_libesmtp
-_ACEOF
 
- if test "x$with_libesmtp" = "xyes"; then
-  BUILD_WITH_LIBESMTP_TRUE=
-  BUILD_WITH_LIBESMTP_FALSE='#'
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBESMTP_TRUE='#'
-  BUILD_WITH_LIBESMTP_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-# }}}
-
-# --with-libganglia {{{
+	with_liblua="no (pkg-config cannot find liblua)"
 
-# Check whether --with-libganglia was given.
-if test "${with_libganglia+set}" = set; then :
-  withval=$with_libganglia;
- if test -f "$withval" && test -x "$withval"
- then
-	 with_libganglia_config="$withval"
-	 with_libganglia="yes"
- else if test -f "$withval/bin/ganglia-config" && test -x "$withval/bin/ganglia-config"
- then
-	 with_libganglia_config="$withval/bin/ganglia-config"
-	 with_libganglia="yes"
- else if test -d "$withval"
- then
-	 GANGLIA_CPPFLAGS="-I$withval/include"
-	 GANGLIA_LDFLAGS="-L$withval/lib"
-	 with_libganglia="yes"
- else
-	 with_libganglia="$withval"
- fi; fi; fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
- with_libganglia="yes"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-if test "x$with_libganglia" = "xyes"
-then
-	if test "x$with_libganglia_config" != "x"
-	then
-		if test "x$GANGLIA_CPPFLAGS" = "x"
-		then
-			GANGLIA_CPPFLAGS=`"$with_libganglia_config" --cflags 2>/dev/null`
-		fi
 
-		if test "x$GANGLIA_LDFLAGS" = "x"
-		then
-			GANGLIA_LDFLAGS=`"$with_libganglia_config" --ldflags 2>/dev/null`
-		fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-		if test "x$GANGLIA_LIBS" = "x"
-		then
-			GANGLIA_LIBS=`"$with_libganglia_config" --libs 2>/dev/null`
-		fi
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
 	else
-		GANGLIA_LIBS="-lganglia"
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
 	fi
-fi
-
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
-CPPFLAGS="$CPPFLAGS $GANGLIA_CPPFLAGS"
-LDFLAGS="$LDFLAGS $GANGLIA_LDFLAGS"
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-if test "x$with_libganglia" = "xyes"
-then
-	for ac_header in gm_protocol.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "gm_protocol.h" "ac_cv_header_gm_protocol_h" "$ac_includes_default"
-if test "x$ac_cv_header_gm_protocol_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GM_PROTOCOL_H 1
-_ACEOF
+	with_liblua="no (pkg-config cannot find liblua)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-$as_echo "#define HAVE_GM_PROTOCOL_H 1" >>confdefs.h
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
 else
-  with_libganglia="no (gm_protocol.h not found)"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-if test "x$with_libganglia" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for xdr_Ganglia_value_msg in -lganglia" >&5
-$as_echo_n "checking for xdr_Ganglia_value_msg in -lganglia... " >&6; }
-if ${ac_cv_lib_ganglia_xdr_Ganglia_value_msg+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lganglia  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char xdr_Ganglia_value_msg ();
-int
-main ()
-{
-return xdr_Ganglia_value_msg ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_ganglia_xdr_Ganglia_value_msg=yes
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_ganglia_xdr_Ganglia_value_msg=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ganglia_xdr_Ganglia_value_msg" >&5
-$as_echo "$ac_cv_lib_ganglia_xdr_Ganglia_value_msg" >&6; }
-if test "x$ac_cv_lib_ganglia_xdr_Ganglia_value_msg" = xyes; then :
-
-
-$as_echo "#define HAVE_LIBGANGLIA 1" >>confdefs.h
-
-
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libganglia="no (symbol xdr_Ganglia_value_msg not found)"
+  pkg_failed=yes
 fi
-
+ else
+    pkg_failed=untried
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
-
 
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
- if test "x$with_libganglia" = "xyes"; then
-  BUILD_WITH_LIBGANGLIA_TRUE=
-  BUILD_WITH_LIBGANGLIA_FALSE='#'
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBGANGLIA_TRUE='#'
-  BUILD_WITH_LIBGANGLIA_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-# }}}
 
-# --with-libgcrypt {{{
-GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS"
-GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS"
-GCRYPT_LIBS="$GCRYPT_LIBS"
 
-# Check whether --with-libgcrypt was given.
-if test "${with_libgcrypt+set}" = set; then :
-  withval=$with_libgcrypt;
- if test -f "$withval" && test -x "$withval"
- then
-	 with_libgcrypt_config="$withval"
-	 with_libgcrypt="yes"
- else if test -f "$withval/bin/gcrypt-config" && test -x "$withval/bin/gcrypt-config"
- then
-	 with_libgcrypt_config="$withval/bin/gcrypt-config"
-	 with_libgcrypt="yes"
- else if test -d "$withval"
- then
-	 GCRYPT_CPPFLAGS="$GCRYPT_CPPFLAGS -I$withval/include"
-	 GCRYPT_LDFLAGS="$GCRYPT_LDFLAGS -L$withval/lib"
-	 with_libgcrypt="yes"
- else
-	 with_libgcrypt_config="gcrypt-config"
-	 with_libgcrypt="$withval"
- fi; fi; fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
 
- with_libgcrypt_config="libgcrypt-config"
- with_libgcrypt="yes"
 
-fi
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-if test "x$with_libgcrypt" = "xyes" && test "x$with_libgcrypt_config" != "x"
-then
-	if test "x$GCRYPT_CPPFLAGS" = "x"
-	then
-		GCRYPT_CPPFLAGS=`"$with_libgcrypt_config" --cflags 2>/dev/null`
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-	if test "x$GCRYPT_LIBS" = "x"
-	then
-		GCRYPT_LIBS=`"$with_libgcrypt_config" --libs 2>/dev/null`
-	fi
-fi
+	with_liblua="no (pkg-config cannot find liblua)"
 
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
-SAVE_LIBS="$LIBS"
-CPPFLAGS="$CPPFLAGS $GCRYPT_CPPFLAGS"
-LDFLAGS="$LDFLAGS $GCRYPT_LDFLAGS"
-LIBS="$LIBS $GCRYPT_LIBS"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-if test "x$with_libgcrypt" = "xyes"
-then
-	if test "x$GCRYPT_CPPFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: gcrypt CPPFLAGS: $GCRYPT_CPPFLAGS" >&5
-$as_echo "$as_me: gcrypt CPPFLAGS: $GCRYPT_CPPFLAGS" >&6;}
-	fi
-	for ac_header in gcrypt.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "gcrypt.h" "ac_cv_header_gcrypt_h" "$ac_includes_default"
-if test "x$ac_cv_header_gcrypt_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_GCRYPT_H 1
-_ACEOF
- with_libgcrypt="yes"
 else
-  with_libgcrypt="no (gcrypt.h not found)"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-if test "x$with_libgcrypt" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for gcry_md_hash_buffer in -lgcrypt" >&5
-$as_echo_n "checking for gcry_md_hash_buffer in -lgcrypt... " >&6; }
-if ${ac_cv_lib_gcrypt_gcry_md_hash_buffer+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lgcrypt  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char gcry_md_hash_buffer ();
-int
-main ()
-{
-return gcry_md_hash_buffer ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_gcrypt_gcry_md_hash_buffer=yes
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_gcrypt_gcry_md_hash_buffer=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_gcrypt_gcry_md_hash_buffer" >&5
-$as_echo "$ac_cv_lib_gcrypt_gcry_md_hash_buffer" >&6; }
-if test "x$ac_cv_lib_gcrypt_gcry_md_hash_buffer" = xyes; then :
-  with_libgcrypt="yes"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libgcrypt="no (symbol gcry_md_hash_buffer not found)"
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-	if test "$with_libgcrypt" != "no"; then
 
-# Check whether --with-libgcrypt-prefix was given.
-if test "${with_libgcrypt_prefix+set}" = set; then :
-  withval=$with_libgcrypt_prefix; libgcrypt_config_prefix="$withval"
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  libgcrypt_config_prefix=""
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-  if test x$libgcrypt_config_prefix != x ; then
-     if test x${LIBGCRYPT_CONFIG+set} != xset ; then
-        LIBGCRYPT_CONFIG=$libgcrypt_config_prefix/bin/libgcrypt-config
-     fi
-  fi
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}libgcrypt-config", so it can be a program name with args.
-set dummy ${ac_tool_prefix}libgcrypt-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_LIBGCRYPT_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $LIBGCRYPT_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_LIBGCRYPT_CONFIG="$LIBGCRYPT_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_LIBGCRYPT_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-  ;;
-esac
-fi
-LIBGCRYPT_CONFIG=$ac_cv_path_LIBGCRYPT_CONFIG
-if test -n "$LIBGCRYPT_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $LIBGCRYPT_CONFIG" >&5
-$as_echo "$LIBGCRYPT_CONFIG" >&6; }
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-fi
-if test -z "$ac_cv_path_LIBGCRYPT_CONFIG"; then
-  ac_pt_LIBGCRYPT_CONFIG=$LIBGCRYPT_CONFIG
-  # Extract the first word of "libgcrypt-config", so it can be a program name with args.
-set dummy libgcrypt-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_ac_pt_LIBGCRYPT_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $ac_pt_LIBGCRYPT_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ac_pt_LIBGCRYPT_CONFIG="$ac_pt_LIBGCRYPT_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_ac_pt_LIBGCRYPT_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
-fi
-ac_pt_LIBGCRYPT_CONFIG=$ac_cv_path_ac_pt_LIBGCRYPT_CONFIG
-if test -n "$ac_pt_LIBGCRYPT_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_LIBGCRYPT_CONFIG" >&5
-$as_echo "$ac_pt_LIBGCRYPT_CONFIG" >&6; }
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-  if test "x$ac_pt_LIBGCRYPT_CONFIG" = x; then
-    LIBGCRYPT_CONFIG="no"
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    LIBGCRYPT_CONFIG=$ac_pt_LIBGCRYPT_CONFIG
-  fi
+
 else
-  LIBGCRYPT_CONFIG="$ac_cv_path_LIBGCRYPT_CONFIG"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-  tmp=1:1.2.0
-  if echo "$tmp" | grep ':' >/dev/null 2>/dev/null ; then
-     req_libgcrypt_api=`echo "$tmp"     | sed 's/\(.*\):\(.*\)/\1/'`
-     min_libgcrypt_version=`echo "$tmp" | sed 's/\(.*\):\(.*\)/\2/'`
-  else
-     req_libgcrypt_api=0
-     min_libgcrypt_version="$tmp"
-  fi
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBGCRYPT - version >= $min_libgcrypt_version" >&5
-$as_echo_n "checking for LIBGCRYPT - version >= $min_libgcrypt_version... " >&6; }
-  ok=no
-  if test "$LIBGCRYPT_CONFIG" != "no" ; then
-    req_major=`echo $min_libgcrypt_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\1/'`
-    req_minor=`echo $min_libgcrypt_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\2/'`
-    req_micro=`echo $min_libgcrypt_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\)/\3/'`
-    libgcrypt_config_version=`$LIBGCRYPT_CONFIG --version`
-    major=`echo $libgcrypt_config_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/\1/'`
-    minor=`echo $libgcrypt_config_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/\2/'`
-    micro=`echo $libgcrypt_config_version | \
-               sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/\3/'`
-    if test "$major" -gt "$req_major"; then
-        ok=yes
-    else
-        if test "$major" -eq "$req_major"; then
-            if test "$minor" -gt "$req_minor"; then
-               ok=yes
-            else
-               if test "$minor" -eq "$req_minor"; then
-                   if test "$micro" -ge "$req_micro"; then
-                     ok=yes
-                   fi
-               fi
-            fi
-        fi
-    fi
-  fi
-  if test $ok = yes; then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes ($libgcrypt_config_version)" >&5
-$as_echo "yes ($libgcrypt_config_version)" >&6; }
-  else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-  fi
-  if test $ok = yes; then
-     # If we have a recent libgcrypt, we should also check that the
-     # API is compatible
-     if test "$req_libgcrypt_api" -gt 0 ; then
-        tmp=`$LIBGCRYPT_CONFIG --api-version 2>/dev/null || echo 0`
-        if test "$tmp" -gt 0 ; then
-           { $as_echo "$as_me:${as_lineno-$LINENO}: checking LIBGCRYPT API version" >&5
-$as_echo_n "checking LIBGCRYPT API version... " >&6; }
-           if test "$req_libgcrypt_api" -eq "$tmp" ; then
-             { $as_echo "$as_me:${as_lineno-$LINENO}: result: okay" >&5
-$as_echo "okay" >&6; }
-           else
-             ok=no
-             { $as_echo "$as_me:${as_lineno-$LINENO}: result: does not match. want=$req_libgcrypt_api got=$tmp" >&5
-$as_echo "does not match. want=$req_libgcrypt_api got=$tmp" >&6; }
-           fi
-        fi
-     fi
-  fi
-  if test $ok = yes; then
-    LIBGCRYPT_CFLAGS=`$LIBGCRYPT_CONFIG --cflags`
-    LIBGCRYPT_LIBS=`$LIBGCRYPT_CONFIG --libs`
-    :
-    if test x"$host" != x ; then
-      libgcrypt_config_host=`$LIBGCRYPT_CONFIG --host 2>/dev/null || echo none`
-      if test x"$libgcrypt_config_host" != xnone ; then
-        if test x"$libgcrypt_config_host" != x"$host" ; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING:
-***
-*** The config script $LIBGCRYPT_CONFIG was
-*** built for $libgcrypt_config_host and thus may not match the
-*** used host $host.
-*** You may want to use the configure option --with-libgcrypt-prefix
-*** to specify a matching config script.
-***" >&5
-$as_echo "$as_me: WARNING:
-***
-*** The config script $LIBGCRYPT_CONFIG was
-*** built for $libgcrypt_config_host and thus may not match the
-*** used host $host.
-*** You may want to use the configure option --with-libgcrypt-prefix
-*** to specify a matching config script.
-***" >&2;}
-        fi
-      fi
-    fi
-  else
-    LIBGCRYPT_CFLAGS=""
-    LIBGCRYPT_LIBS=""
-    with_libgcrypt="no (version 1.2.0+ required)"
-  fi
 
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-		GCRYPT_CPPFLAGS="$LIBGCRYPT_CPPFLAGS $LIBGCRYPT_CFLAGS"
-		GCRYPT_LIBS="$LIBGCRYPT_LIBS"
-	fi
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.2\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.2") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.2" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
-LIBS="$SAVE_LIBS"
 
-if test "x$with_libgcrypt" = "xyes"
-then
 
-$as_echo "#define HAVE_LIBGCRYPT 1" >>confdefs.h
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.2" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.2" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
 
 
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
- if test "x$with_libgcrypt" = "xyes"; then
-  BUILD_WITH_LIBGCRYPT_TRUE=
-  BUILD_WITH_LIBGCRYPT_FALSE='#'
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  BUILD_WITH_LIBGCRYPT_TRUE='#'
-  BUILD_WITH_LIBGCRYPT_FALSE=
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
-# }}}
 
-# --with-libiptc {{{
 
-# Check whether --with-libiptc was given.
-if test "${with_libiptc+set}" = set; then :
-  withval=$with_libiptc;
-	if test "x$withval" = "xyes"
-	then
-		with_libiptc="pkgconfig"
-	else if test "x$withval" = "xno"
-	then
-		with_libiptc="no"
-	else
-		with_libiptc="yes"
-		with_libiptc_cflags="-I$withval/include"
-		with_libiptc_libs="-L$withval/lib"
-	fi; fi
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-
-	if test "x$ac_system" = "xLinux"
-	then
-		with_libiptc="pkgconfig"
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
 	else
-		with_libiptc="no (Linux only)"
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-fi
 
 
-if test "x$with_libiptc" = "xpkgconfig" && test "x$PKG_CONFIG" = "x"
-then
-	with_libiptc="no (Don't have pkg-config)"
-fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	$PKG_CONFIG --exists 'libiptc' 2>/dev/null
-	if test $? -ne 0
-	then
-		with_libiptc="no (pkg-config doesn't know libiptc)"
-	fi
-fi
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	with_libiptc_cflags="`$PKG_CONFIG --cflags 'libiptc'`"
-	if test $? -ne 0
-	then
-		with_libiptc="no ($PKG_CONFIG failed)"
-	fi
-	with_libiptc_libs="`$PKG_CONFIG --libs 'libiptc'`"
-	if test $? -ne 0
-	then
-		with_libiptc="no ($PKG_CONFIG failed)"
-	fi
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-
-SAVE_CPPFLAGS="$CPPFLAGS"
-CPPFLAGS="$CPPFLAGS $with_libiptc_cflags"
-
-# check whether the header file for libiptc is available.
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	for ac_header in libiptc/libiptc.h libiptc/libip6tc.h
-do :
-  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
-if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
-  cat >>confdefs.h <<_ACEOF
-#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
-_ACEOF
-
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libiptc="no (header file missing)"
+  pkg_failed=yes
 fi
-
-done
-
+ else
+    pkg_failed=untried
 fi
-# If the header file is available, check for the required type declaractions.
-# They may be missing in old versions of libiptc. In that case, they will be
-# declared in the iptables plugin.
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	ac_fn_c_check_type "$LINENO" "iptc_handle_t" "ac_cv_type_iptc_handle_t" "$ac_includes_default"
-if test "x$ac_cv_type_iptc_handle_t" = xyes; then :
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_IPTC_HANDLE_T 1
-_ACEOF
 
 
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-ac_fn_c_check_type "$LINENO" "ip6tc_handle_t" "ac_cv_type_ip6tc_handle_t" "$ac_includes_default"
-if test "x$ac_cv_type_ip6tc_handle_t" = xyes; then :
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_IP6TC_HANDLE_T 1
-_ACEOF
+	with_liblua="no (pkg-config cannot find liblua)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-fi
-# Check for the iptc_init symbol in the library.
-# This could be in iptc or ip4tc
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	SAVE_LIBS="$LIBS"
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for library containing iptc_init" >&5
-$as_echo_n "checking for library containing iptc_init... " >&6; }
-if ${ac_cv_search_iptc_init+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_func_search_save_LIBS=$LIBS
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char iptc_init ();
-int
-main ()
-{
-return iptc_init ();
-  ;
-  return 0;
-}
-_ACEOF
-for ac_lib in '' iptc ip4tc; do
-  if test -z "$ac_lib"; then
-    ac_res="none required"
-  else
-    ac_res=-l$ac_lib
-    LIBS="-l$ac_lib $with_libiptc_libs $ac_func_search_save_LIBS"
-  fi
-  if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_search_iptc_init=$ac_res
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext
-  if ${ac_cv_search_iptc_init+:} false; then :
-  break
-fi
-done
-if ${ac_cv_search_iptc_init+:} false; then :
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_search_iptc_init=no
+  pkg_failed=yes
 fi
-rm conftest.$ac_ext
-LIBS=$ac_func_search_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_iptc_init" >&5
-$as_echo "$ac_cv_search_iptc_init" >&6; }
-ac_res=$ac_cv_search_iptc_init
-if test "$ac_res" != no; then :
-  test "$ac_res" = "none required" || LIBS="$ac_res $LIBS"
-  with_libiptc="pkgconfig"
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  with_libiptc="no"
-fi
-
-	LIBS="$SAVE_LIBS"
+  pkg_failed=yes
 fi
-if test "x$with_libiptc" = "xpkgconfig"
-then
-	with_libiptc="yes"
+ else
+    pkg_failed=untried
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
 
- if test "x$with_libiptc" = "xyes"; then
-  BUILD_WITH_LIBIPTC_TRUE=
-  BUILD_WITH_LIBIPTC_FALSE='#'
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  BUILD_WITH_LIBIPTC_TRUE='#'
-  BUILD_WITH_LIBIPTC_FALSE=
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-if test "x$with_libiptc" = "xyes"
-then
-	BUILD_WITH_LIBIPTC_CPPFLAGS="$with_libiptc_cflags"
-	BUILD_WITH_LIBIPTC_LDFLAGS="$with_libiptc_libs"
-
+	with_liblua="no (pkg-config cannot find liblua)"
 
-fi
-# }}}
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
-# --with-java {{{
-with_java_home="$JAVA_HOME"
-if test "x$with_java_home" = "x"
-then
-	with_java_home="/usr/lib/jvm"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
-with_java_vmtype="client"
-with_java_cflags=""
-with_java_libs=""
-JAVAC="$JAVAC"
-JAR="$JAR"
 
-# Check whether --with-java was given.
-if test "${with_java+set}" = set; then :
-  withval=$with_java;
-	if test "x$withval" = "xno"
-	then
-		with_java="no"
-	else if test "x$withval" = "xyes"
-	then
-		with_java="yes"
-	else
-		with_java_home="$withval"
-		with_java="yes"
-	fi; fi
 
 else
-  with_java="yes"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-if test "x$with_java" = "xyes"
-then
-	if test -d "$with_java_home"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jni.h" >&5
-$as_echo_n "checking for jni.h... " >&6; }
-		TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
-		if test "x$TMPVAR" != "x"
-		then
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
-$as_echo "found in $TMPVAR" >&6; }
-			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
-		else
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-		fi
 
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jni_md.h" >&5
-$as_echo_n "checking for jni_md.h... " >&6; }
-		TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
-		if test "x$TMPVAR" != "x"
-		then
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
-$as_echo "found in $TMPVAR" >&6; }
-			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
-		else
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-		fi
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libjvm.so" >&5
-$as_echo_n "checking for libjvm.so... " >&6; }
-		TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
-		if test "x$TMPVAR" != "x"
-		then
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: found in $TMPVAR" >&5
-$as_echo "found in $TMPVAR" >&6; }
-			JAVA_LDFLAGS="$JAVA_LDFLAGS -L$TMPVAR -Wl,-rpath -Wl,$TMPVAR"
-		else
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-		fi
 
-		if test "x$JAVAC" = "x"
-		then
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for javac" >&5
-$as_echo_n "checking for javac... " >&6; }
-			TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
-			if test "x$TMPVAR" != "x"
-			then
-				JAVAC="$TMPVAR"
-				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAVAC" >&5
-$as_echo "$JAVAC" >&6; }
-			else
-				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-			fi
-		fi
-		if test "x$JAR" = "x"
-		then
-			{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for jar" >&5
-$as_echo_n "checking for jar... " >&6; }
-			TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
-			if test "x$TMPVAR" != "x"
-			then
-				JAR="$TMPVAR"
-				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAR" >&5
-$as_echo "$JAR" >&6; }
-			else
-				{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-			fi
-		fi
-	else if test "x$with_java_home" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: JAVA_HOME: No such directory: $with_java_home" >&5
-$as_echo "$as_me: WARNING: JAVA_HOME: No such directory: $with_java_home" >&2;}
-	fi; fi
-fi
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
 
-if test "x$JAVA_CPPFLAGS" != "x"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_CPPFLAGS set to: $JAVA_CPPFLAGS" >&5
-$as_echo "$as_me: Building with JAVA_CPPFLAGS set to: $JAVA_CPPFLAGS" >&6;}
-fi
-if test "x$JAVA_CFLAGS" != "x"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_CFLAGS set to: $JAVA_CFLAGS" >&5
-$as_echo "$as_me: Building with JAVA_CFLAGS set to: $JAVA_CFLAGS" >&6;}
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-if test "x$JAVA_LDFLAGS" != "x"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_LDFLAGS set to: $JAVA_LDFLAGS" >&5
-$as_echo "$as_me: Building with JAVA_LDFLAGS set to: $JAVA_LDFLAGS" >&6;}
+ else
+    pkg_failed=untried
 fi
-if test "x$JAVAC" = "x"
-then
-	with_javac_path="$PATH"
-	if test "x$with_java_home" != "x"
-	then
-		with_javac_path="$with_java_home:with_javac_path"
-		if test -d "$with_java_home/bin"
-		then
-			with_javac_path="$with_java_home/bin:with_javac_path"
-		fi
-	fi
-
-	# Extract the first word of "javac", so it can be a program name with args.
-set dummy javac; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_JAVAC+:} false; then :
-  $as_echo_n "(cached) " >&6
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua-5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua-5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua-5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  case $JAVAC in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_JAVAC="$JAVAC" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in "$with_javac_path"
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_JAVAC="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
+  pkg_failed=yes
 fi
-JAVAC=$ac_cv_path_JAVAC
-if test -n "$JAVAC"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAVAC" >&5
-$as_echo "$JAVAC" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+ else
+    pkg_failed=untried
 fi
 
 
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-if test "x$JAVAC" = "x"
-then
-	with_java="no (javac not found)"
-fi
-if test "x$JAR" = "x"
-then
-	with_jar_path="$PATH"
-	if test "x$with_java_home" != "x"
-	then
-		with_jar_path="$with_java_home:$with_jar_path"
-		if test -d "$with_java_home/bin"
-		then
-			with_jar_path="$with_java_home/bin:$with_jar_path"
-		fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua-5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua-5.1" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-	# Extract the first word of "jar", so it can be a program name with args.
-set dummy jar; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_JAR+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $JAR in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_JAR="$JAR" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in "$with_jar_path"
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_JAR="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
 
-  ;;
-esac
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
 fi
-JAR=$ac_cv_path_JAR
-if test -n "$JAR"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $JAR" >&5
-$as_echo "$JAR" >&6; }
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
 fi
-if test "x$JAR" = "x"
-then
-	with_java="no (jar not found)"
-fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_CFLAGS="$CFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
-CPPFLAGS="$CPPFLAGS $JAVA_CPPFLAGS"
-CFLAGS="$CFLAGS $JAVA_CFLAGS"
-LDFLAGS="$LDFLAGS $JAVA_LDFLAGS"
+	with_liblua="no (pkg-config cannot find liblua)"
 
-if test "x$with_java" = "xyes"
-then
-	for ac_header in jni.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "jni.h" "ac_cv_header_jni_h" "$ac_includes_default"
-if test "x$ac_cv_header_jni_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_JNI_H 1
-_ACEOF
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
 else
-  with_java="no (jni.h not found)"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-done
 
-fi
-if test "x$with_java" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for JNI_CreateJavaVM in -ljvm" >&5
-$as_echo_n "checking for JNI_CreateJavaVM in -ljvm... " >&6; }
-if ${ac_cv_lib_jvm_JNI_CreateJavaVM+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-ljvm $JAVA_LIBS $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char JNI_CreateJavaVM ();
-int
-main ()
-{
-return JNI_CreateJavaVM ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_jvm_JNI_CreateJavaVM=yes
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LUA" >&5
+$as_echo_n "checking for LUA... " >&6; }
+
+if test -n "$LUA_CFLAGS"; then
+    pkg_cv_LUA_CFLAGS="$LUA_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_CFLAGS=`$PKG_CONFIG --cflags "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LUA_LIBS"; then
+    pkg_cv_LUA_LIBS="$LUA_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"lua5.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "lua5.1") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LUA_LIBS=`$PKG_CONFIG --libs "lua5.1" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  ac_cv_lib_jvm_JNI_CreateJavaVM=no
+  pkg_failed=yes
 fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
+ else
+    pkg_failed=untried
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_jvm_JNI_CreateJavaVM" >&5
-$as_echo "$ac_cv_lib_jvm_JNI_CreateJavaVM" >&6; }
-if test "x$ac_cv_lib_jvm_JNI_CreateJavaVM" = xyes; then :
-  with_java="yes"
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  with_java="no (libjvm not found)"
+        _pkg_short_errors_supported=no
 fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "lua5.1" 2>&1`
+        else
+	        LUA_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "lua5.1" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LUA_PKG_ERRORS" >&5
 
-fi
-if test "x$with_java" = "xyes"
-then
-	JAVA_LIBS="$JAVA_LIBS -ljvm"
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: Building with JAVA_LIBS set to: $JAVA_LIBS" >&5
-$as_echo "$as_me: Building with JAVA_LIBS set to: $JAVA_LIBS" >&6;}
-fi
+	with_liblua="no (pkg-config cannot find liblua)"
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-CFLAGS="$SAVE_CFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_liblua="no (pkg-config cannot find liblua)"
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
 
- if test "x$with_java" = "xyes"; then
-  BUILD_WITH_JAVA_TRUE=
-  BUILD_WITH_JAVA_FALSE='#'
 else
-  BUILD_WITH_JAVA_TRUE='#'
-  BUILD_WITH_JAVA_FALSE=
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
-# }}}
 
-# --with-libldap {{{
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-# Check whether --with-libldap was given.
-if test "${with_libldap+set}" = set; then :
-  withval=$with_libldap;
- if test "x$withval" = "xyes"
- then
-	 with_libldap="yes"
- else if test "x$withval" = "xno"
- then
-	 with_libldap="no"
- else
-	 with_libldap="yes"
-	 LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS -I$withval/include"
-	 LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS -L$withval/lib"
- fi; fi
 
 else
-  with_libldap="yes"
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
 fi
 
 
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
 
-CPPFLAGS="$CPPFLAGS $LIBLDAP_CPPFLAGS"
-LDFLAGS="$LDFLAGS $LIBLDAP_LDFLAGS"
 
-if test "x$with_libldap" = "xyes"
+else
+	LUA_CFLAGS=$pkg_cv_LUA_CFLAGS
+	LUA_LIBS=$pkg_cv_LUA_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_liblua="yes"
+fi
+fi
+
+if test "x$with_liblua" = "xyes"
 then
-	if test "x$LIBLDAP_CPPFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libldap CPPFLAGS: $LIBLDAP_CPPFLAGS" >&5
-$as_echo "$as_me: libldap CPPFLAGS: $LIBLDAP_CPPFLAGS" >&6;}
-	fi
-	for ac_header in ldap.h
+  SAVE_CFLAGS="$CFLAGS"
+  CFLAGS="$CFLAGS $LUA_CFLAGS"
+
+  for ac_header in lua.h lauxlib.h lualib.h
 do :
-  ac_fn_c_check_header_mongrel "$LINENO" "ldap.h" "ac_cv_header_ldap_h" "$ac_includes_default"
-if test "x$ac_cv_header_ldap_h" = xyes; then :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
-#define HAVE_LDAP_H 1
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
- with_libldap="yes"
+ with_liblua="yes"
 else
-  with_libldap="no ('ldap.h' not found)"
+  with_liblua="no (header not found)"
+
 fi
 
 done
 
+
+  CFLAGS="$SAVE_CFLAGS"
 fi
-if test "x$with_libldap" = "xyes"
+
+if test "x$with_liblua" = "xyes"
 then
-	if test "x$LIBLDAP_LDFLAGS" != "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: libldap LDFLAGS: $LIBLDAP_LDFLAGS" >&5
-$as_echo "$as_me: libldap LDFLAGS: $LIBLDAP_LDFLAGS" >&6;}
-	fi
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for ldap_initialize in -lldap" >&5
-$as_echo_n "checking for ldap_initialize in -lldap... " >&6; }
-if ${ac_cv_lib_ldap_ldap_initialize+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lldap  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+  SAVE_LIBS="$LIBS"
+  LIBS="$LIBS $LUA_LIBS"
 
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char ldap_initialize ();
-int
-main ()
-{
-return ldap_initialize ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_ldap_ldap_initialize=yes
-else
-  ac_cv_lib_ldap_ldap_initialize=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_ldap_ldap_initialize" >&5
-$as_echo "$ac_cv_lib_ldap_ldap_initialize" >&6; }
-if test "x$ac_cv_lib_ldap_ldap_initialize" = xyes; then :
-  with_libldap="yes"
+  ac_fn_c_check_func "$LINENO" "lua_settop" "ac_cv_func_lua_settop"
+if test "x$ac_cv_func_lua_settop" = xyes; then :
+  with_liblua="yes"
 else
-  with_libldap="no (symbol 'ldap_initialize' not found)"
+  with_liblua="no (symbol 'lua_settop' not found)"
+
 fi
 
 
+  LIBS="$SAVE_LIBS"
 fi
 
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
-
-if test "x$with_libldap" = "xyes"
+if test "x$with_liblua" = "xyes"
 then
-	BUILD_WITH_LIBLDAP_CPPFLAGS="$LIBLDAP_CPPFLAGS"
-	BUILD_WITH_LIBLDAP_LDFLAGS="$LIBLDAP_LDFLAGS"
-
-
-fi
- if test "x$with_libldap" = "xyes"; then
-  BUILD_WITH_LIBLDAP_TRUE=
-  BUILD_WITH_LIBLDAP_FALSE='#'
-else
-  BUILD_WITH_LIBLDAP_TRUE='#'
-  BUILD_WITH_LIBLDAP_FALSE=
+    BUILD_WITH_LIBLUA_CFLAGS="$LUA_CFLAGS"
+    BUILD_WITH_LIBLUA_LIBS="$LUA_LIBS"
 fi
 
+
 # }}}
 
 # --with-liblvm2app {{{
 with_liblvm2app_cppflags=""
 with_liblvm2app_ldflags=""
 
@@ -22088,24 +35563,32 @@
 with_liblvm2app_cppflags=""
 with_liblvm2app_ldflags=""
 
 # Check whether --with-liblvm2app was given.
 if test "${with_liblvm2app+set}" = set; then :
   withval=$with_liblvm2app;
-        if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	if test "x$withval" = "xno"
         then
-                with_liblvm2app_cppflags="-I$withval/include"
-                with_liblvm2app_ldflags="-L$withval/lib"
-                with_liblvm2app="yes"
+		with_liblvm2app="no"
         else
-                with_liblvm2app="$withval"
+		with_liblvm2app="yes"
+		if test "x$withval" != "xyes"
+		then
+			with_liblvm2app_cppflags="-I$withval/include"
+			with_liblvm2app_ldflags="-L$withval/lib"
+		fi
         fi
 
 else
 
-        with_liblvm2app="yes"
+	if test "x$ac_system" = "xLinux"
+	then
+		with_liblvm2app="yes"
+	else
+		with_liblvm2app="no (Linux only library)"
+	fi
 
 fi
 
 if test "x$with_liblvm2app" = "xyes"
 then
         SAVE_CPPFLAGS="$CPPFLAGS"
@@ -22351,19 +35834,12 @@
 fi
 
 
 # configure using pkg-config
 if test "x$with_libmodbus" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libmodbus="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libmodbus" = "xuse_pkgconfig"
-then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: Checking for libmodbus using $PKG_CONFIG" >&5
 $as_echo "$as_me: Checking for libmodbus using $PKG_CONFIG" >&6;}
 	$PKG_CONFIG --exists 'libmodbus' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libmodbus="no (pkg-config doesn't know libmodbus)"
@@ -22598,12 +36074,120 @@
   BUILD_WITH_LIBMONGOC_TRUE='#'
   BUILD_WITH_LIBMONGOC_FALSE=
 fi
 
 # }}}
 
+# --with-libmosquitto {{{
+with_libmosquitto_cppflags=""
+with_libmosquitto_ldflags=""
+
+# Check whether --with-libmosquitto was given.
+if test "${with_libmosquitto+set}" = set; then :
+  withval=$with_libmosquitto;
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libmosquitto_cppflags="-I$withval/include"
+		with_libmosquitto_ldflags="-L$withval/lib"
+		with_libmosquitto="yes"
+	else
+		with_libmosquitto="$withval"
+	fi
+
+else
+
+	with_libmosquitto="yes"
+
+fi
+
+if test "x$with_libmosquitto" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
+
+	for ac_header in mosquitto.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "mosquitto.h" "ac_cv_header_mosquitto_h" "$ac_includes_default"
+if test "x$ac_cv_header_mosquitto_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_MOSQUITTO_H 1
+_ACEOF
+ with_libmosquitto="yes"
+else
+  with_libmosquitto="no (mosquitto.h not found)"
+fi
+
+done
+
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libmosquitto" = "xyes"
+then
+	SAVE_LDFLAGS="$LDFLAGS"
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	LDFLAGS="$LDFLAGS $with_libmosquitto_ldflags"
+	CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
+
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for mosquitto_connect in -lmosquitto" >&5
+$as_echo_n "checking for mosquitto_connect in -lmosquitto... " >&6; }
+if ${ac_cv_lib_mosquitto_mosquitto_connect+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lmosquitto  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char mosquitto_connect ();
+int
+main ()
+{
+return mosquitto_connect ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_mosquitto_mosquitto_connect=yes
+else
+  ac_cv_lib_mosquitto_mosquitto_connect=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_mosquitto_mosquitto_connect" >&5
+$as_echo "$ac_cv_lib_mosquitto_mosquitto_connect" >&6; }
+if test "x$ac_cv_lib_mosquitto_mosquitto_connect" = xyes; then :
+  with_libmosquitto="yes"
+else
+  with_libmosquitto="no (libmosquitto not found)"
+fi
+
+
+	LDFLAGS="$SAVE_LDFLAGS"
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libmosquitto" = "xyes"
+then
+	BUILD_WITH_LIBMOSQUITTO_CPPFLAGS="$with_libmosquitto_cppflags"
+	BUILD_WITH_LIBMOSQUITTO_LDFLAGS="$with_libmosquitto_ldflags"
+	BUILD_WITH_LIBMOSQUITTO_LIBS="-lmosquitto"
+
+
+
+fi
+# }}}
+
 # --with-libmysql {{{
 with_mysql_config="mysql_config"
 with_mysql_cflags=""
 with_mysql_libs=""
 
 # Check whether --with-libmysql was given.
@@ -22808,16 +36392,12 @@
  else
 	 with_libmnl="no (Linux only library)"
  fi
 
 fi
 
-if test "x$PKG_CONFIG" = "x"
-then
-	with_libmnl="no (Don't have pkg-config)"
-fi
 if test "x$with_libmnl" = "xyes"
 then
 	if $PKG_CONFIG --exists libmnl 2>/dev/null; then
 	  with_libmnl_cflags="$with_libmnl_ldflags `$PKG_CONFIG --cflags libmnl`"
 	  with_libmnl_libs="$with_libmnl_libs `$PKG_CONFIG --libs libmnl`"
 	fi
@@ -23065,13 +36645,13 @@
 		{ $as_echo "$as_me:${as_lineno-$LINENO}: netapp LDFLAGS: $LIBNETAPP_LDFLAGS" >&5
 $as_echo "$as_me: netapp LDFLAGS: $LIBNETAPP_LDFLAGS" >&6;}
 	fi
 
 	if test "x$LIBNETAPP_LIBS" = "x"
 	then
-		LIBNETAPP_LIBS="-lpthread -lxml -ladt -lssl -lm -lcrypto -lz"
+		LIBNETAPP_LIBS="$PTHREAD_LIBS -lxml -ladt -lssl -lm -lcrypto -lz"
 	fi
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: netapp LIBS: $LIBNETAPP_LIBS" >&5
 $as_echo "$as_me: netapp LIBS: $LIBNETAPP_LIBS" >&6;}
 
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for na_server_invoke_elem in -lnetapp" >&5
 $as_echo_n "checking for na_server_invoke_elem in -lnetapp... " >&6; }
@@ -23139,53 +36719,38 @@
   BUILD_WITH_LIBNETAPP_FALSE=
 fi
 
 # }}}
 
 # --with-libnetsnmp {{{
-with_snmp_config="net-snmp-config"
-with_snmp_cflags=""
-with_snmp_libs=""
 
 # Check whether --with-libnetsnmp was given.
 if test "${with_libnetsnmp+set}" = set; then :
   withval=$with_libnetsnmp;
 	if test "x$withval" = "xno"
 	then
 		with_libnetsnmp="no"
 	else if test "x$withval" = "xyes"
 	then
 		with_libnetsnmp="yes"
 	else
-		if test -x "$withval"
-		then
-			with_snmp_config="$withval"
-			with_libnetsnmp="yes"
-		else
-			with_snmp_config="$withval/bin/net-snmp-config"
-			with_libnetsnmp="yes"
-		fi
+		with_libnetsnmp_cppflags="-I$withval/include"
+		with_libnetsnmp_ldflags="-I$withval/lib"
+		with_libnetsnmp="yes"
 	fi; fi
 
 else
   with_libnetsnmp="yes"
 fi
 
 if test "x$with_libnetsnmp" = "xyes"
 then
-	with_snmp_cflags=`$with_snmp_config --cflags 2>/dev/null`
-	snmp_config_status=$?
-
-	if test $snmp_config_status -ne 0
-	then
-		with_libnetsnmp="no ($with_snmp_config failed)"
-	else
-		SAVE_CPPFLAGS="$CPPFLAGS"
-		CPPFLAGS="$CPPFLAGS $with_snmp_cflags"
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags"
 
-		for ac_header in net-snmp/net-snmp-config.h
+	for ac_header in net-snmp/net-snmp-config.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "net-snmp/net-snmp-config.h" "ac_cv_header_net_snmp_net_snmp_config_h" "$ac_includes_default"
 if test "x$ac_cv_header_net_snmp_net_snmp_config_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_NET_SNMP_NET_SNMP_CONFIG_H 1
 _ACEOF
@@ -23194,25 +36759,20 @@
   with_libnetsnmp="no (net-snmp/net-snmp-config.h not found)"
 fi
 
 done
 
 
-		CPPFLAGS="$SAVE_CPPFLAGS"
-	fi
+	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libnetsnmp" = "xyes"
 then
-	with_snmp_libs=`$with_snmp_config --libs 2>/dev/null`
-	snmp_config_status=$?
+	SAVE_LDFLAGS="$LDFLAGS"
+	LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
 
-	if test $snmp_config_status -ne 0
-	then
-		with_libnetsnmp="no ($with_snmp_config failed)"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for init_snmp in -lnetsnmp" >&5
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for init_snmp in -lnetsnmp" >&5
 $as_echo_n "checking for init_snmp in -lnetsnmp... " >&6; }
 if ${ac_cv_lib_netsnmp_init_snmp+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-lnetsnmp $with_snmp_libs $LIBS"
@@ -23248,28 +36808,23 @@
 if test "x$ac_cv_lib_netsnmp_init_snmp" = xyes; then :
   with_libnetsnmp="yes"
 else
   with_libnetsnmp="no (libnetsnmp not found)"
 fi
 
-	fi
+
+	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_libnetsnmp" = "xyes"
 then
-	BUILD_WITH_LIBSNMP_CFLAGS="$with_snmp_cflags"
-	BUILD_WITH_LIBSNMP_LIBS="$with_snmp_libs"
+	BUILD_WITH_LIBNETSNMP_CPPFLAGS="$with_libnetsnmp_cppflags"
+	BUILD_WITH_LIBNETSNMP_LDFLAGS="$with_libnetsnmp_ldflags"
+	BUILD_WITH_LIBNETSNMP_LIBS="-lnetsnmp"
+fi
 
 
-fi
- if test "x$with_libnetsnmp" = "xyes"; then
-  BUILD_WITH_LIBNETSNMP_TRUE=
-  BUILD_WITH_LIBNETSNMP_FALSE='#'
-else
-  BUILD_WITH_LIBNETSNMP_TRUE='#'
-  BUILD_WITH_LIBNETSNMP_FALSE=
-fi
 
 # }}}
 
 # --with-liboconfig {{{
 with_own_liboconfig="no"
 liboconfig_LDFLAGS="$LDFLAGS"
@@ -23302,15 +36857,15 @@
 
 
 save_LDFLAGS="$LDFLAGS"
 save_CPPFLAGS="$CPPFLAGS"
 LDFLAGS="$liboconfig_LDFLAGS"
 CPPFLAGS="$liboconfig_CPPFLAGS"
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for oconfig_parse_fh in -loconfig" >&5
-$as_echo_n "checking for oconfig_parse_fh in -loconfig... " >&6; }
-if ${ac_cv_lib_oconfig_oconfig_parse_fh+:} false; then :
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for oconfig_parse_file in -loconfig" >&5
+$as_echo_n "checking for oconfig_parse_file in -loconfig... " >&6; }
+if ${ac_cv_lib_oconfig_oconfig_parse_file+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
 LIBS="-loconfig  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -23318,33 +36873,33 @@
 /* Override any GCC internal prototype to avoid an error.
    Use char because int might match the return type of a GCC
    builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern "C"
 #endif
-char oconfig_parse_fh ();
+char oconfig_parse_file ();
 int
 main ()
 {
-return oconfig_parse_fh ();
+return oconfig_parse_file ();
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_oconfig_oconfig_parse_fh=yes
+  ac_cv_lib_oconfig_oconfig_parse_file=yes
 else
-  ac_cv_lib_oconfig_oconfig_parse_fh=no
+  ac_cv_lib_oconfig_oconfig_parse_file=no
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_oconfig_oconfig_parse_fh" >&5
-$as_echo "$ac_cv_lib_oconfig_oconfig_parse_fh" >&6; }
-if test "x$ac_cv_lib_oconfig_oconfig_parse_fh" = xyes; then :
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_oconfig_oconfig_parse_file" >&5
+$as_echo "$ac_cv_lib_oconfig_oconfig_parse_file" >&6; }
+if test "x$ac_cv_lib_oconfig_oconfig_parse_file" = xyes; then :
 
 	with_liboconfig="yes"
 	with_own_liboconfig="no"
 
 else
 
@@ -23575,30 +37130,30 @@
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
 	LIBS="$SAVE_LIBS"
 fi
 if test "x$with_oracle" = "xyes"
 then
-	BUILD_WITH_ORACLE_CFLAGS="$with_oracle_cppflags"
+	BUILD_WITH_ORACLE_CPPFLAGS="$with_oracle_cppflags"
 	BUILD_WITH_ORACLE_LIBS="$with_oracle_libs"
 
 
 fi
 # }}}
 
 # --with-libowcapi {{{
 with_libowcapi_cppflags=""
-with_libowcapi_libs="-lowcapi"
+with_libowcapi_ldflags=""
 
 # Check whether --with-libowcapi was given.
 if test "${with_libowcapi+set}" = set; then :
   withval=$with_libowcapi;
 	if test "x$withval" != "xno" && test "x$withval" != "xyes"
 	then
 		with_libowcapi_cppflags="-I$withval/include"
-		with_libowcapi_libs="-L$withval/lib -lowcapi"
+		with_libowcapi_ldflags="-L$withval/lib"
 		with_libowcapi="yes"
 	else
 		with_libowcapi="$withval"
 	fi
 
 else
@@ -23607,13 +37162,13 @@
 
 fi
 
 if test "x$with_libowcapi" = "xyes"
 then
 	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$with_libowcapi_cppflags"
+	CPPFLAGS="$CPPFLAGS $with_libowcapi_cppflags"
 
 	for ac_header in owcapi.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "owcapi.h" "ac_cv_header_owcapi_h" "$ac_includes_default"
 if test "x$ac_cv_header_owcapi_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
@@ -23630,13 +37185,13 @@
 	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libowcapi" = "xyes"
 then
 	SAVE_LDFLAGS="$LDFLAGS"
 	SAVE_CPPFLAGS="$CPPFLAGS"
-	LDFLAGS="$with_libowcapi_libs"
+	LDFLAGS="$LDFLAGS $with_libowcapi_ldflags"
 	CPPFLAGS="$with_libowcapi_cppflags"
 
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for OW_get in -lowcapi" >&5
 $as_echo_n "checking for OW_get in -lowcapi... " >&6; }
 if ${ac_cv_lib_owcapi_OW_get+:} false; then :
   $as_echo_n "(cached) " >&6
@@ -23682,13 +37237,15 @@
 	LDFLAGS="$SAVE_LDFLAGS"
 	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libowcapi" = "xyes"
 then
 	BUILD_WITH_LIBOWCAPI_CPPFLAGS="$with_libowcapi_cppflags"
-	BUILD_WITH_LIBOWCAPI_LIBS="$with_libowcapi_libs"
+	BUILD_WITH_LIBOWCAPI_LDFLAGS="$with_libowcapi_ldflags"
+	BUILD_WITH_LIBOWCAPI_LIBS="-lowcapi"
+
 
 
 fi
 # }}}
 
 # --with-libpcap {{{
@@ -23870,13 +37427,13 @@
 
 if test "x$with_libperl" = "xyes" \
 	&& test -n "$perl_interpreter"
 then
   SAVE_CFLAGS="$CFLAGS"
   SAVE_LIBS="$LIBS"
-  PERL_CFLAGS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e ccopts`
+  PERL_CFLAGS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e perl_inc`
   PERL_LIBS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e ldopts`
   CFLAGS="$CFLAGS $PERL_CFLAGS"
   LIBS="$LIBS $PERL_LIBS"
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libperl" >&5
 $as_echo_n "checking for libperl... " >&6; }
@@ -24285,271 +37842,527 @@
   BUILD_WITH_LIBPQ_TRUE='#'
   BUILD_WITH_LIBPQ_FALSE=
 fi
 
 # }}}
 
-# --with-libpthread {{{
+# --with-libprotobuf {{{
+with_libprotobuf_cppflags=""
+with_libprotobuf_ldflags=""
+
+# Check whether --with-libprotobuf was given.
+if test "${with_libprotobuf+set}" = set; then :
+  withval=$with_libprotobuf;
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libprotobuf_cppflags="-I$withval/include"
+      with_libprotobuf_ldflags="-L$withval/lib"
+      with_libprotobuf="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libprotobuf="no (disabled on command line)"
+    fi
+
+else
+  withval="yes"
 
-# Check whether --with-libpthread was given.
-if test "${with_libpthread+set}" = set; then :
-  withval=$with_libpthread; 	if test "x$withval" != "xno" \
-		&& test "x$withval" != "xyes"
-	then
-		LDFLAGS="$LDFLAGS -L$withval/lib"
-		CPPFLAGS="$CPPFLAGS -I$withval/include"
-		with_libpthread="yes"
+fi
+
+if test "x$withval" = "xyes"
+then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for PROTOBUF" >&5
+$as_echo_n "checking for PROTOBUF... " >&6; }
+
+if test -n "$PROTOBUF_CFLAGS"; then
+    pkg_cv_PROTOBUF_CFLAGS="$PROTOBUF_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"protobuf\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "protobuf") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PROTOBUF_CFLAGS=`$PKG_CONFIG --cflags "protobuf" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PROTOBUF_LIBS"; then
+    pkg_cv_PROTOBUF_LIBS="$PROTOBUF_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"protobuf\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "protobuf") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PROTOBUF_LIBS=`$PKG_CONFIG --libs "protobuf" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PROTOBUF_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "protobuf" 2>&1`
 	else
-		if test "x$withval" = "xno"
-		then
-			with_libpthread="no (disabled)"
-		fi
+	        PROTOBUF_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "protobuf" 2>&1`
 	fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$PROTOBUF_PKG_ERRORS" >&5
+
+	with_libprotobuf="no (pkg-config could not find libprotobuf)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_libprotobuf="no (pkg-config could not find libprotobuf)"
 
 else
-  with_libpthread="yes"
+	PROTOBUF_CFLAGS=$pkg_cv_PROTOBUF_CFLAGS
+	PROTOBUF_LIBS=$pkg_cv_PROTOBUF_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_libprotobuf="yes"
+fi
 fi
 
-if test "x$with_libpthread" = "xyes"
+if test "x$withval" != "xno"
 then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pthread_create in -lpthread" >&5
-$as_echo_n "checking for pthread_create in -lpthread... " >&6; }
-if ${ac_cv_lib_pthread_pthread_create+:} false; then :
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  LDFLAGS="$with_libprotobuf_ldflags"
+  LIBS="$PROTOBUF_LIBS $LIBS"
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for main in -lprotobuf" >&5
+$as_echo_n "checking for main in -lprotobuf... " >&6; }
+if ${ac_cv_lib_protobuf_main+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lprotobuf  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+
+int
+main ()
+{
+return main ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_cxx_try_link "$LINENO"; then :
+  ac_cv_lib_protobuf_main=yes
+else
+  ac_cv_lib_protobuf_main=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_protobuf_main" >&5
+$as_echo "$ac_cv_lib_protobuf_main" >&6; }
+if test "x$ac_cv_lib_protobuf_main" = xyes; then :
+
+      SAVE_CPPFLAGS="$CPPFLAGS"
+      CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
+      if test "x$PROTOBUF_LIBS" = "x"
+      then
+        PROTOBUF_LIBS="-lprotobuf"
+      fi
+      for ac_header in google/protobuf/util/time_util.h
+do :
+  ac_fn_cxx_check_header_mongrel "$LINENO" "google/protobuf/util/time_util.h" "ac_cv_header_google_protobuf_util_time_util_h" "$ac_includes_default"
+if test "x$ac_cv_header_google_protobuf_util_time_util_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_GOOGLE_PROTOBUF_UTIL_TIME_UTIL_H 1
+_ACEOF
+ with_libprotobuf="yes"
+else
+  with_libprotobuf="no (<google/protobuf/util/time_util.h> not found)"
+
+fi
+
+done
+
+      CPPFLAGS="$SAVE_CPPFLAGS"
+
+else
+  with_libprotobuf="no (libprotobuf not found)"
+
+fi
+
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
+fi
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
+BUILD_WITH_LIBPROTOBUF_LDFLAGS="$with_libprotobuf_ldflags"
+BUILD_WITH_LIBPROTOBUF_LIBS="$PROTOBUF_LIBS"
+
+
+
+# }}}
+
+# --with-libprotobuf-c {{{
+with_libprotobuf_c_cppflags=""
+with_libprotobuf_c_ldflags=""
+
+# Check whether --with-libprotobuf-c was given.
+if test "${with_libprotobuf_c+set}" = set; then :
+  withval=$with_libprotobuf_c;
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libprotobuf_c_cppflags="-I$withval/include"
+      with_libprotobuf_c_ldflags="-L$withval/lib"
+      with_libprotobuf_c="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libprotobuf_c="no (disabled on command line)"
+    fi
+
+else
+  withval="yes"
+
+fi
+
+if test "x$withval" = "xyes"
+then
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for PROTOBUF_C" >&5
+$as_echo_n "checking for PROTOBUF_C... " >&6; }
+
+if test -n "$PROTOBUF_C_CFLAGS"; then
+    pkg_cv_PROTOBUF_C_CFLAGS="$PROTOBUF_C_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprotobuf-c\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libprotobuf-c") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PROTOBUF_C_CFLAGS=`$PKG_CONFIG --cflags "libprotobuf-c" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$PROTOBUF_C_LIBS"; then
+    pkg_cv_PROTOBUF_C_LIBS="$PROTOBUF_C_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libprotobuf-c\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libprotobuf-c") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_PROTOBUF_C_LIBS=`$PKG_CONFIG --libs "libprotobuf-c" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        PROTOBUF_C_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "libprotobuf-c" 2>&1`
+        else
+	        PROTOBUF_C_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libprotobuf-c" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$PROTOBUF_C_PKG_ERRORS" >&5
+
+	with_libprotobuf_c="no (pkg-config could not find libprotobuf-c)"
+
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_libprotobuf_c="no (pkg-config could not find libprotobuf-c)"
+
+else
+	PROTOBUF_C_CFLAGS=$pkg_cv_PROTOBUF_C_CFLAGS
+	PROTOBUF_C_LIBS=$pkg_cv_PROTOBUF_C_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_libprotobuf_c="yes"
+fi
+fi
+
+if test "x$withval" != "xno"
+then
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  LDFLAGS="$with_libprotobuf_c_ldflags"
+  LIBS="$PROTOBUF_C_LIBS $LIBS"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for protobuf_c_message_pack in -lprotobuf-c" >&5
+$as_echo_n "checking for protobuf_c_message_pack in -lprotobuf-c... " >&6; }
+if ${ac_cv_lib_protobuf_c_protobuf_c_message_pack+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
+LIBS="-lprotobuf-c  $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
    Use char because int might match the return type of a GCC
    builtin and then its argument prototype would still apply.  */
 #ifdef __cplusplus
 extern "C"
 #endif
-char pthread_create ();
+char protobuf_c_message_pack ();
 int
 main ()
 {
-return pthread_create ();
+return protobuf_c_message_pack ();
   ;
   return 0;
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_pthread_pthread_create=yes
+  ac_cv_lib_protobuf_c_protobuf_c_message_pack=yes
 else
-  ac_cv_lib_pthread_pthread_create=no
+  ac_cv_lib_protobuf_c_protobuf_c_message_pack=no
 fi
 rm -f core conftest.err conftest.$ac_objext \
     conftest$ac_exeext conftest.$ac_ext
 LIBS=$ac_check_lib_save_LIBS
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_pthread_pthread_create" >&5
-$as_echo "$ac_cv_lib_pthread_pthread_create" >&6; }
-if test "x$ac_cv_lib_pthread_pthread_create" = xyes; then :
-  with_libpthread="yes"
-else
-  with_libpthread="no (libpthread not found)"
-fi
-
-fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_protobuf_c_protobuf_c_message_pack" >&5
+$as_echo "$ac_cv_lib_protobuf_c_protobuf_c_message_pack" >&6; }
+if test "x$ac_cv_lib_protobuf_c_protobuf_c_message_pack" = xyes; then :
 
-if test "x$with_libpthread" = "xyes"
-then
-	for ac_header in pthread.h
+      SAVE_CPPFLAGS="$CPPFLAGS"
+      CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
+      if test "x$PROTOBUF_C_LIBS" = "x"
+      then
+        PROTOBUF_C_LIBS="-lprotobuf-c"
+      fi
+      for ac_header in protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h
 do :
-  ac_fn_c_check_header_mongrel "$LINENO" "pthread.h" "ac_cv_header_pthread_h" "$ac_includes_default"
-if test "x$ac_cv_header_pthread_h" = xyes; then :
+  as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
+ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
-#define HAVE_PTHREAD_H 1
+#define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
 
+          with_libprotobuf_c="yes"
+          break
+
 else
-  with_libpthread="no (pthread.h not found)"
+  with_libprotobuf_c="no (<protobuf-c.h> not found)"
+
 fi
 
 done
 
-fi
-if test "x$with_libpthread" = "xyes"
-then
-	collect_pthread=1
+      CPPFLAGS="$SAVE_CPPFLAGS"
+
 else
-	collect_pthread=0
-fi
+  with_libprotobuf_c="no (libprotobuf-c not found)"
 
-cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBPTHREAD $collect_pthread
-_ACEOF
+fi
 
- if test "x$with_libpthread" = "xyes"; then
-  BUILD_WITH_LIBPTHREAD_TRUE=
-  BUILD_WITH_LIBPTHREAD_FALSE='#'
-else
-  BUILD_WITH_LIBPTHREAD_TRUE='#'
-  BUILD_WITH_LIBPTHREAD_FALSE=
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
 fi
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS="$with_libprotobuf_c_ldflags"
+BUILD_WITH_LIBPROTOBUF_C_LIBS="$PROTOBUF_C_LIBS"
+
+
 
 # }}}
 
-# --with-python {{{
-with_python_prog=""
-with_python_path="$PATH"
-
-# Check whether --with-python was given.
-if test "${with_python+set}" = set; then :
-  withval=$with_python;
- if test "x$withval" = "xyes" || test "x$withval" = "xno"
- then
-	 with_python="$withval"
- else if test -x "$withval"
- then
-	 with_python_prog="$withval"
-	 with_python_path="`dirname \"$withval\"`$PATH_SEPARATOR$with_python_path"
-	 with_python="yes"
- else if test -d "$withval"
- then
-	 with_python_path="$withval$PATH_SEPARATOR$with_python_path"
-	 with_python="yes"
- else
-	 { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: Argument not recognized: $withval" >&5
-$as_echo "$as_me: WARNING: Argument not recognized: $withval" >&2;}
- fi; fi; fi
+# --with-libpython {{{
+
+
+
+
 
+# Check whether --with-libpython was given.
+if test "${with_libpython+set}" = set; then :
+  withval=$with_libpython; with_libpython="$withval"
 else
-  with_python="yes"
+  with_libpython="check"
+
 fi
 
+if test "$with_libpython" != "no"; then
+  if test "$LIBPYTHON_CPPFLAGS" = "" && test "$LIBPYTHON_LDFLAGS" = ""; then
 
-SAVE_PATH="$PATH"
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
-SAVE_LIBS="$LIBS"
+    for ac_prog in python3-config python2-config python-config
 
-PATH="$with_python_path"
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
+$as_echo_n "checking for $ac_word... " >&6; }
+if ${ac_cv_path_PYTHON_CONFIG+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  case $PYTHON_CONFIG in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PYTHON_CONFIG="$PYTHON_CONFIG" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+    for ac_exec_ext in '' $ac_executable_extensions; do
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PYTHON_CONFIG="$as_dir/$ac_word$ac_exec_ext"
+    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+  done
+IFS=$as_save_IFS
 
-if test "x$with_python" = "xyes" && test "x$with_python_prog" = "x"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for python" >&5
-$as_echo_n "checking for python... " >&6; }
-	with_python_prog="`which python 2>/dev/null`"
-	if test "x$with_python_prog" = "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: not found" >&5
-$as_echo "not found" >&6; }
-		with_python="no (interpreter not found)"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $with_python_prog" >&5
-$as_echo "$with_python_prog" >&6; }
-	fi
+  ;;
+esac
+fi
+PYTHON_CONFIG=$ac_cv_path_PYTHON_CONFIG
+if test -n "$PYTHON_CONFIG"; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PYTHON_CONFIG" >&5
+$as_echo "$PYTHON_CONFIG" >&6; }
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
 fi
 
-if test "x$with_python" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for Python CPPFLAGS" >&5
-$as_echo_n "checking for Python CPPFLAGS... " >&6; }
-	python_include_path=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_python_inc())" | "$with_python_prog" 2>&1`
-	python_config_status=$?
 
-	if test "$python_config_status" -ne 0 || test "x$python_include_path" = "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: failed with status $python_config_status (output: $python_include_path)" >&5
-$as_echo "failed with status $python_config_status (output: $python_include_path)" >&6; }
-		with_python="no"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $python_include_path" >&5
-$as_echo "$python_include_path" >&6; }
-	fi
+  test -n "$PYTHON_CONFIG" && break
+done
+
+    if test "$PYTHON_CONFIG" = ""; then
+      if test "$with_libpython" = "yes"; then
+        as_fn_error $? "Unable to find python-config" "$LINENO" 5
+      fi
+      with_libpython="no"
+    fi
+  fi
 fi
 
-if test "x$with_python" = "xyes"
-then
-	CPPFLAGS="-I$python_include_path $CPPFLAGS"
-	for ac_header in Python.h
+if test "$PYTHON_CONFIG" != ""; then
+  LIBPYTHON_CPPFLAGS="`${PYTHON_CONFIG} --includes`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
+  LIBPYTHON_LDFLAGS="`${PYTHON_CONFIG} --ldflags`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
+  LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
+fi
+
+if test "$with_libpython" != "xno"; then
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  CPPFLAGS="$LIBPYTHON_CPPFLAGS $CPPFLAGS"
+  LDFLAGS="$LIBPYTHON_LDFLAGS $LDFLAGS"
+  LIBS="$LIBPYTHON_LIBS $LIBS"
+  for ac_header in Python.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "Python.h" "ac_cv_header_Python_h" "$ac_includes_default"
 if test "x$ac_cv_header_Python_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_PYTHON_H 1
 _ACEOF
- with_python="yes"
-else
-  with_python="no ('Python.h' not found)"
-fi
-
-done
-
-fi
-
-if test "x$with_python" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for Python LDFLAGS" >&5
-$as_echo_n "checking for Python LDFLAGS... " >&6; }
-	python_library_path=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_config_vars(\"LIBDIR\").__getitem__(0))" | "$with_python_prog" 2>&1`
-	python_config_status=$?
 
-	if test "$python_config_status" -ne 0 || test "x$python_library_path" = "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: failed with status $python_config_status (output: $python_library_path)" >&5
-$as_echo "failed with status $python_config_status (output: $python_library_path)" >&6; }
-		with_python="no"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $python_library_path" >&5
-$as_echo "$python_library_path" >&6; }
-	fi
-fi
+      { $as_echo "$as_me:${as_lineno-$LINENO}: checking for libpython" >&5
+$as_echo_n "checking for libpython... " >&6; }
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+#include <Python.h>
+int
+main ()
+{
+Py_Initialize();
+  ;
+  return 0;
+}
 
-if test "x$with_python" = "xyes"
-then
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for Python LIBS" >&5
-$as_echo_n "checking for Python LIBS... " >&6; }
-	python_library_flags=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_config_vars(\"BLDLIBRARY\").__getitem__(0))" | "$with_python_prog" 2>&1`
-	python_config_status=$?
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  with_libpython="yes"
+else
+  with_libpython="no"
 
-	if test "$python_config_status" -ne 0 || test "x$python_library_flags" = "x"
-	then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: failed with status $python_config_status (output: $python_library_flags)" >&5
-$as_echo "failed with status $python_config_status (output: $python_library_flags)" >&6; }
-		with_python="no"
-	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $python_library_flags" >&5
-$as_echo "$python_library_flags" >&6; }
-	fi
 fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+      { $as_echo "$as_me:${as_lineno-$LINENO}: result: $with_libpython" >&5
+$as_echo "$with_libpython" >&6; }
 
-if test "x$with_python" = "xyes"
-then
-	LDFLAGS="-L$python_library_path $LDFLAGS"
-	LIBS="$python_library_flags $LIBS"
-
-	ac_fn_c_check_func "$LINENO" "PyObject_CallFunction" "ac_cv_func_PyObject_CallFunction"
-if test "x$ac_cv_func_PyObject_CallFunction" = xyes; then :
-  with_python="yes"
 else
-  with_python="no (Symbol 'PyObject_CallFunction' not found)"
-fi
+  with_libpython="no"
 
 fi
 
-PATH="$SAVE_PATH"
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
-LIBS="$SAVE_LIBS"
-
-if test "x$with_python" = "xyes"
-then
-	BUILD_WITH_PYTHON_CPPFLAGS="-I$python_include_path"
-	BUILD_WITH_PYTHON_LDFLAGS="-L$python_library_path"
-	BUILD_WITH_PYTHON_LIBS="$python_library_flags"
-
-
+done
 
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
 fi
-# }}} --with-python
+# }}} --with-libpython
 
 # --with-librabbitmq {{{
 with_librabbitmq_cppflags=""
 with_librabbitmq_ldflags=""
 
 # Check whether --with-librabbitmq was given.
@@ -24951,18 +38764,19 @@
 
   if test "x$with_librdkafka_log_cb" = "xyes"
   then
 
 $as_echo "#define HAVE_LIBRDKAFKA_LOG_CB 1" >>confdefs.h
 
-  else if test "x$with_librdkafka_logger" = "xyes"
+  fi
+  if test "x$with_librdkafka_logger" = "xyes"
   then
 
 $as_echo "#define HAVE_LIBRDKAFKA_LOGGER 1" >>confdefs.h
 
-  fi; fi
+  fi
 fi
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
  if test "x$with_librdkafka" = "xyes"; then
   BUILD_WITH_LIBRDKAFKA_TRUE=
   BUILD_WITH_LIBRDKAFKA_FALSE='#'
@@ -25548,17 +39362,12 @@
 
 if test "x$with_libsensors" = "xyes"
 then
 	SAVE_CPPFLAGS="$CPPFLAGS"
 	CPPFLAGS="$CPPFLAGS $with_sensors_cflags"
 
-#	AC_CHECK_HEADERS(sensors/sensors.h,
-#	[
-#		AC_DEFINE(HAVE_SENSORS_SENSORS_H, 1, [Define to 1 if you have the <sensors/sensors.h> header file.])
-#	],
-#	[with_libsensors="no (sensors/sensors.h not found)"])
 	for ac_header in sensors/sensors.h
 do :
   ac_fn_c_check_header_mongrel "$LINENO" "sensors/sensors.h" "ac_cv_header_sensors_sensors_h" "$ac_includes_default"
 if test "x$ac_cv_header_sensors_sensors_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SENSORS_SENSORS_H 1
@@ -25644,493 +39453,88 @@
   BUILD_WITH_LM_SENSORS_TRUE='#'
   BUILD_WITH_LM_SENSORS_FALSE=
 fi
 
 # }}}
 
-# --with-libsigrok {{{
-with_libsigrok_cflags=""
-with_libsigrok_ldflags=""
-
-# Check whether --with-libsigrok was given.
-if test "${with_libsigrok+set}" = set; then :
-  withval=$with_libsigrok;
-	if test "x$withval" = "xno"
-	then
-		with_libsigrok="no"
-	else
-		with_libsigrok="yes"
-		if test "x$withval" != "xyes"
-		then
-			with_libsigrok_cflags="-I$withval/include"
-			with_libsigrok_ldflags="-L$withval/lib"
-		fi
-	fi
+# libsigrok {{{
 
-else
-  with_libsigrok="yes"
-fi
 
 
-# libsigrok has a glib dependency
-if test "x$with_libsigrok" = "xyes"
-then
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBSIGROK" >&5
+$as_echo_n "checking for LIBSIGROK... " >&6; }
 
-	 # Check whether --enable-glibtest was given.
-if test "${enable_glibtest+set}" = set; then :
-  enableval=$enable_glibtest;
+if test -n "$LIBSIGROK_CFLAGS"; then
+    pkg_cv_LIBSIGROK_CFLAGS="$LIBSIGROK_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsigrok < 0.4\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsigrok < 0.4") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBSIGROK_CFLAGS=`$PKG_CONFIG --cflags "libsigrok < 0.4" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  enable_glibtest=yes
+  pkg_failed=yes
 fi
-
-
-  pkg_config_args=glib-2.0
-  for module in .
-  do
-      case "$module" in
-         gmodule)
-             pkg_config_args="$pkg_config_args gmodule-2.0"
-         ;;
-         gmodule-no-export)
-             pkg_config_args="$pkg_config_args gmodule-no-export-2.0"
-         ;;
-         gobject)
-             pkg_config_args="$pkg_config_args gobject-2.0"
-         ;;
-         gthread)
-             pkg_config_args="$pkg_config_args gthread-2.0"
-         ;;
-         gio*)
-             pkg_config_args="$pkg_config_args $module-2.0"
-         ;;
-      esac
-  done
-
-
-
-
-
-
-
-
-if test "x$ac_cv_env_PKG_CONFIG_set" != "xset"; then
-	if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}pkg-config", so it can be a program name with args.
-set dummy ${ac_tool_prefix}pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PKG_CONFIG="$PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
-
-  ;;
-esac
+ else
+    pkg_failed=untried
 fi
-PKG_CONFIG=$ac_cv_path_PKG_CONFIG
-if test -n "$PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG" >&5
-$as_echo "$PKG_CONFIG" >&6; }
+if test -n "$LIBSIGROK_LIBS"; then
+    pkg_cv_LIBSIGROK_LIBS="$LIBSIGROK_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsigrok < 0.4\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsigrok < 0.4") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBSIGROK_LIBS=`$PKG_CONFIG --libs "libsigrok < 0.4" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
 fi
 
 
-fi
-if test -z "$ac_cv_path_PKG_CONFIG"; then
-  ac_pt_PKG_CONFIG=$PKG_CONFIG
-  # Extract the first word of "pkg-config", so it can be a program name with args.
-set dummy pkg-config; ac_word=$2
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for $ac_word" >&5
-$as_echo_n "checking for $ac_word... " >&6; }
-if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  case $ac_pt_PKG_CONFIG in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_ac_pt_PKG_CONFIG="$ac_pt_PKG_CONFIG" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-    for ac_exec_ext in '' $ac_executable_extensions; do
-  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
-    $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-  done
-IFS=$as_save_IFS
 
-  ;;
-esac
-fi
-ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG
-if test -n "$ac_pt_PKG_CONFIG"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG" >&5
-$as_echo "$ac_pt_PKG_CONFIG" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-fi
 
-  if test "x$ac_pt_PKG_CONFIG" = x; then
-    PKG_CONFIG=""
-  else
-    case $cross_compiling:$ac_tool_warned in
-yes:)
-{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet" >&5
-$as_echo "$as_me: WARNING: using cross tools not prefixed with host triplet" >&2;}
-ac_tool_warned=yes ;;
-esac
-    PKG_CONFIG=$ac_pt_PKG_CONFIG
-  fi
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
 else
-  PKG_CONFIG="$ac_cv_path_PKG_CONFIG"
-fi
-
+        _pkg_short_errors_supported=no
 fi
-if test -n "$PKG_CONFIG"; then
-	_pkg_min_version=0.16
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version" >&5
-$as_echo_n "checking pkg-config is at least version $_pkg_min_version... " >&6; }
-	if $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
+        if test $_pkg_short_errors_supported = yes; then
+	        LIBSIGROK_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "libsigrok < 0.4" 2>&1`
 	else
-		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-		PKG_CONFIG=""
+	        LIBSIGROK_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libsigrok < 0.4" 2>&1`
 	fi
-fi
-
-  no_glib=""
-
-  if test "x$PKG_CONFIG" = x ; then
-    no_glib=yes
-    PKG_CONFIG=no
-  fi
-
-  min_glib_version=2.28.0
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for GLIB - version >= $min_glib_version" >&5
-$as_echo_n "checking for GLIB - version >= $min_glib_version... " >&6; }
-
-  if test x$PKG_CONFIG != xno ; then
-    ## don't try to run the test against uninstalled libtool libs
-    if $PKG_CONFIG --uninstalled $pkg_config_args; then
-	  echo "Will use uninstalled version of GLib found in PKG_CONFIG_PATH"
-	  enable_glibtest=no
-    fi
-
-    if $PKG_CONFIG --atleast-version $min_glib_version $pkg_config_args; then
-	  :
-    else
-	  no_glib=yes
-    fi
-  fi
-
-  if test x"$no_glib" = x ; then
-    GLIB_GENMARSHAL=`$PKG_CONFIG --variable=glib_genmarshal glib-2.0`
-    GOBJECT_QUERY=`$PKG_CONFIG --variable=gobject_query glib-2.0`
-    GLIB_MKENUMS=`$PKG_CONFIG --variable=glib_mkenums glib-2.0`
-    GLIB_COMPILE_RESOURCES=`$PKG_CONFIG --variable=glib_compile_resources gio-2.0`
-
-    GLIB_CFLAGS=`$PKG_CONFIG --cflags $pkg_config_args`
-    GLIB_LIBS=`$PKG_CONFIG --libs $pkg_config_args`
-    glib_config_major_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\1/'`
-    glib_config_minor_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\2/'`
-    glib_config_micro_version=`$PKG_CONFIG --modversion glib-2.0 | \
-           sed 's/\([0-9]*\).\([0-9]*\).\([0-9]*\)/\3/'`
-    if test "x$enable_glibtest" = "xyes" ; then
-      ac_save_CFLAGS="$CFLAGS"
-      ac_save_LIBS="$LIBS"
-      CFLAGS="$CFLAGS $GLIB_CFLAGS"
-      LIBS="$GLIB_LIBS $LIBS"
-      rm -f conf.glibtest
-      if test "$cross_compiling" = yes; then :
-  echo $ac_n "cross compiling; assumed OK... $ac_c"
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <glib.h>
-#include <stdio.h>
-#include <stdlib.h>
-
-int
-main ()
-{
-  unsigned int major, minor, micro;
-
-  fclose (fopen ("conf.glibtest", "w"));
-
-  if (sscanf("$min_glib_version", "%u.%u.%u", &major, &minor, &micro) != 3) {
-     printf("%s, bad version string\n", "$min_glib_version");
-     exit(1);
-   }
-
-  if ((glib_major_version != $glib_config_major_version) ||
-      (glib_minor_version != $glib_config_minor_version) ||
-      (glib_micro_version != $glib_config_micro_version))
-    {
-      printf("\n*** 'pkg-config --modversion glib-2.0' returned %d.%d.%d, but GLIB (%d.%d.%d)\n",
-             $glib_config_major_version, $glib_config_minor_version, $glib_config_micro_version,
-             glib_major_version, glib_minor_version, glib_micro_version);
-      printf ("*** was found! If pkg-config was correct, then it is best\n");
-      printf ("*** to remove the old version of GLib. You may also be able to fix the error\n");
-      printf("*** by modifying your LD_LIBRARY_PATH enviroment variable, or by editing\n");
-      printf("*** /etc/ld.so.conf. Make sure you have run ldconfig if that is\n");
-      printf("*** required on your system.\n");
-      printf("*** If pkg-config was wrong, set the environment variable PKG_CONFIG_PATH\n");
-      printf("*** to point to the correct configuration files\n");
-    }
-  else if ((glib_major_version != GLIB_MAJOR_VERSION) ||
-	   (glib_minor_version != GLIB_MINOR_VERSION) ||
-           (glib_micro_version != GLIB_MICRO_VERSION))
-    {
-      printf("*** GLIB header files (version %d.%d.%d) do not match\n",
-	     GLIB_MAJOR_VERSION, GLIB_MINOR_VERSION, GLIB_MICRO_VERSION);
-      printf("*** library (version %d.%d.%d)\n",
-	     glib_major_version, glib_minor_version, glib_micro_version);
-    }
-  else
-    {
-      if ((glib_major_version > major) ||
-        ((glib_major_version == major) && (glib_minor_version > minor)) ||
-        ((glib_major_version == major) && (glib_minor_version == minor) && (glib_micro_version >= micro)))
-      {
-        return 0;
-       }
-     else
-      {
-        printf("\n*** An old version of GLIB (%u.%u.%u) was found.\n",
-               glib_major_version, glib_minor_version, glib_micro_version);
-        printf("*** You need a version of GLIB newer than %u.%u.%u. The latest version of\n",
-	       major, minor, micro);
-        printf("*** GLIB is always available from ftp://ftp.gtk.org.\n");
-        printf("***\n");
-        printf("*** If you have already installed a sufficiently new version, this error\n");
-        printf("*** probably means that the wrong copy of the pkg-config shell script is\n");
-        printf("*** being found. The easiest way to fix this is to remove the old version\n");
-        printf("*** of GLIB, but you can also set the PKG_CONFIG environment to point to the\n");
-        printf("*** correct copy of pkg-config. (In this case, you will have to\n");
-        printf("*** modify your LD_LIBRARY_PATH enviroment variable, or edit /etc/ld.so.conf\n");
-        printf("*** so that the correct libraries are found at run-time))\n");
-      }
-    }
-  return 1;
-}
-
-_ACEOF
-if ac_fn_c_try_run "$LINENO"; then :
-
-else
-  no_glib=yes
-fi
-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \
-  conftest.$ac_objext conftest.beam conftest.$ac_ext
-fi
-
-       CFLAGS="$ac_save_CFLAGS"
-       LIBS="$ac_save_LIBS"
-     fi
-  fi
-  if test "x$no_glib" = x ; then
-     { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes (version $glib_config_major_version.$glib_config_minor_version.$glib_config_micro_version)" >&5
-$as_echo "yes (version $glib_config_major_version.$glib_config_minor_version.$glib_config_micro_version)" >&6; }
-     with_libsigrok_cflags="$with_libsigrok_cflags $GLIB_CFLAGS"; with_libsigrok_ldflags="$with_libsigrok_ldflags $GLIB_LIBS"
-  else
-     { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
-$as_echo "no" >&6; }
-     if test "$PKG_CONFIG" = "no" ; then
-       echo "*** A new enough version of pkg-config was not found."
-       echo "*** See http://www.freedesktop.org/software/pkgconfig/"
-     else
-       if test -f conf.glibtest ; then
-        :
-       else
-          echo "*** Could not run GLIB test program, checking why..."
-          ac_save_CFLAGS="$CFLAGS"
-          ac_save_LIBS="$LIBS"
-          CFLAGS="$CFLAGS $GLIB_CFLAGS"
-          LIBS="$LIBS $GLIB_LIBS"
-          cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <glib.h>
-#include <stdio.h>
-
-int
-main ()
-{
- return ((glib_major_version) || (glib_minor_version) || (glib_micro_version));
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-   echo "*** The test program compiled, but did not run. This usually means"
-          echo "*** that the run-time linker is not finding GLIB or finding the wrong"
-          echo "*** version of GLIB. If it is not finding GLIB, you'll need to set your"
-          echo "*** LD_LIBRARY_PATH environment variable, or edit /etc/ld.so.conf to point"
-          echo "*** to the installed location  Also, make sure you have run ldconfig if that"
-          echo "*** is required on your system"
-	  echo "***"
-          echo "*** If you have an old version installed, it is best to remove it, although"
-          echo "*** you may also be able to get things to work by modifying LD_LIBRARY_PATH"
-else
-   echo "*** The test program failed to compile or link. See the file config.log for the"
-          echo "*** exact error that occured. This usually means GLIB is incorrectly installed."
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-          CFLAGS="$ac_save_CFLAGS"
-          LIBS="$ac_save_LIBS"
-       fi
-     fi
-     GLIB_CFLAGS=""
-     GLIB_LIBS=""
-     GLIB_GENMARSHAL=""
-     GOBJECT_QUERY=""
-     GLIB_MKENUMS=""
-     GLIB_COMPILE_RESOURCES=""
-     :
-  fi
-
-
-
-
-
-
-  rm -f conf.glibtest
-
-
-fi
-
-# libsigrok headers
-if test "x$with_libsigrok" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libsigrok_cflags"
-
-	for ac_header in libsigrok/libsigrok.h
-do :
-  ac_fn_c_check_header_mongrel "$LINENO" "libsigrok/libsigrok.h" "ac_cv_header_libsigrok_libsigrok_h" "$ac_includes_default"
-if test "x$ac_cv_header_libsigrok_libsigrok_h" = xyes; then :
-  cat >>confdefs.h <<_ACEOF
-#define HAVE_LIBSIGROK_LIBSIGROK_H 1
-_ACEOF
-
-else
-  with_libsigrok="no (libsigrok/libsigrok.h not found)"
-fi
-
-done
-
-
-	CPPFLAGS="$SAVE_CPPFLAGS"
-fi
-
-# libsigrok library
-if test "x$with_libsigrok" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	SAVE_LDFLAGS="$LDFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libsigrok_cflags"
-	LDFLAGS="$LDFLAGS $with_libsigrok_ldflags"
-
-	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for sr_init in -lsigrok" >&5
-$as_echo_n "checking for sr_init in -lsigrok... " >&6; }
-if ${ac_cv_lib_sigrok_sr_init+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_check_lib_save_LIBS=$LIBS
-LIBS="-lsigrok  $LIBS"
-cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-/* Override any GCC internal prototype to avoid an error.
-   Use char because int might match the return type of a GCC
-   builtin and then its argument prototype would still apply.  */
-#ifdef __cplusplus
-extern "C"
-#endif
-char sr_init ();
-int
-main ()
-{
-return sr_init ();
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_link "$LINENO"; then :
-  ac_cv_lib_sigrok_sr_init=yes
-else
-  ac_cv_lib_sigrok_sr_init=no
-fi
-rm -f core conftest.err conftest.$ac_objext \
-    conftest$ac_exeext conftest.$ac_ext
-LIBS=$ac_check_lib_save_LIBS
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_sigrok_sr_init" >&5
-$as_echo "$ac_cv_lib_sigrok_sr_init" >&6; }
-if test "x$ac_cv_lib_sigrok_sr_init" = xyes; then :
-
-
-$as_echo "#define HAVE_LIBSIGROK 1" >>confdefs.h
-
-
-else
-  with_libsigrok="no (libsigrok not found)"
-fi
-
+	# Put the nasty error message in config.log where it belongs
+	echo "$LIBSIGROK_PKG_ERRORS" >&5
 
-	CPPFLAGS="$SAVE_CPPFLAGS"
-	LDFLAGS="$SAVE_LDFLAGS"
-fi
-if test "x$with_libsigrok" = "xyes"
-then
-	BUILD_WITH_LIBSIGROK_CFLAGS="$with_libsigrok_cflags"
-	BUILD_WITH_LIBSIGROK_LDFLAGS="$with_libsigrok_ldflags"
+	with_libsigrok="no (pkg-config could not find libsigrok)"
 
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_libsigrok="no (pkg-config could not find libsigrok)"
 
-fi
- if test "x$with_libsigrok" = "xyes"; then
-  BUILD_WITH_LIBSIGROK_TRUE=
-  BUILD_WITH_LIBSIGROK_FALSE='#'
 else
-  BUILD_WITH_LIBSIGROK_TRUE='#'
-  BUILD_WITH_LIBSIGROK_FALSE=
+	LIBSIGROK_CFLAGS=$pkg_cv_LIBSIGROK_CFLAGS
+	LIBSIGROK_LIBS=$pkg_cv_LIBSIGROK_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_libsigrok="yes"
 fi
-
 # }}}
 
 # --with-libstatgrab {{{
 with_libstatgrab_cflags=""
 with_libstatgrab_ldflags=""
 
@@ -26157,32 +39561,24 @@
 fi
 
 
 if test "x$with_libstatgrab" = "xyes" \
   && test "x$with_libstatgrab_pkg_config" = "xyes"
 then
-  if test "x$PKG_CONFIG" != "x"
-  then
-    { $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config for libstatgrab" >&5
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking pkg-config for libstatgrab" >&5
 $as_echo_n "checking pkg-config for libstatgrab... " >&6; }
-    temp_result="found"
-    $PKG_CONFIG --exists libstatgrab 2>/dev/null
-    if test "$?" != "0"
-    then
-      with_libstatgrab_pkg_config="no"
-      with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
-      temp_result="not found"
-    fi
-    { $as_echo "$as_me:${as_lineno-$LINENO}: result: $temp_result" >&5
-$as_echo "$temp_result" >&6; }
-  else
-    { $as_echo "$as_me:${as_lineno-$LINENO}: pkg-config not available, trying to guess flags for the statgrab library." >&5
-$as_echo "$as_me: pkg-config not available, trying to guess flags for the statgrab library." >&6;}
+  temp_result="found"
+  $PKG_CONFIG --exists libstatgrab 2>/dev/null
+  if test "$?" != "0"
+  then
     with_libstatgrab_pkg_config="no"
-    with_libstatgrab_ldflags="$with_libstatgrab_ldflags -lstatgrab"
+    with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
+    temp_result="not found"
   fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $temp_result" >&5
+$as_echo "$temp_result" >&6; }
 fi
 
 if test "x$with_libstatgrab" = "xyes" \
   && test "x$with_libstatgrab_pkg_config" = "xyes" \
   && test "x$with_libstatgrab_cflags" = "x"
 then
@@ -26296,12 +39692,13 @@
   LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libstatgrab" = "xyes"
 then
   SAVE_CFLAGS="$CFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
   SAVE_LIBS="$LIBS"
 
   CFLAGS="$CFLAGS $with_libstatgrab_cflags"
   LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
   LIBS="-lstatgrab $LIBS"
 
@@ -26695,19 +40092,12 @@
 	with_libupsclient="yes"
 fi
 
 # configure using pkg-config
 if test "x$with_libupsclient" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libupsclient="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libupsclient" = "xuse_pkgconfig"
-then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: Checking for libupsclient using $PKG_CONFIG" >&5
 $as_echo "$as_me: Checking for libupsclient using $PKG_CONFIG" >&6;}
 	$PKG_CONFIG --exists 'libupsclient' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libupsclient="no (pkg-config doesn't know libupsclient)"
@@ -26848,12 +40238,116 @@
 	BUILD_WITH_LIBUPSCLIENT_LIBS="$with_libupsclient_libs"
 
 
 fi
 # }}}
 
+# --with-libxenctrl {{{
+with_libxenctrl_cppflags=""
+with_libxenctrl_ldflags=""
+
+# Check whether --with-libxenctrl was given.
+if test "${with_libxenctrl+set}" = set; then :
+  withval=$with_libxenctrl;
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libxenctrl_cppflags="-I$withval/include"
+		with_libxenctrl_ldflags="-L$withval/lib"
+		with_libxenctrl="yes"
+	else
+		with_libxenctrl="$withval"
+	fi
+
+else
+
+	with_libxenctrl="yes"
+
+fi
+
+if test "x$with_libxenctrl" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
+
+	for ac_header in xenctrl.h
+do :
+  ac_fn_c_check_header_mongrel "$LINENO" "xenctrl.h" "ac_cv_header_xenctrl_h" "$ac_includes_default"
+if test "x$ac_cv_header_xenctrl_h" = xyes; then :
+  cat >>confdefs.h <<_ACEOF
+#define HAVE_XENCTRL_H 1
+_ACEOF
+ with_libxenctrl="yes"
+else
+  with_libxenctrl="no (xenctrl.h not found)"
+fi
+
+done
+
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libxenctrl" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
+	LDFLAGS="$LDFLAGS $with_libxenctrl_ldflags"
+
+	#Xen versions older than 3.4 has no xc_getcpuinfo()
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for xc_getcpuinfo in -lxenctrl" >&5
+$as_echo_n "checking for xc_getcpuinfo in -lxenctrl... " >&6; }
+if ${ac_cv_lib_xenctrl_xc_getcpuinfo+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_check_lib_save_LIBS=$LIBS
+LIBS="-lxenctrl  $LIBS"
+cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+/* Override any GCC internal prototype to avoid an error.
+   Use char because int might match the return type of a GCC
+   builtin and then its argument prototype would still apply.  */
+#ifdef __cplusplus
+extern "C"
+#endif
+char xc_getcpuinfo ();
+int
+main ()
+{
+return xc_getcpuinfo ();
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_c_try_link "$LINENO"; then :
+  ac_cv_lib_xenctrl_xc_getcpuinfo=yes
+else
+  ac_cv_lib_xenctrl_xc_getcpuinfo=no
+fi
+rm -f core conftest.err conftest.$ac_objext \
+    conftest$ac_exeext conftest.$ac_ext
+LIBS=$ac_check_lib_save_LIBS
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_xenctrl_xc_getcpuinfo" >&5
+$as_echo "$ac_cv_lib_xenctrl_xc_getcpuinfo" >&6; }
+if test "x$ac_cv_lib_xenctrl_xc_getcpuinfo" = xyes; then :
+  with_libxenctrl="yes"
+else
+  with_libxenctrl="no (symbol 'xc_getcpuinfo' not found)"
+fi
+
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+	LIBXENCTL_CPPFLAGS="$with_libxenctl_cppflags"
+	LIBXENCTL_LDFLAGS="$with_libxenctl_ldflags"
+
+
+fi
+# }}}
+
 # --with-libxmms {{{
 with_xmms_config="xmms-config"
 with_xmms_cflags=""
 with_xmms_libs=""
 
 # Check whether --with-libxmms was given.
@@ -27123,13 +40617,13 @@
 	else if test -d "$with_mic/lib"
 	then
 		{ $as_echo "$as_me:${as_lineno-$LINENO}: Not checking for Intel Mic: Manually configured" >&5
 $as_echo "$as_me: Not checking for Intel Mic: Manually configured" >&6;}
 		with_mic_cflags="-I$withval/include"
 		with_mic_ldpath="-L$withval/lib/Linux"
-		with_mic_libs="-lMicAccessSDK -lscif -lpthread"
+		with_mic_libs="$PTHREAD_LIBS -lMicAccessSDK -lscif"
 		with_mic="yes"
 	fi; fi; fi
 
 else
   with_mic="yes"
 fi
@@ -27165,13 +40659,13 @@
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for MicInitAPI in -lMicAccessSDK" >&5
 $as_echo_n "checking for MicInitAPI in -lMicAccessSDK... " >&6; }
 if ${ac_cv_lib_MicAccessSDK_MicInitAPI+:} false; then :
   $as_echo_n "(cached) " >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lMicAccessSDK -lscif -lpthread $LIBS"
+LIBS="-lMicAccessSDK $PTHREAD_LIBS -lscif $LIBS"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
 /* Override any GCC internal prototype to avoid an error.
    Use char because int might match the return type of a GCC
    builtin and then its argument prototype would still apply.  */
@@ -27197,13 +40691,13 @@
 LIBS=$ac_check_lib_save_LIBS
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_MicAccessSDK_MicInitAPI" >&5
 $as_echo "$ac_cv_lib_MicAccessSDK_MicInitAPI" >&6; }
 if test "x$ac_cv_lib_MicAccessSDK_MicInitAPI" = xyes; then :
   with_mic_ldpath="$with_mic_ldpath"
-			with_mic_libs="-lMicAccessSDK -lscif -lpthread"
+			with_mic_libs="$PTHREAD_LIBS -lMicAccessSDK -lscif"
 else
   with_mic="no (symbol MicInitAPI not found)"
 fi
 
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
@@ -27249,19 +40743,12 @@
 fi
 
 
 # configure using pkg-config
 if test "x$with_libvarnish" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libvarnish="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libvarnish" = "xuse_pkgconfig"
-then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: Checking for varnishapi using $PKG_CONFIG" >&5
 $as_echo "$as_me: Checking for varnishapi using $PKG_CONFIG" >&6;}
 	$PKG_CONFIG --exists 'varnishapi' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libvarnish="no (pkg-config doesn't know varnishapi)"
@@ -27353,31 +40840,28 @@
 
 # pkg-config --exists 'libxml-2.0'; pkg-config --exists libvirt {{{
 with_libxml2="no (pkg-config isn't available)"
 with_libxml2_cflags=""
 with_libxml2_ldflags=""
 with_libvirt="no (pkg-config isn't available)"
-with_libvirt_cflags=""
-with_libvirt_ldflags=""
-if test "x$PKG_CONFIG" != "x"
-then
-	$PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
-	if test "$?" = "0"
-	then
-		with_libxml2="yes"
-	else
-		with_libxml2="no (pkg-config doesn't know libxml-2.0)"
-	fi
+with_libvirt_cflags=""
+with_libvirt_ldflags=""
+$PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
+if test "$?" = "0"
+then
+	with_libxml2="yes"
+else
+	with_libxml2="no (pkg-config doesn't know libxml-2.0)"
+fi
 
-	$PKG_CONFIG --exists libvirt 2>/dev/null
-	if test "$?" = "0"
-	then
-		with_libvirt="yes"
-	else
-		with_libvirt="no (pkg-config doesn't know libvirt)"
-	fi
+$PKG_CONFIG --exists libvirt 2>/dev/null
+if test "$?" = "0"
+then
+	with_libvirt="yes"
+else
+	with_libvirt="no (pkg-config doesn't know libvirt)"
 fi
 if test "x$with_libxml2" = "xyes"
 then
 	with_libxml2_cflags="`$PKG_CONFIG --cflags libxml-2.0`"
 	if test $? -ne 0
 	then
@@ -27570,25 +41054,12 @@
 
 # $PKG_CONFIG --exists OpenIPMIpthread {{{
 with_libopenipmipthread="yes"
 with_libopenipmipthread_cflags=""
 with_libopenipmipthread_libs=""
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for pkg-config" >&5
-$as_echo_n "checking for pkg-config... " >&6; }
-temp_result="no"
-if test "x$PKG_CONFIG" = "x"
-then
-	with_libopenipmipthread="no"
-	temp_result="no"
-else
-	temp_result="$PKG_CONFIG"
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $temp_result" >&5
-$as_echo "$temp_result" >&6; }
-
 if test "x$with_libopenipmipthread" = "xyes"
 then
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for libOpenIPMIpthread" >&5
 $as_echo_n "checking for libOpenIPMIpthread... " >&6; }
 	$PKG_CONFIG --exists OpenIPMIpthread 2>/dev/null
 	if test "$?" != "0"
@@ -27848,33 +41319,99 @@
         else
 	        LIBNOTIFY_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "libnotify" 2>&1`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$LIBNOTIFY_PKG_ERRORS" >&5
 
-	if test "x$LIBNOTIFY_PKG_ERRORS" = "x"; then
-			 with_libnotify="no"
-		 else
-			 with_libnotify="no ($LIBNOTIFY_PKG_ERRORS)"
-		 fi
+	with_libnotify="no (pkg-config doesn't know libnotify)"
+
 elif test $pkg_failed = untried; then
      	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
-	if test "x$LIBNOTIFY_PKG_ERRORS" = "x"; then
-			 with_libnotify="no"
-		 else
-			 with_libnotify="no ($LIBNOTIFY_PKG_ERRORS)"
-		 fi
+	with_libnotify="no (pkg-config doesn't know libnotify)"
+
 else
 	LIBNOTIFY_CFLAGS=$pkg_cv_LIBNOTIFY_CFLAGS
 	LIBNOTIFY_LIBS=$pkg_cv_LIBNOTIFY_LIBS
         { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
 	with_libnotify="yes"
 fi
 
+
+pkg_failed=no
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for LIBRIEMANN_CLIENT" >&5
+$as_echo_n "checking for LIBRIEMANN_CLIENT... " >&6; }
+
+if test -n "$LIBRIEMANN_CLIENT_CFLAGS"; then
+    pkg_cv_LIBRIEMANN_CLIENT_CFLAGS="$LIBRIEMANN_CLIENT_CFLAGS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"riemann-client >= 1.6.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "riemann-client >= 1.6.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBRIEMANN_CLIENT_CFLAGS=`$PKG_CONFIG --cflags "riemann-client >= 1.6.0" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+if test -n "$LIBRIEMANN_CLIENT_LIBS"; then
+    pkg_cv_LIBRIEMANN_CLIENT_LIBS="$LIBRIEMANN_CLIENT_LIBS"
+ elif test -n "$PKG_CONFIG"; then
+    if test -n "$PKG_CONFIG" && \
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"riemann-client >= 1.6.0\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "riemann-client >= 1.6.0") 2>&5
+  ac_status=$?
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }; then
+  pkg_cv_LIBRIEMANN_CLIENT_LIBS=`$PKG_CONFIG --libs "riemann-client >= 1.6.0" 2>/dev/null`
+		      test "x$?" != "x0" && pkg_failed=yes
+else
+  pkg_failed=yes
+fi
+ else
+    pkg_failed=untried
+fi
+
+
+
+if test $pkg_failed = yes; then
+   	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+
+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then
+        _pkg_short_errors_supported=yes
+else
+        _pkg_short_errors_supported=no
+fi
+        if test $_pkg_short_errors_supported = yes; then
+	        LIBRIEMANN_CLIENT_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs "riemann-client >= 1.6.0" 2>&1`
+        else
+	        LIBRIEMANN_CLIENT_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs "riemann-client >= 1.6.0" 2>&1`
+        fi
+	# Put the nasty error message in config.log where it belongs
+	echo "$LIBRIEMANN_CLIENT_PKG_ERRORS" >&5
+
+	with_libriemann_client="no (pkg-config doesn't know libriemann-client)"
+elif test $pkg_failed = untried; then
+     	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+	with_libriemann_client="no (pkg-config doesn't know libriemann-client)"
+else
+	LIBRIEMANN_CLIENT_CFLAGS=$pkg_cv_LIBRIEMANN_CLIENT_CFLAGS
+	LIBRIEMANN_CLIENT_LIBS=$pkg_cv_LIBRIEMANN_CLIENT_LIBS
+        { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	with_libriemann_client="yes"
+fi
+
 # Check for enabled/disabled features
 #
 
 # AC_COLLECTD(name, enable/disable, info-text, feature/module)
 # ------------------------------------------------------------
 
@@ -27989,12 +41526,47 @@
 else
   BUILD_FEATURE_GETIFADDRS_TRUE='#'
   BUILD_FEATURE_GETIFADDRS_FALSE=
 fi
 
 
+																# Check whether --enable-werror was given.
+if test "${enable_werror+set}" = set; then :
+  enableval=$enable_werror;
+else
+  enable_werror='yes'
+fi
+# AC_ARG_ENABLE
+if test "x$enable_werror" = "xno"
+then
+	collectd_werror=0
+else
+	if test "x$enable_werror" = "xyes"
+	then
+		collectd_werror=1
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: please specify either --enable-werror or --disable-werror; enabling werror." >&5
+$as_echo "$as_me: please specify either --enable-werror or --disable-werror; enabling werror." >&6;}
+		collectd_werror=1
+		enable_werror='yes'
+	fi
+fi
+
+cat >>confdefs.h <<_ACEOF
+#define COLLECT_WERROR $collectd_werror
+_ACEOF
+
+	 if test "x$enable_werror" = "xyes"; then
+  BUILD_FEATURE_WERROR_TRUE=
+  BUILD_FEATURE_WERROR_FALSE='#'
+else
+  BUILD_FEATURE_WERROR_TRUE='#'
+  BUILD_FEATURE_WERROR_FALSE=
+fi
+
+
 dependency_warning="no"
 dependency_error="no"
 
 plugin_ascent="no"
 plugin_barometer="no"
 plugin_battery="no"
@@ -28002,34 +41574,39 @@
 plugin_ceph="no"
 plugin_cgroups="no"
 plugin_conntrack="no"
 plugin_contextswitch="no"
 plugin_cpu="no"
 plugin_cpufreq="no"
+plugin_cpusleep="no"
 plugin_curl_json="no"
 plugin_curl_xml="no"
 plugin_df="no"
 plugin_disk="no"
 plugin_drbd="no"
 plugin_entropy="no"
 plugin_ethstat="no"
 plugin_fhcount="no"
 plugin_fscache="no"
+plugin_gps="no"
+plugin_grpc="no"
 plugin_interface="no"
 plugin_ipmi="no"
 plugin_ipvs="no"
 plugin_irq="no"
 plugin_load="no"
 plugin_log_logstash="no"
 plugin_memory="no"
 plugin_multimeter="no"
 plugin_nfs="no"
 plugin_numa="no"
 plugin_perl="no"
+plugin_pinba="no"
 plugin_processes="no"
 plugin_protocols="no"
+plugin_python="no"
 plugin_serial="no"
 plugin_smart="no"
 plugin_swap="no"
 plugin_tape="no"
 plugin_tcpconns="no"
 plugin_ted="no"
@@ -28038,22 +41615,24 @@
 plugin_uptime="no"
 plugin_users="no"
 plugin_virt="no"
 plugin_vmem="no"
 plugin_vserver="no"
 plugin_wireless="no"
+plugin_xencpu="no"
 plugin_zfs_arc="no"
+plugin_zone="no"
 plugin_zookeeper="no"
 
 # Linux
 if test "x$ac_system" = "xLinux"
 then
 	plugin_battery="yes"
+	plugin_cgroups="yes"
 	plugin_conntrack="yes"
 	plugin_contextswitch="yes"
-	plugin_cgroups="yes"
 	plugin_cpu="yes"
 	plugin_cpufreq="yes"
 	plugin_disk="yes"
 	plugin_drbd="yes"
 	plugin_entropy="yes"
 	plugin_fhcount="yes"
@@ -28083,51 +41662,65 @@
 		plugin_ipvs="yes"
 	fi
 	if test "x$c_cv_have_usable_asm_msrindex_h" = "xyes" && test "x$have_cpuid_h" = "xyes"
 	then
 		plugin_turbostat="yes"
 	fi
+
+	if test "x$c_cv_have_clock_boottime_monotonic" = "xyes"
+	then
+		plugin_cpusleep="yes"
+	fi
 fi
 
 if test "x$ac_system" = "xOpenBSD"
 then
 	plugin_tcpconns="yes"
 fi
 
+if test "x$ac_system" = "xNetBSD"
+then
+	plugin_disk="yes"
+	plugin_entropy="yes"
+	plugin_irq="yes"
+	plugin_processes="yes"
+fi
+
 # Mac OS X devices
 if test "x$with_libiokit" = "xyes"
 then
 	plugin_battery="yes"
 	plugin_disk="yes"
 fi
 
 # AIX
 
 if test "x$ac_system" = "xAIX"
 then
-	plugin_tcpconns="yes"
 	plugin_ipc="yes"
+	plugin_tcpconns="yes"
 fi
 
 # FreeBSD
 
 if test "x$ac_system" = "xFreeBSD"
 then
+	plugin_disk="yes"
 	plugin_zfs_arc="yes"
 fi
 
 
 if test "x$with_perfstat" = "xyes"
 then
-	plugin_cpu="yes"
 	plugin_contextswitch="yes"
+	plugin_cpu="yes"
 	plugin_disk="yes"
-	plugin_memory="yes"
-	plugin_swap="yes"
 	plugin_interface="yes"
 	plugin_load="yes"
+	plugin_memory="yes"
+	plugin_swap="yes"
 	plugin_uptime="yes"
 fi
 
 if test "x$with_procinfo" = "xyes"
 then
 	plugin_processes="yes"
@@ -28137,36 +41730,38 @@
 if test "x$with_kstat" = "xyes"
 then
 	plugin_nfs="yes"
 	plugin_processes="yes"
 	plugin_uptime="yes"
 	plugin_zfs_arc="yes"
+	plugin_zone="yes"
 fi
 
 if test "x$with_devinfo$with_kstat" = "xyesyes"
 then
 	plugin_cpu="yes"
 	plugin_disk="yes"
 	plugin_interface="yes"
 	plugin_memory="yes"
 	plugin_tape="yes"
 fi
 
 # libi2c-dev
-with_libi2c="no"
 if test "x$ac_system" = "xLinux"
 then
 ac_fn_c_check_decl "$LINENO" "i2c_smbus_read_i2c_block_data" "ac_cv_have_decl_i2c_smbus_read_i2c_block_data" "#include <stdlib.h>
 	#include <linux/i2c-dev.h>
 "
 if test "x$ac_cv_have_decl_i2c_smbus_read_i2c_block_data" = xyes; then :
   with_libi2c="yes"
 else
   with_libi2c="no (symbol i2c_smbus_read_i2c_block_data not found - have you installed libi2c-dev ?)"
 fi
 
+else
+	with_libi2c="no (Linux only)"
 fi
 
 if test "x$with_libi2c" = "xyes"
 then
 	plugin_barometer="yes"
 fi
@@ -28277,17 +41872,27 @@
 
 if test "x$have_linux_sockios_h$have_linux_ethtool_h" = "xyesyes"
 then
 	plugin_ethstat="yes"
 fi
 
+if test "x$with_libgrpcpp" = "xyes" && test "x$with_libprotobuf" = "xyes" && test "x$have_protoc3" = "xyes" && test "x$GRPC_CPP_PLUGIN" != "x"
+then
+	plugin_grpc="yes"
+fi
+
 if test "x$have_getifaddrs" = "xyes"
 then
 	plugin_interface="yes"
 fi
 
+if test "x$with_libgps" = "xyes"
+then
+	plugin_gps="yes"
+fi
+
 if test "x$have_getloadavg" = "xyes"
 then
 	plugin_load="yes"
 fi
 
 if test "x$with_libyajl" = "xyes"
@@ -28297,12 +41902,17 @@
 
 if test "x$c_cv_have_libperl$c_cv_have_perl_ithreads" = "xyesyes"
 then
 	plugin_perl="yes"
 fi
 
+if test "x$have_protoc_c" = "xyes" && test "x$with_libprotobuf_c" = "xyes"
+then
+	plugin_pinba="yes"
+fi
+
 # Mac OS X memory interface
 if test "x$have_host_statistics" = "xyes"
 then
 	plugin_memory="yes"
 fi
 
@@ -28327,12 +41937,17 @@
 
 if test "x$with_kvm_getprocs" = "xyes" && test "x$have_struct_kinfo_proc_openbsd" = "xyes"
 then
 	plugin_processes="yes"
 fi
 
+if test "x$with_libpython" != "xno"
+then
+	plugin_python="yes"
+fi
+
 if test "x$with_libatasmart" = "xyes" && test "x$with_libudev" = "xyes"
 then
 	plugin_smart="yes"
 fi
 
 if test "x$with_kvm_getswapinfo" = "xyes"
@@ -28342,12 +41957,17 @@
 
 if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_two_args" = "xyes"
 then
 	plugin_swap="yes"
 fi
 
+if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_three_args" = "xyes"
+then
+	plugin_swap="yes"
+fi
+
 if test "x$with_kvm_openfiles$with_kvm_nlist" = "xyesyes"
 then
 	plugin_tcpconns="yes"
 fi
 
 if test "x$have_getutent" = "xyes"
@@ -28361,12 +41981,16 @@
 
 if test "x$with_libxml2" = "xyes" && test "x$with_libvirt" = "xyes"
 then
 	plugin_virt="yes"
 fi
 
+if test "x$with_libxenctrl" = "xyes"
+then
+  plugin_xencpu="yes"
+fi
 
 
 
 # Check whether --enable-all-plugins was given.
 if test "${enable_all_plugins+set}" = set; then :
   enableval=$enable_all_plugins;
@@ -28409,13 +42033,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28430,13 +42054,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_AGGREGATION_TRUE=
   BUILD_PLUGIN_AGGREGATION_FALSE='#'
 else
@@ -28469,13 +42093,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_librabbitmq" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_librabbitmq"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28490,13 +42114,13 @@
 		    if test "x$with_librabbitmq" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_librabbitmq (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_AMQP_TRUE=
   BUILD_PLUGIN_AMQP_FALSE='#'
 else
@@ -28529,13 +42153,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libcurl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libcurl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28550,13 +42174,13 @@
 		    if test "x$with_libcurl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libcurl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_APACHE_TRUE=
   BUILD_PLUGIN_APACHE_FALSE='#'
 else
@@ -28589,13 +42213,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28610,13 +42234,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_APCUPS_TRUE=
   BUILD_PLUGIN_APCUPS_FALSE='#'
 else
@@ -28649,13 +42273,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libiokit" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libiokit"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28670,13 +42294,13 @@
 		    if test "x$with_libiokit" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libiokit (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_APPLE_SENSORS_TRUE=
   BUILD_PLUGIN_APPLE_SENSORS_FALSE='#'
 else
@@ -28709,13 +42333,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libaquaero5" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libaquaero5"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28730,13 +42354,13 @@
 		    if test "x$with_libaquaero5" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libaquaero5 (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_AQUAERO_TRUE=
   BUILD_PLUGIN_AQUAERO_FALSE='#'
 else
@@ -28769,13 +42393,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ascent" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ascent"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28790,13 +42414,13 @@
 		    if test "x$plugin_ascent" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ascent (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ASCENT_TRUE=
   BUILD_PLUGIN_ASCENT_FALSE='#'
 else
@@ -28829,13 +42453,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_barometer" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_barometer"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28850,13 +42474,13 @@
 		    if test "x$plugin_barometer" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_barometer (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_BAROMETER_TRUE=
   BUILD_PLUGIN_BAROMETER_FALSE='#'
 else
@@ -28889,13 +42513,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_battery" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_battery"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28910,13 +42534,13 @@
 		    if test "x$plugin_battery" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_battery (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_BATTERY_TRUE=
   BUILD_PLUGIN_BATTERY_FALSE='#'
 else
@@ -28949,13 +42573,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_bind" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_bind"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -28970,13 +42594,13 @@
 		    if test "x$plugin_bind" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_bind (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_BIND_TRUE=
   BUILD_PLUGIN_BIND_FALSE='#'
 else
@@ -29009,13 +42633,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ceph" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ceph"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29030,13 +42654,13 @@
 		    if test "x$plugin_ceph" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ceph (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CEPH_TRUE=
   BUILD_PLUGIN_CEPH_FALSE='#'
 else
@@ -29047,12 +42671,132 @@
     enable_ceph="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-cgroups was given.
+if test "${enable_cgroups+set}" = set; then :
+  enableval=$enable_cgroups;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_cgroups" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_cgroups"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_cgroups" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_CGROUPS 1" >>confdefs.h
+
+		    if test "x$plugin_cgroups" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_cgroups (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_CGROUPS_TRUE=
+  BUILD_PLUGIN_CGROUPS_FALSE='#'
+else
+  BUILD_PLUGIN_CGROUPS_TRUE='#'
+  BUILD_PLUGIN_CGROUPS_FALSE=
+fi
+
+    enable_cgroups="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
+    # Check whether --enable-chrony was given.
+if test "${enable_chrony+set}" = set; then :
+  enableval=$enable_chrony;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "xyes" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="yes"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "xyes" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_CHRONY 1" >>confdefs.h
+
+		    if test "xyes" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="yes (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_CHRONY_TRUE=
+  BUILD_PLUGIN_CHRONY_FALSE='#'
+else
+  BUILD_PLUGIN_CHRONY_TRUE='#'
+  BUILD_PLUGIN_CHRONY_FALSE=
+fi
+
+    enable_chrony="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-conntrack was given.
 if test "${enable_conntrack+set}" = set; then :
   enableval=$enable_conntrack;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -29069,13 +42813,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_conntrack" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_conntrack"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29090,13 +42834,13 @@
 		    if test "x$plugin_conntrack" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_conntrack (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CONNTRACK_TRUE=
   BUILD_PLUGIN_CONNTRACK_FALSE='#'
 else
@@ -29129,13 +42873,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_contextswitch" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_contextswitch"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29150,13 +42894,13 @@
 		    if test "x$plugin_contextswitch" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_contextswitch (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CONTEXTSWITCH_TRUE=
   BUILD_PLUGIN_CONTEXTSWITCH_FALSE='#'
 else
@@ -29167,12 +42911,72 @@
     enable_contextswitch="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-cpu was given.
+if test "${enable_cpu+set}" = set; then :
+  enableval=$enable_cpu;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_cpu" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_cpu"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_cpu" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_CPU 1" >>confdefs.h
+
+		    if test "x$plugin_cpu" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_cpu (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_CPU_TRUE=
+  BUILD_PLUGIN_CPU_FALSE='#'
+else
+  BUILD_PLUGIN_CPU_TRUE='#'
+  BUILD_PLUGIN_CPU_FALSE=
+fi
+
+    enable_cpu="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-cpufreq was given.
 if test "${enable_cpufreq+set}" = set; then :
   enableval=$enable_cpufreq;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -29189,13 +42993,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_cpufreq" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_cpufreq"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29210,13 +43014,13 @@
 		    if test "x$plugin_cpufreq" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_cpufreq (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CPUFREQ_TRUE=
   BUILD_PLUGIN_CPUFREQ_FALSE='#'
 else
@@ -29227,15 +43031,15 @@
     enable_cpufreq="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-cpu was given.
-if test "${enable_cpu+set}" = set; then :
-  enableval=$enable_cpu;
+    # Check whether --enable-cpusleep was given.
+if test "${enable_cpusleep+set}" = set; then :
+  enableval=$enable_cpusleep;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
      else if test "x$enableval" = "xforce"
      then
 	     enable_plugin="yes"
@@ -29245,49 +43049,49 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$plugin_cpu" = "xyes"
+	     if test "x$plugin_cpusleep" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_cpusleep"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$plugin_cpu" = "xyes" || test "x$force" = "xyes"
+	    if test "x$plugin_cpusleep" = "xyes" || test "x$force" = "xyes"
 	    then
 
-$as_echo "#define HAVE_PLUGIN_CPU 1" >>confdefs.h
+$as_echo "#define HAVE_PLUGIN_CPUSLEEP 1" >>confdefs.h
 
-		    if test "x$plugin_cpu" != "xyes"
+		    if test "x$plugin_cpusleep" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_cpusleep (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_CPU_TRUE=
-  BUILD_PLUGIN_CPU_FALSE='#'
+  BUILD_PLUGIN_CPUSLEEP_TRUE=
+  BUILD_PLUGIN_CPUSLEEP_FALSE='#'
 else
-  BUILD_PLUGIN_CPU_TRUE='#'
-  BUILD_PLUGIN_CPU_FALSE=
+  BUILD_PLUGIN_CPUSLEEP_TRUE='#'
+  BUILD_PLUGIN_CPUSLEEP_FALSE=
 fi
 
-    enable_cpu="$enable_plugin"
+    enable_cpusleep="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
     # Check whether --enable-csv was given.
@@ -29309,13 +43113,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29330,13 +43134,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CSV_TRUE=
   BUILD_PLUGIN_CSV_FALSE='#'
 else
@@ -29369,13 +43173,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libcurl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libcurl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29390,13 +43194,13 @@
 		    if test "x$with_libcurl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libcurl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CURL_TRUE=
   BUILD_PLUGIN_CURL_FALSE='#'
 else
@@ -29429,13 +43233,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_curl_json" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_curl_json"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29450,13 +43254,13 @@
 		    if test "x$plugin_curl_json" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_curl_json (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CURL_JSON_TRUE=
   BUILD_PLUGIN_CURL_JSON_FALSE='#'
 else
@@ -29489,13 +43293,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_curl_xml" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_curl_xml"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29510,13 +43314,13 @@
 		    if test "x$plugin_curl_xml" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_curl_xml (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_CURL_XML_TRUE=
   BUILD_PLUGIN_CURL_XML_FALSE='#'
 else
@@ -29527,72 +43331,12 @@
     enable_curl_xml="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-cgroups was given.
-if test "${enable_cgroups+set}" = set; then :
-  enableval=$enable_cgroups;
-     if test "x$enableval" = "xyes"
-     then
-	     enable_plugin="yes"
-     else if test "x$enableval" = "xforce"
-     then
-	     enable_plugin="yes"
-	     force="yes"
-     else
-	     enable_plugin="no (disabled on command line)"
-     fi; fi
-
-else
-
-	 if test "x$enable_all_plugins" = "xauto"
-	 then
-	     if test "x$plugin_cgroups" = "xyes"
-	     then
-		     enable_plugin="yes"
-	     else
-		     enable_plugin="no"
-	     fi
-	 else
-	     enable_plugin="$enable_all_plugins"
-	 fi
-
-fi
-
-    if test "x$enable_plugin" = "xyes"
-    then
-	    if test "x$plugin_cgroups" = "xyes" || test "x$force" = "xyes"
-	    then
-
-$as_echo "#define HAVE_PLUGIN_CGROUPS 1" >>confdefs.h
-
-		    if test "x$plugin_cgroups" != "xyes"
-		    then
-			    dependency_warning="yes"
-		    fi
-	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
-		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
-	    fi
-    fi
-     if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_CGROUPS_TRUE=
-  BUILD_PLUGIN_CGROUPS_FALSE='#'
-else
-  BUILD_PLUGIN_CGROUPS_TRUE='#'
-  BUILD_PLUGIN_CGROUPS_FALSE=
-fi
-
-    enable_cgroups="$enable_plugin"
-
-
-
-    enable_plugin="no"
-    force="no"
     # Check whether --enable-dbi was given.
 if test "${enable_dbi+set}" = set; then :
   enableval=$enable_dbi;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -29609,13 +43353,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libdbi" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libdbi"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29630,13 +43374,13 @@
 		    if test "x$with_libdbi" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libdbi (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_DBI_TRUE=
   BUILD_PLUGIN_DBI_FALSE='#'
 else
@@ -29669,13 +43413,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_df" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_df"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29690,13 +43434,13 @@
 		    if test "x$plugin_df" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_df (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_DF_TRUE=
   BUILD_PLUGIN_DF_FALSE='#'
 else
@@ -29729,13 +43473,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_disk" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_disk"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29750,13 +43494,13 @@
 		    if test "x$plugin_disk" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_disk (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_DISK_TRUE=
   BUILD_PLUGIN_DISK_FALSE='#'
 else
@@ -29767,15 +43511,15 @@
     enable_disk="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-drbd was given.
-if test "${enable_drbd+set}" = set; then :
-  enableval=$enable_drbd;
+    # Check whether --enable-dns was given.
+if test "${enable_dns+set}" = set; then :
+  enableval=$enable_dns;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
      else if test "x$enableval" = "xforce"
      then
 	     enable_plugin="yes"
@@ -29785,57 +43529,57 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$plugin_drbd" = "xyes"
+	     if test "x$with_libpcap" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libpcap"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$plugin_drbd" = "xyes" || test "x$force" = "xyes"
+	    if test "x$with_libpcap" = "xyes" || test "x$force" = "xyes"
 	    then
 
-$as_echo "#define HAVE_PLUGIN_DRBD 1" >>confdefs.h
+$as_echo "#define HAVE_PLUGIN_DNS 1" >>confdefs.h
 
-		    if test "x$plugin_drbd" != "xyes"
+		    if test "x$with_libpcap" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libpcap (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_DRBD_TRUE=
-  BUILD_PLUGIN_DRBD_FALSE='#'
+  BUILD_PLUGIN_DNS_TRUE=
+  BUILD_PLUGIN_DNS_FALSE='#'
 else
-  BUILD_PLUGIN_DRBD_TRUE='#'
-  BUILD_PLUGIN_DRBD_FALSE=
+  BUILD_PLUGIN_DNS_TRUE='#'
+  BUILD_PLUGIN_DNS_FALSE=
 fi
 
-    enable_drbd="$enable_plugin"
+    enable_dns="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-dns was given.
-if test "${enable_dns+set}" = set; then :
-  enableval=$enable_dns;
+    # Check whether --enable-drbd was given.
+if test "${enable_drbd+set}" = set; then :
+  enableval=$enable_drbd;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
      else if test "x$enableval" = "xforce"
      then
 	     enable_plugin="yes"
@@ -29845,49 +43589,49 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$with_libpcap" = "xyes"
+	     if test "x$plugin_drbd" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_drbd"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$with_libpcap" = "xyes" || test "x$force" = "xyes"
+	    if test "x$plugin_drbd" = "xyes" || test "x$force" = "xyes"
 	    then
 
-$as_echo "#define HAVE_PLUGIN_DNS 1" >>confdefs.h
+$as_echo "#define HAVE_PLUGIN_DRBD 1" >>confdefs.h
 
-		    if test "x$with_libpcap" != "xyes"
+		    if test "x$plugin_drbd" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_drbd (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_DNS_TRUE=
-  BUILD_PLUGIN_DNS_FALSE='#'
+  BUILD_PLUGIN_DRBD_TRUE=
+  BUILD_PLUGIN_DRBD_FALSE='#'
 else
-  BUILD_PLUGIN_DNS_TRUE='#'
-  BUILD_PLUGIN_DNS_FALSE=
+  BUILD_PLUGIN_DRBD_TRUE='#'
+  BUILD_PLUGIN_DRBD_FALSE=
 fi
 
-    enable_dns="$enable_plugin"
+    enable_drbd="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
     # Check whether --enable-email was given.
@@ -29909,13 +43653,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29930,13 +43674,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_EMAIL_TRUE=
   BUILD_PLUGIN_EMAIL_FALSE='#'
 else
@@ -29969,13 +43713,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_entropy" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_entropy"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -29990,13 +43734,13 @@
 		    if test "x$plugin_entropy" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_entropy (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ENTROPY_TRUE=
   BUILD_PLUGIN_ENTROPY_FALSE='#'
 else
@@ -30029,13 +43773,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ethstat" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ethstat"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30050,13 +43794,13 @@
 		    if test "x$plugin_ethstat" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ethstat (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ETHSTAT_TRUE=
   BUILD_PLUGIN_ETHSTAT_FALSE='#'
 else
@@ -30089,13 +43833,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30110,13 +43854,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_EXEC_TRUE=
   BUILD_PLUGIN_EXEC_FALSE='#'
 else
@@ -30149,13 +43893,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_fhcount" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_fhcount"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30170,13 +43914,13 @@
 		    if test "x$plugin_fhcount" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_fhcount (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_FHCOUNT_TRUE=
   BUILD_PLUGIN_FHCOUNT_FALSE='#'
 else
@@ -30209,13 +43953,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30230,13 +43974,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_FILECOUNT_TRUE=
   BUILD_PLUGIN_FILECOUNT_FALSE='#'
 else
@@ -30269,13 +44013,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_fscache" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_fscache"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30290,13 +44034,13 @@
 		    if test "x$plugin_fscache" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_fscache (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_FSCACHE_TRUE=
   BUILD_PLUGIN_FSCACHE_FALSE='#'
 else
@@ -30329,13 +44073,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libganglia" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libganglia"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30350,13 +44094,13 @@
 		    if test "x$with_libganglia" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libganglia (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_GMOND_TRUE=
   BUILD_PLUGIN_GMOND_FALSE='#'
 else
@@ -30367,12 +44111,132 @@
     enable_gmond="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-gps was given.
+if test "${enable_gps+set}" = set; then :
+  enableval=$enable_gps;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_gps" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_gps"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_gps" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_GPS 1" >>confdefs.h
+
+		    if test "x$plugin_gps" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_gps (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_GPS_TRUE=
+  BUILD_PLUGIN_GPS_FALSE='#'
+else
+  BUILD_PLUGIN_GPS_TRUE='#'
+  BUILD_PLUGIN_GPS_FALSE=
+fi
+
+    enable_gps="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
+    # Check whether --enable-grpc was given.
+if test "${enable_grpc+set}" = set; then :
+  enableval=$enable_grpc;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_grpc" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_grpc"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_grpc" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_GRPC 1" >>confdefs.h
+
+		    if test "x$plugin_grpc" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_grpc (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_GRPC_TRUE=
+  BUILD_PLUGIN_GRPC_FALSE='#'
+else
+  BUILD_PLUGIN_GRPC_TRUE='#'
+  BUILD_PLUGIN_GRPC_FALSE=
+fi
+
+    enable_grpc="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-hddtemp was given.
 if test "${enable_hddtemp+set}" = set; then :
   enableval=$enable_hddtemp;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -30389,13 +44253,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30410,13 +44274,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_HDDTEMP_TRUE=
   BUILD_PLUGIN_HDDTEMP_FALSE='#'
 else
@@ -30449,13 +44313,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_interface" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_interface"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30470,13 +44334,13 @@
 		    if test "x$plugin_interface" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_interface (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_INTERFACE_TRUE=
   BUILD_PLUGIN_INTERFACE_FALSE='#'
 else
@@ -30509,13 +44373,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ipc" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ipc"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30530,13 +44394,13 @@
 		    if test "x$plugin_ipc" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ipc (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_IPC_TRUE=
   BUILD_PLUGIN_IPC_FALSE='#'
 else
@@ -30569,13 +44433,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ipmi" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ipmi"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30590,13 +44454,13 @@
 		    if test "x$plugin_ipmi" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ipmi (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_IPMI_TRUE=
   BUILD_PLUGIN_IPMI_FALSE='#'
 else
@@ -30629,13 +44493,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libiptc" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libiptc"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30650,13 +44514,13 @@
 		    if test "x$with_libiptc" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libiptc (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_IPTABLES_TRUE=
   BUILD_PLUGIN_IPTABLES_FALSE='#'
 else
@@ -30689,13 +44553,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ipvs" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ipvs"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30710,13 +44574,13 @@
 		    if test "x$plugin_ipvs" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ipvs (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_IPVS_TRUE=
   BUILD_PLUGIN_IPVS_FALSE='#'
 else
@@ -30749,13 +44613,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_irq" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_irq"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30770,13 +44634,13 @@
 		    if test "x$plugin_irq" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_irq (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_IRQ_TRUE=
   BUILD_PLUGIN_IRQ_FALSE='#'
 else
@@ -30809,13 +44673,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_java" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_java"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30830,13 +44694,13 @@
 		    if test "x$with_java" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_java (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_JAVA_TRUE=
   BUILD_PLUGIN_JAVA_FALSE='#'
 else
@@ -30869,13 +44733,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_load" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_load"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -30890,13 +44754,13 @@
 		    if test "x$plugin_load" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_load (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_LOAD_TRUE=
   BUILD_PLUGIN_LOAD_FALSE='#'
 else
@@ -30907,15 +44771,15 @@
     enable_load="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-logfile was given.
-if test "${enable_logfile+set}" = set; then :
-  enableval=$enable_logfile;
+    # Check whether --enable-log_logstash was given.
+if test "${enable_log_logstash+set}" = set; then :
+  enableval=$enable_log_logstash;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
      else if test "x$enableval" = "xforce"
      then
 	     enable_plugin="yes"
@@ -30925,57 +44789,57 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "xyes" = "xyes"
+	     if test "x$plugin_log_logstash" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_log_logstash"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "xyes" = "xyes" || test "x$force" = "xyes"
+	    if test "x$plugin_log_logstash" = "xyes" || test "x$force" = "xyes"
 	    then
 
-$as_echo "#define HAVE_PLUGIN_LOGFILE 1" >>confdefs.h
+$as_echo "#define HAVE_PLUGIN_LOG_LOGSTASH 1" >>confdefs.h
 
-		    if test "xyes" != "xyes"
+		    if test "x$plugin_log_logstash" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_log_logstash (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_LOGFILE_TRUE=
-  BUILD_PLUGIN_LOGFILE_FALSE='#'
+  BUILD_PLUGIN_LOG_LOGSTASH_TRUE=
+  BUILD_PLUGIN_LOG_LOGSTASH_FALSE='#'
 else
-  BUILD_PLUGIN_LOGFILE_TRUE='#'
-  BUILD_PLUGIN_LOGFILE_FALSE=
+  BUILD_PLUGIN_LOG_LOGSTASH_TRUE='#'
+  BUILD_PLUGIN_LOG_LOGSTASH_FALSE=
 fi
 
-    enable_logfile="$enable_plugin"
+    enable_log_logstash="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
-    # Check whether --enable-log_logstash was given.
-if test "${enable_log_logstash+set}" = set; then :
-  enableval=$enable_log_logstash;
+    # Check whether --enable-logfile was given.
+if test "${enable_logfile+set}" = set; then :
+  enableval=$enable_logfile;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
      else if test "x$enableval" = "xforce"
      then
 	     enable_plugin="yes"
@@ -30985,49 +44849,49 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$plugin_log_logstash" = "xyes"
+	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$plugin_log_logstash" = "xyes" || test "x$force" = "xyes"
+	    if test "xyes" = "xyes" || test "x$force" = "xyes"
 	    then
 
-$as_echo "#define HAVE_PLUGIN_LOG_LOGSTASH 1" >>confdefs.h
+$as_echo "#define HAVE_PLUGIN_LOGFILE 1" >>confdefs.h
 
-		    if test "x$plugin_log_logstash" != "xyes"
+		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
-  BUILD_PLUGIN_LOG_LOGSTASH_TRUE=
-  BUILD_PLUGIN_LOG_LOGSTASH_FALSE='#'
+  BUILD_PLUGIN_LOGFILE_TRUE=
+  BUILD_PLUGIN_LOGFILE_FALSE='#'
 else
-  BUILD_PLUGIN_LOG_LOGSTASH_TRUE='#'
-  BUILD_PLUGIN_LOG_LOGSTASH_FALSE=
+  BUILD_PLUGIN_LOGFILE_TRUE='#'
+  BUILD_PLUGIN_LOGFILE_FALSE=
 fi
 
-    enable_log_logstash="$enable_plugin"
+    enable_logfile="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
     # Check whether --enable-lpar was given.
@@ -31049,13 +44913,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_perfstat" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_perfstat"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31070,13 +44934,13 @@
 		    if test "x$with_perfstat" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_perfstat (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_LPAR_TRUE=
   BUILD_PLUGIN_LPAR_FALSE='#'
 else
@@ -31087,12 +44951,72 @@
     enable_lpar="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-lua was given.
+if test "${enable_lua+set}" = set; then :
+  enableval=$enable_lua;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$with_liblua" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$with_liblua"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$with_liblua" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_LUA 1" >>confdefs.h
+
+		    if test "x$with_liblua" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$with_liblua (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_LUA_TRUE=
+  BUILD_PLUGIN_LUA_FALSE='#'
+else
+  BUILD_PLUGIN_LUA_TRUE='#'
+  BUILD_PLUGIN_LUA_FALSE=
+fi
+
+    enable_lua="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-lvm was given.
 if test "${enable_lvm+set}" = set; then :
   enableval=$enable_lvm;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -31109,13 +45033,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_liblvm2app" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_liblvm2app"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31130,13 +45054,13 @@
 		    if test "x$with_liblvm2app" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_liblvm2app (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_LVM_TRUE=
   BUILD_PLUGIN_LVM_FALSE='#'
 else
@@ -31169,13 +45093,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$have_linux_wireless_h" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$have_linux_wireless_h"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31190,13 +45114,13 @@
 		    if test "x$have_linux_wireless_h" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$have_linux_wireless_h (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MADWIFI_TRUE=
   BUILD_PLUGIN_MADWIFI_FALSE='#'
 else
@@ -31229,13 +45153,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31250,13 +45174,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE=
   BUILD_PLUGIN_MATCH_EMPTY_COUNTER_FALSE='#'
 else
@@ -31289,13 +45213,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31310,13 +45234,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MATCH_HASHED_TRUE=
   BUILD_PLUGIN_MATCH_HASHED_FALSE='#'
 else
@@ -31349,13 +45273,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31370,13 +45294,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MATCH_REGEX_TRUE=
   BUILD_PLUGIN_MATCH_REGEX_FALSE='#'
 else
@@ -31409,13 +45333,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31430,13 +45354,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MATCH_TIMEDIFF_TRUE=
   BUILD_PLUGIN_MATCH_TIMEDIFF_FALSE='#'
 else
@@ -31469,13 +45393,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31490,13 +45414,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MATCH_VALUE_TRUE=
   BUILD_PLUGIN_MATCH_VALUE_FALSE='#'
 else
@@ -31529,13 +45453,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31550,13 +45474,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MBMON_TRUE=
   BUILD_PLUGIN_MBMON_FALSE='#'
 else
@@ -31589,13 +45513,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$have_linux_raid_md_u_h" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$have_linux_raid_md_u_h"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31610,13 +45534,13 @@
 		    if test "x$have_linux_raid_md_u_h" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$have_linux_raid_md_u_h (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MD_TRUE=
   BUILD_PLUGIN_MD_FALSE='#'
 else
@@ -31649,13 +45573,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libmemcached" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libmemcached"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31670,13 +45594,13 @@
 		    if test "x$with_libmemcached" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libmemcached (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MEMCACHEC_TRUE=
   BUILD_PLUGIN_MEMCACHEC_FALSE='#'
 else
@@ -31709,13 +45633,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31730,13 +45654,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MEMCACHED_TRUE=
   BUILD_PLUGIN_MEMCACHED_FALSE='#'
 else
@@ -31769,13 +45693,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_memory" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_memory"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31790,13 +45714,13 @@
 		    if test "x$plugin_memory" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_memory (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MEMORY_TRUE=
   BUILD_PLUGIN_MEMORY_FALSE='#'
 else
@@ -31829,13 +45753,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_mic" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_mic"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31850,13 +45774,13 @@
 		    if test "x$with_mic" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_mic (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MIC_TRUE=
   BUILD_PLUGIN_MIC_FALSE='#'
 else
@@ -31889,13 +45813,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libmodbus" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libmodbus"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31910,13 +45834,13 @@
 		    if test "x$with_libmodbus" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libmodbus (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MODBUS_TRUE=
   BUILD_PLUGIN_MODBUS_FALSE='#'
 else
@@ -31927,12 +45851,72 @@
     enable_modbus="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-mqtt was given.
+if test "${enable_mqtt+set}" = set; then :
+  enableval=$enable_mqtt;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$with_libmosquitto" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$with_libmosquitto"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$with_libmosquitto" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_MQTT 1" >>confdefs.h
+
+		    if test "x$with_libmosquitto" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$with_libmosquitto (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_MQTT_TRUE=
+  BUILD_PLUGIN_MQTT_FALSE='#'
+else
+  BUILD_PLUGIN_MQTT_TRUE='#'
+  BUILD_PLUGIN_MQTT_FALSE=
+fi
+
+    enable_mqtt="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-multimeter was given.
 if test "${enable_multimeter+set}" = set; then :
   enableval=$enable_multimeter;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -31949,13 +45933,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_multimeter" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_multimeter"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -31970,13 +45954,13 @@
 		    if test "x$plugin_multimeter" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_multimeter (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MULTIMETER_TRUE=
   BUILD_PLUGIN_MULTIMETER_FALSE='#'
 else
@@ -32009,13 +45993,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libmysql" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libmysql"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32030,13 +46014,13 @@
 		    if test "x$with_libmysql" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libmysql (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_MYSQL_TRUE=
   BUILD_PLUGIN_MYSQL_FALSE='#'
 else
@@ -32069,13 +46053,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libnetapp" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libnetapp"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32090,13 +46074,13 @@
 		    if test "x$with_libnetapp" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libnetapp (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NETAPP_TRUE=
   BUILD_PLUGIN_NETAPP_FALSE='#'
 else
@@ -32129,13 +46113,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libmnl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libmnl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32150,13 +46134,13 @@
 		    if test "x$with_libmnl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libmnl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NETLINK_TRUE=
   BUILD_PLUGIN_NETLINK_FALSE='#'
 else
@@ -32189,13 +46173,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32210,13 +46194,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NETWORK_TRUE=
   BUILD_PLUGIN_NETWORK_FALSE='#'
 else
@@ -32249,13 +46233,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_nfs" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_nfs"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32270,13 +46254,13 @@
 		    if test "x$plugin_nfs" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_nfs (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NFS_TRUE=
   BUILD_PLUGIN_NFS_FALSE='#'
 else
@@ -32309,13 +46293,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libcurl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libcurl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32330,13 +46314,13 @@
 		    if test "x$with_libcurl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libcurl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NGINX_TRUE=
   BUILD_PLUGIN_NGINX_FALSE='#'
 else
@@ -32369,13 +46353,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libnotify" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libnotify"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32390,13 +46374,13 @@
 		    if test "x$with_libnotify" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libnotify (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE=
   BUILD_PLUGIN_NOTIFY_DESKTOP_FALSE='#'
 else
@@ -32429,13 +46413,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libesmtp" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libesmtp"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32450,13 +46434,13 @@
 		    if test "x$with_libesmtp" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libesmtp (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NOTIFY_EMAIL_TRUE=
   BUILD_PLUGIN_NOTIFY_EMAIL_FALSE='#'
 else
@@ -32467,12 +46451,72 @@
     enable_notify_email="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-notify_nagios was given.
+if test "${enable_notify_nagios+set}" = set; then :
+  enableval=$enable_notify_nagios;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "xyes" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="yes"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "xyes" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_NOTIFY_NAGIOS 1" >>confdefs.h
+
+		    if test "xyes" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="yes (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE=
+  BUILD_PLUGIN_NOTIFY_NAGIOS_FALSE='#'
+else
+  BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE='#'
+  BUILD_PLUGIN_NOTIFY_NAGIOS_FALSE=
+fi
+
+    enable_notify_nagios="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-ntpd was given.
 if test "${enable_ntpd+set}" = set; then :
   enableval=$enable_ntpd;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -32489,13 +46533,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32510,13 +46554,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NTPD_TRUE=
   BUILD_PLUGIN_NTPD_FALSE='#'
 else
@@ -32549,13 +46593,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_numa" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_numa"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32570,13 +46614,13 @@
 		    if test "x$plugin_numa" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_numa (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NUMA_TRUE=
   BUILD_PLUGIN_NUMA_FALSE='#'
 else
@@ -32609,13 +46653,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libupsclient" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libupsclient"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32630,13 +46674,13 @@
 		    if test "x$with_libupsclient" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libupsclient (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_NUT_TRUE=
   BUILD_PLUGIN_NUT_FALSE='#'
 else
@@ -32669,13 +46713,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32690,13 +46734,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_OLSRD_TRUE=
   BUILD_PLUGIN_OLSRD_FALSE='#'
 else
@@ -32729,13 +46773,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libowcapi" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libowcapi"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32750,13 +46794,13 @@
 		    if test "x$with_libowcapi" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libowcapi (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ONEWIRE_TRUE=
   BUILD_PLUGIN_ONEWIRE_FALSE='#'
 else
@@ -32789,13 +46833,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libldap" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libldap"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32810,13 +46854,13 @@
 		    if test "x$with_libldap" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libldap (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_OPENLDAP_TRUE=
   BUILD_PLUGIN_OPENLDAP_FALSE='#'
 else
@@ -32849,13 +46893,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32870,13 +46914,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_OPENVPN_TRUE=
   BUILD_PLUGIN_OPENVPN_FALSE='#'
 else
@@ -32909,13 +46953,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_oracle" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_oracle"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32930,13 +46974,13 @@
 		    if test "x$with_oracle" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_oracle (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ORACLE_TRUE=
   BUILD_PLUGIN_ORACLE_FALSE='#'
 else
@@ -32969,13 +47013,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_perl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_perl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -32990,13 +47034,13 @@
 		    if test "x$plugin_perl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_perl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PERL_TRUE=
   BUILD_PLUGIN_PERL_FALSE='#'
 else
@@ -33029,13 +47073,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$have_net_pfvar_h" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$have_net_pfvar_h"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33050,13 +47094,13 @@
 		    if test "x$have_net_pfvar_h" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$have_net_pfvar_h (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PF_TRUE=
   BUILD_PLUGIN_PF_FALSE='#'
 else
@@ -33086,38 +47130,38 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$have_protoc_c" = "xyes"
+	     if test "x$plugin_pinba" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_pinba"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$have_protoc_c" = "xyes" || test "x$force" = "xyes"
+	    if test "x$plugin_pinba" = "xyes" || test "x$force" = "xyes"
 	    then
 
 $as_echo "#define HAVE_PLUGIN_PINBA 1" >>confdefs.h
 
-		    if test "x$have_protoc_c" != "xyes"
+		    if test "x$plugin_pinba" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_pinba (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PINBA_TRUE=
   BUILD_PLUGIN_PINBA_FALSE='#'
 else
@@ -33150,13 +47194,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_liboping" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_liboping"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33171,13 +47215,13 @@
 		    if test "x$with_liboping" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_liboping (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PING_TRUE=
   BUILD_PLUGIN_PING_FALSE='#'
 else
@@ -33210,13 +47254,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libpq" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libpq"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33231,13 +47275,13 @@
 		    if test "x$with_libpq" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libpq (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_POSTGRESQL_TRUE=
   BUILD_PLUGIN_POSTGRESQL_FALSE='#'
 else
@@ -33270,13 +47314,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33291,13 +47335,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_POWERDNS_TRUE=
   BUILD_PLUGIN_POWERDNS_FALSE='#'
 else
@@ -33330,13 +47374,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_processes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_processes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33351,13 +47395,13 @@
 		    if test "x$plugin_processes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_processes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PROCESSES_TRUE=
   BUILD_PLUGIN_PROCESSES_FALSE='#'
 else
@@ -33390,13 +47434,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_protocols" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_protocols"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33411,13 +47455,13 @@
 		    if test "x$plugin_protocols" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_protocols (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PROTOCOLS_TRUE=
   BUILD_PLUGIN_PROTOCOLS_FALSE='#'
 else
@@ -33446,38 +47490,38 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$with_python" = "xyes"
+	     if test "x$plugin_python" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_python"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$with_python" = "xyes" || test "x$force" = "xyes"
+	    if test "x$plugin_python" = "xyes" || test "x$force" = "xyes"
 	    then
 
 $as_echo "#define HAVE_PLUGIN_PYTHON 1" >>confdefs.h
 
-		    if test "x$with_python" != "xyes"
+		    if test "x$plugin_python" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_python (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_PYTHON_TRUE=
   BUILD_PLUGIN_PYTHON_FALSE='#'
 else
@@ -33510,13 +47554,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libhiredis" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libhiredis"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33531,13 +47575,13 @@
 		    if test "x$with_libhiredis" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libhiredis (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_REDIS_TRUE=
   BUILD_PLUGIN_REDIS_FALSE='#'
 else
@@ -33570,13 +47614,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_librouteros" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_librouteros"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33591,13 +47635,13 @@
 		    if test "x$with_librouteros" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_librouteros (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ROUTEROS_TRUE=
   BUILD_PLUGIN_ROUTEROS_FALSE='#'
 else
@@ -33630,13 +47674,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$librrd_rrdc_update" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$librrd_rrdc_update"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33651,13 +47695,13 @@
 		    if test "x$librrd_rrdc_update" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$librrd_rrdc_update (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_RRDCACHED_TRUE=
   BUILD_PLUGIN_RRDCACHED_FALSE='#'
 else
@@ -33690,13 +47734,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_librrd" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_librrd"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33711,13 +47755,13 @@
 		    if test "x$with_librrd" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_librrd (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_RRDTOOL_TRUE=
   BUILD_PLUGIN_RRDTOOL_FALSE='#'
 else
@@ -33750,13 +47794,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libsensors" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libsensors"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33771,13 +47815,13 @@
 		    if test "x$with_libsensors" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libsensors (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SENSORS_TRUE=
   BUILD_PLUGIN_SENSORS_FALSE='#'
 else
@@ -33810,13 +47854,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_serial" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_serial"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33831,13 +47875,13 @@
 		    if test "x$plugin_serial" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_serial (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SERIAL_TRUE=
   BUILD_PLUGIN_SERIAL_FALSE='#'
 else
@@ -33870,13 +47914,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libsigrok" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libsigrok"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33891,13 +47935,13 @@
 		    if test "x$with_libsigrok" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libsigrok (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SIGROK_TRUE=
   BUILD_PLUGIN_SIGROK_FALSE='#'
 else
@@ -33930,13 +47974,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_smart" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_smart"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -33951,13 +47995,13 @@
 		    if test "x$plugin_smart" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_smart (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SMART_TRUE=
   BUILD_PLUGIN_SMART_FALSE='#'
 else
@@ -33990,13 +48034,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libnetsnmp" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libnetsnmp"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34011,13 +48055,13 @@
 		    if test "x$with_libnetsnmp" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libnetsnmp (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SNMP_TRUE=
   BUILD_PLUGIN_SNMP_FALSE='#'
 else
@@ -34050,13 +48094,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34071,13 +48115,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_STATSD_TRUE=
   BUILD_PLUGIN_STATSD_FALSE='#'
 else
@@ -34110,13 +48154,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_swap" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_swap"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34131,13 +48175,13 @@
 		    if test "x$plugin_swap" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_swap (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SWAP_TRUE=
   BUILD_PLUGIN_SWAP_FALSE='#'
 else
@@ -34170,13 +48214,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$have_syslog" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$have_syslog"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34191,13 +48235,13 @@
 		    if test "x$have_syslog" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$have_syslog (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_SYSLOG_TRUE=
   BUILD_PLUGIN_SYSLOG_FALSE='#'
 else
@@ -34230,13 +48274,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34251,13 +48295,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TABLE_TRUE=
   BUILD_PLUGIN_TABLE_FALSE='#'
 else
@@ -34290,13 +48334,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34311,13 +48355,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TAIL_TRUE=
   BUILD_PLUGIN_TAIL_FALSE='#'
 else
@@ -34350,13 +48394,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34371,13 +48415,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TAIL_CSV_TRUE=
   BUILD_PLUGIN_TAIL_CSV_FALSE='#'
 else
@@ -34410,13 +48454,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_tape" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_tape"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34431,13 +48475,13 @@
 		    if test "x$plugin_tape" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_tape (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TAPE_TRUE=
   BUILD_PLUGIN_TAPE_FALSE='#'
 else
@@ -34470,13 +48514,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34491,13 +48535,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TARGET_NOTIFICATION_TRUE=
   BUILD_PLUGIN_TARGET_NOTIFICATION_FALSE='#'
 else
@@ -34530,13 +48574,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34551,13 +48595,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TARGET_REPLACE_TRUE=
   BUILD_PLUGIN_TARGET_REPLACE_FALSE='#'
 else
@@ -34590,13 +48634,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34611,13 +48655,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TARGET_SCALE_TRUE=
   BUILD_PLUGIN_TARGET_SCALE_FALSE='#'
 else
@@ -34650,13 +48694,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34671,13 +48715,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TARGET_SET_TRUE=
   BUILD_PLUGIN_TARGET_SET_FALSE='#'
 else
@@ -34710,13 +48754,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34731,13 +48775,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TARGET_V5UPGRADE_TRUE=
   BUILD_PLUGIN_TARGET_V5UPGRADE_FALSE='#'
 else
@@ -34770,13 +48814,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_tcpconns" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_tcpconns"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34791,13 +48835,13 @@
 		    if test "x$plugin_tcpconns" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_tcpconns (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TCPCONNS_TRUE=
   BUILD_PLUGIN_TCPCONNS_FALSE='#'
 else
@@ -34830,13 +48874,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34851,13 +48895,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TEAMSPEAK2_TRUE=
   BUILD_PLUGIN_TEAMSPEAK2_FALSE='#'
 else
@@ -34890,13 +48934,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_ted" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_ted"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34911,13 +48955,13 @@
 		    if test "x$plugin_ted" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_ted (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TED_TRUE=
   BUILD_PLUGIN_TED_FALSE='#'
 else
@@ -34950,13 +48994,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_thermal" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_thermal"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -34971,13 +49015,13 @@
 		    if test "x$plugin_thermal" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_thermal (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_THERMAL_TRUE=
   BUILD_PLUGIN_THERMAL_FALSE='#'
 else
@@ -35010,13 +49054,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35031,13 +49075,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_THRESHOLD_TRUE=
   BUILD_PLUGIN_THRESHOLD_FALSE='#'
 else
@@ -35070,13 +49114,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libtokyotyrant" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libtokyotyrant"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35091,13 +49135,13 @@
 		    if test "x$with_libtokyotyrant" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libtokyotyrant (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TOKYOTYRANT_TRUE=
   BUILD_PLUGIN_TOKYOTYRANT_FALSE='#'
 else
@@ -35130,13 +49174,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_turbostat" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_turbostat"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35151,13 +49195,13 @@
 		    if test "x$plugin_turbostat" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_turbostat (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_TURBOSTAT_TRUE=
   BUILD_PLUGIN_TURBOSTAT_FALSE='#'
 else
@@ -35190,13 +49234,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35211,13 +49255,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_UNIXSOCK_TRUE=
   BUILD_PLUGIN_UNIXSOCK_FALSE='#'
 else
@@ -35250,13 +49294,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_uptime" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_uptime"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35271,13 +49315,13 @@
 		    if test "x$plugin_uptime" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_uptime (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_UPTIME_TRUE=
   BUILD_PLUGIN_UPTIME_FALSE='#'
 else
@@ -35310,13 +49354,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_users" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_users"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35331,13 +49375,13 @@
 		    if test "x$plugin_users" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_users (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_USERS_TRUE=
   BUILD_PLUGIN_USERS_FALSE='#'
 else
@@ -35370,13 +49414,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35391,13 +49435,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_UUID_TRUE=
   BUILD_PLUGIN_UUID_FALSE='#'
 else
@@ -35430,13 +49474,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libvarnish" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libvarnish"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35451,13 +49495,13 @@
 		    if test "x$with_libvarnish" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libvarnish (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_VARNISH_TRUE=
   BUILD_PLUGIN_VARNISH_FALSE='#'
 else
@@ -35490,13 +49534,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_virt" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_virt"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35511,13 +49555,13 @@
 		    if test "x$plugin_virt" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_virt (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_VIRT_TRUE=
   BUILD_PLUGIN_VIRT_FALSE='#'
 else
@@ -35550,13 +49594,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_vmem" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_vmem"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35571,13 +49615,13 @@
 		    if test "x$plugin_vmem" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_vmem (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_VMEM_TRUE=
   BUILD_PLUGIN_VMEM_FALSE='#'
 else
@@ -35610,13 +49654,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_vserver" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_vserver"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35631,13 +49675,13 @@
 		    if test "x$plugin_vserver" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_vserver (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_VSERVER_TRUE=
   BUILD_PLUGIN_VSERVER_FALSE='#'
 else
@@ -35670,13 +49714,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_wireless" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_wireless"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35691,13 +49735,13 @@
 		    if test "x$plugin_wireless" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_wireless (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WIRELESS_TRUE=
   BUILD_PLUGIN_WIRELESS_FALSE='#'
 else
@@ -35730,13 +49774,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35751,13 +49795,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_GRAPHITE_TRUE=
   BUILD_PLUGIN_WRITE_GRAPHITE_FALSE='#'
 else
@@ -35790,13 +49834,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libcurl" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libcurl"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35811,13 +49855,13 @@
 		    if test "x$with_libcurl" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libcurl (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_HTTP_TRUE=
   BUILD_PLUGIN_WRITE_HTTP_FALSE='#'
 else
@@ -35850,13 +49894,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_librdkafka" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_librdkafka"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35871,13 +49915,13 @@
 		    if test "x$with_librdkafka" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_librdkafka (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_KAFKA_TRUE=
   BUILD_PLUGIN_WRITE_KAFKA_FALSE='#'
 else
@@ -35910,13 +49954,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35931,13 +49975,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_LOG_TRUE=
   BUILD_PLUGIN_WRITE_LOG_FALSE='#'
 else
@@ -35970,13 +50014,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libmongoc" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libmongoc"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -35991,13 +50035,13 @@
 		    if test "x$with_libmongoc" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libmongoc (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_MONGODB_TRUE=
   BUILD_PLUGIN_WRITE_MONGODB_FALSE='#'
 else
@@ -36030,13 +50074,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libhiredis" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libhiredis"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36051,13 +50095,13 @@
 		    if test "x$with_libhiredis" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libhiredis (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_REDIS_TRUE=
   BUILD_PLUGIN_WRITE_REDIS_FALSE='#'
 else
@@ -36086,38 +50130,38 @@
      fi; fi
 
 else
 
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
-	     if test "x$have_protoc_c" = "xyes"
+	     if test "x$with_libriemann_client" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libriemann_client"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
 
     if test "x$enable_plugin" = "xyes"
     then
-	    if test "x$have_protoc_c" = "xyes" || test "x$force" = "xyes"
+	    if test "x$with_libriemann_client" = "xyes" || test "x$force" = "xyes"
 	    then
 
 $as_echo "#define HAVE_PLUGIN_WRITE_RIEMANN 1" >>confdefs.h
 
-		    if test "x$have_protoc_c" != "xyes"
+		    if test "x$with_libriemann_client" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libriemann_client (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_RIEMANN_TRUE=
   BUILD_PLUGIN_WRITE_RIEMANN_FALSE='#'
 else
@@ -36150,13 +50194,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36171,13 +50215,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_SENSU_TRUE=
   BUILD_PLUGIN_WRITE_SENSU_FALSE='#'
 else
@@ -36210,13 +50254,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36231,13 +50275,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_WRITE_TSDB_TRUE=
   BUILD_PLUGIN_WRITE_TSDB_FALSE='#'
 else
@@ -36248,12 +50292,72 @@
     enable_write_tsdb="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-xencpu was given.
+if test "${enable_xencpu+set}" = set; then :
+  enableval=$enable_xencpu;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_xencpu" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_xencpu"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_xencpu" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_XENCPU 1" >>confdefs.h
+
+		    if test "x$plugin_xencpu" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_xencpu (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_XENCPU_TRUE=
+  BUILD_PLUGIN_XENCPU_FALSE='#'
+else
+  BUILD_PLUGIN_XENCPU_TRUE='#'
+  BUILD_PLUGIN_XENCPU_FALSE=
+fi
+
+    enable_xencpu="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-xmms was given.
 if test "${enable_xmms+set}" = set; then :
   enableval=$enable_xmms;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -36270,13 +50374,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$with_libxmms" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$with_libxmms"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36291,13 +50395,13 @@
 		    if test "x$with_libxmms" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$with_libxmms (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_XMMS_TRUE=
   BUILD_PLUGIN_XMMS_FALSE='#'
 else
@@ -36330,13 +50434,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$plugin_zfs_arc" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$plugin_zfs_arc"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36351,13 +50455,13 @@
 		    if test "x$plugin_zfs_arc" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$plugin_zfs_arc (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ZFS_ARC_TRUE=
   BUILD_PLUGIN_ZFS_ARC_FALSE='#'
 else
@@ -36368,12 +50472,72 @@
     enable_zfs_arc="$enable_plugin"
 
 
 
     enable_plugin="no"
     force="no"
+    # Check whether --enable-zone was given.
+if test "${enable_zone+set}" = set; then :
+  enableval=$enable_zone;
+     if test "x$enableval" = "xyes"
+     then
+	     enable_plugin="yes"
+     else if test "x$enableval" = "xforce"
+     then
+	     enable_plugin="yes"
+	     force="yes"
+     else
+	     enable_plugin="no (disabled on command line)"
+     fi; fi
+
+else
+
+	 if test "x$enable_all_plugins" = "xauto"
+	 then
+	     if test "x$plugin_zone" = "xyes"
+	     then
+		     enable_plugin="yes"
+	     else
+		     enable_plugin="$plugin_zone"
+	     fi
+	 else
+	     enable_plugin="$enable_all_plugins"
+	 fi
+
+fi
+
+    if test "x$enable_plugin" = "xyes"
+    then
+	    if test "x$plugin_zone" = "xyes" || test "x$force" = "xyes"
+	    then
+
+$as_echo "#define HAVE_PLUGIN_ZONE 1" >>confdefs.h
+
+		    if test "x$plugin_zone" != "xyes"
+		    then
+			    dependency_warning="yes"
+		    fi
+	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
+		    dependency_error="yes"
+		    enable_plugin="$plugin_zone (dependency error)"
+	    fi
+    fi
+     if test "x$enable_plugin" = "xyes"; then
+  BUILD_PLUGIN_ZONE_TRUE=
+  BUILD_PLUGIN_ZONE_FALSE='#'
+else
+  BUILD_PLUGIN_ZONE_TRUE='#'
+  BUILD_PLUGIN_ZONE_FALSE=
+fi
+
+    enable_zone="$enable_plugin"
+
+
+
+    enable_plugin="no"
+    force="no"
     # Check whether --enable-zookeeper was given.
 if test "${enable_zookeeper+set}" = set; then :
   enableval=$enable_zookeeper;
      if test "x$enableval" = "xyes"
      then
 	     enable_plugin="yes"
@@ -36390,13 +50554,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "xyes" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="yes"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
 
 fi
@@ -36411,13 +50575,13 @@
 		    if test "xyes" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="yes (dependency error)"
 	    fi
     fi
      if test "x$enable_plugin" = "xyes"; then
   BUILD_PLUGIN_ZOOKEEPER_TRUE=
   BUILD_PLUGIN_ZOOKEEPER_FALSE='#'
 else
@@ -36555,12 +50719,27 @@
 	else
 		with_perl_bindings="no (no perl interpreter found)"
 	fi
 
 fi
 
+
+if test "x$with_perl_bindings" = "xyes"
+then
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for the ExtUtils::MakeMaker module" >&5
+$as_echo_n "checking for the ExtUtils::MakeMaker module... " >&6; }
+	if $PERL -MExtUtils::MakeMaker -e '' 2>/dev/null; then
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+$as_echo "yes" >&6; }
+	else
+		{ $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+$as_echo "no" >&6; }
+		with_perl_bindings="no (ExtUtils::MakeMaker not found)"
+	fi
+fi
+
 if test "x$with_perl_bindings" = "xyes"
 then
 	PERL_BINDINGS="perl"
 else
 	PERL_BINDINGS=""
 fi
@@ -36581,13 +50760,23 @@
 
 
 
 ac_config_files="$ac_config_files src/libcollectdclient/collectd/lcc_features.h"
 
 
-ac_config_files="$ac_config_files Makefile src/Makefile src/daemon/Makefile src/collectd.conf src/libcollectdclient/Makefile src/libcollectdclient/libcollectdclient.pc src/liboconfig/Makefile bindings/Makefile bindings/java/Makefile"
+AM_CFLAGS="-Wall"
+AM_CXXFLAGS="-Wall"
+if test "x$enable_werror" != "xno"
+then
+        AM_CFLAGS="$AM_CFLAGS -Werror"
+        AM_CXXFLAGS="$AM_CXXFLAGS -Werror"
+fi
+
+
+
+ac_config_files="$ac_config_files Makefile proto/Makefile src/Makefile src/daemon/Makefile src/collectd.conf src/libcollectdclient/Makefile src/libcollectdclient/libcollectdclient.pc src/liboconfig/Makefile bindings/Makefile bindings/java/Makefile"
 
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
@@ -36745,42 +50934,50 @@
   am__EXEEXT_FALSE='#'
 else
   am__EXEEXT_TRUE='#'
   am__EXEEXT_FALSE=
 fi
 
+if test -z "${am__fastdepCXX_TRUE}" && test -z "${am__fastdepCXX_FALSE}"; then
+  as_fn_error $? "conditional \"am__fastdepCXX\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${COMPILER_IS_GCC_TRUE}" && test -z "${COMPILER_IS_GCC_FALSE}"; then
   as_fn_error $? "conditional \"COMPILER_IS_GCC\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${HAVE_PROTOC_C_TRUE}" && test -z "${HAVE_PROTOC_C_FALSE}"; then
-  as_fn_error $? "conditional \"HAVE_PROTOC_C\" was never defined.
+if test -z "${HAVE_PROTOC3_TRUE}" && test -z "${HAVE_PROTOC3_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_PROTOC3\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_LINUX_TRUE}" && test -z "${BUILD_LINUX_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_LINUX\" was never defined.
+if test -z "${HAVE_GRPC_CPP_TRUE}" && test -z "${HAVE_GRPC_CPP_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_GRPC_CPP\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_SOLARIS_TRUE}" && test -z "${BUILD_SOLARIS_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_SOLARIS\" was never defined.
+if test -z "${BUILD_AIX_TRUE}" && test -z "${BUILD_AIX_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_AIX\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_DARWIN_TRUE}" && test -z "${BUILD_DARWIN_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_DARWIN\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_OPENBSD_TRUE}" && test -z "${BUILD_OPENBSD_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_OPENBSD\" was never defined.
+if test -z "${BUILD_FREEBSD_TRUE}" && test -z "${BUILD_FREEBSD_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_FREEBSD\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_AIX_TRUE}" && test -z "${BUILD_AIX_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_AIX\" was never defined.
+if test -z "${BUILD_LINUX_TRUE}" && test -z "${BUILD_LINUX_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_LINUX\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_FREEBSD_TRUE}" && test -z "${BUILD_FREEBSD_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_FREEBSD\" was never defined.
+if test -z "${BUILD_OPENBSD_TRUE}" && test -z "${BUILD_OPENBSD_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_OPENBSD\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${BUILD_SOLARIS_TRUE}" && test -z "${BUILD_SOLARIS_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_SOLARIS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_FEATURE_STANDARDS_TRUE}" && test -z "${BUILD_FEATURE_STANDARDS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_FEATURE_STANDARDS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
@@ -36861,12 +51058,16 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBGCRYPT_TRUE}" && test -z "${BUILD_WITH_LIBGCRYPT_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBGCRYPT\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_WITH_LIBGPS_TRUE}" && test -z "${BUILD_WITH_LIBGPS_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_WITH_LIBGPS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_WITH_LIBIPTC_TRUE}" && test -z "${BUILD_WITH_LIBIPTC_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBIPTC\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_JAVA_TRUE}" && test -z "${BUILD_WITH_JAVA_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_JAVA\" was never defined.
@@ -36897,16 +51098,12 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBNETAPP_TRUE}" && test -z "${BUILD_WITH_LIBNETAPP_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBNETAPP\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_WITH_LIBNETSNMP_TRUE}" && test -z "${BUILD_WITH_LIBNETSNMP_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_WITH_LIBNETSNMP\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_WITH_OWN_LIBOCONFIG_TRUE}" && test -z "${BUILD_WITH_OWN_LIBOCONFIG_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_OWN_LIBOCONFIG\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBOPING_TRUE}" && test -z "${BUILD_WITH_LIBOPING_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBOPING\" was never defined.
@@ -36925,16 +51122,12 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBPQ_TRUE}" && test -z "${BUILD_WITH_LIBPQ_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBPQ\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_WITH_LIBPTHREAD_TRUE}" && test -z "${BUILD_WITH_LIBPTHREAD_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_WITH_LIBPTHREAD\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_WITH_LIBRABBITMQ_TRUE}" && test -z "${BUILD_WITH_LIBRABBITMQ_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBRABBITMQ\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBRDKAFKA_TRUE}" && test -z "${BUILD_WITH_LIBRDKAFKA_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBRDKAFKA\" was never defined.
@@ -36945,16 +51138,12 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LM_SENSORS_TRUE}" && test -z "${BUILD_WITH_LM_SENSORS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LM_SENSORS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_WITH_LIBSIGROK_TRUE}" && test -z "${BUILD_WITH_LIBSIGROK_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_WITH_LIBSIGROK\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_WITH_LIBSTATGRAB_TRUE}" && test -z "${BUILD_WITH_LIBSTATGRAB_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBSTATGRAB\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_WITH_LIBTOKYOTYRANT_TRUE}" && test -z "${BUILD_WITH_LIBTOKYOTYRANT_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_WITH_LIBTOKYOTYRANT\" was never defined.
@@ -36985,12 +51174,16 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_FEATURE_GETIFADDRS_TRUE}" && test -z "${BUILD_FEATURE_GETIFADDRS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_FEATURE_GETIFADDRS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_FEATURE_WERROR_TRUE}" && test -z "${BUILD_FEATURE_WERROR_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_FEATURE_WERROR\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_AGGREGATION_TRUE}" && test -z "${BUILD_PLUGIN_AGGREGATION_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_AGGREGATION\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_AMQP_TRUE}" && test -z "${BUILD_PLUGIN_AMQP_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_AMQP\" was never defined.
@@ -37029,26 +51222,38 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_CEPH_TRUE}" && test -z "${BUILD_PLUGIN_CEPH_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CEPH\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_CGROUPS_TRUE}" && test -z "${BUILD_PLUGIN_CGROUPS_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_CGROUPS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${BUILD_PLUGIN_CHRONY_TRUE}" && test -z "${BUILD_PLUGIN_CHRONY_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_CHRONY\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_CONNTRACK_TRUE}" && test -z "${BUILD_PLUGIN_CONNTRACK_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CONNTRACK\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_CONTEXTSWITCH_TRUE}" && test -z "${BUILD_PLUGIN_CONTEXTSWITCH_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CONTEXTSWITCH\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_CPU_TRUE}" && test -z "${BUILD_PLUGIN_CPU_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_CPU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_CPUFREQ_TRUE}" && test -z "${BUILD_PLUGIN_CPUFREQ_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CPUFREQ\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_PLUGIN_CPU_TRUE}" && test -z "${BUILD_PLUGIN_CPU_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_PLUGIN_CPU\" was never defined.
+if test -z "${BUILD_PLUGIN_CPUSLEEP_TRUE}" && test -z "${BUILD_PLUGIN_CPUSLEEP_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_CPUSLEEP\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_CSV_TRUE}" && test -z "${BUILD_PLUGIN_CSV_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CSV\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
@@ -37061,36 +51266,32 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_CURL_XML_TRUE}" && test -z "${BUILD_PLUGIN_CURL_XML_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_CURL_XML\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_PLUGIN_CGROUPS_TRUE}" && test -z "${BUILD_PLUGIN_CGROUPS_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_PLUGIN_CGROUPS\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_PLUGIN_DBI_TRUE}" && test -z "${BUILD_PLUGIN_DBI_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_DBI\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_DF_TRUE}" && test -z "${BUILD_PLUGIN_DF_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_DF\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_DISK_TRUE}" && test -z "${BUILD_PLUGIN_DISK_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_DISK\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_PLUGIN_DRBD_TRUE}" && test -z "${BUILD_PLUGIN_DRBD_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_PLUGIN_DRBD\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_PLUGIN_DNS_TRUE}" && test -z "${BUILD_PLUGIN_DNS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_DNS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_DRBD_TRUE}" && test -z "${BUILD_PLUGIN_DRBD_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_DRBD\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_EMAIL_TRUE}" && test -z "${BUILD_PLUGIN_EMAIL_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_EMAIL\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_ENTROPY_TRUE}" && test -z "${BUILD_PLUGIN_ENTROPY_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_ENTROPY\" was never defined.
@@ -37117,12 +51318,20 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_GMOND_TRUE}" && test -z "${BUILD_PLUGIN_GMOND_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_GMOND\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_GPS_TRUE}" && test -z "${BUILD_PLUGIN_GPS_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_GPS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
+if test -z "${BUILD_PLUGIN_GRPC_TRUE}" && test -z "${BUILD_PLUGIN_GRPC_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_GRPC\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_HDDTEMP_TRUE}" && test -z "${BUILD_PLUGIN_HDDTEMP_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_HDDTEMP\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_INTERFACE_TRUE}" && test -z "${BUILD_PLUGIN_INTERFACE_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_INTERFACE\" was never defined.
@@ -37153,24 +51362,28 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_LOAD_TRUE}" && test -z "${BUILD_PLUGIN_LOAD_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_LOAD\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${BUILD_PLUGIN_LOGFILE_TRUE}" && test -z "${BUILD_PLUGIN_LOGFILE_FALSE}"; then
-  as_fn_error $? "conditional \"BUILD_PLUGIN_LOGFILE\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${BUILD_PLUGIN_LOG_LOGSTASH_TRUE}" && test -z "${BUILD_PLUGIN_LOG_LOGSTASH_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_LOG_LOGSTASH\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_LOGFILE_TRUE}" && test -z "${BUILD_PLUGIN_LOGFILE_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_LOGFILE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_LPAR_TRUE}" && test -z "${BUILD_PLUGIN_LPAR_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_LPAR\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_LUA_TRUE}" && test -z "${BUILD_PLUGIN_LUA_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_LUA\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_LVM_TRUE}" && test -z "${BUILD_PLUGIN_LVM_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_LVM\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_MADWIFI_TRUE}" && test -z "${BUILD_PLUGIN_MADWIFI_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_MADWIFI\" was never defined.
@@ -37221,12 +51434,16 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_MODBUS_TRUE}" && test -z "${BUILD_PLUGIN_MODBUS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_MODBUS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_MQTT_TRUE}" && test -z "${BUILD_PLUGIN_MQTT_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_MQTT\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_MULTIMETER_TRUE}" && test -z "${BUILD_PLUGIN_MULTIMETER_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_MULTIMETER\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_MYSQL_TRUE}" && test -z "${BUILD_PLUGIN_MYSQL_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_MYSQL\" was never defined.
@@ -37257,12 +51474,16 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_NOTIFY_EMAIL_TRUE}" && test -z "${BUILD_PLUGIN_NOTIFY_EMAIL_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_NOTIFY_EMAIL\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE}" && test -z "${BUILD_PLUGIN_NOTIFY_NAGIOS_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_NOTIFY_NAGIOS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_NTPD_TRUE}" && test -z "${BUILD_PLUGIN_NTPD_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_NTPD\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_NUMA_TRUE}" && test -z "${BUILD_PLUGIN_NUMA_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_NUMA\" was never defined.
@@ -37509,20 +51730,28 @@
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_WRITE_TSDB_TRUE}" && test -z "${BUILD_PLUGIN_WRITE_TSDB_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_WRITE_TSDB\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_XENCPU_TRUE}" && test -z "${BUILD_PLUGIN_XENCPU_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_XENCPU\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_XMMS_TRUE}" && test -z "${BUILD_PLUGIN_XMMS_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_XMMS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 if test -z "${BUILD_PLUGIN_ZFS_ARC_TRUE}" && test -z "${BUILD_PLUGIN_ZFS_ARC_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_ZFS_ARC\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${BUILD_PLUGIN_ZONE_TRUE}" && test -z "${BUILD_PLUGIN_ZONE_FALSE}"; then
+  as_fn_error $? "conditional \"BUILD_PLUGIN_ZONE\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${BUILD_PLUGIN_ZOOKEEPER_TRUE}" && test -z "${BUILD_PLUGIN_ZOOKEEPER_FALSE}"; then
   as_fn_error $? "conditional \"BUILD_PLUGIN_ZOOKEEPER\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
 
 : "${CONFIG_STATUS=./config.status}"
@@ -37918,13 +52147,13 @@
 
 cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # Save the log message, to keep $0 and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by collectd $as_me 5.5.3, which was
+This file was extended by collectd $as_me 5.6.0, which was
 generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -37984,13 +52213,13 @@
 Report bugs to the package provider."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-collectd config.status 5.5.3
+collectd config.status 5.6.0
 configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
 Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
@@ -38242,12 +52471,66 @@
 hardcode_action='`$ECHO "$hardcode_action" | $SED "$delay_single_quote_subst"`'
 enable_dlopen='`$ECHO "$enable_dlopen" | $SED "$delay_single_quote_subst"`'
 enable_dlopen_self='`$ECHO "$enable_dlopen_self" | $SED "$delay_single_quote_subst"`'
 enable_dlopen_self_static='`$ECHO "$enable_dlopen_self_static" | $SED "$delay_single_quote_subst"`'
 old_striplib='`$ECHO "$old_striplib" | $SED "$delay_single_quote_subst"`'
 striplib='`$ECHO "$striplib" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_dirs='`$ECHO "$compiler_lib_search_dirs" | $SED "$delay_single_quote_subst"`'
+predep_objects='`$ECHO "$predep_objects" | $SED "$delay_single_quote_subst"`'
+postdep_objects='`$ECHO "$postdep_objects" | $SED "$delay_single_quote_subst"`'
+predeps='`$ECHO "$predeps" | $SED "$delay_single_quote_subst"`'
+postdeps='`$ECHO "$postdeps" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_path='`$ECHO "$compiler_lib_search_path" | $SED "$delay_single_quote_subst"`'
+LD_CXX='`$ECHO "$LD_CXX" | $SED "$delay_single_quote_subst"`'
+reload_flag_CXX='`$ECHO "$reload_flag_CXX" | $SED "$delay_single_quote_subst"`'
+reload_cmds_CXX='`$ECHO "$reload_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_cmds_CXX='`$ECHO "$old_archive_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_CXX='`$ECHO "$compiler_CXX" | $SED "$delay_single_quote_subst"`'
+GCC_CXX='`$ECHO "$GCC_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_no_builtin_flag_CXX='`$ECHO "$lt_prog_compiler_no_builtin_flag_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_pic_CXX='`$ECHO "$lt_prog_compiler_pic_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_wl_CXX='`$ECHO "$lt_prog_compiler_wl_CXX" | $SED "$delay_single_quote_subst"`'
+lt_prog_compiler_static_CXX='`$ECHO "$lt_prog_compiler_static_CXX" | $SED "$delay_single_quote_subst"`'
+lt_cv_prog_compiler_c_o_CXX='`$ECHO "$lt_cv_prog_compiler_c_o_CXX" | $SED "$delay_single_quote_subst"`'
+archive_cmds_need_lc_CXX='`$ECHO "$archive_cmds_need_lc_CXX" | $SED "$delay_single_quote_subst"`'
+enable_shared_with_static_runtimes_CXX='`$ECHO "$enable_shared_with_static_runtimes_CXX" | $SED "$delay_single_quote_subst"`'
+export_dynamic_flag_spec_CXX='`$ECHO "$export_dynamic_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+whole_archive_flag_spec_CXX='`$ECHO "$whole_archive_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_needs_object_CXX='`$ECHO "$compiler_needs_object_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_from_new_cmds_CXX='`$ECHO "$old_archive_from_new_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+old_archive_from_expsyms_cmds_CXX='`$ECHO "$old_archive_from_expsyms_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+archive_cmds_CXX='`$ECHO "$archive_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+archive_expsym_cmds_CXX='`$ECHO "$archive_expsym_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+module_cmds_CXX='`$ECHO "$module_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+module_expsym_cmds_CXX='`$ECHO "$module_expsym_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+with_gnu_ld_CXX='`$ECHO "$with_gnu_ld_CXX" | $SED "$delay_single_quote_subst"`'
+allow_undefined_flag_CXX='`$ECHO "$allow_undefined_flag_CXX" | $SED "$delay_single_quote_subst"`'
+no_undefined_flag_CXX='`$ECHO "$no_undefined_flag_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_flag_spec_CXX='`$ECHO "$hardcode_libdir_flag_spec_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_libdir_separator_CXX='`$ECHO "$hardcode_libdir_separator_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_CXX='`$ECHO "$hardcode_direct_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_direct_absolute_CXX='`$ECHO "$hardcode_direct_absolute_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_minus_L_CXX='`$ECHO "$hardcode_minus_L_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_shlibpath_var_CXX='`$ECHO "$hardcode_shlibpath_var_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_automatic_CXX='`$ECHO "$hardcode_automatic_CXX" | $SED "$delay_single_quote_subst"`'
+inherit_rpath_CXX='`$ECHO "$inherit_rpath_CXX" | $SED "$delay_single_quote_subst"`'
+link_all_deplibs_CXX='`$ECHO "$link_all_deplibs_CXX" | $SED "$delay_single_quote_subst"`'
+always_export_symbols_CXX='`$ECHO "$always_export_symbols_CXX" | $SED "$delay_single_quote_subst"`'
+export_symbols_cmds_CXX='`$ECHO "$export_symbols_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+exclude_expsyms_CXX='`$ECHO "$exclude_expsyms_CXX" | $SED "$delay_single_quote_subst"`'
+include_expsyms_CXX='`$ECHO "$include_expsyms_CXX" | $SED "$delay_single_quote_subst"`'
+prelink_cmds_CXX='`$ECHO "$prelink_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+postlink_cmds_CXX='`$ECHO "$postlink_cmds_CXX" | $SED "$delay_single_quote_subst"`'
+file_list_spec_CXX='`$ECHO "$file_list_spec_CXX" | $SED "$delay_single_quote_subst"`'
+hardcode_action_CXX='`$ECHO "$hardcode_action_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_dirs_CXX='`$ECHO "$compiler_lib_search_dirs_CXX" | $SED "$delay_single_quote_subst"`'
+predep_objects_CXX='`$ECHO "$predep_objects_CXX" | $SED "$delay_single_quote_subst"`'
+postdep_objects_CXX='`$ECHO "$postdep_objects_CXX" | $SED "$delay_single_quote_subst"`'
+predeps_CXX='`$ECHO "$predeps_CXX" | $SED "$delay_single_quote_subst"`'
+postdeps_CXX='`$ECHO "$postdeps_CXX" | $SED "$delay_single_quote_subst"`'
+compiler_lib_search_path_CXX='`$ECHO "$compiler_lib_search_path_CXX" | $SED "$delay_single_quote_subst"`'
 
 LTCC='$LTCC'
 LTCFLAGS='$LTCFLAGS'
 compiler='$compiler_DEFAULT'
 
 # A function that is used when there is no print builtin or printf.
@@ -38320,13 +52603,44 @@
 libname_spec \
 library_names_spec \
 soname_spec \
 install_override_mode \
 finish_eval \
 old_striplib \
-striplib; do
+striplib \
+compiler_lib_search_dirs \
+predep_objects \
+postdep_objects \
+predeps \
+postdeps \
+compiler_lib_search_path \
+LD_CXX \
+reload_flag_CXX \
+compiler_CXX \
+lt_prog_compiler_no_builtin_flag_CXX \
+lt_prog_compiler_pic_CXX \
+lt_prog_compiler_wl_CXX \
+lt_prog_compiler_static_CXX \
+lt_cv_prog_compiler_c_o_CXX \
+export_dynamic_flag_spec_CXX \
+whole_archive_flag_spec_CXX \
+compiler_needs_object_CXX \
+with_gnu_ld_CXX \
+allow_undefined_flag_CXX \
+no_undefined_flag_CXX \
+hardcode_libdir_flag_spec_CXX \
+hardcode_libdir_separator_CXX \
+exclude_expsyms_CXX \
+include_expsyms_CXX \
+file_list_spec_CXX \
+compiler_lib_search_dirs_CXX \
+predep_objects_CXX \
+postdep_objects_CXX \
+predeps_CXX \
+postdeps_CXX \
+compiler_lib_search_path_CXX; do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
       eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED \\"\\\$sed_quote_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -38350,13 +52664,24 @@
 prelink_cmds \
 postlink_cmds \
 postinstall_cmds \
 postuninstall_cmds \
 finish_cmds \
 sys_lib_search_path_spec \
-sys_lib_dlsearch_path_spec; do
+sys_lib_dlsearch_path_spec \
+reload_cmds_CXX \
+old_archive_cmds_CXX \
+old_archive_from_new_cmds_CXX \
+old_archive_from_expsyms_cmds_CXX \
+archive_cmds_CXX \
+archive_expsym_cmds_CXX \
+module_cmds_CXX \
+module_expsym_cmds_CXX \
+export_symbols_cmds_CXX \
+prelink_cmds_CXX \
+postlink_cmds_CXX; do
     case \`eval \\\\\$ECHO \\\\""\\\\\$\$var"\\\\"\` in
     *[\\\\\\\`\\"\\\$]*)
       eval "lt_\$var=\\\\\\"\\\`\\\$ECHO \\"\\\$\$var\\" | \\\$SED -e \\"\\\$double_quote_subst\\" -e \\"\\\$sed_quote_subst\\" -e \\"\\\$delay_variable_subst\\"\\\`\\\\\\""
       ;;
     *)
       eval "lt_\$var=\\\\\\"\\\$\$var\\\\\\""
@@ -38395,12 +52722,13 @@
   case $ac_config_target in
     "src/config.h") CONFIG_HEADERS="$CONFIG_HEADERS src/config.h" ;;
     "libtool") CONFIG_COMMANDS="$CONFIG_COMMANDS libtool" ;;
     "depfiles") CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
     "src/libcollectdclient/collectd/lcc_features.h") CONFIG_FILES="$CONFIG_FILES src/libcollectdclient/collectd/lcc_features.h" ;;
     "Makefile") CONFIG_FILES="$CONFIG_FILES Makefile" ;;
+    "proto/Makefile") CONFIG_FILES="$CONFIG_FILES proto/Makefile" ;;
     "src/Makefile") CONFIG_FILES="$CONFIG_FILES src/Makefile" ;;
     "src/daemon/Makefile") CONFIG_FILES="$CONFIG_FILES src/daemon/Makefile" ;;
     "src/collectd.conf") CONFIG_FILES="$CONFIG_FILES src/collectd.conf" ;;
     "src/libcollectdclient/Makefile") CONFIG_FILES="$CONFIG_FILES src/libcollectdclient/Makefile" ;;
     "src/libcollectdclient/libcollectdclient.pc") CONFIG_FILES="$CONFIG_FILES src/libcollectdclient/libcollectdclient.pc" ;;
     "src/liboconfig/Makefile") CONFIG_FILES="$CONFIG_FILES src/liboconfig/Makefile" ;;
@@ -39048,13 +53376,13 @@
 # can be downloaded from http://www.gnu.org/licenses/gpl.html, or
 # obtained by writing to the Free Software Foundation, Inc.,
 # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 
 
 # The names of the tagged configurations supported by this script.
-available_tags=""
+available_tags="CXX "
 
 # ### BEGIN LIBTOOL CONFIG
 
 # Which release of libtool.m4 was used?
 macro_version=$macro_version
 macro_revision=$macro_revision
@@ -39435,12 +53763,26 @@
 # Specify filename containing input files.
 file_list_spec=$lt_file_list_spec
 
 # How to hardcode a shared library path into an executable.
 hardcode_action=$hardcode_action
 
+# The directories searched by this compiler when creating a shared library.
+compiler_lib_search_dirs=$lt_compiler_lib_search_dirs
+
+# Dependencies to place before and after the objects being linked to
+# create a shared library.
+predep_objects=$lt_predep_objects
+postdep_objects=$lt_postdep_objects
+predeps=$lt_predeps
+postdeps=$lt_postdeps
+
+# The library search path used internally by the compiler when linking
+# a shared library.
+compiler_lib_search_path=$lt_compiler_lib_search_path
+
 # ### END LIBTOOL CONFIG
 
 _LT_EOF
 
   case $host_os in
   aix3*)
@@ -39627,12 +53969,165 @@
 
 
    mv -f "$cfgfile" "$ofile" ||
     (rm -f "$ofile" && cp "$cfgfile" "$ofile" && rm -f "$cfgfile")
   chmod +x "$ofile"
 
+
+    cat <<_LT_EOF >> "$ofile"
+
+# ### BEGIN LIBTOOL TAG CONFIG: CXX
+
+# The linker used to build libraries.
+LD=$lt_LD_CXX
+
+# How to create reloadable object files.
+reload_flag=$lt_reload_flag_CXX
+reload_cmds=$lt_reload_cmds_CXX
+
+# Commands used to build an old-style archive.
+old_archive_cmds=$lt_old_archive_cmds_CXX
+
+# A language specific compiler.
+CC=$lt_compiler_CXX
+
+# Is the compiler the GNU compiler?
+with_gcc=$GCC_CXX
+
+# Compiler flag to turn off builtin functions.
+no_builtin_flag=$lt_lt_prog_compiler_no_builtin_flag_CXX
+
+# Additional compiler flags for building library objects.
+pic_flag=$lt_lt_prog_compiler_pic_CXX
+
+# How to pass a linker flag through the compiler.
+wl=$lt_lt_prog_compiler_wl_CXX
+
+# Compiler flag to prevent dynamic linking.
+link_static_flag=$lt_lt_prog_compiler_static_CXX
+
+# Does compiler simultaneously support -c and -o options?
+compiler_c_o=$lt_lt_cv_prog_compiler_c_o_CXX
+
+# Whether or not to add -lc for building shared libraries.
+build_libtool_need_lc=$archive_cmds_need_lc_CXX
+
+# Whether or not to disallow shared libs when runtime libs are static.
+allow_libtool_libs_with_static_runtimes=$enable_shared_with_static_runtimes_CXX
+
+# Compiler flag to allow reflexive dlopens.
+export_dynamic_flag_spec=$lt_export_dynamic_flag_spec_CXX
+
+# Compiler flag to generate shared objects directly from archives.
+whole_archive_flag_spec=$lt_whole_archive_flag_spec_CXX
+
+# Whether the compiler copes with passing no objects directly.
+compiler_needs_object=$lt_compiler_needs_object_CXX
+
+# Create an old-style archive from a shared archive.
+old_archive_from_new_cmds=$lt_old_archive_from_new_cmds_CXX
+
+# Create a temporary old-style archive to link instead of a shared archive.
+old_archive_from_expsyms_cmds=$lt_old_archive_from_expsyms_cmds_CXX
+
+# Commands used to build a shared archive.
+archive_cmds=$lt_archive_cmds_CXX
+archive_expsym_cmds=$lt_archive_expsym_cmds_CXX
+
+# Commands used to build a loadable module if different from building
+# a shared archive.
+module_cmds=$lt_module_cmds_CXX
+module_expsym_cmds=$lt_module_expsym_cmds_CXX
+
+# Whether we are building with GNU ld or not.
+with_gnu_ld=$lt_with_gnu_ld_CXX
+
+# Flag that allows shared libraries with undefined symbols to be built.
+allow_undefined_flag=$lt_allow_undefined_flag_CXX
+
+# Flag that enforces no undefined symbols.
+no_undefined_flag=$lt_no_undefined_flag_CXX
+
+# Flag to hardcode \$libdir into a binary during linking.
+# This must work even if \$libdir does not exist
+hardcode_libdir_flag_spec=$lt_hardcode_libdir_flag_spec_CXX
+
+# Whether we need a single "-rpath" flag with a separated argument.
+hardcode_libdir_separator=$lt_hardcode_libdir_separator_CXX
+
+# Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
+# DIR into the resulting binary.
+hardcode_direct=$hardcode_direct_CXX
+
+# Set to "yes" if using DIR/libNAME\${shared_ext} during linking hardcodes
+# DIR into the resulting binary and the resulting library dependency is
+# "absolute",i.e impossible to change by setting \${shlibpath_var} if the
+# library is relocated.
+hardcode_direct_absolute=$hardcode_direct_absolute_CXX
+
+# Set to "yes" if using the -LDIR flag during linking hardcodes DIR
+# into the resulting binary.
+hardcode_minus_L=$hardcode_minus_L_CXX
+
+# Set to "yes" if using SHLIBPATH_VAR=DIR during linking hardcodes DIR
+# into the resulting binary.
+hardcode_shlibpath_var=$hardcode_shlibpath_var_CXX
+
+# Set to "yes" if building a shared library automatically hardcodes DIR
+# into the library and all subsequent libraries and executables linked
+# against it.
+hardcode_automatic=$hardcode_automatic_CXX
+
+# Set to yes if linker adds runtime paths of dependent libraries
+# to runtime path list.
+inherit_rpath=$inherit_rpath_CXX
+
+# Whether libtool must link a program against all its dependency libraries.
+link_all_deplibs=$link_all_deplibs_CXX
+
+# Set to "yes" if exported symbols are required.
+always_export_symbols=$always_export_symbols_CXX
+
+# The commands to list exported symbols.
+export_symbols_cmds=$lt_export_symbols_cmds_CXX
+
+# Symbols that should not be listed in the preloaded symbols.
+exclude_expsyms=$lt_exclude_expsyms_CXX
+
+# Symbols that must always be exported.
+include_expsyms=$lt_include_expsyms_CXX
+
+# Commands necessary for linking programs (against libraries) with templates.
+prelink_cmds=$lt_prelink_cmds_CXX
+
+# Commands necessary for finishing linking programs.
+postlink_cmds=$lt_postlink_cmds_CXX
+
+# Specify filename containing input files.
+file_list_spec=$lt_file_list_spec_CXX
+
+# How to hardcode a shared library path into an executable.
+hardcode_action=$hardcode_action_CXX
+
+# The directories searched by this compiler when creating a shared library.
+compiler_lib_search_dirs=$lt_compiler_lib_search_dirs_CXX
+
+# Dependencies to place before and after the objects being linked to
+# create a shared library.
+predep_objects=$lt_predep_objects_CXX
+postdep_objects=$lt_postdep_objects_CXX
+predeps=$lt_predeps_CXX
+postdeps=$lt_postdeps_CXX
+
+# The library search path used internally by the compiler when linking
+# a shared library.
+compiler_lib_search_path=$lt_compiler_lib_search_path_CXX
+
+# ### END LIBTOOL TAG CONFIG: CXX
+_LT_EOF
+
  ;;
     "depfiles":C) test x"$AMDEP_TRUE" != x"" || {
   # Older Autoconf quotes --file arguments for eval, but not when files
   # are listed without --file.  Let's play safe and only enable the eval
   # if we detect the quoting.
   case $CONFIG_FILES in
@@ -39929,214 +54424,474 @@
 if test "x$with_perl_bindings" = "xyes" \
 	&& test "x$PERL_BINDINGS_OPTIONS" != "x"
 then
 	with_perl_bindings="yes ($PERL_BINDINGS_OPTIONS)"
 fi
 
-cat <<EOF;
-
-Configuration:
-  Libraries:
-    intel mic . . . . . . $with_mic
-    libaquaero5 . . . . . $with_libaquaero5
-    libatasmart . . . . . $with_libatasmart
-    libcurl . . . . . . . $with_libcurl
-    libdbi  . . . . . . . $with_libdbi
-    libesmtp  . . . . . . $with_libesmtp
-    libganglia  . . . . . $with_libganglia
-    libgcrypt . . . . . . $with_libgcrypt
-    libhal  . . . . . . . $with_libhal
-    libhiredis  . . . . . $with_libhiredis
-    libi2c-dev  . . . . . $with_libi2c
-    libiokit  . . . . . . $with_libiokit
-    libiptc . . . . . . . $with_libiptc
-    libjvm  . . . . . . . $with_java
-    libkstat  . . . . . . $with_kstat
-    libkvm  . . . . . . . $with_libkvm
-    libldap . . . . . . . $with_libldap
-    liblvm2app  . . . . . $with_liblvm2app
-    libmemcached  . . . . $with_libmemcached
-    libmnl  . . . . . . . $with_libmnl
-    libmodbus . . . . . . $with_libmodbus
-    libmongoc . . . . . . $with_libmongoc
-    libmysql  . . . . . . $with_libmysql
-    libnetapp . . . . . . $with_libnetapp
-    libnetsnmp  . . . . . $with_libnetsnmp
-    libnotify . . . . . . $with_libnotify
-    liboconfig  . . . . . $with_liboconfig
-    libopenipmi . . . . . $with_libopenipmipthread
-    liboping  . . . . . . $with_liboping
-    libowcapi . . . . . . $with_libowcapi
-    libpcap . . . . . . . $with_libpcap
-    libperfstat . . . . . $with_perfstat
-    libperl . . . . . . . $with_libperl
-    libpq . . . . . . . . $with_libpq
-    libpthread  . . . . . $with_libpthread
-    librabbitmq . . . . . $with_librabbitmq
-    librdkafka  . . . . . $with_librdkafka
-    librouteros . . . . . $with_librouteros
-    librrd  . . . . . . . $with_librrd
-    libsensors  . . . . . $with_libsensors
-    libsigrok   . . . . . $with_libsigrok
-    libstatgrab . . . . . $with_libstatgrab
-    libtokyotyrant  . . . $with_libtokyotyrant
-    libudev . . . . . . . $with_libudev
-    libupsclient  . . . . $with_libupsclient
-    libvarnish  . . . . . $with_libvarnish
-    libvirt . . . . . . . $with_libvirt
-    libxml2 . . . . . . . $with_libxml2
-    libxmms . . . . . . . $with_libxmms
-    libyajl . . . . . . . $with_libyajl
-    oracle  . . . . . . . $with_oracle
-    protobuf-c  . . . . . $have_protoc_c
-    python  . . . . . . . $with_python
-
-  Features:
-    daemon mode . . . . . $enable_daemon
-    debug . . . . . . . . $enable_debug
-
-  Bindings:
-    perl  . . . . . . . . $with_perl_bindings
-
-  Modules:
-    aggregation . . . . . $enable_aggregation
-    amqp    . . . . . . . $enable_amqp
-    apache  . . . . . . . $enable_apache
-    apcups  . . . . . . . $enable_apcups
-    apple_sensors . . . . $enable_apple_sensors
-    aquaero . . . . . . . $enable_aquaero
-    ascent  . . . . . . . $enable_ascent
-    barometer . . . . . . $enable_barometer
-    battery . . . . . . . $enable_battery
-    bind  . . . . . . . . $enable_bind
-    ceph  . . . . . . . . $enable_ceph
-    cgroups . . . . . . . $enable_cgroups
-    conntrack . . . . . . $enable_conntrack
-    contextswitch . . . . $enable_contextswitch
-    cpu . . . . . . . . . $enable_cpu
-    cpufreq . . . . . . . $enable_cpufreq
-    csv . . . . . . . . . $enable_csv
-    curl  . . . . . . . . $enable_curl
-    curl_json . . . . . . $enable_curl_json
-    curl_xml  . . . . . . $enable_curl_xml
-    dbi . . . . . . . . . $enable_dbi
-    df  . . . . . . . . . $enable_df
-    disk  . . . . . . . . $enable_disk
-    dns . . . . . . . . . $enable_dns
-    drbd  . . . . . . . . $enable_drbd
-    email . . . . . . . . $enable_email
-    entropy . . . . . . . $enable_entropy
-    ethstat . . . . . . . $enable_ethstat
-    exec  . . . . . . . . $enable_exec
-    fhcount . . . . . . . $enable_fhcount
-    filecount . . . . . . $enable_filecount
-    fscache . . . . . . . $enable_fscache
-    gmond . . . . . . . . $enable_gmond
-    hddtemp . . . . . . . $enable_hddtemp
-    interface . . . . . . $enable_interface
-    ipc . . . . . . . . . $enable_ipc
-    ipmi  . . . . . . . . $enable_ipmi
-    iptables  . . . . . . $enable_iptables
-    ipvs  . . . . . . . . $enable_ipvs
-    irq . . . . . . . . . $enable_irq
-    java  . . . . . . . . $enable_java
-    load  . . . . . . . . $enable_load
-    logfile . . . . . . . $enable_logfile
-    log_logstash  . . . . $enable_log_logstash
-    lpar  . . . . . . . . $enable_lpar
-    lvm . . . . . . . . . $enable_lvm
-    madwifi . . . . . . . $enable_madwifi
-    match_empty_counter . $enable_match_empty_counter
-    match_hashed  . . . . $enable_match_hashed
-    match_regex . . . . . $enable_match_regex
-    match_timediff  . . . $enable_match_timediff
-    match_value . . . . . $enable_match_value
-    mbmon . . . . . . . . $enable_mbmon
-    md  . . . . . . . . . $enable_md
-    memcachec . . . . . . $enable_memcachec
-    memcached . . . . . . $enable_memcached
-    memory  . . . . . . . $enable_memory
-    mic . . . . . . . . . $enable_mic
-    modbus  . . . . . . . $enable_modbus
-    multimeter  . . . . . $enable_multimeter
-    mysql . . . . . . . . $enable_mysql
-    netapp  . . . . . . . $enable_netapp
-    netlink . . . . . . . $enable_netlink
-    network . . . . . . . $enable_network
-    nfs . . . . . . . . . $enable_nfs
-    nginx . . . . . . . . $enable_nginx
-    notify_desktop  . . . $enable_notify_desktop
-    notify_email  . . . . $enable_notify_email
-    ntpd  . . . . . . . . $enable_ntpd
-    numa  . . . . . . . . $enable_numa
-    nut . . . . . . . . . $enable_nut
-    olsrd . . . . . . . . $enable_olsrd
-    onewire . . . . . . . $enable_onewire
-    openldap  . . . . . . $enable_openldap
-    openvpn . . . . . . . $enable_openvpn
-    oracle  . . . . . . . $enable_oracle
-    perl  . . . . . . . . $enable_perl
-    pf  . . . . . . . . . $enable_pf
-    pinba . . . . . . . . $enable_pinba
-    ping  . . . . . . . . $enable_ping
-    postgresql  . . . . . $enable_postgresql
-    powerdns  . . . . . . $enable_powerdns
-    processes . . . . . . $enable_processes
-    protocols . . . . . . $enable_protocols
-    python  . . . . . . . $enable_python
-    redis . . . . . . . . $enable_redis
-    routeros  . . . . . . $enable_routeros
-    rrdcached . . . . . . $enable_rrdcached
-    rrdtool . . . . . . . $enable_rrdtool
-    sensors . . . . . . . $enable_sensors
-    serial  . . . . . . . $enable_serial
-    sigrok  . . . . . . . $enable_sigrok
-    smart . . . . . . . . $enable_smart
-    snmp  . . . . . . . . $enable_snmp
-    statsd  . . . . . . . $enable_statsd
-    swap  . . . . . . . . $enable_swap
-    syslog  . . . . . . . $enable_syslog
-    table . . . . . . . . $enable_table
-    tail_csv  . . . . . . $enable_tail_csv
-    tail  . . . . . . . . $enable_tail
-    tape  . . . . . . . . $enable_tape
-    target_notification . $enable_target_notification
-    target_replace  . . . $enable_target_replace
-    target_scale  . . . . $enable_target_scale
-    target_set  . . . . . $enable_target_set
-    target_v5upgrade  . . $enable_target_v5upgrade
-    tcpconns  . . . . . . $enable_tcpconns
-    teamspeak2  . . . . . $enable_teamspeak2
-    ted . . . . . . . . . $enable_ted
-    thermal . . . . . . . $enable_thermal
-    threshold . . . . . . $enable_threshold
-    tokyotyrant . . . . . $enable_tokyotyrant
-    turbostat . . . . . . $enable_turbostat
-    unixsock  . . . . . . $enable_unixsock
-    uptime  . . . . . . . $enable_uptime
-    users . . . . . . . . $enable_users
-    uuid  . . . . . . . . $enable_uuid
-    varnish . . . . . . . $enable_varnish
-    virt  . . . . . . . . $enable_virt
-    vmem  . . . . . . . . $enable_vmem
-    vserver . . . . . . . $enable_vserver
-    wireless  . . . . . . $enable_wireless
-    write_graphite  . . . $enable_write_graphite
-    write_http  . . . . . $enable_write_http
-    write_kafka . . . . . $enable_write_kafka
-    write_log . . . . . . $enable_write_log
-    write_mongodb . . . . $enable_write_mongodb
-    write_redis . . . . . $enable_write_redis
-    write_riemann . . . . $enable_write_riemann
-    write_sensu . . . . . $enable_write_sensu
-    write_tsdb  . . . . . $enable_write_tsdb
-    xmms  . . . . . . . . $enable_xmms
-    zfs_arc . . . . . . . $enable_zfs_arc
-    zookeeper . . . . . . $enable_zookeeper
-
-EOF
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Configuration:" >&5
+$as_echo "Configuration:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:   Build:" >&5
+$as_echo "  Build:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     Platform  . . . . . . $ac_system" >&5
+$as_echo "    Platform  . . . . . . $ac_system" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     CC  . . . . . . . . . $CC" >&5
+$as_echo "    CC  . . . . . . . . . $CC" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     CFLAGS  . . . . . . . $AM_CFLAGS $CFLAGS" >&5
+$as_echo "    CFLAGS  . . . . . . . $AM_CFLAGS $CFLAGS" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     CXXFLAGS  . . . . . . $AM_CXXFLAGS $CXXFLAGS" >&5
+$as_echo "    CXXFLAGS  . . . . . . $AM_CXXFLAGS $CXXFLAGS" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     CPP . . . . . . . . . $CPP" >&5
+$as_echo "    CPP . . . . . . . . . $CPP" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     CPPFLAGS  . . . . . . $CPPFLAGS" >&5
+$as_echo "    CPPFLAGS  . . . . . . $CPPFLAGS" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     GRPC_CPP_PLUGIN . . . $GRPC_CPP_PLUGIN" >&5
+$as_echo "    GRPC_CPP_PLUGIN . . . $GRPC_CPP_PLUGIN" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     LD  . . . . . . . . . $LD" >&5
+$as_echo "    LD  . . . . . . . . . $LD" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     LDFLAGS . . . . . . . $LDFLAGS" >&5
+$as_echo "    LDFLAGS . . . . . . . $LDFLAGS" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     PROTOC  . . . . . . . $PROTOC" >&5
+$as_echo "    PROTOC  . . . . . . . $PROTOC" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     YACC  . . . . . . . . $YACC" >&5
+$as_echo "    YACC  . . . . . . . . $YACC" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     YFLAGS  . . . . . . . $YFLAGS" >&5
+$as_echo "    YFLAGS  . . . . . . . $YFLAGS" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:   Libraries:" >&5
+$as_echo "  Libraries:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     intel mic . . . . . . $with_mic" >&5
+$as_echo "    intel mic . . . . . . $with_mic" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libaquaero5 . . . . . $with_libaquaero5" >&5
+$as_echo "    libaquaero5 . . . . . $with_libaquaero5" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libatasmart . . . . . $with_libatasmart" >&5
+$as_echo "    libatasmart . . . . . $with_libatasmart" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libcurl . . . . . . . $with_libcurl" >&5
+$as_echo "    libcurl . . . . . . . $with_libcurl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libdbi  . . . . . . . $with_libdbi" >&5
+$as_echo "    libdbi  . . . . . . . $with_libdbi" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libesmtp  . . . . . . $with_libesmtp" >&5
+$as_echo "    libesmtp  . . . . . . $with_libesmtp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libganglia  . . . . . $with_libganglia" >&5
+$as_echo "    libganglia  . . . . . $with_libganglia" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libgcrypt . . . . . . $with_libgcrypt" >&5
+$as_echo "    libgcrypt . . . . . . $with_libgcrypt" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libgps  . . . . . . . $with_libgps" >&5
+$as_echo "    libgps  . . . . . . . $with_libgps" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libgrpc++ . . . . . . $with_libgrpcpp" >&5
+$as_echo "    libgrpc++ . . . . . . $with_libgrpcpp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libhal  . . . . . . . $with_libhal" >&5
+$as_echo "    libhal  . . . . . . . $with_libhal" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libhiredis  . . . . . $with_libhiredis" >&5
+$as_echo "    libhiredis  . . . . . $with_libhiredis" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libi2c-dev  . . . . . $with_libi2c" >&5
+$as_echo "    libi2c-dev  . . . . . $with_libi2c" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libiokit  . . . . . . $with_libiokit" >&5
+$as_echo "    libiokit  . . . . . . $with_libiokit" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libiptc . . . . . . . $with_libiptc" >&5
+$as_echo "    libiptc . . . . . . . $with_libiptc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libjvm  . . . . . . . $with_java" >&5
+$as_echo "    libjvm  . . . . . . . $with_java" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libkstat  . . . . . . $with_kstat" >&5
+$as_echo "    libkstat  . . . . . . $with_kstat" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libkvm  . . . . . . . $with_libkvm" >&5
+$as_echo "    libkvm  . . . . . . . $with_libkvm" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libldap . . . . . . . $with_libldap" >&5
+$as_echo "    libldap . . . . . . . $with_libldap" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     liblua  . . . . . . . $with_liblua" >&5
+$as_echo "    liblua  . . . . . . . $with_liblua" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     liblvm2app  . . . . . $with_liblvm2app" >&5
+$as_echo "    liblvm2app  . . . . . $with_liblvm2app" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmemcached  . . . . $with_libmemcached" >&5
+$as_echo "    libmemcached  . . . . $with_libmemcached" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmnl  . . . . . . . $with_libmnl" >&5
+$as_echo "    libmnl  . . . . . . . $with_libmnl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmodbus . . . . . . $with_libmodbus" >&5
+$as_echo "    libmodbus . . . . . . $with_libmodbus" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmongoc . . . . . . $with_libmongoc" >&5
+$as_echo "    libmongoc . . . . . . $with_libmongoc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmosquitto  . . . . $with_libmosquitto" >&5
+$as_echo "    libmosquitto  . . . . $with_libmosquitto" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libmysql  . . . . . . $with_libmysql" >&5
+$as_echo "    libmysql  . . . . . . $with_libmysql" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libnetapp . . . . . . $with_libnetapp" >&5
+$as_echo "    libnetapp . . . . . . $with_libnetapp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libnetsnmp  . . . . . $with_libnetsnmp" >&5
+$as_echo "    libnetsnmp  . . . . . $with_libnetsnmp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libnotify . . . . . . $with_libnotify" >&5
+$as_echo "    libnotify . . . . . . $with_libnotify" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     liboconfig  . . . . . $with_liboconfig" >&5
+$as_echo "    liboconfig  . . . . . $with_liboconfig" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libopenipmi . . . . . $with_libopenipmipthread" >&5
+$as_echo "    libopenipmi . . . . . $with_libopenipmipthread" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     liboping  . . . . . . $with_liboping" >&5
+$as_echo "    liboping  . . . . . . $with_liboping" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libowcapi . . . . . . $with_libowcapi" >&5
+$as_echo "    libowcapi . . . . . . $with_libowcapi" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libpcap . . . . . . . $with_libpcap" >&5
+$as_echo "    libpcap . . . . . . . $with_libpcap" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libperfstat . . . . . $with_perfstat" >&5
+$as_echo "    libperfstat . . . . . $with_perfstat" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libperl . . . . . . . $with_libperl" >&5
+$as_echo "    libperl . . . . . . . $with_libperl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libpq . . . . . . . . $with_libpq" >&5
+$as_echo "    libpq . . . . . . . . $with_libpq" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libprotobuf . . . . . $with_libprotobuf" >&5
+$as_echo "    libprotobuf . . . . . $with_libprotobuf" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libprotobuf-c . . . . $with_libprotobuf_c" >&5
+$as_echo "    libprotobuf-c . . . . $with_libprotobuf_c" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libpython . . . . . . $with_libpython" >&5
+$as_echo "    libpython . . . . . . $with_libpython" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     librabbitmq . . . . . $with_librabbitmq" >&5
+$as_echo "    librabbitmq . . . . . $with_librabbitmq" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libriemann-client . . $with_libriemann_client" >&5
+$as_echo "    libriemann-client . . $with_libriemann_client" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     librdkafka  . . . . . $with_librdkafka" >&5
+$as_echo "    librdkafka  . . . . . $with_librdkafka" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     librouteros . . . . . $with_librouteros" >&5
+$as_echo "    librouteros . . . . . $with_librouteros" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     librrd  . . . . . . . $with_librrd" >&5
+$as_echo "    librrd  . . . . . . . $with_librrd" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libsensors  . . . . . $with_libsensors" >&5
+$as_echo "    libsensors  . . . . . $with_libsensors" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libsigrok   . . . . . $with_libsigrok" >&5
+$as_echo "    libsigrok   . . . . . $with_libsigrok" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libstatgrab . . . . . $with_libstatgrab" >&5
+$as_echo "    libstatgrab . . . . . $with_libstatgrab" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libtokyotyrant  . . . $with_libtokyotyrant" >&5
+$as_echo "    libtokyotyrant  . . . $with_libtokyotyrant" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libudev . . . . . . . $with_libudev" >&5
+$as_echo "    libudev . . . . . . . $with_libudev" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libupsclient  . . . . $with_libupsclient" >&5
+$as_echo "    libupsclient  . . . . $with_libupsclient" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libvarnish  . . . . . $with_libvarnish" >&5
+$as_echo "    libvarnish  . . . . . $with_libvarnish" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libvirt . . . . . . . $with_libvirt" >&5
+$as_echo "    libvirt . . . . . . . $with_libvirt" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libxenctrl  . . . . . $with_libxenctrl" >&5
+$as_echo "    libxenctrl  . . . . . $with_libxenctrl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libxml2 . . . . . . . $with_libxml2" >&5
+$as_echo "    libxml2 . . . . . . . $with_libxml2" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libxmms . . . . . . . $with_libxmms" >&5
+$as_echo "    libxmms . . . . . . . $with_libxmms" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     libyajl . . . . . . . $with_libyajl" >&5
+$as_echo "    libyajl . . . . . . . $with_libyajl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     oracle  . . . . . . . $with_oracle" >&5
+$as_echo "    oracle  . . . . . . . $with_oracle" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     protobuf-c  . . . . . $have_protoc_c" >&5
+$as_echo "    protobuf-c  . . . . . $have_protoc_c" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     protoc 3  . . . . . . $have_protoc3" >&5
+$as_echo "    protoc 3  . . . . . . $have_protoc3" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:   Features:" >&5
+$as_echo "  Features:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     daemon mode . . . . . $enable_daemon" >&5
+$as_echo "    daemon mode . . . . . $enable_daemon" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     debug . . . . . . . . $enable_debug" >&5
+$as_echo "    debug . . . . . . . . $enable_debug" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:   Bindings:" >&5
+$as_echo "  Bindings:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     perl  . . . . . . . . $with_perl_bindings" >&5
+$as_echo "    perl  . . . . . . . . $with_perl_bindings" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:   Modules:" >&5
+$as_echo "  Modules:" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     aggregation . . . . . $enable_aggregation" >&5
+$as_echo "    aggregation . . . . . $enable_aggregation" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     amqp    . . . . . . . $enable_amqp" >&5
+$as_echo "    amqp    . . . . . . . $enable_amqp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     apache  . . . . . . . $enable_apache" >&5
+$as_echo "    apache  . . . . . . . $enable_apache" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     apcups  . . . . . . . $enable_apcups" >&5
+$as_echo "    apcups  . . . . . . . $enable_apcups" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     apple_sensors . . . . $enable_apple_sensors" >&5
+$as_echo "    apple_sensors . . . . $enable_apple_sensors" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     aquaero . . . . . . . $enable_aquaero" >&5
+$as_echo "    aquaero . . . . . . . $enable_aquaero" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ascent  . . . . . . . $enable_ascent" >&5
+$as_echo "    ascent  . . . . . . . $enable_ascent" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     barometer . . . . . . $enable_barometer" >&5
+$as_echo "    barometer . . . . . . $enable_barometer" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     battery . . . . . . . $enable_battery" >&5
+$as_echo "    battery . . . . . . . $enable_battery" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     bind  . . . . . . . . $enable_bind" >&5
+$as_echo "    bind  . . . . . . . . $enable_bind" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ceph  . . . . . . . . $enable_ceph" >&5
+$as_echo "    ceph  . . . . . . . . $enable_ceph" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     cgroups . . . . . . . $enable_cgroups" >&5
+$as_echo "    cgroups . . . . . . . $enable_cgroups" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     chrony. . . . . . . . $enable_chrony" >&5
+$as_echo "    chrony. . . . . . . . $enable_chrony" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     conntrack . . . . . . $enable_conntrack" >&5
+$as_echo "    conntrack . . . . . . $enable_conntrack" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     contextswitch . . . . $enable_contextswitch" >&5
+$as_echo "    contextswitch . . . . $enable_contextswitch" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     cpu . . . . . . . . . $enable_cpu" >&5
+$as_echo "    cpu . . . . . . . . . $enable_cpu" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     cpufreq . . . . . . . $enable_cpufreq" >&5
+$as_echo "    cpufreq . . . . . . . $enable_cpufreq" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     cpusleep  . . . . . . $enable_cpusleep" >&5
+$as_echo "    cpusleep  . . . . . . $enable_cpusleep" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     csv . . . . . . . . . $enable_csv" >&5
+$as_echo "    csv . . . . . . . . . $enable_csv" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     curl  . . . . . . . . $enable_curl" >&5
+$as_echo "    curl  . . . . . . . . $enable_curl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     curl_json . . . . . . $enable_curl_json" >&5
+$as_echo "    curl_json . . . . . . $enable_curl_json" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     curl_xml  . . . . . . $enable_curl_xml" >&5
+$as_echo "    curl_xml  . . . . . . $enable_curl_xml" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     dbi . . . . . . . . . $enable_dbi" >&5
+$as_echo "    dbi . . . . . . . . . $enable_dbi" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     df  . . . . . . . . . $enable_df" >&5
+$as_echo "    df  . . . . . . . . . $enable_df" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     disk  . . . . . . . . $enable_disk" >&5
+$as_echo "    disk  . . . . . . . . $enable_disk" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     dns . . . . . . . . . $enable_dns" >&5
+$as_echo "    dns . . . . . . . . . $enable_dns" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     drbd  . . . . . . . . $enable_drbd" >&5
+$as_echo "    drbd  . . . . . . . . $enable_drbd" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     email . . . . . . . . $enable_email" >&5
+$as_echo "    email . . . . . . . . $enable_email" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     entropy . . . . . . . $enable_entropy" >&5
+$as_echo "    entropy . . . . . . . $enable_entropy" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ethstat . . . . . . . $enable_ethstat" >&5
+$as_echo "    ethstat . . . . . . . $enable_ethstat" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     exec  . . . . . . . . $enable_exec" >&5
+$as_echo "    exec  . . . . . . . . $enable_exec" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     fhcount . . . . . . . $enable_fhcount" >&5
+$as_echo "    fhcount . . . . . . . $enable_fhcount" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     filecount . . . . . . $enable_filecount" >&5
+$as_echo "    filecount . . . . . . $enable_filecount" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     fscache . . . . . . . $enable_fscache" >&5
+$as_echo "    fscache . . . . . . . $enable_fscache" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     gmond . . . . . . . . $enable_gmond" >&5
+$as_echo "    gmond . . . . . . . . $enable_gmond" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     gps . . . . . . . . . $enable_gps" >&5
+$as_echo "    gps . . . . . . . . . $enable_gps" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     grpc  . . . . . . . . $enable_grpc" >&5
+$as_echo "    grpc  . . . . . . . . $enable_grpc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     hddtemp . . . . . . . $enable_hddtemp" >&5
+$as_echo "    hddtemp . . . . . . . $enable_hddtemp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     interface . . . . . . $enable_interface" >&5
+$as_echo "    interface . . . . . . $enable_interface" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ipc . . . . . . . . . $enable_ipc" >&5
+$as_echo "    ipc . . . . . . . . . $enable_ipc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ipmi  . . . . . . . . $enable_ipmi" >&5
+$as_echo "    ipmi  . . . . . . . . $enable_ipmi" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     iptables  . . . . . . $enable_iptables" >&5
+$as_echo "    iptables  . . . . . . $enable_iptables" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ipvs  . . . . . . . . $enable_ipvs" >&5
+$as_echo "    ipvs  . . . . . . . . $enable_ipvs" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     irq . . . . . . . . . $enable_irq" >&5
+$as_echo "    irq . . . . . . . . . $enable_irq" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     java  . . . . . . . . $enable_java" >&5
+$as_echo "    java  . . . . . . . . $enable_java" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     load  . . . . . . . . $enable_load" >&5
+$as_echo "    load  . . . . . . . . $enable_load" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     logfile . . . . . . . $enable_logfile" >&5
+$as_echo "    logfile . . . . . . . $enable_logfile" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     log_logstash  . . . . $enable_log_logstash" >&5
+$as_echo "    log_logstash  . . . . $enable_log_logstash" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     lpar  . . . . . . . . $enable_lpar" >&5
+$as_echo "    lpar  . . . . . . . . $enable_lpar" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     lua . . . . . . . . . $enable_lua" >&5
+$as_echo "    lua . . . . . . . . . $enable_lua" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     lvm . . . . . . . . . $enable_lvm" >&5
+$as_echo "    lvm . . . . . . . . . $enable_lvm" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     madwifi . . . . . . . $enable_madwifi" >&5
+$as_echo "    madwifi . . . . . . . $enable_madwifi" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     match_empty_counter . $enable_match_empty_counter" >&5
+$as_echo "    match_empty_counter . $enable_match_empty_counter" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     match_hashed  . . . . $enable_match_hashed" >&5
+$as_echo "    match_hashed  . . . . $enable_match_hashed" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     match_regex . . . . . $enable_match_regex" >&5
+$as_echo "    match_regex . . . . . $enable_match_regex" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     match_timediff  . . . $enable_match_timediff" >&5
+$as_echo "    match_timediff  . . . $enable_match_timediff" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     match_value . . . . . $enable_match_value" >&5
+$as_echo "    match_value . . . . . $enable_match_value" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     mbmon . . . . . . . . $enable_mbmon" >&5
+$as_echo "    mbmon . . . . . . . . $enable_mbmon" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     md  . . . . . . . . . $enable_md" >&5
+$as_echo "    md  . . . . . . . . . $enable_md" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     memcachec . . . . . . $enable_memcachec" >&5
+$as_echo "    memcachec . . . . . . $enable_memcachec" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     memcached . . . . . . $enable_memcached" >&5
+$as_echo "    memcached . . . . . . $enable_memcached" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     memory  . . . . . . . $enable_memory" >&5
+$as_echo "    memory  . . . . . . . $enable_memory" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     mic . . . . . . . . . $enable_mic" >&5
+$as_echo "    mic . . . . . . . . . $enable_mic" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     modbus  . . . . . . . $enable_modbus" >&5
+$as_echo "    modbus  . . . . . . . $enable_modbus" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     mqtt  . . . . . . . . $enable_mqtt" >&5
+$as_echo "    mqtt  . . . . . . . . $enable_mqtt" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     multimeter  . . . . . $enable_multimeter" >&5
+$as_echo "    multimeter  . . . . . $enable_multimeter" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     mysql . . . . . . . . $enable_mysql" >&5
+$as_echo "    mysql . . . . . . . . $enable_mysql" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     netapp  . . . . . . . $enable_netapp" >&5
+$as_echo "    netapp  . . . . . . . $enable_netapp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     netlink . . . . . . . $enable_netlink" >&5
+$as_echo "    netlink . . . . . . . $enable_netlink" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     network . . . . . . . $enable_network" >&5
+$as_echo "    network . . . . . . . $enable_network" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     nfs . . . . . . . . . $enable_nfs" >&5
+$as_echo "    nfs . . . . . . . . . $enable_nfs" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     nginx . . . . . . . . $enable_nginx" >&5
+$as_echo "    nginx . . . . . . . . $enable_nginx" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     notify_desktop  . . . $enable_notify_desktop" >&5
+$as_echo "    notify_desktop  . . . $enable_notify_desktop" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     notify_email  . . . . $enable_notify_email" >&5
+$as_echo "    notify_email  . . . . $enable_notify_email" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     notify_nagios . . . . $enable_notify_nagios" >&5
+$as_echo "    notify_nagios . . . . $enable_notify_nagios" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ntpd  . . . . . . . . $enable_ntpd" >&5
+$as_echo "    ntpd  . . . . . . . . $enable_ntpd" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     numa  . . . . . . . . $enable_numa" >&5
+$as_echo "    numa  . . . . . . . . $enable_numa" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     nut . . . . . . . . . $enable_nut" >&5
+$as_echo "    nut . . . . . . . . . $enable_nut" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     olsrd . . . . . . . . $enable_olsrd" >&5
+$as_echo "    olsrd . . . . . . . . $enable_olsrd" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     onewire . . . . . . . $enable_onewire" >&5
+$as_echo "    onewire . . . . . . . $enable_onewire" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     openldap  . . . . . . $enable_openldap" >&5
+$as_echo "    openldap  . . . . . . $enable_openldap" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     openvpn . . . . . . . $enable_openvpn" >&5
+$as_echo "    openvpn . . . . . . . $enable_openvpn" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     oracle  . . . . . . . $enable_oracle" >&5
+$as_echo "    oracle  . . . . . . . $enable_oracle" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     perl  . . . . . . . . $enable_perl" >&5
+$as_echo "    perl  . . . . . . . . $enable_perl" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     pf  . . . . . . . . . $enable_pf" >&5
+$as_echo "    pf  . . . . . . . . . $enable_pf" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     pinba . . . . . . . . $enable_pinba" >&5
+$as_echo "    pinba . . . . . . . . $enable_pinba" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ping  . . . . . . . . $enable_ping" >&5
+$as_echo "    ping  . . . . . . . . $enable_ping" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     postgresql  . . . . . $enable_postgresql" >&5
+$as_echo "    postgresql  . . . . . $enable_postgresql" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     powerdns  . . . . . . $enable_powerdns" >&5
+$as_echo "    powerdns  . . . . . . $enable_powerdns" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     processes . . . . . . $enable_processes" >&5
+$as_echo "    processes . . . . . . $enable_processes" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     protocols . . . . . . $enable_protocols" >&5
+$as_echo "    protocols . . . . . . $enable_protocols" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     python  . . . . . . . $enable_python" >&5
+$as_echo "    python  . . . . . . . $enable_python" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     redis . . . . . . . . $enable_redis" >&5
+$as_echo "    redis . . . . . . . . $enable_redis" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     routeros  . . . . . . $enable_routeros" >&5
+$as_echo "    routeros  . . . . . . $enable_routeros" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     rrdcached . . . . . . $enable_rrdcached" >&5
+$as_echo "    rrdcached . . . . . . $enable_rrdcached" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     rrdtool . . . . . . . $enable_rrdtool" >&5
+$as_echo "    rrdtool . . . . . . . $enable_rrdtool" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     sensors . . . . . . . $enable_sensors" >&5
+$as_echo "    sensors . . . . . . . $enable_sensors" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     serial  . . . . . . . $enable_serial" >&5
+$as_echo "    serial  . . . . . . . $enable_serial" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     sigrok  . . . . . . . $enable_sigrok" >&5
+$as_echo "    sigrok  . . . . . . . $enable_sigrok" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     smart . . . . . . . . $enable_smart" >&5
+$as_echo "    smart . . . . . . . . $enable_smart" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     snmp  . . . . . . . . $enable_snmp" >&5
+$as_echo "    snmp  . . . . . . . . $enable_snmp" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     statsd  . . . . . . . $enable_statsd" >&5
+$as_echo "    statsd  . . . . . . . $enable_statsd" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     swap  . . . . . . . . $enable_swap" >&5
+$as_echo "    swap  . . . . . . . . $enable_swap" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     syslog  . . . . . . . $enable_syslog" >&5
+$as_echo "    syslog  . . . . . . . $enable_syslog" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     table . . . . . . . . $enable_table" >&5
+$as_echo "    table . . . . . . . . $enable_table" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     tail_csv  . . . . . . $enable_tail_csv" >&5
+$as_echo "    tail_csv  . . . . . . $enable_tail_csv" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     tail  . . . . . . . . $enable_tail" >&5
+$as_echo "    tail  . . . . . . . . $enable_tail" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     tape  . . . . . . . . $enable_tape" >&5
+$as_echo "    tape  . . . . . . . . $enable_tape" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     target_notification . $enable_target_notification" >&5
+$as_echo "    target_notification . $enable_target_notification" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     target_replace  . . . $enable_target_replace" >&5
+$as_echo "    target_replace  . . . $enable_target_replace" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     target_scale  . . . . $enable_target_scale" >&5
+$as_echo "    target_scale  . . . . $enable_target_scale" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     target_set  . . . . . $enable_target_set" >&5
+$as_echo "    target_set  . . . . . $enable_target_set" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     target_v5upgrade  . . $enable_target_v5upgrade" >&5
+$as_echo "    target_v5upgrade  . . $enable_target_v5upgrade" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     tcpconns  . . . . . . $enable_tcpconns" >&5
+$as_echo "    tcpconns  . . . . . . $enable_tcpconns" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     teamspeak2  . . . . . $enable_teamspeak2" >&5
+$as_echo "    teamspeak2  . . . . . $enable_teamspeak2" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     ted . . . . . . . . . $enable_ted" >&5
+$as_echo "    ted . . . . . . . . . $enable_ted" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     thermal . . . . . . . $enable_thermal" >&5
+$as_echo "    thermal . . . . . . . $enable_thermal" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     threshold . . . . . . $enable_threshold" >&5
+$as_echo "    threshold . . . . . . $enable_threshold" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     tokyotyrant . . . . . $enable_tokyotyrant" >&5
+$as_echo "    tokyotyrant . . . . . $enable_tokyotyrant" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     turbostat . . . . . . $enable_turbostat" >&5
+$as_echo "    turbostat . . . . . . $enable_turbostat" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     unixsock  . . . . . . $enable_unixsock" >&5
+$as_echo "    unixsock  . . . . . . $enable_unixsock" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     uptime  . . . . . . . $enable_uptime" >&5
+$as_echo "    uptime  . . . . . . . $enable_uptime" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     users . . . . . . . . $enable_users" >&5
+$as_echo "    users . . . . . . . . $enable_users" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     uuid  . . . . . . . . $enable_uuid" >&5
+$as_echo "    uuid  . . . . . . . . $enable_uuid" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     varnish . . . . . . . $enable_varnish" >&5
+$as_echo "    varnish . . . . . . . $enable_varnish" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     virt  . . . . . . . . $enable_virt" >&5
+$as_echo "    virt  . . . . . . . . $enable_virt" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     vmem  . . . . . . . . $enable_vmem" >&5
+$as_echo "    vmem  . . . . . . . . $enable_vmem" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     vserver . . . . . . . $enable_vserver" >&5
+$as_echo "    vserver . . . . . . . $enable_vserver" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     wireless  . . . . . . $enable_wireless" >&5
+$as_echo "    wireless  . . . . . . $enable_wireless" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_graphite  . . . $enable_write_graphite" >&5
+$as_echo "    write_graphite  . . . $enable_write_graphite" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_http  . . . . . $enable_write_http" >&5
+$as_echo "    write_http  . . . . . $enable_write_http" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_kafka . . . . . $enable_write_kafka" >&5
+$as_echo "    write_kafka . . . . . $enable_write_kafka" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_log . . . . . . $enable_write_log" >&5
+$as_echo "    write_log . . . . . . $enable_write_log" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_mongodb . . . . $enable_write_mongodb" >&5
+$as_echo "    write_mongodb . . . . $enable_write_mongodb" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_redis . . . . . $enable_write_redis" >&5
+$as_echo "    write_redis . . . . . $enable_write_redis" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_riemann . . . . $enable_write_riemann" >&5
+$as_echo "    write_riemann . . . . $enable_write_riemann" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_sensu . . . . . $enable_write_sensu" >&5
+$as_echo "    write_sensu . . . . . $enable_write_sensu" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     write_tsdb  . . . . . $enable_write_tsdb" >&5
+$as_echo "    write_tsdb  . . . . . $enable_write_tsdb" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     xencpu  . . . . . . . $enable_xencpu" >&5
+$as_echo "    xencpu  . . . . . . . $enable_xencpu" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     xmms  . . . . . . . . $enable_xmms" >&5
+$as_echo "    xmms  . . . . . . . . $enable_xmms" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     zfs_arc . . . . . . . $enable_zfs_arc" >&5
+$as_echo "    zfs_arc . . . . . . . $enable_zfs_arc" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     zone  . . . . . . . . $enable_zone" >&5
+$as_echo "    zone  . . . . . . . . $enable_zone" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result:     zookeeper . . . . . . $enable_zookeeper" >&5
+$as_echo "    zookeeper . . . . . . $enable_zookeeper" >&6; }
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: " >&5
+$as_echo "" >&6; }
 
 if test "x$dependency_error" = "xyes"; then
 	as_fn_error $? "\"Some plugins are missing dependencies - see the summary above for details\"" "$LINENO" 5
 fi
 
 if test "x$dependency_warning" = "xyes"; then
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/configure.ac	2016-11-29 00:08:22.383470218 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/configure.ac	2016-09-11 16:10:25.243038749 +0800
@@ -1,9 +1,10 @@
 dnl Process this file with autoconf to produce a configure script.
+AC_PREREQ([2.60])
 AC_INIT([collectd],[m4_esyscmd(./version-gen.sh)])
-AC_CONFIG_SRCDIR(src/)
+AC_CONFIG_SRCDIR(src/target_set.c)
 AC_CONFIG_HEADERS(src/config.h)
 AC_CONFIG_AUX_DIR([libltdl/config])
 
 dnl older automake's default of ARFLAGS=cru is noisy on newer binutils;
 dnl we don't really need the 'u' even in older toolchains.  Then there is
 dnl older libtool, which spelled it AR_FLAGS
@@ -28,24 +29,27 @@
 	 AC_DEFINE(LIBTOOL_VERSION, 1, [Define to used libtool version.])
 	]
 )
 
 AM_CONDITIONAL([BUILD_INCLUDED_LTDL], [test "x$LTDLDEPS" != "x"])
 
-AM_INIT_AUTOMAKE([tar-pax dist-bzip2 foreign])
+AM_INIT_AUTOMAKE([subdir-objects tar-pax dist-bzip2 no-dist-gzip foreign])
 m4_ifdef([AM_SILENT_RULES], [AM_SILENT_RULES([yes])])
 AC_LANG(C)
 
 AC_PREFIX_DEFAULT("/opt/collectd")
 
 AC_SYS_LARGEFILE
 
 #
 # Checks for programs.
 #
-AC_PROG_CC
+AC_PROG_CC_C99([],
+  [AC_MSG_ERROR([No compiler found that supports C99])]
+)
+AC_PROG_CXX
 AC_PROG_CPP
 AC_PROG_EGREP
 AC_PROG_INSTALL
 AC_PROG_LN_S
 AC_PROG_MAKE_SET
 AM_PROG_CC_C_O
@@ -53,12 +57,14 @@
 
 AC_DISABLE_STATIC
 AC_PROG_LIBTOOL
 AC_PROG_LEX
 AC_PROG_YACC
 
+AC_PATH_PROG([VALGRIND], [valgrind])
+
 # Warn when pkg.m4 is missing
 m4_pattern_forbid([^_?PKG_[A-Z_]+$],[*** pkg.m4 missing, please install pkg-config])
 
 PKG_PROG_PKG_CONFIG
 
 AC_CACHE_CHECK([if bison is the parser generator],
@@ -70,32 +76,39 @@
 
 if test "x$collectd_cv_prog_bison" = "xno" && test ! -f "${srcdir}/src/liboconfig/parser.c"
 then
 	AC_MSG_ERROR([bison is missing and you do not have ${srcdir}/src/liboconfig/parser.c. Please install bison])
 fi
 
-AC_CHECK_PROG([have_protoc_c], [protoc-c], [yes], [no])
-if test "x$have_protoc_c" = "xno"
-then
-	have_protoc_c="no (protoc-c compiler not found)"
-fi
-
-if test "x$have_protoc_c" = "xyes"
-then
-	AC_CHECK_HEADERS([protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h],
-			 [have_protoc_c="yes"; break],
-			 [have_protoc_c="no (<google/protobuf-c/protobuf-c.h> not found)"])
-fi
-if test "x$have_protoc_c" = "xyes"
+AC_ARG_VAR([PROTOC], [path to the protoc binary])
+AC_PATH_PROG([PROTOC], [protoc])
+have_protoc3="no"
+if test "x$PROTOC" != "x"; then
+	AC_MSG_CHECKING([for protoc 3.0.0+])
+	if $PROTOC --version | $EGREP libprotoc.3 >/dev/null; then
+		protoc3="yes (`$PROTOC --version`)"
+		have_protoc3="yes"
+	else
+		protoc3="no (`$PROTOC --version`)"
+	fi
+	AC_MSG_RESULT([$protoc3])
+fi
+AM_CONDITIONAL(HAVE_PROTOC3, test "x$have_protoc3" = "xyes")
+
+AC_ARG_VAR([GRPC_CPP_PLUGIN], [path to the grpc_cpp_plugin binary])
+AC_PATH_PROG([GRPC_CPP_PLUGIN], [grpc_cpp_plugin])
+AM_CONDITIONAL(HAVE_GRPC_CPP, test "x$GRPC_CPP_PLUGIN" != "x")
+
+AC_ARG_VAR([PROTOC_C], [path to the protoc-c binary])
+AC_PATH_PROG([PROTOC_C], [protoc-c])
+if test "x$PROTOC_C" = "x"
 then
-	AC_CHECK_LIB([protobuf-c], [protobuf_c_message_pack],
-		     [have_protoc_c="yes"],
-		     [have_protoc_c="no (libprotobuf-c not found)"])
-
+  have_protoc_c="no (protoc-c compiler not found)"
+else
+  have_protoc_c="yes"
 fi
-AM_CONDITIONAL(HAVE_PROTOC_C, test "x$have_protoc_c" = "xyes")
 
 AC_MSG_CHECKING([for kernel type ($host_os)])
 case $host_os in
 	*linux*)
 	AC_DEFINE([KERNEL_LINUX], 1, [True if program is to be compiled for a Linux kernel])
 	ac_system="Linux"
@@ -109,12 +122,16 @@
 	ac_system="Darwin"
 	;;
 	*openbsd*)
 	AC_DEFINE([KERNEL_OPENBSD], 1, [True if program is to be compiled for an OpenBSD kernel])
 	ac_system="OpenBSD"
 	;;
+	*netbsd*)
+	AC_DEFINE([KERNEL_NETBSD], 1, [True if program is to be compiled for a NetBSD kernel])
+	ac_system="NetBSD"
+	;;
 	*aix*)
 	AC_DEFINE([KERNEL_AIX], 1, [True if program is to be compiled for a AIX kernel])
 	ac_system="AIX"
 	;;
 	*freebsd*)
 	AC_DEFINE([KERNEL_FREEBSD], 1, [True if program is to be compiled for a FreeBSD kernel])
@@ -122,18 +139,18 @@
 	;;
 	*)
 	ac_system="unknown"
 esac
 AC_MSG_RESULT([$ac_system])
 
-AM_CONDITIONAL([BUILD_LINUX],[test "x$ac_system" = "xLinux"])
-AM_CONDITIONAL([BUILD_SOLARIS],[test "x$ac_system" = "xSolaris"])
-AM_CONDITIONAL([BUILD_DARWIN],[test "x$ac_system" = "xDarwin"])
-AM_CONDITIONAL([BUILD_OPENBSD],[test "x$ac_system" = "xOpenBSD"])
-AM_CONDITIONAL([BUILD_AIX],[test "x$ac_system" = "xAIX"])
-AM_CONDITIONAL([BUILD_FREEBSD],[test "x$ac_system" = "xFreeBSD"])
+AM_CONDITIONAL([BUILD_AIX], [test "x$ac_system" = "xAIX"])
+AM_CONDITIONAL([BUILD_DARWIN], [test "x$ac_system" = "xDarwin"])
+AM_CONDITIONAL([BUILD_FREEBSD], [test "x$ac_system" = "xFreeBSD"])
+AM_CONDITIONAL([BUILD_LINUX], [test "x$ac_system" = "xLinux"])
+AM_CONDITIONAL([BUILD_OPENBSD], [test "x$ac_system" = "xOpenBSD"])
+AM_CONDITIONAL([BUILD_SOLARIS], [test "x$ac_system" = "xSolaris"])
 
 if test "x$ac_system" = "xLinux"
 then
 	AC_ARG_VAR([KERNEL_DIR], [path to Linux kernel sources])
 	if test -z "$KERNEL_DIR"
 	then
@@ -196,12 +213,25 @@
 AC_HEADER_SYS_WAIT
 AC_HEADER_DIRENT
 AC_HEADER_STDBOOL
 
 AC_CHECK_HEADERS(stdio.h errno.h math.h stdarg.h syslog.h fcntl.h signal.h assert.h sys/types.h sys/socket.h sys/select.h poll.h netdb.h arpa/inet.h sys/resource.h sys/param.h kstat.h regex.h sys/ioctl.h endian.h sys/isa_defs.h fnmatch.h libgen.h)
 
+# For entropy plugin on newer NetBSD
+AC_CHECK_HEADERS(sys/rndio.h, [], [],
+[#if HAVE_SYS_TYPES_H
+# include <sys/types.h>
+#endif
+#if HAVE_SYS_IOCTL_H
+# include <sys/ioctl.h>
+#endif
+#if HAVE_SYS_PARAM_H
+# include <sys/param.h>
+#endif
+])
+
 # For ping library
 AC_CHECK_HEADERS(netinet/in_systm.h, [], [],
 [#if HAVE_STDINT_H
 # include <stdint.h>
 #endif
 #if HAVE_SYS_TYPES_H
@@ -410,25 +440,41 @@
 #endif
 ])
 
 AC_MSG_CHECKING([for sysctl kern.cp_times])
 if test -x /sbin/sysctl
 then
-	/sbin/sysctl kern.cp_times 2>/dev/null
+	/sbin/sysctl kern.cp_times >/dev/null 2>&1
 	if test $? -eq 0
 	then
 		AC_MSG_RESULT([yes])
 		AC_DEFINE(HAVE_SYSCTL_KERN_CP_TIMES, 1,
 		[Define if sysctl supports kern.cp_times])
 	else
 		AC_MSG_RESULT([no])
 	fi
 else
 	AC_MSG_RESULT([no])
 fi
 
+AC_MSG_CHECKING([for sysctl kern.cp_time])
+if test -x /sbin/sysctl
+then
+	/sbin/sysctl kern.cp_time >/dev/null 2>&1
+	if test $? -eq 0
+	then
+		AC_MSG_RESULT([yes])
+		AC_DEFINE(HAVE_SYSCTL_KERN_CP_TIME, 1,
+			[Define if sysctl supports kern.cp_time])
+	else
+		AC_MSG_RESULT([no])
+	fi
+else
+	AC_MSG_RESULT([no])
+fi
+
 # For hddtemp module
 AC_CHECK_HEADERS(linux/major.h)
 
 # For md module (Linux only)
 if test "x$ac_system" = "xLinux"
 then
@@ -442,13 +488,13 @@
 ])
 	AC_CHECK_HEADERS([sys/sysmacros.h])
 else
 	have_linux_raid_md_u_h="no"
 fi
 
-# For the swap module
+# For the wireless module
 have_linux_wireless_h="no"
 if test "x$ac_system" = "xLinux"
 then
   AC_CHECK_HEADERS(linux/wireless.h,
 		   [have_linux_wireless_h="yes"],
 		   [have_linux_wireless_h="no"],
@@ -634,16 +680,32 @@
   sys/vfs.h \
   sys/vfstab.h \
   sys/vmmeter.h \
   wordexp.h \
 ])
 
-AC_CHECK_HEADERS([xfs/xqm.h], [], [],
-[
-#define _GNU_SOURCE
-])
+# --enable-xfs {{{
+AC_ARG_ENABLE([xfs],
+  [AS_HELP_STRING([--enable-xfs], [xfs support in df plugin @<:@default=yes@:>@])],
+  [],
+  [enable_xfs="auto"]
+)
+
+if test "x$enable_xfs" != "xno"; then
+  AC_CHECK_HEADERS([xfs/xqm.h],
+    [],
+    [
+      if test "x$enable_xfs" = "xyes"; then
+        AC_MSG_ERROR([xfs/xqm.h not found])
+      fi
+    ],
+    [[#define _GNU_SOURCE]]
+  )
+fi
+
+# }}}
 
 # For the dns plugin
 AC_CHECK_HEADERS(arpa/nameser.h)
 AC_CHECK_HEADERS(arpa/nameser_compat.h, [], [],
 [
 #if HAVE_ARPA_NAMESER_H
@@ -677,14 +739,12 @@
 #endif
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
 ])
 
-AC_CHECK_HEADERS(netinet/ip_compat.h)
-
 have_net_pfvar_h="no"
 AC_CHECK_HEADERS(net/pfvar.h,
                [have_net_pfvar_h="yes"],
                [have_net_pfvar_h="no"],
 [
 #if HAVE_SYS_IOCTL_H
@@ -702,12 +762,29 @@
 ])
 
 # For the multimeter plugin
 have_termios_h="no"
 AC_CHECK_HEADERS(termios.h, [have_termios_h="yes"])
 
+# For cpusleep plugin
+AC_CACHE_CHECK([whether clock_boottime and clock_monotonic are supported],
+		       [c_cv_have_clock_boottime_monotonic],
+		       AC_COMPILE_IFELSE([AC_LANG_PROGRAM(
+[[
+#include <time.h>
+]],
+[[
+ struct timespec b, m;
+ clock_gettime(CLOCK_BOOTTIME, &b );
+ clock_gettime(CLOCK_MONOTONIC, &m );
+]]
+		       )],
+		       [c_cv_have_clock_boottime_monotonic="yes"],
+		       [c_cv_have_clock_boottime_monotonic="no"]))
+
+
 # For the turbostat plugin
 have_asm_msrindex_h="no"
 AC_CHECK_HEADERS(asm/msr-index.h, [have_asm_msrindex_h="yes"])
 
 if test "x$have_asm_msrindex_h" = "xyes"
 then
@@ -733,29 +810,36 @@
 
 AC_CHECK_HEADERS(sys/capability.h)
 #
 # Checks for typedefs, structures, and compiler characteristics.
 #
 AC_C_CONST
-AC_C_INLINE
-AC_TYPE_OFF_T
 AC_TYPE_PID_T
 AC_TYPE_SIZE_T
-AC_TYPE_SSIZE_T
 AC_TYPE_UID_T
-AC_TYPE_UINT32_T
 AC_HEADER_TIME
 
 #
 # Checks for library functions.
 #
-AC_PROG_GCC_TRADITIONAL
-AC_CHECK_FUNCS(gettimeofday select strdup strtol getaddrinfo getnameinfo strchr memcpy strstr strcmp strncmp strncpy strlen strncasecmp strcasecmp openlog closelog sysconf setenv if_indextoname setlocale)
+AC_CHECK_FUNCS(gettimeofday select strdup strtol getaddrinfo getnameinfo strchr memcpy strstr strcmp strncmp strncpy strlen strncasecmp strcasecmp openlog closelog sysconf setenv if_indextoname setlocale asprintf)
 
 AC_FUNC_STRERROR_R
 
+test_cxx_flags() {
+	AC_LANG_PUSH([C++])
+	AC_LANG_CONFTEST([
+		AC_LANG_SOURCE([[int main(void){}]])
+	])
+	$CXX -c conftest.cpp $CXXFLAGS $@ > /dev/null 2> /dev/null
+	ret=$?
+	rm -f conftest.o
+	AC_LANG_POP([C++])
+	return $ret
+}
+
 SAVE_CFLAGS="$CFLAGS"
 # Emulate behavior of src/Makefile.am
 if test "x$GCC" = "xyes"
 then
 	CFLAGS="$CFLAGS -Wall -Werror"
 fi
@@ -849,14 +933,12 @@
 	AC_CHECK_LIB(posix4, clock_gettime, [clock_gettime_needs_posix4="yes"
 					     have_clock_gettime="yes"])
 fi
 if test "x$have_clock_gettime" = "xyes"
 then
 	AC_DEFINE(HAVE_CLOCK_GETTIME, 1, [Define if the clock_gettime(2) function is available.])
-else
-	AC_MSG_WARN(cannot find clock_gettime)
 fi
 
 nanosleep_needs_rt="no"
 nanosleep_needs_posix4="no"
 AC_CHECK_FUNCS(nanosleep,
     [],
@@ -1302,12 +1384,26 @@
         AC_DEFINE_UNQUOTED(COLLECTD_USERAGENT, ["$withval"], [User agent for http requests])
     fi
 ])
 
 # }}}
 
+# --with-data-max-name-len {{{
+AC_ARG_WITH(data-max-name-len, [AS_HELP_STRING([--with-data-max-name-len@<:@=VALUE@:>@], [Maximum length of data buffers])],
+[
+    if test "x$withval" != "x" && test $withval -gt 0
+    then
+        AC_DEFINE_UNQUOTED(DATA_MAX_NAME_LEN, [$withval], [Maximum length of data buffers])
+    else
+        AC_MSG_ERROR([DATA_MAX_NAME_LEN must be a positive integer -- $withval given])
+    fi
+],
+[   AC_DEFINE(DATA_MAX_NAME_LEN, 128, [Maximum length of data buffers])]
+)
+# }}}
+
 have_getfsstat="no"
 AC_CHECK_FUNCS(getfsstat, [have_getfsstat="yes"])
 have_getvfsstat="no"
 AC_CHECK_FUNCS(getvfsstat, [have_getvfsstat="yes"])
 have_listmntent="no"
 AC_CHECK_FUNCS(listmntent, [have_listmntent="yes"])
@@ -1379,21 +1475,21 @@
 		AC_DEFINE(HAVE_TWO_GETMNTENT, 1,
 			  [Define if the function getmntent exists and takes two arguments.])
 	fi
 fi
 if test "x$have_getmntent" = "xsun"; then
 	AC_DEFINE(HAVE_SUN_GETMNTENT, 1,
-		  [Define if the function getmntent exists. It's the version from libsun.])
+		  [Define if the function getmntent exists. It is the version from libsun.])
 fi
 if test "x$have_getmntent" = "xseq"; then
 	AC_DEFINE(HAVE_SEQ_GETMNTENT, 1,
-		  [Define if the function getmntent exists. It's the version from libseq.])
+		  [Define if the function getmntent exists. It is the version from libseq.])
 fi
 if test "x$have_getmntent" = "xgen"; then
 	AC_DEFINE(HAVE_GEN_GETMNTENT, 1,
-		  [Define if the function getmntent exists. It's the version from libgen.])
+		  [Define if the function getmntent exists. It is the version from libgen.])
 fi
 
 # Check for htonll
 AC_CACHE_CHECK([if have htonll defined],
                   [c_cv_have_htonll],
                   AC_LINK_IFELSE([AC_LANG_PROGRAM(
@@ -1478,12 +1574,30 @@
 	[
 #include <sys/param.h>
 #include <sys/sysctl.h>
 #include <kvm.h>
 	])
 
+
+AC_CHECK_MEMBERS([struct kinfo_proc2.p_pid, struct kinfo_proc2.p_uru_maxrss],
+	[
+		AC_DEFINE(HAVE_STRUCT_KINFO_PROC2_NETBSD, 1,
+			[Define if struct kinfo_proc2 exists in the NetBSD variant.])
+		have_struct_kinfo_proc2_netbsd="yes"
+	],
+	[
+		have_struct_kinfo_proc2_netbsd="no"
+	],
+	[
+#include <sys/param.h>
+#include <sys/sysctl.h>
+#include <kvm.h>
+	])
+
+
+
 AC_CHECK_MEMBERS([struct udphdr.uh_dport, struct udphdr.uh_sport], [], [],
 [#define _BSD_SOURCE
 #define _DEFAULT_SOURCE
 #if HAVE_STDINT_H
 # include <stdint.h>
 #endif
@@ -1545,24 +1659,54 @@
 	AC_DEFINE(HAVE_LIBRESOLV, 1, [Define to 1 if you have the 'resolv' library (-lresolv).])
 ],
 [with_libresolv="no"])
 AM_CONDITIONAL(BUILD_WITH_LIBRESOLV, test "x$with_libresolv" = "xyes")
 
 dnl Check for HAL (hardware abstraction library)
-with_libhal="yes"
-AC_CHECK_LIB(hal,libhal_device_property_exists,
-	     [AC_DEFINE(HAVE_LIBHAL, 1, [Define to 1 if you have 'hal' library])],
-	     [with_libhal="no"])
-if test "x$with_libhal" = "xyes"; then
-	if test "x$PKG_CONFIG" != "x"; then
-		BUILD_WITH_LIBHAL_CFLAGS="`$PKG_CONFIG --cflags hal`"
-		BUILD_WITH_LIBHAL_LIBS="`$PKG_CONFIG --libs hal`"
-		AC_SUBST(BUILD_WITH_LIBHAL_CFLAGS)
-		AC_SUBST(BUILD_WITH_LIBHAL_LIBS)
-	fi
-fi
+with_libhal="no"
+PKG_CHECK_MODULES([HAL], [hal],
+  [
+    SAVE_LIBS="$LIBS"
+    LIBS="$HAL_LIBS $LIBS"
+    AC_CHECK_LIB([hal], [libhal_device_property_exists],
+      [
+        SAVE_CPPFLAGS="$CPPFLAGS"
+        CPPFLAGS="$HAL_CFLAGS $CPPFLAGS"
+        AC_CHECK_HEADERS([libhal.h],
+        [
+          with_libhal="yes"
+          BUILD_WITH_LIBHAL_CFLAGS="$HAL_CFLAGS"
+          BUILD_WITH_LIBHAL_LIBS="$HAL_LIBS"
+        ])
+        CPPFLAGS="$SAVE_CPPFLAGS"
+      ],
+      [ : ]
+    )
+    LIBS="$SAVE_LIBS"
+  ],
+  [ : ]
+)
+AC_SUBST(BUILD_WITH_LIBHAL_CFLAGS)
+AC_SUBST(BUILD_WITH_LIBHAL_LIBS)
+
+
+SAVE_LIBS="$LIBS"
+AC_CHECK_LIB([pthread],
+  [pthread_create],
+  [],
+  [AC_MSG_ERROR([Symbol 'pthread_create' not found in libpthread"])],
+  []
+)
+PTHREAD_LIBS="$LIBS"
+LIBS="$SAVE_LIBS"
+
+AC_CHECK_HEADERS([pthread.h],
+  [],
+  [AC_MSG_ERROR([pthread.h not found])]
+)
+AC_SUBST([PTHREAD_LIBS])
 
 m4_divert_once([HELP_WITH], [
 collectd additional packages:])
 
 if test "x$ac_system" = "xAIX"
 then
@@ -1856,12 +2000,42 @@
 		 [have_curlopt_timeout="no"],
 		 [[#include <curl/curl.h>]])
 	fi
 fi
 if test "x$with_libcurl" = "xyes"
 then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_curl_cflags"
+	LDFLAGS="$LDFLAGS $with_curl_libs"
+	AC_CACHE_CHECK([for CURLINFO_APPCONNECT_TIME],
+		[c_cv_have_curlinfo_appconnect_time],
+		AC_LINK_IFELSE([AC_LANG_PROGRAM(
+[[
+#include <curl/curl.h>
+]],
+[[
+int val = CURLINFO_APPCONNECT_TIME;
+return val;
+]]
+			)],
+			[c_cv_have_curlinfo_appconnect_time="yes"],
+			[c_cv_have_curlinfo_appconnect_time="no"]
+		)
+	)
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+fi
+AM_CONDITIONAL(BUILD_WITH_LIBCURL, test "x$with_libcurl" = "xyes")
+if test "x$c_cv_have_curlinfo_appconnect_time" = "xyes"
+then
+	AC_DEFINE(HAVE_CURLINFO_APPCONNECT_TIME, 1, [Define if curl.h defines CURLINFO_APPCONNECT_TIME.])
+fi
+
+if test "x$with_libcurl" = "xyes"
+then
 	BUILD_WITH_LIBCURL_CFLAGS="$with_curl_cflags"
 	BUILD_WITH_LIBCURL_LIBS="$with_curl_libs"
 	AC_SUBST(BUILD_WITH_LIBCURL_CFLAGS)
 	AC_SUBST(BUILD_WITH_LIBCURL_LIBS)
 
 	if test "x$have_curlopt_username" = "xyes"
@@ -1871,13 +2045,12 @@
 
 	if test "x$have_curlopt_timeout" = "xyes"
 	then
 		AC_DEFINE(HAVE_CURLOPT_TIMEOUT_MS, 1, [Define if libcurl supports CURLOPT_TIMEOUT_MS option.])
 	fi
 fi
-AM_CONDITIONAL(BUILD_WITH_LIBCURL, test "x$with_libcurl" = "xyes")
 # }}}
 
 # --with-libdbi {{{
 with_libdbi_cppflags=""
 with_libdbi_ldflags=""
 AC_ARG_WITH(libdbi, [AS_HELP_STRING([--with-libdbi@<:@=PREFIX@:>@], [Path to libdbi.])],
@@ -2108,18 +2281,12 @@
 
 if test "x$with_libgcrypt" = "xyes"
 then
 	AC_CHECK_LIB(gcrypt, gcry_md_hash_buffer,
 		[with_libgcrypt="yes"],
 		[with_libgcrypt="no (symbol gcry_md_hash_buffer not found)"])
-
-	if test "$with_libgcrypt" != "no"; then
-		m4_ifdef([AM_PATH_LIBGCRYPT],[AM_PATH_LIBGCRYPT(1:1.2.0,,with_libgcrypt="no (version 1.2.0+ required)")])
-		GCRYPT_CPPFLAGS="$LIBGCRYPT_CPPFLAGS $LIBGCRYPT_CFLAGS"
-		GCRYPT_LIBS="$LIBGCRYPT_LIBS"
-	fi
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 LIBS="$SAVE_LIBS"
 
@@ -2131,12 +2298,152 @@
 AC_SUBST(GCRYPT_CPPFLAGS)
 AC_SUBST(GCRYPT_LDFLAGS)
 AC_SUBST(GCRYPT_LIBS)
 AM_CONDITIONAL(BUILD_WITH_LIBGCRYPT, test "x$with_libgcrypt" = "xyes")
 # }}}
 
+# --with-libgps {{{
+with_libgps_cflags=""
+with_libgps_ldflags=""
+AC_ARG_WITH(libgps, [AS_HELP_STRING([--with-libgps@<:@=PREFIX@:>@], [Path to libgps.])],
+[
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libgps_cflags="-I$withval/include"
+		with_libgps_ldflags="-L$withval/lib"
+		with_libgps="yes"
+	else
+		with_libgps="$withval"
+	fi
+],
+[
+	with_libgps="yes"
+])
+if test "x$with_libgps" = "xyes"
+then
+	SAVE_CFLAGS="$CFLAGS"
+	CFLAGS="$CFLAGS $with_libgps_cflags"
+
+	AC_CHECK_HEADERS(gps.h, [with_libgps="yes"], [with_libgps="no (gps.h not found)"])
+
+	CFLAGS="$SAVE_CFLAGS"
+fi
+if test "x$with_libgps" = "xyes"
+then
+	SAVE_CFLAGS="$CFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CFLAGS="$CFLAGS $with_libgps_cflags"
+	LDFLAGS="$LDFLAGS $with_libgps_ldflags"
+
+	AC_CHECK_LIB(gps, gps_open, [with_libgps="yes"], [with_libgps="no (symbol gps_open not found)"])
+
+	CFLAGS="$SAVE_CFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+fi
+if test "x$with_libgps" = "xyes"
+then
+	BUILD_WITH_LIBGPS_CFLAGS="$with_libgps_cflags"
+	BUILD_WITH_LIBGPS_LDFLAGS="$with_libgps_ldflags"
+	BUILD_WITH_LIBGPS_LIBS="-lgps"
+	AC_SUBST(BUILD_WITH_LIBGPS_CFLAGS)
+	AC_SUBST(BUILD_WITH_LIBGPS_LDFLAGS)
+	AC_SUBST(BUILD_WITH_LIBGPS_LIBS)
+fi
+AM_CONDITIONAL(BUILD_WITH_LIBGPS, test "x$with_libgps" = "xyes")
+# }}}
+
+# --with-libgrpc++ {{{
+with_libgrpcpp_cppflags=""
+with_libgrpcpp_ldflags=""
+AC_ARG_WITH([libgrpc++], [AS_HELP_STRING([--with-libgrpc++@<:@=PREFIX@:>@], [Path to libgrpc++.])],
+  [
+    with_grpcpp="$withval"
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libgrpcpp_cppflags="-I$withval/include"
+      with_libgrpcpp_ldflags="-L$withval/lib"
+      with_libgrpcpp="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libgrpcpp="no (disabled on command line)"
+    fi
+  ],
+  [withval="yes"]
+)
+if test "x$withval" = "xyes"
+then
+PKG_CHECK_MODULES([GRPCPP], [grpc++],
+  [with_libgrpcpp="yes"],
+  [with_libgrpcpp="no (pkg-config could not find libgrpc++)"]
+)
+fi
+
+if test "x$withval" != "xno"
+then
+  AC_MSG_CHECKING([whether $CXX accepts -std=c++11])
+  if test_cxx_flags -std=c++11; then
+    AC_MSG_RESULT([yes])
+  else
+    AC_MSG_RESULT([no])
+    with_libgrpcpp="no (requires C++11 support)"
+  fi
+fi
+
+if test "x$with_libgrpcpp" = "xyes"
+then
+  AC_LANG_PUSH(C++)
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+  AC_CHECK_HEADERS([grpc++/grpc++.h], [],
+    [with_libgrpcpp="no (<grpc++/grpc++.h> not found)"]
+  )
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  AC_LANG_POP(C++)
+fi
+if test "x$with_libgrpcpp" = "xyes"
+then
+  AC_LANG_PUSH(C++)
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS $CPPFLAGS"
+  LDFLAGS="$with_libgrpcpp_ldflags"
+  if test "x$GRPCPP_LIBS" = "x"
+  then
+    LIBS="-lgrpc++"
+  else
+    LIBS="$GRPCPP_LIBS"
+  fi
+  AC_LINK_IFELSE(
+    [AC_LANG_PROGRAM(
+      [[#include <grpc++/grpc++.h>]],
+      [[grpc::ServerBuilder sb;]]
+    )],
+    [
+      with_libgrpcpp="yes"
+      if test "x$GRPCPP_LIBS" = "x"
+      then
+        GRPCPP_LIBS="-lgrpc++"
+      fi
+    ],
+    [with_libgrpcpp="no (libgrpc++ not found)"]
+  )
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
+  AC_LANG_POP(C++)
+fi
+BUILD_WITH_LIBGRPCPP_CPPFLAGS="-std=c++11 $with_libgrpcpp_cppflags $GRPCPP_CFLAGS"
+BUILD_WITH_LIBGRPCPP_LDFLAGS="$with_libgrpcpp_ldflags"
+BUILD_WITH_LIBGRPCPP_LIBS="$GRPCPP_LIBS"
+AC_SUBST([BUILD_WITH_LIBGRPCPP_CPPFLAGS])
+AC_SUBST([BUILD_WITH_LIBGRPCPP_LDFLAGS])
+AC_SUBST([BUILD_WITH_LIBGRPCPP_LIBS])
+# }}}
+
 # --with-libiptc {{{
 AC_ARG_WITH(libiptc, [AS_HELP_STRING([--with-libiptc@<:@=PREFIX@:>@], [Path to libiptc.])],
 [
 	if test "x$withval" = "xyes"
 	then
 		with_libiptc="pkgconfig"
@@ -2155,17 +2462,12 @@
 		with_libiptc="pkgconfig"
 	else
 		with_libiptc="no (Linux only)"
 	fi
 ])
 
-if test "x$with_libiptc" = "xpkgconfig" && test "x$PKG_CONFIG" = "x"
-then
-	with_libiptc="no (Don't have pkg-config)"
-fi
-
 if test "x$with_libiptc" = "xpkgconfig"
 then
 	$PKG_CONFIG --exists 'libiptc' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libiptc="no (pkg-config doesn't know libiptc)"
@@ -2232,15 +2534,12 @@
 # --with-java {{{
 with_java_home="$JAVA_HOME"
 if test "x$with_java_home" = "x"
 then
 	with_java_home="/usr/lib/jvm"
 fi
-with_java_vmtype="client"
-with_java_cflags=""
-with_java_libs=""
 JAVAC="$JAVAC"
 JAR="$JAR"
 AC_ARG_WITH(java, [AS_HELP_STRING([--with-java@<:@=PREFIX@:>@], [Path to Java home.])],
 [
 	if test "x$withval" = "xno"
 	then
@@ -2256,57 +2555,57 @@
 [with_java="yes"])
 if test "x$with_java" = "xyes"
 then
 	if test -d "$with_java_home"
 	then
 		AC_MSG_CHECKING([for jni.h])
-		TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+		TMPVAR=`find -L "$with_java_home" -name jni.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
 		if test "x$TMPVAR" != "x"
 		then
 			AC_MSG_RESULT([found in $TMPVAR])
 			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
 		else
 			AC_MSG_RESULT([not found])
 		fi
 
 		AC_MSG_CHECKING([for jni_md.h])
-		TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+		TMPVAR=`find -L "$with_java_home" -name jni_md.h -type f -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
 		if test "x$TMPVAR" != "x"
 		then
 			AC_MSG_RESULT([found in $TMPVAR])
 			JAVA_CPPFLAGS="$JAVA_CPPFLAGS -I$TMPVAR"
 		else
 			AC_MSG_RESULT([not found])
 		fi
 
 		AC_MSG_CHECKING([for libjvm.so])
-		TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | LC_ALL=C sort | head -n 1`
+		TMPVAR=`find -L "$with_java_home" -type f \( -name libjvm.so -o -name libjvm.dylib \) -exec 'dirname' '{}' ';' 2>/dev/null | head -n 1`
 		if test "x$TMPVAR" != "x"
 		then
 			AC_MSG_RESULT([found in $TMPVAR])
 			JAVA_LDFLAGS="$JAVA_LDFLAGS -L$TMPVAR -Wl,-rpath -Wl,$TMPVAR"
 		else
 			AC_MSG_RESULT([not found])
 		fi
 
 		if test "x$JAVAC" = "x"
 		then
 			AC_MSG_CHECKING([for javac])
-			TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
+			TMPVAR=`find -L "$with_java_home" -name javac -type f 2>/dev/null | head -n 1`
 			if test "x$TMPVAR" != "x"
 			then
 				JAVAC="$TMPVAR"
 				AC_MSG_RESULT([$JAVAC])
 			else
 				AC_MSG_RESULT([not found])
 			fi
 		fi
 		if test "x$JAR" = "x"
 		then
 			AC_MSG_CHECKING([for jar])
-			TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | LC_ALL=C sort | head -n 1`
+			TMPVAR=`find -L "$with_java_home" -name jar -type f 2>/dev/null | head -n 1`
 			if test "x$TMPVAR" != "x"
 			then
 				JAR="$TMPVAR"
 				AC_MSG_RESULT([$JAR])
 			else
 				AC_MSG_RESULT([not found])
@@ -2327,12 +2626,16 @@
 	AC_MSG_NOTICE([Building with JAVA_CFLAGS set to: $JAVA_CFLAGS])
 fi
 if test "x$JAVA_LDFLAGS" != "x"
 then
 	AC_MSG_NOTICE([Building with JAVA_LDFLAGS set to: $JAVA_LDFLAGS])
 fi
+if test "x$JAVA_LIBS" != "x"
+then
+	AC_MSG_NOTICE([Building with JAVA_LIBS set to: $JAVA_LIBS])
+fi
 if test "x$JAVAC" = "x"
 then
 	with_javac_path="$PATH"
 	if test "x$with_java_home" != "x"
 	then
 		with_javac_path="$with_java_home:with_javac_path"
@@ -2367,36 +2670,39 @@
 	with_java="no (jar not found)"
 fi
 
 SAVE_CPPFLAGS="$CPPFLAGS"
 SAVE_CFLAGS="$CFLAGS"
 SAVE_LDFLAGS="$LDFLAGS"
+SAVE_LIBS="$LIBS"
 CPPFLAGS="$CPPFLAGS $JAVA_CPPFLAGS"
 CFLAGS="$CFLAGS $JAVA_CFLAGS"
 LDFLAGS="$LDFLAGS $JAVA_LDFLAGS"
+LIBS="$LIBS $JAVA_LIBS"
 
 if test "x$with_java" = "xyes"
 then
 	AC_CHECK_HEADERS(jni.h, [], [with_java="no (jni.h not found)"])
 fi
 if test "x$with_java" = "xyes"
 then
 	AC_CHECK_LIB(jvm, JNI_CreateJavaVM,
 	[with_java="yes"],
-	[with_java="no (libjvm not found)"],
-	[$JAVA_LIBS])
+	[with_java="no (Symbol 'JNI_CreateJavaVM' not found)"],
+	[$JAVA_LIBS $PTHREAD_LIBS])
 fi
 if test "x$with_java" = "xyes"
 then
 	JAVA_LIBS="$JAVA_LIBS -ljvm"
 	AC_MSG_NOTICE([Building with JAVA_LIBS set to: $JAVA_LIBS])
 fi
 
 CPPFLAGS="$SAVE_CPPFLAGS"
 CFLAGS="$SAVE_CFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
+LIBS="$SAVE_LIBS"
 
 AC_SUBST(JAVA_CPPFLAGS)
 AC_SUBST(JAVA_CFLAGS)
 AC_SUBST(JAVA_LDFLAGS)
 AC_SUBST(JAVA_LIBS)
 AM_CONDITIONAL(BUILD_WITH_JAVA, test "x$with_java" = "xyes")
@@ -2457,28 +2763,116 @@
 	AC_SUBST(BUILD_WITH_LIBLDAP_CPPFLAGS)
 	AC_SUBST(BUILD_WITH_LIBLDAP_LDFLAGS)
 fi
 AM_CONDITIONAL(BUILD_WITH_LIBLDAP, test "x$with_libldap" = "xyes")
 # }}}
 
+# --with-liblua {{{
+AC_ARG_VAR([LIBLUA_PKG_CONFIG_NAME], [Name of liblua used by pkg-config])
+if test "x$LIBLUA_PKG_CONFIG_NAME" != "x"
+then
+  PKG_CHECK_MODULES([LUA], [$LIBLUA_PKG_CONFIG_NAME],
+    [with_liblua="yes"],
+    [with_liblua="no"]
+  )
+else
+  PKG_CHECK_MODULES([LUA], [lua],
+    [with_liblua="yes"],
+    [
+      PKG_CHECK_MODULES([LUA], [lua-5.3],
+        [with_liblua="yes"],
+        [
+	  PKG_CHECK_MODULES([LUA], [lua5.3],
+            [with_liblua="yes"],
+            [
+              PKG_CHECK_MODULES([LUA], [lua-5.2],
+                [with_liblua="yes"],
+                [
+                  PKG_CHECK_MODULES([LUA], [lua5.2],
+                    [with_liblua="yes"],
+                    [
+                      PKG_CHECK_MODULES([LUA], [lua-5.1],
+                        [with_liblua="yes"],
+                        [
+                          PKG_CHECK_MODULES([LUA], [lua5.1],
+                            [with_liblua="yes"],
+                            [with_liblua="no (pkg-config cannot find liblua)"]
+                          )
+                        ]
+                      )
+                    ]
+                  )
+                ]
+              )
+            ]
+          )
+        ]
+      )
+    ]
+  )
+fi
+
+if test "x$with_liblua" = "xyes"
+then
+  SAVE_CFLAGS="$CFLAGS"
+  CFLAGS="$CFLAGS $LUA_CFLAGS"
+
+  AC_CHECK_HEADERS([lua.h lauxlib.h lualib.h],
+    [with_liblua="yes"],
+    [with_liblua="no (header not found)"]
+  )
+
+  CFLAGS="$SAVE_CFLAGS"
+fi
+
+if test "x$with_liblua" = "xyes"
+then
+  SAVE_LIBS="$LIBS"
+  LIBS="$LIBS $LUA_LIBS"
+
+  AC_CHECK_FUNC([lua_settop],
+    [with_liblua="yes"],
+    [with_liblua="no (symbol 'lua_settop' not found)"]
+  )
+
+  LIBS="$SAVE_LIBS"
+fi
+
+if test "x$with_liblua" = "xyes"
+then
+    BUILD_WITH_LIBLUA_CFLAGS="$LUA_CFLAGS"
+    BUILD_WITH_LIBLUA_LIBS="$LUA_LIBS"
+fi
+AC_SUBST(BUILD_WITH_LIBLUA_CFLAGS)
+AC_SUBST(BUILD_WITH_LIBLUA_LIBS)
+# }}}
+
 # --with-liblvm2app {{{
 with_liblvm2app_cppflags=""
 with_liblvm2app_ldflags=""
 AC_ARG_WITH(liblvm2app, [AS_HELP_STRING([--with-liblvm2app@<:@=PREFIX@:>@], [Path to liblvm2app.])],
 [
-        if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	if test "x$withval" = "xno"
         then
-                with_liblvm2app_cppflags="-I$withval/include"
-                with_liblvm2app_ldflags="-L$withval/lib"
-                with_liblvm2app="yes"
+		with_liblvm2app="no"
         else
-                with_liblvm2app="$withval"
+		with_liblvm2app="yes"
+		if test "x$withval" != "xyes"
+		then
+			with_liblvm2app_cppflags="-I$withval/include"
+			with_liblvm2app_ldflags="-L$withval/lib"
+		fi
         fi
 ],
 [
-        with_liblvm2app="yes"
+	if test "x$ac_system" = "xLinux"
+	then
+		with_liblvm2app="yes"
+	else
+		with_liblvm2app="no (Linux only library)"
+	fi
 ])
 if test "x$with_liblvm2app" = "xyes"
 then
         SAVE_CPPFLAGS="$CPPFLAGS"
         CPPFLAGS="$CPPFLAGS $with_liblvm2app_cppflags"
 
@@ -2585,19 +2979,12 @@
 ],
 [with_libmodbus="use_pkgconfig"])
 
 # configure using pkg-config
 if test "x$with_libmodbus" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libmodbus="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libmodbus" = "xuse_pkgconfig"
-then
 	AC_MSG_NOTICE([Checking for libmodbus using $PKG_CONFIG])
 	$PKG_CONFIG --exists 'libmodbus' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libmodbus="no (pkg-config doesn't know libmodbus)"
 	fi
@@ -2715,33 +3102,82 @@
 	AC_SUBST(BUILD_WITH_LIBMONGOC_CPPFLAGS)
 	AC_SUBST(BUILD_WITH_LIBMONGOC_LDFLAGS)
 fi
 AM_CONDITIONAL(BUILD_WITH_LIBMONGOC, test "x$with_libmongoc" = "xyes")
 # }}}
 
-# --with-libmysql {{{
-with_mysql_config="mysql_config"
-with_mysql_cflags=""
-with_mysql_libs=""
-AC_ARG_WITH(libmysql, [AS_HELP_STRING([--with-libmysql@<:@=PREFIX@:>@], [Path to libmysql.])],
+# --with-libmosquitto {{{
+with_libmosquitto_cppflags=""
+with_libmosquitto_ldflags=""
+AC_ARG_WITH(libmosquitto, [AS_HELP_STRING([--with-libmosquitto@<:@=PREFIX@:>@], [Path to libmosquitto.])],
 [
-	if test "x$withval" = "xno"
-	then
-		with_libmysql="no"
-	else if test "x$withval" = "xyes"
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
 	then
-		with_libmysql="yes"
+		with_libmosquitto_cppflags="-I$withval/include"
+		with_libmosquitto_ldflags="-L$withval/lib"
+		with_libmosquitto="yes"
 	else
-		if test -f "$withval" && test -x "$withval";
-		then
-			with_mysql_config="$withval"
-		else if test -x "$withval/bin/mysql_config"
-		then
-			with_mysql_config="$withval/bin/mysql_config"
-		fi; fi
-		with_libmysql="yes"
+		with_libmosquitto="$withval"
+	fi
+],
+[
+	with_libmosquitto="yes"
+])
+if test "x$with_libmosquitto" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
+
+	AC_CHECK_HEADERS(mosquitto.h, [with_libmosquitto="yes"], [with_libmosquitto="no (mosquitto.h not found)"])
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libmosquitto" = "xyes"
+then
+	SAVE_LDFLAGS="$LDFLAGS"
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	LDFLAGS="$LDFLAGS $with_libmosquitto_ldflags"
+	CPPFLAGS="$CPPFLAGS $with_libmosquitto_cppflags"
+
+	AC_CHECK_LIB(mosquitto, mosquitto_connect, [with_libmosquitto="yes"], [with_libmosquitto="no (libmosquitto not found)"])
+
+	LDFLAGS="$SAVE_LDFLAGS"
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libmosquitto" = "xyes"
+then
+	BUILD_WITH_LIBMOSQUITTO_CPPFLAGS="$with_libmosquitto_cppflags"
+	BUILD_WITH_LIBMOSQUITTO_LDFLAGS="$with_libmosquitto_ldflags"
+	BUILD_WITH_LIBMOSQUITTO_LIBS="-lmosquitto"
+	AC_SUBST(BUILD_WITH_LIBMOSQUITTO_CPPFLAGS)
+	AC_SUBST(BUILD_WITH_LIBMOSQUITTO_LDFLAGS)
+	AC_SUBST(BUILD_WITH_LIBMOSQUITTO_LIBS)
+fi
+# }}}
+
+# --with-libmysql {{{
+with_mysql_config="mysql_config"
+with_mysql_cflags=""
+with_mysql_libs=""
+AC_ARG_WITH(libmysql, [AS_HELP_STRING([--with-libmysql@<:@=PREFIX@:>@], [Path to libmysql.])],
+[
+	if test "x$withval" = "xno"
+	then
+		with_libmysql="no"
+	else if test "x$withval" = "xyes"
+	then
+		with_libmysql="yes"
+	else
+		if test -f "$withval" && test -x "$withval";
+		then
+			with_mysql_config="$withval"
+		else if test -x "$withval/bin/mysql_config"
+		then
+			with_mysql_config="$withval/bin/mysql_config"
+		fi; fi
+		with_libmysql="yes"
 	fi; fi
 ],
 [
 	with_libmysql="yes"
 ])
 if test "x$with_libmysql" = "xyes"
@@ -2833,16 +3269,12 @@
  then
 	 with_libmnl="yes"
  else
 	 with_libmnl="no (Linux only library)"
  fi
 ])
-if test "x$PKG_CONFIG" = "x"
-then
-	with_libmnl="no (Don't have pkg-config)"
-fi
 if test "x$with_libmnl" = "xyes"
 then
 	if $PKG_CONFIG --exists libmnl 2>/dev/null; then
 	  with_libmnl_cflags="$with_libmnl_ldflags `$PKG_CONFIG --cflags libmnl`"
 	  with_libmnl_libs="$with_libmnl_libs `$PKG_CONFIG --libs libmnl`"
 	fi
@@ -2967,13 +3399,13 @@
 	then
 		AC_MSG_NOTICE([netapp LDFLAGS: $LIBNETAPP_LDFLAGS])
 	fi
 
 	if test "x$LIBNETAPP_LIBS" = "x"
 	then
-		LIBNETAPP_LIBS="-lpthread -lxml -ladt -lssl -lm -lcrypto -lz"
+		LIBNETAPP_LIBS="$PTHREAD_LIBS -lxml -ladt -lssl -lm -lcrypto -lz"
 	fi
 	AC_MSG_NOTICE([netapp LIBS: $LIBNETAPP_LIBS])
 
 	AC_CHECK_LIB(netapp, na_server_invoke_elem,
 		[with_libnetapp="yes"],
 		[with_libnetapp="no (symbol na_server_invoke_elem not found)"],
@@ -2993,75 +3425,57 @@
 AC_SUBST(LIBNETAPP_LDFLAGS)
 AC_SUBST(LIBNETAPP_LIBS)
 AM_CONDITIONAL(BUILD_WITH_LIBNETAPP, test "x$with_libnetapp" = "xyes")
 # }}}
 
 # --with-libnetsnmp {{{
-with_snmp_config="net-snmp-config"
-with_snmp_cflags=""
-with_snmp_libs=""
 AC_ARG_WITH(libnetsnmp, [AS_HELP_STRING([--with-libnetsnmp@<:@=PREFIX@:>@], [Path to the Net-SNMPD library.])],
 [
 	if test "x$withval" = "xno"
 	then
 		with_libnetsnmp="no"
 	else if test "x$withval" = "xyes"
 	then
 		with_libnetsnmp="yes"
 	else
-		if test -x "$withval"
-		then
-			with_snmp_config="$withval"
-			with_libnetsnmp="yes"
-		else
-			with_snmp_config="$withval/bin/net-snmp-config"
-			with_libnetsnmp="yes"
-		fi
+		with_libnetsnmp_cppflags="-I$withval/include"
+		with_libnetsnmp_ldflags="-I$withval/lib"
+		with_libnetsnmp="yes"
 	fi; fi
 ],
 [with_libnetsnmp="yes"])
 if test "x$with_libnetsnmp" = "xyes"
 then
-	with_snmp_cflags=`$with_snmp_config --cflags 2>/dev/null`
-	snmp_config_status=$?
-
-	if test $snmp_config_status -ne 0
-	then
-		with_libnetsnmp="no ($with_snmp_config failed)"
-	else
-		SAVE_CPPFLAGS="$CPPFLAGS"
-		CPPFLAGS="$CPPFLAGS $with_snmp_cflags"
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libnetsnmp_cppflags"
 
-		AC_CHECK_HEADERS(net-snmp/net-snmp-config.h, [], [with_libnetsnmp="no (net-snmp/net-snmp-config.h not found)"])
+	AC_CHECK_HEADERS(net-snmp/net-snmp-config.h, [], [with_libnetsnmp="no (net-snmp/net-snmp-config.h not found)"])
 
-		CPPFLAGS="$SAVE_CPPFLAGS"
-	fi
+	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libnetsnmp" = "xyes"
 then
-	with_snmp_libs=`$with_snmp_config --libs 2>/dev/null`
-	snmp_config_status=$?
+	SAVE_LDFLAGS="$LDFLAGS"
+	LDFLAGS="$LDFLAGS $with_libnetsnmp_ldflags"
 
-	if test $snmp_config_status -ne 0
-	then
-		with_libnetsnmp="no ($with_snmp_config failed)"
-	else
-		AC_CHECK_LIB(netsnmp, init_snmp,
+	AC_CHECK_LIB(netsnmp, init_snmp,
 		[with_libnetsnmp="yes"],
 		[with_libnetsnmp="no (libnetsnmp not found)"],
 		[$with_snmp_libs])
-	fi
+
+	LDFLAGS="$SAVE_LDFLAGS"
 fi
 if test "x$with_libnetsnmp" = "xyes"
 then
-	BUILD_WITH_LIBSNMP_CFLAGS="$with_snmp_cflags"
-	BUILD_WITH_LIBSNMP_LIBS="$with_snmp_libs"
-	AC_SUBST(BUILD_WITH_LIBSNMP_CFLAGS)
-	AC_SUBST(BUILD_WITH_LIBSNMP_LIBS)
-fi
-AM_CONDITIONAL(BUILD_WITH_LIBNETSNMP, test "x$with_libnetsnmp" = "xyes")
+	BUILD_WITH_LIBNETSNMP_CPPFLAGS="$with_libnetsnmp_cppflags"
+	BUILD_WITH_LIBNETSNMP_LDFLAGS="$with_libnetsnmp_ldflags"
+	BUILD_WITH_LIBNETSNMP_LIBS="-lnetsnmp"
+fi
+AC_SUBST(BUILD_WITH_LIBNETSNMP_CPPFLAGS)
+AC_SUBST(BUILD_WITH_LIBNETSNMP_LDFLAGS)
+AC_SUBST(BUILD_WITH_LIBNETSNMP_LIBS)
 # }}}
 
 # --with-liboconfig {{{
 with_own_liboconfig="no"
 liboconfig_LDFLAGS="$LDFLAGS"
 liboconfig_CPPFLAGS="$CPPFLAGS"
@@ -3088,13 +3502,13 @@
 ])
 
 save_LDFLAGS="$LDFLAGS"
 save_CPPFLAGS="$CPPFLAGS"
 LDFLAGS="$liboconfig_LDFLAGS"
 CPPFLAGS="$liboconfig_CPPFLAGS"
-AC_CHECK_LIB(oconfig, oconfig_parse_fh,
+AC_CHECK_LIB(oconfig, oconfig_parse_file,
 [
 	with_liboconfig="yes"
 	with_own_liboconfig="no"
 ],
 [
 	with_liboconfig="yes"
@@ -3226,62 +3640,64 @@
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
 	LIBS="$SAVE_LIBS"
 fi
 if test "x$with_oracle" = "xyes"
 then
-	BUILD_WITH_ORACLE_CFLAGS="$with_oracle_cppflags"
+	BUILD_WITH_ORACLE_CPPFLAGS="$with_oracle_cppflags"
 	BUILD_WITH_ORACLE_LIBS="$with_oracle_libs"
-	AC_SUBST(BUILD_WITH_ORACLE_CFLAGS)
+	AC_SUBST(BUILD_WITH_ORACLE_CPPFLAGS)
 	AC_SUBST(BUILD_WITH_ORACLE_LIBS)
 fi
 # }}}
 
 # --with-libowcapi {{{
 with_libowcapi_cppflags=""
-with_libowcapi_libs="-lowcapi"
+with_libowcapi_ldflags=""
 AC_ARG_WITH(libowcapi, [AS_HELP_STRING([--with-libowcapi@<:@=PREFIX@:>@], [Path to libowcapi.])],
 [
 	if test "x$withval" != "xno" && test "x$withval" != "xyes"
 	then
 		with_libowcapi_cppflags="-I$withval/include"
-		with_libowcapi_libs="-L$withval/lib -lowcapi"
+		with_libowcapi_ldflags="-L$withval/lib"
 		with_libowcapi="yes"
 	else
 		with_libowcapi="$withval"
 	fi
 ],
 [
 	with_libowcapi="yes"
 ])
 if test "x$with_libowcapi" = "xyes"
 then
 	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$with_libowcapi_cppflags"
+	CPPFLAGS="$CPPFLAGS $with_libowcapi_cppflags"
 
 	AC_CHECK_HEADERS(owcapi.h, [with_libowcapi="yes"], [with_libowcapi="no (owcapi.h not found)"])
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libowcapi" = "xyes"
 then
 	SAVE_LDFLAGS="$LDFLAGS"
 	SAVE_CPPFLAGS="$CPPFLAGS"
-	LDFLAGS="$with_libowcapi_libs"
+	LDFLAGS="$LDFLAGS $with_libowcapi_ldflags"
 	CPPFLAGS="$with_libowcapi_cppflags"
 
 	AC_CHECK_LIB(owcapi, OW_get, [with_libowcapi="yes"], [with_libowcapi="no (libowcapi not found)"])
 
 	LDFLAGS="$SAVE_LDFLAGS"
 	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libowcapi" = "xyes"
 then
 	BUILD_WITH_LIBOWCAPI_CPPFLAGS="$with_libowcapi_cppflags"
-	BUILD_WITH_LIBOWCAPI_LIBS="$with_libowcapi_libs"
+	BUILD_WITH_LIBOWCAPI_LDFLAGS="$with_libowcapi_ldflags"
+	BUILD_WITH_LIBOWCAPI_LIBS="-lowcapi"
 	AC_SUBST(BUILD_WITH_LIBOWCAPI_CPPFLAGS)
+	AC_SUBST(BUILD_WITH_LIBOWCAPI_LDFLAGS)
 	AC_SUBST(BUILD_WITH_LIBOWCAPI_LIBS)
 fi
 # }}}
 
 # --with-libpcap {{{
 AC_ARG_WITH(libpcap, [AS_HELP_STRING([--with-libpcap@<:@=PREFIX@:>@], [Path to libpcap.])],
@@ -3370,13 +3786,13 @@
 if test "x$with_libperl" = "xyes" \
 	&& test -n "$perl_interpreter"
 then
   SAVE_CFLAGS="$CFLAGS"
   SAVE_LIBS="$LIBS"
 dnl ARCHFLAGS="" -> disable multi -arch on OSX (see Config_heavy.pl:fetch_string)
-  PERL_CFLAGS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e ccopts`
+  PERL_CFLAGS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e perl_inc`
   PERL_LIBS=`ARCHFLAGS="" $perl_interpreter -MExtUtils::Embed -e ldopts`
   CFLAGS="$CFLAGS $PERL_CFLAGS"
   LIBS="$LIBS $PERL_LIBS"
 
   AC_CACHE_CHECK([for libperl],
     [c_cv_have_libperl],
@@ -3604,167 +4020,203 @@
 	AC_SUBST(BUILD_WITH_LIBPQ_CPPFLAGS)
 	AC_SUBST(BUILD_WITH_LIBPQ_LDFLAGS)
 fi
 AM_CONDITIONAL(BUILD_WITH_LIBPQ, test "x$with_libpq" = "xyes")
 # }}}
 
-# --with-libpthread {{{
-AC_ARG_WITH(libpthread, [AS_HELP_STRING([--with-libpthread=@<:@=PREFIX@:>@], [Path to libpthread.])],
-[	if test "x$withval" != "xno" \
-		&& test "x$withval" != "xyes"
-	then
-		LDFLAGS="$LDFLAGS -L$withval/lib"
-		CPPFLAGS="$CPPFLAGS -I$withval/include"
-		with_libpthread="yes"
-	else
-		if test "x$withval" = "xno"
-		then
-			with_libpthread="no (disabled)"
-		fi
-	fi
-], [with_libpthread="yes"])
-if test "x$with_libpthread" = "xyes"
+# --with-libprotobuf {{{
+with_libprotobuf_cppflags=""
+with_libprotobuf_ldflags=""
+AC_ARG_WITH([libprotobuf], [AS_HELP_STRING([--with-libprotobuf@<:@=PREFIX@:>@], [Path to libprotobuf.])],
+  [
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libprotobuf_cppflags="-I$withval/include"
+      with_libprotobuf_ldflags="-L$withval/lib"
+      with_libprotobuf="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libprotobuf="no (disabled on command line)"
+    fi
+  ],
+  [withval="yes"]
+)
+if test "x$withval" = "xyes"
 then
-	AC_CHECK_LIB(pthread, pthread_create, [with_libpthread="yes"], [with_libpthread="no (libpthread not found)"], [])
+PKG_CHECK_MODULES([PROTOBUF], [protobuf],
+  [with_libprotobuf="yes"],
+  [with_libprotobuf="no (pkg-config could not find libprotobuf)"]
+)
 fi
 
-if test "x$with_libpthread" = "xyes"
-then
-	AC_CHECK_HEADERS(pthread.h,, [with_libpthread="no (pthread.h not found)"])
-fi
-if test "x$with_libpthread" = "xyes"
+if test "x$withval" != "xno"
 then
-	collect_pthread=1
-else
-	collect_pthread=0
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  LDFLAGS="$with_libprotobuf_ldflags"
+  LIBS="$PROTOBUF_LIBS $LIBS"
+  AC_LANG_PUSH([C++])
+  AC_CHECK_LIB([protobuf], [main],
+    [
+      SAVE_CPPFLAGS="$CPPFLAGS"
+      CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
+      if test "x$PROTOBUF_LIBS" = "x"
+      then
+        PROTOBUF_LIBS="-lprotobuf"
+      fi
+      AC_CHECK_HEADERS([google/protobuf/util/time_util.h],
+        [with_libprotobuf="yes"],
+        [with_libprotobuf="no (<google/protobuf/util/time_util.h> not found)"]
+      )
+      CPPFLAGS="$SAVE_CPPFLAGS"
+    ],
+    [with_libprotobuf="no (libprotobuf not found)"]
+  )
+  AC_LANG_POP([C++])
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
 fi
-AC_DEFINE_UNQUOTED(HAVE_LIBPTHREAD, [$collect_pthread],
-	[Wether or not to use pthread (POSIX threads) library])
-AM_CONDITIONAL(BUILD_WITH_LIBPTHREAD, test "x$with_libpthread" = "xyes")
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS="$with_libprotobuf_cppflags $PROTOBUF_CFLAGS"
+BUILD_WITH_LIBPROTOBUF_LDFLAGS="$with_libprotobuf_ldflags"
+BUILD_WITH_LIBPROTOBUF_LIBS="$PROTOBUF_LIBS"
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_CPPFLAGS])
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_LDFLAGS])
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_LIBS])
 # }}}
 
-# --with-python {{{
-with_python_prog=""
-with_python_path="$PATH"
-AC_ARG_WITH(python, [AS_HELP_STRING([--with-python@<:@=PREFIX@:>@], [Path to the python interpreter.])],
-[
- if test "x$withval" = "xyes" || test "x$withval" = "xno"
- then
-	 with_python="$withval"
- else if test -x "$withval"
- then
-	 with_python_prog="$withval"
-	 with_python_path="`dirname \"$withval\"`$PATH_SEPARATOR$with_python_path"
-	 with_python="yes"
- else if test -d "$withval"
- then
-	 with_python_path="$withval$PATH_SEPARATOR$with_python_path"
-	 with_python="yes"
- else
-	 AC_MSG_WARN([Argument not recognized: $withval])
- fi; fi; fi
-], [with_python="yes"])
-
-SAVE_PATH="$PATH"
-SAVE_CPPFLAGS="$CPPFLAGS"
-SAVE_LDFLAGS="$LDFLAGS"
-SAVE_LIBS="$LIBS"
-
-PATH="$with_python_path"
-
-if test "x$with_python" = "xyes" && test "x$with_python_prog" = "x"
-then
-	AC_MSG_CHECKING([for python])
-	with_python_prog="`which python 2>/dev/null`"
-	if test "x$with_python_prog" = "x"
-	then
-		AC_MSG_RESULT([not found])
-		with_python="no (interpreter not found)"
-	else
-		AC_MSG_RESULT([$with_python_prog])
-	fi
-fi
-
-if test "x$with_python" = "xyes"
-then
-	AC_MSG_CHECKING([for Python CPPFLAGS])
-	python_include_path=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_python_inc())" | "$with_python_prog" 2>&1`
-	python_config_status=$?
-
-	if test "$python_config_status" -ne 0 || test "x$python_include_path" = "x"
-	then
-		AC_MSG_RESULT([failed with status $python_config_status (output: $python_include_path)])
-		with_python="no"
-	else
-		AC_MSG_RESULT([$python_include_path])
-	fi
-fi
-
-if test "x$with_python" = "xyes"
+# --with-libprotobuf-c {{{
+with_libprotobuf_c_cppflags=""
+with_libprotobuf_c_ldflags=""
+AC_ARG_WITH([libprotobuf-c], [AS_HELP_STRING([--with-libprotobuf-c@<:@=PREFIX@:>@], [Path to libprotobuf-c.])],
+  [
+    if test "x$withval" != "xno" && test "x$withval" != "xyes"
+    then
+      with_libprotobuf_c_cppflags="-I$withval/include"
+      with_libprotobuf_c_ldflags="-L$withval/lib"
+      with_libprotobuf_c="yes"
+    fi
+    if test "x$withval" = "xno"
+    then
+      with_libprotobuf_c="no (disabled on command line)"
+    fi
+  ],
+  [withval="yes"]
+)
+if test "x$withval" = "xyes"
 then
-	CPPFLAGS="-I$python_include_path $CPPFLAGS"
-	AC_CHECK_HEADERS(Python.h,
-			 [with_python="yes"],
-			 [with_python="no ('Python.h' not found)"])
+PKG_CHECK_MODULES([PROTOBUF_C], [libprotobuf-c],
+  [with_libprotobuf_c="yes"],
+  [with_libprotobuf_c="no (pkg-config could not find libprotobuf-c)"]
+)
 fi
 
-if test "x$with_python" = "xyes"
+if test "x$withval" != "xno"
 then
-	AC_MSG_CHECKING([for Python LDFLAGS])
-	python_library_path=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_config_vars(\"LIBDIR\").__getitem__(0))" | "$with_python_prog" 2>&1`
-	python_config_status=$?
-
-	if test "$python_config_status" -ne 0 || test "x$python_library_path" = "x"
-	then
-		AC_MSG_RESULT([failed with status $python_config_status (output: $python_library_path)])
-		with_python="no"
-	else
-		AC_MSG_RESULT([$python_library_path])
-	fi
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  LDFLAGS="$with_libprotobuf_c_ldflags"
+  LIBS="$PROTOBUF_C_LIBS $LIBS"
+  AC_CHECK_LIB([protobuf-c], [protobuf_c_message_pack],
+    [
+      SAVE_CPPFLAGS="$CPPFLAGS"
+      CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
+      if test "x$PROTOBUF_C_LIBS" = "x"
+      then
+        PROTOBUF_C_LIBS="-lprotobuf-c"
+      fi
+      AC_CHECK_HEADERS([protobuf-c/protobuf-c.h google/protobuf-c/protobuf-c.h],
+        [
+          with_libprotobuf_c="yes"
+          break
+        ],
+        [with_libprotobuf_c="no (<protobuf-c.h> not found)"]
+      )
+      CPPFLAGS="$SAVE_CPPFLAGS"
+    ],
+    [with_libprotobuf_c="no (libprotobuf-c not found)"]
+  )
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
 fi
-
-if test "x$with_python" = "xyes"
-then
-	AC_MSG_CHECKING([for Python LIBS])
-	python_library_flags=`echo "import distutils.sysconfig;import sys;sys.stdout.write(distutils.sysconfig.get_config_vars(\"BLDLIBRARY\").__getitem__(0))" | "$with_python_prog" 2>&1`
-	python_config_status=$?
-
-	if test "$python_config_status" -ne 0 || test "x$python_library_flags" = "x"
-	then
-		AC_MSG_RESULT([failed with status $python_config_status (output: $python_library_flags)])
-		with_python="no"
-	else
-		AC_MSG_RESULT([$python_library_flags])
-	fi
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS="$with_libprotobuf_c_cppflags $PROTOBUF_C_CFLAGS"
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS="$with_libprotobuf_c_ldflags"
+BUILD_WITH_LIBPROTOBUF_C_LIBS="$PROTOBUF_C_LIBS"
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS])
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_C_LDFLAGS])
+AC_SUBST([BUILD_WITH_LIBPROTOBUF_C_LIBS])
+# }}}
+
+# --with-libpython {{{
+AC_ARG_VAR([LIBPYTHON_CPPFLAGS], [Preprocessor flags for libpython])
+AC_ARG_VAR([LIBPYTHON_LDFLAGS], [Linker flags for libpython])
+AC_ARG_VAR([LIBPYTHON_LIBS], [Libraries for libpython])
+
+AC_ARG_WITH([libpython],
+  [AS_HELP_STRING([--with-libpython],
+    [if we should build with libpython @<:@default=yes@:>@])
+  ],
+  [with_libpython="$withval"],
+  [with_libpython="check"]
+)
+if test "$with_libpython" != "no"; then
+  if test "$LIBPYTHON_CPPFLAGS" = "" && test "$LIBPYTHON_LDFLAGS" = ""; then
+    AC_ARG_VAR([PYTHON_CONFIG], [path to python-config])
+    AC_PATH_PROGS([PYTHON_CONFIG],
+      [python3-config python2-config python-config]
+    )
+    if test "$PYTHON_CONFIG" = ""; then
+      if test "$with_libpython" = "yes"; then
+        AC_MSG_ERROR([Unable to find python-config])
+      fi
+      with_libpython="no"
+    fi
+  fi
 fi
 
-if test "x$with_python" = "xyes"
-then
-	LDFLAGS="-L$python_library_path $LDFLAGS"
-	LIBS="$python_library_flags $LIBS"
-
-	AC_CHECK_FUNC(PyObject_CallFunction,
-		      [with_python="yes"],
-		      [with_python="no (Symbol 'PyObject_CallFunction' not found)"])
+if test "$PYTHON_CONFIG" != ""; then
+  LIBPYTHON_CPPFLAGS="`${PYTHON_CONFIG} --includes`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
+  LIBPYTHON_LDFLAGS="`${PYTHON_CONFIG} --ldflags`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
+  LIBPYTHON_LIBS="`${PYTHON_CONFIG} --libs`"
+  if test $? -ne 0; then
+    with_libpython="no"
+  fi
 fi
 
-PATH="$SAVE_PATH"
-CPPFLAGS="$SAVE_CPPFLAGS"
-LDFLAGS="$SAVE_LDFLAGS"
-LIBS="$SAVE_LIBS"
-
-if test "x$with_python" = "xyes"
-then
-	BUILD_WITH_PYTHON_CPPFLAGS="-I$python_include_path"
-	BUILD_WITH_PYTHON_LDFLAGS="-L$python_library_path"
-	BUILD_WITH_PYTHON_LIBS="$python_library_flags"
-	AC_SUBST(BUILD_WITH_PYTHON_CPPFLAGS)
-	AC_SUBST(BUILD_WITH_PYTHON_LDFLAGS)
-	AC_SUBST(BUILD_WITH_PYTHON_LIBS)
+if test "$with_libpython" != "xno"; then
+  SAVE_CPPFLAGS="$CPPFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
+  SAVE_LIBS="$LIBS"
+  CPPFLAGS="$LIBPYTHON_CPPFLAGS $CPPFLAGS"
+  LDFLAGS="$LIBPYTHON_LDFLAGS $LDFLAGS"
+  LIBS="$LIBPYTHON_LIBS $LIBS"
+  AC_CHECK_HEADERS([Python.h],
+    [
+      AC_MSG_CHECKING([for libpython])
+      AC_LINK_IFELSE([AC_LANG_PROGRAM(
+          [[#include <Python.h>]],
+          [[Py_Initialize();]])
+        ],
+        [with_libpython="yes"],
+        [with_libpython="no"]
+      )
+      AC_MSG_RESULT([$with_libpython])
+    ],
+    [with_libpython="no"]
+  )
+  CPPFLAGS="$SAVE_CPPFLAGS"
+  LDFLAGS="$SAVE_LDFLAGS"
+  LIBS="$SAVE_LIBS"
 fi
-# }}} --with-python
+# }}} --with-libpython
 
 # --with-librabbitmq {{{
 with_librabbitmq_cppflags=""
 with_librabbitmq_ldflags=""
 AC_ARG_WITH(librabbitmq, [AS_HELP_STRING([--with-librabbitmq@<:@=PREFIX@:>@], [Path to librabbitmq.])],
 [
@@ -3911,16 +4363,17 @@
 	AC_SUBST(BUILD_WITH_LIBRDKAFKA_LDFLAGS)
 	AC_SUBST(BUILD_WITH_LIBRDKAFKA_LIBS)
 	AC_DEFINE(HAVE_LIBRDKAFKA, 1, [Define if librdkafka is present and usable.])
   if test "x$with_librdkafka_log_cb" = "xyes"
   then
         AC_DEFINE(HAVE_LIBRDKAFKA_LOG_CB, 1, [Define if librdkafka log facility is present and usable.])
-  else if test "x$with_librdkafka_logger" = "xyes"
+  fi
+  if test "x$with_librdkafka_logger" = "xyes"
   then
         AC_DEFINE(HAVE_LIBRDKAFKA_LOGGER, 1, [Define if librdkafka log facility is present and usable.])
-  fi; fi
+  fi
 fi
 CPPFLAGS="$SAVE_CPPFLAGS"
 LDFLAGS="$SAVE_LDFLAGS"
 AM_CONDITIONAL(BUILD_WITH_LIBRDKAFKA, test "x$with_librdkafka" = "xyes")
 
 # }}}
@@ -4110,17 +4563,12 @@
 ])
 if test "x$with_libsensors" = "xyes"
 then
 	SAVE_CPPFLAGS="$CPPFLAGS"
 	CPPFLAGS="$CPPFLAGS $with_sensors_cflags"
 
-#	AC_CHECK_HEADERS(sensors/sensors.h,
-#	[
-#		AC_DEFINE(HAVE_SENSORS_SENSORS_H, 1, [Define to 1 if you have the <sensors/sensors.h> header file.])
-#	],
-#	[with_libsensors="no (sensors/sensors.h not found)"])
 	AC_CHECK_HEADERS(sensors/sensors.h, [], [with_libsensors="no (sensors/sensors.h not found)"])
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
 fi
 if test "x$with_libsensors" = "xyes"
 then
@@ -4145,80 +4593,19 @@
 	AC_SUBST(BUILD_WITH_LIBSENSORS_CFLAGS)
 	AC_SUBST(BUILD_WITH_LIBSENSORS_LDFLAGS)
 fi
 AM_CONDITIONAL(BUILD_WITH_LM_SENSORS, test "x$with_libsensors" = "xyes")
 # }}}
 
-# --with-libsigrok {{{
-with_libsigrok_cflags=""
-with_libsigrok_ldflags=""
-AC_ARG_WITH(libsigrok, [AS_HELP_STRING([--with-libsigrok@<:@=PREFIX@:>@], [Path to libsigrok.])],
-[
-	if test "x$withval" = "xno"
-	then
-		with_libsigrok="no"
-	else
-		with_libsigrok="yes"
-		if test "x$withval" != "xyes"
-		then
-			with_libsigrok_cflags="-I$withval/include"
-			with_libsigrok_ldflags="-L$withval/lib"
-		fi
-	fi
-],[with_libsigrok="yes"])
-
-# libsigrok has a glib dependency
-if test "x$with_libsigrok" = "xyes"
-then
-m4_ifdef([AM_PATH_GLIB_2_0],
-	[
-	 AM_PATH_GLIB_2_0([2.28.0],
-	 	[with_libsigrok_cflags="$with_libsigrok_cflags $GLIB_CFLAGS"; with_libsigrok_ldflags="$with_libsigrok_ldflags $GLIB_LIBS"])
-	],
-	[
-	 with_libsigrok="no (glib not available)"
-	]
+# libsigrok {{{
+AC_SUBST([LIBSIGROK_CFLAGS])
+AC_SUBST([LIBSIGROK_LIBS])
+PKG_CHECK_MODULES([LIBSIGROK], [libsigrok < 0.4],
+  [with_libsigrok="yes"],
+  [with_libsigrok="no (pkg-config could not find libsigrok)"]
 )
-fi
-
-# libsigrok headers
-if test "x$with_libsigrok" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libsigrok_cflags"
-
-	AC_CHECK_HEADERS(libsigrok/libsigrok.h, [], [with_libsigrok="no (libsigrok/libsigrok.h not found)"])
-
-	CPPFLAGS="$SAVE_CPPFLAGS"
-fi
-
-# libsigrok library
-if test "x$with_libsigrok" = "xyes"
-then
-	SAVE_CPPFLAGS="$CPPFLAGS"
-	SAVE_LDFLAGS="$LDFLAGS"
-	CPPFLAGS="$CPPFLAGS $with_libsigrok_cflags"
-	LDFLAGS="$LDFLAGS $with_libsigrok_ldflags"
-
-	AC_CHECK_LIB(sigrok, sr_init,
-	[
-		AC_DEFINE(HAVE_LIBSIGROK, 1, [Define to 1 if you have the sigrok library (-lsigrok).])
-	],
-	[with_libsigrok="no (libsigrok not found)"])
-
-	CPPFLAGS="$SAVE_CPPFLAGS"
-	LDFLAGS="$SAVE_LDFLAGS"
-fi
-if test "x$with_libsigrok" = "xyes"
-then
-	BUILD_WITH_LIBSIGROK_CFLAGS="$with_libsigrok_cflags"
-	BUILD_WITH_LIBSIGROK_LDFLAGS="$with_libsigrok_ldflags"
-	AC_SUBST(BUILD_WITH_LIBSIGROK_CFLAGS)
-	AC_SUBST(BUILD_WITH_LIBSIGROK_LDFLAGS)
-fi
-AM_CONDITIONAL(BUILD_WITH_LIBSIGROK, test "x$with_libsigrok" = "xyes")
 # }}}
 
 # --with-libstatgrab {{{
 with_libstatgrab_cflags=""
 with_libstatgrab_ldflags=""
 AC_ARG_WITH(libstatgrab, [AS_HELP_STRING([--with-libstatgrab@<:@=PREFIX@:>@], [Path to libstatgrab.])],
@@ -4240,29 +4627,22 @@
  with_libstatgrab_pkg_config="yes"
 ])
 
 if test "x$with_libstatgrab" = "xyes" \
   && test "x$with_libstatgrab_pkg_config" = "xyes"
 then
-  if test "x$PKG_CONFIG" != "x"
+  AC_MSG_CHECKING([pkg-config for libstatgrab])
+  temp_result="found"
+  $PKG_CONFIG --exists libstatgrab 2>/dev/null
+  if test "$?" != "0"
   then
-    AC_MSG_CHECKING([pkg-config for libstatgrab])
-    temp_result="found"
-    $PKG_CONFIG --exists libstatgrab 2>/dev/null
-    if test "$?" != "0"
-    then
-      with_libstatgrab_pkg_config="no"
-      with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
-      temp_result="not found"
-    fi
-    AC_MSG_RESULT([$temp_result])
-  else
-    AC_MSG_NOTICE([pkg-config not available, trying to guess flags for the statgrab library.])
     with_libstatgrab_pkg_config="no"
-    with_libstatgrab_ldflags="$with_libstatgrab_ldflags -lstatgrab"
+    with_libstatgrab="no (pkg-config doesn't know libstatgrab)"
+    temp_result="not found"
   fi
+  AC_MSG_RESULT([$temp_result])
 fi
 
 if test "x$with_libstatgrab" = "xyes" \
   && test "x$with_libstatgrab_pkg_config" = "xyes" \
   && test "x$with_libstatgrab_cflags" = "x"
 then
@@ -4322,12 +4702,13 @@
   LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_libstatgrab" = "xyes"
 then
   SAVE_CFLAGS="$CFLAGS"
+  SAVE_LDFLAGS="$LDFLAGS"
   SAVE_LIBS="$LIBS"
 
   CFLAGS="$CFLAGS $with_libstatgrab_cflags"
   LDFLAGS="$LDFLAGS $with_libstatgrab_ldflags"
   LIBS="-lstatgrab $LIBS"
 
@@ -4554,19 +4935,12 @@
 	with_libupsclient="yes"
 fi
 
 # configure using pkg-config
 if test "x$with_libupsclient" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libupsclient="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libupsclient" = "xuse_pkgconfig"
-then
 	AC_MSG_NOTICE([Checking for libupsclient using $PKG_CONFIG])
 	$PKG_CONFIG --exists 'libupsclient' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libupsclient="no (pkg-config doesn't know libupsclient)"
 	fi
@@ -4633,12 +5007,57 @@
 	BUILD_WITH_LIBUPSCLIENT_LIBS="$with_libupsclient_libs"
 	AC_SUBST(BUILD_WITH_LIBUPSCLIENT_CFLAGS)
 	AC_SUBST(BUILD_WITH_LIBUPSCLIENT_LIBS)
 fi
 # }}}
 
+# --with-libxenctrl {{{
+with_libxenctrl_cppflags=""
+with_libxenctrl_ldflags=""
+AC_ARG_WITH(libxenctrl, [AS_HELP_STRING([--with-libxenctrl@<:@=PREFIX@:>@], [Path to libxenctrl.])],
+[
+	if test "x$withval" != "xno" && test "x$withval" != "xyes"
+	then
+		with_libxenctrl_cppflags="-I$withval/include"
+		with_libxenctrl_ldflags="-L$withval/lib"
+		with_libxenctrl="yes"
+	else
+		with_libxenctrl="$withval"
+	fi
+],
+[
+	with_libxenctrl="yes"
+])
+if test "x$with_libxenctrl" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
+
+	AC_CHECK_HEADERS(xenctrl.h, [with_libxenctrl="yes"], [with_libxenctrl="no (xenctrl.h not found)"])
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+fi
+if test "x$with_libxenctrl" = "xyes"
+then
+	SAVE_CPPFLAGS="$CPPFLAGS"
+	SAVE_LDFLAGS="$LDFLAGS"
+	CPPFLAGS="$CPPFLAGS $with_libxenctrl_cppflags"
+	LDFLAGS="$LDFLAGS $with_libxenctrl_ldflags"
+
+	#Xen versions older than 3.4 has no xc_getcpuinfo()
+	AC_CHECK_LIB(xenctrl, xc_getcpuinfo, [with_libxenctrl="yes"], [with_libxenctrl="no (symbol 'xc_getcpuinfo' not found)"], [])
+
+	CPPFLAGS="$SAVE_CPPFLAGS"
+	LDFLAGS="$SAVE_LDFLAGS"
+	LIBXENCTL_CPPFLAGS="$with_libxenctl_cppflags"
+	LIBXENCTL_LDFLAGS="$with_libxenctl_ldflags"
+	AC_SUBST(LIBXENCTL_CPPFLAGS)
+	AC_SUBST(LIBXENCTL_LDFLAGS)
+fi
+# }}}
+
 # --with-libxmms {{{
 with_xmms_config="xmms-config"
 with_xmms_cflags=""
 with_xmms_libs=""
 AC_ARG_WITH(libxmms, [AS_HELP_STRING([--with-libxmms@<:@=PREFIX@:>@], [Path to libxmms.])],
 [
@@ -4772,13 +5191,13 @@
 		with_mic="yes"
 	else if test -d "$with_mic/lib"
 	then
 		AC_MSG_NOTICE([Not checking for Intel Mic: Manually configured])
 		with_mic_cflags="-I$withval/include"
 		with_mic_ldpath="-L$withval/lib/Linux"
-		with_mic_libs="-lMicAccessSDK -lscif -lpthread"
+		with_mic_libs="$PTHREAD_LIBS -lMicAccessSDK -lscif"
 		with_mic="yes"
 	fi; fi; fi
 ],
 [with_mic="yes"])
 if test "x$with_mic" = "xyes"
 then
@@ -4794,14 +5213,14 @@
 
 	CPPFLAGS="$CPPFLAGS $with_mic_cflags"
 	LDFLAGS="$LDFLAGS $with_mic_ldpath"
 
 	AC_CHECK_LIB(MicAccessSDK, MicInitAPI,
 			[with_mic_ldpath="$with_mic_ldpath"
-			with_mic_libs="-lMicAccessSDK -lscif -lpthread"],
-			[with_mic="no (symbol MicInitAPI not found)"],[-lscif -lpthread])
+			with_mic_libs="$PTHREAD_LIBS -lMicAccessSDK -lscif"],
+			[with_mic="no (symbol MicInitAPI not found)"],[$PTHREAD_LIBS -lscif])
 
 	CPPFLAGS="$SAVE_CPPFLAGS"
 	LDFLAGS="$SAVE_LDFLAGS"
 fi
 
 if test "x$with_mic" = "xyes"
@@ -4837,19 +5256,12 @@
 ],
 [with_libvarnish="use_pkgconfig"])
 
 # configure using pkg-config
 if test "x$with_libvarnish" = "xuse_pkgconfig"
 then
-	if test "x$PKG_CONFIG" = "x"
-	then
-		with_libvarnish="no (Don't have pkg-config)"
-	fi
-fi
-if test "x$with_libvarnish" = "xuse_pkgconfig"
-then
 	AC_MSG_NOTICE([Checking for varnishapi using $PKG_CONFIG])
 	$PKG_CONFIG --exists 'varnishapi' 2>/dev/null
 	if test $? -ne 0
 	then
 		with_libvarnish="no (pkg-config doesn't know varnishapi)"
 	fi
@@ -4903,29 +5315,26 @@
 with_libxml2="no (pkg-config isn't available)"
 with_libxml2_cflags=""
 with_libxml2_ldflags=""
 with_libvirt="no (pkg-config isn't available)"
 with_libvirt_cflags=""
 with_libvirt_ldflags=""
-if test "x$PKG_CONFIG" != "x"
+$PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
+if test "$?" = "0"
 then
-	$PKG_CONFIG --exists 'libxml-2.0' 2>/dev/null
-	if test "$?" = "0"
-	then
-		with_libxml2="yes"
-	else
-		with_libxml2="no (pkg-config doesn't know libxml-2.0)"
-	fi
+	with_libxml2="yes"
+else
+	with_libxml2="no (pkg-config doesn't know libxml-2.0)"
+fi
 
-	$PKG_CONFIG --exists libvirt 2>/dev/null
-	if test "$?" = "0"
-	then
-		with_libvirt="yes"
-	else
-		with_libvirt="no (pkg-config doesn't know libvirt)"
-	fi
+$PKG_CONFIG --exists libvirt 2>/dev/null
+if test "$?" = "0"
+then
+	with_libvirt="yes"
+else
+	with_libvirt="no (pkg-config doesn't know libvirt)"
 fi
 if test "x$with_libxml2" = "xyes"
 then
 	with_libxml2_cflags="`$PKG_CONFIG --cflags libxml-2.0`"
 	if test $? -ne 0
 	then
@@ -5018,23 +5427,12 @@
 
 # $PKG_CONFIG --exists OpenIPMIpthread {{{
 with_libopenipmipthread="yes"
 with_libopenipmipthread_cflags=""
 with_libopenipmipthread_libs=""
 
-AC_MSG_CHECKING([for pkg-config])
-temp_result="no"
-if test "x$PKG_CONFIG" = "x"
-then
-	with_libopenipmipthread="no"
-	temp_result="no"
-else
-	temp_result="$PKG_CONFIG"
-fi
-AC_MSG_RESULT([$temp_result])
-
 if test "x$with_libopenipmipthread" = "xyes"
 then
 	AC_MSG_CHECKING([for libOpenIPMIpthread])
 	$PKG_CONFIG --exists OpenIPMIpthread 2>/dev/null
 	if test "$?" != "0"
 	then
@@ -5152,17 +5550,18 @@
 fi
 AM_CONDITIONAL(BUILD_WITH_LIBATASMART, test "x$with_libatasmart" = "xyes")
 # }}}
 
 PKG_CHECK_MODULES([LIBNOTIFY], [libnotify],
 		[with_libnotify="yes"],
-		[if test "x$LIBNOTIFY_PKG_ERRORS" = "x"; then
-			 with_libnotify="no"
-		 else
-			 with_libnotify="no ($LIBNOTIFY_PKG_ERRORS)"
-		 fi])
+		[with_libnotify="no (pkg-config doesn't know libnotify)"]
+)
+
+PKG_CHECK_MODULES([LIBRIEMANN_CLIENT], [riemann-client >= 1.6.0],
+ [with_libriemann_client="yes"],
+ [with_libriemann_client="no (pkg-config doesn't know libriemann-client)"])
 
 # Check for enabled/disabled features
 #
 
 # AC_COLLECTD(name, enable/disable, info-text, feature/module)
 # ------------------------------------------------------------
@@ -5249,13 +5648,13 @@
 	 if test "x$enable_all_plugins" = "xauto"
 	 then
 	     if test "x$2" = "xyes"
 	     then
 		     enable_plugin="yes"
 	     else
-		     enable_plugin="no"
+		     enable_plugin="$2"
 	     fi
 	 else
 	     enable_plugin="$enable_all_plugins"
 	 fi
     ])
     if test "x$enable_plugin" = "xyes"
@@ -5266,13 +5665,13 @@
 		    if test "x$2" != "xyes"
 		    then
 			    dependency_warning="yes"
 		    fi
 	    else # User passed "yes" but dependency checking yielded "no" => Dependency problem.
 		    dependency_error="yes"
-		    enable_plugin="no (dependency error)"
+		    enable_plugin="$2 (dependency error)"
 	    fi
     fi
     AM_CONDITIONAL([BUILD_PLUGIN_]my_toupper([$1]), test "x$enable_plugin" = "xyes")
     enable_$1="$enable_plugin"
   ]
 )# AC_PLUGIN(name, default, info)
@@ -5280,12 +5679,13 @@
 m4_divert_once([HELP_ENABLE], [
 collectd features:])
 # FIXME: Remove these calls to `AC_COLLECTD' and then remove that macro.
 AC_COLLECTD([debug],     [enable],  [feature], [debugging])
 AC_COLLECTD([daemon],    [disable], [feature], [daemon mode])
 AC_COLLECTD([getifaddrs],[enable],  [feature], [getifaddrs under Linux])
+AC_COLLECTD([werror],    [disable], [feature], [building with -Werror])
 
 dependency_warning="no"
 dependency_error="no"
 
 plugin_ascent="no"
 plugin_barometer="no"
@@ -5294,34 +5694,39 @@
 plugin_ceph="no"
 plugin_cgroups="no"
 plugin_conntrack="no"
 plugin_contextswitch="no"
 plugin_cpu="no"
 plugin_cpufreq="no"
+plugin_cpusleep="no"
 plugin_curl_json="no"
 plugin_curl_xml="no"
 plugin_df="no"
 plugin_disk="no"
 plugin_drbd="no"
 plugin_entropy="no"
 plugin_ethstat="no"
 plugin_fhcount="no"
 plugin_fscache="no"
+plugin_gps="no"
+plugin_grpc="no"
 plugin_interface="no"
 plugin_ipmi="no"
 plugin_ipvs="no"
 plugin_irq="no"
 plugin_load="no"
 plugin_log_logstash="no"
 plugin_memory="no"
 plugin_multimeter="no"
 plugin_nfs="no"
 plugin_numa="no"
 plugin_perl="no"
+plugin_pinba="no"
 plugin_processes="no"
 plugin_protocols="no"
+plugin_python="no"
 plugin_serial="no"
 plugin_smart="no"
 plugin_swap="no"
 plugin_tape="no"
 plugin_tcpconns="no"
 plugin_ted="no"
@@ -5330,22 +5735,24 @@
 plugin_uptime="no"
 plugin_users="no"
 plugin_virt="no"
 plugin_vmem="no"
 plugin_vserver="no"
 plugin_wireless="no"
+plugin_xencpu="no"
 plugin_zfs_arc="no"
+plugin_zone="no"
 plugin_zookeeper="no"
 
 # Linux
 if test "x$ac_system" = "xLinux"
 then
 	plugin_battery="yes"
+	plugin_cgroups="yes"
 	plugin_conntrack="yes"
 	plugin_contextswitch="yes"
-	plugin_cgroups="yes"
 	plugin_cpu="yes"
 	plugin_cpufreq="yes"
 	plugin_disk="yes"
 	plugin_drbd="yes"
 	plugin_entropy="yes"
 	plugin_fhcount="yes"
@@ -5375,51 +5782,65 @@
 		plugin_ipvs="yes"
 	fi
 	if test "x$c_cv_have_usable_asm_msrindex_h" = "xyes" && test "x$have_cpuid_h" = "xyes"
 	then
 		plugin_turbostat="yes"
 	fi
+	
+	if test "x$c_cv_have_clock_boottime_monotonic" = "xyes"
+	then
+		plugin_cpusleep="yes"
+	fi
 fi
 
 if test "x$ac_system" = "xOpenBSD"
 then
 	plugin_tcpconns="yes"
 fi
 
+if test "x$ac_system" = "xNetBSD"
+then
+	plugin_disk="yes"
+	plugin_entropy="yes"
+	plugin_irq="yes"
+	plugin_processes="yes"
+fi
+
 # Mac OS X devices
 if test "x$with_libiokit" = "xyes"
 then
 	plugin_battery="yes"
 	plugin_disk="yes"
 fi
 
 # AIX
 
 if test "x$ac_system" = "xAIX"
 then
-	plugin_tcpconns="yes"
 	plugin_ipc="yes"
+	plugin_tcpconns="yes"
 fi
 
 # FreeBSD
 
 if test "x$ac_system" = "xFreeBSD"
 then
+	plugin_disk="yes"
 	plugin_zfs_arc="yes"
 fi
 
 
 if test "x$with_perfstat" = "xyes"
 then
-	plugin_cpu="yes"
 	plugin_contextswitch="yes"
+	plugin_cpu="yes"
 	plugin_disk="yes"
-	plugin_memory="yes"
-	plugin_swap="yes"
 	plugin_interface="yes"
 	plugin_load="yes"
+	plugin_memory="yes"
+	plugin_swap="yes"
 	plugin_uptime="yes"
 fi
 
 if test "x$with_procinfo" = "xyes"
 then
 	plugin_processes="yes"
@@ -5429,32 +5850,34 @@
 if test "x$with_kstat" = "xyes"
 then
 	plugin_nfs="yes"
 	plugin_processes="yes"
 	plugin_uptime="yes"
 	plugin_zfs_arc="yes"
+	plugin_zone="yes"
 fi
 
 if test "x$with_devinfo$with_kstat" = "xyesyes"
 then
 	plugin_cpu="yes"
 	plugin_disk="yes"
 	plugin_interface="yes"
 	plugin_memory="yes"
 	plugin_tape="yes"
 fi
 
 # libi2c-dev
-with_libi2c="no"
 if test "x$ac_system" = "xLinux"
 then
 AC_CHECK_DECL(i2c_smbus_read_i2c_block_data,
 	[with_libi2c="yes"],
 	[with_libi2c="no (symbol i2c_smbus_read_i2c_block_data not found - have you installed libi2c-dev ?)"],
 	[[#include <stdlib.h>
 	#include <linux/i2c-dev.h>]])
+else
+	with_libi2c="no (Linux only)"
 fi
 
 if test "x$with_libi2c" = "xyes"
 then
 	plugin_barometer="yes"
 fi
@@ -5565,17 +5988,27 @@
 
 if test "x$have_linux_sockios_h$have_linux_ethtool_h" = "xyesyes"
 then
 	plugin_ethstat="yes"
 fi
 
+if test "x$with_libgrpcpp" = "xyes" && test "x$with_libprotobuf" = "xyes" && test "x$have_protoc3" = "xyes" && test "x$GRPC_CPP_PLUGIN" != "x"
+then
+	plugin_grpc="yes"
+fi
+
 if test "x$have_getifaddrs" = "xyes"
 then
 	plugin_interface="yes"
 fi
 
+if test "x$with_libgps" = "xyes"
+then
+	plugin_gps="yes"
+fi
+
 if test "x$have_getloadavg" = "xyes"
 then
 	plugin_load="yes"
 fi
 
 if test "x$with_libyajl" = "xyes"
@@ -5585,12 +6018,17 @@
 
 if test "x$c_cv_have_libperl$c_cv_have_perl_ithreads" = "xyesyes"
 then
 	plugin_perl="yes"
 fi
 
+if test "x$have_protoc_c" = "xyes" && test "x$with_libprotobuf_c" = "xyes"
+then
+	plugin_pinba="yes"
+fi
+
 # Mac OS X memory interface
 if test "x$have_host_statistics" = "xyes"
 then
 	plugin_memory="yes"
 fi
 
@@ -5615,12 +6053,17 @@
 
 if test "x$with_kvm_getprocs" = "xyes" && test "x$have_struct_kinfo_proc_openbsd" = "xyes"
 then
 	plugin_processes="yes"
 fi
 
+if test "x$with_libpython" != "xno"
+then
+	plugin_python="yes"
+fi
+
 if test "x$with_libatasmart" = "xyes" && test "x$with_libudev" = "xyes"
 then
 	plugin_smart="yes"
 fi
 
 if test "x$with_kvm_getswapinfo" = "xyes"
@@ -5630,12 +6073,17 @@
 
 if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_two_args" = "xyes"
 then
 	plugin_swap="yes"
 fi
 
+if test "x$have_swapctl" = "xyes" && test "x$c_cv_have_swapctl_three_args" = "xyes"
+then
+	plugin_swap="yes"
+fi
+
 if test "x$with_kvm_openfiles$with_kvm_nlist" = "xyesyes"
 then
 	plugin_tcpconns="yes"
 fi
 
 if test "x$have_getutent" = "xyes"
@@ -5649,12 +6097,16 @@
 
 if test "x$with_libxml2" = "xyes" && test "x$with_libvirt" = "xyes"
 then
 	plugin_virt="yes"
 fi
 
+if test "x$with_libxenctrl" = "xyes"
+then
+  plugin_xencpu="yes"
+fi
 
 m4_divert_once([HELP_ENABLE], [
 collectd plugins:])
 
 AC_ARG_ENABLE([all-plugins],
 		AS_HELP_STRING([--enable-all-plugins],[enable all plugins (auto by def)]),
@@ -5670,147 +6122,156 @@
 		 fi; fi
 		],
 		[enable_all_plugins="auto"])
 
 m4_divert_once([HELP_ENABLE], [])
 
-AC_PLUGIN([aggregation], [yes],                [Aggregation plugin])
-AC_PLUGIN([amqp],        [$with_librabbitmq],  [AMQP output plugin])
-AC_PLUGIN([apache],      [$with_libcurl],      [Apache httpd statistics])
-AC_PLUGIN([apcups],      [yes],                [Statistics of UPSes by APC])
-AC_PLUGIN([apple_sensors], [$with_libiokit],   [Apple's hardware sensors])
-AC_PLUGIN([aquaero],     [$with_libaquaero5],  [Aquaero's hardware sensors])
-AC_PLUGIN([ascent],      [$plugin_ascent],     [AscentEmu player statistics])
-AC_PLUGIN([barometer],   [$plugin_barometer],  [Barometer sensor on I2C])
-AC_PLUGIN([battery],     [$plugin_battery],    [Battery statistics])
-AC_PLUGIN([bind],        [$plugin_bind],       [ISC Bind nameserver statistics])
-AC_PLUGIN([ceph],        [$plugin_ceph],       [Ceph daemon statistics])
-AC_PLUGIN([conntrack],   [$plugin_conntrack],  [nf_conntrack statistics])
-AC_PLUGIN([contextswitch], [$plugin_contextswitch], [context switch statistics])
-AC_PLUGIN([cpufreq],     [$plugin_cpufreq],    [CPU frequency statistics])
-AC_PLUGIN([cpu],         [$plugin_cpu],        [CPU usage statistics])
-AC_PLUGIN([csv],         [yes],                [CSV output plugin])
-AC_PLUGIN([curl],        [$with_libcurl],      [CURL generic web statistics])
-AC_PLUGIN([curl_json],   [$plugin_curl_json],    [CouchDB statistics])
-AC_PLUGIN([curl_xml],   [$plugin_curl_xml],    [CURL generic xml statistics])
-AC_PLUGIN([cgroups],     [$plugin_cgroups],    [CGroups CPU usage accounting])
-AC_PLUGIN([dbi],         [$with_libdbi],       [General database statistics])
-AC_PLUGIN([df],          [$plugin_df],         [Filesystem usage statistics])
-AC_PLUGIN([disk],        [$plugin_disk],       [Disk usage statistics])
-AC_PLUGIN([drbd],        [$plugin_drbd],       [DRBD statistics])
-AC_PLUGIN([dns],         [$with_libpcap],      [DNS traffic analysis])
-AC_PLUGIN([email],       [yes],                [EMail statistics])
-AC_PLUGIN([entropy],     [$plugin_entropy],    [Entropy statistics])
-AC_PLUGIN([ethstat],     [$plugin_ethstat],    [Stats from NIC driver])
-AC_PLUGIN([exec],        [yes],                [Execution of external programs])
-AC_PLUGIN([fhcount],     [$plugin_fhcount],    [File handles statistics])
-AC_PLUGIN([filecount],   [yes],                [Count files in directories])
-AC_PLUGIN([fscache],     [$plugin_fscache],    [fscache statistics])
-AC_PLUGIN([gmond],       [$with_libganglia],   [Ganglia plugin])
-AC_PLUGIN([hddtemp],     [yes],                [Query hddtempd])
-AC_PLUGIN([interface],   [$plugin_interface],  [Interface traffic statistics])
-AC_PLUGIN([ipc],         [$plugin_ipc],        [IPC statistics])
-AC_PLUGIN([ipmi],        [$plugin_ipmi],       [IPMI sensor statistics])
-AC_PLUGIN([iptables],    [$with_libiptc],      [IPTables rule counters])
-AC_PLUGIN([ipvs],        [$plugin_ipvs],       [IPVS connection statistics])
-AC_PLUGIN([irq],         [$plugin_irq],        [IRQ statistics])
-AC_PLUGIN([java],        [$with_java],         [Embed the Java Virtual Machine])
-AC_PLUGIN([load],        [$plugin_load],       [System load])
-AC_PLUGIN([logfile],     [yes],                [File logging plugin])
-AC_PLUGIN([log_logstash], [$plugin_log_logstash], [Logstash json_event compatible logging])
-AC_PLUGIN([lpar],        [$with_perfstat],     [AIX logical partitions statistics])
-AC_PLUGIN([lvm],         [$with_liblvm2app],   [LVM statistics])
-AC_PLUGIN([madwifi],     [$have_linux_wireless_h], [Madwifi wireless statistics])
-AC_PLUGIN([match_empty_counter], [yes],        [The empty counter match])
-AC_PLUGIN([match_hashed], [yes],               [The hashed match])
-AC_PLUGIN([match_regex], [yes],                [The regex match])
-AC_PLUGIN([match_timediff], [yes],             [The timediff match])
-AC_PLUGIN([match_value], [yes],                [The value match])
-AC_PLUGIN([mbmon],       [yes],                [Query mbmond])
-AC_PLUGIN([md],          [$have_linux_raid_md_u_h], [md (Linux software RAID) devices])
-AC_PLUGIN([memcachec],   [$with_libmemcached], [memcachec statistics])
-AC_PLUGIN([memcached],   [yes],                [memcached statistics])
-AC_PLUGIN([memory],      [$plugin_memory],     [Memory usage])
-AC_PLUGIN([mic],         [$with_mic],          [Intel Many Integrated Core stats])
-AC_PLUGIN([modbus],      [$with_libmodbus],    [Modbus plugin])
-AC_PLUGIN([multimeter],  [$plugin_multimeter], [Read multimeter values])
-AC_PLUGIN([mysql],       [$with_libmysql],     [MySQL statistics])
-AC_PLUGIN([netapp],      [$with_libnetapp],    [NetApp plugin])
-AC_PLUGIN([netlink],     [$with_libmnl],       [Enhanced Linux network statistics])
-AC_PLUGIN([network],     [yes],                [Network communication plugin])
-AC_PLUGIN([nfs],         [$plugin_nfs],        [NFS statistics])
-AC_PLUGIN([nginx],       [$with_libcurl],      [nginx statistics])
-AC_PLUGIN([notify_desktop], [$with_libnotify], [Desktop notifications])
-AC_PLUGIN([notify_email], [$with_libesmtp],    [Email notifier])
-AC_PLUGIN([ntpd],        [yes],                [NTPd statistics])
-AC_PLUGIN([numa],        [$plugin_numa],       [NUMA virtual memory statistics])
-AC_PLUGIN([nut],         [$with_libupsclient], [Network UPS tools statistics])
-AC_PLUGIN([olsrd],       [yes],                [olsrd statistics])
-AC_PLUGIN([onewire],     [$with_libowcapi],    [OneWire sensor statistics])
-AC_PLUGIN([openldap],    [$with_libldap],      [OpenLDAP statistics])
-AC_PLUGIN([openvpn],     [yes],                [OpenVPN client statistics])
-AC_PLUGIN([oracle],      [$with_oracle],       [Oracle plugin])
-AC_PLUGIN([perl],        [$plugin_perl],       [Embed a Perl interpreter])
-AC_PLUGIN([pf],          [$have_net_pfvar_h],  [BSD packet filter (PF) statistics])
+AC_PLUGIN([aggregation],         [yes],                     [Aggregation plugin])
+AC_PLUGIN([amqp],                [$with_librabbitmq],       [AMQP output plugin])
+AC_PLUGIN([apache],              [$with_libcurl],           [Apache httpd statistics])
+AC_PLUGIN([apcups],              [yes],                     [Statistics of UPSes by APC])
+AC_PLUGIN([apple_sensors],       [$with_libiokit],          [Apple hardware sensors])
+AC_PLUGIN([aquaero],             [$with_libaquaero5],       [Aquaero hardware sensors])
+AC_PLUGIN([ascent],              [$plugin_ascent],          [AscentEmu player statistics])
+AC_PLUGIN([barometer],           [$plugin_barometer],       [Barometer sensor on I2C])
+AC_PLUGIN([battery],             [$plugin_battery],         [Battery statistics])
+AC_PLUGIN([bind],                [$plugin_bind],            [ISC Bind nameserver statistics])
+AC_PLUGIN([ceph],                [$plugin_ceph],            [Ceph daemon statistics])
+AC_PLUGIN([cgroups],             [$plugin_cgroups],         [CGroups CPU usage accounting])
+AC_PLUGIN([chrony],              [yes],                     [Chrony statistics])
+AC_PLUGIN([conntrack],           [$plugin_conntrack],       [nf_conntrack statistics])
+AC_PLUGIN([contextswitch],       [$plugin_contextswitch],   [context switch statistics])
+AC_PLUGIN([cpu],                 [$plugin_cpu],             [CPU usage statistics])
+AC_PLUGIN([cpufreq],             [$plugin_cpufreq],         [CPU frequency statistics])
+AC_PLUGIN([cpusleep],            [$plugin_cpusleep],        [CPU sleep statistics])
+AC_PLUGIN([csv],                 [yes],                     [CSV output plugin])
+AC_PLUGIN([curl],                [$with_libcurl],           [CURL generic web statistics])
+AC_PLUGIN([curl_json],           [$plugin_curl_json],       [CouchDB statistics])
+AC_PLUGIN([curl_xml],            [$plugin_curl_xml],        [CURL generic xml statistics])
+AC_PLUGIN([dbi],                 [$with_libdbi],            [General database statistics])
+AC_PLUGIN([df],                  [$plugin_df],              [Filesystem usage statistics])
+AC_PLUGIN([disk],                [$plugin_disk],            [Disk usage statistics])
+AC_PLUGIN([dns],                 [$with_libpcap],           [DNS traffic analysis])
+AC_PLUGIN([drbd],                [$plugin_drbd],            [DRBD statistics])
+AC_PLUGIN([email],               [yes],                     [EMail statistics])
+AC_PLUGIN([entropy],             [$plugin_entropy],         [Entropy statistics])
+AC_PLUGIN([ethstat],             [$plugin_ethstat],         [Stats from NIC driver])
+AC_PLUGIN([exec],                [yes],                     [Execution of external programs])
+AC_PLUGIN([fhcount],             [$plugin_fhcount],         [File handles statistics])
+AC_PLUGIN([filecount],           [yes],                     [Count files in directories])
+AC_PLUGIN([fscache],             [$plugin_fscache],         [fscache statistics])
+AC_PLUGIN([gmond],               [$with_libganglia],        [Ganglia plugin])
+AC_PLUGIN([gps],                 [$plugin_gps],             [GPS plugin])
+AC_PLUGIN([grpc],                [$plugin_grpc],            [gRPC plugin])
+AC_PLUGIN([hddtemp],             [yes],                     [Query hddtempd])
+AC_PLUGIN([interface],           [$plugin_interface],       [Interface traffic statistics])
+AC_PLUGIN([ipc],                 [$plugin_ipc],             [IPC statistics])
+AC_PLUGIN([ipmi],                [$plugin_ipmi],            [IPMI sensor statistics])
+AC_PLUGIN([iptables],            [$with_libiptc],           [IPTables rule counters])
+AC_PLUGIN([ipvs],                [$plugin_ipvs],            [IPVS connection statistics])
+AC_PLUGIN([irq],                 [$plugin_irq],             [IRQ statistics])
+AC_PLUGIN([java],                [$with_java],              [Embed the Java Virtual Machine])
+AC_PLUGIN([load],                [$plugin_load],            [System load])
+AC_PLUGIN([log_logstash],        [$plugin_log_logstash],    [Logstash json_event compatible logging])
+AC_PLUGIN([logfile],             [yes],                     [File logging plugin])
+AC_PLUGIN([lpar],                [$with_perfstat],          [AIX logical partitions statistics])
+AC_PLUGIN([lua],                 [$with_liblua],            [Lua plugin])
+AC_PLUGIN([lvm],                 [$with_liblvm2app],        [LVM statistics])
+AC_PLUGIN([madwifi],             [$have_linux_wireless_h],  [Madwifi wireless statistics])
+AC_PLUGIN([match_empty_counter], [yes],                     [The empty counter match])
+AC_PLUGIN([match_hashed],        [yes],                     [The hashed match])
+AC_PLUGIN([match_regex],         [yes],                     [The regex match])
+AC_PLUGIN([match_timediff],      [yes],                     [The timediff match])
+AC_PLUGIN([match_value],         [yes],                     [The value match])
+AC_PLUGIN([mbmon],               [yes],                     [Query mbmond])
+AC_PLUGIN([md],                  [$have_linux_raid_md_u_h], [md (Linux software RAID) devices])
+AC_PLUGIN([memcachec],           [$with_libmemcached],      [memcachec statistics])
+AC_PLUGIN([memcached],           [yes],                     [memcached statistics])
+AC_PLUGIN([memory],              [$plugin_memory],          [Memory usage])
+AC_PLUGIN([mic],                 [$with_mic],               [Intel Many Integrated Core stats])
+AC_PLUGIN([modbus],              [$with_libmodbus],         [Modbus plugin])
+AC_PLUGIN([mqtt],                [$with_libmosquitto],      [MQTT output plugin])
+AC_PLUGIN([multimeter],          [$plugin_multimeter],      [Read multimeter values])
+AC_PLUGIN([mysql],               [$with_libmysql],          [MySQL statistics])
+AC_PLUGIN([netapp],              [$with_libnetapp],         [NetApp plugin])
+AC_PLUGIN([netlink],             [$with_libmnl],            [Enhanced Linux network statistics])
+AC_PLUGIN([network],             [yes],                     [Network communication plugin])
+AC_PLUGIN([nfs],                 [$plugin_nfs],             [NFS statistics])
+AC_PLUGIN([nginx],               [$with_libcurl],           [nginx statistics])
+AC_PLUGIN([notify_desktop],      [$with_libnotify],         [Desktop notifications])
+AC_PLUGIN([notify_email],        [$with_libesmtp],          [Email notifier])
+AC_PLUGIN([notify_nagios],       [yes],                     [Nagios notification plugin])
+AC_PLUGIN([ntpd],                [yes],                     [NTPd statistics])
+AC_PLUGIN([numa],                [$plugin_numa],            [NUMA virtual memory statistics])
+AC_PLUGIN([nut],                 [$with_libupsclient],      [Network UPS tools statistics])
+AC_PLUGIN([olsrd],               [yes],                     [olsrd statistics])
+AC_PLUGIN([onewire],             [$with_libowcapi],         [OneWire sensor statistics])
+AC_PLUGIN([openldap],            [$with_libldap],           [OpenLDAP statistics])
+AC_PLUGIN([openvpn],             [yes],                     [OpenVPN client statistics])
+AC_PLUGIN([oracle],              [$with_oracle],            [Oracle plugin])
+AC_PLUGIN([perl],                [$plugin_perl],            [Embed a Perl interpreter])
+AC_PLUGIN([pf],                  [$have_net_pfvar_h],       [BSD packet filter (PF) statistics])
 # FIXME: Check for libevent, too.
-AC_PLUGIN([pinba],       [$have_protoc_c],     [Pinba statistics])
-AC_PLUGIN([ping],        [$with_liboping],     [Network latency statistics])
-AC_PLUGIN([postgresql],  [$with_libpq],        [PostgreSQL database statistics])
-AC_PLUGIN([powerdns],    [yes],                [PowerDNS statistics])
-AC_PLUGIN([processes],   [$plugin_processes],  [Process statistics])
-AC_PLUGIN([protocols],   [$plugin_protocols],  [Protocol (IP, TCP, ...) statistics])
-AC_PLUGIN([python],      [$with_python],       [Embed a Python interpreter])
-AC_PLUGIN([redis],       [$with_libhiredis],    [Redis plugin])
-AC_PLUGIN([routeros],    [$with_librouteros],  [RouterOS plugin])
-AC_PLUGIN([rrdcached],   [$librrd_rrdc_update], [RRDTool output plugin])
-AC_PLUGIN([rrdtool],     [$with_librrd],       [RRDTool output plugin])
-AC_PLUGIN([sensors],     [$with_libsensors],   [lm_sensors statistics])
-AC_PLUGIN([serial],      [$plugin_serial],     [serial port traffic])
-AC_PLUGIN([sigrok],      [$with_libsigrok],    [sigrok acquisition sources])
-AC_PLUGIN([smart],       [$plugin_smart],      [SMART statistics])
-AC_PLUGIN([snmp],        [$with_libnetsnmp],   [SNMP querying plugin])
-AC_PLUGIN([statsd],      [yes],                [StatsD plugin])
-AC_PLUGIN([swap],        [$plugin_swap],       [Swap usage statistics])
-AC_PLUGIN([syslog],      [$have_syslog],       [Syslog logging plugin])
-AC_PLUGIN([table],       [yes],                [Parsing of tabular data])
-AC_PLUGIN([tail],        [yes],                [Parsing of logfiles])
-AC_PLUGIN([tail_csv],    [yes],                [Parsing of CSV files])
-AC_PLUGIN([tape],        [$plugin_tape],       [Tape drive statistics])
-AC_PLUGIN([target_notification], [yes],        [The notification target])
-AC_PLUGIN([target_replace], [yes],             [The replace target])
-AC_PLUGIN([target_scale],[yes],                [The scale target])
-AC_PLUGIN([target_set],  [yes],                [The set target])
-AC_PLUGIN([target_v5upgrade], [yes],           [The v5upgrade target])
-AC_PLUGIN([tcpconns],    [$plugin_tcpconns],   [TCP connection statistics])
-AC_PLUGIN([teamspeak2],  [yes],                [TeamSpeak2 server statistics])
-AC_PLUGIN([ted],         [$plugin_ted],        [Read The Energy Detective values])
-AC_PLUGIN([thermal],     [$plugin_thermal],    [Linux ACPI thermal zone statistics])
-AC_PLUGIN([threshold],   [yes],                [Threshold checking plugin])
-AC_PLUGIN([tokyotyrant], [$with_libtokyotyrant],  [TokyoTyrant database statistics])
-AC_PLUGIN([turbostat],   [$plugin_turbostat],  [Advanced statistic on Intel cpu states])
-AC_PLUGIN([unixsock],    [yes],                [Unixsock communication plugin])
-AC_PLUGIN([uptime],      [$plugin_uptime],     [Uptime statistics])
-AC_PLUGIN([users],       [$plugin_users],      [User statistics])
-AC_PLUGIN([uuid],        [yes],                [UUID as hostname plugin])
-AC_PLUGIN([varnish],     [$with_libvarnish],   [Varnish cache statistics])
-AC_PLUGIN([virt],        [$plugin_virt],       [Virtual machine statistics])
-AC_PLUGIN([vmem],        [$plugin_vmem],       [Virtual memory statistics])
-AC_PLUGIN([vserver],     [$plugin_vserver],    [Linux VServer statistics])
-AC_PLUGIN([wireless],    [$plugin_wireless],   [Wireless statistics])
-AC_PLUGIN([write_graphite], [yes],             [Graphite / Carbon output plugin])
-AC_PLUGIN([write_http],  [$with_libcurl],      [HTTP output plugin])
-AC_PLUGIN([write_kafka],  [$with_librdkafka],  [Kafka output plugin])
-AC_PLUGIN([write_log], [yes],                  [Log output plugin])
-AC_PLUGIN([write_mongodb], [$with_libmongoc],  [MongoDB output plugin])
-AC_PLUGIN([write_redis], [$with_libhiredis],    [Redis output plugin])
-AC_PLUGIN([write_riemann], [$have_protoc_c],   [Riemann output plugin])
-AC_PLUGIN([write_sensu], [yes],                [Sensu output plugin])
-AC_PLUGIN([write_tsdb],  [yes],                [TSDB output plugin])
-AC_PLUGIN([xmms],        [$with_libxmms],      [XMMS statistics])
-AC_PLUGIN([zfs_arc],     [$plugin_zfs_arc],    [ZFS ARC statistics])
-AC_PLUGIN([zookeeper],   [yes],  	       [Zookeeper statistics])
+AC_PLUGIN([pinba],               [$plugin_pinba],           [Pinba statistics])
+AC_PLUGIN([ping],                [$with_liboping],          [Network latency statistics])
+AC_PLUGIN([postgresql],          [$with_libpq],             [PostgreSQL database statistics])
+AC_PLUGIN([powerdns],            [yes],                     [PowerDNS statistics])
+AC_PLUGIN([processes],           [$plugin_processes],       [Process statistics])
+AC_PLUGIN([protocols],           [$plugin_protocols],       [Protocol (IP, TCP, ...) statistics])
+AC_PLUGIN([python],              [$plugin_python],          [Embed a Python interpreter])
+AC_PLUGIN([redis],               [$with_libhiredis],        [Redis plugin])
+AC_PLUGIN([routeros],            [$with_librouteros],       [RouterOS plugin])
+AC_PLUGIN([rrdcached],           [$librrd_rrdc_update],     [RRDTool output plugin])
+AC_PLUGIN([rrdtool],             [$with_librrd],            [RRDTool output plugin])
+AC_PLUGIN([sensors],             [$with_libsensors],        [lm_sensors statistics])
+AC_PLUGIN([serial],              [$plugin_serial],          [serial port traffic])
+AC_PLUGIN([sigrok],              [$with_libsigrok],         [sigrok acquisition sources])
+AC_PLUGIN([smart],               [$plugin_smart],           [SMART statistics])
+AC_PLUGIN([snmp],                [$with_libnetsnmp],        [SNMP querying plugin])
+AC_PLUGIN([statsd],              [yes],                     [StatsD plugin])
+AC_PLUGIN([swap],                [$plugin_swap],            [Swap usage statistics])
+AC_PLUGIN([syslog],              [$have_syslog],            [Syslog logging plugin])
+AC_PLUGIN([table],               [yes],                     [Parsing of tabular data])
+AC_PLUGIN([tail],                [yes],                     [Parsing of logfiles])
+AC_PLUGIN([tail_csv],            [yes],                     [Parsing of CSV files])
+AC_PLUGIN([tape],                [$plugin_tape],            [Tape drive statistics])
+AC_PLUGIN([target_notification], [yes],                     [The notification target])
+AC_PLUGIN([target_replace],      [yes],                     [The replace target])
+AC_PLUGIN([target_scale],        [yes],                     [The scale target])
+AC_PLUGIN([target_set],          [yes],                     [The set target])
+AC_PLUGIN([target_v5upgrade],    [yes],                     [The v5upgrade target])
+AC_PLUGIN([tcpconns],            [$plugin_tcpconns],        [TCP connection statistics])
+AC_PLUGIN([teamspeak2],          [yes],                     [TeamSpeak2 server statistics])
+AC_PLUGIN([ted],                 [$plugin_ted],             [Read The Energy Detective values])
+AC_PLUGIN([thermal],             [$plugin_thermal],         [Linux ACPI thermal zone statistics])
+AC_PLUGIN([threshold],           [yes],                     [Threshold checking plugin])
+AC_PLUGIN([tokyotyrant],         [$with_libtokyotyrant],    [TokyoTyrant database statistics])
+AC_PLUGIN([turbostat],           [$plugin_turbostat],       [Advanced statistic on Intel cpu states])
+AC_PLUGIN([unixsock],            [yes],                     [Unixsock communication plugin])
+AC_PLUGIN([uptime],              [$plugin_uptime],          [Uptime statistics])
+AC_PLUGIN([users],               [$plugin_users],           [User statistics])
+AC_PLUGIN([uuid],                [yes],                     [UUID as hostname plugin])
+AC_PLUGIN([varnish],             [$with_libvarnish],        [Varnish cache statistics])
+AC_PLUGIN([virt],                [$plugin_virt],            [Virtual machine statistics])
+AC_PLUGIN([vmem],                [$plugin_vmem],            [Virtual memory statistics])
+AC_PLUGIN([vserver],             [$plugin_vserver],         [Linux VServer statistics])
+AC_PLUGIN([wireless],            [$plugin_wireless],        [Wireless statistics])
+AC_PLUGIN([write_graphite],      [yes],                     [Graphite / Carbon output plugin])
+AC_PLUGIN([write_http],          [$with_libcurl],           [HTTP output plugin])
+AC_PLUGIN([write_kafka],         [$with_librdkafka],        [Kafka output plugin])
+AC_PLUGIN([write_log],           [yes],                     [Log output plugin])
+AC_PLUGIN([write_mongodb],       [$with_libmongoc],         [MongoDB output plugin])
+AC_PLUGIN([write_redis],         [$with_libhiredis],        [Redis output plugin])
+AC_PLUGIN([write_riemann],       [$with_libriemann_client], [Riemann output plugin])
+AC_PLUGIN([write_sensu],         [yes],                     [Sensu output plugin])
+AC_PLUGIN([write_tsdb],          [yes],                     [TSDB output plugin])
+AC_PLUGIN([xencpu],              [$plugin_xencpu],          [Xen Host CPU usage])
+AC_PLUGIN([xmms],                [$with_libxmms],           [XMMS statistics])
+AC_PLUGIN([zfs_arc],             [$plugin_zfs_arc],         [ZFS ARC statistics])
+AC_PLUGIN([zone],                [$plugin_zone],            [Solaris container statistics])
+AC_PLUGIN([zookeeper],           [yes],                     [Zookeeper statistics])
 
 dnl Default configuration file
 # Load either syslog or logfile
 LOAD_PLUGIN_SYSLOG=""
 LOAD_PLUGIN_LOGFILE=""
 LOAD_PLUGIN_LOG_LOGSTASH=""
@@ -5929,12 +6390,24 @@
 	then
 		with_perl_bindings="yes"
 	else
 		with_perl_bindings="no (no perl interpreter found)"
 	fi
 ])
+
+if test "x$with_perl_bindings" = "xyes"
+then
+	AC_MSG_CHECKING([for the ExtUtils::MakeMaker module])
+	if $PERL -MExtUtils::MakeMaker -e '' 2>/dev/null; then
+		AC_MSG_RESULT([yes])
+	else
+		AC_MSG_RESULT([no])
+		with_perl_bindings="no (ExtUtils::MakeMaker not found)"
+	fi
+fi
+
 if test "x$with_perl_bindings" = "xyes"
 then
 	PERL_BINDINGS="perl"
 else
 	PERL_BINDINGS=""
 fi
@@ -5955,13 +6428,23 @@
 AC_SUBST(LCC_VERSION_PATCH)
 AC_SUBST(LCC_VERSION_EXTRA)
 AC_SUBST(LCC_VERSION_STRING)
 
 AC_CONFIG_FILES(src/libcollectdclient/collectd/lcc_features.h)
 
-AC_CONFIG_FILES([Makefile src/Makefile src/daemon/Makefile src/collectd.conf src/libcollectdclient/Makefile src/libcollectdclient/libcollectdclient.pc src/liboconfig/Makefile bindings/Makefile bindings/java/Makefile])
+AM_CFLAGS="-Wall"
+AM_CXXFLAGS="-Wall"
+if test "x$enable_werror" != "xno"
+then
+        AM_CFLAGS="$AM_CFLAGS -Werror"
+        AM_CXXFLAGS="$AM_CXXFLAGS -Werror"
+fi
+AC_SUBST([AM_CFLAGS])
+AC_SUBST([AM_CXXFLAGS])
+
+AC_CONFIG_FILES([Makefile proto/Makefile src/Makefile src/daemon/Makefile src/collectd.conf src/libcollectdclient/Makefile src/libcollectdclient/libcollectdclient.pc src/liboconfig/Makefile bindings/Makefile bindings/java/Makefile])
 AC_OUTPUT
 
 if test "x$with_librrd" = "xyes" \
 	&& test "x$librrd_threadsafe" != "xyes"
 then
 	with_librrd="yes (warning: librrd is not thread-safe)"
@@ -5982,214 +6465,243 @@
 if test "x$with_perl_bindings" = "xyes" \
 	&& test "x$PERL_BINDINGS_OPTIONS" != "x"
 then
 	with_perl_bindings="yes ($PERL_BINDINGS_OPTIONS)"
 fi
 
-cat <<EOF;
-
-Configuration:
-  Libraries:
-    intel mic . . . . . . $with_mic
-    libaquaero5 . . . . . $with_libaquaero5
-    libatasmart . . . . . $with_libatasmart
-    libcurl . . . . . . . $with_libcurl
-    libdbi  . . . . . . . $with_libdbi
-    libesmtp  . . . . . . $with_libesmtp
-    libganglia  . . . . . $with_libganglia
-    libgcrypt . . . . . . $with_libgcrypt
-    libhal  . . . . . . . $with_libhal
-    libhiredis  . . . . . $with_libhiredis
-    libi2c-dev  . . . . . $with_libi2c
-    libiokit  . . . . . . $with_libiokit
-    libiptc . . . . . . . $with_libiptc
-    libjvm  . . . . . . . $with_java
-    libkstat  . . . . . . $with_kstat
-    libkvm  . . . . . . . $with_libkvm
-    libldap . . . . . . . $with_libldap
-    liblvm2app  . . . . . $with_liblvm2app
-    libmemcached  . . . . $with_libmemcached
-    libmnl  . . . . . . . $with_libmnl
-    libmodbus . . . . . . $with_libmodbus
-    libmongoc . . . . . . $with_libmongoc
-    libmysql  . . . . . . $with_libmysql
-    libnetapp . . . . . . $with_libnetapp
-    libnetsnmp  . . . . . $with_libnetsnmp
-    libnotify . . . . . . $with_libnotify
-    liboconfig  . . . . . $with_liboconfig
-    libopenipmi . . . . . $with_libopenipmipthread
-    liboping  . . . . . . $with_liboping
-    libowcapi . . . . . . $with_libowcapi
-    libpcap . . . . . . . $with_libpcap
-    libperfstat . . . . . $with_perfstat
-    libperl . . . . . . . $with_libperl
-    libpq . . . . . . . . $with_libpq
-    libpthread  . . . . . $with_libpthread
-    librabbitmq . . . . . $with_librabbitmq
-    librdkafka  . . . . . $with_librdkafka
-    librouteros . . . . . $with_librouteros
-    librrd  . . . . . . . $with_librrd
-    libsensors  . . . . . $with_libsensors
-    libsigrok   . . . . . $with_libsigrok
-    libstatgrab . . . . . $with_libstatgrab
-    libtokyotyrant  . . . $with_libtokyotyrant
-    libudev . . . . . . . $with_libudev
-    libupsclient  . . . . $with_libupsclient
-    libvarnish  . . . . . $with_libvarnish
-    libvirt . . . . . . . $with_libvirt
-    libxml2 . . . . . . . $with_libxml2
-    libxmms . . . . . . . $with_libxmms
-    libyajl . . . . . . . $with_libyajl
-    oracle  . . . . . . . $with_oracle
-    protobuf-c  . . . . . $have_protoc_c
-    python  . . . . . . . $with_python
-
-  Features:
-    daemon mode . . . . . $enable_daemon
-    debug . . . . . . . . $enable_debug
-
-  Bindings:
-    perl  . . . . . . . . $with_perl_bindings
-
-  Modules:
-    aggregation . . . . . $enable_aggregation
-    amqp    . . . . . . . $enable_amqp
-    apache  . . . . . . . $enable_apache
-    apcups  . . . . . . . $enable_apcups
-    apple_sensors . . . . $enable_apple_sensors
-    aquaero . . . . . . . $enable_aquaero
-    ascent  . . . . . . . $enable_ascent
-    barometer . . . . . . $enable_barometer
-    battery . . . . . . . $enable_battery
-    bind  . . . . . . . . $enable_bind
-    ceph  . . . . . . . . $enable_ceph
-    cgroups . . . . . . . $enable_cgroups
-    conntrack . . . . . . $enable_conntrack
-    contextswitch . . . . $enable_contextswitch
-    cpu . . . . . . . . . $enable_cpu
-    cpufreq . . . . . . . $enable_cpufreq
-    csv . . . . . . . . . $enable_csv
-    curl  . . . . . . . . $enable_curl
-    curl_json . . . . . . $enable_curl_json
-    curl_xml  . . . . . . $enable_curl_xml
-    dbi . . . . . . . . . $enable_dbi
-    df  . . . . . . . . . $enable_df
-    disk  . . . . . . . . $enable_disk
-    dns . . . . . . . . . $enable_dns
-    drbd  . . . . . . . . $enable_drbd
-    email . . . . . . . . $enable_email
-    entropy . . . . . . . $enable_entropy
-    ethstat . . . . . . . $enable_ethstat
-    exec  . . . . . . . . $enable_exec
-    fhcount . . . . . . . $enable_fhcount
-    filecount . . . . . . $enable_filecount
-    fscache . . . . . . . $enable_fscache
-    gmond . . . . . . . . $enable_gmond
-    hddtemp . . . . . . . $enable_hddtemp
-    interface . . . . . . $enable_interface
-    ipc . . . . . . . . . $enable_ipc
-    ipmi  . . . . . . . . $enable_ipmi
-    iptables  . . . . . . $enable_iptables
-    ipvs  . . . . . . . . $enable_ipvs
-    irq . . . . . . . . . $enable_irq
-    java  . . . . . . . . $enable_java
-    load  . . . . . . . . $enable_load
-    logfile . . . . . . . $enable_logfile
-    log_logstash  . . . . $enable_log_logstash
-    lpar  . . . . . . . . $enable_lpar
-    lvm . . . . . . . . . $enable_lvm
-    madwifi . . . . . . . $enable_madwifi
-    match_empty_counter . $enable_match_empty_counter
-    match_hashed  . . . . $enable_match_hashed
-    match_regex . . . . . $enable_match_regex
-    match_timediff  . . . $enable_match_timediff
-    match_value . . . . . $enable_match_value
-    mbmon . . . . . . . . $enable_mbmon
-    md  . . . . . . . . . $enable_md
-    memcachec . . . . . . $enable_memcachec
-    memcached . . . . . . $enable_memcached
-    memory  . . . . . . . $enable_memory
-    mic . . . . . . . . . $enable_mic
-    modbus  . . . . . . . $enable_modbus
-    multimeter  . . . . . $enable_multimeter
-    mysql . . . . . . . . $enable_mysql
-    netapp  . . . . . . . $enable_netapp
-    netlink . . . . . . . $enable_netlink
-    network . . . . . . . $enable_network
-    nfs . . . . . . . . . $enable_nfs
-    nginx . . . . . . . . $enable_nginx
-    notify_desktop  . . . $enable_notify_desktop
-    notify_email  . . . . $enable_notify_email
-    ntpd  . . . . . . . . $enable_ntpd
-    numa  . . . . . . . . $enable_numa
-    nut . . . . . . . . . $enable_nut
-    olsrd . . . . . . . . $enable_olsrd
-    onewire . . . . . . . $enable_onewire
-    openldap  . . . . . . $enable_openldap
-    openvpn . . . . . . . $enable_openvpn
-    oracle  . . . . . . . $enable_oracle
-    perl  . . . . . . . . $enable_perl
-    pf  . . . . . . . . . $enable_pf
-    pinba . . . . . . . . $enable_pinba
-    ping  . . . . . . . . $enable_ping
-    postgresql  . . . . . $enable_postgresql
-    powerdns  . . . . . . $enable_powerdns
-    processes . . . . . . $enable_processes
-    protocols . . . . . . $enable_protocols
-    python  . . . . . . . $enable_python
-    redis . . . . . . . . $enable_redis
-    routeros  . . . . . . $enable_routeros
-    rrdcached . . . . . . $enable_rrdcached
-    rrdtool . . . . . . . $enable_rrdtool
-    sensors . . . . . . . $enable_sensors
-    serial  . . . . . . . $enable_serial
-    sigrok  . . . . . . . $enable_sigrok
-    smart . . . . . . . . $enable_smart
-    snmp  . . . . . . . . $enable_snmp
-    statsd  . . . . . . . $enable_statsd
-    swap  . . . . . . . . $enable_swap
-    syslog  . . . . . . . $enable_syslog
-    table . . . . . . . . $enable_table
-    tail_csv  . . . . . . $enable_tail_csv
-    tail  . . . . . . . . $enable_tail
-    tape  . . . . . . . . $enable_tape
-    target_notification . $enable_target_notification
-    target_replace  . . . $enable_target_replace
-    target_scale  . . . . $enable_target_scale
-    target_set  . . . . . $enable_target_set
-    target_v5upgrade  . . $enable_target_v5upgrade
-    tcpconns  . . . . . . $enable_tcpconns
-    teamspeak2  . . . . . $enable_teamspeak2
-    ted . . . . . . . . . $enable_ted
-    thermal . . . . . . . $enable_thermal
-    threshold . . . . . . $enable_threshold
-    tokyotyrant . . . . . $enable_tokyotyrant
-    turbostat . . . . . . $enable_turbostat
-    unixsock  . . . . . . $enable_unixsock
-    uptime  . . . . . . . $enable_uptime
-    users . . . . . . . . $enable_users
-    uuid  . . . . . . . . $enable_uuid
-    varnish . . . . . . . $enable_varnish
-    virt  . . . . . . . . $enable_virt
-    vmem  . . . . . . . . $enable_vmem
-    vserver . . . . . . . $enable_vserver
-    wireless  . . . . . . $enable_wireless
-    write_graphite  . . . $enable_write_graphite
-    write_http  . . . . . $enable_write_http
-    write_kafka . . . . . $enable_write_kafka
-    write_log . . . . . . $enable_write_log
-    write_mongodb . . . . $enable_write_mongodb
-    write_redis . . . . . $enable_write_redis
-    write_riemann . . . . $enable_write_riemann
-    write_sensu . . . . . $enable_write_sensu
-    write_tsdb  . . . . . $enable_write_tsdb
-    xmms  . . . . . . . . $enable_xmms
-    zfs_arc . . . . . . . $enable_zfs_arc
-    zookeeper . . . . . . $enable_zookeeper
-
-EOF
+AC_MSG_RESULT()
+AC_MSG_RESULT([Configuration:])
+AC_MSG_RESULT([  Build:])
+AC_MSG_RESULT([    Platform  . . . . . . $ac_system])
+AC_MSG_RESULT([    CC  . . . . . . . . . $CC])
+AC_MSG_RESULT([    CFLAGS  . . . . . . . $AM_CFLAGS $CFLAGS])
+AC_MSG_RESULT([    CXXFLAGS  . . . . . . $AM_CXXFLAGS $CXXFLAGS])
+AC_MSG_RESULT([    CPP . . . . . . . . . $CPP])
+AC_MSG_RESULT([    CPPFLAGS  . . . . . . $CPPFLAGS])
+AC_MSG_RESULT([    GRPC_CPP_PLUGIN . . . $GRPC_CPP_PLUGIN])
+AC_MSG_RESULT([    LD  . . . . . . . . . $LD])
+AC_MSG_RESULT([    LDFLAGS . . . . . . . $LDFLAGS])
+AC_MSG_RESULT([    PROTOC  . . . . . . . $PROTOC])
+AC_MSG_RESULT([    YACC  . . . . . . . . $YACC])
+AC_MSG_RESULT([    YFLAGS  . . . . . . . $YFLAGS])
+AC_MSG_RESULT()
+AC_MSG_RESULT([  Libraries:])
+AC_MSG_RESULT([    intel mic . . . . . . $with_mic])
+AC_MSG_RESULT([    libaquaero5 . . . . . $with_libaquaero5])
+AC_MSG_RESULT([    libatasmart . . . . . $with_libatasmart])
+AC_MSG_RESULT([    libcurl . . . . . . . $with_libcurl])
+AC_MSG_RESULT([    libdbi  . . . . . . . $with_libdbi])
+AC_MSG_RESULT([    libesmtp  . . . . . . $with_libesmtp])
+AC_MSG_RESULT([    libganglia  . . . . . $with_libganglia])
+AC_MSG_RESULT([    libgcrypt . . . . . . $with_libgcrypt])
+AC_MSG_RESULT([    libgps  . . . . . . . $with_libgps])
+AC_MSG_RESULT([    libgrpc++ . . . . . . $with_libgrpcpp])
+AC_MSG_RESULT([    libhal  . . . . . . . $with_libhal])
+AC_MSG_RESULT([    libhiredis  . . . . . $with_libhiredis])
+AC_MSG_RESULT([    libi2c-dev  . . . . . $with_libi2c])
+AC_MSG_RESULT([    libiokit  . . . . . . $with_libiokit])
+AC_MSG_RESULT([    libiptc . . . . . . . $with_libiptc])
+AC_MSG_RESULT([    libjvm  . . . . . . . $with_java])
+AC_MSG_RESULT([    libkstat  . . . . . . $with_kstat])
+AC_MSG_RESULT([    libkvm  . . . . . . . $with_libkvm])
+AC_MSG_RESULT([    libldap . . . . . . . $with_libldap])
+AC_MSG_RESULT([    liblua  . . . . . . . $with_liblua])
+AC_MSG_RESULT([    liblvm2app  . . . . . $with_liblvm2app])
+AC_MSG_RESULT([    libmemcached  . . . . $with_libmemcached])
+AC_MSG_RESULT([    libmnl  . . . . . . . $with_libmnl])
+AC_MSG_RESULT([    libmodbus . . . . . . $with_libmodbus])
+AC_MSG_RESULT([    libmongoc . . . . . . $with_libmongoc])
+AC_MSG_RESULT([    libmosquitto  . . . . $with_libmosquitto])
+AC_MSG_RESULT([    libmysql  . . . . . . $with_libmysql])
+AC_MSG_RESULT([    libnetapp . . . . . . $with_libnetapp])
+AC_MSG_RESULT([    libnetsnmp  . . . . . $with_libnetsnmp])
+AC_MSG_RESULT([    libnotify . . . . . . $with_libnotify])
+AC_MSG_RESULT([    liboconfig  . . . . . $with_liboconfig])
+AC_MSG_RESULT([    libopenipmi . . . . . $with_libopenipmipthread])
+AC_MSG_RESULT([    liboping  . . . . . . $with_liboping])
+AC_MSG_RESULT([    libowcapi . . . . . . $with_libowcapi])
+AC_MSG_RESULT([    libpcap . . . . . . . $with_libpcap])
+AC_MSG_RESULT([    libperfstat . . . . . $with_perfstat])
+AC_MSG_RESULT([    libperl . . . . . . . $with_libperl])
+AC_MSG_RESULT([    libpq . . . . . . . . $with_libpq])
+AC_MSG_RESULT([    libprotobuf . . . . . $with_libprotobuf])
+AC_MSG_RESULT([    libprotobuf-c . . . . $with_libprotobuf_c])
+AC_MSG_RESULT([    libpython . . . . . . $with_libpython])
+AC_MSG_RESULT([    librabbitmq . . . . . $with_librabbitmq])
+AC_MSG_RESULT([    libriemann-client . . $with_libriemann_client])
+AC_MSG_RESULT([    librdkafka  . . . . . $with_librdkafka])
+AC_MSG_RESULT([    librouteros . . . . . $with_librouteros])
+AC_MSG_RESULT([    librrd  . . . . . . . $with_librrd])
+AC_MSG_RESULT([    libsensors  . . . . . $with_libsensors])
+AC_MSG_RESULT([    libsigrok   . . . . . $with_libsigrok])
+AC_MSG_RESULT([    libstatgrab . . . . . $with_libstatgrab])
+AC_MSG_RESULT([    libtokyotyrant  . . . $with_libtokyotyrant])
+AC_MSG_RESULT([    libudev . . . . . . . $with_libudev])
+AC_MSG_RESULT([    libupsclient  . . . . $with_libupsclient])
+AC_MSG_RESULT([    libvarnish  . . . . . $with_libvarnish])
+AC_MSG_RESULT([    libvirt . . . . . . . $with_libvirt])
+AC_MSG_RESULT([    libxenctrl  . . . . . $with_libxenctrl])
+AC_MSG_RESULT([    libxml2 . . . . . . . $with_libxml2])
+AC_MSG_RESULT([    libxmms . . . . . . . $with_libxmms])
+AC_MSG_RESULT([    libyajl . . . . . . . $with_libyajl])
+AC_MSG_RESULT([    oracle  . . . . . . . $with_oracle])
+AC_MSG_RESULT([    protobuf-c  . . . . . $have_protoc_c])
+AC_MSG_RESULT([    protoc 3  . . . . . . $have_protoc3])
+AC_MSG_RESULT()
+AC_MSG_RESULT([  Features:])
+AC_MSG_RESULT([    daemon mode . . . . . $enable_daemon])
+AC_MSG_RESULT([    debug . . . . . . . . $enable_debug])
+AC_MSG_RESULT()
+AC_MSG_RESULT([  Bindings:])
+AC_MSG_RESULT([    perl  . . . . . . . . $with_perl_bindings])
+AC_MSG_RESULT()
+AC_MSG_RESULT([  Modules:])
+AC_MSG_RESULT([    aggregation . . . . . $enable_aggregation])
+AC_MSG_RESULT([    amqp    . . . . . . . $enable_amqp])
+AC_MSG_RESULT([    apache  . . . . . . . $enable_apache])
+AC_MSG_RESULT([    apcups  . . . . . . . $enable_apcups])
+AC_MSG_RESULT([    apple_sensors . . . . $enable_apple_sensors])
+AC_MSG_RESULT([    aquaero . . . . . . . $enable_aquaero])
+AC_MSG_RESULT([    ascent  . . . . . . . $enable_ascent])
+AC_MSG_RESULT([    barometer . . . . . . $enable_barometer])
+AC_MSG_RESULT([    battery . . . . . . . $enable_battery])
+AC_MSG_RESULT([    bind  . . . . . . . . $enable_bind])
+AC_MSG_RESULT([    ceph  . . . . . . . . $enable_ceph])
+AC_MSG_RESULT([    cgroups . . . . . . . $enable_cgroups])
+AC_MSG_RESULT([    chrony. . . . . . . . $enable_chrony])
+AC_MSG_RESULT([    conntrack . . . . . . $enable_conntrack])
+AC_MSG_RESULT([    contextswitch . . . . $enable_contextswitch])
+AC_MSG_RESULT([    cpu . . . . . . . . . $enable_cpu])
+AC_MSG_RESULT([    cpufreq . . . . . . . $enable_cpufreq])
+AC_MSG_RESULT([    cpusleep  . . . . . . $enable_cpusleep])
+AC_MSG_RESULT([    csv . . . . . . . . . $enable_csv])
+AC_MSG_RESULT([    curl  . . . . . . . . $enable_curl])
+AC_MSG_RESULT([    curl_json . . . . . . $enable_curl_json])
+AC_MSG_RESULT([    curl_xml  . . . . . . $enable_curl_xml])
+AC_MSG_RESULT([    dbi . . . . . . . . . $enable_dbi])
+AC_MSG_RESULT([    df  . . . . . . . . . $enable_df])
+AC_MSG_RESULT([    disk  . . . . . . . . $enable_disk])
+AC_MSG_RESULT([    dns . . . . . . . . . $enable_dns])
+AC_MSG_RESULT([    drbd  . . . . . . . . $enable_drbd])
+AC_MSG_RESULT([    email . . . . . . . . $enable_email])
+AC_MSG_RESULT([    entropy . . . . . . . $enable_entropy])
+AC_MSG_RESULT([    ethstat . . . . . . . $enable_ethstat])
+AC_MSG_RESULT([    exec  . . . . . . . . $enable_exec])
+AC_MSG_RESULT([    fhcount . . . . . . . $enable_fhcount])
+AC_MSG_RESULT([    filecount . . . . . . $enable_filecount])
+AC_MSG_RESULT([    fscache . . . . . . . $enable_fscache])
+AC_MSG_RESULT([    gmond . . . . . . . . $enable_gmond])
+AC_MSG_RESULT([    gps . . . . . . . . . $enable_gps])
+AC_MSG_RESULT([    grpc  . . . . . . . . $enable_grpc])
+AC_MSG_RESULT([    hddtemp . . . . . . . $enable_hddtemp])
+AC_MSG_RESULT([    interface . . . . . . $enable_interface])
+AC_MSG_RESULT([    ipc . . . . . . . . . $enable_ipc])
+AC_MSG_RESULT([    ipmi  . . . . . . . . $enable_ipmi])
+AC_MSG_RESULT([    iptables  . . . . . . $enable_iptables])
+AC_MSG_RESULT([    ipvs  . . . . . . . . $enable_ipvs])
+AC_MSG_RESULT([    irq . . . . . . . . . $enable_irq])
+AC_MSG_RESULT([    java  . . . . . . . . $enable_java])
+AC_MSG_RESULT([    load  . . . . . . . . $enable_load])
+AC_MSG_RESULT([    logfile . . . . . . . $enable_logfile])
+AC_MSG_RESULT([    log_logstash  . . . . $enable_log_logstash])
+AC_MSG_RESULT([    lpar  . . . . . . . . $enable_lpar])
+AC_MSG_RESULT([    lua . . . . . . . . . $enable_lua])
+AC_MSG_RESULT([    lvm . . . . . . . . . $enable_lvm])
+AC_MSG_RESULT([    madwifi . . . . . . . $enable_madwifi])
+AC_MSG_RESULT([    match_empty_counter . $enable_match_empty_counter])
+AC_MSG_RESULT([    match_hashed  . . . . $enable_match_hashed])
+AC_MSG_RESULT([    match_regex . . . . . $enable_match_regex])
+AC_MSG_RESULT([    match_timediff  . . . $enable_match_timediff])
+AC_MSG_RESULT([    match_value . . . . . $enable_match_value])
+AC_MSG_RESULT([    mbmon . . . . . . . . $enable_mbmon])
+AC_MSG_RESULT([    md  . . . . . . . . . $enable_md])
+AC_MSG_RESULT([    memcachec . . . . . . $enable_memcachec])
+AC_MSG_RESULT([    memcached . . . . . . $enable_memcached])
+AC_MSG_RESULT([    memory  . . . . . . . $enable_memory])
+AC_MSG_RESULT([    mic . . . . . . . . . $enable_mic])
+AC_MSG_RESULT([    modbus  . . . . . . . $enable_modbus])
+AC_MSG_RESULT([    mqtt  . . . . . . . . $enable_mqtt])
+AC_MSG_RESULT([    multimeter  . . . . . $enable_multimeter])
+AC_MSG_RESULT([    mysql . . . . . . . . $enable_mysql])
+AC_MSG_RESULT([    netapp  . . . . . . . $enable_netapp])
+AC_MSG_RESULT([    netlink . . . . . . . $enable_netlink])
+AC_MSG_RESULT([    network . . . . . . . $enable_network])
+AC_MSG_RESULT([    nfs . . . . . . . . . $enable_nfs])
+AC_MSG_RESULT([    nginx . . . . . . . . $enable_nginx])
+AC_MSG_RESULT([    notify_desktop  . . . $enable_notify_desktop])
+AC_MSG_RESULT([    notify_email  . . . . $enable_notify_email])
+AC_MSG_RESULT([    notify_nagios . . . . $enable_notify_nagios])
+AC_MSG_RESULT([    ntpd  . . . . . . . . $enable_ntpd])
+AC_MSG_RESULT([    numa  . . . . . . . . $enable_numa])
+AC_MSG_RESULT([    nut . . . . . . . . . $enable_nut])
+AC_MSG_RESULT([    olsrd . . . . . . . . $enable_olsrd])
+AC_MSG_RESULT([    onewire . . . . . . . $enable_onewire])
+AC_MSG_RESULT([    openldap  . . . . . . $enable_openldap])
+AC_MSG_RESULT([    openvpn . . . . . . . $enable_openvpn])
+AC_MSG_RESULT([    oracle  . . . . . . . $enable_oracle])
+AC_MSG_RESULT([    perl  . . . . . . . . $enable_perl])
+AC_MSG_RESULT([    pf  . . . . . . . . . $enable_pf])
+AC_MSG_RESULT([    pinba . . . . . . . . $enable_pinba])
+AC_MSG_RESULT([    ping  . . . . . . . . $enable_ping])
+AC_MSG_RESULT([    postgresql  . . . . . $enable_postgresql])
+AC_MSG_RESULT([    powerdns  . . . . . . $enable_powerdns])
+AC_MSG_RESULT([    processes . . . . . . $enable_processes])
+AC_MSG_RESULT([    protocols . . . . . . $enable_protocols])
+AC_MSG_RESULT([    python  . . . . . . . $enable_python])
+AC_MSG_RESULT([    redis . . . . . . . . $enable_redis])
+AC_MSG_RESULT([    routeros  . . . . . . $enable_routeros])
+AC_MSG_RESULT([    rrdcached . . . . . . $enable_rrdcached])
+AC_MSG_RESULT([    rrdtool . . . . . . . $enable_rrdtool])
+AC_MSG_RESULT([    sensors . . . . . . . $enable_sensors])
+AC_MSG_RESULT([    serial  . . . . . . . $enable_serial])
+AC_MSG_RESULT([    sigrok  . . . . . . . $enable_sigrok])
+AC_MSG_RESULT([    smart . . . . . . . . $enable_smart])
+AC_MSG_RESULT([    snmp  . . . . . . . . $enable_snmp])
+AC_MSG_RESULT([    statsd  . . . . . . . $enable_statsd])
+AC_MSG_RESULT([    swap  . . . . . . . . $enable_swap])
+AC_MSG_RESULT([    syslog  . . . . . . . $enable_syslog])
+AC_MSG_RESULT([    table . . . . . . . . $enable_table])
+AC_MSG_RESULT([    tail_csv  . . . . . . $enable_tail_csv])
+AC_MSG_RESULT([    tail  . . . . . . . . $enable_tail])
+AC_MSG_RESULT([    tape  . . . . . . . . $enable_tape])
+AC_MSG_RESULT([    target_notification . $enable_target_notification])
+AC_MSG_RESULT([    target_replace  . . . $enable_target_replace])
+AC_MSG_RESULT([    target_scale  . . . . $enable_target_scale])
+AC_MSG_RESULT([    target_set  . . . . . $enable_target_set])
+AC_MSG_RESULT([    target_v5upgrade  . . $enable_target_v5upgrade])
+AC_MSG_RESULT([    tcpconns  . . . . . . $enable_tcpconns])
+AC_MSG_RESULT([    teamspeak2  . . . . . $enable_teamspeak2])
+AC_MSG_RESULT([    ted . . . . . . . . . $enable_ted])
+AC_MSG_RESULT([    thermal . . . . . . . $enable_thermal])
+AC_MSG_RESULT([    threshold . . . . . . $enable_threshold])
+AC_MSG_RESULT([    tokyotyrant . . . . . $enable_tokyotyrant])
+AC_MSG_RESULT([    turbostat . . . . . . $enable_turbostat])
+AC_MSG_RESULT([    unixsock  . . . . . . $enable_unixsock])
+AC_MSG_RESULT([    uptime  . . . . . . . $enable_uptime])
+AC_MSG_RESULT([    users . . . . . . . . $enable_users])
+AC_MSG_RESULT([    uuid  . . . . . . . . $enable_uuid])
+AC_MSG_RESULT([    varnish . . . . . . . $enable_varnish])
+AC_MSG_RESULT([    virt  . . . . . . . . $enable_virt])
+AC_MSG_RESULT([    vmem  . . . . . . . . $enable_vmem])
+AC_MSG_RESULT([    vserver . . . . . . . $enable_vserver])
+AC_MSG_RESULT([    wireless  . . . . . . $enable_wireless])
+AC_MSG_RESULT([    write_graphite  . . . $enable_write_graphite])
+AC_MSG_RESULT([    write_http  . . . . . $enable_write_http])
+AC_MSG_RESULT([    write_kafka . . . . . $enable_write_kafka])
+AC_MSG_RESULT([    write_log . . . . . . $enable_write_log])
+AC_MSG_RESULT([    write_mongodb . . . . $enable_write_mongodb])
+AC_MSG_RESULT([    write_redis . . . . . $enable_write_redis])
+AC_MSG_RESULT([    write_riemann . . . . $enable_write_riemann])
+AC_MSG_RESULT([    write_sensu . . . . . $enable_write_sensu])
+AC_MSG_RESULT([    write_tsdb  . . . . . $enable_write_tsdb])
+AC_MSG_RESULT([    xencpu  . . . . . . . $enable_xencpu])
+AC_MSG_RESULT([    xmms  . . . . . . . . $enable_xmms])
+AC_MSG_RESULT([    zfs_arc . . . . . . . $enable_zfs_arc])
+AC_MSG_RESULT([    zone  . . . . . . . . $enable_zone])
+AC_MSG_RESULT([    zookeeper . . . . . . $enable_zookeeper])
+AC_MSG_RESULT()
 
 if test "x$dependency_error" = "xyes"; then
 	AC_MSG_ERROR("Some plugins are missing dependencies - see the summary above for details")
 fi
 
 if test "x$dependency_warning" = "xyes"; then
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib: collectd.service
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/collection3/lib/Collectd/Graph/Common.pm /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/collection3/lib/Collectd/Graph/Common.pm
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/collection3/lib/Collectd/Graph/Common.pm	2016-11-29 00:08:22.387470260 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/collection3/lib/Collectd/Graph/Common.pm	2016-09-11 16:10:25.247038744 +0800
@@ -484,22 +484,37 @@
 
 sub get_files_by_ident
 {
   my $ident = shift;
   my $all_files;
   my @ret = ();
+  my $temp;
+  my $hosts;
 
   my $cache_key = ident_to_string ($ident);
   if (defined ($Cache->{'get_files_by_ident'}{$cache_key}))
   {
     my $ret = $Cache->{'get_files_by_ident'}{$cache_key};
 
     return ($ret)
   }
 
-  $all_files = _get_all_files ();
+  if ($ident->{'hostname'})
+  {
+    $all_files = [];
+    $hosts = $ident->{'hostname'};
+    foreach (@$hosts)
+    {
+      $temp = get_files_for_host ($_);
+      push (@$all_files, @$temp);
+    }
+  }
+  else
+  {
+    $all_files = _get_all_files ();
+  }
 
   @ret = grep { _filter_ident ($ident, $_) == 0 } (@$all_files);
 
   $Cache->{'get_files_by_ident'}{$cache_key} = \@ret;
   return (\@ret);
 } # get_files_by_ident
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/examples/myplugin.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/examples/myplugin.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/examples/myplugin.c	2016-11-29 00:08:22.387470260 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/examples/myplugin.c	2016-09-11 16:10:25.247038744 +0800
@@ -100,23 +101,23 @@
 	vl.time       = time (NULL);
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "myplugin", sizeof (vl.plugin));
 
 	/* it is strongly recommended to use a type defined in the types.db file
 	 * instead of a custom type */
-	sstrncpy (vl.type, "myplugin", sizeof (vl.type));
+	sstrncpy (vl.type, "myplugin", sizeof (vl.plugin));
 	/* optionally set vl.plugin_instance and vl.type_instance to reasonable
 	 * values (default: "") */
 
 	/* dispatch the values to collectd which passes them on to all registered
 	 * write functions */
 	plugin_dispatch_values (&vl);
 
 	/* A return value != 0 indicates an error and the plugin will be skipped
 	 * for an increasing amount of time. */
-	return 0;
+    return 0;
 } /* static int my_read (void) */
 
 /*
  * This function is called after values have been dispatched to collectd.
  */
 static int my_write (const data_set_t *ds, const value_list_t *vl,
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib: fedora
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/migrate-4-5.px /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/migrate-4-5.px
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/migrate-4-5.px	2016-11-29 00:08:22.387470260 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/migrate-4-5.px	2016-09-11 16:10:25.247038744 +0800
@@ -101,12 +101,14 @@
   pg_n_tup_c => ["value"],
   pg_scan => ["value"],
   pg_xact => ["value"],
   protocol_counter => ["value"],
   ps_cputime => ["user", "syst"],
   ps_pagefaults => ["minflt", "majflt"],
+  ps_code => ["value"],
+  ps_data => ["value"],
   serial_octets => ["rx", "tx"],
   swap_io => ["value"],
   virt_cpu_total => ["ns"],
   virt_vcpu => ["ns"],
   vmpage_action => ["value"],
   vmpage_faults => ["minflt", "majflt"],
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/README	2016-11-29 00:08:22.383470218 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/README	2016-09-11 16:10:25.243038749 +0800
@@ -14,17 +14,12 @@
 collectd-network.py
 -------------------
   This Python module by Adrian Perez implements the collectd network protocol
 in pure Python. It currently supports to receive data and notifications from
 collectd.
 
-collectd.service
-----------------
-  Service file for systemd. Please ship this file as
-  /lib/systemd/system/collectd.service in any linux package of collectd.
-
 collectd-unixsock.py
 --------------------
   This Python module by Clay Loveless provides an interface to collect's
 unixsock plugin.
 
 collectd2html.pl
@@ -67,17 +62,12 @@
 ------------
   Creates a new RRD-file with only one data-source (DS) of the source-RRD-
 file. That is very handy when you realise that you have bundled up DSes in one
 RRD-file that should have been in multiple RRD-files instead. Is is used by
 `migrate-3-4.px' to split up the cpu-, nfs-, swap-files and possibly others.
 
-fedora/
--------
-  Init-script and Spec-file that can be used when creating RPM-packages for
-Fedora.
-
 GenericJMX.conf
 ---------------
   Example configuration file for the ‘GenericJMX’ Java plugin. Please read the
 documentation at the beginning of the file for more details.
 
 migrate-3-4.px
@@ -103,6 +93,11 @@
 them in, so others can profit from it.
 
 solaris-smf
 -----------
   Manifest file for the Solaris SMF system and detailed information on how to
 register collectd as a service with this system.
+
+collectd.service
+----------------
+  Service file for systemd. Please ship this file as
+  /lib/systemd/system/collectd.service in any linux package of collectd.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/redhat/collectd.spec /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/redhat/collectd.spec
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/redhat/collectd.spec	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/redhat/collectd.spec	2016-09-11 16:10:25.247038744 +0800
@@ -35,102 +35,76 @@
 #     /var/lib/mock/centos-6-x86_64/result/collectd-X.Y.Z-NN.src.rpm
 #
 
 %global _hardened_build 1
 %{?perl_default_filter}
 
-# plugins only buildable on RHEL6
-# (NB: %{elN} macro is not available on RHEL < 6)
-%{?el6:%global _has_libyajl 1}
-%{?el6:%global _has_recent_libpcap 1}
-%{?el6:%global _has_recent_sockios_h 1}
-%{?el6:%global _has_recent_libganglia 1}
-%{?el6:%global _has_working_libiptc 1}
-%{?el6:%global _has_ip_vs_h 1}
-%{?el6:%global _has_lvm2app_h 1}
-%{?el6:%global _has_libmodbus 1}
-%{?el6:%global _has_libudev 1}
-%{?el6:%global _has_iproute 1}
-%{?el6:%global _has_atasmart 1}
-%{?el6:%global _has_hiredis 1}
-%{?el6:%global _has_asm_msr_index 1}
-
-%{?el7:%global _has_libyajl 1}
-%{?el7:%global _has_recent_libpcap 1}
-%{?el7:%global _has_recent_sockios_h 1}
-%{?el7:%global _has_working_libiptc 1}
-%{?el7:%global _has_ip_vs_h 1}
-%{?el7:%global _has_lvm2app_h 1}
-%{?el7:%global _has_libudev 1}
-%{?el7:%global _has_recent_librrd 1}
-%{?el7:%global _has_iproute 1}
-%{?el7:%global _has_atasmart 1}
-%{?el7:%global _has_hiredis 1}
-%{?el7:%global _has_asm_msr_index 1}
-%{?el7:%global _has_libmodbus 1}
-%{?el7:%global _has_xmms 1}
-
 # plugins enabled by default
 %define with_aggregation 0%{!?_without_aggregation:1}
 %define with_amqp 0%{!?_without_amqp:1}
 %define with_apache 0%{!?_without_apache:1}
 %define with_apcups 0%{!?_without_apcups:1}
 %define with_ascent 0%{!?_without_ascent:1}
 %define with_battery 0%{!?_without_battery:1}
 %define with_bind 0%{!?_without_bind:1}
-%define with_ceph 0%{!?_without_ceph:0%{?_has_libyajl}}
+%define with_ceph 0%{!?_without_ceph:1}
 %define with_cgroups 0%{!?_without_cgroups:1}
+%define with_chrony 0%{!?_without_chrony:1}
 %define with_conntrack 0%{!?_without_conntrack:1}
 %define with_contextswitch 0%{!?_without_contextswitch:1}
 %define with_cpu 0%{!?_without_cpu:1}
 %define with_cpufreq 0%{!?_without_cpufreq:1}
+%define with_cpusleep 0%{!?_without_cpusleep:1}
 %define with_csv 0%{!?_without_csv:1}
 %define with_curl 0%{!?_without_curl:1}
-%define with_curl_json 0%{!?_without_curl_json:0%{?_has_libyajl}}
+%define with_curl_json 0%{!?_without_curl_json:1}
 %define with_curl_xml 0%{!?_without_curl_xml:1}
 %define with_dbi 0%{!?_without_dbi:1}
 %define with_df 0%{!?_without_df:1}
 %define with_disk 0%{!?_without_disk:1}
-%define with_dns 0%{!?_without_dns:0%{?_has_recent_libpcap}}
+%define with_dns 0%{!?_without_dns:1}
 %define with_drbd 0%{!?_without_drbd:1}
 %define with_email 0%{!?_without_email:1}
 %define with_entropy 0%{!?_without_entropy:1}
-%define with_ethstat 0%{!?_without_ethstat:0%{?_has_recent_sockios_h}}
+%define with_ethstat 0%{!?_without_ethstat:1}
 %define with_exec 0%{!?_without_exec:1}
 %define with_fhcount 0%{!?_without_fhcount:1}
 %define with_filecount 0%{!?_without_filecount:1}
 %define with_fscache 0%{!?_without_fscache:1}
-%define with_gmond 0%{!?_without_gmond:0%{?_has_recent_libganglia}}
+%define with_gmond 0%{!?_without_gmond:1}
+%define with_gps 0%{!?_without_gps:1}
 %define with_hddtemp 0%{!?_without_hddtemp:1}
 %define with_interface 0%{!?_without_interface:1}
 %define with_ipc 0%{!?_without_ipc:1}
 %define with_ipmi 0%{!?_without_ipmi:1}
-%define with_iptables 0%{!?_without_iptables:0%{?_has_working_libiptc}}
-%define with_ipvs 0%{!?_without_ipvs:0%{?_has_ip_vs_h}}
+%define with_iptables 0%{!?_without_iptables:1}
+%define with_ipvs 0%{!?_without_ipvs:1}
 %define with_irq 0%{!?_without_irq:1}
 %define with_java 0%{!?_without_java:1}
-%define with_virt 0%{!?_without_virt:1}
 %define with_load 0%{!?_without_load:1}
+%define with_log_logstash 0%{!?_without_log_logstash:1}
 %define with_logfile 0%{!?_without_logfile:1}
-%define with_log_logstash 0%{!?_without_log_logstash:0%{?_has_libyajl}}
-%define with_lvm 0%{!?_without_lvm:0%{?_has_lvm2app_h}}
+%define with_lua 0%{!?_without_lua:1}
+%define with_lvm 0%{!?_without_lvm:1}
 %define with_madwifi 0%{!?_without_madwifi:1}
 %define with_mbmon 0%{!?_without_mbmon:1}
 %define with_md 0%{!?_without_md:1}
 %define with_memcachec 0%{!?_without_memcachec:1}
 %define with_memcached 0%{!?_without_memcached:1}
 %define with_memory 0%{!?_without_memory:1}
+%define with_modbus 0%{!?_without_modbus:1}
+%define with_mqtt 0%{!?_without_mqtt:1}
 %define with_multimeter 0%{!?_without_multimeter:1}
-%define with_modbus 0%{!?_without_modbus:0%{?_has_libmodbus}}
 %define with_mysql 0%{!?_without_mysql:1}
-%define with_netlink 0%{!?_without_netlink:0%{?_has_iproute}}
+%define with_netlink 0%{!?_without_netlink:1}
 %define with_network 0%{!?_without_network:1}
 %define with_nfs 0%{!?_without_nfs:1}
 %define with_nginx 0%{!?_without_nginx:1}
 %define with_notify_desktop 0%{!?_without_notify_desktop:1}
 %define with_notify_email 0%{!?_without_notify_email:1}
+%define with_notify_nagios 0%{!?_without_notify_nagios:1}
 %define with_ntpd 0%{!?_without_ntpd:1}
 %define with_numa 0%{!?_without_numa:1}
 %define with_nut 0%{!?_without_nut:1}
 %define with_olsrd 0%{!?_without_olsrd:1}
 %define with_openldap 0%{!?_without_openldap:1}
 %define with_openvpn 0%{!?_without_openvpn:1}
@@ -139,44 +113,44 @@
 %define with_ping 0%{!?_without_ping:1}
 %define with_postgresql 0%{!?_without_postgresql:1}
 %define with_powerdns 0%{!?_without_powerdns:1}
 %define with_processes 0%{!?_without_processes:1}
 %define with_protocols 0%{!?_without_protocols:1}
 %define with_python 0%{!?_without_python:1}
-%define with_redis 0%{!?_without_redis:0%{?_has_hiredis}}
-%define with_rrdcached 0%{!?_without_rrdcached:0%{?_has_recent_librrd}}
+%define with_redis 0%{!?_without_redis:1}
+%define with_rrdcached 0%{!?_without_rrdcached:1}
 %define with_rrdtool 0%{!?_without_rrdtool:1}
 %define with_sensors 0%{!?_without_sensors:1}
 %define with_serial 0%{!?_without_serial:1}
-%define with_smart 0%{!?_without_smart:0%{?_has_atasmart}}
+%define with_smart 0%{!?_without_smart:1}
 %define with_snmp 0%{!?_without_snmp:1}
 %define with_statsd 0%{!?_without_statsd:1}
 %define with_swap 0%{!?_without_swap:1}
 %define with_syslog 0%{!?_without_syslog:1}
 %define with_table 0%{!?_without_table:1}
 %define with_tail 0%{!?_without_tail:1}
 %define with_tail_csv 0%{!?_without_tail_csv:1}
 %define with_tcpconns 0%{!?_without_tcpconns:1}
 %define with_teamspeak2 0%{!?_without_teamspeak2:1}
 %define with_ted 0%{!?_without_ted:1}
 %define with_thermal 0%{!?_without_thermal:1}
 %define with_threshold 0%{!?_without_threshold:1}
-%define with_turbostat 0%{!?_without_turbostat:0%{?_has_asm_msr_index}}
+%define with_turbostat 0%{!?_without_turbostat:1}
 %define with_unixsock 0%{!?_without_unixsock:1}
 %define with_uptime 0%{!?_without_uptime:1}
 %define with_users 0%{!?_without_users:1}
 %define with_uuid 0%{!?_without_uuid:1}
 %define with_varnish 0%{!?_without_varnish:1}
+%define with_virt 0%{!?_without_virt:1}
 %define with_vmem 0%{!?_without_vmem:1}
 %define with_vserver 0%{!?_without_vserver:1}
 %define with_wireless 0%{!?_without_wireless:1}
 %define with_write_graphite 0%{!?_without_write_graphite:1}
 %define with_write_http 0%{!?_without_write_http:1}
 %define with_write_log 0%{!?_without_write_log:1}
-%define with_write_redis 0%{!?_without_write_redis:0%{?_has_hiredis}}
-%define with_write_riemann 0%{!?_without_write_riemann:1}
+%define with_write_redis 0%{!?_without_write_redis:1}
 %define with_write_sensu 0%{!?_without_write_sensu:1}
 %define with_write_tsdb 0%{!?_without_write_tsdb:1}
 %define with_xmms 0%{!?_without_xmms:0%{?_has_xmms}}
 %define with_zfs_arc 0%{!?_without_zfs_arc:1}
 %define with_zookeeper 0%{!?_without_zookeeper:1}
 
@@ -186,12 +160,14 @@
 # plugin apple_sensors disabled, requires a Mac
 %define with_apple_sensors 0%{!?_without_apple_sensors:0}
 # plugin aquaero disabled, requires a libaquaero5
 %define with_aquaero 0%{!?_without_aquaero:0}
 # plugin barometer disabled, requires a libi2c
 %define with_barometer 0%{!?_without_barometer:0}
+# plugin grpc disabled, requires protobuf-compiler >= 3.0
+%define with_grpc 0%{!?_without_grpc:0}
 # plugin lpar disabled, requires AIX
 %define with_lpar 0%{!?_without_lpar:0}
 # plugin mic disabled, requires Mic
 %define with_mic 0%{!?_without_mic:0}
 # plugin netapp disabled, requires libnetapp
 %define with_netapp 0%{!?_without_netapp:0}
@@ -210,30 +186,62 @@
 # plugin tokyotyrant disabled, requires tcrdb.h
 %define with_tokyotyrant 0%{!?_without_tokyotyrant:0}
 # plugin write_kafka disabled, requires librdkafka
 %define with_write_kafka 0%{!?_without_write_kafka:0}
 # plugin write_mongodb disabled, requires libmongoc
 %define with_write_mongodb 0%{!?_without_write_mongodb:0}
+# plugin write_riemann disabled, requires a new enough riemann_c_client
+%define with_write_riemann 0%{!?_without_write_riemann:0}
+# plugin xencpu disabled, requires xen-devel from non-default repo
+%define with_xencpu 0%{!?_without_xencpu:0}
+# plugin zone disabled, requires Solaris
+%define with_zone 0%{!?_without_zone:0}
+
+# Plugins not buildable on RHEL < 6
+%if 0%{?rhel} && 0%{?rhel} < 6
+%define with_ceph 0
+%define with_curl_json 0
+%define with_log_logstash 0
+%define with_dns 0
+%define with_ethstat 0
+%define with_gmond 0
+%define with_iptables 0
+%define with_ipvs 0
+%define with_lvm 0
+%define with_modbus 0
+%define with_netlink 0
+%define with_redis 0
+%define with_smart 0
+%define with_turbostat 0
+%define with_write_redis 0
+%endif
+
+# Plugins not buildable on RHEL < 7
+%if 0%{?rhel} && 0%{?rhel} < 7
+%define with_cpusleep 0
+%define with_gps 0
+%define with_mqtt 0
+%define with_rrdcached 0
+%define with_xmms 0
+%endif
 
-Summary:	statistics collection and monitoring daemon
+Summary:	Statistics collection and monitoring daemon
 Name:		collectd
-Version:	5.5.2
-Release:	1%{?dist}
+Version:	5.6.0
+Release:	2%{?dist}
 URL:		https://collectd.org
 Source:		https://collectd.org/files/%{name}-%{version}.tar.bz2
 License:	GPLv2
 Group:		System Environment/Daemons
 BuildRoot:	%{_tmppath}/%{name}-%{version}-root
-BuildRequires:	libgcrypt-devel, kernel-headers, libtool-ltdl-devel, libcap-devel
+BuildRequires:	libgcrypt-devel, kernel-headers, libtool-ltdl-devel, libcap-devel, which
 Vendor:		collectd development team <collectd@verplant.org>
 
-%if 0%{?el7:1}
-Requires(pre):		initscripts
-Requires(post):		systemd
-Requires(preun):	systemd
-Requires(postun):	systemd
+%if 0%{?fedora} || 0%{?rhel} >= 7
+%{?systemd_requires}
+BuildRequires:		systemd
 %else
 Requires(post):		chkconfig
 Requires(preun):	chkconfig, initscripts
 Requires(postun):	initscripts
 %endif
 
@@ -314,12 +322,21 @@
 Requires:      %{name}%{?_isa} = %{version}-%{release}
 BuildRequires: yajl-devel
 %description ceph
 Ceph plugin for collectd
 %endif
 
+%if %{with_chrony}
+%package chrony
+Summary:       Chrony plugin for collectd
+Group:         System Environment/Daemons
+Requires:      %{name}%{?_isa} = %{version}-%{release}
+%description chrony
+Chrony plugin for collectd
+%endif
+
 %if %{with_curl}
 %package curl
 Summary:	Curl plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 BuildRequires:	curl-devel
@@ -401,12 +418,32 @@
 BuildRequires:	ganglia-devel
 %description gmond
 The gmond plugin subscribes to a Multicast group to receive data from gmond,
 the client daemon of the Ganglia project.
 %endif
 
+%if %{with_gps}
+%package gps
+Summary:	GPS plugin for collectd
+Group:		System Environment/Daemons
+Requires:	%{name}%{?_isa} = %{version}-%{release}
+BuildRequires:	gpsd-devel
+%description gps
+This plugin monitor gps related data through gpsd.
+%endif
+
+%if %{with_grpc}
+%package grpc
+Summary:	GRPC plugin for collectd
+Group:		System Environment/Daemons
+Requires:	%{name}%{?_isa} = %{version}-%{release}
+BuildRequires:	protobuf-compiler
+%description grpc
+This plugin embeds a gRPC server into Collectd.
+%endif
+
 %if %{with_hddtemp}
 %package hddtemp
 Summary:	Hddtemp plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}, hddtemp
 %description hddtemp
@@ -456,12 +493,23 @@
 Requires:      %{name}%{?_isa} = %{version}-%{release}
 BuildRequires: yajl-devel
 %description log_logstash
 This plugin logs in logstash JSON format
 %endif
 
+%if %{with_lua}
+%package lua
+Summary:	Lua plugin for collectd
+Group:		System Environment/Daemons
+Requires:	%{name}%{?_isa} = %{version}-%{release}
+BuildRequires:	lua-devel
+%description lua
+The Lua plugin embeds a Lua interpreter into collectd and exposes the
+application programming interface (API) to Lua scripts.
+%endif
+
 %if %{with_lvm}
 %package lvm
 Summary:	LVM plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 BuildRequires:	lvm2-devel
@@ -510,12 +558,22 @@
 BuildRequires:	mysql-devel
 %description mysql
 MySQL querying plugin. This plugin provides data of issued commands, called
 handlers and database traffic.
 %endif
 
+%if %{with_mqtt}
+%package mqtt
+Summary:	mqtt plugin for collectd
+Group:		System Environment/Daemons
+Requires:	%{name}%{?_isa} = %{version}-%{release}
+BuildRequires:	mosquitto-devel
+%description mqtt
+The MQTT plugin publishes and subscribes to MQTT topics.
+%endif
+
 %if %{with_netlink}
 %package netlink
 Summary:	netlink plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 BuildRequires:	libmnl-devel, iproute-devel
@@ -578,16 +636,16 @@
 %if %{with_perl}
 %package perl
 Summary:	Perl plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 Requires:	perl(:MODULE_COMPAT_%(eval "`%{__perl} -V:version`"; echo $version))
-	%if 0%{?rhel} >= 6
-BuildRequires:	perl-ExtUtils-Embed
-	%else
+	%if 0%{?rhel} && 0%{?rhel} < 6
 BuildRequires:	perl
+	%else
+BuildRequires:	perl-ExtUtils-Embed
 	%endif
 %description perl
 The Perl plugin embeds a Perl interpreter into collectd and exposes the
 application programming interface (API) to Perl-scripts.
 %endif
 
@@ -626,16 +684,16 @@
 
 %if %{with_python}
 %package python
 Summary:	Python plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
-	%if 0%{?rhel} >= 6
-BuildRequires: python-devel
-	%else
+	%if 0%{?rhel} && 0%{?rhel} < 6
 BuildRequires: python26-devel
+	%else
+BuildRequires: python-devel
 	%endif
 %description python
 The Python plugin embeds a Python interpreter into collectd and exposes the
 application programming interface (API) to Python-scripts.
 %endif
 
@@ -746,13 +804,13 @@
 
 %if %{with_write_kafka}
 %package write_kafka
 Summary:       Write-kafka plugin for collectd
 Group:         System Environment/Daemons
 Requires:      %{name}%{?_isa} = %{version}-%{release}
-BuildRequires: rdkafka-devel
+BuildRequires: librdkafka-devel
 %description write_kafka
 The write_kafka plugin sends values to kafka, a distributed messaging system.
 %endif
 
 %if %{with_write_redis}
 %package write_redis
@@ -771,12 +829,22 @@
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 BuildRequires:	protobuf-c-devel
 %description write_riemann
 The riemann plugin submits values to Riemann, an event stream processor.
 %endif
 
+%if %{with_xencpu}
+%package xencpu
+Summary:	xencpu plugin for collectd
+Group:		System Environment/Daemons
+Requires:	%{name}%{?_isa} = %{version}-%{release}
+BuildRequires:	xen-devel
+%description xencpu
+The xencpu plugin collects CPU statistics from Xen.
+%endif
+
 %if %{with_xmms}
 %package xmms
 Summary:	XMMS plugin for collectd
 Group:		System Environment/Daemons
 Requires:	%{name}%{?_isa} = %{version}-%{release}
 BuildRequires:	xmms-devel
@@ -901,12 +969,18 @@
 %if %{with_cgroups}
 %define _with_cgroups --enable-cgroups
 %else
 %define _with_cgroups --disable-cgroups
 %endif
 
+%if %{with_chrony}
+%define _with_chrony --enable-chrony
+%else
+%define _with_chrony --disable-chrony
+%endif
+
 %if %{with_conntrack}
 %define _with_conntrack --enable-conntrack
 %else
 %define _with_conntrack --disable-conntrack
 %endif
 
@@ -925,12 +999,18 @@
 %if %{with_cpufreq}
 %define _with_cpufreq --enable-cpufreq
 %else
 %define _with_cpufreq --disable-cpufreq
 %endif
 
+%if %{with_cpusleep}
+%define _with_cpusleep --enable-cpusleep
+%else
+%define _with_cpusleep --disable-cpusleep
+%endif
+
 %if %{with_csv}
 %define _with_csv --enable-csv
 %else
 %define _with_csv --disable-csv
 %endif
 
@@ -1033,12 +1113,24 @@
 %if %{with_gmond}
 %define _with_gmond --enable-gmond
 %else
 %define _with_gmond --disable-gmond
 %endif
 
+%if %{with_gps}
+%define _with_gps --enable-gps
+%else
+%define _with_gps --disable-gps
+%endif
+
+%if %{with_grpc}
+%define _with_grpc --enable-grpc
+%else
+%define _with_grpc --disable-grpc
+%endif
+
 %if %{with_hddtemp}
 %define _with_hddtemp --enable-hddtemp
 %else
 %define _with_hddtemp --disable-hddtemp
 %endif
 
@@ -1111,12 +1203,18 @@
 %if %{with_lpar}
 %define _with_lpar --enable-lpar
 %else
 %define _with_lpar --disable-lpar
 %endif
 
+%if %{with_lua}
+%define _with_lua --enable-lua
+%else
+%define _with_lua --disable-lua
+%endif
+
 %if %{with_lvm}
 %define _with_lvm --enable-lvm
 %else
 %define _with_lvm --disable-lvm
 %endif
 
@@ -1171,12 +1269,18 @@
 %if %{with_multimeter}
 %define _with_multimeter --enable-multimeter
 %else
 %define _with_multimeter --disable-multimeter
 %endif
 
+%if %{with_mqtt}
+%define _with_mqtt --enable-mqtt
+%else
+%define _with_mqtt --disable-mqtt
+%endif
+
 %if %{with_mysql}
 %define _with_mysql --enable-mysql
 %else
 %define _with_mysql --disable-mysql
 %endif
 
@@ -1219,12 +1323,18 @@
 %if %{with_notify_email}
 %define _with_notify_email --enable-notify_email
 %else
 %define _with_notify_email --disable-notify_email
 %endif
 
+%if %{with_notify_nagios}
+%define _with_notify_nagios --enable-notify_nagios
+%else
+%define _with_notify_nagios --disable-notify_nagios
+%endif
+
 %if %{with_ntpd}
 %define _with_ntpd --enable-ntpd
 %else
 %define _with_ntpd --disable-ntpd
 %endif
 
@@ -1316,16 +1426,17 @@
 %define _with_protocols --enable-protocols
 %else
 %define _with_protocols --disable-protocols
 %endif
 
 %if %{with_python}
-	%if 0%{?rhel} >= 6
-%define _with_python --enable-python
-	%else
+	%if 0%{?rhel} && 0%{?rhel} < 6
 %define _with_python --enable-python --with-python=%{_bindir}/python2.6
+%define _python_config PYTHON_CONFIG="%{_bindir}/python2.6-config"
+	%else
+%define _with_python --enable-python
 	%endif
 %else
 %define _with_python --disable-python
 %endif
 
 %if %{with_redis}
@@ -1565,31 +1676,44 @@
 %if %{with_write_tsdb}
 %define _with_write_tsdb --enable-write_tsdb
 %else
 %define _with_write_tsdb --disable-write_tsdb
 %endif
 
+%if %{with_xencpu}
+%define _with_xencpu --enable-xencpu
+%else
+%define _with_xencpu --disable-xencpu
+%endif
+
 %if %{with_xmms}
 %define _with_xmms --enable-xmms
 %else
 %define _with_xmms --disable-xmms
 %endif
 
 %if %{with_zfs_arc}
 %define _with_zfs_arc --enable-zfs_arc
 %else
 %define _with_zfs_arc --disable-zfs_arc
 %endif
 
+%if %{with_zone}
+%define _with_zone --enable-zone
+%else
+%define _with_zone --disable-zone
+%endif
+
 %if %{with_zookeeper}
 %define _with_zookeeper --enable-zookeeper
 %else
 %define _with_zookeeper --disable-zookeeper
 %endif
 
 %configure CFLAGS="%{optflags} -DLT_LAZY_OR_NOW=\"RTLD_LAZY|RTLD_GLOBAL\"" \
+	%{?_python_config} \
 	--disable-static \
 	--without-included-ltdl \
 	--enable-all-plugins=yes \
 	--enable-match_empty_counter \
 	--enable-match_hashed \
 	--enable-match_regex \
@@ -1609,20 +1733,22 @@
 	%{?_with_ascent} \
 	%{?_with_barometer} \
 	%{?_with_battery} \
 	%{?_with_bind} \
 	%{?_with_ceph} \
 	%{?_with_cgroups} \
+	%{?_with_chrony} \
 	%{?_with_conntrack} \
 	%{?_with_contextswitch} \
-	%{?_with_cpu} \
 	%{?_with_cpufreq} \
+	%{?_with_cpusleep} \
+	%{?_with_cpu} \
 	%{?_with_csv} \
-	%{?_with_curl} \
 	%{?_with_curl_json} \
 	%{?_with_curl_xml} \
+	%{?_with_curl} \
 	%{?_with_dbi} \
 	%{?_with_df} \
 	%{?_with_disk} \
 	%{?_with_dns} \
 	%{?_with_drbd} \
 	%{?_with_email} \
@@ -1630,113 +1756,120 @@
 	%{?_with_ethstat} \
 	%{?_with_exec} \
 	%{?_with_fhcount} \
 	%{?_with_filecount} \
 	%{?_with_fscache} \
 	%{?_with_gmond} \
+	%{?_with_gps} \
+	%{?_with_grpc} \
 	%{?_with_hddtemp} \
 	%{?_with_interface} \
 	%{?_with_ipc} \
 	%{?_with_ipmi} \
 	%{?_with_iptables} \
 	%{?_with_ipvs} \
+	%{?_with_irq} \
 	%{?_with_java} \
-	%{?_with_virt} \
+	%{?_with_load} \
 	%{?_with_log_logstash} \
+	%{?_with_logfile} \
 	%{?_with_lpar} \
+	%{?_with_lua} \
 	%{?_with_lvm} \
+	%{?_with_madwifi} \
+	%{?_with_mbmon} \
+	%{?_with_md} \
 	%{?_with_memcachec} \
+	%{?_with_memcached} \
+	%{?_with_memory} \
 	%{?_with_mic} \
 	%{?_with_modbus} \
+	%{?_with_mqtt} \
 	%{?_with_multimeter} \
 	%{?_with_mysql} \
 	%{?_with_netapp} \
 	%{?_with_netlink} \
+	%{?_with_network} \
+	%{?_with_nfs} \
 	%{?_with_nginx} \
 	%{?_with_notify_desktop} \
 	%{?_with_notify_email} \
+	%{?_with_notify_nagios} \
+	%{?_with_ntpd} \
+	%{?_with_numa} \
 	%{?_with_nut} \
+	%{?_with_olsrd} \
 	%{?_with_onewire} \
 	%{?_with_openldap} \
+	%{?_with_openvpn} \
 	%{?_with_oracle} \
 	%{?_with_perl} \
 	%{?_with_pf} \
 	%{?_with_pinba} \
 	%{?_with_ping} \
 	%{?_with_postgresql} \
+	%{?_with_powerdns} \
+	%{?_with_processes} \
+	%{?_with_protocols} \
 	%{?_with_python} \
 	%{?_with_redis} \
 	%{?_with_routeros} \
 	%{?_with_rrdcached} \
 	%{?_with_rrdtool} \
 	%{?_with_sensors} \
+	%{?_with_serial} \
 	%{?_with_sigrok} \
 	%{?_with_smart} \
 	%{?_with_snmp} \
-	%{?_with_tape} \
-	%{?_with_tokyotyrant} \
-	%{?_with_varnish} \
-	%{?_with_write_http} \
-	%{?_with_write_kafka} \
-	%{?_with_write_mongodb} \
-	%{?_with_write_redis} \
-	%{?_with_xmms} \
-	%{?_with_zfs_arc} \
-	%{?_with_zookeeper} \
-	%{?_with_irq} \
-	%{?_with_load} \
-	%{?_with_logfile} \
-	%{?_with_madwifi} \
-	%{?_with_mbmon} \
-	%{?_with_md} \
-	%{?_with_memcached} \
-	%{?_with_memory} \
-	%{?_with_network} \
-	%{?_with_nfs} \
-	%{?_with_ntpd} \
-	%{?_with_numa} \
-	%{?_with_olsrd} \
-	%{?_with_openvpn} \
-	%{?_with_powerdns} \
-	%{?_with_processes} \
-	%{?_with_protocols} \
-	%{?_with_serial} \
 	%{?_with_statsd} \
 	%{?_with_swap} \
 	%{?_with_syslog} \
 	%{?_with_table} \
-	%{?_with_tail} \
 	%{?_with_tail_csv} \
+	%{?_with_tail} \
+	%{?_with_tape} \
 	%{?_with_tcpconns} \
 	%{?_with_teamspeak2} \
 	%{?_with_ted} \
 	%{?_with_thermal} \
 	%{?_with_threshold} \
+	%{?_with_tokyotyrant} \
 	%{?_with_turbostat} \
 	%{?_with_unixsock} \
 	%{?_with_uptime} \
 	%{?_with_users} \
 	%{?_with_uuid} \
+	%{?_with_varnish} \
+	%{?_with_virt} \
 	%{?_with_vmem} \
 	%{?_with_vserver} \
 	%{?_with_wireless}\
 	%{?_with_write_graphite} \
 	%{?_with_write_http} \
+	%{?_with_write_http} \
+	%{?_with_write_kafka} \
 	%{?_with_write_log} \
+	%{?_with_write_mongodb} \
+	%{?_with_write_redis} \
 	%{?_with_write_riemann} \
 	%{?_with_write_sensu} \
-	%{?_with_write_tsdb}
+	%{?_with_write_tsdb} \
+	%{?_with_xencpu} \
+	%{?_with_xmms} \
+	%{?_with_zfs_arc} \
+	%{?_with_zone} \
+	%{?_with_zookeeper}
 
 
 %{__make} %{?_smp_mflags}
 
 
 %install
 rm -rf %{buildroot}
 %{__make} install DESTDIR=%{buildroot}
-%if 0%{?el7:1}
+%if 0%{?fedora} || 0%{?rhel} >= 7
 %{__install} -Dp -m0644 contrib/systemd.collectd.service %{buildroot}%{_unitdir}/collectd.service
 %else
 %{__install} -Dp -m0755 contrib/redhat/init.d-collectd %{buildroot}%{_initrddir}/collectd
 %endif
 %{__install} -Dp -m0644 src/collectd.conf %{buildroot}%{_sysconfdir}/collectd.conf
 %{__install} -d %{buildroot}%{_sharedstatedir}/collectd/
@@ -1764,12 +1897,16 @@
 %if ! %{with_java}
 rm -f %{buildroot}%{_datadir}/collectd/java/collectd-api.jar
 rm -f %{buildroot}%{_datadir}/collectd/java/generic-jmx.jar
 rm -f %{buildroot}%{_mandir}/man5/collectd-java.5*
 %endif
 
+%if ! %{with_lua}
+rm -f %{buildroot}%{_mandir}/man5/collectd-lua.5*
+%endif
+
 %if ! %{with_perl}
 rm -f %{buildroot}%{_mandir}/man5/collectd-perl.5*
 rm -f %{buildroot}%{_mandir}/man3/Collectd::Unixsock.3pm*
 rm -fr %{buildroot}/usr/lib/perl5/
 %endif
 
@@ -1786,43 +1923,32 @@
 %endif
 
 
 %clean
 rm -rf %{buildroot}
 
-%pre
-%if 0%{?el7:1}
-# stop sysv-based instance before upgrading to systemd
-if [ $1 -eq 2 ] && [ -f /var/lock/subsys/collectd ]; then
-	SYSTEMCTL_SKIP_REDIRECT=1 %{_initddir}/collectd stop >/dev/null 2>&1 || :
-fi
-%endif
-
 %post
-%if 0%{?el7:1}
-if [ $1 -eq 2 ]; then
-	/usr/bin/systemctl daemon-reload >/dev/null 2>&1 || :
-fi
+%if 0%{?fedora} || 0%{?rhel} >= 7
 %systemd_post collectd.service
 %else
 /sbin/chkconfig --add collectd || :
 %endif
 
 %preun
-%if 0%{?el7:1}
+%if 0%{?fedora} || 0%{?rhel} >= 7
 %systemd_preun collectd.service
 %else
 # stop collectd only when uninstalling
 if [ $1 -eq 0 ]; then
 	/sbin/service collectd stop >/dev/null 2>&1 || :
 	/sbin/chkconfig --del collectd || :
 fi
 %endif
 
 %postun
-%if 0%{?el7:1}
+%if 0%{?fedora} || 0%{?rhel} >= 7
 %systemd_postun_with_restart collectd.service
 %else
 # restart collectd only when upgrading
 if [ $1 -eq 1 ]; then
 	/sbin/service collectd condrestart >/dev/null 2>&1 || :
 fi
@@ -1832,13 +1958,13 @@
 %postun -n libcollectdclient -p /sbin/ldconfig
 
 
 %files
 %doc AUTHORS COPYING ChangeLog README
 %config(noreplace) %{_sysconfdir}/collectd.conf
-%if 0%{?el7:1}
+%if 0%{?fedora} || 0%{?rhel} >= 7
 %{_unitdir}/collectd.service
 %else
 %{_initrddir}/collectd
 %endif
 %{_sbindir}/collectd
 %{_sbindir}/collectdmon
@@ -1886,12 +2012,15 @@
 %if %{with_cpu}
 %{_libdir}/%{name}/cpu.so
 %endif
 %if %{with_cpufreq}
 %{_libdir}/%{name}/cpufreq.so
 %endif
+%if %{with_cpusleep}
+%{_libdir}/%{name}/cpusleep.so
+%endif
 %if %{with_csv}
 %{_libdir}/%{name}/csv.so
 %endif
 %if %{with_df}
 %{_libdir}/%{name}/df.so
 %endif
@@ -1955,12 +2084,15 @@
 %if %{with_network}
 %{_libdir}/%{name}/network.so
 %endif
 %if %{with_nfs}
 %{_libdir}/%{name}/nfs.so
 %endif
+%if %{with_notify_nagios}
+%{_libdir}/%{name}/notify_nagios.so
+%endif
 %if %{with_ntpd}
 %{_libdir}/%{name}/ntpd.so
 %endif
 %if %{with_numa}
 %{_libdir}/%{name}/numa.so
 %endif
@@ -2109,12 +2241,17 @@
 
 %if %{with_ceph}
 %files ceph
 %{_libdir}/%{name}/ceph.so
 %endif
 
+%if %{with_chrony}
+%files chrony
+%{_libdir}/%{name}/chrony.so
+%endif
+
 %if %{with_curl}
 %files curl
 %{_libdir}/%{name}/curl.so
 %endif
 
 %if %{with_curl_json}
@@ -2149,12 +2286,22 @@
 
 %if %{with_gmond}
 %files gmond
 %{_libdir}/%{name}/gmond.so
 %endif
 
+%if %{with_gps}
+%files gps
+%{_libdir}/%{name}/gps.so
+%endif
+
+%if %{with_grpc}
+%files grpc
+%{_libdir}/%{name}/grpc.so
+%endif
+
 %if %{with_hddtemp}
 %files hddtemp
 %{_libdir}/%{name}/hddtemp.so
 %endif
 
 %if %{with_ipmi}
@@ -2182,12 +2329,18 @@
 
 %if %{with_log_logstash}
 %files log_logstash
 %{_libdir}/%{name}/log_logstash.so
 %endif
 
+%if %{with_lua}
+%files lua
+%{_mandir}/man5/collectd-lua*
+%{_libdir}/%{name}/lua.so
+%endif
+
 %if %{with_lvm}
 %files lvm
 %{_libdir}/%{name}/lvm.so
 %endif
 
 %if %{with_memcachec}
@@ -2202,12 +2355,17 @@
 
 %if %{with_modbus}
 %files modbus
 %{_libdir}/%{name}/modbus.so
 %endif
 
+%if %{with_mqtt}
+%files mqtt
+%{_libdir}/%{name}/mqtt.so
+%endif
+
 %if %{with_mysql}
 %files mysql
 %{_libdir}/%{name}/mysql.so
 %endif
 
 %if %{with_netlink}
@@ -2329,12 +2487,17 @@
 
 %if %{with_write_riemann}
 %files write_riemann
 %{_libdir}/%{name}/write_riemann.so
 %endif
 
+%if %{with_xencpu}
+%files xencpu
+%{_libdir}/%{name}/xencpu.so
+%endif
+
 %if %{with_xmms}
 %files xmms
 %{_libdir}/%{name}/xmms.so
 %endif
 
 %files collection3
@@ -2346,12 +2509,17 @@
 %{_sysconfdir}/httpd/conf.d/php-collection.conf
 
 %files contrib
 %doc contrib/
 
 %changelog
+* Sun Aug 14 2016 Ruben Kerkhof <ruben@rubenkerkhof.com> - 5.6.0-1
+- New PRE-RELEASE version
+- New plugins enabled by default: chrony, cpusleep, gps, lua, mqtt, notify_nagios
+- New plugins disabled by default: grpc, xencpu, zone
+
 * Tue Jul 26 2016 Ruben Kerkhof <ruben@rubenkerkhof.com> - 5.5.2-1
 - New upstream version
 - Contains fix for CVE-2016-6254
 - Change collectd.org url to https
 
 * Sat Jun 04 2016 Ruben Kerkhof <ruben@rubenkerkhof.com> 5.5.1-1
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/systemd.collectd.service /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/systemd.collectd.service
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/contrib/systemd.collectd.service	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/contrib/systemd.collectd.service	2016-09-11 16:10:25.251038738 +0800
@@ -1,10 +1,11 @@
 [Unit]
-Description=Collectd
-After=local-fs.target network.target
-Requires=local-fs.target network.target
+Description=Collectd statistics daemon
+Documentation=man:collectd(1) man:collectd.conf(5)
+After=local-fs.target network-online.target
+Requires=local-fs.target network-online.target
 
 [Service]
 ExecStart=/usr/sbin/collectd
 EnvironmentFile=-/etc/sysconfig/collectd
 EnvironmentFile=-/etc/default/collectd
 ProtectSystem=full
@@ -30,11 +31,11 @@
 NoNewPrivileges=true
 
 # Tell systemd it will receive a notification from collectd over it's control
 # socket once the daemon is ready. See systemd.service(5) for more details.
 Type=notify
 
-# Restart the collectd daemon after a 10 seconds delay, in case it crashes.
+# Restart the collectd daemon when it fails.
 Restart=on-failure
 
 [Install]
 WantedBy=multi-user.target
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/Makefile.am	2016-11-29 00:08:22.379470177 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/Makefile.am	2016-09-11 16:10:25.239038754 +0800
@@ -3,17 +3,17 @@
 SUBDIRS =
 
 if BUILD_INCLUDED_LTDL
 SUBDIRS += libltdl
 endif
 
-SUBDIRS += src bindings .
+SUBDIRS += proto src bindings .
 
 AM_CPPFLAGS = $(LTDLINCL)
 
-EXTRA_DIST = contrib version-gen.sh
+EXTRA_DIST = contrib version-gen.sh testwrapper.sh
 
 install-exec-hook:
 	$(mkinstalldirs) $(DESTDIR)$(localstatedir)/run
 	$(mkinstalldirs) $(DESTDIR)$(localstatedir)/lib/$(PACKAGE_NAME)
 	$(mkinstalldirs) $(DESTDIR)$(localstatedir)/log
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/Makefile.in	2016-11-29 00:09:17.336044668 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/Makefile.in	2016-09-11 16:10:45.315010897 +0800
@@ -83,13 +83,14 @@
 	$(top_srcdir)/configure $(am__configure_deps) \
 	$(top_srcdir)/src/libcollectdclient/collectd/lcc_features.h.in \
 	AUTHORS COPYING ChangeLog NEWS README TODO \
 	libltdl/config/compile libltdl/config/config.guess \
 	libltdl/config/config.sub libltdl/config/depcomp \
 	libltdl/config/install-sh libltdl/config/missing \
-	libltdl/config/ltmain.sh $(top_srcdir)/libltdl/config/compile \
+	libltdl/config/ylwrap libltdl/config/ltmain.sh \
+	$(top_srcdir)/libltdl/config/compile \
 	$(top_srcdir)/libltdl/config/config.guess \
 	$(top_srcdir)/libltdl/config/config.sub \
 	$(top_srcdir)/libltdl/config/install-sh \
 	$(top_srcdir)/libltdl/config/ltmain.sh \
 	$(top_srcdir)/libltdl/config/missing
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -154,13 +155,13 @@
   unique=`for i in $$list; do \
     if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
   done | $(am__uniquify_input)`
 ETAGS = etags
 CTAGS = ctags
 CSCOPE = cscope
-DIST_SUBDIRS = libltdl src bindings .
+DIST_SUBDIRS = libltdl proto src bindings .
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
 am__remove_distdir = \
   if test -d "$(distdir)"; then \
     find "$(distdir)" -type d ! -perm -200 -exec chmod u+w {} ';' \
@@ -190,21 +191,23 @@
         dir0="$$dir0"/"$$first"; \
       fi; \
     fi; \
     dir1=`echo "$$dir1" | sed -e "$$sed_rest"`; \
   done; \
   reldir="$$dir2"
-DIST_ARCHIVES = $(distdir).tar.gz $(distdir).tar.bz2
 GZIP_ENV = --best
-DIST_TARGETS = dist-bzip2 dist-gzip
+DIST_ARCHIVES = $(distdir).tar.bz2
+DIST_TARGETS = dist-bzip2
 distuninstallcheck_listfiles = find . -type f -print
 am__distuninstallcheck_listfiles = $(distuninstallcheck_listfiles) \
   | sed 's|^\./|$(prefix)/|' | grep -v '$(infodir)/dir$$'
 distcleancheck_listfiles = find . -type f -print
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -216,40 +219,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -257,16 +281,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -287,22 +307,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -316,19 +337,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -351,24 +371,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -378,12 +405,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -403,28 +432,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -437,13 +476,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
@@ -472,15 +510,15 @@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 ACLOCAL_AMFLAGS = -I libltdl/m4
-SUBDIRS = $(am__append_1) src bindings .
+SUBDIRS = $(am__append_1) proto src bindings .
 AM_CPPFLAGS = $(LTDLINCL)
-EXTRA_DIST = contrib version-gen.sh
+EXTRA_DIST = contrib version-gen.sh testwrapper.sh
 all: all-recursive
 
 .SUFFIXES:
 am--refresh: Makefile
 	@:
 $(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0: proto
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/README	2016-11-29 00:08:22.379470177 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/README	2016-09-11 16:10:25.239038754 +0800
@@ -1,9 +1,9 @@
  collectd - System information collection daemon
 =================================================
-http://collectd.org/
+https://collectd.org/
 
 About
 -----
 
   collectd is a small daemon which collects system information periodically
   and provides mechanisms to store and monitor the values in a variety of
@@ -48,12 +48,15 @@
     - ceph
       Statistics from the Ceph distributed storage system.
 
     - cgroups
       CPU accounting information for process groups under Linux.
 
+    - chrony
+      Chrony daemon statistics: Local clock drift, offset to peers, etc.
+
     - conntrack
       Number of nf_conntrack entries.
 
     - contextswitch
       Number of context switches done by the operating system.
 
@@ -61,12 +64,15 @@
       CPU utilization: Time spent in the system, user, nice, idle, and related
       states.
 
     - cpufreq
       CPU frequency (For laptops with speed step or a similar technology)
 
+    - cpusleep
+      CPU sleep: Time spent in suspend (For mobile devices which enter suspend automatically)
+
     - curl
       Parse statistics from websites using regular expressions.
 
     - curl_json
       Retrieves JSON data via cURL and parses it according to user
       configuration.
@@ -116,12 +122,18 @@
     - fscache
       Linux file-system based caching framework statistics.
 
     - gmond
       Receive multicast traffic from Ganglia instances.
 
+    - gps
+      Monitor gps related data through gpsd.
+
+    - grpc
+      Receive values over the network using the gRPC framework.
+
     - hddtemp
       Hard disk temperatures using hddtempd.
 
     - interface
       Interface traffic: Number of octets, packets and errors for each
       interface.
@@ -153,12 +165,18 @@
       System load average over the last 1, 5 and 15 minutes.
 
     - lpar
       Detailed CPU statistics of the “Logical Partitions” virtualization
       technique built into IBM's POWER processors.
 
+    - lua
+      The Lua plugin implements a Lua interpreter into collectd. This
+      makes it possible to write plugins in Lua which are executed by
+      collectd without the need to start a heavy interpreter every interval.
+      See collectd-lua(5) for details.
+
     - lvm
       Size of “Logical Volumes” (LV) and “Volume Groups” (VG) of Linux'
       “Logical Volume Manager” (LVM).
 
     - madwifi
       Queries very detailed usage statistics from wireless LAN adapters and
@@ -188,12 +206,15 @@
       Intel Many Integrated Core (MIC) CPUs.
 
     - modbus
       Reads values from Modbus/TCP enabled devices. Supports reading values
       from multiple "slaves" so gateway devices can be used.
 
+    - mqtt
+      Publishes and subscribes to MQTT topics.
+
     - multimeter
       Information provided by serial multimeters, such as the `Metex
       M-4650CR'.
 
     - mysql
       MySQL server statistics: Commands issued, handlers triggered, thread
@@ -376,18 +397,25 @@
       System resources used by Linux VServers.
       See <http://linux-vserver.org/>.
 
     - wireless
       Link quality of wireless cards. Linux only.
 
+    - xencpu
+      XEN Hypervisor CPU stats.
+
     - xmms
       Bitrate and frequency of music played with XMMS.
 
     - zfs_arc
       Statistics for ZFS' “Adaptive Replacement Cache” (ARC).
 
+    - zone
+      Measures the percentage of cpu load per container (zone) under Solaris 10
+      and higher
+
     - zookeeper
       Read data from Zookeeper's MNTR command.
 
   * Output can be written or sent to various destinations by the following
     plugins:
 
@@ -397,12 +425,16 @@
 
     - csv
       Write to comma separated values (CSV) files. This needs lots of
       diskspace but is extremely portable and can be analysed with almost
       every program that can analyse anything. Even Microsoft's Excel..
 
+    - lua
+      It's possible to implement write plugins in Lua using the Lua
+      plugin. See collectd-lua(5) for details.
+
     - network
       Send the data to a remote host to save the data somehow. This is useful
       for large setups where the data should be saved by a dedicated machine.
 
     - perl
       Of course the values are propagated to plugins written in Perl, too, so
@@ -492,12 +524,15 @@
       See http://www.galago-project.org/specs/notification/.
 
     - notify_email
       Send an E-mail with the notification message to the configured
       recipients.
 
+    - notify_nagios
+      Submit notifications as passive check results to a local nagios instance.
+
     - exec
       Execute a program or script to handle the notification.
       See collectd-exec(5).
 
     - logfile
       Writes the notification message to a file or STDOUT/STDERR.
@@ -666,16 +701,25 @@
     <http://www.stafford.uklinux.net/libesmtp/>
 
   * libganglia (optional)
     Used by the `gmond' plugin to process data received from Ganglia.
     <http://ganglia.info/>
 
+  * libgrpc (optional)
+    Used by the `grpc' plugin. gRPC requires a C++ compiler supporting the
+    C++11 standard.
+    <https://grpc.io/>
+
   * libgcrypt (optional)
     Used by the `network' plugin for encryption and authentication.
     <http://www.gnupg.org/>
 
+  * libgps (optional)
+    Used by the `gps' plugin.
+    <http://developer.berlios.de/projects/gpsd/>
+
   * libhal (optional)
     If present, the `uuid' plugin will check for UUID from HAL.
     <http://hal.freedesktop.org/>
 
   * libi2c-dev (optional)
     Used for the plugin `barometer', provides just the i2c-dev.h header file
@@ -692,12 +736,16 @@
     <http://openjdk.java.net/> (and others)
 
   * libldap (optional)
     Used by the `openldap' plugin.
     <http://www.openldap.org/>
 
+  * liblua (optional)
+    Used by the `lua' plugin. Currently, Lua 5.1 and later are supported.
+    <https://www.lua.org/>
+
   * liblvm2 (optional)
     Used by the `lvm' plugin.
     <ftp://sources.redhat.com/pub/lvm2/>
 
   * libmemcached (optional)
     Used by the `memcachec' plugin to connect to a memcache daemon.
@@ -755,20 +803,24 @@
     <http://www.perl.org/>
 
   * libpq (optional)
     The PostgreSQL C client library used by the `postgresql' plugin.
     <http://www.postgresql.org/>
 
+  * libprotobuf, protoc 3.0+ (optional)
+    Used by the `grpc' plugin to generate service stubs and code to handle
+    network packets of collectd's protobuf-based network protocol.
+    <https://developers.google.com/protocol-buffers/>
+
   * libprotobuf-c, protoc-c (optional)
     Used by the `pinba' plugin to generate a parser for the network packets
-    sent by the Pinba PHP extension, and by the `write_riemann' plugin to
-    generate events to be sent to a Riemann server.
+    sent by the Pinba PHP extension.
     <http://code.google.com/p/protobuf-c/>
 
   * libpython (optional)
-    Used by the `python' plugin. Currently, Python 2.3 and later and Python 3
+    Used by the `python' plugin. Currently, Python 2.6 and later and Python 3
     are supported.
     <http://www.python.org/>
 
   * librabbitmq (optional; also called “rabbitmq-c”)
     Used by the `amqp' plugin for AMQP connections, for example to RabbitMQ.
     <http://hg.rabbitmq.com/rabbitmq-c/>
@@ -820,12 +872,16 @@
 
   * libxml2 (optional)
     Parse XML data. This is needed for the `ascent', `bind', `curl_xml' and
     `virt' plugins.
     <http://xmlsoft.org/>
 
+  * libxen (optional)
+    Used by the `xencpu' plugin.
+    <http://xenbits.xensource.com/>
+
   * libxmms (optional)
     <http://www.xmms.org/>
 
   * libyajl (optional)
     Parse JSON data. This is needed for the `ceph', `curl_json' and
     `log_logstash' plugins.
@@ -833,12 +889,16 @@
 
   * libvarnish (optional)
      Fetches statistics from a Varnish instance. This is needed for the
      `varnish' plugin.
      <http://varnish-cache.org>
 
+  * riemann-c-client (optional)
+     For the `write_riemann' plugin.
+     <https://github.com/algernon/riemann-c-client>
+
 Configuring / Compiling / Installing
 ------------------------------------
 
   To configure, build and install collectd with the default settings, run
   `./configure && make && make install'.  For detailed, generic instructions
   see INSTALL. For a complete list of configure options and their description,
@@ -886,24 +946,25 @@
     - libjvm.so
 
   If found, appropriate CPP-flags and LD-flags are set and the following
   library checks succeed.
 
   If this doesn't work for you, you have the possibility to specify CPP-flags,
-  C-flags and LD-flags for the ‘Java’ plugin by hand, using the following three
-  (environment) variables:
+  C-flags, LD-flags and LIBS for the ‘Java’ plugin by hand, using the
+  following environment variables:
 
     - JAVA_CPPFLAGS
     - JAVA_CFLAGS
     - JAVA_LDFLAGS
+    - JAVA_LIBS
 
   For example (shortened for demonstration purposes):
 
     ./configure JAVA_CPPFLAGS="-I$JAVA_HOME/include -I$JAVA_HOME/include/linux"
 
-  Adding "-ljvm" to the JAVA_LDFLAGS is done automatically, you don't have to
+  Adding "-ljvm" to JAVA_LIBS is done automatically, you don't have to
   do that.
 
 Generating the configure script
 -------------------------------
 
 Collectd ships with a `build.sh' script to generate the `configure'
@@ -914,12 +975,13 @@
 - autoconf
 - automake
 - flex
 - bison
 - libtool
 - libtool-ltdl
+- pkg-config
 
 The `build.sh' script takes no arguments.
 
 Crosscompiling
 --------------
 
@@ -966,9 +1028,8 @@
 ------
 
   Florian octo Forster <octo at collectd.org>,
   Sebastian tokkee Harl <sh at tokkee.org>,
   and many contributors (see `AUTHORS').
 
-  Please send bug reports and patches to the mailing list, see `Contact'
-  above.
-
+  Please use GitHub reporting bugs and submitting pull requests.
+  See CONTRIBUTING.md for details.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/aggregation.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/aggregation.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/aggregation.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/aggregation.c	2016-09-11 16:10:25.251038738 +0800
@@ -23,17 +23,14 @@
  * Authors:
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
 
-#include <pthread.h>
-
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "meta_data.h"
 #include "utils_cache.h" /* for uc_get_rate() */
 #include "utils_subst.h"
 #include "utils_vl_lookup.h"
 
 #define AGG_MATCHES_ALL(str) (strcmp ("/.*/", str) == 0)
@@ -237,39 +234,37 @@
     value_list_t const *vl, aggregation_t *agg)
 {
   agg_instance_t *inst;
 
   DEBUG ("aggregation plugin: Creating new instance.");
 
-  inst = malloc (sizeof (*inst));
+  inst = calloc (1, sizeof (*inst));
   if (inst == NULL)
   {
-    ERROR ("aggregation plugin: malloc() failed.");
+    ERROR ("aggregation plugin: calloc() failed.");
     return (NULL);
   }
-  memset (inst, 0, sizeof (*inst));
   pthread_mutex_init (&inst->lock, /* attr = */ NULL);
 
   inst->ds_type = ds->ds[0].type;
 
   agg_instance_create_name (inst, vl, agg);
 
   inst->min = NAN;
   inst->max = NAN;
 
 #define INIT_STATE(field) do { \
   inst->state_ ## field = NULL; \
   if (agg->calc_ ## field) { \
-    inst->state_ ## field = malloc (sizeof (*inst->state_ ## field)); \
+    inst->state_ ## field = calloc (1, sizeof (*inst->state_ ## field)); \
     if (inst->state_ ## field == NULL) { \
       agg_instance_destroy (inst); \
       free (inst); \
-      ERROR ("aggregation plugin: malloc() failed."); \
+      ERROR ("aggregation plugin: calloc() failed."); \
       return (NULL); \
     } \
-    memset (inst->state_ ## field, 0, sizeof (*inst->state_ ## field)); \
   } \
 } while (0)
 
   INIT_STATE (num);
   INIT_STATE (sum);
   INIT_STATE (average);
@@ -347,13 +342,12 @@
   if (pi_prefix[0] != 0)
     subst_string (vl->plugin_instance, sizeof (vl->plugin_instance),
         pi_prefix, AGG_FUNC_PLACEHOLDER, func);
   else
     sstrncpy (vl->plugin_instance, func, sizeof (vl->plugin_instance));
 
-  memset (&v, 0, sizeof (v));
   status = rate_to_value (&v, rate, state, inst->ds_type, t);
   if (status != 0)
   {
     /* If this is the first iteration and rate_to_value() was asked to return a
      * COUNTER or a DERIVE, it will return EAGAIN. Catch this and handle
      * gracefully. */
@@ -485,15 +479,13 @@
  *   </Aggregation>
  * </Plugin>
  */
 static int agg_config_handle_group_by (oconfig_item_t const *ci, /* {{{ */
     aggregation_t *agg)
 {
-  int i;
-
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     char const *value;
 
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       ERROR ("aggregation plugin: Argument %i of the \"GroupBy\" option "
@@ -523,31 +515,29 @@
 
 static int agg_config_aggregation (oconfig_item_t *ci) /* {{{ */
 {
   aggregation_t *agg;
   _Bool is_valid;
   int status;
-  int i;
 
-  agg = malloc (sizeof (*agg));
+  agg = calloc (1, sizeof (*agg));
   if (agg == NULL)
   {
-    ERROR ("aggregation plugin: malloc failed.");
+    ERROR ("aggregation plugin: calloc failed.");
     return (-1);
   }
-  memset (agg, 0, sizeof (*agg));
 
   sstrncpy (agg->ident.host, "/.*/", sizeof (agg->ident.host));
   sstrncpy (agg->ident.plugin, "/.*/", sizeof (agg->ident.plugin));
   sstrncpy (agg->ident.plugin_instance, "/.*/",
       sizeof (agg->ident.plugin_instance));
   sstrncpy (agg->ident.type, "/.*/", sizeof (agg->ident.type));
   sstrncpy (agg->ident.type_instance, "/.*/",
       sizeof (agg->ident.type_instance));
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       cf_util_get_string_buffer (child, agg->ident.host,
           sizeof (agg->ident.host));
@@ -679,14 +669,12 @@
       agg->ident.type, agg->ident.type_instance);
   return (0);
 } /* }}} int agg_config_aggregation */
 
 static int agg_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
   pthread_mutex_lock (&agg_instance_list_lock);
 
   if (lookup == NULL)
   {
     lookup = lookup_create (agg_lookup_class_callback,
         agg_lookup_obj_callback,
@@ -697,13 +685,13 @@
       pthread_mutex_unlock (&agg_instance_list_lock);
       ERROR ("aggregation plugin: lookup_create failed.");
       return (-1);
     }
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Aggregation", child->key) == 0)
       agg_config_aggregation (child);
     else
@@ -715,13 +703,12 @@
 
   return (0);
 } /* }}} int agg_config */
 
 static int agg_read (void) /* {{{ */
 {
-  agg_instance_t *this;
   cdtime_t t;
   int success;
 
   t = cdtime ();
   success = 0;
 
@@ -736,13 +723,13 @@
   if (agg_instance_list_head == NULL)
   {
     pthread_mutex_unlock (&agg_instance_list_lock);
     return (0);
   }
 
-  for (this = agg_instance_list_head; this != NULL; this = this->next)
+  for (agg_instance_t *this = agg_instance_list_head; this != NULL; this = this->next)
   {
     int status;
 
     status = agg_instance_read (this, t);
     if (status != 0)
       WARNING ("aggregation plugin: Reading an aggregation instance "
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/amqp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/amqp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/amqp.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/amqp.c	2016-09-11 16:10:25.251038738 +0800
@@ -30,14 +31,12 @@
 #include "common.h"
 #include "plugin.h"
 #include "utils_cmd_putval.h"
 #include "utils_format_json.h"
 #include "utils_format_graphite.h"
 
-#include <pthread.h>
-
 #include <amqp.h>
 #include <amqp_framing.h>
 
 #ifdef HAVE_AMQP_TCP_SOCKET_H
 # include <amqp_tcp_socket.h>
 #endif
@@ -526,19 +525,17 @@
         return (camqp_setup_queue (conf));
     return (0);
 } /* }}} int camqp_connect */
 
 static int camqp_shutdown (void) /* {{{ */
 {
-    size_t i;
-
     DEBUG ("amqp plugin: Shutting down %zu subscriber threads.",
             subscriber_threads_num);
 
     subscriber_threads_running = 0;
-    for (i = 0; i < subscriber_threads_num; i++)
+    for (size_t i = 0; i < subscriber_threads_num; i++)
     {
         /* FIXME: Sending a signal is not very elegant here. Maybe find out how
          * to use a timeout in the thread and check for the variable in regular
          * intervals. */
         pthread_kill (subscriber_threads[i], SIGTERM);
         pthread_join (subscriber_threads[i], /* retval = */ NULL);
@@ -733,13 +730,13 @@
 
     tmp = realloc (subscriber_threads,
             sizeof (*subscriber_threads) * (subscriber_threads_num + 1));
     if (tmp == NULL)
     {
         ERROR ("amqp plugin: realloc failed.");
-        camqp_config_free (conf);
+        sfree (subscriber_threads);
         return (ENOMEM);
     }
     subscriber_threads = tmp;
     tmp = subscriber_threads + subscriber_threads_num;
     memset (tmp, 0, sizeof (*tmp));
 
@@ -747,13 +744,12 @@
             camqp_subscribe_thread, conf);
     if (status != 0)
     {
         char errbuf[1024];
         ERROR ("amqp plugin: pthread_create failed: %s",
                 sstrerror (status, errbuf, sizeof (errbuf)));
-        camqp_config_free (conf);
         return (status);
     }
 
     subscriber_threads_num++;
 
     return (0);
@@ -763,33 +759,34 @@
  * Publishing code
  */
 /* XXX: You must hold "conf->lock" when calling this function! */
 static int camqp_write_locked (camqp_config_t *conf, /* {{{ */
         const char *buffer, const char *routing_key)
 {
-    amqp_basic_properties_t props;
     int status;
 
     status = camqp_connect (conf);
     if (status != 0)
         return (status);
 
-    memset (&props, 0, sizeof (props));
-    props._flags = AMQP_BASIC_CONTENT_TYPE_FLAG
-        | AMQP_BASIC_DELIVERY_MODE_FLAG
-        | AMQP_BASIC_APP_ID_FLAG;
+    amqp_basic_properties_t props = {
+        ._flags = AMQP_BASIC_CONTENT_TYPE_FLAG
+            | AMQP_BASIC_DELIVERY_MODE_FLAG
+            | AMQP_BASIC_APP_ID_FLAG,
+        .delivery_mode = conf->delivery_mode,
+        .app_id = amqp_cstring_bytes("collectd")
+    };
+
     if (conf->format == CAMQP_FORMAT_COMMAND)
         props.content_type = amqp_cstring_bytes("text/collectd");
     else if (conf->format == CAMQP_FORMAT_JSON)
         props.content_type = amqp_cstring_bytes("application/json");
     else if (conf->format == CAMQP_FORMAT_GRAPHITE)
         props.content_type = amqp_cstring_bytes("text/graphite");
     else
         assert (23 == 42);
-    props.delivery_mode = conf->delivery_mode;
-    props.app_id = amqp_cstring_bytes("collectd");
 
     status = amqp_basic_publish(conf->connection,
                 /* channel = */ 1,
                 amqp_cstring_bytes(CONF(conf, exchange)),
                 amqp_cstring_bytes (routing_key),
                 /* mandatory = */ 0,
@@ -814,29 +811,26 @@
     char buffer[8192];
     int status;
 
     if ((ds == NULL) || (vl == NULL) || (conf == NULL))
         return (EINVAL);
 
-    memset (buffer, 0, sizeof (buffer));
-
     if (conf->routing_key != NULL)
     {
         sstrncpy (routing_key, conf->routing_key, sizeof (routing_key));
     }
     else
     {
-        size_t i;
         ssnprintf (routing_key, sizeof (routing_key), "collectd/%s/%s/%s/%s/%s",
                 vl->host,
                 vl->plugin, vl->plugin_instance,
                 vl->type, vl->type_instance);
 
         /* Switch slashes (the only character forbidden by collectd) and dots
          * (the separation character used by AMQP). */
-        for (i = 0; routing_key[i] != 0; i++)
+        for (size_t i = 0; routing_key[i] != 0; i++)
         {
             if (routing_key[i] == '.')
                 routing_key[i] = '/';
             else if (routing_key[i] == '/')
                 routing_key[i] = '.';
         }
@@ -920,23 +914,21 @@
 
 static int camqp_config_connection (oconfig_item_t *ci, /* {{{ */
         _Bool publish)
 {
     camqp_config_t *conf;
     int status;
-    int i;
 
-    conf = malloc (sizeof (*conf));
+    conf = calloc (1, sizeof (*conf));
     if (conf == NULL)
     {
-        ERROR ("amqp plugin: malloc failed.");
+        ERROR ("amqp plugin: calloc failed.");
         return (ENOMEM);
     }
 
     /* Initialize "conf" {{{ */
-    memset (conf, 0, sizeof (*conf));
     conf->publish = publish;
     conf->name = NULL;
     conf->format = CAMQP_FORMAT_COMMAND;
     conf->host = NULL;
     conf->port = 5672;
     conf->vhost = NULL;
@@ -968,13 +960,13 @@
     if (status != 0)
     {
         sfree (conf);
         return (status);
     }
 
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp ("Host", child->key) == 0)
             status = cf_util_get_string (child, &conf->host);
         else if (strcasecmp ("Port", child->key) == 0)
@@ -1101,15 +1093,13 @@
 
     return (0);
 } /* }}} int camqp_config_connection */
 
 static int camqp_config (oconfig_item_t *ci) /* {{{ */
 {
-    int i;
-
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp ("Publish", child->key) == 0)
             camqp_config_connection (child, /* publish = */ 1);
         else if (strcasecmp ("Subscribe", child->key) == 0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apache.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apache.c	2016-09-11 16:10:25.251038738 +0800
@@ -22,15 +22,15 @@
  *   Florent EppO Monbillard <eppo at darox.net>
  *   - connections/lighttpd extension
  *   Amit Gupta <amit.gupta221 at gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <curl/curl.h>
 
 enum server_enum
 {
 	APACHE = 0,
@@ -60,14 +60,16 @@
 
 typedef struct apache_s apache_t;
 
 /* TODO: Remove this prototype */
 static int apache_read_host (user_data_t *user_data);
 
-static void apache_free (apache_t *st)
+static void apache_free (void *arg)
 {
+	apache_t *st = arg;
+
 	if (st == NULL)
 		return;
 
 	sfree (st->name);
 	sfree (st->host);
 	sfree (st->url);
@@ -95,20 +97,20 @@
 	{
 		ERROR ("apache plugin: apache_curl_callback: "
 				"user_data pointer is NULL.");
 		return (0);
 	}
 
-	if (len <= 0)
+	if (len == 0)
 		return (len);
 
 	if ((st->apache_buffer_fill + len) >= st->apache_buffer_size)
 	{
 		char *temp;
 
-		temp = (char *) realloc (st->apache_buffer,
+		temp = realloc (st->apache_buffer,
 				st->apache_buffer_fill + len + 1);
 		if (temp == NULL)
 		{
 			ERROR ("apache plugin: realloc failed.");
 			return (0);
 		}
@@ -134,13 +136,13 @@
 	{
 		ERROR ("apache plugin: apache_header_callback: "
 				"user_data pointer is NULL.");
 		return (0);
 	}
 
-	if (len <= 0)
+	if (len == 0)
 		return (len);
 
 	/* look for the Server header */
 	if (strncasecmp (buf, "Server: ", strlen ("Server: ")) != 0)
 		return (len);
 
@@ -169,34 +171,32 @@
  *   URL ...
  * </Plugin>
  */
 static int config_add (oconfig_item_t *ci)
 {
 	apache_t *st;
-	int i;
 	int status;
 
-	st = malloc (sizeof (*st));
+	st = calloc (1, sizeof (*st));
 	if (st == NULL)
 	{
-		ERROR ("apache plugin: malloc failed.");
+		ERROR ("apache plugin: calloc failed.");
 		return (-1);
 	}
-	memset (st, 0, sizeof (*st));
 
 	st->timeout = -1;
 
 	status = cf_util_get_string (ci, &st->name);
 	if (status != 0)
 	{
 		sfree (st);
 		return (status);
 	}
 	assert (st->name != NULL);
 
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("URL", child->key) == 0)
 			status = cf_util_get_string (child, &st->url);
 		else if (strcasecmp ("Host", child->key) == 0)
@@ -236,29 +236,28 @@
 				st->name);
 		status = -1;
 	}
 
 	if (status == 0)
 	{
-		user_data_t ud;
-		char callback_name[3*DATA_MAX_NAME_LEN];
+		user_data_t ud = {
+			.data = st,
+			.free_func = apache_free
+		};
 
-		memset (&ud, 0, sizeof (ud));
-		ud.data = st;
-		ud.free_func = (void *) apache_free;
+		char callback_name[3*DATA_MAX_NAME_LEN];
 
-		memset (callback_name, 0, sizeof (callback_name));
 		ssnprintf (callback_name, sizeof (callback_name),
 				"apache/%s/%s",
 				(st->host != NULL) ? st->host : hostname_g,
-				(st->name != NULL) ? st->name : "default");
+				(st->name != NULL) ? st->name : "default"),
 
 		status = plugin_register_complex_read (/* group = */ NULL,
 				/* name      = */ callback_name,
 				/* callback  = */ apache_read_host,
-				/* interval  = */ NULL,
+				/* interval  = */ 0,
 				/* user_data = */ &ud);
 	}
 
 	if (status != 0)
 	{
 		apache_free (st);
@@ -268,15 +267,14 @@
 	return (0);
 } /* int config_add */
 
 static int config (oconfig_item_t *ci)
 {
 	int status = 0;
-	int i;
 
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Instance", child->key) == 0)
 			config_add (child);
 		else
@@ -380,14 +378,13 @@
 		curl_easy_setopt (st->curl, CURLOPT_SSL_CIPHER_LIST,st->ssl_ciphers);
 
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
 	if (st->timeout >= 0)
 		curl_easy_setopt (st->curl, CURLOPT_TIMEOUT_MS, (long) st->timeout);
 	else
-		curl_easy_setopt (st->curl, CURLOPT_TIMEOUT_MS,
-				CDTIME_T_TO_MS(plugin_get_interval()));
+		curl_easy_setopt (st->curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
 	return (0);
 } /* }}} int init_host */
 
 static void submit_value (const char *type, const char *type_instance,
@@ -462,14 +459,13 @@
 	long long handle_request = 0LL;
 	long long request_start  = 0LL;
 	long long request_end    = 0LL;
 	long long response_start = 0LL;
 	long long response_end   = 0LL;
 
-	int i;
-	for (i = 0; buf[i] != '\0'; i++)
+	for (int i = 0; buf[i] != '\0'; i++)
 	{
 		if (buf[i] == '.') open++;
 		else if (buf[i] == '_') waiting++;
 		else if (buf[i] == 'S') starting++;
 		else if (buf[i] == 'R') reading++;
 		else if (buf[i] == 'W') sending++;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apcups.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apcups.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apcups.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apcups.c	2016-09-11 16:10:25.251038738 +0800
@@ -1,9 +1,9 @@
 /*
  * collectd - src/apcups.c
- * Copyright (C) 2006-2012  Florian octo Forster
+ * Copyright (C) 2006-2015  Florian octo Forster
  * Copyright (C) 2006       Anthony Gialluca <tonyabg at charter.net>
  * Copyright (C) 2000-2004  Kern Sibbald
  * Copyright (C) 1996-1999  Andre M. Hedrick <andre at suse.com>
  *
  * This program is free software; you can redistribute it and/or
  * modify it under the terms of version 2 of the GNU General
@@ -22,82 +22,77 @@
  * Authors:
  *   Anthony Gialluca <tonyabg at charter.net>
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"      /* rrd_update_file */
 #include "plugin.h"      /* plugin_register, plugin_submit */
-#include "configfile.h"  /* cf_register */
 
 #if HAVE_SYS_TYPES_H
 # include <sys/types.h>
 #endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NETDB_H
 # include <netdb.h>
 #endif
 
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
 
-#define NISPORT 3551
-#define MAXSTRING               256
-#define MODULE_NAME "apcups"
+#ifndef APCUPS_SERVER_TIMEOUT
+# define APCUPS_SERVER_TIMEOUT 15.0
+#endif
 
-#define APCUPS_DEFAULT_HOST "localhost"
+#ifndef APCUPS_DEFAULT_NODE
+# define APCUPS_DEFAULT_NODE "localhost"
+#endif
+
+#ifndef APCUPS_DEFAULT_SERVICE
+# define APCUPS_DEFAULT_SERVICE "3551"
+#endif
 
 /*
  * Private data types
  */
-typedef struct
+struct apc_detail_s
 {
-	gauge_t linev;
-	gauge_t loadpct;
-	gauge_t bcharge;
-	gauge_t timeleft;
-	gauge_t outputv;
-	gauge_t itemp;
-	gauge_t battv;
-	gauge_t linefreq;
-} apc_detail_t;
+	double linev;
+	double loadpct;
+	double bcharge;
+	double timeleft;
+	double outputv;
+	double itemp;
+	double battv;
+	double linefreq;
+};
 
 /*
  * Private variables
  */
 /* Default values for contacting daemon */
-static char *conf_host = NULL;
-static int   conf_port = NISPORT;
+static char *conf_node = NULL;
+static char *conf_service = NULL;
 /* Defaults to false for backwards compatibility. */
 static _Bool conf_report_seconds = 0;
+static _Bool conf_persistent_conn = 1;
 
 static int global_sockfd = -1;
 
 static int count_retries = 0;
 static int count_iterations = 0;
-static _Bool close_socket = 0;
-
-static const char *config_keys[] =
-{
-	"Host",
-	"Port",
-	"ReportSeconds"
-};
-static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static int net_shutdown (int *fd)
 {
 	uint16_t packet_size = 0;
 
 	if ((fd == NULL) || (*fd < 0))
 		return (EINVAL);
 
-	swrite (*fd, (void *) &packet_size, sizeof (packet_size));
+	(void)swrite (*fd, (void *) &packet_size, sizeof (packet_size));
 	close (*fd);
 	*fd = -1;
 
 	return (0);
 } /* int net_shutdown */
 
@@ -113,32 +108,26 @@
 
 /*
  * Open a TCP connection to the UPS network server
  * Returns -1 on error
  * Returns socket file descriptor otherwise
  */
-static int net_open (char *host, int port)
+static int net_open (char const *node, char const *service)
 {
 	int              sd;
 	int              status;
-	char             port_str[8];
-	struct addrinfo  ai_hints;
 	struct addrinfo *ai_return;
 	struct addrinfo *ai_list;
 
-	assert ((port > 0x00000000) && (port <= 0x0000FFFF));
-
-	/* Convert the port to a string */
-	ssnprintf (port_str, sizeof (port_str), "%i", port);
-
-	/* Resolve name */
-	memset ((void *) &ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_family   = AF_INET; /* XXX: Change this to `AF_UNSPEC' if apcupsd can handle IPv6 */
-	ai_hints.ai_socktype = SOCK_STREAM;
+	/* TODO: Change this to `AF_UNSPEC' if apcupsd can handle IPv6 */
+	struct addrinfo ai_hints = {
+		.ai_family = AF_INET,
+		.ai_socktype = SOCK_STREAM
+	};
 
-	status = getaddrinfo (host, port_str, &ai_hints, &ai_return);
+	status = getaddrinfo (node, service, &ai_hints, &ai_return);
 	if (status != 0)
 	{
 		char errbuf[1024];
 		INFO ("apcups plugin: getaddrinfo failed: %s",
 				(status == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
@@ -176,13 +165,13 @@
 		return (-1);
 	}
 
 	DEBUG ("apcups plugin: Done opening a socket %i", sd);
 
 	return (sd);
-} /* int net_open (char *host, char *service, int port) */
+} /* int net_open */
 
 /*
  * Receive a message from the other end. Each message consists of
  * two packets. The first is a header that contains the size
  * of the data that follows in the second packet.
  * Returns number of bytes read
@@ -231,13 +220,13 @@
  * Send a message over the network. The send consists of
  * two network packets. The first is sends a short containing
  * the length of the data packet which follows.
  * Returns zero on success
  * Returns non-zero on error
  */
-static int net_send (int *sockfd, char *buff, int len)
+static int net_send (int *sockfd, const char *buff, int len)
 {
 	uint16_t packet_size;
 
 	assert (len > 0);
 	assert (*sockfd >= 0);
 
@@ -260,19 +249,21 @@
 	}
 
 	return (0);
 }
 
 /* Get and print status from apcupsd NIS server */
-static int apc_query_server (char *host, int port,
-		apc_detail_t *apcups_detail)
+static int apc_query_server (char const *node, char const *service,
+		struct apc_detail_s *apcups_detail)
 {
 	int     n;
 	char    recvline[1024];
 	char   *tokptr;
 	char   *toksaveptr;
+	char   *key;
+	double  value;
 	_Bool retry = 1;
 	int status;
 
 #if APCMAIN
 # define PRINT_VALUE(name, val) printf("  Found property: name = %s; value = %f;\n", name, val)
 #else
@@ -280,13 +271,13 @@
 #endif
 
 	while (retry)
 	{
 		if (global_sockfd < 0)
 		{
-			global_sockfd = net_open (host, port);
+			global_sockfd = net_open (node, service);
 			if (global_sockfd < 0)
 			{
 				ERROR ("apcups plugin: Connecting to the "
 						"apcupsd failed.");
 				return (-1);
 			}
@@ -320,34 +311,31 @@
 	if ((count_iterations == 10) && (count_retries > 2))
 	{
 		NOTICE ("apcups plugin: There have been %i retries in the "
 				"first %i iterations. Will close the socket "
 				"in future iterations.",
 				count_retries, count_iterations);
-		close_socket = 1;
+		conf_persistent_conn = 0;
 	}
 
 	while ((n = net_recv (&global_sockfd, recvline, sizeof (recvline) - 1)) > 0)
 	{
-		assert ((unsigned int)n < sizeof (recvline));
-		recvline[n] = '\0';
+		assert ((size_t)n < sizeof (recvline));
+		recvline[n] = 0;
 #if APCMAIN
 		printf ("net_recv = `%s';\n", recvline);
 #endif /* if APCMAIN */
 
 		toksaveptr = NULL;
 		tokptr = strtok_r (recvline, " :\t", &toksaveptr);
 		while (tokptr != NULL)
 		{
-			char *key = tokptr;
+			key = tokptr;
 			if ((tokptr = strtok_r (NULL, " :\t", &toksaveptr)) == NULL)
 				continue;
-
-			gauge_t value;
-			if (strtogauge (tokptr, &value) != 0)
-				continue;
+			value = atof (tokptr);
 
 			PRINT_VALUE (key, value);
 
 			if (strcmp ("LINEV", key) == 0)
 				apcups_detail->linev = value;
 			else if (strcmp ("BATTV", key) == 0)
@@ -373,13 +361,13 @@
 
 			tokptr = strtok_r (NULL, ":", &toksaveptr);
 		} /* while (tokptr != NULL) */
 	}
 	status = errno; /* save errno, net_shutdown() may re-set it. */
 
-	if (close_socket)
+	if (!conf_persistent_conn)
 		net_shutdown (&global_sockfd);
 
 	if (n < 0)
 	{
 		char errbuf[1024];
 		ERROR ("apcups plugin: Reading from socket failed: %s",
@@ -387,56 +375,53 @@
 		return (-1);
 	}
 
 	return (0);
 }
 
-static int apcups_config (const char *key, const char *value)
+static int apcups_config (oconfig_item_t *ci)
 {
-	if (strcasecmp (key, "host") == 0)
-	{
-		if (conf_host != NULL)
-		{
-			free (conf_host);
-			conf_host = NULL;
-		}
-		if ((conf_host = strdup (value)) == NULL)
-			return (1);
-	}
-	else if (strcasecmp (key, "Port") == 0)
+	_Bool persistent_conn_set = 0;
+
+	for (int i = 0; i < ci->children_num; i++)
 	{
-		int port_tmp = atoi (value);
-		if (port_tmp < 1 || port_tmp > 65535)
-		{
-			WARNING ("apcups plugin: Invalid port: %i", port_tmp);
-			return (1);
+		oconfig_item_t *child = ci->children + i;
+
+		if (strcasecmp (child->key, "Host") == 0)
+			cf_util_get_string (child, &conf_node);
+		else if (strcasecmp (child->key, "Port") == 0)
+			cf_util_get_service (child, &conf_service);
+		else if (strcasecmp (child->key, "ReportSeconds") == 0)
+			cf_util_get_boolean (child, &conf_report_seconds);
+		else if (strcasecmp (child->key, "PersistentConnection") == 0) {
+			cf_util_get_boolean (child, &conf_persistent_conn);
+			persistent_conn_set = 1;
 		}
-		conf_port = port_tmp;
-	}
-	else if (strcasecmp (key, "ReportSeconds") == 0)
-	{
-		if (IS_TRUE (value))
-			conf_report_seconds = 1;
 		else
-			conf_report_seconds = 0;
+			ERROR ("apcups plugin: Unknown config option \"%s\".", child->key);
 	}
-	else
-	{
-		return (-1);
+
+	if (!persistent_conn_set) {
+		double interval = CDTIME_T_TO_DOUBLE(plugin_get_interval());
+		if (interval > APCUPS_SERVER_TIMEOUT) {
+			NOTICE ("apcups plugin: Plugin poll interval set to %.3f seconds. "
+				"Apcupsd NIS socket timeout is %.3f seconds, "
+				"PersistentConnection disabled by default.",
+				interval, APCUPS_SERVER_TIMEOUT);
+			conf_persistent_conn = 0;
+		}
 	}
+
 	return (0);
-}
+} /* int apcups_config */
 
-static void apc_submit_generic (char *type, char *type_inst, gauge_t value)
+static void apc_submit_generic (const char *type, const char *type_inst, double value)
 {
 	value_t values[1];
 	value_list_t vl = VALUE_LIST_INIT;
 
-	if (isnan (value))
-		return;
-
 	values[0].gauge = value;
 
 	vl.values = values;
 	vl.values_len = 1;
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "apcups", sizeof (vl.plugin));
@@ -444,13 +429,13 @@
 	sstrncpy (vl.type, type, sizeof (vl.type));
 	sstrncpy (vl.type_instance, type_inst, sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 }
 
-static void apc_submit (apc_detail_t const *apcups_detail)
+static void apc_submit (struct apc_detail_s *apcups_detail)
 {
 	apc_submit_generic ("voltage",    "input",   apcups_detail->linev);
 	apc_submit_generic ("voltage",    "output",  apcups_detail->outputv);
 	apc_submit_generic ("voltage",    "battery", apcups_detail->battv);
 	apc_submit_generic ("charge",     "",        apcups_detail->bcharge);
 	apc_submit_generic ("percent",    "load",    apcups_detail->loadpct);
@@ -458,41 +443,46 @@
 	apc_submit_generic ("temperature", "",       apcups_detail->itemp);
 	apc_submit_generic ("frequency",  "input",   apcups_detail->linefreq);
 }
 
 static int apcups_read (void)
 {
-	apc_detail_t apcups_detail = {
-		.linev    = NAN,
-		.outputv  = NAN,
-		.battv    = NAN,
-		.loadpct  = NAN,
-		.bcharge  = NAN,
-		.timeleft = NAN,
-		.itemp    = NAN,
-		.linefreq = NAN,
-	};
+	struct apc_detail_s apcups_detail;
+	int status;
 
-	int status = apc_query_server (conf_host == NULL
-			? APCUPS_DEFAULT_HOST
-			: conf_host,
-			conf_port, &apcups_detail);
+	apcups_detail.linev    =   -1.0;
+	apcups_detail.outputv  =   -1.0;
+	apcups_detail.battv    =   -1.0;
+	apcups_detail.loadpct  =   -1.0;
+	apcups_detail.bcharge  =   -1.0;
+	apcups_detail.timeleft =    NAN;
+	apcups_detail.itemp    = -300.0;
+	apcups_detail.linefreq =   -1.0;
+
+	status = apc_query_server ((conf_node == NULL) ? APCUPS_DEFAULT_NODE : conf_node,
+			(conf_service == NULL) ? APCUPS_DEFAULT_SERVICE : conf_service,
+			&apcups_detail);
+
+	/*
+	 * if we did not connect then do not bother submitting
+	 * zeros. We want rrd files to have NAN.
+	 */
 	if (status != 0)
 	{
-		DEBUG ("apcups plugin: apc_query_server (%s, %i) = %i",
-				conf_host == NULL ? APCUPS_DEFAULT_HOST : conf_host,
-				conf_port, status);
-		return (status);
+		DEBUG ("apcups plugin: apc_query_server (%s, %s) = %i",
+				(conf_node == NULL) ? APCUPS_DEFAULT_NODE : conf_node,
+				(conf_service == NULL) ? APCUPS_DEFAULT_SERVICE : conf_service,
+				status);
+		return (-1);
 	}
 
 	apc_submit (&apcups_detail);
 
 	return (0);
 } /* apcups_read */
 
 void module_register (void)
 {
-	plugin_register_config ("apcups", apcups_config, config_keys,
-			config_keys_num);
+	plugin_register_complex_config ("apcups", apcups_config);
 	plugin_register_read ("apcups", apcups_read);
 	plugin_register_shutdown ("apcups", apcups_shutdown);
 } /* void module_register */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apple_sensors.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apple_sensors.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/apple_sensors.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/apple_sensors.c	2016-09-11 16:10:25.251038738 +0800
@@ -56,13 +57,13 @@
 
 static mach_port_t io_master_port = MACH_PORT_NULL;
 
 static int as_init (void)
 {
 	kern_return_t status;
-	
+
 	if (io_master_port != MACH_PORT_NULL)
 	{
 		mach_port_deallocate (mach_task_self (),
 				io_master_port);
 		io_master_port = MACH_PORT_NULL;
 	}
@@ -110,14 +111,12 @@
 	CFTypeRef       property;
 
 	char   type[128];
 	char   inst[128];
 	int    value_int;
 	double value_double;
-	int    i;
-
 	if (!io_master_port || (io_master_port == MACH_PORT_NULL))
 		return (-1);
 
 	status = IOServiceGetMatchingServices (io_master_port,
 		       	IOServiceNameMatching("IOHWSensor"),
 		       	&iterator);
@@ -166,13 +165,13 @@
 			continue;
 		if (!CFStringGetCString (property,
 					inst, sizeof (inst),
 					kCFStringEncodingASCII))
 			continue;
 		inst[sizeof (inst) - 1] = '\0';
-		for (i = 0; i < 128; i++)
+		for (int i = 0; i < 128; i++)
 		{
 			if (inst[i] == '\0')
 				break;
 			else if (isalnum (inst[i]))
 				inst[i] = (char) tolower (inst[i]);
 			else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/aquaero.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/aquaero.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/aquaero.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/aquaero.c	2016-09-11 16:10:25.251038738 +0800
@@ -30,15 +31,13 @@
  */
 /* Default values for contacting daemon */
 static char *conf_device = NULL;
 
 static int aquaero_config (oconfig_item_t *ci)
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Device", child->key))
 			cf_util_get_string (child, &conf_device);
 		else
@@ -84,15 +83,14 @@
 
 /* aquaero_submit_array submits every value of a given array of values */
 static void aquaero_submit_array (const char *type,
 		const char *type_instance_prefix, double *value_array, int len)
 {
 	char type_instance[DATA_MAX_NAME_LEN];
-	int i;
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		if (value_array[i] == AQ5_FLOAT_UNDEF)
 			continue;
 
 		snprintf (type_instance, sizeof (type_instance), "%s%d",
 				type_instance_prefix, i + 1);
@@ -103,13 +101,12 @@
 static int aquaero_read (void)
 {
 	aq5_data_t aq_data;
 	aq5_settings_t aq_sett;
 	char *err_msg = NULL;
 	char type_instance[DATA_MAX_NAME_LEN];
-	int i;
 
 	if (libaquaero5_poll(conf_device, &aq_data, &err_msg) < 0)
 	{
 		char errbuf[1024];
 		ERROR ("aquaero plugin: Failed to poll device \"%s\": %s (%s)",
 				conf_device ? conf_device : "default", err_msg,
@@ -144,13 +141,13 @@
 
 	/* Other temperature sensors */
 	aquaero_submit_array("temperature", "other", aq_data.otemp,
 			AQ5_NUM_OTHER_SENSORS);
 
 	/* Fans */
-	for (i = 0; i < AQ5_NUM_FAN; i++)
+	for (int i = 0; i < AQ5_NUM_FAN; i++)
 	{
 		if ((aq_sett.fan_data_source[i] == NONE)
 				|| (aq_data.fan_vrm_temp[i] != AQ5_FLOAT_UNDEF))
 			continue;
 
 		snprintf (type_instance, sizeof (type_instance),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ascent.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ascent.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ascent.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ascent.c	2016-09-11 16:10:25.251038738 +0800
@@ -22,20 +22,20 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <curl/curl.h>
 #include <libxml/parser.h>
 
-static char *races_list[] = /* {{{ */
+static const char *races_list[] = /* {{{ */
 {
   NULL,
   "Human",    /*  1 */
   "Orc",      /*  2 */
   "Dwarf",    /*  3 */
   "Nightelf", /*  4 */
@@ -46,13 +46,13 @@
   NULL,
   "Bloodelf", /* 10 */
   "Draenei"   /* 11 */
 }; /* }}} */
 #define RACES_LIST_LENGTH STATIC_ARRAY_SIZE (races_list)
 
-static char *classes_list[] = /* {{{ */
+static const char *classes_list[] = /* {{{ */
 {
   NULL,
   "Warrior", /*  1 */
   "Paladin", /*  2 */
   "Hunter",  /*  3 */
   "Rogue",   /*  4 */
@@ -63,13 +63,13 @@
   "Warlock", /*  9 */
   NULL,
   "Druid"    /* 11 */
 }; /* }}} */
 #define CLASSES_LIST_LENGTH STATIC_ARRAY_SIZE (classes_list)
 
-static char *genders_list[] = /* {{{ */
+static const char *genders_list[] = /* {{{ */
 {
   "Male",
   "Female"
 }; /* }}} */
 #define GENDERS_LIST_LENGTH STATIC_ARRAY_SIZE (genders_list)
 
@@ -151,20 +151,20 @@
 
 static size_t ascent_curl_callback (void *buf, size_t size, size_t nmemb, /* {{{ */
     void __attribute__((unused)) *stream)
 {
   size_t len = size * nmemb;
 
-  if (len <= 0)
+  if (len == 0)
     return (len);
 
   if ((ascent_buffer_fill + len) >= ascent_buffer_size)
   {
     char *temp;
 
-    temp = (char *) realloc (ascent_buffer,
+    temp = realloc (ascent_buffer,
         ascent_buffer_fill + len + 1);
     if (temp == NULL)
     {
       ERROR ("ascent plugin: realloc failed.");
       return (0);
     }
@@ -178,26 +178,25 @@
 
   return (len);
 } /* }}} size_t ascent_curl_callback */
 
 static int ascent_submit_players (player_stats_t *ps) /* {{{ */
 {
-  size_t i;
   gauge_t value;
 
-  for (i = 0; i < RACES_LIST_LENGTH; i++)
+  for (size_t i = 0; i < RACES_LIST_LENGTH; i++)
     if (races_list[i] != NULL)
       ascent_submit_gauge ("by-race", "players", races_list[i],
           (gauge_t) ps->races[i]);
 
-  for (i = 0; i < CLASSES_LIST_LENGTH; i++)
+  for (size_t i = 0; i < CLASSES_LIST_LENGTH; i++)
     if (classes_list[i] != NULL)
       ascent_submit_gauge ("by-class", "players", classes_list[i],
           (gauge_t) ps->classes[i]);
 
-  for (i = 0; i < GENDERS_LIST_LENGTH; i++)
+  for (size_t i = 0; i < GENDERS_LIST_LENGTH; i++)
     if (genders_list[i] != NULL)
       ascent_submit_gauge ("by-gender", "players", genders_list[i],
           (gauge_t) ps->genders[i]);
 
   if (ps->level_num <= 0)
     value = NAN;
@@ -325,15 +324,13 @@
   return (0);
 } /* }}} int ascent_xml_read_int */
 
 static int ascent_xml_sessions_plr (xmlDoc *doc, xmlNode *node, /* {{{ */
     player_info_t *pi)
 {
-  xmlNode *child;
-
-  for (child = node->xmlChildrenNode; child != NULL; child = child->next)
+  for (xmlNode *child = node->xmlChildrenNode; child != NULL; child = child->next)
   {
     if ((xmlStrcmp ((const xmlChar *) "comment", child->name) == 0)
         || (xmlStrcmp ((const xmlChar *) "text", child->name) == 0))
       /* ignore */;
     else if (xmlStrcmp ((const xmlChar *) "race", child->name) == 0)
       ascent_xml_read_int (doc, child, &pi->race);
@@ -361,18 +358,17 @@
 
   return (0);
 } /* }}} int ascent_xml_sessions_plr */
 
 static int ascent_xml_sessions (xmlDoc *doc, xmlNode *node) /* {{{ */
 {
-  xmlNode *child;
-  player_stats_t ps;
+  player_stats_t ps = {
+    .level_sum = 0
+  };
 
-  memset (&ps, 0, sizeof (ps));
-
-  for (child = node->xmlChildrenNode; child != NULL; child = child->next)
+  for (xmlNode *child = node->xmlChildrenNode; child != NULL; child = child->next)
   {
     if ((xmlStrcmp ((const xmlChar *) "comment", child->name) == 0)
         || (xmlStrcmp ((const xmlChar *) "text", child->name) == 0))
       /* ignore */;
     else if (xmlStrcmp ((const xmlChar *) "plr", child->name) == 0)
     {
@@ -393,15 +389,13 @@
 
   return (0);
 } /* }}} int ascent_xml_sessions */
 
 static int ascent_xml_status (xmlDoc *doc, xmlNode *node) /* {{{ */
 {
-  xmlNode *child;
-
-  for (child = node->xmlChildrenNode; child != NULL; child = child->next)
+  for (xmlNode *child = node->xmlChildrenNode; child != NULL; child = child->next)
   {
     if ((xmlStrcmp ((const xmlChar *) "comment", child->name) == 0)
         || (xmlStrcmp ((const xmlChar *) "text", child->name) == 0))
       /* ignore */;
     else if (xmlStrcmp ((const xmlChar *) "alliance", child->name) == 0)
       ascent_xml_submit_gauge (doc, child, NULL, "players", "alliance");
@@ -435,13 +429,12 @@
 } /* }}} int ascent_xml_status */
 
 static int ascent_xml (const char *data) /* {{{ */
 {
   xmlDoc *doc;
   xmlNode *cur;
-  xmlNode *child;
 
 #if 0
   doc = xmlParseMemory (data, strlen (data),
       /* URL = */ "ascent.xml",
       /* encoding = */ NULL,
       /* options = */ 0);
@@ -466,13 +459,13 @@
   {
     ERROR ("ascent plugin: XML root element is not \"serverpage\".");
     xmlFreeDoc (doc);
     return (-1);
   }
 
-  for (child = cur->xmlChildrenNode; child != NULL; child = child->next)
+  for (xmlNode *child = cur->xmlChildrenNode; child != NULL; child = child->next)
   {
     if ((xmlStrcmp ((const xmlChar *) "comment", child->name) == 0)
         || (xmlStrcmp ((const xmlChar *) "text", child->name) == 0))
       /* ignore */;
     else if (xmlStrcmp ((const xmlChar *) "status", child->name) == 0)
       ascent_xml_status (doc, child);
@@ -591,14 +584,13 @@
     curl_easy_setopt (curl, CURLOPT_CAINFO, cacert);
 
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
   if (timeout != NULL)
     curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS, atol(timeout));
   else
-    curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS,
-       CDTIME_T_TO_MS(plugin_get_interval()));
+    curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
   return (0);
 } /* }}} int ascent_init */
 
 static int ascent_read (void) /* {{{ */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/barometer.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/barometer.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/barometer.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/barometer.c	2016-09-11 16:10:25.251038738 +0800
@@ -26,12 +27,13 @@
 
 #include <stdint.h>
 #include <fcntl.h>
 #include <unistd.h>
 #include <linux/i2c-dev.h>
 #include <math.h>
+#include <sys/ioctl.h>
 
 /* ------------ MPL115 defines ------------ */
 /* I2C address of the MPL115 sensor */
 #define MPL115_I2C_ADDRESS          0x60
 
 /* register addresses */
@@ -340,15 +342,15 @@
  * @param sensor reference name (as provided by the config file)
  *
  * @return Zero when successful
  */
 static int temp_list_add(temperature_list_t * list, const char * sensor)
 {
-    temperature_list_t * new_temp;
+    temperature_list_t *new_temp;
 
-    new_temp = (temperature_list_t *) malloc(sizeof(*new_temp));
+    new_temp = malloc(sizeof (*new_temp));
     if(new_temp == NULL)
         return -1;
 
     new_temp->sensor_name = strdup(sensor);
     new_temp->initialized = 0;
     new_temp->num_values = 0;
@@ -404,13 +406,12 @@
 static int get_reference_temperature(double * result)
 {
     temperature_list_t * list = temp_list;
 
     gauge_t * values = NULL;   /**< rate values */
     size_t    values_num = 0;  /**< number of rate values */
-    int i;
 
     gauge_t values_history[REF_TEMP_AVG_NUM];
 
     double avg_sum;  /**< Value sum for computing average */
     int    avg_num;  /**< Number of values for computing average */
     double average;  /**< Resulting value average */
@@ -442,17 +443,16 @@
                    list->sensor_name,
                    values_num);
 
             list->initialized = 1;
             list->num_values = values_num;
 
-            for(i=0; i<values_num; ++i)
+            for(size_t i=0; i<values_num; ++i)
             {
-                DEBUG ("barometer: get_reference_temperature - rate %d: %lf **",
-                       i,
-                       values[i]);
+                DEBUG ("barometer: get_reference_temperature - rate %zu: %lf **",
+                       i, values[i]);
                 if(!isnan(values[i]))
                 {
                     avg_sum += values[i];
                     ++avg_num;
                 }
             }
@@ -472,17 +472,16 @@
             list->initialized = 0;
             list->num_values = 0;
             list = list->next;
             continue;
         }
 
-        for(i=0; i<REF_TEMP_AVG_NUM*list->num_values; ++i)
+        for(size_t i=0; i<REF_TEMP_AVG_NUM*list->num_values; ++i)
         {
-            DEBUG ("barometer: get_reference_temperature - history %d: %lf",
-                   i,
-                   values_history[i]);
+            DEBUG ("barometer: get_reference_temperature - history %zu: %lf",
+                   i, values_history[i]);
             if(!isnan(values_history[i]))
             {
                 avg_sum += values_history[i];
                 ++avg_num;
             }
         }
@@ -498,17 +497,16 @@
                 list->initialized = 0;
                 list->num_values = 0;
                 list = list->next;
                 continue;
             }
 
-            for(i=0; i<values_num; ++i)
+            for(size_t i=0; i<values_num; ++i)
             {
-                DEBUG ("barometer: get_reference_temperature - rate last %d: %lf **",
-                       i,
-                       values[i]);
+                DEBUG ("barometer: get_reference_temperature - rate last %zu: %lf **",
+                       i, values[i]);
                 if(!isnan(values[i]))
                 {
                     avg_sum += values[i];
                     ++avg_num;
                 }
             }
@@ -1580,14 +1578,13 @@
 
     /* Rather than delaying init, we will intitialize during first read. This
        way at least we have a better chance to have the reference temperature
        already available. */
     if(!avg_initialized)
     {
-        int i;
-        for(i=0; i<config_oversample-1; ++i)
+        for(int i=0; i<config_oversample-1; ++i)
         {
             result = MPL115_read_averaged(&pressure, &temperature);
             if(result)
             {
                 ERROR ("barometer: MPL115_collectd_barometer_read - mpl115 read, ignored during init");
             }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/battery.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/battery.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/battery.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/battery.c	2016-09-11 16:10:25.251038738 +0800
@@ -21,17 +21,16 @@
  *   Florian octo Forster <octo at collectd.org>
  *   Michał Mirosław <mirq-linux at rere.qmqm.pl>
  *   Andy Parkins <andyp at fussylogic.co.uk>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
-#include "utils_complain.h"
-
 #if HAVE_MACH_MACH_TYPES_H
 #  include <mach/mach_types.h>
 #endif
 #if HAVE_MACH_MACH_INIT_H
 #  include <mach/mach_init.h>
 #endif
@@ -140,13 +139,13 @@
 	{
 		battery_submit (plugin_instance, "capacity", capacity_charged);
 	}
 } /* }}} void submit_capacity */
 
 #if HAVE_IOKIT_PS_IOPOWERSOURCES_H || HAVE_IOKIT_IOKITLIB_H
-static double dict_get_double (CFDictionaryRef dict, char *key_string) /* {{{ */
+static double dict_get_double (CFDictionaryRef dict, const char *key_string) /* {{{ */
 {
 	double      val_double;
 	long long   val_int;
 	CFNumberRef val_obj;
 	CFStringRef key_obj;
 
@@ -200,21 +199,20 @@
 	CFArrayRef      ps_array;
 	int             ps_array_len;
 	CFDictionaryRef ps_dict;
 	CFTypeRef       ps_obj;
 
 	double temp_double;
-	int i;
 
 	ps_raw       = IOPSCopyPowerSourcesInfo ();
 	ps_array     = IOPSCopyPowerSourcesList (ps_raw);
 	ps_array_len = CFArrayGetCount (ps_array);
 
 	DEBUG ("ps_array_len == %i", ps_array_len);
 
-	for (i = 0; i < ps_array_len; i++)
+	for (int i = 0; i < ps_array_len; i++)
 	{
 		ps_obj  = CFArrayGetValueAtIndex (ps_array, i);
 		ps_dict = IOPSGetPowerSourceDescription (ps_raw, ps_obj);
 
 		if (ps_dict == NULL)
 		{
@@ -273,13 +271,12 @@
 	io_iterator_t   iterator;
 	io_object_t     io_obj;
 
 	CFDictionaryRef bat_root_dict;
 	CFArrayRef      bat_info_arry;
 	CFIndex         bat_info_arry_len;
-	CFIndex         bat_info_arry_pos;
 	CFDictionaryRef bat_info_dict;
 
 	double temp_double;
 
 	status = IOServiceGetMatchingServices (kIOMasterPortDefault,
 			IOServiceNameMatching ("battery"),
@@ -308,13 +305,13 @@
 		{
 			CFRelease (bat_root_dict);
 			continue;
 		}
 		bat_info_arry_len = CFArrayGetCount (bat_info_arry);
 
-		for (bat_info_arry_pos = 0;
+		for (CFIndex bat_info_arry_pos = 0;
 				bat_info_arry_pos < bat_info_arry_len;
 				bat_info_arry_pos++)
 		{
 			bat_info_dict = (CFDictionaryRef) CFArrayGetValueAtIndex (bat_info_arry, bat_info_arry_pos);
 
 			if (isnan (*ret_capacity_full))
@@ -338,13 +335,13 @@
 			if (isnan (*ret_voltage))
 			{
 				temp_double = dict_get_double (bat_info_dict, "Voltage");
 				*ret_voltage = temp_double / 1000.0;
 			}
 		}
-		
+
 		CFRelease (bat_root_dict);
 	}
 
 	IOObjectRelease (iterator);
 } /* }}} void get_via_generic_iokit */
 # endif /* HAVE_IOKIT_IOKITLIB_H */
@@ -355,13 +352,13 @@
 	gauge_t voltage = NAN; /* Voltage in V */
 
 	/* We only get the charged capacity as a percentage from
 	 * IOPowerSources. IOKit, on the other hand, only reports the full
 	 * capacity. We use the two to calculate the current charged capacity. */
 	gauge_t charge_rel = NAN; /* Current charge in percent */
-	gauge_t capacity_charged = NAN; /* Charged capacity */
+	gauge_t capacity_charged; /* Charged capacity */
 	gauge_t capacity_full = NAN; /* Total capacity */
 	gauge_t capacity_design = NAN; /* Full design capacity */
 
 #if HAVE_IOKIT_PS_IOPOWERSOURCES_H
 	get_via_io_power_sources (&charge_rel, &current, &voltage);
 #endif
@@ -712,17 +709,16 @@
 			/* include hidden */ 0);
 	return (status);
 } /* }}} int read_acpi */
 
 static int read_pmu (void) /* {{{ */
 {
-	int i;
-
+	int i = 0;
 	/* The upper limit here is just a safeguard. If there is a system with
 	 * more than 100 batteries, this can easily be increased. */
-	for (i = 0; i < 100; i++)
+	for (; i < 100; i++)
 	{
 		FILE *fh;
 
 		char buffer[1024];
 		char filename[PATH_MAX];
 		char plugin_instance[DATA_MAX_NAME_LEN];
@@ -794,22 +790,20 @@
 
 	DEBUG ("battery plugin: Trying pmu ...");
 	status = read_pmu ();
 	if (status == 0)
 		return (0);
 
-	ERROR ("battery plugin: All available input methods failed.");
+	ERROR ("battery plugin: Add available input methods failed.");
 	return (-1);
 } /* }}} int battery_read */
 #endif /* KERNEL_LINUX */
 
 static int battery_config (oconfig_item_t *ci)
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("ValuesPercentage", child->key) == 0)
 			cf_util_get_boolean (child, &report_percent);
 		else if (strcasecmp ("ReportDegraded", child->key) == 0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/bind.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/bind.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/bind.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/bind.c	2016-09-11 16:10:25.251038738 +0800
@@ -33,15 +33,15 @@
 # ifndef _XOPEN_SOURCE
 #  define _XOPEN_SOURCE 500
 # endif
 #endif /* STRPTIME_NEEDS_STANDARDS */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 /* Some versions of libcurl don't include this themselves and then don't have
  * fd_set available. */
 #if HAVE_SYS_SELECT_H
 # include <sys/select.h>
 #endif
@@ -51,13 +51,13 @@
 #include <libxml/xpath.h>
 
 #ifndef BIND_DEFAULT_URL
 # define BIND_DEFAULT_URL "http://localhost:8053/"
 #endif
 
-/* 
+/*
  * Some types used for the callback functions. `translation_table_ptr_t' and
  * `list_info_ptr_t' are passed to the callbacks in the `void *user_data'
  * pointer.
  */
 typedef int (*list_callback_t) (const char *name, value_t value,
     time_t current_time, void *user_data);
@@ -274,20 +274,20 @@
 
 static size_t bind_curl_callback (void *buf, size_t size, /* {{{ */
     size_t nmemb, void __attribute__((unused)) *stream)
 {
   size_t len = size * nmemb;
 
-  if (len <= 0)
+  if (len == 0)
     return (len);
 
   if ((bind_buffer_fill + len) >= bind_buffer_size)
   {
     char *temp;
 
-    temp = realloc(bind_buffer, bind_buffer_fill + len + 1);
+    temp = realloc (bind_buffer, bind_buffer_fill + len + 1);
     if (temp == NULL)
     {
       ERROR ("bind plugin: realloc failed.");
       return (0);
     }
     bind_buffer = temp;
@@ -306,18 +306,17 @@
  * (Plugin instance is fixed, type and type instance come from lookup table.)
  */
 static int bind_xml_table_callback (const char *name, value_t value, /* {{{ */
     time_t current_time, void *user_data)
 {
   translation_table_ptr_t *table = (translation_table_ptr_t *) user_data;
-  size_t i;
 
   if (table == NULL)
     return (-1);
 
-  for (i = 0; i < table->table_length; i++)
+  for (size_t i = 0; i < table->table_length; i++)
   {
     if (strcmp (table->table[i].xml_name, name) != 0)
       continue;
 
     submit (current_time,
         table->plugin_instance,
@@ -414,13 +413,13 @@
     xmlDoc *doc, xmlXPathContext *xpathCtx, time_t *ret_value)
 {
   xmlXPathObject *xpathObj = NULL;
   xmlNode *node;
   char *str_ptr;
   char *tmp;
-  struct tm tm;
+  struct tm tm = { 0 };
 
   xpathObj = xmlXPathEvalExpression (BAD_CAST xpath_expression, xpathCtx);
   if (xpathObj == NULL)
   {
     ERROR ("bind plugin: Unable to evaluate XPath expression `%s'.",
         xpath_expression);
@@ -455,13 +454,12 @@
   {
     ERROR ("bind plugin: bind_xml_read_timestamp: xmlNodeListGetString failed.");
     xmlXPathFreeObject (xpathObj);
     return (-1);
   }
 
-  memset (&tm, 0, sizeof(tm));
   tmp = strptime (str_ptr, "%Y-%m-%dT%T", &tm);
   xmlFree(str_ptr);
   if (tmp == NULL)
   {
     ERROR ("bind plugin: bind_xml_read_timestamp: strptime failed.");
     xmlXPathFreeObject (xpathObj);
@@ -471,13 +469,13 @@
   *ret_value = mktime(&tm);
 
   xmlXPathFreeObject (xpathObj);
   return (0);
 } /* }}} int bind_xml_read_timestamp */
 
-/* 
+/*
  * bind_parse_generic_name_value
  *
  * Reads statistics in the form:
  * <foo>
  *   <name>QUERY</name>
  *   <counter>123</counter>
@@ -488,37 +486,35 @@
     void *user_data,
     xmlDoc *doc, xmlXPathContext *xpathCtx,
     time_t current_time, int ds_type)
 {
   xmlXPathObject *xpathObj = NULL;
   int num_entries;
-  int i;
 
   xpathObj = xmlXPathEvalExpression(BAD_CAST xpath_expression, xpathCtx);
   if (xpathObj == NULL)
   {
     ERROR("bind plugin: Unable to evaluate XPath expression `%s'.",
         xpath_expression);
     return (-1);
   }
 
   num_entries = 0;
   /* Iterate over all matching nodes. */
-  for (i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
+  for (int i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
   {
     xmlNode *name_node = NULL;
     xmlNode *counter = NULL;
     xmlNode *parent;
-    xmlNode *child;
 
     parent = xpathObj->nodesetval->nodeTab[i];
     DEBUG ("bind plugin: bind_parse_generic_name_value: parent->name = %s;",
         (char *) parent->name);
 
     /* Iterate over all child nodes. */
-    for (child = parent->xmlChildrenNode;
+    for (xmlNode *child = parent->xmlChildrenNode;
         child != NULL;
         child = child->next)
     {
       if (child->type != XML_ELEMENT_NODE)
         continue;
 
@@ -556,13 +552,13 @@
 
   xmlXPathFreeObject(xpathObj);
 
   return (0);
 } /* }}} int bind_parse_generic_name_value */
 
-/* 
+/*
  * bind_parse_generic_value_list
  *
  * Reads statistics in the form:
  * <foo>
  *   <name0>123</name0>
  *   <name1>234</name1>
@@ -575,30 +571,27 @@
     void *user_data,
     xmlDoc *doc, xmlXPathContext *xpathCtx,
     time_t current_time, int ds_type)
 {
   xmlXPathObject *xpathObj = NULL;
   int num_entries;
-  int i;
 
   xpathObj = xmlXPathEvalExpression(BAD_CAST xpath_expression, xpathCtx);
   if (xpathObj == NULL)
   {
     ERROR("bind plugin: Unable to evaluate XPath expression `%s'.",
         xpath_expression);
     return (-1);
   }
 
   num_entries = 0;
   /* Iterate over all matching nodes. */
-  for (i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
+  for (int i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
   {
-    xmlNode *child;
-
     /* Iterate over all child nodes. */
-    for (child = xpathObj->nodesetval->nodeTab[i]->xmlChildrenNode;
+    for (xmlNode *child = xpathObj->nodesetval->nodeTab[i]->xmlChildrenNode;
         child != NULL;
         child = child->next)
     {
       char *node_name;
       value_t value;
       int status;
@@ -646,30 +639,27 @@
     void *user_data,
     xmlDoc *doc, xmlXPathContext *xpathCtx,
     time_t current_time, int ds_type)
 {
   xmlXPathObject *xpathObj = NULL;
   int num_entries;
-  int i;
 
   xpathObj = xmlXPathEvalExpression(BAD_CAST xpath_expression, xpathCtx);
   if (xpathObj == NULL)
   {
     ERROR("bind plugin: Unable to evaluate XPath expression `%s'.",
         xpath_expression);
     return (-1);
   }
 
   num_entries = 0;
   /* Iterate over all matching nodes. */
-  for (i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
+  for (int i = 0; xpathObj->nodesetval && (i < xpathObj->nodesetval->nodeNr); i++)
   {
-    xmlNode *child;
-
     /* Iterate over all child nodes. */
-    for (child = xpathObj->nodesetval->nodeTab[i]->xmlChildrenNode;
+    for (xmlNode *child = xpathObj->nodesetval->nodeTab[i]->xmlChildrenNode;
         child != NULL;
         child = child->next)
     {
       if (child->type != XML_ELEMENT_NODE)
         continue;
 
@@ -711,13 +701,12 @@
 static int bind_xml_stats_handle_zone (int version, xmlDoc *doc, /* {{{ */
     xmlXPathContext *path_ctx, xmlNode *node, cb_view_t *view,
     time_t current_time)
 {
   xmlXPathObject *path_obj;
   char *zone_name = NULL;
-  int i;
   size_t j;
 
   if (version >= 3)
   {
     char *n = (char *) xmlGetProp (node, BAD_CAST "name");
     char *c = (char *) xmlGetProp (node, BAD_CAST "rdataclass");
@@ -735,13 +724,13 @@
     if (path_obj == NULL)
     {
       ERROR ("bind plugin: xmlXPathEvalExpression failed.");
       return (-1);
     }
 
-    for (i = 0; path_obj->nodesetval && (i < path_obj->nodesetval->nodeNr); i++)
+    for (int i = 0; path_obj->nodesetval && (i < path_obj->nodesetval->nodeNr); i++)
     {
       zone_name = (char *) xmlNodeListGetString (doc,
           path_obj->nodesetval->nodeTab[i]->xmlChildrenNode, 1);
       if (zone_name != NULL)
         break;
     }
@@ -771,13 +760,13 @@
   DEBUG ("bind plugin: bind_xml_stats_handle_zone: Found zone `%s'.",
       zone_name);
 
   { /* Parse the <counters> tag {{{ */
     char plugin_instance[DATA_MAX_NAME_LEN];
     translation_table_ptr_t table_ptr =
-    { 
+    {
       nsstats_translation_table,
       nsstats_translation_table_length,
       plugin_instance
     };
 
     ssnprintf (plugin_instance, sizeof (plugin_instance), "%s-zone-%s",
@@ -814,13 +803,12 @@
 static int bind_xml_stats_search_zones (int version, xmlDoc *doc, /* {{{ */
     xmlXPathContext *path_ctx, xmlNode *node, cb_view_t *view,
     time_t current_time)
 {
   xmlXPathObject *zone_nodes = NULL;
   xmlXPathContext *zone_path_context;
-  int i;
 
   zone_path_context = xmlXPathNewContext (doc);
   if (zone_path_context == NULL)
   {
     ERROR ("bind plugin: xmlXPathNewContext failed.");
     return (-1);
@@ -831,13 +819,13 @@
   {
     ERROR ("bind plugin: Cannot find any <view> tags.");
     xmlXPathFreeContext (zone_path_context);
     return (-1);
   }
 
-  for (i = 0; i < zone_nodes->nodesetval->nodeNr; i++)
+  for (int i = 0; i < zone_nodes->nodesetval->nodeNr; i++)
   {
     node = zone_nodes->nodesetval->nodeTab[i];
     assert (node != NULL);
 
     zone_path_context->node = node;
 
@@ -852,13 +840,12 @@
 
 static int bind_xml_stats_handle_view (int version, xmlDoc *doc, /* {{{ */
     xmlXPathContext *path_ctx, xmlNode *node, time_t current_time)
 {
   char *view_name = NULL;
   cb_view_t *view;
-  int i;
   size_t j;
 
   if (version == 3)
   {
     view_name = (char*) xmlGetProp(node, BAD_CAST "name");
 
@@ -884,13 +871,13 @@
     if (path_obj == NULL)
     {
       ERROR ("bind plugin: xmlXPathEvalExpression failed.");
       return (-1);
     }
 
-    for (i = 0; path_obj->nodesetval && (i < path_obj->nodesetval->nodeNr); i++)
+    for (int i = 0; path_obj->nodesetval && (i < path_obj->nodesetval->nodeNr); i++)
     {
       view_name = (char *) xmlNodeListGetString (doc,
           path_obj->nodesetval->nodeTab[i]->xmlChildrenNode, 1);
       if (view_name != NULL)
         break;
     }
@@ -952,13 +939,13 @@
   } /* }}} */
 
   if (view->resolver_stats != 0) /* {{{ */
   {
     char plugin_instance[DATA_MAX_NAME_LEN];
     translation_table_ptr_t table_ptr =
-    { 
+    {
       resstats_translation_table,
       resstats_translation_table_length,
       plugin_instance
     };
 
     ssnprintf (plugin_instance, sizeof (plugin_instance),
@@ -1007,13 +994,12 @@
 
 static int bind_xml_stats_search_views (int version, xmlDoc *doc, /* {{{ */
     xmlXPathContext *xpathCtx, xmlNode *statsnode, time_t current_time)
 {
   xmlXPathObject *view_nodes = NULL;
   xmlXPathContext *view_path_context;
-  int i;
 
   view_path_context = xmlXPathNewContext (doc);
   if (view_path_context == NULL)
   {
     ERROR ("bind plugin: xmlXPathNewContext failed.");
     return (-1);
@@ -1024,13 +1010,13 @@
   {
     ERROR ("bind plugin: Cannot find any <view> tags.");
     xmlXPathFreeContext (view_path_context);
     return (-1);
   }
 
-  for (i = 0; i < view_nodes->nodesetval->nodeNr; i++)
+  for (int i = 0; i < view_nodes->nodesetval->nodeNr; i++)
   {
     xmlNode *node;
 
     node = view_nodes->nodesetval->nodeTab[i];
     assert (node != NULL);
 
@@ -1438,13 +1424,12 @@
 static int bind_xml (const char *data) /* {{{ */
 {
   xmlDoc *doc = NULL;
   xmlXPathContext *xpathCtx = NULL;
   xmlXPathObject *xpathObj = NULL;
   int ret = -1;
-  int i;
 
   doc = xmlParseMemory (data, strlen (data));
   if (doc == NULL)
   {
     ERROR ("bind plugin: xmlParseMemory failed.");
     return (-1);
@@ -1468,13 +1453,13 @@
     DEBUG ("bind plugin: Statistics appears not to be v3");
     // we will fallback to v1 or v2 detection
     if (xpathObj != NULL) { xmlXPathFreeObject (xpathObj); }
   }
   else
   {
-    for (i = 0; i < xpathObj->nodesetval->nodeNr; i++)
+    for (int i = 0; i < xpathObj->nodesetval->nodeNr; i++)
     {
       xmlNode *node;
       char *attr_version;
 
       node = xpathObj->nodesetval->nodeTab[i];
       assert (node != NULL);
@@ -1530,13 +1515,13 @@
     xmlXPathFreeObject (xpathObj);
     xmlXPathFreeContext (xpathCtx);
     xmlFreeDoc (doc);
     return (-1);
   }
 
-  for (i = 0; i < xpathObj->nodesetval->nodeNr; i++)
+  for (int i = 0; i < xpathObj->nodesetval->nodeNr; i++)
   {
     xmlNode *node;
     char *attr_version;
     int parsed_version = 0;
 
     node = xpathObj->nodesetval->nodeTab[i];
@@ -1610,13 +1595,13 @@
   {
     WARNING ("bind plugin: The `Zone' option needs "
         "exactly one string argument.");
     return (-1);
   }
 
-  tmp = (char **) realloc (view->zones,
+  tmp = realloc (view->zones,
       sizeof (char *) * (view->zones_num + 1));
   if (tmp == NULL)
   {
     ERROR ("bind plugin: realloc failed.");
     return (-1);
   }
@@ -1633,21 +1618,20 @@
   return (0);
 } /* }}} int bind_config_add_view_zone */
 
 static int bind_config_add_view (oconfig_item_t *ci) /* {{{ */
 {
   cb_view_t *tmp;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("bind plugin: `View' blocks need exactly one string argument.");
     return (-1);
   }
 
-  tmp = (cb_view_t *) realloc (views, sizeof (*views) * (views_num + 1));
+  tmp = realloc (views, sizeof (*views) * (views_num + 1));
   if (tmp == NULL)
   {
     ERROR ("bind plugin: realloc failed.");
     return (-1);
   }
   views = tmp;
@@ -1665,13 +1649,13 @@
   {
     ERROR ("bind plugin: strdup failed.");
     sfree (views);
     return (-1);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("QTypes", child->key) == 0)
       bind_config_set_bool ("QTypes", &tmp->qtypes, child);
     else if (strcasecmp ("ResolverStats", child->key) == 0)
@@ -1690,15 +1674,13 @@
   views_num++;
   return (0);
 } /* }}} int bind_config_add_view */
 
 static int bind_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Url", child->key) == 0) {
       if ((child->values_num != 1) || (child->values[0].type != OCONFIG_TYPE_STRING))
       {
@@ -1755,13 +1737,13 @@
   curl_easy_setopt (curl, CURLOPT_ERRORBUFFER, bind_curl_error);
   curl_easy_setopt (curl, CURLOPT_URL, (url != NULL) ? url : BIND_DEFAULT_URL);
   curl_easy_setopt (curl, CURLOPT_FOLLOWLOCATION, 1L);
   curl_easy_setopt (curl, CURLOPT_MAXREDIRS, 50L);
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
   curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS, (timeout >= 0) ?
-      (long) timeout : CDTIME_T_TO_MS(plugin_get_interval()));
+      (long) timeout : (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
 
   return (0);
 } /* }}} int bind_init */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ceph.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ceph.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ceph.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ceph.c	2016-09-11 16:10:25.251038738 +0800
@@ -34,21 +35,23 @@
 #include <errno.h>
 #include <fcntl.h>
 #include <yajl/yajl_parse.h>
 #if HAVE_YAJL_YAJL_VERSION_H
 #include <yajl/yajl_version.h>
 #endif
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
+#endif
 
 #include <limits.h>
 #include <poll.h>
 #include <stdint.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <strings.h>
-#include <sys/socket.h>
 #include <sys/time.h>
 #include <sys/types.h>
 #include <sys/un.h>
 #include <unistd.h>
 #include <math.h>
 #include <inttypes.h>
@@ -94,13 +97,13 @@
     DSET_BYTES = 1,
     DSET_RATE = 2,
     DSET_TYPE_UNFOUND = 1000
 };
 
 /** Valid types for ceph defined in types.db */
-const char * ceph_dset_types [CEPH_DSET_TYPES_NUM] =
+static const char * const ceph_dset_types [CEPH_DSET_TYPES_NUM] =
                                    {"ceph_latency", "ceph_bytes", "ceph_rate"};
 
 /******* ceph_daemon *******/
 struct ceph_daemon
 {
     /** Version of the admin_socket interface */
@@ -161,13 +164,13 @@
 static int convert_special_metrics = 1;
 
 /** Array of daemons to monitor */
 static struct ceph_daemon **g_daemons = NULL;
 
 /** Number of elements in g_daemons */
-static int g_num_daemons = 0;
+static size_t g_num_daemons = 0;
 
 /**
  * A set of data that we build up in memory while parsing the JSON.
  */
 struct values_tmp
 {
@@ -256,31 +259,32 @@
 {
     return CEPH_CB_CONTINUE;
 }
 
 #define BUFFER_ADD(dest, src) do { \
     size_t dest_size = sizeof (dest); \
-    strncat ((dest), (src), dest_size - strlen (dest)); \
+    size_t dest_len = strlen (dest); \
+    if (dest_size > dest_len) { \
+        sstrncpy ((dest) + dest_len, (src), dest_size - dest_len); \
+    } \
     (dest)[dest_size - 1] = 0; \
 } while (0)
 
 static int
 ceph_cb_number(void *ctx, const char *number_val, yajl_len_t number_len)
 {
     yajl_struct *state = (yajl_struct*) ctx;
     char buffer[number_len+1];
-    char key[2 * DATA_MAX_NAME_LEN];
+    char key[2 * DATA_MAX_NAME_LEN] = { 0 };
     _Bool latency_type = 0;
-    size_t i;
     int status;
 
     memcpy(buffer, number_val, number_len);
-    buffer[sizeof(buffer) - 1] = 0;
+    buffer[sizeof(buffer) - 1] = '\0';
 
-    memset (key, 0, sizeof (key));
-    for (i = 0; i < state->depth; i++)
+    for (size_t i = 0; i < state->depth; i++)
     {
         if (state->stack[i] == NULL)
             continue;
 
         if (strlen (key) != 0)
             BUFFER_ADD (key, ".");
@@ -290,12 +294,17 @@
     /* Special case for latency metrics. */
     if ((strcmp ("avgcount", state->key) == 0)
         || (strcmp ("sum", state->key) == 0))
     {
         latency_type = 1;
 
+        /* depth >= 2  =>  (stack[-1] != NULL && stack[-2] != NULL) */
+        assert ((state->depth < 2)
+                || ((state->stack[state->depth - 1] != NULL)
+                    && (state->stack[state->depth - 2] != NULL)));
+
         /* Super-special case for filestore.journal_wr_bytes.avgcount: For
          * some reason, Ceph schema encodes this as a count/sum pair while all
          * other "Bytes" data (excluding used/capacity bytes for OSD space) uses
          * a single "Derive" type. To spare further confusion, keep this KPI as
          * the same type of other "Bytes". Instead of keeping an "average" or
          * "rate", use the "sum" in the pair and assign that to the derive
@@ -420,30 +429,29 @@
 {
     DEBUG("ceph plugin: name=%s, asok_path=%s", d->name, d->asok_path);
 }
 
 static void ceph_daemons_print(void)
 {
-    int i;
-    for(i = 0; i < g_num_daemons; ++i)
+    for(size_t i = 0; i < g_num_daemons; ++i)
     {
         ceph_daemon_print(g_daemons[i]);
     }
 }
 
 static void ceph_daemon_free(struct ceph_daemon *d)
 {
-    int i = 0;
-    for(; i < d->last_idx; i++)
+    for(int i = 0; i < d->last_idx; i++)
     {
         sfree(d->last_poll_data[i]);
     }
     sfree(d->last_poll_data);
     d->last_poll_data = NULL;
     d->last_idx = 0;
-    for(i = 0; i < d->ds_num; i++)
+
+    for(int i = 0; i < d->ds_num; i++)
     {
         sfree(d->ds_names[i]);
     }
     sfree(d->ds_types);
     sfree(d->ds_names);
     sfree(d);
@@ -546,16 +554,15 @@
     return 0;
 }
 
 /* count_parts returns the number of elements a "foo.bar.baz" style key has. */
 static size_t count_parts (char const *key)
 {
-    char const *ptr;
     size_t parts_num = 0;
 
-    for (ptr = key; ptr != NULL; ptr = strchr (ptr + 1, '.'))
+    for (const char *ptr = key; ptr != NULL; ptr = strchr (ptr + 1, '.'))
         parts_num++;
 
     return parts_num;
 }
 
 /**
@@ -591,13 +598,12 @@
  */
 static int ceph_daemon_add_ds_entry(struct ceph_daemon *d, const char *name,
         int pc_type)
 {
     uint32_t type;
     char ds_name[DATA_MAX_NAME_LEN];
-    memset(ds_name, 0, sizeof(ds_name));
 
     if(convert_special_metrics)
     {
         /**
          * Special case for filestore:JournalWrBytes. For some reason, Ceph
          * schema encodes this as a count/sum pair while all other "Bytes" data
@@ -621,13 +627,13 @@
     d->ds_types = realloc(d->ds_types, sizeof(uint32_t) * (d->ds_num + 1));
     if(!d->ds_types)
     {
         return -ENOMEM;
     }
 
-    d->ds_names[d->ds_num] = malloc(sizeof(char) * DATA_MAX_NAME_LEN);
+    d->ds_names[d->ds_num] = malloc(DATA_MAX_NAME_LEN);
     if(!d->ds_names[d->ds_num])
     {
         return -ENOMEM;
     }
 
     type = (pc_type & PERFCOUNTER_DERIVE) ? DSET_RATE :
@@ -682,16 +688,15 @@
     *dest = (item->values[0].value.boolean) ? 1 : 0;
     return 0;
 }
 
 static int cc_add_daemon_config(oconfig_item_t *ci)
 {
-    int ret, i;
-    struct ceph_daemon *nd, cd;
+    int ret;
+    struct ceph_daemon *nd, cd = { 0 };
     struct ceph_daemon **tmp;
-    memset(&cd, 0, sizeof(struct ceph_daemon));
 
     if((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
     {
         WARNING("ceph plugin: `Daemon' blocks need exactly one string "
                 "argument.");
         return (-1);
@@ -700,13 +705,13 @@
     ret = cc_handle_str(ci, cd.name, DATA_MAX_NAME_LEN);
     if(ret)
     {
         return ret;
     }
 
-    for(i=0; i < ci->children_num; i++)
+    for(int i=0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if(strcasecmp("SocketPath", child->key) == 0)
         {
             ret = cc_handle_str(child, cd.asok_path, sizeof(cd.asok_path));
@@ -745,27 +750,28 @@
         /* The positive return value here indicates that this is a
          * runtime error, not a configuration error.  */
         return ENOMEM;
     }
     g_daemons = tmp;
 
-    nd = malloc(sizeof(*nd));
+    nd = malloc(sizeof (*nd));
     if(!nd)
     {
         return ENOMEM;
     }
     memcpy(nd, &cd, sizeof(*nd));
-    g_daemons[g_num_daemons++] = nd;
+    g_daemons[g_num_daemons] = nd;
+    g_num_daemons++;
     return 0;
 }
 
 static int ceph_config(oconfig_item_t *ci)
 {
-    int ret, i;
+    int ret;
 
-    for(i = 0; i < ci->children_num; ++i)
+    for(int i = 0; i < ci->children_num; ++i)
     {
         oconfig_item_t *child = ci->children + i;
         if(strcasecmp("Daemon", child->key) == 0)
         {
             ret = cc_add_daemon_config(child);
             if(ret == ENOMEM)
@@ -843,13 +849,13 @@
 /**
  * Latency counter does not yet have an entry in last poll data - add it.
  */
 static int add_last(struct ceph_daemon *d, const char *ds_n, double cur_sum,
         uint64_t cur_count)
 {
-    d->last_poll_data[d->last_idx] = malloc(1 * sizeof(struct last_data));
+    d->last_poll_data[d->last_idx] = malloc(sizeof (*d->last_poll_data[d->last_idx]));
     if(!d->last_poll_data[d->last_idx])
     {
         return -ENOMEM;
     }
     sstrncpy(d->last_poll_data[d->last_idx]->ds_name,ds_n,
             sizeof(d->last_poll_data[d->last_idx]->ds_name));
@@ -871,13 +877,13 @@
         d->last_poll_data[index]->last_count = cur_count;
         return 0;
     }
 
     if(!d->last_poll_data)
     {
-        d->last_poll_data = malloc(1 * sizeof(struct last_data *));
+        d->last_poll_data = malloc(sizeof (*d->last_poll_data));
         if(!d->last_poll_data)
         {
             return -ENOMEM;
         }
     }
     else
@@ -896,14 +902,13 @@
 /**
  * If using index guess failed (shouldn't happen, but possible if counters
  * get rearranged), resort to searching for counter name
  */
 static int backup_search_for_last_avg(struct ceph_daemon *d, const char *ds_n)
 {
-    int i = 0;
-    for(; i < d->last_idx; i++)
+    for(int i = 0; i < d->last_idx; i++)
     {
         if(strcmp(d->last_poll_data[i]->ds_name, ds_n) == 0)
         {
             return i;
         }
     }
@@ -957,18 +962,17 @@
 
 /**
  * If using index guess failed, resort to searching for counter name
  */
 static uint32_t backup_search_for_type(struct ceph_daemon *d, char *ds_name)
 {
-    int idx = 0;
-    for(; idx < d->ds_num; idx++)
+    for(int i = 0; i < d->ds_num; i++)
     {
-        if(strcmp(d->ds_names[idx], ds_name) == 0)
+        if(strcmp(d->ds_names[i], ds_name) == 0)
         {
-            return d->ds_types[idx];
+            return d->ds_types[i];
         }
     }
     return DSET_TYPE_UNFOUND;
 }
 
 /**
@@ -981,13 +985,12 @@
     uint64_t tmp_u;
     struct values_tmp *vtmp = (struct values_tmp*) arg;
     uint32_t type = DSET_TYPE_UNFOUND;
     int index = vtmp->index;
 
     char ds_name[DATA_MAX_NAME_LEN];
-    memset(ds_name, 0, sizeof(ds_name));
 
     if (parse_keys (ds_name, sizeof (ds_name), key))
     {
         return 1;
     }
 
@@ -1084,13 +1087,13 @@
 
     return 0;
 }
 
 static int cconn_connect(struct cconn *io)
 {
-    struct sockaddr_un address;
+    struct sockaddr_un address = { 0 };
     int flags, fd, err;
     if(io->state != CSTATE_UNCONNECTED)
     {
         ERROR("ceph plugin: cconn_connect: io->state != CSTATE_UNCONNECTED");
         return -EDOM;
     }
@@ -1099,13 +1102,12 @@
     {
         err = -errno;
         ERROR("ceph plugin: cconn_connect: socket(PF_UNIX, SOCK_STREAM, 0) "
             "failed: error %d", err);
         return err;
     }
-    memset(&address, 0, sizeof(struct sockaddr_un));
     address.sun_family = AF_UNIX;
     snprintf(address.sun_path, sizeof(address.sun_path), "%s",
             io->d->asok_path);
     RETRY_ON_EINTR(err,
         connect(fd, (struct sockaddr *) &address, sizeof(struct sockaddr_un)));
     if(err < 0)
@@ -1459,21 +1461,21 @@
 }
 
 /** This handles the actual network I/O to talk to the Ceph daemons.
  */
 static int cconn_main_loop(uint32_t request_type)
 {
-    int i, ret, some_unreachable = 0;
+    int ret, some_unreachable = 0;
     struct timeval end_tv;
     struct cconn io_array[g_num_daemons];
 
     DEBUG("ceph plugin: entering cconn_main_loop(request_type = %d)", request_type);
 
     /* create cconn array */
     memset(io_array, 0, sizeof(io_array));
-    for(i = 0; i < g_num_daemons; ++i)
+    for(size_t i = 0; i < g_num_daemons; ++i)
     {
         io_array[i].d = g_daemons[i];
         io_array[i].request_type = request_type;
         io_array[i].state = CSTATE_UNCONNECTED;
     }
 
@@ -1486,19 +1488,19 @@
         int nfds, diff;
         struct timeval tv;
         struct cconn *polled_io_array[g_num_daemons];
         struct pollfd fds[g_num_daemons];
         memset(fds, 0, sizeof(fds));
         nfds = 0;
-        for(i = 0; i < g_num_daemons; ++i)
+        for(size_t i = 0; i < g_num_daemons; ++i)
         {
             struct cconn *io = io_array + i;
             ret = cconn_prepare(io, fds + nfds);
             if(ret < 0)
             {
-                WARNING("ceph plugin: cconn_prepare(name=%s,i=%d,st=%d)=%d",
+                WARNING("ceph plugin: cconn_prepare(name=%s,i=%zu,st=%d)=%d",
                         io->d->name, i, io->state, ret);
                 cconn_close(io);
                 io->request_type = ASOK_REQ_NONE;
                 some_unreachable = 1;
             }
             else if(ret == 1)
@@ -1524,19 +1526,20 @@
         RETRY_ON_EINTR(ret, poll(fds, nfds, diff));
         if(ret < 0)
         {
             ERROR("ceph plugin: poll(2) error: %d", ret);
             goto done;
         }
-        for(i = 0; i < nfds; ++i)
+        for(int i = 0; i < nfds; ++i)
         {
             struct cconn *io = polled_io_array[i];
             int revents = fds[i].revents;
             if(revents == 0)
             {
                 /* do nothing */
+                continue;
             }
             else if(cconn_validate_revents(io, revents))
             {
                 WARNING("ceph plugin: cconn(name=%s,i=%d,st=%d): "
                 "revents validation error: "
                 "revents=0x%08x", io->d->name, i, io->state, revents);
@@ -1555,13 +1558,13 @@
                     io->request_type = ASOK_REQ_NONE;
                     some_unreachable = 1;
                 }
             }
         }
     }
-    done: for(i = 0; i < g_num_daemons; ++i)
+    done: for(size_t i = 0; i < g_num_daemons; ++i)
     {
         cconn_close(io_array + i);
     }
     if(some_unreachable)
     {
         DEBUG("ceph plugin: cconn_main_loop: some Ceph daemons were unreachable.");
@@ -1578,24 +1581,41 @@
     return cconn_main_loop(ASOK_REQ_DATA);
 }
 
 /******* lifecycle *******/
 static int ceph_init(void)
 {
-    int ret;
+#if defined(HAVE_SYS_CAPABILITY_H) && defined(CAP_DAC_OVERRIDE)
+  if (check_capability (CAP_DAC_OVERRIDE) != 0)
+  {
+    if (getuid () == 0)
+      WARNING ("ceph plugin: Running collectd as root, but the "
+          "CAP_DAC_OVERRIDE capability is missing. The plugin's read "
+          "function will probably fail. Is your init system dropping "
+          "capabilities?");
+    else
+      WARNING ("ceph plugin: collectd doesn't have the CAP_DAC_OVERRIDE "
+          "capability. If you don't want to run collectd as root, try running "
+          "\"setcap cap_dac_override=ep\" on the collectd binary.");
+  }
+#endif
+
     ceph_daemons_print();
 
-    ret = cconn_main_loop(ASOK_REQ_VERSION);
+    if (g_num_daemons < 1)
+    {
+        ERROR ("ceph plugin: No daemons configured. See the \"Daemon\" config option.");
+        return ENOENT;
+    }
 
-    return (ret) ? ret : 0;
+    return cconn_main_loop(ASOK_REQ_VERSION);
 }
 
 static int ceph_shutdown(void)
 {
-    int i;
-    for(i = 0; i < g_num_daemons; ++i)
+    for(size_t i = 0; i < g_num_daemons; ++i)
     {
         ceph_daemon_free(g_daemons[i]);
     }
     sfree(g_daemons);
     g_daemons = NULL;
     g_num_daemons = 0;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ceph_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ceph_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ceph_test.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ceph_test.c	2016-09-11 16:10:25.251038738 +0800
@@ -21,14 +21,14 @@
 
 #include "ceph.c" /* sic */
 #include "testing.h"
 
 struct case_s
 {
-  char *key;
-  char *value;
+  const char *key;
+  const char *value;
 };
 typedef struct case_s case_t;
 
 struct test_s
 {
   case_t *cases;
@@ -133,28 +133,29 @@
 
   yajl_struct ctx = {test_handler, &t};
 
   yajl_handle hndl;
 #if HAVE_YAJL_V2
   hndl = yajl_alloc (&callbacks, NULL, &ctx);
-  CHECK_ZERO (traverse_json ((unsigned char *) json, (uint32_t) strlen (json), hndl));
+  CHECK_ZERO (traverse_json ((const unsigned char *) json, (uint32_t) strlen (json), hndl));
   CHECK_ZERO (yajl_complete_parse (hndl));
 #else
   hndl = yajl_alloc (&callbacks, NULL, NULL, &ctx);
-  CHECK_ZERO (traverse_json ((unsigned char *) json, (uint32_t) strlen (json), hndl));
+  CHECK_ZERO (traverse_json ((const unsigned char *) json, (uint32_t) strlen (json), hndl));
   CHECK_ZERO (yajl_parse_complete (hndl));
 #endif
 
+  yajl_free (hndl);
   return 0;
 }
 
 DEF_TEST(parse_keys)
 {
   struct {
-    char *str;
-    char *want;
+    const char *str;
+    const char *want;
   } cases[] = {
     {"WBThrottle.bytes_dirtied.description.bytes_wb.description.ios_dirtied.description.ios_wb.type", "WBThrottle.bytesDirtied.description.bytesWb.description.iosDirt"},
     {"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb", "Aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"},
     {"foo:bar", "FooBar"},
     {"foo:bar+", "FooBarPlus"},
     {"foo:bar-", "FooBarMinus"},
@@ -165,19 +166,16 @@
     {"WBThrottle.bytes_dirtied.type", "WBThrottle.bytesDirtied"},
   };
   size_t i;
 
   for (i = 0; i < STATIC_ARRAY_SIZE (cases); i++)
   {
-    char got[DATA_MAX_NAME_LEN];
-
-    memset (got, 0, sizeof (got));
+    char got[64];
 
     CHECK_ZERO (parse_keys (got, sizeof (got), cases[i].str));
-
-    CHECK_ZERO (strcmp (got, cases[i].want));
+    EXPECT_EQ_STR (cases[i].want, got);
   }
 
   return 0;
 }
 
 int main (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cgroups.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cgroups.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cgroups.c	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cgroups.c	2016-09-11 16:10:25.251038738 +0800
@@ -19,15 +19,15 @@
  * Authors:
  *   Michael Stapelberg <michael at stapelberg.de>
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_mount.h"
 #include "utils_ignorelist.h"
 
 static char const *config_keys[] =
 {
 	"CGroup",
@@ -203,24 +203,22 @@
 
 	return (-1);
 }
 
 static int cgroups_read (void)
 {
-	cu_mount_t *mnt_list;
-	cu_mount_t *mnt_ptr;
+	cu_mount_t *mnt_list = NULL;
 	_Bool cgroup_found = 0;
 
-	mnt_list = NULL;
 	if (cu_mount_getlist (&mnt_list) == NULL)
 	{
 		ERROR ("cgroups plugin: cu_mount_getlist failed.");
 		return (-1);
 	}
 
-	for (mnt_ptr = mnt_list; mnt_ptr != NULL; mnt_ptr = mnt_ptr->next)
+	for (cu_mount_t *mnt_ptr = mnt_list; mnt_ptr != NULL; mnt_ptr = mnt_ptr->next)
 	{
 		/* Find the cgroup mountpoint which contains the cpuacct
 		 * controller. */
 		if ((strcmp(mnt_ptr->type, "cgroup") != 0)
 				|| !cu_mount_checkoption(mnt_ptr->options,
 					"cpuacct", /* full = */ 1))
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: chrony.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.1	2016-11-29 00:09:58.860483387 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.1	2016-09-11 16:11:14.366971759 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD 1"
-.TH COLLECTD 1 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD 1 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd \- System statistics collection daemon
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.5	2016-11-29 00:09:59.432489455 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.5	2016-09-11 16:11:14.998970922 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD.CONF 5"
-.TH COLLECTD.CONF 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD.CONF 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd.conf \- Configuration for the system statistics collection daemon collectd
@@ -172,13 +172,13 @@
 \&\fBLoadPlugin\fR lines may be omitted for all plugins with a configuration block,
 i.e. a \f(CW\*(C`<Plugin\ ...>\*(C'\fR block.
 .PP
 The syntax of this config file is similar to the config file of the famous
 \&\fIApache\fR webserver. Each line contains either an option (a key and a list of
 one or more values) or a section-start or \-end. Empty lines and everything
-after a non-quoted hash-symbol (\f(CW\*(C`#\*(C'\fR) is ignored. \fIKeys\fR are unquoted
+after a non-quoted hash-symbol (\f(CW\*(C`#\*(C'\fR) are ignored. \fIKeys\fR are unquoted
 strings, consisting only of alphanumeric characters and the underscore (\f(CW\*(C`_\*(C'\fR)
 character. Keys are handled case insensitive by \fIcollectd\fR itself and all
 plugins included with it. \fIValues\fR can either be an \fIunquoted string\fR, a
 \&\fIquoted string\fR (enclosed in double-quotes) a \fInumber\fR or a \fIboolean\fR
 expression. \fIUnquoted strings\fR consist of only alphanumeric characters and
 underscores (\f(CW\*(C`_\*(C'\fR) and do not need to be quoted. \fIQuoted strings\fR are
@@ -201,25 +201,25 @@
 \&\fBLoadPlugin\fR option \fImust\fR occur \fIbefore\fR the appropriate
 \&\f(CW\*(C`<\f(CBPlugin\f(CW ...>\*(C'\fR block.
 .SH "GLOBAL OPTIONS"
 .IX Header "GLOBAL OPTIONS"
 .IP "\fBBaseDir\fR \fIDirectory\fR" 4
 .IX Item "BaseDir Directory"
-Sets the base directory. This is the directory beneath all RRD-files are
+Sets the base directory. This is the directory beneath which all RRD-files are
 created. Possibly more subdirectories are created. This is also the working
 directory for the daemon.
 .IP "\fBLoadPlugin\fR \fIPlugin\fR" 4
 .IX Item "LoadPlugin Plugin"
 Loads the plugin \fIPlugin\fR. This is required to load plugins, unless the
 \&\fBAutoLoadPlugin\fR option is enabled (see below). Without any loaded plugins,
 \&\fIcollectd\fR will be mostly useless.
 .Sp
 Only the first \fBLoadPlugin\fR statement or block for a given plugin name has any
 effect. This is useful when you want to split up the configuration into smaller
 files and want each file to be \*(L"self contained\*(R", i.e. it contains a \fBPlugin\fR
-block \fIand\fR then appropriate \fBLoadPlugin\fR statement. The downside is that if
+block \fIand\fR the appropriate \fBLoadPlugin\fR statement. The downside is that if
 you have multiple conflicting \fBLoadPlugin\fR blocks, e.g. when they specify
 different intervals, only one of them (the first one encountered) will take
 effect and all others will be silently ignored.
 .Sp
 \&\fBLoadPlugin\fR may either be a simple configuration \fIstatement\fR or a \fIblock\fR
 with additional options, affecting the behavior of \fBLoadPlugin\fR. A simple
@@ -258,14 +258,21 @@
 By default, this is disabled. As a special exception, if the plugin name is
 either \f(CW\*(C`perl\*(C'\fR or \f(CW\*(C`python\*(C'\fR, the default is changed to enabled in order to keep
 the average user from ever having to deal with this low level linking stuff.
 .IP "\fBInterval\fR \fISeconds\fR" 4
 .IX Item "Interval Seconds"
 Sets a plugin-specific interval for collecting metrics. This overrides the
-global \fBInterval\fR setting. If a plugin provides own support for specifying an
-interval, that setting will take precedence.
+global \fBInterval\fR setting. If a plugin provides its own support for specifying
+an interval, that setting will take precedence.
+.IP "\fBFlushInterval\fR \fISeconds\fR" 4
+.IX Item "FlushInterval Seconds"
+Specifies the interval, in seconds, to call the flush callback if it's
+defined in this plugin. By default, this is disabled.
+.IP "\fBFlushTimeout\fR \fISeconds\fR" 4
+.IX Item "FlushTimeout Seconds"
+Specifies the value of the timeout argument of the flush callback.
 .RE
 .RS 4
 .RE
 .IP "\fBAutoLoadPlugin\fR \fBfalse\fR|\fBtrue\fR" 4
 .IX Item "AutoLoadPlugin false|true"
 When set to \fBfalse\fR (the default), each plugin needs to be loaded explicitly,
@@ -334,13 +341,13 @@
 arbitrarily mix configuration files and other documents (e.g. \s-1README\s0 files).
 The given example is similar to the first example above but includes all files
 matching \f(CW\*(C`*.conf\*(C'\fR in any subdirectory of \f(CW\*(C`/etc/collectd.d\*(C'\fR.
 .RE
 .RS 4
 .Sp
-If more than one files are included by a single \fBInclude\fR option, the files
+If more than one file is included by a single \fBInclude\fR option, the files
 will be included in lexicographical order (as defined by the \f(CW\*(C`strcmp\*(C'\fR
 function). Thus, you can e.\ g. use numbered prefixes to specify the
 order in which the files are loaded.
 .Sp
 To prevent loops and shooting yourself in the foot in interesting ways the
 nesting is limited to a depth of 8\ levels, which should be sufficient for
@@ -360,30 +367,24 @@
 .IX Item "PluginDir Directory"
 Path to the plugins (shared objects) of collectd.
 .IP "\fBTypesDB\fR \fIFile\fR [\fIFile\fR ...]" 4
 .IX Item "TypesDB File [File ...]"
 Set one or more files that contain the data-set descriptions. See
 \&\fItypes.db\fR\|(5) for a description of the format of this file.
-.Sp
-If this option is not specified, a default file is read. If you need to define
-custom types in addition to the types defined in the default file, you need to
-explicitly load both. In other words, if the \fBTypesDB\fR option is encountered
-the default behavior is disabled and if you need the default types you have to
-also explicitly load them.
 .IP "\fBInterval\fR \fISeconds\fR" 4
 .IX Item "Interval Seconds"
 Configures the interval in which to query the read plugins. Obviously smaller
 values lead to a higher system load produced by collectd, while higher values
 lead to more coarse statistics.
 .Sp
 \&\fBWarning:\fR You should set this once and then never touch it again. If you do,
 \&\fIyou will have to delete all your \s-1RRD\s0 files\fR or know some serious RRDtool
 magic! (Assuming you're using the \fIRRDtool\fR or \fIRRDCacheD\fR plugin.)
 .IP "\fBMaxReadInterval\fR \fISeconds\fR" 4
 .IX Item "MaxReadInterval Seconds"
-Read plugin doubles interval between queries after each failed attempt
+A read plugin doubles the interval between queries after each failed attempt
 to get data.
 .Sp
 This options limits the maximum value of the interval. The default value is
 \&\fB86400\fR.
 .IP "\fBTimeout\fR \fIIterations\fR" 4
 .IX Item "Timeout Iterations"
@@ -636,13 +637,15 @@
 .ie n .SS "Plugin ""amqp"""
 .el .SS "Plugin \f(CWamqp\fP"
 .IX Subsection "Plugin amqp"
 The \fI\s-1AMQP\s0 plugin\fR can be used to communicate with other instances of
 \&\fIcollectd\fR or third party applications using an \s-1AMQP\s0 message broker. Values
 are sent to or received from the broker, which handles routing, queueing and
-possibly filtering or messages.
+possibly filtering out messages.
+.PP
+\&\fBSynopsis:\fR
 .PP
 .Vb 10
 \& <Plugin "amqp">
 \&   # Send values to an AMQP broker
 \&   <Publish "some_name">
 \&     Host "localhost"
@@ -903,17 +906,28 @@
 Hostname of the host running \fBapcupsd\fR. Defaults to \fBlocalhost\fR. Please note
 that IPv6 support has been disabled unless someone can confirm or decline that
 \&\fBapcupsd\fR can handle it.
 .IP "\fBPort\fR \fIPort\fR" 4
 .IX Item "Port Port"
 TCP-Port to connect to. Defaults to \fB3551\fR.
-.IP "\fBReportSeconds\fR \fBtrue|false\fR" 4
+.IP "\fBReportSeconds\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "ReportSeconds true|false"
 If set to \fBtrue\fR, the time reported in the \f(CW\*(C`timeleft\*(C'\fR metric will be
 converted to seconds. This is the recommended setting. If set to \fBfalse\fR, the
 default for backwards compatibility, the time will be reported in minutes.
+.IP "\fBPersistentConnection\fR \fBtrue\fR|\fBfalse\fR" 4
+.IX Item "PersistentConnection true|false"
+The plugin is designed to keep the connection to \fIapcupsd\fR open between reads.
+If plugin poll interval is greater than 15 seconds (hardcoded socket close
+timeout in \fIapcupsd\fR \s-1NIS\s0), then this option is \fBfalse\fR by default.
+.Sp
+You can instruct the plugin to close the connection after each read by setting
+this option to \fBfalse\fR or force keeping the connection by setting it to \fBtrue\fR.
+.Sp
+If \fIapcupsd\fR appears to close the connection due to inactivity quite quickly,
+the plugin will try to detect this problem and switch to an open-read-close mode.
 .ie n .SS "Plugin ""aquaero"""
 .el .SS "Plugin \f(CWaquaero\fP"
 .IX Subsection "Plugin aquaero"
 This plugin collects the value of the available sensors in an
 \&\fIAquaero\ 5\fR board. Aquaero\ 5 is a water-cooling controller board,
 manufactured by Aqua Computer GmbH <http://www.aquacomputer.de/>, with a \s-1USB2\s0
@@ -995,13 +1009,13 @@
 It was developed and tested under Linux only. The only platform dependency is
 the standard Linux i2c\-dev interface (the particular bus driver has to
 support the \s-1SM\s0 Bus command subset).
 .PP
 The reduction or normalization to mean sea level pressure requires (depending
 on selected method/approximation) also altitude and reference to temperature
-sensor(s).  When multiple temperature sensors are configured the minimum of
+sensor(s).  When multiple temperature sensors are configured the minumum of
 their values is always used (expecting that the warmer ones are affected by
 e.g. direct sun light at that moment).
 .PP
 Synopsis:
 .PP
 .Vb 9
@@ -1099,13 +1113,13 @@
 .PD
 The altitude (in meters) of the location where you meassure the pressure.
 .IP "\fBTemperatureSensor\fR \fIreference\fR" 4
 .IX Item "TemperatureSensor reference"
 Temperature sensor(s) which should be used as a reference when normalizing the
 pressure using \f(CW\*(C`Normalization\*(C'\fR method 2.
-When specified more sensors a minimum is found and used each time.  The
+When specified more sensors a minumum is found and used each time.  The
 temperature reading directly from this pressure sensor/plugin is typically not
 suitable as the pressure sensor will be probably inside while we want outside
 temperature.  The collectd reference name is something like
 <hostname>/<plugin_name>\-<plugin_instance>/<type>\-<type_instance>
 (<type_instance> is usually omitted when there is just single value type). Or
 you can figure it out from the path of the output data files.
@@ -1355,12 +1369,31 @@
 .IP "\fBIgnoreSelected\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "IgnoreSelected true|false"
 Invert the selection: If set to true, all cgroups \fIexcept\fR the ones that
 match any one of the criteria are collected. By default only selected
 cgroups are collected if a selection is made. If no selection is configured
 at all, \fBall\fR cgroups are selected.
+.ie n .SS "Plugin ""chrony"""
+.el .SS "Plugin \f(CWchrony\fP"
+.IX Subsection "Plugin chrony"
+The \f(CW\*(C`chrony\*(C'\fR plugin collects ntp data from a \fBchronyd\fR server, such as clock
+skew and per-peer stratum.
+.PP
+For talking to \fBchronyd\fR, it mimics what the \fBchronyc\fR control program does
+on the wire.
+.PP
+Available configuration options for the \f(CW\*(C`chrony\*(C'\fR plugin:
+.IP "\fBHost\fR \fIHostname\fR" 4
+.IX Item "Host Hostname"
+Hostname of the host running \fBchronyd\fR. Defaults to \fBlocalhost\fR.
+.IP "\fBPort\fR \fIPort\fR" 4
+.IX Item "Port Port"
+UDP-Port to connect to. Defaults to \fB323\fR.
+.IP "\fBTimeout\fR \fITimeout\fR" 4
+.IX Item "Timeout Timeout"
+Connection timeout in seconds. Defaults to \fB2\fR.
 .ie n .SS "Plugin ""conntrack"""
 .el .SS "Plugin \f(CWconntrack\fP"
 .IX Subsection "Plugin conntrack"
 This plugin collects \s-1IP\s0 conntrack statistics.
 .IP "\fBOldFiles\fR" 4
 .IX Item "OldFiles"
@@ -1397,20 +1430,34 @@
 .IP "\fBValuesPercentage\fR \fBfalse\fR|\fBtrue\fR" 4
 .IX Item "ValuesPercentage false|true"
 This option is only considered when both, \fBReportByCpu\fR and \fBReportByState\fR
 are set to \fBtrue\fR. In this case, by default, metrics will be reported as
 Jiffies. By setting this option to \fBtrue\fR, you can request percentage values
 in the un-aggregated (per-CPU, per-state) mode as well.
+.IP "\fBReportNumCpu\fR \fBfalse\fR|\fBtrue\fR" 4
+.IX Item "ReportNumCpu false|true"
+When set to \fBtrue\fR, reports the number of available CPUs.
+Defaults to \fBfalse\fR.
 .ie n .SS "Plugin ""cpufreq"""
 .el .SS "Plugin \f(CWcpufreq\fP"
 .IX Subsection "Plugin cpufreq"
 This plugin doesn't have any options. It reads
 \&\fI/sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq\fR (for the first \s-1CPU\s0
 installed) to get the current \s-1CPU\s0 frequency. If this file does not exist make
 sure \fBcpufreqd\fR (<http://cpufreqd.sourceforge.net/>) or a similar tool is
 installed and an \*(L"cpu governor\*(R" (that's a kernel module) is loaded.
+.ie n .SS "Plugin ""cpusleep"""
+.el .SS "Plugin \f(CWcpusleep\fP"
+.IX Subsection "Plugin cpusleep"
+This plugin doesn't have any options. It reads \s-1CLOCK_BOOTTIME\s0 and
+\&\s-1CLOCK_MONOTONIC\s0 and reports the difference between these clocks. Since
+\&\s-1BOOTTIME\s0 clock increments while device is suspended and \s-1MONOTONIC\s0
+clock does not, the derivative of the difference between these clocks
+gives the relative amount of time the device has spent in suspend
+state. The recorded value is in milliseconds of sleep per seconds of
+wall clock.
 .ie n .SS "Plugin ""csv"""
 .el .SS "Plugin \f(CWcsv\fP"
 .IX Subsection "Plugin csv"
 .IP "\fBDataDir\fR \fIDirectory\fR" 4
 .IX Item "DataDir Directory"
 Set the directory to store CSV-files under. Per default CSV-files are generated
@@ -1420,12 +1467,76 @@
 much sense when collectd is running in foreground\- or non-daemon-mode.
 .IP "\fBStoreRates\fR \fBtrue|false\fR" 4
 .IX Item "StoreRates true|false"
 If set to \fBtrue\fR, convert counter values to rates. If set to \fBfalse\fR (the
 default) counter values are stored as is, i.\ e. as an increasing integer
 number.
+.SS "cURL Statistics"
+.IX Subsection "cURL Statistics"
+All cURL-based plugins support collection of generic, request-based
+statistics. These are disabled by default and can be enabled selectively for
+each page or \s-1URL\s0 queried from the curl, curl_json, or curl_xml plugins. See
+the documentation of those plugins for specific information. This section
+describes the available metrics that can be configured for each plugin. All
+options are disabled by default.
+.PP
+See <http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html> for more details.
+.IP "\fBTotalTime\fR \fBtrue|false\fR" 4
+.IX Item "TotalTime true|false"
+Total time of the transfer, including name resolving, \s-1TCP\s0 connect, etc.
+.IP "\fBNamelookupTime\fR \fBtrue|false\fR" 4
+.IX Item "NamelookupTime true|false"
+Time it took from the start until name resolving was completed.
+.IP "\fBConnectTime\fR \fBtrue|false\fR" 4
+.IX Item "ConnectTime true|false"
+Time it took from the start until the connect to the remote host (or proxy)
+was completed.
+.IP "\fBAppconnectTime\fR \fBtrue|false\fR" 4
+.IX Item "AppconnectTime true|false"
+Time it took from the start until the \s-1SSL/SSH\s0 connect/handshake to the remote
+host was completed.
+.IP "\fBPretransferTime\fR \fBtrue|false\fR" 4
+.IX Item "PretransferTime true|false"
+Time it took from the start until just before the transfer begins.
+.IP "\fBStarttransferTime\fR \fBtrue|false\fR" 4
+.IX Item "StarttransferTime true|false"
+Time it took from the start until the first byte was received.
+.IP "\fBRedirectTime\fR \fBtrue|false\fR" 4
+.IX Item "RedirectTime true|false"
+Time it took for all redirection steps include name lookup, connect,
+pre-transfer and transfer before final transaction was started.
+.IP "\fBRedirectCount\fR \fBtrue|false\fR" 4
+.IX Item "RedirectCount true|false"
+The total number of redirections that were actually followed.
+.IP "\fBSizeUpload\fR \fBtrue|false\fR" 4
+.IX Item "SizeUpload true|false"
+The total amount of bytes that were uploaded.
+.IP "\fBSizeDownload\fR \fBtrue|false\fR" 4
+.IX Item "SizeDownload true|false"
+The total amount of bytes that were downloaded.
+.IP "\fBSpeedDownload\fR \fBtrue|false\fR" 4
+.IX Item "SpeedDownload true|false"
+The average download speed that curl measured for the complete download.
+.IP "\fBSpeedUpload\fR \fBtrue|false\fR" 4
+.IX Item "SpeedUpload true|false"
+The average upload speed that curl measured for the complete upload.
+.IP "\fBHeaderSize\fR \fBtrue|false\fR" 4
+.IX Item "HeaderSize true|false"
+The total size of all the headers received.
+.IP "\fBRequestSize\fR \fBtrue|false\fR" 4
+.IX Item "RequestSize true|false"
+The total size of the issued requests.
+.IP "\fBContentLengthDownload\fR \fBtrue|false\fR" 4
+.IX Item "ContentLengthDownload true|false"
+The content-length of the download.
+.IP "\fBContentLengthUpload\fR \fBtrue|false\fR" 4
+.IX Item "ContentLengthUpload true|false"
+The specified size of the upload.
+.IP "\fBNumConnects\fR \fBtrue|false\fR" 4
+.IX Item "NumConnects true|false"
+The number of new connections that were created to achieve the transfer.
 .ie n .SS "Plugin ""curl"""
 .el .SS "Plugin \f(CWcurl\fP"
 .IX Subsection "Plugin curl"
 The curl plugin uses the \fBlibcurl\fR (<http://curl.haxx.se/>) to read web pages
 and the match infrastructure (the same code used by the tail plugin) to use
 regular expressions with the received data.
@@ -1510,16 +1621,25 @@
 Measure response time for the request. If this setting is enabled, \fBMatch\fR
 blocks (see below) are optional. Disabled by default.
 .Sp
 Beware that requests will get aborted if they take too long to complete. Adjust
 \&\fBTimeout\fR accordingly if you expect \fBMeasureResponseTime\fR to report such slow
 requests.
+.Sp
+This option is similar to enabling the \fBTotalTime\fR statistic but it's
+measured by collectd instead of cURL.
 .IP "\fBMeasureResponseCode\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "MeasureResponseCode true|false"
 Measure response code for the request. If this setting is enabled, \fBMatch\fR
 blocks (see below) are optional. Disabled by default.
+.IP "\fB<Statistics>\fR" 4
+.IX Item "<Statistics>"
+One \fBStatistics\fR block can be used to specify cURL statistics to be collected
+for each request to the remote web site. See the section \*(L"cURL Statistics\*(R"
+above for details. If this setting is enabled, \fBMatch\fR blocks (see below) are
+optional.
 .IP "\fB<Match>\fR" 4
 .IX Item "<Match>"
 One or more \fBMatch\fR blocks that define how to match information in the data
 returned by \f(CW\*(C`libcurl\*(C'\fR. The \f(CW\*(C`curl\*(C'\fR plugin uses the same infrastructure that's
 used by the \f(CW\*(C`tail\*(C'\fR plugin, so please see the documentation of the \f(CW\*(C`tail\*(C'\fR
 plugin below on how matches are defined. If the \fBMeasureResponseTime\fR or
@@ -1594,12 +1714,16 @@
 The \fBKey\fR string argument must be in a path format. Each component is
 used to match the key from a \s-1JSON\s0 map or the index of an \s-1JSON\s0
 array. If a path component of a \fBKey\fR is a \fI*\fR\ wildcard, the
 values for all map keys or array indices will be collectd.
 .PP
 The following options are valid within \fB\s-1URL\s0\fR blocks:
+.IP "\fBHost\fR \fIName\fR" 4
+.IX Item "Host Name"
+Use \fIName\fR as the host name when submitting values. Defaults to the global
+host name setting.
 .IP "\fBInstance\fR \fIInstance\fR" 4
 .IX Item "Instance Instance"
 Sets the plugin instance to \fIInstance\fR.
 .IP "\fBInterval\fR \fIInterval\fR" 4
 .IX Item "Interval Interval"
 Sets the interval (in seconds) in which the values will be collected from this
@@ -1623,12 +1747,17 @@
 .IX Item "Post Body"
 .IP "\fBTimeout\fR \fIMilliseconds\fR" 4
 .IX Item "Timeout Milliseconds"
 .PD
 These options behave exactly equivalent to the appropriate options of the
 \&\fIcURL\fR plugin. Please see there for a detailed description.
+.IP "\fB<Statistics>\fR" 4
+.IX Item "<Statistics>"
+One \fBStatistics\fR block can be used to specify cURL statistics to be collected
+for each request to the remote \s-1URL.\s0 See the section \*(L"cURL Statistics\*(R" above
+for details.
 .PP
 The following options are valid within \fBKey\fR blocks:
 .IP "\fBType\fR \fIType\fR" 4
 .IX Item "Type Type"
 Sets the type used to dispatch the values to the daemon. Detailed information
 about types and their configuration can be found in \fItypes.db\fR\|(5). This
@@ -1717,12 +1846,17 @@
 .IX Item "Post Body"
 .IP "\fBTimeout\fR \fIMilliseconds\fR" 4
 .IX Item "Timeout Milliseconds"
 .PD
 These options behave exactly equivalent to the appropriate options of the
 \&\fIcURL plugin\fR. Please see there for a detailed description.
+.IP "\fB<Statistics>\fR" 4
+.IX Item "<Statistics>"
+One \fBStatistics\fR block can be used to specify cURL statistics to be collected
+for each request to the remote \s-1URL.\s0 See the section \*(L"cURL Statistics\*(R" above
+for details.
 .IP "<\fBXPath\fR \fIXPath-expression\fR>" 4
 .IX Item "<XPath XPath-expression>"
 Within each \fB\s-1URL\s0\fR block, there must be one or more \fBXPath\fR blocks. Each
 \&\fBXPath\fR block specifies how to get one type of information. The string
 argument must be a valid XPath expression which returns a list of \*(L"base
 elements\*(R". One value is dispatched for each \*(L"base element\*(R".
@@ -1784,12 +1918,13 @@
 \&        InstancesFrom "category"
 \&        ValuesFrom "value"
 \&      </Result>
 \&    </Query>
 \&    <Database "product_information">
 \&      Driver "mysql"
+\&      Interval 120
 \&      DriverOption "host" "localhost"
 \&      DriverOption "username" "collectd"
 \&      DriverOption "password" "aZo6daiw"
 \&      DriverOption "dbname" "prod_info"
 \&      SelectDB "prod_info"
 \&      Query "out_of_stock"
@@ -1960,12 +2095,16 @@
 of databases, the configuration is very generic. If in doubt, refer to libdbi's
 documentation\ \- we stick as close to the terminology used there.
 .PP
 Each database needs a \*(L"name\*(R" as string argument in the starting tag of the
 block. This name will be used as \*(L"PluginInstance\*(R" in the values submitted to
 the daemon. Other than that, that name is not used.
+.IP "\fBInterval\fR \fIInterval\fR" 4
+.IX Item "Interval Interval"
+Sets the interval (in seconds) in which the values will be collected from this
+database. By default the global \fBInterval\fR setting will be used.
 .IP "\fBDriver\fR \fIDriver\fR" 4
 .IX Item "Driver Driver"
 Specifies the driver to use to connect to the database. In many cases those
 drivers are named after the database they can connect to, but this is not a
 technical necessity. These drivers are sometimes referred to as \*(L"\s-1DBD\*(R",
 \&\s0\fBD\fRata\fBB\fRase \fBD\fRriver, and some distributions ship them in separate
@@ -1996,13 +2135,13 @@
 .Sp
 Unfortunately, drivers are not too keen to report errors when an unknown option
 is passed to them, so invalid settings here may go unnoticed. This is not the
 plugin's fault, it will report errors if it gets them from the library\ /
 the driver. If a driver complains about an option, the plugin will dump a
 complete list of all options understood by that driver to the log. There is no
-way to programmatically find out if an option expects a string or a numeric
+way to programatically find out if an option expects a string or a numeric
 argument, so you will have to refer to the appropriate \s-1DBD\s0's documentation to
 find this out. Sorry.
 .IP "\fBSelectDB\fR \fIDatabase\fR" 4
 .IX Item "SelectDB Database"
 In some cases, the database name you connect with is not the database name you
 want to use for querying data. If this option is set, the plugin will \*(L"select\*(R"
@@ -2165,13 +2304,13 @@
 By default, the plugin will submit values as type \f(CW\*(C`derive\*(C'\fR and \fItype
 instance\fR set to \fIName\fR, the name of the metric as reported by the driver. If
 an appropriate \fBMap\fR option exists, the given \fIType\fR and, optionally,
 \&\fITypeInstance\fR will be used.
 .IP "\fBMappedOnly\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "MappedOnly true|false"
-When set to \fBtrue\fR, only metrics that can be mapped to to a \fItype\fR will be
+When set to \fBtrue\fR, only metrics that can be mapped to a \fItype\fR will be
 collected, all other metrics will be ignored. Defaults to \fBfalse\fR.
 .ie n .SS "Plugin ""exec"""
 .el .SS "Plugin \f(CWexec\fP"
 .IX Subsection "Plugin exec"
 Please make sure to read \fIcollectd\-exec\fR\|(5) before using this plugin. It
 contains valuable information on when the executable is executed and the
@@ -2354,12 +2493,133 @@
 .IX Item "DataSource Name"
 Data source to map this metric to. If the configured type has exactly one data
 source, this is optional. Otherwise the option is required.
 .RE
 .RS 4
 .RE
+.ie n .SS "Plugin ""gps"""
+.el .SS "Plugin \f(CWgps\fP"
+.IX Subsection "Plugin gps"
+The \f(CW\*(C`gps plugin\*(C'\fR connects to gpsd on the host machine.
+The host, port, timeout and pause are configurable.
+.PP
+This is useful if you run an \s-1NTP\s0 server using a \s-1GPS\s0 for source and you want to
+monitor it.
+.PP
+Mind your \s-1GPS\s0 must send $\-\-GSA for having the data reported!
+.PP
+The following elements are collected:
+.IP "\fBsatellites\fR" 4
+.IX Item "satellites"
+Number of satellites used for fix (type instance \*(L"used\*(R") and in view (type
+instance \*(L"visible\*(R"). 0 means no \s-1GPS\s0 satellites are visible.
+.IP "\fBdilution_of_precision\fR" 4
+.IX Item "dilution_of_precision"
+Vertical and horizontal dilution (type instance \*(L"horizontal\*(R" or \*(L"vertical\*(R").
+It should be between 0 and 3.
+Look at the documentation of your \s-1GPS\s0 to know more.
+.PP
+Synopsis:
+.PP
+.Vb 10
+\& LoadPlugin gps
+\& <Plugin "gps">
+\&   # Connect to localhost on gpsd regular port:
+\&   Host "127.0.0.1"
+\&   Port "2947"
+\&   # 15 ms timeout
+\&   Timeout 0.015
+\&   # PauseConnect of 5 sec. between connection attempts.
+\&   PauseConnect 5
+\& </Plugin>
+.Ve
+.PP
+Available configuration options:
+.IP "\fBHost\fR \fIHost\fR" 4
+.IX Item "Host Host"
+The host on which gpsd daemon runs. Defaults to \fBlocalhost\fR.
+.IP "\fBPort\fR \fIPort\fR" 4
+.IX Item "Port Port"
+Port to connect to gpsd on the host machine. Defaults to \fB2947\fR.
+.IP "\fBTimeout\fR \fISeconds\fR" 4
+.IX Item "Timeout Seconds"
+Timeout in seconds (default 0.015 sec).
+.Sp
+The \s-1GPS\s0 data stream is fetch by the plugin form the daemon.
+It waits for data to be available, if none arrives it times out
+and loop for another reading.
+Mind to put a low value gpsd expects value in the micro-seconds area
+(recommended is 500 us) since the waiting function is blocking.
+Value must be between 500 us and 5 sec., if outside that range the
+default value is applied.
+.Sp
+This only applies from gpsd release\-2.95.
+.IP "\fBPauseConnect\fR \fISeconds\fR" 4
+.IX Item "PauseConnect Seconds"
+Pause to apply between attempts of connection to gpsd in seconds (default 5 sec).
+.ie n .SS "Plugin ""grpc"""
+.el .SS "Plugin \f(CWgrpc\fP"
+.IX Subsection "Plugin grpc"
+The \fIgrpc\fR plugin provides an \s-1RPC\s0 interface to submit values to or query
+values from collectd based on the open source gRPC framework. It exposes an
+end-point for dispatching values to the daemon.
+.PP
+The \fBgRPC\fR homepage can be found at <https://grpc.io/>.
+.IP "\fBServer\fR \fIHost\fR \fIPort\fR" 4
+.IX Item "Server Host Port"
+The \fBServer\fR statement sets the address of a server to which to send metrics
+via the \f(CW\*(C`DispatchValues\*(C'\fR function.
+.Sp
+The argument \fIHost\fR may be a hostname, an IPv4 address, or an IPv6 address.
+.Sp
+Optionally, \fBServer\fR may be specified as a configuration block which supports
+the following options:
+.RS 4
+.IP "\fBEnableSSL\fR \fBfalse\fR|\fBtrue\fR" 4
+.IX Item "EnableSSL false|true"
+Whether to require \s-1SSL\s0 for outgoing connections. Default: false.
+.IP "\fBSSLCACertificateFile\fR \fIFilename\fR" 4
+.IX Item "SSLCACertificateFile Filename"
+.PD 0
+.IP "\fBSSLCertificateFile\fR \fIFilename\fR" 4
+.IX Item "SSLCertificateFile Filename"
+.IP "\fBSSLCertificateKeyFile\fR \fIFilename\fR" 4
+.IX Item "SSLCertificateKeyFile Filename"
+.PD
+Filenames specifying \s-1SSL\s0 certificate and key material to be used with \s-1SSL\s0
+connections.
+.RE
+.RS 4
+.RE
+.IP "\fBListen\fR \fIHost\fR \fIPort\fR" 4
+.IX Item "Listen Host Port"
+The \fBListen\fR statement sets the network address to bind to. When multiple
+statements are specified, the daemon will bind to all of them. If none are
+specified, it defaults to \fB0.0.0.0:50051\fR.
+.Sp
+The argument \fIHost\fR may be a hostname, an IPv4 address, or an IPv6 address.
+.Sp
+Optionally, \fBListen\fR may be specified as a configuration block which
+supports the following options:
+.RS 4
+.IP "\fBEnableSSL\fR \fItrue\fR|\fIfalse\fR" 4
+.IX Item "EnableSSL true|false"
+Whether to enable \s-1SSL\s0 for incoming connections. Default: false.
+.IP "\fBSSLCACertificateFile\fR \fIFilename\fR" 4
+.IX Item "SSLCACertificateFile Filename"
+.PD 0
+.IP "\fBSSLCertificateFile\fR \fIFilename\fR" 4
+.IX Item "SSLCertificateFile Filename"
+.IP "\fBSSLCertificateKeyFile\fR \fIFilename\fR" 4
+.IX Item "SSLCertificateKeyFile Filename"
+.PD
+Filenames specifying \s-1SSL\s0 certificate and key material to be used with \s-1SSL\s0
+connections.
+.RE
+.RS 4
+.RE
 .ie n .SS "Plugin ""hddtemp"""
 .el .SS "Plugin \f(CWhddtemp\fP"
 .IX Subsection "Plugin hddtemp"
 To get values from \fBhddtemp\fR collectd connects to \fBlocalhost\fR (127.0.0.1),
 port \fB7634/tcp\fR. The \fBHost\fR and \fBPort\fR options can be used to change these
 default values, see below. \f(CW\*(C`hddtemp\*(C'\fR has to be running to work correctly. If
@@ -2406,12 +2666,34 @@
 \& IgnoreSelected "true"
 .Ve
 .Sp
 This will ignore the loopback interface, all interfaces with names starting
 with \fIveth\fR and all interfaces with names starting with \fItun\fR followed by
 at least one digit.
+.IP "\fBReportInactive\fR \fItrue\fR|\fIfalse\fR" 4
+.IX Item "ReportInactive true|false"
+When set to \fIfalse\fR, only interfaces with non-zero traffic will be
+reported. Note that the check is done by looking into whether a
+package was sent at any time from boot and the corresponding counter
+is non-zero. So, if the interface has been sending data in the past
+since boot, but not during the reported time-interval, it will still
+be reported.
+.Sp
+The default value is \fItrue\fR and results in collection of the data
+from all interfaces that are selected by \fBInterface\fR and
+\&\fBIgnoreSelected\fR options.
+.IP "\fBUniqueName\fR \fItrue\fR|\fIfalse\fR" 4
+.IX Item "UniqueName true|false"
+Interface name is not unique on Solaris (\s-1KSTAT\s0), interface name is unique
+only within a module/instance. Following tuple is considered unique:
+   (ks_module, ks_instance, ks_name)
+If this option is set to true, interface name contains above three fields
+separated by an underscore. For more info on \s-1KSTAT,\s0 visit
+<http://docs.oracle.com/cd/E23824_01/html/821\-1468/kstat\-3kstat.html#REFMAN3Ekstat\-3kstat>
+.Sp
+This option is only available on Solaris.
 .ie n .SS "Plugin ""ipmi"""
 .el .SS "Plugin \f(CWipmi\fP"
 .IX Subsection "Plugin ipmi"
 .IP "\fBSensor\fR \fISensor\fR" 4
 .IX Item "Sensor Sensor"
 Selects sensors to collect or to ignore, depending on \fBIgnoreSelected\fR.
@@ -2601,12 +2883,17 @@
 .IX Item "ReportBySerial false|true"
 If enabled, the serial of the physical machine the partition is currently
 running on is reported as \fIhostname\fR and the logical hostname of the machine
 is reported in the \fIplugin instance\fR. Otherwise, the logical hostname will be
 used (just like other plugins) and the \fIplugin instance\fR will be empty.
 Defaults to false.
+.ie n .SS "Plugin ""lua"""
+.el .SS "Plugin \f(CWlua\fP"
+.IX Subsection "Plugin lua"
+This plugin embeds a Lua interpreter into collectd and provides an interface
+to collectd's plugin system. See \fIcollectd\-lua\fR\|(5) for its documentation.
 .ie n .SS "Plugin ""mbmon"""
 .el .SS "Plugin \f(CWmbmon\fP"
 .IX Subsection "Plugin mbmon"
 The \f(CW\*(C`mbmon plugin\*(C'\fR uses mbmon to retrieve temperature, voltage, etc.
 .PP
 Be default collectd connects to \fBlocalhost\fR (127.0.0.1), port \fB411/tcp\fR. The
@@ -3005,12 +3292,132 @@
 .RE
 .RS 4
 .RE
 .RE
 .RS 4
 .RE
+.ie n .SS "Plugin ""mqtt"""
+.el .SS "Plugin \f(CWmqtt\fP"
+.IX Subsection "Plugin mqtt"
+The \fI\s-1MQTT\s0 plugin\fR can send metrics to \s-1MQTT \s0(\fBPublish\fR blocks) and receive
+values from \s-1MQTT \s0(\fBSubscribe\fR blocks).
+.PP
+\&\fBSynopsis:\fR
+.PP
+.Vb 10
+\& <Plugin mqtt>
+\&   <Publish "name">
+\&     Host "mqtt.example.com"
+\&     Prefix "collectd"
+\&   </Publish>
+\&   <Subscribe "name">
+\&     Host "mqtt.example.com"
+\&     Topic "collectd/#"
+\&   </Subscribe>
+\& </Plugin>
+.Ve
+.PP
+The plugin's configuration is in \fBPublish\fR and/or \fBSubscribe\fR blocks,
+configuring the sending and receiving direction respectively. The plugin will
+register a write callback named \f(CW\*(C`mqtt/\f(CIname\f(CW\*(C'\fR where \fIname\fR is the string
+argument given to the \fBPublish\fR block. Both types of blocks share many but not
+all of the following options. If an option is valid in only one of the blocks,
+it will be mentioned explicitly.
+.PP
+\&\fBOptions:\fR
+.IP "\fBHost\fR \fIHostname\fR" 4
+.IX Item "Host Hostname"
+Hostname of the \s-1MQTT\s0 broker to connect to.
+.IP "\fBPort\fR \fIService\fR" 4
+.IX Item "Port Service"
+Port number or service name of the \s-1MQTT\s0 broker to connect to.
+.IP "\fBUser\fR \fIUserName\fR" 4
+.IX Item "User UserName"
+Username used when authenticating to the \s-1MQTT\s0 broker.
+.IP "\fBPassword\fR \fIPassword\fR" 4
+.IX Item "Password Password"
+Password used when authenticating to the \s-1MQTT\s0 broker.
+.IP "\fBClientId\fR \fIClientId\fR" 4
+.IX Item "ClientId ClientId"
+\&\s-1MQTT\s0 client \s-1ID\s0 to use. Defaults to the hostname used by \fIcollectd\fR.
+.IP "\fBQoS\fR [\fB0\fR\-\fB2\fR]" 4
+.IX Item "QoS [0-2]"
+Sets the \fIQuality of Service\fR, with the values \f(CW0\fR, \f(CW1\fR and \f(CW2\fR meaning:
+.RS 4
+.IP "\fB0\fR" 4
+.IX Item "0"
+At most once
+.IP "\fB1\fR" 4
+.IX Item "1"
+At least once
+.IP "\fB2\fR" 4
+.IX Item "2"
+Exactly once
+.RE
+.RS 4
+.Sp
+In \fBPublish\fR blocks, this option determines the QoS flag set on outgoing
+messages and defaults to \fB0\fR. In \fBSubscribe\fR blocks, determines the maximum
+QoS setting the client is going to accept and defaults to \fB2\fR. If the QoS flag
+on a message is larger than the maximum accepted QoS of a subscriber, the
+message's QoS will be downgraded.
+.RE
+.IP "\fBPrefix\fR \fIPrefix\fR (Publish only)" 4
+.IX Item "Prefix Prefix (Publish only)"
+This plugin will use one topic per \fIvalue list\fR which will looks like a path.
+\&\fIPrefix\fR is used as the first path element and defaults to \fBcollectd\fR.
+.Sp
+An example topic name would be:
+.Sp
+.Vb 1
+\& collectd/cpu\-0/cpu\-user
+.Ve
+.IP "\fBRetain\fR \fBfalse\fR|\fBtrue\fR (Publish only)" 4
+.IX Item "Retain false|true (Publish only)"
+Controls whether the \s-1MQTT\s0 broker will retain (keep a copy of) the last message
+sent to each topic and deliver it to new subscribers. Defaults to \fBfalse\fR.
+.IP "\fBStoreRates\fR \fBtrue\fR|\fBfalse\fR (Publish only)" 4
+.IX Item "StoreRates true|false (Publish only)"
+Controls whether \f(CW\*(C`DERIVE\*(C'\fR and \f(CW\*(C`COUNTER\*(C'\fR metrics are converted to a \fIrate\fR
+before sending. Defaults to \fBtrue\fR.
+.IP "\fBCleanSession\fR \fBtrue\fR|\fBfalse\fR (Subscribe only)" 4
+.IX Item "CleanSession true|false (Subscribe only)"
+Controls whether the \s-1MQTT \s0\*(L"cleans\*(R" the session up after the subscriber
+disconnects or if it maintains the subscriber's subscriptions and all messages
+that arrive while the subscriber is disconnected. Defaults to \fBtrue\fR.
+.IP "\fBTopic\fR \fITopicName\fR (Subscribe only)" 4
+.IX Item "Topic TopicName (Subscribe only)"
+Configures the topic(s) to subscribe to. You can use the single level \f(CW\*(C`+\*(C'\fR and
+multi level \f(CW\*(C`#\*(C'\fR wildcards. Defaults to \fBcollectd/#\fR, i.e. all topics beneath
+the \fBcollectd\fR branch.
+.IP "\fBCACert\fR \fIfile\fR" 4
+.IX Item "CACert file"
+Path to the PEM-encoded \s-1CA\s0 certificate file. Setting this option enables \s-1TLS\s0
+communication with the \s-1MQTT\s0 broker, and as such, \fBPort\fR should be the TLS-enabled
+port of the \s-1MQTT\s0 broker.
+A valid \s-1TLS\s0 configuration requires \fBCACert\fR, \fBCertificateFile\fR and \fBCertificateKeyFile\fR.
+.IP "\fBCertificateFile\fR \fIfile\fR" 4
+.IX Item "CertificateFile file"
+Path to the PEM-encoded certificate file to use as client certificate when
+connecting to the \s-1MQTT\s0 broker.
+A valid \s-1TLS\s0 configuration requires \fBCACert\fR, \fBCertificateFile\fR and \fBCertificateKeyFile\fR.
+.IP "\fBCertificateKeyFile\fR \fIfile\fR" 4
+.IX Item "CertificateKeyFile file"
+Path to the unencrypted PEM-encoded key file corresponding to \fBCertificateFile\fR.
+A valid \s-1TLS\s0 configuration requires \fBCACert\fR, \fBCertificateFile\fR and \fBCertificateKeyFile\fR.
+.IP "\fBTLSProtocol\fR \fIprotocol\fR" 4
+.IX Item "TLSProtocol protocol"
+If configured, this specifies the string protocol version (e.g. \f(CW\*(C`tlsv1\*(C'\fR,
+\&\f(CW\*(C`tlsv1.2\*(C'\fR) to use for the \s-1TLS\s0 connection to the broker. If not set a default
+version is used which depends on the version of OpenSSL the Mosquitto library
+was linked against.
+.IP "\fBCipherSuite\fR \fIciphersuite\fR" 4
+.IX Item "CipherSuite ciphersuite"
+A string describing the ciphers available for use. See \fIciphers\fR\|(1) and the
+\&\f(CW\*(C`openssl ciphers\*(C'\fR utility for more information. If unset, the default ciphers
+will be used.
 .ie n .SS "Plugin ""mysql"""
 .el .SS "Plugin \f(CWmysql\fP"
 .IX Subsection "Plugin mysql"
 The \f(CW\*(C`mysql plugin\*(C'\fR requires \fBmysqlclient\fR to be installed. It connects to
 one or more databases when started and keeps the connection up as long as
 possible. When the connection is interrupted for whatever reason it will try
@@ -3031,37 +3438,50 @@
 \&\f(CW\*(C`SHOW SLAVE STATUS\*(C'\fR command. See the \fBMySQL reference manual\fR,
 \&\fI12.5.5.21 \s-1SHOW MASTER STATUS\s0 Syntax\fR and
 \&\fI12.5.5.31 \s-1SHOW SLAVE STATUS\s0 Syntax\fR for details.
 .PP
 Synopsis:
 .PP
-.Vb 9
+.Vb 10
 \&  <Plugin mysql>
 \&    <Database foo>
 \&      Host "hostname"
 \&      User "username"
 \&      Password "password"
 \&      Port "3306"
 \&      MasterStats true
 \&      ConnectTimeout 10
+\&      SSLKey "/path/to/key.pem"
+\&      SSLCert "/path/to/cert.pem"
+\&      SSLCA "/path/to/ca.pem"
+\&      SSLCAPath "/path/to/cas/"
+\&      SSLCipher "DHE\-RSA\-AES256\-SHA"
 \&    </Database>
 \&
 \&    <Database bar>
 \&      Alias "squeeze"
 \&      Host "localhost"
 \&      Socket "/var/run/mysql/mysqld.sock"
 \&      SlaveStats true
 \&      SlaveNotifications true
 \&    </Database>
+\&
+\&   <Database galera>
+\&      Alias "galera"
+\&      Host "localhost"
+\&      Socket "/var/run/mysql/mysqld.sock"
+\&      WsrepStats true
+\&   </Database>
 \&  </Plugin>
 .Ve
 .PP
 A \fBDatabase\fR block defines one connection to a MySQL database. It accepts a
 single argument which specifies the name of the database. None of the other
 options are required. MySQL will use default values as documented in the
-section \*(L"\fImysql_real_connect()\fR\*(R" in the \fBMySQL reference manual\fR.
+\&\*(L"\fImysql_real_connect()\fR\*(R" and \*(L"\fImysql_ssl_set()\fR\*(R" sections in the
+\&\fBMySQL reference manual\fR.
 .IP "\fBAlias\fR \fIAlias\fR" 4
 .IX Item "Alias Alias"
 Alias to use as sender instead of hostname when reporting. This may be useful
 when having cryptic hostnames.
 .IP "\fBHost\fR \fIHostname\fR" 4
 .IX Item "Host Hostname"
@@ -3111,15 +3531,37 @@
 order to be able to get access to these statistics, the user needs special
 privileges. See the \fBUser\fR documentation above. Defaults to \fBfalse\fR.
 .IP "\fBSlaveNotifications\fR \fItrue|false\fR" 4
 .IX Item "SlaveNotifications true|false"
 If enabled, the plugin sends a notification if the replication slave I/O and /
 or \s-1SQL\s0 threads are not running. Defaults to \fBfalse\fR.
+.IP "\fBWsrepStats\fR \fItrue|false\fR" 4
+.IX Item "WsrepStats true|false"
+.Vb 3
+\& Enable the collection of wsrep plugin statistics, used in Master\-Master
+\& replication setups like in MySQL Galera/Percona XtraDB Cluster.
+\& User needs only privileges to execute \*(AqSHOW GLOBAL STATUS\*(Aq
+.Ve
 .IP "\fBConnectTimeout\fR \fISeconds\fR" 4
 .IX Item "ConnectTimeout Seconds"
 Sets the connect timeout for the MySQL client.
+.IP "\fBSSLKey\fR \fIPath\fR" 4
+.IX Item "SSLKey Path"
+If provided, the X509 key in \s-1PEM\s0 format.
+.IP "\fBSSLCert\fR \fIPath\fR" 4
+.IX Item "SSLCert Path"
+If provided, the X509 cert in \s-1PEM\s0 format.
+.IP "\fB\s-1SSLCA\s0\fR \fIPath\fR" 4
+.IX Item "SSLCA Path"
+If provided, the \s-1CA\s0 file in \s-1PEM\s0 format (check OpenSSL docs).
+.IP "\fBSSLCAPath\fR \fIPath\fR" 4
+.IX Item "SSLCAPath Path"
+If provided, the \s-1CA\s0 directory (check OpenSSL docs).
+.IP "\fBSSLCipher\fR \fIString\fR" 4
+.IX Item "SSLCipher String"
+If provided, the \s-1SSL\s0 cipher to use.
 .ie n .SS "Plugin ""netapp"""
 .el .SS "Plugin \f(CWnetapp\fP"
 .IX Subsection "Plugin netapp"
 The netapp plugin can collect various performance and capacity information
 from a NetApp filer using the NetApp \s-1API.\s0
 .PP
@@ -3966,12 +4408,22 @@
 Subject-template to use when sending emails. There must be exactly two
 string-placeholders in the subject, given in the standard \fI\fIprintf\fI\|(3)\fR syntax,
 i.\ e. \f(CW%s\fR. The first will be replaced with the severity, the second
 with the hostname.
 .Sp
 Default: \f(CW\*(C`Collectd notify: %s@%s\*(C'\fR
+.ie n .SS "Plugin ""notify_nagios"""
+.el .SS "Plugin \f(CWnotify_nagios\fP"
+.IX Subsection "Plugin notify_nagios"
+The \fInotify_nagios\fR plugin writes notifications to Nagios' \fIcommand file\fR as
+a \fIpassive service check result\fR.
+.PP
+Available configuration options:
+.IP "\fBCommandFile\fR \fIPath\fR" 4
+.IX Item "CommandFile Path"
+Sets the \fIcommand file\fR to write to. Defaults to \fI/usr/local/nagios/var/rw/nagios.cmd\fR.
 .ie n .SS "Plugin ""ntpd"""
 .el .SS "Plugin \f(CWntpd\fP"
 .IX Subsection "Plugin ntpd"
 The \f(CW\*(C`ntpd\*(C'\fR plugin collects per-peer ntp data such as time offset and time
 dispersion.
 .PP
@@ -4175,12 +4627,20 @@
 .PP
 The following options are accepted within each \fBInstance\fR block:
 .IP "\fB\s-1URL\s0\fR \fIldap://host/binddn\fR" 4
 .IX Item "URL ldap://host/binddn"
 Sets the \s-1URL\s0 to use to connect to the \fIOpenLDAP\fR server. This option is
 \&\fImandatory\fR.
+.IP "\fBBindDN\fR \fIBindDN\fR" 4
+.IX Item "BindDN BindDN"
+Name in the form of an \s-1LDAP\s0 distinguished name intended to be used for
+authentication. Defaults to empty string to establish an anonymous authorization.
+.IP "\fBPassword\fR \fIPassword\fR" 4
+.IX Item "Password Password"
+Password for simple bind authentication. If this option is not set,
+unauthenticated bind operation is used.
 .IP "\fBStartTLS\fR \fBtrue|false\fR" 4
 .IX Item "StartTLS true|false"
 Defines whether \s-1TLS\s0 must be used when connecting to the \fIOpenLDAP\fR server.
 Disabled by default.
 .IP "\fBVerifyHost\fR \fBtrue|false\fR" 4
 .IX Item "VerifyHost true|false"
@@ -4193,14 +4653,15 @@
 File that holds one or more \s-1SSL\s0 certificates. If you want to use \s-1TLS/SSL\s0 you
 may possibly need this option. What \s-1CA\s0 certificates are checked by default
 depends on the distribution you use and can be changed with the usual ldap
 client configuration mechanisms. See \fIldap.conf\fR\|(5) for the details.
 .IP "\fBTimeout\fR \fISeconds\fR" 4
 .IX Item "Timeout Seconds"
-Sets the timeout value for ldap operations. Defaults to \fB\-1\fR which results in
-an infinite timeout.
+Sets the timeout value for ldap operations, in seconds. By default, the
+configured \fBInterval\fR is used to set the timeout. Use \fB\-1\fR to disable
+(infinite timeout).
 .IP "\fBVersion\fR \fIVersion\fR" 4
 .IX Item "Version Version"
 An integer which sets the \s-1LDAP\s0 protocol version number to use when connecting
 to the \fIOpenLDAP\fR server. Defaults to \fB3\fR for using \fILDAPv3\fR.
 .ie n .SS "Plugin ""openvpn"""
 .el .SS "Plugin \f(CWopenvpn\fP"
@@ -4413,12 +4874,18 @@
 arguments are accepted.
 .Sp
 Default: \fB0.9\fR
 .IP "\fB\s-1TTL\s0\fR \fI0\-255\fR" 4
 .IX Item "TTL 0-255"
 Sets the Time-To-Live of generated \s-1ICMP\s0 packets.
+.IP "\fBSize\fR \fIsize\fR" 4
+.IX Item "Size size"
+Sets the size of the data payload in \s-1ICMP\s0 packet to specified \fIsize\fR (it
+will be filled with regular \s-1ASCII\s0 pattern). If not set, default 56 byte
+long string is used so that the packet size of an ICMPv4 packet is exactly
+64 bytes, similar to the behaviour of normal \fIping\fR\|(1) command.
 .IP "\fBSourceAddress\fR \fIhost\fR" 4
 .IX Item "SourceAddress host"
 Sets the source address to use. \fIhost\fR may either be a numerical network
 address or a network hostname.
 .IP "\fBDevice\fR \fIname\fR" 4
 .IX Item "Device name"
@@ -4518,19 +4985,18 @@
 .Ve
 .PP
 The \fBQuery\fR block defines one database query which may later be used by a
 database definition. It accepts a single mandatory argument which specifies
 the name of the query. The names of all queries have to be unique (see the
 \&\fBMinVersion\fR and \fBMaxVersion\fR options below for an exception to this
-rule). The following configuration options are available to define the query:
+rule).
 .PP
-In each \fBQuery\fR block, there is one or more \fBResult\fR blocks. \fBResult\fR
-blocks define how to handle the values returned from the query. They define
-which column holds which value and how to dispatch that value to the daemon.
-Multiple \fBResult\fR blocks may be used to extract multiple values from a single
-query.
+In each \fBQuery\fR block, there is one or more \fBResult\fR blocks. Multiple
+\&\fBResult\fR blocks may be used to extract multiple values from a single query.
+.PP
+The following configuration options are available to define the query:
 .IP "\fBStatement\fR \fIsql query statement\fR" 4
 .IX Item "Statement sql query statement"
 Specify the \fIsql query statement\fR which the plugin should execute. The string
 may contain the tokens \fB\f(CB$1\fB\fR, \fB\f(CB$2\fB\fR, etc. which are used to reference the
 first, second, etc. parameter. The value of the parameters is specified by the
 \&\fBParam\fR configuration option \- see below for details. To include a literal
@@ -4538,14 +5004,14 @@
 .Sp
 Any \s-1SQL\s0 command which may return data (such as \f(CW\*(C`SELECT\*(C'\fR or \f(CW\*(C`SHOW\*(C'\fR) is
 allowed. Note, however, that only a single command may be used. Semicolons are
 allowed as long as a single non-empty command has been specified only.
 .Sp
 The returned lines will be handled separately one after another.
-.IP "\fBParam\fR \fIhostname\fR|\fIdatabase\fR|\fIusername\fR|\fIinterval\fR" 4
-.IX Item "Param hostname|database|username|interval"
+.IP "\fBParam\fR \fIhostname\fR|\fIdatabase\fR|\fIinstance\fR|\fIusername\fR|\fIinterval\fR" 4
+.IX Item "Param hostname|database|instance|username|interval"
 Specify the parameters which should be passed to the \s-1SQL\s0 query. The parameters
 are referred to in the \s-1SQL\s0 query as \fB\f(CB$1\fB\fR, \fB\f(CB$2\fB\fR, etc. in the same order as
 they appear in the configuration file. The value of the parameter is
 determined depending on the value of the \fBParam\fR option as follows:
 .RS 4
 .IP "\fIhostname\fR" 4
@@ -4569,20 +5035,44 @@
 .RE
 .RS 4
 .Sp
 Please note that parameters are only supported by PostgreSQL's protocol
 version 3 and above which was introduced in version 7.4 of PostgreSQL.
 .RE
+.IP "\fBPluginInstanceFrom\fR \fIcolumn\fR" 4
+.IX Item "PluginInstanceFrom column"
+Specify how to create the \*(L"PluginInstance\*(R" for reporting this query results.
+Only one column is supported. You may concatenate fields and string values in
+the query statement to get the required results.
+.IP "\fBMinVersion\fR \fIversion\fR" 4
+.IX Item "MinVersion version"
+.PD 0
+.IP "\fBMaxVersion\fR \fIversion\fR" 4
+.IX Item "MaxVersion version"
+.PD
+Specify the minimum or maximum version of PostgreSQL that this query should be
+used with. Some statistics might only be available with certain versions of
+PostgreSQL. This allows you to specify multiple queries with the same name but
+which apply to different versions, thus allowing you to use the same
+configuration in a heterogeneous environment.
+.Sp
+The \fIversion\fR has to be specified as the concatenation of the major, minor
+and patch-level versions, each represented as two-decimal-digit numbers. For
+example, version 8.2.3 will become 80203.
+.PP
+The \fBResult\fR block defines how to handle the values returned from the query.
+It defines which column holds which value and how to dispatch that value to
+the daemon.
 .IP "\fBType\fR \fItype\fR" 4
 .IX Item "Type type"
 The \fItype\fR name to be used when dispatching the values. The type describes
 how to handle the data and where to store it. See \fItypes.db\fR\|(5) for more
 details on types and their configuration. The number and type of values (as
 selected by the \fBValuesFrom\fR option) has to match the type of the given name.
 .Sp
-This option is required inside a \fBResult\fR block.
+This option is mandatory.
 .IP "\fBInstancePrefix\fR \fIprefix\fR" 4
 .IX Item "InstancePrefix prefix"
 .PD 0
 .IP "\fBInstancesFrom\fR \fIcolumn0\fR [\fIcolumn1\fR ...]" 4
 .IX Item "InstancesFrom column0 [column1 ...]"
 .PD
@@ -4611,27 +5101,12 @@
 \&\fIstrtod\fR\|(3) functions, so anything supported by those functions is supported
 by the plugin as well.
 .Sp
 This option is required inside a \fBResult\fR block and may be specified multiple
 times. If multiple \fBValuesFrom\fR options are specified, the columns are read
 in the given order.
-.IP "\fBMinVersion\fR \fIversion\fR" 4
-.IX Item "MinVersion version"
-.PD 0
-.IP "\fBMaxVersion\fR \fIversion\fR" 4
-.IX Item "MaxVersion version"
-.PD
-Specify the minimum or maximum version of PostgreSQL that this query should be
-used with. Some statistics might only be available with certain versions of
-PostgreSQL. This allows you to specify multiple queries with the same name but
-which apply to different versions, thus allowing you to use the same
-configuration in a heterogeneous environment.
-.Sp
-The \fIversion\fR has to be specified as the concatenation of the major, minor
-and patch-level versions, each represented as two-decimal-digit numbers. For
-example, version 8.2.3 will become 80203.
 .PP
 The following predefined queries are available (the definitions can be found
 in the \fIpostgresql_default.conf\fR file which, by default, is available at
 \&\f(CW\*(C`\f(CIprefix\f(CW/share/collectd/\*(C'\fR):
 .IP "\fBbackends\fR" 4
 .IX Item "backends"
@@ -4768,14 +5243,16 @@
 amount of time will be lost, for example, if a single statement within the
 transaction fails or if the database server crashes.
 .IP "\fBInstance\fR \fIname\fR" 4
 .IX Item "Instance name"
 Specify the plugin instance name that should be used instead of the database
 name (which is the default, if this option has not been specified). This
-allows one to query multiple databases of the same name on the same host (e.g.
+allows to query multiple databases of the same name on the same host (e.g.
 when running multiple database server versions in parallel).
+The plugin instance name can also be set from the query result using
+the \fBPluginInstanceFrom\fR option in \fBQuery\fR block.
 .IP "\fBHost\fR \fIhostname\fR" 4
 .IX Item "Host hostname"
 Specify the hostname or \s-1IP\s0 of the PostgreSQL server to connect to. If the
 value begins with a slash, it is interpreted as the directory name in which to
 look for the \s-1UNIX\s0 domain socket.
 .Sp
@@ -4818,13 +5295,13 @@
 .RS 4
 .RE
 .IP "\fBInstance\fR \fIname\fR" 4
 .IX Item "Instance name"
 Specify the plugin instance name that should be used instead of the database
 name (which is the default, if this option has not been specified). This
-allows one to query multiple databases of the same name on the same host (e.g.
+allows to query multiple databases of the same name on the same host (e.g.
 when running multiple database server versions in parallel).
 .IP "\fBKRBSrvName\fR \fIkerberos_service_name\fR" 4
 .IX Item "KRBSrvName kerberos_service_name"
 Specify the Kerberos service name to use when authenticating with Kerberos 5
 or \s-1GSSAPI.\s0 See the sections \*(L"Kerberos authentication\*(R" and \*(L"\s-1GSSAPI\*(R"\s0 of the
 \&\fBPostgreSQL Documentation\fR for details.
@@ -5005,18 +5482,21 @@
 io data (where available) and minor and major pagefaults.
 .Sp
 Some platforms have a limit on the length of process names. \fIName\fR must stay
 below this limit.
 .IP "\fBProcessMatch\fR \fIname\fR \fIregex\fR" 4
 .IX Item "ProcessMatch name regex"
-Similar to the \fBProcess\fR option this allows one to select more detailed
+Similar to the \fBProcess\fR option this allows to select more detailed
 statistics of processes matching the specified \fIregex\fR (see \fIregex\fR\|(7) for
 details). The statistics of all matching processes are summed up and
 dispatched to the daemon using the specified \fIname\fR as an identifier. This
-allows one to \*(L"group\*(R" several processes together. \fIname\fR must not contain
+allows to \*(L"group\*(R" several processes together. \fIname\fR must not contain
 slashes.
+.IP "\fBCollectContextSwitch\fR \fIBoolean\fR" 4
+.IX Item "CollectContextSwitch Boolean"
+Collect context switch of the process.
 .ie n .SS "Plugin ""protocols"""
 .el .SS "Plugin \f(CWprotocols\fP"
 .IX Subsection "Plugin protocols"
 Collects a lot of information about various network protocols, such as \fI\s-1IP\s0\fR,
 \&\fI\s-1TCP\s0\fR, \fI\s-1UDP\s0\fR, etc.
 .PP
@@ -5192,14 +5672,14 @@
 way the \f(CW\*(C`rrdtool\*(C'\fR plugin works (see below). The added abstraction layer
 provides a number of benefits, though: Because the cache is not within
 \&\f(CW\*(C`collectd\*(C'\fR anymore, it does not need to be flushed when \f(CW\*(C`collectd\*(C'\fR is to be
 restarted. This results in much shorter (if any) gaps in graphs, especially
 under heavy load. Also, the \f(CW\*(C`rrdtool\*(C'\fR command line utility is aware of the
 daemon so that it can flush values to disk automatically when needed. This
-allows one to integrate automated flushing of values into graphing solutions
-much more easily.
+allows to integrate automated flushing of values into graphing solutions much
+more easily.
 .PP
 There are disadvantages, though: The daemon may reside on a different host, so
 it may not be possible for \f(CW\*(C`collectd\*(C'\fR to create the appropriate \s-1RRD\s0 files
 anymore. And even if \f(CW\*(C`rrdcached\*(C'\fR runs on the same host, it may run in a
 different base directory, so relative paths may do weird stuff if you're not
 careful.
@@ -5417,12 +5897,17 @@
 sensors. This may not be practical, especially for uninteresting sensors.
 Thus, you can use the \fBSensor\fR\-option to pick the sensors you're interested
 in. Sometimes, however, it's easier/preferred to collect all sensors \fIexcept\fR a
 few ones. This option enables you to do that: By setting \fBIgnoreSelected\fR to
 \&\fItrue\fR the effect of \fBSensor\fR is inverted: All selected sensors are ignored
 and all other sensors are collected.
+.IP "\fBUseLabels\fR \fItrue\fR|\fIfalse\fR" 4
+.IX Item "UseLabels true|false"
+Configures how sensor readings are reported. When set to \fItrue\fR, sensor
+readings are reported using their descriptive label (e.g. \*(L"VCore\*(R"). When set to
+\&\fIfalse\fR (the default) the sensor name is used (\*(L"in0\*(R").
 .ie n .SS "Plugin ""sigrok"""
 .el .SS "Plugin \f(CWsigrok\fP"
 .IX Subsection "Plugin sigrok"
 The \fIsigrok plugin\fR uses \fIlibsigrok\fR to retrieve measurements from any device
 supported by the sigrok <http://sigrok.org/> project.
 .PP
@@ -5507,12 +5992,26 @@
 Sets whether selected disks, i.\ e. the ones matches by any of the \fBDisk\fR
 statements, are ignored or if all other disks are ignored. The behavior
 (hopefully) is intuitive: If no \fBDisk\fR option is configured, all disks are
 collected. If at least one \fBDisk\fR option is given and no \fBIgnoreSelected\fR or
 set to \fBfalse\fR, \fBonly\fR matching disks will be collected. If \fBIgnoreSelected\fR
 is set to \fBtrue\fR, all disks are collected \fBexcept\fR the ones matched.
+.IP "\fBIgnoreSleepMode\fR \fBtrue\fR|\fBfalse\fR" 4
+.IX Item "IgnoreSleepMode true|false"
+Normally, the \f(CW\*(C`smart\*(C'\fR plugin will ignore disks that are reported to be asleep.
+This option disables the sleep mode check and allows the plugin to collect data
+from these disks anyway. This is useful in cases where libatasmart mistakenly
+reports disks as asleep because it has not been updated to incorporate support
+for newer idle states in the \s-1ATA\s0 spec.
+.IP "\fBUseSerial\fR \fBtrue\fR|\fBfalse\fR" 4
+.IX Item "UseSerial true|false"
+A disk's kernel name (e.g., sda) can change from one boot to the next. If this
+option is enabled, the \f(CW\*(C`smart\*(C'\fR plugin will use the disk's serial number (e.g.,
+\&\s-1HGST_HUH728080ALE600_2EJ8VH8X\s0) instead of the kernel name as the key for
+storing data. This ensures that the data for a given disk will be kept together
+even if the kernel name changes.
 .ie n .SS "Plugin ""snmp"""
 .el .SS "Plugin \f(CWsnmp\fP"
 .IX Subsection "Plugin snmp"
 Since the configuration of the \f(CW\*(C`snmp plugin\*(C'\fR is a little more complicated than
 other plugins, its documentation has been moved to an own manpage,
 \&\fIcollectd\-snmp\fR\|(5). Please see there for details.
@@ -5548,12 +6047,17 @@
 .PD
 These options control what happens if metrics are not updated in an interval.
 If set to \fBFalse\fR, the default, metrics are dispatched unchanged, i.e. the
 rate of counters and size of sets will be zero, timers report \f(CW\*(C`NaN\*(C'\fR and gauges
 are unchanged. If set to \fBTrue\fR, the such metrics are not dispatched and
 removed from the internal cache.
+.IP "\fBCounterSum\fR \fBfalse\fR|\fBtrue\fR" 4
+.IX Item "CounterSum false|true"
+When enabled, creates a \f(CW\*(C`count\*(C'\fR metric which reports the change since the last
+read. This option primarily exists for compatibility with the \fIstatsd\fR
+implementation by Etsy.
 .IP "\fBTimerPercentile\fR \fIPercent\fR" 4
 .IX Item "TimerPercentile Percent"
 Calculate and dispatch the configured percentile, i.e. compute the latency, so
 that \fIPercent\fR of all reported timers are smaller than or equal to the
 computed latency. This is useful for cutting off the long tail latency, as it's
 often done in \fIService Level Agreements\fR (SLAs).
@@ -6003,13 +6507,13 @@
 connections a mail server or news server has to other mail or news servers, or
 how many connections a web proxy holds to web servers. You have to give the
 port in numeric form.
 .IP "\fBAllPortsSummary\fR \fItrue\fR|\fIfalse\fR" 4
 .IX Item "AllPortsSummary true|false"
 If this option is set to \fItrue\fR a summary of statistics from all connections
-are collectd. This option defaults to \fIfalse\fR.
+are collected. This option defaults to \fIfalse\fR.
 .ie n .SS "Plugin ""thermal"""
 .el .SS "Plugin \f(CWthermal\fP"
 .IX Subsection "Plugin thermal"
 .IP "\fBForceUseProcfs\fR \fItrue\fR|\fIfalse\fR" 4
 .IX Item "ForceUseProcfs true|false"
 By default, the \fIThermal plugin\fR tries to read the statistics from the Linux
@@ -6078,18 +6582,18 @@
 Boolean enabling the collection of the I/O System-Management Interrupt
 counter'. This option should only be used if the automated detection
 fails or if you want to disable this feature.
 .IP "\fBDigitalTemperatureSensor\fR \fItrue\fR|\fIfalse\fR" 4
 .IX Item "DigitalTemperatureSensor true|false"
 Boolean enabling the collection of the temperature of each core.
-This option should only be used if the automated detectionfails or 
+This option should only be used if the automated detectionfails or
 if you want to disable this feature.
 .IP "\fBDigitalTemperatureSensor\fR \fItrue\fR|\fIfalse\fR" 4
 .IX Item "DigitalTemperatureSensor true|false"
 Boolean enabling the collection of the temperature of each package.
-This option should only be used if the automated detectionfails or 
+This option should only be used if the automated detectionfails or
 if you want to disable this feature.
 .IP "\fBTCCActivationTemp\fR \fITemperature\fR" 4
 .IX Item "TCCActivationTemp Temperature"
 Thermal Control Circuit Activation Temperature of the installed
 \&\s-1CPU.\s0 This temperature is used when collecting the temperature of
 cores or packages. This option should only be used if the automated
@@ -6372,23 +6876,23 @@
 data according to this setting. The default is to use the path as provided by
 the hypervisor (the \*(L"dev\*(R" property of the target node), which is equal to
 setting \fBname\fR.
 .Sp
 \&\fBaddress\fR means use the interface's mac address. This is useful since the
 interface path might change between reboots of a guest or across migrations.
-.IP "\fBPluginInstanceFormat\fR \fBname|uuid\fR" 4
-.IX Item "PluginInstanceFormat name|uuid"
+.IP "\fBPluginInstanceFormat\fR \fBname|uuid|none\fR" 4
+.IX Item "PluginInstanceFormat name|uuid|none"
 When the virt plugin logs data, it sets the plugin_instance of the collected
-data according to this setting. The default is to use the guest name as provided
-by the hypervisor, which is equal to setting \fBname\fR.
+data according to this setting. The default is to not set the plugin_instance.
 .Sp
+\&\fBname\fR means use the guest's name as provided by the hypervisor.
 \&\fBuuid\fR means use the guest's \s-1UUID.\s0
 .Sp
-You can also specify combinations of these fields. For example \fBname uuid\fR
-means to concatenate the guest name and \s-1UUID \s0(with a literal colon character
-between, thus \fI\*(L"foo:1234\-1234\-1234\-1234\*(R"\fR).
+You can also specify combinations of the \fBname\fR and \fBuuid\fR fields.
+For example \fBname uuid\fR means to concatenate the guest name and \s-1UUID
+\&\s0(with a literal colon character between, thus \fI\*(L"foo:1234\-1234\-1234\-1234\*(R"\fR).
 .ie n .SS "Plugin ""vmem"""
 .el .SS "Plugin \f(CWvmem\fP"
 .IX Subsection "Plugin vmem"
 The \f(CW\*(C`vmem\*(C'\fR plugin collects information about the usage of virtual memory.
 Since the statistics provided by the Linux kernel are very detailed, they are
 collected very detailed. However, to get all the details, you have to switch
@@ -6446,12 +6950,19 @@
 .IP "\fBPort\fR \fIService\fR" 4
 .IX Item "Port Service"
 Service name or port number to connect to. Defaults to \f(CW2003\fR.
 .IP "\fBProtocol\fR \fIString\fR" 4
 .IX Item "Protocol String"
 Protocol to use when connecting to \fIGraphite\fR. Defaults to \f(CW\*(C`tcp\*(C'\fR.
+.IP "\fBReconnectInterval\fR \fISeconds\fR" 4
+.IX Item "ReconnectInterval Seconds"
+When set to non-zero, forces the connection to the Graphite backend to be
+closed and re-opend periodically. This behavior is desirable in environments
+where the connection to the Graphite backend is done through load balancers,
+for example. When set to zero, the default, the connetion is kept open for as
+long as possible.
 .IP "\fBLogSendErrors\fR \fBfalse\fR|\fBtrue\fR" 4
 .IX Item "LogSendErrors false|true"
 If set to \fBtrue\fR (the default), logs errors when sending data to \fIGraphite\fR.
 If set to \fBfalse\fR, it will not log the errors. This is especially useful when
 using Protocol \s-1UDP\s0 since many times we want to use the \*(L"fire-and-forget\*(R"
 approach and logging errors fills syslog with unneeded messages.
@@ -6640,24 +7151,38 @@
 .IX Item "ClientCert File"
 File that holds the \s-1SSL\s0 certificate to be used for certificate-based
 authentication.
 .IP "\fBClientKeyPass\fR \fIPassword\fR" 4
 .IX Item "ClientKeyPass Password"
 Password required to load the private key in \fBClientKey\fR.
+.IP "\fBHeader\fR \fIHeader\fR" 4
+.IX Item "Header Header"
+A \s-1HTTP\s0 header to add to the request.  Multiple headers are added if this option is specified more than once.  Example:
+.Sp
+.Vb 1
+\&  Header "X\-Custom\-Header: custom_value"
+.Ve
 .IP "\fBSSLVersion\fR \fBSSLv2\fR|\fBSSLv3\fR|\fBTLSv1\fR|\fBTLSv1_0\fR|\fBTLSv1_1\fR|\fBTLSv1_2\fR" 4
 .IX Item "SSLVersion SSLv2|SSLv3|TLSv1|TLSv1_0|TLSv1_1|TLSv1_2"
 Define which \s-1SSL\s0 protocol version must be used. By default \f(CW\*(C`libcurl\*(C'\fR will
 attempt to figure out the remote \s-1SSL\s0 protocol version. See
 \&\fIcurl_easy_setopt\fR\|(3) for more details.
-.IP "\fBFormat\fR \fBCommand\fR|\fB\s-1JSON\s0\fR" 4
-.IX Item "Format Command|JSON"
+.IP "\fBFormat\fR \fBCommand\fR|\fB\s-1JSON\s0\fR|\fB\s-1KAIROSDB\s0\fR" 4
+.IX Item "Format Command|JSON|KAIROSDB"
 Format of the output to generate. If set to \fBCommand\fR, will create output that
 is understood by the \fIExec\fR and \fIUnixSock\fR plugins. When set to \fB\s-1JSON\s0\fR, will
-create output in the \fIJavaScript Object Notation\fR (\s-1JSON\s0).
+create output in the \fIJavaScript Object Notation\fR (\s-1JSON\s0). When set to \s-1KAIROSDB
+,\s0 will create output in the KairosDB format.
 .Sp
 Defaults to \fBCommand\fR.
+.IP "\fBMetrics\fR \fBtrue\fR|\fBfalse\fR" 4
+.IX Item "Metrics true|false"
+Controls whether \fImetrics\fR are POSTed to this location. Defaults to \fBtrue\fR.
+.IP "\fBNotifications\fR \fBfalse\fR|\fBtrue\fR" 4
+.IX Item "Notifications false|true"
+Controls whether \fInotifications\fR are POSTed to this location. Defaults to \fBfalse\fR.
 .IP "\fBStoreRates\fR \fBtrue|false\fR" 4
 .IX Item "StoreRates true|false"
 If set to \fBtrue\fR, convert counter values to rates. If set to \fBfalse\fR (the
 default) counter values are stored as is, i.e. as an increasing integer number.
 .IP "\fBBufferSize\fR \fIBytes\fR" 4
 .IX Item "BufferSize Bytes"
@@ -6676,12 +7201,15 @@
 .IP "\fBTimeout\fR \fITimeout\fR" 4
 .IX Item "Timeout Timeout"
 Sets the maximum time in milliseconds given for \s-1HTTP POST\s0 operations to
 complete. When this limit is reached, the \s-1POST\s0 operation will be aborted, and
 all the data in the current send buffer will probably be lost. Defaults to 0,
 which means the connection never times out.
+.IP "\fBLogHttpError\fR \fBfalse\fR|\fBtrue\fR" 4
+.IX Item "LogHttpError false|true"
+Enables printing of \s-1HTTP\s0 error code to log. Turned off by default.
 .Sp
 The \f(CW\*(C`write_http\*(C'\fR plugin regularly submits the collected values to the \s-1HTTP\s0
 server. How frequently this happens depends on how much data you are collecting
 and the size of \fBBufferSize\fR. The optimal value to set \fBTimeout\fR to is
 slightly below this interval, which you can estimate by monitoring the network
 traffic between collectd and the \s-1HTTP\s0 server.
@@ -6712,13 +7240,13 @@
 .IP "\fBProperty\fR \fIString\fR \fIString\fR" 4
 .IX Item "Property String String"
 Configure the named property for the current topic. Properties are
 forwarded to the kafka producer library \fBlibrdkafka\fR.
 .IP "\fBKey\fR \fIString\fR" 4
 .IX Item "Key String"
-Use the specified string as a partitioning key for the topic. Kafka breaks
+Use the specified string as a partioning key for the topic. Kafka breaks
 topic into partitions and guarantees that for a given topology, the same
 consumer will be used for a specific key. The special (case insensitive)
 string \fBRandom\fR can be used to specify that an arbitrary partition should
 be used.
 .IP "\fBFormat\fR \fBCommand\fR|\fB\s-1JSON\s0\fR|\fBGraphite\fR" 4
 .IX Item "Format Command|JSON|Graphite"
@@ -6783,27 +7311,33 @@
 .el .SS "Plugin \f(CWwrite_redis\fP"
 .IX Subsection "Plugin write_redis"
 The \fIwrite_redis plugin\fR submits values to \fIRedis\fR, a data structure server.
 .PP
 Synopsis:
 .PP
-.Vb 7
+.Vb 11
 \&  <Plugin "write_redis">
 \&    <Node "example">
 \&        Host "localhost"
 \&        Port "6379"
 \&        Timeout 1000
+\&        Prefix "collectd/"
+\&        Database 1
+\&        MaxSetSize \-1
+\&        StoreRates true
 \&    </Node>
 \&  </Plugin>
 .Ve
 .PP
 Values are submitted to \fISorted Sets\fR, using the metric name as the key, and
 the timestamp as the score. Retrieving a date range can then be done using the
 \&\f(CW\*(C`ZRANGEBYSCORE\*(C'\fR \fIRedis\fR command. Additionally, all the identifiers of these
-\&\fISorted Sets\fR are kept in a \fISet\fR called \f(CW\*(C`collectd/values\*(C'\fR and can be
-retrieved using the \f(CW\*(C`SMEMBERS\*(C'\fR \fIRedis\fR command. See
+\&\fISorted Sets\fR are kept in a \fISet\fR called \f(CW\*(C`collectd/values\*(C'\fR (or
+\&\f(CW\*(C`${prefix}/values\*(C'\fR if the \fBPrefix\fR option was specified) and can be retrieved
+using the \f(CW\*(C`SMEMBERS\*(C'\fR \fIRedis\fR command. You can specify the database to use
+with the \fBDatabase\fR parameter (default is \f(CW0\fR). See
 <http://redis.io/commands#sorted_set> and <http://redis.io/commands#set> for
 details.
 .PP
 The information shown in the synopsis above is the \fIdefault configuration\fR
 which is used by the plugin if no configuration is present.
 .PP
@@ -6825,12 +7359,30 @@
 The \fBPort\fR option is the \s-1TCP\s0 port on which the Redis instance accepts
 connections. Either a service name of a port number may be given. Please note
 that numerical port numbers must be given as a string, too.
 .IP "\fBTimeout\fR \fIMilliseconds\fR" 4
 .IX Item "Timeout Milliseconds"
 The \fBTimeout\fR option sets the socket connection timeout, in milliseconds.
+.IP "\fBPrefix\fR \fIPrefix\fR" 4
+.IX Item "Prefix Prefix"
+Prefix used when constructing the name of the \fISorted Sets\fR and the \fISet\fR
+containing all metrics. Defaults to \f(CW\*(C`collectd/\*(C'\fR, so metrics will have names
+like \f(CW\*(C`collectd/cpu\-0/cpu\-user\*(C'\fR. When setting this to something different, it
+is recommended but not required to include a trailing slash in \fIPrefix\fR.
+.IP "\fBDatabase\fR \fIIndex\fR" 4
+.IX Item "Database Index"
+This index selects the redis database to use for writing operations. Defaults
+to \f(CW0\fR.
+.IP "\fBMaxSetSize\fR \fIItems\fR" 4
+.IX Item "MaxSetSize Items"
+The \fBMaxSetSize\fR option limits the number of items that the \fISorted Sets\fR can
+hold. Negative values for \fIItems\fR sets no limit, which is the default behavior.
+.IP "\fBStoreRates\fR \fBtrue\fR|\fBfalse\fR" 4
+.IX Item "StoreRates true|false"
+If set to \fBtrue\fR (the default), convert counter values to rates. If set to
+\&\fBfalse\fR counter values are stored as is, i.e. as an increasing integer number.
 .ie n .SS "Plugin ""write_riemann"""
 .el .SS "Plugin \f(CWwrite_riemann\fP"
 .IX Subsection "Plugin write_riemann"
 The \fIwrite_riemann plugin\fR will send values to \fIRiemann\fR, a powerful stream
 aggregation and monitoring system. The plugin sends \fIProtobuf\fR encoded data to
 \&\fIRiemann\fR using \s-1UDP\s0 packets.
@@ -6863,16 +7415,28 @@
 .IP "\fBHost\fR \fIAddress\fR" 4
 .IX Item "Host Address"
 Hostname or address to connect to. Defaults to \f(CW\*(C`localhost\*(C'\fR.
 .IP "\fBPort\fR \fIService\fR" 4
 .IX Item "Port Service"
 Service name or port number to connect to. Defaults to \f(CW5555\fR.
-.IP "\fBProtocol\fR \fB\s-1UDP\s0\fR|\fB\s-1TCP\s0\fR" 4
-.IX Item "Protocol UDP|TCP"
+.IP "\fBProtocol\fR \fB\s-1UDP\s0\fR|\fB\s-1TCP\s0\fR|\fB\s-1TLS\s0\fR" 4
+.IX Item "Protocol UDP|TCP|TLS"
 Specify the protocol to use when communicating with \fIRiemann\fR. Defaults to
 \&\fB\s-1TCP\s0\fR.
+.IP "\fBTLSCertFile\fR \fIPath\fR" 4
+.IX Item "TLSCertFile Path"
+When using the \fB\s-1TLS\s0\fR protocol, path to a \s-1PEM\s0 certificate to present
+to remote host.
+.IP "\fBTLSCAFile\fR \fIPath\fR" 4
+.IX Item "TLSCAFile Path"
+When using the \fB\s-1TLS\s0\fR protocol, path to a \s-1PEM CA\s0 certificate to
+use to validate the remote hosts's identity.
+.IP "\fBTLSKeyFile\fR \fIPath\fR" 4
+.IX Item "TLSKeyFile Path"
+When using the \fB\s-1TLS\s0\fR protocol, path to a \s-1PEM\s0 private key associated
+with the certificate defined by \fBTLSCertFile\fR.
 .IP "\fBBatch\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "Batch true|false"
 If set to \fBtrue\fR and \fBProtocol\fR is set to \fB\s-1TCP\s0\fR,
 events will be batched in memory and flushed at
 regular intervals or when \fBBatchMaxSize\fR is exceeded.
 .Sp
@@ -6884,12 +7448,16 @@
 is an issue.
 .Sp
 Defaults to true
 .IP "\fBBatchMaxSize\fR \fIsize\fR" 4
 .IX Item "BatchMaxSize size"
 Maximum payload size for a riemann packet. Defaults to 8192
+.IP "\fBBatchFlushTimeout\fR \fIseconds\fR" 4
+.IX Item "BatchFlushTimeout seconds"
+Maximum amount of seconds to wait in between to batch flushes.
+No timeout by default.
 .IP "\fBStoreRates\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "StoreRates true|false"
 If set to \fBtrue\fR (the default), convert counter values to rates. If set to
 \&\fBfalse\fR counter values are stored as is, i.e. as an increasing integer number.
 .Sp
 This will be reflected in the \f(CW\*(C`ds_type\*(C'\fR tag: If \fBStoreRates\fR is enabled,
@@ -7025,12 +7593,20 @@
 Add the given string as an additional tag to the metric being sent to
 \&\fISensu\fR.
 .IP "\fBAttribute\fR \fIString\fR \fIString\fR" 4
 .IX Item "Attribute String String"
 Consider the two given strings to be the key and value of an additional
 attribute for each metric being sent out to \fISensu\fR.
+.ie n .SS "Plugin ""xencpu"""
+.el .SS "Plugin \f(CWxencpu\fP"
+.IX Subsection "Plugin xencpu"
+This plugin collects metrics of hardware \s-1CPU\s0 load for machine running Xen
+hypervisor. Load is calculated from 'idle time' value, provided by Xen.
+Result is reported using the \f(CW\*(C`percent\*(C'\fR type, for each \s-1CPU \s0(core).
+.PP
+This plugin doesn't have any options (yet).
 .ie n .SS "Plugin ""zookeeper"""
 .el .SS "Plugin \f(CWzookeeper\fP"
 .IX Subsection "Plugin zookeeper"
 The \fIzookeeper plugin\fR will collect statistics from a \fIZookeeper\fR server
 using the mntr command.  It requires Zookeeper 3.4.0+ and access to the
 client port.
@@ -7894,12 +8470,14 @@
 .IP "\fBPlugin\fR \fIString\fR" 4
 .IX Item "Plugin String"
 .IP "\fBPluginInstance\fR \fIString\fR" 4
 .IX Item "PluginInstance String"
 .IP "\fBTypeInstance\fR \fIString\fR" 4
 .IX Item "TypeInstance String"
+.IP "\fBMetaData\fR \fIString\fR \fIString\fR" 4
+.IX Item "MetaData String String"
 .PD
 Set the appropriate field to the given string. The strings for plugin instance
 and type instance may be empty, the strings for host and plugin may not be
 empty. It's currently not possible to set the type of a value this way.
 .RE
 .RS 4
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.in	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.in	2016-09-11 16:10:25.255038733 +0800
@@ -97,16 +97,18 @@
 #@BUILD_PLUGIN_ASCENT_TRUE@LoadPlugin ascent
 #@BUILD_PLUGIN_BAROMETER_TRUE@LoadPlugin barometer
 #@BUILD_PLUGIN_BATTERY_TRUE@LoadPlugin battery
 #@BUILD_PLUGIN_BIND_TRUE@LoadPlugin bind
 #@BUILD_PLUGIN_CEPH_TRUE@LoadPlugin ceph
 #@BUILD_PLUGIN_CGROUPS_TRUE@LoadPlugin cgroups
+#@BUILD_PLUGIN_CHRONY_TRUE@LoadPlugin chrony
 #@BUILD_PLUGIN_CONNTRACK_TRUE@LoadPlugin conntrack
 #@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@LoadPlugin contextswitch
 @BUILD_PLUGIN_CPU_TRUE@@BUILD_PLUGIN_CPU_TRUE@LoadPlugin cpu
 #@BUILD_PLUGIN_CPUFREQ_TRUE@LoadPlugin cpufreq
+#@BUILD_PLUGIN_CPUSLEEP_TRUE@LoadPlugin cpusleep
 @LOAD_PLUGIN_CSV@LoadPlugin csv
 #@BUILD_PLUGIN_CURL_TRUE@LoadPlugin curl
 #@BUILD_PLUGIN_CURL_JSON_TRUE@LoadPlugin curl_json
 #@BUILD_PLUGIN_CURL_XML_TRUE@LoadPlugin curl_xml
 #@BUILD_PLUGIN_DBI_TRUE@LoadPlugin dbi
 #@BUILD_PLUGIN_DF_TRUE@LoadPlugin df
@@ -118,40 +120,45 @@
 #@BUILD_PLUGIN_ETHSTAT_TRUE@LoadPlugin ethstat
 #@BUILD_PLUGIN_EXEC_TRUE@LoadPlugin exec
 #@BUILD_PLUGIN_FHCOUNT_TRUE@LoadPlugin fhcount
 #@BUILD_PLUGIN_FILECOUNT_TRUE@LoadPlugin filecount
 #@BUILD_PLUGIN_FSCACHE_TRUE@LoadPlugin fscache
 #@BUILD_PLUGIN_GMOND_TRUE@LoadPlugin gmond
+#@BUILD_PLUGIN_GPS_TRUE@LoadPlugin gps
+#@BUILD_PLUGIN_GRPC_TRUE@LoadPlugin grpc
 #@BUILD_PLUGIN_HDDTEMP_TRUE@LoadPlugin hddtemp
 @BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_PLUGIN_INTERFACE_TRUE@LoadPlugin interface
 #@BUILD_PLUGIN_IPC_TRUE@LoadPlugin ipc
 #@BUILD_PLUGIN_IPMI_TRUE@LoadPlugin ipmi
 #@BUILD_PLUGIN_IPTABLES_TRUE@LoadPlugin iptables
 #@BUILD_PLUGIN_IPVS_TRUE@LoadPlugin ipvs
 #@BUILD_PLUGIN_IRQ_TRUE@LoadPlugin irq
 #@BUILD_PLUGIN_JAVA_TRUE@LoadPlugin java
 @BUILD_PLUGIN_LOAD_TRUE@@BUILD_PLUGIN_LOAD_TRUE@LoadPlugin load
 #@BUILD_PLUGIN_LPAR_TRUE@LoadPlugin lpar
+#@BUILD_PLUGIN_LUA_TRUE@LoadPlugin lua
 #@BUILD_PLUGIN_LVM_TRUE@LoadPlugin lvm
 #@BUILD_PLUGIN_MADWIFI_TRUE@LoadPlugin madwifi
 #@BUILD_PLUGIN_MBMON_TRUE@LoadPlugin mbmon
 #@BUILD_PLUGIN_MD_TRUE@LoadPlugin md
 #@BUILD_PLUGIN_MEMCACHEC_TRUE@LoadPlugin memcachec
 #@BUILD_PLUGIN_MEMCACHED_TRUE@LoadPlugin memcached
 @BUILD_PLUGIN_MEMORY_TRUE@@BUILD_PLUGIN_MEMORY_TRUE@LoadPlugin memory
 #@BUILD_PLUGIN_MIC_TRUE@LoadPlugin mic
 #@BUILD_PLUGIN_MODBUS_TRUE@LoadPlugin modbus
+#@BUILD_PLUGIN_MQTT_TRUE@LoadPlugin mqtt
 #@BUILD_PLUGIN_MULTIMETER_TRUE@LoadPlugin multimeter
 #@BUILD_PLUGIN_MYSQL_TRUE@LoadPlugin mysql
 #@BUILD_PLUGIN_NETAPP_TRUE@LoadPlugin netapp
 #@BUILD_PLUGIN_NETLINK_TRUE@LoadPlugin netlink
 @LOAD_PLUGIN_NETWORK@LoadPlugin network
 #@BUILD_PLUGIN_NFS_TRUE@LoadPlugin nfs
 #@BUILD_PLUGIN_NGINX_TRUE@LoadPlugin nginx
 #@BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@LoadPlugin notify_desktop
 #@BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@LoadPlugin notify_email
+#@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@LoadPlugin notify_nagios
 #@BUILD_PLUGIN_NTPD_TRUE@LoadPlugin ntpd
 #@BUILD_PLUGIN_NUMA_TRUE@LoadPlugin numa
 #@BUILD_PLUGIN_NUT_TRUE@LoadPlugin nut
 #@BUILD_PLUGIN_OLSRD_TRUE@LoadPlugin olsrd
 #@BUILD_PLUGIN_ONEWIRE_TRUE@LoadPlugin onewire
 #@BUILD_PLUGIN_OPENLDAP_TRUE@LoadPlugin openldap
@@ -201,14 +208,16 @@
 #@BUILD_PLUGIN_WRITE_LOG_TRUE@LoadPlugin write_log
 #@BUILD_PLUGIN_WRITE_MONGODB_TRUE@LoadPlugin write_mongodb
 #@BUILD_PLUGIN_WRITE_REDIS_TRUE@LoadPlugin write_redis
 #@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@LoadPlugin write_riemann
 #@BUILD_PLUGIN_WRITE_SENSU_TRUE@LoadPlugin write_sensu
 #@BUILD_PLUGIN_WRITE_TSDB_TRUE@LoadPlugin write_tsdb
+#@BUILD_PLUGIN_XENCPU_TRUE@LoadPlugin xencpu
 #@BUILD_PLUGIN_XMMS_TRUE@LoadPlugin xmms
 #@BUILD_PLUGIN_ZFS_ARC_TRUE@LoadPlugin zfs_arc
+#@BUILD_PLUGIN_ZONE_TRUE@LoadPlugin zone
 #@BUILD_PLUGIN_ZOOKEEPER_TRUE@LoadPlugin zookeeper
 
 ##############################################################################
 # Plugin configuration                                                       #
 #----------------------------------------------------------------------------#
 # In this section configuration stubs for each plugin are provided. A desc-  #
@@ -260,12 +269,13 @@
 #</Plugin>
 
 #<Plugin apcups>
 #	Host "localhost"
 #	Port "3551"
 #	ReportSeconds true
+#	PersistentConnection true
 #</Plugin>
 
 #<Plugin aquaero>
 #	Device ""
 #</Plugin>
 
@@ -325,12 +335,18 @@
 #  </Daemon>
 #  <Daemon "mds.a">
 #    SocketPath "/var/run/ceph/ceph-mds.ceph1.asok"
 #  </Daemon>
 #</Plugin>
 
+#<Plugin chrony>
+#	Host    "localhost"
+#	Port    "323"
+#	Timeout "2"
+#</Plugin>
+
 #<Plugin cgroups>
 #  CGroup "libvirt"
 #  IgnoreSelected false
 #</Plugin>
 
 #<Plugin cpu>
@@ -548,20 +564,44 @@
 #    Type "swap"
 #    TypeInstance "free"
 #    DataSource "value"
 #  </Metric>
 #</Plugin>
 
+#<Plugin gps>
+#  Host "127.0.0.1"
+#  Port "2947"
+#  Timeout 0.015
+#  PauseConnect 5
+#</Plugin>
+
+#<Plugin grpc>
+#	<Server "example.com" "50051">
+#		EnableSSL true
+#		SSLCACertificateFile "/path/to/root.pem"
+#		SSLCertificateFile "/path/to/server.pem"
+#		SSLCertificateKeyFile "/path/to/server.key"
+#	</Server>
+#	<Listen "0.0.0.0" "50051">
+#		EnableSSL true
+#		SSLCACertificateFile "/path/to/root.pem"
+#		SSLCertificateFile "/path/to/client.pem"
+#		SSLCertificateKeyFile "/path/to/client.key"
+#	</Listen>
+#</Plugin>
+
 #<Plugin hddtemp>
 #  Host "127.0.0.1"
 #  Port "7634"
 #</Plugin>
 
 #<Plugin interface>
 #	Interface "eth0"
 #	IgnoreSelected false
+#	ReportInactive true
+#	UniqueName false
 #</Plugin>
 
 #<Plugin ipmi>
 #	Sensor "some_sensor"
 #	Sensor "another_one"
 #	IgnoreSelected false
@@ -598,12 +638,18 @@
 
 #<Plugin lpar>
 #	CpuPoolStats   false
 #	ReportBySerial false
 #</Plugin>
 
+#<Plugin lua>
+#	BasePath "@prefix@/share/@PACKAGE_NAME@/lua"
+#	Script "script1.lua"
+#	Script "script2.lua"
+#</Plugin>
+
 #<Plugin madwifi>
 #	Interface "wlan0"
 #	IgnoreSelected false
 #	Source "SysFS"
 #	WatchSet "None"
 #	WatchAdd "node_octets"
@@ -666,30 +712,70 @@
 #			Instance "foobar" # optional
 #			Collect "data_name"
 #		</Slave>
 #	</Host>
 #</Plugin>
 
+#<Plugin mqtt>
+#	<Publish "name">
+#		Host "localhost"
+#		Port 1883
+#		ClientId "localhost"
+#		User "user"
+#		Password "secret"
+#		QoS 0
+#		Prefix "collectd"
+#		StoreRates true
+#		Retain false
+#		CACert "/etc/ssl/ca.crt"
+#		CertificateFile "/etc/ssl/client.crt"
+#		CertificateKeyFile "/etc/ssl/client.pem"
+#		TLSProtocol "tlsv1.2"
+#		CipherSuite "ciphers"
+#	</Publish>
+#	<Subscribe "name">
+#		Host "localhost"
+#		Port 1883
+#		ClientId "localhost"
+#		User "user"
+#		Password "secret"
+#		QoS 2
+#		Topic "collectd/#"
+#		CleanSession true
+#	</Subscribe>
+#</Plugin>
+
 #<Plugin mysql>
 #	<Database db_name>
 #		Host "database.serv.er"
 #		User "db_user"
 #		Password "secret"
 #		Database "db_name"
+#		SSLKey "/path/to/key.pem"
+#		SSLCert "/path/to/cert.pem"
+#		SSLCA "/path/to/ca.pem"
+#		SSLCAPath "/path/to/cas/"
+#		SSLCipher "DHE-RSA-AES256-SHA"
 #		MasterStats true
 #		ConnectTimeout 10
 #		InnodbStats true
 #	</Database>
 #
 #	<Database db_name2>
 #		Alias "squeeze"
 #		Host "localhost"
 #		Socket "/var/run/mysql/mysqld.sock"
 #		SlaveStats true
 #		SlaveNotifications true
 #	</Database>
+#	<Database galera>
+#		Alias "galera"
+#		Host "localhost"
+#		Socket "/var/run/mysql/mysqld.sock"
+#		WsrepStats true
+#	</Database>
 #</Plugin>
 
 #<Plugin netapp>
 #	<Host "netapp1.example.com">
 #		Protocol      "https"
 #		Address       "10.0.0.1"
@@ -803,12 +889,16 @@
 #	# <WARNING/FAILURE/OK> on <hostname>. beware! do not use not more than two %s in this string!!!
 #	Subject "Aaaaaa!! %s on %s!!!!!"
 #	Recipient "email1@domain1.net"
 #	Recipient "email2@domain2.com"
 #</Plugin>
 
+#<Plugin notify_nagios>
+#	CommandFile "/usr/local/nagios/var/rw/nagios.cmd"
+#</Plugin>
+
 #<Plugin ntpd>
 #	Host "localhost"
 #	Port 123
 #	ReverseLookups false
 #	IncludeUnitID true
 #</Plugin>
@@ -1097,12 +1187,13 @@
 #  Host "::"
 #  Port "8125"
 #  DeleteCounters false
 #  DeleteTimers   false
 #  DeleteGauges   false
 #  DeleteSets     false
+#  CounterSum     false
 #  TimerPercentile 90.0
 #  TimerPercentile 95.0
 #  TimerPercentile 99.0
 #  TimerLower     false
 #  TimerUpper     false
 #  TimerSum       false
@@ -1212,16 +1303,16 @@
 #</Plugin>
 
 #<Plugin turbostat>
 ##	None of the following option should be set manually
 ##	This plugin automatically detect most optimal options
 ##	Only set values here if:
-##	- The module ask you to
+##	- The module asks you to
 ##	- You want to disable the collection of some data
-##	- Your (intel) CPU is not supported (yet) by the module
-##	- The module generate a lot of errors 'MSR offset 0x... read failed'
+##	- Your (Intel) CPU is not supported (yet) by the module
+##	- The module generates a lot of errors 'MSR offset 0x... read failed'
 ##	In the last two cases, please open a bug request
 #
 #	TCCActivationTemp "100"
 #	CoreCstates "392"
 # 	PackageCstates "396"
 #	SystemManagementInterrupt true
@@ -1307,19 +1398,19 @@
 
 #<Plugin write_graphite>
 #  <Node "example">
 #    Host "localhost"
 #    Port "2003"
 #    Protocol "tcp"
+#    ReconnectInterval 0
 #    LogSendErrors true
 #    Prefix "collectd"
 #    Postfix "collectd"
 #    StoreRates true
 #    AlwaysAppendDS false
 #    EscapeCharacter "_"
-#    SeparateInstances false
 #  </Node>
 #</Plugin>
 
 #<Plugin write_http>
 #	<Node "example">
 #		URL "http://example.com/collectd-post"
@@ -1329,14 +1420,17 @@
 #		VerifyHost true
 #		CACert "/etc/ssl/ca.crt"
 #		CAPath "/etc/ssl/certs/"
 #		ClientKey "/etc/ssl/client.pem"
 #		ClientCert "/etc/ssl/client.crt"
 #		ClientKeyPass "secret"
+#		Header "X-Custom-Header: custom_value"
 #		SSLVersion "TLSv1"
 #		Format "Command"
+#		Metrics true
+#		Notifications false
 #		StoreRates false
 #		BufferSize 4096
 #		LowSpeedLimit 0
 #		Timeout 0
 #	</Node>
 #</Plugin>
@@ -1362,12 +1456,13 @@
 
 #<Plugin write_redis>
 #	<Node "example">
 #		Host "localhost"
 #		Port "6379"
 #		Timeout 1000
+#		Prefix "collectd/"
 #	</Node>
 #</Plugin>
 
 #<Plugin write_riemann>
 #	<Node "example">
 #		Host "localhost"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.pod /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.pod
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd.conf.pod	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd.conf.pod	2016-09-11 16:10:25.255038733 +0800
@@ -35,13 +35,13 @@
 B<LoadPlugin> lines may be omitted for all plugins with a configuration block,
 i.e. a C<E<lt>PluginE<nbsp>...E<gt>> block.
 
 The syntax of this config file is similar to the config file of the famous
 I<Apache> webserver. Each line contains either an option (a key and a list of
 one or more values) or a section-start or -end. Empty lines and everything
-after a non-quoted hash-symbol (C<#>) is ignored. I<Keys> are unquoted
+after a non-quoted hash-symbol (C<#>) are ignored. I<Keys> are unquoted
 strings, consisting only of alphanumeric characters and the underscore (C<_>)
 character. Keys are handled case insensitive by I<collectd> itself and all
 plugins included with it. I<Values> can either be an I<unquoted string>, a
 I<quoted string> (enclosed in double-quotes) a I<number> or a I<boolean>
 expression. I<Unquoted strings> consist of only alphanumeric characters and
 underscores (C<_>) and do not need to be quoted. I<Quoted strings> are
@@ -67,26 +67,26 @@
 =head1 GLOBAL OPTIONS
 
 =over 4
 
 =item B<BaseDir> I<Directory>
 
-Sets the base directory. This is the directory beneath all RRD-files are
+Sets the base directory. This is the directory beneath which all RRD-files are
 created. Possibly more subdirectories are created. This is also the working
 directory for the daemon.
 
 =item B<LoadPlugin> I<Plugin>
 
 Loads the plugin I<Plugin>. This is required to load plugins, unless the
 B<AutoLoadPlugin> option is enabled (see below). Without any loaded plugins,
 I<collectd> will be mostly useless.
 
 Only the first B<LoadPlugin> statement or block for a given plugin name has any
 effect. This is useful when you want to split up the configuration into smaller
 files and want each file to be "self contained", i.e. it contains a B<Plugin>
-block I<and> then appropriate B<LoadPlugin> statement. The downside is that if
+block I<and> the appropriate B<LoadPlugin> statement. The downside is that if
 you have multiple conflicting B<LoadPlugin> blocks, e.g. when they specify
 different intervals, only one of them (the first one encountered) will take
 effect and all others will be silently ignored.
 
 B<LoadPlugin> may either be a simple configuration I<statement> or a I<block>
 with additional options, affecting the behavior of B<LoadPlugin>. A simple
@@ -124,14 +124,23 @@
 either C<perl> or C<python>, the default is changed to enabled in order to keep
 the average user from ever having to deal with this low level linking stuff.
 
 =item B<Interval> I<Seconds>
 
 Sets a plugin-specific interval for collecting metrics. This overrides the
-global B<Interval> setting. If a plugin provides own support for specifying an
-interval, that setting will take precedence.
+global B<Interval> setting. If a plugin provides its own support for specifying
+an interval, that setting will take precedence.
+
+=item B<FlushInterval> I<Seconds>
+
+Specifies the interval, in seconds, to call the flush callback if it's
+defined in this plugin. By default, this is disabled.
+
+=item B<FlushTimeout> I<Seconds>
+
+Specifies the value of the timeout argument of the flush callback.
 
 =back
 
 =item B<AutoLoadPlugin> B<false>|B<true>
 
 When set to B<false> (the default), each plugin needs to be loaded explicitly,
@@ -200,13 +209,13 @@
 arbitrarily mix configuration files and other documents (e.g. README files).
 The given example is similar to the first example above but includes all files
 matching C<*.conf> in any subdirectory of C</etc/collectd.d>.
 
 =back
 
-If more than one files are included by a single B<Include> option, the files
+If more than one file is included by a single B<Include> option, the files
 will be included in lexicographical order (as defined by the C<strcmp>
 function). Thus, you can e.E<nbsp>g. use numbered prefixes to specify the
 order in which the files are loaded.
 
 To prevent loops and shooting yourself in the foot in interesting ways the
 nesting is limited to a depth of 8E<nbsp>levels, which should be sufficient for
@@ -229,31 +238,25 @@
 
 =item B<TypesDB> I<File> [I<File> ...]
 
 Set one or more files that contain the data-set descriptions. See
 L<types.db(5)> for a description of the format of this file.
 
-If this option is not specified, a default file is read. If you need to define
-custom types in addition to the types defined in the default file, you need to
-explicitly load both. In other words, if the B<TypesDB> option is encountered
-the default behavior is disabled and if you need the default types you have to
-also explicitly load them.
-
 =item B<Interval> I<Seconds>
 
 Configures the interval in which to query the read plugins. Obviously smaller
 values lead to a higher system load produced by collectd, while higher values
 lead to more coarse statistics.
 
 B<Warning:> You should set this once and then never touch it again. If you do,
 I<you will have to delete all your RRD files> or know some serious RRDtool
 magic! (Assuming you're using the I<RRDtool> or I<RRDCacheD> plugin.)
 
 =item B<MaxReadInterval> I<Seconds>
 
-Read plugin doubles interval between queries after each failed attempt
+A read plugin doubles the interval between queries after each failed attempt
 to get data.
 
 This options limits the maximum value of the interval. The default value is
 B<86400>.
 
 =item B<Timeout> I<Iterations>
@@ -520,13 +523,15 @@
 
 =head2 Plugin C<amqp>
 
 The I<AMQP plugin> can be used to communicate with other instances of
 I<collectd> or third party applications using an AMQP message broker. Values
 are sent to or received from the broker, which handles routing, queueing and
-possibly filtering or messages.
+possibly filtering out messages.
+
+B<Synopsis:>
 
  <Plugin "amqp">
    # Send values to an AMQP broker
    <Publish "some_name">
      Host "localhost"
      Port "5672"
@@ -818,18 +823,30 @@
 B<apcupsd> can handle it.
 
 =item B<Port> I<Port>
 
 TCP-Port to connect to. Defaults to B<3551>.
 
-=item B<ReportSeconds> B<true|false>
+=item B<ReportSeconds> B<true>|B<false>
 
 If set to B<true>, the time reported in the C<timeleft> metric will be
 converted to seconds. This is the recommended setting. If set to B<false>, the
 default for backwards compatibility, the time will be reported in minutes.
 
+=item B<PersistentConnection> B<true>|B<false>
+
+The plugin is designed to keep the connection to I<apcupsd> open between reads.
+If plugin poll interval is greater than 15 seconds (hardcoded socket close
+timeout in I<apcupsd> NIS), then this option is B<false> by default.
+
+You can instruct the plugin to close the connection after each read by setting
+this option to B<false> or force keeping the connection by setting it to B<true>.
+
+If I<apcupsd> appears to close the connection due to inactivity quite quickly,
+the plugin will try to detect this problem and switch to an open-read-close mode.
+
 =back
 
 =head2 Plugin C<aquaero>
 
 This plugin collects the value of the available sensors in an
 I<AquaeroE<nbsp>5> board. AquaeroE<nbsp>5 is a water-cooling controller board,
@@ -934,13 +951,13 @@
 It was developed and tested under Linux only. The only platform dependency is
 the standard Linux i2c-dev interface (the particular bus driver has to
 support the SM Bus command subset).
 
 The reduction or normalization to mean sea level pressure requires (depending
 on selected method/approximation) also altitude and reference to temperature
-sensor(s).  When multiple temperature sensors are configured the minimum of
+sensor(s).  When multiple temperature sensors are configured the minumum of
 their values is always used (expecting that the warmer ones are affected by
 e.g. direct sun light at that moment).
 
 Synopsis:
 
   <Plugin "barometer">
@@ -1046,13 +1063,13 @@
 The altitude (in meters) of the location where you meassure the pressure.
 
 =item B<TemperatureSensor> I<reference>
 
 Temperature sensor(s) which should be used as a reference when normalizing the
 pressure using C<Normalization> method 2.
-When specified more sensors a minimum is found and used each time.  The
+When specified more sensors a minumum is found and used each time.  The
 temperature reading directly from this pressure sensor/plugin is typically not
 suitable as the pressure sensor will be probably inside while we want outside
 temperature.  The collectd reference name is something like
 <hostname>/<plugin_name>-<plugin_instance>/<type>-<type_instance>
 (<type_instance> is usually omitted when there is just single value type). Or
 you can figure it out from the path of the output data files.
@@ -1341,12 +1358,38 @@
 match any one of the criteria are collected. By default only selected
 cgroups are collected if a selection is made. If no selection is configured
 at all, B<all> cgroups are selected.
 
 =back
 
+=head2 Plugin C<chrony>
+
+The C<chrony> plugin collects ntp data from a B<chronyd> server, such as clock
+skew and per-peer stratum.
+
+For talking to B<chronyd>, it mimics what the B<chronyc> control program does
+on the wire.
+
+Available configuration options for the C<chrony> plugin:
+
+=over 4
+
+=item B<Host> I<Hostname>
+
+Hostname of the host running B<chronyd>. Defaults to B<localhost>.
+
+=item B<Port> I<Port>
+
+UDP-Port to connect to. Defaults to B<323>.
+
+=item B<Timeout> I<Timeout>
+
+Connection timeout in seconds. Defaults to B<2>.
+
+=back
+
 =head2 Plugin C<conntrack>
 
 This plugin collects IP conntrack statistics.
 
 =over 4
 
@@ -1401,22 +1444,37 @@
 
 This option is only considered when both, B<ReportByCpu> and B<ReportByState>
 are set to B<true>. In this case, by default, metrics will be reported as
 Jiffies. By setting this option to B<true>, you can request percentage values
 in the un-aggregated (per-CPU, per-state) mode as well.
 
+=item B<ReportNumCpu> B<false>|B<true>
+
+When set to B<true>, reports the number of available CPUs.
+Defaults to B<false>.
+
 =back
 
 =head2 Plugin C<cpufreq>
 
 This plugin doesn't have any options. It reads
 F</sys/devices/system/cpu/cpu0/cpufreq/scaling_cur_freq> (for the first CPU
 installed) to get the current CPU frequency. If this file does not exist make
 sure B<cpufreqd> (L<http://cpufreqd.sourceforge.net/>) or a similar tool is
 installed and an "cpu governor" (that's a kernel module) is loaded.
 
+=head2 Plugin C<cpusleep>
+
+This plugin doesn't have any options. It reads CLOCK_BOOTTIME and
+CLOCK_MONOTONIC and reports the difference between these clocks. Since
+BOOTTIME clock increments while device is suspended and MONOTONIC
+clock does not, the derivative of the difference between these clocks
+gives the relative amount of time the device has spent in suspend
+state. The recorded value is in milliseconds of sleep per seconds of
+wall clock.
+
 =head2 Plugin C<csv>
 
 =over 4
 
 =item B<DataDir> I<Directory>
 
@@ -1431,12 +1489,98 @@
 If set to B<true>, convert counter values to rates. If set to B<false> (the
 default) counter values are stored as is, i.E<nbsp>e. as an increasing integer
 number.
 
 =back
 
+=head2 cURL Statistics
+
+All cURL-based plugins support collection of generic, request-based
+statistics. These are disabled by default and can be enabled selectively for
+each page or URL queried from the curl, curl_json, or curl_xml plugins. See
+the documentation of those plugins for specific information. This section
+describes the available metrics that can be configured for each plugin. All
+options are disabled by default.
+
+See L<http://curl.haxx.se/libcurl/c/curl_easy_getinfo.html> for more details.
+
+=over 4
+
+=item B<TotalTime> B<true|false>
+
+Total time of the transfer, including name resolving, TCP connect, etc.
+
+=item B<NamelookupTime> B<true|false>
+
+Time it took from the start until name resolving was completed.
+
+=item B<ConnectTime> B<true|false>
+
+Time it took from the start until the connect to the remote host (or proxy)
+was completed.
+
+=item B<AppconnectTime> B<true|false>
+
+Time it took from the start until the SSL/SSH connect/handshake to the remote
+host was completed.
+
+=item B<PretransferTime> B<true|false>
+
+Time it took from the start until just before the transfer begins.
+
+=item B<StarttransferTime> B<true|false>
+
+Time it took from the start until the first byte was received.
+
+=item B<RedirectTime> B<true|false>
+
+Time it took for all redirection steps include name lookup, connect,
+pre-transfer and transfer before final transaction was started.
+
+=item B<RedirectCount> B<true|false>
+
+The total number of redirections that were actually followed.
+
+=item B<SizeUpload> B<true|false>
+
+The total amount of bytes that were uploaded.
+
+=item B<SizeDownload> B<true|false>
+
+The total amount of bytes that were downloaded.
+
+=item B<SpeedDownload> B<true|false>
+
+The average download speed that curl measured for the complete download.
+
+=item B<SpeedUpload> B<true|false>
+
+The average upload speed that curl measured for the complete upload.
+
+=item B<HeaderSize> B<true|false>
+
+The total size of all the headers received.
+
+=item B<RequestSize> B<true|false>
+
+The total size of the issued requests.
+
+=item B<ContentLengthDownload> B<true|false>
+
+The content-length of the download.
+
+=item B<ContentLengthUpload> B<true|false>
+
+The specified size of the upload.
+
+=item B<NumConnects> B<true|false>
+
+The number of new connections that were created to achieve the transfer.
+
+=back
+
 =head2 Plugin C<curl>
 
 The curl plugin uses the B<libcurl> (L<http://curl.haxx.se/>) to read web pages
 and the match infrastructure (the same code used by the tail plugin) to use
 regular expressions with the received data.
 
@@ -1531,17 +1675,27 @@
 blocks (see below) are optional. Disabled by default.
 
 Beware that requests will get aborted if they take too long to complete. Adjust
 B<Timeout> accordingly if you expect B<MeasureResponseTime> to report such slow
 requests.
 
+This option is similar to enabling the B<TotalTime> statistic but it's
+measured by collectd instead of cURL.
+
 =item B<MeasureResponseCode> B<true>|B<false>
 
 Measure response code for the request. If this setting is enabled, B<Match>
 blocks (see below) are optional. Disabled by default.
 
+=item B<E<lt>StatisticsE<gt>>
+
+One B<Statistics> block can be used to specify cURL statistics to be collected
+for each request to the remote web site. See the section "cURL Statistics"
+above for details. If this setting is enabled, B<Match> blocks (see below) are
+optional.
+
 =item B<E<lt>MatchE<gt>>
 
 One or more B<Match> blocks that define how to match information in the data
 returned by C<libcurl>. The C<curl> plugin uses the same infrastructure that's
 used by the C<tail> plugin, so please see the documentation of the C<tail>
 plugin below on how matches are defined. If the B<MeasureResponseTime> or
@@ -1618,12 +1772,17 @@
 values for all map keys or array indices will be collectd.
 
 The following options are valid within B<URL> blocks:
 
 =over 4
 
+=item B<Host> I<Name>
+
+Use I<Name> as the host name when submitting values. Defaults to the global
+host name setting.
+
 =item B<Instance> I<Instance>
 
 Sets the plugin instance to I<Instance>.
 
 =item B<Interval> I<Interval>
 
@@ -1648,12 +1807,18 @@
 
 =item B<Timeout> I<Milliseconds>
 
 These options behave exactly equivalent to the appropriate options of the
 I<cURL> plugin. Please see there for a detailed description.
 
+=item B<E<lt>StatisticsE<gt>>
+
+One B<Statistics> block can be used to specify cURL statistics to be collected
+for each request to the remote URL. See the section "cURL Statistics" above
+for details.
+
 =back
 
 The following options are valid within B<Key> blocks:
 
 =over 4
 
@@ -1750,12 +1915,18 @@
 
 =item B<Timeout> I<Milliseconds>
 
 These options behave exactly equivalent to the appropriate options of the
 I<cURL plugin>. Please see there for a detailed description.
 
+=item B<E<lt>StatisticsE<gt>>
+
+One B<Statistics> block can be used to specify cURL statistics to be collected
+for each request to the remote URL. See the section "cURL Statistics" above
+for details.
+
 =item E<lt>B<XPath> I<XPath-expression>E<gt>
 
 Within each B<URL> block, there must be one or more B<XPath> blocks. Each
 B<XPath> block specifies how to get one type of information. The string
 argument must be a valid XPath expression which returns a list of "base
 elements". One value is dispatched for each "base element".
@@ -1822,12 +1993,13 @@
         InstancesFrom "category"
         ValuesFrom "value"
       </Result>
     </Query>
     <Database "product_information">
       Driver "mysql"
+      Interval 120
       DriverOption "host" "localhost"
       DriverOption "username" "collectd"
       DriverOption "password" "aZo6daiw"
       DriverOption "dbname" "prod_info"
       SelectDB "prod_info"
       Query "out_of_stock"
@@ -2001,12 +2173,17 @@
 Each database needs a "name" as string argument in the starting tag of the
 block. This name will be used as "PluginInstance" in the values submitted to
 the daemon. Other than that, that name is not used.
 
 =over 4
 
+=item B<Interval> I<Interval>
+
+Sets the interval (in seconds) in which the values will be collected from this
+database. By default the global B<Interval> setting will be used.
+
 =item B<Driver> I<Driver>
 
 Specifies the driver to use to connect to the database. In many cases those
 drivers are named after the database they can connect to, but this is not a
 technical necessity. These drivers are sometimes referred to as "DBD",
 B<D>ataB<B>ase B<D>river, and some distributions ship them in separate
@@ -2036,13 +2213,13 @@
 
 Unfortunately, drivers are not too keen to report errors when an unknown option
 is passed to them, so invalid settings here may go unnoticed. This is not the
 plugin's fault, it will report errors if it gets them from the libraryE<nbsp>/
 the driver. If a driver complains about an option, the plugin will dump a
 complete list of all options understood by that driver to the log. There is no
-way to programmatically find out if an option expects a string or a numeric
+way to programatically find out if an option expects a string or a numeric
 argument, so you will have to refer to the appropriate DBD's documentation to
 find this out. Sorry.
 
 =item B<SelectDB> I<Database>
 
 In some cases, the database name you connect with is not the database name you
@@ -2241,13 +2418,13 @@
 instance> set to I<Name>, the name of the metric as reported by the driver. If
 an appropriate B<Map> option exists, the given I<Type> and, optionally,
 I<TypeInstance> will be used.
 
 =item B<MappedOnly> B<true>|B<false>
 
-When set to B<true>, only metrics that can be mapped to to a I<type> will be
+When set to B<true>, only metrics that can be mapped to a I<type> will be
 collected, all other metrics will be ignored. Defaults to B<false>.
 
 =back
 
 =head2 Plugin C<exec>
 
@@ -2471,12 +2648,151 @@
 source, this is optional. Otherwise the option is required.
 
 =back
 
 =back
 
+=head2 Plugin C<gps>
+
+The C<gps plugin> connects to gpsd on the host machine.
+The host, port, timeout and pause are configurable.
+
+This is useful if you run an NTP server using a GPS for source and you want to
+monitor it.
+
+Mind your GPS must send $--GSA for having the data reported!
+
+The following elements are collected:
+
+=over 4
+
+=item B<satellites>
+
+Number of satellites used for fix (type instance "used") and in view (type
+instance "visible"). 0 means no GPS satellites are visible.
+
+=item B<dilution_of_precision>
+
+Vertical and horizontal dilution (type instance "horizontal" or "vertical").
+It should be between 0 and 3.
+Look at the documentation of your GPS to know more.
+
+=back
+
+Synopsis:
+
+ LoadPlugin gps
+ <Plugin "gps">
+   # Connect to localhost on gpsd regular port:
+   Host "127.0.0.1"
+   Port "2947"
+   # 15 ms timeout
+   Timeout 0.015
+   # PauseConnect of 5 sec. between connection attempts.
+   PauseConnect 5
+ </Plugin>
+
+Available configuration options:
+
+=over 4
+
+=item B<Host> I<Host>
+
+The host on which gpsd daemon runs. Defaults to B<localhost>.
+
+=item B<Port> I<Port>
+
+Port to connect to gpsd on the host machine. Defaults to B<2947>.
+
+=item B<Timeout> I<Seconds>
+
+Timeout in seconds (default 0.015 sec).
+
+The GPS data stream is fetch by the plugin form the daemon.
+It waits for data to be available, if none arrives it times out
+and loop for another reading.
+Mind to put a low value gpsd expects value in the micro-seconds area
+(recommended is 500 us) since the waiting function is blocking.
+Value must be between 500 us and 5 sec., if outside that range the
+default value is applied.
+
+This only applies from gpsd release-2.95.
+
+=item B<PauseConnect> I<Seconds>
+
+Pause to apply between attempts of connection to gpsd in seconds (default 5 sec).
+
+=back
+
+=head2 Plugin C<grpc>
+
+The I<grpc> plugin provides an RPC interface to submit values to or query
+values from collectd based on the open source gRPC framework. It exposes an
+end-point for dispatching values to the daemon.
+
+The B<gRPC> homepage can be found at L<https://grpc.io/>.
+
+=over 4
+
+=item B<Server> I<Host> I<Port>
+
+The B<Server> statement sets the address of a server to which to send metrics
+via the C<DispatchValues> function.
+
+The argument I<Host> may be a hostname, an IPv4 address, or an IPv6 address.
+
+Optionally, B<Server> may be specified as a configuration block which supports
+the following options:
+
+=over 4
+
+=item B<EnableSSL> B<false>|B<true>
+
+Whether to require SSL for outgoing connections. Default: false.
+
+=item B<SSLCACertificateFile> I<Filename>
+
+=item B<SSLCertificateFile> I<Filename>
+
+=item B<SSLCertificateKeyFile> I<Filename>
+
+Filenames specifying SSL certificate and key material to be used with SSL
+connections.
+
+=back
+
+=item B<Listen> I<Host> I<Port>
+
+The B<Listen> statement sets the network address to bind to. When multiple
+statements are specified, the daemon will bind to all of them. If none are
+specified, it defaults to B<0.0.0.0:50051>.
+
+The argument I<Host> may be a hostname, an IPv4 address, or an IPv6 address.
+
+Optionally, B<Listen> may be specified as a configuration block which
+supports the following options:
+
+=over 4
+
+=item B<EnableSSL> I<true>|I<false>
+
+Whether to enable SSL for incoming connections. Default: false.
+
+=item B<SSLCACertificateFile> I<Filename>
+
+=item B<SSLCertificateFile> I<Filename>
+
+=item B<SSLCertificateKeyFile> I<Filename>
+
+Filenames specifying SSL certificate and key material to be used with SSL
+connections.
+
+=back
+
+=back
+
 =head2 Plugin C<hddtemp>
 
 To get values from B<hddtemp> collectd connects to B<localhost> (127.0.0.1),
 port B<7634/tcp>. The B<Host> and B<Port> options can be used to change these
 default values, see below. C<hddtemp> has to be running to work correctly. If
 C<hddtemp> is not running timeouts may appear which may interfere with other
@@ -2530,12 +2846,35 @@
  IgnoreSelected "true"
 
 This will ignore the loopback interface, all interfaces with names starting
 with I<veth> and all interfaces with names starting with I<tun> followed by
 at least one digit.
 
+=item B<ReportInactive> I<true>|I<false>
+
+When set to I<false>, only interfaces with non-zero traffic will be
+reported. Note that the check is done by looking into whether a
+package was sent at any time from boot and the corresponding counter
+is non-zero. So, if the interface has been sending data in the past
+since boot, but not during the reported time-interval, it will still
+be reported.
+
+The default value is I<true> and results in collection of the data
+from all interfaces that are selected by B<Interface> and
+B<IgnoreSelected> options.
+
+=item B<UniqueName> I<true>|I<false>
+
+Interface name is not unique on Solaris (KSTAT), interface name is unique
+only within a module/instance. Following tuple is considered unique:
+   (ks_module, ks_instance, ks_name)
+If this option is set to true, interface name contains above three fields
+separated by an underscore. For more info on KSTAT, visit
+L<http://docs.oracle.com/cd/E23824_01/html/821-1468/kstat-3kstat.html#REFMAN3Ekstat-3kstat>
+
+This option is only available on Solaris.
 
 =back
 
 =head2 Plugin C<ipmi>
 
 =over 4
@@ -2773,12 +3112,18 @@
 is reported in the I<plugin instance>. Otherwise, the logical hostname will be
 used (just like other plugins) and the I<plugin instance> will be empty.
 Defaults to false.
 
 =back
 
+=head2 Plugin C<lua>
+
+This plugin embeds a Lua interpreter into collectd and provides an interface
+to collectd's plugin system. See L<collectd-lua(5)> for its documentation.
+
+
 =head2 Plugin C<mbmon>
 
 The C<mbmon plugin> uses mbmon to retrieve temperature, voltage, etc.
 
 Be default collectd connects to B<localhost> (127.0.0.1), port B<411/tcp>. The
 B<Host> and B<Port> options can be used to change these values, see below.
@@ -3251,12 +3596,152 @@
 =back
 
 =back
 
 =back
 
+=head2 Plugin C<mqtt>
+
+The I<MQTT plugin> can send metrics to MQTT (B<Publish> blocks) and receive
+values from MQTT (B<Subscribe> blocks).
+
+B<Synopsis:>
+
+ <Plugin mqtt>
+   <Publish "name">
+     Host "mqtt.example.com"
+     Prefix "collectd"
+   </Publish>
+   <Subscribe "name">
+     Host "mqtt.example.com"
+     Topic "collectd/#"
+   </Subscribe>
+ </Plugin>
+
+The plugin's configuration is in B<Publish> and/or B<Subscribe> blocks,
+configuring the sending and receiving direction respectively. The plugin will
+register a write callback named C<mqtt/I<name>> where I<name> is the string
+argument given to the B<Publish> block. Both types of blocks share many but not
+all of the following options. If an option is valid in only one of the blocks,
+it will be mentioned explicitly.
+
+B<Options:>
+
+=over 4
+
+=item B<Host> I<Hostname>
+
+Hostname of the MQTT broker to connect to.
+
+=item B<Port> I<Service>
+
+Port number or service name of the MQTT broker to connect to.
+
+=item B<User> I<UserName>
+
+Username used when authenticating to the MQTT broker.
+
+=item B<Password> I<Password>
+
+Password used when authenticating to the MQTT broker.
+
+=item B<ClientId> I<ClientId>
+
+MQTT client ID to use. Defaults to the hostname used by I<collectd>.
+
+=item B<QoS> [B<0>-B<2>]
+
+Sets the I<Quality of Service>, with the values C<0>, C<1> and C<2> meaning:
+
+=over 4
+
+=item B<0>
+
+At most once
+
+=item B<1>
+
+At least once
+
+=item B<2>
+
+Exactly once
+
+=back
+
+In B<Publish> blocks, this option determines the QoS flag set on outgoing
+messages and defaults to B<0>. In B<Subscribe> blocks, determines the maximum
+QoS setting the client is going to accept and defaults to B<2>. If the QoS flag
+on a message is larger than the maximum accepted QoS of a subscriber, the
+message's QoS will be downgraded.
+
+=item B<Prefix> I<Prefix> (Publish only)
+
+This plugin will use one topic per I<value list> which will looks like a path.
+I<Prefix> is used as the first path element and defaults to B<collectd>.
+
+An example topic name would be:
+
+ collectd/cpu-0/cpu-user
+
+=item B<Retain> B<false>|B<true> (Publish only)
+
+Controls whether the MQTT broker will retain (keep a copy of) the last message
+sent to each topic and deliver it to new subscribers. Defaults to B<false>.
+
+=item B<StoreRates> B<true>|B<false> (Publish only)
+
+Controls whether C<DERIVE> and C<COUNTER> metrics are converted to a I<rate>
+before sending. Defaults to B<true>.
+
+=item B<CleanSession> B<true>|B<false> (Subscribe only)
+
+Controls whether the MQTT "cleans" the session up after the subscriber
+disconnects or if it maintains the subscriber's subscriptions and all messages
+that arrive while the subscriber is disconnected. Defaults to B<true>.
+
+=item B<Topic> I<TopicName> (Subscribe only)
+
+Configures the topic(s) to subscribe to. You can use the single level C<+> and
+multi level C<#> wildcards. Defaults to B<collectd/#>, i.e. all topics beneath
+the B<collectd> branch.
+
+=item B<CACert> I<file>
+
+Path to the PEM-encoded CA certificate file. Setting this option enables TLS
+communication with the MQTT broker, and as such, B<Port> should be the TLS-enabled
+port of the MQTT broker.
+A valid TLS configuration requires B<CACert>, B<CertificateFile> and B<CertificateKeyFile>.
+
+=item B<CertificateFile> I<file>
+
+Path to the PEM-encoded certificate file to use as client certificate when
+connecting to the MQTT broker.
+A valid TLS configuration requires B<CACert>, B<CertificateFile> and B<CertificateKeyFile>.
+
+=item B<CertificateKeyFile> I<file>
+
+Path to the unencrypted PEM-encoded key file corresponding to B<CertificateFile>.
+A valid TLS configuration requires B<CACert>, B<CertificateFile> and B<CertificateKeyFile>.
+
+=item B<TLSProtocol> I<protocol>
+
+If configured, this specifies the string protocol version (e.g. C<tlsv1>,
+C<tlsv1.2>) to use for the TLS connection to the broker. If not set a default
+version is used which depends on the version of OpenSSL the Mosquitto library
+was linked against.
+
+=item B<CipherSuite> I<ciphersuite>
+
+A string describing the ciphers available for use. See L<ciphers(1)> and the
+C<openssl ciphers> utility for more information. If unset, the default ciphers
+will be used.
+
+
+=back
+
 =head2 Plugin C<mysql>
 
 The C<mysql plugin> requires B<mysqlclient> to be installed. It connects to
 one or more databases when started and keeps the connection up as long as
 possible. When the connection is interrupted for whatever reason it will try
 to re-connect. The plugin will complain loudly in case anything goes wrong.
@@ -3284,27 +3769,40 @@
       Host "hostname"
       User "username"
       Password "password"
       Port "3306"
       MasterStats true
       ConnectTimeout 10
+      SSLKey "/path/to/key.pem"
+      SSLCert "/path/to/cert.pem"
+      SSLCA "/path/to/ca.pem"
+      SSLCAPath "/path/to/cas/"
+      SSLCipher "DHE-RSA-AES256-SHA"
     </Database>
 
     <Database bar>
       Alias "squeeze"
       Host "localhost"
       Socket "/var/run/mysql/mysqld.sock"
       SlaveStats true
       SlaveNotifications true
     </Database>
+
+   <Database galera>
+      Alias "galera"
+      Host "localhost"
+      Socket "/var/run/mysql/mysqld.sock"
+      WsrepStats true
+   </Database>
   </Plugin>
 
 A B<Database> block defines one connection to a MySQL database. It accepts a
 single argument which specifies the name of the database. None of the other
 options are required. MySQL will use default values as documented in the
-section "mysql_real_connect()" in the B<MySQL reference manual>.
+"mysql_real_connect()" and "mysql_ssl_set()" sections in the
+B<MySQL reference manual>.
 
 =over 4
 
 =item B<Alias> I<Alias>
 
 Alias to use as sender instead of hostname when reporting. This may be useful
@@ -3363,16 +3861,42 @@
 
 =item B<SlaveNotifications> I<true|false>
 
 If enabled, the plugin sends a notification if the replication slave I/O and /
 or SQL threads are not running. Defaults to B<false>.
 
+=item B<WsrepStats> I<true|false>
+ 
+ Enable the collection of wsrep plugin statistics, used in Master-Master
+ replication setups like in MySQL Galera/Percona XtraDB Cluster.
+ User needs only privileges to execute 'SHOW GLOBAL STATUS'
+ 
 =item B<ConnectTimeout> I<Seconds>
 
 Sets the connect timeout for the MySQL client.
 
+=item B<SSLKey> I<Path>
+
+If provided, the X509 key in PEM format.
+
+=item B<SSLCert> I<Path>
+
+If provided, the X509 cert in PEM format.
+
+=item B<SSLCA> I<Path>
+
+If provided, the CA file in PEM format (check OpenSSL docs).
+
+=item B<SSLCAPath> I<Path>
+
+If provided, the CA directory (check OpenSSL docs).
+
+=item B<SSLCipher> I<String>
+
+If provided, the SSL cipher to use.
+
 =back
 
 =head2 Plugin C<netapp>
 
 The netapp plugin can collect various performance and capacity information
 from a NetApp filer using the NetApp API.
@@ -4306,12 +4830,27 @@
 with the hostname.
 
 Default: C<Collectd notify: %s@%s>
 
 =back
 
+=head2 Plugin C<notify_nagios>
+
+The I<notify_nagios> plugin writes notifications to Nagios' I<command file> as
+a I<passive service check result>.
+
+Available configuration options:
+
+=over 4
+
+=item B<CommandFile> I<Path>
+
+Sets the I<command file> to write to. Defaults to F</usr/local/nagios/var/rw/nagios.cmd>.
+
+=back
+
 =head2 Plugin C<ntpd>
 
 The C<ntpd> plugin collects per-peer ntp data such as time offset and time
 dispersion.
 
 For talking to B<ntpd>, it mimics what the B<ntpdc> control program does on
@@ -4543,12 +5082,22 @@
 
 =item B<URL> I<ldap://host/binddn>
 
 Sets the URL to use to connect to the I<OpenLDAP> server. This option is
 I<mandatory>.
 
+=item B<BindDN> I<BindDN>
+
+Name in the form of an LDAP distinguished name intended to be used for
+authentication. Defaults to empty string to establish an anonymous authorization.
+
+=item B<Password> I<Password>
+
+Password for simple bind authentication. If this option is not set,
+unauthenticated bind operation is used.
+
 =item B<StartTLS> B<true|false>
 
 Defines whether TLS must be used when connecting to the I<OpenLDAP> server.
 Disabled by default.
 
 =item B<VerifyHost> B<true|false>
@@ -4564,14 +5113,15 @@
 may possibly need this option. What CA certificates are checked by default
 depends on the distribution you use and can be changed with the usual ldap
 client configuration mechanisms. See ldap.conf(5) for the details.
 
 =item B<Timeout> I<Seconds>
 
-Sets the timeout value for ldap operations. Defaults to B<-1> which results in
-an infinite timeout.
+Sets the timeout value for ldap operations, in seconds. By default, the
+configured B<Interval> is used to set the timeout. Use B<-1> to disable
+(infinite timeout).
 
 =item B<Version> I<Version>
 
 An integer which sets the LDAP protocol version number to use when connecting
 to the I<OpenLDAP> server. Defaults to B<3> for using I<LDAPv3>.
 
@@ -4814,12 +5364,19 @@
 Default: B<0.9>
 
 =item B<TTL> I<0-255>
 
 Sets the Time-To-Live of generated ICMP packets.
 
+=item B<Size> I<size>
+
+Sets the size of the data payload in ICMP packet to specified I<size> (it
+will be filled with regular ASCII pattern). If not set, default 56 byte
+long string is used so that the packet size of an ICMPv4 packet is exactly
+64 bytes, similar to the behaviour of normal ping(1) command.
+
 =item B<SourceAddress> I<host>
 
 Sets the source address to use. I<host> may either be a numerical network
 address or a network hostname.
 
 =item B<Device> I<name>
@@ -4921,19 +5478,18 @@
   </Plugin>
 
 The B<Query> block defines one database query which may later be used by a
 database definition. It accepts a single mandatory argument which specifies
 the name of the query. The names of all queries have to be unique (see the
 B<MinVersion> and B<MaxVersion> options below for an exception to this
-rule). The following configuration options are available to define the query:
+rule).
+
+In each B<Query> block, there is one or more B<Result> blocks. Multiple
+B<Result> blocks may be used to extract multiple values from a single query.
 
-In each B<Query> block, there is one or more B<Result> blocks. B<Result>
-blocks define how to handle the values returned from the query. They define
-which column holds which value and how to dispatch that value to the daemon.
-Multiple B<Result> blocks may be used to extract multiple values from a single
-query.
+The following configuration options are available to define the query:
 
 =over 4
 
 =item B<Statement> I<sql query statement>
 
 Specify the I<sql query statement> which the plugin should execute. The string
@@ -4945,13 +5501,13 @@
 Any SQL command which may return data (such as C<SELECT> or C<SHOW>) is
 allowed. Note, however, that only a single command may be used. Semicolons are
 allowed as long as a single non-empty command has been specified only.
 
 The returned lines will be handled separately one after another.
 
-=item B<Param> I<hostname>|I<database>|I<username>|I<interval>
+=item B<Param> I<hostname>|I<database>|I<instance>|I<username>|I<interval>
 
 Specify the parameters which should be passed to the SQL query. The parameters
 are referred to in the SQL query as B<$1>, B<$2>, etc. in the same order as
 they appear in the configuration file. The value of the parameter is
 determined depending on the value of the B<Param> option as follows:
 
@@ -4982,20 +5538,48 @@
 
 =back
 
 Please note that parameters are only supported by PostgreSQL's protocol
 version 3 and above which was introduced in version 7.4 of PostgreSQL.
 
+=item B<PluginInstanceFrom> I<column>
+
+Specify how to create the "PluginInstance" for reporting this query results.
+Only one column is supported. You may concatenate fields and string values in
+the query statement to get the required results.
+
+=item B<MinVersion> I<version>
+
+=item B<MaxVersion> I<version>
+
+Specify the minimum or maximum version of PostgreSQL that this query should be
+used with. Some statistics might only be available with certain versions of
+PostgreSQL. This allows you to specify multiple queries with the same name but
+which apply to different versions, thus allowing you to use the same
+configuration in a heterogeneous environment.
+
+The I<version> has to be specified as the concatenation of the major, minor
+and patch-level versions, each represented as two-decimal-digit numbers. For
+example, version 8.2.3 will become 80203.
+
+=back
+
+The B<Result> block defines how to handle the values returned from the query.
+It defines which column holds which value and how to dispatch that value to
+the daemon.
+
+=over 4
+
 =item B<Type> I<type>
 
 The I<type> name to be used when dispatching the values. The type describes
 how to handle the data and where to store it. See L<types.db(5)> for more
 details on types and their configuration. The number and type of values (as
 selected by the B<ValuesFrom> option) has to match the type of the given name.
 
-This option is required inside a B<Result> block.
+This option is mandatory.
 
 =item B<InstancePrefix> I<prefix>
 
 =item B<InstancesFrom> I<column0> [I<column1> ...]
 
 Specify how to create the "TypeInstance" for each data set (i.E<nbsp>e. line).
@@ -5025,26 +5609,12 @@
 by the plugin as well.
 
 This option is required inside a B<Result> block and may be specified multiple
 times. If multiple B<ValuesFrom> options are specified, the columns are read
 in the given order.
 
-=item B<MinVersion> I<version>
-
-=item B<MaxVersion> I<version>
-
-Specify the minimum or maximum version of PostgreSQL that this query should be
-used with. Some statistics might only be available with certain versions of
-PostgreSQL. This allows you to specify multiple queries with the same name but
-which apply to different versions, thus allowing you to use the same
-configuration in a heterogeneous environment.
-
-The I<version> has to be specified as the concatenation of the major, minor
-and patch-level versions, each represented as two-decimal-digit numbers. For
-example, version 8.2.3 will become 80203.
-
 =back
 
 The following predefined queries are available (the definitions can be found
 in the F<postgresql_default.conf> file which, by default, is available at
 C<I<prefix>/share/collectd/>):
 
@@ -5206,14 +5776,16 @@
 transaction fails or if the database server crashes.
 
 =item B<Instance> I<name>
 
 Specify the plugin instance name that should be used instead of the database
 name (which is the default, if this option has not been specified). This
-allows one to query multiple databases of the same name on the same host (e.g.
+allows to query multiple databases of the same name on the same host (e.g.
 when running multiple database server versions in parallel).
+The plugin instance name can also be set from the query result using
+the B<PluginInstanceFrom> option in B<Query> block.
 
 =item B<Host> I<hostname>
 
 Specify the hostname or IP of the PostgreSQL server to connect to. If the
 value begins with a slash, it is interpreted as the directory name in which to
 look for the UNIX domain socket.
@@ -5267,13 +5839,13 @@
 =back
 
 =item B<Instance> I<name>
 
 Specify the plugin instance name that should be used instead of the database
 name (which is the default, if this option has not been specified). This
-allows one to query multiple databases of the same name on the same host (e.g.
+allows to query multiple databases of the same name on the same host (e.g.
 when running multiple database server versions in parallel).
 
 =item B<KRBSrvName> I<kerberos_service_name>
 
 Specify the Kerberos service name to use when authenticating with Kerberos 5
 or GSSAPI. See the sections "Kerberos authentication" and "GSSAPI" of the
@@ -5467,19 +6039,23 @@
 
 Some platforms have a limit on the length of process names. I<Name> must stay
 below this limit.
 
 =item B<ProcessMatch> I<name> I<regex>
 
-Similar to the B<Process> option this allows one to select more detailed
+Similar to the B<Process> option this allows to select more detailed
 statistics of processes matching the specified I<regex> (see L<regex(7)> for
 details). The statistics of all matching processes are summed up and
 dispatched to the daemon using the specified I<name> as an identifier. This
-allows one to "group" several processes together. I<name> must not contain
+allows to "group" several processes together. I<name> must not contain
 slashes.
 
+=item B<CollectContextSwitch> I<Boolean>
+
+Collect context switch of the process.
+
 =back
 
 =head2 Plugin C<protocols>
 
 Collects a lot of information about various network protocols, such as I<IP>,
 I<TCP>, I<UDP>, etc.
@@ -5682,14 +6258,14 @@
 way the C<rrdtool> plugin works (see below). The added abstraction layer
 provides a number of benefits, though: Because the cache is not within
 C<collectd> anymore, it does not need to be flushed when C<collectd> is to be
 restarted. This results in much shorter (if any) gaps in graphs, especially
 under heavy load. Also, the C<rrdtool> command line utility is aware of the
 daemon so that it can flush values to disk automatically when needed. This
-allows one to integrate automated flushing of values into graphing solutions
-much more easily.
+allows to integrate automated flushing of values into graphing solutions much
+more easily.
 
 There are disadvantages, though: The daemon may reside on a different host, so
 it may not be possible for C<collectd> to create the appropriate RRD files
 anymore. And even if C<rrdcached> runs on the same host, it may run in a
 different base directory, so relative paths may do weird stuff if you're not
 careful.
@@ -5940,12 +6516,18 @@
 Thus, you can use the B<Sensor>-option to pick the sensors you're interested
 in. Sometimes, however, it's easier/preferred to collect all sensors I<except> a
 few ones. This option enables you to do that: By setting B<IgnoreSelected> to
 I<true> the effect of B<Sensor> is inverted: All selected sensors are ignored
 and all other sensors are collected.
 
+=item B<UseLabels> I<true>|I<false>
+
+Configures how sensor readings are reported. When set to I<true>, sensor
+readings are reported using their descriptive label (e.g. "VCore"). When set to
+I<false> (the default) the sensor name is used ("in0").
+
 =back
 
 =head2 Plugin C<sigrok>
 
 The I<sigrok plugin> uses I<libsigrok> to retrieve measurements from any device
 supported by the L<sigrok|http://sigrok.org/> project.
@@ -6042,12 +6624,28 @@
 statements, are ignored or if all other disks are ignored. The behavior
 (hopefully) is intuitive: If no B<Disk> option is configured, all disks are
 collected. If at least one B<Disk> option is given and no B<IgnoreSelected> or
 set to B<false>, B<only> matching disks will be collected. If B<IgnoreSelected>
 is set to B<true>, all disks are collected B<except> the ones matched.
 
+=item B<IgnoreSleepMode> B<true>|B<false>
+
+Normally, the C<smart> plugin will ignore disks that are reported to be asleep.
+This option disables the sleep mode check and allows the plugin to collect data
+from these disks anyway. This is useful in cases where libatasmart mistakenly
+reports disks as asleep because it has not been updated to incorporate support
+for newer idle states in the ATA spec.
+
+=item B<UseSerial> B<true>|B<false>
+
+A disk's kernel name (e.g., sda) can change from one boot to the next. If this
+option is enabled, the C<smart> plugin will use the disk's serial number (e.g.,
+HGST_HUH728080ALE600_2EJ8VH8X) instead of the kernel name as the key for
+storing data. This ensures that the data for a given disk will be kept together
+even if the kernel name changes.
+
 =back
 
 =head2 Plugin C<snmp>
 
 Since the configuration of the C<snmp plugin> is a little more complicated than
 other plugins, its documentation has been moved to an own manpage,
@@ -6088,12 +6686,18 @@
 These options control what happens if metrics are not updated in an interval.
 If set to B<False>, the default, metrics are dispatched unchanged, i.e. the
 rate of counters and size of sets will be zero, timers report C<NaN> and gauges
 are unchanged. If set to B<True>, the such metrics are not dispatched and
 removed from the internal cache.
 
+=item B<CounterSum> B<false>|B<true>
+
+When enabled, creates a C<count> metric which reports the change since the last
+read. This option primarily exists for compatibility with the I<statsd>
+implementation by Etsy.
+
 =item B<TimerPercentile> I<Percent>
 
 Calculate and dispatch the configured percentile, i.e. compute the latency, so
 that I<Percent> of all reported timers are smaller than or equal to the
 computed latency. This is useful for cutting off the long tail latency, as it's
 often done in I<Service Level Agreements> (SLAs).
@@ -6601,13 +7205,13 @@
 how many connections a web proxy holds to web servers. You have to give the
 port in numeric form.
 
 =item B<AllPortsSummary> I<true>|I<false>
 
 If this option is set to I<true> a summary of statistics from all connections
-are collectd. This option defaults to I<false>.
+are collected. This option defaults to I<false>.
 
 =back
 
 =head2 Plugin C<thermal>
 
 =over 4
@@ -6696,19 +7300,19 @@
 counter'. This option should only be used if the automated detection
 fails or if you want to disable this feature.
 
 =item B<DigitalTemperatureSensor> I<true>|I<false>
 
 Boolean enabling the collection of the temperature of each core.
-This option should only be used if the automated detectionfails or 
+This option should only be used if the automated detectionfails or
 if you want to disable this feature.
 
 =item B<DigitalTemperatureSensor> I<true>|I<false>
 
 Boolean enabling the collection of the temperature of each package.
-This option should only be used if the automated detectionfails or 
+This option should only be used if the automated detectionfails or
 if you want to disable this feature.
 
 =item B<TCCActivationTemp> I<Temperature>
 
 Thermal Control Circuit Activation Temperature of the installed
 CPU. This temperature is used when collecting the temperature of
@@ -7042,23 +7646,23 @@
 the hypervisor (the "dev" property of the target node), which is equal to
 setting B<name>.
 
 B<address> means use the interface's mac address. This is useful since the
 interface path might change between reboots of a guest or across migrations.
 
-=item B<PluginInstanceFormat> B<name|uuid>
+=item B<PluginInstanceFormat> B<name|uuid|none>
 
 When the virt plugin logs data, it sets the plugin_instance of the collected
-data according to this setting. The default is to use the guest name as provided
-by the hypervisor, which is equal to setting B<name>.
+data according to this setting. The default is to not set the plugin_instance.
 
+B<name> means use the guest's name as provided by the hypervisor.
 B<uuid> means use the guest's UUID.
 
-You can also specify combinations of these fields. For example B<name uuid>
-means to concatenate the guest name and UUID (with a literal colon character
-between, thus I<"foo:1234-1234-1234-1234">).
+You can also specify combinations of the B<name> and B<uuid> fields.
+For example B<name uuid> means to concatenate the guest name and UUID
+(with a literal colon character between, thus I<"foo:1234-1234-1234-1234">).
 
 =back
 
 =head2 Plugin C<vmem>
 
 The C<vmem> plugin collects information about the usage of virtual memory.
@@ -7127,12 +7731,20 @@
 Service name or port number to connect to. Defaults to C<2003>.
 
 =item B<Protocol> I<String>
 
 Protocol to use when connecting to I<Graphite>. Defaults to C<tcp>.
 
+=item B<ReconnectInterval> I<Seconds>
+
+When set to non-zero, forces the connection to the Graphite backend to be
+closed and re-opend periodically. This behavior is desirable in environments
+where the connection to the Graphite backend is done through load balancers,
+for example. When set to zero, the default, the connetion is kept open for as
+long as possible.
+
 =item B<LogSendErrors> B<false>|B<true>
 
 If set to B<true> (the default), logs errors when sending data to I<Graphite>.
 If set to B<false>, it will not log the errors. This is especially useful when
 using Protocol UDP since many times we want to use the "fire-and-forget"
 approach and logging errors fills syslog with unneeded messages.
@@ -7353,26 +7965,41 @@
 authentication.
 
 =item B<ClientKeyPass> I<Password>
 
 Password required to load the private key in B<ClientKey>.
 
+=item B<Header> I<Header>
+
+A HTTP header to add to the request.  Multiple headers are added if this option is specified more than once.  Example:
+
+  Header "X-Custom-Header: custom_value"
+
 =item B<SSLVersion> B<SSLv2>|B<SSLv3>|B<TLSv1>|B<TLSv1_0>|B<TLSv1_1>|B<TLSv1_2>
 
 Define which SSL protocol version must be used. By default C<libcurl> will
 attempt to figure out the remote SSL protocol version. See
 L<curl_easy_setopt(3)> for more details.
 
-=item B<Format> B<Command>|B<JSON>
+=item B<Format> B<Command>|B<JSON>|B<KAIROSDB>
 
 Format of the output to generate. If set to B<Command>, will create output that
 is understood by the I<Exec> and I<UnixSock> plugins. When set to B<JSON>, will
-create output in the I<JavaScript Object Notation> (JSON).
+create output in the I<JavaScript Object Notation> (JSON). When set to KAIROSDB
+, will create output in the KairosDB format.
 
 Defaults to B<Command>.
 
+=item B<Metrics> B<true>|B<false>
+
+Controls whether I<metrics> are POSTed to this location. Defaults to B<true>.
+
+=item B<Notifications> B<false>|B<true>
+
+Controls whether I<notifications> are POSTed to this location. Defaults to B<false>.
+
 =item B<StoreRates> B<true|false>
 
 If set to B<true>, convert counter values to rates. If set to B<false> (the
 default) counter values are stored as is, i.e. as an increasing integer number.
 
 =item B<BufferSize> I<Bytes>
@@ -7395,12 +8022,16 @@
 
 Sets the maximum time in milliseconds given for HTTP POST operations to
 complete. When this limit is reached, the POST operation will be aborted, and
 all the data in the current send buffer will probably be lost. Defaults to 0,
 which means the connection never times out.
 
+=item B<LogHttpError> B<false>|B<true>
+
+Enables printing of HTTP error code to log. Turned off by default.
+
 The C<write_http> plugin regularly submits the collected values to the HTTP
 server. How frequently this happens depends on how much data you are collecting
 and the size of B<BufferSize>. The optimal value to set B<Timeout> to is
 slightly below this interval, which you can estimate by monitoring the network
 traffic between collectd and the HTTP server.
 
@@ -7436,13 +8067,13 @@
 
 Configure the named property for the current topic. Properties are
 forwarded to the kafka producer library B<librdkafka>.
 
 =item B<Key> I<String>
 
-Use the specified string as a partitioning key for the topic. Kafka breaks
+Use the specified string as a partioning key for the topic. Kafka breaks
 topic into partitions and guarantees that for a given topology, the same
 consumer will be used for a specific key. The special (case insensitive)
 string B<Random> can be used to specify that an arbitrary partition should
 be used.
 
 =item B<Format> B<Command>|B<JSON>|B<Graphite>
@@ -7521,20 +8152,26 @@
 
   <Plugin "write_redis">
     <Node "example">
         Host "localhost"
         Port "6379"
         Timeout 1000
+        Prefix "collectd/"
+        Database 1
+        MaxSetSize -1
+        StoreRates true
     </Node>
   </Plugin>
 
 Values are submitted to I<Sorted Sets>, using the metric name as the key, and
 the timestamp as the score. Retrieving a date range can then be done using the
 C<ZRANGEBYSCORE> I<Redis> command. Additionally, all the identifiers of these
-I<Sorted Sets> are kept in a I<Set> called C<collectd/values> and can be
-retrieved using the C<SMEMBERS> I<Redis> command. See
+I<Sorted Sets> are kept in a I<Set> called C<collectd/values> (or
+C<${prefix}/values> if the B<Prefix> option was specified) and can be retrieved
+using the C<SMEMBERS> I<Redis> command. You can specify the database to use
+with the B<Database> parameter (default is C<0>). See
 L<http://redis.io/commands#sorted_set> and L<http://redis.io/commands#set> for
 details.
 
 The information shown in the synopsis above is the I<default configuration>
 which is used by the plugin if no configuration is present.
 
@@ -7563,12 +8200,34 @@
 that numerical port numbers must be given as a string, too.
 
 =item B<Timeout> I<Milliseconds>
 
 The B<Timeout> option sets the socket connection timeout, in milliseconds.
 
+=item B<Prefix> I<Prefix>
+
+Prefix used when constructing the name of the I<Sorted Sets> and the I<Set>
+containing all metrics. Defaults to C<collectd/>, so metrics will have names
+like C<collectd/cpu-0/cpu-user>. When setting this to something different, it
+is recommended but not required to include a trailing slash in I<Prefix>.
+
+=item B<Database> I<Index>
+
+This index selects the redis database to use for writing operations. Defaults
+to C<0>.
+
+=item B<MaxSetSize> I<Items>
+
+The B<MaxSetSize> option limits the number of items that the I<Sorted Sets> can
+hold. Negative values for I<Items> sets no limit, which is the default behavior.
+
+=item B<StoreRates> B<true>|B<false>
+
+If set to B<true> (the default), convert counter values to rates. If set to
+B<false> counter values are stored as is, i.e. as an increasing integer number.
+
 =back
 
 =head2 Plugin C<write_riemann>
 
 The I<write_riemann plugin> will send values to I<Riemann>, a powerful stream
 aggregation and monitoring system. The plugin sends I<Protobuf> encoded data to
@@ -7607,17 +8266,32 @@
 Hostname or address to connect to. Defaults to C<localhost>.
 
 =item B<Port> I<Service>
 
 Service name or port number to connect to. Defaults to C<5555>.
 
-=item B<Protocol> B<UDP>|B<TCP>
+=item B<Protocol> B<UDP>|B<TCP>|B<TLS>
 
 Specify the protocol to use when communicating with I<Riemann>. Defaults to
 B<TCP>.
 
+=item B<TLSCertFile> I<Path>
+
+When using the B<TLS> protocol, path to a PEM certificate to present
+to remote host.
+
+=item B<TLSCAFile> I<Path>
+
+When using the B<TLS> protocol, path to a PEM CA certificate to
+use to validate the remote hosts's identity.
+
+=item B<TLSKeyFile> I<Path>
+
+When using the B<TLS> protocol, path to a PEM private key associated
+with the certificate defined by B<TLSCertFile>.
+
 =item B<Batch> B<true>|B<false>
 
 If set to B<true> and B<Protocol> is set to B<TCP>,
 events will be batched in memory and flushed at
 regular intervals or when B<BatchMaxSize> is exceeded.
 
@@ -7631,12 +8305,17 @@
 Defaults to true
 
 =item B<BatchMaxSize> I<size>
 
 Maximum payload size for a riemann packet. Defaults to 8192
 
+=item B<BatchFlushTimeout> I<seconds>
+
+Maximum amount of seconds to wait in between to batch flushes.
+No timeout by default.
+
 =item B<StoreRates> B<true>|B<false>
 
 If set to B<true> (the default), convert counter values to rates. If set to
 B<false> counter values are stored as is, i.e. as an increasing integer number.
 
 This will be reflected in the C<ds_type> tag: If B<StoreRates> is enabled,
@@ -7797,12 +8476,20 @@
 
 Consider the two given strings to be the key and value of an additional
 attribute for each metric being sent out to I<Sensu>.
 
 =back
 
+=head2 Plugin C<xencpu>
+
+This plugin collects metrics of hardware CPU load for machine running Xen
+hypervisor. Load is calculated from 'idle time' value, provided by Xen.
+Result is reported using the C<percent> type, for each CPU (core).
+
+This plugin doesn't have any options (yet).
+
 =head2 Plugin C<zookeeper>
 
 The I<zookeeper plugin> will collect statistics from a I<Zookeeper> server
 using the mntr command.  It requires Zookeeper 3.4.0+ and access to the
 client port.
 
@@ -8694,12 +9381,14 @@
 =item B<Plugin> I<String>
 
 =item B<PluginInstance> I<String>
 
 =item B<TypeInstance> I<String>
 
+=item B<MetaData> I<String> I<String>
+
 Set the appropriate field to the given string. The strings for plugin instance
 and type instance may be empty, the strings for host and plugin may not be
 empty. It's currently not possible to set the type of a value this way.
 
 =back
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdctl.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdctl.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdctl.1	2016-11-29 00:09:59.648491748 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdctl.1	2016-09-11 16:11:15.210970642 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTDCTL 1"
-.TH COLLECTDCTL 1 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTDCTL 1 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectdctl \- Control interface for collectd
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdctl.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdctl.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdctl.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdctl.c	2016-09-11 16:10:25.255038733 +0800
@@ -64,17 +64,26 @@
 #  define isinf(f) (!isfinite(f) && !isnan(f))
 # endif
 #endif /* NAN_ZERO_ZERO */
 
 #include "libcollectdclient/collectd/client.h"
 
+#ifndef PREFIX
+# define PREFIX "/opt/" PACKAGE_NAME
+#endif
+
+#ifndef LOCALSTATEDIR
+# define LOCALSTATEDIR PREFIX "/var"
+#endif
+
 #define DEFAULT_SOCK LOCALSTATEDIR"/run/"PACKAGE_NAME"-unixsock"
 
 extern char *optarg;
 extern int   optind;
 
+__attribute__((noreturn))
 static void exit_usage (const char *name, int status) {
   fprintf ((status == 0) ? stdout : stderr,
       "Usage: %s [options] <command> [cmd options]\n\n"
 
       "Available options:\n"
       "  -s       Path to collectd's UNIX socket.\n"
@@ -117,13 +126,13 @@
     str++;
   }
 
   return count;
 } /* count_chars */
 
-static int array_grow (void **array, int *array_len, size_t elem_size)
+static int array_grow (void **array, size_t *array_len, size_t elem_size)
 {
   void *tmp;
 
   assert ((array != NULL) && (array_len != NULL));
 
   tmp = realloc (*array, (*array_len + 1) * elem_size);
@@ -181,32 +190,30 @@
 
   size_t   ret_values_num   = 0;
   gauge_t *ret_values       = NULL;
   char   **ret_values_names = NULL;
 
   int status;
-  size_t i;
 
   assert (strcasecmp (argv[0], "getval") == 0);
 
   if (argc != 2) {
     fprintf (stderr, "ERROR: getval: Missing identifier.\n");
     return (-1);
   }
 
-  memset (&ident, 0, sizeof (ident));
   status = parse_identifier (c, argv[1], &ident);
   if (status != 0)
     return (status);
 
 #define BAIL_OUT(s) \
   do { \
     if (ret_values != NULL) \
       free (ret_values); \
     if (ret_values_names != NULL) { \
-      for (i = 0; i < ret_values_num; ++i) \
+      for (size_t i = 0; i < ret_values_num; ++i) \
         free (ret_values_names[i]); \
       free (ret_values_names); \
     } \
     ret_values_num = 0; \
     return (s); \
   } while (0)
@@ -215,30 +222,29 @@
       &ret_values_num, &ret_values, &ret_values_names);
   if (status != 0) {
     fprintf (stderr, "ERROR: %s\n", lcc_strerror (c));
     BAIL_OUT (-1);
   }
 
-  for (i = 0; i < ret_values_num; ++i)
+  for (size_t i = 0; i < ret_values_num; ++i)
     printf ("%s=%e\n", ret_values_names[i], ret_values[i]);
   BAIL_OUT (0);
 #undef BAIL_OUT
 } /* getval */
 
 static int flush (lcc_connection_t *c, int argc, char **argv)
 {
   int timeout = -1;
 
   lcc_identifier_t *identifiers = NULL;
-  int identifiers_num = 0;
+  size_t identifiers_num = 0;
 
   char **plugins = NULL;
-  int plugins_num = 0;
+  size_t plugins_num = 0;
 
   int status;
-  int i;
 
   assert (strcasecmp (argv[0], "flush") == 0);
 
 #define BAIL_OUT(s) \
   do { \
     if (identifiers != NULL) \
@@ -247,13 +253,13 @@
     if (plugins != NULL) \
       free (plugins); \
     plugins_num = 0; \
     return (s); \
   } while (0)
 
-  for (i = 1; i < argc; ++i) {
+  for (int i = 1; i < argc; ++i) {
     char *key, *value;
 
     key   = argv[i];
     value = strchr (argv[i], (int)'=');
 
     if (! value) {
@@ -311,23 +317,21 @@
       BAIL_OUT (status);
 
     assert (plugins_num == 1);
     plugins[0] = NULL;
   }
 
-  for (i = 0; i < plugins_num; ++i) {
+  for (size_t i = 0; i < plugins_num; ++i) {
     if (identifiers_num == 0) {
       status = lcc_flush (c, plugins[i], NULL, timeout);
       if (status != 0)
         fprintf (stderr, "ERROR: Failed to flush plugin `%s': %s.\n",
             (plugins[i] == NULL) ? "(all)" : plugins[i], lcc_strerror (c));
     }
     else {
-      int j;
-
-      for (j = 0; j < identifiers_num; ++j) {
+      for (size_t j = 0; j < identifiers_num; ++j) {
         status = lcc_flush (c, plugins[i], identifiers + j, timeout);
         if (status != 0) {
           char id[1024];
 
           lcc_identifier_to_string (c, id, sizeof (id), identifiers + j);
           fprintf (stderr, "ERROR: Failed to flush plugin `%s', "
@@ -346,13 +350,12 @@
 static int listval (lcc_connection_t *c, int argc, char **argv)
 {
   lcc_identifier_t *ret_ident     = NULL;
   size_t            ret_ident_num = 0;
 
   int status;
-  size_t i;
 
   assert (strcasecmp (argv[0], "listval") == 0);
 
   if (argc != 1) {
     fprintf (stderr, "ERROR: listval: Does not accept any arguments.\n");
     return (-1);
@@ -369,13 +372,13 @@
   status = lcc_listval (c, &ret_ident, &ret_ident_num);
   if (status != 0) {
     fprintf (stderr, "ERROR: %s\n", lcc_strerror (c));
     BAIL_OUT (status);
   }
 
-  for (i = 0; i < ret_ident_num; ++i) {
+  for (size_t i = 0; i < ret_ident_num; ++i) {
     char id[1024];
 
     status = lcc_identifier_to_string (c, id, sizeof (id), ret_ident + i);
     if (status != 0) {
       fprintf (stderr, "ERROR: listval: Failed to convert returned "
           "identifier to a string: %s\n", lcc_strerror (c));
@@ -395,13 +398,12 @@
   /* 64 ought to be enough for anybody ;-) */
   value_t values[64];
   int     values_types[64];
   size_t  values_len = 0;
 
   int status;
-  int i;
 
   assert (strcasecmp (argv[0], "putval") == 0);
 
   if (argc < 3) {
     fprintf (stderr, "ERROR: putval: Missing identifier "
         "and/or value list.\n");
@@ -412,13 +414,13 @@
   vl.values_types = values_types;
 
   status = parse_identifier (c, argv[1], &vl.identifier);
   if (status != 0)
     return (status);
 
-  for (i = 2; i < argc; ++i) {
+  for (int i = 2; i < argc; ++i) {
     char *tmp;
 
     tmp = strchr (argv[i], (int)'=');
 
     if (tmp != NULL) { /* option */
       char *key   = argv[i];
@@ -479,13 +481,13 @@
           return (-1);
         }
       }
 
       values_len = 0;
       value = tmp;
-      while (value != 0) {
+      while (value != NULL) {
         char *dot, *endptr;
 
         tmp = strchr (value, (int)':');
 
         if (tmp != NULL) {
           *tmp = '\0';
@@ -504,13 +506,13 @@
         }
         else if (dot) { /* floating point value */
           values[values_len].gauge = strtod (value, &endptr);
           values_types[values_len] = LCC_TYPE_GAUGE;
         }
         else { /* integer */
-          values[values_len].counter = strtol (value, &endptr, 0);
+          values[values_len].counter = (counter_t) strtoull (value, &endptr, 0);
           values_types[values_len] = LCC_TYPE_COUNTER;
         }
         ++values_len;
 
         if (endptr == value) {
           fprintf (stderr, "ERROR: Failed to parse value as number: %s.\n",
@@ -548,27 +550,26 @@
 
   lcc_connection_t *c;
 
   int status;
 
   while (42) {
-    int n;
+    int opt;
 
-    n = getopt (argc, argv, "s:h");
+    opt = getopt (argc, argv, "s:h");
 
-    if (n == -1)
+    if (opt == -1)
       break;
 
-    switch (n) {
+    switch (opt) {
       case 's':
         snprintf (address, sizeof (address), "unix:%s", optarg);
         address[sizeof (address) - 1] = '\0';
         break;
       case 'h':
         exit_usage (argv[0], 0);
-        break;
       default:
         exit_usage (argv[0], 1);
     }
   }
 
   if (optind >= argc) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-email.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-email.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-email.5	2016-11-29 00:09:59.496490135 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-email.5	2016-09-11 16:11:15.054970848 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EMAIL 5"
-.TH COLLECTD-EMAIL 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-EMAIL 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-email \- Documentation of collectd's "email plugin"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-exec.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-exec.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-exec.5	2016-11-29 00:09:59.580491026 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-exec.5	2016-09-11 16:11:15.138970737 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-EXEC 5"
-.TH COLLECTD-EXEC 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-EXEC 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-exec \- Documentation of collectd's "exec plugin"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-java.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-java.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-java.5	2016-11-29 00:09:59.756492893 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-java.5	2016-09-11 16:11:15.314970505 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-JAVA 5"
-.TH COLLECTD-JAVA 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-JAVA 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-java \- Documentation of collectd's "java plugin"
@@ -675,12 +675,16 @@
 Works like the option of the same name directly beneath the \fIMBean\fR block, but
 sets the type instance instead. \fI(optional)\fR
 .IP "\fBInstanceFrom\fR \fIprefix\fR" 4
 .IX Item "InstanceFrom prefix"
 Works like the option of the same name directly beneath the \fIMBean\fR block, but
 sets the type instance instead. \fI(optional)\fR
+.IP "\fBPluginName\fR \fIname\fR" 4
+.IX Item "PluginName name"
+When set, overrides the default setting for the \fIplugin\fR field
+(\f(CW\*(C`GenericJMX\*(C'\fR).
 .IP "\fBTable\fR \fBtrue\fR|\fBfalse\fR" 4
 .IX Item "Table true|false"
 Set this to true if the returned attribute is a \fIcomposite type\fR. If set to
 true, the keys within the \fIcomposite type\fR is appended to the
 \&\fItype instance\fR.
 .IP "\fBAttribute\fR \fIpath\fR" 4
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-java.pod /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-java.pod
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-java.pod	2016-11-29 00:08:22.395470343 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-java.pod	2016-09-11 16:10:25.251038738 +0800
@@ -617,12 +617,17 @@
 
 =item B<InstanceFrom> I<prefix>
 
 Works like the option of the same name directly beneath the I<MBean> block, but
 sets the type instance instead. I<(optional)>
 
+=item B<PluginName> I<name>
+
+When set, overrides the default setting for the I<plugin> field
+(C<GenericJMX>).
+
 =item B<Table> B<true>|B<false>
 
 Set this to true if the returned attribute is a I<composite type>. If set to
 true, the keys within the I<composite type> is appended to the
 I<type instance>.
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: collectd-lua.5
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: collectd-lua.pod
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdmon.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdmon.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdmon.1	2016-11-29 00:09:59.828493657 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdmon.1	2016-09-11 16:11:15.446970330 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTDMON 1"
-.TH COLLECTDMON 1 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTDMON 1 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectdmon \- Monitoring daemon for collectd
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdmon.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdmon.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectdmon.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectdmon.c	2016-09-11 16:10:25.255038733 +0800
@@ -52,27 +52,36 @@
 #include <sys/wait.h>
 
 #include <time.h>
 
 #include <unistd.h>
 
+#ifndef PREFIX
+# define PREFIX "/opt/" PACKAGE_NAME
+#endif
+
+#ifndef LOCALSTATEDIR
+# define LOCALSTATEDIR PREFIX "/var"
+#endif
+
 #ifndef COLLECTDMON_PIDFILE
 # define COLLECTDMON_PIDFILE LOCALSTATEDIR"/run/collectdmon.pid"
 #endif /* ! COLLECTDMON_PIDFILE */
 
 #ifndef WCOREDUMP
 # define WCOREDUMP(s) 0
 #endif /* ! WCOREDUMP */
 
 static int loop    = 0;
 static int restart = 0;
 
-static char  *pidfile      = NULL;
-static pid_t  collectd_pid = 0;
+static const char *pidfile      = NULL;
+static pid_t       collectd_pid = 0;
 
-static void exit_usage (char *name)
+__attribute__((noreturn))
+static void exit_usage (const char *name)
 {
 	printf ("Usage: %s <options> [-- <collectd options>]\n"
 
 			"\nAvailable options:\n"
 			"  -h         Display this help and exit.\n"
 			"  -c <path>  Path to the collectd binary.\n"
@@ -116,12 +125,13 @@
 	return 0;
 } /* pidfile_remove */
 
 static int daemonize (void)
 {
 	struct rlimit rl;
+	int dev_null;
 
 	pid_t pid = 0;
 	int   i   = 0;
 
 	if (0 != chdir ("/")) {
 		fprintf (stderr, "Error: chdir() failed: %s\n", strerror (errno));
@@ -149,32 +159,39 @@
 	if (RLIM_INFINITY == rl.rlim_max)
 		rl.rlim_max = 1024;
 
 	for (i = 0; i < (int)rl.rlim_max; ++i)
 		close (i);
 
-	errno = 0;
-	if (open ("/dev/null", O_RDWR) != 0) {
-		syslog (LOG_ERR, "Error: couldn't connect STDIN to /dev/null: %s",
-				strerror (errno));
+	dev_null = open ("/dev/null", O_RDWR);
+	if (dev_null == -1) {
+		syslog (LOG_ERR, "Error: couldn't open /dev/null: %s", strerror (errno));
+		return -1;
+	}
+
+	if (dup2 (dev_null, STDIN_FILENO) == -1) {
+		close (dev_null);
+		syslog (LOG_ERR, "Error: couldn't connect STDIN to /dev/null: %s", strerror (errno));
 		return -1;
 	}
 
-	errno = 0;
-	if (dup (0) != 1) {
-		syslog (LOG_ERR, "Error: couldn't connect STDOUT to /dev/null: %s",
-				strerror (errno));
+	if (dup2 (dev_null, STDOUT_FILENO) == -1) {
+		close (dev_null);
+		syslog (LOG_ERR, "Error: couldn't connect STDOUT to /dev/null: %s", strerror (errno));
 		return -1;
 	}
 
-	errno = 0;
-	if (dup (0) != 2) {
-		syslog (LOG_ERR, "Error: couldn't connect STDERR to /dev/null: %s",
-				strerror (errno));
+	if (dup2 (dev_null, STDERR_FILENO) == -1) {
+		close (dev_null);
+		syslog (LOG_ERR, "Error: couldn't connect STDERR to /dev/null: %s", strerror (errno));
 		return -1;
 	}
+
+	if ((dev_null != STDIN_FILENO) && (dev_null != STDOUT_FILENO) && (dev_null != STDERR_FILENO))
+		close (dev_null);
+
 	return 0;
 } /* daemonize */
 
 static int collectd_start (char **argv)
 {
 	pid_t pid = 0;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-nagios.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-nagios.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-nagios.1	2016-11-29 00:09:59.896494379 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-nagios.1	2016-09-11 16:11:15.510970245 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-NAGIOS 1"
-.TH COLLECTD-NAGIOS 1 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-NAGIOS 1 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-nagios \- Nagios plugin for querying collectd
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-nagios.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-nagios.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-nagios.c	2016-11-29 00:08:22.395470343 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-nagios.c	2016-09-11 16:10:25.251038738 +0800
@@ -101,13 +101,13 @@
 static range_t range_critical_g;
 static range_t range_warning_g;
 static int consolitation_g = CON_NONE;
 static _Bool nan_is_error_g = 0;
 
 static char **match_ds_g = NULL;
-static int    match_ds_num_g = 0;
+static size_t match_ds_num_g = 0;
 
 /* `strdup' is an XSI extension. I don't want to pull in all of XSI just for
  * that, so here's an own implementation.. It's easy enough. The GCC attributes
  * are supposed to get good performance..  -octo */
 __attribute__((malloc, nonnull (1)))
 static char *cn_strdup (const char *str) /* {{{ */
@@ -125,33 +125,31 @@
 static int filter_ds (size_t *values_num,
 		double **values, char ***values_names)
 {
 	gauge_t *new_values;
 	char   **new_names;
 
-	size_t i;
-
 	if (match_ds_g == NULL)
 		return (RET_OKAY);
 
 	new_values = (gauge_t *)calloc (match_ds_num_g, sizeof (*new_values));
 	if (new_values == NULL)
 	{
-		fprintf (stderr, "malloc failed: %s\n", strerror (errno));
+		fprintf (stderr, "calloc failed: %s\n", strerror (errno));
 		return (RET_UNKNOWN);
 	}
 
 	new_names = (char **)calloc (match_ds_num_g, sizeof (*new_names));
 	if (new_names == NULL)
 	{
-		fprintf (stderr, "malloc failed: %s\n", strerror (errno));
+		fprintf (stderr, "calloc failed: %s\n", strerror (errno));
 		free (new_values);
 		return (RET_UNKNOWN);
 	}
 
-	for (i = 0; i < (size_t) match_ds_num_g; i++)
+	for (size_t i = 0; i < match_ds_num_g; i++)
 	{
 		size_t j;
 
 		/* match_ds_g keeps pointers into argv but the names will be freed */
 		new_names[i] = cn_strdup (match_ds_g[i]);
 		if (new_names[i] == NULL)
@@ -179,13 +177,13 @@
 		}
 
 		new_values[i] = (*values)[j];
 	}
 
 	free (*values);
-	for (i = 0; i < *values_num; i++)
+	for (size_t i = 0; i < *values_num; i++)
 		free ((*values_names)[i]);
 	free (*values_names);
 
 	*values       = new_values;
 	*values_names = new_names;
 	*values_num   = match_ds_num_g;
@@ -242,12 +240,13 @@
 	if (!isnan (range->max) && (range->max < value))
 		ret = 1;
 
 	return (((ret - range->invert) == 0) ? 0 : 1);
 } /* int match_range */
 
+__attribute__((noreturn))
 static void usage (const char *name)
 {
 	fprintf (stderr, "Usage: %s <-s socket> <-n value_spec> <-H hostname> [options]\n"
 			"\n"
 			"Valid options are:\n"
 			"  -s <socket>    Path to collectd's UNIX-socket.\n"
@@ -279,13 +278,12 @@
 	lcc_identifier_t *ret_ident = NULL;
 	size_t ret_ident_num = 0;
 
 	char *hostname = NULL;
 
 	int status;
-	size_t i;
 
 	status = lcc_listval (connection, &ret_ident, &ret_ident_num);
 	if (status != 0) {
 		printf ("UNKNOWN: %s\n", lcc_strerror (connection));
 		if (ret_ident != NULL)
 			free (ret_ident);
@@ -297,13 +295,13 @@
 		printf ("UNKNOWN: %s\n", lcc_strerror (connection));
 		if (ret_ident != NULL)
 			free (ret_ident);
 		return (RET_UNKNOWN);
 	}
 
-	for (i = 0; i < ret_ident_num; ++i) {
+	for (size_t i = 0; i < ret_ident_num; ++i) {
 		char id[1024];
 
 		if ((hostname_g != NULL) && (strcasecmp (hostname_g, ret_ident[i].host)))
 			continue;
 
 		if ((hostname == NULL) || strcasecmp (hostname, ret_ident[i].host))
@@ -341,15 +339,14 @@
 {
 	int num_critical = 0;
 	int num_warning  = 0;
 	int num_okay = 0;
 	const char *status_str = "UNKNOWN";
 	int status_code = RET_UNKNOWN;
-	size_t i;
 
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 	{
 		if (isnan (values[i]))
 		{
 			if (nan_is_error_g)
 				num_critical++;
 			else
@@ -386,33 +383,32 @@
 
 	printf ("%s: %i critical, %i warning, %i okay", status_str,
 			num_critical, num_warning, num_okay);
 	if (values_num > 0)
 	{
 		printf (" |");
-		for (i = 0; i < values_num; i++)
+		for (size_t i = 0; i < values_num; i++)
 			printf (" %s=%f;;;;", values_names[i], values[i]);
 	}
 	printf ("\n");
 
 	return (status_code);
 } /* int do_check_con_none */
 
 static int do_check_con_average (size_t values_num,
 		double *values, char **values_names)
 {
-	size_t i;
 	double total;
 	int total_num;
 	double average;
 	const char *status_str = "UNKNOWN";
 	int status_code = RET_UNKNOWN;
 
 	total = 0.0;
 	total_num = 0;
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 	{
 		if (isnan (values[i]))
 		{
 			if (!nan_is_error_g)
 				continue;
 
@@ -447,31 +443,30 @@
 	{
 		status_str = "OKAY";
 		status_code = RET_OKAY;
 	}
 
 	printf ("%s: %g average |", status_str, average);
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 		printf (" %s=%f;;;;", values_names[i], values[i]);
 	printf ("\n");
 
 	return (status_code);
 } /* int do_check_con_average */
 
 static int do_check_con_sum (size_t values_num,
 		double *values, char **values_names)
 {
-	size_t i;
 	double total;
 	int total_num;
 	const char *status_str = "UNKNOWN";
 	int status_code = RET_UNKNOWN;
 
 	total = 0.0;
 	total_num = 0;
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 	{
 		if (isnan (values[i]))
 		{
 			if (!nan_is_error_g)
 				continue;
 
@@ -504,36 +499,35 @@
 	{
 		status_str = "OKAY";
 		status_code = RET_OKAY;
 	}
 
 	printf ("%s: %g sum |", status_str, total);
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 		printf (" %s=%f;;;;", values_names[i], values[i]);
 	printf ("\n");
 
 	return (status_code);
 } /* int do_check_con_sum */
 
 static int do_check_con_percentage (size_t values_num,
 		double *values, char **values_names)
 {
-	size_t i;
 	double sum = 0.0;
 	double percentage;
 
 	const char *status_str  = "UNKNOWN";
 	int         status_code = RET_UNKNOWN;
 
 	if ((values_num < 1) || (isnan (values[0])))
 	{
 		printf ("WARNING: The first value is not defined\n");
 		return (RET_WARNING);
 	}
 
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 	{
 		if (isnan (values[i]))
 		{
 			if (!nan_is_error_g)
 				continue;
 
@@ -567,32 +561,30 @@
 	{
 		status_str  = "OKAY";
 		status_code = RET_OKAY;
 	}
 
 	printf ("%s: %lf percent |", status_str, percentage);
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 		printf (" %s=%lf;;;;", values_names[i], values[i]);
 	return (status_code);
 } /* int do_check_con_percentage */
 
 static int do_check (lcc_connection_t *connection)
 {
 	gauge_t *values;
 	char   **values_names;
 	size_t   values_num;
 	char ident_str[1024];
 	lcc_identifier_t ident;
-	size_t i;
 	int status;
 
 	snprintf (ident_str, sizeof (ident_str), "%s/%s",
 			hostname_g, value_string_g);
 	ident_str[sizeof (ident_str) - 1] = 0;
 
-	memset (&ident, 0, sizeof (ident));
 	status = lcc_string_to_identifier (connection, &ident, ident_str);
 	if (status != 0)
 	{
 		printf ("ERROR: Creating an identifier failed: %s.\n",
 				lcc_strerror (connection));
 		LCC_DESTROY (connection);
@@ -614,23 +606,23 @@
 	status = filter_ds (&values_num, &values, &values_names);
 	if (status != RET_OKAY)
 		return (status);
 
 	status = RET_UNKNOWN;
 	if (consolitation_g == CON_NONE)
-		status =  do_check_con_none (values_num, values, values_names);
+		status = do_check_con_none (values_num, values, values_names);
 	else if (consolitation_g == CON_AVERAGE)
-		status =  do_check_con_average (values_num, values, values_names);
+		status = do_check_con_average (values_num, values, values_names);
 	else if (consolitation_g == CON_SUM)
 		status = do_check_con_sum (values_num, values, values_names);
 	else if (consolitation_g == CON_PERCENTAGE)
 		status = do_check_con_percentage (values_num, values, values_names);
 
 	free (values);
 	if (values_names != NULL)
-		for (i = 0; i < values_num; i++)
+		for (size_t i = 0; i < values_num; i++)
 			free (values_names[i]);
 	free (values_names);
 
 	return (status);
 } /* int do_check */
 
@@ -690,13 +682,13 @@
 					usage (argv[0]);
 				}
 				break;
 			case 'd':
 			{
 				char **tmp;
-				tmp = (char **) realloc (match_ds_g,
+				tmp = realloc (match_ds_g,
 						(match_ds_num_g + 1)
 						* sizeof (char *));
 				if (tmp == NULL)
 				{
 					fprintf (stderr, "realloc failed: %s\n",
 							strerror (errno));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-perl.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-perl.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-perl.5	2016-11-29 00:10:00.008495566 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-perl.5	2016-09-11 16:11:15.606970119 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-PERL 5"
-.TH COLLECTD-PERL 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-PERL 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-perl \- Documentation of collectd's "perl plugin"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-python.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-python.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-python.5	2016-11-29 00:10:00.120496755 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-python.5	2016-09-11 16:11:15.726969960 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-PYTHON 5"
-.TH COLLECTD-PYTHON 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-PYTHON 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-python \- Documentation of collectd's "python plugin"
@@ -161,13 +161,13 @@
 The \f(CW\*(C`python plugin\*(C'\fR embeds a Python-interpreter into collectd and provides an
 interface to collectd's plugin system. This makes it possible to write plugins
 for collectd in Python. This is a lot more efficient than executing a
 Python-script every time you want to read a value with the \f(CW\*(C`exec plugin\*(C'\fR (see
 \&\fIcollectd\-exec\fR\|(5)) and provides a lot more functionality, too.
 .PP
-The minimum required Python version is \fI2.3\fR.
+The minimum required Python version is \fI2.6\fR.
 .SH "CONFIGURATION"
 .IX Header "CONFIGURATION"
 .IP "\fBLoadPlugin\fR \fIPlugin\fR" 4
 .IX Item "LoadPlugin Plugin"
 Loads the Python plugin \fIPlugin\fR.
 .IP "\fBEncoding\fR \fIName\fR" 4
@@ -206,17 +206,18 @@
 collectd script as well as from a normal Python interpreter:
 .RS 4
 .IP "\(bu" 4
 \&\fB1.\fR collectd will try to import the \fBreadline\fR module to give you a decent
 way of entering your commands. The daemonized collectd won't do that.
 .IP "\(bu" 4
-\&\fB2.\fR collectd will block \fI\s-1SIGINT\s0\fR. Pressing \fICtrl+C\fR will usually cause
+\&\fB2.\fR Python will be handling \fI\s-1SIGINT\s0\fR. Pressing \fICtrl+C\fR will usually cause
 collectd to shut down. This would be problematic in an interactive session,
-therefore this signal will be blocked. You can still use it to interrupt
-syscalls like sleep and pause but it won't generate a \fIKeyboardInterrupt\fR
-exception either.
+therefore Python will be handling it in interactive sessions. This allows you
+to use \fICtrl+C\fR to interrupt Python code without killing collectd. This also
+means you can catch \fIKeyboardInterrupt\fR exceptions which does not work during
+normal operation.
 .Sp
 To quit collectd send \fI\s-1EOF\s0\fR (press \fICtrl+D\fR at the beginning of a new line).
 .IP "\(bu" 4
 \&\fB3.\fR collectd handles \fI\s-1SIGCHLD\s0\fR. This means that Python won't be able to
 determine the return code of spawned processes with \fIsystem()\fR, \fIpopen()\fR and
 subprocess. This will result in Python not using external programs like less
@@ -678,13 +679,15 @@
 .Vb 1
 \&  import collectd
 .Ve
 .PP
 A very simple read function might look like:
 .PP
-.Vb 4
+.Vb 1
+\&  import random
+\&
 \&  def read(data=None):
 \&    vl = collectd.Values(type=\*(Aqgauge\*(Aq)
 \&    vl.plugin=\*(Aqpython.spam\*(Aq
 \&    vl.dispatch(values=[random.random() * 100])
 .Ve
 .PP
@@ -696,28 +699,18 @@
 \&      print "%s (%s): %f" % (vl.plugin, vl.type, i)
 .Ve
 .PP
 To register those functions with collectd:
 .PP
 .Vb 2
-\&  collectd.register_read(read);
-\&  collectd.register_write(write);
+\&  collectd.register_read(read)
+\&  collectd.register_write(write)
 .Ve
 .PP
 See the section \*(L"\s-1CLASSES\*(R"\s0 above for a complete documentation of the data
 types used by the read, write and match functions.
-.SH "NOTES"
-.IX Header "NOTES"
-.IP "\(bu" 4
-Please feel free to send in new plugins to collectd's mailing list at
-<collectd\ at\ collectd.org> for review and, possibly,
-inclusion in the main distribution. In the latter case, we will take care of
-keeping the plugin up to date and adapting it to new versions of collectd.
-.Sp
-Before submitting your plugin, please take a look at
-<http://collectd.org/dev\-info.shtml>.
 .SH "CAVEATS"
 .IX Header "CAVEATS"
 .IP "\(bu" 4
 collectd is heavily multi-threaded. Each collectd thread accessing the Python
 plugin will be mapped to a Python interpreter thread. Any such thread will be
 created and destroyed transparently and on-the-fly.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-python.pod /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-python.pod
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-python.pod	2016-11-29 00:08:22.395470343 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-python.pod	2016-09-11 16:10:25.251038738 +0800
@@ -34,13 +34,13 @@
 The C<python plugin> embeds a Python-interpreter into collectd and provides an
 interface to collectd's plugin system. This makes it possible to write plugins
 for collectd in Python. This is a lot more efficient than executing a
 Python-script every time you want to read a value with the C<exec plugin> (see
 L<collectd-exec(5)>) and provides a lot more functionality, too.
 
-The minimum required Python version is I<2.3>.
+The minimum required Python version is I<2.6>.
 
 =head1 CONFIGURATION
 
 =over 4
 
 =item B<LoadPlugin> I<Plugin>
@@ -91,17 +91,18 @@
 
 B<1.> collectd will try to import the B<readline> module to give you a decent
 way of entering your commands. The daemonized collectd won't do that.
 
 =item *
 
-B<2.> collectd will block I<SIGINT>. Pressing I<Ctrl+C> will usually cause
+B<2.> Python will be handling I<SIGINT>. Pressing I<Ctrl+C> will usually cause
 collectd to shut down. This would be problematic in an interactive session,
-therefore this signal will be blocked. You can still use it to interrupt
-syscalls like sleep and pause but it won't generate a I<KeyboardInterrupt>
-exception either.
+therefore Python will be handling it in interactive sessions. This allows you
+to use I<Ctrl+C> to interrupt Python code without killing collectd. This also
+means you can catch I<KeyboardInterrupt> exceptions which does not work during
+normal operation.
 
 To quit collectd send I<EOF> (press I<Ctrl+D> at the beginning of a new line).
 
 =item *
 
 B<3.> collectd handles I<SIGCHLD>. This means that Python won't be able to
@@ -655,12 +656,14 @@
 Any Python module will start similar to:
 
   import collectd
 
 A very simple read function might look like:
 
+  import random
+
   def read(data=None):
     vl = collectd.Values(type='gauge')
     vl.plugin='python.spam'
     vl.dispatch(values=[random.random() * 100])
 
 A very simple write function might look like:
@@ -668,34 +671,18 @@
   def write(vl, data=None):
     for i in vl.values:
       print "%s (%s): %f" % (vl.plugin, vl.type, i)
 
 To register those functions with collectd:
 
-  collectd.register_read(read);
-  collectd.register_write(write);
+  collectd.register_read(read)
+  collectd.register_write(write)
 
 See the section L<"CLASSES"> above for a complete documentation of the data
 types used by the read, write and match functions.
 
-=head1 NOTES
-
-=over 4
-
-=item *
-
-Please feel free to send in new plugins to collectd's mailing list at
-E<lt>collectdE<nbsp>atE<nbsp>collectd.orgE<gt> for review and, possibly,
-inclusion in the main distribution. In the latter case, we will take care of
-keeping the plugin up to date and adapting it to new versions of collectd.
-
-Before submitting your plugin, please take a look at
-L<http://collectd.org/dev-info.shtml>.
-
-=back
-
 =head1 CAVEATS
 
 =over 4
 
 =item *
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-snmp.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-snmp.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-snmp.5	2016-11-29 00:10:00.200497604 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-snmp.5	2016-09-11 16:11:15.806969854 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-SNMP 5"
-.TH COLLECTD-SNMP 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-SNMP 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-snmp \- Documentation of collectd's "snmp plugin"
@@ -326,15 +326,15 @@
 degrees Kelvin you could specify a shift of \fB273.15\fR here to store values in
 degrees Celsius. The default value is, of course, \fB0.0\fR.
 .Sp
 This value is not applied to counter-values.
 .IP "\fBIgnore\fR \fIValue\fR [, \fIValue\fR ...]" 4
 .IX Item "Ignore Value [, Value ...]"
-The ignore values allows one to ignore Instances based on their name and the
-patterns specified by the various values you've entered. The match is a
-glob-type shell matching.
+The ignore values allows to ignore Instances based on their name and the patterns
+specified by the various values you've entered. The match is a glob-type shell
+matching.
 .IP "\fBInvertMatch\fR \fItrue|false(default)\fR" 4
 .IX Item "InvertMatch true|false(default)"
 The invertmatch value should be use in combination of the Ignore option.
 It changes the behaviour of the Ignore option, from a blacklist behaviour
 when InvertMatch is set to false, to a whitelist when specified to true.
 .SS "The Host block"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-snmp.pod /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-snmp.pod
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-snmp.pod	2016-11-29 00:08:22.395470343 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-snmp.pod	2016-09-11 16:10:25.251038738 +0800
@@ -201,15 +201,15 @@
 degrees Celsius. The default value is, of course, B<0.0>.
 
 This value is not applied to counter-values.
 
 =item B<Ignore> I<Value> [, I<Value> ...]
 
-The ignore values allows one to ignore Instances based on their name and the
-patterns specified by the various values you've entered. The match is a
-glob-type shell matching.
+The ignore values allows to ignore Instances based on their name and the patterns
+specified by the various values you've entered. The match is a glob-type shell
+matching.
 
 =item B<InvertMatch> I<true|false(default)>
 
 The invertmatch value should be use in combination of the Ignore option.
 It changes the behaviour of the Ignore option, from a blacklist behaviour
 when InvertMatch is set to false, to a whitelist when specified to true.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-tg.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-tg.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-tg.1	2016-11-29 00:10:00.264498283 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-tg.1	2016-09-11 16:11:15.866969775 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-TG 1"
-.TH COLLECTD-TG 1 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-TG 1 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-tg \- Traffic generator for collectd.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-tg.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-tg.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-tg.c	2016-11-29 00:08:22.395470343 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-tg.c	2016-09-11 16:10:25.251038738 +0800
@@ -36,18 +36,19 @@
 #include <unistd.h>
 #include <stdio.h>
 #include <string.h>
 #include <time.h>
 #include <signal.h>
 #include <errno.h>
+#include <math.h>
+#include <sys/time.h>
 
 #include "utils_heap.h"
 
 #include "libcollectdclient/collectd/client.h"
 #include "libcollectdclient/collectd/network.h"
-#include "libcollectdclient/collectd/network_buffer.h"
 
 #define DEF_NUM_HOSTS    1000
 #define DEF_NUM_PLUGINS    20
 #define DEF_NUM_VALUES 100000
 #define DEF_INTERVAL       10.0
 
@@ -96,12 +97,35 @@
 
 static void signal_handler (int signal) /* {{{ */
 {
   loop = 0;
 } /* }}} void signal_handler */
 
+#if HAVE_CLOCK_GETTIME
+static double dtime (void) /* {{{ */
+{
+  struct timespec ts = { 0 };
+
+  if (clock_gettime (CLOCK_MONOTONIC, &ts) != 0)
+    perror ("clock_gettime");
+
+  return ((double) ts.tv_sec) + (((double) ts.tv_nsec) / 1e9);
+} /* }}} double dtime */
+#else
+/* Work around for Mac OS X which doesn't have clock_gettime(2). *sigh* */
+static double dtime (void) /* {{{ */
+{
+  struct timeval tv = { 0 };
+
+  if (gettimeofday (&tv, /* timezone = */ NULL) != 0)
+    perror ("gettimeofday");
+
+  return ((double) tv.tv_sec) + (((double) tv.tv_usec) / 1e6);
+} /* }}} double dtime */
+#endif
+
 static int compare_time (const void *v0, const void *v1) /* {{{ */
 {
   const lcc_value_list_t *vl0 = v0;
   const lcc_value_list_t *vl1 = v1;
 
   if (vl0->time < vl1->time)
@@ -128,19 +152,18 @@
 
 static lcc_value_list_t *create_value_list (void) /* {{{ */
 {
   lcc_value_list_t *vl;
   int host_num;
 
-  vl = malloc (sizeof (*vl));
+  vl = calloc (1, sizeof (*vl));
   if (vl == NULL)
   {
-    fprintf (stderr, "malloc failed.\n");
+    fprintf (stderr, "calloc failed.\n");
     return (NULL);
   }
-  memset (vl, 0, sizeof (*vl));
 
   vl->values = calloc (/* nmemb = */ 1, sizeof (*vl->values));
   if (vl->values == NULL)
   {
     fprintf (stderr, "calloc failed.\n");
     free (vl);
@@ -158,13 +181,13 @@
 
   vl->values_len = 1;
 
   host_num = get_boundet_random (0, conf_num_hosts);
 
   vl->interval = conf_interval;
-  vl->time = 1.0 + time (NULL)
+  vl->time = 1.0 + dtime ()
     + (host_num % (1 + (int) vl->interval));
 
   if (get_boundet_random (0, 2) == 0)
     vl->values_types[0] = LCC_TYPE_GAUGE;
   else
     vl->values_types[0] = LCC_TYPE_DERIVE;
@@ -197,13 +220,13 @@
 {
   int status;
 
   if (vl->values_types[0] == LCC_TYPE_GAUGE)
     vl->values[0].gauge = 100.0 * ((gauge_t) random ()) / (((gauge_t) RAND_MAX) + 1.0);
   else
-    vl->values[0].derive += get_boundet_random (0, 100);
+    vl->values[0].derive += (derive_t) get_boundet_random (0, 100);
 
   status = lcc_network_values_send (net, vl);
   if (status != 0)
     fprintf (stderr, "lcc_network_values_send failed with status %i.\n", status);
 
   vl->time += vl->interval;
@@ -311,14 +334,13 @@
 
   return (0);
 } /* }}} int read_options */
 
 int main (int argc, char **argv) /* {{{ */
 {
-  int i;
-  time_t last_time;
+  double last_time;
   int values_sent = 0;
 
   read_options (argc, argv);
 
   sigint_action.sa_handler = signal_handler;
   sigaction (SIGINT, &sigint_action, /* old = */ NULL);
@@ -340,13 +362,13 @@
     fprintf (stderr, "lcc_network_create failed.\n");
     exit (EXIT_FAILURE);
   }
   else
   {
     lcc_server_t *srv;
-    
+
     srv = lcc_server_create (net, conf_destination, conf_service);
     if (srv == NULL)
     {
       fprintf (stderr, "lcc_server_create failed.\n");
       exit (EXIT_FAILURE);
     }
@@ -357,13 +379,13 @@
         "admin", "password1");
 #endif
   }
 
   fprintf (stdout, "Creating %i values ... ", conf_num_values);
   fflush (stdout);
-  for (i = 0; i < conf_num_values; i++)
+  for (int i = 0; i < conf_num_values; i++)
   {
     lcc_value_list_t *vl;
 
     vl = create_value_list ();
     if (vl == NULL)
     {
@@ -385,20 +407,24 @@
 
     if (vl->time != last_time)
     {
       printf ("%i values have been sent.\n", values_sent);
 
       /* Check if we need to sleep */
-      time_t now = time (NULL);
+      double now = dtime ();
 
       while (now < vl->time)
       {
         /* 1 / 100 second */
         struct timespec ts = { 0, 10000000 };
+
+        ts.tv_sec = (time_t) now;
+        ts.tv_nsec = (long) ((now - ((double) ts.tv_sec)) * 1e9);
+
         nanosleep (&ts, /* remaining = */ NULL);
-        now = time (NULL);
+        now = dtime ();
 
         if (!loop)
           break;
       }
       last_time = vl->time;
     }
@@ -420,10 +446,9 @@
     destroy_value_list (vl);
   }
   c_heap_destroy (values_heap);
 
   lcc_network_destroy (net);
   exit (EXIT_SUCCESS);
-  return (0);
 } /* }}} int main */
 
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-threshold.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-threshold.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-threshold.5	2016-11-29 00:10:00.340499090 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-threshold.5	2016-09-11 16:11:15.938969680 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-THRESHOLD 5"
-.TH COLLECTD-THRESHOLD 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-THRESHOLD 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-threshold \- Documentation of collectd's Threshold plugin
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-unixsock.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-unixsock.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/collectd-unixsock.5	2016-11-29 00:10:00.412499853 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/collectd-unixsock.5	2016-09-11 16:11:16.014969579 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "COLLECTD-UNIXSOCK 5"
-.TH COLLECTD-UNIXSOCK 5 "2016-11-28" "5.5.3" "collectd"
+.TH COLLECTD-UNIXSOCK 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 collectd\-unixsock \- Documentation of collectd's "unixsock plugin"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/config.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/config.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/config.h.in	2016-11-29 00:09:58.792482667 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/config.h.in	2016-09-11 16:10:42.787014368 +0800
@@ -12,12 +12,18 @@
 /* wether or not to enable feature getifaddrs under Linux */
 #undef COLLECT_GETIFADDRS
 
 /* Wether or not to use the esmtp library */
 #undef COLLECT_LIBESMTP
 
+/* wether or not to enable feature building with -Werror */
+#undef COLLECT_WERROR
+
+/* Maximum length of data buffers */
+#undef DATA_MAX_NAME_LEN
+
 /* Define if endianflip is needed to convert to x86 representation. */
 #undef FP_LAYOUT_NEED_ENDIANFLIP
 
 /* Define if intswap is needed to convert to x86 representation. */
 #undef FP_LAYOUT_NEED_INTSWAP
 
@@ -72,12 +78,15 @@
 /* Define to 1 if you have the <arpa/nameser.h> header file. */
 #undef HAVE_ARPA_NAMESER_H
 
 /* Define to 1 if you have the <asm/msr-index.h> header file. */
 #undef HAVE_ASM_MSR_INDEX_H
 
+/* Define to 1 if you have the `asprintf' function. */
+#undef HAVE_ASPRINTF
+
 /* Define to 1 if you have the <assert.h> header file. */
 #undef HAVE_ASSERT_H
 
 /* Define to 1 if you have the <atasmart.h> header file. */
 #undef HAVE_ATASMART_H
 
@@ -100,12 +109,15 @@
 /* Define to 1 if you have the <cpuid.h> header file. */
 #undef HAVE_CPUID_H
 
 /* Define to 1 if you have the <ctype.h> header file. */
 #undef HAVE_CTYPE_H
 
+/* Define if curl.h defines CURLINFO_APPCONNECT_TIME. */
+#undef HAVE_CURLINFO_APPCONNECT_TIME
+
 /* Define if libcurl supports CURLOPT_TIMEOUT_MS option. */
 #undef HAVE_CURLOPT_TIMEOUT_MS
 
 /* Define if libcurl supports CURLOPT_USERNAME option. */
 #undef HAVE_CURLOPT_USERNAME
 
@@ -170,13 +182,13 @@
 /* Define to 1 if you have the <fs_info.h> header file. */
 #undef HAVE_FS_INFO_H
 
 /* Define to 1 if you have the <gcrypt.h> header file. */
 #undef HAVE_GCRYPT_H
 
-/* Define if the function getmntent exists. It's the version from libgen. */
+/* Define if the function getmntent exists. It is the version from libgen. */
 #undef HAVE_GEN_GETMNTENT
 
 /* Define to 1 if you have the `getaddrinfo' function. */
 #undef HAVE_GETADDRINFO
 
 /* Define to 1 if you have the `getfsstat' function. */
@@ -219,12 +231,22 @@
 #undef HAVE_GM_PROTOCOL_H
 
 /* Define to 1 if you have the <google/protobuf-c/protobuf-c.h> header file.
    */
 #undef HAVE_GOOGLE_PROTOBUF_C_PROTOBUF_C_H
 
+/* Define to 1 if you have the <google/protobuf/util/time_util.h> header file.
+   */
+#undef HAVE_GOOGLE_PROTOBUF_UTIL_TIME_UTIL_H
+
+/* Define to 1 if you have the <gps.h> header file. */
+#undef HAVE_GPS_H
+
+/* Define to 1 if you have the <grpc++/grpc++.h> header file. */
+#undef HAVE_GRPC___GRPC___H
+
 /* Define to 1 if you have the <grp.h> header file. */
 #undef HAVE_GRP_H
 
 /* Define to 1 if you have the <hiredis/hiredis.h> header file. */
 #undef HAVE_HIREDIS_HIREDIS_H
 
@@ -289,12 +311,15 @@
 /* Define to 1 if `wtime' is a member of `kstat_io_t'. */
 #undef HAVE_KSTAT_IO_T_WTIME
 
 /* Define to 1 if you have the <kvm.h> header file. */
 #undef HAVE_KVM_H
 
+/* Define to 1 if you have the <lauxlib.h> header file. */
+#undef HAVE_LAUXLIB_H
+
 /* Define to 1 if you have the <ldap.h> header file. */
 #undef HAVE_LDAP_H
 
 /* Define to 1 if you have the <libaquaero5.h> header file. */
 #undef HAVE_LIBAQUAERO5_H
 
@@ -319,14 +344,14 @@
 /* Define to 1 if you have the gcrypt library (-lgcrypt). */
 #undef HAVE_LIBGCRYPT
 
 /* Define to 1 if you have the <libgen.h> header file. */
 #undef HAVE_LIBGEN_H
 
-/* Define to 1 if you have 'hal' library */
-#undef HAVE_LIBHAL
+/* Define to 1 if you have the <libhal.h> header file. */
+#undef HAVE_LIBHAL_H
 
 /* Define to 1 if you have the <libiptc/libip6tc.h> header file. */
 #undef HAVE_LIBIPTC_LIBIP6TC_H
 
 /* Define to 1 if you have the <libiptc/libiptc.h> header file. */
 #undef HAVE_LIBIPTC_LIBIPTC_H
@@ -373,13 +398,13 @@
 /* Define if libperl is present and usable. */
 #undef HAVE_LIBPERL
 
 /* Define to 1 if you have the <libpq-fe.h> header file. */
 #undef HAVE_LIBPQ_FE_H
 
-/* Wether or not to use pthread (POSIX threads) library */
+/* Define to 1 if you have the `pthread' library (-lpthread). */
 #undef HAVE_LIBPTHREAD
 
 /* Define if librabbitmq is present and usable. */
 #undef HAVE_LIBRABBITMQ
 
 /* Define if librdkafka is present and usable. */
@@ -397,18 +422,12 @@
 /* Define to 1 if you have the 'resolv' library (-lresolv). */
 #undef HAVE_LIBRESOLV
 
 /* Define to 1 if you have the sensors library (-lsensors). */
 #undef HAVE_LIBSENSORS
 
-/* Define to 1 if you have the sigrok library (-lsigrok). */
-#undef HAVE_LIBSIGROK
-
-/* Define to 1 if you have the <libsigrok/libsigrok.h> header file. */
-#undef HAVE_LIBSIGROK_LIBSIGROK_H
-
 /* Define to 1 if you have the 'statgrab' library (-lstatgrab) */
 #undef HAVE_LIBSTATGRAB
 
 /* Define to 1 if libstatgrab version >= 0.90 */
 #undef HAVE_LIBSTATGRAB_0_90
 
@@ -481,12 +500,18 @@
 /* Define to 1 if you have the <locale.h> header file. */
 #undef HAVE_LOCALE_H
 
 /* Define this if a modern libltdl is already installed */
 #undef HAVE_LTDL
 
+/* Define to 1 if you have the <lualib.h> header file. */
+#undef HAVE_LUALIB_H
+
+/* Define to 1 if you have the <lua.h> header file. */
+#undef HAVE_LUA_H
+
 /* Define to 1 if you have the <lvm2app.h> header file. */
 #undef HAVE_LVM2APP_H
 
 /* Define to 1 if you have the <mach/host_priv.h> header file. */
 #undef HAVE_MACH_HOST_PRIV_H
 
@@ -562,12 +587,15 @@
 /* Define to 1 if you have the <modbus.h> header file. */
 #undef HAVE_MODBUS_H
 
 /* Define to 1 if you have the <mongo.h> header file. */
 #undef HAVE_MONGO_H
 
+/* Define to 1 if you have the <mosquitto.h> header file. */
+#undef HAVE_MOSQUITTO_H
+
 /* Define to 1 if you have the <mysql.h> header file. */
 #undef HAVE_MYSQL_H
 
 /* Define to 1 if you have the <mysql/mysql.h> header file. */
 #undef HAVE_MYSQL_MYSQL_H
 
@@ -595,15 +623,12 @@
 /* Define to 1 if you have the <netinet/in_systm.h> header file. */
 #undef HAVE_NETINET_IN_SYSTM_H
 
 /* Define to 1 if you have the <netinet/ip6.h> header file. */
 #undef HAVE_NETINET_IP6_H
 
-/* Define to 1 if you have the <netinet/ip_compat.h> header file. */
-#undef HAVE_NETINET_IP_COMPAT_H
-
 /* Define to 1 if you have the <netinet/ip.h> header file. */
 #undef HAVE_NETINET_IP_H
 
 /* Define to 1 if you have the <netinet/ip_icmp.h> header file. */
 #undef HAVE_NETINET_IP_ICMP_H
 
@@ -709,24 +734,30 @@
 /* Define to 1 if the ceph plugin is enabled. */
 #undef HAVE_PLUGIN_CEPH
 
 /* Define to 1 if the cgroups plugin is enabled. */
 #undef HAVE_PLUGIN_CGROUPS
 
+/* Define to 1 if the chrony plugin is enabled. */
+#undef HAVE_PLUGIN_CHRONY
+
 /* Define to 1 if the conntrack plugin is enabled. */
 #undef HAVE_PLUGIN_CONNTRACK
 
 /* Define to 1 if the contextswitch plugin is enabled. */
 #undef HAVE_PLUGIN_CONTEXTSWITCH
 
 /* Define to 1 if the cpu plugin is enabled. */
 #undef HAVE_PLUGIN_CPU
 
 /* Define to 1 if the cpufreq plugin is enabled. */
 #undef HAVE_PLUGIN_CPUFREQ
 
+/* Define to 1 if the cpusleep plugin is enabled. */
+#undef HAVE_PLUGIN_CPUSLEEP
+
 /* Define to 1 if the csv plugin is enabled. */
 #undef HAVE_PLUGIN_CSV
 
 /* Define to 1 if the curl plugin is enabled. */
 #undef HAVE_PLUGIN_CURL
 
@@ -772,12 +803,18 @@
 /* Define to 1 if the fscache plugin is enabled. */
 #undef HAVE_PLUGIN_FSCACHE
 
 /* Define to 1 if the gmond plugin is enabled. */
 #undef HAVE_PLUGIN_GMOND
 
+/* Define to 1 if the gps plugin is enabled. */
+#undef HAVE_PLUGIN_GPS
+
+/* Define to 1 if the grpc plugin is enabled. */
+#undef HAVE_PLUGIN_GRPC
+
 /* Define to 1 if the hddtemp plugin is enabled. */
 #undef HAVE_PLUGIN_HDDTEMP
 
 /* Define to 1 if the interface plugin is enabled. */
 #undef HAVE_PLUGIN_INTERFACE
 
@@ -808,12 +845,15 @@
 /* Define to 1 if the log_logstash plugin is enabled. */
 #undef HAVE_PLUGIN_LOG_LOGSTASH
 
 /* Define to 1 if the lpar plugin is enabled. */
 #undef HAVE_PLUGIN_LPAR
 
+/* Define to 1 if the lua plugin is enabled. */
+#undef HAVE_PLUGIN_LUA
+
 /* Define to 1 if the lvm plugin is enabled. */
 #undef HAVE_PLUGIN_LVM
 
 /* Define to 1 if the madwifi plugin is enabled. */
 #undef HAVE_PLUGIN_MADWIFI
 
@@ -850,12 +890,15 @@
 /* Define to 1 if the mic plugin is enabled. */
 #undef HAVE_PLUGIN_MIC
 
 /* Define to 1 if the modbus plugin is enabled. */
 #undef HAVE_PLUGIN_MODBUS
 
+/* Define to 1 if the mqtt plugin is enabled. */
+#undef HAVE_PLUGIN_MQTT
+
 /* Define to 1 if the multimeter plugin is enabled. */
 #undef HAVE_PLUGIN_MULTIMETER
 
 /* Define to 1 if the mysql plugin is enabled. */
 #undef HAVE_PLUGIN_MYSQL
 
@@ -877,12 +920,15 @@
 /* Define to 1 if the notify_desktop plugin is enabled. */
 #undef HAVE_PLUGIN_NOTIFY_DESKTOP
 
 /* Define to 1 if the notify_email plugin is enabled. */
 #undef HAVE_PLUGIN_NOTIFY_EMAIL
 
+/* Define to 1 if the notify_nagios plugin is enabled. */
+#undef HAVE_PLUGIN_NOTIFY_NAGIOS
+
 /* Define to 1 if the ntpd plugin is enabled. */
 #undef HAVE_PLUGIN_NTPD
 
 /* Define to 1 if the numa plugin is enabled. */
 #undef HAVE_PLUGIN_NUMA
 
@@ -1066,18 +1112,24 @@
 /* Define to 1 if the write_sensu plugin is enabled. */
 #undef HAVE_PLUGIN_WRITE_SENSU
 
 /* Define to 1 if the write_tsdb plugin is enabled. */
 #undef HAVE_PLUGIN_WRITE_TSDB
 
+/* Define to 1 if the xencpu plugin is enabled. */
+#undef HAVE_PLUGIN_XENCPU
+
 /* Define to 1 if the xmms plugin is enabled. */
 #undef HAVE_PLUGIN_XMMS
 
 /* Define to 1 if the zfs_arc plugin is enabled. */
 #undef HAVE_PLUGIN_ZFS_ARC
 
+/* Define to 1 if the zone plugin is enabled. */
+#undef HAVE_PLUGIN_ZONE
+
 /* Define to 1 if the zookeeper plugin is enabled. */
 #undef HAVE_PLUGIN_ZOOKEEPER
 
 /* Define to 1 if you have the <poll.h> header file. */
 #undef HAVE_POLL_H
 
@@ -1132,13 +1184,13 @@
 /* Define to 1 if you have the `select' function. */
 #undef HAVE_SELECT
 
 /* Define to 1 if you have the <sensors/sensors.h> header file. */
 #undef HAVE_SENSORS_SENSORS_H
 
-/* Define if the function getmntent exists. It's the version from libseq. */
+/* Define if the function getmntent exists. It is the version from libseq. */
 #undef HAVE_SEQ_GETMNTENT
 
 /* Define to 1 if you have the `setenv' function. */
 #undef HAVE_SETENV
 
 /* Define to 1 if you have the `setgroups' function. */
@@ -1249,12 +1301,21 @@
 /* Define to 1 if the system has the type `struct ip6_ext'. */
 #undef HAVE_STRUCT_IP6_EXT
 
 /* Define to 1 if `imr_ifindex' is a member of `struct ip_mreqn'. */
 #undef HAVE_STRUCT_IP_MREQN_IMR_IFINDEX
 
+/* Define if struct kinfo_proc2 exists in the NetBSD variant. */
+#undef HAVE_STRUCT_KINFO_PROC2_NETBSD
+
+/* Define to 1 if `p_pid' is a member of `struct kinfo_proc2'. */
+#undef HAVE_STRUCT_KINFO_PROC2_P_PID
+
+/* Define to 1 if `p_uru_maxrss' is a member of `struct kinfo_proc2'. */
+#undef HAVE_STRUCT_KINFO_PROC2_P_URU_MAXRSS
+
 /* Define if struct kinfo_proc exists in the FreeBSD variant. */
 #undef HAVE_STRUCT_KINFO_PROC_FREEBSD
 
 /* Define to 1 if `ki_pid' is a member of `struct kinfo_proc'. */
 #undef HAVE_STRUCT_KINFO_PROC_KI_PID
 
@@ -1301,13 +1362,13 @@
 /* Define to 1 if `uh_dport' is a member of `struct udphdr'. */
 #undef HAVE_STRUCT_UDPHDR_UH_DPORT
 
 /* Define to 1 if `uh_sport' is a member of `struct udphdr'. */
 #undef HAVE_STRUCT_UDPHDR_UH_SPORT
 
-/* Define if the function getmntent exists. It's the version from libsun. */
+/* Define if the function getmntent exists. It is the version from libsun. */
 #undef HAVE_SUN_GETMNTENT
 
 /* Define to 1 if you have the `swapctl' function. */
 #undef HAVE_SWAPCTL
 
 /* Define if the function swapctl exists and takes three arguments. */
@@ -1322,12 +1383,15 @@
 /* Define to 1 if you have the `sysctl' function. */
 #undef HAVE_SYSCTL
 
 /* Define to 1 if you have the `sysctlbyname' function. */
 #undef HAVE_SYSCTLBYNAME
 
+/* Define if sysctl supports kern.cp_time */
+#undef HAVE_SYSCTL_KERN_CP_TIME
+
 /* Define if sysctl supports kern.cp_times */
 #undef HAVE_SYSCTL_KERN_CP_TIMES
 
 /* Define to 1 if you have the `syslog' function. */
 #undef HAVE_SYSLOG
 
@@ -1378,12 +1442,15 @@
 /* Define to 1 if you have the <sys/param.h> header file. */
 #undef HAVE_SYS_PARAM_H
 
 /* Define to 1 if you have the <sys/resource.h> header file. */
 #undef HAVE_SYS_RESOURCE_H
 
+/* Define to 1 if you have the <sys/rndio.h> header file. */
+#undef HAVE_SYS_RNDIO_H
+
 /* Define to 1 if you have the <sys/select.h> header file. */
 #undef HAVE_SYS_SELECT_H
 
 /* Define to 1 if you have the <sys/socket.h> header file. */
 #undef HAVE_SYS_SOCKET_H
 
@@ -1489,12 +1556,15 @@
 /* Define to 1 if you have the <wordexp.h> header file. */
 #undef HAVE_WORDEXP_H
 
 /* This value is set to 1 to indicate that the system argz facility works */
 #undef HAVE_WORKING_ARGZ
 
+/* Define to 1 if you have the <xenctrl.h> header file. */
+#undef HAVE_XENCTRL_H
+
 /* Define to 1 if you have the <xfs/xqm.h> header file. */
 #undef HAVE_XFS_XQM_H
 
 /* Define to 1 if you have the <yajl/yajl_parse.h> header file. */
 #undef HAVE_YAJL_YAJL_PARSE_H
 
@@ -1513,12 +1583,15 @@
 /* True if program is to be compiled for a FreeBSD kernel */
 #undef KERNEL_FREEBSD
 
 /* True if program is to be compiled for a Linux kernel */
 #undef KERNEL_LINUX
 
+/* True if program is to be compiled for a NetBSD kernel */
+#undef KERNEL_NETBSD
+
 /* True if program is to be compiled for an OpenBSD kernel */
 #undef KERNEL_OPENBSD
 
 /* True if program is to be compiled for a Solaris kernel */
 #undef KERNEL_SOLARIS
 
@@ -1630,17 +1703,12 @@
 /* Define to enable reentrancy interfaces. */
 #undef _REENTRANT
 
 /* Define to use the thread-safe version of errno under AIX. */
 #undef _THREAD_SAFE_ERRNO
 
-/* Define for Solaris 2.5.1 so the uint32_t typedef from <sys/synch.h>,
-   <pthread.h>, or <semaphore.h> is not used. If the typedef were allowed, the
-   #define below would cause a syntax error. */
-#undef _UINT32_T
-
 /* Define to enforce X/Open 7 (XSI) compliance. */
 #undef _XOPEN_SOURCE
 
 /* Define so that glibc/gnulib argp.h does not typedef error_t. */
 #undef __error_t_defined
 
@@ -1650,30 +1718,14 @@
 /* Define to a type to use for `error_t' if it is not otherwise available. */
 #undef error_t
 
 /* Define to `int' if <sys/types.h> doesn't define. */
 #undef gid_t
 
-/* Define to `__inline__' or `__inline' if that's what the C compiler
-   calls it, or to nothing if 'inline' is not supported under any name.  */
-#ifndef __cplusplus
-#undef inline
-#endif
-
-/* Define to `long int' if <sys/types.h> does not define. */
-#undef off_t
-
 /* Define to `int' if <sys/types.h> does not define. */
 #undef pid_t
 
 /* Define to `unsigned int' if <sys/types.h> does not define. */
 #undef size_t
 
-/* Define to `int' if <sys/types.h> does not define. */
-#undef ssize_t
-
 /* Define to `int' if <sys/types.h> doesn't define. */
 #undef uid_t
-
-/* Define to the type of an unsigned integer type of width exactly 32 bits if
-   such a type exists and the standard includes do not define it. */
-#undef uint32_t
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/conntrack.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/conntrack.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/conntrack.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/conntrack.c	2016-09-11 16:10:25.255038733 +0800
@@ -71,20 +72,19 @@
 } /* static void conntrack_submit */
 
 static int conntrack_read (void)
 {
 	value_t conntrack, conntrack_max, conntrack_pct;
 	FILE *fh;
-	char buffer[64];
+	char buffer[64] = { 0 };
 	size_t buffer_len;
 
 	fh = fopen (old_files?CONNTRACK_FILE_OLD:CONNTRACK_FILE, "r");
 	if (fh == NULL)
 		return (-1);
 
-	memset (buffer, 0, sizeof (buffer));
 	if (fgets (buffer, sizeof (buffer), fh) == NULL)
 	{
 		fclose (fh);
 		return (-1);
 	}
 	fclose (fh);
@@ -132,10 +132,10 @@
 
 	return (0);
 } /* static int conntrack_read */
 
 void module_register (void)
 {
-    plugin_register_config ("conntrack", conntrack_config,
+	plugin_register_config ("conntrack", conntrack_config,
                             config_keys, config_keys_num);
 	plugin_register_read ("conntrack", conntrack_read);
 } /* void module_register */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpu.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpu.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpu.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpu.c	2016-09-11 16:10:25.255038733 +0800
@@ -188,29 +189,33 @@
  * determine how many CPUs there were. Reset to 0 by cpu_reset(). */
 static size_t global_cpu_num = 0;
 
 static _Bool report_by_cpu = 1;
 static _Bool report_by_state = 1;
 static _Bool report_percent = 0;
+static _Bool report_num_cpu = 0;
 
 static const char *config_keys[] =
 {
 	"ReportByCpu",
 	"ReportByState",
+	"ReportNumCpu",
 	"ValuesPercentage"
 };
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static int cpu_config (char const *key, char const *value) /* {{{ */
 {
 	if (strcasecmp (key, "ReportByCpu") == 0)
 		report_by_cpu = IS_TRUE (value) ? 1 : 0;
 	else if (strcasecmp (key, "ValuesPercentage") == 0)
 		report_percent = IS_TRUE (value) ? 1 : 0;
 	else if (strcasecmp (key, "ReportByState") == 0)
 		report_by_state = IS_TRUE (value) ? 1 : 0;
+	else if (strcasecmp (key, "ReportNumCpu") == 0)
+		report_num_cpu = IS_TRUE (value) ? 1 : 0;
 	else
 		return (-1);
 
 	return (0);
 } /* }}} int cpu_config */
 
@@ -402,25 +407,22 @@
 } /* }}} cpu_state_t *get_cpu_state */
 
 /* Populates the per-CPU COLLECTD_CPU_STATE_ACTIVE rate and the global rate_by_state
  * array. */
 static void aggregate (gauge_t *sum_by_state) /* {{{ */
 {
-	size_t cpu_num;
-	size_t state;
-
-	for (state = 0; state < COLLECTD_CPU_STATE_MAX; state++)
+	for (size_t state = 0; state < COLLECTD_CPU_STATE_MAX; state++)
 		sum_by_state[state] = NAN;
 
-	for (cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
+	for (size_t cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
 	{
 		cpu_state_t *this_cpu_states = get_cpu_state (cpu_num, 0);
 
 		this_cpu_states[COLLECTD_CPU_STATE_ACTIVE].rate = NAN;
 
-		for (state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
+		for (size_t state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
 		{
 			if (!this_cpu_states[state].has_value)
 				continue;
 
 			RATE_ADD (sum_by_state[state], this_cpu_states[state].rate);
 			if (state != COLLECTD_CPU_STATE_IDLE)
@@ -439,54 +441,65 @@
  * aggregation. rates is a pointer to COLLECTD_CPU_STATE_MAX gauge_t values holding the
  * current rate; each rate may be NAN. Calculates the percentage of each state
  * and dispatches the metric. */
 static void cpu_commit_one (int cpu_num, /* {{{ */
 		gauge_t rates[static COLLECTD_CPU_STATE_MAX])
 {
-	size_t state;
 	gauge_t sum;
 
 	sum = rates[COLLECTD_CPU_STATE_ACTIVE];
 	RATE_ADD (sum, rates[COLLECTD_CPU_STATE_IDLE]);
 
 	if (!report_by_state)
 	{
 		gauge_t percent = 100.0 * rates[COLLECTD_CPU_STATE_ACTIVE] / sum;
 		submit_percent (cpu_num, COLLECTD_CPU_STATE_ACTIVE, percent);
 		return;
 	}
 
-	for (state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
+	for (size_t state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
 	{
 		gauge_t percent = 100.0 * rates[state] / sum;
 		submit_percent (cpu_num, state, percent);
 	}
 } /* }}} void cpu_commit_one */
 
+/* Commits the number of cores */
+static void cpu_commit_num_cpu (gauge_t num_cpu) /* {{{ */
+{
+	value_t values[1];
+	value_list_t vl = VALUE_LIST_INIT;
+
+	values[0].gauge = num_cpu;
+
+	vl.values = values;
+	vl.values_len = 1;
+
+	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
+	sstrncpy (vl.plugin, "cpu", sizeof (vl.plugin));
+	sstrncpy (vl.type, "count", sizeof (vl.type));
+
+	plugin_dispatch_values (&vl);
+} /* }}} void cpu_commit_num_cpu */
+
 /* Resets the internal aggregation. This is called by the read callback after
  * each iteration / after each call to cpu_commit(). */
 static void cpu_reset (void) /* {{{ */
 {
-	size_t i;
-
-	for (i = 0; i < cpu_states_num; i++)
+	for (size_t i = 0; i < cpu_states_num; i++)
 		cpu_states[i].has_value = 0;
 
 	global_cpu_num = 0;
 } /* }}} void cpu_reset */
 
 /* Legacy behavior: Dispatches the raw derive values without any aggregation. */
 static void cpu_commit_without_aggregation (void) /* {{{ */
 {
-	int state;
-
-	for (state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
+	for (int state = 0; state < COLLECTD_CPU_STATE_ACTIVE; state++)
 	{
-		size_t cpu_num;
-
-		for (cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
+		for (size_t cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
 		{
 			cpu_state_t *s = get_cpu_state (cpu_num, state);
 
 			if (!s->has_value)
 				continue;
 
@@ -498,13 +511,15 @@
 /* Aggregates the internal state and dispatches the metrics. */
 static void cpu_commit (void) /* {{{ */
 {
 	gauge_t global_rates[COLLECTD_CPU_STATE_MAX] = {
 		NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN /* Batman! */
 	};
-	size_t cpu_num;
+
+	if (report_num_cpu)
+		cpu_commit_num_cpu ((gauge_t) global_cpu_num);
 
 	if (report_by_state && report_by_cpu && !report_percent)
 	{
 		cpu_commit_without_aggregation ();
 		return;
 	}
@@ -514,36 +529,36 @@
 	if (!report_by_cpu)
 	{
 		cpu_commit_one (-1, global_rates);
 		return;
 	}
 
-	for (cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
+	for (size_t cpu_num = 0; cpu_num < global_cpu_num; cpu_num++)
 	{
 		cpu_state_t *this_cpu_states = get_cpu_state (cpu_num, 0);
 		gauge_t local_rates[COLLECTD_CPU_STATE_MAX] = {
 			NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN, NAN
 		};
-		size_t state;
 
-		for (state = 0; state < COLLECTD_CPU_STATE_MAX; state++)
+		for (size_t state = 0; state < COLLECTD_CPU_STATE_MAX; state++)
 			if (this_cpu_states[state].has_value)
 				local_rates[state] = this_cpu_states[state].rate;
 
 		cpu_commit_one ((int) cpu_num, local_rates);
 	}
 } /* }}} void cpu_commit */
 
 /* Adds a derive value to the internal state. This should be used by each read
  * function for each state. At the end of the iteration, the read function
  * should call cpu_commit(). */
-static int cpu_stage (size_t cpu_num, size_t state, derive_t value, cdtime_t now) /* {{{ */
+static int cpu_stage (size_t cpu_num, size_t state, derive_t d, cdtime_t now) /* {{{ */
 {
 	int status;
 	cpu_state_t *s;
-	value_t v;
+	gauge_t rate = NAN;
+	value_t val = {.derive = d};
 
 	if (state >= COLLECTD_CPU_STATE_ACTIVE)
 		return (EINVAL);
 
 	status = cpu_states_alloc (cpu_num);
 	if (status != 0)
@@ -551,37 +566,34 @@
 
 	if (global_cpu_num <= cpu_num)
 		global_cpu_num = cpu_num + 1;
 
 	s = get_cpu_state (cpu_num, state);
 
-	v.gauge = NAN;
-	status = value_to_rate (&v, value, &s->conv, DS_TYPE_DERIVE, now);
+	status = value_to_rate (&rate, val, DS_TYPE_DERIVE, now, &s->conv);
 	if (status != 0)
 		return (status);
 
-	s->rate = v.gauge;
+	s->rate = rate;
 	s->has_value = 1;
 	return (0);
 } /* }}} int cpu_stage */
 
 static int cpu_read (void)
 {
 	cdtime_t now = cdtime ();
 
 #if PROCESSOR_CPU_LOAD_INFO /* {{{ */
-	int cpu;
-
 	kern_return_t status;
 
 	processor_cpu_load_info_data_t cpu_info;
 	mach_msg_type_number_t         cpu_info_len;
 
 	host_t cpu_host;
 
-	for (cpu = 0; cpu < cpu_list_len; cpu++)
+	for (mach_msg_type_number_t cpu = 0; cpu < cpu_list_len; cpu++)
 	{
 		cpu_host = 0;
 		cpu_info_len = PROCESSOR_BASIC_INFO_COUNT;
 
 		status = processor_info (cpu_list[cpu], PROCESSOR_CPU_LOAD_INFO, &cpu_host,
 				(processor_info_t) &cpu_info, &cpu_info_len);
@@ -650,19 +662,18 @@
 		}
 	}
 	fclose (fh);
 /* }}} #endif defined(KERNEL_LINUX) */
 
 #elif defined(HAVE_LIBKSTAT) /* {{{ */
-	int cpu;
 	static cpu_stat_t cs;
 
 	if (kc == NULL)
 		return (-1);
 
-	for (cpu = 0; cpu < numcpu; cpu++)
+	for (int cpu = 0; cpu < numcpu; cpu++)
 	{
 		if (kstat_read (kc, ksp[cpu], &cs) == -1)
 			continue; /* error message? */
 
 		cpu_stage (ksp[cpu]->ks_instance, COLLECTD_CPU_STATE_IDLE,   (derive_t) cs.cpu_sysinfo.cpu[CPU_IDLE],   now);
 		cpu_stage (ksp[cpu]->ks_instance, COLLECTD_CPU_STATE_USER,   (derive_t) cs.cpu_sysinfo.cpu[CPU_USER],   now);
@@ -672,26 +683,25 @@
 /* }}} #endif defined(HAVE_LIBKSTAT) */
 
 #elif CAN_USE_SYSCTL /* {{{ */
 	uint64_t cpuinfo[numcpu][CPUSTATES];
 	size_t cpuinfo_size;
 	int status;
-	int i;
 
 	if (numcpu < 1)
 	{
 		ERROR ("cpu plugin: Could not determine number of "
 				"installed CPUs using sysctl(3).");
 		return (-1);
 	}
 
 	memset (cpuinfo, 0, sizeof (cpuinfo));
 
 #if defined(KERN_CPTIME2)
 	if (numcpu > 1) {
-		for (i = 0; i < numcpu; i++) {
+		for (int i = 0; i < numcpu; i++) {
 			int mib[] = {CTL_KERN, KERN_CPTIME2, i};
 
 			cpuinfo_size = sizeof (cpuinfo[0]);
 
 			status = sysctl (mib, STATIC_ARRAY_SIZE (mib),
 					cpuinfo[i], &cpuinfo_size, NULL, 0);
@@ -718,43 +728,42 @@
 			char errbuf[1024];
 			ERROR ("cpu plugin: sysctl failed: %s.",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			return (-1);
 		}
 
-		for(i = 0; i < CPUSTATES; i++) {
+		for(int i = 0; i < CPUSTATES; i++) {
 			cpuinfo[0][i] = cpuinfo_tmp[i];
 		}
 	}
 
-	for (i = 0; i < numcpu; i++) {
+	for (int i = 0; i < numcpu; i++) {
 		cpu_stage (i, COLLECTD_CPU_STATE_USER,      (derive_t) cpuinfo[i][CP_USER], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_NICE,      (derive_t) cpuinfo[i][CP_NICE], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_SYSTEM,    (derive_t) cpuinfo[i][CP_SYS], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_IDLE,      (derive_t) cpuinfo[i][CP_IDLE], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_INTERRUPT, (derive_t) cpuinfo[i][CP_INTR], now);
 	}
 /* }}} #endif CAN_USE_SYSCTL */
 
 #elif defined(HAVE_SYSCTLBYNAME) && defined(HAVE_SYSCTL_KERN_CP_TIMES) /* {{{ */
 	long cpuinfo[maxcpu][CPUSTATES];
 	size_t cpuinfo_size;
-	int i;
 
 	memset (cpuinfo, 0, sizeof (cpuinfo));
 
 	cpuinfo_size = sizeof (cpuinfo);
 	if (sysctlbyname("kern.cp_times", &cpuinfo, &cpuinfo_size, NULL, 0) < 0)
 	{
 		char errbuf[1024];
 		ERROR ("cpu plugin: sysctlbyname failed: %s.",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	for (i = 0; i < numcpu; i++) {
+	for (int i = 0; i < numcpu; i++) {
 		cpu_stage (i, COLLECTD_CPU_STATE_USER,      (derive_t) cpuinfo[i][CP_USER], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_NICE,      (derive_t) cpuinfo[i][CP_NICE], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_SYSTEM,    (derive_t) cpuinfo[i][CP_SYS], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_IDLE,      (derive_t) cpuinfo[i][CP_IDLE], now);
 		cpu_stage (i, COLLECTD_CPU_STATE_INTERRUPT, (derive_t) cpuinfo[i][CP_INTR], now);
 	}
@@ -798,27 +807,26 @@
 	cpu_state (0, COLLECTD_CPU_STATE_USER,   (derive_t) cs->user);
 	cpu_state (0, COLLECTD_CPU_STATE_WAIT,   (derive_t) cs->iowait);
 /* }}} #endif HAVE_LIBSTATGRAB */
 
 #elif defined(HAVE_PERFSTAT) /* {{{ */
 	perfstat_id_t id;
-	int i, cpus;
+	int cpus;
 
 	numcpu =  perfstat_cpu(NULL, NULL, sizeof(perfstat_cpu_t), 0);
 	if(numcpu == -1)
 	{
 		char errbuf[1024];
 		WARNING ("cpu plugin: perfstat_cpu: %s",
 			sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	if (pnumcpu != numcpu || perfcpu == NULL)
 	{
-		if (perfcpu != NULL)
-			free(perfcpu);
+		free(perfcpu);
 		perfcpu = malloc(numcpu * sizeof(perfstat_cpu_t));
 	}
 	pnumcpu = numcpu;
 
 	id.name[0] = '\0';
 	if ((cpus = perfstat_cpu(&id, perfcpu, sizeof(perfstat_cpu_t), numcpu)) < 0)
@@ -826,13 +834,13 @@
 		char errbuf[1024];
 		WARNING ("cpu plugin: perfstat_cpu: %s",
 			sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	for (i = 0; i < cpus; i++)
+	for (int i = 0; i < cpus; i++)
 	{
 		cpu_stage (i, COLLECTD_CPU_STATE_IDLE,   (derive_t) perfcpu[i].idle, now);
 		cpu_stage (i, COLLECTD_CPU_STATE_SYSTEM, (derive_t) perfcpu[i].sys,  now);
 		cpu_stage (i, COLLECTD_CPU_STATE_USER,   (derive_t) perfcpu[i].user, now);
 		cpu_stage (i, COLLECTD_CPU_STATE_WAIT,   (derive_t) perfcpu[i].wait, now);
 	}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpufreq.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpufreq.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpufreq.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpufreq.c	2016-09-11 16:10:25.255038733 +0800
@@ -77,18 +78,17 @@
 }
 
 static int cpufreq_read (void)
 {
         int status;
 	unsigned long long val;
-	int i = 0;
 	FILE *fp;
 	char filename[256];
 	char buffer[16];
 
-	for (i = 0; i < num_cpu; i++)
+	for (int i = 0; i < num_cpu; i++)
 	{
 		status = ssnprintf (filename, sizeof (filename),
 				"/sys/devices/system/cpu/cpu%d/cpufreq/"
 				"scaling_cur_freq", i);
 		if ((status < 1) || ((unsigned int)status >= sizeof (filename)))
 			return (-1);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: cpusleep.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpython.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpython.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/cpython.h	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/cpython.h	2016-09-11 16:10:25.255038733 +0800
@@ -18,13 +18,13 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Sven Trenkel <collectd at semidefinite.de>  
+ *   Sven Trenkel <collectd at semidefinite.de>
  **/
 
 /* Some python versions don't include this by default. */
 
 #include <longintrepr.h>
 
@@ -49,38 +49,12 @@
 	return
 
 #define CPY_RELEASE_THREADS \
 	PyGILState_Release(gil_state);\
 }
 
-/* Python 2.4 has this macro, older versions do not. */
-#ifndef Py_VISIT
-#define Py_VISIT(o) do {\
-	int _vret;\
-	if ((o) != NULL) {\
-		_vret = visit((o), arg);\
-		if (_vret != 0)\
-		return _vret;\
-	}\
-} while (0)
-#endif
-
-/* Python 2.4 has this macro, older versions do not. */
-#ifndef Py_CLEAR
-#define Py_CLEAR(o) do {\
-	PyObject *tmp = o;\
-	(o) = NULL;\
-	Py_XDECREF(tmp);\
-} while (0)
-#endif
-
-/* Python 2.4 has this macro, older versions do not. */
-#ifndef Py_RETURN_NONE
-# define Py_RETURN_NONE return Py_INCREF(Py_None), Py_None
-#endif
-
 /* This macro is a shortcut for calls like
  * x = PyObject_Repr(x);
  * This can't be done like this example because this would leak
  * a reference the the original x and crash in case of x == NULL.
  * This calling syntax is less than elegant but it works, saves
  * a lot of lines and avoids potential refcount errors. */
@@ -108,16 +82,16 @@
 #define CPY_STRCAT_AND_DEL(a, b) do {\
 	CPY_STRCAT((a), (b));\
 	Py_XDECREF((b));\
 } while (0)
 static inline void CPY_STRCAT(PyObject **a, PyObject *b) {
 	PyObject *ret;
-	
+
 	if (!a || !*a)
 		return;
-	
+
 	ret = PyUnicode_Concat(*a, b);
 	Py_DECREF(*a);
 	*a = ret;
 }
 
 #else
@@ -153,13 +127,13 @@
 	if (ret != NULL)
 		return ret;
 	PyErr_Clear();
 	return PyBytes_FromString(buf);
 #else
 	return PyString_FromString(buf);
-#endif	
+#endif
 }
 
 void cpy_log_exception(const char *context);
 
 /* Python object declarations. */
 
@@ -167,43 +141,43 @@
 	PyObject_HEAD        /* No semicolon! */
 	PyObject *parent;    /* Config */
 	PyObject *key;       /* String */
 	PyObject *values;    /* Sequence */
 	PyObject *children;  /* Sequence */
 } Config;
-PyTypeObject ConfigType;
+extern PyTypeObject ConfigType;
 
 typedef struct {
 	PyObject_HEAD        /* No semicolon! */
 	double time;
 	char host[DATA_MAX_NAME_LEN];
 	char plugin[DATA_MAX_NAME_LEN];
 	char plugin_instance[DATA_MAX_NAME_LEN];
 	char type[DATA_MAX_NAME_LEN];
 	char type_instance[DATA_MAX_NAME_LEN];
 } PluginData;
-PyTypeObject PluginDataType;
+extern PyTypeObject PluginDataType;
 #define PluginData_New() PyObject_CallFunctionObjArgs((PyObject *) &PluginDataType, (void *) 0)
 
 typedef struct {
 	PluginData data;
 	PyObject *values;    /* Sequence */
 	PyObject *meta;      /* dict */
 	double interval;
 } Values;
-PyTypeObject ValuesType;
+extern PyTypeObject ValuesType;
 #define Values_New() PyObject_CallFunctionObjArgs((PyObject *) &ValuesType, (void *) 0)
 
 typedef struct {
 	PluginData data;
 	int severity;
 	char message[NOTIF_MAX_MSG_LEN];
 } Notification;
-PyTypeObject NotificationType;
+extern PyTypeObject NotificationType;
 #define Notification_New() PyObject_CallFunctionObjArgs((PyObject *) &NotificationType, (void *) 0)
 
 typedef PyLongObject Signed;
-PyTypeObject SignedType;
+extern PyTypeObject SignedType;
 
 typedef PyLongObject Unsigned;
-PyTypeObject UnsignedType;
+extern PyTypeObject UnsignedType;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/csv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/csv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/csv.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/csv.c	2016-09-11 16:10:25.255038733 +0800
@@ -42,26 +43,25 @@
 
 static int value_list_to_string (char *buffer, int buffer_len,
 		const data_set_t *ds, const value_list_t *vl)
 {
 	int offset;
 	int status;
-	int i;
 	gauge_t *rates = NULL;
 
 	assert (0 == strcmp (ds->type, vl->type));
 
 	memset (buffer, '\0', buffer_len);
 
 	status = ssnprintf (buffer, buffer_len, "%.3f",
 			CDTIME_T_TO_DOUBLE (vl->time));
 	if ((status < 1) || (status >= buffer_len))
 		return (-1);
 	offset = status;
 
-	for (i = 0; i < ds->ds_num; i++)
+	for (size_t i = 0; i < ds->ds_num; i++)
 	{
 		if ((ds->ds[i].type != DS_TYPE_COUNTER)
 				&& (ds->ds[i].type != DS_TYPE_GAUGE)
 				&& (ds->ds[i].type != DS_TYPE_DERIVE)
 				&& (ds->ds[i].type != DS_TYPE_ABSOLUTE))
 		{
@@ -184,13 +184,12 @@
 	return (0);
 } /* int value_list_to_filename */
 
 static int csv_create_file (const char *filename, const data_set_t *ds)
 {
 	FILE *csv;
-	int i;
 
 	if (check_create_dir (filename))
 		return (-1);
 
 	csv = fopen (filename, "w");
 	if (csv == NULL)
@@ -200,13 +199,13 @@
 				filename,
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	fprintf (csv, "epoch");
-	for (i = 0; i < ds->ds_num; i++)
+	for (size_t i = 0; i < ds->ds_num; i++)
 		fprintf (csv, ",%s", ds->ds[i].name);
 
 	fprintf (csv, "\n");
 	fclose (csv);
 
 	return 0;
@@ -266,13 +265,13 @@
 {
 	struct stat  statbuf;
 	char         filename[512];
 	char         values[4096];
 	FILE        *csv;
 	int          csv_fd;
-	struct flock fl;
+	struct flock fl = { 0 };
 	int          status;
 
 	if (0 != strcmp (ds->type, vl->type)) {
 		ERROR ("csv plugin: DS type does not match value list type");
 		return -1;
 	}
@@ -285,18 +284,16 @@
 
 	if (value_list_to_string (values, sizeof (values), ds, vl) != 0)
 		return (-1);
 
 	if (use_stdio)
 	{
-		size_t i;
-
 		escape_string (filename, sizeof (filename));
 
 		/* Replace commas by colons for PUTVAL compatible output. */
-		for (i = 0; i < sizeof (values); i++)
+		for (size_t i = 0; i < sizeof (values); i++)
 		{
 			if (values[i] == 0)
 				break;
 			else if (values[i] == ',')
 				values[i] = ':';
 		}
@@ -339,15 +336,12 @@
 		ERROR ("csv plugin: fopen (%s) failed: %s", filename,
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 	csv_fd = fileno (csv);
 
-	memset (&fl, '\0', sizeof (fl));
-	fl.l_start  = 0;
-	fl.l_len    = 0; /* till end of file */
 	fl.l_pid    = getpid ();
 	fl.l_type   = F_WRLCK;
 	fl.l_whence = SEEK_SET;
 
 	status = fcntl (csv_fd, F_SETLK, &fl);
 	if (status != 0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl.c	2016-09-11 16:10:25.255038733 +0800
@@ -19,15 +19,16 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Aman Gupta <aman at tmm1.net>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
+#include "utils_curl_stats.h"
 #include "utils_match.h"
 #include "utils_time.h"
 
 #include <curl/curl.h>
 
 /*
@@ -64,12 +65,13 @@
   char *cacert;
   struct curl_slist *headers;
   char *post_body;
   _Bool response_time;
   _Bool response_code;
   int timeout;
+  curl_stats_t *stats;
 
   CURL *curl;
   char curl_errbuf[CURL_ERROR_SIZE];
   char *buffer;
   size_t buffer_size;
   size_t buffer_fill;
@@ -92,26 +94,26 @@
     size_t size, size_t nmemb, void *user_data)
 {
   web_page_t *wp;
   size_t len;
 
   len = size * nmemb;
-  if (len <= 0)
+  if (len == 0)
     return (len);
 
   wp = user_data;
   if (wp == NULL)
     return (0);
 
   if ((wp->buffer_fill + len) >= wp->buffer_size)
   {
     char *temp;
     size_t temp_size;
 
     temp_size = wp->buffer_fill + len + 1;
-    temp = (char *) realloc (wp->buffer, temp_size);
+    temp = realloc (wp->buffer, temp_size);
     if (temp == NULL)
     {
       ERROR ("curl plugin: realloc failed.");
       return (0);
     }
     wp->buffer = temp;
@@ -153,12 +155,13 @@
   sfree (wp->user);
   sfree (wp->pass);
   sfree (wp->credentials);
   sfree (wp->cacert);
   sfree (wp->post_body);
   curl_slist_free_all (wp->headers);
+  curl_stats_destroy (wp->stats);
 
   sfree (wp->buffer);
 
   cc_web_match_free (wp->matches);
   cc_web_page_free (wp->next);
   sfree (wp);
@@ -263,29 +266,27 @@
 
 static int cc_config_add_match (web_page_t *page, /* {{{ */
     oconfig_item_t *ci)
 {
   web_match_t *match;
   int status;
-  int i;
 
   if (ci->values_num != 0)
   {
     WARNING ("curl plugin: Ignoring arguments for the `Match' block.");
   }
 
-  match = (web_match_t *) malloc (sizeof (*match));
+  match = calloc (1, sizeof (*match));
   if (match == NULL)
   {
-    ERROR ("curl plugin: malloc failed.");
+    ERROR ("curl plugin: calloc failed.");
     return (-1);
   }
-  memset (match, 0, sizeof (*match));
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Regex", child->key) == 0)
       status = cf_util_get_string (child, &match->regex);
     else if (strcasecmp ("ExcludeRegex", child->key) == 0)
@@ -336,13 +337,13 @@
   }
 
   match->match = match_create_simple (match->regex, match->exclude_regex,
       match->dstype);
   if (match->match == NULL)
   {
-    ERROR ("curl plugin: tail_match_add_match_simple failed.");
+    ERROR ("curl plugin: match_create_simple failed.");
     cc_web_match_free (match);
     return (-1);
   }
   else
   {
     web_match_t *prev;
@@ -388,13 +389,13 @@
     size_t credentials_size;
 
     credentials_size = strlen (wp->user) + 2;
     if (wp->pass != NULL)
       credentials_size += strlen (wp->pass);
 
-    wp->credentials = (char *) malloc (credentials_size);
+    wp->credentials = malloc (credentials_size);
     if (wp->credentials == NULL)
     {
       ERROR ("curl plugin: malloc failed.");
       return (-1);
     }
 
@@ -418,59 +419,57 @@
     curl_easy_setopt (wp->curl, CURLOPT_POSTFIELDS, wp->post_body);
 
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
   if (wp->timeout >= 0)
     curl_easy_setopt (wp->curl, CURLOPT_TIMEOUT_MS, (long) wp->timeout);
   else
-    curl_easy_setopt (wp->curl, CURLOPT_TIMEOUT_MS,
-       CDTIME_T_TO_MS(plugin_get_interval()));
+    curl_easy_setopt (wp->curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
   return (0);
 } /* }}} int cc_page_init_curl */
 
 static int cc_config_add_page (oconfig_item_t *ci) /* {{{ */
 {
   web_page_t *page;
   int status;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("curl plugin: `Page' blocks need exactly one string argument.");
     return (-1);
   }
 
-  page = (web_page_t *) malloc (sizeof (*page));
+  page = calloc (1, sizeof (*page));
   if (page == NULL)
   {
-    ERROR ("curl plugin: malloc failed.");
+    ERROR ("curl plugin: calloc failed.");
     return (-1);
   }
-  memset (page, 0, sizeof (*page));
   page->url = NULL;
   page->user = NULL;
   page->pass = NULL;
   page->digest = 0;
   page->verify_peer = 1;
   page->verify_host = 1;
   page->response_time = 0;
   page->response_code = 0;
   page->timeout = -1;
+  page->stats = NULL;
 
   page->instance = strdup (ci->values[0].value.string);
   if (page->instance == NULL)
   {
     ERROR ("curl plugin: strdup failed.");
     sfree (page);
     return (-1);
   }
 
   /* Process all children */
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("URL", child->key) == 0)
       status = cf_util_get_string (child, &page->url);
     else if (strcasecmp ("User", child->key) == 0)
@@ -495,12 +494,17 @@
     else if (strcasecmp ("Header", child->key) == 0)
       status = cc_config_append_string ("Header", &page->headers, child);
     else if (strcasecmp ("Post", child->key) == 0)
       status = cf_util_get_string (child, &page->post_body);
     else if (strcasecmp ("Timeout", child->key) == 0)
       status = cf_util_get_int (child, &page->timeout);
+    else if (strcasecmp ("Statistics", child->key) == 0) {
+      page->stats = curl_stats_from_config (child);
+      if (page->stats == NULL)
+        status = -1;
+    }
     else
     {
       WARNING ("curl plugin: Option `%s' not allowed here.", child->key);
       status = -1;
     }
 
@@ -514,18 +518,19 @@
     if (page->url == NULL)
     {
       WARNING ("curl plugin: `URL' missing in `Page' block.");
       status = -1;
     }
 
-    if (page->matches == NULL && !page->response_time && !page->response_code)
+    if (page->matches == NULL && page->stats == NULL
+        && !page->response_time && !page->response_code)
     {
       assert (page->instance != NULL);
       WARNING ("curl plugin: No (valid) `Match' block "
-          "or MeasureResponseTime or MeasureResponseCode within "
-          "`Page' block `%s'.", page->instance);
+          "or Statistics or MeasureResponseTime or MeasureResponseCode "
+          "within `Page' block `%s'.", page->instance);
       status = -1;
     }
 
     if (status == 0)
       status = cc_page_init_curl (page);
 
@@ -543,31 +548,30 @@
     pages_g = page;
   else
   {
     web_page_t *prev;
 
     prev = pages_g;
-    while ((prev != NULL) && (prev->next != NULL))
+    while (prev->next != NULL)
       prev = prev->next;
     prev->next = page;
   }
 
   return (0);
 } /* }}} int cc_config_add_page */
 
 static int cc_config (oconfig_item_t *ci) /* {{{ */
 {
   int success;
   int errors;
   int status;
-  int i;
 
   success = 0;
   errors = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Page", child->key) == 0)
     {
       status = cc_config_add_page (child);
@@ -657,13 +661,12 @@
 
   plugin_dispatch_values (&vl);
 } /* }}} void cc_submit_response_time */
 
 static int cc_read_page (web_page_t *wp) /* {{{ */
 {
-  web_match_t *wm;
   int status;
   cdtime_t start = 0;
 
   if (wp->response_time)
     start = cdtime ();
 
@@ -675,12 +678,14 @@
         status, wp->curl_errbuf);
     return (-1);
   }
 
   if (wp->response_time)
     cc_submit_response_time (wp, cdtime() - start);
+  if (wp->stats != NULL)
+    curl_stats_dispatch (wp->stats, wp->curl, hostname_g, "curl", wp->instance);
 
   if(wp->response_code)
   {
     long response_code = 0;
     status = curl_easy_getinfo(wp->curl, CURLINFO_RESPONSE_CODE, &response_code);
     if(status != CURLE_OK) {
@@ -688,13 +693,13 @@
         status, wp->curl_errbuf);
     } else {
       cc_submit_response_code(wp, response_code);
     }
   }
 
-  for (wm = wp->matches; wm != NULL; wm = wm->next)
+  for (web_match_t *wm = wp->matches; wm != NULL; wm = wm->next)
   {
     cu_match_value_t *mv;
 
     status = match_apply (wm->match, wp->buffer);
     if (status != 0)
     {
@@ -715,15 +720,13 @@
 
   return (0);
 } /* }}} int cc_read_page */
 
 static int cc_read (void) /* {{{ */
 {
-  web_page_t *wp;
-
-  for (wp = pages_g; wp != NULL; wp = wp->next)
+  for (web_page_t *wp = pages_g; wp != NULL; wp = wp->next)
     cc_read_page (wp);
 
   return (0);
 } /* }}} int cc_read */
 
 static int cc_shutdown (void) /* {{{ */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl_json.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl_json.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl_json.c	2016-11-29 00:08:22.399470384 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl_json.c	2016-09-11 16:10:25.255038733 +0800
@@ -19,19 +19,19 @@
  * Authors:
  *   Doug MacEachern <dougm at hyperic.com>
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_avltree.h"
 #include "utils_complain.h"
+#include "utils_curl_stats.h"
 
-#include <sys/socket.h>
 #include <sys/types.h>
 #include <sys/un.h>
 
 #include <curl/curl.h>
 
 #include <yajl/yajl_parse.h>
@@ -76,12 +76,13 @@
   _Bool verify_host;
   char *cacert;
   struct curl_slist *headers;
   char *post_body;
   cdtime_t interval;
   int timeout;
+  curl_stats_t *stats;
 
   CURL *curl;
   char curl_errbuf[CURL_ERROR_SIZE];
 
   yajl_handle yajl;
   c_avl_tree_t *tree;
@@ -114,13 +115,13 @@
   cj_t *db;
   size_t len;
   yajl_status status;
 
   len = size * nmemb;
 
-  if (len <= 0)
+  if (len == 0)
     return (len);
 
   db = user_data;
   if (db == NULL)
     return (0);
 
@@ -140,15 +141,12 @@
 } /* }}} size_t cj_curl_callback */
 
 static int cj_get_type (cj_key_t *key)
 {
   const data_set_t *ds;
 
-  if ((key == NULL) || !CJ_IS_KEY (key))
-    return -EINVAL;
-
   ds = plugin_get_ds (key->type);
   if (ds == NULL)
   {
     static char type[DATA_MAX_NAME_LEN] = "!!!invalid!!!";
 
     assert (key->type != NULL);
@@ -226,21 +224,18 @@
 
   /* Create a null-terminated version of the string. */
   memcpy (buffer, number, number_len);
   buffer[sizeof (buffer) - 1] = 0;
 
   if ((key == NULL) || !CJ_IS_KEY (key)) {
-    if (key != NULL && !db->state[db->depth].in_array/*can be inhomogeneous*/) {
+    if (key != NULL && !db->state[db->depth].in_array/*can be inhomogeneous*/)
       NOTICE ("curl_json plugin: Found \"%s\", but the configuration expects"
               " a map.", buffer);
-      return (CJ_CB_CONTINUE);
-    }
-
     cj_cb_inc_array_index (ctx, /* update_key = */ 1);
     key = db->state[db->depth].key;
-    if ((key == NULL) || !CJ_IS_KEY (key)) {
+    if (key == NULL) {
       return (CJ_CB_CONTINUE);
     }
   }
   else
   {
     cj_cb_inc_array_index (ctx, /* update_key = */ 1);
@@ -436,12 +431,13 @@
   sfree (db->user);
   sfree (db->pass);
   sfree (db->credentials);
   sfree (db->cacert);
   sfree (db->post_body);
   curl_slist_free_all (db->headers);
+  curl_stats_destroy (db->stats);
 
   sfree (db);
 } /* }}} void cj_free */
 
 /* Configuration handling functions {{{ */
 
@@ -471,29 +467,27 @@
 
 static int cj_config_add_key (cj_t *db, /* {{{ */
                                    oconfig_item_t *ci)
 {
   cj_key_t *key;
   int status;
-  int i;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("curl_json plugin: The `Key' block "
              "needs exactly one string argument.");
     return (-1);
   }
 
-  key = (cj_key_t *) malloc (sizeof (*key));
+  key = calloc (1, sizeof (*key));
   if (key == NULL)
   {
-    ERROR ("curl_json plugin: malloc failed.");
+    ERROR ("curl_json plugin: calloc failed.");
     return (-1);
   }
-  memset (key, 0, sizeof (*key));
   key->magic = CJ_KEY_MAGIC;
 
   if (strcasecmp ("Key", ci->key) == 0)
   {
     status = cf_util_get_string (ci, &key->path);
     if (status != 0)
@@ -508,13 +502,13 @@
            "Invalid key: %s", ci->key);
     cj_key_free (key);
     return (-1);
   }
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Type", child->key) == 0)
       status = cf_util_get_string (child, &key->type);
     else if (strcasecmp ("Instance", child->key) == 0)
@@ -622,13 +616,13 @@
     size_t credentials_size;
 
     credentials_size = strlen (db->user) + 2;
     if (db->pass != NULL)
       credentials_size += strlen (db->pass);
 
-    db->credentials = (char *) malloc (credentials_size);
+    db->credentials = malloc (credentials_size);
     if (db->credentials == NULL)
     {
       ERROR ("curl_json plugin: malloc failed.");
       return (-1);
     }
 
@@ -652,43 +646,39 @@
     curl_easy_setopt (db->curl, CURLOPT_POSTFIELDS, db->post_body);
 
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
   if (db->timeout >= 0)
     curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS, (long) db->timeout);
   else if (db->interval > 0)
-    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS,
-        CDTIME_T_TO_MS(db->timeout));
+    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(db->timeout));
   else
-    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS,
-        CDTIME_T_TO_MS(plugin_get_interval()));
+    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
   return (0);
 } /* }}} int cj_init_curl */
 
 static int cj_config_add_url (oconfig_item_t *ci) /* {{{ */
 {
   cj_t *db;
   int status = 0;
-  int i;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("curl_json plugin: The `URL' block "
              "needs exactly one string argument.");
     return (-1);
   }
 
-  db = (cj_t *) malloc (sizeof (*db));
+  db = calloc (1, sizeof (*db));
   if (db == NULL)
   {
-    ERROR ("curl_json plugin: malloc failed.");
+    ERROR ("curl_json plugin: calloc failed.");
     return (-1);
   }
-  memset (db, 0, sizeof (*db));
 
   db->timeout = -1;
 
   if (strcasecmp ("URL", ci->key) == 0)
     status = cf_util_get_string (ci, &db->url);
   else if (strcasecmp ("Sock", ci->key) == 0)
@@ -704,13 +694,13 @@
   {
     sfree (db);
     return (status);
   }
 
   /* Fill the `cj_t' structure.. */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Instance", child->key) == 0)
       status = cf_util_get_string (child, &db->instance);
     else if (strcasecmp ("Host", child->key) == 0)
@@ -734,12 +724,18 @@
     else if (strcasecmp ("Key", child->key) == 0)
       status = cj_config_add_key (db, child);
     else if (strcasecmp ("Interval", child->key) == 0)
       status = cf_util_get_cdtime(child, &db->interval);
     else if (strcasecmp ("Timeout", child->key) == 0)
       status = cf_util_get_int (child, &db->timeout);
+    else if (strcasecmp ("Statistics", child->key) == 0)
+    {
+      db->stats = curl_stats_from_config (child);
+      if (db->stats == NULL)
+        status = -1;
+    }
     else
     {
       WARNING ("curl_json plugin: Option `%s' not allowed here.", child->key);
       status = -1;
     }
 
@@ -759,33 +755,30 @@
       status = cj_init_curl (db);
   }
 
   /* If all went well, register this database for reading */
   if (status == 0)
   {
-    user_data_t ud;
     char *cb_name;
-    struct timespec interval = { 0, 0 };
-
-    CDTIME_T_TO_TIMESPEC (db->interval, &interval);
 
     if (db->instance == NULL)
       db->instance = strdup("default");
 
     DEBUG ("curl_json plugin: Registering new read callback: %s",
            db->instance);
 
-    memset (&ud, 0, sizeof (ud));
-    ud.data = (void *) db;
-    ud.free_func = cj_free;
-
     cb_name = ssnprintf_alloc ("curl_json-%s-%s",
                db->instance, db->url ? db->url : db->sock);
 
+    user_data_t ud = {
+      .data = db,
+      .free_func = cj_free
+    };
+
     plugin_register_complex_read (/* group = */ NULL, cb_name, cj_read,
-                                  /* interval = */ (db->interval > 0) ? &interval : NULL,
+                                  /* interval = */ db->interval,
                                   &ud);
     sfree (cb_name);
   }
   else
   {
     cj_free (db);
@@ -798,18 +791,17 @@
 
 static int cj_config (oconfig_item_t *ci) /* {{{ */
 {
   int success;
   int errors;
   int status;
-  int i;
 
   success = 0;
   errors = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Sock", child->key) == 0
         || strcasecmp ("URL", child->key) == 0)
     {
@@ -834,38 +826,39 @@
 
   return (0);
 } /* }}} int cj_config */
 
 /* }}} End of configuration handling functions */
 
+static const char *cj_host (cj_t *db) /* {{{ */
+{
+  if ((db->host == NULL)
+      || (strcmp ("", db->host) == 0)
+      || (strcmp (CJ_DEFAULT_HOST, db->host) == 0))
+    return hostname_g;
+  return db->host;
+} /* }}} cj_host */
+
 static void cj_submit (cj_t *db, cj_key_t *key, value_t *value) /* {{{ */
 {
   value_list_t vl = VALUE_LIST_INIT;
-  char *host;
 
   vl.values     = value;
   vl.values_len = 1;
 
-  if ((db->host == NULL)
-      || (strcmp ("", db->host) == 0)
-      || (strcmp (CJ_DEFAULT_HOST, db->host) == 0))
-    host = hostname_g;
-  else
-    host = db->host;
-
   if (key->instance == NULL)
   {
-    int i, len = 0;
-    for (i = 0; i < db->depth; i++)
+    int len = 0;
+    for (int i = 0; i < db->depth; i++)
       len += ssnprintf(vl.type_instance+len, sizeof(vl.type_instance)-len,
                        i ? "-%s" : "%s", db->state[i+1].name);
   }
   else
     sstrncpy (vl.type_instance, key->instance, sizeof (vl.type_instance));
 
-  sstrncpy (vl.host, host, sizeof (vl.host));
+  sstrncpy (vl.host, cj_host (db), sizeof (vl.host));
   sstrncpy (vl.plugin, "curl_json", sizeof (vl.plugin));
   sstrncpy (vl.plugin_instance, db->instance, sizeof (vl.plugin_instance));
   sstrncpy (vl.type, key->type, sizeof (vl.type));
 
   if (db->interval > 0)
     vl.interval = db->interval;
@@ -873,13 +866,13 @@
   plugin_dispatch_values (&vl);
 } /* }}} int cj_submit */
 
 static int cj_sock_perform (cj_t *db) /* {{{ */
 {
   char errbuf[1024];
-  struct sockaddr_un sa_unix = {};
+  struct sockaddr_un sa_unix = { 0 };
   sa_unix.sun_family = AF_UNIX;
   sstrncpy (sa_unix.sun_path, db->sock, sizeof (sa_unix.sun_path));
 
   int fd = socket (AF_UNIX, SOCK_STREAM, 0);
   if (fd < 0)
     return (-1);
@@ -922,12 +915,14 @@
   if (status != CURLE_OK)
   {
     ERROR ("curl_json plugin: curl_easy_perform failed with status %i: %s (%s)",
            status, db->curl_errbuf, url);
     return (-1);
   }
+  if (db->stats != NULL)
+    curl_stats_dispatch (db->stats, db->curl, cj_host (db), "curl_json", db->instance);
 
   curl_easy_getinfo(db->curl, CURLINFO_EFFECTIVE_URL, &url);
   curl_easy_getinfo(db->curl, CURLINFO_RESPONSE_CODE, &rc);
 
   /* The response code is zero if a non-HTTP transport was used. */
   if ((rc != 0) && (rc != 200))
@@ -967,15 +962,15 @@
     yajl_free (db->yajl);
     db->yajl = yprev;
     return (-1);
   }
 
 #if HAVE_YAJL_V2
-    status = yajl_complete_parse(db->yajl);
+  status = yajl_complete_parse(db->yajl);
 #else
-    status = yajl_parse_complete(db->yajl);
+  status = yajl_parse_complete(db->yajl);
 #endif
   if (status != yajl_status_ok)
   {
     unsigned char *errmsg;
 
     errmsg = yajl_get_error (db->yajl, /* verbose = */ 0,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl_xml.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl_xml.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/curl_xml.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/curl_xml.c	2016-09-11 16:10:25.255038733 +0800
@@ -17,15 +17,16 @@
  *
  * Authors:
  *   Amit Gupta <amit.gupta221 at gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
+#include "utils_curl_stats.h"
 #include "utils_llist.h"
 
 #include <libxml/parser.h>
 #include <libxml/tree.h>
 #include <libxml/xpath.h>
 #include <libxml/xpathInternals.h>
@@ -47,13 +48,13 @@
 
 struct cx_xpath_s /* {{{ */
 {
   char *path;
   char *type;
   cx_values_t *values;
-  int values_len;
+  size_t values_len;
   char *instance_prefix;
   char *instance;
   int is_table;
   unsigned long magic;
 };
 typedef struct cx_xpath_s cx_xpath_t;
@@ -80,12 +81,13 @@
   _Bool verify_peer;
   _Bool verify_host;
   char *cacert;
   char *post_body;
   int timeout;
   struct curl_slist *headers;
+  curl_stats_t *stats;
 
   cx_namespace_t *namespaces;
   size_t namespaces_num;
 
   CURL *curl;
   char curl_errbuf[CURL_ERROR_SIZE];
@@ -111,20 +113,20 @@
   {
     ERROR ("curl_xml plugin: cx_curl_callback: "
            "user_data pointer is NULL.");
     return (0);
   }
 
-   if (len <= 0)
+  if (len == 0)
     return (len);
 
   if ((db->buffer_fill + len) >= db->buffer_size)
   {
     char *temp;
 
-    temp = (char *) realloc (db->buffer,
+    temp = realloc (db->buffer,
                     db->buffer_fill + len + 1);
     if (temp == NULL)
     {
       ERROR ("curl_xml plugin: realloc failed.");
       return (0);
     }
@@ -167,19 +169,17 @@
     cx_xpath_free (le->value);
 
     le = le_next;
   }
 
   llist_destroy (list);
-  list = NULL;
 } /* }}} void cx_list_free */
 
 static void cx_free (void *arg) /* {{{ */
 {
   cx_t *db;
-  size_t i;
 
   DEBUG ("curl_xml plugin: cx_free (arg = %p);", arg);
 
   db = (cx_t *) arg;
 
   if (db == NULL)
@@ -200,23 +200,31 @@
   sfree (db->user);
   sfree (db->pass);
   sfree (db->credentials);
   sfree (db->cacert);
   sfree (db->post_body);
   curl_slist_free_all (db->headers);
+  curl_stats_destroy (db->stats);
 
-  for (i = 0; i < db->namespaces_num; i++)
+  for (size_t i = 0; i < db->namespaces_num; i++)
   {
     sfree (db->namespaces[i].prefix);
     sfree (db->namespaces[i].url);
   }
   sfree (db->namespaces);
 
   sfree (db);
 } /* }}} void cx_free */
 
+static const char *cx_host (cx_t *db) /* {{{ */
+{
+  if (db->host == NULL)
+    return hostname_g;
+  return db->host;
+} /* }}} cx_host */
+
 static int cx_config_append_string (const char *name, struct curl_slist **dest, /* {{{ */
     oconfig_item_t *ci)
 {
   struct curl_slist *temp = NULL;
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -240,21 +248,21 @@
     WARNING ("curl_xml plugin: DataSet `%s' not defined.", xpath->type);
     return (-1);
   }
 
   if (ds->ds_num != xpath->values_len)
   {
-    WARNING ("curl_xml plugin: DataSet `%s' requires %i values, but config talks about %i",
+    WARNING ("curl_xml plugin: DataSet `%s' requires %zu values, but config talks about %zu",
         xpath->type, ds->ds_num, xpath->values_len);
     return (-1);
   }
 
   return (0);
 } /* }}} cx_check_type */
 
-static xmlXPathObjectPtr cx_evaluate_xpath (xmlXPathContextPtr xpath_ctx, /* {{{ */ 
+static xmlXPathObjectPtr cx_evaluate_xpath (xmlXPathContextPtr xpath_ctx, /* {{{ */
            xmlChar *expr)
 {
   xmlXPathObjectPtr xpath_obj;
 
   /* XXX: When to free this? */
   xpath_obj = xmlXPathEvalExpression(BAD_CAST expr, xpath_ctx);
@@ -315,13 +323,13 @@
 
   /* ignoring the element if other than textnode/attribute*/
   if (cx_if_not_text_node(values_node->nodeTab[0]))
   {
     WARNING ("curl_xml plugin: "
         "relative xpath expression \"%s\" is expected to return "
-        "only text/attribute node which is not the case. Skipping...", 
+        "only text/attribute node which is not the case. Skipping...",
         xpath->values[index].path);
     xmlXPathFreeObject (values_node_obj);
     return (-1);
   }
 
   node_value = (char *) xmlNodeGetContent(values_node->nodeTab[0]);
@@ -336,13 +344,13 @@
           /* endptr = */ NULL, /* base = */ 0);
       break;
     case DS_TYPE_ABSOLUTE:
       vl->values[index].absolute = (absolute_t) strtoull (node_value,
           /* endptr = */ NULL, /* base = */ 0);
       break;
-    case DS_TYPE_GAUGE: 
+    case DS_TYPE_GAUGE:
       vl->values[index].gauge = (gauge_t) strtod (node_value,
           /* endptr = */ NULL);
   }
 
   /* free up object */
   xmlXPathFreeObject (values_node_obj);
@@ -356,20 +364,19 @@
 static int cx_handle_all_value_xpaths (xmlXPathContextPtr xpath_ctx, /* {{{ */
     cx_xpath_t *xpath,
     const data_set_t *ds, value_list_t *vl)
 {
   value_t values[xpath->values_len];
   int status;
-  int i;
 
   assert (xpath->values_len > 0);
   assert (xpath->values_len == vl->values_len);
   assert (xpath->values_len == ds->ds_num);
   vl->values = values;
 
-  for (i = 0; i < xpath->values_len; i++)
+  for (size_t i = 0; i < xpath->values_len; i++)
   {
     status = cx_handle_single_value_xpath (xpath_ctx, xpath, ds, vl, i);
     if (status != 0)
       return (-1); /* An error has been printed. */
   } /* for (i = 0; i < xpath->values_len; i++) */
 
@@ -472,24 +479,23 @@
 
   return (0);
 } /* }}} int cx_handle_instance_xpath */
 
 static int  cx_handle_base_xpath (char const *plugin_instance, /* {{{ */
     char const *host,
-    xmlXPathContextPtr xpath_ctx, const data_set_t *ds, 
+    xmlXPathContextPtr xpath_ctx, const data_set_t *ds,
     char *base_xpath, cx_xpath_t *xpath)
 {
   int total_nodes;
-  int i;
 
   xmlXPathObjectPtr base_node_obj = NULL;
   xmlNodeSetPtr base_nodes = NULL;
 
   value_list_t vl = VALUE_LIST_INIT;
 
-  base_node_obj = cx_evaluate_xpath (xpath_ctx, BAD_CAST base_xpath); 
+  base_node_obj = cx_evaluate_xpath (xpath_ctx, BAD_CAST base_xpath);
   if (base_node_obj == NULL)
     return -1; /* error is logged already */
 
   base_nodes = base_node_obj->nodesetval;
   total_nodes = (base_nodes) ? base_nodes->nodeNr : 0;
 
@@ -500,30 +506,30 @@
               "Skipping the xpath block...", base_xpath);
      xmlXPathFreeObject (base_node_obj);
      return -1;
   }
 
   /* If base_xpath returned multiple results, then */
-  /* Instance in the xpath block is required */ 
+  /* Instance in the xpath block is required */
   if (total_nodes > 1 && xpath->instance == NULL)
   {
     ERROR ("curl_xml plugin: "
              "InstanceFrom is must in xpath block since the base xpath expression \"%s\" "
              "returned multiple results. Skipping the xpath block...", base_xpath);
     return -1;
   }
 
   /* set the values for the value_list */
   vl.values_len = ds->ds_num;
   sstrncpy (vl.type, xpath->type, sizeof (vl.type));
   sstrncpy (vl.plugin, "curl_xml", sizeof (vl.plugin));
-  sstrncpy (vl.host, (host != NULL) ? host : hostname_g, sizeof (vl.host));
+  sstrncpy (vl.host, host, sizeof (vl.host));
   if (plugin_instance != NULL)
-    sstrncpy (vl.plugin_instance, plugin_instance, sizeof (vl.plugin_instance)); 
+    sstrncpy (vl.plugin_instance, plugin_instance, sizeof (vl.plugin_instance));
 
-  for (i = 0; i < total_nodes; i++)
+  for (int i = 0; i < total_nodes; i++)
   {
     int status;
 
     xpath_ctx->node = base_nodes->nodeTab[i];
 
     status = cx_handle_instance_xpath (xpath_ctx, xpath, &vl,
@@ -534,35 +540,35 @@
     status = cx_handle_all_value_xpaths (xpath_ctx, xpath, ds, &vl);
     if (status != 0)
       continue; /* An error has been logged. */
   } /* for (i = 0; i < total_nodes; i++) */
 
   /* free up the allocated memory */
-  xmlXPathFreeObject (base_node_obj); 
+  xmlXPathFreeObject (base_node_obj);
 
-  return (0); 
+  return (0);
 } /* }}} cx_handle_base_xpath */
 
-static int cx_handle_parsed_xml(xmlDocPtr doc, /* {{{ */ 
+static int cx_handle_parsed_xml(xmlDocPtr doc, /* {{{ */
                        xmlXPathContextPtr xpath_ctx, cx_t *db)
 {
   llentry_t *le;
   const data_set_t *ds;
   cx_xpath_t *xpath;
   int status=-1;
-  
+
 
   le = llist_head (db->list);
   while (le != NULL)
   {
     /* get the ds */
     xpath = (cx_xpath_t *) le->value;
     ds = plugin_get_ds (xpath->type);
 
     if ( (cx_check_type(ds, xpath) == 0) &&
-         (cx_handle_base_xpath(db->instance, db->host,
+         (cx_handle_base_xpath(db->instance, cx_host (db),
                                xpath_ctx, ds, le->key, xpath) == 0) )
       status = 0; /* we got atleast one success */
 
     le = le->next;
   } /* while (le != NULL) */
 
@@ -571,13 +577,12 @@
 
 static int cx_parse_stats_xml(xmlChar* xml, cx_t *db) /* {{{ */
 {
   int status;
   xmlDocPtr doc;
   xmlXPathContextPtr xpath_ctx;
-  size_t i;
 
   /* Load the XML */
   doc = xmlParseDoc(xml);
   if (doc == NULL)
   {
     ERROR ("curl_xml plugin: Failed to parse the xml document  - %s", xml);
@@ -589,13 +594,13 @@
   {
     ERROR ("curl_xml plugin: Failed to create the xml context");
     xmlFreeDoc(doc);
     return (-1);
   }
 
-  for (i = 0; i < db->namespaces_num; i++)
+  for (size_t i = 0; i < db->namespaces_num; i++)
   {
     cx_namespace_t const *ns = db->namespaces + i;
     status = xmlXPathRegisterNs (xpath_ctx,
         BAD_CAST ns->prefix, BAD_CAST ns->url);
     if (status != 0)
     {
@@ -620,20 +625,22 @@
   int status;
   long rc;
   char *ptr;
   char *url;
   url = db->url;
 
-  db->buffer_fill = 0; 
+  db->buffer_fill = 0;
   status = curl_easy_perform (curl);
   if (status != CURLE_OK)
   {
     ERROR ("curl_xml plugin: curl_easy_perform failed with status %i: %s (%s)",
            status, db->curl_errbuf, url);
     return (-1);
   }
+  if (db->stats != NULL)
+    curl_stats_dispatch (db->stats, db->curl, cx_host (db), "curl_xml", db->instance);
 
   curl_easy_getinfo(curl, CURLINFO_EFFECTIVE_URL, &url);
   curl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE, &rc);
 
   /* The response code is zero if a non-HTTP transport was used. */
   if ((rc != 0) && (rc != 200))
@@ -668,37 +675,35 @@
 
 /* Configuration handling functions {{{ */
 
 static int cx_config_add_values (const char *name, cx_xpath_t *xpath, /* {{{ */
                                       oconfig_item_t *ci)
 {
-  int i;
-
   if (ci->values_num < 1)
   {
     WARNING ("curl_xml plugin: `ValuesFrom' needs at least one argument.");
     return (-1);
   }
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("curl_xml plugin: `ValuesFrom' needs only string argument.");
       return (-1);
     }
 
   sfree (xpath->values);
 
   xpath->values_len = 0;
-  xpath->values = (cx_values_t *) malloc (sizeof (cx_values_t) * ci->values_num);
+  xpath->values = malloc (sizeof (cx_values_t) * ci->values_num);
   if (xpath->values == NULL)
     return (-1);
-  xpath->values_len = ci->values_num;
+  xpath->values_len = (size_t) ci->values_num;
 
   /* populate cx_values_t structure */
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     xpath->values[i].path_len = sizeof (ci->values[i].value.string);
     sstrncpy (xpath->values[i].path, ci->values[i].value.string, sizeof (xpath->values[i].path));
   }
 
   return (0);
@@ -707,21 +712,19 @@
 static int cx_config_add_xpath (cx_t *db, oconfig_item_t *ci) /* {{{ */
 {
   cx_xpath_t *xpath;
   char *name;
   llentry_t *le;
   int status;
-  int i;
 
-  xpath = malloc (sizeof (*xpath));
+  xpath = calloc (1, sizeof (*xpath));
   if (xpath == NULL)
   {
-    ERROR ("curl_xml plugin: malloc failed.");
+    ERROR ("curl_xml plugin: calloc failed.");
     return (-1);
   }
-  memset (xpath, 0, sizeof (*xpath));
 
   status = cf_util_get_string (ci, &xpath->path);
   if (status != 0)
   {
     cx_xpath_free (xpath);
     return (status);
@@ -734,13 +737,13 @@
            "xpath value can't be an empty string");
     cx_xpath_free (xpath);
     return (-1);
   }
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Type", child->key) == 0)
       status = cf_util_get_string (child, &xpath->type);
     else if (strcasecmp ("InstancePrefix", child->key) == 0)
@@ -873,13 +876,13 @@
     size_t credentials_size;
 
     credentials_size = strlen (db->user) + 2;
     if (db->pass != NULL)
       credentials_size += strlen (db->pass);
 
-    db->credentials = (char *) malloc (credentials_size);
+    db->credentials = malloc (credentials_size);
     if (db->credentials == NULL)
     {
       ERROR ("curl_xml plugin: malloc failed.");
       return (-1);
     }
 
@@ -903,40 +906,37 @@
     curl_easy_setopt (db->curl, CURLOPT_POSTFIELDS, db->post_body);
 
 #ifdef HAVE_CURLOPT_TIMEOUT_MS
   if (db->timeout >= 0)
     curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS, (long) db->timeout);
   else
-    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS,
-       CDTIME_T_TO_MS(plugin_get_interval()));
+    curl_easy_setopt (db->curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
 #endif
 
   return (0);
 } /* }}} int cx_init_curl */
 
 static int cx_config_add_url (oconfig_item_t *ci) /* {{{ */
 {
   cx_t *db;
   int status = 0;
-  int i;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("curl_xml plugin: The `URL' block "
              "needs exactly one string argument.");
     return (-1);
   }
 
-  db = (cx_t *) malloc (sizeof (*db));
+  db = calloc (1, sizeof (*db));
   if (db == NULL)
   {
-    ERROR ("curl_xml plugin: malloc failed.");
+    ERROR ("curl_xml plugin: calloc failed.");
     return (-1);
   }
-  memset (db, 0, sizeof (*db));
 
   db->timeout = -1;
 
   if (strcasecmp ("URL", ci->key) == 0)
   {
     status = cf_util_get_string (ci, &db->url);
@@ -952,13 +952,13 @@
            "Invalid key: %s", ci->key);
     cx_free (db);
     return (-1);
   }
 
   /* Fill the `cx_t' structure.. */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Instance", child->key) == 0)
       status = cf_util_get_string (child, &db->instance);
     else if (strcasecmp ("Host", child->key) == 0)
@@ -982,12 +982,18 @@
     else if (strcasecmp ("Post", child->key) == 0)
       status = cf_util_get_string (child, &db->post_body);
     else if (strcasecmp ("Namespace", child->key) == 0)
       status = cx_config_add_namespace (db, child);
     else if (strcasecmp ("Timeout", child->key) == 0)
       status = cf_util_get_int (child, &db->timeout);
+    else if (strcasecmp ("Statistics", child->key) == 0)
+    {
+      db->stats = curl_stats_from_config (child);
+      if (db->stats == NULL)
+        status = -1;
+    }
     else
     {
       WARNING ("curl_xml plugin: Option `%s' not allowed here.", child->key);
       status = -1;
     }
 
@@ -1007,28 +1013,29 @@
       status = cx_init_curl (db);
   }
 
   /* If all went well, register this database for reading */
   if (status == 0)
   {
-    user_data_t ud;
     char *cb_name;
 
     if (db->instance == NULL)
       db->instance = strdup("default");
 
     DEBUG ("curl_xml plugin: Registering new read callback: %s",
            db->instance);
 
-    memset (&ud, 0, sizeof (ud));
-    ud.data = (void *) db;
-    ud.free_func = cx_free;
-
     cb_name = ssnprintf_alloc ("curl_xml-%s-%s", db->instance, db->url);
+
+    user_data_t ud = {
+      .data = db,
+      .free_func = cx_free
+    };
+
     plugin_register_complex_read (/* group = */ "curl_xml", cb_name, cx_read,
-                                  /* interval = */ NULL, &ud);
+                                  /* interval = */ 0, &ud);
     sfree (cb_name);
   }
   else
   {
     cx_free (db);
     return (-1);
@@ -1041,18 +1048,17 @@
 
 static int cx_config (oconfig_item_t *ci) /* {{{ */
 {
   int success;
   int errors;
   int status;
-  int i;
 
   success = 0;
   errors = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("URL", child->key) == 0)
     {
       status = cx_config_add_url (child);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/collectd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/collectd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/collectd.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/collectd.c	2016-09-11 16:10:25.255038733 +0800
@@ -23,24 +23,21 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Alvaro Barcellos <alvaro.barcellos at gmail.com>
  **/
 
 #include "collectd.h"
-#include "common.h"
 
+#include "common.h"
 #include "plugin.h"
 #include "configfile.h"
 
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <sys/un.h>
 #include <netdb.h>
 
-#include <pthread.h>
-
 #if HAVE_LOCALE_H
 # include <locale.h>
 #endif
 
 #if HAVE_STATGRAB_H
 # include <statgrab.h>
@@ -52,13 +49,12 @@
 
 /*
  * Global variables
  */
 char hostname_g[DATA_MAX_NAME_LEN];
 cdtime_t interval_g;
-int  pidfile_from_cli = 0;
 int  timeout_g;
 #if HAVE_LIBKSTAT
 kstat_ctl_t *kc;
 #endif /* HAVE_LIBKSTAT */
 
 static int loop = 0;
@@ -98,15 +94,13 @@
 }
 
 static int init_hostname (void)
 {
 	const char *str;
 
-	struct addrinfo  ai_hints;
 	struct addrinfo *ai_list;
-	struct addrinfo *ai_ptr;
 	int status;
 
 	str = global_option_get ("Hostname");
 	if (str != NULL)
 	{
 		sstrncpy (hostname_g, str, sizeof (hostname_g));
@@ -121,27 +115,28 @@
 	}
 
 	str = global_option_get ("FQDNLookup");
 	if (IS_FALSE (str))
 		return (0);
 
-	memset (&ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_flags = AI_CANONNAME;
+	struct addrinfo ai_hints = {
+		.ai_flags = AI_CANONNAME
+	};
 
 	status = getaddrinfo (hostname_g, NULL, &ai_hints, &ai_list);
 	if (status != 0)
 	{
 		ERROR ("Looking up \"%s\" failed. You have set the "
 				"\"FQDNLookup\" option, but I cannot resolve "
 				"my hostname to a fully qualified domain "
 				"name. Please fix the network "
 				"configuration.", hostname_g);
 		return (-1);
 	}
 
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		if (ai_ptr->ai_canonname == NULL)
 			continue;
 
 		sstrncpy (hostname_g, ai_ptr->ai_canonname, sizeof (hostname_g));
 		break;
@@ -194,13 +189,13 @@
 	}
 
 	dirlen = strlen (dir);
 	while ((dirlen > 0) && (dir[dirlen - 1] == '/'))
 		dir[--dirlen] = '\0';
 
-	if (dirlen <= 0) {
+	if (dirlen == 0) {
 		free (dir);
 		return (-1);
 	}
 
 	status = chdir (dir);
 	if (status == 0)
@@ -267,12 +262,13 @@
 } /* static void update_kstat (void) */
 #endif /* HAVE_LIBKSTAT */
 
 /* TODO
  * Remove all settings but `-f' and `-C'
  */
+__attribute__((noreturn))
 static void exit_usage (int status)
 {
 	printf ("Usage: "PACKAGE_NAME" [OPTIONS]\n\n"
 
 			"Available options:\n"
 			"  General:\n"
@@ -329,15 +325,13 @@
 	{
 		ERROR ("sg_drop_privileges: %s", sg_str_error (sg_get_error ()));
 		return (-1);
 	}
 #endif
 
-	plugin_init_all ();
-
-	return (0);
+	return plugin_init_all ();
 } /* int do_init () */
 
 
 static int do_loop (void)
 {
 	cdtime_t interval = cf_get_default_interval ();
@@ -385,14 +379,13 @@
 
 	return (0);
 } /* int do_loop */
 
 static int do_shutdown (void)
 {
-	plugin_shutdown_all ();
-	return (0);
+	return plugin_shutdown_all ();
 } /* int do_shutdown */
 
 #if COLLECT_DAEMON
 static int pidfile_create (void)
 {
 	FILE *fh;
@@ -422,89 +415,106 @@
 } /* static int pidfile_remove (const char *file) */
 #endif /* COLLECT_DAEMON */
 
 #ifdef KERNEL_LINUX
 static int notify_upstart (void)
 {
-    const char  *upstart_job = getenv("UPSTART_JOB");
+    char const *upstart_job = getenv("UPSTART_JOB");
 
     if (upstart_job == NULL)
         return 0;
 
     if (strcmp(upstart_job, "collectd") != 0)
+    {
+        WARNING ("Environment specifies unexpected UPSTART_JOB=\"%s\", expected \"collectd\". Ignoring the variable.", upstart_job);
         return 0;
+    }
 
-    WARNING ("supervised by upstart, will stop to signal readyness");
+    NOTICE("Upstart detected, stopping now to signal readyness.");
     raise(SIGSTOP);
     unsetenv("UPSTART_JOB");
 
     return 1;
 }
 
 static int notify_systemd (void)
 {
-    int                  fd = -1;
-    const char          *notifysocket = getenv("NOTIFY_SOCKET");
-    struct sockaddr_un   su;
-    struct iovec         iov;
-    struct msghdr        hdr;
+    int                  fd;
+    const char          *notifysocket;
+    struct sockaddr_un   su = { 0 };
+    size_t               su_size;
+    char                 buffer[] = "READY=1\n";
 
+    notifysocket = getenv ("NOTIFY_SOCKET");
     if (notifysocket == NULL)
         return 0;
 
-    if ((strchr("@/", notifysocket[0])) == NULL ||
-        strlen(notifysocket) < 2)
+    if ((strlen (notifysocket) < 2)
+        || ((notifysocket[0] != '@') && (notifysocket[0] != '/')))
+    {
+        ERROR ("invalid notification socket NOTIFY_SOCKET=\"%s\": path must be absolute", notifysocket);
         return 0;
+    }
+    NOTICE ("Systemd detected, trying to signal readyness.");
+
+    unsetenv ("NOTIFY_SOCKET");
 
-    WARNING ("supervised by systemd, will signal readyness");
-    if ((fd = socket(AF_UNIX, SOCK_DGRAM, 0)) < 0) {
-        WARNING ("cannot contact systemd socket %s", notifysocket);
+#if defined(SOCK_CLOEXEC)
+    fd = socket (AF_UNIX, SOCK_DGRAM|SOCK_CLOEXEC, /* protocol = */ 0);
+#else
+    fd = socket (AF_UNIX, SOCK_DGRAM, /* protocol = */ 0);
+#endif
+    if (fd < 0) {
+        char errbuf[1024];
+        ERROR ("creating UNIX socket failed: %s",
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
         return 0;
     }
 
-    bzero(&su, sizeof(su));
     su.sun_family = AF_UNIX;
-    sstrncpy (su.sun_path, notifysocket, sizeof(su.sun_path));
-
-    if (notifysocket[0] == '@')
+    if (notifysocket[0] != '@')
+    {
+        /* regular UNIX socket */
+        sstrncpy (su.sun_path, notifysocket, sizeof (su.sun_path));
+        su_size = sizeof (su);
+    }
+    else
+    {
+        /* Linux abstract namespace socket: specify address as "\0foo", i.e.
+         * start with a null byte. Since null bytes have no special meaning in
+         * that case, we have to set su_size correctly to cover only the bytes
+         * that are part of the address. */
+        sstrncpy (su.sun_path, notifysocket, sizeof (su.sun_path));
         su.sun_path[0] = 0;
+        su_size = sizeof (sa_family_t) + strlen (notifysocket);
+        if (su_size > sizeof (su))
+            su_size = sizeof (su);
+    }
 
-    bzero(&iov, sizeof(iov));
-    iov.iov_base = "READY=1";
-    iov.iov_len = strlen("READY=1");
-
-    bzero(&hdr, sizeof(hdr));
-    hdr.msg_name = &su;
-    hdr.msg_namelen = offsetof(struct sockaddr_un, sun_path) +
-        strlen(notifysocket);
-    hdr.msg_iov = &iov;
-    hdr.msg_iovlen = 1;
-
-    unsetenv("NOTIFY_SOCKET");
-    if (sendmsg(fd, &hdr, MSG_NOSIGNAL) < 0) {
-        WARNING ("cannot send notification to systemd");
+    if (sendto (fd, buffer, strlen (buffer), MSG_NOSIGNAL, (void *) &su, (socklen_t) su_size) < 0)
+    {
+        char errbuf[1024];
+        ERROR ("sendto(\"%s\") failed: %s", notifysocket,
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
         close(fd);
         return 0;
     }
+
+    unsetenv ("NOTIFY_SOCKET");
     close(fd);
     return 1;
 }
 #endif /* KERNEL_LINUX */
 
 int main (int argc, char **argv)
 {
-	struct sigaction sig_int_action;
-	struct sigaction sig_term_action;
-	struct sigaction sig_usr1_action;
-	struct sigaction sig_pipe_action;
-	char *configfile = CONFIGFILE;
+	const char *configfile = CONFIGFILE;
 	int test_config  = 0;
 	int test_readall = 0;
 	const char *basedir;
 #if COLLECT_DAEMON
-	struct sigaction sig_chld_action;
 	pid_t pid;
 	int daemonize    = 1;
 #endif
 	int exit_status = 0;
 
 	/* read options */
@@ -528,21 +538,20 @@
 				break;
 			case 't':
 				test_config = 1;
 				break;
 			case 'T':
 				test_readall = 1;
-				global_option_set ("ReadThreads", "-1");
+				global_option_set ("ReadThreads", "-1", 1);
 #if COLLECT_DAEMON
 				daemonize = 0;
 #endif /* COLLECT_DAEMON */
 				break;
 #if COLLECT_DAEMON
 			case 'P':
-				global_option_set ("PIDFile", optarg);
-				pidfile_from_cli = 1;
+				global_option_set ("PIDFile", optarg, 1);
 				break;
 			case 'f':
 				daemonize = 0;
 				break;
 #endif /* COLLECT_DAEMON */
 			case 'h':
@@ -599,26 +608,30 @@
 		return (0);
 
 #if COLLECT_DAEMON
 	/*
 	 * fork off child
 	 */
-	memset (&sig_chld_action, '\0', sizeof (sig_chld_action));
-	sig_chld_action.sa_handler = SIG_IGN;
+	struct sigaction sig_chld_action = {
+		.sa_handler = SIG_IGN
+	};
+
 	sigaction (SIGCHLD, &sig_chld_action, NULL);
 
     /*
      * Only daemonize if we're not being supervised
      * by upstart or systemd (when using Linux).
      */
 	if (daemonize
 #ifdef KERNEL_LINUX
 	    && notify_upstart() == 0 && notify_systemd() == 0
 #endif
 	)
 	{
+		int status;
+
 		if ((pid = fork ()) == -1)
 		{
 			/* error */
 			char errbuf[1024];
 			fprintf (stderr, "fork: %s",
 					sstrerror (errno, errbuf,
@@ -641,84 +654,108 @@
 
 		/* close standard descriptors */
 		close (2);
 		close (1);
 		close (0);
 
-		if (open ("/dev/null", O_RDWR) != 0)
+		status = open ("/dev/null", O_RDWR);
+		if (status != 0)
 		{
-			ERROR ("Error: Could not connect `STDIN' to `/dev/null'");
+			ERROR ("Error: Could not connect `STDIN' to `/dev/null' (status %d)", status);
 			return (1);
 		}
-		if (dup (0) != 1)
+
+		status = dup (0);
+		if (status != 1)
 		{
-			ERROR ("Error: Could not connect `STDOUT' to `/dev/null'");
+			ERROR ("Error: Could not connect `STDOUT' to `/dev/null' (status %d)", status);
 			return (1);
 		}
-		if (dup (0) != 2)
+
+		status = dup (0);
+		if (status != 2)
 		{
-			ERROR ("Error: Could not connect `STDERR' to `/dev/null'");
+			ERROR ("Error: Could not connect `STDERR' to `/dev/null', (status %d)", status);
 			return (1);
 		}
 	} /* if (daemonize) */
 #endif /* COLLECT_DAEMON */
 
-	memset (&sig_pipe_action, '\0', sizeof (sig_pipe_action));
-	sig_pipe_action.sa_handler = SIG_IGN;
+	struct sigaction sig_pipe_action = {
+		.sa_handler = SIG_IGN
+	};
+
 	sigaction (SIGPIPE, &sig_pipe_action, NULL);
 
 	/*
 	 * install signal handlers
 	 */
-	memset (&sig_int_action, '\0', sizeof (sig_int_action));
-	sig_int_action.sa_handler = sig_int_handler;
+	struct sigaction sig_int_action = {
+		.sa_handler = sig_int_handler
+	};
+
 	if (0 != sigaction (SIGINT, &sig_int_action, NULL)) {
 		char errbuf[1024];
 		ERROR ("Error: Failed to install a signal handler for signal INT: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (1);
 	}
 
-	memset (&sig_term_action, '\0', sizeof (sig_term_action));
-	sig_term_action.sa_handler = sig_term_handler;
+	struct sigaction sig_term_action = {
+		.sa_handler = sig_term_handler
+	};
+
 	if (0 != sigaction (SIGTERM, &sig_term_action, NULL)) {
 		char errbuf[1024];
 		ERROR ("Error: Failed to install a signal handler for signal TERM: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (1);
 	}
 
-	memset (&sig_usr1_action, '\0', sizeof (sig_usr1_action));
-	sig_usr1_action.sa_handler = sig_usr1_handler;
+	struct sigaction sig_usr1_action = {
+		.sa_handler = sig_usr1_handler
+	};
+
 	if (0 != sigaction (SIGUSR1, &sig_usr1_action, NULL)) {
 		char errbuf[1024];
 		ERROR ("Error: Failed to install a signal handler for signal USR1: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (1);
 	}
 
 	/*
 	 * run the actual loops
 	 */
-	do_init ();
+	if (do_init () != 0)
+	{
+		ERROR ("Error: one or more plugin init callbacks failed.");
+		exit_status = 1;
+	}
 
 	if (test_readall)
 	{
 		if (plugin_read_all_once () != 0)
+		{
+			ERROR ("Error: one or more plugin read callbacks failed.");
 			exit_status = 1;
+		}
 	}
 	else
 	{
 		INFO ("Initialization complete, entering read-loop.");
 		do_loop ();
 	}
 
 	/* close syslog */
 	INFO ("Exiting normally.");
 
-	do_shutdown ();
+	if (do_shutdown () != 0)
+	{
+		ERROR ("Error: one or more plugin shutdown callbacks failed.");
+		exit_status = 1;
+	}
 
 #if COLLECT_DAEMON
 	if (daemonize)
 		pidfile_remove ();
 #endif /* COLLECT_DAEMON */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/collectd.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/collectd.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/collectd.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/collectd.h	2016-09-11 16:10:25.255038733 +0800
@@ -92,12 +92,15 @@
 # if HAVE_SYS_TIME_H
 #  include <sys/time.h>
 # else
 #  include <time.h>
 # endif
 #endif
+#if HAVE_SYS_SOCKET_H
+# include <sys/socket.h>
+#endif
 
 #if HAVE_ASSERT_H
 # include <assert.h>
 #else
 # define assert(...) /* nop */
 #endif
@@ -221,80 +224,74 @@
 
 #if HAVE_KSTAT_H
 # include <kstat.h>
 #endif
 
 #ifndef PACKAGE_NAME
-#define PACKAGE_NAME "collectd"
+# define PACKAGE_NAME "collectd"
 #endif
 
 #ifndef PREFIX
-#define PREFIX "/opt/" PACKAGE_NAME
+# define PREFIX "/opt/" PACKAGE_NAME
 #endif
 
 #ifndef SYSCONFDIR
-#define SYSCONFDIR PREFIX "/etc"
+# define SYSCONFDIR PREFIX "/etc"
 #endif
 
 #ifndef CONFIGFILE
-#define CONFIGFILE SYSCONFDIR"/collectd.conf"
+# define CONFIGFILE SYSCONFDIR"/collectd.conf"
 #endif
 
 #ifndef LOCALSTATEDIR
-#define LOCALSTATEDIR PREFIX "/var"
+# define LOCALSTATEDIR PREFIX "/var"
 #endif
 
 #ifndef PKGLOCALSTATEDIR
-#define PKGLOCALSTATEDIR PREFIX "/var/lib/" PACKAGE_NAME
+# define PKGLOCALSTATEDIR PREFIX "/var/lib/" PACKAGE_NAME
 #endif
 
 #ifndef PIDFILE
-#define PIDFILE PREFIX "/var/run/" PACKAGE_NAME ".pid"
+# define PIDFILE PREFIX "/var/run/" PACKAGE_NAME ".pid"
 #endif
 
 #ifndef PLUGINDIR
-#define PLUGINDIR PREFIX "/lib/" PACKAGE_NAME
+# define PLUGINDIR PREFIX "/lib/" PACKAGE_NAME
 #endif
 
 #ifndef PKGDATADIR
-#define PKGDATADIR PREFIX "/share/" PACKAGE_NAME
+# define PKGDATADIR PREFIX "/share/" PACKAGE_NAME
 #endif
 
 #ifndef COLLECTD_GRP_NAME
 # define COLLECTD_GRP_NAME "collectd"
 #endif
 
 #ifndef COLLECTD_DEFAULT_INTERVAL
 # define COLLECTD_DEFAULT_INTERVAL 10.0
 #endif
 
- #ifndef COLLECTD_USERAGENT
- # define COLLECTD_USERAGENT PACKAGE_NAME"/"PACKAGE_VERSION
- #endif
+#ifndef COLLECTD_USERAGENT
+# define COLLECTD_USERAGENT PACKAGE_NAME "/" PACKAGE_VERSION
+#endif
 
 /* Only enable __attribute__() for compilers known to support it. */
-#if defined(__clang__)
-# define clang_attr(x) __attribute__(x)
-# define gcc_attr(x) /**/
-#elif __GNUC__
-# define clang_attr(x) /**/
-# define gcc_attr(x) __attribute__(x)
-#else
-# define clang_attr(x) /**/
-# define gcc_attr(x) /**/
-# define __attribute__(x) /**/
+#if !defined(__clang__) && !defined(__GNUC__)
+# if !defined(__attribute__)
+#  define __attribute__(x) /**/
+# endif
 #endif
 
 #if defined(COLLECT_DEBUG) && COLLECT_DEBUG && defined(__GNUC__) && __GNUC__
 # undef strcpy
 # undef strcat
 # undef strtok
 # pragma GCC poison strcpy strcat strtok
 #endif
 
-/* 
+/*
  * Special hack for the perl plugin: Because the later included perl.h defines
  * a macro which is never used, but contains `sprintf', we cannot poison that
  * identifies just yet. The parl plugin will do that itself once perl.h is
  * included.
  */
 #ifndef DONT_POISON_SPRINTF_YET
@@ -310,10 +307,9 @@
 
 /* Type for time as used by "utils_time.h" */
 typedef uint64_t cdtime_t;
 
 extern char     hostname_g[];
 extern cdtime_t interval_g;
-extern int      pidfile_from_cli;
 extern int      timeout_g;
 
 #endif /* COLLECTD_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common.c	2016-09-11 16:10:25.259038726 +0800
@@ -29,47 +29,46 @@
 
 #if HAVE_CONFIG_H
 # include "config.h"
 #endif
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 #include "utils_cache.h"
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
-
 #ifdef HAVE_MATH_H
 # include <math.h>
 #endif
 
 /* for getaddrinfo */
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <netdb.h>
 
 #include <poll.h>
 
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
 
+#if HAVE_NETINET_TCP_H
+# include <netinet/tcp.h>
+#endif
+
 /* for ntohl and htonl */
 #if HAVE_ARPA_INET_H
 # include <arpa/inet.h>
 #endif
 
-#ifdef HAVE_LIBKSTAT
-extern kstat_ctl_t *kc;
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
 #endif
 
-/* AIX doesn't have MSG_DONTWAIT */
-#ifndef MSG_DONTWAIT
-#  define MSG_DONTWAIT MSG_NONBLOCK
+#ifdef HAVE_LIBKSTAT
+extern kstat_ctl_t *kc;
 #endif
 
 #if !HAVE_GETPWNAM_R
 static pthread_mutex_t getpwnam_r_lock = PTHREAD_MUTEX_INITIALIZER;
 #endif
 
@@ -118,16 +117,15 @@
 	/* "status" does not include the null byte. */
 	alloc_buffer_size = (size_t) (status + 1);
 	if (alloc_buffer_size <= sizeof (static_buffer))
 		return (strdup (static_buffer));
 
 	/* Allocate a buffer large enough to hold the string. */
-	alloc_buffer = malloc (alloc_buffer_size);
+	alloc_buffer = calloc (1, alloc_buffer_size);
 	if (alloc_buffer == NULL)
 		return (NULL);
-	memset (alloc_buffer, 0, alloc_buffer_size);
 
 	/* Print again into this new buffer. */
 	va_start (ap, format);
 	status = vsnprintf (alloc_buffer, alloc_buffer_size, format, ap);
 	va_end (ap);
 	if (status < 0)
@@ -147,13 +145,13 @@
 	if (s == NULL)
 		return (NULL);
 
 	/* Do not use `strdup' here, because it's not specified in POSIX. It's
 	 * ``only'' an XSI extension. */
 	sz = strlen (s) + 1;
-	r = (char *) malloc (sizeof (char) * sz);
+	r = malloc (sz);
 	if (r == NULL)
 	{
 		ERROR ("sstrdup: Out of memory.");
 		exit (3);
 	}
 	memcpy (r, s, sizeof (char) * sz);
@@ -261,14 +259,14 @@
 			close (fd);
 			return (-1);
 		}
 
 		assert ((0 > status) || (nleft >= (size_t)status));
 
-		nleft = nleft - status;
-		ptr   = ptr   + status;
+		nleft = nleft - ((size_t) status);
+		ptr   = ptr   + ((size_t) status);
 	}
 
 	return (0);
 }
 
 
@@ -279,12 +277,15 @@
 	ssize_t     status;
 	struct      pollfd pfd;
 
 	ptr   = (const char *) buf;
 	nleft = count;
 	
+	if (fd < 0)
+		return (-1);
+
 	/* checking for closed peer connection */
 	pfd.fd = fd;
 	pfd.events = POLLIN | POLLHUP;
 	pfd.revents = 0;
 	if (poll(&pfd, 1, 0) > 0) {
 		char buffer[32];
@@ -302,14 +303,14 @@
 		if ((status < 0) && ((errno == EAGAIN) || (errno == EINTR)))
 			continue;
 
 		if (status < 0)
 			return (status);
 
-		nleft = nleft - status;
-		ptr   = ptr   + status;
+		nleft = nleft - ((size_t) status);
+		ptr   = ptr   + ((size_t) status);
 	}
 
 	return (0);
 }
 
 int strsplit (char *string, char **fields, size_t size)
@@ -337,26 +338,25 @@
 		char **fields, size_t fields_num,
 		const char *sep)
 {
 	size_t avail;
 	char *ptr;
 	size_t sep_len;
-	size_t i;
 
-	if ((buffer_size < 1) || (fields_num <= 0))
+	if ((buffer_size < 1) || (fields_num == 0))
 		return (-1);
 
 	memset (buffer, 0, buffer_size);
 	ptr = buffer;
 	avail = buffer_size - 1;
 
 	sep_len = 0;
 	if (sep != NULL)
 		sep_len = strlen (sep);
 
-	for (i = 0; i < fields_num; i++)
+	for (size_t i = 0; i < fields_num; i++)
 	{
 		size_t field_len;
 
 		if ((i > 0) && (sep_len > 0))
 		{
 			if (avail < sep_len)
@@ -374,59 +374,36 @@
 		memcpy (ptr, fields[i], field_len);
 		ptr += field_len;
 		avail -= field_len;
 	}
 
 	assert (buffer[buffer_size - 1] == 0);
-	return (strlen (buffer));
+	return ((int) strlen (buffer));
 }
 
-int strsubstitute (char *str, char c_from, char c_to)
-{
-	int ret;
-
-	if (str == NULL)
-		return (-1);
-
-	ret = 0;
-	while (*str != '\0')
-	{
-		if (*str == c_from)
-		{
-			*str = c_to;
-			ret++;
-		}
-		str++;
-	}
-
-	return (ret);
-} /* int strsubstitute */
-
 int escape_string (char *buffer, size_t buffer_size)
 {
   char *temp;
-  size_t i;
   size_t j;
 
   /* Check if we need to escape at all first */
   temp = strpbrk (buffer, " \t\"\\");
   if (temp == NULL)
     return (0);
 
   if (buffer_size < 3)
     return (EINVAL);
 
-  temp = (char *) malloc (buffer_size);
+  temp = calloc (1, buffer_size);
   if (temp == NULL)
     return (ENOMEM);
-  memset (temp, 0, buffer_size);
 
   temp[0] = '"';
   j = 1;
 
-  for (i = 0; i < buffer_size; i++)
+  for (size_t i = 0; i < buffer_size; i++)
   {
     if (buffer[i] == 0)
     {
       break;
     }
     else if ((buffer[i] == '"') || (buffer[i] == '\\'))
@@ -454,15 +431,13 @@
   sfree (temp);
   return (0);
 } /* int escape_string */
 
 int strunescape (char *buf, size_t buf_len)
 {
-	size_t i;
-
-	for (i = 0; (i < buf_len) && (buf[i] != '\0'); ++i)
+	for (size_t i = 0; (i < buf_len) && (buf[i] != '\0'); ++i)
 	{
 		if (buf[i] != '\\')
 			continue;
 
 		if (((i + 1) >= buf_len) || (buf[i + 1] == 0)) {
 			ERROR ("string unescape: backslash found at end of string.");
@@ -509,13 +484,12 @@
 
 	return (buffer_len);
 } /* size_t strstripnewline */
 
 int escape_slashes (char *buffer, size_t buffer_size)
 {
-	int i;
 	size_t buffer_len;
 
 	buffer_len = strlen (buffer);
 
 	if (buffer_len <= 1)
 	{
@@ -532,26 +506,24 @@
 	if (buffer[0] == '/')
 	{
 		memmove (buffer, buffer + 1, buffer_len);
 		buffer_len--;
 	}
 
-	for (i = 0; i < buffer_len; i++)
+	for (size_t i = 0; i < buffer_len; i++)
 	{
 		if (buffer[i] == '/')
 			buffer[i] = '_';
 	}
 
 	return (0);
 } /* int escape_slashes */
 
 void replace_special (char *buffer, size_t buffer_size)
 {
-	size_t i;
-
-	for (i = 0; i < buffer_size; i++)
+	for (size_t i = 0; i < buffer_size; i++)
 	{
 		if (buffer[i] == 0)
 			return;
 		if ((!isalnum ((int) buffer[i])) && (buffer[i] != '-'))
 			buffer[i] = '_';
 	}
@@ -619,13 +591,12 @@
 	int   fields_num;
 	char *ptr;
 	char *saveptr;
 	int   last_is_file = 1;
 	int   path_is_absolute = 0;
 	size_t len;
-	int   i;
 
 	/*
 	 * Sanity checks first
 	 */
 	if (file_orig == NULL)
 		return (-1);
@@ -665,13 +636,13 @@
 			break;
 	}
 
 	/*
 	 * For each component, do..
 	 */
-	for (i = 0; i < (fields_num - last_is_file); i++)
+	for (int i = 0; i < (fields_num - last_is_file); i++)
 	{
 		/*
 		 * Do not create directories that start with a dot. This
 		 * prevents `../../' attacks and other likely malicious
 		 * behavior.
 		 */
@@ -683,14 +654,14 @@
 		}
 
 		/*
 		 * Join the components together again
 		 */
 		dir[0] = '/';
-		if (strjoin (dir + path_is_absolute, dir_len - path_is_absolute,
-					fields, i + 1, "/") < 0)
+		if (strjoin (dir + path_is_absolute, (size_t) (dir_len - path_is_absolute),
+					fields, (size_t) (i + 1), "/") < 0)
 		{
 			ERROR ("strjoin failed: `%s', component #%i", file_orig, i);
 			return (-1);
 		}
 
 		while (42) {
@@ -964,13 +935,12 @@
 int format_values (char *ret, size_t ret_len, /* {{{ */
 		const data_set_t *ds, const value_list_t *vl,
 		_Bool store_rates)
 {
         size_t offset = 0;
         int status;
-        int i;
         gauge_t *rates = NULL;
 
         assert (0 == strcmp (ds->type, vl->type));
 
         memset (ret, 0, ret_len);
 
@@ -990,13 +960,13 @@
         else \
                 offset += ((size_t) status); \
 } while (0)
 
         BUFFER_ADD ("%.3f", CDTIME_T_TO_DOUBLE (vl->time));
 
-        for (i = 0; i < ds->ds_num; i++)
+        for (size_t i = 0; i < ds->ds_num; i++)
         {
                 if (ds->ds[i].type == DS_TYPE_GAUGE)
                         BUFFER_ADD (":"GAUGE_FORMAT, vl->values[i].gauge);
                 else if (store_rates)
                 {
                         if (rates == NULL)
@@ -1151,13 +1121,13 @@
       sfree (value);
       ERROR ("parse_value: Invalid data source type: %i.", ds_type);
       return -1;
   }
 
   if (value == endptr) {
-    ERROR ("parse_value: Failed to parse string as %s: \"%s\".",
+    ERROR ("parse_value: Failed to parse string as %s: %s.",
         DS_TYPE_TO_STRING (ds_type), value);
     sfree (value);
     return -1;
   }
   else if ((NULL != endptr) && ('\0' != *endptr))
     INFO ("parse_value: Ignoring trailing garbage \"%s\" after %s value. "
@@ -1167,35 +1137,36 @@
   sfree (value);
   return 0;
 } /* int parse_value */
 
 int parse_values (char *buffer, value_list_t *vl, const data_set_t *ds)
 {
-	int i;
+	size_t i;
 	char *dummy;
 	char *ptr;
 	char *saveptr;
 
 	if ((buffer == NULL) || (vl == NULL) || (ds == NULL))
 		return EINVAL;
 
-	i = -1;
+	i = 0;
 	dummy = buffer;
 	saveptr = NULL;
+	vl->time = 0;
 	while ((ptr = strtok_r (dummy, ":", &saveptr)) != NULL)
 	{
 		dummy = NULL;
 
 		if (i >= vl->values_len)
 		{
 			/* Make sure i is invalid. */
-			i = vl->values_len + 1;
+			i = 0;
 			break;
 		}
 
-		if (i == -1)
+		if (vl->time == 0)
 		{
 			if (strcmp ("N", ptr) == 0)
 				vl->time = cdtime ();
 			else
 			{
 				char *endptr = NULL;
@@ -1208,25 +1179,25 @@
 						|| (endptr == NULL) /* This should not happen */
 						|| (*endptr != 0))  /* Trailing chars */
 					return (-1);
 
 				vl->time = DOUBLE_TO_CDTIME_T (tmp);
 			}
-		}
-		else
-		{
-			if ((strcmp ("U", ptr) == 0) && (ds->ds[i].type == DS_TYPE_GAUGE))
-				vl->values[i].gauge = NAN;
-			else if (0 != parse_value (ptr, &vl->values[i], ds->ds[i].type))
-				return -1;
+
+			continue;
 		}
 
+		if ((strcmp ("U", ptr) == 0) && (ds->ds[i].type == DS_TYPE_GAUGE))
+			vl->values[i].gauge = NAN;
+		else if (0 != parse_value (ptr, &vl->values[i], ds->ds[i].type))
+			return -1;
+
 		i++;
 	} /* while (strtok_r) */
 
-	if ((ptr != NULL) || (i != vl->values_len))
+	if ((ptr != NULL) || (i == 0))
 		return (-1);
 	return (0);
 } /* int parse_values */
 
 #if !HAVE_GETPWNAM_R
 int getpwnam_r (const char *name, struct passwd *pwbuf, char *buf,
@@ -1382,16 +1353,15 @@
 {
 	counter_t diff;
 
 	if (old_value > new_value)
 	{
 		if (old_value <= 4294967295U)
-			diff = (4294967295U - old_value) + new_value;
+			diff = (4294967295U - old_value) + new_value + 1;
 		else
-			diff = (18446744073709551615ULL - old_value)
-				+ new_value;
+			diff = (18446744073709551615ULL - old_value) + new_value + 1;
 	}
 	else
 	{
 		diff = new_value - old_value;
 	}
 
@@ -1490,101 +1460,87 @@
 
         state->last_time = t;
 	*ret_value = state->last_value;
 	return (0);
 } /* }}} value_t rate_to_value */
 
-int value_to_rate (value_t *ret_rate, derive_t value, /* {{{ */
-		value_to_rate_state_t *state,
-		int ds_type, cdtime_t t)
+int value_to_rate (gauge_t *ret_rate, /* {{{ */
+		value_t value, int ds_type, cdtime_t t, value_to_rate_state_t *state)
 {
-	double interval;
+	gauge_t interval;
 
 	/* Another invalid state: The time is not increasing. */
 	if (t <= state->last_time)
 	{
 		memset (state, 0, sizeof (*state));
 		return (EINVAL);
 	}
 
 	interval = CDTIME_T_TO_DOUBLE(t - state->last_time);
 
 	/* Previous value is invalid. */
-	if (state->last_time == 0) /* {{{ */
+	if (state->last_time == 0)
 	{
-		if (ds_type == DS_TYPE_DERIVE)
-		{
-			state->last_value.derive = value;
-		}
-		else if (ds_type == DS_TYPE_COUNTER)
-		{
-			state->last_value.counter = (counter_t) value;
-		}
-		else if (ds_type == DS_TYPE_ABSOLUTE)
-		{
-			state->last_value.absolute = (absolute_t) value;
-		}
-		else
-		{
-			assert (23 == 42);
-		}
-
+		state->last_value = value;
 		state->last_time = t;
 		return (EAGAIN);
-	} /* }}} */
-
-	if (ds_type == DS_TYPE_DERIVE)
-	{
-		ret_rate->gauge = (value - state->last_value.derive) / interval;
-		state->last_value.derive = value;
 	}
-	else if (ds_type == DS_TYPE_COUNTER)
-	{
-		ret_rate->gauge = (((counter_t)value) - state->last_value.counter) / interval;
-		state->last_value.counter = (counter_t) value;
-	}
-	else if (ds_type == DS_TYPE_ABSOLUTE)
-	{
-		ret_rate->gauge = (((absolute_t)value) - state->last_value.absolute) / interval;
-		state->last_value.absolute = (absolute_t) value;
+
+	switch (ds_type) {
+	case DS_TYPE_DERIVE: {
+		derive_t diff = value.derive - state->last_value.derive;
+		*ret_rate = ((gauge_t) diff) / ((gauge_t) interval);
+		break;
+	}
+	case DS_TYPE_GAUGE: {
+		*ret_rate = value.gauge;
+		break;
+	}
+	case DS_TYPE_COUNTER: {
+		counter_t diff = counter_diff (state->last_value.counter, value.counter);
+		*ret_rate = ((gauge_t) diff) / ((gauge_t) interval);
+		break;
+	}
+	case DS_TYPE_ABSOLUTE: {
+		absolute_t diff = value.absolute;
+		*ret_rate = ((gauge_t) diff) / ((gauge_t) interval);
+		break;
 	}
-	else
-	{
-		assert (23 == 42);
+	default:
+		return EINVAL;
 	}
 
+	state->last_value = value;
         state->last_time = t;
 	return (0);
 } /* }}} value_t rate_to_value */
 
 int service_name_to_port_number (const char *service_name)
 {
 	struct addrinfo *ai_list;
-	struct addrinfo *ai_ptr;
-	struct addrinfo ai_hints;
 	int status;
 	int service_number;
 
 	if (service_name == NULL)
 		return (-1);
 
-	ai_list = NULL;
-	memset (&ai_hints, 0, sizeof (ai_hints));
-	ai_hints.ai_family = AF_UNSPEC;
+	struct addrinfo ai_hints = {
+		.ai_family = AF_UNSPEC
+	};
 
 	status = getaddrinfo (/* node = */ NULL, service_name,
 			&ai_hints, &ai_list);
 	if (status != 0)
 	{
 		ERROR ("service_name_to_port_number: getaddrinfo failed: %s",
 				gai_strerror (status));
 		return (-1);
 	}
 
 	service_number = -1;
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		if (ai_ptr->ai_family == AF_INET)
 		{
 			struct sockaddr_in *sa;
 
 			sa = (void *) ai_ptr->ai_addr;
@@ -1606,12 +1562,52 @@
 
 	if ((service_number > 0) && (service_number <= 65535))
 		return (service_number);
 	return (-1);
 } /* int service_name_to_port_number */
 
+void set_sock_opts (int sockfd) /* {{{ */
+{
+	int status;
+	int socktype;
+
+	socklen_t socklen = sizeof (socklen_t);
+	int so_keepalive = 1;
+
+	status = getsockopt (sockfd, SOL_SOCKET, SO_TYPE, &socktype, &socklen);
+	if (status != 0)
+	{
+		WARNING ("set_sock_opts: failed to determine socket type");
+		return;
+	}
+
+	if (socktype == SOCK_STREAM)
+	{
+		status = setsockopt(sockfd, SOL_SOCKET, SO_KEEPALIVE,
+				&so_keepalive, sizeof (so_keepalive));
+		if (status != 0)
+			WARNING ("set_sock_opts: failed to set socket keepalive flag");
+
+#ifdef TCP_KEEPIDLE
+		int tcp_keepidle = ((CDTIME_T_TO_MS(plugin_get_interval()) - 1) / 100 + 1);
+		status = setsockopt(sockfd, IPPROTO_TCP, TCP_KEEPIDLE,
+				&tcp_keepidle, sizeof (tcp_keepidle));
+		if (status != 0)
+			WARNING ("set_sock_opts: failed to set socket tcp keepalive time");
+#endif
+
+#ifdef TCP_KEEPINTVL
+		int tcp_keepintvl = ((CDTIME_T_TO_MS(plugin_get_interval()) - 1) / 1000 + 1);
+		status = setsockopt(sockfd, IPPROTO_TCP, TCP_KEEPINTVL,
+				&tcp_keepintvl, sizeof (tcp_keepintvl));
+		if (status != 0)
+			WARNING ("set_sock_opts: failed to set socket tcp keepalive interval");
+#endif
+	}
+} /* }}} void set_sock_opts */
+
 int strtoderive (const char *string, derive_t *ret_value) /* {{{ */
 {
 	derive_t tmp;
 	char *endptr;
 
 	if ((string == NULL) || (ret_value == NULL))
@@ -1669,12 +1665,59 @@
         *ret_array_len = array_len;
 	return (0);
 } /* }}} int strarray_add */
 
 void strarray_free (char **array, size_t array_len) /* {{{ */
 {
-	size_t i;
-
-	for (i = 0; i < array_len; i++)
+	for (size_t i = 0; i < array_len; i++)
 		sfree (array[i]);
 	sfree (array);
 } /* }}} void strarray_free */
+
+#ifdef HAVE_SYS_CAPABILITY_H
+int check_capability (int capability) /* {{{ */
+{
+#ifdef _LINUX_CAPABILITY_VERSION_3
+	cap_user_header_t cap_header = calloc(1, sizeof (*cap_header));
+	if (cap_header == NULL)
+	{
+		ERROR("check_capability: calloc failed");
+		return (-1);
+	}
+
+	cap_user_data_t cap_data = calloc(1, sizeof (*cap_data));
+	if (cap_data == NULL)
+	{
+		ERROR("check_capability: calloc failed");
+		sfree(cap_header);
+		return (-1);
+	}
+
+	cap_header->pid = getpid();
+	cap_header->version = _LINUX_CAPABILITY_VERSION;
+	if (capget(cap_header, cap_data) < 0)
+	{
+		ERROR("check_capability: capget failed");
+		sfree(cap_header);
+		sfree(cap_data);
+		return (-1);
+	}
+
+	if ((cap_data->effective & (1 << capability)) == 0)
+	{
+		sfree(cap_header);
+		sfree(cap_data);
+		return (-1);
+	}
+	else
+	{
+		sfree(cap_header);
+		sfree(cap_data);
+		return (0);
+	}
+#else
+	WARNING ("check_capability: unsupported capability implementation. "
+	    "Some plugin(s) may require elevated privileges to work properly.");
+	return (0);
+#endif /* _LINUX_CAPABILITY_VERSION_3 */
+} /* }}} int check_capability */
+#endif /* HAVE_SYS_CAPABILITY_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common.h	2016-09-11 16:10:25.259038726 +0800
@@ -34,15 +35,13 @@
 #if HAVE_PWD_H
 # include <pwd.h>
 #endif
 
 #define sfree(ptr) \
 	do { \
-		if((ptr) != NULL) { \
-			free(ptr); \
-		} \
+		free(ptr); \
 		(ptr) = NULL; \
 	} while (0)
 
 #define STATIC_ARRAY_SIZE(a) (sizeof (a) / sizeof (*(a)))
 
 #define IS_TRUE(s) ((strcasecmp ("true", (s)) == 0) \
@@ -221,14 +220,12 @@
  *   `buffer'      String to be handled.
  *   `buffer_size' Length of the string. The function returns after
  *                 encountering a null-byte or reading this many bytes.
  */
 void replace_special (char *buffer, size_t buffer_size);
 
-int strsubstitute (char *str, char c_from, char c_to);
-
 /*
  * NAME
  *   strunescape
  *
  * DESCRIPTION
  *   Replaces any escaped characters in a string with the appropriate special
@@ -354,25 +351,36 @@
  * Returns zero on success. Returns EAGAIN when called for the first time; in
  * this case the value_t is invalid and the next call should succeed. Other
  * return values indicate an error. */
 int rate_to_value (value_t *ret_value, gauge_t rate,
 		rate_to_value_state_t *state, int ds_type, cdtime_t t);
 
-int value_to_rate (value_t *ret_rate, derive_t value,
-		value_to_rate_state_t *state, int ds_type, cdtime_t t);
+int value_to_rate (gauge_t *ret_rate, value_t value, int ds_type, cdtime_t t,
+		value_to_rate_state_t *state);
 
 /* Converts a service name (a string) to a port number
  * (in the range [1-65535]). Returns less than zero on error. */
 int service_name_to_port_number (const char *service_name);
 
+/* Sets various, non-default, socket options */
+void set_sock_opts (int sockfd);
+
 /** Parse a string to a derive_t value. Returns zero on success or non-zero on
  * failure. If failure is returned, ret_value is not touched. */
 int strtoderive (const char *string, derive_t *ret_value);
 
 /** Parse a string to a gauge_t value. Returns zero on success or non-zero on
  * failure. If failure is returned, ret_value is not touched. */
 int strtogauge (const char *string, gauge_t *ret_value);
 
 int strarray_add (char ***ret_array, size_t *ret_array_len, char const *str);
 void strarray_free (char **array, size_t array_len);
 
+#ifdef HAVE_SYS_CAPABILITY_H
+/** Check if the current process benefits from the capability passed in
+ * argument. Returns zero if it does, less than zero if it doesn't or on error.
+ * See capabilities(7) for the list of possible capabilities.
+ * */
+int check_capability (int capability);
+#endif /* HAVE_SYS_CAPABILITY_H */
+
 #endif /* COMMON_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/common_test.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/common_test.c	2016-09-11 16:10:25.259038726 +0800
@@ -21,14 +21,14 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
-#include "testing.h"
 #include "common.h"
+#include "testing.h"
 
 #if HAVE_LIBKSTAT
 kstat_ctl_t *kc;
 #endif /* HAVE_LIBKSTAT */
 
 DEF_TEST(sstrncpy)
@@ -39,24 +39,24 @@
 
   buffer[0] = buffer[1] = buffer[2] = buffer[3] = 0xff;
   buffer[12] = buffer[13] = buffer[14] = buffer[15] = 0xff;
 
   ret = sstrncpy (ptr, "foobar", 8);
   OK(ret == ptr);
-  STREQ ("foobar", ptr);
+  EXPECT_EQ_STR ("foobar", ptr);
   OK(buffer[3] == buffer[12]);
 
   ret = sstrncpy (ptr, "abc", 8);
   OK(ret == ptr);
-  STREQ ("abc", ptr);
+  EXPECT_EQ_STR ("abc", ptr);
   OK(buffer[3] == buffer[12]);
 
   ret = sstrncpy (ptr, "collectd", 8);
   OK(ret == ptr);
   OK(ptr[7] == 0);
-  STREQ ("collect", ptr);
+  EXPECT_EQ_STR ("collect", ptr);
   OK(buffer[3] == buffer[12]);
 
   return (0);
 }
 
 DEF_TEST(ssnprintf)
@@ -67,33 +67,32 @@
 
   buffer[0] = buffer[1] = buffer[2] = buffer[3] = 0xff;
   buffer[12] = buffer[13] = buffer[14] = buffer[15] = 0xff;
 
   status = ssnprintf (ptr, 8, "%i", 1337);
   OK(status == 4);
-  STREQ ("1337", ptr);
+  EXPECT_EQ_STR ("1337", ptr);
 
   status = ssnprintf (ptr, 8, "%s", "collectd");
   OK(status == 8);
   OK(ptr[7] == 0);
-  STREQ ("collect", ptr);
+  EXPECT_EQ_STR ("collect", ptr);
   OK(buffer[3] == buffer[12]);
 
   return (0);
 }
 
 DEF_TEST(sstrdup)
 {
   char *ptr;
 
   ptr = sstrdup ("collectd");
   OK(ptr != NULL);
-  STREQ ("collectd", ptr);
+  EXPECT_EQ_STR ("collectd", ptr);
 
   sfree(ptr);
-  OK(ptr == NULL);
 
   ptr = sstrdup (NULL);
   OK(ptr == NULL);
 
   return (0);
 }
@@ -104,46 +103,46 @@
   char *fields[8];
   int status;
 
   strncpy (buffer, "foo bar", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 2);
-  STREQ ("foo", fields[0]);
-  STREQ ("bar", fields[1]);
+  EXPECT_EQ_STR ("foo", fields[0]);
+  EXPECT_EQ_STR ("bar", fields[1]);
 
   strncpy (buffer, "foo \t bar", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 2);
-  STREQ ("foo", fields[0]);
-  STREQ ("bar", fields[1]);
+  EXPECT_EQ_STR ("foo", fields[0]);
+  EXPECT_EQ_STR ("bar", fields[1]);
 
   strncpy (buffer, "one two\tthree\rfour\nfive", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 5);
-  STREQ ("one", fields[0]);
-  STREQ ("two", fields[1]);
-  STREQ ("three", fields[2]);
-  STREQ ("four", fields[3]);
-  STREQ ("five", fields[4]);
+  EXPECT_EQ_STR ("one", fields[0]);
+  EXPECT_EQ_STR ("two", fields[1]);
+  EXPECT_EQ_STR ("three", fields[2]);
+  EXPECT_EQ_STR ("four", fields[3]);
+  EXPECT_EQ_STR ("five", fields[4]);
 
   strncpy (buffer, "\twith trailing\n", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 2);
-  STREQ ("with", fields[0]);
-  STREQ ("trailing", fields[1]);
+  EXPECT_EQ_STR ("with", fields[0]);
+  EXPECT_EQ_STR ("trailing", fields[1]);
 
   strncpy (buffer, "1 2 3 4 5 6 7 8 9 10 11 12 13", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 8);
-  STREQ ("7", fields[6]);
-  STREQ ("8", fields[7]);
+  EXPECT_EQ_STR ("7", fields[6]);
+  EXPECT_EQ_STR ("8", fields[7]);
 
   strncpy (buffer, "single", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 1);
-  STREQ ("single", fields[0]);
+  EXPECT_EQ_STR ("single", fields[0]);
 
   strncpy (buffer, "", sizeof (buffer));
   status = strsplit (buffer, fields, 8);
   OK(status == 0);
 
   return (0);
@@ -159,68 +158,117 @@
   fields[1] = "bar";
   fields[2] = "baz";
   fields[3] = "qux";
 
   status = strjoin (buffer, sizeof (buffer), fields, 2, "!");
   OK(status == 7);
-  STREQ ("foo!bar", buffer);
+  EXPECT_EQ_STR ("foo!bar", buffer);
 
   status = strjoin (buffer, sizeof (buffer), fields, 1, "!");
   OK(status == 3);
-  STREQ ("foo", buffer);
+  EXPECT_EQ_STR ("foo", buffer);
 
   status = strjoin (buffer, sizeof (buffer), fields, 0, "!");
   OK(status < 0);
 
   status = strjoin (buffer, sizeof (buffer), fields, 2, "rcht");
   OK(status == 10);
-  STREQ ("foorchtbar", buffer);
+  EXPECT_EQ_STR ("foorchtbar", buffer);
 
   status = strjoin (buffer, sizeof (buffer), fields, 4, "");
   OK(status == 12);
-  STREQ ("foobarbazqux", buffer);
+  EXPECT_EQ_STR ("foobarbazqux", buffer);
 
   status = strjoin (buffer, sizeof (buffer), fields, 4, "!");
   OK(status == 15);
-  STREQ ("foo!bar!baz!qux", buffer);
+  EXPECT_EQ_STR ("foo!bar!baz!qux", buffer);
 
   fields[0] = "0123";
   fields[1] = "4567";
   fields[2] = "8901";
   fields[3] = "2345";
   status = strjoin (buffer, sizeof (buffer), fields, 4, "-");
   OK(status < 0);
 
   return (0);
 }
 
+DEF_TEST(escape_slashes)
+{
+  struct {
+    char *str;
+    char *want;
+  } cases[] = {
+    {"foo/bar/baz", "foo_bar_baz"},
+    {"/like/a/path", "like_a_path"},
+    {"trailing/slash/", "trailing_slash_"},
+    {"foo//bar", "foo__bar"},
+  };
+
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++) {
+    char buffer[32];
+
+    strncpy (buffer, cases[i].str, sizeof (buffer));
+    OK(escape_slashes (buffer, sizeof (buffer)) == 0);
+    EXPECT_EQ_STR(cases[i].want, buffer);
+  }
+
+  return 0;
+}
+
+DEF_TEST(escape_string)
+{
+  struct {
+    char *str;
+    char *want;
+  } cases[] = {
+    {"foobar", "foobar"},
+    {"f00bar", "f00bar"},
+    {"foo bar", "\"foo bar\""},
+    {"foo \"bar\"", "\"foo \\\"bar\\\"\""},
+    {"012345678901234", "012345678901234"},
+    {"012345 78901234", "\"012345 789012\""},
+    {"012345 78901\"34", "\"012345 78901\""},
+  };
+
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++) {
+    char buffer[16];
+
+    strncpy (buffer, cases[i].str, sizeof (buffer));
+    OK(escape_string (buffer, sizeof (buffer)) == 0);
+    EXPECT_EQ_STR(cases[i].want, buffer);
+  }
+
+  return 0;
+}
+
 DEF_TEST(strunescape)
 {
   char buffer[16];
   int status;
 
   strncpy (buffer, "foo\\tbar", sizeof (buffer));
   status = strunescape (buffer, sizeof (buffer));
   OK(status == 0);
-  STREQ ("foo\tbar", buffer);
+  EXPECT_EQ_STR ("foo\tbar", buffer);
 
   strncpy (buffer, "\\tfoo\\r\\n", sizeof (buffer));
   status = strunescape (buffer, sizeof (buffer));
   OK(status == 0);
-  STREQ ("\tfoo\r\n", buffer);
+  EXPECT_EQ_STR ("\tfoo\r\n", buffer);
 
   strncpy (buffer, "With \\\"quotes\\\"", sizeof (buffer));
   status = strunescape (buffer, sizeof (buffer));
   OK(status == 0);
-  STREQ ("With \"quotes\"", buffer);
+  EXPECT_EQ_STR ("With \"quotes\"", buffer);
 
   /* Backslash before null byte */
   strncpy (buffer, "\\tbackslash end\\", sizeof (buffer));
   status = strunescape (buffer, sizeof (buffer));
   OK(status != 0);
-  STREQ ("\tbackslash end", buffer);
+  EXPECT_EQ_STR ("\tbackslash end", buffer);
   return (0);
 
   /* Backslash at buffer end */
   strncpy (buffer, "\\t3\\56", sizeof (buffer));
   status = strunescape (buffer, 4);
   OK(status != 0);
@@ -232,19 +280,115 @@
   OK(buffer[5] == '6');
   OK(buffer[6] == '7');
 
   return (0);
 }
 
+DEF_TEST(parse_values)
+{
+  struct {
+    char buffer[64];
+    int status;
+    gauge_t value;
+  } cases[] = {
+    {"1435044576:42",     0, 42.0},
+    {"1435044576:42:23", -1,  NAN},
+    {"1435044576:U",      0,  NAN},
+    {"N:12.3",            0, 12.3},
+    {"N:42.0:23",        -1,  NAN},
+    {"N:U",               0,  NAN},
+    {"T:42.0",           -1,  NAN},
+  };
+
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++)
+  {
+    data_source_t dsrc = {
+      .name = "value",
+      .type = DS_TYPE_GAUGE,
+      .min = 0.0,
+      .max = NAN,
+    };
+    data_set_t ds = {
+      .type = "example",
+      .ds_num = 1,
+      .ds = &dsrc,
+    };
+
+    value_t v = {
+      .gauge = NAN,
+    };
+    value_list_t vl = {
+      .values = &v,
+      .values_len = 1,
+      .time = 0,
+      .interval = 0,
+      .host = "example.com",
+      .plugin = "common_test",
+      .type = "example",
+      .meta = NULL,
+    };
+
+    int status = parse_values (cases[i].buffer, &vl, &ds);
+    EXPECT_EQ_INT (cases[i].status, status);
+    if (status != 0)
+      continue;
+
+    EXPECT_EQ_DOUBLE (cases[i].value, vl.values[0].gauge);
+  }
+
+  return (0);
+}
+
+DEF_TEST(value_to_rate)
+{
+  struct {
+    time_t t0;
+    time_t t1;
+    int ds_type;
+    value_t v0;
+    value_t v1;
+    gauge_t want;
+  } cases[] = {
+    { 0, 10, DS_TYPE_DERIVE,  {.derive  =    0}, {.derive = 1000},   NAN},
+    {10, 20, DS_TYPE_DERIVE,  {.derive  = 1000}, {.derive = 2000}, 100.0},
+    {20, 30, DS_TYPE_DERIVE,  {.derive  = 2000}, {.derive = 1800}, -20.0},
+    { 0, 10, DS_TYPE_COUNTER, {.counter =    0}, {.counter = 1000},   NAN},
+    {10, 20, DS_TYPE_COUNTER, {.counter = 1000}, {.counter = 5000}, 400.0},
+    /* 32bit wrap-around. */
+    {20, 30, DS_TYPE_COUNTER, {.counter = 4294967238ULL}, {.counter =   42}, 10.0},
+    /* 64bit wrap-around. */
+    {30, 40, DS_TYPE_COUNTER, {.counter = 18446744073709551558ULL}, {.counter =   42}, 10.0},
+  };
+
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++) {
+    value_to_rate_state_t state = { cases[i].v0, TIME_T_TO_CDTIME_T (cases[i].t0) };
+    gauge_t got;
+
+    if (cases[i].t0 == 0) {
+      OK(value_to_rate (&got, cases[i].v1, cases[i].ds_type, TIME_T_TO_CDTIME_T(cases[i].t1), &state) == EAGAIN);
+      continue;
+    }
+
+    OK(value_to_rate (&got, cases[i].v1, cases[i].ds_type, TIME_T_TO_CDTIME_T(cases[i].t1), &state) == 0);
+    EXPECT_EQ_DOUBLE(cases[i].want, got);
+  }
+
+  return 0;
+}
+
 int main (void)
 {
   RUN_TEST(sstrncpy);
   RUN_TEST(ssnprintf);
   RUN_TEST(sstrdup);
   RUN_TEST(strsplit);
   RUN_TEST(strjoin);
+  RUN_TEST(escape_slashes);
+  RUN_TEST(escape_string);
   RUN_TEST(strunescape);
+  RUN_TEST(parse_values);
+  RUN_TEST(value_to_rate);
 
   END_TEST;
 }
 
 /* vim: set sw=2 sts=2 et : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/configfile.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/configfile.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/configfile.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/configfile.c	2016-09-11 16:10:25.259038726 +0800
@@ -69,21 +69,22 @@
 	plugin_ctx_t ctx;
 	struct cf_complex_callback_s *next;
 } cf_complex_callback_t;
 
 typedef struct cf_value_map_s
 {
-	char *key;
+	const char *key;
 	int (*func) (oconfig_item_t *);
 } cf_value_map_t;
 
 typedef struct cf_global_option_s
 {
-	char *key;
+	const char *key;
 	char *value;
-	char *def;
+	_Bool from_cli; /* value set from CLI */
+	const char *def;
 } cf_global_option_t;
 
 /*
  * Prototypes of callback functions
  */
 static int dispatch_value_typesdb (oconfig_item_t *ci);
@@ -105,27 +106,27 @@
 	{"Plugin",     dispatch_block_plugin}
 };
 static int cf_value_map_num = STATIC_ARRAY_SIZE (cf_value_map);
 
 static cf_global_option_t cf_global_options[] =
 {
-	{"BaseDir",     NULL, PKGLOCALSTATEDIR},
-	{"PIDFile",     NULL, PIDFILE},
-	{"Hostname",    NULL, NULL},
-	{"FQDNLookup",  NULL, "true"},
-	{"Interval",    NULL, NULL},
-	{"ReadThreads", NULL, "5"},
-	{"WriteThreads", NULL, "5"},
-	{"WriteQueueLimitHigh", NULL, NULL},
-	{"WriteQueueLimitLow", NULL, NULL},
-	{"Timeout",     NULL, "2"},
-	{"AutoLoadPlugin", NULL, "false"},
-	{"CollectInternalStats", NULL, "false"},
-	{"PreCacheChain",  NULL, "PreCache"},
-	{"PostCacheChain", NULL, "PostCache"},
-	{"MaxReadInterval", NULL, "86400"}
+	{"BaseDir",              NULL, 0, PKGLOCALSTATEDIR},
+	{"PIDFile",              NULL, 0, PIDFILE},
+	{"Hostname",             NULL, 0, NULL},
+	{"FQDNLookup",           NULL, 0, "true"},
+	{"Interval",             NULL, 0, NULL},
+	{"ReadThreads",          NULL, 0, "5"},
+	{"WriteThreads",         NULL, 0, "5"},
+	{"WriteQueueLimitHigh",  NULL, 0, NULL},
+	{"WriteQueueLimitLow",   NULL, 0, NULL},
+	{"Timeout",              NULL, 0, "2"},
+	{"AutoLoadPlugin",       NULL, 0, "false"},
+	{"CollectInternalStats", NULL, 0, "false"},
+	{"PreCacheChain",        NULL, 0, "PreCache"},
+	{"PostCacheChain",       NULL, 0, "PostCache"},
+	{"MaxReadInterval",      NULL, 0, "86400"}
 };
 static int cf_global_options_num = STATIC_ARRAY_SIZE (cf_global_options);
 
 static int cf_default_typesdb = 1;
 
 /*
@@ -151,13 +152,13 @@
 {
 	cf_callback_t *cf_cb;
 	plugin_ctx_t old_ctx;
 	char *key;
 	char *value;
 	int ret;
-	int i;
+	int i = 0;
 
 	if (orig_key == NULL)
 		return (EINVAL);
 
 	DEBUG ("type = %s, key = %s, value = %s",
 			ESCAPE_NULL(type),
@@ -207,44 +208,42 @@
 
 static int dispatch_global_option (const oconfig_item_t *ci)
 {
 	if (ci->values_num != 1)
 		return (-1);
 	if (ci->values[0].type == OCONFIG_TYPE_STRING)
-		return (global_option_set (ci->key, ci->values[0].value.string));
+		return (global_option_set (ci->key, ci->values[0].value.string, 0));
 	else if (ci->values[0].type == OCONFIG_TYPE_NUMBER)
 	{
 		char tmp[128];
 		ssnprintf (tmp, sizeof (tmp), "%lf", ci->values[0].value.number);
-		return (global_option_set (ci->key, tmp));
+		return (global_option_set (ci->key, tmp, 0));
 	}
 	else if (ci->values[0].type == OCONFIG_TYPE_BOOLEAN)
 	{
 		if (ci->values[0].value.boolean)
-			return (global_option_set (ci->key, "true"));
+			return (global_option_set (ci->key, "true", 0));
 		else
-			return (global_option_set (ci->key, "false"));
+			return (global_option_set (ci->key, "false", 0));
 	}
 
 	return (-1);
 } /* int dispatch_global_option */
 
 static int dispatch_value_typesdb (oconfig_item_t *ci)
 {
-	int i = 0;
-
 	assert (strcasecmp (ci->key, "TypesDB") == 0);
 
 	cf_default_typesdb = 0;
 
 	if (ci->values_num < 1) {
 		ERROR ("configfile: `TypesDB' needs at least one argument.");
 		return (-1);
 	}
 
-	for (i = 0; i < ci->values_num; ++i)
+	for (int i = 0; i < ci->values_num; ++i)
 	{
 		if (OCONFIG_TYPE_STRING != ci->values[i].type) {
 			WARNING ("configfile: TypesDB: Skipping %i. argument which "
 					"is not a string.", i + 1);
 			continue;
 		}
@@ -254,28 +253,27 @@
 	return (0);
 } /* int dispatch_value_typesdb */
 
 static int dispatch_value_plugindir (oconfig_item_t *ci)
 {
 	assert (strcasecmp (ci->key, "PluginDir") == 0);
-	
+
 	if (ci->values_num != 1)
 		return (-1);
 	if (ci->values[0].type != OCONFIG_TYPE_STRING)
 		return (-1);
 
 	plugin_set_dir (ci->values[0].value.string);
 	return (0);
 }
 
 static int dispatch_loadplugin (oconfig_item_t *ci)
 {
-	int i;
 	const char *name;
 	unsigned int flags = 0;
-	plugin_ctx_t ctx;
+	plugin_ctx_t ctx = { 0 };
 	plugin_ctx_t old_ctx;
 	int ret_val;
 
 	assert (strcasecmp (ci->key, "LoadPlugin") == 0);
 
 	if (ci->values_num != 1)
@@ -285,28 +283,32 @@
 
 	name = ci->values[0].value.string;
 	if (strcmp ("libvirt", name) == 0)
 		name = "virt";
 
 	/* default to the global interval set before loading this plugin */
-	memset (&ctx, 0, sizeof (ctx));
 	ctx.interval = cf_get_default_interval ();
+	ctx.flush_interval = 0;
+	ctx.flush_timeout = 0;
 
-	for (i = 0; i < ci->children_num; ++i) {
-		if (strcasecmp("Globals", ci->children[i].key) == 0)
-			cf_util_get_flag (ci->children + i, &flags, PLUGIN_FLAGS_GLOBAL);
-		else if (strcasecmp ("Interval", ci->children[i].key) == 0) {
-			if (cf_util_get_cdtime (ci->children + i, &ctx.interval) != 0) {
-				/* cf_util_get_cdtime will log an error */
-				continue;
-			}
-		}
+	for (int i = 0; i < ci->children_num; ++i)
+	{
+		oconfig_item_t *child = ci->children + i;
+
+		if (strcasecmp("Globals", child->key) == 0)
+			cf_util_get_flag (child, &flags, PLUGIN_FLAGS_GLOBAL);
+		else if (strcasecmp ("Interval", child->key) == 0)
+			cf_util_get_cdtime (child, &ctx.interval);
+		else if (strcasecmp ("FlushInterval", child->key) == 0)
+			cf_util_get_cdtime (child, &ctx.flush_interval);
+		else if (strcasecmp ("FlushTimeout", child->key) == 0)
+			cf_util_get_cdtime (child, &ctx.flush_timeout);
 		else {
 			WARNING("Ignoring unknown LoadPlugin option \"%s\" "
 					"for plugin \"%s\"",
-					ci->children[i].key, ci->values[0].value.string);
+					child->key, ci->values[0].value.string);
 		}
 	}
 
 	old_ctx = plugin_set_ctx (ctx);
 	ret_val = plugin_load (name, (uint32_t) flags);
 	/* reset to the "global" context */
@@ -317,18 +319,17 @@
 
 static int dispatch_value_plugin (const char *plugin, oconfig_item_t *ci)
 {
 	char  buffer[4096];
 	char *buffer_ptr;
 	int   buffer_free;
-	int i;
 
 	buffer_ptr = buffer;
 	buffer_free = sizeof (buffer);
 
-	for (i = 0; i < ci->values_num; i++)
+	for (int i = 0; i < ci->values_num; i++)
 	{
 		int status = -1;
 
 		if (ci->values[i].type == OCONFIG_TYPE_STRING)
 			status = ssnprintf (buffer_ptr, buffer_free, " %s",
 					ci->values[i].value.string);
@@ -350,38 +351,34 @@
 
 	return (cf_dispatch (plugin, ci->key, buffer_ptr));
 } /* int dispatch_value_plugin */
 
 static int dispatch_value (oconfig_item_t *ci)
 {
-	int ret = -2;
-	int i;
+	int ret = 0;
 
-	for (i = 0; i < cf_value_map_num; i++)
+	for (int i = 0; i < cf_value_map_num; i++)
 		if (strcasecmp (cf_value_map[i].key, ci->key) == 0)
 		{
 			ret = cf_value_map[i].func (ci);
 			break;
 		}
 
-	for (i = 0; i < cf_global_options_num; i++)
+	for (int i = 0; i < cf_global_options_num; i++)
 		if (strcasecmp (cf_global_options[i].key, ci->key) == 0)
 		{
 			ret = dispatch_global_option (ci);
 			break;
 		}
 
 	return (ret);
 } /* int dispatch_value */
 
 static int dispatch_block_plugin (oconfig_item_t *ci)
 {
-	int i;
-	char *name;
-
-	cf_complex_callback_t *cb;
+	const char *name;
 
 	if (strcasecmp (ci->key, "Plugin") != 0)
 		return (-1);
 	if (ci->values_num < 1)
 		return (-1);
 	if (ci->values[0].type != OCONFIG_TYPE_STRING)
@@ -397,18 +394,17 @@
 				"This compatibility code will go away eventually.");
 		name = "virt";
 	}
 
 	if (IS_TRUE (global_option_get ("AutoLoadPlugin")))
 	{
-		plugin_ctx_t ctx;
+		plugin_ctx_t ctx = { 0 };
 		plugin_ctx_t old_ctx;
 		int status;
 
 		/* default to the global interval set before loading this plugin */
-		memset (&ctx, 0, sizeof (ctx));
 		ctx.interval = cf_get_default_interval ();
 
 		old_ctx = plugin_set_ctx (ctx);
 		status = plugin_load (name, /* flags = */ 0);
 		/* reset to the "global" context */
 		plugin_set_ctx (old_ctx);
@@ -419,13 +415,13 @@
 					"with status %i.", name, status);
 			return (status);
 		}
 	}
 
 	/* Check for a complex callback first */
-	for (cb = complex_callback_head; cb != NULL; cb = cb->next)
+	for (cf_complex_callback_t *cb = complex_callback_head; cb != NULL; cb = cb->next)
 	{
 		if (strcasecmp (name, cb->type) == 0)
 		{
 			plugin_ctx_t old_ctx;
 			int ret_val;
 
@@ -434,13 +430,13 @@
 			plugin_set_ctx (old_ctx);
 			return (ret_val);
 		}
 	}
 
 	/* Hm, no complex plugin found. Dispatch the values one by one */
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		if (ci->children[i].children == NULL)
 			dispatch_value_plugin (name, ci->children + i);
 		else
 		{
 			WARNING ("There is a `%s' block within the "
@@ -470,21 +466,20 @@
 }
 
 static int cf_ci_replace_child (oconfig_item_t *dst, oconfig_item_t *src,
 		int offset)
 {
 	oconfig_item_t *temp;
-	int i;
 
 	assert (offset >= 0);
 	assert (dst->children_num > offset);
 
 	/* Free the memory used by the replaced child. Usually that's the
 	 * `Include "blah"' statement. */
 	temp = dst->children + offset;
-	for (i = 0; i < temp->values_num; i++)
+	for (int i = 0; i < temp->values_num; i++)
 	{
 		if (temp->values[i].type == OCONFIG_TYPE_STRING)
 		{
 			sfree (temp->values[i].value.string);
 		}
 	}
@@ -506,13 +501,13 @@
 	if (dst->children_num + src->children_num - 1 == 0)
 	{
 		dst->children_num = 0;
 		return (0);
 	}
 
-	temp = (oconfig_item_t *) realloc (dst->children,
+	temp = realloc (dst->children,
 			sizeof (oconfig_item_t)
 			* (dst->children_num + src->children_num - 1));
 	if (temp == NULL)
 	{
 		ERROR ("configfile: realloc failed.");
 		return (-1);
@@ -554,13 +549,13 @@
 {
 	oconfig_item_t *temp;
 
 	if ((src == NULL) || (src->children_num == 0))
 		return (0);
 
-	temp = (oconfig_item_t *) realloc (dst->children,
+	temp = realloc (dst->children,
 			sizeof (oconfig_item_t)
 			* (dst->children_num + src->children_num));
 	if (temp == NULL)
 	{
 		ERROR ("configfile: realloc failed.");
 		return (-1);
@@ -579,36 +574,32 @@
 #define CF_MAX_DEPTH 8
 static oconfig_item_t *cf_read_generic (const char *path,
 		const char *pattern, int depth);
 
 static int cf_include_all (oconfig_item_t *root, int depth)
 {
-	int i;
-
-	for (i = 0; i < root->children_num; i++)
+	for (int i = 0; i < root->children_num; i++)
 	{
 		oconfig_item_t *new;
 		oconfig_item_t *old;
 
 		char *pattern = NULL;
 
-		int j;
-
 		if (strcasecmp (root->children[i].key, "Include") != 0)
 			continue;
 
 		old = root->children + i;
 
 		if ((old->values_num != 1)
 				|| (old->values[0].type != OCONFIG_TYPE_STRING))
 		{
 			ERROR ("configfile: `Include' needs exactly one string argument.");
 			continue;
 		}
 
-		for (j = 0; j < old->children_num; ++j)
+		for (int j = 0; j < old->children_num; ++j)
 		{
 			oconfig_item_t *child = old->children + j;
 
 			if (strcasecmp (child->key, "Filter") == 0)
 				cf_util_get_string (child, &pattern);
 			else
@@ -696,33 +687,31 @@
 	oconfig_item_t *root = NULL;
 	DIR *dh;
 	struct dirent *de;
 	char **filenames = NULL;
 	int filenames_num = 0;
 	int status;
-	int i;
 
 	assert (depth < CF_MAX_DEPTH);
 
 	dh = opendir (dir);
 	if (dh == NULL)
 	{
 		char errbuf[1024];
 		ERROR ("configfile: opendir failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (NULL);
 	}
 
-	root = (oconfig_item_t *) malloc (sizeof (oconfig_item_t));
+	root = calloc (1, sizeof (*root));
 	if (root == NULL)
 	{
-		ERROR ("configfile: malloc failed.");
+		ERROR ("configfile: calloc failed.");
 		closedir (dh);
 		return (NULL);
 	}
-	memset (root, 0, sizeof (oconfig_item_t));
 
 	while ((de = readdir (dh)) != NULL)
 	{
 		char   name[1024];
 		char **tmp;
 
@@ -734,26 +723,26 @@
 		if ((status < 0) || ((size_t) status >= sizeof (name)))
 		{
 			ERROR ("configfile: Not including `%s/%s' because its"
 					" name is too long.",
 					dir, de->d_name);
 			closedir (dh);
-			for (i = 0; i < filenames_num; ++i)
+			for (int i = 0; i < filenames_num; ++i)
 				free (filenames[i]);
 			free (filenames);
 			free (root);
 			return (NULL);
 		}
 
 		++filenames_num;
-		tmp = (char **) realloc (filenames,
+		tmp = realloc (filenames,
 				filenames_num * sizeof (*filenames));
 		if (tmp == NULL) {
 			ERROR ("configfile: realloc failed.");
 			closedir (dh);
-			for (i = 0; i < filenames_num - 1; ++i)
+			for (int i = 0; i < filenames_num - 1; ++i)
 				free (filenames[i]);
 			free (filenames);
 			free (root);
 			return (NULL);
 		}
 		filenames = tmp;
@@ -767,13 +756,13 @@
 		return (root);
 	}
 
 	qsort ((void *) filenames, filenames_num, sizeof (*filenames),
 			cf_compare_string);
 
-	for (i = 0; i < filenames_num; ++i)
+	for (int i = 0; i < filenames_num; ++i)
 	{
 		oconfig_item_t *temp;
 		char *name = filenames[i];
 
 		temp = cf_read_generic (name, pattern, depth);
 		if (temp == NULL)
@@ -800,24 +789,23 @@
  *
  * Path is stat'ed and either cf_read_file or cf_read_dir is called
  * accordingly.
  *
  * There are two versions of this function: If `wordexp' exists shell wildcards
  * will be expanded and the function will include all matches found. If
- * `wordexp' (or, more precisely, it's header file) is not available the
+ * `wordexp' (or, more precisely, its header file) is not available the
  * simpler function is used which does not do any such expansion.
  */
 #if HAVE_WORDEXP_H
 static oconfig_item_t *cf_read_generic (const char *path,
 		const char *pattern, int depth)
 {
 	oconfig_item_t *root = NULL;
 	int status;
 	const char *path_ptr;
 	wordexp_t we;
-	size_t i;
 
 	if (depth >= CF_MAX_DEPTH)
 	{
 		ERROR ("configfile: Not including `%s' because the maximum "
 				"nesting depth has been reached.", path);
 		return (NULL);
@@ -827,26 +815,25 @@
 	if (status != 0)
 	{
 		ERROR ("configfile: wordexp (%s) failed.", path);
 		return (NULL);
 	}
 
-	root = (oconfig_item_t *) malloc (sizeof (oconfig_item_t));
+	root = calloc (1, sizeof (*root));
 	if (root == NULL)
 	{
-		ERROR ("configfile: malloc failed.");
+		ERROR ("configfile: calloc failed.");
 		return (NULL);
 	}
-	memset (root, '\0', sizeof (oconfig_item_t));
 
 	/* wordexp() might return a sorted list already. That's not
 	 * documented though, so let's make sure we get what we want. */
 	qsort ((void *) we.we_wordv, we.we_wordc, sizeof (*we.we_wordv),
 			cf_compare_string);
 
-	for (i = 0; i < we.we_wordc; i++)
+	for (size_t i = 0; i < we.we_wordc; i++)
 	{
 		oconfig_item_t *temp;
 		struct stat statbuf;
 
 		path_ptr = we.we_wordv[i];
 
@@ -918,19 +905,18 @@
 
 	ERROR ("configfile: %s is neither a file nor a directory.", path);
 	return (NULL);
 } /* oconfig_item_t *cf_read_generic */
 #endif /* !HAVE_WORDEXP_H */
 
-/* 
+/*
  * Public functions
  */
-int global_option_set (const char *option, const char *value)
+int global_option_set (const char *option, const char *value, _Bool from_cli)
 {
 	int i;
-
 	DEBUG ("option = %s; value = %s;", option, value);
 
 	for (i = 0; i < cf_global_options_num; i++)
 		if (strcasecmp (cf_global_options[i].key, option) == 0)
 			break;
 
@@ -932,28 +918,34 @@
 
 	for (i = 0; i < cf_global_options_num; i++)
 		if (strcasecmp (cf_global_options[i].key, option) == 0)
 			break;
 
 	if (i >= cf_global_options_num)
+	{
+		ERROR ("configfile: Cannot set unknown global option `%s'.", option);
 		return (-1);
+	}
 
-	if (strcasecmp (option, "PIDFile") == 0 && pidfile_from_cli == 1)
+	if (cf_global_options[i].from_cli && (! from_cli))
 	{
-		DEBUG ("Configfile: Ignoring `PIDFILE' option because "
-			"command-line option `-P' take precedence.");
+		DEBUG ("configfile: Ignoring %s `%s' option because "
+				"it was overriden by a command-line option.",
+				option, value);
 		return (0);
 	}
 
 	sfree (cf_global_options[i].value);
 
 	if (value != NULL)
 		cf_global_options[i].value = strdup (value);
 	else
 		cf_global_options[i].value = NULL;
 
+	cf_global_options[i].from_cli = from_cli;
+
 	return (0);
 }
 
 const char *global_option_get (const char *option)
 {
 	int i;
@@ -954,20 +946,22 @@
 	return (0);
 }
 
 const char *global_option_get (const char *option)
 {
 	int i;
-
 	for (i = 0; i < cf_global_options_num; i++)
 		if (strcasecmp (cf_global_options[i].key, option) == 0)
 			break;
 
 	if (i >= cf_global_options_num)
+	{
+		ERROR ("configfile: Cannot get unknown global option `%s'.", option);
 		return (NULL);
-	
+	}
+
 	return ((cf_global_options[i].value != NULL)
 			? cf_global_options[i].value
 			: cf_global_options[i].def);
 } /* char *global_option_get */
 
 long global_option_get_long (const char *option, long default_value)
@@ -1012,15 +1006,13 @@
 	return (global_option_get_time ("Interval",
 			       DOUBLE_TO_CDTIME_T (COLLECTD_DEFAULT_INTERVAL)));
 }
 
 void cf_unregister (const char *type)
 {
-	cf_callback_t *this, *prev;
-
-	for (prev = NULL, this = first_callback;
+	for (cf_callback_t *prev = NULL, *this = first_callback;
 			this != NULL;
 			prev = this, this = this->next)
 		if (strcasecmp (this->type, type) == 0)
 		{
 			if (prev == NULL)
 				first_callback = this->next;
@@ -1031,15 +1023,13 @@
 			break;
 		}
 } /* void cf_unregister */
 
 void cf_unregister_complex (const char *type)
 {
-	cf_complex_callback_t *this, *prev;
-
-	for (prev = NULL, this = complex_callback_head;
+	for (cf_complex_callback_t *prev = NULL, *this = complex_callback_head;
 			this != NULL;
 			prev = this, this = this->next)
 		if (strcasecmp (this->type, type) == 0)
 		{
 			if (prev == NULL)
 				complex_callback_head = this->next;
@@ -1059,13 +1049,13 @@
 	cf_callback_t *cf_cb;
 
 	/* Remove this module from the list, if it already exists */
 	cf_unregister (type);
 
 	/* This pointer will be free'd in `cf_unregister' */
-	if ((cf_cb = (cf_callback_t *) malloc (sizeof (cf_callback_t))) == NULL)
+	if ((cf_cb = malloc (sizeof (*cf_cb))) == NULL)
 		return;
 
 	cf_cb->type     = type;
 	cf_cb->callback = callback;
 	cf_cb->keys     = keys;
 	cf_cb->keys_num = keys_num;
@@ -1076,13 +1066,13 @@
 } /* void cf_register */
 
 int cf_register_complex (const char *type, int (*callback) (oconfig_item_t *))
 {
 	cf_complex_callback_t *new;
 
-	new = (cf_complex_callback_t *) malloc (sizeof (cf_complex_callback_t));
+	new = malloc (sizeof (*new));
 	if (new == NULL)
 		return (-1);
 
 	new->type = strdup (type);
 	if (new->type == NULL)
 	{
@@ -1107,16 +1097,16 @@
 		last->next = new;
 	}
 
 	return (0);
 } /* int cf_register_complex */
 
-int cf_read (char *filename)
+int cf_read (const char *filename)
 {
 	oconfig_item_t *conf;
-	int i;
+	int ret = 0;
 
 	conf = cf_read_generic (filename, /* pattern = */ NULL, /* depth = */ 0);
 	if (conf == NULL)
 	{
 		ERROR ("Unable to read config file %s.", filename);
 		return (-1);
@@ -1125,27 +1115,36 @@
 	{
 		ERROR ("Configuration file %s is empty.", filename);
 		oconfig_free (conf);
 		return (-1);
 	}
 
-	for (i = 0; i < conf->children_num; i++)
+	for (int i = 0; i < conf->children_num; i++)
 	{
 		if (conf->children[i].children == NULL)
-			dispatch_value (conf->children + i);
+		{
+			if (dispatch_value (conf->children + i) != 0)
+				ret = -1;
+		}
 		else
-			dispatch_block (conf->children + i);
+		{
+			if (dispatch_block (conf->children + i) != 0)
+				ret = -1;
+		}
 	}
 
 	oconfig_free (conf);
 
 	/* Read the default types.db if no `TypesDB' option was given. */
 	if (cf_default_typesdb)
-		read_types_list (PKGDATADIR"/types.db");
+	{
+		if (read_types_list (PKGDATADIR"/types.db") != 0)
+			ret = -1;
+	}
 
-	return (0);
+	return ret;
 } /* int cf_read */
 
 /* Assures the config option is a string, duplicates it and returns the copy in
  * "ret_string". If necessary "*ret_string" is freed first. Returns zero upon
  * success. */
 int cf_util_get_string (const oconfig_item_t *ci, char **ret_string) /* {{{ */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/configfile.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/configfile.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/configfile.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/configfile.h	2016-09-11 16:10:25.259038726 +0800
@@ -31,13 +32,13 @@
 #include "utils_time.h"
 #include "liboconfig/oconfig.h"
 
 /*
  * DESCRIPTION
  *  Remove a registered plugin from the internal data structures.
- * 
+ *
  * PARAMETERS
  *  `type'      Name of the plugin (must be the same as passed to
  *              `plugin_register'
  */
 void cf_unregister (const char *type);
 void cf_unregister_complex (const char *type);
@@ -84,18 +85,17 @@
  *              If set to NULL will use the `CONFIGFILE' define.
  *
  * RETURN VALUE
  *  Returns zero upon success and non-zero otherwise. A error-message will have
  *  been printed in this case.
  */
-int cf_read (char *filename);
+int cf_read (const char *filename);
 
-int global_option_set (const char *option, const char *value);
+int global_option_set (const char *option, const char *value, _Bool from_cli);
 const char *global_option_get (const char *option);
 long global_option_get_long (const char *option, long default_value);
-long global_option_get_long_in_range (const char *option, long default_value, long min, long max);
 
 cdtime_t global_option_get_time (char const *option, cdtime_t default_value);
 
 cdtime_t cf_get_default_interval (void);
 
 /* Assures the config option is a string, duplicates it and returns the copy in
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/filter_chain.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/filter_chain.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/filter_chain.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/filter_chain.c	2016-09-11 16:10:25.259038726 +0800
@@ -171,13 +172,13 @@
   char *dest;
 
   if (orig == NULL)
     return (NULL);
 
   sz = strlen (orig) + 1;
-  dest = (char *) malloc (sz);
+  dest = malloc (sz);
   if (dest == NULL)
     return (NULL);
 
   memcpy (dest, orig, sz);
 
   return (dest);
@@ -232,19 +233,18 @@
     WARNING ("Filter subsystem: Cannot find a \"%s\" match. "
         "Did you load the appropriate plugin?",
         ci->values[0].value.string);
     return (-1);
   }
 
-  m = (fc_match_t *) malloc (sizeof (*m));
+  m = calloc (1, sizeof (*m));
   if (m == NULL)
   {
-    ERROR ("fc_config_add_match: malloc failed.");
+    ERROR ("fc_config_add_match: calloc failed.");
     return (-1);
   }
-  memset (m, 0, sizeof (*m));
 
   sstrncpy (m->name, ptr->name, sizeof (m->name));
   memcpy (&m->proc, &ptr->proc, sizeof (m->proc));
   m->user_data = NULL;
   m->next = NULL;
 
@@ -304,19 +304,18 @@
     WARNING ("Filter subsystem: Cannot find a \"%s\" target. "
         "Did you load the appropriate plugin?",
         ci->values[0].value.string);
     return (-1);
   }
 
-  t = (fc_target_t *) malloc (sizeof (*t));
+  t = calloc (1, sizeof (*t));
   if (t == NULL)
   {
-    ERROR ("fc_config_add_target: malloc failed.");
+    ERROR ("fc_config_add_target: calloc failed.");
     return (-1);
   }
-  memset (t, 0, sizeof (*t));
 
   sstrncpy (t->name, ptr->name, sizeof (t->name));
   memcpy (&t->proc, &ptr->proc, sizeof (t->proc));
   t->user_data = NULL;
   t->next = NULL;
 
@@ -332,13 +331,13 @@
     }
   }
   else
   {
     t->user_data = NULL;
   }
-  
+
   if (*targets_head != NULL)
   {
     ptr = *targets_head;
     while (ptr->next != NULL)
       ptr = ptr->next;
 
@@ -355,13 +354,12 @@
 static int fc_config_add_rule (fc_chain_t *chain, /* {{{ */
     oconfig_item_t *ci)
 {
   fc_rule_t *rule;
   char rule_name[2*DATA_MAX_NAME_LEN] = "Unnamed rule";
   int status = 0;
-  int i;
 
   if (ci->values_num > 1)
   {
     WARNING ("Filter subsystem: `Rule' blocks have at most one argument.");
     return (-1);
   }
@@ -370,29 +368,27 @@
   {
     WARNING ("Filter subsystem: `Rule' blocks expect one string argument "
         "or no argument at all.");
     return (-1);
   }
 
-  rule = (fc_rule_t *) malloc (sizeof (*rule));
+  rule = calloc (1, sizeof (*rule));
   if (rule == NULL)
   {
-    ERROR ("fc_config_add_rule: malloc failed.");
+    ERROR ("fc_config_add_rule: calloc failed.");
     return (-1);
   }
-  memset (rule, 0, sizeof (*rule));
-  rule->next = NULL;
 
   if (ci->values_num == 1)
   {
     sstrncpy (rule->name, ci->values[0].value.string, sizeof (rule->name));
     ssnprintf (rule_name, sizeof (rule_name), "Rule \"%s\"",
         ci->values[0].value.string);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Match", option->key) == 0)
       status = fc_config_add_match (&rule->matches, option);
     else if (strcasecmp ("Target", option->key) == 0)
@@ -447,13 +443,12 @@
 } /* }}} int fc_config_add_rule */
 
 static int fc_config_add_chain (const oconfig_item_t *ci) /* {{{ */
 {
   fc_chain_t *chain = NULL;
   int status = 0;
-  int i;
   int new_chain = 1;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("Filter subsystem: <Chain> blocks require exactly one "
@@ -466,26 +461,22 @@
     if ((chain = fc_chain_get_by_name (ci->values[0].value.string)) != NULL)
       new_chain = 0;
   }
 
   if (chain == NULL)
   {
-    chain = (fc_chain_t *) malloc (sizeof (*chain));
+    chain = calloc (1, sizeof (*chain));
     if (chain == NULL)
     {
-      ERROR ("fc_config_add_chain: malloc failed.");
+      ERROR ("fc_config_add_chain: calloc failed.");
       return (-1);
     }
-    memset (chain, 0, sizeof (*chain));
     sstrncpy (chain->name, ci->values[0].value.string, sizeof (chain->name));
-    chain->rules = NULL;
-    chain->targets = NULL;
-    chain->next = NULL;
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Rule", option->key) == 0)
       status = fc_config_add_rule (chain, option);
     else if (strcasecmp ("Target", option->key) == 0)
@@ -629,44 +620,41 @@
   return (FC_TARGET_RETURN);
 } /* }}} int fc_bit_return_invoke */
 
 static int fc_bit_write_create (const oconfig_item_t *ci, /* {{{ */
     void **user_data)
 {
-  int i;
-
   fc_writer_t *plugin_list = NULL;
   size_t plugin_list_len = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     fc_writer_t *temp;
-    int j;
 
     if (strcasecmp ("Plugin", child->key) != 0)
     {
       ERROR ("Filter subsystem: The built-in target `write' does not "
           "support the configuration option `%s'.",
           child->key);
       continue;
     }
 
-    for (j = 0; j < child->values_num; j++)
+    for (int j = 0; j < child->values_num; j++)
     {
       char *plugin;
 
       if (child->values[j].type != OCONFIG_TYPE_STRING)
       {
         ERROR ("Filter subsystem: Built-in target `write': "
             "The `Plugin' option accepts only string arguments.");
         continue;
       }
       plugin = child->values[j].value.string;
 
-      temp = (fc_writer_t *) realloc (plugin_list, (plugin_list_len + 2)
+      temp = realloc (plugin_list, (plugin_list_len + 2)
           * (sizeof (*plugin_list)));
       if (temp == NULL)
       {
         ERROR ("fc_bit_write_create: realloc failed.");
         continue;
       }
@@ -689,20 +677,19 @@
   return (0);
 } /* }}} int fc_bit_write_create */
 
 static int fc_bit_write_destroy (void **user_data) /* {{{ */
 {
   fc_writer_t *plugin_list;
-  size_t i;
 
   if ((user_data == NULL) || (*user_data == NULL))
     return (0);
 
   plugin_list = *user_data;
 
-  for (i = 0; plugin_list[i].plugin != NULL; i++)
+  for (size_t i = 0; plugin_list[i].plugin != NULL; i++)
     free (plugin_list[i].plugin);
   free (plugin_list);
 
   return (0);
 } /* }}} int fc_bit_write_destroy */
 
@@ -749,15 +736,13 @@
           "Built-in target `write': Some write plugin is back to normal "
           "operation. `write' succeeded.");
     }
   }
   else
   {
-    size_t i;
-
-    for (i = 0; plugin_list[i].plugin != NULL; i++)
+    for (size_t i = 0; plugin_list[i].plugin != NULL; i++)
     {
       status = plugin_write (plugin_list[i].plugin, ds, vl);
       if (status != 0)
       {
         c_complain (LOG_INFO, &plugin_list[i].complaint,
             "Filter subsystem: Built-in target `write': Dispatching value to "
@@ -778,18 +763,17 @@
   return (FC_TARGET_CONTINUE);
 } /* }}} int fc_bit_write_invoke */
 
 static int fc_init_once (void) /* {{{ */
 {
   static int done = 0;
-  target_proc_t tproc;
+  target_proc_t tproc = { 0 };
 
   if (done != 0)
     return (0);
 
-  memset (&tproc, 0, sizeof (tproc));
   tproc.create  = fc_bit_jump_create;
   tproc.destroy = fc_bit_jump_destroy;
   tproc.invoke  = fc_bit_jump_invoke;
   fc_register_target ("jump", tproc);
 
   memset (&tproc, 0, sizeof (tproc));
@@ -821,20 +805,18 @@
 int fc_register_match (const char *name, match_proc_t proc) /* {{{ */
 {
   fc_match_t *m;
 
   DEBUG ("fc_register_match (%s);", name);
 
-  m = (fc_match_t *) malloc (sizeof (*m));
+  m = calloc (1, sizeof (*m));
   if (m == NULL)
     return (-ENOMEM);
-  memset (m, 0, sizeof (*m));
 
   sstrncpy (m->name, name, sizeof (m->name));
   memcpy (&m->proc, &proc, sizeof (m->proc));
-  m->next = NULL;
 
   if (match_list_head == NULL)
   {
     match_list_head = m;
   }
   else
@@ -855,20 +837,18 @@
 int fc_register_target (const char *name, target_proc_t proc) /* {{{ */
 {
   fc_target_t *t;
 
   DEBUG ("fc_register_target (%s);", name);
 
-  t = (fc_target_t *) malloc (sizeof (*t));
+  t = calloc (1, sizeof (*t));
   if (t == NULL)
     return (-ENOMEM);
-  memset (t, 0, sizeof (*t));
 
   sstrncpy (t->name, name, sizeof (t->name));
   memcpy (&t->proc, &proc, sizeof (t->proc));
-  t->next = NULL;
 
   if (target_list_head == NULL)
   {
     target_list_head = t;
   }
   else
@@ -884,37 +864,34 @@
 
   return (0);
 } /* }}} int fc_register_target */
 
 fc_chain_t *fc_chain_get_by_name (const char *chain_name) /* {{{ */
 {
-  fc_chain_t *chain;
-
   if (chain_name == NULL)
     return (NULL);
 
-  for (chain = chain_list_head; chain != NULL; chain = chain->next)
+  for (fc_chain_t *chain = chain_list_head; chain != NULL; chain = chain->next)
     if (strcasecmp (chain_name, chain->name) == 0)
       return (chain);
 
   return (NULL);
 } /* }}} int fc_chain_get_by_name */
 
 int fc_process_chain (const data_set_t *ds, value_list_t *vl, /* {{{ */
     fc_chain_t *chain)
 {
-  fc_rule_t *rule;
   fc_target_t *target;
   int status = FC_TARGET_CONTINUE;
 
   if (chain == NULL)
     return (-1);
 
   DEBUG ("fc_process_chain (chain = %s);", chain->name);
 
-  for (rule = chain->rules; rule != NULL; rule = rule->next)
+  for (fc_rule_t *rule = chain->rules; rule != NULL; rule = rule->next)
   {
     fc_match_t *match;
     status = FC_TARGET_CONTINUE;
 
     if (rule->name[0] != 0)
     {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/filter_chain.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/filter_chain.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/filter_chain.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/filter_chain.h	2016-09-11 16:10:25.259038726 +0800
@@ -94,13 +95,13 @@
 
 int fc_process_chain (const data_set_t *ds, value_list_t *vl,
     fc_chain_t *chain);
 
 int fc_default_action (const data_set_t *ds, value_list_t *vl);
 
-/* 
+/*
  * Shortcut for global configuration
  */
 int fc_configure (const oconfig_item_t *ci);
 
 #endif /* FILTER_CHAIN_H */
 /* vim: set sw=2 sts=2 et : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/Makefile.am	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/Makefile.am	2016-09-11 16:10:25.255038733 +0800
@@ -1,60 +1,55 @@
-if COMPILER_IS_GCC
-AM_CFLAGS = -Wall -Werror
-endif
-
 AM_CPPFLAGS = -I$(top_srcdir)/src
 AM_CPPFLAGS += -DPREFIX='"${prefix}"'
 AM_CPPFLAGS += -DCONFIGFILE='"${sysconfdir}/${PACKAGE_NAME}.conf"'
 AM_CPPFLAGS += -DLOCALSTATEDIR='"${localstatedir}"'
 AM_CPPFLAGS += -DPKGLOCALSTATEDIR='"${localstatedir}/lib/${PACKAGE_NAME}"'
 if BUILD_FEATURE_DAEMON
 AM_CPPFLAGS += -DPIDFILE='"${localstatedir}/run/${PACKAGE_NAME}.pid"'
 endif
 AM_CPPFLAGS += -DPLUGINDIR='"${pkglibdir}"'
 AM_CPPFLAGS += -DPKGDATADIR='"${pkgdatadir}"'
 
 # Link to these libraries..
-COMMON_LIBS =
+COMMON_LIBS = $(PTHREAD_LIBS)
 if BUILD_WITH_LIBRT
 COMMON_LIBS += -lrt
 endif
 if BUILD_WITH_LIBPOSIX4
 COMMON_LIBS += -lposix4
 endif
 if BUILD_WITH_LIBSOCKET
 COMMON_LIBS += -lsocket
 endif
 if BUILD_WITH_LIBRESOLV
 COMMON_LIBS += -lresolv
 endif
-if BUILD_WITH_LIBPTHREAD
-COMMON_LIBS += -lpthread
-endif
 if BUILD_WITH_LIBKSTAT
 COMMON_LIBS += -lkstat
 endif
 if BUILD_WITH_LIBDEVINFO
 COMMON_LIBS += -ldevinfo
 endif
 
-AUTOMAKE_OPTIONS = subdir-objects
-
 sbin_PROGRAMS = collectd
 
-noinst_LTLIBRARIES = libavltree.la libcommon.la libheap.la libplugin_mock.la
+noinst_LTLIBRARIES = libavltree.la libcommon.la libheap.la libmetadata.la libplugin_mock.la
 
 libavltree_la_SOURCES = utils_avltree.c utils_avltree.h
 
 libcommon_la_SOURCES = common.c common.h
 libcommon_la_LIBADD = $(COMMON_LIBS)
 
 libheap_la_SOURCES = utils_heap.c utils_heap.h
 
-libplugin_mock_la_SOURCES = plugin_mock.c utils_cache_mock.c utils_time_mock.c
-libplugin_mock_la_LIBADD = $(COMMON_LIBS)
+libmetadata_la_SOURCES = meta_data.c meta_data.h
+
+libplugin_mock_la_SOURCES = plugin_mock.c utils_cache_mock.c \
+			    utils_time.c utils_time.h
+libplugin_mock_la_CPPFLAGS = $(AM_CPPFLAGS) -DMOCK_TIME
+libplugin_mock_la_LIBADD = $(COMMON_LIBS) libcommon.la
 
 collectd_SOURCES = collectd.c collectd.h \
 		   configfile.c configfile.h \
 		   filter_chain.c filter_chain.h \
 		   meta_data.c meta_data.h \
 		   plugin.c plugin.h \
@@ -73,13 +68,13 @@
 
 
 collectd_CPPFLAGS =  $(AM_CPPFLAGS) $(LTDLINCL)
 collectd_CFLAGS = $(AM_CFLAGS)
 collectd_LDFLAGS = -export-dynamic
 collectd_LDADD = libavltree.la libcommon.la libheap.la -lm $(COMMON_LIBS)
-collectd_DEPENDENCIES = libavltree.la libcommon.la libheap.la
+collectd_DEPENDENCIES = libavltree.la libcommon.la libheap.la libmetadata.la
 
 # The daemon needs to call sg_init, so we need to link it against libstatgrab,
 # too. -octo
 if BUILD_WITH_LIBSTATGRAB
 collectd_CFLAGS += $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
 collectd_LDADD += $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
@@ -89,17 +84,28 @@
 collectd_LDADD += $(LIBLTDL) $(top_builddir)/src/liboconfig/liboconfig.la
 collectd_DEPENDENCIES += $(top_builddir)/src/liboconfig/liboconfig.la
 else
 collectd_LDADD += -loconfig
 endif
 
-check_PROGRAMS = test_common test_utils_avltree test_utils_heap
-TESTS = test_common test_utils_avltree test_utils_heap
+LOG_COMPILER = env VALGRIND="@VALGRIND@" $(abs_top_srcdir)/testwrapper.sh
+
+check_PROGRAMS = test_common test_meta_data test_utils_avltree test_utils_heap test_utils_time test_utils_subst
+TESTS          = test_common test_meta_data test_utils_avltree test_utils_heap test_utils_time test_utils_subst
 
 test_common_SOURCES = common_test.c ../testing.h
-test_common_LDADD = libcommon.la libplugin_mock.la $(COMMON_LIBS)
+test_common_LDADD = libplugin_mock.la
+
+test_meta_data_SOURCES = meta_data_test.c ../testing.h
+test_meta_data_LDADD = libmetadata.la libplugin_mock.la
 
 test_utils_avltree_SOURCES = utils_avltree_test.c ../testing.h
 test_utils_avltree_LDADD = libavltree.la $(COMMON_LIBS)
 
 test_utils_heap_SOURCES = utils_heap_test.c ../testing.h
 test_utils_heap_LDADD = libheap.la $(COMMON_LIBS)
+
+test_utils_time_SOURCES = utils_time_test.c ../testing.h
+
+test_utils_subst_SOURCES = utils_subst_test.c ../testing.h \
+			   utils_subst.c utils_subst.h
+test_utils_subst_LDADD = libplugin_mock.la
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/Makefile.in	2016-11-29 00:09:18.020051865 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/Makefile.in	2016-09-11 16:10:46.059009878 +0800
@@ -81,28 +81,29 @@
 host_triplet = @host@
 @BUILD_FEATURE_DAEMON_TRUE@am__append_1 = -DPIDFILE='"${localstatedir}/run/${PACKAGE_NAME}.pid"'
 @BUILD_WITH_LIBRT_TRUE@am__append_2 = -lrt
 @BUILD_WITH_LIBPOSIX4_TRUE@am__append_3 = -lposix4
 @BUILD_WITH_LIBSOCKET_TRUE@am__append_4 = -lsocket
 @BUILD_WITH_LIBRESOLV_TRUE@am__append_5 = -lresolv
-@BUILD_WITH_LIBPTHREAD_TRUE@am__append_6 = -lpthread
-@BUILD_WITH_LIBKSTAT_TRUE@am__append_7 = -lkstat
-@BUILD_WITH_LIBDEVINFO_TRUE@am__append_8 = -ldevinfo
+@BUILD_WITH_LIBKSTAT_TRUE@am__append_6 = -lkstat
+@BUILD_WITH_LIBDEVINFO_TRUE@am__append_7 = -ldevinfo
 sbin_PROGRAMS = collectd$(EXEEXT)
 
 # The daemon needs to call sg_init, so we need to link it against libstatgrab,
 # too. -octo
-@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_9 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_10 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_WITH_OWN_LIBOCONFIG_TRUE@am__append_11 = $(LIBLTDL) $(top_builddir)/src/liboconfig/liboconfig.la
-@BUILD_WITH_OWN_LIBOCONFIG_TRUE@am__append_12 = $(top_builddir)/src/liboconfig/liboconfig.la
-@BUILD_WITH_OWN_LIBOCONFIG_FALSE@am__append_13 = -loconfig
-check_PROGRAMS = test_common$(EXEEXT) test_utils_avltree$(EXEEXT) \
-	test_utils_heap$(EXEEXT)
-TESTS = test_common$(EXEEXT) test_utils_avltree$(EXEEXT) \
-	test_utils_heap$(EXEEXT)
+@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_8 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_9 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_WITH_OWN_LIBOCONFIG_TRUE@am__append_10 = $(LIBLTDL) $(top_builddir)/src/liboconfig/liboconfig.la
+@BUILD_WITH_OWN_LIBOCONFIG_TRUE@am__append_11 = $(top_builddir)/src/liboconfig/liboconfig.la
+@BUILD_WITH_OWN_LIBOCONFIG_FALSE@am__append_12 = -loconfig
+check_PROGRAMS = test_common$(EXEEXT) test_meta_data$(EXEEXT) \
+	test_utils_avltree$(EXEEXT) test_utils_heap$(EXEEXT) \
+	test_utils_time$(EXEEXT) test_utils_subst$(EXEEXT)
+TESTS = test_common$(EXEEXT) test_meta_data$(EXEEXT) \
+	test_utils_avltree$(EXEEXT) test_utils_heap$(EXEEXT) \
+	test_utils_time$(EXEEXT) test_utils_subst$(EXEEXT)
 subdir = src/daemon
 DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/Makefile.am \
 	$(top_srcdir)/libltdl/config/depcomp \
 	$(top_srcdir)/libltdl/config/test-driver
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/configure.ac
@@ -128,15 +129,19 @@
 libcommon_la_DEPENDENCIES = $(am__DEPENDENCIES_2)
 am_libcommon_la_OBJECTS = common.lo
 libcommon_la_OBJECTS = $(am_libcommon_la_OBJECTS)
 libheap_la_LIBADD =
 am_libheap_la_OBJECTS = utils_heap.lo
 libheap_la_OBJECTS = $(am_libheap_la_OBJECTS)
-libplugin_mock_la_DEPENDENCIES = $(am__DEPENDENCIES_2)
-am_libplugin_mock_la_OBJECTS = plugin_mock.lo utils_cache_mock.lo \
-	utils_time_mock.lo
+libmetadata_la_LIBADD =
+am_libmetadata_la_OBJECTS = meta_data.lo
+libmetadata_la_OBJECTS = $(am_libmetadata_la_OBJECTS)
+libplugin_mock_la_DEPENDENCIES = $(am__DEPENDENCIES_2) libcommon.la
+am_libplugin_mock_la_OBJECTS = libplugin_mock_la-plugin_mock.lo \
+	libplugin_mock_la-utils_cache_mock.lo \
+	libplugin_mock_la-utils_time.lo
 libplugin_mock_la_OBJECTS = $(am_libplugin_mock_la_OBJECTS)
 am__installdirs = "$(DESTDIR)$(sbindir)"
 PROGRAMS = $(sbin_PROGRAMS)
 am_collectd_OBJECTS = collectd-collectd.$(OBJEXT) \
 	collectd-configfile.$(OBJEXT) collectd-filter_chain.$(OBJEXT) \
 	collectd-meta_data.$(OBJEXT) collectd-plugin.$(OBJEXT) \
@@ -157,20 +162,29 @@
 @BUILD_WITH_OWN_LIBOCONFIG_TRUE@	$(top_builddir)/src/liboconfig/liboconfig.la
 collectd_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(collectd_CFLAGS) \
 	$(CFLAGS) $(collectd_LDFLAGS) $(LDFLAGS) -o $@
 am_test_common_OBJECTS = common_test.$(OBJEXT)
 test_common_OBJECTS = $(am_test_common_OBJECTS)
-test_common_DEPENDENCIES = libcommon.la libplugin_mock.la \
-	$(am__DEPENDENCIES_2)
+test_common_DEPENDENCIES = libplugin_mock.la
+am_test_meta_data_OBJECTS = meta_data_test.$(OBJEXT)
+test_meta_data_OBJECTS = $(am_test_meta_data_OBJECTS)
+test_meta_data_DEPENDENCIES = libmetadata.la libplugin_mock.la
 am_test_utils_avltree_OBJECTS = utils_avltree_test.$(OBJEXT)
 test_utils_avltree_OBJECTS = $(am_test_utils_avltree_OBJECTS)
 test_utils_avltree_DEPENDENCIES = libavltree.la $(am__DEPENDENCIES_2)
 am_test_utils_heap_OBJECTS = utils_heap_test.$(OBJEXT)
 test_utils_heap_OBJECTS = $(am_test_utils_heap_OBJECTS)
 test_utils_heap_DEPENDENCIES = libheap.la $(am__DEPENDENCIES_2)
+am_test_utils_subst_OBJECTS = utils_subst_test.$(OBJEXT) \
+	utils_subst.$(OBJEXT)
+test_utils_subst_OBJECTS = $(am_test_utils_subst_OBJECTS)
+test_utils_subst_DEPENDENCIES = libplugin_mock.la
+am_test_utils_time_OBJECTS = utils_time_test.$(OBJEXT)
+test_utils_time_OBJECTS = $(am_test_utils_time_OBJECTS)
+test_utils_time_LDADD = $(LDADD)
 AM_V_P = $(am__v_P_@AM_V@)
 am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
 am__v_P_0 = false
 am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
@@ -200,19 +214,23 @@
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
 am__v_CCLD_0 = @echo "  CCLD    " $@;
 am__v_CCLD_1 = 
 SOURCES = $(libavltree_la_SOURCES) $(libcommon_la_SOURCES) \
-	$(libheap_la_SOURCES) $(libplugin_mock_la_SOURCES) \
-	$(collectd_SOURCES) $(test_common_SOURCES) \
-	$(test_utils_avltree_SOURCES) $(test_utils_heap_SOURCES)
+	$(libheap_la_SOURCES) $(libmetadata_la_SOURCES) \
+	$(libplugin_mock_la_SOURCES) $(collectd_SOURCES) \
+	$(test_common_SOURCES) $(test_meta_data_SOURCES) \
+	$(test_utils_avltree_SOURCES) $(test_utils_heap_SOURCES) \
+	$(test_utils_subst_SOURCES) $(test_utils_time_SOURCES)
 DIST_SOURCES = $(libavltree_la_SOURCES) $(libcommon_la_SOURCES) \
-	$(libheap_la_SOURCES) $(libplugin_mock_la_SOURCES) \
-	$(collectd_SOURCES) $(test_common_SOURCES) \
-	$(test_utils_avltree_SOURCES) $(test_utils_heap_SOURCES)
+	$(libheap_la_SOURCES) $(libmetadata_la_SOURCES) \
+	$(libplugin_mock_la_SOURCES) $(collectd_SOURCES) \
+	$(test_common_SOURCES) $(test_meta_data_SOURCES) \
+	$(test_utils_avltree_SOURCES) $(test_utils_heap_SOURCES) \
+	$(test_utils_subst_SOURCES) $(test_utils_time_SOURCES)
 am__can_run_installinfo = \
   case $$AM_UPDATE_INFO_DIR in \
     n|no|NO) false;; \
     *) (install-info --version) >/dev/null 2>&1;; \
   esac
 am__tagged_files = $(HEADERS) $(SOURCES) $(TAGS_FILES) $(LISP)
@@ -438,12 +456,14 @@
 TEST_LOG_DRIVER = $(SHELL) $(top_srcdir)/libltdl/config/test-driver
 TEST_LOG_COMPILE = $(TEST_LOG_COMPILER) $(AM_TEST_LOG_FLAGS) \
 	$(TEST_LOG_FLAGS)
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -455,40 +475,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -496,16 +537,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -526,22 +563,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -555,19 +593,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -590,24 +627,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -617,12 +661,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -642,28 +688,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -676,13 +732,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
@@ -710,32 +765,34 @@
 sys_symbol_underscore = @sys_symbol_underscore@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-@COMPILER_IS_GCC_TRUE@AM_CFLAGS = -Wall -Werror
 AM_CPPFLAGS = -I$(top_srcdir)/src -DPREFIX='"${prefix}"' \
 	-DCONFIGFILE='"${sysconfdir}/${PACKAGE_NAME}.conf"' \
 	-DLOCALSTATEDIR='"${localstatedir}"' \
 	-DPKGLOCALSTATEDIR='"${localstatedir}/lib/${PACKAGE_NAME}"' \
 	$(am__append_1) -DPLUGINDIR='"${pkglibdir}"' \
 	-DPKGDATADIR='"${pkgdatadir}"'
 
 # Link to these libraries..
-COMMON_LIBS = $(am__append_2) $(am__append_3) $(am__append_4) \
-	$(am__append_5) $(am__append_6) $(am__append_7) \
-	$(am__append_8)
-AUTOMAKE_OPTIONS = subdir-objects
-noinst_LTLIBRARIES = libavltree.la libcommon.la libheap.la libplugin_mock.la
+COMMON_LIBS = $(PTHREAD_LIBS) $(am__append_2) $(am__append_3) \
+	$(am__append_4) $(am__append_5) $(am__append_6) \
+	$(am__append_7)
+noinst_LTLIBRARIES = libavltree.la libcommon.la libheap.la libmetadata.la libplugin_mock.la
 libavltree_la_SOURCES = utils_avltree.c utils_avltree.h
 libcommon_la_SOURCES = common.c common.h
 libcommon_la_LIBADD = $(COMMON_LIBS)
 libheap_la_SOURCES = utils_heap.c utils_heap.h
-libplugin_mock_la_SOURCES = plugin_mock.c utils_cache_mock.c utils_time_mock.c
-libplugin_mock_la_LIBADD = $(COMMON_LIBS)
+libmetadata_la_SOURCES = meta_data.c meta_data.h
+libplugin_mock_la_SOURCES = plugin_mock.c utils_cache_mock.c \
+			    utils_time.c utils_time.h
+
+libplugin_mock_la_CPPFLAGS = $(AM_CPPFLAGS) -DMOCK_TIME
+libplugin_mock_la_LIBADD = $(COMMON_LIBS) libcommon.la
 collectd_SOURCES = collectd.c collectd.h \
 		   configfile.c configfile.h \
 		   filter_chain.c filter_chain.h \
 		   meta_data.c meta_data.h \
 		   plugin.c plugin.h \
 		   utils_cache.c utils_cache.h \
@@ -749,25 +806,33 @@
 		   utils_tail.c utils_tail.h \
 		   utils_time.c utils_time.h \
 		   types_list.c types_list.h \
 		   utils_threshold.c utils_threshold.h
 
 collectd_CPPFLAGS = $(AM_CPPFLAGS) $(LTDLINCL)
-collectd_CFLAGS = $(AM_CFLAGS) $(am__append_9)
+collectd_CFLAGS = $(AM_CFLAGS) $(am__append_8)
 collectd_LDFLAGS = -export-dynamic
 collectd_LDADD = libavltree.la libcommon.la libheap.la -lm \
-	$(COMMON_LIBS) $(am__append_10) $(am__append_11) \
-	$(am__append_13)
-collectd_DEPENDENCIES = libavltree.la libcommon.la libheap.la \
+	$(COMMON_LIBS) $(am__append_9) $(am__append_10) \
 	$(am__append_12)
+collectd_DEPENDENCIES = libavltree.la libcommon.la libheap.la \
+	libmetadata.la $(am__append_11)
+LOG_COMPILER = env VALGRIND="@VALGRIND@" $(abs_top_srcdir)/testwrapper.sh
 test_common_SOURCES = common_test.c ../testing.h
-test_common_LDADD = libcommon.la libplugin_mock.la $(COMMON_LIBS)
+test_common_LDADD = libplugin_mock.la
+test_meta_data_SOURCES = meta_data_test.c ../testing.h
+test_meta_data_LDADD = libmetadata.la libplugin_mock.la
 test_utils_avltree_SOURCES = utils_avltree_test.c ../testing.h
 test_utils_avltree_LDADD = libavltree.la $(COMMON_LIBS)
 test_utils_heap_SOURCES = utils_heap_test.c ../testing.h
 test_utils_heap_LDADD = libheap.la $(COMMON_LIBS)
+test_utils_time_SOURCES = utils_time_test.c ../testing.h
+test_utils_subst_SOURCES = utils_subst_test.c ../testing.h \
+			   utils_subst.c utils_subst.h
+
+test_utils_subst_LDADD = libplugin_mock.la
 all: all-am
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .log .o .obj .test .test$(EXEEXT) .trs
 $(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
@@ -817,12 +882,15 @@
 libcommon.la: $(libcommon_la_OBJECTS) $(libcommon_la_DEPENDENCIES) $(EXTRA_libcommon_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(LINK)  $(libcommon_la_OBJECTS) $(libcommon_la_LIBADD) $(LIBS)
 
 libheap.la: $(libheap_la_OBJECTS) $(libheap_la_DEPENDENCIES) $(EXTRA_libheap_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(LINK)  $(libheap_la_OBJECTS) $(libheap_la_LIBADD) $(LIBS)
 
+libmetadata.la: $(libmetadata_la_OBJECTS) $(libmetadata_la_DEPENDENCIES) $(EXTRA_libmetadata_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(LINK)  $(libmetadata_la_OBJECTS) $(libmetadata_la_LIBADD) $(LIBS)
+
 libplugin_mock.la: $(libplugin_mock_la_OBJECTS) $(libplugin_mock_la_DEPENDENCIES) $(EXTRA_libplugin_mock_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(LINK)  $(libplugin_mock_la_OBJECTS) $(libplugin_mock_la_LIBADD) $(LIBS)
 
 clean-checkPROGRAMS:
 	@list='$(check_PROGRAMS)'; test -n "$$list" || exit 0; \
 	echo " rm -f" $$list; \
@@ -886,20 +954,32 @@
 	$(AM_V_CCLD)$(collectd_LINK) $(collectd_OBJECTS) $(collectd_LDADD) $(LIBS)
 
 test_common$(EXEEXT): $(test_common_OBJECTS) $(test_common_DEPENDENCIES) $(EXTRA_test_common_DEPENDENCIES) 
 	@rm -f test_common$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(test_common_OBJECTS) $(test_common_LDADD) $(LIBS)
 
+test_meta_data$(EXEEXT): $(test_meta_data_OBJECTS) $(test_meta_data_DEPENDENCIES) $(EXTRA_test_meta_data_DEPENDENCIES) 
+	@rm -f test_meta_data$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(test_meta_data_OBJECTS) $(test_meta_data_LDADD) $(LIBS)
+
 test_utils_avltree$(EXEEXT): $(test_utils_avltree_OBJECTS) $(test_utils_avltree_DEPENDENCIES) $(EXTRA_test_utils_avltree_DEPENDENCIES) 
 	@rm -f test_utils_avltree$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(test_utils_avltree_OBJECTS) $(test_utils_avltree_LDADD) $(LIBS)
 
 test_utils_heap$(EXEEXT): $(test_utils_heap_OBJECTS) $(test_utils_heap_DEPENDENCIES) $(EXTRA_test_utils_heap_DEPENDENCIES) 
 	@rm -f test_utils_heap$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(test_utils_heap_OBJECTS) $(test_utils_heap_LDADD) $(LIBS)
 
+test_utils_subst$(EXEEXT): $(test_utils_subst_OBJECTS) $(test_utils_subst_DEPENDENCIES) $(EXTRA_test_utils_subst_DEPENDENCIES) 
+	@rm -f test_utils_subst$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(test_utils_subst_OBJECTS) $(test_utils_subst_LDADD) $(LIBS)
+
+test_utils_time$(EXEEXT): $(test_utils_time_OBJECTS) $(test_utils_time_DEPENDENCIES) $(EXTRA_test_utils_time_DEPENDENCIES) 
+	@rm -f test_utils_time$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(test_utils_time_OBJECTS) $(test_utils_time_LDADD) $(LIBS)
+
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
@@ -919,19 +999,24 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd-utils_tail.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd-utils_tail_match.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd-utils_threshold.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd-utils_time.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/common.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/common_test.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/plugin_mock.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libplugin_mock_la-plugin_mock.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libplugin_mock_la-utils_cache_mock.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libplugin_mock_la-utils_time.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/meta_data.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/meta_data_test.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_avltree.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_avltree_test.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_cache_mock.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_heap.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_heap_test.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_time_mock.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_subst.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_subst_test.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_time_test.Po@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`;\
 @am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
 @am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
@@ -951,12 +1036,33 @@
 @am__fastdepCC_TRUE@	$(LTCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
 @am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
 
+libplugin_mock_la-plugin_mock.lo: plugin_mock.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libplugin_mock_la-plugin_mock.lo -MD -MP -MF $(DEPDIR)/libplugin_mock_la-plugin_mock.Tpo -c -o libplugin_mock_la-plugin_mock.lo `test -f 'plugin_mock.c' || echo '$(srcdir)/'`plugin_mock.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libplugin_mock_la-plugin_mock.Tpo $(DEPDIR)/libplugin_mock_la-plugin_mock.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='plugin_mock.c' object='libplugin_mock_la-plugin_mock.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o libplugin_mock_la-plugin_mock.lo `test -f 'plugin_mock.c' || echo '$(srcdir)/'`plugin_mock.c
+
+libplugin_mock_la-utils_cache_mock.lo: utils_cache_mock.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libplugin_mock_la-utils_cache_mock.lo -MD -MP -MF $(DEPDIR)/libplugin_mock_la-utils_cache_mock.Tpo -c -o libplugin_mock_la-utils_cache_mock.lo `test -f 'utils_cache_mock.c' || echo '$(srcdir)/'`utils_cache_mock.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libplugin_mock_la-utils_cache_mock.Tpo $(DEPDIR)/libplugin_mock_la-utils_cache_mock.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_cache_mock.c' object='libplugin_mock_la-utils_cache_mock.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o libplugin_mock_la-utils_cache_mock.lo `test -f 'utils_cache_mock.c' || echo '$(srcdir)/'`utils_cache_mock.c
+
+libplugin_mock_la-utils_time.lo: utils_time.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libplugin_mock_la-utils_time.lo -MD -MP -MF $(DEPDIR)/libplugin_mock_la-utils_time.Tpo -c -o libplugin_mock_la-utils_time.lo `test -f 'utils_time.c' || echo '$(srcdir)/'`utils_time.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libplugin_mock_la-utils_time.Tpo $(DEPDIR)/libplugin_mock_la-utils_time.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_time.c' object='libplugin_mock_la-utils_time.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libplugin_mock_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o libplugin_mock_la-utils_time.lo `test -f 'utils_time.c' || echo '$(srcdir)/'`utils_time.c
+
 collectd-collectd.o: collectd.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectd_CPPFLAGS) $(CPPFLAGS) $(collectd_CFLAGS) $(CFLAGS) -MT collectd-collectd.o -MD -MP -MF $(DEPDIR)/collectd-collectd.Tpo -c -o collectd-collectd.o `test -f 'collectd.c' || echo '$(srcdir)/'`collectd.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/collectd-collectd.Tpo $(DEPDIR)/collectd-collectd.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='collectd.c' object='collectd-collectd.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectd_CPPFLAGS) $(CPPFLAGS) $(collectd_CFLAGS) $(CFLAGS) -c -o collectd-collectd.o `test -f 'collectd.c' || echo '$(srcdir)/'`collectd.c
@@ -1395,12 +1501,19 @@
 	@p='test_common$(EXEEXT)'; \
 	b='test_common'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
 	"$$tst" $(AM_TESTS_FD_REDIRECT)
+test_meta_data.log: test_meta_data$(EXEEXT)
+	@p='test_meta_data$(EXEEXT)'; \
+	b='test_meta_data'; \
+	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
+	--log-file $$b.log --trs-file $$b.trs \
+	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
+	"$$tst" $(AM_TESTS_FD_REDIRECT)
 test_utils_avltree.log: test_utils_avltree$(EXEEXT)
 	@p='test_utils_avltree$(EXEEXT)'; \
 	b='test_utils_avltree'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
@@ -1409,12 +1522,26 @@
 	@p='test_utils_heap$(EXEEXT)'; \
 	b='test_utils_heap'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
 	"$$tst" $(AM_TESTS_FD_REDIRECT)
+test_utils_time.log: test_utils_time$(EXEEXT)
+	@p='test_utils_time$(EXEEXT)'; \
+	b='test_utils_time'; \
+	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
+	--log-file $$b.log --trs-file $$b.trs \
+	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
+	"$$tst" $(AM_TESTS_FD_REDIRECT)
+test_utils_subst.log: test_utils_subst$(EXEEXT)
+	@p='test_utils_subst$(EXEEXT)'; \
+	b='test_utils_subst'; \
+	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
+	--log-file $$b.log --trs-file $$b.trs \
+	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
+	"$$tst" $(AM_TESTS_FD_REDIRECT)
 .test.log:
 	@p='$<'; \
 	$(am__set_b); \
 	$(am__check_pre) $(TEST_LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_TEST_LOG_DRIVER_FLAGS) $(TEST_LOG_DRIVER_FLAGS) -- $(TEST_LOG_COMPILE) \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/meta_data.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/meta_data.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/meta_data.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/meta_data.c	2016-09-11 16:10:25.259038726 +0800
@@ -22,17 +22,16 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "meta_data.h"
 
-#include <pthread.h>
-
 /*
  * Data types
  */
 union meta_value_u
 {
   char    *mv_string;
@@ -68,32 +67,31 @@
   char *dest;
 
   if (orig == NULL)
     return (NULL);
 
   sz = strlen (orig) + 1;
-  dest = (char *) malloc (sz);
+  dest = malloc (sz);
   if (dest == NULL)
     return (NULL);
 
   memcpy (dest, orig, sz);
 
   return (dest);
 } /* }}} char *md_strdup */
 
 static meta_entry_t *md_entry_alloc (const char *key) /* {{{ */
 {
   meta_entry_t *e;
 
-  e = (meta_entry_t *) malloc (sizeof (*e));
+  e = calloc (1, sizeof (*e));
   if (e == NULL)
   {
-    ERROR ("md_entry_alloc: malloc failed.");
+    ERROR ("md_entry_alloc: calloc failed.");
     return (NULL);
   }
-  memset (e, 0, sizeof (*e));
 
   e->key = md_strdup (key);
   if (e->key == NULL)
   {
     free (e);
     ERROR ("md_entry_alloc: md_strdup failed.");
@@ -103,28 +101,43 @@
   e->type = 0;
   e->next = NULL;
 
   return (e);
 } /* }}} meta_entry_t *md_entry_alloc */
 
-static meta_entry_t *md_entry_clone (const meta_entry_t *orig) /* {{{ */
+/* XXX: The lock on md must be held while calling this function! */
+static meta_entry_t *md_entry_clone_contents (const meta_entry_t *orig) /* {{{ */
 {
   meta_entry_t *copy;
 
-  if (orig == NULL)
-    return (NULL);
+  /* WARNINGS :
+   *  - we do not check that orig != NULL here. You should have done it before.
+   *  - we do not set copy->next. DO NOT FORGET TO SET copy->next IN YOUR FUNCTION
+   */
 
   copy = md_entry_alloc (orig->key);
   if (copy == NULL)
     return (NULL);
   copy->type = orig->type;
   if (copy->type == MD_TYPE_STRING)
     copy->value.mv_string = strdup (orig->value.mv_string);
   else
     copy->value = orig->value;
 
+  return (copy);
+} /* }}} meta_entry_t *md_entry_clone_contents */
+
+static meta_entry_t *md_entry_clone (const meta_entry_t *orig) /* {{{ */
+{
+  meta_entry_t *copy;
+
+  if (orig == NULL)
+    return (NULL);
+
+  copy = md_entry_clone_contents(orig);
+
   copy->next = md_entry_clone (orig->next);
   return (copy);
 } /* }}} meta_entry_t *md_entry_clone */
 
 static void md_entry_free (meta_entry_t *e) /* {{{ */
 {
@@ -195,12 +208,69 @@
   }
 
   return (0);
 } /* }}} int md_entry_insert */
 
 /* XXX: The lock on md must be held while calling this function! */
+static int md_entry_insert_clone (meta_data_t *md, meta_entry_t *orig) /* {{{ */
+{
+  meta_entry_t *e;
+  meta_entry_t *this;
+  meta_entry_t *prev;
+
+  /* WARNINGS :
+   *  - we do not check that md and e != NULL here. You should have done it before.
+   *  - we do not use the lock. You should have set it before.
+   */
+
+  e = md_entry_clone_contents(orig);
+
+  prev = NULL;
+  this = md->head;
+  while (this != NULL)
+  {
+    if (strcasecmp (e->key, this->key) == 0)
+      break;
+
+    prev = this;
+    this = this->next;
+  }
+
+  if (this == NULL)
+  {
+    /* This key does not exist yet. */
+    if (md->head == NULL)
+      md->head = e;
+    else
+    {
+      assert (prev != NULL);
+      prev->next = e;
+    }
+
+    e->next = NULL;
+  }
+  else /* (this != NULL) */
+  {
+    if (prev == NULL)
+      md->head = e;
+    else
+      prev->next = e;
+
+    e->next = this->next;
+  }
+
+  if (this != NULL)
+  {
+    this->next = NULL;
+    md_entry_free (this);
+  }
+
+  return (0);
+} /* }}} int md_entry_insert_clone */
+
+/* XXX: The lock on md must be held while calling this function! */
 static meta_entry_t *md_entry_lookup (meta_data_t *md, /* {{{ */
     const char *key)
 {
   meta_entry_t *e;
 
   if ((md == NULL) || (key == NULL))
@@ -228,21 +298,19 @@
  * Public functions
  */
 meta_data_t *meta_data_create (void) /* {{{ */
 {
   meta_data_t *md;
 
-  md = (meta_data_t *) malloc (sizeof (*md));
+  md = calloc (1, sizeof (*md));
   if (md == NULL)
   {
-    ERROR ("meta_data_create: malloc failed.");
+    ERROR ("meta_data_create: calloc failed.");
     return (NULL);
   }
-  memset (md, 0, sizeof (*md));
 
-  md->head = NULL;
   pthread_mutex_init (&md->lock, /* attr = */ NULL);
 
   return (md);
 } /* }}} meta_data_t *meta_data_create */
 
 meta_data_t *meta_data_clone (meta_data_t *orig) /* {{{ */
@@ -260,32 +328,50 @@
   copy->head = md_entry_clone (orig->head);
   pthread_mutex_unlock (&orig->lock);
 
   return (copy);
 } /* }}} meta_data_t *meta_data_clone */
 
+int meta_data_clone_merge (meta_data_t **dest, meta_data_t *orig) /* {{{ */
+{
+  if (orig == NULL)
+    return (0);
+
+  if (*dest == NULL) {
+    *dest = meta_data_clone(orig);
+    return(0);
+  }
+
+  pthread_mutex_lock (&orig->lock);
+  for (meta_entry_t *e=orig->head; e != NULL; e = e->next)
+  {
+    md_entry_insert_clone((*dest), e);
+  }
+  pthread_mutex_unlock (&orig->lock);
+
+  return (0);
+} /* }}} int meta_data_clone_merge */
+
 void meta_data_destroy (meta_data_t *md) /* {{{ */
 {
   if (md == NULL)
     return;
 
   md_entry_free (md->head);
   pthread_mutex_destroy (&md->lock);
   free (md);
 } /* }}} void meta_data_destroy */
 
 int meta_data_exists (meta_data_t *md, const char *key) /* {{{ */
 {
-  meta_entry_t *e;
-
   if ((md == NULL) || (key == NULL))
     return (-EINVAL);
 
   pthread_mutex_lock (&md->lock);
 
-  for (e = md->head; e != NULL; e = e->next)
+  for (meta_entry_t *e = md->head; e != NULL; e = e->next)
   {
     if (strcasecmp (key, e->key) == 0)
     {
       pthread_mutex_unlock (&md->lock);
       return (1);
     }
@@ -294,20 +380,18 @@
   pthread_mutex_unlock (&md->lock);
   return (0);
 } /* }}} int meta_data_exists */
 
 int meta_data_type (meta_data_t *md, const char *key) /* {{{ */
 {
-  meta_entry_t *e;
-
   if ((md == NULL) || (key == NULL))
     return -EINVAL;
 
   pthread_mutex_lock (&md->lock);
 
-  for (e = md->head; e != NULL; e = e->next)
+  for (meta_entry_t *e = md->head; e != NULL; e = e->next)
   {
     if (strcasecmp (key, e->key) == 0)
     {
       pthread_mutex_unlock (&md->lock);
       return e->type;
     }
@@ -317,32 +401,31 @@
   return 0;
 } /* }}} int meta_data_type */
 
 int meta_data_toc (meta_data_t *md, char ***toc) /* {{{ */
 {
   int i = 0, count = 0;
-  meta_entry_t *e;
 
   if ((md == NULL) || (toc == NULL))
     return -EINVAL;
 
   pthread_mutex_lock (&md->lock);
 
-  for (e = md->head; e != NULL; e = e->next)
-    ++count;    
+  for (meta_entry_t *e = md->head; e != NULL; e = e->next)
+    ++count;
 
   if (count == 0)
   {
     pthread_mutex_unlock (&md->lock);
     return (count);
   }
 
   *toc = calloc(count, sizeof(**toc));
-  for (e = md->head; e != NULL; e = e->next)
+  for (meta_entry_t *e = md->head; e != NULL; e = e->next)
     (*toc)[i++] = strdup(e->key);
-  
+
   pthread_mutex_unlock (&md->lock);
   return count;
 } /* }}} int meta_data_toc */
 
 int meta_data_delete (meta_data_t *md, const char *key) /* {{{ */
 {
@@ -515,13 +598,13 @@
   if (temp == NULL)
   {
     pthread_mutex_unlock (&md->lock);
     ERROR ("meta_data_get_string: md_strdup failed.");
     return (-ENOMEM);
   }
- 
+
   pthread_mutex_unlock (&md->lock);
 
   *value = temp;
 
   return (0);
 } /* }}} int meta_data_get_string */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/meta_data.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/meta_data.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/meta_data.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/meta_data.h	2016-09-11 16:10:25.259038726 +0800
@@ -40,12 +41,13 @@
 
 struct meta_data_s;
 typedef struct meta_data_s meta_data_t;
 
 meta_data_t *meta_data_create (void);
 meta_data_t *meta_data_clone (meta_data_t *orig);
+int meta_data_clone_merge (meta_data_t **dest, meta_data_t *orig);
 void meta_data_destroy (meta_data_t *md);
 
 int meta_data_exists (meta_data_t *md, const char *key);
 int meta_data_type (meta_data_t *md, const char *key);
 int meta_data_toc (meta_data_t *md, char ***toc);
 int meta_data_delete (meta_data_t *md, const char *key);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon: meta_data_test.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/plugin.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/plugin.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/plugin.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/plugin.c	2016-09-11 16:10:25.259038726 +0800
@@ -77,12 +78,18 @@
 {
 	value_list_t *vl;
 	plugin_ctx_t ctx;
 	write_queue_t *next;
 };
 
+struct flush_callback_s {
+	char *name;
+	cdtime_t timeout;
+};
+typedef struct flush_callback_s flush_callback_t;
+
 /*
  * Private variables
  */
 static c_avl_tree_t *plugins_loaded = NULL;
 
 static llist_t *list_init;
@@ -279,13 +286,13 @@
 	{
 		le = llentry_create (key, cf);
 		if (le == NULL)
 		{
 			ERROR ("plugin: register_callback: "
 					"llentry_create failed.");
-			free (key);
+			sfree (key);
 			destroy_callback (cf);
 			return (-1);
 		}
 
 		llist_append (*list, le);
 	}
@@ -309,14 +316,14 @@
 
 static void log_list_callbacks (llist_t **list, /* {{{ */
 				const char *comment)
 {
 	char *str;
 	int len;
-	llentry_t *le;
 	int i;
+	llentry_t *le;
 	int n;
 	char **keys;
 
 	n = llist_size(*list);
 	if (n == 0)
 	{
@@ -349,29 +356,28 @@
 	}
 	else
 	{
 		*str = '\0';
 		strjoin(str, len, keys, n, "', '");
 		INFO("%s ['%s']", comment, str);
-		free(str);
+		sfree (str);
 	}
-	free(keys);
+	sfree (keys);
 } /* }}} void log_list_callbacks */
 
 static int create_register_callback (llist_t **list, /* {{{ */
 		const char *name, void *callback, user_data_t *ud)
 {
 	callback_func_t *cf;
 
-	cf = (callback_func_t *) malloc (sizeof (*cf));
+	cf = calloc (1, sizeof (*cf));
 	if (cf == NULL)
 	{
-		ERROR ("plugin: create_register_callback: malloc failed.");
+		ERROR ("plugin: create_register_callback: calloc failed.");
 		return (-1);
 	}
-	memset (cf, 0, sizeof (*cf));
 
 	cf->cf_callback = callback;
 	if (ud == NULL)
 	{
 		cf->cf_udata.data = NULL;
 		cf->cf_udata.free_func = NULL;
@@ -474,13 +480,15 @@
 static void *plugin_read_thread (void __attribute__((unused)) *args)
 {
 	while (read_loop != 0)
 	{
 		read_func_t *rf;
 		plugin_ctx_t old_ctx;
+		cdtime_t start;
 		cdtime_t now;
+		cdtime_t elapsed;
 		int status;
 		int rf_type;
 		int rc;
 
 		/* Get the read function that needs to be read next.
 		 * We don't need to hold "read_lock" for the heap, but we need
@@ -553,12 +561,14 @@
 			rf = NULL;
 			continue;
 		}
 
 		DEBUG ("plugin_read_thread: Handling `%s'.", rf->rf_name);
 
+		start = cdtime ();
+
 		old_ctx = plugin_set_ctx (rf->rf_ctx);
 
 		if (rf_type == RF_SIMPLE)
 		{
 			int (*callback) (void);
 
@@ -596,14 +606,28 @@
 			rf->rf_effective_interval = rf->rf_interval;
 		}
 
 		/* update the ``next read due'' field */
 		now = cdtime ();
 
+		/* calculate the time spent in the read function */
+		elapsed = (now - start);
+
+		if (elapsed > rf->rf_effective_interval)
+			WARNING ("plugin_read_thread: read-function of the `%s' plugin took %.3f "
+				"seconds, which is above its read interval (%.3f seconds). You might "
+				"want to adjust the `Interval' or `ReadThreads' settings.",
+				rf->rf_name, CDTIME_T_TO_DOUBLE(elapsed),
+				CDTIME_T_TO_DOUBLE(rf->rf_effective_interval));
+
+		DEBUG ("plugin_read_thread: read-function of the `%s' plugin took "
+				"%.6f seconds.",
+				rf->rf_name, CDTIME_T_TO_DOUBLE(elapsed));
+
 		DEBUG ("plugin_read_thread: Effective interval of the "
-				"%s plugin is %.3f seconds.",
+				"`%s' plugin is %.3f seconds.",
 				rf->rf_name,
 				CDTIME_T_TO_DOUBLE (rf->rf_effective_interval));
 
 		/* Calculate the next (absolute) time at which this function
 		 * should be called. */
 		rf->rf_next_read += rf->rf_effective_interval;
@@ -614,13 +638,13 @@
 			/* `rf_next_read' is in the past. Insert `now'
 			 * so this value doesn't trail off into the
 			 * past too much. */
 			rf->rf_next_read = now;
 		}
 
-		DEBUG ("plugin_read_thread: Next read of the %s plugin at %.3f.",
+		DEBUG ("plugin_read_thread: Next read of the `%s' plugin at %.3f.",
 				rf->rf_name,
 				CDTIME_T_TO_DOUBLE (rf->rf_next_read));
 
 		/* Re-insert this read function into the heap again. */
 		c_heap_insert (read_heap, rf);
 	} /* while (read_loop) */
@@ -628,26 +652,24 @@
 	pthread_exit (NULL);
 	return ((void *) 0);
 } /* void *plugin_read_thread */
 
 static void start_read_threads (int num)
 {
-	int i;
-
 	if (read_threads != NULL)
 		return;
 
 	read_threads = (pthread_t *) calloc (num, sizeof (pthread_t));
 	if (read_threads == NULL)
 	{
 		ERROR ("plugin: start_read_threads: calloc failed.");
 		return;
 	}
 
 	read_threads_num = 0;
-	for (i = 0; i < num; i++)
+	for (int i = 0; i < num; i++)
 	{
 		if (pthread_create (read_threads + read_threads_num, NULL,
 					plugin_read_thread, NULL) == 0)
 		{
 			read_threads_num++;
 		}
@@ -658,26 +680,24 @@
 		}
 	} /* for (i) */
 } /* void start_read_threads */
 
 static void stop_read_threads (void)
 {
-	int i;
-
 	if (read_threads == NULL)
 		return;
 
 	INFO ("collectd: Stopping %i read threads.", read_threads_num);
 
 	pthread_mutex_lock (&read_lock);
 	read_loop = 0;
 	DEBUG ("plugin: stop_read_threads: Signalling `read_cond'");
 	pthread_cond_broadcast (&read_cond);
 	pthread_mutex_unlock (&read_lock);
 
-	for (i = 0; i < read_threads_num; i++)
+	for (int i = 0; i < read_threads_num; i++)
 	{
 		if (pthread_join (read_threads[i], NULL) != 0)
 		{
 			ERROR ("plugin: stop_read_threads: pthread_join failed.");
 		}
 		read_threads[i] = (pthread_t) 0;
@@ -843,26 +863,24 @@
 	pthread_exit (NULL);
 	return ((void *) 0);
 } /* }}} void *plugin_write_thread */
 
 static void start_write_threads (size_t num) /* {{{ */
 {
-	size_t i;
-
 	if (write_threads != NULL)
 		return;
 
 	write_threads = (pthread_t *) calloc (num, sizeof (pthread_t));
 	if (write_threads == NULL)
 	{
 		ERROR ("plugin: start_write_threads: calloc failed.");
 		return;
 	}
 
 	write_threads_num = 0;
-	for (i = 0; i < num; i++)
+	for (size_t i = 0; i < num; i++)
 	{
 		int status;
 
 		status = pthread_create (write_threads + write_threads_num,
 				/* attr = */ NULL,
 				plugin_write_thread,
@@ -880,13 +898,13 @@
 	} /* for (i) */
 } /* }}} void start_write_threads */
 
 static void stop_write_threads (void) /* {{{ */
 {
 	write_queue_t *q;
-	int i;
+	size_t i;
 
 	if (write_threads == NULL)
 		return;
 
 	INFO ("collectd: Stopping %zu write threads.", write_threads_num);
 
@@ -921,42 +939,42 @@
 	write_queue_tail = NULL;
 	write_queue_length = 0;
 	pthread_mutex_unlock (&write_lock);
 
 	if (i > 0)
 	{
-		WARNING ("plugin: %i value list%s left after shutting down "
+		WARNING ("plugin: %zu value list%s left after shutting down "
 				"the write threads.",
 				i, (i == 1) ? " was" : "s were");
 	}
 } /* }}} void stop_write_threads */
 
 /*
  * Public functions
  */
 void plugin_set_dir (const char *dir)
 {
-	if (plugindir != NULL)
-		free (plugindir);
+	sfree (plugindir);
 
 	if (dir == NULL)
-		plugindir = NULL;
-	else if ((plugindir = strdup (dir)) == NULL)
 	{
-		char errbuf[1024];
-		ERROR ("strdup failed: %s",
-				sstrerror (errno, errbuf, sizeof (errbuf)));
+		plugindir = NULL;
+		return;
 	}
+
+	plugindir = strdup (dir);
+	if (plugindir == NULL)
+		ERROR ("plugin_set_dir: strdup(\"%s\") failed", dir);
 }
 
 static _Bool plugin_is_loaded (char const *name)
 {
 	int status;
 
 	if (plugins_loaded == NULL)
-		plugins_loaded = c_avl_create ((void *) strcasecmp);
+		plugins_loaded = c_avl_create ((int (*) (const void *, const void *)) strcasecmp);
 	assert (plugins_loaded != NULL);
 
 	status = c_avl_get (plugins_loaded, name, /* ret_value = */ NULL);
 	return (status == 0);
 }
 
@@ -1080,12 +1098,13 @@
 		status = plugin_load_file (filename, flags);
 		if (status == 0)
 		{
 			/* success */
 			plugin_mark_loaded (plugin_name);
 			ret = 0;
+			INFO ("plugin_load: plugin \"%s\" successfully loaded.", plugin_name);
 			break;
 		}
 		else
 		{
 			ERROR ("plugin_load: Load plugin \"%s\" failed with "
 					"status %i.", plugin_name, status);
@@ -1216,20 +1235,19 @@
 int plugin_register_read (const char *name,
 		int (*callback) (void))
 {
 	read_func_t *rf;
 	int status;
 
-	rf = malloc (sizeof (*rf));
+	rf = calloc (1, sizeof (*rf));
 	if (rf == NULL)
 	{
-		ERROR ("plugin_register_read: malloc failed.");
+		ERROR ("plugin_register_read: calloc failed.");
 		return (ENOMEM);
 	}
 
-	memset (rf, 0, sizeof (read_func_t));
 	rf->rf_callback = (void *) callback;
 	rf->rf_udata.data = NULL;
 	rf->rf_udata.free_func = NULL;
 	rf->rf_ctx = plugin_get_ctx ();
 	rf->rf_group[0] = '\0';
 	rf->rf_name = strdup (name);
@@ -1244,37 +1262,33 @@
 
 	return (status);
 } /* int plugin_register_read */
 
 int plugin_register_complex_read (const char *group, const char *name,
 		plugin_read_cb callback,
-		const struct timespec *interval,
+		cdtime_t interval,
 		user_data_t *user_data)
 {
 	read_func_t *rf;
 	int status;
 
-	rf = malloc (sizeof (*rf));
+	rf = calloc (1,sizeof (*rf));
 	if (rf == NULL)
 	{
-		ERROR ("plugin_register_complex_read: malloc failed.");
+		ERROR ("plugin_register_complex_read: calloc failed.");
 		return (ENOMEM);
 	}
 
-	memset (rf, 0, sizeof (read_func_t));
 	rf->rf_callback = (void *) callback;
 	if (group != NULL)
 		sstrncpy (rf->rf_group, group, sizeof (rf->rf_group));
 	else
 		rf->rf_group[0] = '\0';
 	rf->rf_name = strdup (name);
 	rf->rf_type = RF_COMPLEX;
-	if (interval != NULL)
-		rf->rf_interval = TIMESPEC_TO_CDTIME_T (interval);
-	else
-		rf->rf_interval = plugin_get_interval ();
+	rf->rf_interval = (interval != 0) ? interval : plugin_get_interval ();
 
 	/* Set user data */
 	if (user_data == NULL)
 	{
 		rf->rf_udata.data = NULL;
 		rf->rf_udata.free_func = NULL;
@@ -1299,17 +1313,110 @@
 		plugin_write_cb callback, user_data_t *ud)
 {
 	return (create_register_callback (&list_write, name,
 				(void *) callback, ud));
 } /* int plugin_register_write */
 
+static int plugin_flush_timeout_callback (user_data_t *ud)
+{
+	flush_callback_t *cb = ud->data;
+
+	return plugin_flush (cb->name, cb->timeout, /* identifier = */ NULL);
+} /* static int plugin_flush_callback */
+
+static void plugin_flush_timeout_callback_free (void *data)
+{
+	flush_callback_t *cb = data;
+
+	if (cb == NULL) return;
+
+	sfree (cb->name);
+	sfree (cb);
+} /* static void plugin_flush_callback_free */
+
+static char *plugin_flush_callback_name (const char *name)
+{
+	const char *flush_prefix = "flush/";
+	size_t prefix_size;
+	char *flush_name;
+	size_t name_size;
+
+	prefix_size = strlen(flush_prefix);
+	name_size = strlen(name);
+
+	flush_name = malloc (name_size + prefix_size + 1);
+	if (flush_name == NULL)
+	{
+		ERROR ("plugin_flush_callback_name: malloc failed.");
+		return (NULL);
+	}
+
+	sstrncpy (flush_name, flush_prefix, prefix_size + 1);
+	sstrncpy (flush_name + prefix_size, name, name_size + 1);
+
+	return flush_name;
+} /* static char *plugin_flush_callback_name */
+
 int plugin_register_flush (const char *name,
 		plugin_flush_cb callback, user_data_t *ud)
 {
-	return (create_register_callback (&list_flush, name,
-				(void *) callback, ud));
+	int status;
+	plugin_ctx_t ctx = plugin_get_ctx ();
+
+	status = create_register_callback (&list_flush, name,
+		(void *) callback, ud);
+	if (status != 0)
+		return status;
+
+	if (ctx.flush_interval != 0)
+	{
+		char *flush_name;
+		flush_callback_t *cb;
+
+		flush_name = plugin_flush_callback_name (name);
+		if (flush_name == NULL)
+			return (-1);
+
+		cb = malloc(sizeof (*cb));
+		if (cb == NULL)
+		{
+			ERROR ("plugin_register_flush: malloc failed.");
+			sfree (flush_name);
+			return (-1);
+		}
+
+		cb->name = strdup (name);
+		if (cb->name == NULL)
+		{
+			ERROR ("plugin_register_flush: strdup failed.");
+			sfree (cb);
+			sfree (flush_name);
+			return (-1);
+		}
+		cb->timeout = ctx.flush_timeout;
+
+		ud->data = cb;
+		ud->free_func = plugin_flush_timeout_callback_free;
+
+		status = plugin_register_complex_read (
+			/* group     = */ "flush",
+			/* name      = */ flush_name,
+			/* callback  = */ plugin_flush_timeout_callback,
+			/* interval  = */ ctx.flush_interval,
+			/* user data = */ ud);
+
+		sfree (flush_name);
+		if (status != 0)
+		{
+			sfree (cb->name);
+			sfree (cb);
+			return status;
+		}
+	}
+
+	return 0;
 } /* int plugin_register_flush */
 
 int plugin_register_missing (const char *name,
 		plugin_missing_cb callback, user_data_t *ud)
 {
 	return (create_register_callback (&list_missing, name,
@@ -1344,13 +1451,12 @@
 	data_sets = NULL;
 } /* void plugin_free_data_sets */
 
 int plugin_register_data_set (const data_set_t *ds)
 {
 	data_set_t *ds_copy;
-	int i;
 
 	if ((data_sets != NULL)
 			&& (c_avl_get (data_sets, ds->type, NULL) == 0))
 	{
 		NOTICE ("Replacing DS `%s' with another version.", ds->type);
 		plugin_unregister_data_set (ds->type);
@@ -1359,26 +1465,26 @@
 	{
 		data_sets = c_avl_create ((int (*) (const void *, const void *)) strcmp);
 		if (data_sets == NULL)
 			return (-1);
 	}
 
-	ds_copy = (data_set_t *) malloc (sizeof (data_set_t));
+	ds_copy = malloc (sizeof (*ds_copy));
 	if (ds_copy == NULL)
 		return (-1);
 	memcpy(ds_copy, ds, sizeof (data_set_t));
 
-	ds_copy->ds = (data_source_t *) malloc (sizeof (data_source_t)
+	ds_copy->ds = malloc (sizeof (*ds_copy->ds)
 			* ds->ds_num);
 	if (ds_copy->ds == NULL)
 	{
-		free (ds_copy);
+		sfree (ds_copy);
 		return (-1);
 	}
 
-	for (i = 0; i < ds->ds_num; i++)
+	for (size_t i = 0; i < ds->ds_num; i++)
 		memcpy (ds_copy->ds + i, ds->ds + i, sizeof (data_source_t));
 
 	return (c_avl_insert (data_sets, (void *) ds_copy->type, (void *) ds_copy));
 } /* int plugin_register_data_set */
 
 int plugin_register_log (const char *name,
@@ -1522,13 +1628,27 @@
 {
 	return (plugin_unregister (list_write, name));
 }
 
 int plugin_unregister_flush (const char *name)
 {
-	return (plugin_unregister (list_flush, name));
+	plugin_ctx_t ctx = plugin_get_ctx ();
+
+	if (ctx.flush_interval != 0)
+	{
+		char *flush_name;
+
+		flush_name = plugin_flush_callback_name (name);
+		if (flush_name != NULL)
+		{
+			plugin_unregister_read(flush_name);
+			sfree (flush_name);
+		}
+	}
+
+	return plugin_unregister (list_flush, name);
 }
 
 int plugin_unregister_missing (const char *name)
 {
 	return (plugin_unregister (list_missing, name));
 }
@@ -1561,17 +1681,18 @@
 
 int plugin_unregister_notification (const char *name)
 {
 	return (plugin_unregister (list_notification, name));
 }
 
-void plugin_init_all (void)
+int plugin_init_all (void)
 {
 	char const *chain_name;
 	llentry_t *le;
 	int status;
+	int ret = 0;
 
 	/* Init the value cache */
 	uc_init ();
 
 	if (IS_TRUE (global_option_get ("CollectInternalStats")))
 		record_statistics = 1;
@@ -1610,13 +1731,13 @@
 	{
 		ERROR ("WriteThreads must be positive.");
 		write_threads_num = 5;
 	}
 
 	if ((list_init == NULL) && (read_heap == NULL))
-		return;
+		return ret;
 
 	/* Calling all init callbacks before checking if read callbacks
 	 * are available allows the init callbacks to register the read
 	 * callback. */
 	le = llist_head (list_init);
 	while (le != NULL)
@@ -1639,12 +1760,13 @@
 					le->key, status);
 			/* Plugins that register read callbacks from the init
 			 * callback should take care of appropriate error
 			 * handling themselves. */
 			/* FIXME: Unload _all_ functions */
 			plugin_unregister_read (le->key);
+			ret = -1;
 		}
 
 		le = le->next;
 	}
 
 	start_write_threads ((size_t) write_threads_num);
@@ -1660,12 +1782,13 @@
 
 		rt = global_option_get ("ReadThreads");
 		num = atoi (rt);
 		if (num != -1)
 			start_read_threads ((num > 0) ? num : 5);
 	}
+	return ret;
 } /* void plugin_init_all */
 
 /* TODO: Rename this function. */
 void plugin_read_all (void)
 {
 	if(record_statistics) {
@@ -1843,15 +1966,16 @@
 
     le = le->next;
   }
   return (0);
 } /* int plugin_flush */
 
-void plugin_shutdown_all (void)
+int plugin_shutdown_all (void)
 {
 	llentry_t *le;
+	int ret = 0;  // Assume success.
 
 	destroy_all_callbacks (&list_init);
 
 	stop_read_threads ();
 
 	pthread_mutex_lock (&read_lock);
@@ -1886,13 +2010,14 @@
 		/* Advance the pointer before calling the callback allows
 		 * shutdown functions to unregister themselves. If done the
 		 * other way around the memory `le' points to will be freed
 		 * after callback returns. */
 		le = le->next;
 
-		(*callback) ();
+		if ((*callback) () != 0)
+			ret = -1;
 
 		plugin_set_ctx (old_ctx);
 	}
 
 	/* Write plugins which use the `user_data' pointer usually need the
 	 * same data available to the flush callback. If this is the case, set
@@ -1906,12 +2031,13 @@
 	destroy_all_callbacks (&list_notification);
 	destroy_all_callbacks (&list_shutdown);
 	destroy_all_callbacks (&list_log);
 
 	plugin_free_loaded ();
 	plugin_free_data_sets ();
+	return (ret);
 } /* void plugin_shutdown_all */
 
 int plugin_dispatch_missing (const value_list_t *vl) /* {{{ */
 {
   llentry_t *le;
 
@@ -1961,14 +2087,16 @@
 	int      saved_values_len;
 
 	data_set_t *ds;
 
 	int free_meta_data = 0;
 
-	if ((vl == NULL) || (vl->type[0] == 0)
-			|| (vl->values == NULL) || (vl->values_len < 1))
+	assert(vl);
+	assert(vl->plugin);
+
+	if (vl->type[0] == 0 || vl->values == NULL || vl->values_len < 1)
 	{
 		ERROR ("plugin_dispatch_values: Invalid value list "
 				"from plugin %s.", vl->plugin);
 		return (-1);
 	}
 
@@ -2029,14 +2157,14 @@
 #if COLLECT_DEBUG
 	assert (ds->ds_num == vl->values_len);
 #else
 	if (ds->ds_num != vl->values_len)
 	{
 		ERROR ("plugin_dispatch_values: ds->type = %s: "
-				"(ds->ds_num = %i) != "
-				"(vl->values_len = %i)",
+				"(ds->ds_num = %zu) != "
+				"(vl->values_len = %zu)",
 				ds->type, ds->ds_num, vl->values_len);
 		return (-1);
 	}
 #endif
 
 	escape_slashes (vl->host, sizeof (vl->host));
@@ -2083,13 +2211,13 @@
 		else if (status == FC_TARGET_STOP)
 		{
 			/* Restore the state of the value_list so that plugins
 			 * don't get confused.. */
 			if (saved_values != NULL)
 			{
-				free (vl->values);
+				sfree (vl->values);
 				vl->values     = saved_values;
 				vl->values_len = saved_values_len;
 			}
 			return (0);
 		}
 	}
@@ -2112,13 +2240,13 @@
 		fc_default_action (ds, vl);
 
 	/* Restore the state of the value_list so that plugins don't get
 	 * confused.. */
 	if (saved_values != NULL)
 	{
-		free (vl->values);
+		sfree (vl->values);
 		vl->values     = saved_values;
 		vl->values_len = saved_values_len;
 	}
 
 	if ((free_meta_data != 0) && (vl->meta != NULL))
 	{
@@ -2227,13 +2355,13 @@
 	int failed = 0;
 	gauge_t sum = 0.0;
 	va_list ap;
 
 	assert (template->values_len == 1);
 
-  /* Calculate sum for Gauge to calculate percent if needed */
+	/* Calculate sum for Gauge to calculate percent if needed */
 	if (DS_TYPE_GAUGE == store_type)	{
 		va_start (ap, store_type);
 		while (42)
 		{
 			char const *name;
 			gauge_t value;
@@ -2448,19 +2576,18 @@
   if ((n == NULL) || (name == NULL) || (value == NULL))
   {
     ERROR ("plugin_notification_meta_add: A pointer is NULL!");
     return (-1);
   }
 
-  meta = (notification_meta_t *) malloc (sizeof (notification_meta_t));
+  meta = calloc (1, sizeof (*meta));
   if (meta == NULL)
   {
-    ERROR ("plugin_notification_meta_add: malloc failed.");
+    ERROR ("plugin_notification_meta_add: calloc failed.");
     return (-1);
   }
-  memset (meta, 0, sizeof (notification_meta_t));
 
   sstrncpy (meta->name, name, sizeof (meta->name));
   meta->type = type;
 
   switch (type)
   {
@@ -2551,20 +2678,18 @@
   return (plugin_notification_meta_add (n, name, NM_TYPE_BOOLEAN, &value));
 }
 
 int plugin_notification_meta_copy (notification_t *dst,
     const notification_t *src)
 {
-  notification_meta_t *meta;
-
   assert (dst != NULL);
   assert (src != NULL);
   assert (dst != src);
   assert ((src->meta == NULL) || (src->meta != dst->meta));
 
-  for (meta = src->meta; meta != NULL; meta = meta->next)
+  for (notification_meta_t *meta = src->meta; meta != NULL; meta = meta->next)
   {
     if (meta->type == NM_TYPE_STRING)
       plugin_notification_meta_add_string (dst, meta->name,
           meta->nm_value.nm_string);
     else if (meta->type == NM_TYPE_SIGNED_INT)
       plugin_notification_meta_add_signed_int (dst, meta->name,
@@ -2598,13 +2723,17 @@
   while (this != NULL)
   {
     next = this->next;
 
     if (this->type == NM_TYPE_STRING)
     {
-      free ((char *)this->nm_value.nm_string);
+      /* Assign to a temporary variable to work around nm_string's const
+       * modifier. */
+      void *tmp = (void *) this->nm_value.nm_string;
+
+      sfree (tmp);
       this->nm_value.nm_string = NULL;
     }
     sfree (this);
 
     this = next;
   }
@@ -2705,13 +2834,13 @@
 
 	void *(*start_routine) (void *) = plugin_thread->start_routine;
 	void *plugin_arg = plugin_thread->arg;
 
 	plugin_set_ctx (plugin_thread->ctx);
 
-	free (plugin_thread);
+	sfree (plugin_thread);
 
 	return start_routine (plugin_arg);
 } /* void *plugin_thread_start */
 
 int plugin_thread_create (pthread_t *thread, const pthread_attr_t *attr,
 		void *(*start_routine) (void *), void *arg)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/plugin.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/plugin.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/plugin.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/plugin.h	2016-09-11 16:10:25.259038726 +0800
@@ -1,8 +1,8 @@
 /**
- * collectd - src/plugin.h
+ * collectd - src/daemon/plugin.h
  * Copyright (C) 2005-2014  Florian octo Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
@@ -26,23 +26,24 @@
  **/
 
 #ifndef PLUGIN_H
 #define PLUGIN_H
 
 #include "collectd.h"
+
 #include "configfile.h"
 #include "meta_data.h"
 #include "utils_time.h"
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
+#include <pthread.h>
 
 #define PLUGIN_FLAGS_GLOBAL 0x0001
 
-#define DATA_MAX_NAME_LEN 64
+#ifndef DATA_MAX_NAME_LEN
+# define DATA_MAX_NAME_LEN 128
+#endif
 
 #define DS_TYPE_COUNTER  0
 #define DS_TYPE_GAUGE    1
 #define DS_TYPE_DERIVE   2
 #define DS_TYPE_ABSOLUTE 3
 
@@ -94,13 +95,13 @@
 };
 typedef union value_u value_t;
 
 struct value_list_s
 {
 	value_t *values;
-	int      values_len;
+	size_t   values_len;
 	cdtime_t time;
 	cdtime_t interval;
 	char     host[DATA_MAX_NAME_LEN];
 	char     plugin[DATA_MAX_NAME_LEN];
 	char     plugin_instance[DATA_MAX_NAME_LEN];
 	char     type[DATA_MAX_NAME_LEN];
@@ -122,13 +123,13 @@
 };
 typedef struct data_source_s data_source_t;
 
 struct data_set_s
 {
 	char           type[DATA_MAX_NAME_LEN];
-	int            ds_num;
+	size_t         ds_num;
 	data_source_t *ds;
 };
 typedef struct data_set_s data_set_t;
 
 enum notification_meta_type_e
 {
@@ -174,12 +175,14 @@
 };
 typedef struct user_data_s user_data_t;
 
 struct plugin_ctx_s
 {
 	cdtime_t interval;
+	cdtime_t flush_interval;
+	cdtime_t flush_timeout;
 };
 typedef struct plugin_ctx_s plugin_ctx_t;
 
 /*
  * Callback types
  */
@@ -235,16 +237,16 @@
  * NOTES
  *  Re-loading an already loaded module is detected and zero is returned in
  *  this case.
  */
 int plugin_load (const char *name, uint32_t flags);
 
-void plugin_init_all (void);
+int plugin_init_all (void);
 void plugin_read_all (void);
 int plugin_read_all_once (void);
-void plugin_shutdown_all (void);
+int plugin_shutdown_all (void);
 
 /*
  * NAME
  *  plugin_write
  *
  * DESCRIPTION
@@ -290,13 +292,13 @@
 int plugin_register_read (const char *name,
 		int (*callback) (void));
 /* "user_data" will be freed automatically, unless
  * "plugin_register_complex_read" returns an error (non-zero). */
 int plugin_register_complex_read (const char *group, const char *name,
 		plugin_read_cb callback,
-		const struct timespec *interval,
+		cdtime_t interval,
 		user_data_t *user_data);
 int plugin_register_write (const char *name,
 		plugin_write_cb callback, user_data_t *user_data);
 int plugin_register_flush (const char *name,
 		plugin_flush_cb callback, user_data_t *user_data);
 int plugin_register_missing (const char *name,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/types_list.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/types_list.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/types_list.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/types_list.c	2016-09-11 16:10:25.259038726 +0800
@@ -99,41 +100,42 @@
 
 static void parse_line (char *buf)
 {
   char  *fields[64];
   size_t fields_num;
   data_set_t *ds;
-  int i;
 
   fields_num = strsplit (buf, fields, 64);
   if (fields_num < 2)
     return;
 
   /* Ignore lines which begin with a hash sign. */
   if (fields[0][0] == '#')
     return;
 
-  ds = (data_set_t *) malloc (sizeof (data_set_t));
+  ds = calloc (1, sizeof (*ds));
   if (ds == NULL)
     return;
 
-  memset (ds, '\0', sizeof (data_set_t));
-
   sstrncpy (ds->type, fields[0], sizeof (ds->type));
 
   ds->ds_num = fields_num - 1;
   ds->ds = (data_source_t *) calloc (ds->ds_num, sizeof (data_source_t));
   if (ds->ds == NULL)
+  {
+    sfree (ds);
     return;
+  }
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
     if (parse_ds (ds->ds + i, fields[i + 1], strlen (fields[i + 1])) != 0)
     {
-      sfree (ds->ds);
-      ERROR ("types_list: parse_line: Cannot parse data source #%i "
+      ERROR ("types_list: parse_line: Cannot parse data source #%zu "
 	  "of data set %s", i, ds->type);
+      sfree (ds->ds);
+      sfree (ds);
       return;
     }
 
   plugin_register_data_set (ds);
 
   sfree (ds->ds);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree.c	2016-09-11 16:10:25.259038726 +0800
@@ -21,17 +21,13 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
-#include "config.h"
-
 #include <stdlib.h>
-#include <stdio.h>
-#include <string.h>
 #include <assert.h>
 
 #include "utils_avltree.h"
 
 #define BALANCE(n) ((((n)->left == NULL) ? 0 : (n)->left->height) \
 		- (((n)->right == NULL) ? 0 : (n)->right->height))
@@ -482,13 +478,13 @@
 {
 	c_avl_tree_t *t;
 
 	if (compare == NULL)
 		return (NULL);
 
-	if ((t = (c_avl_tree_t *) malloc (sizeof (c_avl_tree_t))) == NULL)
+	if ((t = malloc (sizeof (*t))) == NULL)
 		return (NULL);
 
 	t->root = NULL;
 	t->compare = compare;
 	t->size = 0;
 
@@ -506,13 +502,13 @@
 int c_avl_insert (c_avl_tree_t *t, void *key, void *value)
 {
 	c_avl_node_t *new;
 	c_avl_node_t *nptr;
 	int cmp;
 
-	if ((new = (c_avl_node_t *) malloc (sizeof (c_avl_node_t))) == NULL)
+	if ((new = malloc (sizeof (*new))) == NULL)
 		return (-1);
 
 	new->key = key;
 	new->value = value;
 	new->height = 1;
 	new->left = NULL;
@@ -662,16 +658,15 @@
 {
 	c_avl_iterator_t *iter;
 
 	if (t == NULL)
 		return (NULL);
 
-	iter = (c_avl_iterator_t *) malloc (sizeof (c_avl_iterator_t));
+	iter = calloc (1, sizeof (*iter));
 	if (iter == NULL)
 		return (NULL);
-	memset (iter, '\0', sizeof (c_avl_iterator_t));
 	iter->tree = t;
 
 	return (iter);
 } /* c_avl_iterator_t *c_avl_get_iterator */
 
 int c_avl_iterator_next (c_avl_iterator_t *iter, void **key, void **value)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree.h	2016-09-11 16:10:25.259038726 +0800
@@ -39,13 +39,13 @@
  *
  * DESCRIPTION
  *   Allocates a new AVL-tree.
  *
  * PARAMETERS
  *   `compare'  The function-pointer `compare' is used to compare two keys. It
- *              has to return less than zero if it's first argument is smaller
+ *              has to return less than zero if its first argument is smaller
  *              then the second argument, more than zero if the first argument
  *              is bigger than the second argument and zero if they are equal.
  *              If your keys are char-pointers, you can use the `strcmp'
  *              function from the libc here.
  *
  * RETURN VALUE
@@ -128,13 +128,13 @@
 
 /*
  * NAME
  *   c_avl_pick
  *
  * DESCRIPTION
- *   Remove a (pseudo-)random element from the tree and return it's `key' and
+ *   Remove a (pseudo-)random element from the tree and return its `key' and
  *   `value'. Entries are not returned in any particular order. This function
  *   is intended for cache-flushes that don't care about the order but simply
  *   want to remove all elements, one at a time.
  *
  * PARAMETERS
  *   `t'	AVL-tree to get the value from.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_avltree_test.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_avltree_test.c	2016-09-11 16:10:25.259038726 +0800
@@ -21,14 +21,16 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
-#include "testing.h"
+#include "common.h" /* STATIC_ARRAY_SIZE */
 #include "collectd.h"
+
+#include "testing.h"
 #include "utils_avltree.h"
 
 static int compare_total_count = 0;
 #define RESET_COUNTS() do { compare_total_count = 0; } while (0)
 
 static int compare_callback (void const *v0, void const *v1)
@@ -39,36 +41,104 @@
   compare_total_count++;
   return (strcmp (v0, v1));
 }
 
 DEF_TEST(success)
 {
+  struct {
+    char *key;
+    char *value;
+  } cases[] = {
+    {"Eeph7chu", "vai1reiV"},
+    {"igh3Paiz", "teegh1Ee"},
+    {"caip6Uu8", "ooteQu8n"},
+    {"Aech6vah", "AijeeT0l"},
+    {"Xah0et2L", "gah8Taep"},
+    {"BocaeB8n", "oGaig8io"},
+    {"thai8AhM", "ohjeFo3f"},
+    {"ohth6ieC", "hoo8ieWo"},
+    {"aej7Woow", "phahuC2s"},
+    {"Hai8ier2", "Yie6eimi"},
+    {"phuXi3Li", "JaiF7ieb"},
+    {"Shaig5ef", "aihi5Zai"},
+    {"voh6Aith", "Oozaeto0"},
+    {"zaiP5kie", "seep5veM"},
+    {"pae7ba7D", "chie8Ojo"},
+    {"Gou2ril3", "ouVoo0ha"},
+    {"lo3Thee3", "ahDu4Zuj"},
+    {"Rah8kohv", "ieShoc7E"},
+    {"ieN5engi", "Aevou1ah"},
+    {"ooTe4OhP", "aingai5Y"},
+  };
+
   c_avl_tree_t *t;
-  char key_orig[] = "foo";
-  char value_orig[] = "bar";
-  char *key_ret = NULL;
-  char *value_ret = NULL;
 
   RESET_COUNTS ();
-  t = c_avl_create (compare_callback);
-  OK (t != NULL);
+  CHECK_NOT_NULL (t = c_avl_create (compare_callback));
 
-  OK (c_avl_insert (t, key_orig, value_orig) == 0);
-  OK (c_avl_size (t) == 1);
+  /* insert */
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++)
+  {
+    char *key;
+    char *value;
+
+    CHECK_NOT_NULL (key = strdup (cases[i].key));
+    CHECK_NOT_NULL (value = strdup (cases[i].value));
+
+    CHECK_ZERO (c_avl_insert (t, key, value));
+    EXPECT_EQ_INT ((int) (i + 1), c_avl_size (t));
+  }
 
   /* Key already exists. */
-  OK (c_avl_insert (t, "foo", "qux") > 0);
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++)
+    EXPECT_EQ_INT (1, c_avl_insert (t, cases[i].key, cases[i].value));
+
+  /* get */
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases); i++)
+  {
+    char *value_ret = NULL;
+
+    CHECK_ZERO (c_avl_get (t, cases[i].key, (void *) &value_ret));
+    EXPECT_EQ_STR (cases[i].value, value_ret);
+  }
+
+  /* remove half */
+  for (size_t i = 0; i < STATIC_ARRAY_SIZE (cases) / 2; i++)
+  {
+    char *key = NULL;
+    char *value = NULL;
+
+    int expected_size = (int) (STATIC_ARRAY_SIZE (cases) - (i + 1));
+
+    CHECK_ZERO (c_avl_remove (t, cases[i].key, (void *) &key, (void *) &value));
+
+    EXPECT_EQ_STR (cases[i].key, key);
+    EXPECT_EQ_STR (cases[i].value, value);
+
+    free (key);
+    free (value);
+
+    EXPECT_EQ_INT (expected_size, c_avl_size (t));
+  }
+
+  /* pick the other half */
+  for (size_t i = STATIC_ARRAY_SIZE (cases) / 2; i < STATIC_ARRAY_SIZE (cases); i++)
+  {
+    char *key = NULL;
+    char *value = NULL;
+
+    int expected_size = (int) (STATIC_ARRAY_SIZE (cases) - (i + 1));
+
+    EXPECT_EQ_INT (expected_size + 1, c_avl_size (t));
+    EXPECT_EQ_INT (0, c_avl_pick (t, (void *) &key, (void *) &value));
 
-  OK (c_avl_get (t, "foo", (void *) &value_ret) == 0);
-  OK (value_ret == &value_orig[0]);
+    free (key);
+    free (value);
 
-  key_ret = value_ret = NULL;
-  OK (c_avl_remove (t, "foo", (void *) &key_ret, (void *) &value_ret) == 0);
-  OK (key_ret == &key_orig[0]);
-  OK (value_ret == &value_orig[0]);
-  OK (c_avl_size (t) == 0);
+    EXPECT_EQ_INT (expected_size, c_avl_size (t));
+  }
 
   c_avl_destroy (t);
 
   return (0);
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache.c	2016-09-11 16:10:25.259038726 +0800
@@ -1,9 +1,10 @@
 /**
  * collectd - src/utils_cache.c
  * Copyright (C) 2007-2010  Florian octo Forster
+ * Copyright (C) 2016       Sebastian tokkee Harl
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -19,15 +20,17 @@
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
+ *   Sebastian tokkee Harl <sh at tokkee.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 #include "utils_avltree.h"
 #include "utils_cache.h"
 #include "meta_data.h"
 
@@ -29,28 +32,27 @@
 #include "plugin.h"
 #include "utils_avltree.h"
 #include "utils_cache.h"
 #include "meta_data.h"
 
 #include <assert.h>
-#include <pthread.h>
 
 typedef struct cache_entry_s
 {
 	char name[6 * DATA_MAX_NAME_LEN];
-	int        values_num;
+	size_t     values_num;
 	gauge_t   *values_gauge;
 	value_t   *values_raw;
 	/* Time contained in the package
 	 * (for calculating rates) */
 	cdtime_t last_time;
 	/* Time according to the local clock
 	 * (for purging old entries) */
 	cdtime_t last_update;
 	/* Interval in which the data is collected
-	 * (for purding old entries) */
+	 * (for purging old entries) */
 	cdtime_t interval;
 	int state;
 	int hits;
 
 	/*
 	 * +-----+-----+-----+-----+-----+-----+-----+-----+-----+----
@@ -65,34 +67,40 @@
 	size_t   history_index; /* points to the next position to write to. */
 	size_t   history_length;
 
 	meta_data_t *meta;
 } cache_entry_t;
 
+struct uc_iter_s {
+  c_avl_iterator_t *iter;
+
+  char *name;
+  cache_entry_t *entry;
+};
+
 static c_avl_tree_t   *cache_tree = NULL;
 static pthread_mutex_t cache_lock = PTHREAD_MUTEX_INITIALIZER;
 
 static int cache_compare (const cache_entry_t *a, const cache_entry_t *b)
 {
 #if COLLECT_DEBUG
   assert ((a != NULL) && (b != NULL));
 #endif
   return (strcmp (a->name, b->name));
 } /* int cache_compare */
 
-static cache_entry_t *cache_alloc (int values_num)
+static cache_entry_t *cache_alloc (size_t values_num)
 {
   cache_entry_t *ce;
 
-  ce = (cache_entry_t *) malloc (sizeof (cache_entry_t));
+  ce = calloc (1, sizeof (*ce));
   if (ce == NULL)
   {
-    ERROR ("utils_cache: cache_alloc: malloc failed.");
+    ERROR ("utils_cache: cache_alloc: calloc failed.");
     return (NULL);
   }
-  memset (ce, '\0', sizeof (cache_entry_t));
   ce->values_num = values_num;
 
   ce->values_gauge = calloc (values_num, sizeof (*ce->values_gauge));
   ce->values_raw   = calloc (values_num, sizeof (*ce->values_raw));
   if ((ce->values_gauge == NULL) || (ce->values_raw == NULL))
   {
@@ -125,15 +133,13 @@
   }
   sfree (ce);
 } /* void cache_free */
 
 static void uc_check_range (const data_set_t *ds, cache_entry_t *ce)
 {
-  int i;
-
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     if (isnan (ce->values_gauge[i]))
       continue;
     else if (ce->values_gauge[i] < ds->ds[i].min)
       ce->values_gauge[i] = NAN;
     else if (ce->values_gauge[i] > ds->ds[i].max)
@@ -141,13 +147,12 @@
   }
 } /* void uc_check_range */
 
 static int uc_insert (const data_set_t *ds, const value_list_t *vl,
     const char *key)
 {
-  int i;
   char *key_copy;
   cache_entry_t *ce;
 
   /* `cache_lock' has been locked by `uc_update' */
 
   key_copy = strdup (key);
@@ -158,19 +163,19 @@
   }
 
   ce = cache_alloc (ds->ds_num);
   if (ce == NULL)
   {
     sfree (key_copy);
-    ERROR ("uc_insert: cache_alloc (%i) failed.", ds->ds_num);
+    ERROR ("uc_insert: cache_alloc (%zu) failed.", ds->ds_num);
     return (-1);
   }
 
   sstrncpy (ce->name, key, sizeof (ce->name));
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     switch (ds->ds[i].type)
     {
       case DS_TYPE_COUNTER:
 	ce->values_gauge[i] = NAN;
 	ce->values_raw[i].counter = vl->values[i].counter;
@@ -243,14 +248,13 @@
   int keys_len = 0;
 
   char *key;
   c_avl_iterator_t *iter;
 
   int status;
-  int i;
-  
+
   pthread_mutex_lock (&cache_lock);
 
   now = cdtime ();
 
   /* Build a list of entries to be flushed */
   iter = c_avl_get_iterator (cache_tree);
@@ -261,13 +265,13 @@
 
     /* If the entry is fresh enough, continue. */
     if ((now - ce->last_update) < (ce->interval * timeout_g))
       continue;
 
     /* If entry has not been updated, add to `keys' array */
-    tmp = (char **) realloc ((void *) keys,
+    tmp = realloc ((void *) keys,
 	(keys_len + 1) * sizeof (char *));
     if (tmp == NULL)
     {
       ERROR ("uc_check_timeout: realloc failed.");
       continue;
     }
@@ -315,13 +319,13 @@
 
   /* Call the "missing" callback for each value. Do this before removing the
    * value from the cache, so that callbacks can still access the data stored,
    * including plugin specific meta data, rates, history, …. This must be done
    * without holding the lock, otherwise we will run into a deadlock if a
    * plugin calls the cache interface. */
-  for (i = 0; i < keys_len; i++)
+  for (int i = 0; i < keys_len; i++)
   {
     value_list_t vl = VALUE_LIST_INIT;
 
     vl.values = NULL;
     vl.values_len = 0;
     vl.meta = NULL;
@@ -340,13 +344,13 @@
   } /* for (i = 0; i < keys_len; i++) */
 
   /* Now actually remove all the values from the cache. We don't re-evaluate
    * the timestamp again, so in theory it is possible we remove a value after
    * it is updated here. */
   pthread_mutex_lock (&cache_lock);
-  for (i = 0; i < keys_len; i++)
+  for (int i = 0; i < keys_len; i++)
   {
     key = NULL;
     ce = NULL;
 
     status = c_avl_remove (cache_tree, keys[i],
 	(void *) &key, (void *) &ce);
@@ -372,13 +376,12 @@
 
 int uc_update (const data_set_t *ds, const value_list_t *vl)
 {
   char name[6 * DATA_MAX_NAME_LEN];
   cache_entry_t *ce = NULL;
   int status;
-  int i;
 
   if (FORMAT_VL (name, sizeof (name), vl) != 0)
   {
     ERROR ("uc_update: FORMAT_VL failed.");
     return (-1);
   }
@@ -404,35 +407,19 @@
 	name,
 	CDTIME_T_TO_DOUBLE (vl->time),
 	CDTIME_T_TO_DOUBLE (ce->last_time));
     return (-1);
   }
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     switch (ds->ds[i].type)
     {
       case DS_TYPE_COUNTER:
 	{
-	  counter_t diff;
-
-	  /* check if the counter has wrapped around */
-	  if (vl->values[i].counter < ce->values_raw[i].counter)
-	  {
-	    if (ce->values_raw[i].counter <= 4294967295U)
-	      diff = (4294967295U - ce->values_raw[i].counter)
-		+ vl->values[i].counter;
-	    else
-	      diff = (18446744073709551615ULL - ce->values_raw[i].counter)
-		+ vl->values[i].counter;
-	  }
-	  else /* counter has NOT wrapped around */
-	  {
-	    diff = vl->values[i].counter - ce->values_raw[i].counter;
-	  }
-
+	  counter_t diff = counter_diff (ce->values_raw[i].counter, vl->values[i].counter);
 	  ce->values_gauge[i] = ((double) diff)
 	    / (CDTIME_T_TO_DOUBLE (vl->time - ce->last_time));
 	  ce->values_raw[i].counter = vl->values[i].counter;
 	}
 	break;
 
@@ -440,15 +427,13 @@
 	ce->values_raw[i].gauge = vl->values[i].gauge;
 	ce->values_gauge[i] = vl->values[i].gauge;
 	break;
 
       case DS_TYPE_DERIVE:
 	{
-	  derive_t diff;
-
-	  diff = vl->values[i].derive - ce->values_raw[i].derive;
+	  derive_t diff = vl->values[i].derive - ce->values_raw[i].derive;
 
 	  ce->values_gauge[i] = ((double) diff)
 	    / (CDTIME_T_TO_DOUBLE (vl->time - ce->last_time));
 	  ce->values_raw[i].derive = vl->values[i].derive;
 	}
 	break;
@@ -464,20 +449,20 @@
 	pthread_mutex_unlock (&cache_lock);
 	ERROR ("uc_update: Don't know how to handle data source type %i.",
 	    ds->ds[i].type);
 	return (-1);
     } /* switch (ds->ds[i].type) */
 
-    DEBUG ("uc_update: %s: ds[%i] = %lf", name, i, ce->values_gauge[i]);
+    DEBUG ("uc_update: %s: ds[%zu] = %lf", name, i, ce->values_gauge[i]);
   } /* for (i) */
 
   /* Update the history if it exists. */
   if (ce->history != NULL)
   {
     assert (ce->history_index < ce->history_length);
-    for (i = 0; i < ce->values_num; i++)
+    for (size_t i = 0; i < ce->values_num; i++)
     {
       size_t hist_idx = (ce->values_num * ce->history_index) + i;
       ce->history[hist_idx] = ce->values_gauge[i];
     }
 
     assert (ce->history_length > 0);
@@ -514,13 +499,13 @@
     {
       status = -1;
     }
     else
     {
       ret_num = ce->values_num;
-      ret = (gauge_t *) malloc (ret_num * sizeof (gauge_t));
+      ret = malloc (ret_num * sizeof (*ret));
       if (ret == NULL)
       {
         ERROR ("utils_cache: uc_get_rate_by_name: malloc failed.");
         status = -1;
       }
       else
@@ -564,13 +549,13 @@
     return (NULL);
 
   /* This is important - the caller has no other way of knowing how many
    * values are returned. */
   if (ret_num != (size_t) ds->ds_num)
   {
-    ERROR ("utils_cache: uc_get_rate: ds[%s] has %i values, "
+    ERROR ("utils_cache: uc_get_rate: ds[%s] has %zu values, "
 	"but uc_get_rate_by_name returned %zu.",
 	ds->type, ds->ds_num, ret_num);
     sfree (ret);
     return (NULL);
   }
 
@@ -651,15 +636,13 @@
 
   c_avl_iterator_destroy (iter);
   pthread_mutex_unlock (&cache_lock);
 
   if (status != 0)
   {
-    size_t i;
-
-    for (i = 0; i < number; i++)
+    for (size_t i = 0; i < number; i++)
     {
       sfree (names[i]);
     }
     sfree (names);
     sfree (times);
 
@@ -728,13 +711,12 @@
 } /* int uc_set_state */
 
 int uc_get_history_by_name (const char *name,
     gauge_t *ret_history, size_t num_steps, size_t num_ds)
 {
   cache_entry_t *ce = NULL;
-  size_t i;
   int status = 0;
 
   pthread_mutex_lock (&cache_lock);
 
   status = c_avl_get (cache_tree, name, (void *) &ce);
   if (status != 0)
@@ -760,23 +742,23 @@
     if (tmp == NULL)
     {
       pthread_mutex_unlock (&cache_lock);
       return (-ENOMEM);
     }
 
-    for (i = ce->history_length * ce->values_num;
+    for (size_t i = ce->history_length * ce->values_num;
 	i < (num_steps * ce->values_num);
 	i++)
       tmp[i] = NAN;
 
     ce->history = tmp;
     ce->history_length = num_steps;
   } /* if (ce->history_length < num_steps) */
 
   /* Copy the values to the output buffer. */
-  for (i = 0; i < num_steps; i++)
+  for (size_t i = 0; i < num_steps; i++)
   {
     size_t src_index;
     size_t dst_index;
 
     if (i < ce->history_index)
       src_index = ce->history_index - (i + 1);
@@ -884,12 +866,108 @@
   pthread_mutex_unlock (&cache_lock);
 
   return (ret);
 } /* int uc_inc_hits */
 
 /*
+ * Iterator interface
+ */
+uc_iter_t *uc_get_iterator (void)
+{
+  uc_iter_t *iter;
+
+  iter = (uc_iter_t *) calloc(1, sizeof (*iter));
+  if (iter == NULL)
+    return (NULL);
+
+  pthread_mutex_lock (&cache_lock);
+
+  iter->iter = c_avl_get_iterator (cache_tree);
+  if (iter->iter == NULL)
+  {
+    free (iter);
+    return (NULL);
+  }
+
+  return (iter);
+} /* uc_iter_t *uc_get_iterator */
+
+int uc_iterator_next (uc_iter_t *iter, char **ret_name)
+{
+  int status;
+
+  if (iter == NULL)
+    return (-1);
+
+  while ((status = c_avl_iterator_next (iter->iter,
+	  (void *) &iter->name, (void *) &iter->entry)) == 0)
+  {
+    if (iter->entry->state == STATE_MISSING)
+      continue;
+
+    break;
+  }
+  if (status != 0) {
+    iter->name = NULL;
+    iter->entry = NULL;
+    return (-1);
+  }
+
+  if (ret_name != NULL)
+    *ret_name = iter->name;
+
+  return (0);
+} /* int uc_iterator_next */
+
+void uc_iterator_destroy (uc_iter_t *iter)
+{
+  if (iter == NULL)
+    return;
+
+  c_avl_iterator_destroy (iter->iter);
+  pthread_mutex_unlock (&cache_lock);
+
+  free (iter);
+} /* void uc_iterator_destroy */
+
+int uc_iterator_get_time (uc_iter_t *iter, cdtime_t *ret_time)
+{
+  if ((iter == NULL) || (iter->entry == NULL) || (ret_time == NULL))
+    return (-1);
+
+  *ret_time = iter->entry->last_time;
+  return (0);
+} /* int uc_iterator_get_name */
+
+int uc_iterator_get_values (uc_iter_t *iter, value_t **ret_values, size_t *ret_num)
+{
+  if ((iter == NULL) || (iter->entry == NULL)
+      || (ret_values == NULL) || (ret_num == NULL))
+    return (-1);
+
+  *ret_values = calloc (iter->entry->values_num, sizeof(*iter->entry->values_raw));
+  if (*ret_values == NULL)
+    return (-1);
+  for (size_t i = 0; i < iter->entry->values_num; ++i)
+    *ret_values[i] = iter->entry->values_raw[i];
+
+  *ret_num = iter->entry->values_num;
+
+  return (0);
+} /* int uc_iterator_get_values */
+
+int uc_iterator_get_interval (uc_iter_t *iter, cdtime_t *ret_interval)
+{
+  if ((iter == NULL) || (iter->entry == NULL) || (ret_interval == NULL))
+    return (-1);
+
+  *ret_interval = iter->entry->interval;
+  return (0);
+} /* int uc_iterator_get_name */
+
+/*
  * Meta data interface
  */
 /* XXX: This function will acquire `cache_lock' but will not free it! */
 static meta_data_t *uc_get_meta (const value_list_t *vl) /* {{{ */
 {
   char name[6 * DATA_MAX_NAME_LEN];
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache.h	2016-09-11 16:10:25.259038726 +0800
@@ -1,9 +1,10 @@
 /**
- * collectd - src/utils_cache.h
+ * collectd - utils_cache.h
  * Copyright (C) 2007       Florian octo Forster
+ * Copyright (C) 2016       Sebastian tokkee Harl
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -19,12 +20,13 @@
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
+ *   Sebastian tokkee Harl <sh at tokkee.org>
  **/
 
 #ifndef UTILS_CACHE_H
 #define UTILS_CACHE_H 1
 
 #include "plugin.h"
@@ -52,12 +54,59 @@
 int uc_get_history (const data_set_t *ds, const value_list_t *vl,
     gauge_t *ret_history, size_t num_steps, size_t num_ds);
 int uc_get_history_by_name (const char *name,
     gauge_t *ret_history, size_t num_steps, size_t num_ds);
 
 /*
+ * Iterator interface
+ */
+struct uc_iter_s;
+typedef struct uc_iter_s uc_iter_t;
+
+/*
+ * NAME
+ *   uc_get_iterator
+ *
+ * DESCRIPTION
+ *   Create an iterator for the cache. It will hold the cache lock until it's
+ *   destroyed.
+ *
+ * RETURN VALUE
+ *   An iterator object on success or NULL else.
+ */
+uc_iter_t *uc_get_iterator (void);
+
+/*
+ * NAME
+ *   uc_iterator_next
+ *
+ * DESCRIPTION
+ *   Advance the iterator to the next positiion and (optionally) returns the
+ *   name of the entry.
+ *
+ * PARAMETERS
+ *   `iter'     The iterator object to advance.
+ *   `ret_name' Pointer to a string where to store the name. The returned
+ *              value is a copy of the value and has to be freed by the
+ *              caller.
+ *
+ * RETURN VALUE
+ *   Zero upon success or non-zero if the iterator ie NULL or no further
+ *   values are available.
+ */
+int uc_iterator_next (uc_iter_t *iter, char **ret_name);
+void uc_iterator_destroy (uc_iter_t *iter);
+
+/* Return the timestamp of the value at the current position. */
+int uc_iterator_get_time (uc_iter_t *iter, cdtime_t *ret_time);
+/* Return the (raw) value at the current position. */
+int uc_iterator_get_values (uc_iter_t *iter, value_t **ret_values, size_t *ret_num);
+/* Return the interval of the value at the current position. */
+int uc_iterator_get_interval (uc_iter_t *iter, cdtime_t *ret_interval);
+
+/*
  * Meta data interface
  */
 int uc_meta_data_exists (const value_list_t *vl, const char *key);
 int uc_meta_data_delete (const value_list_t *vl, const char *key);
 
 int uc_meta_data_add_string (const value_list_t *vl,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache_mock.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache_mock.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_cache_mock.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_cache_mock.c	2016-09-11 16:10:25.259038726 +0800
@@ -23,10 +23,11 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
 #include "utils_cache.h"
 
-gauge_t *uc_get_rate (const data_set_t *ds, const value_list_t *vl)
+gauge_t *uc_get_rate (__attribute__((unused)) data_set_t const *ds,
+                      __attribute__((unused)) value_list_t const *vl)
 {
   return (NULL);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_complain.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_complain.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_complain.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_complain.c	2016-09-11 16:10:25.259038726 +0800
@@ -24,16 +24,18 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Sebastian tokkee Harl <sh at tokkee.org>
  **/
 
 #include "collectd.h"
+
 #include "utils_complain.h"
 #include "plugin.h"
 
 /* vcomplain returns 0 if it did not report, 1 else */
+__attribute__ ((format (printf, 3, 0)))
 static int vcomplain (int level, c_complain_t *c,
 		const char *format, va_list ap)
 {
 	cdtime_t now;
 	char   message[512];
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_complain.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_complain.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_complain.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_complain.h	2016-09-11 16:10:25.259038726 +0800
@@ -63,12 +63,13 @@
  *
  * PARAMETERS
  *   `level'  The log level passed to `plugin_log'.
  *   `c'      Identifier for the complaint.
  *   `format' Message format - see the documentation of printf(3).
  */
+__attribute__ ((format(printf,3,4)))
 void c_complain (int level, c_complain_t *c, const char *format, ...);
 
 /*
  * NAME
  *   c_complain_once
  *
@@ -77,12 +78,13 @@
  *   again, unless `c_release' has been called in between. If used after some
  *   calls to `c_complain', it will report again on the next interval and stop
  *   after that.
  *
  *   See `c_complain' for further details and a description of the parameters.
  */
+__attribute__ ((format(printf,3,4)))
 void c_complain_once (int level, c_complain_t *c, const char *format, ...);
 
 /*
  * NAME
  *   c_would_release
  *
@@ -98,12 +100,13 @@
  * DESCRIPTION
  *   Release a complaint. This will report a message once, marking the
  *   complaint as released.
  *
  *   See `c_complain' for a description of the parameters.
  */
+__attribute__ ((format(printf,3,4)))
 void c_do_release (int level, c_complain_t *c, const char *format, ...);
 #define c_release(level, c, ...) \
 	do { \
 		if (c_would_release (c)) \
 			c_do_release(level, c, __VA_ARGS__); \
 	} while (0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap.c	2016-09-11 16:10:25.259038726 +0800
@@ -22,13 +22,12 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include <stdlib.h>
-#include <string.h>
 #include <errno.h>
 #include <assert.h>
 #include <pthread.h>
 
 #include "utils_heap.h"
 
@@ -109,20 +108,19 @@
 {
   c_heap_t *h;
 
   if (compare == NULL)
     return (NULL);
 
-  h = malloc (sizeof (*h));
+  h = calloc (1, sizeof (*h));
   if (h == NULL)
     return (NULL);
 
-  memset (h, 0, sizeof (*h));
   pthread_mutex_init (&h->lock, /* attr = */ NULL);
   h->compare = compare;
-  
+
   h->list = NULL;
   h->list_len = 0;
   h->list_size = 0;
 
   return (h);
 } /* c_heap_t *c_heap_create */
@@ -171,13 +169,13 @@
   index = h->list_len;
   h->list[index] = ptr;
   h->list_len++;
 
   /* Reorganize the heap from bottom up. */
   reheap (h, /* parent of this node = */ (index - 1) / 2, DIR_UP);
-  
+
   pthread_mutex_unlock (&h->lock);
   return (0);
 } /* int c_heap_insert */
 
 void *c_heap_get_root (c_heap_t *h)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap.h	2016-09-11 16:10:25.259038726 +0800
@@ -36,13 +36,13 @@
  *
  * DESCRIPTION
  *   Allocates a new heap.
  *
  * PARAMETERS
  *   `compare'  The function-pointer `compare' is used to compare two keys. It
- *              has to return less than zero if it's first argument is smaller
+ *              has to return less than zero if its first argument is smaller
  *              then the second argument, more than zero if the first argument
  *              is bigger than the second argument and zero if they are equal.
  *              If your keys are char-pointers, you can use the `strcmp'
  *              function from the libc here.
  *
  * RETURN VALUE
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_heap_test.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_heap_test.c	2016-09-11 16:10:25.259038726 +0800
@@ -21,14 +21,15 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
-#include "testing.h"
 #include "collectd.h"
+
+#include "testing.h"
 #include "utils_heap.h"
 
 static int compare (void const *v0, void const *v1)
 {
   int const *i0 = v0;
   int const *i1 = v1;
@@ -41,33 +42,32 @@
     return 0;
 }
 
 DEF_TEST(simple)
 {
   int values[] = { 9, 5, 6, 1, 3, 4, 0, 8, 2, 7 };
-  int i;
   c_heap_t *h;
 
   CHECK_NOT_NULL(h = c_heap_create (compare));
-  for (i = 0; i < 10; i++)
+  for (int i = 0; i < 10; i++)
     CHECK_ZERO(c_heap_insert (h, &values[i]));
 
-  for (i = 0; i < 5; i++)
+  for (int i = 0; i < 5; i++)
   {
     int *ret = NULL;
     CHECK_NOT_NULL(ret = c_heap_get_root(h));
     OK(*ret == i);
   }
 
   CHECK_ZERO(c_heap_insert (h, &values[6] /* = 0 */));
   CHECK_ZERO(c_heap_insert (h, &values[3] /* = 1 */));
   CHECK_ZERO(c_heap_insert (h, &values[8] /* = 2 */));
   CHECK_ZERO(c_heap_insert (h, &values[4] /* = 3 */));
   CHECK_ZERO(c_heap_insert (h, &values[5] /* = 4 */));
 
-  for (i = 0; i < 10; i++)
+  for (int i = 0; i < 10; i++)
   {
     int *ret = NULL;
     CHECK_NOT_NULL(ret = c_heap_get_root(h));
     OK(*ret == i);
   }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_ignorelist.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_ignorelist.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_ignorelist.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_ignorelist.c	2016-09-11 16:10:25.259038726 +0800
@@ -24,13 +24,13 @@
 /**
  * ignorelist handles plugin's list of configured collectable
  * entries with global ignore action
  **/
 /**
  * Usage:
- * 
+ *
  * Define plugin's global pointer variable of type ignorelist_t:
  *   ignorelist_t *myconfig_ignore;
  * If you know the state of the global ignore (IgnoreSelected),
  * allocate the variable with:
  *   myconfig_ignore = ignorelist_create (YourKnownIgnore);
  * If you do not know the state of the global ignore,
@@ -85,69 +85,61 @@
 
 	item->next = il->head;
 	il->head = item;
 }
 
 #if HAVE_REGEX_H
-static int ignorelist_append_regex(ignorelist_t *il, const char *entry)
+static int ignorelist_append_regex(ignorelist_t *il, const char *re_str)
 {
 	regex_t *re;
-	ignorelist_item_t *item;
+	ignorelist_item_t *entry;
 	int status;
 
-	/* create buffer */
-	re = malloc (sizeof (*re));
+	re = calloc (1, sizeof (*re));
 	if (re == NULL)
 	{
-		ERROR ("ignorelist_append_regex: malloc failed.");
-		return ENOMEM;
+		ERROR ("ignorelist_append_regex: calloc failed.");
+		return (ENOMEM);
 	}
-	memset (re, 0, sizeof (*re));
 
-	/* compile regex */
-	status = regcomp (re, entry, REG_EXTENDED);
+	status = regcomp (re, re_str, REG_EXTENDED);
 	if (status != 0)
 	{
 		char errbuf[1024];
-
 		(void) regerror (status, re, errbuf, sizeof (errbuf));
-		ERROR ("ignorelist_append_regex: Compiling regular expression \"%s\" failed: %s", entry, errbuf);
+		ERROR ("utils_ignorelist: regcomp failed: %s", errbuf);
+		ERROR ("ignorelist_append_regex: Compiling regular expression \"%s\" failed: %s", re_str, errbuf);
 		sfree (re);
-		return status;
+		return (status);
 	}
 
-	/* create new entry */
-	item = malloc (sizeof (*item));
-	if (item == NULL)
+	entry = calloc (1, sizeof (*entry));
+	if (entry == NULL)
 	{
-		ERROR ("ignorelist_append_regex: malloc failed.");
+		ERROR ("ignorelist_append_regex: calloc failed.");
 		regfree (re);
 		sfree (re);
-		return ENOMEM;
+		return (ENOMEM);
 	}
-	memset (item, 0, sizeof (*item));
-	item->rmatch = re;
-
-	/* append new entry */
-	ignorelist_append (il, item);
+	entry->rmatch = re;
 
+	ignorelist_append (il, entry);
 	return (0);
-} /* int ignorelist_append_regex(ignorelist_t *il, const char *entry) */
+} /* int ignorelist_append_regex */
 #endif
 
 static int ignorelist_append_string(ignorelist_t *il, const char *entry)
 {
 	ignorelist_item_t *new;
 
 	/* create new entry */
-	if ((new = malloc(sizeof(ignorelist_item_t))) == NULL )
+	if ((new = calloc(1, sizeof (*new))) == NULL )
 	{
 		ERROR ("cannot allocate new entry");
 		return (1);
 	}
-	memset (new, '\0', sizeof(ignorelist_item_t));
 	new->smatch = sstrdup(entry);
 
 	/* append new entry */
 	ignorelist_append (il, new);
 
 	return (0);
@@ -196,16 +188,15 @@
  * return pointer to ignorelist_t
  */
 ignorelist_t *ignorelist_create (int invert)
 {
 	ignorelist_t *il;
 
-	il = malloc (sizeof (*il));
+	il = calloc (1, sizeof (*il));
 	if (il == NULL)
 		return NULL;
-	memset (il, 0, sizeof (*il));
 
 	/*
 	 * ->ignore == 0  =>  collect
 	 * ->ignore == 1  =>  ignore
 	 */
 	il->ignore = invert ? 0 : 1;
@@ -241,13 +232,12 @@
 			this->smatch = NULL;
 		}
 		sfree (this);
 	}
 
 	sfree (il);
-	il = NULL;
 } /* void ignorelist_destroy (ignorelist_t *il) */
 
 /*
  * set ignore state of the ignorelist_t
  */
 void ignorelist_set_invert (ignorelist_t *il, int invert)
@@ -260,13 +250,13 @@
 
 	il->ignore = invert ? 0 : 1;
 } /* void ignorelist_set_invert (ignorelist_t *il, int ignore) */
 
 /*
  * append entry into ignorelist_t
- * return 1 for success
+ * return 0 for success
  */
 int ignorelist_add (ignorelist_t *il, const char *entry)
 {
 	size_t len;
 
 	if (il == NULL)
@@ -311,23 +301,21 @@
 /*
  * check list for entry
  * return 1 for ignored entry
  */
 int ignorelist_match (ignorelist_t *il, const char *entry)
 {
-	ignorelist_item_t *traverse;
-
 	/* if no entries, collect all */
 	if ((il == NULL) || (il->head == NULL))
 		return (0);
 
 	if ((entry == NULL) || (strlen (entry) == 0))
 		return (0);
 
 	/* traverse list and check entries */
-	for (traverse = il->head; traverse != NULL; traverse = traverse->next)
+	for (ignorelist_item_t *traverse = il->head; traverse != NULL; traverse = traverse->next)
 	{
 #if HAVE_REGEX_H
 		if (traverse->rmatch != NULL)
 		{
 			if (ignorelist_match_regex (traverse, entry))
 				return (il->ignore);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_llist.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_llist.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_llist.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_llist.c	2016-09-11 16:10:25.259038726 +0800
@@ -21,14 +21,12 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian Forster <octo at collectd.org>
  */
 
-#include "config.h"
-
 #include <stdlib.h>
 #include <string.h>
 
 #include "utils_llist.h"
 
 /*
@@ -45,18 +43,16 @@
  * Public functions
  */
 llist_t *llist_create (void)
 {
 	llist_t *ret;
 
-	ret = (llist_t *) malloc (sizeof (llist_t));
+	ret = calloc (1, sizeof (*ret));
 	if (ret == NULL)
 		return (NULL);
 
-	memset (ret, '\0', sizeof (llist_t));
-
 	return (ret);
 }
 
 void llist_destroy (llist_t *l)
 {
 	llentry_t *e_this;
@@ -75,13 +71,13 @@
 }
 
 llentry_t *llentry_create (char *key, void *value)
 {
 	llentry_t *e;
 
-	e = (llentry_t *) malloc (sizeof (llentry_t));
+	e = malloc (sizeof (*e));
 	if (e)
 	{
 		e->key   = key;
 		e->value = value;
 		e->next  = NULL;
 	}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_match.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_match.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_match.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_match.c	2016-09-11 16:10:25.259038726 +0800
@@ -60,13 +61,13 @@
   {
     ERROR ("utils_match: match_substr: `end' points after end of string.");
     return (NULL);
   }
 
   ret_len = end - begin;
-  ret = (char *) malloc (sizeof (char) * (ret_len + 1));
+  ret = malloc (ret_len + 1);
   if (ret == NULL)
   {
     ERROR ("utils_match: match_substr: malloc failed.");
     return (NULL);
   }
 
@@ -235,16 +236,15 @@
   cu_match_t *obj;
   int status;
 
   DEBUG ("utils_match: match_create_callback: regex = %s, excluderegex = %s",
 	 regex, excluderegex);
 
-  obj = (cu_match_t *) malloc (sizeof (cu_match_t));
+  obj = calloc (1, sizeof (*obj));
   if (obj == NULL)
     return (NULL);
-  memset (obj, '\0', sizeof (cu_match_t));
 
   status = regcomp (&obj->regex, regex, REG_EXTENDED | REG_NEWLINE);
   if (status != 0)
   {
     ERROR ("Compiling the regular expression \"%s\" failed.", regex);
     sfree (obj);
@@ -272,16 +272,15 @@
 cu_match_t *match_create_simple (const char *regex,
 				 const char *excluderegex, int match_ds_type)
 {
   cu_match_value_t *user_data;
   cu_match_t *obj;
 
-  user_data = (cu_match_value_t *) malloc (sizeof (cu_match_value_t));
+  user_data = calloc (1, sizeof (*user_data));
   if (user_data == NULL)
     return (NULL);
-  memset (user_data, '\0', sizeof (cu_match_value_t));
   user_data->ds_type = match_ds_type;
 
   obj = match_create_callback (regex, excluderegex,
 			       default_callback, user_data);
   if (obj == NULL)
   {
@@ -320,15 +319,14 @@
 } /* void match_destroy */
 
 int match_apply (cu_match_t *obj, const char *str)
 {
   int status;
   regmatch_t re_match[32];
-  char *matches[32];
+  char *matches[32] = { 0 };
   size_t matches_num;
-  size_t i;
 
   if ((obj == NULL) || (str == NULL))
     return (-1);
 
   if (obj->flags & UTILS_MATCH_FLAGS_EXCLUDE_REGEX) {
     status = regexec (&obj->excluderegex, str,
@@ -346,13 +344,12 @@
       /* eflags = */ 0);
 
   /* Regex did not match */
   if (status != 0)
     return (0);
 
-  memset (matches, '\0', sizeof (matches));
   for (matches_num = 0; matches_num < STATIC_ARRAY_SIZE (matches); matches_num++)
   {
     if ((re_match[matches_num].rm_so < 0)
 	|| (re_match[matches_num].rm_eo < 0))
       break;
 
@@ -375,13 +372,13 @@
     if (status != 0)
     {
       ERROR ("utils_match: match_apply: callback failed.");
     }
   }
 
-  for (i = 0; i < matches_num; i++)
+  for (size_t i = 0; i < matches_num; i++)
   {
     sfree (matches[i]);
   }
 
   return (status);
 } /* int match_apply */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_subst.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_subst.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_subst.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_subst.c	2016-09-11 16:10:25.259038726 +0800
@@ -26,42 +26,70 @@
 
 /*
  * This module provides functions for string substitution.
  */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "utils_subst.h"
 
-char *subst (char *buf, size_t buflen, const char *string, int off1, int off2,
+char *subst (char *buf, size_t buflen, const char *string, size_t off1, size_t off2,
 		const char *replacement)
 {
-	char  *buf_ptr = buf;
-	size_t len     = buflen;
+	char *out = buf;
+
+	char const *front;
+	char const *back;
+	size_t front_len;
+	size_t replacement_len;
+	size_t back_len;
+
+	if ((NULL == buf) || (0 == buflen) || (NULL == string) || (NULL == replacement))
+		return NULL;
 
-	if ((NULL == buf) || (0 >= buflen) || (NULL == string)
-			|| (0 > off1) || (0 > off2) || (off1 > off2)
-			|| (NULL == replacement))
+	size_t string_len = strlen (string);
+	if ((off1 > string_len) || (off2 > string_len) || (off1 > off2))
 		return NULL;
 
-	sstrncpy (buf_ptr, string,
-			((size_t)off1 + 1 > buflen) ? buflen : (size_t)off1 + 1);
-	buf_ptr += off1;
-	len     -= off1;
-
-	if (0 >= len)
-		return buf;
-
-	sstrncpy (buf_ptr, replacement, len);
-	buf_ptr += strlen (replacement);
-	len     -= strlen (replacement);
+	front = string;
+	back = string + off2;
+	front_len = off1;
+	replacement_len = strlen (replacement);
+	back_len = strlen (back);
+
+	if (front_len >= buflen) {
+		front_len = buflen - 1;
+		replacement_len = 0;
+		back_len = 0;
+	} else if ((front_len + replacement_len) >= buflen) {
+		replacement_len = buflen - (front_len + 1);
+		back_len = 0;
+	} else if ((front_len + replacement_len + back_len) >= buflen) {
+		back_len = buflen - (front_len + replacement_len + 1);
+	} else {
+		buflen = front_len + replacement_len + back_len + 1;
+	}
+	assert ((front_len + replacement_len + back_len) == (buflen - 1));
+
+	if (front_len != 0) {
+		sstrncpy (out, front, front_len + 1);
+		out += front_len;
+	}
+
+	if (replacement_len != 0) {
+		sstrncpy (out, replacement, replacement_len + 1);
+		out += replacement_len;
+	}
 
-	if (0 >= len)
-		return buf;
+	if (back_len != 0) {
+		sstrncpy (out, back, back_len + 1);
+		out += back_len;
+	}
 
-	sstrncpy (buf_ptr, string + off2, len);
+	out[0] = 0;
 	return buf;
 } /* subst */
 
 char *asubst (const char *string, int off1, int off2, const char *replacement)
 {
 	char *buf;
@@ -72,46 +100,39 @@
 	if ((NULL == string) || (0 > off1) || (0 > off2) || (off1 > off2)
 			|| (NULL ==replacement))
 		return NULL;
 
 	len = off1 + strlen (replacement) + strlen (string) - off2 + 1;
 
-	buf = (char *)malloc (len);
+	buf = malloc (len);
 	if (NULL == buf)
 		return NULL;
 
 	ret = subst (buf, len, string, off1, off2, replacement);
 	if (NULL == ret)
 		free (buf);
 	return ret;
 } /* asubst */
 
 char *subst_string (char *buf, size_t buflen, const char *string,
 		const char *needle, const char *replacement)
 {
-	char *temp;
 	size_t needle_len;
 	size_t i;
 
 	if ((buf == NULL) || (string == NULL)
 			|| (needle == NULL) || (replacement == NULL))
 		return (NULL);
 
-	temp = (char *) malloc (buflen);
-	if (temp == NULL)
-	{
-		ERROR ("subst_string: malloc failed.");
-		return (NULL);
-	}
-
 	needle_len = strlen (needle);
-	strncpy (buf, string, buflen);
+	sstrncpy (buf, string, buflen);
 
 	/* Limit the loop to prevent endless loops. */
 	for (i = 0; i < buflen; i++)
 	{
+		char temp[buflen];
 		char *begin_ptr;
 		size_t begin;
 
 		/* Find `needle' in `buf'. */
 		begin_ptr = strstr (buf, needle);
 		if (begin_ptr == NULL)
@@ -139,12 +160,11 @@
 	{
 		WARNING ("subst_string: Loop exited after %zu iterations: "
 				"string = %s; needle = %s; replacement = %s;",
 				i, string, needle, replacement);
 	}
 
-	sfree (temp);
 	return (buf);
 } /* char *subst_string */
 
 /* vim: set sw=4 ts=4 tw=78 noexpandtab : */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_subst.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_subst.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_subst.h	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_subst.h	2016-09-11 16:10:25.259038726 +0800
@@ -63,13 +63,13 @@
  *   replacement = " - "
  *
  *   -> "foo - bar"
  *
  * The function returns 'buf' on success, NULL else.
  */
-char *subst (char *buf, size_t buflen, const char *string, int off1, int off2,
+char *subst (char *buf, size_t buflen, const char *string, size_t off1, size_t off2,
 		const char *replacement);
 
 /*
  * asubst:
  *
  * This function is very similar to subst(). It differs in that it
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon: utils_subst_test.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_tail.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_tail.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_tail.c	2016-11-29 00:08:22.403470426 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_tail.c	2016-09-11 16:10:25.259038726 +0800
@@ -42,16 +43,15 @@
 };
 
 static int cu_tail_reopen (cu_tail_t *obj)
 {
   int seek_end = 0;
   FILE *fh;
-  struct stat stat_buf;
+  struct stat stat_buf = { 0 };
   int status;
 
-  memset (&stat_buf, 0, sizeof (stat_buf));
   status = stat (obj->file, &stat_buf);
   if (status != 0)
   {
     char errbuf[1024];
     ERROR ("utils_tail: stat (%s) failed: %s", obj->file,
 	sstrerror (errno, errbuf, sizeof (errbuf)));
@@ -116,16 +116,15 @@
 } /* int cu_tail_reopen */
 
 cu_tail_t *cu_tail_create (const char *file)
 {
 	cu_tail_t *obj;
 
-	obj = (cu_tail_t *) malloc (sizeof (cu_tail_t));
+	obj = calloc (1, sizeof (*obj));
 	if (obj == NULL)
 		return (NULL);
-	memset (obj, '\0', sizeof (cu_tail_t));
 
 	obj->file = strdup (file);
 	if (obj->file == NULL)
 	{
 		free (obj);
 		return (NULL);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_tail_match.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_tail_match.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_tail_match.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_tail_match.c	2016-09-11 16:10:25.259038726 +0800
@@ -108,31 +109,29 @@
 } /* int simple_submit_match */
 
 static int tail_callback (void *data, char *buf,
     int __attribute__((unused)) buflen)
 {
   cu_tail_match_t *obj = (cu_tail_match_t *) data;
-  size_t i;
 
-  for (i = 0; i < obj->matches_num; i++)
+  for (size_t i = 0; i < obj->matches_num; i++)
     match_apply (obj->matches[i].match, buf);
 
   return (0);
 } /* int tail_callback */
 
 /*
  * Public functions
  */
 cu_tail_match_t *tail_match_create (const char *filename)
 {
   cu_tail_match_t *obj;
 
-  obj = (cu_tail_match_t *) malloc (sizeof (cu_tail_match_t));
+  obj = calloc (1, sizeof (*obj));
   if (obj == NULL)
     return (NULL);
-  memset (obj, '\0', sizeof (cu_tail_match_t));
 
   obj->tail = cu_tail_create (filename);
   if (obj->tail == NULL)
   {
     sfree (obj);
     return (NULL);
@@ -140,24 +139,22 @@
 
   return (obj);
 } /* cu_tail_match_t *tail_match_create */
 
 void tail_match_destroy (cu_tail_match_t *obj)
 {
-  size_t i;
-
   if (obj == NULL)
     return;
 
   if (obj->tail != NULL)
   {
     cu_tail_destroy (obj->tail);
     obj->tail = NULL;
   }
 
-  for (i = 0; i < obj->matches_num; i++)
+  for (size_t i = 0; i < obj->matches_num; i++)
   {
     cu_tail_match_match_t *match = obj->matches + i;
     if (match->match != NULL)
     {
       match_destroy (match->match);
       match->match = NULL;
@@ -177,13 +174,13 @@
     int (*submit_match) (cu_match_t *match, void *user_data),
     void *user_data,
     void (*free_user_data) (void *user_data))
 {
   cu_tail_match_match_t *temp;
 
-  temp = (cu_tail_match_match_t *) realloc (obj->matches,
+  temp = realloc (obj->matches,
       sizeof (cu_tail_match_match_t) * (obj->matches_num + 1));
   if (temp == NULL)
     return (-1);
 
   obj->matches = temp;
   obj->matches_num++;
@@ -209,19 +206,18 @@
   int status;
 
   match = match_create_simple (regex, excluderegex, ds_type);
   if (match == NULL)
     return (-1);
 
-  user_data = (cu_tail_match_simple_t *) malloc (sizeof (cu_tail_match_simple_t));
+  user_data = calloc (1, sizeof (*user_data));
   if (user_data == NULL)
   {
     match_destroy (match);
     return (-1);
   }
-  memset (user_data, '\0', sizeof (cu_tail_match_simple_t));
 
   sstrncpy (user_data->plugin, plugin, sizeof (user_data->plugin));
   if (plugin_instance != NULL)
     sstrncpy (user_data->plugin_instance, plugin_instance,
 	sizeof (user_data->plugin_instance));
 
@@ -245,23 +241,22 @@
 } /* int tail_match_add_match_simple */
 
 int tail_match_read (cu_tail_match_t *obj)
 {
   char buffer[4096];
   int status;
-  size_t i;
 
   status = cu_tail_read (obj->tail, buffer, sizeof (buffer), tail_callback,
       (void *) obj);
   if (status != 0)
   {
     ERROR ("tail_match: cu_tail_read failed.");
     return (status);
   }
 
-  for (i = 0; i < obj->matches_num; i++)
+  for (size_t i = 0; i < obj->matches_num; i++)
   {
     cu_tail_match_match_t *lt_match = obj->matches + i;
 
     if (lt_match->submit == NULL)
       continue;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_threshold.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_threshold.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_threshold.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_threshold.c	2016-09-11 16:10:25.259038726 +0800
@@ -121,22 +122,22 @@
 {
   threshold_t *t;
 
   if (vl == NULL)
     return (EINVAL);
 
-	/* Is this lock really necessary? */
-	pthread_mutex_lock (&threshold_lock);
+  /* Is this lock really necessary? */
+  pthread_mutex_lock (&threshold_lock);
   t = threshold_search (vl);
   if (t == NULL) {
-		pthread_mutex_unlock (&threshold_lock);
+    pthread_mutex_unlock (&threshold_lock);
     return (ENOENT);
-	}
+  }
 
   memcpy (ret_threshold, t, sizeof (*ret_threshold));
-	pthread_mutex_unlock (&threshold_lock);
+  pthread_mutex_unlock (&threshold_lock);
 
   ret_threshold->next = NULL;
 
   return (0);
 } /* }}} int ut_search_threshold */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_threshold.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_threshold.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_threshold.h	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_threshold.h	2016-09-11 16:10:25.259038726 +0800
@@ -56,12 +56,12 @@
 threshold_t *threshold_get (const char *hostname,
     const char *plugin, const char *plugin_instance,
     const char *type, const char *type_instance);
 
 threshold_t *threshold_search (const value_list_t *vl);
 
-int ut_search_threshold (const value_list_t *vl, 
+int ut_search_threshold (const value_list_t *vl,
   threshold_t *ret_threshold);
 
 #endif /* UTILS_THRESHOLD_H */
 
 /* vim: set sw=2 sts=2 ts=8 : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_time.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_time.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_time.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_time.c	2016-09-11 16:10:25.259038726 +0800
@@ -1,9 +1,9 @@
 /**
  * collectd - src/utils_time.c
- * Copyright (C) 2010       Florian octo Forster
+ * Copyright (C) 2010-2015  Florian octo Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -18,21 +18,34 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Florian octo Forster <ff at octo.it>
+ *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "utils_time.h"
 #include "plugin.h"
 #include "common.h"
 
-#if HAVE_CLOCK_GETTIME
+#ifndef DEFAULT_MOCK_TIME
+# define DEFAULT_MOCK_TIME 1542455354518929408ULL
+#endif
+
+#ifdef MOCK_TIME
+cdtime_t cdtime_mock = (cdtime_t) MOCK_TIME;
+
+cdtime_t cdtime (void)
+{
+  return cdtime_mock;
+}
+#else /* !MOCK_TIME */
+# if HAVE_CLOCK_GETTIME
 cdtime_t cdtime (void) /* {{{ */
 {
   int status;
   struct timespec ts = { 0, 0 };
 
   status = clock_gettime (CLOCK_REALTIME, &ts);
@@ -43,13 +56,13 @@
         sstrerror (errno, errbuf, sizeof (errbuf)));
     return (0);
   }
 
   return (TIMESPEC_TO_CDTIME_T (&ts));
 } /* }}} cdtime_t cdtime */
-#else
+# else /* !HAVE_CLOCK_GETTIME */
 /* Work around for Mac OS X which doesn't have clock_gettime(2). *sigh* */
 cdtime_t cdtime (void) /* {{{ */
 {
   int status;
   struct timeval tv = { 0, 0 };
 
@@ -61,44 +74,98 @@
         sstrerror (errno, errbuf, sizeof (errbuf)));
     return (0);
   }
 
   return (TIMEVAL_TO_CDTIME_T (&tv));
 } /* }}} cdtime_t cdtime */
+# endif
 #endif
 
-size_t cdtime_to_iso8601 (char *s, size_t max, cdtime_t t) /* {{{ */
+/* format_zone reads time zone information from "extern long timezone", exported
+ * by <time.h>, and formats it according to RFC 3339. This differs from
+ * strftime()'s "%z" format by including a colon between hour and minute. */
+static int format_zone (char *buffer, size_t buffer_size, struct tm const *tm) /* {{{ */
+{
+  char tmp[7];
+  size_t sz;
+
+  if ((buffer == NULL) || (buffer_size < 7))
+    return EINVAL;
+
+  sz = strftime (tmp, sizeof (tmp), "%z", tm);
+  if (sz == 0)
+    return ENOMEM;
+  if (sz != 5)
+  {
+    DEBUG ("format_zone: strftime(\"%%z\") = \"%s\", want \"+hhmm\"", tmp);
+    sstrncpy (buffer, tmp, buffer_size);
+    return 0;
+  }
+
+  buffer[0] = tmp[0];
+  buffer[1] = tmp[1];
+  buffer[2] = tmp[2];
+  buffer[3] = ':';
+  buffer[4] = tmp[3];
+  buffer[5] = tmp[4];
+  buffer[6] = 0;
+
+  return 0;
+} /* }}} int format_zone */
+
+static int format_rfc3339 (char *buffer, size_t buffer_size, cdtime_t t, _Bool print_nano) /* {{{ */
 {
   struct timespec t_spec;
   struct tm t_tm;
-
+  char base[20]; /* 2006-01-02T15:04:05 */
+  char nano[11]; /* .999999999 */
+  char zone[7];  /* +00:00 */
+  char *fields[] = {base, nano, zone};
   size_t len;
+  int status;
 
   CDTIME_T_TO_TIMESPEC (t, &t_spec);
   NORMALIZE_TIMESPEC (t_spec);
 
-  if (localtime_r ((time_t *)&t_spec.tv_sec, &t_tm) == NULL) {
+  if (localtime_r (&t_spec.tv_sec, &t_tm) == NULL) {
     char errbuf[1024];
-    ERROR ("cdtime_to_iso8601: localtime_r failed: %s",
-        sstrerror (errno, errbuf, sizeof (errbuf)));
-    return (0);
+    status = errno;
+    ERROR ("format_rfc3339: localtime_r failed: %s",
+        sstrerror (status, errbuf, sizeof (errbuf)));
+    return (status);
   }
 
-  len = strftime (s, max, "%Y-%m-%dT%H:%M:%S", &t_tm);
+  len = strftime (base, sizeof (base), "%Y-%m-%dT%H:%M:%S", &t_tm);
   if (len == 0)
-    return 0;
+    return ENOMEM;
 
-  if (max - len > 2) {
-    int n = snprintf (s + len, max - len, ".%09i", (int)t_spec.tv_nsec);
-    len += (n < max - len) ? n : max - len;
-  }
+  if (print_nano)
+    ssnprintf (nano, sizeof (nano), ".%09ld", (long) t_spec.tv_nsec);
+  else
+    sstrncpy (nano, "", sizeof (nano));
 
-  if (max - len > 3) {
-    int n = strftime (s + len, max - len, "%z", &t_tm);
-    len += (n < max - len) ? n : max - len;
-  }
+  status = format_zone (zone, sizeof (zone), &t_tm);
+  if (status != 0)
+    return status;
+
+  if (strjoin (buffer, buffer_size, fields, STATIC_ARRAY_SIZE (fields), "") < 0)
+    return ENOMEM;
+  return 0;
+} /* }}} int format_rfc3339 */
+
+int rfc3339 (char *buffer, size_t buffer_size, cdtime_t t) /* {{{ */
+{
+  if (buffer_size < RFC3339_SIZE)
+    return ENOMEM;
+
+  return format_rfc3339 (buffer, buffer_size, t, 0);
+} /* }}} size_t cdtime_to_rfc3339 */
+
+int rfc3339nano (char *buffer, size_t buffer_size, cdtime_t t) /* {{{ */
+{
+  if (buffer_size < RFC3339NANO_SIZE)
+    return ENOMEM;
 
-  s[max - 1] = '\0';
-  return len;
-} /* }}} size_t cdtime_to_iso8601 */
+  return format_rfc3339 (buffer, buffer_size, t, 1);
+} /* }}} size_t cdtime_to_rfc3339nano */
 
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_time.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_time.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon/utils_time.h	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon/utils_time.h	2016-09-11 16:10:25.259038726 +0800
@@ -1,9 +1,9 @@
 /**
- * collectd - src/utils_time.h
- * Copyright (C) 2010       Florian octo Forster
+ * collectd - src/daemon/utils_time.h
+ * Copyright (C) 2010-2015  Florian octo Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -18,64 +18,79 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Florian octo Forster <ff at octo.it>
+ *   Florian octo Forster <octo at collectd.org>
  **/
 
 #ifndef UTILS_TIME_H
 #define UTILS_TIME_H 1
 
 #include "collectd.h"
 
+#ifdef TESTING_H
+/* cdtime_mock is the time returned by cdtime() when build with
+ * -DMOCK_TIME */
+extern cdtime_t cdtime_mock;
+#endif
+
 /*
  * "cdtime_t" is a 64bit unsigned integer. The time is stored at a 2^-30 second
  * resolution, i.e. the most significant 34 bit are used to store the time in
  * seconds, the least significant bits store the sub-second part in something
  * very close to nanoseconds. *The* big advantage of storing time in this
  * manner is that comparing times and calculating differences is as simple as
  * it is with "time_t", i.e. a simple integer comparison / subtraction works.
  */
-/* 
+/*
  * cdtime_t is defined in "collectd.h" */
 /* typedef uint64_t cdtime_t; */
 
 /* 2^30 = 1073741824 */
-#define TIME_T_TO_CDTIME_T(t) (((cdtime_t) (t)) * 1073741824)
-#define CDTIME_T_TO_TIME_T(t) ((time_t) ((t) / 1073741824))
+#define TIME_T_TO_CDTIME_T(t) (((cdtime_t) (t)) << 30)
+
+#define MS_TO_CDTIME_T(ms) (((((cdtime_t) (ms)) / 1000) << 30) | \
+    ((((((cdtime_t) (ms)) % 1000) << 30) + 500) / 1000))
+#define US_TO_CDTIME_T(us) (((((cdtime_t) (us)) / 1000000) << 30) | \
+    ((((((cdtime_t) (us)) % 1000000) << 30) + 500000) / 1000000))
+#define NS_TO_CDTIME_T(ns) (((((cdtime_t) (ns)) / 1000000000) << 30) | \
+    ((((((cdtime_t) (ns)) % 1000000000) << 30) + 500000000) / 1000000000))
+
+#define CDTIME_T_TO_TIME_T(t) ((time_t) (((t) + (1 << 29)) >> 30))
+#define CDTIME_T_TO_MS(t)  ((uint64_t) ((((t) >> 30) * 1000) + \
+  ((((t) & 0x3fffffff) * 1000 + (1 << 29)) >> 30)))
+#define CDTIME_T_TO_US(t)  ((uint64_t) ((((t) >> 30) * 1000000) + \
+  ((((t) & 0x3fffffff) * 1000000 + (1 << 29)) >> 30)))
+#define CDTIME_T_TO_NS(t)  ((uint64_t) ((((t) >> 30) * 1000000000) + \
+  ((((t) & 0x3fffffff) * 1000000000 + (1 << 29)) >> 30)))
 
 #define CDTIME_T_TO_DOUBLE(t) (((double) (t)) / 1073741824.0)
 #define DOUBLE_TO_CDTIME_T(d) ((cdtime_t) ((d) * 1073741824.0))
 
-#define MS_TO_CDTIME_T(ms) ((cdtime_t)    (((double) (ms)) * 1073741.824))
-#define CDTIME_T_TO_MS(t)  ((long)        (((double) (t))  / 1073741.824))
-#define US_TO_CDTIME_T(us) ((cdtime_t)    (((double) (us)) * 1073.741824))
-#define CDTIME_T_TO_US(t)  ((suseconds_t) (((double) (t))  / 1073.741824))
-#define NS_TO_CDTIME_T(ns) ((cdtime_t)    (((double) (ns)) * 1.073741824))
-#define CDTIME_T_TO_NS(t)  ((long)        (((double) (t))  / 1.073741824))
-
-#define CDTIME_T_TO_TIMEVAL(cdt,tvp) do {                                    \
-        (tvp)->tv_sec = CDTIME_T_TO_TIME_T (cdt);                            \
-        (tvp)->tv_usec = CDTIME_T_TO_US ((cdt) % 1073741824);                \
+#define CDTIME_T_TO_TIMEVAL(cdt,tvp) do { \
+  (tvp)->tv_sec = (time_t) ((cdt) >> 30); \
+  (tvp)->tv_usec = (suseconds_t) ((((cdt) & 0x3fffffff) * 1000000 + (1 << 29)) >> 30); \
 } while (0)
-#define TIMEVAL_TO_CDTIME_T(tv) (TIME_T_TO_CDTIME_T ((tv)->tv_sec)           \
-    + US_TO_CDTIME_T ((tv)->tv_usec))
+#define TIMEVAL_TO_CDTIME_T(tv) US_TO_CDTIME_T(1000000 * (tv)->tv_sec + (tv)->tv_usec)
 
-#define CDTIME_T_TO_TIMESPEC(cdt,tsp) do {                                   \
-  (tsp)->tv_sec = CDTIME_T_TO_TIME_T (cdt);                                  \
-  (tsp)->tv_nsec = CDTIME_T_TO_NS ((cdt) % 1073741824);                      \
+#define CDTIME_T_TO_TIMESPEC(cdt,tsp) do { \
+  (tsp)->tv_sec = (time_t) ((cdt) >> 30); \
+  (tsp)->tv_nsec = (long) ((((cdt) & 0x3fffffff) * 1000000000 + (1 << 29)) >> 30); \
 } while (0)
-#define TIMESPEC_TO_CDTIME_T(ts) (TIME_T_TO_CDTIME_T ((ts)->tv_sec)           \
-    + NS_TO_CDTIME_T ((ts)->tv_nsec))
+#define TIMESPEC_TO_CDTIME_T(ts) NS_TO_CDTIME_T(1000000000ULL * (ts)->tv_sec + (ts)->tv_nsec)
 
 cdtime_t cdtime (void);
 
-/* format a cdtime_t value in ISO 8601 format:
- * returns the number of characters written to the string (not including the
- * terminating null byte or 0 on error; the function ensures that the string
- * is null terminated */
-size_t cdtime_to_iso8601 (char *s, size_t max, cdtime_t t);
+#define RFC3339_SIZE     26
+#define RFC3339NANO_SIZE 36
+
+/* rfc3339 formats a cdtime_t time in RFC 3339 format with second precision. */
+int rfc3339 (char *buffer, size_t buffer_size, cdtime_t t);
+
+/* rfc3339nano formats a cdtime_t time in RFC 3339 format with nanosecond
+ * precision. */
+int rfc3339nano (char *buffer, size_t buffer_size, cdtime_t t);
 
 #endif /* UTILS_TIME_H */
 /* vim: set sw=2 sts=2 et : */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/daemon: utils_time_mock.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/daemon: utils_time_test.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/dbi.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/dbi.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/dbi.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/dbi.c	2016-09-11 16:10:25.259038726 +0800
@@ -22,15 +22,15 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_db_query.h"
 
 #include <dbi/dbi.h>
 
 /* libdbi 0.9.0 introduced a new thread-safe interface and marked the old
  * functions "deprecated". These macros convert the new functions to their old
@@ -61,12 +61,14 @@
 
 struct cdbi_database_s /* {{{ */
 {
   char *name;
   char *select_db;
 
+  cdtime_t interval;
+
   char *driver;
   char *host;
   cdbi_driver_option_t *driver_options;
   size_t driver_options_num;
 
   udb_query_preparation_area_t **q_prep_areas;
@@ -143,13 +145,13 @@
     value = dbi_result_get_double_idx (res, index);
     ssnprintf (buffer, buffer_size, "%63.15g", value);
   }
   else if (src_type == DBI_TYPE_STRING)
   {
     const char *value;
-    
+
     value = dbi_result_get_string_idx (res, index);
     if (value == NULL)
       sstrncpy (buffer, "", buffer_size);
     else if (strcmp ("ERROR", value) == 0)
       return (-1);
     else
@@ -173,30 +175,28 @@
 
   return (0);
 } /* }}} int cdbi_result_get_field */
 
 static void cdbi_database_free (cdbi_database_t *db) /* {{{ */
 {
-  size_t i;
-
   if (db == NULL)
     return;
 
   sfree (db->name);
   sfree (db->driver);
 
-  for (i = 0; i < db->driver_options_num; i++)
+  for (size_t i = 0; i < db->driver_options_num; i++)
   {
     sfree (db->driver_options[i].key);
     if (!db->driver_options[i].is_numeric)
       sfree (db->driver_options[i].value.string);
   }
   sfree (db->driver_options);
 
   if (db->q_prep_areas)
-    for (i = 0; i < db->queries_num; ++i)
+    for (size_t i = 0; i < db->queries_num; ++i)
       udb_query_delete_preparation_area (db->q_prep_areas[i]);
   free (db->q_prep_areas);
 
   sfree (db);
 } /* }}} void cdbi_database_free */
 
@@ -209,15 +209,16 @@
  *       Type "gauge"
  *       InstancesFrom "name"
  *       ValuesFrom "value"
  *     </Result>
  *     ...
  *   </Query>
- *     
+ *
  *   <Database "plugin_instance1">
  *     Driver "mysql"
+ *     Interval 120
  *     DriverOption "hostname" "localhost"
  *     ...
  *     Query "plugin_instance0"
  *   </Database>
  * </Plugin>
  */
@@ -234,13 +235,13 @@
   {
     WARNING ("dbi plugin: The `DriverOption' config option "
         "needs exactly two arguments.");
     return (-1);
   }
 
-  option = (cdbi_driver_option_t *) realloc (db->driver_options,
+  option = realloc (db->driver_options,
       sizeof (*option) * (db->driver_options_num + 1));
   if (option == NULL)
   {
     ERROR ("dbi plugin: realloc failed");
     return (-1);
   }
@@ -278,39 +279,37 @@
 } /* }}} int cdbi_config_add_database_driver_option */
 
 static int cdbi_config_add_database (oconfig_item_t *ci) /* {{{ */
 {
   cdbi_database_t *db;
   int status;
-  int i;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("dbi plugin: The `Database' block "
         "needs exactly one string argument.");
     return (-1);
   }
 
-  db = (cdbi_database_t *) malloc (sizeof (*db));
+  db = calloc (1, sizeof (*db));
   if (db == NULL)
   {
-    ERROR ("dbi plugin: malloc failed.");
+    ERROR ("dbi plugin: calloc failed.");
     return (-1);
   }
-  memset (db, 0, sizeof (*db));
 
   status = cf_util_get_string (ci, &db->name);
   if (status != 0)
   {
     sfree (db);
     return (status);
   }
 
   /* Fill the `cdbi_database_t' structure.. */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Driver", child->key) == 0)
       status = cf_util_get_string (child, &db->driver);
     else if (strcasecmp ("DriverOption", child->key) == 0)
@@ -319,12 +318,14 @@
       status = cf_util_get_string (child, &db->select_db);
     else if (strcasecmp ("Query", child->key) == 0)
       status = udb_query_pick_from_list (child, queries, queries_num,
           &db->queries, &db->queries_num);
     else if (strcasecmp ("Host", child->key) == 0)
       status = cf_util_get_string (child, &db->host);
+    else if (strcasecmp ("Interval", child->key) == 0)
+      status = cf_util_get_cdtime(child, &db->interval);
     else
     {
       WARNING ("dbi plugin: Option `%s' not allowed here.", child->key);
       status = -1;
     }
 
@@ -348,23 +349,21 @@
 
     break;
   } /* while (status == 0) */
 
   while ((status == 0) && (db->queries_num > 0))
   {
-    db->q_prep_areas = (udb_query_preparation_area_t **) calloc (
-        db->queries_num, sizeof (*db->q_prep_areas));
-
+    db->q_prep_areas = calloc (db->queries_num, sizeof (*db->q_prep_areas));
     if (db->q_prep_areas == NULL)
     {
-      WARNING ("dbi plugin: malloc failed");
+      WARNING ("dbi plugin: calloc failed");
       status = -1;
       break;
     }
 
-    for (i = 0; i < db->queries_num; ++i)
+    for (size_t i = 0; i < db->queries_num; ++i)
     {
       db->q_prep_areas[i]
         = udb_query_allocate_preparation_area (db->queries[i]);
 
       if (db->q_prep_areas[i] == NULL)
       {
@@ -379,37 +378,37 @@
 
   /* If all went well, add this database to the global list of databases. */
   if (status == 0)
   {
     cdbi_database_t **temp;
 
-    temp = (cdbi_database_t **) realloc (databases,
+    temp = realloc (databases,
         sizeof (*databases) * (databases_num + 1));
     if (temp == NULL)
     {
       ERROR ("dbi plugin: realloc failed");
       status = -1;
     }
     else
     {
-      user_data_t ud;
       char *name = NULL;
 
       databases = temp;
       databases[databases_num] = db;
       databases_num++;
 
-      memset (&ud, 0, sizeof (ud));
-      ud.data = (void *) db;
-      ud.free_func = NULL;
       name = ssnprintf_alloc("dbi:%s", db->name);
 
+      user_data_t ud = {
+        .data = db
+      };
+
       plugin_register_complex_read (/* group = */ NULL,
           /* name = */ name ? name : db->name,
           /* callback = */ cdbi_read_database,
-          /* interval = */ NULL,
+          /* interval = */ (db->interval > 0) ? db->interval : 0,
           /* user_data = */ &ud);
       free (name);
     }
   }
 
   if (status != 0)
@@ -420,15 +419,13 @@
 
   return (0);
 } /* }}} int cdbi_config_add_database */
 
 static int cdbi_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("Query", child->key) == 0)
       udb_query_create (&queries, &queries_num, child,
           /* callback = */ NULL);
     else if (strcasecmp ("Database", child->key) == 0)
@@ -491,25 +488,23 @@
   const char *statement;
   dbi_result res;
   size_t column_num;
   char **column_names;
   char **column_values;
   int status;
-  size_t i;
 
   /* Macro that cleans up dynamically allocated memory and returns the
    * specified status. */
 #define BAIL_OUT(status) \
   if (column_names != NULL) { sfree (column_names[0]); sfree (column_names); } \
   if (column_values != NULL) { sfree (column_values[0]); sfree (column_values); } \
   if (res != NULL) { dbi_result_free (res); res = NULL; } \
   return (status)
 
   column_names = NULL;
   column_values = NULL;
-  res = NULL;
 
   statement = udb_query_get_statement (q);
   assert (statement != NULL);
 
   res = dbi_conn_query (db->connection, statement);
   if (res == NULL)
@@ -539,49 +534,47 @@
     column_num = (size_t) db_status;
     DEBUG ("cdbi_read_database_query (%s, %s): There are %zu columns.",
         db->name, udb_query_get_name (q), column_num);
   }
 
   /* Allocate `column_names' and `column_values'. {{{ */
-  column_names = (char **) calloc (column_num, sizeof (char *));
+  column_names = calloc (column_num, sizeof (*column_names));
   if (column_names == NULL)
   {
-    ERROR ("dbi plugin: malloc failed.");
+    ERROR ("dbi plugin: calloc failed.");
     BAIL_OUT (-1);
   }
 
-  column_names[0] = (char *) calloc (column_num,
-      DATA_MAX_NAME_LEN * sizeof (char));
+  column_names[0] = calloc (column_num, DATA_MAX_NAME_LEN);
   if (column_names[0] == NULL)
   {
-    ERROR ("dbi plugin: malloc failed.");
+    ERROR ("dbi plugin: calloc failed.");
     BAIL_OUT (-1);
   }
-  for (i = 1; i < column_num; i++)
+  for (size_t i = 1; i < column_num; i++)
     column_names[i] = column_names[i - 1] + DATA_MAX_NAME_LEN;
 
-  column_values = (char **) calloc (column_num, sizeof (char *));
+  column_values = calloc (column_num, sizeof (*column_values));
   if (column_values == NULL)
   {
-    ERROR ("dbi plugin: malloc failed.");
+    ERROR ("dbi plugin: calloc failed.");
     BAIL_OUT (-1);
   }
 
-  column_values[0] = (char *) calloc (column_num,
-      DATA_MAX_NAME_LEN * sizeof (char));
+  column_values[0] = calloc (column_num, DATA_MAX_NAME_LEN);
   if (column_values[0] == NULL)
   {
-    ERROR ("dbi plugin: malloc failed.");
+    ERROR ("dbi plugin: calloc failed.");
     BAIL_OUT (-1);
   }
-  for (i = 1; i < column_num; i++)
+  for (size_t i = 1; i < column_num; i++)
     column_values[i] = column_values[i - 1] + DATA_MAX_NAME_LEN;
   /* }}} */
 
   /* Copy the field names to `column_names' */
-  for (i = 0; i < column_num; i++) /* {{{ */
+  for (size_t i = 0; i < column_num; i++) /* {{{ */
   {
     const char *column_name;
 
     column_name = dbi_result_get_field_name (res, (unsigned int) (i + 1));
     if (column_name == NULL)
     {
@@ -593,13 +586,13 @@
 
     sstrncpy (column_names[i], column_name, DATA_MAX_NAME_LEN);
   } /* }}} for (i = 0; i < column_num; i++) */
 
   udb_query_prepare_result (q, prep_area, (db->host ? db->host : hostname_g),
       /* plugin = */ "dbi", db->name,
-      column_names, column_num, /* interval = */ 0);
+      column_names, column_num, /* interval = */ (db->interval > 0) ? db->interval : 0);
 
   /* 0 = error; 1 = success; */
   status = dbi_result_first_row (res); /* {{{ */
   if (status != 1)
   {
     char errbuf[1024];
@@ -615,13 +608,13 @@
   /* Iterate over all rows and call `udb_query_handle_result' with each list of
    * values. */
   while (42) /* {{{ */
   {
     status = 0;
     /* Copy the value of the columns to `column_values' */
-    for (i = 0; i < column_num; i++) /* {{{ */
+    for (size_t i = 0; i < column_num; i++) /* {{{ */
     {
       status = cdbi_result_get_field (res, (unsigned int) (i + 1),
           column_values[i], DATA_MAX_NAME_LEN);
 
       if (status != 0)
       {
@@ -671,13 +664,12 @@
 } /* }}} int cdbi_read_database_query */
 
 static int cdbi_connect_database (cdbi_database_t *db) /* {{{ */
 {
   dbi_driver driver;
   dbi_conn connection;
-  size_t i;
   int status;
 
   if (db->connection != NULL)
   {
     status = dbi_conn_ping (db->connection);
     if (status != 0) /* connection is alive */
@@ -713,13 +705,13 @@
 
   /* Set all the driver options. Because this is a very very very generic
    * interface, the error handling is kind of long. If an invalid option is
    * encountered, it will get a list of options understood by the driver and
    * report that as `INFO'. This way, users hopefully don't have too much
    * trouble finding out how to configure the plugin correctly.. */
-  for (i = 0; i < db->driver_options_num; i++)
+  for (size_t i = 0; i < db->driver_options_num; i++)
   {
     if (db->driver_options[i].is_numeric)
     {
       status = dbi_conn_set_option_numeric (connection,
           db->driver_options[i].key, db->driver_options[i].value.numeric);
       if (status != 0)
@@ -746,17 +738,15 @@
             cdbi_strerror (connection, errbuf, sizeof (errbuf)));
       }
     }
 
     if (status != 0)
     {
-      char const *opt;
-
       INFO ("dbi plugin: This is a list of all options understood "
           "by the `%s' driver:", db->driver);
-      for (opt = dbi_conn_get_option_list (connection, NULL);
+      for (const char *opt = dbi_conn_get_option_list (connection, NULL);
           opt != NULL;
           opt = dbi_conn_get_option_list (connection, opt))
       {
         INFO ("dbi plugin: * %s", opt);
       }
 
@@ -795,13 +785,12 @@
   return (0);
 } /* }}} int cdbi_connect_database */
 
 static int cdbi_read_database (user_data_t *ud) /* {{{ */
 {
   cdbi_database_t *db = (cdbi_database_t *) ud->data;
-  size_t i;
   int success;
   int status;
 
   unsigned int db_version;
 
   status = cdbi_connect_database (db);
@@ -810,13 +799,13 @@
   assert (db->connection != NULL);
 
   db_version = dbi_conn_get_engine_version (db->connection);
   /* TODO: Complain if `db_version == 0' */
 
   success = 0;
-  for (i = 0; i < db->queries_num; i++)
+  for (size_t i = 0; i < db->queries_num; i++)
   {
     /* Check if we know the database's version and if so, if this query applies
      * to that version. */
     if ((db_version != 0)
         && (udb_query_check_version (db->queries[i], db_version) == 0))
       continue;
@@ -835,15 +824,13 @@
 
   return (0);
 } /* }}} int cdbi_read_database */
 
 static int cdbi_shutdown (void) /* {{{ */
 {
-  size_t i;
-
-  for (i = 0; i < databases_num; i++)
+  for (size_t i = 0; i < databases_num; i++)
   {
     if (databases[i]->connection != NULL)
     {
       dbi_conn_close (databases[i]->connection);
       databases[i]->connection = NULL;
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/df.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/df.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/df.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/df.c	2016-09-11 16:10:25.259038726 +0800
@@ -19,15 +19,15 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Paul Sadauskas <psadauskas at gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_mount.h"
 #include "utils_ignorelist.h"
 
 #if HAVE_STATVFS
 # if HAVE_SYS_STATVFS_H
 #  include <sys/statvfs.h>
@@ -187,22 +187,21 @@
 	struct statvfs statbuf;
 #elif HAVE_STATFS
 	struct statfs statbuf;
 #endif
 	/* struct STATANYFS statbuf; */
 	cu_mount_t *mnt_list;
-	cu_mount_t *mnt_ptr;
 
 	mnt_list = NULL;
 	if (cu_mount_getlist (&mnt_list) == NULL)
 	{
 		ERROR ("df plugin: cu_mount_getlist failed.");
 		return (-1);
 	}
 
-	for (mnt_ptr = mnt_list; mnt_ptr != NULL; mnt_ptr = mnt_ptr->next)
+	for (cu_mount_t *mnt_ptr = mnt_list; mnt_ptr != NULL; mnt_ptr = mnt_ptr->next)
 	{
 		unsigned long long blocksize;
 		char disk_name[256];
 		cu_mount_t *dup_ptr;
 		uint64_t blk_free;
 		uint64_t blk_reserved;
@@ -270,18 +269,18 @@
 		else
 		{
 			if (strcmp (mnt_ptr->dir, "/") == 0)
 				sstrncpy (disk_name, "root", sizeof (disk_name));
 			else
 			{
-				int i, len;
+				int len;
 
 				sstrncpy (disk_name, mnt_ptr->dir + 1, sizeof (disk_name));
 				len = strlen (disk_name);
 
-				for (i = 0; i < len; i++)
+				for (int i = 0; i < len; i++)
 					if (disk_name[i] == '/')
 						disk_name[i] = '-';
 			}
 		}
 
 		blocksize = BLOCKSIZE(statbuf);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/disk.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/disk.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/disk.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/disk.c	2016-09-11 16:10:25.259038726 +0800
@@ -50,12 +51,16 @@
 #if HAVE_IOKIT_STORAGE_IOBLOCKSTORAGEDRIVER_H
 #  include <IOKit/storage/IOBlockStorageDriver.h>
 #endif
 #if HAVE_IOKIT_IOBSD_H
 #  include <IOKit/IOBSD.h>
 #endif
+#if KERNEL_FREEBSD
+#include <devstat.h>
+#include <libgeom.h>
+#endif
 
 #if HAVE_LIMITS_H
 # include <limits.h>
 #endif
 #ifndef UINT_MAX
 #  define UINT_MAX 4294967295U
@@ -99,17 +104,24 @@
 	derive_t read_time;
 	derive_t write_time;
 
 	derive_t avg_read_time;
 	derive_t avg_write_time;
 
+	_Bool has_merged;
+	_Bool has_in_progress;
+	_Bool has_io_time;
+
 	struct diskstats *next;
 } diskstats_t;
 
 static diskstats_t *disklist;
 /* #endif KERNEL_LINUX */
+#elif KERNEL_FREEBSD
+static struct gmesh geom_tree;
+/* #endif KERNEL_FREEBSD */
 
 #elif HAVE_LIBKSTAT
 #define MAX_NUMDISK 1024
 extern kstat_ctl_t *kc;
 static kstat_t *ksp[MAX_NUMDISK];
 static int numdisk = 0;
@@ -216,15 +228,39 @@
 		io_master_port = MACH_PORT_NULL;
 		return (-1);
 	}
 /* #endif HAVE_IOKIT_IOKITLIB_H */
 
 #elif KERNEL_LINUX
-	/* do nothing */
+#if HAVE_LIBUDEV
+	if (conf_udev_name_attr != NULL)
+	{
+		handle_udev = udev_new();
+		if (handle_udev == NULL) {
+			ERROR ("disk plugin: udev_new() failed!");
+			return (-1);
+		}
+	}
+#endif /* HAVE_LIBUDEV */
 /* #endif KERNEL_LINUX */
 
+#elif KERNEL_FREEBSD
+	int rv;
+
+	rv = geom_gettree(&geom_tree);
+	if (rv != 0) {
+		ERROR ("geom_gettree() failed, returned %d", rv);
+		return (-1);
+	}
+	rv = geom_stats_open();
+	if (rv != 0) {
+		ERROR ("geom_stats_open() failed, returned %d", rv);
+		return (-1);
+	}
+/* #endif KERNEL_FREEBSD */
+
 #elif HAVE_LIBKSTAT
 	kstat_t *ksp_chain;
 
 	numdisk = 0;
 
 	if (kc == NULL)
@@ -243,23 +279,30 @@
 	}
 #endif /* HAVE_LIBKSTAT */
 
 	return (0);
 } /* int disk_init */
 
+static int disk_shutdown (void)
+{
+#if KERNEL_LINUX
+#if HAVE_LIBUDEV
+	if (handle_udev != NULL)
+		udev_unref(handle_udev);
+#endif /* HAVE_LIBUDEV */
+#endif /* KERNEL_LINUX */
+	return (0);
+} /* int disk_shutdown */
+
 static void disk_submit (const char *plugin_instance,
 		const char *type,
 		derive_t read, derive_t write)
 {
 	value_t values[2];
 	value_list_t vl = VALUE_LIST_INIT;
 
-	/* Both `ignorelist' and `plugin_instance' may be NULL. */
-	if (ignorelist_match (ignorelist, plugin_instance) != 0)
-	  return;
-
 	values[0].derive = read;
 	values[1].derive = write;
 
 	vl.values = values;
 	vl.values_len = 2;
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
@@ -268,50 +311,46 @@
 			sizeof (vl.plugin_instance));
 	sstrncpy (vl.type, type, sizeof (vl.type));
 
 	plugin_dispatch_values (&vl);
 } /* void disk_submit */
 
-#if KERNEL_LINUX
-static void submit_in_progress (char const *disk_name, gauge_t in_progress)
+#if KERNEL_FREEBSD || KERNEL_LINUX
+static void submit_io_time (char const *plugin_instance, derive_t io_time, derive_t weighted_time)
 {
-	value_t v;
+	value_t values[2];
 	value_list_t vl = VALUE_LIST_INIT;
 
-	if (ignorelist_match (ignorelist, disk_name) != 0)
-	  return;
-
-	v.gauge = in_progress;
+	values[0].derive = io_time;
+	values[1].derive = weighted_time;
 
-	vl.values = &v;
-	vl.values_len = 1;
+	vl.values = values;
+	vl.values_len = 2;
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "disk", sizeof (vl.plugin));
-	sstrncpy (vl.plugin_instance, disk_name, sizeof (vl.plugin_instance));
-	sstrncpy (vl.type, "pending_operations", sizeof (vl.type));
+	sstrncpy (vl.plugin_instance, plugin_instance, sizeof (vl.plugin_instance));
+	sstrncpy (vl.type, "disk_io_time", sizeof (vl.type));
 
 	plugin_dispatch_values (&vl);
-}
+} /* void submit_io_time */
+#endif /* KERNEL_FREEBSD || KERNEL_LINUX */
 
-static void submit_io_time (char const *plugin_instance, derive_t io_time, derive_t weighted_time)
+#if KERNEL_LINUX
+static void submit_in_progress (char const *disk_name, gauge_t in_progress)
 {
-	value_t values[2];
+	value_t v;
 	value_list_t vl = VALUE_LIST_INIT;
 
-	if (ignorelist_match (ignorelist, plugin_instance) != 0)
-	  return;
-
-	values[0].derive = io_time;
-	values[1].derive = weighted_time;
+	v.gauge = in_progress;
 
-	vl.values = values;
-	vl.values_len = 2;
+	vl.values = &v;
+	vl.values_len = 1;
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "disk", sizeof (vl.plugin));
-	sstrncpy (vl.plugin_instance, plugin_instance, sizeof (vl.plugin_instance));
-	sstrncpy (vl.type, "disk_io_time", sizeof (vl.type));
+	sstrncpy (vl.plugin_instance, disk_name, sizeof (vl.plugin_instance));
+	sstrncpy (vl.type, "pending_operations", sizeof (vl.type));
 
 	plugin_dispatch_values (&vl);
 }
 
 
 static counter_t disk_calc_time_incr (counter_t delta_time, counter_t delta_ops)
@@ -364,13 +403,13 @@
 		       	kCFStringEncodingASCII);
 	if (key_obj == NULL)
 	{
 		DEBUG ("CFStringCreateWithCString (%s) failed.", key);
 		return (-1LL);
 	}
-	
+
 	/* get => we don't need to release (== free) the object */
 	val_obj = (CFNumberRef) CFDictionaryGetValue (dict, key_obj);
 
 	CFRelease (key_obj);
 
 	if (val_obj == NULL)
@@ -479,39 +518,167 @@
 				ssnprintf (disk_name, sizeof (disk_name), "%i-%i", disk_major, disk_minor);
 			}
 		}
 		else
 			ssnprintf (disk_name, sizeof (disk_name), "%i-%i", disk_major, disk_minor);
 
+		DEBUG ("disk plugin: disk_name = \"%s\"", disk_name);
+
+		/* check the name against ignore list */
+		if (ignorelist_match (ignorelist, disk_name) != 0) {
+			CFRelease (props_dict);
+			IOObjectRelease (disk);
+			continue;
+		}
+
 		/* extract the stats */
 		read_ops  = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsReadsKey);
 		read_byt  = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsBytesReadKey);
 		read_tme  = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsTotalReadTimeKey);
 		write_ops = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsWritesKey);
 		write_byt = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsBytesWrittenKey);
 		write_tme = dict_get_value (stats_dict, kIOBlockStorageDriverStatisticsTotalWriteTimeKey);
 		CFRelease (props_dict);
 		IOObjectRelease (disk);
 
 		/* and submit */
-		DEBUG ("disk plugin: disk_name = \"%s\"", disk_name);
 		if ((read_byt != -1LL) || (write_byt != -1LL))
 			disk_submit (disk_name, "disk_octets", read_byt, write_byt);
 		if ((read_ops != -1LL) || (write_ops != -1LL))
 			disk_submit (disk_name, "disk_ops", read_ops, write_ops);
 		if ((read_tme != -1LL) || (write_tme != -1LL))
 			disk_submit (disk_name, "disk_time", read_tme / 1000, write_tme / 1000);
 
 	}
 	IOObjectRelease (disk_list);
 /* #endif HAVE_IOKIT_IOKITLIB_H */
 
+#elif KERNEL_FREEBSD
+	int retry, dirty;
+
+	void *snap = NULL;
+	struct devstat *snap_iter;
+
+	struct gident *geom_id;
+
+	const char *disk_name;
+	long double read_time, write_time, busy_time, total_duration;
+
+	for (retry = 0, dirty = 1; retry < 5 && dirty == 1; retry++) {
+		if (snap != NULL)
+			geom_stats_snapshot_free(snap);
+
+		/* Get a fresh copy of stats snapshot */
+		snap = geom_stats_snapshot_get();
+		if (snap == NULL) {
+			ERROR("disk plugin: geom_stats_snapshot_get() failed.");
+			return (-1);
+		}
+
+		/* Check if we have dirty read from this snapshot */
+		dirty = 0;
+		geom_stats_snapshot_reset(snap);
+		while ((snap_iter = geom_stats_snapshot_next(snap)) != NULL) {
+			if (snap_iter->id == NULL)
+				continue;
+			geom_id = geom_lookupid(&geom_tree, snap_iter->id);
+
+			/* New device? refresh GEOM tree */
+			if (geom_id == NULL) {
+				geom_deletetree(&geom_tree);
+				if (geom_gettree(&geom_tree) != 0) {
+					ERROR("disk plugin: geom_gettree() failed");
+					geom_stats_snapshot_free(snap);
+					return (-1);
+				}
+				geom_id = geom_lookupid(&geom_tree, snap_iter->id);
+			}
+			/*
+			 * This should be rare: the device come right before we take the
+			 * snapshot and went away right after it.  We will handle this
+			 * case later, so don't mark dirty but silently ignore it.
+			 */
+			if (geom_id == NULL)
+				continue;
+
+			/* Only collect PROVIDER data */
+			if (geom_id->lg_what != ISPROVIDER)
+				continue;
+
+			/* Only collect data when rank is 1 (physical devices) */
+			if (((struct gprovider *)(geom_id->lg_ptr))->lg_geom->lg_rank != 1)
+				continue;
+
+			/* Check if this is a dirty read quit for another try */
+			if (snap_iter->sequence0 != snap_iter->sequence1) {
+				dirty = 1;
+				break;
+			}
+		}
+	}
+
+	/* Reset iterator */
+	geom_stats_snapshot_reset(snap);
+	for (;;) {
+		snap_iter = geom_stats_snapshot_next(snap);
+		if (snap_iter == NULL)
+			break;
+
+		if (snap_iter->id == NULL)
+			continue;
+		geom_id = geom_lookupid(&geom_tree, snap_iter->id);
+		if (geom_id == NULL)
+			continue;
+		if (geom_id->lg_what != ISPROVIDER)
+			continue;
+		if (((struct gprovider *)(geom_id->lg_ptr))->lg_geom->lg_rank != 1)
+			continue;
+		/* Skip dirty reads, if present */
+		if (dirty && (snap_iter->sequence0 != snap_iter->sequence1))
+			continue;
+
+		disk_name = ((struct gprovider *)geom_id->lg_ptr)->lg_name;
+
+		if (ignorelist_match (ignorelist, disk_name) != 0)
+			continue;
+
+		if ((snap_iter->bytes[DEVSTAT_READ] != 0) || (snap_iter->bytes[DEVSTAT_WRITE] != 0)) {
+			disk_submit(disk_name, "disk_octets",
+					(derive_t)snap_iter->bytes[DEVSTAT_READ],
+					(derive_t)snap_iter->bytes[DEVSTAT_WRITE]);
+		}
+
+		if ((snap_iter->operations[DEVSTAT_READ] != 0) || (snap_iter->operations[DEVSTAT_WRITE] != 0)) {
+			disk_submit(disk_name, "disk_ops",
+					(derive_t)snap_iter->operations[DEVSTAT_READ],
+					(derive_t)snap_iter->operations[DEVSTAT_WRITE]);
+		}
+
+		read_time = devstat_compute_etime(&snap_iter->duration[DEVSTAT_READ], NULL);
+		write_time = devstat_compute_etime(&snap_iter->duration[DEVSTAT_WRITE], NULL);
+		if ((read_time != 0) || (write_time != 0)) {
+			disk_submit (disk_name, "disk_time",
+					(derive_t)(read_time*1000), (derive_t)(write_time*1000));
+		}
+		if (devstat_compute_statistics(snap_iter, NULL, 1.0,
+		    DSM_TOTAL_BUSY_TIME, &busy_time,
+		    DSM_TOTAL_DURATION, &total_duration,
+		    DSM_NONE) != 0) {
+			WARNING("%s", devstat_errbuf);
+		}
+		else
+		{
+			submit_io_time(disk_name, busy_time, total_duration);
+		}
+	}
+	geom_stats_snapshot_free(snap);
+
 #elif KERNEL_LINUX
 	FILE *fh;
 	char buffer[1024];
-	
+
 	char *fields[32];
 	int numfields;
 	int fieldshift = 0;
 
 	int minor = 0;
 
@@ -541,21 +708,16 @@
 		}
 
 		/* Kernel is 2.4.* */
 		fieldshift = 1;
 	}
 
-#if HAVE_LIBUDEV
-	handle_udev = udev_new();
-#endif
-
 	while (fgets (buffer, sizeof (buffer), fh) != NULL)
 	{
 		char *disk_name;
 		char *output_name;
-		char *alt_name;
 
 		numfields = strsplit (buffer, fields, 32);
 
 		if ((numfields != (14 + fieldshift)) && (numfields != 7))
 			continue;
 
@@ -687,12 +849,22 @@
 						diff_write_time, diff_write_ops);
 
 			ds->read_ops = read_ops;
 			ds->read_time = read_time;
 			ds->write_ops = write_ops;
 			ds->write_time = write_time;
+
+			if (read_merged || write_merged)
+				ds->has_merged = 1;
+
+			if (in_progress)
+				ds->has_in_progress = 1;
+
+			if (io_time)
+				ds->has_io_time = 1;
+		
 		} /* if (is_disk) */
 
 		/* Don't write to the RRDs if we've just started.. */
 		ds->poll_count++;
 		if (ds->poll_count <= 2)
 		{
@@ -709,19 +881,29 @@
 			continue;
 		}
 
 		output_name = disk_name;
 
 #if HAVE_LIBUDEV
-		alt_name = disk_udev_attr_name (handle_udev, disk_name,
-				conf_udev_name_attr);
-#else
-		alt_name = NULL;
+		char *alt_name = NULL;
+		if (conf_udev_name_attr != NULL)
+		{
+			alt_name = disk_udev_attr_name (handle_udev, disk_name, conf_udev_name_attr);
+			if (alt_name != NULL)
+				output_name = alt_name;
+		}
 #endif
-		if (alt_name != NULL)
-			output_name = alt_name;
+
+		if (ignorelist_match (ignorelist, output_name) != 0)
+		{
+#if HAVE_LIBUDEV
+			/* release udev-based alternate name, if allocated */
+			sfree (alt_name);
+#endif
+			continue;
+		}
 
 		if ((ds->read_bytes != 0) || (ds->write_bytes != 0))
 			disk_submit (output_name, "disk_octets",
 					ds->read_bytes, ds->write_bytes);
 
 		if ((ds->read_ops != 0) || (ds->write_ops != 0))
@@ -731,25 +913,27 @@
 		if ((ds->avg_read_time != 0) || (ds->avg_write_time != 0))
 			disk_submit (output_name, "disk_time",
 					ds->avg_read_time, ds->avg_write_time);
 
 		if (is_disk)
 		{
-			disk_submit (output_name, "disk_merged",
+			if (ds->has_merged)
+				disk_submit (output_name, "disk_merged",
 					read_merged, write_merged);
-			submit_in_progress (output_name, in_progress);
-			submit_io_time (output_name, io_time, weighted_time);
+			if (ds->has_in_progress)
+				submit_in_progress (output_name, in_progress);
+			if (ds->has_io_time)
+				submit_io_time (output_name, io_time, weighted_time);
 		} /* if (is_disk) */
 
+#if HAVE_LIBUDEV
 		/* release udev-based alternate name, if allocated */
-		free(alt_name);
+		sfree (alt_name);
+#endif
 	} /* while (fgets (buffer, sizeof (buffer), fh) != NULL) */
 
-#if HAVE_LIBUDEV
-	udev_unref(handle_udev);
-#endif
 
 	fclose (fh);
 /* #endif defined(KERNEL_LINUX) */
 
 #elif HAVE_LIBKSTAT
 # if HAVE_KSTAT_IO_T_WRITES && HAVE_KSTAT_IO_T_NWRITES && HAVE_KSTAT_IO_T_WTIME
@@ -767,34 +951,39 @@
 #  define KIO_RTIME   rtime
 #  define KIO_WTIME   wtime
 # else
 #  error "kstat_io_t does not have the required members"
 # endif
 	static kstat_io_t kio;
-	int i;
 
 	if (kc == NULL)
 		return (-1);
 
-	for (i = 0; i < numdisk; i++)
+	for (int i = 0; i < numdisk; i++)
 	{
 		if (kstat_read (kc, ksp[i], &kio) == -1)
 			continue;
 
 		if (strncmp (ksp[i]->ks_class, "disk", 4) == 0)
 		{
+			if (ignorelist_match (ignorelist, ksp[i]->ks_name) != 0)
+				continue;
+
 			disk_submit (ksp[i]->ks_name, "disk_octets",
 					kio.KIO_ROCTETS, kio.KIO_WOCTETS);
 			disk_submit (ksp[i]->ks_name, "disk_ops",
 					kio.KIO_ROPS, kio.KIO_WOPS);
 			/* FIXME: Convert this to microseconds if necessary */
 			disk_submit (ksp[i]->ks_name, "disk_time",
 					kio.KIO_RTIME, kio.KIO_WTIME);
 		}
 		else if (strncmp (ksp[i]->ks_class, "partition", 9) == 0)
 		{
+			if (ignorelist_match (ignorelist, ksp[i]->ks_name) != 0)
+				continue;
+
 			disk_submit (ksp[i]->ks_name, "disk_octets",
 					kio.KIO_ROCTETS, kio.KIO_WOCTETS);
 			disk_submit (ksp[i]->ks_name, "disk_ops",
 					kio.KIO_ROPS, kio.KIO_WOPS);
 		}
 	}
@@ -804,21 +993,26 @@
 	sg_disk_io_stats *ds;
 # if HAVE_LIBSTATGRAB_0_90
 	size_t disks;
 # else
 	int disks;
 #endif
-	int counter;
 	char name[DATA_MAX_NAME_LEN];
-	
+
 	if ((ds = sg_get_disk_io_stats(&disks)) == NULL)
 		return (0);
-		
-	for (counter=0; counter < disks; counter++) {
+
+	for (int counter = 0; counter < disks; counter++) {
 		strncpy(name, ds->disk_name, sizeof(name));
 		name[sizeof(name)-1] = '\0'; /* strncpy doesn't terminate longer strings */
+
+		if (ignorelist_match (ignorelist, name) != 0) {
+			ds++;
+			continue;
+		}
+
 		disk_submit (name, "disk_octets", ds->read_bytes, ds->write_bytes);
 		ds++;
 	}
 /* #endif defined(HAVE_LIBSTATGRAB) */
 
 #elif defined(HAVE_PERFSTAT)
@@ -827,40 +1021,42 @@
 	derive_t read_time;
 	derive_t write_time;
 	derive_t read_ops;
 	derive_t write_ops;
 	perfstat_id_t firstpath;
 	int rnumdisk;
-	int i;
 
-	if ((numdisk = perfstat_disk(NULL, NULL, sizeof(perfstat_disk_t), 0)) < 0) 
+	if ((numdisk = perfstat_disk(NULL, NULL, sizeof(perfstat_disk_t), 0)) < 0)
 	{
 		char errbuf[1024];
 		WARNING ("disk plugin: perfstat_disk: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	if (numdisk != pnumdisk || stat_disk==NULL) {
-		if (stat_disk!=NULL) 
+		if (stat_disk!=NULL)
 			free(stat_disk);
 		stat_disk = (perfstat_disk_t *)calloc(numdisk, sizeof(perfstat_disk_t));
-	} 
+	}
 	pnumdisk = numdisk;
 
 	firstpath.name[0]='\0';
-	if ((rnumdisk = perfstat_disk(&firstpath, stat_disk, sizeof(perfstat_disk_t), numdisk)) < 0) 
+	if ((rnumdisk = perfstat_disk(&firstpath, stat_disk, sizeof(perfstat_disk_t), numdisk)) < 0)
 	{
 		char errbuf[1024];
 		WARNING ("disk plugin: perfstat_disk : %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	for (i = 0; i < rnumdisk; i++) 
+	for (int i = 0; i < rnumdisk; i++)
 	{
+		if (ignorelist_match (ignorelist, stat_disk[i].name) != 0)
+			continue;
+
 		read_sectors = stat_disk[i].rblks*stat_disk[i].bsize;
 		write_sectors = stat_disk[i].wblks*stat_disk[i].bsize;
 		disk_submit (stat_disk[i].name, "disk_octets", read_sectors, write_sectors);
 
 		read_ops = stat_disk[i].xrate;
 		write_ops = stat_disk[i].xfers - stat_disk[i].xrate;
@@ -879,8 +1075,9 @@
 
 void module_register (void)
 {
   plugin_register_config ("disk", disk_config,
       config_keys, config_keys_num);
   plugin_register_init ("disk", disk_init);
+  plugin_register_shutdown ("disk", disk_shutdown);
   plugin_register_read ("disk", disk_read);
 } /* void module_register */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/dns.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/dns.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/dns.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/dns.c	2016-09-11 16:10:25.259038726 +0800
@@ -22,22 +22,25 @@
  **/
 
 #define _DEFAULT_SOURCE
 #define _BSD_SOURCE
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include "utils_dns.h"
-#include <pthread.h>
 #include <poll.h>
 
 #include <pcap.h>
 
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
+#endif
+
 /*
  * Private data types
  */
 struct counter_list_s
 {
 	unsigned int key;
@@ -91,17 +94,16 @@
 
 static counter_list_t *counter_list_create (counter_list_t **list,
 		unsigned int key, unsigned int value)
 {
 	counter_list_t *entry;
 
-	entry = (counter_list_t *) malloc (sizeof (counter_list_t));
+	entry = calloc (1, sizeof (*entry));
 	if (entry == NULL)
 		return (NULL);
 
-	memset (entry, 0, sizeof (counter_list_t));
 	entry->key = key;
 	entry->value = value;
 
 	if (*list == NULL)
 	{
 		*list = entry;
@@ -209,13 +211,13 @@
 }
 
 static int dns_run_pcap_loop (void)
 {
 	pcap_t *pcap_obj;
 	char    pcap_error[PCAP_ERRBUF_SIZE];
-	struct  bpf_program fp;
+	struct  bpf_program fp = { 0 };
 
 	int status;
 
 	/* Don't block any signals */
 	{
 		sigset_t sigmask;
@@ -236,13 +238,12 @@
 				"failed: %s",
 				(pcap_device != NULL) ? pcap_device : "any",
 				pcap_error);
 		return (PCAP_ERROR);
 	}
 
-	memset (&fp, 0, sizeof (fp));
 	status = pcap_compile (pcap_obj, &fp, "udp port 53", 1, 0);
 	if (status < 0)
 	{
 		ERROR ("dns plugin: pcap_compile failed: %s",
 				pcap_statustostr (status));
 		return (status);
@@ -346,12 +347,26 @@
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	listen_thread_init = 1;
 
+#if defined(HAVE_SYS_CAPABILITY_H) && defined(CAP_NET_RAW)
+	if (check_capability (CAP_NET_RAW) != 0)
+	{
+		if (getuid () == 0)
+			WARNING ("dns plugin: Running collectd as root, but the CAP_NET_RAW "
+					"capability is missing. The plugin's read function will probably "
+					"fail. Is your init system dropping capabilities?");
+		else
+			WARNING ("dns plugin: collectd doesn't have the CAP_NET_RAW capability. "
+					"If you don't want to run collectd as root, try running \"setcap "
+					"cap_net_raw=ep\" on the collectd binary.");
+	}
+#endif
+
 	return (0);
 } /* int dns_init */
 
 static void submit_derive (const char *type, const char *type_instance,
 		derive_t value)
 {
@@ -389,13 +404,12 @@
 
 static int dns_read (void)
 {
 	unsigned int keys[T_MAX];
 	unsigned int values[T_MAX];
 	int len;
-	int i;
 
 	counter_list_t *ptr;
 
 	pthread_mutex_lock (&traffic_mutex);
 	values[0] = tr_queries;
 	values[1] = tr_responses;
@@ -411,13 +425,13 @@
 	{
 		keys[len]   = ptr->key;
 		values[len] = ptr->value;
 	}
 	pthread_mutex_unlock (&qtype_mutex);
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		DEBUG ("dns plugin: qtype = %u; counter = %u;", keys[i], values[i]);
 		submit_derive ("dns_qtype", qtype_str (keys[i]), values[i]);
 	}
 
 	pthread_mutex_lock (&opcode_mutex);
@@ -427,13 +441,13 @@
 	{
 		keys[len]   = ptr->key;
 		values[len] = ptr->value;
 	}
 	pthread_mutex_unlock (&opcode_mutex);
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		DEBUG ("dns plugin: opcode = %u; counter = %u;", keys[i], values[i]);
 		submit_derive ("dns_opcode", opcode_str (keys[i]), values[i]);
 	}
 
 	pthread_mutex_lock (&rcode_mutex);
@@ -443,13 +457,13 @@
 	{
 		keys[len]   = ptr->key;
 		values[len] = ptr->value;
 	}
 	pthread_mutex_unlock (&rcode_mutex);
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		DEBUG ("dns plugin: rcode = %u; counter = %u;", keys[i], values[i]);
 		submit_derive ("dns_rcode", rcode_str (keys[i]), values[i]);
 	}
 
 	return (0);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/drbd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/drbd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/drbd.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/drbd.c	2016-09-11 16:10:25.259038726 +0800
@@ -25,13 +25,13 @@
  **/
 
 /*
  See: http://www.drbd.org/users-guide/ch-admin.html#s-performance-indicators
 
  version: 8.3.11 (api:88/proto:86-96)
- srcversion: 71955441799F513ACA6DA60 
+ srcversion: 71955441799F513ACA6DA60
   0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate B r-----
 	 ns:64363752 nr:0 dw:357799284 dr:846902273 al:34987022 bm:18062 lo:0 \
 						pe:0 ua:0 ap:0 ep:1 wo:f oos:0
  */
 
 #include "collectd.h"
@@ -66,13 +67,12 @@
 static int drbd_submit_fields (long int resource,
 		char **fields, size_t fields_num)
 {
 	char plugin_instance[DATA_MAX_NAME_LEN];
 	value_t values[fields_num];
 	value_list_t vl = VALUE_LIST_INIT;
-	size_t i;
 
 	if (resource < 0)
 	{
 		WARNING ("drbd plugin: Unable to parse resource");
 		return (EINVAL);
 	}
@@ -85,13 +85,13 @@
 		return (EINVAL);
 	}
 
 	ssnprintf (plugin_instance, sizeof (plugin_instance), "r%ld",
 			resource);
 
-	for (i = 0; i < drbd_names_num; i++)
+	for (size_t i = 0; i < drbd_names_num; i++)
 	{
 		char *data;
 		/* skip non numeric wo */
 		if (strncmp(fields[i], "wo", 2) == 0)
 			continue;
 		data = strchr(fields[i], ':');
@@ -104,13 +104,13 @@
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "drbd", sizeof (vl.plugin));
 	sstrncpy (vl.plugin_instance, plugin_instance,
 			sizeof (vl.plugin_instance));
 	sstrncpy (vl.type, "drbd_resource", sizeof (vl.type));
 
-	for (i = 0; i < fields_num; i++)
+	for (size_t i = 0; i < fields_num; i++)
 	{
 		if (drbd_names[i] == NULL)
 			continue;
 		vl.values = values + i;
 		sstrncpy (vl.type_instance, drbd_names[i],
 				sizeof (vl.type_instance));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/email.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/email.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/email.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/email.c	2016-09-11 16:10:25.263038721 +0800
@@ -36,24 +36,18 @@
  *
  * successful spam checks
  * c:<type1>[,<type2>,...]
  */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
-#include "configfile.h"
-
 #include <stddef.h>
 
-#if HAVE_LIBPTHREAD
-# include <pthread.h>
-#endif
-
-#include <sys/socket.h>
 #include <sys/un.h>
 #include <sys/select.h>
 
 /* some systems (e.g. Darwin) seem to not define UNIX_PATH_MAX at all */
 #ifndef UNIX_PATH_MAX
 # define UNIX_PATH_MAX sizeof (((struct sockaddr_un *)0)->sun_path)
@@ -217,13 +211,13 @@
 } /* static int email_config (char *, char *) */
 
 /* Increment the value of the given name in the given list by incr. */
 static void type_list_incr (type_list_t *list, char *name, int incr)
 {
 	if (NULL == list->head) {
-		list->head = (type_t *)smalloc (sizeof (type_t));
+		list->head = smalloc (sizeof (*list->head));
 
 		list->head->name  = sstrdup (name);
 		list->head->value = incr;
 		list->head->next  = NULL;
 
 		list->tail = list->head;
@@ -234,13 +228,13 @@
 		for (ptr = list->head; NULL != ptr; ptr = ptr->next) {
 			if (0 == strcmp (name, ptr->name))
 				break;
 		}
 
 		if (NULL == ptr) {
-			list->tail->next = (type_t *)smalloc (sizeof (type_t));
+			list->tail->next = smalloc (sizeof (*list->tail->next));
 			list->tail = list->tail->next;
 
 			list->tail->name  = sstrdup (name);
 			list->tail->value = incr;
 			list->tail->next  = NULL;
 		}
@@ -387,14 +381,14 @@
 } /* static void *collect (void *) */
 
 static void *open_connection (void __attribute__((unused)) *arg)
 {
 	struct sockaddr_un addr;
 
-	char *path  = (NULL == sock_file) ? SOCK_PATH : sock_file;
-	char *group = (NULL == sock_group) ? COLLECTD_GRP_NAME : sock_group;
+	const char *path  = (NULL == sock_file) ? SOCK_PATH : sock_file;
+	const char *group = (NULL == sock_group) ? COLLECTD_GRP_NAME : sock_group;
 
 	/* create UNIX socket */
 	errno = 0;
 	if (-1 == (connector_socket = socket (PF_UNIX, SOCK_STREAM, 0))) {
 		char errbuf[1024];
 		disabled = 1;
@@ -466,36 +460,33 @@
 		char errbuf[1024];
 		log_warn ("chmod() failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 	}
 
 	{ /* initialize collector threads */
-		int i   = 0;
-		int err = 0;
-
 		pthread_attr_t ptattr;
 
 		conns.head = NULL;
 		conns.tail = NULL;
 
 		pthread_attr_init (&ptattr);
 		pthread_attr_setdetachstate (&ptattr, PTHREAD_CREATE_DETACHED);
 
 		available_collectors = max_conns;
 
 		collectors =
-			(collector_t **)smalloc (max_conns * sizeof (collector_t *));
+			smalloc (max_conns * sizeof (*collectors));
 
-		for (i = 0; i < max_conns; ++i) {
-			collectors[i] = (collector_t *)smalloc (sizeof (collector_t));
+		for (int i = 0; i < max_conns; ++i) {
+			collectors[i] = smalloc (sizeof (*collectors[i]));
 			collectors[i]->socket = NULL;
 
-			if (0 != (err = plugin_thread_create (&collectors[i]->thread,
-							&ptattr, collect, collectors[i]))) {
+			if (plugin_thread_create (&collectors[i]->thread,
+							&ptattr, collect, collectors[i]) != 0) {
 				char errbuf[1024];
-				log_err ("pthread_create() failed: %s",
+				log_err ("plugin_thread_create() failed: %s",
 						sstrerror (errno, errbuf, sizeof (errbuf)));
 				collectors[i]->thread = (pthread_t) 0;
 			}
 		}
 
 		pthread_attr_destroy (&ptattr);
@@ -535,19 +526,18 @@
 			}
 
 			/* access() succeeded. */
 			break;
 		}
 
-		connection = malloc (sizeof (*connection));
+		connection = calloc (1, sizeof (*connection));
 		if (connection == NULL)
 		{
 			close (remote);
 			continue;
 		}
-		memset (connection, 0, sizeof (*connection));
 
 		connection->socket = fdopen (remote, "r");
 		connection->next   = NULL;
 
 		if (NULL == connection->socket) {
 			close (remote);
@@ -574,19 +564,17 @@
 	pthread_exit ((void *) 0);
 	return ((void *) 0);
 } /* static void *open_connection (void *) */
 
 static int email_init (void)
 {
-	int err = 0;
-
-	if (0 != (err = plugin_thread_create (&connector, NULL,
-				open_connection, NULL))) {
+	if (plugin_thread_create (&connector, NULL,
+				open_connection, NULL) != 0) {
 		char errbuf[1024];
 		disabled = 1;
-		log_err ("pthread_create() failed: %s",
+		log_err ("plugin_thread_create() failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	return (0);
 } /* int email_init */
@@ -609,14 +597,12 @@
 	t->head = NULL;
 	t->tail = NULL;
 }
 
 static int email_shutdown (void)
 {
-	int i = 0;
-
 	if (connector != ((pthread_t) 0)) {
 		pthread_kill (connector, SIGTERM);
 		connector = (pthread_t) 0;
 	}
 
 	if (connector_socket >= 0) {
@@ -627,13 +613,13 @@
 	/* don't allow any more connections to be processed */
 	pthread_mutex_lock (&conns_mutex);
 
 	available_collectors = 0;
 
 	if (collectors != NULL) {
-		for (i = 0; i < max_conns; ++i) {
+		for (int i = 0; i < max_conns; ++i) {
 			if (collectors[i] == NULL)
 				continue;
 
 			if (collectors[i]->thread != ((pthread_t) 0)) {
 				pthread_kill (collectors[i]->thread, SIGTERM);
 				collectors[i]->thread = (pthread_t) 0;
@@ -685,21 +671,18 @@
 /* Copy list l1 to list l2. l2 may partly exist already, but it is assumed
  * that neither the order nor the name of any element of either list is
  * changed and no elements are deleted. The values of l1 are reset to zero
  * after they have been copied to l2. */
 static void copy_type_list (type_list_t *l1, type_list_t *l2)
 {
-	type_t *ptr1;
-	type_t *ptr2;
-
 	type_t *last = NULL;
 
-	for (ptr1 = l1->head, ptr2 = l2->head; NULL != ptr1;
+	for (type_t *ptr1 = l1->head, *ptr2 = l2->head; NULL != ptr1;
 			ptr1 = ptr1->next, last = ptr2, ptr2 = ptr2->next) {
 		if (NULL == ptr2) {
-			ptr2 = (type_t *)smalloc (sizeof (type_t));
+			ptr2 = smalloc (sizeof (*ptr2));
 			ptr2->name = NULL;
 			ptr2->next = NULL;
 
 			if (NULL == last) {
 				l2->head = ptr2;
 			}
@@ -719,14 +702,12 @@
 	}
 	return;
 }
 
 static int email_read (void)
 {
-	type_t *ptr;
-
 	double score_old;
 	int score_count_old;
 
 	if (disabled)
 		return (-1);
 
@@ -734,24 +715,24 @@
 	pthread_mutex_lock (&count_mutex);
 
 	copy_type_list (&list_count, &list_count_copy);
 
 	pthread_mutex_unlock (&count_mutex);
 
-	for (ptr = list_count_copy.head; NULL != ptr; ptr = ptr->next) {
+	for (type_t *ptr = list_count_copy.head; NULL != ptr; ptr = ptr->next) {
 		email_submit ("email_count", ptr->name, ptr->value);
 	}
 
 	/* email size */
 	pthread_mutex_lock (&size_mutex);
 
 	copy_type_list (&list_size, &list_size_copy);
 
 	pthread_mutex_unlock (&size_mutex);
 
-	for (ptr = list_size_copy.head; NULL != ptr; ptr = ptr->next) {
+	for (type_t *ptr = list_size_copy.head; NULL != ptr; ptr = ptr->next) {
 		email_submit ("email_size", ptr->name, ptr->value);
 	}
 
 	/* spam score */
 	pthread_mutex_lock (&score_mutex);
 
@@ -769,13 +750,13 @@
 	pthread_mutex_lock (&check_mutex);
 
 	copy_type_list (&list_check, &list_check_copy);
 
 	pthread_mutex_unlock (&check_mutex);
 
-	for (ptr = list_check_copy.head; NULL != ptr; ptr = ptr->next)
+	for (type_t *ptr = list_check_copy.head; NULL != ptr; ptr = ptr->next)
 		email_submit ("spam_check", ptr->name, ptr->value);
 
 	return (0);
 } /* int email_read */
 
 void module_register (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ethstat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ethstat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ethstat.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ethstat.c	2016-09-11 16:10:25.263038721 +0800
@@ -20,15 +20,15 @@
  * Authors:
  *   Cyril Feraudet <cyril at feraudet.com>
  *   Florian "octo" Forster <octo@collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_avltree.h"
 #include "utils_complain.h"
 
 #if HAVE_SYS_IOCTL_H
 # include <sys/ioctl.h>
 #endif
@@ -101,29 +101,28 @@
   if (key == NULL)
   {
     ERROR ("ethstat plugin: strdup(3) failed.");
     return (ENOMEM);
   }
 
-  map = malloc (sizeof (*map));
+  map = calloc (1, sizeof (*map));
   if (map == NULL)
   {
     sfree (key);
-    ERROR ("ethstat plugin: malloc(3) failed.");
+    ERROR ("ethstat plugin: calloc failed.");
     return (ENOMEM);
   }
-  memset (map, 0, sizeof (*map));
 
   sstrncpy (map->type, ci->values[1].value.string, sizeof (map->type));
   if (ci->values_num == 3)
     sstrncpy (map->type_instance, ci->values[2].value.string,
         sizeof (map->type_instance));
 
   if (value_map == NULL)
   {
-    value_map = c_avl_create ((void *) strcmp);
+    value_map = c_avl_create ((int (*) (const void *, const void *)) strcmp);
     if (value_map == NULL)
     {
       sfree (map);
       sfree (key);
       ERROR ("ethstat plugin: c_avl_create() failed.");
       return (-1);
@@ -147,15 +146,13 @@
 
   return (0);
 } /* }}} int ethstat_add_map */
 
 static int ethstat_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Interface", child->key) == 0)
       ethstat_add_interface (child);
     else if (strcasecmp ("Map", child->key) == 0)
@@ -214,37 +211,38 @@
   plugin_dispatch_values (&vl);
 }
 
 static int ethstat_read_interface (char *device)
 {
   int fd;
-  struct ifreq req;
-  struct ethtool_drvinfo drvinfo;
   struct ethtool_gstrings *strings;
   struct ethtool_stats *stats;
   size_t n_stats;
   size_t strings_size;
   size_t stats_size;
-  size_t i;
   int status;
 
-  memset (&req, 0, sizeof (req));
-  sstrncpy(req.ifr_name, device, sizeof (req.ifr_name));
-
   fd = socket(AF_INET, SOCK_DGRAM, /* protocol = */ 0);
   if (fd < 0)
   {
     char errbuf[1024];
     ERROR("ethstat plugin: Failed to open control socket: %s",
         sstrerror (errno, errbuf, sizeof (errbuf)));
     return 1;
   }
 
-  memset (&drvinfo, 0, sizeof (drvinfo));
-  drvinfo.cmd = ETHTOOL_GDRVINFO;
-  req.ifr_data = (void *) &drvinfo;
+  struct ethtool_drvinfo drvinfo = {
+    .cmd = ETHTOOL_GDRVINFO
+  };
+
+  struct ifreq req = {
+    .ifr_data = (void *) &drvinfo
+  };
+
+  sstrncpy(req.ifr_name, device, sizeof (req.ifr_name));
+
   status = ioctl (fd, SIOCETHTOOL, &req);
   if (status < 0)
   {
     char errbuf[1024];
     close (fd);
     ERROR ("ethstat plugin: Failed to get driver information "
@@ -270,13 +268,13 @@
   stats = malloc (stats_size);
   if ((strings == NULL) || (stats == NULL))
   {
     close (fd);
     sfree (strings);
     sfree (stats);
-    ERROR("ethstat plugin: malloc(3) failed.");
+    ERROR("ethstat plugin: malloc failed.");
     return (-1);
   }
 
   strings->cmd = ETHTOOL_GSTRINGS;
   strings->string_set = ETH_SS_STATS;
   strings->len = n_stats;
@@ -307,13 +305,13 @@
     ERROR("ethstat plugin: Reading statistics from %s failed: %s",
         device,
         sstrerror (errno, errbuf, sizeof (errbuf)));
     return (-1);
   }
 
-  for (i = 0; i < n_stats; i++)
+  for (size_t i = 0; i < n_stats; i++)
   {
     char *stat_name;
 
     stat_name = (void *) &strings->data[i * ETH_GSTRING_LEN];
     /* Remove leading spaces in key name */
     while (isspace ((int) *stat_name))
@@ -331,15 +329,13 @@
 
   return (0);
 } /* }}} ethstat_read_interface */
 
 static int ethstat_read(void)
 {
-  size_t i;
-
-  for (i = 0; i < interfaces_num; i++)
+  for (size_t i = 0; i < interfaces_num; i++)
     ethstat_read_interface (interfaces[i]);
 
   return 0;
 }
 
 static int ethstat_shutdown (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/exec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/exec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/exec.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/exec.c	2016-09-11 16:10:25.263038721 +0800
@@ -35,13 +36,15 @@
 
 #include <sys/types.h>
 #include <pwd.h>
 #include <grp.h>
 #include <signal.h>
 
-#include <pthread.h>
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
+#endif
 
 #define PL_NORMAL        0x01
 #define PL_NOTIF_ACTION  0x02
 
 #define PL_RUNNING       0x10
 
@@ -123,19 +126,18 @@
   {
     WARNING ("exec plugin: The first two arguments to the `%s' option must "
         "be string arguments.", ci->key);
     return (-1);
   }
 
-  pl = (program_list_t *) malloc (sizeof (program_list_t));
+  pl = calloc (1, sizeof (*pl));
   if (pl == NULL)
   {
-    ERROR ("exec plugin: malloc failed.");
+    ERROR ("exec plugin: calloc failed.");
     return (-1);
   }
-  memset (pl, '\0', sizeof (program_list_t));
 
   if (strcasecmp ("NotificationExec", ci->key) == 0)
     pl->flags |= PL_NOTIF_ACTION;
   else
     pl->flags |= PL_NORMAL;
 
@@ -160,34 +162,33 @@
     ERROR ("exec plugin: strdup failed.");
     sfree (pl->user);
     sfree (pl);
     return (-1);
   }
 
-  pl->argv = (char **) malloc (ci->values_num * sizeof (char *));
+  pl->argv = calloc (ci->values_num, sizeof (*pl->argv));
   if (pl->argv == NULL)
   {
-    ERROR ("exec plugin: malloc failed.");
+    ERROR ("exec plugin: calloc failed.");
     sfree (pl->exec);
     sfree (pl->user);
     sfree (pl);
     return (-1);
   }
-  memset (pl->argv, '\0', ci->values_num * sizeof (char *));
 
   {
     char *tmp = strrchr (ci->values[1].value.string, '/');
     if (tmp == NULL)
       sstrncpy (buffer, ci->values[1].value.string, sizeof (buffer));
     else
       sstrncpy (buffer, tmp + 1, sizeof (buffer));
   }
   pl->argv[0] = strdup (buffer);
   if (pl->argv[0] == NULL)
   {
-    ERROR ("exec plugin: malloc failed.");
+    ERROR ("exec plugin: strdup failed.");
     sfree (pl->argv);
     sfree (pl->exec);
     sfree (pl->user);
     sfree (pl);
     return (-1);
   }
@@ -246,15 +247,13 @@
 
   return (0);
 } /* int exec_config_exec }}} */
 
 static int exec_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if ((strcasecmp ("Exec", child->key) == 0)
         || (strcasecmp ("NotificationExec", child->key) == 0))
       exec_config_exec (child);
     else
@@ -347,13 +346,12 @@
 } /* void exec_child }}} */
 
 static void reset_signal_mask (void) /* {{{ */
 {
   sigset_t ss;
 
-  memset (&ss, 0, sizeof (ss));
   sigemptyset (&ss);
   sigprocmask (SIG_SETMASK, &ss, /* old mask = */ NULL);
 } /* }}} void reset_signal_mask */
 
 static int create_pipe (int fd_pipe[2]) /* {{{ */
 {
@@ -472,17 +470,16 @@
         sstrerror (errno, errbuf, sizeof (errbuf)));
     goto failed;
   }
   else if (pid == 0)
   {
     int fd_num;
-    int fd;
 
     /* Close all file descriptors but the pipe end we need. */
     fd_num = getdtablesize ();
-    for (fd = 0; fd < fd_num; fd++)
+    for (int fd = 0; fd < fd_num; fd++)
     {
       if ((fd == fd_pipe_in[0])
           || (fd == fd_pipe_out[1])
           || (fd == fd_pipe_err[1]))
         continue;
       close (fd);
@@ -722,13 +719,12 @@
 } /* void *exec_read_one }}} */
 
 static void *exec_notification_one (void *arg) /* {{{ */
 {
   program_list_t *pl = ((program_list_and_notification_t *) arg)->pl;
   notification_t *n = &((program_list_and_notification_t *) arg)->n;
-  notification_meta_t *meta;
   int fd;
   FILE *fh;
   int pid;
   int status;
   const char *severity;
 
@@ -770,13 +766,13 @@
     fprintf (fh, "PluginInstance: %s\n", n->plugin_instance);
   if (strlen (n->type) > 0)
     fprintf (fh, "Type: %s\n", n->type);
   if (strlen (n->type_instance) > 0)
     fprintf (fh, "TypeInstance: %s\n", n->type_instance);
 
-  for (meta = n->meta; meta != NULL; meta = meta->next)
+  for (notification_meta_t *meta = n->meta; meta != NULL; meta = meta->next)
   {
     if (meta->type == NM_TYPE_STRING)
       fprintf (fh, "%s: %s\n", meta->name, meta->nm_value.nm_string);
     else if (meta->type == NM_TYPE_SIGNED_INT)
       fprintf (fh, "%s: %"PRIi64"\n", meta->name, meta->nm_value.nm_signed_int);
     else if (meta->type == NM_TYPE_UNSIGNED_INT)
@@ -805,26 +801,40 @@
   pthread_exit ((void *) 0);
   return (NULL);
 } /* void *exec_notification_one }}} */
 
 static int exec_init (void) /* {{{ */
 {
-  struct sigaction sa;
+  struct sigaction sa = {
+    .sa_handler = sigchld_handler
+  };
 
-  memset (&sa, '\0', sizeof (sa));
-  sa.sa_handler = sigchld_handler;
   sigaction (SIGCHLD, &sa, NULL);
 
+#if defined(HAVE_SYS_CAPABILITY_H) && defined(CAP_SETUID) && defined(CAP_SETGID)
+  if ((check_capability (CAP_SETUID) != 0) ||
+      (check_capability (CAP_SETGID) != 0))
+  {
+    if (getuid () == 0)
+      WARNING ("exec plugin: Running collectd as root, but the CAP_SETUID "
+          "or CAP_SETGID capabilities are missing. The plugin's read function "
+          "will probably fail. Is your init system dropping capabilities?");
+    else
+      WARNING ("exec plugin: collectd doesn't have the CAP_SETUID or "
+          "CAP_SETGID capabilities. If you don't want to run collectd as root, "
+          "try running \"setcap 'cap_setuid=ep cap_setgid=ep'\" on the "
+          "collectd binary.");
+  }
+#endif
+
   return (0);
 } /* int exec_init }}} */
 
 static int exec_read (void) /* {{{ */
 {
-  program_list_t *pl;
-
-  for (pl = pl_head; pl != NULL; pl = pl->next)
+  for (program_list_t *pl = pl_head; pl != NULL; pl = pl->next)
   {
     pthread_t t;
     pthread_attr_t attr;
 
     /* Only execute `normal' style executables here. */
     if ((pl->flags & PL_NORMAL) == 0)
@@ -849,30 +859,28 @@
   return (0);
 } /* int exec_read }}} */
 
 static int exec_notification (const notification_t *n, /* {{{ */
     user_data_t __attribute__((unused)) *user_data)
 {
-  program_list_t *pl;
   program_list_and_notification_t *pln;
 
-  for (pl = pl_head; pl != NULL; pl = pl->next)
+  for (program_list_t *pl = pl_head; pl != NULL; pl = pl->next)
   {
     pthread_t t;
     pthread_attr_t attr;
 
     /* Only execute `notification' style executables here. */
     if ((pl->flags & PL_NOTIF_ACTION) == 0)
       continue;
 
     /* Skip if a child is already running. */
     if (pl->pid != 0)
       continue;
 
-    pln = (program_list_and_notification_t *) malloc (sizeof
-        (program_list_and_notification_t));
+    pln = malloc (sizeof (*pln));
     if (pln == NULL)
     {
       ERROR ("exec plugin: malloc failed.");
       continue;
     }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/fhcount.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/fhcount.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/fhcount.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/fhcount.c	2016-09-11 16:10:25.263038721 +0800
@@ -15,15 +15,15 @@
  * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
  * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
  *
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 
 static const char *config_keys[] = {
   "ValuesAbsolute",
   "ValuesPercentage"
 };
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/filecount.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/filecount.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/filecount.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/filecount.c	2016-09-11 16:10:25.263038721 +0800
@@ -19,14 +19,15 @@
  * Authors:
  *   Alessandro Iurlano <alessandro.iurlano at gmail.com>
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
-#include "plugin.h"       
+#include "plugin.h"
 
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <dirent.h>
 #include <fnmatch.h>
@@ -331,29 +332,27 @@
 } /* int fc_config_add_dir_option */
 
 static int fc_config_add_dir (oconfig_item_t *ci)
 {
   fc_directory_conf_t *dir;
   int status;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("filecount plugin: `Directory' needs exactly one string "
         "argument.");
     return (-1);
   }
 
   /* Initialize `dir' */
-  dir = (fc_directory_conf_t *) malloc (sizeof (*dir));
+  dir = calloc (1, sizeof (*dir));
   if (dir == NULL)
   {
-    ERROR ("filecount plugin: malloc failed.");
+    ERROR ("filecount plugin: calloc failed.");
     return (-1);
   }
-  memset (dir, 0, sizeof (*dir));
 
   dir->path = strdup (ci->values[0].value.string);
   if (dir->path == NULL)
   {
     ERROR ("filecount plugin: strdup failed.");
     sfree (dir);
@@ -366,13 +365,13 @@
 
   dir->name = NULL;
   dir->mtime = 0;
   dir->size = 0;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Instance", option->key) == 0)
       status = fc_config_add_dir_instance (dir, option);
     else if (strcasecmp ("Name", option->key) == 0)
@@ -397,13 +396,13 @@
   } /* for (ci->children) */
 
   if (status == 0)
   {
     fc_directory_conf_t **temp;
 
-    temp = (fc_directory_conf_t **) realloc (directories,
+    temp = realloc (directories,
         sizeof (*directories) * (directories_num + 1));
     if (temp == NULL)
     {
       ERROR ("filecount plugin: realloc failed.");
       status = -1;
     }
@@ -426,15 +425,13 @@
 
   return (0);
 } /* int fc_config_add_dir */
 
 static int fc_config (oconfig_item_t *ci)
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("Directory", child->key) == 0)
       fc_config_add_dir (child);
     else
     {
@@ -539,13 +536,13 @@
 
   dir->files_num = 0;
   dir->files_size = 0;
 
   if (dir->mtime != 0)
     dir->now = time (NULL);
-    
+
   status = walk_directory (dir->path, fc_read_dir_callback, dir,
       /* include hidden */ (dir->options & FC_HIDDEN) ? 1 : 0);
   if (status != 0)
   {
     WARNING ("filecount plugin: walk_directory (%s) failed.", dir->path);
     return (-1);
@@ -555,15 +552,13 @@
 
   return (0);
 } /* int fc_read_dir */
 
 static int fc_read (void)
 {
-  size_t i;
-
-  for (i = 0; i < directories_num; i++)
+  for (size_t i = 0; i < directories_num; i++)
     fc_read_dir (directories[i]);
 
   return (0);
 } /* int fc_read */
 
 void module_register (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/fscache.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/fscache.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/fscache.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/fscache.c	2016-09-11 16:10:25.263038721 +0800
@@ -155,13 +156,12 @@
     /* Read file line by line */
     while (fgets (linebuffer, sizeof (linebuffer), fh) != NULL)
     {
         char *lineptr;
         char *fields[32];
         int fields_num;
-        int i;
 
         /* Find the colon and replace it with a null byte */
         lineptr = strchr (linebuffer, ':');
         if (lineptr == NULL)
             continue;
         *lineptr = 0;
@@ -172,20 +172,20 @@
         section_len = strlen (section);
         while ((section_len > 0) && isspace ((int) section[section_len - 1]))
         {
             section_len--;
             section[section_len] = 0;
         }
-        if (section_len <= 0)
+        if (section_len == 0)
             continue;
 
         fields_num = strsplit (lineptr, fields, STATIC_ARRAY_SIZE (fields));
         if (fields_num <= 0)
             continue;
 
-        for (i = 0; i < fields_num; i++)
+        for (int i = 0; i < fields_num; i++)
         {
             char *field_name;
             char *field_value_str;
             value_t field_value_cnt;
             int status;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/gmond.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/gmond.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/gmond.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/gmond.c	2016-09-11 16:10:25.263038721 +0800
@@ -22,23 +22,17 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "utils_avltree.h"
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NETDB_H
 # include <netdb.h>
 #endif
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
@@ -80,18 +74,18 @@
   int flags;
 };
 typedef struct staging_entry_s staging_entry_t;
 
 struct metric_map_s
 {
-  char *ganglia_name;
-  char *type;
-  char *type_instance;
-  char *ds_name;
-  int   ds_type;
-  int   ds_index;
+  char  *ganglia_name;
+  char  *type;
+  char  *type_instance;
+  char  *ds_name;
+  int    ds_type;
+  size_t ds_index;
 };
 typedef struct metric_map_s metric_map_t;
 
 #define MC_RECEIVE_GROUP_DEFAULT "239.2.11.71"
 static char          *mc_receive_group = NULL;
 #define MC_RECEIVE_PORT_DEFAULT "8649"
@@ -163,13 +157,13 @@
   }
 
   if (i >= map_len)
     return (NULL);
 
   /* Look up the DS type and ds_index. */
-  if ((map[i].ds_type < 0) || (map[i].ds_index < 0)) /* {{{ */
+  if (map[i].ds_type < 0) /* {{{ */
   {
     const data_set_t *ds;
 
     ds = plugin_get_ds (map[i].type);
     if (ds == NULL)
     {
@@ -188,13 +182,13 @@
     if (map[i].ds_name == NULL)
     {
       map[i].ds_index = 0;
     }
     else
     {
-      int j;
+      size_t j;
 
       for (j = 0; j < ds->ds_num; j++)
         if (strcasecmp (ds->ds[j].name, map[i].ds_name) == 0)
           break;
 
       if (j >= ds->ds_num)
@@ -214,36 +208,29 @@
 } /* }}} metric_map_t *metric_lookup */
 
 static int create_sockets (socket_entry_t **ret_sockets, /* {{{ */
     size_t *ret_sockets_num,
     const char *node, const char *service, int listen)
 {
-  struct addrinfo  ai_hints;
   struct addrinfo *ai_list;
-  struct addrinfo *ai_ptr;
   int              ai_return;
 
   socket_entry_t *sockets = NULL;
   size_t          sockets_num = 0;
 
   int status;
 
   if (*ret_sockets != NULL)
     return (EINVAL);
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags    = 0;
-#ifdef AI_PASSIVE
-  ai_hints.ai_flags |= AI_PASSIVE;
-#endif
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family   = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_DGRAM;
-  ai_hints.ai_protocol = IPPROTO_UDP;
+  struct addrinfo ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_ADDRCONFIG | AI_PASSIVE,
+    .ai_protocol = IPPROTO_UDP,
+    .ai_socktype = SOCK_DGRAM
+  };
 
   ai_return = getaddrinfo (node, service, &ai_hints, &ai_list);
   if (ai_return != 0)
   {
     char errbuf[1024];
     ERROR ("gmond plugin: getaddrinfo (%s, %s) failed: %s",
@@ -252,13 +239,13 @@
         (ai_return == EAI_SYSTEM)
         ? sstrerror (errno, errbuf, sizeof (errbuf))
         : gai_strerror (ai_return));
     return (-1);
   }
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next) /* {{{ */
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next) /* {{{ */
   {
     socket_entry_t *tmp;
 
     tmp = realloc (sockets, (sockets_num + 1) * sizeof (*sockets));
     if (tmp == NULL)
     {
@@ -311,57 +298,83 @@
       continue;
     }
 
     if (ai_ptr->ai_family == AF_INET)
     {
       struct sockaddr_in *addr;
-      struct ip_mreq mreq;
       int loop;
 
       addr = (struct sockaddr_in *) ai_ptr->ai_addr;
 
       if (!IN_MULTICAST (ntohl (addr->sin_addr.s_addr)))
       {
         sockets_num++;
         continue;
       }
 
       loop = 1;
-      setsockopt (sockets[sockets_num].fd, IPPROTO_IP, IP_MULTICAST_LOOP,
+      status = setsockopt (sockets[sockets_num].fd, IPPROTO_IP, IP_MULTICAST_LOOP,
           (void *) &loop, sizeof (loop));
+      if (status != 0)
+      {
+        char errbuf[1024];
+        WARNING ("gmond plugin: setsockopt(2) failed: %s",
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
+      }
+
+      struct ip_mreq mreq = {
+        .imr_multiaddr.s_addr = addr->sin_addr.s_addr,
+        .imr_interface.s_addr = htonl (INADDR_ANY)
+      };
 
-      memset (&mreq, 0, sizeof (mreq));
-      mreq.imr_multiaddr.s_addr = addr->sin_addr.s_addr;
-      mreq.imr_interface.s_addr = htonl (INADDR_ANY);
-      setsockopt (sockets[sockets_num].fd, IPPROTO_IP, IP_ADD_MEMBERSHIP,
+      status = setsockopt (sockets[sockets_num].fd, IPPROTO_IP, IP_ADD_MEMBERSHIP,
           (void *) &mreq, sizeof (mreq));
+      if (status != 0)
+      {
+        char errbuf[1024];
+        WARNING ("gmond plugin: setsockopt(2) failed: %s",
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
+      }
     } /* if (ai_ptr->ai_family == AF_INET) */
     else if (ai_ptr->ai_family == AF_INET6)
     {
       struct sockaddr_in6 *addr;
-      struct ipv6_mreq mreq;
       int loop;
 
       addr = (struct sockaddr_in6 *) ai_ptr->ai_addr;
 
       if (!IN6_IS_ADDR_MULTICAST (&addr->sin6_addr))
       {
         sockets_num++;
         continue;
       }
 
       loop = 1;
-      setsockopt (sockets[sockets_num].fd, IPPROTO_IPV6, IPV6_MULTICAST_LOOP,
+      status = setsockopt (sockets[sockets_num].fd, IPPROTO_IPV6, IPV6_MULTICAST_LOOP,
           (void *) &loop, sizeof (loop));
+      if (status != 0)
+      {
+        char errbuf[1024];
+        WARNING ("gmond plugin: setsockopt(2) failed: %s",
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
+      }
+
+      struct ipv6_mreq mreq = {
+        .ipv6mr_interface = 0 /* any */
+      };
 
-      memset (&mreq, 0, sizeof (mreq));
       memcpy (&mreq.ipv6mr_multiaddr,
           &addr->sin6_addr, sizeof (addr->sin6_addr));
-      mreq.ipv6mr_interface = 0; /* any */
-      setsockopt (sockets[sockets_num].fd, IPPROTO_IPV6, IPV6_ADD_MEMBERSHIP,
+      status = setsockopt (sockets[sockets_num].fd, IPPROTO_IPV6, IPV6_ADD_MEMBERSHIP,
           (void *) &mreq, sizeof (mreq));
+      if (status != 0)
+      {
+        char errbuf[1024];
+        WARNING ("gmond plugin: setsockopt(2) failed: %s",
+                 sstrerror (errno, errbuf, sizeof (errbuf)));
+      }
     } /* if (ai_ptr->ai_family == AF_INET6) */
 
     sockets_num++;
   } /* }}} for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next) */
 
   freeaddrinfo (ai_list);
@@ -376,19 +389,16 @@
   *ret_sockets_num = sockets_num;
   return (0);
 } /* }}} int create_sockets */
 
 static int request_meta_data (const char *host, const char *name) /* {{{ */
 {
-  Ganglia_metadata_msg msg;
-  char buffer[BUFF_SIZE];
+  Ganglia_metadata_msg msg = { 0 };
+  char buffer[BUFF_SIZE] = { 0 };
   unsigned int buffer_size;
   XDR xdr;
-  size_t i;
-
-  memset (&msg, 0, sizeof (msg));
 
   msg.id = gmetadata_request;
   msg.Ganglia_metadata_msg_u.grequest.metric_id.host = strdup (host);
   msg.Ganglia_metadata_msg_u.grequest.metric_id.name = strdup (name);
 
   if ((msg.Ganglia_metadata_msg_u.grequest.metric_id.host == NULL)
@@ -396,13 +406,12 @@
   {
     sfree (msg.Ganglia_metadata_msg_u.grequest.metric_id.host);
     sfree (msg.Ganglia_metadata_msg_u.grequest.metric_id.name);
     return (-1);
   }
 
-  memset (buffer, 0, sizeof (buffer));
   xdrmem_create (&xdr, buffer, sizeof (buffer), XDR_ENCODE);
 
   if (!xdr_Ganglia_metadata_msg (&xdr, &msg))
   {
     sfree (msg.Ganglia_metadata_msg_u.grequest.metric_id.host);
     sfree (msg.Ganglia_metadata_msg_u.grequest.metric_id.name);
@@ -412,13 +421,13 @@
   buffer_size = xdr_getpos (&xdr);
 
   DEBUG ("gmond plugin: Requesting meta data for %s/%s.",
       host, name);
 
   pthread_mutex_lock (&mc_send_sockets_lock);
-  for (i = 0; i < mc_send_sockets_num; i++)
+  for (size_t i = 0; i < mc_send_sockets_num; i++)
   {
     ssize_t status = sendto (mc_send_sockets[i].fd, buffer, (size_t) buffer_size,
         /* flags = */ 0,
         (struct sockaddr *) &mc_send_sockets[i].addr,
         mc_send_sockets[i].addrlen);
     if (status == -1)
@@ -454,16 +463,15 @@
   se = NULL;
   status = c_avl_get (staging_tree, key, (void *) &se);
   if (status == 0)
     return (se);
 
   /* insert new entry */
-  se = (staging_entry_t *) malloc (sizeof (*se));
+  se = calloc (1, sizeof (*se));
   if (se == NULL)
     return (NULL);
-  memset (se, 0, sizeof (*se));
 
   sstrncpy (se->key, key, sizeof (se->key));
   se->flags = 0;
 
   se->vl.values = (value_t *) calloc (values_len, sizeof (*se->vl.values));
   if (se->vl.values == NULL)
@@ -493,13 +501,13 @@
 
   return (se);
 } /* }}} staging_entry_t *staging_entry_get */
 
 static int staging_entry_update (const char *host, const char *name, /* {{{ */
     const char *type, const char *type_instance,
-    int ds_index, int ds_type, value_t value)
+    size_t ds_index, int ds_type, value_t value)
 {
   const data_set_t *ds;
   staging_entry_t *se;
 
   ds = plugin_get_ds (type);
   if (ds == NULL)
@@ -507,13 +515,13 @@
     ERROR ("gmond plugin: Looking up type %s failed.", type);
     return (-1);
   }
 
   if (ds->ds_num <= ds_index)
   {
-    ERROR ("gmond plugin: Invalid index %i: %s has only %i data source(s).",
+    ERROR ("gmond plugin: Invalid index %zu: %s has only %zu data source(s).",
         ds_index, ds->type, ds->ds_num);
     return (-1);
   }
 
   pthread_mutex_lock (&staging_lock);
 
@@ -693,13 +701,13 @@
       staging_entry_t *se;
       const data_set_t *ds;
       metric_map_t *map;
 
       msg_meta = msg->Ganglia_metadata_msg_u.gfull;
 
-      if (msg_meta.metric.tmax <= 0)
+      if (msg_meta.metric.tmax == 0)
         return (-1);
 
       map = metric_lookup (msg_meta.metric_id.name);
       if (map == NULL)
       {
         DEBUG ("gmond plugin: Not handling meta data %s.",
@@ -761,25 +769,23 @@
     case gmetric_int:
     case gmetric_uint:
     case gmetric_string:
     case gmetric_float:
     case gmetric_double:
     {
-      Ganglia_value_msg msg;
+      Ganglia_value_msg msg = { 0 };
 
-      memset (&msg, 0, sizeof (msg));
       if (xdr_Ganglia_value_msg (&xdr, &msg))
         mc_handle_value_msg (&msg);
       break;
     }
 
     case gmetadata_full:
     case gmetadata_request:
     {
-      Ganglia_metadata_msg msg;
-      memset (&msg, 0, sizeof (msg));
+      Ganglia_metadata_msg msg = { 0 };
       if (xdr_Ganglia_metadata_msg (&xdr, &msg))
         mc_handle_metadata_msg (&msg);
       break;
     }
 
     default:
@@ -817,13 +823,12 @@
 } /* }}} int mc_handle_socket */
 
 static void *mc_receive_thread (void *arg) /* {{{ */
 {
   socket_entry_t *mc_receive_socket_entries;
   int status;
-  size_t i;
 
   mc_receive_socket_entries = NULL;
   status = create_sockets (&mc_receive_socket_entries, &mc_receive_sockets_num,
       (mc_receive_group != NULL) ? mc_receive_group : MC_RECEIVE_GROUP_DEFAULT,
       (mc_receive_port != NULL) ? mc_receive_port : MC_RECEIVE_PORT_DEFAULT,
       /* listen = */ 1);
@@ -835,21 +840,21 @@
 
   mc_receive_sockets = (struct pollfd *) calloc (mc_receive_sockets_num,
       sizeof (*mc_receive_sockets));
   if (mc_receive_sockets == NULL)
   {
     ERROR ("gmond plugin: calloc failed.");
-    for (i = 0; i < mc_receive_sockets_num; i++)
+    for (size_t i = 0; i < mc_receive_sockets_num; i++)
       close (mc_receive_socket_entries[i].fd);
     free (mc_receive_socket_entries);
     mc_receive_socket_entries = NULL;
     mc_receive_sockets_num = 0;
     return ((void *) -1);
   }
 
-  for (i = 0; i < mc_receive_sockets_num; i++)
+  for (size_t i = 0; i < mc_receive_sockets_num; i++)
   {
     mc_receive_sockets[i].fd = mc_receive_socket_entries[i].fd;
     mc_receive_sockets[i].events = POLLIN | POLLPRI;
     mc_receive_sockets[i].revents = 0;
   }
 
@@ -863,13 +868,13 @@
         continue;
       ERROR ("gmond plugin: poll failed: %s",
           sstrerror (errno, errbuf, sizeof (errbuf)));
       break;
     }
 
-    for (i = 0; i < mc_receive_sockets_num; i++)
+    for (size_t i = 0; i < mc_receive_sockets_num; i++)
     {
       if (mc_receive_sockets[i].revents != 0)
         mc_handle_socket (mc_receive_sockets + i);
     }
   } /* while (mc_receive_thread_loop != 0) */
 
@@ -913,13 +918,13 @@
 
   mc_receive_thread_running = 0;
 
   return (0);
 } /* }}} int mc_receive_thread_stop */
 
-/* 
+/*
  * Config:
  *
  * <Plugin gmond>
  *   MCReceiveFrom "239.2.11.71" "8649"
  *   <Metric "load_one">
  *     Type "load"
@@ -951,13 +956,12 @@
   return (0);
 } /* }}} int gmond_config_set_string */
 
 static int gmond_config_add_metric (oconfig_item_t *ci) /* {{{ */
 {
   metric_map_t *map;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("gmond plugin: `Metric' blocks need "
         "exactly one string argument.");
     return (-1);
@@ -983,13 +987,13 @@
   if (map->ganglia_name == NULL)
   {
     ERROR ("gmond plugin: strdup failed.");
     return (-1);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("Type", child->key) == 0)
       gmond_config_set_string (child, &map->type);
     else if (strcasecmp ("TypeInstance", child->key) == 0)
       gmond_config_set_string (child, &map->type_instance);
@@ -1060,15 +1064,13 @@
 
   return (0);
 } /* }}} int gmond_config_set_address */
 
 static int gmond_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("MCReceiveFrom", child->key) == 0)
       gmond_config_set_address (child, &mc_receive_group, &mc_receive_port);
     else if (strcasecmp ("Metric", child->key) == 0)
       gmond_config_add_metric (child);
@@ -1086,13 +1088,13 @@
 {
   create_sockets (&mc_send_sockets, &mc_send_sockets_num,
       (mc_receive_group != NULL) ? mc_receive_group : MC_RECEIVE_GROUP_DEFAULT,
       (mc_receive_port != NULL) ? mc_receive_port : MC_RECEIVE_PORT_DEFAULT,
       /* listen = */ 0);
 
-  staging_tree = c_avl_create ((void *) strcmp);
+  staging_tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
   if (staging_tree == NULL)
   {
     ERROR ("gmond plugin: c_avl_create failed.");
     return (-1);
   }
 
@@ -1100,18 +1102,16 @@
 
   return (0);
 } /* }}} int gmond_init */
 
 static int gmond_shutdown (void) /* {{{ */
 {
-  size_t i;
-
   mc_receive_thread_stop ();
 
   pthread_mutex_lock (&mc_send_sockets_lock);
-  for (i = 0; i < mc_send_sockets_num; i++)
+  for (size_t i = 0; i < mc_send_sockets_num; i++)
   {
     close (mc_send_sockets[i].fd);
     mc_send_sockets[i].fd = -1;
   }
   sfree (mc_send_sockets);
   mc_send_sockets_num = 0;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: gps.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: grpc.cc
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/hddtemp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/hddtemp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/hddtemp.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/hddtemp.c	2016-09-11 16:10:25.263038721 +0800
@@ -27,18 +27,17 @@
  *   Do a pass, some day, and spare some memory. We consume too much for now
  *   in string buffers and the like.
  *
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 # include <netdb.h>
-# include <sys/socket.h>
 # include <netinet/in.h>
 # include <netinet/tcp.h>
 # include <libgen.h> /* for basename */
 
 #if HAVE_LINUX_MAJOR_H
 # include <linux/major.h>
@@ -86,46 +85,43 @@
 	ssize_t status;
 	int buffer_fill;
 
 	const char *host;
 	const char *port;
 
-	struct addrinfo  ai_hints;
-	struct addrinfo *ai_list, *ai_ptr;
+	struct addrinfo *ai_list;
 	int              ai_return;
 
-	memset (&ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_flags    = 0;
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags   |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family   = PF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_STREAM;
-	ai_hints.ai_protocol = IPPROTO_TCP;
-
 	host = hddtemp_host;
 	if (host == NULL)
 		host = HDDTEMP_DEF_HOST;
 
 	port = hddtemp_port;
 	if (strlen (port) == 0)
 		port = HDDTEMP_DEF_PORT;
 
+	struct addrinfo ai_hints = {
+		.ai_flags = AI_ADDRCONFIG,
+		.ai_family = AF_UNSPEC,
+		.ai_protocol = IPPROTO_TCP,
+		.ai_socktype = SOCK_STREAM
+	};
+
 	if ((ai_return = getaddrinfo (host, port, &ai_hints, &ai_list)) != 0)
 	{
 		char errbuf[1024];
 		ERROR ("hddtemp plugin: getaddrinfo (%s, %s): %s",
 				host, port,
 				(ai_return == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
 				: gai_strerror (ai_return));
 		return (-1);
 	}
 
 	fd = -1;
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		/* create our socket descriptor */
 		fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype,
 				ai_ptr->ai_protocol);
 		if (fd < 0)
 		{
@@ -250,13 +246,12 @@
 	char buf[1024];
 	char *fields[128];
 	char *ptr;
 	char *saveptr;
 	int num_fields;
 	int num_disks;
-	int i;
 
 	/* get data from daemon */
 	if (hddtemp_query_daemon (buf, sizeof (buf)) < 0)
 		return (-1);
 
 	/* NB: strtok_r will eat up "||" and leading "|"'s */
@@ -271,13 +266,13 @@
 		if (num_fields >= 128)
 			break;
 	}
 
 	num_disks = num_fields / 4;
 
-	for (i = 0; i < num_disks; i++)
+	for (int i = 0; i < num_disks; i++)
 	{
 		char *name;
 		double temperature;
 		char *mode;
 
 		mode = fields[4*i + 3];
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/interface.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/interface.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/interface.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/interface.c	2016-09-11 16:10:25.263038721 +0800
@@ -20,23 +20,20 @@
  *   Florian octo Forster <octo at collectd.org>
  *   Sune Marcher <sm at flork.dk>
  *   Manuel Sanmartin
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 
 #if HAVE_SYS_TYPES_H
 #  include <sys/types.h>
 #endif
-#if HAVE_SYS_SOCKET_H
-#  include <sys/socket.h>
-#endif
 
 /* One cannot include both. This sucks. */
 #if HAVE_LINUX_IF_H
 #  include <linux/if.h>
 #elif HAVE_NET_IF_H
 #  include <net/if.h>
@@ -84,23 +81,26 @@
  * (Module-)Global variables
  */
 static const char *config_keys[] =
 {
 	"Interface",
 	"IgnoreSelected",
-	NULL
+	"ReportInactive",
 };
-static int config_keys_num = 2;
+static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static ignorelist_t *ignorelist = NULL;
 
+static _Bool report_inactive = 1;
+
 #ifdef HAVE_LIBKSTAT
 #define MAX_NUMIF 256
 extern kstat_ctl_t *kc;
 static kstat_t *ksp[MAX_NUMIF];
 static int numif = 0;
+static _Bool unique_name = 0;
 #endif /* HAVE_LIBKSTAT */
 
 static int interface_config (const char *key, const char *value)
 {
 	if (ignorelist == NULL)
 		ignorelist = ignorelist_create (/* invert = */ 1);
@@ -113,25 +113,35 @@
 	{
 		int invert = 1;
 		if (IS_TRUE (value))
 			invert = 0;
 		ignorelist_set_invert (ignorelist, invert);
 	}
+	else if (strcasecmp (key, "ReportInactive") == 0)
+		report_inactive = IS_TRUE (value);
+	else if (strcasecmp (key, "UniqueName") == 0)
+	{
+		#ifdef HAVE_LIBKSTAT
+		if (IS_TRUE (value))
+			unique_name = 1;
+		#else
+			WARNING ("interface plugin: the \"UniqueName\" option is only valid on Solaris.");
+		#endif /* HAVE_LIBKSTAT */
+	}
 	else
 	{
 		return (-1);
 	}
 
 	return (0);
 }
 
 #if HAVE_LIBKSTAT
 static int interface_init (void)
 {
 	kstat_t *ksp_chain;
-	derive_t val;
 
 	numif = 0;
 
 	if (kc == NULL)
 		return (-1);
 
@@ -142,13 +152,13 @@
 		if (strncmp (ksp_chain->ks_class, "net", 3))
 			continue;
 		if (ksp_chain->ks_type != KSTAT_TYPE_NAMED)
 			continue;
 		if (kstat_read (kc, ksp_chain, NULL) == -1)
 			continue;
-		if ((val = get_kstat_value (ksp_chain, "obytes")) == -1LL)
+		if (get_kstat_value (ksp_chain, "obytes") == -1LL)
 			continue;
 		ksp[numif++] = ksp_chain;
 	}
 
 	return (0);
 } /* int interface_init */
@@ -178,15 +188,14 @@
 } /* void if_submit */
 
 static int interface_read (void)
 {
 #if HAVE_GETIFADDRS
 	struct ifaddrs *if_list;
-	struct ifaddrs *if_ptr;
 
-/* Darin/Mac OS X and possible other *BSDs */
+/* Darwin/Mac OS X and possible other *BSDs */
 #if HAVE_STRUCT_IF_DATA
 #  define IFA_DATA if_data
 #  define IFA_RX_BYTES ifi_ibytes
 #  define IFA_TX_BYTES ifi_obytes
 #  define IFA_RX_PACKT ifi_ipackets
 #  define IFA_TX_PACKT ifi_opackets
@@ -208,17 +217,20 @@
 
 	struct IFA_DATA *if_data;
 
 	if (getifaddrs (&if_list) != 0)
 		return (-1);
 
-	for (if_ptr = if_list; if_ptr != NULL; if_ptr = if_ptr->ifa_next)
+	for (struct ifaddrs *if_ptr = if_list; if_ptr != NULL; if_ptr = if_ptr->ifa_next)
 	{
 		if (if_ptr->ifa_addr != NULL && if_ptr->ifa_addr->sa_family == AF_LINK) {
 			if_data = (struct IFA_DATA *) if_ptr->ifa_data;
 
+			if (!report_inactive && if_data->IFA_RX_PACKT == 0 && if_data->IFA_TX_PACKT == 0)
+				continue;
+
 			if_submit (if_ptr->ifa_name, "if_octets",
 				if_data->IFA_RX_BYTES,
 				if_data->IFA_TX_BYTES);
 			if_submit (if_ptr->ifa_name, "if_packets",
 				if_data->IFA_RX_PACKT,
 				if_data->IFA_TX_PACKT);
@@ -265,112 +277,131 @@
 
 		numfields = strsplit (dummy, fields, 16);
 
 		if (numfields < 11)
 			continue;
 
-		incoming = atoll (fields[0]);
-		outgoing = atoll (fields[8]);
-		if_submit (device, "if_octets", incoming, outgoing);
-
 		incoming = atoll (fields[1]);
 		outgoing = atoll (fields[9]);
+		if (!report_inactive && incoming == 0 && outgoing == 0)
+			continue;
+
 		if_submit (device, "if_packets", incoming, outgoing);
 
+		incoming = atoll (fields[0]);
+		outgoing = atoll (fields[8]);
+		if_submit (device, "if_octets", incoming, outgoing);
+
 		incoming = atoll (fields[2]);
 		outgoing = atoll (fields[10]);
 		if_submit (device, "if_errors", incoming, outgoing);
+
+		incoming = atoll (fields[3]);
+		outgoing = atoll (fields[11]);
+		if_submit (device, "if_dropped", incoming, outgoing);
 	}
 
 	fclose (fh);
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_LIBKSTAT
-	int i;
 	derive_t rx;
 	derive_t tx;
+	char iname[DATA_MAX_NAME_LEN];
 
 	if (kc == NULL)
 		return (-1);
 
-	for (i = 0; i < numif; i++)
+	for (int i = 0; i < numif; i++)
 	{
 		if (kstat_read (kc, ksp[i], NULL) == -1)
 			continue;
 
+		if (unique_name)
+			ssnprintf(iname, sizeof(iname), "%s_%d_%s", ksp[i]->ks_module, ksp[i]->ks_instance, ksp[i]->ks_name);
+		else
+			sstrncpy(iname, ksp[i]->ks_name, sizeof(iname));
+
 		/* try to get 64bit counters */
-		rx = get_kstat_value (ksp[i], "rbytes64");
-		tx = get_kstat_value (ksp[i], "obytes64");
+		rx = get_kstat_value (ksp[i], "ipackets64");
+		tx = get_kstat_value (ksp[i], "opackets64");
 		/* or fallback to 32bit */
 		if (rx == -1LL)
-			rx = get_kstat_value (ksp[i], "rbytes");
+			rx = get_kstat_value (ksp[i], "ipackets");
 		if (tx == -1LL)
-			tx = get_kstat_value (ksp[i], "obytes");
+			tx = get_kstat_value (ksp[i], "opackets");
+		if (!report_inactive && rx == 0 && tx == 0)
+			continue;
 		if ((rx != -1LL) || (tx != -1LL))
-			if_submit (ksp[i]->ks_name, "if_octets", rx, tx);
+			if_submit (iname, "if_packets", rx, tx);
 
 		/* try to get 64bit counters */
-		rx = get_kstat_value (ksp[i], "ipackets64");
-		tx = get_kstat_value (ksp[i], "opackets64");
+		rx = get_kstat_value (ksp[i], "rbytes64");
+		tx = get_kstat_value (ksp[i], "obytes64");
 		/* or fallback to 32bit */
 		if (rx == -1LL)
-			rx = get_kstat_value (ksp[i], "ipackets");
+			rx = get_kstat_value (ksp[i], "rbytes");
 		if (tx == -1LL)
-			tx = get_kstat_value (ksp[i], "opackets");
+			tx = get_kstat_value (ksp[i], "obytes");
 		if ((rx != -1LL) || (tx != -1LL))
-			if_submit (ksp[i]->ks_name, "if_packets", rx, tx);
+			if_submit (iname, "if_octets", rx, tx);
 
 		/* no 64bit error counters yet */
 		rx = get_kstat_value (ksp[i], "ierrors");
 		tx = get_kstat_value (ksp[i], "oerrors");
 		if ((rx != -1LL) || (tx != -1LL))
-			if_submit (ksp[i]->ks_name, "if_errors", rx, tx);
+			if_submit (iname, "if_errors", rx, tx);
 	}
 /* #endif HAVE_LIBKSTAT */
 
 #elif defined(HAVE_LIBSTATGRAB)
 	sg_network_io_stats *ios;
-	int i, num;
+	int num;
 
 	ios = sg_get_network_io_stats (&num);
 
-	for (i = 0; i < num; i++)
+	for (int i = 0; i < num; i++) {
+		if (!report_inactive && ios[i].rx == 0 && ios[i].tx == 0)
+			continue;
 		if_submit (ios[i].interface_name, "if_octets", ios[i].rx, ios[i].tx);
+	}
 /* #endif HAVE_LIBSTATGRAB */
 
 #elif defined(HAVE_PERFSTAT)
 	perfstat_id_t id;
-	int i, ifs;
+	int ifs;
 
 	if ((nif =  perfstat_netinterface(NULL, NULL, sizeof(perfstat_netinterface_t), 0)) < 0)
 	{
 		char errbuf[1024];
 		WARNING ("interface plugin: perfstat_netinterface: %s",
 			sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	if (pnif != nif || ifstat == NULL)
 	{
-		if (ifstat != NULL)
-			free(ifstat);
-		ifstat = malloc(nif * sizeof(perfstat_netinterface_t));
+		free(ifstat);
+		ifstat = malloc(nif * sizeof (*ifstat));
 	}
 	pnif = nif;
 
 	id.name[0]='\0';
 	if ((ifs = perfstat_netinterface(&id, ifstat, sizeof(perfstat_netinterface_t), nif)) < 0)
 	{
 		char errbuf[1024];
 		WARNING ("interface plugin: perfstat_netinterface (interfaces=%d): %s",
 			nif, sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	for (i = 0; i < ifs; i++)
+	for (int i = 0; i < ifs; i++)
 	{
+		if (!report_inactive && ifstat[i].ipackets == 0 && ifstat[i].opackets == 0)
+			continue;
+
 		if_submit (ifstat[i].name, "if_octets", ifstat[i].ibytes, ifstat[i].obytes);
 		if_submit (ifstat[i].name, "if_packets", ifstat[i].ipackets ,ifstat[i].opackets);
 		if_submit (ifstat[i].name, "if_errors", ifstat[i].ierrors, ifstat[i].oerrors );
 	}
 #endif /* HAVE_PERFSTAT */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipc.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipc.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipc.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipc.c	2016-09-11 16:10:25.263038721 +0800
@@ -24,15 +24,15 @@
 
 /* Many of this code is based on busybox ipc implementation, which is:
  *   (C) Rodney Radford <rradford@mindspring.com> and distributed under GPLv2.
  */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #if KERNEL_LINUX
   /* _GNU_SOURCE is needed for struct shm_info.used_ids on musl libc */
 # define _GNU_SOURCE
 
   /* X/OPEN tells us to use <sys/{types,ipc,sem}.h> for semctl() */
@@ -210,13 +210,13 @@
     ERROR ("ipc plugin: ipc_get_info: missmatch struct size and buffer size");
     return (NULL);
   }
 
   *nmemb = size / stsize;
 
-  buff = (caddr_t)malloc (size);
+  buff = malloc (size);
   if (buff == NULL)  {
     ERROR ("ipc plugin: ipc_get_info malloc failed.");
     return (NULL);
   }
 
   if (get_ipc_info(cid, cmd, version, buff, &size) < 0)
@@ -233,20 +233,20 @@
 
 static int ipc_read_sem (void) /* {{{ */
 {
   ipcinfo_sem_t *ipcinfo_sem;
   unsigned short sem_nsems=0;
   unsigned short sems=0;
-  int i,n;
+  int n;
 
   ipcinfo_sem = (ipcinfo_sem_t *)ipc_get_info(0,
     GET_IPCINFO_SEM_ALL, IPCINFO_SEM_VERSION, sizeof(ipcinfo_sem_t), &n);
   if (ipcinfo_sem == NULL)
     return -1;
 
-  for (i=0; i<n; i++) {
+  for (int i=0; i<n; i++) {
     sem_nsems += ipcinfo_sem[i].sem_nsems;
     sems++;
   }
   free(ipcinfo_sem);
 
   ipc_submit_g("sem", "count", "arrays", sem_nsems);
@@ -258,20 +258,20 @@
 static int ipc_read_shm (void) /* {{{ */
 {
   ipcinfo_shm_t *ipcinfo_shm;
   ipcinfo_shm_t *pshm;
   unsigned int shm_segments=0;
   size64_t shm_bytes=0;
-  int i,n;
+  int n;
 
   ipcinfo_shm = (ipcinfo_shm_t *)ipc_get_info(0,
     GET_IPCINFO_SHM_ALL, IPCINFO_SHM_VERSION, sizeof(ipcinfo_shm_t), &n);
   if (ipcinfo_shm == NULL)
     return -1;
 
-  for (i=0, pshm=ipcinfo_shm; i<n; i++, pshm++) {
+  for (int i=0, pshm=ipcinfo_shm; i<n; i++, pshm++) {
     shm_segments++;
     shm_bytes += pshm->shm_segsz;
   }
   free(ipcinfo_shm);
 
   ipc_submit_g("shm", "segments", NULL, shm_segments);
@@ -284,24 +284,24 @@
 static int ipc_read_msg (void) /* {{{ */
 {
   ipcinfo_msg_t *ipcinfo_msg;
   uint32_t msg_used_space=0;
   uint32_t msg_alloc_queues=0;
   msgqnum32_t msg_qnum=0;
-  int i,n;
+  int n;
 
   ipcinfo_msg = (ipcinfo_msg_t *)ipc_get_info(0,
     GET_IPCINFO_MSG_ALL, IPCINFO_MSG_VERSION, sizeof(ipcinfo_msg_t), &n);
   if (ipcinfo_msg == NULL)
     return -1;
 
-  for (i=0; i<n; i++) {
+  for (int i=0; i<n; i++) {
     msg_alloc_queues++;
     msg_used_space += ipcinfo_msg[i].msg_cbytes;
     msg_qnum += ipcinfo_msg[i].msg_qnum;
-
+  }
   free(ipcinfo_msg);
 
   ipc_submit_g("msg", "count", "queues", msg_alloc_queues);
   ipc_submit_g("msg", "count", "headers", msg_qnum);
   ipc_submit_g("msg", "count", "space", msg_used_space);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipmi.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipmi.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipmi.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipmi.c	2016-09-11 16:10:25.263038721 +0800
@@ -21,18 +21,17 @@
  *   Florian octo Forster <octo at collectd.org>
  *   Peter Holik <peter at holik.at>
  *   Bruno Prémont <bonbons at linux-vserver.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 #include "utils_ignorelist.h"
 
-#include <pthread.h>
-
 #include <OpenIPMI/ipmiif.h>
 #include <OpenIPMI/ipmi_err.h>
 #include <OpenIPMI/ipmi_posix.h>
 #include <OpenIPMI/ipmi_conn.h>
 #include <OpenIPMI/ipmi_smi.h>
 
@@ -79,15 +78,13 @@
 
 /*
  * Misc private functions
  */
 static void c_ipmi_error (const char *func, int status)
 {
-  char errbuf[4096];
-
-  memset (errbuf, 0, sizeof (errbuf));
+  char errbuf[4096] = { 0 };
 
   if (IPMI_IS_OS_ERR (status))
   {
     sstrerror (IPMI_GET_OS_ERR (status), errbuf, sizeof (errbuf));
   }
   else if (IPMI_IS_IPMI_ERR (status))
@@ -233,23 +230,22 @@
 static int sensor_list_add (ipmi_sensor_t *sensor)
 {
   ipmi_sensor_id_t sensor_id;
   c_ipmi_sensor_list_t *list_item;
   c_ipmi_sensor_list_t *list_prev;
 
-  char buffer[DATA_MAX_NAME_LEN];
+  char buffer[DATA_MAX_NAME_LEN] = { 0 };
   const char *entity_id_string;
   char sensor_name[DATA_MAX_NAME_LEN];
   char *sensor_name_ptr;
   int sensor_type;
   const char *type;
   ipmi_entity_t *ent = ipmi_sensor_get_entity(sensor);
 
   sensor_id = ipmi_sensor_convert_to_id (sensor);
 
-  memset (buffer, 0, sizeof (buffer));
   ipmi_sensor_get_name (sensor, buffer, sizeof (buffer));
   buffer[sizeof (buffer) - 1] = 0;
 
   entity_id_string = ipmi_entity_get_entity_id_string (ent);
 
   if (entity_id_string == NULL)
@@ -276,13 +272,13 @@
 
     sensor_id_ptr = strstr (buffer, "(");
     if (sensor_id_ptr != NULL)
     {
       /* `sensor_id_ptr' now points to "(123)". */
       ssnprintf (sensor_name, sizeof (sensor_name),
-          "%s %s", sensor_name_ptr, sensor_id_ptr); 
+          "%s %s", sensor_name_ptr, sensor_id_ptr);
     }
     /* else: don't touch sensor_name. */
   }
   sensor_name_ptr = sensor_name;
 
   /* Both `ignorelist' and `plugin_instance' may be NULL. */
@@ -433,17 +429,15 @@
   free (list_item);
   return (0);
 } /* int sensor_list_remove */
 
 static int sensor_list_read_all (void)
 {
-  c_ipmi_sensor_list_t *list_item;
-
   pthread_mutex_lock (&sensor_list_lock);
 
-  for (list_item = sensor_list;
+  for (c_ipmi_sensor_list_t *list_item = sensor_list;
       list_item != NULL;
       list_item = list_item->next)
   {
     ipmi_sensor_id_get_reading (list_item->sensor_id,
         sensor_read_handler, /* user data = */ list_item);
   } /* for (list_item) */
@@ -549,13 +543,12 @@
   }
 } /* void domain_connection_change_handler */
 
 static int thread_init (os_handler_t **ret_os_handler)
 {
   os_handler_t *os_handler;
-  ipmi_open_option_t open_option[1];
   ipmi_con_t *smi_connection = NULL;
   ipmi_domain_id_t domain_id;
   int status;
 
   os_handler = ipmi_posix_thread_setup_os_handler (SIGIO);
   if (os_handler == NULL)
@@ -573,15 +566,18 @@
   if (status != 0)
   {
     c_ipmi_error ("ipmi_smi_setup_con", status);
     return (-1);
   }
 
-  memset (open_option, 0, sizeof (open_option));
-  open_option[0].option = IPMI_OPEN_OPTION_ALL;
-  open_option[0].ival = 1;
+  ipmi_open_option_t open_option[1] = {
+    [0] = {
+      .option = IPMI_OPEN_OPTION_ALL,
+      { .ival = 1 }
+    }
+  };
 
   status = ipmi_open_domain ("mydomain", &smi_connection, /* num_con = */ 1,
       domain_connection_change_handler, /* user data = */ NULL,
       /* domain_fully_up_handler = */ NULL, /* user data = */ NULL,
       open_option, sizeof (open_option) / sizeof (open_option[0]),
       &domain_id);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/iptables.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/iptables.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/iptables.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/iptables.c	2016-09-11 16:10:25.263038721 +0800
@@ -22,21 +22,23 @@
  *  Sjoerd van der Berg <harekiet at users.sourceforge.net>
  *  Florian Forster <octo at collectd.org>
  *  Marco Chiappero <marco at absence.it>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
-
-#include <sys/socket.h>
 
 #include <libiptc/libiptc.h>
 #include <libiptc/libip6tc.h>
 
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
+#endif
+
 /*
  * iptc_handle_t was available before libiptc was officially available as a
  * shared library. Note, that when the shared lib was introduced, the API and
  * ABI have changed slightly:
  * 'iptc_handle_t' used to be 'struct iptc_handle *' and most functions used
  * 'iptc_handle_t *' as an argument. Now, most functions use 'struct
@@ -60,27 +62,26 @@
 /*
  * Config format should be `Chain table chainname',
  * e. g. `Chain mangle incoming'
  */
 static const char *config_keys[] =
 {
-	"Chain",
-	"Chain6"
+    "Chain",
+    "Chain6"
 };
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
-/*
-    Each table/chain combo that will be queried goes into this list
-*/
-
 enum protocol_version_e
 {
     IPV4,
     IPV6
 };
 typedef enum protocol_version_e protocol_version_t;
 
+/*
+ * Each table/chain combo that will be queried goes into this list
+ */
 #ifndef XT_TABLE_MAXNAMELEN
 # define XT_TABLE_MAXNAMELEN 32
 #endif
 typedef struct {
     protocol_version_t ip_version;
     char table[XT_TABLE_MAXNAMELEN];
@@ -101,148 +102,147 @@
 
 static ip_chain_t **chain_list = NULL;
 static int chain_num = 0;
 
 static int iptables_config (const char *key, const char *value)
 {
-	/* int ip_value; */
-	protocol_version_t ip_version = 0;
+    /* int ip_value; */
+    protocol_version_t ip_version = 0;
 
-	if (strcasecmp (key, "Chain") == 0)
-		ip_version = IPV4;
-	else if (strcasecmp (key, "Chain6") == 0)
-		ip_version = IPV6;
-	else
-		return (1);
+    if (strcasecmp (key, "Chain") == 0)
+        ip_version = IPV4;
+    else if (strcasecmp (key, "Chain6") == 0)
+        ip_version = IPV6;
+    else
+        return (1);
 
-	ip_chain_t temp, *final, **list;
-	char *table;
-	int   table_len;
-	char *chain;
-	int   chain_len;
-
-	char *value_copy;
-	char *fields[4];
-	int   fields_num;
+    ip_chain_t  temp = { 0 };
+    ip_chain_t *final, **list;
+    char *table;
+    int   table_len;
+    char *chain;
+    int   chain_len;
+
+    char *value_copy;
+    char *fields[4];
+    int   fields_num;
+
+    value_copy = strdup (value);
+    if (value_copy == NULL)
+    {
+        char errbuf[1024];
+        ERROR ("strdup failed: %s",
+                sstrerror (errno, errbuf, sizeof (errbuf)));
+        return (1);
+    }
+
+    /*
+     *  Time to fill the temp element
+     *  Examine value string, it should look like:
+     *  Chain[6] <table> <chain> [<comment|num> [name]]
+     */
+
+    /* set IPv4 or IPv6 */
+    temp.ip_version = ip_version;
+
+    /* Chain <table> <chain> [<comment|num> [name]] */
+    fields_num = strsplit (value_copy, fields, 4);
+    if (fields_num < 2)
+    {
+        free (value_copy);
+        return (1);
+    }
 
-	memset (&temp, 0, sizeof (temp));
+    table = fields[0];
+    chain = fields[1];
 
-	value_copy = strdup (value);
-	if (value_copy == NULL)
-	{
-	    char errbuf[1024];
-	    ERROR ("strdup failed: %s",
-		    sstrerror (errno, errbuf, sizeof (errbuf)));
-	    return (1);
-	}
+    table_len = strlen (table) + 1;
+    if ((unsigned int)table_len > sizeof(temp.table))
+    {
+        ERROR ("Table `%s' too long.", table);
+        free (value_copy);
+        return (1);
+    }
+    sstrncpy (temp.table, table, table_len);
 
-	/*
-	 *  Time to fill the temp element
-	 *  Examine value string, it should look like:
-	 *  Chain[6] <table> <chain> [<comment|num> [name]]
-	 */
-
-	/* set IPv4 or IPv6 */
-	temp.ip_version = ip_version;
-
-	/* Chain <table> <chain> [<comment|num> [name]] */
-	fields_num = strsplit (value_copy, fields, 4);
-	if (fields_num < 2)
-	{
-	    free (value_copy);
-	    return (1);
-	}
+    chain_len = strlen (chain) + 1;
+    if ((unsigned int)chain_len > sizeof(temp.chain))
+    {
+        ERROR ("Chain `%s' too long.", chain);
+        free (value_copy);
+        return (1);
+    }
+    sstrncpy (temp.chain, chain, chain_len);
 
-	table = fields[0];
-	chain = fields[1];
+    if (fields_num >= 3)
+    {
+        char *comment = fields[2];
+        int   rule = atoi (comment);
 
-	table_len = strlen (table) + 1;
-	if ((unsigned int)table_len > sizeof(temp.table))
+        if (rule)
 	{
-		ERROR ("Table `%s' too long.", table);
-		free (value_copy);
-		return (1);
+            temp.rule.num = rule;
+            temp.rule_type = RTYPE_NUM;
 	}
-	sstrncpy (temp.table, table, table_len);
-
-	chain_len = strlen (chain) + 1;
-	if ((unsigned int)chain_len > sizeof(temp.chain))
+        else
 	{
-		ERROR ("Chain `%s' too long.", chain);
+            temp.rule.comment = strdup (comment);
+            if (temp.rule.comment == NULL)
+            {
 		free (value_copy);
 		return (1);
-	}
-	sstrncpy (temp.chain, chain, chain_len);
-
-	if (fields_num >= 3)
-	{
-	    char *comment = fields[2];
-	    int   rule = atoi (comment);
-
-	    if (rule)
-	    {
-		temp.rule.num = rule;
-		temp.rule_type = RTYPE_NUM;
-	    }
-	    else
-	    {
-		temp.rule.comment = strdup (comment);
-		if (temp.rule.comment == NULL)
-		{
-		    free (value_copy);
-		    return (1);
-		}
-		temp.rule_type = RTYPE_COMMENT;
 	    }
+            temp.rule_type = RTYPE_COMMENT;
 	}
-	else
-	{
-	    temp.rule_type = RTYPE_COMMENT_ALL;
-	}
+    }
+    else
+    {
+        temp.rule_type = RTYPE_COMMENT_ALL;
+    }
 
-	if (fields_num >= 4)
-	    sstrncpy (temp.name, fields[3], sizeof (temp.name));
+    if (fields_num >= 4)
+        sstrncpy (temp.name, fields[3], sizeof (temp.name));
 
-	free (value_copy);
-	value_copy = NULL;
-	table = NULL;
-	chain = NULL;
+    free (value_copy);
+    value_copy = NULL;
+    table = NULL;
+    chain = NULL;
 
-	list = (ip_chain_t **) realloc (chain_list, (chain_num + 1) * sizeof (ip_chain_t *));
-	if (list == NULL)
-	{
-	    char errbuf[1024];
-	    ERROR ("realloc failed: %s",
-		    sstrerror (errno, errbuf, sizeof (errbuf)));
-	    sfree (temp.rule.comment);
-	    return (1);
-	}
+    list = realloc (chain_list, (chain_num + 1) * sizeof (ip_chain_t *));
+    if (list == NULL)
+    {
+        char errbuf[1024];
+        ERROR ("realloc failed: %s",
+                sstrerror (errno, errbuf, sizeof (errbuf)));
+        sfree (temp.rule.comment);
+        return (1);
+    }
 
-	chain_list = list;
-	final = (ip_chain_t *) malloc( sizeof(temp) );
-	if (final == NULL)
-	{
-	    char errbuf[1024];
-	    ERROR ("malloc failed: %s",
-		    sstrerror (errno, errbuf, sizeof (errbuf)));
-	    sfree (temp.rule.comment);
-	    return (1);
-	}
-	memcpy (final, &temp, sizeof (temp));
-	chain_list[chain_num] = final;
-	chain_num++;
+    chain_list = list;
+    final = malloc(sizeof (*final));
+    if (final == NULL)
+    {
+        char errbuf[1024];
+        ERROR ("malloc failed: %s",
+                sstrerror (errno, errbuf, sizeof (errbuf)));
+        sfree (temp.rule.comment);
+        return (1);
+    }
+    memcpy (final, &temp, sizeof (temp));
+    chain_list[chain_num] = final;
+    chain_num++;
 
-	DEBUG ("Chain #%i: table = %s; chain = %s;", chain_num, final->table, final->chain);
+    DEBUG ("Chain #%i: table = %s; chain = %s;", chain_num, final->table, final->chain);
 
-	return (0);
+    return (0);
 } /* int iptables_config */
 
 static int submit6_match (const struct ip6t_entry_match *match,
-                const struct ip6t_entry *entry,
-                const ip_chain_t *chain,
-                int rule_num)
+                          const struct ip6t_entry *entry,
+                          const ip_chain_t *chain,
+                          int rule_num)
 {
     int status;
     value_t values[1];
     value_list_t vl = VALUE_LIST_INIT;
 
     /* Select the rules to collect */
@@ -253,38 +253,38 @@
     }
     else
     {
         if (strcmp (match->u.user.name, "comment") != 0)
             return (0);
         if ((chain->rule_type == RTYPE_COMMENT)
-                && (strcmp (chain->rule.comment, (char *) match->data) != 0))
+             && (strcmp (chain->rule.comment, (char *) match->data) != 0))
             return (0);
     }
 
     vl.values = values;
     vl.values_len = 1;
     sstrncpy (vl.host, hostname_g, sizeof (vl.host));
     sstrncpy (vl.plugin, "ip6tables", sizeof (vl.plugin));
 
     status = ssnprintf (vl.plugin_instance, sizeof (vl.plugin_instance),
-            "%s-%s", chain->table, chain->chain);
+                        "%s-%s", chain->table, chain->chain);
     if ((status < 1) || ((unsigned int)status >= sizeof (vl.plugin_instance)))
         return (0);
 
     if (chain->name[0] != '\0')
     {
         sstrncpy (vl.type_instance, chain->name, sizeof (vl.type_instance));
     }
     else
     {
         if (chain->rule_type == RTYPE_NUM)
             ssnprintf (vl.type_instance, sizeof (vl.type_instance),
-                    "%i", chain->rule.num);
+                       "%i", chain->rule.num);
         else
             sstrncpy (vl.type_instance, (char *) match->data,
-                    sizeof (vl.type_instance));
+                      sizeof (vl.type_instance));
     }
 
     sstrncpy (vl.type, "ipt_bytes", sizeof (vl.type));
     values[0].derive = (derive_t) entry->counters.bcnt;
     plugin_dispatch_values (&vl);
 
@@ -295,15 +295,15 @@
     return (0);
 } /* int submit_match */
 
 
 /* This needs to return `int' for IPT_MATCH_ITERATE to work. */
 static int submit_match (const struct ipt_entry_match *match,
-		const struct ipt_entry *entry,
-		const ip_chain_t *chain,
-		int rule_num) 
+                         const struct ipt_entry *entry,
+                         const ip_chain_t *chain,
+                         int rule_num)
 {
     int status;
     value_t values[1];
     value_list_t vl = VALUE_LIST_INIT;
 
     /* Select the rules to collect */
@@ -314,38 +314,38 @@
     }
     else
     {
 	if (strcmp (match->u.user.name, "comment") != 0)
 	    return (0);
 	if ((chain->rule_type == RTYPE_COMMENT)
-		&& (strcmp (chain->rule.comment, (char *) match->data) != 0))
+             && (strcmp (chain->rule.comment, (char *) match->data) != 0))
 	    return (0);
     }
 
     vl.values = values;
     vl.values_len = 1;
     sstrncpy (vl.host, hostname_g, sizeof (vl.host));
     sstrncpy (vl.plugin, "iptables", sizeof (vl.plugin));
 
     status = ssnprintf (vl.plugin_instance, sizeof (vl.plugin_instance),
-	    "%s-%s", chain->table, chain->chain);
+                        "%s-%s", chain->table, chain->chain);
     if ((status < 1) || ((unsigned int)status >= sizeof (vl.plugin_instance)))
 	return (0);
 
     if (chain->name[0] != '\0')
     {
 	sstrncpy (vl.type_instance, chain->name, sizeof (vl.type_instance));
     }
     else
     {
 	if (chain->rule_type == RTYPE_NUM)
 	    ssnprintf (vl.type_instance, sizeof (vl.type_instance),
-		    "%i", chain->rule.num);
+                       "%i", chain->rule.num);
 	else
 	    sstrncpy (vl.type_instance, (char *) match->data,
-		    sizeof (vl.type_instance));
+                      sizeof (vl.type_instance));
     }
 
     sstrncpy (vl.type, "ipt_bytes", sizeof (vl.type));
     values[0].derive = (derive_t) entry->counters.bcnt;
     plugin_dispatch_values (&vl);
 
@@ -355,13 +355,13 @@
 
     return (0);
 } /* int submit_match */
 
 
 /* ipv6 submit_chain */
-static void submit6_chain( ip6tc_handle_t *handle, ip_chain_t *chain )
+static void submit6_chain (ip6tc_handle_t *handle, ip_chain_t *chain)
 {
     const struct ip6t_entry *entry;
     int rule_num;
 
     /* Find first rule for chain and use the iterate macro */
     entry = ip6tc_first_rule( chain->chain, handle );
@@ -387,18 +387,18 @@
         rule_num++;
     } /* while (entry) */
 }
 
 
 /* ipv4 submit_chain */
-static void submit_chain( iptc_handle_t *handle, ip_chain_t *chain )
+static void submit_chain (iptc_handle_t *handle, ip_chain_t *chain)
 {
     const struct ipt_entry *entry;
     int rule_num;
 
-    /* Find first rule for chain and use the iterate macro */    
+    /* Find first rule for chain and use the iterate macro */
     entry = iptc_first_rule( chain->chain, handle );
     if (entry == NULL)
     {
 	DEBUG ("iptc_first_rule failed: %s", iptc_strerror (errno));
 	return;
     }
@@ -420,102 +420,113 @@
     } /* while (entry) */
 }
 
 
 static int iptables_read (void)
 {
-    int i;
     int num_failures = 0;
     ip_chain_t *chain;
 
-    /* Init the iptc handle structure and query the correct table */    
-    for (i = 0; i < chain_num; i++)
+    /* Init the iptc handle structure and query the correct table */
+    for (int i = 0; i < chain_num; i++)
     {
 	chain = chain_list[i];
-	
+
 	if (!chain)
 	{
 	    DEBUG ("iptables plugin: chain == NULL");
 	    continue;
 	}
 
 	if ( chain->ip_version == IPV4 )
         {
 #ifdef HAVE_IPTC_HANDLE_T
-		iptc_handle_t _handle;
-		iptc_handle_t *handle = &_handle;
+            iptc_handle_t _handle;
+            iptc_handle_t *handle = &_handle;
 
-		*handle = iptc_init (chain->table);
+            *handle = iptc_init (chain->table);
 #else
-		iptc_handle_t *handle;
-                handle = iptc_init (chain->table);
+            iptc_handle_t *handle;
+            handle = iptc_init (chain->table);
 #endif
 
-                if (!handle)
-                {
-                        ERROR ("iptables plugin: iptc_init (%s) failed: %s",
-                                chain->table, iptc_strerror (errno));
-                        num_failures++;
-                        continue;
-                }
+            if (!handle)
+            {
+                ERROR ("iptables plugin: iptc_init (%s) failed: %s",
+                        chain->table, iptc_strerror (errno));
+                num_failures++;
+                continue;
+            }
 
-                submit_chain (handle, chain);
-                iptc_free (handle);
+            submit_chain (handle, chain);
+            iptc_free (handle);
         }
         else if ( chain->ip_version == IPV6 )
         {
 #ifdef HAVE_IP6TC_HANDLE_T
-		ip6tc_handle_t _handle;
-		ip6tc_handle_t *handle = &_handle;
+            ip6tc_handle_t _handle;
+            ip6tc_handle_t *handle = &_handle;
 
-		*handle = ip6tc_init (chain->table);
+            *handle = ip6tc_init (chain->table);
 #else
-                ip6tc_handle_t *handle;
-                handle = ip6tc_init (chain->table);
+            ip6tc_handle_t *handle;
+            handle = ip6tc_init (chain->table);
 #endif
+            if (!handle)
+            {
+                ERROR ("iptables plugin: ip6tc_init (%s) failed: %s",
+                        chain->table, ip6tc_strerror (errno));
+                num_failures++;
+                continue;
+            }
 
-                if (!handle)
-                {
-                        ERROR ("iptables plugin: ip6tc_init (%s) failed: %s",
-                                chain->table, ip6tc_strerror (errno));
-                        num_failures++;
-                        continue;
-                }
-
-                submit6_chain (handle, chain);
-                ip6tc_free (handle);
+            submit6_chain (handle, chain);
+            ip6tc_free (handle);
         }
-        else num_failures++;
-
+        else
+            num_failures++;
     } /* for (i = 0 .. chain_num) */
 
     return ((num_failures < chain_num) ? 0 : -1);
 } /* int iptables_read */
 
 static int iptables_shutdown (void)
 {
-    int i;
-
-    for (i = 0; i < chain_num; i++)
+    for (int i = 0; i < chain_num; i++)
     {
 	if ((chain_list[i] != NULL) && (chain_list[i]->rule_type == RTYPE_COMMENT))
-	{
 	    sfree (chain_list[i]->rule.comment);
-	}
 	sfree (chain_list[i]);
     }
     sfree (chain_list);
 
     return (0);
 } /* int iptables_shutdown */
 
+static int iptables_init (void)
+{
+#if defined(HAVE_SYS_CAPABILITY_H) && defined(CAP_NET_ADMIN)
+    if (check_capability (CAP_NET_ADMIN) != 0)
+    {
+        if (getuid () == 0)
+            WARNING ("iptables plugin: Running collectd as root, but the "
+                  "CAP_NET_ADMIN capability is missing. The plugin's read "
+                  "function will probably fail. Is your init system dropping "
+                  "capabilities?");
+        else
+            WARNING ("iptables plugin: collectd doesn't have the CAP_NET_ADMIN "
+                  "capability. If you don't want to run collectd as root, try "
+                  "running \"setcap cap_net_admin=ep\" on the collectd binary.");
+    }
+#endif
+    return (0);
+} /* int iptables_init */
+
 void module_register (void)
 {
     plugin_register_config ("iptables", iptables_config,
-	    config_keys, config_keys_num);
+                             config_keys, config_keys_num);
+    plugin_register_init ("iptables", iptables_init);
     plugin_register_read ("iptables", iptables_read);
     plugin_register_shutdown ("iptables", iptables_shutdown);
 } /* void module_register */
 
-/*
- * vim:shiftwidth=4:softtabstop=4:tabstop=8
- */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipvs.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipvs.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ipvs.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ipvs.c	2016-09-11 16:10:25.263038721 +0800
@@ -34,15 +35,12 @@
 #include "plugin.h"
 #include "common.h"
 
 #if HAVE_ARPA_INET_H
 # include <arpa/inet.h>
 #endif /* HAVE_ARPA_INET_H */
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif /* HAVE_SYS_SOCKET_H */
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif /* HAVE_NETINET_IN_H */
 
 /* this can probably only be found in the kernel sources */
 #if HAVE_LINUX_IP_VS_H
@@ -194,13 +192,13 @@
 	/* inet_ntoa() returns a pointer to a statically allocated buffer
 	 * I hope non-glibc systems behave the same */
 	len = ssnprintf (pi, size, "%s_%s%u", inet_ntoa (addr),
 			(se->protocol == IPPROTO_TCP) ? "TCP" : "UDP",
 			ntohs (se->port));
 
-	if ((0 > len) || (size <= len)) {
+	if ((0 > len) || (size <= ((size_t) len))) {
 		log_err ("plugin instance truncated: %s", pi);
 		return -1;
 	}
 	return 0;
 } /* get_pi */
 
@@ -217,20 +215,21 @@
 
 	/* inet_ntoa() returns a pointer to a statically allocated buffer
 	 * I hope non-glibc systems behave the same */
 	len = ssnprintf (ti, size, "%s_%u", inet_ntoa (addr),
 			ntohs (de->port));
 
-	if ((0 > len) || (size <= len)) {
+	if ((0 > len) || (size <= ((size_t) len))) {
 		log_err ("type instance truncated: %s", ti);
 		return -1;
 	}
 	return 0;
 } /* get_ti */
 
-static void cipvs_submit_connections (char *pi, char *ti, derive_t value)
+static void cipvs_submit_connections (const char *pi, const char *ti,
+		derive_t value)
 {
 	value_t values[1];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].derive = value;
 
@@ -245,13 +244,13 @@
 		sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 	return;
 } /* cipvs_submit_connections */
 
-static void cipvs_submit_if (char *pi, char *t, char *ti,
+static void cipvs_submit_if (const char *pi, const char *t, const char *ti,
 		derive_t rx, derive_t tx)
 {
 	value_t values[2];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].derive = rx;
@@ -268,13 +267,14 @@
 		sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 	return;
 } /* cipvs_submit_if */
 
-static void cipvs_submit_dest (char *pi, struct ip_vs_dest_entry *de) {
+static void cipvs_submit_dest (const char *pi, struct ip_vs_dest_entry *de)
+{
 	struct ip_vs_stats_user stats = de->stats;
 
 	char ti[DATA_MAX_NAME_LEN];
 
 	if (0 != get_ti (de, ti, sizeof (ti)))
 		return;
@@ -289,43 +289,40 @@
 {
 	struct ip_vs_stats_user  stats = se->stats;
 	struct ip_vs_get_dests  *dests = ipvs_get_dests (se);
 
 	char pi[DATA_MAX_NAME_LEN];
 
-	int i = 0;
-
 	if (0 != get_pi (se, pi, sizeof (pi)))
 	{
 		free (dests);
 		return;
 	}
 
 	cipvs_submit_connections (pi, NULL, stats.conns);
 	cipvs_submit_if (pi, "if_packets", NULL, stats.inpkts, stats.outpkts);
 	cipvs_submit_if (pi, "if_octets", NULL, stats.inbytes, stats.outbytes);
 
-	for (i = 0; i < dests->num_dests; ++i)
+	for (size_t i = 0; i < dests->num_dests; ++i)
 		cipvs_submit_dest (pi, &dests->entrytable[i]);
 
 	free (dests);
 	return;
 } /* cipvs_submit_service */
 
 static int cipvs_read (void)
 {
 	struct ip_vs_get_services *services = NULL;
-	int i = 0;
 
 	if (sockfd < 0)
 		return (-1);
 
 	if (NULL == (services = ipvs_get_services ()))
 		return -1;
 
-	for (i = 0; i < services->num_services; ++i)
+	for (size_t i = 0; i < services->num_services; ++i)
 		cipvs_submit_service (&services->entrytable[i]);
 
 	free (services);
 	return 0;
 } /* cipvs_read */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/irq.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/irq.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/irq.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/irq.c	2016-09-11 16:10:25.263038721 +0800
@@ -19,15 +19,15 @@
  *
  * Authors:
  *   Peter Holik <peter at holik.at>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 
 #if !KERNEL_LINUX
 # error "No applicable input method."
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/java.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/java.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/java.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/java.c	2016-09-11 16:10:25.263038721 +0800
@@ -19,17 +19,17 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Justo Alonso Achaques <justo.alonso at gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
 #include "filter_chain.h"
 
-#include <pthread.h>
 #include <jni.h>
 
 #if !defined(JNI_VERSION_1_2)
 # error "Need JNI 1.2 compatible interface!"
 #endif
 
@@ -504,13 +504,12 @@
   jclass c_ocitem;
   jmethodID m_ocitem_constructor;
   jmethodID m_addvalue;
   jmethodID m_addchild;
   jobject o_key;
   jobject o_ocitem;
-  int i;
 
   c_ocitem = (*jvm_env)->FindClass (jvm_env, "org/collectd/api/OConfigItem");
   if (c_ocitem == NULL)
   {
     ERROR ("java plugin: ctoj_oconfig_item: "
         "FindClass (org/collectd/api/OConfigItem) failed.");
@@ -569,13 +568,13 @@
   }
 
   /* We don't need the String object any longer.. */
   (*jvm_env)->DeleteLocalRef (jvm_env, o_key);
 
   /* Call OConfigItem.addValue for each value */
-  for (i = 0; i < ci->values_num; i++) /* {{{ */
+  for (int i = 0; i < ci->values_num; i++) /* {{{ */
   {
     jobject o_value;
 
     o_value = ctoj_oconfig_value (jvm_env, ci->values[i]);
     if (o_value == NULL)
     {
@@ -587,13 +586,13 @@
 
     (*jvm_env)->CallVoidMethod (jvm_env, o_ocitem, m_addvalue, o_value);
     (*jvm_env)->DeleteLocalRef (jvm_env, o_value);
   } /* }}} for (i = 0; i < ci->values_num; i++) */
 
   /* Call OConfigItem.addChild for each child */
-  for (i = 0; i < ci->children_num; i++) /* {{{ */
+  for (int i = 0; i < ci->children_num; i++) /* {{{ */
   {
     jobject o_child;
 
     o_child = ctoj_oconfig_item (jvm_env, ci->children + i);
     if (o_child == NULL)
     {
@@ -615,13 +614,12 @@
 {
   jclass c_dataset;
   jmethodID m_constructor;
   jmethodID m_add;
   jobject o_type;
   jobject o_dataset;
-  int i;
 
   /* Look up the org/collectd/api/DataSet class */
   c_dataset = (*jvm_env)->FindClass (jvm_env, "org/collectd/api/DataSet");
   if (c_dataset == NULL)
   {
     ERROR ("java plugin: ctoj_data_set: Looking up the "
@@ -665,13 +663,13 @@
     return (NULL);
   }
 
   /* Decrease reference counter on the java.lang.String object. */
   (*jvm_env)->DeleteLocalRef (jvm_env, o_type);
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     jobject o_datasource;
 
     o_datasource = ctoj_data_source (jvm_env, ds->ds + i);
     if (o_datasource == NULL)
     {
@@ -760,13 +758,12 @@
     const data_set_t *ds, const value_list_t *vl)
 {
   jclass c_valuelist;
   jmethodID m_valuelist_constructor;
   jobject o_valuelist;
   int status;
-  int i;
 
   /* First, create a new ValueList instance..
    * Look up the class.. */
   c_valuelist = (*jvm_env)->FindClass (jvm_env,
       "org/collectd/api/ValueList");
   if (c_valuelist == NULL)
@@ -843,13 +840,13 @@
   {
     ERROR ("java plugin: ctoj_value_list: ctoj_long (setInterval) failed.");
     (*jvm_env)->DeleteLocalRef (jvm_env, o_valuelist);
     return (NULL);
   }
 
-  for (i = 0; i < vl->values_len; i++)
+  for (size_t i = 0; i < vl->values_len; i++)
   {
     status = ctoj_value_list_add_value (jvm_env, vl->values[i], ds->ds[i].type,
         c_valuelist, o_valuelist);
     if (status != 0)
     {
       ERROR ("java plugin: ctoj_value_list: "
@@ -1114,13 +1111,12 @@
   jmethodID m_toarray;
   jobject o_list;
   jobjectArray o_number_array;
 
   value_t *values;
   int values_num;
-  int i;
 
   values_num = ds->ds_num;
 
   values = NULL;
   o_number_array = NULL;
   o_list = NULL;
@@ -1174,13 +1170,13 @@
   if (values == NULL)
   {
     ERROR ("java plugin: jtoc_values_array: calloc failed.");
     BAIL_OUT (-1);
   }
 
-  for (i = 0; i < values_num; i++)
+  for (int i = 0; i < values_num; i++)
   {
     jobject o_number;
     int status;
 
     o_number = (*jvm_env)->GetObjectArrayElement (jvm_env,
         o_number_array, (jsize) i);
@@ -1361,18 +1357,15 @@
   return (status);
 } /* }}} jint cjni_api_dispatch_values */
 
 static jint JNICALL cjni_api_dispatch_notification (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_notification)
 {
-  notification_t n;
+  notification_t n = { 0 };
   int status;
 
-  memset (&n, 0, sizeof (n));
-  n.meta = NULL;
-
   status = jtoc_notification (jvm_env, &n, o_notification);
   if (status != 0)
   {
     ERROR ("java plugin: cjni_api_dispatch_notification: jtoc_notification failed.");
     return (-1);
   }
@@ -1421,71 +1414,71 @@
   return (cjni_callback_register (jvm_env, o_name, o_config, CB_TYPE_INIT));
 } /* }}} jint cjni_api_register_init */
 
 static jint JNICALL cjni_api_register_read (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_name, jobject o_read)
 {
-  user_data_t ud;
   cjni_callback_info_t *cbi;
 
   cbi = cjni_callback_info_create (jvm_env, o_name, o_read, CB_TYPE_READ);
   if (cbi == NULL)
     return (-1);
 
   DEBUG ("java plugin: Registering new read callback: %s", cbi->name);
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = (void *) cbi;
-  ud.free_func = cjni_callback_info_destroy;
+  user_data_t ud = {
+    .data = cbi,
+    .free_func = cjni_callback_info_destroy
+  };
 
   plugin_register_complex_read (/* group = */ NULL, cbi->name, cjni_read,
-      /* interval = */ NULL, &ud);
+      /* interval = */ 0, &ud);
 
   (*jvm_env)->DeleteLocalRef (jvm_env, o_read);
 
   return (0);
 } /* }}} jint cjni_api_register_read */
 
 static jint JNICALL cjni_api_register_write (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_name, jobject o_write)
 {
-  user_data_t ud;
   cjni_callback_info_t *cbi;
 
   cbi = cjni_callback_info_create (jvm_env, o_name, o_write, CB_TYPE_WRITE);
   if (cbi == NULL)
     return (-1);
 
   DEBUG ("java plugin: Registering new write callback: %s", cbi->name);
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = (void *) cbi;
-  ud.free_func = cjni_callback_info_destroy;
+  user_data_t ud = {
+    .data = cbi,
+    .free_func = cjni_callback_info_destroy
+  };
 
   plugin_register_write (cbi->name, cjni_write, &ud);
 
   (*jvm_env)->DeleteLocalRef (jvm_env, o_write);
 
   return (0);
 } /* }}} jint cjni_api_register_write */
 
 static jint JNICALL cjni_api_register_flush (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_name, jobject o_flush)
 {
-  user_data_t ud;
   cjni_callback_info_t *cbi;
 
   cbi = cjni_callback_info_create (jvm_env, o_name, o_flush, CB_TYPE_FLUSH);
   if (cbi == NULL)
     return (-1);
 
   DEBUG ("java plugin: Registering new flush callback: %s", cbi->name);
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = (void *) cbi;
-  ud.free_func = cjni_callback_info_destroy;
+  user_data_t ud = {
+    .data = cbi,
+    .free_func = cjni_callback_info_destroy
+  };
 
   plugin_register_flush (cbi->name, cjni_flush, &ud);
 
   (*jvm_env)->DeleteLocalRef (jvm_env, o_flush);
 
   return (0);
@@ -1498,48 +1491,48 @@
         CB_TYPE_SHUTDOWN));
 } /* }}} jint cjni_api_register_shutdown */
 
 static jint JNICALL cjni_api_register_log (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_name, jobject o_log)
 {
-  user_data_t ud;
   cjni_callback_info_t *cbi;
 
   cbi = cjni_callback_info_create (jvm_env, o_name, o_log, CB_TYPE_LOG);
   if (cbi == NULL)
     return (-1);
 
   DEBUG ("java plugin: Registering new log callback: %s", cbi->name);
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = (void *) cbi;
-  ud.free_func = cjni_callback_info_destroy;
+  user_data_t ud = {
+    .data = cbi,
+    .free_func = cjni_callback_info_destroy
+  };
 
   plugin_register_log (cbi->name, cjni_log, &ud);
 
   (*jvm_env)->DeleteLocalRef (jvm_env, o_log);
 
   return (0);
 } /* }}} jint cjni_api_register_log */
 
 static jint JNICALL cjni_api_register_notification (JNIEnv *jvm_env, /* {{{ */
     jobject this, jobject o_name, jobject o_notification)
 {
-  user_data_t ud;
   cjni_callback_info_t *cbi;
 
   cbi = cjni_callback_info_create (jvm_env, o_name, o_notification,
       CB_TYPE_NOTIFICATION);
   if (cbi == NULL)
     return (-1);
 
   DEBUG ("java plugin: Registering new notification callback: %s", cbi->name);
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = (void *) cbi;
-  ud.free_func = cjni_callback_info_destroy;
+  user_data_t ud = {
+    .data = cbi,
+    .free_func = cjni_callback_info_destroy
+  };
 
   plugin_register_notification (cbi->name, cjni_notification, &ud);
 
   (*jvm_env)->DeleteLocalRef (jvm_env, o_notification);
 
   return (0);
@@ -1565,26 +1558,24 @@
     (*jvm_env)->ReleaseStringUTFChars (jvm_env, o_name, c_name);
     return (-1);
   }
 
   if (type == CB_TYPE_MATCH)
   {
-    match_proc_t m_proc;
+    match_proc_t m_proc = { 0 };
 
-    memset (&m_proc, 0, sizeof (m_proc));
     m_proc.create  = cjni_match_target_create;
     m_proc.destroy = cjni_match_target_destroy;
     m_proc.match   = (void *) cjni_match_target_invoke;
 
     status = fc_register_match (c_name, m_proc);
   }
   else if (type == CB_TYPE_TARGET)
   {
-    target_proc_t t_proc;
+    target_proc_t t_proc = { 0 };
 
-    memset (&t_proc, 0, sizeof (t_proc));
     t_proc.create  = cjni_match_target_create;
     t_proc.destroy = cjni_match_target_destroy;
     t_proc.invoke  = cjni_match_target_invoke;
 
     status = fc_register_target (c_name, t_proc);
   }
@@ -1798,20 +1789,19 @@
   {
     ERROR ("java plugin: cjni_callback_info_create: "
         "GetStringUTFChars failed.");
     return (NULL);
   }
 
-  cbi = (cjni_callback_info_t *) malloc (sizeof (*cbi));
+  cbi = calloc (1, sizeof (*cbi));
   if (cbi == NULL)
   {
-    ERROR ("java plugin: cjni_callback_info_create: malloc failed.");
+    ERROR ("java plugin: cjni_callback_info_create: calloc failed.");
     (*jvm_env)->ReleaseStringUTFChars (jvm_env, o_name, c_name);
     return (NULL);
   }
-  memset (cbi, 0, sizeof (*cbi));
   cbi->type = type;
 
   cbi->name = strdup (c_name);
   if (cbi->name == NULL)
   {
     pthread_mutex_unlock (&java_callbacks_lock);
@@ -1903,13 +1893,13 @@
   DEBUG ("java plugin: Registering new %s callback: %s",
       type_str, cbi->name);
 #endif
 
   pthread_mutex_lock (&java_callbacks_lock);
 
-  tmp = (cjni_callback_info_t *) realloc (java_callbacks,
+  tmp = realloc (java_callbacks,
       (java_callbacks_num + 1) * sizeof (*java_callbacks));
   if (tmp == NULL)
   {
     pthread_mutex_unlock (&java_callbacks_lock);
     ERROR ("java plugin: cjni_callback_register: realloc failed.");
 
@@ -1984,17 +1974,16 @@
 
 /* Create the JVM. This is called when the first thread tries to access the JVM
  * via cjni_thread_attach. */
 static int cjni_create_jvm (void) /* {{{ */
 {
   JNIEnv *jvm_env;
-  JavaVMInitArgs vm_args;
+  JavaVMInitArgs vm_args = { 0 };
   JavaVMOption vm_options[jvm_argc];
 
   int status;
-  size_t i;
 
   if (jvm != NULL)
     return (0);
 
   status = pthread_key_create (&jvm_env_key, cjni_jvm_env_destroy);
   if (status != 0)
@@ -2003,18 +1992,17 @@
         "with status %i.", status);
     return (-1);
   }
 
   jvm_env = NULL;
 
-  memset (&vm_args, 0, sizeof (vm_args));
   vm_args.version = JNI_VERSION_1_2;
   vm_args.options = vm_options;
   vm_args.nOptions = (jint) jvm_argc;
 
-  for (i = 0; i < jvm_argc; i++)
+  for (size_t i = 0; i < jvm_argc; i++)
   {
     DEBUG ("java plugin: cjni_create_jvm: jvm_argv[%zu] = %s",
         i, jvm_argv[i]);
     vm_args.options[i].optionString = jvm_argv[i];
   }
 
@@ -2064,19 +2052,18 @@
   assert (jvm != NULL);
 
   cjni_env = pthread_getspecific (jvm_env_key);
   if (cjni_env == NULL)
   {
     /* This pointer is free'd in `cjni_jvm_env_destroy'. */
-    cjni_env = (cjni_jvm_env_t *) malloc (sizeof (*cjni_env));
+    cjni_env = calloc (1, sizeof (*cjni_env));
     if (cjni_env == NULL)
     {
-      ERROR ("java plugin: cjni_thread_attach: malloc failed.");
+      ERROR ("java plugin: cjni_thread_attach: calloc failed.");
       return (NULL);
     }
-    memset (cjni_env, 0, sizeof (*cjni_env));
     cjni_env->reference_counter = 0;
     cjni_env->jvm_env = NULL;
 
     pthread_setspecific (jvm_env_key, cjni_env);
   }
 
@@ -2085,17 +2072,16 @@
     cjni_env->reference_counter++;
     jvm_env = cjni_env->jvm_env;
   }
   else
   {
     int status;
-    JavaVMAttachArgs args;
+    JavaVMAttachArgs args = { 0 };
 
     assert (cjni_env->jvm_env == NULL);
 
-    memset (&args, 0, sizeof (args));
     args.version = JNI_VERSION_1_2;
 
     status = (*jvm)->AttachCurrentThread (jvm, (void *) &jvm_env, (void *) &args);
     if (status != 0)
     {
       ERROR ("java plugin: cjni_thread_attach: AttachCurrentThread failed "
@@ -2166,13 +2152,13 @@
         "`LoadPlugin' options! The JVM is already started and I have to "
         "ignore this argument: %s",
         ci->values[0].value.string);
     return (-1);
   }
 
-  tmp = (char **) realloc (jvm_argv, sizeof (char *) * (jvm_argc + 1));
+  tmp = realloc (jvm_argv, sizeof (char *) * (jvm_argc + 1));
   if (tmp == NULL)
   {
     ERROR ("java plugin: realloc failed.");
     return (-1);
   }
   jvm_argv = tmp;
@@ -2202,13 +2188,13 @@
   }
 
   jvm_env = cjni_thread_attach ();
   if (jvm_env == NULL)
     return (-1);
 
-  class = (java_plugin_class_t *) realloc (java_classes_list,
+  class = realloc (java_classes_list,
       (java_classes_list_len + 1) * sizeof (*java_classes_list));
   if (class == NULL)
   {
     ERROR ("java plugin: realloc failed.");
     cjni_thread_detach ();
     return (-1);
@@ -2227,14 +2213,13 @@
   class->class = NULL;
   class->object = NULL;
 
   { /* Replace all dots ('.') with slashes ('/'). Dots are usually used
        thorough the Java community, but (Sun's) `FindClass' and friends need
        slashes. */
-    size_t i;
-    for (i = 0; class->name[i] != 0; i++)
+    for (size_t i = 0; class->name[i] != 0; i++)
       if (class->name[i] == '.')
         class->name[i] = '/';
   }
 
   DEBUG ("java plugin: Loading class %s", class->name);
 
@@ -2286,13 +2271,12 @@
 static int cjni_config_plugin_block (oconfig_item_t *ci) /* {{{ */
 {
   JNIEnv *jvm_env;
   cjni_callback_info_t *cbi;
   jobject o_ocitem;
   const char *name;
-  size_t i;
 
   jclass class;
   jmethodID method;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -2301,13 +2285,13 @@
     return (-1);
   }
 
   name = ci->values[0].value.string;
 
   cbi = NULL;
-  for (i = 0; i < java_callbacks_num; i++)
+  for (size_t i = 0; i < java_callbacks_num; i++)
   {
     if (java_callbacks[i].type != CB_TYPE_CONFIG)
       continue;
 
     if (strcmp (name, java_callbacks[i].name) != 0)
       continue;
@@ -2353,18 +2337,17 @@
 
 static int cjni_config_perform (oconfig_item_t *ci) /* {{{ */
 {
   int success;
   int errors;
   int status;
-  int i;
 
   success = 0;
   errors = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("JVMArg", child->key) == 0)
     {
       status = cjni_config_add_jvm_arg (child);
@@ -2721,13 +2704,12 @@
   cjni_callback_info_t *cbi_ret;
   cjni_callback_info_t *cbi_factory;
   const char *name;
   jobject o_ci;
   jobject o_tmp;
   int type;
-  size_t i;
 
   cbi_ret = NULL;
   o_ci = NULL;
   jvm_env = NULL;
 
 #define BAIL_OUT(status) \
@@ -2766,13 +2748,13 @@
 
   /* This is the name of the match we should create. */
   name = ci->values[0].value.string;
 
   /* Lets see if we have a matching factory here.. */
   cbi_factory = NULL;
-  for (i = 0; i < java_callbacks_num; i++)
+  for (size_t i = 0; i < java_callbacks_num; i++)
   {
     if (java_callbacks[i].type != type)
       continue;
 
     if (strcmp (name, java_callbacks[i].name) != 0)
       continue;
@@ -2798,19 +2780,19 @@
         "ctoj_oconfig_item failed.");
     BAIL_OUT (-1);
   }
 
   /* Allocate a new callback info structure. This is going to be our user_data
    * pointer. */
-  cbi_ret = (cjni_callback_info_t *) malloc (sizeof (*cbi_ret));
+  cbi_ret = calloc (1, sizeof (*cbi_ret));
   if (cbi_ret == NULL)
   {
-    ERROR ("java plugin: cjni_match_target_create: malloc failed.");
+    ERROR ("java plugin: cjni_match_target_create: calloc failed.");
     BAIL_OUT (-1);
   }
-  memset (cbi_ret, 0, sizeof (*cbi_ret));
+
   cbi_ret->object = NULL;
   cbi_ret->type = type;
 
   /* Lets fill the callback info structure.. First, the name: */
   cbi_ret->name = strdup (name);
   if (cbi_ret->name == NULL)
@@ -2920,15 +2902,14 @@
   DEBUG ("java plugin: cjni_match_target_invoke: Method returned %i.", ret_status);
 
   /* If we're executing a target, copy the `ValueList' back to our
    * `value_list_t'. */
   if (cbi->type == CB_TYPE_TARGET)
   {
-    value_list_t new_vl;
+    value_list_t new_vl = { 0 };
 
-    memset (&new_vl, 0, sizeof (new_vl));
     status = jtoc_value_list (jvm_env, &new_vl, o_vl);
     if (status != 0)
     {
       ERROR ("java plugin: cjni_match_target_invoke: "
           "jtoc_value_list failed.");
     }
@@ -2949,15 +2930,14 @@
 } /* }}} int cjni_match_target_invoke */
 
 /* Iterate over `java_callbacks' and call all CB_TYPE_INIT callbacks. */
 static int cjni_init_plugins (JNIEnv *jvm_env) /* {{{ */
 {
   int status;
-  size_t i;
 
-  for (i = 0; i < java_callbacks_num; i++)
+  for (size_t i = 0; i < java_callbacks_num; i++)
   {
     if (java_callbacks[i].type != CB_TYPE_INIT)
       continue;
 
     DEBUG ("java plugin: Initializing %s", java_callbacks[i].name);
 
@@ -2976,15 +2956,14 @@
 } /* }}} int cjni_init_plugins */
 
 /* Iterate over `java_callbacks' and call all CB_TYPE_SHUTDOWN callbacks. */
 static int cjni_shutdown_plugins (JNIEnv *jvm_env) /* {{{ */
 {
   int status;
-  size_t i;
 
-  for (i = 0; i < java_callbacks_num; i++)
+  for (size_t i = 0; i < java_callbacks_num; i++)
   {
     if (java_callbacks[i].type != CB_TYPE_SHUTDOWN)
       continue;
 
     DEBUG ("java plugin: Shutting down %s", java_callbacks[i].name);
 
@@ -3001,21 +2980,19 @@
 } /* }}} int cjni_shutdown_plugins */
 
 
 static int cjni_shutdown (void) /* {{{ */
 {
   JNIEnv *jvm_env;
-  JavaVMAttachArgs args;
+  JavaVMAttachArgs args = { 0 };
   int status;
-  size_t i;
 
   if (jvm == NULL)
     return (0);
 
   jvm_env = NULL;
-  memset (&args, 0, sizeof (args));
   args.version = JNI_VERSION_1_2;
 
   status = (*jvm)->AttachCurrentThread (jvm, (void *) &jvm_env, &args);
   if (status != 0)
   {
     ERROR ("java plugin: cjni_shutdown: AttachCurrentThread failed with status %i.",
@@ -3024,26 +3001,26 @@
   }
 
   /* Execute all the shutdown functions registered by plugins. */
   cjni_shutdown_plugins (jvm_env);
 
   /* Release all the global references to callback functions */
-  for (i = 0; i < java_callbacks_num; i++)
+  for (size_t i = 0; i < java_callbacks_num; i++)
   {
     if (java_callbacks[i].object != NULL)
     {
       (*jvm_env)->DeleteGlobalRef (jvm_env, java_callbacks[i].object);
       java_callbacks[i].object = NULL;
     }
     sfree (java_callbacks[i].name);
   }
   java_callbacks_num = 0;
   sfree (java_callbacks);
 
   /* Release all the global references to directly loaded classes. */
-  for (i = 0; i < java_classes_list_len; i++)
+  for (size_t i = 0; i < java_classes_list_len; i++)
   {
     if (java_classes_list[i].object != NULL)
     {
       (*jvm_env)->DeleteGlobalRef (jvm_env, java_classes_list[i].object);
       java_classes_list[i].object = NULL;
     }
@@ -3058,13 +3035,13 @@
   jvm = NULL;
   jvm_env = NULL;
 
   pthread_key_delete (jvm_env_key);
 
   /* Free the JVM argument list */
-  for (i = 0; i < jvm_argc; i++)
+  for (size_t i = 0; i < jvm_argc; i++)
     sfree (jvm_argv[i]);
   jvm_argc = 0;
   sfree (jvm_argv);
 
   return (0);
 } /* }}} int cjni_shutdown */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/client.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/client.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/client.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/client.c	2016-09-11 16:10:25.263038721 +0800
@@ -110,12 +110,13 @@
 };
 typedef struct lcc_response_s lcc_response_t;
 
 /*
  * Private functions
  */
+__attribute__ ((format (printf, 1, 0)))
 static int lcc_tracef(char const *format, ...)
 {
   va_list ap;
   int status;
 
   char const *trace = getenv (LCC_TRACE_ENV);
@@ -243,18 +244,16 @@
     str_len--;
   }
 } /* }}} void lcc_chomp */
 
 static void lcc_response_free (lcc_response_t *res) /* {{{ */
 {
-  size_t i;
-
   if (res == NULL)
     return;
 
-  for (i = 0; i < res->lines_num; i++)
+  for (size_t i = 0; i < res->lines_num; i++)
     free (res->lines[i]);
   free (res->lines);
   res->lines = NULL;
 } /* }}} void lcc_response_free */
 
 static int lcc_send (lcc_connection_t *c, const char *command) /* {{{ */
@@ -274,19 +273,17 @@
   return (0);
 } /* }}} int lcc_send */
 
 static int lcc_receive (lcc_connection_t *c, /* {{{ */
     lcc_response_t *ret_res)
 {
-  lcc_response_t res;
+  lcc_response_t res = { 0 };
   char *ptr;
   char buffer[4096];
   size_t i;
 
-  memset (&res, 0, sizeof (res));
-
   /* Read the first line, containing the status and a message */
   ptr = fgets (buffer, sizeof (buffer), c->fh);
   if (ptr == NULL)
   {
     lcc_set_errno (c, errno);
     return (-1);
@@ -295,13 +292,13 @@
   lcc_tracef ("receive: <-- %s\n", buffer);
 
   /* Convert the leading status to an integer and make `ptr' to point to the
    * beginning of the message. */
   ptr = NULL;
   errno = 0;
-  res.status = strtol (buffer, &ptr, 0);
+  res.status = (int) strtol (buffer, &ptr, 0);
   if ((errno != 0) || (ptr == &buffer[0]))
   {
     lcc_set_errno (c, errno);
     return (-1);
   }
 
@@ -320,13 +317,13 @@
     return (0);
   }
 
   /* Allocate space for the char-pointers */
   res.lines_num = (size_t) res.status;
   res.status = 0;
-  res.lines = (char **) malloc (res.lines_num * sizeof (char *));
+  res.lines = malloc (res.lines_num * sizeof (*res.lines));
   if (res.lines == NULL)
   {
     lcc_set_errno (c, ENOMEM);
     return (-1);
   }
 
@@ -366,36 +363,35 @@
   return (0);
 } /* }}} int lcc_receive */
 
 static int lcc_sendreceive (lcc_connection_t *c, /* {{{ */
     const char *command, lcc_response_t *ret_res)
 {
-  lcc_response_t res;
+  lcc_response_t res = { 0 };
   int status;
 
   if (c->fh == NULL)
   {
     lcc_set_errno (c, EBADF);
     return (-1);
   }
 
   status = lcc_send (c, command);
   if (status != 0)
     return (status);
 
-  memset (&res, 0, sizeof (res));
   status = lcc_receive (c, &res);
   if (status == 0)
     memcpy (ret_res, &res, sizeof (*ret_res));
 
   return (status);
 } /* }}} int lcc_sendreceive */
 
 static int lcc_open_unixsocket (lcc_connection_t *c, const char *path) /* {{{ */
 {
-  struct sockaddr_un sa;
+  struct sockaddr_un sa = { 0 };
   int fd;
   int status;
 
   assert (c != NULL);
   assert (c->fh == NULL);
   assert (path != NULL);
@@ -406,13 +402,12 @@
   if (fd < 0)
   {
     lcc_set_errno (c, errno);
     return (-1);
   }
 
-  memset (&sa, 0, sizeof (sa));
   sa.sun_family = AF_UNIX;
   strncpy (sa.sun_path, path, sizeof (sa.sun_path) - 1);
 
   status = connect (fd, (struct sockaddr *) &sa, sizeof (sa));
   if (status != 0)
   {
@@ -432,15 +427,13 @@
   return (0);
 } /* }}} int lcc_open_unixsocket */
 
 static int lcc_open_netsocket (lcc_connection_t *c, /* {{{ */
     const char *addr_orig)
 {
-  struct addrinfo ai_hints;
   struct addrinfo *ai_res;
-  struct addrinfo *ai_ptr;
   char addr_copy[NI_MAXHOST];
   char *addr;
   char *port;
   int fd;
   int status;
 
@@ -449,20 +442,12 @@
   assert (addr_orig != NULL);
 
   strncpy(addr_copy, addr_orig, sizeof(addr_copy));
   addr_copy[sizeof(addr_copy) - 1] = '\0';
   addr = addr_copy;
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags = 0;
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_STREAM;
-
   port = NULL;
   if (*addr == '[') /* IPv6+port format */
   {
     /* `addr' is something like "[2001:780:104:2:211:24ff:feab:26f8]:12345" */
     addr++;
 
@@ -492,23 +477,28 @@
     {
       *port = 0;
       port++;
     }
   }
 
-  ai_res = NULL;
+  struct addrinfo ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_ADDRCONFIG,
+    .ai_socktype = SOCK_STREAM
+  };
+
   status = getaddrinfo (addr,
                         port == NULL ? LCC_DEFAULT_PORT : port,
                         &ai_hints, &ai_res);
   if (status != 0)
   {
     LCC_SET_ERRSTR (c, "getaddrinfo: %s", gai_strerror (status));
     return (-1);
   }
 
-  for (ai_ptr = ai_res; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_res; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype, ai_ptr->ai_protocol);
     if (fd < 0)
     {
       status = errno;
       continue;
@@ -592,16 +582,15 @@
   if (address == NULL)
     return (-1);
 
   if (ret_con == NULL)
     return (-1);
 
-  c = (lcc_connection_t *) malloc (sizeof (*c));
+  c = calloc (1, sizeof (*c));
   if (c == NULL)
     return (-1);
-  memset (c, 0, sizeof (*c));
 
   status = lcc_open_socket (c, address);
   if (status != 0)
   {
     lcc_disconnect (c);
     return (status);
@@ -695,20 +684,20 @@
     return (0);
   }
 
   /* Allocate space for the values */
   if (ret_values != NULL)
   {
-    values = (gauge_t *) malloc (values_num * sizeof (*values));
+    values = malloc (values_num * sizeof (*values));
     if (values == NULL)
       BAIL_OUT (ENOMEM);
   }
 
   if (ret_values_names != NULL)
   {
-    values_names = (char **) calloc (values_num, sizeof (*values_names));
+    values_names = calloc (values_num, sizeof (*values_names));
     if (values_names == NULL)
       BAIL_OUT (ENOMEM);
   }
 
   for (i = 0; i < res.lines_num; i++)
   {
@@ -758,13 +747,12 @@
 {
   char ident_str[6 * LCC_NAME_LEN];
   char ident_esc[12 * LCC_NAME_LEN];
   char command[1024] = "";
   lcc_response_t res;
   int status;
-  size_t i;
 
   if ((c == NULL) || (vl == NULL) || (vl->values_len < 1)
       || (vl->values == NULL) || (vl->values_types == NULL))
   {
     lcc_set_errno (c, EINVAL);
     return (-1);
@@ -783,13 +771,13 @@
 
   if (vl->time > 0.0)
     SSTRCATF (command, " %.3f", vl->time);
   else
     SSTRCAT (command, " N");
 
-  for (i = 0; i < vl->values_len; i++)
+  for (size_t i = 0; i < vl->values_len; i++)
   {
     if (vl->values_types[i] == LCC_TYPE_COUNTER)
       SSTRCATF (command, ":%"PRIu64, vl->values[i].counter);
     else if (vl->values_types[i] == LCC_TYPE_GAUGE)
     {
       if (isnan (vl->values[i].gauge))
@@ -875,13 +863,12 @@
 /* TODO: Implement lcc_putnotif */
 
 int lcc_listval (lcc_connection_t *c, /* {{{ */
     lcc_identifier_t **ret_ident, size_t *ret_ident_num)
 {
   lcc_response_t res;
-  size_t i;
   int status;
 
   lcc_identifier_t *ident;
   size_t ident_num;
 
   if (c == NULL)
@@ -902,21 +889,21 @@
     LCC_SET_ERRSTR (c, "Server error: %s", res.message);
     lcc_response_free (&res);
     return (-1);
   }
 
   ident_num = res.lines_num;
-  ident = (lcc_identifier_t *) malloc (ident_num * sizeof (*ident));
+  ident = malloc (ident_num * sizeof (*ident));
   if (ident == NULL)
   {
     lcc_response_free (&res);
     lcc_set_errno (c, ENOMEM);
     return (-1);
   }
 
-  for (i = 0; i < res.lines_num; i++)
+  for (size_t i = 0; i < res.lines_num; i++)
   {
     char *time_str;
     char *ident_str;
 
     /* First field is the time. */
     time_str = res.lines[i];
@@ -1071,15 +1058,17 @@
     SSTRCPY (ident->type_instance, type_instance);
 
   free (string_copy);
   return (0);
 } /* }}} int lcc_string_to_identifier */
 
-int lcc_identifier_compare (const lcc_identifier_t *i0, /* {{{ */
-    const lcc_identifier_t *i1)
+int lcc_identifier_compare (const void *a, /* {{{ */
+    const void *b)
 {
+  const lcc_identifier_t *i0 = a;
+  const lcc_identifier_t *i1 = b;
   int status;
 
   if ((i0 == NULL) && (i1 == NULL))
     return (0);
   else if (i0 == NULL)
     return (-1);
@@ -1110,11 +1099,11 @@
   {
     lcc_set_errno (c, EINVAL);
     return (-1);
   }
 
   qsort (idents, idents_num, sizeof (*idents),
-      (void *) lcc_identifier_compare);
+      lcc_identifier_compare);
   return (0);
 } /* }}} int lcc_sort_identifiers */
 
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/client.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/client.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/client.h	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/client.h	2016-09-11 16:10:25.263038721 +0800
@@ -128,14 +128,14 @@
 int lcc_string_to_identifier (lcc_connection_t *c,
     lcc_identifier_t *ident, const char *string);
 
 /* Compares the identifiers "i0" and "i1" and returns less than zero or greater
  * than zero if "i0" is smaller than or greater than "i1", respectively. If
  * "i0" and "i1" are identical, zero is returned. */
-int lcc_identifier_compare (const lcc_identifier_t *i0,
-    const lcc_identifier_t *i1);
+int lcc_identifier_compare (const void *i0,
+    const void *i1);
 int lcc_sort_identifiers (lcc_connection_t *c,
     lcc_identifier_t *idents, size_t idents_num);
 
 LCC_END_DECLS
 
 /* vim: set sw=2 sts=2 et : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/lcc_features.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/lcc_features.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/lcc_features.h	2016-11-29 00:09:54.388435969 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/lcc_features.h	2016-09-11 16:11:07.322981123 +0800
@@ -35,18 +35,18 @@
 # define LCC_END_DECLS
 #endif
 
 #define LCC_API_VERSION 0
 
 #define LCC_VERSION_MAJOR 5
-#define LCC_VERSION_MINOR 5
-#define LCC_VERSION_PATCH 3
+#define LCC_VERSION_MINOR 6
+#define LCC_VERSION_PATCH 0
 
 #define LCC_VERSION_EXTRA ""
 
-#define LCC_VERSION_STRING "5.5.3"
+#define LCC_VERSION_STRING "5.6.0"
 
 #define LCC_VERSION_ENCODE(major, minor, patch) \
 	((major) * 10000 + (minor) * 100 + (patch))
 
 #define LCC_VERSION \
 	LCC_VERSION_ENCODE(LCC_VERSION_MAJOR, LCC_VERSION_MINOR, LCC_VERSION_PATCH)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/network.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/network.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/collectd/network.h	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/collectd/network.h	2016-09-11 16:10:25.263038721 +0800
@@ -53,13 +53,13 @@
 /*
  * Create / destroy object
  */
 lcc_network_t *lcc_network_create (void);
 void lcc_network_destroy (lcc_network_t *net);
 
-/* 
+/*
  * Add servers
  */
 lcc_server_t *lcc_server_create (lcc_network_t *net,
     const char *node, const char *service);
 int lcc_server_destroy (lcc_network_t *net, lcc_server_t *srv);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/Makefile.am	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/Makefile.am	2016-09-11 16:10:25.263038721 +0800
@@ -1,12 +1,8 @@
 AUTOMAKE_OPTIONS = foreign no-dependencies
 
-if COMPILER_IS_GCC
-AM_CFLAGS = -Wall -Werror
-endif
-
 pkginclude_HEADERS = collectd/client.h collectd/network.h collectd/network_buffer.h collectd/lcc_features.h
 lib_LTLIBRARIES = libcollectdclient.la
 nodist_pkgconfig_DATA = libcollectdclient.pc
 
 BUILT_SOURCES = collectd/lcc_features.h
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/Makefile.in	2016-11-29 00:09:18.096052665 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/Makefile.in	2016-09-11 16:10:46.119009796 +0800
@@ -200,12 +200,14 @@
   done | $(am__uniquify_input)`
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -217,40 +219,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -258,16 +281,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -288,22 +307,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -317,19 +337,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -352,24 +371,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -379,12 +405,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -404,28 +432,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -438,13 +476,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
@@ -473,13 +510,12 @@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 AUTOMAKE_OPTIONS = foreign no-dependencies
-@COMPILER_IS_GCC_TRUE@AM_CFLAGS = -Wall -Werror
 pkginclude_HEADERS = collectd/client.h collectd/network.h collectd/network_buffer.h collectd/lcc_features.h
 lib_LTLIBRARIES = libcollectdclient.la
 nodist_pkgconfig_DATA = libcollectdclient.pc
 BUILT_SOURCES = collectd/lcc_features.h
 libcollectdclient_la_SOURCES = client.c network.c network_buffer.c
 libcollectdclient_la_CPPFLAGS = $(AM_CPPFLAGS) \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/network_buffer.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/network_buffer.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/network_buffer.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/network_buffer.c	2016-09-11 16:10:25.263038721 +0800
@@ -33,13 +33,12 @@
 #include <errno.h>
 #include <arpa/inet.h> /* htons */
 
 #include <pthread.h>
 
 #if HAVE_LIBGCRYPT
-# include <pthread.h>
 # if defined __APPLE__
 /* default xcode compiler throws warnings even when deprecated functionality
  * is not used. -Werror breaks the build because of erroneous warnings.
  * http://stackoverflow.com/questions/10556299/compiler-warnings-with-libgcrypt-v1-5-0/12830209#12830209
  */
 #  pragma GCC diagnostic ignored "-Wdeprecated-declarations"
@@ -272,13 +271,12 @@
   uint16_t      pkg_length;
   uint16_t      pkg_num_values;
   uint8_t       pkg_values_types[vl->values_len];
   value_t       pkg_values[vl->values_len];
 
   size_t offset;
-  size_t i;
 
   packet_len = sizeof (pkg_type) + sizeof (pkg_length)
     + sizeof (pkg_num_values)
     + sizeof (pkg_values_types)
     + sizeof (pkg_values);
 
@@ -286,13 +284,13 @@
     return (ENOMEM);
 
   pkg_type = htons (TYPE_VALUES);
   pkg_length = htons ((uint16_t) packet_len);
   pkg_num_values = htons ((uint16_t) vl->values_len);
 
-  for (i = 0; i < vl->values_len; i++)
+  for (size_t i = 0; i < vl->values_len; i++)
   {
     pkg_values_types[i] = (uint8_t) vl->values_types[i];
     switch (vl->values_types[i])
     {
       case LCC_TYPE_COUNTER:
         pkg_values[i].counter = (counter_t) htonll (vl->values[i].counter);
@@ -651,25 +649,23 @@
   if (size < 128)
   {
     errno = EINVAL;
     return (NULL);
   }
 
-  nb = malloc (sizeof (*nb));
+  nb = calloc (1, sizeof (*nb));
   if (nb == NULL)
     return (NULL);
-  memset (nb, 0, sizeof (*nb));
 
   nb->size = size;
-  nb->buffer = malloc (nb->size);
+  nb->buffer = calloc (1, nb->size);
   if (nb->buffer == NULL)
   {
     free (nb);
     return (NULL);
   }
-  memset (nb->buffer, 0, nb->size);
 
   nb->ptr = nb->buffer;
   nb->free = nb->size;
 
   nb->seclevel = NONE;
   nb->username = NULL;
@@ -761,23 +757,21 @@
   else if (nb->seclevel == ENCRYPT)
   {
     size_t username_length = strlen (nb->username);
     uint16_t pkg_type = htons (TYPE_ENCR_AES256);
     uint16_t pkg_length = 0; /* Filled in in finalize. */
     uint16_t pkg_user_len = htons ((uint16_t) username_length);
-    char hash[20];
+    /* Filled in in finalize. */
+    char hash[20] = { 0 };
 
     nb->encr_header_len = username_length;
     nb->encr_header_len += PART_ENCRYPTION_AES256_SIZE;
 
     gcry_randomize ((void *) &nb->encr_iv, sizeof (nb->encr_iv),
         GCRY_STRONG_RANDOM);
 
-    /* Filled in in finalize. */
-    memset (hash, 0, sizeof (hash));
-
     ADD_STATIC (nb, pkg_type);
     ADD_STATIC (nb, pkg_length);
     ADD_STATIC (nb, pkg_user_len);
     ADD_GENERIC (nb, nb->username, username_length);
     ADD_GENERIC (nb, nb->encr_iv, sizeof (nb->encr_iv));
     ADD_GENERIC (nb, hash, sizeof (hash));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/network.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/network.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/libcollectdclient/network.c	2016-11-29 00:08:22.407470467 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/libcollectdclient/network.c	2016-09-11 16:10:25.263038721 +0800
@@ -116,35 +116,33 @@
 
   int_server_destroy (next);
 } /* }}} void int_server_destroy */
 
 static int server_open_socket (lcc_server_t *srv) /* {{{ */
 {
-  struct addrinfo ai_hints = { 0 };
-  struct addrinfo *ai_list = NULL;
-  struct addrinfo *ai_ptr;
+  struct addrinfo *ai_list;
   int status;
 
   if (srv == NULL)
     return (EINVAL);
 
   if (srv->fd >= 0)
     server_close_socket (srv);
 
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family   = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_DGRAM;
+  struct addrinfo ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_ADDRCONFIG,
+    .ai_socktype = SOCK_DGRAM
+  };
 
   status = getaddrinfo (srv->node, srv->service, &ai_hints, &ai_list);
   if (status != 0)
     return (status);
   assert (ai_list != NULL);
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     srv->fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype, ai_ptr->ai_protocol);
     if (srv->fd < 0)
       continue;
 
     if (ai_ptr->ai_family == AF_INET)
@@ -201,24 +199,23 @@
     return (-1);
   return (0);
 } /* }}} int server_open_socket */
 
 static int server_send_buffer (lcc_server_t *srv) /* {{{ */
 {
-  char buffer[LCC_NETWORK_BUFFER_SIZE_DEFAULT];
+  char buffer[LCC_NETWORK_BUFFER_SIZE_DEFAULT] = { 0 };
   size_t buffer_size;
   int status;
 
   if (srv->fd < 0)
   {
     status = server_open_socket (srv);
     if (status != 0)
       return (status);
   }
 
-  memset (buffer, 0, sizeof (buffer));
   buffer_size = sizeof (buffer);
 
   status = lcc_network_buffer_finalize (srv->buffer);
   if (status != 0)
   {
     lcc_network_buffer_initialize (srv->buffer);
@@ -268,16 +265,15 @@
  * Public functions
  */
 lcc_network_t *lcc_network_create (void) /* {{{ */
 {
   lcc_network_t *net;
 
-  net = malloc (sizeof (*net));
+  net = calloc (1, sizeof (*net));
   if (net == NULL)
     return (NULL);
-  memset (net, 0, sizeof (*net));
 
   net->servers = NULL;
 
   return (net);
 } /* }}} lcc_network_t *lcc_network_create */
 
@@ -296,16 +292,15 @@
 
   if ((net == NULL) || (node == NULL))
     return (NULL);
   if (service == NULL)
     service = NET_DEFAULT_PORT;
 
-  srv = malloc (sizeof (*srv));
+  srv = calloc (1, sizeof (*srv));
   if (srv == NULL)
     return (NULL);
-  memset (srv, 0, sizeof (*srv));
 
   srv->fd = -1;
   srv->security_level = NONE;
   srv->username = NULL;
   srv->password = NULL;
   srv->next = NULL;
@@ -389,13 +384,13 @@
 
   return (0);
 } /* }}} int lcc_server_set_ttl */
 
 int lcc_server_set_interface (lcc_server_t *srv, char const *interface) /* {{{ */
 {
-  int if_index;
+  unsigned int if_index;
   int status;
 
   if ((srv == NULL) || (interface == NULL))
     return (EINVAL);
 
   if_index = if_nametoindex (interface);
@@ -412,24 +407,22 @@
 #if HAVE_STRUCT_IP_MREQN_IMR_IFINDEX
       /* If possible, use the "ip_mreqn" structure which has
        * an "interface index" member. Using the interface
        * index is preferred here, because of its similarity
        * to the way IPv6 handles this. Unfortunately, it
        * appears not to be portable. */
-      struct ip_mreqn mreq;
-
-      memset (&mreq, 0, sizeof (mreq));
-      mreq.imr_multiaddr.s_addr = addr->sin_addr.s_addr;
-      mreq.imr_address.s_addr = ntohl (INADDR_ANY);
-      mreq.imr_ifindex = if_index;
+      struct ip_mreqn mreq = {
+        .imr_multiaddr.s_addr = addr->sin_addr.s_addr,
+        .imr_address.s_addr = ntohl (INADDR_ANY),
+        .imr_ifindex = (int) if_index
+      };
 #else
-      struct ip_mreq mreq;
-
-      memset (&mreq, 0, sizeof (mreq));
-      mreq.imr_multiaddr.s_addr = addr->sin_addr.s_addr;
-      mreq.imr_interface.s_addr = ntohl (INADDR_ANY);
+      struct ip_mreq mreq = {
+        .imr_multiaddr.s_addr = addr->sin_addr.s_addr,
+        .imr_interface.s_addr = ntohl (INADDR_ANY)
+      };
 #endif
 
       status = setsockopt (srv->fd, IPPROTO_IP, IP_MULTICAST_IF,
           &mreq, sizeof (mreq));
       if (status != 0)
         return (status);
@@ -453,14 +446,14 @@
       return (0);
     }
   }
 
   /* else: Not a multicast interface. */
 #if defined(SO_BINDTODEVICE)
-  status = setsockopt (srv->fd, SOL_SOCKET, SO_BINDTODEVICE,
-      interface, strlen (interface) + 1);
+  status = setsockopt (srv->fd, SOL_SOCKET, SO_BINDTODEVICE, interface,
+      (socklen_t) (strlen (interface) + 1));
   if (status != 0)
     return (-1);
 #endif
 
   return (0);
 } /* }}} int lcc_server_set_interface */
@@ -473,18 +466,16 @@
         level, username, password));
 } /* }}} int lcc_server_set_security_level */
 
 int lcc_network_values_send (lcc_network_t *net, /* {{{ */
     const lcc_value_list_t *vl)
 {
-  lcc_server_t *srv;
-
   if ((net == NULL) || (vl == NULL))
     return (EINVAL);
 
-  for (srv = net->servers; srv != NULL; srv = srv->next)
+  for (lcc_server_t *srv = net->servers; srv != NULL; srv = srv->next)
     server_value_add (srv, vl);
 
   return (0);
 } /* }}} int lcc_network_values_send */
 
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/Makefile.am	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/Makefile.am	2016-09-11 16:10:25.263038721 +0800
@@ -1,8 +1,6 @@
-AUTOMAKE_OPTIONS = foreign no-dependencies
-
 BUILT_SOURCES = parser.h
 #CLEANFILES = parser.[ch] scanner.c
 AM_YFLAGS = -d
 
 noinst_LTLIBRARIES = liboconfig.la
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/Makefile.in	2016-11-29 00:09:18.160053338 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/Makefile.in	2016-09-11 16:10:46.175009719 +0800
@@ -77,14 +77,14 @@
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
 subdir = src/liboconfig
 DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/Makefile.am scanner.c \
-	parser.h parser.c $(top_srcdir)/libltdl/config/ylwrap AUTHORS \
-	COPYING ChangeLog
+	parser.h parser.c $(top_srcdir)/libltdl/config/depcomp \
+	$(top_srcdir)/libltdl/config/ylwrap AUTHORS COPYING ChangeLog
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/configure.ac
 am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
 	$(ACLOCAL_M4)
 mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/src/config.h
@@ -111,14 +111,15 @@
 am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
 am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)/src
-depcomp =
-am__depfiles_maybe =
+depcomp = $(SHELL) $(top_srcdir)/libltdl/config/depcomp
+am__depfiles_maybe = depfiles
+am__mv = mv -f
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) \
 	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
@@ -177,12 +178,14 @@
   done | $(am__uniquify_input)`
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -194,40 +197,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -235,16 +259,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -265,22 +285,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -294,19 +315,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -329,24 +349,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -356,12 +383,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -381,28 +410,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -415,13 +454,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
@@ -449,13 +487,12 @@
 sys_symbol_underscore = @sys_symbol_underscore@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-AUTOMAKE_OPTIONS = foreign no-dependencies
 BUILT_SOURCES = parser.h
 #CLEANFILES = parser.[ch] scanner.c
 AM_YFLAGS = -d
 noinst_LTLIBRARIES = liboconfig.la
 liboconfig_la_LDFLAGS = -avoid-version $(LEXLIB)
 liboconfig_la_SOURCES = oconfig.c oconfig.h aux_types.h scanner.l parser.y
@@ -515,20 +552,39 @@
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/oconfig.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/parser.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/scanner.Plo@am__quote@
+
 .c.o:
-	$(AM_V_CC)$(COMPILE) -c -o $@ $<
+@am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`;\
+@am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
+@am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c -o $@ $<
 
 .c.obj:
-	$(AM_V_CC)$(COMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
+@am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.obj$$||'`;\
+@am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ `$(CYGPATH_W) '$<'` &&\
+@am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
 
 .c.lo:
-	$(AM_V_CC)$(LTCOMPILE) -c -o $@ $<
+@am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.lo$$||'`;\
+@am__fastdepCC_TRUE@	$(LTCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
+@am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
 
 .l.c:
 	$(AM_V_LEX)$(am__skiplex) $(SHELL) $(YLWRAP) $< $(LEX_OUTPUT_ROOT).c $@ -- $(LEXCOMPILE)
 
 .y.c:
 	$(AM_V_YACC)$(am__skipyacc) $(SHELL) $(YLWRAP) $< y.tab.c $@ y.tab.h `echo $@ | $(am__yacc_c2h)` y.output $*.output -- $(YACCCOMPILE)
@@ -664,12 +720,13 @@
 clean: clean-am
 
 clean-am: clean-generic clean-libtool clean-noinstLTLIBRARIES \
 	mostlyclean-am
 
 distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
 	-rm -f Makefile
 distclean-am: clean-am distclean-compile distclean-generic \
 	distclean-tags
 
 dvi: dvi-am
 
@@ -709,12 +766,13 @@
 
 install-ps-am:
 
 installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
 	-rm -f Makefile
 maintainer-clean-am: distclean-am maintainer-clean-generic
 
 mostlyclean: mostlyclean-am
 
 mostlyclean-am: mostlyclean-compile mostlyclean-generic \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/oconfig.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/oconfig.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/oconfig.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/oconfig.c	2016-09-11 16:10:25.263038721 +0800
@@ -40,25 +40,25 @@
 
 static void yyset_in  (FILE *fd)
 {
   yyin = fd;
 } /* void yyset_in */
 
-oconfig_item_t *oconfig_parse_fh (FILE *fh)
+static oconfig_item_t *oconfig_parse_fh (FILE *fh)
 {
   int status;
   oconfig_item_t *ret;
 
   char file[10];
 
   yyset_in (fh);
 
   if (NULL == c_file) {
     status = snprintf (file, sizeof (file), "<fd#%d>", fileno (fh));
 
-    if ((status < 0) || (status >= sizeof (file))) {
+    if ((status < 0) || (((size_t) status) >= sizeof (file))) {
       c_file = "<unknown>";
     }
     else {
       file[sizeof (file) - 1] = '\0';
       c_file = file;
     }
@@ -103,19 +103,18 @@
 } /* oconfig_item_t *oconfig_parse_file */
 
 oconfig_item_t *oconfig_clone (const oconfig_item_t *ci_orig)
 {
   oconfig_item_t *ci_copy;
 
-  ci_copy = (oconfig_item_t *) malloc (sizeof (*ci_copy));
+  ci_copy = calloc (1, sizeof (*ci_copy));
   if (ci_copy == NULL)
   {
-    fprintf (stderr, "malloc failed.\n");
+    fprintf (stderr, "calloc failed.\n");
     return (NULL);
   }
-  memset (ci_copy, 0, sizeof (*ci_copy));
   ci_copy->values = NULL;
   ci_copy->parent = NULL;
   ci_copy->children = NULL;
 
   ci_copy->key = strdup (ci_orig->key);
   if (ci_copy->key == NULL)
@@ -124,32 +123,29 @@
     free (ci_copy);
     return (NULL);
   }
 
   if (ci_orig->values_num > 0) /* {{{ */
   {
-    int i;
-
-    ci_copy->values = (oconfig_value_t *) calloc (ci_orig->values_num,
+    ci_copy->values = (oconfig_value_t *) calloc ((size_t) ci_orig->values_num,
 	sizeof (*ci_copy->values));
     if (ci_copy->values == NULL)
     {
       fprintf (stderr, "calloc failed.\n");
       free (ci_copy->key);
       free (ci_copy);
       return (NULL);
     }
     ci_copy->values_num = ci_orig->values_num;
 
-    for (i = 0; i < ci_copy->values_num; i++)
+    for (int i = 0; i < ci_copy->values_num; i++)
     {
        ci_copy->values[i].type = ci_orig->values[i].type;
        if (ci_copy->values[i].type == OCONFIG_TYPE_STRING)
        {
-	 ci_copy->values[i].value.string
-	   = strdup (ci_orig->values[i].value.string);
+         ci_copy->values[i].value.string = strdup (ci_orig->values[i].value.string);
 	 if (ci_copy->values[i].value.string == NULL)
 	 {
 	   fprintf (stderr, "strdup failed.\n");
 	   oconfig_free (ci_copy);
 	   return (NULL);
 	 }
@@ -160,28 +156,26 @@
        }
     }
   } /* }}} if (ci_orig->values_num > 0) */
 
   if (ci_orig->children_num > 0) /* {{{ */
   {
-    int i;
-
-    ci_copy->children = (oconfig_item_t *) calloc (ci_orig->children_num,
+    ci_copy->children = (oconfig_item_t *) calloc ((size_t) ci_orig->children_num,
 	sizeof (*ci_copy->children));
     if (ci_copy->children == NULL)
     {
       fprintf (stderr, "calloc failed.\n");
       oconfig_free (ci_copy);
       return (NULL);
     }
     ci_copy->children_num = ci_orig->children_num;
 
-    for (i = 0; i < ci_copy->children_num; i++)
+    for (int i = 0; i < ci_copy->children_num; i++)
     {
       oconfig_item_t *child;
-      
+
       child = oconfig_clone (ci_orig->children + i);
       if (child == NULL)
       {
 	oconfig_free (ci_copy);
 	return (NULL);
       }
@@ -193,39 +187,36 @@
 
   return (ci_copy);
 } /* oconfig_item_t *oconfig_clone */
 
 static void oconfig_free_all (oconfig_item_t *ci)
 {
-  int i;
-
   if (ci == NULL)
     return;
 
   if (ci->key != NULL)
     free (ci->key);
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
     if ((ci->values[i].type == OCONFIG_TYPE_STRING)
         && (NULL != ci->values[i].value.string))
       free (ci->values[i].value.string);
 
   if (ci->values != NULL)
     free (ci->values);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
     oconfig_free_all (ci->children + i);
 
   if (ci->children != NULL)
     free (ci->children);
 }
 
 void oconfig_free (oconfig_item_t *ci)
 {
   oconfig_free_all (ci);
   free (ci);
-  ci = NULL;
 }
 
 /*
  * vim:shiftwidth=2:tabstop=8:softtabstop=2:fdm=marker
  */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/oconfig.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/oconfig.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/oconfig.h	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/oconfig.h	2016-09-11 16:10:25.263038721 +0800
@@ -61,13 +61,12 @@
   int              children_num;
 };
 
 /*
  * Functions
  */
-oconfig_item_t *oconfig_parse_fh (FILE *fh);
 oconfig_item_t *oconfig_parse_file (const char *file);
 
 oconfig_item_t *oconfig_clone (const oconfig_item_t *ci);
 
 void oconfig_free (oconfig_item_t *ci);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/parser.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/parser.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/parser.c	2016-11-29 00:10:00.848504480 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/parser.c	2016-09-11 16:11:16.482968961 +0800
@@ -464,13 +464,13 @@
 #if YYDEBUG
   /* YYRLINE[YYN] -- Source line where rule number YYN was defined.  */
 static const yytype_uint8 yyrline[] =
 {
        0,    82,    82,    83,    87,    88,    89,    90,    94,   101,
      110,   114,   124,   130,   140,   147,   160,   176,   177,   178,
-     182,   192,   209,   217
+     182,   192,   209,   216
 };
 #endif
 
 #if YYDEBUG || YYERROR_VERBOSE || 1
 /* YYTNAME[SYMBOL-NUM] -- String name of the symbol SYMBOL-NUM.
    First, the terminals, then, starting at YYNTOKENS, nonterminals.  */
@@ -1445,33 +1445,31 @@
 #line 1446 "parser.c" /* yacc.c:1646  */
     break;
 
   case 22:
 #line 210 "parser.y" /* yacc.c:1646  */
     {
-	 ci_root = malloc (sizeof (oconfig_item_t));
-	 memset (ci_root, '\0', sizeof (oconfig_item_t));
+	 ci_root = calloc (1, sizeof (*ci_root));
 	 ci_root->children = (yyvsp[0].sl).statement;
 	 ci_root->children_num = (yyvsp[0].sl).statement_num;
 	}
-#line 1457 "parser.c" /* yacc.c:1646  */
+#line 1456 "parser.c" /* yacc.c:1646  */
     break;
 
   case 23:
-#line 217 "parser.y" /* yacc.c:1646  */
+#line 216 "parser.y" /* yacc.c:1646  */
     {
-	 ci_root = malloc (sizeof (oconfig_item_t));
-	 memset (ci_root, '\0', sizeof (oconfig_item_t));
+	 ci_root = calloc (1, sizeof (*ci_root));
 	 ci_root->children = NULL;
 	 ci_root->children_num = 0;
 	}
-#line 1468 "parser.c" /* yacc.c:1646  */
+#line 1466 "parser.c" /* yacc.c:1646  */
     break;
 
 
-#line 1472 "parser.c" /* yacc.c:1646  */
+#line 1470 "parser.c" /* yacc.c:1646  */
       default: break;
     }
   /* User semantic actions sometimes alter yychar, and that requires
      that yytoken be updated with the new translation.  We take the
      approach of translating immediately before every use of yytoken.
      One alternative is translating here after every semantic action,
@@ -1693,17 +1691,17 @@
 #if YYERROR_VERBOSE
   if (yymsg != yymsgbuf)
     YYSTACK_FREE (yymsg);
 #endif
   return yyresult;
 }
-#line 225 "parser.y" /* yacc.c:1906  */
+#line 223 "parser.y" /* yacc.c:1906  */
 
 static int yyerror (const char *s)
 {
-	char *text;
+	const char *text;
 
 	if (*yytext == '\n')
 		text = "<newline>";
 	else
 		text = yytext;
 
@@ -1713,13 +1711,12 @@
 } /* int yyerror */
 
 static char *unquote (const char *orig)
 {
 	char *ret = strdup (orig);
 	int len;
-	int i;
 
 	if (ret == NULL)
 		return (NULL);
 
 	len = strlen (ret);
 
@@ -1727,13 +1724,13 @@
 		return (ret);
 
 	len -= 2;
 	memmove (ret, ret + 1, len);
 	ret[len] = '\0';
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		if (ret[i] == '\\')
 		{
 			memmove (ret + i, ret + (i + 1), len - i);
 			len--;
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/parser.y /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/parser.y
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/parser.y	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/parser.y	2016-09-11 16:10:25.263038721 +0800
@@ -205,30 +205,28 @@
 	}
 	;
 
 entire_file:
 	statement_list
 	{
-	 ci_root = malloc (sizeof (oconfig_item_t));
-	 memset (ci_root, '\0', sizeof (oconfig_item_t));
+	 ci_root = calloc (1, sizeof (*ci_root));
 	 ci_root->children = $1.statement;
 	 ci_root->children_num = $1.statement_num;
 	}
 	| /* epsilon */
 	{
-	 ci_root = malloc (sizeof (oconfig_item_t));
-	 memset (ci_root, '\0', sizeof (oconfig_item_t));
+	 ci_root = calloc (1, sizeof (*ci_root));
 	 ci_root->children = NULL;
 	 ci_root->children_num = 0;
 	}
 	;
 
 %%
 static int yyerror (const char *s)
 {
-	char *text;
+	const char *text;
 
 	if (*yytext == '\n')
 		text = "<newline>";
 	else
 		text = yytext;
 
@@ -238,13 +236,12 @@
 } /* int yyerror */
 
 static char *unquote (const char *orig)
 {
 	char *ret = strdup (orig);
 	int len;
-	int i;
 
 	if (ret == NULL)
 		return (NULL);
 
 	len = strlen (ret);
 
@@ -252,13 +249,13 @@
 		return (ret);
 
 	len -= 2;
 	memmove (ret, ret + 1, len);
 	ret[len] = '\0';
 
-	for (i = 0; i < len; i++)
+	for (int i = 0; i < len; i++)
 	{
 		if (ret[i] == '\\')
 		{
 			memmove (ret + i, ret + (i + 1), len - i);
 			len--;
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/scanner.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/scanner.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/scanner.c	2016-11-29 00:10:00.760503545 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/scanner.c	2016-09-11 16:11:16.402969067 +0800
@@ -3353,12 +3353,18 @@
 #include <stdlib.h>
 #include <string.h>
 #include "oconfig.h"
 #include "aux_types.h"
 #include "parser.h"
 
+#ifdef __clang__
+#pragma clang diagnostic push
+#pragma clang diagnostic ignored "-Wmissing-noreturn"
+#endif
+
+
 /* multiline string buffer */
 static char *ml_buffer = NULL;
 static int   ml_pos    = 0;
 static int   ml_len    = 0;
 
 #define ml_free (ml_len - ml_pos)
@@ -3375,13 +3381,13 @@
 
 /* IPv6 address according to http://www.ietf.org/rfc/rfc2373.txt
  * This supports embedded IPv4 addresses as well but does not strictly check
  * for the right prefix (::0:<v4> or ::FFFF:<v4>) because there are too many
  * ways to correctly represent the zero bytes. It's up to the user to check
  * for valid addresses. */
-#line 3382 "scanner.c"
+#line 3388 "scanner.c"
 
 #define INITIAL 0
 #define ML 1
 
 #ifndef YY_NO_UNISTD_H
 /* Special case for "unistd.h", since it is non-ANSI. We include it way
@@ -3591,15 +3597,15 @@
 		}
 
 		yy_load_buffer_state( );
 		}
 
 	{
-#line 85 "scanner.l"
+#line 91 "scanner.l"
 
-#line 3600 "scanner.c"
+#line 3606 "scanner.c"
 
 	while ( 1 )		/* loops until end-of-file is reached */
 		{
 		yy_cp = (yy_c_buf_p);
 
 		/* Support of yytext. */
@@ -3662,85 +3668,85 @@
 			*yy_cp = (yy_hold_char);
 			yy_cp = (yy_last_accepting_cpos);
 			yy_current_state = (yy_last_accepting_state);
 			goto yy_find_action;
 
 case 1:
-#line 87 "scanner.l"
+#line 93 "scanner.l"
 case 2:
 YY_RULE_SETUP
-#line 87 "scanner.l"
+#line 93 "scanner.l"
 {/* ignore */}
 	YY_BREAK
 case 3:
 /* rule 3 can match eol */
 YY_RULE_SETUP
-#line 89 "scanner.l"
+#line 95 "scanner.l"
 {/* continue line */}
 	YY_BREAK
 case 4:
 /* rule 4 can match eol */
 YY_RULE_SETUP
-#line 91 "scanner.l"
+#line 97 "scanner.l"
 {return (EOL);}
 	YY_BREAK
 case 5:
 YY_RULE_SETUP
-#line 92 "scanner.l"
+#line 98 "scanner.l"
 {return (SLASH);}
 	YY_BREAK
 case 6:
 YY_RULE_SETUP
-#line 93 "scanner.l"
+#line 99 "scanner.l"
 {return (OPENBRAC);}
 	YY_BREAK
 case 7:
 YY_RULE_SETUP
-#line 94 "scanner.l"
+#line 100 "scanner.l"
 {return (CLOSEBRAC);}
 	YY_BREAK
 case 8:
 YY_RULE_SETUP
-#line 95 "scanner.l"
+#line 101 "scanner.l"
 {yylval.boolean = 1; return (BTRUE);}
 	YY_BREAK
 case 9:
 YY_RULE_SETUP
-#line 96 "scanner.l"
+#line 102 "scanner.l"
 {yylval.boolean = 0; return (BFALSE);}
 	YY_BREAK
 case 10:
 YY_RULE_SETUP
-#line 98 "scanner.l"
+#line 104 "scanner.l"
 {yylval.string = yytext; return (UNQUOTED_STRING);}
 	YY_BREAK
 case 11:
 YY_RULE_SETUP
-#line 99 "scanner.l"
+#line 105 "scanner.l"
 {yylval.string = yytext; return (UNQUOTED_STRING);}
 	YY_BREAK
 case 12:
 YY_RULE_SETUP
-#line 101 "scanner.l"
+#line 107 "scanner.l"
 {yylval.number = strtod (yytext, NULL); return (NUMBER);}
 	YY_BREAK
 case 13:
 /* rule 13 can match eol */
 YY_RULE_SETUP
-#line 103 "scanner.l"
+#line 109 "scanner.l"
 {yylval.string = yytext; return (QUOTED_STRING);}
 	YY_BREAK
 case 14:
 YY_RULE_SETUP
-#line 104 "scanner.l"
+#line 110 "scanner.l"
 {yylval.string = yytext; return (UNQUOTED_STRING);}
 	YY_BREAK
 case 15:
 /* rule 15 can match eol */
 YY_RULE_SETUP
-#line 106 "scanner.l"
+#line 112 "scanner.l"
 {
 	int len = strlen (yytext);
 
 	ml_pos = 0;
 
 	/* remove "\\<EOL>" */
@@ -3753,19 +3759,19 @@
 	ml_append (yytext);
 	BEGIN (ML);
 }
 	YY_BREAK
 case 16:
 YY_RULE_SETUP
-#line 121 "scanner.l"
+#line 127 "scanner.l"
 {/* remove leading white-space */}
 	YY_BREAK
 case 17:
 /* rule 17 can match eol */
 YY_RULE_SETUP
-#line 122 "scanner.l"
+#line 128 "scanner.l"
 {
 	int len = strlen (yytext);
 
 	/* remove "\\<EOL>" */
 	if ('\r' == yytext[len - 2])
 		len -= 3;
@@ -3776,27 +3782,27 @@
 	ml_append(yytext);
 }
 	YY_BREAK
 case 18:
 /* rule 18 can match eol */
 YY_RULE_SETUP
-#line 134 "scanner.l"
+#line 140 "scanner.l"
 {
 	ml_append(yytext);
 	yylval.string = ml_buffer;
 
 	BEGIN (INITIAL);
 	return (QUOTED_STRING);
 }
 	YY_BREAK
 case 19:
 YY_RULE_SETUP
-#line 141 "scanner.l"
+#line 147 "scanner.l"
 ECHO;
 	YY_BREAK
-#line 3797 "scanner.c"
+#line 3803 "scanner.c"
 case YY_STATE_EOF(INITIAL):
 case YY_STATE_EOF(ML):
 	yyterminate();
 
 	case YY_END_OF_BUFFER:
 		{
@@ -4759,30 +4765,33 @@
 {
 	free( (char *) ptr );	/* see yyrealloc() for (char *) cast */
 }
 
 #define YYTABLES_NAME "yytables"
 
-#line 140 "scanner.l"
+#line 146 "scanner.l"
 
 
 static void ml_append (char *string)
 {
 	int len = strlen (string);
 	int s;
 
 	if (ml_free <= len) {
 		ml_len += len - ml_free + 1;
-		ml_buffer = (char *)realloc (ml_buffer, ml_len);
+		ml_buffer = realloc (ml_buffer, ml_len);
 		if (NULL == ml_buffer)
 			YY_FATAL_ERROR ("out of dynamic memory in ml_append");
 	}
 
 	s = snprintf (ml_buffer + ml_pos, ml_free, "%s", string);
 	if ((0 > s) || (ml_free <= s))
 		YY_FATAL_ERROR ("failed to write to multiline buffer");
 
 	ml_pos += s;
 	return;
 } /* ml_append */
 
+#ifdef __clang__
+#pragma clang diagnostic pop
+#endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/scanner.l /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/scanner.l
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/liboconfig/scanner.l	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/liboconfig/scanner.l	2016-09-11 16:10:25.263038721 +0800
@@ -30,12 +30,18 @@
 #include <stdlib.h>
 #include <string.h>
 #include "oconfig.h"
 #include "aux_types.h"
 #include "parser.h"
 
+#ifdef __clang__
+#pragma clang diagnostic push
+#pragma clang diagnostic ignored "-Wmissing-noreturn"
+#endif
+
+
 /* multiline string buffer */
 static char *ml_buffer = NULL;
 static int   ml_pos    = 0;
 static int   ml_len    = 0;
 
 #define ml_free (ml_len - ml_pos)
@@ -143,19 +149,22 @@
 {
 	int len = strlen (string);
 	int s;
 
 	if (ml_free <= len) {
 		ml_len += len - ml_free + 1;
-		ml_buffer = (char *)realloc (ml_buffer, ml_len);
+		ml_buffer = realloc (ml_buffer, ml_len);
 		if (NULL == ml_buffer)
 			YY_FATAL_ERROR ("out of dynamic memory in ml_append");
 	}
 
 	s = snprintf (ml_buffer + ml_pos, ml_free, "%s", string);
 	if ((0 > s) || (ml_free <= s))
 		YY_FATAL_ERROR ("failed to write to multiline buffer");
 
 	ml_pos += s;
 	return;
 } /* ml_append */
 
+#ifdef __clang__
+#pragma clang diagnostic pop
+#endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/logfile.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/logfile.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/logfile.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/logfile.c	2016-09-11 16:10:25.263038721 +0800
@@ -24,17 +24,16 @@
  * Authors:
  *   Sebastian Harl <sh at tokkee.org>
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
-#include <pthread.h>
-
 #define DEFAULT_LOGFILE LOCALSTATEDIR"/log/collectd.log"
 
 #if COLLECT_DEBUG
 static int log_level = LOG_DEBUG;
 #else
 static int log_level = LOG_INFO;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/log_logstash.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/log_logstash.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/log_logstash.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/log_logstash.c	2016-09-11 16:10:25.263038721 +0800
@@ -24,17 +24,17 @@
  *   Pierre-Yves Ritschard <pyr at spootnik.org>
  * Acknowledgements:
  *   This file is largely inspired by logfile.c
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
 #include <sys/types.h>
-#include <pthread.h>
 #include <yajl/yajl_common.h>
 #include <yajl/yajl_gen.h>
 #if HAVE_YAJL_YAJL_VERSION_H
 # include <yajl/yajl_version.h>
 #endif
 #if defined(YAJL_MAJOR) && (YAJL_MAJOR > 1)
@@ -62,18 +62,18 @@
 
 static int log_logstash_config (const char *key, const char *value)
 {
 
 	if (0 == strcasecmp (key, "LogLevel")) {
 		log_level = parse_log_severity(value);
-        if (log_level < 0) {
-            log_level = LOG_INFO;
-            ERROR("log_logstash: invalid loglevel [%s] defaulting to 'info'",
-                  value);
-            return 1;
-        }
+		if (log_level < 0) {
+			log_level = LOG_INFO;
+			ERROR("log_logstash: invalid loglevel [%s] defaulting to 'info'",
+				value);
+			return 1;
+		}
 	}
 	else if (0 == strcasecmp (key, "File")) {
 		sfree (log_file);
 		log_file = strdup (value);
 	}
 	else {
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: lua.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/madwifi.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/madwifi.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/madwifi.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/madwifi.c	2016-09-11 16:10:25.263038721 +0800
@@ -20,13 +20,13 @@
  *
  *   based on some code from interfaces.c (collectd) and Madwifi driver
  **/
 
 
 /**
- * There are several data streams provided by Madwifi plugin, some are 
+ * There are several data streams provided by Madwifi plugin, some are
  * connected to network interface, some are connected to each node
  * associated to that interface. Nodes represents other sides in
  * wireless communication, for example on network interface in AP mode,
  * there is one node for each associated station. Node data streams
  * contain MAC address of the node as the last part  of the type_instance
  * field.
@@ -39,24 +39,24 @@
  *	node_octets	RX and TX data count (octets/bytes)
  *	node_rssi	Received RSSI of the node
  *	node_tx_rate	Reported TX rate to that node
  *	node_stat	Node statistic counters
  *
  * Both statistic counters have type instances for each counter returned
- * by Madwifi. See madwifi.h for content of ieee80211_nodestats, 
+ * by Madwifi. See madwifi.h for content of ieee80211_nodestats,
  * ieee80211_stats and ath_stats structures. Type instances use the same
  * name as fields in these structures (like ns_rx_dup). Some fields are
  * not reported, because they are not counters (like ns_tx_deauth_code
  * or ast_tx_rssi). Fields ns_rx_bytes and ns_tx_bytes are reported as
  * node_octets data stream instead of type instance of node_stat.
  * Statistics are not logged when they are zero.
- * 
+ *
  * There are two sets of these counters - the first 'WatchList' is a
  * set of counters that are individually logged. The second 'MiscList'
  * is a set of counters that are summed together and the sum is logged.
- * By default, the most important statistics are in the WatchList and 
+ * By default, the most important statistics are in the WatchList and
  * many error statistics are in MiscList. There are also many statistics
  * that are not in any of these sets, so they are not monitored by default.
  * It is possible to alter these lists using configuration options:
  *
  *	WatchAdd X	Adds X to WachList
  *	WatchRemove X	Removes X from WachList
@@ -86,20 +86,19 @@
  * Therefore, the /proc filesystem should always be used together with option
  * `Interface', to limit found interfaces to madwifi interfaces only.
  **/
 
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 
 #include <dirent.h>
 #include <sys/ioctl.h>
-#include <sys/socket.h>
 
 #if !KERNEL_LINUX
 # error "No applicable input method."
 #endif
 
 #include <linux/wireless.h>
@@ -365,51 +364,49 @@
 static int use_sysfs = 1;
 static int init_state = 0;
 
 static inline int item_watched(int i)
 {
 	assert (i >= 0);
-	assert (i < ((STATIC_ARRAY_SIZE (watch_items) + 1) * 32));
+	assert ((size_t) i < (STATIC_ARRAY_SIZE (watch_items) * 32));
 	return watch_items[i / 32] & FLAG (i);
 }
 
 static inline int item_summed(int i)
 {
 	assert (i >= 0);
-	assert (i < ((STATIC_ARRAY_SIZE (misc_items) + 1) * 32));
+	assert ((size_t) i < (STATIC_ARRAY_SIZE (misc_items) * 32));
 	return misc_items[i / 32] & FLAG (i);
 }
 
 static inline void watchlist_add (uint32_t *wl, int item)
 {
 	assert (item >= 0);
-	assert (item < ((WL_LEN + 1) * 32));
+	assert (item < WL_LEN * 32);
 	wl[item / 32] |= FLAG (item);
 }
 
 static inline void watchlist_remove (uint32_t *wl, int item)
 {
 	assert (item >= 0);
-	assert (item < ((WL_LEN + 1) * 32));
+	assert (item < WL_LEN * 32);
 	wl[item / 32] &= ~FLAG (item);
 }
 
 static inline void watchlist_set (uint32_t *wl, uint32_t val)
 {
-	int i;
-	for (i = 0; i < WL_LEN; i++)
+	for (int i = 0; i < WL_LEN; i++)
 		wl[i] = val;
 }
 
 /* This is horribly inefficient, but it is called only during configuration */
 static int watchitem_find (const char *name)
 {
 	int max = STATIC_ARRAY_SIZE (specs);
-	int i;
 
-	for (i = 0; i < max; i++)
+	for (int i = 0; i < max; i++)
 		if (strcasecmp (name, specs[i].name) == 0)
 			return i;
 
 	return -1;
 }
 
@@ -417,33 +414,32 @@
 /* Collectd hooks */
 
 /* We need init function called before madwifi_config */
 
 static int madwifi_real_init (void)
 {
-	int max = STATIC_ARRAY_SIZE (specs);
-	int i;
+	size_t max = STATIC_ARRAY_SIZE (specs);
 
-	for (i = 0; i < STATIC_ARRAY_SIZE (bounds); i++)
+	for (size_t i = 0; i < STATIC_ARRAY_SIZE (bounds); i++)
 		bounds[i] = 0;
 
 	watchlist_set(watch_items, 0);
 	watchlist_set(misc_items, 0);
 
-	for (i = 0; i < max; i++)
+	for (size_t i = 0; i < max; i++)
 	{
 		bounds[specs[i].flags & SRC_MASK] = i;
 
 		if (specs[i].flags & LOG)
 			watch_items[i / 32] |= FLAG (i);
 
 		if (specs[i].flags & SU)
 			misc_items[i / 32] |= FLAG (i);
 	}
 
-	for (i = 0; i < STATIC_ARRAY_SIZE (bounds); i++)
+	for (size_t i = 0; i < STATIC_ARRAY_SIZE (bounds); i++)
 		bounds[i]++;
 
 	return (0);
 }
 
 static int madwifi_config (const char *key, const char *value)
@@ -587,15 +583,14 @@
 }
 
 static void submit_antx (const char *dev, const char *name,
 		u_int32_t *vals, int vals_num)
 {
 	char ti2[16];
-	int i;
 
-	for (i = 0; i < vals_num; i++)
+	for (int i = 0; i < vals_num; i++)
 	{
 		if (vals[i] == 0)
 			continue;
 
 		ssnprintf (ti2, sizeof (ti2), "%i", i);
 		submit_derive (dev, "ath_stat", name, ti2,
@@ -612,28 +607,27 @@
 
 static void
 process_stat_struct (int which, const void *ptr, const char *dev, const char *mac,
 			 const char *type_name, const char *misc_name)
 {
 	uint32_t misc = 0;
-	int i;
 
 	assert (which >= 1);
-	assert (which < STATIC_ARRAY_SIZE (bounds));
+	assert (((size_t) which) < STATIC_ARRAY_SIZE (bounds));
 
-	for (i = bounds[which - 1]; i < bounds[which]; i++)
+	for (int i = bounds[which - 1]; i < bounds[which]; i++)
 	{
 		uint32_t val = *(uint32_t *)(((char *) ptr) + specs[i].offset) ;
 
 		if (item_watched (i) && (val != 0))
 			submit_derive (dev, type_name, specs[i].name, mac, val);
 
 		if (item_summed (i))
 			misc += val;
 	}
-	
+
 	if (misc != 0)
 		submit_derive (dev, type_name, misc_name, mac, misc);
 
 }
 
 static int
@@ -697,13 +691,12 @@
 }
 
 
 static int
 process_station (int sk, const char *dev, struct ieee80211req_sta_info *si)
 {
-	struct iwreq iwr;
 	static char mac[DATA_MAX_NAME_LEN];
 	struct ieee80211req_sta_stats stats;
 	const struct ieee80211_nodestats *ns = &stats.is_stats;
 	int status;
 
 	macaddr_to_str (mac, sizeof (mac), si->isi_macaddr);
@@ -712,16 +705,18 @@
 		submit_gauge (dev, "node_tx_rate", mac, NULL,
 			(si->isi_rates[si->isi_txrate] & IEEE80211_RATE_VAL) / 2);
 
 	if (item_watched (STAT_NODE_RSSI))
 		submit_gauge (dev, "node_rssi", mac, NULL, si->isi_rssi);
 
-	memset (&iwr, 0, sizeof (iwr));
+	struct iwreq iwr = {
+		.u.data.pointer = (void *) &stats,
+		.u.data.length = sizeof (stats)
+	};
 	sstrncpy(iwr.ifr_name, dev, sizeof (iwr.ifr_name));
-	iwr.u.data.pointer = (void *) &stats;
-	iwr.u.data.length = sizeof (stats);
+
 	memcpy(stats.is_u.macaddr, si->isi_macaddr, IEEE80211_ADDR_LEN);
 	status = ioctl(sk, IEEE80211_IOCTL_STA_STATS, &iwr);
 	if (status < 0)
 	{
 		/* Silent, because not all interfaces support all ioctls. */
 		DEBUG ("madwifi plugin: Sending IO-control "
@@ -748,22 +743,23 @@
 	return (0);
 }
 
 static int
 process_stations (int sk, const char *dev)
 {
-	uint8_t buf[24*1024];
-	struct iwreq iwr;
+	uint8_t buf[24*1024] = { 0 };
 	uint8_t *cp;
-	int len, nodes;
+	int nodes;
+	size_t len;
 	int status;
 
-	memset (&iwr, 0, sizeof (iwr));
+	struct iwreq iwr = {
+		.u.data.pointer = (void *) buf,
+		.u.data.length = sizeof (buf)
+	};
 	sstrncpy (iwr.ifr_name, dev, sizeof (iwr.ifr_name));
-	iwr.u.data.pointer = (void *) buf;
-	iwr.u.data.length = sizeof (buf);
 
 	status = ioctl (sk, IEEE80211_IOCTL_STA_INFO, &iwr);
 	if (status < 0)
 	{
 		/* Silent, because not all interfaces support all ioctls. */
 		DEBUG ("madwifi plugin: Sending IO-control "
@@ -888,13 +884,13 @@
 	char buffer[1024];
 	char *device, *dummy;
 	FILE *fh;
 	int status;
 	int num_success;
 	int num_fail;
-	
+
 	if ((fh = fopen ("/proc/net/dev", "r")) == NULL)
 	{
 		WARNING ("madwifi plugin: opening /proc/net/dev failed");
 		return (-1);
 	}
 
@@ -950,13 +946,13 @@
 	if (sk < 0)
 		return (-1);
 
 
 /* procfs iteration is not safe because it does not check whether given
    interface is madwifi interface and there are private ioctls used, which
-   may do something completely different on non-madwifi devices.   
+   may do something completely different on non-madwifi devices.
    Therefore, it is not used unless explicitly enabled (and should be used
    together with ignorelist). */
 
 	if (use_sysfs)
 		rv = sysfs_iterate(sk);
 	else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/Makefile.am	2016-11-29 00:08:22.391470301 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/Makefile.am	2016-09-11 16:10:25.251038738 +0800
@@ -3,94 +3,149 @@
 SUBDIRS += liboconfig
 endif
 SUBDIRS += daemon
 
 PLUGIN_LDFLAGS = -module -avoid-version -export-symbols-regex '\<module_register\>'
 
-if COMPILER_IS_GCC
-AM_CFLAGS = -Wall -Werror
-endif
-
 AM_CPPFLAGS = -I$(srcdir)/daemon
 AM_CPPFLAGS += -DPREFIX='"${prefix}"'
 AM_CPPFLAGS += -DCONFIGFILE='"${sysconfdir}/${PACKAGE_NAME}.conf"'
 AM_CPPFLAGS += -DLOCALSTATEDIR='"${localstatedir}"'
 AM_CPPFLAGS += -DPKGLOCALSTATEDIR='"${localstatedir}/lib/${PACKAGE_NAME}"'
 if BUILD_FEATURE_DAEMON
 AM_CPPFLAGS += -DPIDFILE='"${localstatedir}/run/${PACKAGE_NAME}.pid"'
 endif
 AM_CPPFLAGS += -DPLUGINDIR='"${pkglibdir}"'
 AM_CPPFLAGS += -DPKGDATADIR='"${pkgdatadir}"'
 
-AUTOMAKE_OPTIONS = subdir-objects
+LOG_COMPILER = env VALGRIND="@VALGRIND@" $(abs_top_srcdir)/testwrapper.sh
 
-noinst_LTLIBRARIES = libmount.la liblookup.la
-
-libmount_la_SOURCES = utils_mount.c utils_mount.h
-libmount_la_LIBADD = daemon/libcommon.la
+V_PROTOC = $(v_protoc_@AM_V@)
+v_protoc_ = $(v_protoc_@AM_DEFAULT_V@)
+v_protoc_0 = @echo "  PROTOC  " $@;
+
+noinst_LTLIBRARIES =
+check_PROGRAMS =
+TESTS =
+
+noinst_LTLIBRARIES += libformat_json.la
+libformat_json_la_SOURCES   = utils_format_json.c utils_format_json.h
+libformat_json_la_CPPFLAGS  = $(AM_CPPFLAGS)
+libformat_json_la_LDFLAGS   = $(AM_LDFLAGS)
+libformat_json_la_LIBADD    =
+if BUILD_WITH_LIBYAJL
+libformat_json_la_CPPFLAGS += $(BUILD_WITH_LIBYAJL_CPPFLAGS)
+libformat_json_la_LDFLAGS  += $(BUILD_WITH_LIBYAJL_LDFLAGS)
+libformat_json_la_LIBADD   += $(BUILD_WITH_LIBYAJL_LIBS)
+check_PROGRAMS += test_format_json
+TESTS += test_format_json
+test_format_json_SOURCES = utils_format_json_test.c testing.h
+test_format_json_LDADD = libformat_json.la daemon/libmetadata.la daemon/libplugin_mock.la -lm
+endif
+
+noinst_LTLIBRARIES += liblatency.la
+liblatency_la_SOURCES = utils_latency.c utils_latency.h
+check_PROGRAMS += test_utils_latency
+TESTS += test_utils_latency
+test_utils_latency_SOURCES = utils_latency_test.c testing.h
+test_utils_latency_LDADD = liblatency.la daemon/libplugin_mock.la -lm
 
+noinst_LTLIBRARIES += liblookup.la
 liblookup_la_SOURCES = utils_vl_lookup.c utils_vl_lookup.h
-liblookup_la_LIBADD = daemon/libavltree.la daemon/libcommon.la
+liblookup_la_LIBADD = daemon/libavltree.la
+check_PROGRAMS += test_utils_vl_lookup
+TESTS += test_utils_vl_lookup
+test_utils_vl_lookup_SOURCES = utils_vl_lookup_test.c testing.h
+test_utils_vl_lookup_LDADD = liblookup.la daemon/libplugin_mock.la
+if BUILD_WITH_LIBKSTAT
+test_utils_vl_lookup_LDADD += -lkstat
+endif
+
+noinst_LTLIBRARIES += libmount.la
+libmount_la_SOURCES = utils_mount.c utils_mount.h
+check_PROGRAMS += test_utils_mount
+TESTS += test_utils_mount
+test_utils_mount_SOURCES = utils_mount_test.c testing.h
+test_utils_mount_LDADD = libmount.la daemon/libplugin_mock.la
+if BUILD_WITH_LIBKSTAT
+test_utils_mount_LDADD += -lkstat
+endif
 
 sbin_PROGRAMS = collectdmon
 bin_PROGRAMS = collectd-nagios collectdctl collectd-tg
 
 collectdmon_SOURCES = collectdmon.c
-collectdmon_CPPFLAGS = $(AM_CPPFLAGS)
 
 collectd_nagios_SOURCES = collectd-nagios.c
-collectd_nagios_CPPFLAGS = $(AM_CPPFLAGS) -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
-collectd_nagios_LDADD =
+collectd_nagios_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
+collectd_nagios_LDADD = libcollectdclient/libcollectdclient.la
 if BUILD_WITH_LIBSOCKET
 collectd_nagios_LDADD += -lsocket
 endif
 if BUILD_AIX
 collectd_nagios_LDADD += -lm
 endif
 
-collectd_nagios_LDADD += libcollectdclient/libcollectdclient.la
-collectd_nagios_DEPENDENCIES = libcollectdclient/libcollectdclient.la
-
 
 collectdctl_SOURCES = collectdctl.c
-collectdctl_CPPFLAGS = $(AM_CPPFLAGS) -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
-collectdctl_LDADD =
+collectdctl_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
+collectdctl_LDADD = libcollectdclient/libcollectdclient.la
 if BUILD_WITH_LIBSOCKET
 collectdctl_LDADD += -lsocket
 endif
 if BUILD_AIX
 collectdctl_LDADD += -lm
 endif
-collectdctl_LDADD += libcollectdclient/libcollectdclient.la
-collectdctl_DEPENDENCIES = libcollectdclient/libcollectdclient.la
+
 
 collectd_tg_SOURCES = collectd-tg.c
 collectd_tg_CPPFLAGS = $(AM_CPPFLAGS) \
-		       -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
-collectd_tg_LDADD = daemon/libheap.la
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
+collectd_tg_LDADD = \
+	$(PTHREAD_LIBS) \
+	daemon/libheap.la \
+	libcollectdclient/libcollectdclient.la
 if BUILD_WITH_LIBSOCKET
 collectd_tg_LDADD += -lsocket
 endif
 if BUILD_WITH_LIBRT
 collectd_tg_LDADD += -lrt
 endif
 if BUILD_AIX
 collectd_tg_LDADD += -lm
 endif
-if BUILD_WITH_LIBPTHREAD
-collectd_tg_LDADD += -lpthread
-endif
-collectd_tg_LDADD += libcollectdclient/libcollectdclient.la
-collectd_tg_DEPENDENCIES = libcollectdclient/libcollectdclient.la
 
 
 pkglib_LTLIBRARIES =
 
 BUILT_SOURCES =
 CLEANFILES =
 
+if HAVE_PROTOC3
+if HAVE_GRPC_CPP
+BUILT_SOURCES += collectd.grpc.pb.cc collectd.pb.cc types.pb.cc
+CLEANFILES += collectd.grpc.pb.cc collectd.pb.cc types.pb.cc \
+		collectd.grpc.pb.h collectd.pb.h types.pb.h
+
+collectd.grpc.pb.cc: $(top_srcdir)/proto/collectd.proto $(top_srcdir)/proto/types.proto
+	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto \
+		--grpc_out=$(builddir) --plugin=protoc-gen-grpc=$(GRPC_CPP_PLUGIN) $<
+
+collectd.pb.cc: $(top_srcdir)/proto/collectd.proto $(top_srcdir)/proto/types.proto
+	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto --cpp_out=$(builddir) $<
+
+types.pb.cc: $(top_srcdir)/proto/types.proto
+	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto --cpp_out=$(builddir) $<
+endif
+endif
+
 if BUILD_PLUGIN_AGGREGATION
 pkglib_LTLIBRARIES += aggregation.la
 aggregation_la_SOURCES = aggregation.c \
                          utils_vl_lookup.c utils_vl_lookup.h
 aggregation_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 aggregation_la_LIBADD = -lm
@@ -98,31 +153,27 @@
 
 if BUILD_PLUGIN_AMQP
 pkglib_LTLIBRARIES += amqp.la
 amqp_la_SOURCES = amqp.c \
 		  utils_cmd_putval.c utils_cmd_putval.h \
   	          utils_parse_option.c utils_parse_option.h \
-		  utils_format_graphite.c utils_format_graphite.h \
-		  utils_format_json.c utils_format_json.h
+		  utils_format_graphite.c utils_format_graphite.h
 amqp_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBRABBITMQ_LDFLAGS)
 amqp_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBRABBITMQ_CPPFLAGS)
-amqp_la_LIBADD = $(BUILD_WITH_LIBRABBITMQ_LIBS)
+amqp_la_LIBADD = $(BUILD_WITH_LIBRABBITMQ_LIBS) libformat_json.la
 endif
 
 if BUILD_PLUGIN_APACHE
 pkglib_LTLIBRARIES += apache.la
 apache_la_SOURCES = apache.c
 apache_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-apache_la_CFLAGS = $(AM_CFLAGS)
-apache_la_LIBADD =
-if BUILD_WITH_LIBCURL
-apache_la_CFLAGS += $(BUILD_WITH_LIBCURL_CFLAGS)
-apache_la_LIBADD += $(BUILD_WITH_LIBCURL_LIBS)
-endif
+apache_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+apache_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
 endif
 
+
 if BUILD_PLUGIN_APCUPS
 pkglib_LTLIBRARIES += apcups.la
 apcups_la_SOURCES = apcups.c
 apcups_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 apcups_la_LIBADD =
 if BUILD_WITH_LIBSOCKET
@@ -130,22 +181,21 @@
 endif
 endif
 
 if BUILD_PLUGIN_APPLE_SENSORS
 pkglib_LTLIBRARIES += apple_sensors.la
 apple_sensors_la_SOURCES = apple_sensors.c
-apple_sensors_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-apple_sensors_la_LDFLAGS += -framework IOKit
+apple_sensors_la_LDFLAGS = $(PLUGIN_LDFLAGS) -framework IOKit
 endif
 
 if BUILD_PLUGIN_AQUAERO
 pkglib_LTLIBRARIES += aquaero.la
 aquaero_la_SOURCES = aquaero.c
-aquaero_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 aquaero_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBAQUAERO5_CFLAGS)
-aquaero_la_LIBADD = $(BUILD_WITH_LIBAQUAERO5_LDFLAGS) -laquaero5
+aquaero_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBAQUAERO5_LDFLAGS)
+aquaero_la_LIBADD = -laquaero5
 endif
 
 if BUILD_PLUGIN_ASCENT
 pkglib_LTLIBRARIES += ascent.la
 ascent_la_SOURCES = ascent.c
 ascent_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -162,13 +212,12 @@
 endif
 
 if BUILD_PLUGIN_BATTERY
 pkglib_LTLIBRARIES += battery.la
 battery_la_SOURCES = battery.c
 battery_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-battery_la_LIBADD =
 if BUILD_WITH_LIBIOKIT
 battery_la_LDFLAGS += -framework IOKit
 endif
 endif
 
 if BUILD_PLUGIN_BIND
@@ -193,12 +242,18 @@
 pkglib_LTLIBRARIES += cgroups.la
 cgroups_la_SOURCES = cgroups.c
 cgroups_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 cgroups_la_LIBADD = libmount.la
 endif
 
+if BUILD_PLUGIN_CHRONY
+pkglib_LTLIBRARIES += chrony.la
+chrony_la_SOURCES = chrony.c
+chrony_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+endif
+
 if BUILD_PLUGIN_CONNTRACK
 pkglib_LTLIBRARIES += conntrack.la
 conntrack_la_SOURCES = conntrack.c
 conntrack_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
@@ -236,46 +291,47 @@
 if BUILD_PLUGIN_CPUFREQ
 pkglib_LTLIBRARIES += cpufreq.la
 cpufreq_la_SOURCES = cpufreq.c
 cpufreq_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
+if BUILD_PLUGIN_CPUSLEEP
+pkglib_LTLIBRARIES += cpusleep.la
+cpusleep_la_SOURCES = cpusleep.c
+cpusleep_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+endif
+
 if BUILD_PLUGIN_CSV
 pkglib_LTLIBRARIES += csv.la
 csv_la_SOURCES = csv.c
 csv_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_CURL
 pkglib_LTLIBRARIES += curl.la
-curl_la_SOURCES = curl.c
+curl_la_SOURCES = curl.c \
+		  utils_curl_stats.c utils_curl_stats.h
 curl_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-curl_la_CFLAGS = $(AM_CFLAGS)
-curl_la_LIBADD =
-if BUILD_WITH_LIBCURL
-curl_la_CFLAGS += $(BUILD_WITH_LIBCURL_CFLAGS)
-curl_la_LIBADD += $(BUILD_WITH_LIBCURL_LIBS)
-endif
+curl_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+curl_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
 endif
 
 if BUILD_PLUGIN_CURL_JSON
 pkglib_LTLIBRARIES += curl_json.la
-curl_json_la_SOURCES = curl_json.c
-curl_json_la_CFLAGS = $(AM_CFLAGS)
-curl_json_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
+curl_json_la_SOURCES = curl_json.c \
+		  utils_curl_stats.c utils_curl_stats.h
+curl_json_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
 curl_json_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
-curl_json_la_LIBADD = $(BUILD_WITH_LIBYAJL_LIBS)
-if BUILD_WITH_LIBCURL
-curl_json_la_CFLAGS += $(BUILD_WITH_LIBCURL_CFLAGS)
-curl_json_la_LIBADD += $(BUILD_WITH_LIBCURL_LIBS)
-endif
+curl_json_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
+curl_json_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBYAJL_LIBS)
 endif
 
 if BUILD_PLUGIN_CURL_XML
 pkglib_LTLIBRARIES += curl_xml.la
-curl_xml_la_SOURCES = curl_xml.c
+curl_xml_la_SOURCES = curl_xml.c \
+		  utils_curl_stats.c utils_curl_stats.h
 curl_xml_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 curl_xml_la_CFLAGS = $(AM_CFLAGS) \
 		$(BUILD_WITH_LIBCURL_CFLAGS) $(BUILD_WITH_LIBXML2_CFLAGS)
 curl_xml_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBXML2_LIBS)
 endif
 
@@ -316,36 +372,37 @@
 endif
 if BUILD_WITH_LIBUDEV
 disk_la_CFLAGS += $(BUILD_WITH_LIBUDEV_CFLAGS)
 disk_la_LDFLAGS += $(BUILD_WITH_LIBUDEV_LDFLAGS)
 disk_la_LIBADD += $(BUILD_WITH_LIBUDEV_LIBS)
 endif
+if BUILD_FREEBSD
+disk_la_LIBADD += -ldevstat -lgeom
+endif
 if BUILD_WITH_PERFSTAT
 disk_la_LIBADD += -lperfstat
 endif
 endif
 
 if BUILD_PLUGIN_DNS
 pkglib_LTLIBRARIES += dns.la
 dns_la_SOURCES = dns.c utils_dns.c utils_dns.h
 dns_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-dns_la_LIBADD = -lpcap -lpthread
+dns_la_LIBADD = -lpcap
 endif
 
 if BUILD_PLUGIN_DRBD
 pkglib_LTLIBRARIES += drbd.la
 drbd_la_SOURCES = drbd.c
 drbd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-drbd_la_LIBADD = -lpthread
 endif
 
 if BUILD_PLUGIN_EMAIL
 pkglib_LTLIBRARIES += email.la
 email_la_SOURCES = email.c
 email_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-email_la_LIBADD = -lpthread
 endif
 
 if BUILD_PLUGIN_ENTROPY
 pkglib_LTLIBRARIES += entropy.la
 entropy_la_SOURCES = entropy.c
 entropy_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -355,13 +412,12 @@
 pkglib_LTLIBRARIES += exec.la
 exec_la_SOURCES = exec.c \
 		  utils_cmd_putnotif.c utils_cmd_putnotif.h \
 		  utils_cmd_putval.c utils_cmd_putval.h \
 		  utils_parse_option.h utils_parse_option.c
 exec_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-exec_la_LIBADD = -lpthread
 endif
 
 if BUILD_PLUGIN_ETHSTAT
 pkglib_LTLIBRARIES += ethstat.la
 ethstat_la_SOURCES = ethstat.c
 ethstat_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -384,12 +440,29 @@
 gmond_la_SOURCES = gmond.c
 gmond_la_CPPFLAGS = $(AM_CPPFLAGS) $(GANGLIA_CPPFLAGS)
 gmond_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(GANGLIA_LDFLAGS)
 gmond_la_LIBADD = $(GANGLIA_LIBS)
 endif
 
+if BUILD_PLUGIN_GPS
+pkglib_LTLIBRARIES += gps.la
+gps_la_SOURCES = gps.c
+gps_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBGPS_CFLAGS)
+gps_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBGPS_LDFLAGS)
+gps_la_LIBADD = -lpthread $(BUILD_WITH_LIBGPS_LIBS)
+endif
+
+if BUILD_PLUGIN_GRPC
+pkglib_LTLIBRARIES += grpc.la
+grpc_la_SOURCES = grpc.cc
+nodist_grpc_la_SOURCES = collectd.grpc.pb.cc collectd.pb.cc types.pb.cc
+grpc_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBGRPCPP_CPPFLAGS) $(BUILD_WITH_LIBPROTOBUF_CPPFLAGS)
+grpc_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBGRPCPP_LDFLAGS) $(BUILD_WITH_LIBPROTOBUF_LDFLAGS)
+grpc_la_LIBADD = $(BUILD_WITH_LIBGRPCPP_LIBS) $(BUILD_WITH_LIBPROTOBUF_LIBS)
+endif
+
 if BUILD_PLUGIN_HDDTEMP
 pkglib_LTLIBRARIES += hddtemp.la
 hddtemp_la_SOURCES = hddtemp.c
 hddtemp_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 hddtemp_la_LIBADD =
 if BUILD_WITH_LIBSOCKET
@@ -419,13 +492,12 @@
 endif
 endif # BUILD_PLUGIN_INTERFACE
 
 if BUILD_PLUGIN_IPC
 pkglib_LTLIBRARIES += ipc.la
 ipc_la_SOURCES = ipc.c
-ipc_la_CFLAGS = $(AM_CFLAGS)
 ipc_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_IPTABLES
 pkglib_LTLIBRARIES += iptables.la
 iptables_la_SOURCES = iptables.c
@@ -442,14 +514,15 @@
 ipmi_la_LIBADD = $(BUILD_WITH_OPENIPMI_LIBS)
 endif
 
 if BUILD_PLUGIN_IPVS
 pkglib_LTLIBRARIES += ipvs.la
 ipvs_la_SOURCES = ipvs.c
+ipvs_la_CFLAGS = $(AM_CFLAGS)
 if IP_VS_H_NEEDS_KERNEL_CFLAGS
-ipvs_la_CFLAGS = $(AM_CFLAGS) $(KERNEL_CFLAGS)
+ipvs_la_CFLAGS += $(KERNEL_CFLAGS)
 endif
 ipvs_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_IRQ
 pkglib_LTLIBRARIES += irq.la
@@ -487,29 +560,38 @@
 logfile_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_LOG_LOGSTASH
 pkglib_LTLIBRARIES += log_logstash.la
 log_logstash_la_SOURCES = log_logstash.c
-log_logstash_la_CFLAGS = $(AM_CFLAGS)
 log_logstash_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
 log_logstash_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
 log_logstash_la_LIBADD = $(BUILD_WITH_LIBYAJL_LIBS)
 endif
 
 if BUILD_PLUGIN_LPAR
 pkglib_LTLIBRARIES += lpar.la
 lpar_la_SOURCES = lpar.c
 lpar_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 lpar_la_LIBADD = -lperfstat
 endif
 
+if BUILD_PLUGIN_LUA
+pkglib_LTLIBRARIES += lua.la
+lua_la_SOURCES = lua.c \
+		 utils_lua.c utils_lua.h
+lua_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBLUA_CFLAGS)
+lua_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+lua_la_LIBADD = $(BUILD_WITH_LIBLUA_LIBS)
+endif
+
 if BUILD_PLUGIN_LVM
 pkglib_LTLIBRARIES += lvm.la
 lvm_la_SOURCES = lvm.c
-lvm_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+lvm_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBLVM2APP_CPPFLAGS)
+lvm_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBLVM2APP_LDFLAGS)
 lvm_la_LIBADD = $(BUILD_WITH_LIBLVM2APP_LIBS)
 endif
 
 if BUILD_PLUGIN_MADWIFI
 pkglib_LTLIBRARIES += madwifi.la
 madwifi_la_SOURCES = madwifi.c madwifi.h
@@ -614,28 +696,32 @@
 modbus_la_SOURCES = modbus.c
 modbus_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 modbus_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBMODBUS_CFLAGS)
 modbus_la_LIBADD = $(BUILD_WITH_LIBMODBUS_LIBS)
 endif
 
+if BUILD_PLUGIN_MQTT
+pkglib_LTLIBRARIES += mqtt.la
+mqtt_la_SOURCES = mqtt.c
+mqtt_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBMOSQUITTO_CPPFLAGS)
+mqtt_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBMOSQUITTO_LDFLAGS)
+mqtt_la_LIBADD = $(BUILD_WITH_LIBMOSQUITTO_LIBS)
+endif
+
 if BUILD_PLUGIN_MULTIMETER
 pkglib_LTLIBRARIES += multimeter.la
 multimeter_la_SOURCES = multimeter.c
 multimeter_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_MYSQL
 pkglib_LTLIBRARIES += mysql.la
 mysql_la_SOURCES = mysql.c
+mysql_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBMYSQL_CFLAGS)
 mysql_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-mysql_la_CFLAGS = $(AM_CFLAGS)
-mysql_la_LIBADD =
-if BUILD_WITH_LIBMYSQL
-mysql_la_CFLAGS += $(BUILD_WITH_LIBMYSQL_CFLAGS)
-mysql_la_LIBADD += $(BUILD_WITH_LIBMYSQL_LIBS)
-endif
+mysql_la_LIBADD = $(BUILD_WITH_LIBMYSQL_LIBS)
 endif
 
 if BUILD_PLUGIN_NETAPP
 pkglib_LTLIBRARIES += netapp.la
 netapp_la_SOURCES = netapp.c
 netapp_la_CPPFLAGS = $(AM_CPPFLAGS) $(LIBNETAPP_CPPFLAGS)
@@ -654,13 +740,13 @@
 if BUILD_PLUGIN_NETWORK
 pkglib_LTLIBRARIES += network.la
 network_la_SOURCES = network.c network.h \
 		     utils_fbhash.c utils_fbhash.h
 network_la_CPPFLAGS = $(AM_CPPFLAGS)
 network_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-network_la_LIBADD = -lpthread
+network_la_LIBADD =
 if BUILD_WITH_LIBSOCKET
 network_la_LIBADD += -lsocket
 endif
 if BUILD_WITH_LIBGCRYPT
 network_la_CPPFLAGS += $(GCRYPT_CPPFLAGS)
 network_la_LDFLAGS += $(GCRYPT_LDFLAGS)
@@ -680,19 +766,15 @@
 fscache_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_NGINX
 pkglib_LTLIBRARIES += nginx.la
 nginx_la_SOURCES = nginx.c
-nginx_la_CFLAGS = $(AM_CFLAGS)
-nginx_la_LIBADD =
+nginx_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
 nginx_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-if BUILD_WITH_LIBCURL
-nginx_la_CFLAGS += $(BUILD_WITH_LIBCURL_CFLAGS)
-nginx_la_LIBADD += $(BUILD_WITH_LIBCURL_LIBS)
-endif
+nginx_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
 endif
 
 if BUILD_PLUGIN_NOTIFY_DESKTOP
 pkglib_LTLIBRARIES += notify_desktop.la
 notify_desktop_la_SOURCES = notify_desktop.c
 notify_desktop_la_CFLAGS = $(AM_CFLAGS) $(LIBNOTIFY_CFLAGS)
@@ -701,13 +783,19 @@
 endif
 
 if BUILD_PLUGIN_NOTIFY_EMAIL
 pkglib_LTLIBRARIES += notify_email.la
 notify_email_la_SOURCES = notify_email.c
 notify_email_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-notify_email_la_LIBADD = -lesmtp -lssl -lcrypto -lpthread
+notify_email_la_LIBADD = -lesmtp -lssl -lcrypto
+endif
+
+if BUILD_PLUGIN_NOTIFY_NAGIOS
+pkglib_LTLIBRARIES += notify_nagios.la
+notify_nagios_la_SOURCES = notify_nagios.c
+notify_nagios_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_NTPD
 pkglib_LTLIBRARIES += ntpd.la
 ntpd_la_SOURCES = ntpd.c
 ntpd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -725,13 +813,13 @@
 
 if BUILD_PLUGIN_NUT
 pkglib_LTLIBRARIES += nut.la
 nut_la_SOURCES = nut.c
 nut_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBUPSCLIENT_CFLAGS)
 nut_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-nut_la_LIBADD = -lpthread $(BUILD_WITH_LIBUPSCLIENT_LIBS)
+nut_la_LIBADD = $(BUILD_WITH_LIBUPSCLIENT_LIBS)
 endif
 
 if BUILD_PLUGIN_OLSRD
 pkglib_LTLIBRARIES += olsrd.la
 olsrd_la_SOURCES = olsrd.c
 olsrd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -741,49 +829,50 @@
 endif
 endif
 
 if BUILD_PLUGIN_ONEWIRE
 pkglib_LTLIBRARIES += onewire.la
 onewire_la_SOURCES = onewire.c
-onewire_la_CFLAGS = $(AM_CFLAGS)
 onewire_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBOWCAPI_CPPFLAGS)
 onewire_la_LIBADD = $(BUILD_WITH_LIBOWCAPI_LIBS)
-onewire_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+onewire_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBOWCAPI_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_OPENLDAP
 pkglib_LTLIBRARIES += openldap.la
 openldap_la_SOURCES = openldap.c
-openldap_la_LDFLAGS = -module -avoid-version $(BUILD_WITH_LIBLDAP_LDFLAGS)
-openldap_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBLDAP_CPPFLAGS)
+openldap_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBLDAP_CPPFLAGS)
+openldap_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBLDAP_LDFLAGS)
 openldap_la_LIBADD = -lldap
 endif
 
 if BUILD_PLUGIN_OPENVPN
 pkglib_LTLIBRARIES += openvpn.la
 openvpn_la_SOURCES = openvpn.c
-openvpn_la_CFLAGS = $(AM_CFLAGS)
 openvpn_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_ORACLE
 pkglib_LTLIBRARIES += oracle.la
 oracle_la_SOURCES = oracle.c \
 	utils_db_query.c utils_db_query.h
-oracle_la_CFLAGS = $(AM_CFLAGS)
-oracle_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_ORACLE_CFLAGS)
+oracle_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_ORACLE_CPPFLAGS)
 oracle_la_LIBADD = $(BUILD_WITH_ORACLE_LIBS)
 oracle_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_PERL
 pkglib_LTLIBRARIES += perl.la
 perl_la_SOURCES = perl.c
 # Despite C99 providing the "bool" type thru stdbool.h, Perl defines its own
 # version of that type if HAS_BOOL is not defined... *sigh*
 perl_la_CPPFLAGS = $(AM_CPPFLAGS) -DHAS_BOOL=1
+# Despite off_t being 64 bit wide on 64 bit platforms, Perl insist on using
+# off64_t which is only exposed when _LARGEFILE64_SOURCE is defined... *sigh*
+# On older platforms we also need _REENTRANT. _GNU_SOURCE sets both of these.
+perl_la_CPPFLAGS += -D_GNU_SOURCE
 perl_la_CFLAGS  = $(AM_CFLAGS) \
 		$(PERL_CFLAGS) \
 		-DXS_VERSION=\"$(VERSION)\" -DVERSION=\"$(VERSION)\"
 # Work-around for issues #41 and #42 - Perl 5.10 incorrectly introduced
 # __attribute__nonnull__(3) for Perl_load_module().
 if HAVE_BROKEN_PERL_LOAD_MODULE
@@ -801,14 +890,15 @@
 endif
 
 if BUILD_PLUGIN_PINBA
 pkglib_LTLIBRARIES += pinba.la
 pinba_la_SOURCES = pinba.c
 nodist_pinba_la_SOURCES = pinba.pb-c.c pinba.pb-c.h
-pinba_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-pinba_la_LIBADD = -lprotobuf-c
+pinba_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS)
+pinba_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBPROTOBUF_C_LDFLAGS)
+pinba_la_LIBADD = $(BUILD_WITH_LIBPROTOBUF_C_LIBS)
 endif
 
 if BUILD_PLUGIN_PING
 pkglib_LTLIBRARIES += ping.la
 ping_la_SOURCES = ping.c
 ping_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBOPING_CPPFLAGS)
@@ -832,19 +922,17 @@
 powerdns_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_PYTHON
 pkglib_LTLIBRARIES += python.la
 python_la_SOURCES = python.c pyconfig.c pyvalues.c cpython.h
-python_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_PYTHON_CPPFLAGS)
-python_la_CFLAGS = $(AM_CFLAGS)
+python_la_CPPFLAGS = $(AM_CPPFLAGS) $(LIBPYTHON_CPPFLAGS)
 if COMPILER_IS_GCC
-python_la_CFLAGS += -fno-strict-aliasing -Wno-strict-aliasing
+python_la_CPPFLAGS += -fno-strict-aliasing -Wno-strict-aliasing
 endif
-python_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_PYTHON_LDFLAGS)
-python_la_LIBADD = $(BUILD_WITH_PYTHON_LIBS)
+python_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBPYTHON_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_PROCESSES
 pkglib_LTLIBRARIES += processes.la
 processes_la_SOURCES = processes.c
 processes_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -906,15 +994,15 @@
 serial_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_SIGROK
 pkglib_LTLIBRARIES += sigrok.la
 sigrok_la_SOURCES = sigrok.c
-sigrok_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBSIGROK_CFLAGS)
-sigrok_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBSIGROK_LDFLAGS)
-sigrok_la_LIBADD = -lsigrok
+sigrok_la_CFLAGS = $(AM_CFLAGS) $(LIBSIGROK_CFLAGS)
+sigrok_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+sigrok_la_LIBADD = $(LIBSIGROK_LIBS)
 endif
 
 if BUILD_PLUGIN_SMART
 if BUILD_WITH_LIBUDEV
 pkglib_LTLIBRARIES += smart.la
 smart_la_SOURCES = smart.c
@@ -924,30 +1012,22 @@
 endif
 endif
 
 if BUILD_PLUGIN_SNMP
 pkglib_LTLIBRARIES += snmp.la
 snmp_la_SOURCES = snmp.c
-snmp_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-snmp_la_CFLAGS = $(AM_CFLAGS)
-snmp_la_LIBADD =
-if BUILD_WITH_LIBNETSNMP
-snmp_la_CFLAGS += $(BUILD_WITH_LIBSNMP_CFLAGS)
-snmp_la_LIBADD += $(BUILD_WITH_LIBSNMP_LIBS)
-endif
-if BUILD_WITH_LIBPTHREAD
-snmp_la_LIBADD += -lpthread
-endif
+snmp_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBNETSNMP_CPPFLAGS)
+snmp_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBNETSNMP_LDFLAGS)
+snmp_la_LIBADD = $(BUILD_WITH_LIBNETSNMP_LIBS)
 endif
 
 if BUILD_PLUGIN_STATSD
 pkglib_LTLIBRARIES += statsd.la
-statsd_la_SOURCES = statsd.c \
-                    utils_latency.h utils_latency.c
+statsd_la_SOURCES = statsd.c
 statsd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-statsd_la_LIBADD = -lpthread -lm
+statsd_la_LIBADD = liblatency.la -lm
 endif
 
 if BUILD_PLUGIN_SWAP
 pkglib_LTLIBRARIES += swap.la
 swap_la_SOURCES = swap.c
 swap_la_CFLAGS = $(AM_CFLAGS)
@@ -1092,13 +1172,12 @@
 		      utils_cmd_getthreshold.h utils_cmd_getthreshold.c \
 		      utils_cmd_listval.h utils_cmd_listval.c \
 		      utils_cmd_putval.h utils_cmd_putval.c \
 		      utils_cmd_putnotif.h utils_cmd_putnotif.c \
 		      utils_parse_option.h utils_parse_option.c
 unixsock_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-unixsock_la_LIBADD = -lpthread
 endif
 
 if BUILD_PLUGIN_UPTIME
 pkglib_LTLIBRARIES += uptime.la
 uptime_la_SOURCES = uptime.c
 uptime_la_CFLAGS = $(AM_CFLAGS)
@@ -1167,40 +1246,35 @@
 wireless_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 if BUILD_PLUGIN_WRITE_GRAPHITE
 pkglib_LTLIBRARIES += write_graphite.la
 write_graphite_la_SOURCES = write_graphite.c \
-                        utils_format_graphite.c utils_format_graphite.h \
-                        utils_format_json.c utils_format_json.h
+                        utils_format_graphite.c utils_format_graphite.h
 write_graphite_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+write_graphite_la_LIBADD = libformat_json.la
 endif
 
 if BUILD_PLUGIN_WRITE_HTTP
 pkglib_LTLIBRARIES += write_http.la
 write_http_la_SOURCES = write_http.c \
-			utils_format_json.c utils_format_json.h
+			utils_format_kairosdb.c utils_format_kairosdb.h
 write_http_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-write_http_la_CFLAGS = $(AM_CFLAGS)
-write_http_la_LIBADD =
-if BUILD_WITH_LIBCURL
-write_http_la_CFLAGS += $(BUILD_WITH_LIBCURL_CFLAGS)
-write_http_la_LIBADD += $(BUILD_WITH_LIBCURL_LIBS)
-endif
+write_http_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+write_http_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) libformat_json.la
 endif
 
 if BUILD_PLUGIN_WRITE_KAFKA
 pkglib_LTLIBRARIES += write_kafka.la
 write_kafka_la_SOURCES = write_kafka.c \
                         utils_format_graphite.c utils_format_graphite.h \
-                        utils_format_json.c utils_format_json.h \
                         utils_cmd_putval.c utils_cmd_putval.h \
                         utils_crc32.c utils_crc32.h
 write_kafka_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBRDKAFKA_CPPFLAGS)
 write_kafka_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBRDKAFKA_LDFLAGS)
-write_kafka_la_LIBADD = $(BUILD_WITH_LIBRDKAFKA_LIBS)
+write_kafka_la_LIBADD = $(BUILD_WITH_LIBRDKAFKA_LIBS) libformat_json.la
 endif
 
 if BUILD_PLUGIN_WRITE_LOG
 pkglib_LTLIBRARIES += write_log.la
 write_log_la_SOURCES = write_log.c \
                         utils_format_graphite.c utils_format_graphite.h
@@ -1216,22 +1290,21 @@
 endif
 
 if BUILD_PLUGIN_WRITE_REDIS
 pkglib_LTLIBRARIES += write_redis.la
 write_redis_la_SOURCES = write_redis.c
 write_redis_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBHIREDIS_LDFLAGS)
-write_redis_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBHIREDIS_CPPFLAGS)
+write_redis_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBHIREDIS_CPPFLAGS)
 write_redis_la_LIBADD = -lhiredis
 endif
 
 if BUILD_PLUGIN_WRITE_RIEMANN
 pkglib_LTLIBRARIES += write_riemann.la
 write_riemann_la_SOURCES = write_riemann.c write_riemann_threshold.c write_riemann_threshold.h
-nodist_write_riemann_la_SOURCES = riemann.pb-c.c riemann.pb-c.h
-write_riemann_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-write_riemann_la_LIBADD = -lprotobuf-c
+write_riemann_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBRIEMANN_CLIENT_LIBS)
+write_riemann_la_CFLAGS = $(AM_CFLAGS) $(LIBRIEMANN_CLIENT_CFLAGS)
 endif
 
 if BUILD_PLUGIN_WRITE_SENSU
 pkglib_LTLIBRARIES += write_sensu.la
 write_sensu_la_SOURCES = write_sensu.c
 write_sensu_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -1240,122 +1313,125 @@
 if BUILD_PLUGIN_WRITE_TSDB
 pkglib_LTLIBRARIES += write_tsdb.la
 write_tsdb_la_SOURCES = write_tsdb.c
 write_tsdb_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
+if BUILD_PLUGIN_XENCPU
+pkglib_LTLIBRARIES += xencpu.la
+xencpu_la_SOURCES = xencpu.c
+xencpu_la_CPPFLAGS = $(AM_CPPFLAGS) $(LIBXENCTL_CPPFLAGS)
+xencpu_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBXENCTL_LDFLAGS)
+xencpu_la_LIBADD = -lxenctrl
+endif
+
 if BUILD_PLUGIN_XMMS
 pkglib_LTLIBRARIES += xmms.la
 xmms_la_SOURCES = xmms.c
 xmms_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBXMMS_CFLAGS)
 xmms_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 xmms_la_LIBADD = $(BUILD_WITH_LIBXMMS_LIBS)
 endif
 
 if BUILD_PLUGIN_ZFS_ARC
 pkglib_LTLIBRARIES += zfs_arc.la
 zfs_arc_la_SOURCES = zfs_arc.c
-zfs_arc_la_CFLAGS = $(AM_CFLAGS)
 zfs_arc_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 if BUILD_FREEBSD
 zfs_arc_la_LIBADD = -lm
-else
-if BUILD_LINUX
-# zfs_arc requires no library on linux
-else
-# solaris
-zfs_arc_la_LIBADD = -lkstat
 endif
+if BUILD_SOLARIS
+zfs_arc_la_LIBADD = -lkstat
 endif
 endif
 
 if BUILD_PLUGIN_ZOOKEEPER
 pkglib_LTLIBRARIES += zookeeper.la
 zookeeper_la_SOURCES = zookeeper.c
 zookeeper_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 endif
 
 BUILT_SOURCES += $(dist_man_MANS)
 
+if BUILD_PLUGIN_ZONE
+pkglib_LTLIBRARIES += zone.la
+zone_la_SOURCES = zone.c
+zone_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+endif
+
 dist_man_MANS = collectd.1 \
 		collectd.conf.5 \
 		collectd-email.5 \
 		collectd-exec.5 \
 		collectdctl.1 \
 		collectd-java.5 \
+		collectd-lua.5 \
 		collectdmon.1 \
 		collectd-nagios.1 \
 		collectd-perl.5 \
 		collectd-python.5 \
 		collectd-snmp.5 \
 		collectd-tg.1 \
 		collectd-threshold.5 \
 		collectd-unixsock.5 \
 		types.db.5
 
-#collectd_1_SOURCES = collectd.pod
-
-EXTRA_DIST = types.db
-
-EXTRA_DIST +=   collectd.conf.pod \
+EXTRA_DIST =	collectd.conf.pod \
 		collectd-email.pod \
 		collectd-exec.pod \
 		collectdctl.pod \
 		collectd-java.pod \
+		collectd-lua.pod \
 		collectdmon.pod \
 		collectd-nagios.pod \
 		collectd-perl.pod \
 		collectd-python.pod \
 		collectd.pod \
 		collectd-snmp.pod \
 		collectd-tg.pod \
 		collectd-threshold.pod \
 		collectd-unixsock.pod \
 		postgresql_default.conf \
-		types.db.pod
+		types.db \
+		types.db.pod \
+		valgrind.FreeBSD.suppress
+
+AM_V_POD2MAN_C = $(am__v_POD2MAN_C_@AM_V@)
+am__v_POD2MAN_C_ = $(am__v_POD2MAN_C_@AM_DEFAULT_V@)
+am__v_POD2MAN_C_0 = @echo "  POD2MAN " $@;
+am__v_POD2MAN_C_1 =
 
 .pod.1:
-	pod2man --release=$(VERSION) --center=$(PACKAGE) $< \
+	$(AM_V_POD2MAN_C)pod2man --release=$(VERSION) --center=$(PACKAGE) $< \
 		>.pod2man.tmp.$$$$ 2>/dev/null && mv -f .pod2man.tmp.$$$$ $@ || true
 	@if grep '\<POD ERRORS\>' $@ >/dev/null 2>&1; \
 	then \
 		echo "$@ has some POD errors!"; false; \
 	fi
 
 .pod.5:
-	pod2man --section=5 --release=$(VERSION) --center=$(PACKAGE) $< \
+	$(AM_V_POD2MAN_C)pod2man --section=5 --release=$(VERSION) --center=$(PACKAGE) $< \
 		>.pod2man.tmp.$$$$ 2>/dev/null && mv -f .pod2man.tmp.$$$$ $@ || true
 	@if grep '\<POD ERRORS\>' $@ >/dev/null 2>&1; \
 	then \
 		echo "$@ has some POD errors!"; false; \
 	fi
 
 AM_V_PROTOC_C = $(am__v_PROTOC_C_@AM_V@)
 am__v_PROTOC_C_ = $(am__v_PROTOC_C_@AM_DEFAULT_V@)
-am__v_PROTOC_C_0 = @echo "  PROTOC-C    " $@;
+am__v_PROTOC_C_0 = @echo "  PROTOC-C" $@;
 am__v_PROTOC_C_1 =
 
 # Protocol buffer for the "pinba" plugin.
 EXTRA_DIST += pinba.proto
 if BUILD_PLUGIN_PINBA
 CLEANFILES += pinba.pb-c.c pinba.pb-c.h
 BUILT_SOURCES += pinba.pb-c.c pinba.pb-c.h
 
 pinba.pb-c.c pinba.pb-c.h: pinba.proto
-	$(AM_V_PROTOC_C)protoc-c -I$(srcdir) --c_out . $(srcdir)/pinba.proto
-endif
-
-# Protocol buffer for the "write_riemann" plugin.
-EXTRA_DIST += riemann.proto
-if BUILD_PLUGIN_WRITE_RIEMANN
-CLEANFILES += riemann.pb-c.c riemann.pb-c.h
-
-BUILT_SOURCES += riemann.pb-c.c riemann.pb-c.h
-
-riemann.pb-c.c riemann.pb-c.h: riemann.proto
-	$(AM_V_PROTOC_C)protoc-c -I$(srcdir) --c_out . $(srcdir)/riemann.proto
+	$(AM_V_PROTOC_C)$(PROTOC_C) -I$(srcdir) --c_out . $(srcdir)/pinba.proto
 endif
 
 install-exec-hook:
 	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)
 	if test -e $(DESTDIR)$(sysconfdir)/collectd.conf; \
 	then \
@@ -1370,30 +1446,14 @@
 
 uninstall-hook:
 	rm -f $(DESTDIR)$(pkgdatadir)/types.db;
 	rm -f $(DESTDIR)$(sysconfdir)/collectd.conf
 	rm -f $(DESTDIR)$(pkgdatadir)/postgresql_default.conf;
 
-check_PROGRAMS = test_utils_mount test_utils_vl_lookup
-
-test_utils_mount_SOURCES = utils_mount_test.c testing.h
-test_utils_mount_LDADD = libmount.la daemon/libplugin_mock.la
-if BUILD_WITH_LIBKSTAT
-test_utils_mount_LDADD += -lkstat
-endif
-
-test_utils_vl_lookup_SOURCES = utils_vl_lookup_test.c testing.h
-test_utils_vl_lookup_LDADD = liblookup.la daemon/libplugin_mock.la
-if BUILD_WITH_LIBKSTAT
-test_utils_vl_lookup_LDADD += -lkstat
-endif
-
-TESTS = test_utils_mount test_utils_vl_lookup
-
 if BUILD_PLUGIN_CEPH
 test_plugin_ceph_SOURCES = ceph_test.c
 test_plugin_ceph_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
 test_plugin_ceph_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
-test_plugin_ceph_LDADD = daemon/libcommon.la daemon/libplugin_mock.la $(BUILD_WITH_LIBYAJL_LIBS)
+test_plugin_ceph_LDADD = daemon/libplugin_mock.la $(BUILD_WITH_LIBYAJL_LIBS)
 check_PROGRAMS += test_plugin_ceph
 TESTS += test_plugin_ceph
 endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/Makefile.in	2016-11-29 00:09:17.912050729 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/Makefile.in	2016-09-11 16:10:45.947010031 +0800
@@ -78,238 +78,242 @@
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
 @BUILD_WITH_OWN_LIBOCONFIG_TRUE@am__append_1 = liboconfig
 @BUILD_FEATURE_DAEMON_TRUE@am__append_2 = -DPIDFILE='"${localstatedir}/run/${PACKAGE_NAME}.pid"'
+check_PROGRAMS = $(am__EXEEXT_1) test_utils_latency$(EXEEXT) \
+	test_utils_vl_lookup$(EXEEXT) test_utils_mount$(EXEEXT) \
+	$(am__EXEEXT_2)
+TESTS = $(am__EXEEXT_1) test_utils_latency$(EXEEXT) \
+	test_utils_vl_lookup$(EXEEXT) test_utils_mount$(EXEEXT) \
+	$(am__EXEEXT_2)
+@BUILD_WITH_LIBYAJL_TRUE@am__append_3 = $(BUILD_WITH_LIBYAJL_CPPFLAGS)
+@BUILD_WITH_LIBYAJL_TRUE@am__append_4 = $(BUILD_WITH_LIBYAJL_LDFLAGS)
+@BUILD_WITH_LIBYAJL_TRUE@am__append_5 = $(BUILD_WITH_LIBYAJL_LIBS)
+@BUILD_WITH_LIBYAJL_TRUE@am__append_6 = test_format_json
+@BUILD_WITH_LIBYAJL_TRUE@am__append_7 = test_format_json
+@BUILD_WITH_LIBKSTAT_TRUE@am__append_8 = -lkstat
+@BUILD_WITH_LIBKSTAT_TRUE@am__append_9 = -lkstat
 sbin_PROGRAMS = collectdmon$(EXEEXT)
 bin_PROGRAMS = collectd-nagios$(EXEEXT) collectdctl$(EXEEXT) \
 	collectd-tg$(EXEEXT)
-@BUILD_WITH_LIBSOCKET_TRUE@am__append_3 = -lsocket
-@BUILD_AIX_TRUE@am__append_4 = -lm
-@BUILD_WITH_LIBSOCKET_TRUE@am__append_5 = -lsocket
-@BUILD_AIX_TRUE@am__append_6 = -lm
-@BUILD_WITH_LIBSOCKET_TRUE@am__append_7 = -lsocket
-@BUILD_WITH_LIBRT_TRUE@am__append_8 = -lrt
-@BUILD_AIX_TRUE@am__append_9 = -lm
-@BUILD_WITH_LIBPTHREAD_TRUE@am__append_10 = -lpthread
-@BUILD_PLUGIN_AGGREGATION_TRUE@am__append_11 = aggregation.la
-@BUILD_PLUGIN_AMQP_TRUE@am__append_12 = amqp.la
-@BUILD_PLUGIN_APACHE_TRUE@am__append_13 = apache.la
-@BUILD_PLUGIN_APACHE_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_14 = $(BUILD_WITH_LIBCURL_CFLAGS)
-@BUILD_PLUGIN_APACHE_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_15 = $(BUILD_WITH_LIBCURL_LIBS)
-@BUILD_PLUGIN_APCUPS_TRUE@am__append_16 = apcups.la
-@BUILD_PLUGIN_APCUPS_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_17 = -lsocket
-@BUILD_PLUGIN_APPLE_SENSORS_TRUE@am__append_18 = apple_sensors.la
-@BUILD_PLUGIN_AQUAERO_TRUE@am__append_19 = aquaero.la
-@BUILD_PLUGIN_ASCENT_TRUE@am__append_20 = ascent.la
-@BUILD_PLUGIN_BAROMETER_TRUE@am__append_21 = barometer.la
-@BUILD_PLUGIN_BATTERY_TRUE@am__append_22 = battery.la
-@BUILD_PLUGIN_BATTERY_TRUE@@BUILD_WITH_LIBIOKIT_TRUE@am__append_23 = -framework IOKit
-@BUILD_PLUGIN_BIND_TRUE@am__append_24 = bind.la
-@BUILD_PLUGIN_CEPH_TRUE@am__append_25 = ceph.la
-@BUILD_PLUGIN_CGROUPS_TRUE@am__append_26 = cgroups.la
-@BUILD_PLUGIN_CONNTRACK_TRUE@am__append_27 = conntrack.la
-@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@am__append_28 = contextswitch.la
-@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_29 = -lperfstat
-@BUILD_PLUGIN_CPU_TRUE@am__append_30 = cpu.la
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_31 = -lkstat
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_32 = -ldevinfo
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_33 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_34 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_35 = -lperfstat
-@BUILD_PLUGIN_CPUFREQ_TRUE@am__append_36 = cpufreq.la
-@BUILD_PLUGIN_CSV_TRUE@am__append_37 = csv.la
-@BUILD_PLUGIN_CURL_TRUE@am__append_38 = curl.la
-@BUILD_PLUGIN_CURL_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_39 = $(BUILD_WITH_LIBCURL_CFLAGS)
-@BUILD_PLUGIN_CURL_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_40 = $(BUILD_WITH_LIBCURL_LIBS)
-@BUILD_PLUGIN_CURL_JSON_TRUE@am__append_41 = curl_json.la
-@BUILD_PLUGIN_CURL_JSON_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_42 = $(BUILD_WITH_LIBCURL_CFLAGS)
-@BUILD_PLUGIN_CURL_JSON_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_43 = $(BUILD_WITH_LIBCURL_LIBS)
-@BUILD_PLUGIN_CURL_XML_TRUE@am__append_44 = curl_xml.la
-@BUILD_PLUGIN_DBI_TRUE@am__append_45 = dbi.la
-@BUILD_PLUGIN_DF_TRUE@am__append_46 = df.la
-@BUILD_PLUGIN_DISK_TRUE@am__append_47 = disk.la
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_48 = -lkstat
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_49 = -ldevinfo
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBIOKIT_TRUE@am__append_50 = -framework IOKit
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_51 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_52 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_53 = $(BUILD_WITH_LIBUDEV_CFLAGS)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_54 = $(BUILD_WITH_LIBUDEV_LDFLAGS)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_55 = $(BUILD_WITH_LIBUDEV_LIBS)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_56 = -lperfstat
-@BUILD_PLUGIN_DNS_TRUE@am__append_57 = dns.la
-@BUILD_PLUGIN_DRBD_TRUE@am__append_58 = drbd.la
-@BUILD_PLUGIN_EMAIL_TRUE@am__append_59 = email.la
-@BUILD_PLUGIN_ENTROPY_TRUE@am__append_60 = entropy.la
-@BUILD_PLUGIN_EXEC_TRUE@am__append_61 = exec.la
-@BUILD_PLUGIN_ETHSTAT_TRUE@am__append_62 = ethstat.la
-@BUILD_PLUGIN_FHCOUNT_TRUE@am__append_63 = fhcount.la
-@BUILD_PLUGIN_FILECOUNT_TRUE@am__append_64 = filecount.la
-@BUILD_PLUGIN_GMOND_TRUE@am__append_65 = gmond.la
-@BUILD_PLUGIN_HDDTEMP_TRUE@am__append_66 = hddtemp.la
-@BUILD_PLUGIN_HDDTEMP_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_67 = -lsocket
-@BUILD_PLUGIN_INTERFACE_TRUE@am__append_68 = interface.la
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_69 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_70 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@@BUILD_WITH_LIBSTATGRAB_FALSE@am__append_71 = -lkstat
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@@BUILD_WITH_LIBSTATGRAB_FALSE@am__append_72 = -ldevinfo
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_73 = -lperfstat
-@BUILD_PLUGIN_IPC_TRUE@am__append_74 = ipc.la
-@BUILD_PLUGIN_IPTABLES_TRUE@am__append_75 = iptables.la
-@BUILD_PLUGIN_IPMI_TRUE@am__append_76 = ipmi.la
-@BUILD_PLUGIN_IPVS_TRUE@am__append_77 = ipvs.la
-@BUILD_PLUGIN_IRQ_TRUE@am__append_78 = irq.la
-@BUILD_PLUGIN_JAVA_TRUE@am__append_79 = java.la
-@BUILD_PLUGIN_LOAD_TRUE@am__append_80 = load.la
-@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_81 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_82 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_83 = -lperfstat
-@BUILD_PLUGIN_LOGFILE_TRUE@am__append_84 = logfile.la
-@BUILD_PLUGIN_LOG_LOGSTASH_TRUE@am__append_85 = log_logstash.la
-@BUILD_PLUGIN_LPAR_TRUE@am__append_86 = lpar.la
-@BUILD_PLUGIN_LVM_TRUE@am__append_87 = lvm.la
-@BUILD_PLUGIN_MADWIFI_TRUE@am__append_88 = madwifi.la
-@BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE@am__append_89 = match_empty_counter.la
-@BUILD_PLUGIN_MATCH_HASHED_TRUE@am__append_90 = match_hashed.la
-@BUILD_PLUGIN_MATCH_REGEX_TRUE@am__append_91 = match_regex.la
-@BUILD_PLUGIN_MATCH_TIMEDIFF_TRUE@am__append_92 = match_timediff.la
-@BUILD_PLUGIN_MATCH_VALUE_TRUE@am__append_93 = match_value.la
-@BUILD_PLUGIN_MBMON_TRUE@am__append_94 = mbmon.la
-@BUILD_PLUGIN_MBMON_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_95 = -lsocket
-@BUILD_PLUGIN_MD_TRUE@am__append_96 = md.la
-@BUILD_PLUGIN_MEMCACHEC_TRUE@am__append_97 = memcachec.la
-@BUILD_PLUGIN_MEMCACHED_TRUE@am__append_98 = memcached.la
-@BUILD_PLUGIN_MEMCACHED_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_99 = -lsocket
-@BUILD_PLUGIN_MEMORY_TRUE@am__append_100 = memory.la
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_101 = -lkstat
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_102 = -ldevinfo
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_103 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_104 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_105 = -lperfstat
-@BUILD_PLUGIN_MIC_TRUE@am__append_106 = mic.la
-@BUILD_PLUGIN_MODBUS_TRUE@am__append_107 = modbus.la
-@BUILD_PLUGIN_MULTIMETER_TRUE@am__append_108 = multimeter.la
-@BUILD_PLUGIN_MYSQL_TRUE@am__append_109 = mysql.la
-@BUILD_PLUGIN_MYSQL_TRUE@@BUILD_WITH_LIBMYSQL_TRUE@am__append_110 = $(BUILD_WITH_LIBMYSQL_CFLAGS)
-@BUILD_PLUGIN_MYSQL_TRUE@@BUILD_WITH_LIBMYSQL_TRUE@am__append_111 = $(BUILD_WITH_LIBMYSQL_LIBS)
-@BUILD_PLUGIN_NETAPP_TRUE@am__append_112 = netapp.la
-@BUILD_PLUGIN_NETLINK_TRUE@am__append_113 = netlink.la
-@BUILD_PLUGIN_NETWORK_TRUE@am__append_114 = network.la
-@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_115 = -lsocket
-@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_116 = $(GCRYPT_CPPFLAGS)
-@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_117 = $(GCRYPT_LDFLAGS)
-@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_118 = $(GCRYPT_LIBS)
-@BUILD_PLUGIN_NFS_TRUE@am__append_119 = nfs.la
-@BUILD_PLUGIN_FSCACHE_TRUE@am__append_120 = fscache.la
-@BUILD_PLUGIN_NGINX_TRUE@am__append_121 = nginx.la
-@BUILD_PLUGIN_NGINX_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_122 = $(BUILD_WITH_LIBCURL_CFLAGS)
-@BUILD_PLUGIN_NGINX_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_123 = $(BUILD_WITH_LIBCURL_LIBS)
-@BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@am__append_124 = notify_desktop.la
-@BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@am__append_125 = notify_email.la
-@BUILD_PLUGIN_NTPD_TRUE@am__append_126 = ntpd.la
-@BUILD_PLUGIN_NTPD_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_127 = -lsocket
-@BUILD_PLUGIN_NUMA_TRUE@am__append_128 = numa.la
-@BUILD_PLUGIN_NUT_TRUE@am__append_129 = nut.la
-@BUILD_PLUGIN_OLSRD_TRUE@am__append_130 = olsrd.la
-@BUILD_PLUGIN_OLSRD_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_131 = -lsocket
-@BUILD_PLUGIN_ONEWIRE_TRUE@am__append_132 = onewire.la
-@BUILD_PLUGIN_OPENLDAP_TRUE@am__append_133 = openldap.la
-@BUILD_PLUGIN_OPENVPN_TRUE@am__append_134 = openvpn.la
-@BUILD_PLUGIN_ORACLE_TRUE@am__append_135 = oracle.la
-@BUILD_PLUGIN_PERL_TRUE@am__append_136 = perl.la
+@BUILD_WITH_LIBSOCKET_TRUE@am__append_10 = -lsocket
+@BUILD_AIX_TRUE@am__append_11 = -lm
+@BUILD_WITH_LIBSOCKET_TRUE@am__append_12 = -lsocket
+@BUILD_AIX_TRUE@am__append_13 = -lm
+@BUILD_WITH_LIBSOCKET_TRUE@am__append_14 = -lsocket
+@BUILD_WITH_LIBRT_TRUE@am__append_15 = -lrt
+@BUILD_AIX_TRUE@am__append_16 = -lm
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@am__append_17 = collectd.grpc.pb.cc collectd.pb.cc types.pb.cc
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@am__append_18 = collectd.grpc.pb.cc collectd.pb.cc types.pb.cc \
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@		collectd.grpc.pb.h collectd.pb.h types.pb.h
+
+@BUILD_PLUGIN_AGGREGATION_TRUE@am__append_19 = aggregation.la
+@BUILD_PLUGIN_AMQP_TRUE@am__append_20 = amqp.la
+@BUILD_PLUGIN_APACHE_TRUE@am__append_21 = apache.la
+@BUILD_PLUGIN_APCUPS_TRUE@am__append_22 = apcups.la
+@BUILD_PLUGIN_APCUPS_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_23 = -lsocket
+@BUILD_PLUGIN_APPLE_SENSORS_TRUE@am__append_24 = apple_sensors.la
+@BUILD_PLUGIN_AQUAERO_TRUE@am__append_25 = aquaero.la
+@BUILD_PLUGIN_ASCENT_TRUE@am__append_26 = ascent.la
+@BUILD_PLUGIN_BAROMETER_TRUE@am__append_27 = barometer.la
+@BUILD_PLUGIN_BATTERY_TRUE@am__append_28 = battery.la
+@BUILD_PLUGIN_BATTERY_TRUE@@BUILD_WITH_LIBIOKIT_TRUE@am__append_29 = -framework IOKit
+@BUILD_PLUGIN_BIND_TRUE@am__append_30 = bind.la
+@BUILD_PLUGIN_CEPH_TRUE@am__append_31 = ceph.la
+@BUILD_PLUGIN_CGROUPS_TRUE@am__append_32 = cgroups.la
+@BUILD_PLUGIN_CHRONY_TRUE@am__append_33 = chrony.la
+@BUILD_PLUGIN_CONNTRACK_TRUE@am__append_34 = conntrack.la
+@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@am__append_35 = contextswitch.la
+@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_36 = -lperfstat
+@BUILD_PLUGIN_CPU_TRUE@am__append_37 = cpu.la
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_38 = -lkstat
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_39 = -ldevinfo
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_40 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_41 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_42 = -lperfstat
+@BUILD_PLUGIN_CPUFREQ_TRUE@am__append_43 = cpufreq.la
+@BUILD_PLUGIN_CPUSLEEP_TRUE@am__append_44 = cpusleep.la
+@BUILD_PLUGIN_CSV_TRUE@am__append_45 = csv.la
+@BUILD_PLUGIN_CURL_TRUE@am__append_46 = curl.la
+@BUILD_PLUGIN_CURL_JSON_TRUE@am__append_47 = curl_json.la
+@BUILD_PLUGIN_CURL_XML_TRUE@am__append_48 = curl_xml.la
+@BUILD_PLUGIN_DBI_TRUE@am__append_49 = dbi.la
+@BUILD_PLUGIN_DF_TRUE@am__append_50 = df.la
+@BUILD_PLUGIN_DISK_TRUE@am__append_51 = disk.la
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_52 = -lkstat
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_53 = -ldevinfo
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBIOKIT_TRUE@am__append_54 = -framework IOKit
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_55 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_56 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_57 = $(BUILD_WITH_LIBUDEV_CFLAGS)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_58 = $(BUILD_WITH_LIBUDEV_LDFLAGS)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_59 = $(BUILD_WITH_LIBUDEV_LIBS)
+@BUILD_FREEBSD_TRUE@@BUILD_PLUGIN_DISK_TRUE@am__append_60 = -ldevstat -lgeom
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_61 = -lperfstat
+@BUILD_PLUGIN_DNS_TRUE@am__append_62 = dns.la
+@BUILD_PLUGIN_DRBD_TRUE@am__append_63 = drbd.la
+@BUILD_PLUGIN_EMAIL_TRUE@am__append_64 = email.la
+@BUILD_PLUGIN_ENTROPY_TRUE@am__append_65 = entropy.la
+@BUILD_PLUGIN_EXEC_TRUE@am__append_66 = exec.la
+@BUILD_PLUGIN_ETHSTAT_TRUE@am__append_67 = ethstat.la
+@BUILD_PLUGIN_FHCOUNT_TRUE@am__append_68 = fhcount.la
+@BUILD_PLUGIN_FILECOUNT_TRUE@am__append_69 = filecount.la
+@BUILD_PLUGIN_GMOND_TRUE@am__append_70 = gmond.la
+@BUILD_PLUGIN_GPS_TRUE@am__append_71 = gps.la
+@BUILD_PLUGIN_GRPC_TRUE@am__append_72 = grpc.la
+@BUILD_PLUGIN_HDDTEMP_TRUE@am__append_73 = hddtemp.la
+@BUILD_PLUGIN_HDDTEMP_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_74 = -lsocket
+@BUILD_PLUGIN_INTERFACE_TRUE@am__append_75 = interface.la
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_76 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_77 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@@BUILD_WITH_LIBSTATGRAB_FALSE@am__append_78 = -lkstat
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@@BUILD_WITH_LIBSTATGRAB_FALSE@am__append_79 = -ldevinfo
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_80 = -lperfstat
+@BUILD_PLUGIN_IPC_TRUE@am__append_81 = ipc.la
+@BUILD_PLUGIN_IPTABLES_TRUE@am__append_82 = iptables.la
+@BUILD_PLUGIN_IPMI_TRUE@am__append_83 = ipmi.la
+@BUILD_PLUGIN_IPVS_TRUE@am__append_84 = ipvs.la
+@BUILD_PLUGIN_IPVS_TRUE@@IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE@am__append_85 = $(KERNEL_CFLAGS)
+@BUILD_PLUGIN_IRQ_TRUE@am__append_86 = irq.la
+@BUILD_PLUGIN_JAVA_TRUE@am__append_87 = java.la
+@BUILD_PLUGIN_LOAD_TRUE@am__append_88 = load.la
+@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_89 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_90 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_91 = -lperfstat
+@BUILD_PLUGIN_LOGFILE_TRUE@am__append_92 = logfile.la
+@BUILD_PLUGIN_LOG_LOGSTASH_TRUE@am__append_93 = log_logstash.la
+@BUILD_PLUGIN_LPAR_TRUE@am__append_94 = lpar.la
+@BUILD_PLUGIN_LUA_TRUE@am__append_95 = lua.la
+@BUILD_PLUGIN_LVM_TRUE@am__append_96 = lvm.la
+@BUILD_PLUGIN_MADWIFI_TRUE@am__append_97 = madwifi.la
+@BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE@am__append_98 = match_empty_counter.la
+@BUILD_PLUGIN_MATCH_HASHED_TRUE@am__append_99 = match_hashed.la
+@BUILD_PLUGIN_MATCH_REGEX_TRUE@am__append_100 = match_regex.la
+@BUILD_PLUGIN_MATCH_TIMEDIFF_TRUE@am__append_101 = match_timediff.la
+@BUILD_PLUGIN_MATCH_VALUE_TRUE@am__append_102 = match_value.la
+@BUILD_PLUGIN_MBMON_TRUE@am__append_103 = mbmon.la
+@BUILD_PLUGIN_MBMON_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_104 = -lsocket
+@BUILD_PLUGIN_MD_TRUE@am__append_105 = md.la
+@BUILD_PLUGIN_MEMCACHEC_TRUE@am__append_106 = memcachec.la
+@BUILD_PLUGIN_MEMCACHED_TRUE@am__append_107 = memcached.la
+@BUILD_PLUGIN_MEMCACHED_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_108 = -lsocket
+@BUILD_PLUGIN_MEMORY_TRUE@am__append_109 = memory.la
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_110 = -lkstat
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_111 = -ldevinfo
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_112 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_113 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_114 = -lperfstat
+@BUILD_PLUGIN_MIC_TRUE@am__append_115 = mic.la
+@BUILD_PLUGIN_MODBUS_TRUE@am__append_116 = modbus.la
+@BUILD_PLUGIN_MQTT_TRUE@am__append_117 = mqtt.la
+@BUILD_PLUGIN_MULTIMETER_TRUE@am__append_118 = multimeter.la
+@BUILD_PLUGIN_MYSQL_TRUE@am__append_119 = mysql.la
+@BUILD_PLUGIN_NETAPP_TRUE@am__append_120 = netapp.la
+@BUILD_PLUGIN_NETLINK_TRUE@am__append_121 = netlink.la
+@BUILD_PLUGIN_NETWORK_TRUE@am__append_122 = network.la
+@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_123 = -lsocket
+@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_124 = $(GCRYPT_CPPFLAGS)
+@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_125 = $(GCRYPT_LDFLAGS)
+@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__append_126 = $(GCRYPT_LIBS)
+@BUILD_PLUGIN_NFS_TRUE@am__append_127 = nfs.la
+@BUILD_PLUGIN_FSCACHE_TRUE@am__append_128 = fscache.la
+@BUILD_PLUGIN_NGINX_TRUE@am__append_129 = nginx.la
+@BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@am__append_130 = notify_desktop.la
+@BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@am__append_131 = notify_email.la
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@am__append_132 = notify_nagios.la
+@BUILD_PLUGIN_NTPD_TRUE@am__append_133 = ntpd.la
+@BUILD_PLUGIN_NTPD_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_134 = -lsocket
+@BUILD_PLUGIN_NUMA_TRUE@am__append_135 = numa.la
+@BUILD_PLUGIN_NUT_TRUE@am__append_136 = nut.la
+@BUILD_PLUGIN_OLSRD_TRUE@am__append_137 = olsrd.la
+@BUILD_PLUGIN_OLSRD_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_138 = -lsocket
+@BUILD_PLUGIN_ONEWIRE_TRUE@am__append_139 = onewire.la
+@BUILD_PLUGIN_OPENLDAP_TRUE@am__append_140 = openldap.la
+@BUILD_PLUGIN_OPENVPN_TRUE@am__append_141 = openvpn.la
+@BUILD_PLUGIN_ORACLE_TRUE@am__append_142 = oracle.la
+@BUILD_PLUGIN_PERL_TRUE@am__append_143 = perl.la
 # Work-around for issues #41 and #42 - Perl 5.10 incorrectly introduced
 # __attribute__nonnull__(3) for Perl_load_module().
-@BUILD_PLUGIN_PERL_TRUE@@HAVE_BROKEN_PERL_LOAD_MODULE_TRUE@am__append_137 = -Wno-nonnull
-@BUILD_PLUGIN_PF_TRUE@am__append_138 = pf.la
-@BUILD_PLUGIN_PINBA_TRUE@am__append_139 = pinba.la
-@BUILD_PLUGIN_PING_TRUE@am__append_140 = ping.la
-@BUILD_PLUGIN_POSTGRESQL_TRUE@am__append_141 = postgresql.la
-@BUILD_PLUGIN_POWERDNS_TRUE@am__append_142 = powerdns.la
-@BUILD_PLUGIN_PYTHON_TRUE@am__append_143 = python.la
-@BUILD_PLUGIN_PYTHON_TRUE@@COMPILER_IS_GCC_TRUE@am__append_144 = -fno-strict-aliasing -Wno-strict-aliasing
-@BUILD_PLUGIN_PROCESSES_TRUE@am__append_145 = processes.la
-@BUILD_PLUGIN_PROCESSES_TRUE@@BUILD_WITH_LIBKVM_GETPROCS_TRUE@am__append_146 = -lkvm
-@BUILD_PLUGIN_PROTOCOLS_TRUE@am__append_147 = protocols.la
-@BUILD_PLUGIN_REDIS_TRUE@am__append_148 = redis.la
-@BUILD_PLUGIN_ROUTEROS_TRUE@am__append_149 = routeros.la
-@BUILD_PLUGIN_RRDCACHED_TRUE@am__append_150 = rrdcached.la
-@BUILD_PLUGIN_RRDTOOL_TRUE@am__append_151 = rrdtool.la
-@BUILD_PLUGIN_SENSORS_TRUE@am__append_152 = sensors.la
-@BUILD_PLUGIN_SERIAL_TRUE@am__append_153 = serial.la
-@BUILD_PLUGIN_SIGROK_TRUE@am__append_154 = sigrok.la
-@BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_155 = smart.la
-@BUILD_PLUGIN_SNMP_TRUE@am__append_156 = snmp.la
-@BUILD_PLUGIN_SNMP_TRUE@@BUILD_WITH_LIBNETSNMP_TRUE@am__append_157 = $(BUILD_WITH_LIBSNMP_CFLAGS)
-@BUILD_PLUGIN_SNMP_TRUE@@BUILD_WITH_LIBNETSNMP_TRUE@am__append_158 = $(BUILD_WITH_LIBSNMP_LIBS)
-@BUILD_PLUGIN_SNMP_TRUE@@BUILD_WITH_LIBPTHREAD_TRUE@am__append_159 = -lpthread
-@BUILD_PLUGIN_STATSD_TRUE@am__append_160 = statsd.la
-@BUILD_PLUGIN_SWAP_TRUE@am__append_161 = swap.la
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_162 = -lkstat
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_163 = -ldevinfo
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE@am__append_164 = -lkvm
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_165 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_166 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_167 = -lperfstat
-@BUILD_PLUGIN_SYSLOG_TRUE@am__append_168 = syslog.la
-@BUILD_PLUGIN_TABLE_TRUE@am__append_169 = table.la
-@BUILD_PLUGIN_TAIL_TRUE@am__append_170 = tail.la
-@BUILD_PLUGIN_TAIL_CSV_TRUE@am__append_171 = tail_csv.la
-@BUILD_PLUGIN_TAPE_TRUE@am__append_172 = tape.la
-@BUILD_PLUGIN_TARGET_NOTIFICATION_TRUE@am__append_173 = target_notification.la
-@BUILD_PLUGIN_TARGET_REPLACE_TRUE@am__append_174 = target_replace.la
-@BUILD_PLUGIN_TARGET_SCALE_TRUE@am__append_175 = target_scale.la
-@BUILD_PLUGIN_TARGET_SET_TRUE@am__append_176 = target_set.la
-@BUILD_PLUGIN_TARGET_V5UPGRADE_TRUE@am__append_177 = target_v5upgrade.la
-@BUILD_PLUGIN_TCPCONNS_TRUE@am__append_178 = tcpconns.la
-@BUILD_PLUGIN_TCPCONNS_TRUE@@BUILD_WITH_LIBKVM_NLIST_TRUE@am__append_179 = -lkvm
-@BUILD_PLUGIN_TEAMSPEAK2_TRUE@am__append_180 = teamspeak2.la
-@BUILD_PLUGIN_TED_TRUE@am__append_181 = ted.la
-@BUILD_PLUGIN_THERMAL_TRUE@am__append_182 = thermal.la
-@BUILD_PLUGIN_THRESHOLD_TRUE@am__append_183 = threshold.la
-@BUILD_PLUGIN_TOKYOTYRANT_TRUE@am__append_184 = tokyotyrant.la
-@BUILD_PLUGIN_TOKYOTYRANT_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_185 = -lsocket
-@BUILD_PLUGIN_TURBOSTAT_TRUE@am__append_186 = turbostat.la
-@BUILD_PLUGIN_UNIXSOCK_TRUE@am__append_187 = unixsock.la
-@BUILD_PLUGIN_UPTIME_TRUE@am__append_188 = uptime.la
-@BUILD_PLUGIN_UPTIME_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_189 = -lkstat
-@BUILD_PLUGIN_UPTIME_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_190 = -lperfstat
-@BUILD_PLUGIN_USERS_TRUE@am__append_191 = users.la
-@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_192 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
-@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_193 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
-@BUILD_PLUGIN_UUID_TRUE@am__append_194 = uuid.la
-@BUILD_PLUGIN_VARNISH_TRUE@am__append_195 = varnish.la
-@BUILD_PLUGIN_VIRT_TRUE@am__append_196 = virt.la
-@BUILD_PLUGIN_VMEM_TRUE@am__append_197 = vmem.la
-@BUILD_PLUGIN_VSERVER_TRUE@am__append_198 = vserver.la
-@BUILD_PLUGIN_WIRELESS_TRUE@am__append_199 = wireless.la
-@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@am__append_200 = write_graphite.la
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@am__append_201 = write_http.la
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_202 = $(BUILD_WITH_LIBCURL_CFLAGS)
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__append_203 = $(BUILD_WITH_LIBCURL_LIBS)
-@BUILD_PLUGIN_WRITE_KAFKA_TRUE@am__append_204 = write_kafka.la
-@BUILD_PLUGIN_WRITE_LOG_TRUE@am__append_205 = write_log.la
-@BUILD_PLUGIN_WRITE_MONGODB_TRUE@am__append_206 = write_mongodb.la
-@BUILD_PLUGIN_WRITE_REDIS_TRUE@am__append_207 = write_redis.la
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am__append_208 = write_riemann.la
-@BUILD_PLUGIN_WRITE_SENSU_TRUE@am__append_209 = write_sensu.la
-@BUILD_PLUGIN_WRITE_TSDB_TRUE@am__append_210 = write_tsdb.la
-@BUILD_PLUGIN_XMMS_TRUE@am__append_211 = xmms.la
-@BUILD_PLUGIN_ZFS_ARC_TRUE@am__append_212 = zfs_arc.la
-@BUILD_PLUGIN_ZOOKEEPER_TRUE@am__append_213 = zookeeper.la
-@BUILD_PLUGIN_PINBA_TRUE@am__append_214 = pinba.pb-c.c pinba.pb-c.h
-@BUILD_PLUGIN_PINBA_TRUE@am__append_215 = pinba.pb-c.c pinba.pb-c.h
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am__append_216 = riemann.pb-c.c riemann.pb-c.h
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am__append_217 = riemann.pb-c.c riemann.pb-c.h
-check_PROGRAMS = test_utils_mount$(EXEEXT) \
-	test_utils_vl_lookup$(EXEEXT) $(am__EXEEXT_1)
-@BUILD_WITH_LIBKSTAT_TRUE@am__append_218 = -lkstat
-@BUILD_WITH_LIBKSTAT_TRUE@am__append_219 = -lkstat
-TESTS = test_utils_mount$(EXEEXT) test_utils_vl_lookup$(EXEEXT) \
-	$(am__EXEEXT_1)
+@BUILD_PLUGIN_PERL_TRUE@@HAVE_BROKEN_PERL_LOAD_MODULE_TRUE@am__append_144 = -Wno-nonnull
+@BUILD_PLUGIN_PF_TRUE@am__append_145 = pf.la
+@BUILD_PLUGIN_PINBA_TRUE@am__append_146 = pinba.la
+@BUILD_PLUGIN_PING_TRUE@am__append_147 = ping.la
+@BUILD_PLUGIN_POSTGRESQL_TRUE@am__append_148 = postgresql.la
+@BUILD_PLUGIN_POWERDNS_TRUE@am__append_149 = powerdns.la
+@BUILD_PLUGIN_PYTHON_TRUE@am__append_150 = python.la
+@BUILD_PLUGIN_PYTHON_TRUE@@COMPILER_IS_GCC_TRUE@am__append_151 = -fno-strict-aliasing -Wno-strict-aliasing
+@BUILD_PLUGIN_PROCESSES_TRUE@am__append_152 = processes.la
+@BUILD_PLUGIN_PROCESSES_TRUE@@BUILD_WITH_LIBKVM_GETPROCS_TRUE@am__append_153 = -lkvm
+@BUILD_PLUGIN_PROTOCOLS_TRUE@am__append_154 = protocols.la
+@BUILD_PLUGIN_REDIS_TRUE@am__append_155 = redis.la
+@BUILD_PLUGIN_ROUTEROS_TRUE@am__append_156 = routeros.la
+@BUILD_PLUGIN_RRDCACHED_TRUE@am__append_157 = rrdcached.la
+@BUILD_PLUGIN_RRDTOOL_TRUE@am__append_158 = rrdtool.la
+@BUILD_PLUGIN_SENSORS_TRUE@am__append_159 = sensors.la
+@BUILD_PLUGIN_SERIAL_TRUE@am__append_160 = serial.la
+@BUILD_PLUGIN_SIGROK_TRUE@am__append_161 = sigrok.la
+@BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__append_162 = smart.la
+@BUILD_PLUGIN_SNMP_TRUE@am__append_163 = snmp.la
+@BUILD_PLUGIN_STATSD_TRUE@am__append_164 = statsd.la
+@BUILD_PLUGIN_SWAP_TRUE@am__append_165 = swap.la
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_166 = -lkstat
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBDEVINFO_TRUE@am__append_167 = -ldevinfo
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBKVM_GETSWAPINFO_TRUE@am__append_168 = -lkvm
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_169 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_170 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_171 = -lperfstat
+@BUILD_PLUGIN_SYSLOG_TRUE@am__append_172 = syslog.la
+@BUILD_PLUGIN_TABLE_TRUE@am__append_173 = table.la
+@BUILD_PLUGIN_TAIL_TRUE@am__append_174 = tail.la
+@BUILD_PLUGIN_TAIL_CSV_TRUE@am__append_175 = tail_csv.la
+@BUILD_PLUGIN_TAPE_TRUE@am__append_176 = tape.la
+@BUILD_PLUGIN_TARGET_NOTIFICATION_TRUE@am__append_177 = target_notification.la
+@BUILD_PLUGIN_TARGET_REPLACE_TRUE@am__append_178 = target_replace.la
+@BUILD_PLUGIN_TARGET_SCALE_TRUE@am__append_179 = target_scale.la
+@BUILD_PLUGIN_TARGET_SET_TRUE@am__append_180 = target_set.la
+@BUILD_PLUGIN_TARGET_V5UPGRADE_TRUE@am__append_181 = target_v5upgrade.la
+@BUILD_PLUGIN_TCPCONNS_TRUE@am__append_182 = tcpconns.la
+@BUILD_PLUGIN_TCPCONNS_TRUE@@BUILD_WITH_LIBKVM_NLIST_TRUE@am__append_183 = -lkvm
+@BUILD_PLUGIN_TEAMSPEAK2_TRUE@am__append_184 = teamspeak2.la
+@BUILD_PLUGIN_TED_TRUE@am__append_185 = ted.la
+@BUILD_PLUGIN_THERMAL_TRUE@am__append_186 = thermal.la
+@BUILD_PLUGIN_THRESHOLD_TRUE@am__append_187 = threshold.la
+@BUILD_PLUGIN_TOKYOTYRANT_TRUE@am__append_188 = tokyotyrant.la
+@BUILD_PLUGIN_TOKYOTYRANT_TRUE@@BUILD_WITH_LIBSOCKET_TRUE@am__append_189 = -lsocket
+@BUILD_PLUGIN_TURBOSTAT_TRUE@am__append_190 = turbostat.la
+@BUILD_PLUGIN_UNIXSOCK_TRUE@am__append_191 = unixsock.la
+@BUILD_PLUGIN_UPTIME_TRUE@am__append_192 = uptime.la
+@BUILD_PLUGIN_UPTIME_TRUE@@BUILD_WITH_LIBKSTAT_TRUE@am__append_193 = -lkstat
+@BUILD_PLUGIN_UPTIME_TRUE@@BUILD_WITH_PERFSTAT_TRUE@am__append_194 = -lperfstat
+@BUILD_PLUGIN_USERS_TRUE@am__append_195 = users.la
+@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_196 = $(BUILD_WITH_LIBSTATGRAB_CFLAGS)
+@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__append_197 = $(BUILD_WITH_LIBSTATGRAB_LDFLAGS)
+@BUILD_PLUGIN_UUID_TRUE@am__append_198 = uuid.la
+@BUILD_PLUGIN_VARNISH_TRUE@am__append_199 = varnish.la
+@BUILD_PLUGIN_VIRT_TRUE@am__append_200 = virt.la
+@BUILD_PLUGIN_VMEM_TRUE@am__append_201 = vmem.la
+@BUILD_PLUGIN_VSERVER_TRUE@am__append_202 = vserver.la
+@BUILD_PLUGIN_WIRELESS_TRUE@am__append_203 = wireless.la
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@am__append_204 = write_graphite.la
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@am__append_205 = write_http.la
+@BUILD_PLUGIN_WRITE_KAFKA_TRUE@am__append_206 = write_kafka.la
+@BUILD_PLUGIN_WRITE_LOG_TRUE@am__append_207 = write_log.la
+@BUILD_PLUGIN_WRITE_MONGODB_TRUE@am__append_208 = write_mongodb.la
+@BUILD_PLUGIN_WRITE_REDIS_TRUE@am__append_209 = write_redis.la
+@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am__append_210 = write_riemann.la
+@BUILD_PLUGIN_WRITE_SENSU_TRUE@am__append_211 = write_sensu.la
+@BUILD_PLUGIN_WRITE_TSDB_TRUE@am__append_212 = write_tsdb.la
+@BUILD_PLUGIN_XENCPU_TRUE@am__append_213 = xencpu.la
+@BUILD_PLUGIN_XMMS_TRUE@am__append_214 = xmms.la
+@BUILD_PLUGIN_ZFS_ARC_TRUE@am__append_215 = zfs_arc.la
+@BUILD_PLUGIN_ZOOKEEPER_TRUE@am__append_216 = zookeeper.la
+@BUILD_PLUGIN_ZONE_TRUE@am__append_217 = zone.la
+@BUILD_PLUGIN_PINBA_TRUE@am__append_218 = pinba.pb-c.c pinba.pb-c.h
+@BUILD_PLUGIN_PINBA_TRUE@am__append_219 = pinba.pb-c.c pinba.pb-c.h
 @BUILD_PLUGIN_CEPH_TRUE@am__append_220 = test_plugin_ceph
 @BUILD_PLUGIN_CEPH_TRUE@am__append_221 = test_plugin_ceph
 subdir = src
 DIST_COMMON = $(srcdir)/Makefile.in $(srcdir)/Makefile.am \
 	$(srcdir)/config.h.in $(srcdir)/collectd.conf.in \
 	$(top_srcdir)/libltdl/config/depcomp $(dist_man_MANS) \
@@ -368,30 +372,28 @@
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(aggregation_la_LDFLAGS) $(LDFLAGS) -o \
 	$@
 @BUILD_PLUGIN_AGGREGATION_TRUE@am_aggregation_la_rpath = -rpath \
 @BUILD_PLUGIN_AGGREGATION_TRUE@	$(pkglibdir)
 am__DEPENDENCIES_1 =
-@BUILD_PLUGIN_AMQP_TRUE@amqp_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_AMQP_TRUE@amqp_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
+@BUILD_PLUGIN_AMQP_TRUE@	libformat_json.la
 am__amqp_la_SOURCES_DIST = amqp.c utils_cmd_putval.c \
 	utils_cmd_putval.h utils_parse_option.c utils_parse_option.h \
-	utils_format_graphite.c utils_format_graphite.h \
-	utils_format_json.c utils_format_json.h
+	utils_format_graphite.c utils_format_graphite.h
 @BUILD_PLUGIN_AMQP_TRUE@am_amqp_la_OBJECTS = amqp_la-amqp.lo \
 @BUILD_PLUGIN_AMQP_TRUE@	amqp_la-utils_cmd_putval.lo \
 @BUILD_PLUGIN_AMQP_TRUE@	amqp_la-utils_parse_option.lo \
-@BUILD_PLUGIN_AMQP_TRUE@	amqp_la-utils_format_graphite.lo \
-@BUILD_PLUGIN_AMQP_TRUE@	amqp_la-utils_format_json.lo
+@BUILD_PLUGIN_AMQP_TRUE@	amqp_la-utils_format_graphite.lo
 amqp_la_OBJECTS = $(am_amqp_la_OBJECTS)
 amqp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(amqp_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_AMQP_TRUE@am_amqp_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_APACHE_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_APACHE_TRUE@apache_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_APACHE_TRUE@	$(am__DEPENDENCIES_2)
+@BUILD_PLUGIN_APACHE_TRUE@	$(am__DEPENDENCIES_1)
 am__apache_la_SOURCES_DIST = apache.c
 @BUILD_PLUGIN_APACHE_TRUE@am_apache_la_OBJECTS = apache_la-apache.lo
 apache_la_OBJECTS = $(am_apache_la_OBJECTS)
 apache_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(apache_la_CFLAGS) \
 	$(CFLAGS) $(apache_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -413,14 +415,13 @@
 apple_sensors_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(apple_sensors_la_LDFLAGS) $(LDFLAGS) \
 	-o $@
 @BUILD_PLUGIN_APPLE_SENSORS_TRUE@am_apple_sensors_la_rpath = -rpath \
 @BUILD_PLUGIN_APPLE_SENSORS_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_AQUAERO_TRUE@	$(am__DEPENDENCIES_1)
+aquaero_la_DEPENDENCIES =
 am__aquaero_la_SOURCES_DIST = aquaero.c
 @BUILD_PLUGIN_AQUAERO_TRUE@am_aquaero_la_OBJECTS =  \
 @BUILD_PLUGIN_AQUAERO_TRUE@	aquaero_la-aquaero.lo
 aquaero_la_OBJECTS = $(am_aquaero_la_OBJECTS)
 aquaero_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(aquaero_la_CFLAGS) \
@@ -442,13 +443,13 @@
 barometer_la_OBJECTS = $(am_barometer_la_OBJECTS)
 barometer_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(barometer_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_BAROMETER_TRUE@am_barometer_la_rpath = -rpath \
 @BUILD_PLUGIN_BAROMETER_TRUE@	$(pkglibdir)
-battery_la_DEPENDENCIES =
+battery_la_LIBADD =
 am__battery_la_SOURCES_DIST = battery.c
 @BUILD_PLUGIN_BATTERY_TRUE@am_battery_la_OBJECTS = battery.lo
 battery_la_OBJECTS = $(am_battery_la_OBJECTS)
 battery_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(battery_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -475,12 +476,20 @@
 @BUILD_PLUGIN_CGROUPS_TRUE@am_cgroups_la_OBJECTS = cgroups.lo
 cgroups_la_OBJECTS = $(am_cgroups_la_OBJECTS)
 cgroups_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(cgroups_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CGROUPS_TRUE@am_cgroups_la_rpath = -rpath $(pkglibdir)
+chrony_la_LIBADD =
+am__chrony_la_SOURCES_DIST = chrony.c
+@BUILD_PLUGIN_CHRONY_TRUE@am_chrony_la_OBJECTS = chrony.lo
+chrony_la_OBJECTS = $(am_chrony_la_OBJECTS)
+chrony_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(chrony_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_CHRONY_TRUE@am_chrony_la_rpath = -rpath $(pkglibdir)
 conntrack_la_LIBADD =
 am__conntrack_la_SOURCES_DIST = conntrack.c
 @BUILD_PLUGIN_CONNTRACK_TRUE@am_conntrack_la_OBJECTS = conntrack.lo
 conntrack_la_OBJECTS = $(am_conntrack_la_OBJECTS)
 conntrack_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
@@ -496,16 +505,16 @@
 contextswitch_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(contextswitch_la_LDFLAGS) $(LDFLAGS) \
 	-o $@
 @BUILD_PLUGIN_CONTEXTSWITCH_TRUE@am_contextswitch_la_rpath = -rpath \
 @BUILD_PLUGIN_CONTEXTSWITCH_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_3 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_CPU_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_CPU_TRUE@cpu_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_CPU_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_CPU_TRUE@	$(am__DEPENDENCIES_3) \
+@BUILD_PLUGIN_CPU_TRUE@	$(am__DEPENDENCIES_2) \
 @BUILD_PLUGIN_CPU_TRUE@	$(am__DEPENDENCIES_1)
 am__cpu_la_SOURCES_DIST = cpu.c
 @BUILD_PLUGIN_CPU_TRUE@am_cpu_la_OBJECTS = cpu_la-cpu.lo
 cpu_la_OBJECTS = $(am_cpu_la_OBJECTS)
 cpu_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(cpu_la_CFLAGS) $(CFLAGS) \
@@ -516,48 +525,60 @@
 @BUILD_PLUGIN_CPUFREQ_TRUE@am_cpufreq_la_OBJECTS = cpufreq.lo
 cpufreq_la_OBJECTS = $(am_cpufreq_la_OBJECTS)
 cpufreq_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(cpufreq_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CPUFREQ_TRUE@am_cpufreq_la_rpath = -rpath $(pkglibdir)
+cpusleep_la_LIBADD =
+am__cpusleep_la_SOURCES_DIST = cpusleep.c
+@BUILD_PLUGIN_CPUSLEEP_TRUE@am_cpusleep_la_OBJECTS = cpusleep.lo
+cpusleep_la_OBJECTS = $(am_cpusleep_la_OBJECTS)
+cpusleep_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(cpusleep_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_CPUSLEEP_TRUE@am_cpusleep_la_rpath = -rpath $(pkglibdir)
 csv_la_LIBADD =
 am__csv_la_SOURCES_DIST = csv.c
 @BUILD_PLUGIN_CSV_TRUE@am_csv_la_OBJECTS = csv.lo
 csv_la_OBJECTS = $(am_csv_la_OBJECTS)
 csv_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(csv_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CSV_TRUE@am_csv_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_CURL_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__DEPENDENCIES_4 = $(am__DEPENDENCIES_1)
-@BUILD_PLUGIN_CURL_TRUE@curl_la_DEPENDENCIES = $(am__DEPENDENCIES_4)
-am__curl_la_SOURCES_DIST = curl.c
-@BUILD_PLUGIN_CURL_TRUE@am_curl_la_OBJECTS = curl_la-curl.lo
+@BUILD_PLUGIN_CURL_TRUE@curl_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
+am__curl_la_SOURCES_DIST = curl.c utils_curl_stats.c \
+	utils_curl_stats.h
+@BUILD_PLUGIN_CURL_TRUE@am_curl_la_OBJECTS = curl_la-curl.lo \
+@BUILD_PLUGIN_CURL_TRUE@	curl_la-utils_curl_stats.lo
 curl_la_OBJECTS = $(am_curl_la_OBJECTS)
 curl_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(curl_la_CFLAGS) \
 	$(CFLAGS) $(curl_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CURL_TRUE@am_curl_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_CURL_JSON_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__DEPENDENCIES_5 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_CURL_JSON_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_CURL_JSON_TRUE@	$(am__DEPENDENCIES_5)
-am__curl_json_la_SOURCES_DIST = curl_json.c
+@BUILD_PLUGIN_CURL_JSON_TRUE@	$(am__DEPENDENCIES_1)
+am__curl_json_la_SOURCES_DIST = curl_json.c utils_curl_stats.c \
+	utils_curl_stats.h
 @BUILD_PLUGIN_CURL_JSON_TRUE@am_curl_json_la_OBJECTS =  \
-@BUILD_PLUGIN_CURL_JSON_TRUE@	curl_json_la-curl_json.lo
+@BUILD_PLUGIN_CURL_JSON_TRUE@	curl_json_la-curl_json.lo \
+@BUILD_PLUGIN_CURL_JSON_TRUE@	curl_json_la-utils_curl_stats.lo
 curl_json_la_OBJECTS = $(am_curl_json_la_OBJECTS)
 curl_json_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(curl_json_la_CFLAGS) \
 	$(CFLAGS) $(curl_json_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CURL_JSON_TRUE@am_curl_json_la_rpath = -rpath \
 @BUILD_PLUGIN_CURL_JSON_TRUE@	$(pkglibdir)
 @BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_CURL_XML_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_CURL_XML_TRUE@	$(am__DEPENDENCIES_1)
-am__curl_xml_la_SOURCES_DIST = curl_xml.c
+am__curl_xml_la_SOURCES_DIST = curl_xml.c utils_curl_stats.c \
+	utils_curl_stats.h
 @BUILD_PLUGIN_CURL_XML_TRUE@am_curl_xml_la_OBJECTS =  \
-@BUILD_PLUGIN_CURL_XML_TRUE@	curl_xml_la-curl_xml.lo
+@BUILD_PLUGIN_CURL_XML_TRUE@	curl_xml_la-curl_xml.lo \
+@BUILD_PLUGIN_CURL_XML_TRUE@	curl_xml_la-utils_curl_stats.lo
 curl_xml_la_OBJECTS = $(am_curl_xml_la_OBJECTS)
 curl_xml_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(curl_xml_la_CFLAGS) \
 	$(CFLAGS) $(curl_xml_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_CURL_XML_TRUE@am_curl_xml_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_DBI_TRUE@dbi_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
@@ -574,18 +595,19 @@
 @BUILD_PLUGIN_DF_TRUE@am_df_la_OBJECTS = df.lo
 df_la_OBJECTS = $(am_df_la_OBJECTS)
 df_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(df_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_DF_TRUE@am_df_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_6 = $(am__DEPENDENCIES_1)
-@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__DEPENDENCIES_7 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_3 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_DISK_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am__DEPENDENCIES_4 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_DISK_TRUE@disk_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_6) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_7) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_3) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_4) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_DISK_TRUE@	$(am__DEPENDENCIES_1)
 am__disk_la_SOURCES_DIST = disk.c
 @BUILD_PLUGIN_DISK_TRUE@am_disk_la_OBJECTS = disk_la-disk.lo
 disk_la_OBJECTS = $(am_disk_la_OBJECTS)
 disk_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(disk_la_CFLAGS) \
@@ -596,21 +618,21 @@
 @BUILD_PLUGIN_DNS_TRUE@am_dns_la_OBJECTS = dns.lo utils_dns.lo
 dns_la_OBJECTS = $(am_dns_la_OBJECTS)
 dns_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(dns_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_DNS_TRUE@am_dns_la_rpath = -rpath $(pkglibdir)
-drbd_la_DEPENDENCIES =
+drbd_la_LIBADD =
 am__drbd_la_SOURCES_DIST = drbd.c
 @BUILD_PLUGIN_DRBD_TRUE@am_drbd_la_OBJECTS = drbd.lo
 drbd_la_OBJECTS = $(am_drbd_la_OBJECTS)
 drbd_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(drbd_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_DRBD_TRUE@am_drbd_la_rpath = -rpath $(pkglibdir)
-email_la_DEPENDENCIES =
+email_la_LIBADD =
 am__email_la_SOURCES_DIST = email.c
 @BUILD_PLUGIN_EMAIL_TRUE@am_email_la_OBJECTS = email.lo
 email_la_OBJECTS = $(am_email_la_OBJECTS)
 email_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(email_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -628,13 +650,13 @@
 @BUILD_PLUGIN_ETHSTAT_TRUE@am_ethstat_la_OBJECTS = ethstat.lo
 ethstat_la_OBJECTS = $(am_ethstat_la_OBJECTS)
 ethstat_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(ethstat_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_ETHSTAT_TRUE@am_ethstat_la_rpath = -rpath $(pkglibdir)
-exec_la_DEPENDENCIES =
+exec_la_LIBADD =
 am__exec_la_SOURCES_DIST = exec.c utils_cmd_putnotif.c \
 	utils_cmd_putnotif.h utils_cmd_putval.c utils_cmd_putval.h \
 	utils_parse_option.h utils_parse_option.c
 @BUILD_PLUGIN_EXEC_TRUE@am_exec_la_OBJECTS = exec.lo \
 @BUILD_PLUGIN_EXEC_TRUE@	utils_cmd_putnotif.lo \
 @BUILD_PLUGIN_EXEC_TRUE@	utils_cmd_putval.lo \
@@ -675,24 +697,45 @@
 @BUILD_PLUGIN_GMOND_TRUE@am_gmond_la_OBJECTS = gmond_la-gmond.lo
 gmond_la_OBJECTS = $(am_gmond_la_OBJECTS)
 gmond_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(gmond_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_GMOND_TRUE@am_gmond_la_rpath = -rpath $(pkglibdir)
+@BUILD_PLUGIN_GPS_TRUE@gps_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
+am__gps_la_SOURCES_DIST = gps.c
+@BUILD_PLUGIN_GPS_TRUE@am_gps_la_OBJECTS = gps_la-gps.lo
+gps_la_OBJECTS = $(am_gps_la_OBJECTS)
+gps_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(gps_la_CFLAGS) $(CFLAGS) \
+	$(gps_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_GPS_TRUE@am_gps_la_rpath = -rpath $(pkglibdir)
+@BUILD_PLUGIN_GRPC_TRUE@grpc_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
+@BUILD_PLUGIN_GRPC_TRUE@	$(am__DEPENDENCIES_1)
+am__grpc_la_SOURCES_DIST = grpc.cc
+@BUILD_PLUGIN_GRPC_TRUE@am_grpc_la_OBJECTS = grpc_la-grpc.lo
+@BUILD_PLUGIN_GRPC_TRUE@nodist_grpc_la_OBJECTS =  \
+@BUILD_PLUGIN_GRPC_TRUE@	grpc_la-collectd.grpc.pb.lo \
+@BUILD_PLUGIN_GRPC_TRUE@	grpc_la-collectd.pb.lo \
+@BUILD_PLUGIN_GRPC_TRUE@	grpc_la-types.pb.lo
+grpc_la_OBJECTS = $(am_grpc_la_OBJECTS) $(nodist_grpc_la_OBJECTS)
+grpc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
+	$(CXXFLAGS) $(grpc_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_GRPC_TRUE@am_grpc_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_HDDTEMP_TRUE@hddtemp_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_HDDTEMP_TRUE@	$(am__DEPENDENCIES_1)
 am__hddtemp_la_SOURCES_DIST = hddtemp.c
 @BUILD_PLUGIN_HDDTEMP_TRUE@am_hddtemp_la_OBJECTS = hddtemp.lo
 hddtemp_la_OBJECTS = $(am_hddtemp_la_OBJECTS)
 hddtemp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(hddtemp_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_HDDTEMP_TRUE@am_hddtemp_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_8 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_INTERFACE_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_5 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_INTERFACE_TRUE@interface_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__DEPENDENCIES_8) \
+@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__DEPENDENCIES_5) \
 @BUILD_PLUGIN_INTERFACE_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_INTERFACE_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_INTERFACE_TRUE@	$(am__DEPENDENCIES_1)
 am__interface_la_SOURCES_DIST = interface.c
 @BUILD_PLUGIN_INTERFACE_TRUE@am_interface_la_OBJECTS =  \
 @BUILD_PLUGIN_INTERFACE_TRUE@	interface_la-interface.lo
@@ -701,16 +744,16 @@
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(interface_la_CFLAGS) \
 	$(CFLAGS) $(interface_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_INTERFACE_TRUE@am_interface_la_rpath = -rpath \
 @BUILD_PLUGIN_INTERFACE_TRUE@	$(pkglibdir)
 ipc_la_LIBADD =
 am__ipc_la_SOURCES_DIST = ipc.c
-@BUILD_PLUGIN_IPC_TRUE@am_ipc_la_OBJECTS = ipc_la-ipc.lo
+@BUILD_PLUGIN_IPC_TRUE@am_ipc_la_OBJECTS = ipc.lo
 ipc_la_OBJECTS = $(am_ipc_la_OBJECTS)
 ipc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(ipc_la_CFLAGS) $(CFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(ipc_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_IPC_TRUE@am_ipc_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_IPMI_TRUE@ipmi_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__ipmi_la_SOURCES_DIST = ipmi.c
 @BUILD_PLUGIN_IPMI_TRUE@am_ipmi_la_OBJECTS = ipmi_la-ipmi.lo
 ipmi_la_OBJECTS = $(am_ipmi_la_OBJECTS)
@@ -749,20 +792,31 @@
 @BUILD_PLUGIN_JAVA_TRUE@am_java_la_OBJECTS = java_la-java.lo
 java_la_OBJECTS = $(am_java_la_OBJECTS)
 java_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(java_la_CFLAGS) \
 	$(CFLAGS) $(java_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_JAVA_TRUE@am_java_la_rpath = -rpath $(pkglibdir)
-liblookup_la_DEPENDENCIES = daemon/libavltree.la daemon/libcommon.la
+@BUILD_WITH_LIBYAJL_TRUE@am__DEPENDENCIES_6 = $(am__DEPENDENCIES_1)
+libformat_json_la_DEPENDENCIES = $(am__DEPENDENCIES_6)
+am_libformat_json_la_OBJECTS = libformat_json_la-utils_format_json.lo
+libformat_json_la_OBJECTS = $(am_libformat_json_la_OBJECTS)
+libformat_json_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
+	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
+	$(AM_CFLAGS) $(CFLAGS) $(libformat_json_la_LDFLAGS) $(LDFLAGS) \
+	-o $@
+liblatency_la_LIBADD =
+am_liblatency_la_OBJECTS = utils_latency.lo
+liblatency_la_OBJECTS = $(am_liblatency_la_OBJECTS)
+liblookup_la_DEPENDENCIES = daemon/libavltree.la
 am_liblookup_la_OBJECTS = utils_vl_lookup.lo
 liblookup_la_OBJECTS = $(am_liblookup_la_OBJECTS)
-libmount_la_DEPENDENCIES = daemon/libcommon.la
+libmount_la_LIBADD =
 am_libmount_la_OBJECTS = utils_mount.lo
 libmount_la_OBJECTS = $(am_libmount_la_OBJECTS)
-@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_9 = $(am__DEPENDENCIES_1)
-@BUILD_PLUGIN_LOAD_TRUE@load_la_DEPENDENCIES = $(am__DEPENDENCIES_9) \
+@BUILD_PLUGIN_LOAD_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_7 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_LOAD_TRUE@load_la_DEPENDENCIES = $(am__DEPENDENCIES_7) \
 @BUILD_PLUGIN_LOAD_TRUE@	$(am__DEPENDENCIES_1)
 am__load_la_SOURCES_DIST = load.c
 @BUILD_PLUGIN_LOAD_TRUE@am_load_la_OBJECTS = load_la-load.lo
 load_la_OBJECTS = $(am_load_la_OBJECTS)
 load_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(load_la_CFLAGS) \
@@ -772,14 +826,14 @@
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@	$(am__DEPENDENCIES_1)
 am__log_logstash_la_SOURCES_DIST = log_logstash.c
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@am_log_logstash_la_OBJECTS = log_logstash_la-log_logstash.lo
 log_logstash_la_OBJECTS = $(am_log_logstash_la_OBJECTS)
 log_logstash_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
-	$(log_logstash_la_CFLAGS) $(CFLAGS) $(log_logstash_la_LDFLAGS) \
-	$(LDFLAGS) -o $@
+	$(AM_CFLAGS) $(CFLAGS) $(log_logstash_la_LDFLAGS) $(LDFLAGS) \
+	-o $@
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@am_log_logstash_la_rpath = -rpath \
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@	$(pkglibdir)
 logfile_la_LIBADD =
 am__logfile_la_SOURCES_DIST = logfile.c
 @BUILD_PLUGIN_LOGFILE_TRUE@am_logfile_la_OBJECTS = logfile.lo
 logfile_la_OBJECTS = $(am_logfile_la_OBJECTS)
@@ -792,15 +846,24 @@
 @BUILD_PLUGIN_LPAR_TRUE@am_lpar_la_OBJECTS = lpar.lo
 lpar_la_OBJECTS = $(am_lpar_la_OBJECTS)
 lpar_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(lpar_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_LPAR_TRUE@am_lpar_la_rpath = -rpath $(pkglibdir)
+@BUILD_PLUGIN_LUA_TRUE@lua_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
+am__lua_la_SOURCES_DIST = lua.c utils_lua.c utils_lua.h
+@BUILD_PLUGIN_LUA_TRUE@am_lua_la_OBJECTS = lua_la-lua.lo \
+@BUILD_PLUGIN_LUA_TRUE@	lua_la-utils_lua.lo
+lua_la_OBJECTS = $(am_lua_la_OBJECTS)
+lua_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(lua_la_CFLAGS) $(CFLAGS) \
+	$(lua_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_LUA_TRUE@am_lua_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_LVM_TRUE@lvm_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__lvm_la_SOURCES_DIST = lvm.c
-@BUILD_PLUGIN_LVM_TRUE@am_lvm_la_OBJECTS = lvm.lo
+@BUILD_PLUGIN_LVM_TRUE@am_lvm_la_OBJECTS = lvm_la-lvm.lo
 lvm_la_OBJECTS = $(am_lvm_la_OBJECTS)
 lvm_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(lvm_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_LVM_TRUE@am_lvm_la_rpath = -rpath $(pkglibdir)
 madwifi_la_LIBADD =
@@ -901,17 +964,17 @@
 memcached_la_OBJECTS = $(am_memcached_la_OBJECTS)
 memcached_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(memcached_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_MEMCACHED_TRUE@am_memcached_la_rpath = -rpath \
 @BUILD_PLUGIN_MEMCACHED_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_10 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_MEMORY_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_8 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_MEMORY_TRUE@memory_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_MEMORY_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_MEMORY_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_MEMORY_TRUE@	$(am__DEPENDENCIES_10) \
+@BUILD_PLUGIN_MEMORY_TRUE@	$(am__DEPENDENCIES_8) \
 @BUILD_PLUGIN_MEMORY_TRUE@	$(am__DEPENDENCIES_1)
 am__memory_la_SOURCES_DIST = memory.c
 @BUILD_PLUGIN_MEMORY_TRUE@am_memory_la_OBJECTS = memory_la-memory.lo
 memory_la_OBJECTS = $(am_memory_la_OBJECTS)
 memory_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(memory_la_CFLAGS) \
@@ -931,25 +994,32 @@
 @BUILD_PLUGIN_MODBUS_TRUE@am_modbus_la_OBJECTS = modbus_la-modbus.lo
 modbus_la_OBJECTS = $(am_modbus_la_OBJECTS)
 modbus_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(modbus_la_CFLAGS) \
 	$(CFLAGS) $(modbus_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_MODBUS_TRUE@am_modbus_la_rpath = -rpath $(pkglibdir)
+@BUILD_PLUGIN_MQTT_TRUE@mqtt_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
+am__mqtt_la_SOURCES_DIST = mqtt.c
+@BUILD_PLUGIN_MQTT_TRUE@am_mqtt_la_OBJECTS = mqtt_la-mqtt.lo
+mqtt_la_OBJECTS = $(am_mqtt_la_OBJECTS)
+mqtt_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(mqtt_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_MQTT_TRUE@am_mqtt_la_rpath = -rpath $(pkglibdir)
 multimeter_la_LIBADD =
 am__multimeter_la_SOURCES_DIST = multimeter.c
 @BUILD_PLUGIN_MULTIMETER_TRUE@am_multimeter_la_OBJECTS =  \
 @BUILD_PLUGIN_MULTIMETER_TRUE@	multimeter.lo
 multimeter_la_OBJECTS = $(am_multimeter_la_OBJECTS)
 multimeter_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(multimeter_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_MULTIMETER_TRUE@am_multimeter_la_rpath = -rpath \
 @BUILD_PLUGIN_MULTIMETER_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_MYSQL_TRUE@@BUILD_WITH_LIBMYSQL_TRUE@am__DEPENDENCIES_11 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_MYSQL_TRUE@mysql_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_MYSQL_TRUE@	$(am__DEPENDENCIES_11)
+@BUILD_PLUGIN_MYSQL_TRUE@	$(am__DEPENDENCIES_1)
 am__mysql_la_SOURCES_DIST = mysql.c
 @BUILD_PLUGIN_MYSQL_TRUE@am_mysql_la_OBJECTS = mysql_la-mysql.lo
 mysql_la_OBJECTS = $(am_mysql_la_OBJECTS)
 mysql_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(mysql_la_CFLAGS) \
 	$(CFLAGS) $(mysql_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -970,16 +1040,16 @@
 @BUILD_PLUGIN_NETLINK_TRUE@	netlink_la-netlink.lo
 netlink_la_OBJECTS = $(am_netlink_la_OBJECTS)
 netlink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(netlink_la_CFLAGS) \
 	$(CFLAGS) $(netlink_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_NETLINK_TRUE@am_netlink_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__DEPENDENCIES_12 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_NETWORK_TRUE@@BUILD_WITH_LIBGCRYPT_TRUE@am__DEPENDENCIES_9 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_NETWORK_TRUE@network_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_NETWORK_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_NETWORK_TRUE@	$(am__DEPENDENCIES_12)
+@BUILD_PLUGIN_NETWORK_TRUE@	$(am__DEPENDENCIES_9)
 am__network_la_SOURCES_DIST = network.c network.h utils_fbhash.c \
 	utils_fbhash.h
 @BUILD_PLUGIN_NETWORK_TRUE@am_network_la_OBJECTS =  \
 @BUILD_PLUGIN_NETWORK_TRUE@	network_la-network.lo \
 @BUILD_PLUGIN_NETWORK_TRUE@	network_la-utils_fbhash.lo
 network_la_OBJECTS = $(am_network_la_OBJECTS)
@@ -992,15 +1062,14 @@
 @BUILD_PLUGIN_NFS_TRUE@am_nfs_la_OBJECTS = nfs.lo
 nfs_la_OBJECTS = $(am_nfs_la_OBJECTS)
 nfs_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(nfs_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_NFS_TRUE@am_nfs_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_NGINX_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__DEPENDENCIES_13 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_NGINX_TRUE@nginx_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_NGINX_TRUE@	$(am__DEPENDENCIES_13)
+@BUILD_PLUGIN_NGINX_TRUE@	$(am__DEPENDENCIES_1)
 am__nginx_la_SOURCES_DIST = nginx.c
 @BUILD_PLUGIN_NGINX_TRUE@am_nginx_la_OBJECTS = nginx_la-nginx.lo
 nginx_la_OBJECTS = $(am_nginx_la_OBJECTS)
 nginx_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(nginx_la_CFLAGS) \
 	$(CFLAGS) $(nginx_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -1024,12 +1093,23 @@
 notify_email_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(notify_email_la_LDFLAGS) $(LDFLAGS) \
 	-o $@
 @BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@am_notify_email_la_rpath = -rpath \
 @BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@	$(pkglibdir)
+notify_nagios_la_LIBADD =
+am__notify_nagios_la_SOURCES_DIST = notify_nagios.c
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@am_notify_nagios_la_OBJECTS =  \
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@	notify_nagios.lo
+notify_nagios_la_OBJECTS = $(am_notify_nagios_la_OBJECTS)
+notify_nagios_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
+	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
+	$(AM_CFLAGS) $(CFLAGS) $(notify_nagios_la_LDFLAGS) $(LDFLAGS) \
+	-o $@
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@am_notify_nagios_la_rpath = -rpath \
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@	$(pkglibdir)
 @BUILD_PLUGIN_NTPD_TRUE@ntpd_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__ntpd_la_SOURCES_DIST = ntpd.c
 @BUILD_PLUGIN_NTPD_TRUE@am_ntpd_la_OBJECTS = ntpd.lo
 ntpd_la_OBJECTS = $(am_ntpd_la_OBJECTS)
 ntpd_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
@@ -1064,43 +1144,42 @@
 @BUILD_PLUGIN_ONEWIRE_TRUE@	$(am__DEPENDENCIES_1)
 am__onewire_la_SOURCES_DIST = onewire.c
 @BUILD_PLUGIN_ONEWIRE_TRUE@am_onewire_la_OBJECTS =  \
 @BUILD_PLUGIN_ONEWIRE_TRUE@	onewire_la-onewire.lo
 onewire_la_OBJECTS = $(am_onewire_la_OBJECTS)
 onewire_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(onewire_la_CFLAGS) \
-	$(CFLAGS) $(onewire_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(onewire_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_ONEWIRE_TRUE@am_onewire_la_rpath = -rpath $(pkglibdir)
 openldap_la_DEPENDENCIES =
 am__openldap_la_SOURCES_DIST = openldap.c
 @BUILD_PLUGIN_OPENLDAP_TRUE@am_openldap_la_OBJECTS =  \
 @BUILD_PLUGIN_OPENLDAP_TRUE@	openldap_la-openldap.lo
 openldap_la_OBJECTS = $(am_openldap_la_OBJECTS)
 openldap_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(openldap_la_CFLAGS) \
-	$(CFLAGS) $(openldap_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(openldap_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_OPENLDAP_TRUE@am_openldap_la_rpath = -rpath $(pkglibdir)
 openvpn_la_LIBADD =
 am__openvpn_la_SOURCES_DIST = openvpn.c
-@BUILD_PLUGIN_OPENVPN_TRUE@am_openvpn_la_OBJECTS =  \
-@BUILD_PLUGIN_OPENVPN_TRUE@	openvpn_la-openvpn.lo
+@BUILD_PLUGIN_OPENVPN_TRUE@am_openvpn_la_OBJECTS = openvpn.lo
 openvpn_la_OBJECTS = $(am_openvpn_la_OBJECTS)
 openvpn_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(openvpn_la_CFLAGS) \
-	$(CFLAGS) $(openvpn_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(openvpn_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_OPENVPN_TRUE@am_openvpn_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_ORACLE_TRUE@oracle_la_DEPENDENCIES =  \
 @BUILD_PLUGIN_ORACLE_TRUE@	$(am__DEPENDENCIES_1)
 am__oracle_la_SOURCES_DIST = oracle.c utils_db_query.c \
 	utils_db_query.h
 @BUILD_PLUGIN_ORACLE_TRUE@am_oracle_la_OBJECTS = oracle_la-oracle.lo \
 @BUILD_PLUGIN_ORACLE_TRUE@	oracle_la-utils_db_query.lo
 oracle_la_OBJECTS = $(am_oracle_la_OBJECTS)
 oracle_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(oracle_la_CFLAGS) \
-	$(CFLAGS) $(oracle_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(oracle_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_ORACLE_TRUE@am_oracle_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_PERL_TRUE@perl_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__perl_la_SOURCES_DIST = perl.c
 @BUILD_PLUGIN_PERL_TRUE@am_perl_la_OBJECTS = perl_la-perl.lo
 perl_la_OBJECTS = $(am_perl_la_OBJECTS)
 perl_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
@@ -1112,16 +1191,18 @@
 @BUILD_PLUGIN_PF_TRUE@am_pf_la_OBJECTS = pf.lo
 pf_la_OBJECTS = $(am_pf_la_OBJECTS)
 pf_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(pf_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_PF_TRUE@am_pf_la_rpath = -rpath $(pkglibdir)
-pinba_la_DEPENDENCIES =
+@BUILD_PLUGIN_PINBA_TRUE@pinba_la_DEPENDENCIES =  \
+@BUILD_PLUGIN_PINBA_TRUE@	$(am__DEPENDENCIES_1)
 am__pinba_la_SOURCES_DIST = pinba.c
-@BUILD_PLUGIN_PINBA_TRUE@am_pinba_la_OBJECTS = pinba.lo
-@BUILD_PLUGIN_PINBA_TRUE@nodist_pinba_la_OBJECTS = pinba.pb-c.lo
+@BUILD_PLUGIN_PINBA_TRUE@am_pinba_la_OBJECTS = pinba_la-pinba.lo
+@BUILD_PLUGIN_PINBA_TRUE@nodist_pinba_la_OBJECTS =  \
+@BUILD_PLUGIN_PINBA_TRUE@	pinba_la-pinba.pb-c.lo
 pinba_la_OBJECTS = $(am_pinba_la_OBJECTS) $(nodist_pinba_la_OBJECTS)
 pinba_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(pinba_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_PINBA_TRUE@am_pinba_la_rpath = -rpath $(pkglibdir)
 ping_la_DEPENDENCIES =
@@ -1168,22 +1249,21 @@
 protocols_la_OBJECTS = $(am_protocols_la_OBJECTS)
 protocols_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(protocols_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_PROTOCOLS_TRUE@am_protocols_la_rpath = -rpath \
 @BUILD_PLUGIN_PROTOCOLS_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_PYTHON_TRUE@python_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_PYTHON_TRUE@	$(am__DEPENDENCIES_1)
+python_la_LIBADD =
 am__python_la_SOURCES_DIST = python.c pyconfig.c pyvalues.c cpython.h
 @BUILD_PLUGIN_PYTHON_TRUE@am_python_la_OBJECTS = python_la-python.lo \
 @BUILD_PLUGIN_PYTHON_TRUE@	python_la-pyconfig.lo \
 @BUILD_PLUGIN_PYTHON_TRUE@	python_la-pyvalues.lo
 python_la_OBJECTS = $(am_python_la_OBJECTS)
 python_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(python_la_CFLAGS) \
-	$(CFLAGS) $(python_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(python_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_PYTHON_TRUE@am_python_la_rpath = -rpath $(pkglibdir)
 redis_la_DEPENDENCIES =
 am__redis_la_SOURCES_DIST = redis.c
 @BUILD_PLUGIN_REDIS_TRUE@am_redis_la_OBJECTS = redis_la-redis.lo
 redis_la_OBJECTS = $(am_redis_la_OBJECTS)
 redis_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
@@ -1238,13 +1318,14 @@
 @BUILD_PLUGIN_SERIAL_TRUE@am_serial_la_OBJECTS = serial.lo
 serial_la_OBJECTS = $(am_serial_la_OBJECTS)
 serial_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(serial_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_SERIAL_TRUE@am_serial_la_rpath = -rpath $(pkglibdir)
-sigrok_la_DEPENDENCIES =
+@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_DEPENDENCIES =  \
+@BUILD_PLUGIN_SIGROK_TRUE@	$(am__DEPENDENCIES_1)
 am__sigrok_la_SOURCES_DIST = sigrok.c
 @BUILD_PLUGIN_SIGROK_TRUE@am_sigrok_la_OBJECTS = sigrok_la-sigrok.lo
 sigrok_la_OBJECTS = $(am_sigrok_la_OBJECTS)
 sigrok_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(sigrok_la_CFLAGS) \
 	$(CFLAGS) $(sigrok_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -1257,36 +1338,33 @@
 smart_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(smart_la_CFLAGS) \
 	$(CFLAGS) $(smart_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@am_smart_la_rpath =  \
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@	-rpath \
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_SNMP_TRUE@@BUILD_WITH_LIBNETSNMP_TRUE@am__DEPENDENCIES_14 = $(am__DEPENDENCIES_1)
-@BUILD_PLUGIN_SNMP_TRUE@snmp_la_DEPENDENCIES = $(am__DEPENDENCIES_14) \
-@BUILD_PLUGIN_SNMP_TRUE@	$(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_SNMP_TRUE@snmp_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__snmp_la_SOURCES_DIST = snmp.c
 @BUILD_PLUGIN_SNMP_TRUE@am_snmp_la_OBJECTS = snmp_la-snmp.lo
 snmp_la_OBJECTS = $(am_snmp_la_OBJECTS)
 snmp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(snmp_la_CFLAGS) \
-	$(CFLAGS) $(snmp_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(snmp_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_SNMP_TRUE@am_snmp_la_rpath = -rpath $(pkglibdir)
-statsd_la_DEPENDENCIES =
-am__statsd_la_SOURCES_DIST = statsd.c utils_latency.h utils_latency.c
-@BUILD_PLUGIN_STATSD_TRUE@am_statsd_la_OBJECTS = statsd.lo \
-@BUILD_PLUGIN_STATSD_TRUE@	utils_latency.lo
+@BUILD_PLUGIN_STATSD_TRUE@statsd_la_DEPENDENCIES = liblatency.la
+am__statsd_la_SOURCES_DIST = statsd.c
+@BUILD_PLUGIN_STATSD_TRUE@am_statsd_la_OBJECTS = statsd.lo
 statsd_la_OBJECTS = $(am_statsd_la_OBJECTS)
 statsd_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(statsd_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_STATSD_TRUE@am_statsd_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_15 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_SWAP_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_10 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_SWAP_TRUE@swap_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_SWAP_TRUE@	$(am__DEPENDENCIES_1) \
 @BUILD_PLUGIN_SWAP_TRUE@	$(am__DEPENDENCIES_1) \
-@BUILD_PLUGIN_SWAP_TRUE@	$(am__DEPENDENCIES_15) \
+@BUILD_PLUGIN_SWAP_TRUE@	$(am__DEPENDENCIES_10) \
 @BUILD_PLUGIN_SWAP_TRUE@	$(am__DEPENDENCIES_1)
 am__swap_la_SOURCES_DIST = swap.c
 @BUILD_PLUGIN_SWAP_TRUE@am_swap_la_OBJECTS = swap_la-swap.lo
 swap_la_OBJECTS = $(am_swap_la_OBJECTS)
 swap_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(swap_la_CFLAGS) \
@@ -1449,13 +1527,13 @@
 turbostat_la_OBJECTS = $(am_turbostat_la_OBJECTS)
 turbostat_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(turbostat_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_TURBOSTAT_TRUE@am_turbostat_la_rpath = -rpath \
 @BUILD_PLUGIN_TURBOSTAT_TRUE@	$(pkglibdir)
-unixsock_la_DEPENDENCIES =
+unixsock_la_LIBADD =
 am__unixsock_la_SOURCES_DIST = unixsock.c utils_cmd_flush.h \
 	utils_cmd_flush.c utils_cmd_getval.h utils_cmd_getval.c \
 	utils_cmd_getthreshold.h utils_cmd_getthreshold.c \
 	utils_cmd_listval.h utils_cmd_listval.c utils_cmd_putval.h \
 	utils_cmd_putval.c utils_cmd_putnotif.h utils_cmd_putnotif.c \
 	utils_parse_option.h utils_parse_option.c
@@ -1479,15 +1557,15 @@
 @BUILD_PLUGIN_UPTIME_TRUE@am_uptime_la_OBJECTS = uptime_la-uptime.lo
 uptime_la_OBJECTS = $(am_uptime_la_OBJECTS)
 uptime_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(uptime_la_CFLAGS) \
 	$(CFLAGS) $(uptime_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_UPTIME_TRUE@am_uptime_la_rpath = -rpath $(pkglibdir)
-@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_16 = $(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_USERS_TRUE@@BUILD_WITH_LIBSTATGRAB_TRUE@am__DEPENDENCIES_11 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_USERS_TRUE@users_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_USERS_TRUE@	$(am__DEPENDENCIES_16)
+@BUILD_PLUGIN_USERS_TRUE@	$(am__DEPENDENCIES_11)
 am__users_la_SOURCES_DIST = users.c
 @BUILD_PLUGIN_USERS_TRUE@am_users_la_OBJECTS = users_la-users.lo
 users_la_OBJECTS = $(am_users_la_OBJECTS)
 users_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(users_la_CFLAGS) \
 	$(CFLAGS) $(users_la_LDFLAGS) $(LDFLAGS) -o $@
@@ -1540,51 +1618,50 @@
 @BUILD_PLUGIN_WIRELESS_TRUE@am_wireless_la_OBJECTS = wireless.lo
 wireless_la_OBJECTS = $(am_wireless_la_OBJECTS)
 wireless_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(wireless_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_WIRELESS_TRUE@am_wireless_la_rpath = -rpath $(pkglibdir)
-write_graphite_la_LIBADD =
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@write_graphite_la_DEPENDENCIES =  \
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	libformat_json.la
 am__write_graphite_la_SOURCES_DIST = write_graphite.c \
-	utils_format_graphite.c utils_format_graphite.h \
-	utils_format_json.c utils_format_json.h
+	utils_format_graphite.c utils_format_graphite.h
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@am_write_graphite_la_OBJECTS =  \
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	write_graphite.lo \
-@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	utils_format_graphite.lo \
-@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	utils_format_json.lo
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	utils_format_graphite.lo
 write_graphite_la_OBJECTS = $(am_write_graphite_la_OBJECTS)
 write_graphite_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(write_graphite_la_LDFLAGS) $(LDFLAGS) \
 	-o $@
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@am_write_graphite_la_rpath = -rpath \
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@@BUILD_WITH_LIBCURL_TRUE@am__DEPENDENCIES_17 = $(am__DEPENDENCIES_1)
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@	$(am__DEPENDENCIES_17)
-am__write_http_la_SOURCES_DIST = write_http.c utils_format_json.c \
-	utils_format_json.h
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@	$(am__DEPENDENCIES_1) \
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@	libformat_json.la
+am__write_http_la_SOURCES_DIST = write_http.c utils_format_kairosdb.c \
+	utils_format_kairosdb.h
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@am_write_http_la_OBJECTS =  \
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@	write_http_la-write_http.lo \
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@	write_http_la-utils_format_json.lo
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@	write_http_la-utils_format_kairosdb.lo
 write_http_la_OBJECTS = $(am_write_http_la_OBJECTS)
 write_http_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(write_http_la_CFLAGS) \
 	$(CFLAGS) $(write_http_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@am_write_http_la_rpath = -rpath \
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@	$(pkglibdir)
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_DEPENDENCIES =  \
-@BUILD_PLUGIN_WRITE_KAFKA_TRUE@	$(am__DEPENDENCIES_1)
+@BUILD_PLUGIN_WRITE_KAFKA_TRUE@	$(am__DEPENDENCIES_1) \
+@BUILD_PLUGIN_WRITE_KAFKA_TRUE@	libformat_json.la
 am__write_kafka_la_SOURCES_DIST = write_kafka.c \
 	utils_format_graphite.c utils_format_graphite.h \
-	utils_format_json.c utils_format_json.h utils_cmd_putval.c \
-	utils_cmd_putval.h utils_crc32.c utils_crc32.h
+	utils_cmd_putval.c utils_cmd_putval.h utils_crc32.c \
+	utils_crc32.h
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@am_write_kafka_la_OBJECTS =  \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@	write_kafka_la-write_kafka.lo \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@	write_kafka_la-utils_format_graphite.lo \
-@BUILD_PLUGIN_WRITE_KAFKA_TRUE@	write_kafka_la-utils_format_json.lo \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@	write_kafka_la-utils_cmd_putval.lo \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@	write_kafka_la-utils_crc32.lo
 write_kafka_la_OBJECTS = $(am_write_kafka_la_OBJECTS)
 write_kafka_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(write_kafka_la_LDFLAGS) $(LDFLAGS) -o \
@@ -1616,30 +1693,26 @@
 am__write_redis_la_SOURCES_DIST = write_redis.c
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@am_write_redis_la_OBJECTS =  \
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@	write_redis_la-write_redis.lo
 write_redis_la_OBJECTS = $(am_write_redis_la_OBJECTS)
 write_redis_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
-	$(write_redis_la_CFLAGS) $(CFLAGS) $(write_redis_la_LDFLAGS) \
-	$(LDFLAGS) -o $@
+	$(AM_CFLAGS) $(CFLAGS) $(write_redis_la_LDFLAGS) $(LDFLAGS) -o \
+	$@
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@am_write_redis_la_rpath = -rpath \
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@	$(pkglibdir)
-write_riemann_la_DEPENDENCIES =
+write_riemann_la_LIBADD =
 am__write_riemann_la_SOURCES_DIST = write_riemann.c \
 	write_riemann_threshold.c write_riemann_threshold.h
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am_write_riemann_la_OBJECTS =  \
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	write_riemann.lo \
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	write_riemann_threshold.lo
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@nodist_write_riemann_la_OBJECTS =  \
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	riemann.pb-c.lo
-write_riemann_la_OBJECTS = $(am_write_riemann_la_OBJECTS) \
-	$(nodist_write_riemann_la_OBJECTS)
+@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am_write_riemann_la_OBJECTS = write_riemann_la-write_riemann.lo \
+@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	write_riemann_la-write_riemann_threshold.lo
+write_riemann_la_OBJECTS = $(am_write_riemann_la_OBJECTS)
 write_riemann_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
-	$(AM_CFLAGS) $(CFLAGS) $(write_riemann_la_LDFLAGS) $(LDFLAGS) \
-	-o $@
+	$(write_riemann_la_CFLAGS) $(CFLAGS) \
+	$(write_riemann_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_WRITE_RIEMANN_TRUE@am_write_riemann_la_rpath = -rpath \
 @BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	$(pkglibdir)
 write_sensu_la_LIBADD =
 am__write_sensu_la_SOURCES_DIST = write_sensu.c
 @BUILD_PLUGIN_WRITE_SENSU_TRUE@am_write_sensu_la_OBJECTS =  \
 @BUILD_PLUGIN_WRITE_SENSU_TRUE@	write_sensu.lo
@@ -1657,62 +1730,96 @@
 write_tsdb_la_OBJECTS = $(am_write_tsdb_la_OBJECTS)
 write_tsdb_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(write_tsdb_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_WRITE_TSDB_TRUE@am_write_tsdb_la_rpath = -rpath \
 @BUILD_PLUGIN_WRITE_TSDB_TRUE@	$(pkglibdir)
+xencpu_la_DEPENDENCIES =
+am__xencpu_la_SOURCES_DIST = xencpu.c
+@BUILD_PLUGIN_XENCPU_TRUE@am_xencpu_la_OBJECTS = xencpu_la-xencpu.lo
+xencpu_la_OBJECTS = $(am_xencpu_la_OBJECTS)
+xencpu_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(xencpu_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_XENCPU_TRUE@am_xencpu_la_rpath = -rpath $(pkglibdir)
 @BUILD_PLUGIN_XMMS_TRUE@xmms_la_DEPENDENCIES = $(am__DEPENDENCIES_1)
 am__xmms_la_SOURCES_DIST = xmms.c
 @BUILD_PLUGIN_XMMS_TRUE@am_xmms_la_OBJECTS = xmms_la-xmms.lo
 xmms_la_OBJECTS = $(am_xmms_la_OBJECTS)
 xmms_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(xmms_la_CFLAGS) \
 	$(CFLAGS) $(xmms_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_XMMS_TRUE@am_xmms_la_rpath = -rpath $(pkglibdir)
 zfs_arc_la_DEPENDENCIES =
 am__zfs_arc_la_SOURCES_DIST = zfs_arc.c
-@BUILD_PLUGIN_ZFS_ARC_TRUE@am_zfs_arc_la_OBJECTS =  \
-@BUILD_PLUGIN_ZFS_ARC_TRUE@	zfs_arc_la-zfs_arc.lo
+@BUILD_PLUGIN_ZFS_ARC_TRUE@am_zfs_arc_la_OBJECTS = zfs_arc.lo
 zfs_arc_la_OBJECTS = $(am_zfs_arc_la_OBJECTS)
 zfs_arc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
-	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(zfs_arc_la_CFLAGS) \
-	$(CFLAGS) $(zfs_arc_la_LDFLAGS) $(LDFLAGS) -o $@
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(zfs_arc_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_ZFS_ARC_TRUE@am_zfs_arc_la_rpath = -rpath $(pkglibdir)
+zone_la_LIBADD =
+am__zone_la_SOURCES_DIST = zone.c
+@BUILD_PLUGIN_ZONE_TRUE@am_zone_la_OBJECTS = zone.lo
+zone_la_OBJECTS = $(am_zone_la_OBJECTS)
+zone_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(zone_la_LDFLAGS) $(LDFLAGS) -o $@
+@BUILD_PLUGIN_ZONE_TRUE@am_zone_la_rpath = -rpath $(pkglibdir)
 zookeeper_la_LIBADD =
 am__zookeeper_la_SOURCES_DIST = zookeeper.c
 @BUILD_PLUGIN_ZOOKEEPER_TRUE@am_zookeeper_la_OBJECTS = zookeeper.lo
 zookeeper_la_OBJECTS = $(am_zookeeper_la_OBJECTS)
 zookeeper_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(zookeeper_la_LDFLAGS) $(LDFLAGS) -o $@
 @BUILD_PLUGIN_ZOOKEEPER_TRUE@am_zookeeper_la_rpath = -rpath \
 @BUILD_PLUGIN_ZOOKEEPER_TRUE@	$(pkglibdir)
-@BUILD_PLUGIN_CEPH_TRUE@am__EXEEXT_1 = test_plugin_ceph$(EXEEXT)
+@BUILD_WITH_LIBYAJL_TRUE@am__EXEEXT_1 = test_format_json$(EXEEXT)
+@BUILD_PLUGIN_CEPH_TRUE@am__EXEEXT_2 = test_plugin_ceph$(EXEEXT)
 PROGRAMS = $(bin_PROGRAMS) $(sbin_PROGRAMS)
 am_collectd_nagios_OBJECTS =  \
 	collectd_nagios-collectd-nagios.$(OBJEXT)
 collectd_nagios_OBJECTS = $(am_collectd_nagios_OBJECTS)
+collectd_nagios_DEPENDENCIES = libcollectdclient/libcollectdclient.la \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am_collectd_tg_OBJECTS = collectd_tg-collectd-tg.$(OBJEXT)
 collectd_tg_OBJECTS = $(am_collectd_tg_OBJECTS)
+collectd_tg_DEPENDENCIES = $(am__DEPENDENCIES_1) daemon/libheap.la \
+	libcollectdclient/libcollectdclient.la $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am_collectdctl_OBJECTS = collectdctl-collectdctl.$(OBJEXT)
 collectdctl_OBJECTS = $(am_collectdctl_OBJECTS)
-am_collectdmon_OBJECTS = collectdmon-collectdmon.$(OBJEXT)
+collectdctl_DEPENDENCIES = libcollectdclient/libcollectdclient.la \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
+am_collectdmon_OBJECTS = collectdmon.$(OBJEXT)
 collectdmon_OBJECTS = $(am_collectdmon_OBJECTS)
 collectdmon_LDADD = $(LDADD)
+am__test_format_json_SOURCES_DIST = utils_format_json_test.c testing.h
+@BUILD_WITH_LIBYAJL_TRUE@am_test_format_json_OBJECTS =  \
+@BUILD_WITH_LIBYAJL_TRUE@	utils_format_json_test.$(OBJEXT)
+test_format_json_OBJECTS = $(am_test_format_json_OBJECTS)
+@BUILD_WITH_LIBYAJL_TRUE@test_format_json_DEPENDENCIES =  \
+@BUILD_WITH_LIBYAJL_TRUE@	libformat_json.la \
+@BUILD_WITH_LIBYAJL_TRUE@	daemon/libmetadata.la \
+@BUILD_WITH_LIBYAJL_TRUE@	daemon/libplugin_mock.la
 am__test_plugin_ceph_SOURCES_DIST = ceph_test.c
 @BUILD_PLUGIN_CEPH_TRUE@am_test_plugin_ceph_OBJECTS =  \
 @BUILD_PLUGIN_CEPH_TRUE@	test_plugin_ceph-ceph_test.$(OBJEXT)
 test_plugin_ceph_OBJECTS = $(am_test_plugin_ceph_OBJECTS)
 @BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_DEPENDENCIES =  \
-@BUILD_PLUGIN_CEPH_TRUE@	daemon/libcommon.la \
 @BUILD_PLUGIN_CEPH_TRUE@	daemon/libplugin_mock.la \
 @BUILD_PLUGIN_CEPH_TRUE@	$(am__DEPENDENCIES_1)
 test_plugin_ceph_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(test_plugin_ceph_LDFLAGS) $(LDFLAGS) \
 	-o $@
+am_test_utils_latency_OBJECTS = utils_latency_test.$(OBJEXT)
+test_utils_latency_OBJECTS = $(am_test_utils_latency_OBJECTS)
+test_utils_latency_DEPENDENCIES = liblatency.la \
+	daemon/libplugin_mock.la
 am_test_utils_mount_OBJECTS = utils_mount_test.$(OBJEXT)
 test_utils_mount_OBJECTS = $(am_test_utils_mount_OBJECTS)
 test_utils_mount_DEPENDENCIES = libmount.la daemon/libplugin_mock.la \
 	$(am__DEPENDENCIES_1)
 am_test_utils_vl_lookup_OBJECTS = utils_vl_lookup_test.$(OBJEXT)
 test_utils_vl_lookup_OBJECTS = $(am_test_utils_vl_lookup_OBJECTS)
@@ -1749,120 +1856,148 @@
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
 am__v_CCLD_0 = @echo "  CCLD    " $@;
 am__v_CCLD_1 = 
+CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
+	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
+LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+	$(AM_CXXFLAGS) $(CXXFLAGS)
+AM_V_CXX = $(am__v_CXX_@AM_V@)
+am__v_CXX_ = $(am__v_CXX_@AM_DEFAULT_V@)
+am__v_CXX_0 = @echo "  CXX     " $@;
+am__v_CXX_1 = 
+CXXLD = $(CXX)
+CXXLINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
+	$(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_CXXLD = $(am__v_CXXLD_@AM_V@)
+am__v_CXXLD_ = $(am__v_CXXLD_@AM_DEFAULT_V@)
+am__v_CXXLD_0 = @echo "  CXXLD   " $@;
+am__v_CXXLD_1 = 
 SOURCES = $(aggregation_la_SOURCES) $(amqp_la_SOURCES) \
 	$(apache_la_SOURCES) $(apcups_la_SOURCES) \
 	$(apple_sensors_la_SOURCES) $(aquaero_la_SOURCES) \
 	$(ascent_la_SOURCES) $(barometer_la_SOURCES) \
 	$(battery_la_SOURCES) $(bind_la_SOURCES) $(ceph_la_SOURCES) \
-	$(cgroups_la_SOURCES) $(conntrack_la_SOURCES) \
-	$(contextswitch_la_SOURCES) $(cpu_la_SOURCES) \
-	$(cpufreq_la_SOURCES) $(csv_la_SOURCES) $(curl_la_SOURCES) \
-	$(curl_json_la_SOURCES) $(curl_xml_la_SOURCES) \
-	$(dbi_la_SOURCES) $(df_la_SOURCES) $(disk_la_SOURCES) \
-	$(dns_la_SOURCES) $(drbd_la_SOURCES) $(email_la_SOURCES) \
-	$(entropy_la_SOURCES) $(ethstat_la_SOURCES) $(exec_la_SOURCES) \
-	$(fhcount_la_SOURCES) $(filecount_la_SOURCES) \
-	$(fscache_la_SOURCES) $(gmond_la_SOURCES) \
-	$(hddtemp_la_SOURCES) $(interface_la_SOURCES) \
-	$(ipc_la_SOURCES) $(ipmi_la_SOURCES) $(iptables_la_SOURCES) \
-	$(ipvs_la_SOURCES) $(irq_la_SOURCES) $(java_la_SOURCES) \
-	$(liblookup_la_SOURCES) $(libmount_la_SOURCES) \
-	$(load_la_SOURCES) $(log_logstash_la_SOURCES) \
-	$(logfile_la_SOURCES) $(lpar_la_SOURCES) $(lvm_la_SOURCES) \
+	$(cgroups_la_SOURCES) $(chrony_la_SOURCES) \
+	$(conntrack_la_SOURCES) $(contextswitch_la_SOURCES) \
+	$(cpu_la_SOURCES) $(cpufreq_la_SOURCES) $(cpusleep_la_SOURCES) \
+	$(csv_la_SOURCES) $(curl_la_SOURCES) $(curl_json_la_SOURCES) \
+	$(curl_xml_la_SOURCES) $(dbi_la_SOURCES) $(df_la_SOURCES) \
+	$(disk_la_SOURCES) $(dns_la_SOURCES) $(drbd_la_SOURCES) \
+	$(email_la_SOURCES) $(entropy_la_SOURCES) \
+	$(ethstat_la_SOURCES) $(exec_la_SOURCES) $(fhcount_la_SOURCES) \
+	$(filecount_la_SOURCES) $(fscache_la_SOURCES) \
+	$(gmond_la_SOURCES) $(gps_la_SOURCES) $(grpc_la_SOURCES) \
+	$(nodist_grpc_la_SOURCES) $(hddtemp_la_SOURCES) \
+	$(interface_la_SOURCES) $(ipc_la_SOURCES) $(ipmi_la_SOURCES) \
+	$(iptables_la_SOURCES) $(ipvs_la_SOURCES) $(irq_la_SOURCES) \
+	$(java_la_SOURCES) $(libformat_json_la_SOURCES) \
+	$(liblatency_la_SOURCES) $(liblookup_la_SOURCES) \
+	$(libmount_la_SOURCES) $(load_la_SOURCES) \
+	$(log_logstash_la_SOURCES) $(logfile_la_SOURCES) \
+	$(lpar_la_SOURCES) $(lua_la_SOURCES) $(lvm_la_SOURCES) \
 	$(madwifi_la_SOURCES) $(match_empty_counter_la_SOURCES) \
 	$(match_hashed_la_SOURCES) $(match_regex_la_SOURCES) \
 	$(match_timediff_la_SOURCES) $(match_value_la_SOURCES) \
 	$(mbmon_la_SOURCES) $(md_la_SOURCES) $(memcachec_la_SOURCES) \
 	$(memcached_la_SOURCES) $(memory_la_SOURCES) $(mic_la_SOURCES) \
-	$(modbus_la_SOURCES) $(multimeter_la_SOURCES) \
-	$(mysql_la_SOURCES) $(netapp_la_SOURCES) $(netlink_la_SOURCES) \
+	$(modbus_la_SOURCES) $(mqtt_la_SOURCES) \
+	$(multimeter_la_SOURCES) $(mysql_la_SOURCES) \
+	$(netapp_la_SOURCES) $(netlink_la_SOURCES) \
 	$(network_la_SOURCES) $(nfs_la_SOURCES) $(nginx_la_SOURCES) \
 	$(notify_desktop_la_SOURCES) $(notify_email_la_SOURCES) \
-	$(ntpd_la_SOURCES) $(numa_la_SOURCES) $(nut_la_SOURCES) \
-	$(olsrd_la_SOURCES) $(onewire_la_SOURCES) \
-	$(openldap_la_SOURCES) $(openvpn_la_SOURCES) \
-	$(oracle_la_SOURCES) $(perl_la_SOURCES) $(pf_la_SOURCES) \
-	$(pinba_la_SOURCES) $(nodist_pinba_la_SOURCES) \
-	$(ping_la_SOURCES) $(postgresql_la_SOURCES) \
-	$(powerdns_la_SOURCES) $(processes_la_SOURCES) \
-	$(protocols_la_SOURCES) $(python_la_SOURCES) \
-	$(redis_la_SOURCES) $(routeros_la_SOURCES) \
-	$(rrdcached_la_SOURCES) $(rrdtool_la_SOURCES) \
-	$(sensors_la_SOURCES) $(serial_la_SOURCES) \
-	$(sigrok_la_SOURCES) $(smart_la_SOURCES) $(snmp_la_SOURCES) \
-	$(statsd_la_SOURCES) $(swap_la_SOURCES) $(syslog_la_SOURCES) \
-	$(table_la_SOURCES) $(tail_la_SOURCES) $(tail_csv_la_SOURCES) \
-	$(tape_la_SOURCES) $(target_notification_la_SOURCES) \
-	$(target_replace_la_SOURCES) $(target_scale_la_SOURCES) \
-	$(target_set_la_SOURCES) $(target_v5upgrade_la_SOURCES) \
-	$(tcpconns_la_SOURCES) $(teamspeak2_la_SOURCES) \
-	$(ted_la_SOURCES) $(thermal_la_SOURCES) \
-	$(threshold_la_SOURCES) $(tokyotyrant_la_SOURCES) \
-	$(turbostat_la_SOURCES) $(unixsock_la_SOURCES) \
-	$(uptime_la_SOURCES) $(users_la_SOURCES) $(uuid_la_SOURCES) \
-	$(varnish_la_SOURCES) $(virt_la_SOURCES) $(vmem_la_SOURCES) \
-	$(vserver_la_SOURCES) $(wireless_la_SOURCES) \
-	$(write_graphite_la_SOURCES) $(write_http_la_SOURCES) \
-	$(write_kafka_la_SOURCES) $(write_log_la_SOURCES) \
-	$(write_mongodb_la_SOURCES) $(write_redis_la_SOURCES) \
-	$(write_riemann_la_SOURCES) $(nodist_write_riemann_la_SOURCES) \
+	$(notify_nagios_la_SOURCES) $(ntpd_la_SOURCES) \
+	$(numa_la_SOURCES) $(nut_la_SOURCES) $(olsrd_la_SOURCES) \
+	$(onewire_la_SOURCES) $(openldap_la_SOURCES) \
+	$(openvpn_la_SOURCES) $(oracle_la_SOURCES) $(perl_la_SOURCES) \
+	$(pf_la_SOURCES) $(pinba_la_SOURCES) \
+	$(nodist_pinba_la_SOURCES) $(ping_la_SOURCES) \
+	$(postgresql_la_SOURCES) $(powerdns_la_SOURCES) \
+	$(processes_la_SOURCES) $(protocols_la_SOURCES) \
+	$(python_la_SOURCES) $(redis_la_SOURCES) \
+	$(routeros_la_SOURCES) $(rrdcached_la_SOURCES) \
+	$(rrdtool_la_SOURCES) $(sensors_la_SOURCES) \
+	$(serial_la_SOURCES) $(sigrok_la_SOURCES) $(smart_la_SOURCES) \
+	$(snmp_la_SOURCES) $(statsd_la_SOURCES) $(swap_la_SOURCES) \
+	$(syslog_la_SOURCES) $(table_la_SOURCES) $(tail_la_SOURCES) \
+	$(tail_csv_la_SOURCES) $(tape_la_SOURCES) \
+	$(target_notification_la_SOURCES) $(target_replace_la_SOURCES) \
+	$(target_scale_la_SOURCES) $(target_set_la_SOURCES) \
+	$(target_v5upgrade_la_SOURCES) $(tcpconns_la_SOURCES) \
+	$(teamspeak2_la_SOURCES) $(ted_la_SOURCES) \
+	$(thermal_la_SOURCES) $(threshold_la_SOURCES) \
+	$(tokyotyrant_la_SOURCES) $(turbostat_la_SOURCES) \
+	$(unixsock_la_SOURCES) $(uptime_la_SOURCES) \
+	$(users_la_SOURCES) $(uuid_la_SOURCES) $(varnish_la_SOURCES) \
+	$(virt_la_SOURCES) $(vmem_la_SOURCES) $(vserver_la_SOURCES) \
+	$(wireless_la_SOURCES) $(write_graphite_la_SOURCES) \
+	$(write_http_la_SOURCES) $(write_kafka_la_SOURCES) \
+	$(write_log_la_SOURCES) $(write_mongodb_la_SOURCES) \
+	$(write_redis_la_SOURCES) $(write_riemann_la_SOURCES) \
 	$(write_sensu_la_SOURCES) $(write_tsdb_la_SOURCES) \
-	$(xmms_la_SOURCES) $(zfs_arc_la_SOURCES) \
-	$(zookeeper_la_SOURCES) $(collectd_nagios_SOURCES) \
-	$(collectd_tg_SOURCES) $(collectdctl_SOURCES) \
-	$(collectdmon_SOURCES) $(test_plugin_ceph_SOURCES) \
-	$(test_utils_mount_SOURCES) $(test_utils_vl_lookup_SOURCES)
+	$(xencpu_la_SOURCES) $(xmms_la_SOURCES) $(zfs_arc_la_SOURCES) \
+	$(zone_la_SOURCES) $(zookeeper_la_SOURCES) \
+	$(collectd_nagios_SOURCES) $(collectd_tg_SOURCES) \
+	$(collectdctl_SOURCES) $(collectdmon_SOURCES) \
+	$(test_format_json_SOURCES) $(test_plugin_ceph_SOURCES) \
+	$(test_utils_latency_SOURCES) $(test_utils_mount_SOURCES) \
+	$(test_utils_vl_lookup_SOURCES)
 DIST_SOURCES = $(am__aggregation_la_SOURCES_DIST) \
 	$(am__amqp_la_SOURCES_DIST) $(am__apache_la_SOURCES_DIST) \
 	$(am__apcups_la_SOURCES_DIST) \
 	$(am__apple_sensors_la_SOURCES_DIST) \
 	$(am__aquaero_la_SOURCES_DIST) $(am__ascent_la_SOURCES_DIST) \
 	$(am__barometer_la_SOURCES_DIST) \
 	$(am__battery_la_SOURCES_DIST) $(am__bind_la_SOURCES_DIST) \
 	$(am__ceph_la_SOURCES_DIST) $(am__cgroups_la_SOURCES_DIST) \
-	$(am__conntrack_la_SOURCES_DIST) \
+	$(am__chrony_la_SOURCES_DIST) $(am__conntrack_la_SOURCES_DIST) \
 	$(am__contextswitch_la_SOURCES_DIST) \
 	$(am__cpu_la_SOURCES_DIST) $(am__cpufreq_la_SOURCES_DIST) \
-	$(am__csv_la_SOURCES_DIST) $(am__curl_la_SOURCES_DIST) \
-	$(am__curl_json_la_SOURCES_DIST) \
+	$(am__cpusleep_la_SOURCES_DIST) $(am__csv_la_SOURCES_DIST) \
+	$(am__curl_la_SOURCES_DIST) $(am__curl_json_la_SOURCES_DIST) \
 	$(am__curl_xml_la_SOURCES_DIST) $(am__dbi_la_SOURCES_DIST) \
 	$(am__df_la_SOURCES_DIST) $(am__disk_la_SOURCES_DIST) \
 	$(am__dns_la_SOURCES_DIST) $(am__drbd_la_SOURCES_DIST) \
 	$(am__email_la_SOURCES_DIST) $(am__entropy_la_SOURCES_DIST) \
 	$(am__ethstat_la_SOURCES_DIST) $(am__exec_la_SOURCES_DIST) \
 	$(am__fhcount_la_SOURCES_DIST) \
 	$(am__filecount_la_SOURCES_DIST) \
 	$(am__fscache_la_SOURCES_DIST) $(am__gmond_la_SOURCES_DIST) \
+	$(am__gps_la_SOURCES_DIST) $(am__grpc_la_SOURCES_DIST) \
 	$(am__hddtemp_la_SOURCES_DIST) \
 	$(am__interface_la_SOURCES_DIST) $(am__ipc_la_SOURCES_DIST) \
 	$(am__ipmi_la_SOURCES_DIST) $(am__iptables_la_SOURCES_DIST) \
 	$(am__ipvs_la_SOURCES_DIST) $(am__irq_la_SOURCES_DIST) \
-	$(am__java_la_SOURCES_DIST) $(liblookup_la_SOURCES) \
+	$(am__java_la_SOURCES_DIST) $(libformat_json_la_SOURCES) \
+	$(liblatency_la_SOURCES) $(liblookup_la_SOURCES) \
 	$(libmount_la_SOURCES) $(am__load_la_SOURCES_DIST) \
 	$(am__log_logstash_la_SOURCES_DIST) \
 	$(am__logfile_la_SOURCES_DIST) $(am__lpar_la_SOURCES_DIST) \
-	$(am__lvm_la_SOURCES_DIST) $(am__madwifi_la_SOURCES_DIST) \
+	$(am__lua_la_SOURCES_DIST) $(am__lvm_la_SOURCES_DIST) \
+	$(am__madwifi_la_SOURCES_DIST) \
 	$(am__match_empty_counter_la_SOURCES_DIST) \
 	$(am__match_hashed_la_SOURCES_DIST) \
 	$(am__match_regex_la_SOURCES_DIST) \
 	$(am__match_timediff_la_SOURCES_DIST) \
 	$(am__match_value_la_SOURCES_DIST) \
 	$(am__mbmon_la_SOURCES_DIST) $(am__md_la_SOURCES_DIST) \
 	$(am__memcachec_la_SOURCES_DIST) \
 	$(am__memcached_la_SOURCES_DIST) $(am__memory_la_SOURCES_DIST) \
 	$(am__mic_la_SOURCES_DIST) $(am__modbus_la_SOURCES_DIST) \
-	$(am__multimeter_la_SOURCES_DIST) $(am__mysql_la_SOURCES_DIST) \
-	$(am__netapp_la_SOURCES_DIST) $(am__netlink_la_SOURCES_DIST) \
-	$(am__network_la_SOURCES_DIST) $(am__nfs_la_SOURCES_DIST) \
-	$(am__nginx_la_SOURCES_DIST) \
+	$(am__mqtt_la_SOURCES_DIST) $(am__multimeter_la_SOURCES_DIST) \
+	$(am__mysql_la_SOURCES_DIST) $(am__netapp_la_SOURCES_DIST) \
+	$(am__netlink_la_SOURCES_DIST) $(am__network_la_SOURCES_DIST) \
+	$(am__nfs_la_SOURCES_DIST) $(am__nginx_la_SOURCES_DIST) \
 	$(am__notify_desktop_la_SOURCES_DIST) \
 	$(am__notify_email_la_SOURCES_DIST) \
+	$(am__notify_nagios_la_SOURCES_DIST) \
 	$(am__ntpd_la_SOURCES_DIST) $(am__numa_la_SOURCES_DIST) \
 	$(am__nut_la_SOURCES_DIST) $(am__olsrd_la_SOURCES_DIST) \
 	$(am__onewire_la_SOURCES_DIST) $(am__openldap_la_SOURCES_DIST) \
 	$(am__openvpn_la_SOURCES_DIST) $(am__oracle_la_SOURCES_DIST) \
 	$(am__perl_la_SOURCES_DIST) $(am__pf_la_SOURCES_DIST) \
 	$(am__pinba_la_SOURCES_DIST) $(am__ping_la_SOURCES_DIST) \
@@ -1900,18 +2035,21 @@
 	$(am__write_kafka_la_SOURCES_DIST) \
 	$(am__write_log_la_SOURCES_DIST) \
 	$(am__write_mongodb_la_SOURCES_DIST) \
 	$(am__write_redis_la_SOURCES_DIST) \
 	$(am__write_riemann_la_SOURCES_DIST) \
 	$(am__write_sensu_la_SOURCES_DIST) \
-	$(am__write_tsdb_la_SOURCES_DIST) $(am__xmms_la_SOURCES_DIST) \
-	$(am__zfs_arc_la_SOURCES_DIST) \
+	$(am__write_tsdb_la_SOURCES_DIST) \
+	$(am__xencpu_la_SOURCES_DIST) $(am__xmms_la_SOURCES_DIST) \
+	$(am__zfs_arc_la_SOURCES_DIST) $(am__zone_la_SOURCES_DIST) \
 	$(am__zookeeper_la_SOURCES_DIST) $(collectd_nagios_SOURCES) \
 	$(collectd_tg_SOURCES) $(collectdctl_SOURCES) \
-	$(collectdmon_SOURCES) $(am__test_plugin_ceph_SOURCES_DIST) \
-	$(test_utils_mount_SOURCES) $(test_utils_vl_lookup_SOURCES)
+	$(collectdmon_SOURCES) $(am__test_format_json_SOURCES_DIST) \
+	$(am__test_plugin_ceph_SOURCES_DIST) \
+	$(test_utils_latency_SOURCES) $(test_utils_mount_SOURCES) \
+	$(test_utils_vl_lookup_SOURCES)
 RECURSIVE_TARGETS = all-recursive check-recursive cscopelist-recursive \
 	ctags-recursive dvi-recursive html-recursive info-recursive \
 	install-data-recursive install-dvi-recursive \
 	install-exec-recursive install-html-recursive \
 	install-info-recursive install-pdf-recursive \
 	install-ps-recursive install-recursive installcheck-recursive \
@@ -2156,12 +2294,14 @@
     fi; \
     dir1=`echo "$$dir1" | sed -e "$$sed_rest"`; \
   done; \
   reldir="$$dir2"
 ACLOCAL = @ACLOCAL@
 AMTAR = @AMTAR@
+AM_CFLAGS = @AM_CFLAGS@
+AM_CXXFLAGS = @AM_CXXFLAGS@
 AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
 AR = @AR@
 ARGZ_H = @ARGZ_H@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
@@ -2173,40 +2313,61 @@
 BUILD_WITH_LIBATASMART_LIBS = @BUILD_WITH_LIBATASMART_LIBS@
 BUILD_WITH_LIBCURL_CFLAGS = @BUILD_WITH_LIBCURL_CFLAGS@
 BUILD_WITH_LIBCURL_LIBS = @BUILD_WITH_LIBCURL_LIBS@
 BUILD_WITH_LIBDBI_CPPFLAGS = @BUILD_WITH_LIBDBI_CPPFLAGS@
 BUILD_WITH_LIBDBI_LDFLAGS = @BUILD_WITH_LIBDBI_LDFLAGS@
 BUILD_WITH_LIBDBI_LIBS = @BUILD_WITH_LIBDBI_LIBS@
+BUILD_WITH_LIBGPS_CFLAGS = @BUILD_WITH_LIBGPS_CFLAGS@
+BUILD_WITH_LIBGPS_LDFLAGS = @BUILD_WITH_LIBGPS_LDFLAGS@
+BUILD_WITH_LIBGPS_LIBS = @BUILD_WITH_LIBGPS_LIBS@
+BUILD_WITH_LIBGRPCPP_CPPFLAGS = @BUILD_WITH_LIBGRPCPP_CPPFLAGS@
+BUILD_WITH_LIBGRPCPP_LDFLAGS = @BUILD_WITH_LIBGRPCPP_LDFLAGS@
+BUILD_WITH_LIBGRPCPP_LIBS = @BUILD_WITH_LIBGRPCPP_LIBS@
 BUILD_WITH_LIBHAL_CFLAGS = @BUILD_WITH_LIBHAL_CFLAGS@
 BUILD_WITH_LIBHAL_LIBS = @BUILD_WITH_LIBHAL_LIBS@
 BUILD_WITH_LIBHIREDIS_CPPFLAGS = @BUILD_WITH_LIBHIREDIS_CPPFLAGS@
 BUILD_WITH_LIBHIREDIS_LDFLAGS = @BUILD_WITH_LIBHIREDIS_LDFLAGS@
 BUILD_WITH_LIBIPTC_CPPFLAGS = @BUILD_WITH_LIBIPTC_CPPFLAGS@
 BUILD_WITH_LIBIPTC_LDFLAGS = @BUILD_WITH_LIBIPTC_LDFLAGS@
 BUILD_WITH_LIBLDAP_CPPFLAGS = @BUILD_WITH_LIBLDAP_CPPFLAGS@
 BUILD_WITH_LIBLDAP_LDFLAGS = @BUILD_WITH_LIBLDAP_LDFLAGS@
+BUILD_WITH_LIBLUA_CFLAGS = @BUILD_WITH_LIBLUA_CFLAGS@
+BUILD_WITH_LIBLUA_LIBS = @BUILD_WITH_LIBLUA_LIBS@
 BUILD_WITH_LIBLVM2APP_CPPFLAGS = @BUILD_WITH_LIBLVM2APP_CPPFLAGS@
 BUILD_WITH_LIBLVM2APP_LDFLAGS = @BUILD_WITH_LIBLVM2APP_LDFLAGS@
 BUILD_WITH_LIBLVM2APP_LIBS = @BUILD_WITH_LIBLVM2APP_LIBS@
 BUILD_WITH_LIBMEMCACHED_CPPFLAGS = @BUILD_WITH_LIBMEMCACHED_CPPFLAGS@
 BUILD_WITH_LIBMEMCACHED_LDFLAGS = @BUILD_WITH_LIBMEMCACHED_LDFLAGS@
 BUILD_WITH_LIBMEMCACHED_LIBS = @BUILD_WITH_LIBMEMCACHED_LIBS@
 BUILD_WITH_LIBMNL_CFLAGS = @BUILD_WITH_LIBMNL_CFLAGS@
 BUILD_WITH_LIBMNL_LIBS = @BUILD_WITH_LIBMNL_LIBS@
 BUILD_WITH_LIBMODBUS_CFLAGS = @BUILD_WITH_LIBMODBUS_CFLAGS@
 BUILD_WITH_LIBMODBUS_LIBS = @BUILD_WITH_LIBMODBUS_LIBS@
 BUILD_WITH_LIBMONGOC_CPPFLAGS = @BUILD_WITH_LIBMONGOC_CPPFLAGS@
 BUILD_WITH_LIBMONGOC_LDFLAGS = @BUILD_WITH_LIBMONGOC_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_CPPFLAGS = @BUILD_WITH_LIBMOSQUITTO_CPPFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LDFLAGS = @BUILD_WITH_LIBMOSQUITTO_LDFLAGS@
+BUILD_WITH_LIBMOSQUITTO_LIBS = @BUILD_WITH_LIBMOSQUITTO_LIBS@
 BUILD_WITH_LIBMYSQL_CFLAGS = @BUILD_WITH_LIBMYSQL_CFLAGS@
 BUILD_WITH_LIBMYSQL_LIBS = @BUILD_WITH_LIBMYSQL_LIBS@
+BUILD_WITH_LIBNETSNMP_CPPFLAGS = @BUILD_WITH_LIBNETSNMP_CPPFLAGS@
+BUILD_WITH_LIBNETSNMP_LDFLAGS = @BUILD_WITH_LIBNETSNMP_LDFLAGS@
+BUILD_WITH_LIBNETSNMP_LIBS = @BUILD_WITH_LIBNETSNMP_LIBS@
 BUILD_WITH_LIBOPING_CPPFLAGS = @BUILD_WITH_LIBOPING_CPPFLAGS@
 BUILD_WITH_LIBOPING_LDFLAGS = @BUILD_WITH_LIBOPING_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_CPPFLAGS = @BUILD_WITH_LIBOWCAPI_CPPFLAGS@
+BUILD_WITH_LIBOWCAPI_LDFLAGS = @BUILD_WITH_LIBOWCAPI_LDFLAGS@
 BUILD_WITH_LIBOWCAPI_LIBS = @BUILD_WITH_LIBOWCAPI_LIBS@
 BUILD_WITH_LIBPQ_CPPFLAGS = @BUILD_WITH_LIBPQ_CPPFLAGS@
 BUILD_WITH_LIBPQ_LDFLAGS = @BUILD_WITH_LIBPQ_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS = @BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_C_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_C_LIBS = @BUILD_WITH_LIBPROTOBUF_C_LIBS@
+BUILD_WITH_LIBPROTOBUF_LDFLAGS = @BUILD_WITH_LIBPROTOBUF_LDFLAGS@
+BUILD_WITH_LIBPROTOBUF_LIBS = @BUILD_WITH_LIBPROTOBUF_LIBS@
 BUILD_WITH_LIBRABBITMQ_CPPFLAGS = @BUILD_WITH_LIBRABBITMQ_CPPFLAGS@
 BUILD_WITH_LIBRABBITMQ_LDFLAGS = @BUILD_WITH_LIBRABBITMQ_LDFLAGS@
 BUILD_WITH_LIBRABBITMQ_LIBS = @BUILD_WITH_LIBRABBITMQ_LIBS@
 BUILD_WITH_LIBRDKAFKA_CPPFLAGS = @BUILD_WITH_LIBRDKAFKA_CPPFLAGS@
 BUILD_WITH_LIBRDKAFKA_LDFLAGS = @BUILD_WITH_LIBRDKAFKA_LDFLAGS@
 BUILD_WITH_LIBRDKAFKA_LIBS = @BUILD_WITH_LIBRDKAFKA_LIBS@
@@ -2214,16 +2375,12 @@
 BUILD_WITH_LIBROUTEROS_LDFLAGS = @BUILD_WITH_LIBROUTEROS_LDFLAGS@
 BUILD_WITH_LIBRRD_CFLAGS = @BUILD_WITH_LIBRRD_CFLAGS@
 BUILD_WITH_LIBRRD_LDFLAGS = @BUILD_WITH_LIBRRD_LDFLAGS@
 BUILD_WITH_LIBRRD_LIBS = @BUILD_WITH_LIBRRD_LIBS@
 BUILD_WITH_LIBSENSORS_CFLAGS = @BUILD_WITH_LIBSENSORS_CFLAGS@
 BUILD_WITH_LIBSENSORS_LDFLAGS = @BUILD_WITH_LIBSENSORS_LDFLAGS@
-BUILD_WITH_LIBSIGROK_CFLAGS = @BUILD_WITH_LIBSIGROK_CFLAGS@
-BUILD_WITH_LIBSIGROK_LDFLAGS = @BUILD_WITH_LIBSIGROK_LDFLAGS@
-BUILD_WITH_LIBSNMP_CFLAGS = @BUILD_WITH_LIBSNMP_CFLAGS@
-BUILD_WITH_LIBSNMP_LIBS = @BUILD_WITH_LIBSNMP_LIBS@
 BUILD_WITH_LIBSTATGRAB_CFLAGS = @BUILD_WITH_LIBSTATGRAB_CFLAGS@
 BUILD_WITH_LIBSTATGRAB_LDFLAGS = @BUILD_WITH_LIBSTATGRAB_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS = @BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS@
 BUILD_WITH_LIBTOKYOTYRANT_LIBS = @BUILD_WITH_LIBTOKYOTYRANT_LIBS@
 BUILD_WITH_LIBUDEV_CFLAGS = @BUILD_WITH_LIBUDEV_CFLAGS@
@@ -2244,22 +2401,23 @@
 BUILD_WITH_LIBYAJL_LIBS = @BUILD_WITH_LIBYAJL_LIBS@
 BUILD_WITH_MIC_CPPFLAGS = @BUILD_WITH_MIC_CPPFLAGS@
 BUILD_WITH_MIC_LDADD = @BUILD_WITH_MIC_LDADD@
 BUILD_WITH_MIC_LIBPATH = @BUILD_WITH_MIC_LIBPATH@
 BUILD_WITH_OPENIPMI_CFLAGS = @BUILD_WITH_OPENIPMI_CFLAGS@
 BUILD_WITH_OPENIPMI_LIBS = @BUILD_WITH_OPENIPMI_LIBS@
-BUILD_WITH_ORACLE_CFLAGS = @BUILD_WITH_ORACLE_CFLAGS@
+BUILD_WITH_ORACLE_CPPFLAGS = @BUILD_WITH_ORACLE_CPPFLAGS@
 BUILD_WITH_ORACLE_LIBS = @BUILD_WITH_ORACLE_LIBS@
-BUILD_WITH_PYTHON_CPPFLAGS = @BUILD_WITH_PYTHON_CPPFLAGS@
-BUILD_WITH_PYTHON_LDFLAGS = @BUILD_WITH_PYTHON_LDFLAGS@
-BUILD_WITH_PYTHON_LIBS = @BUILD_WITH_PYTHON_LIBS@
 CC = @CC@
 CCDEPMODE = @CCDEPMODE@
 CFLAGS = @CFLAGS@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
 DEFAULT_LOG_LEVEL = @DEFAULT_LOG_LEVEL@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
 DLLTOOL = @DLLTOOL@
 DSYMUTIL = @DSYMUTIL@
@@ -2273,19 +2431,18 @@
 GANGLIA_CPPFLAGS = @GANGLIA_CPPFLAGS@
 GANGLIA_LDFLAGS = @GANGLIA_LDFLAGS@
 GANGLIA_LIBS = @GANGLIA_LIBS@
 GCRYPT_CPPFLAGS = @GCRYPT_CPPFLAGS@
 GCRYPT_LDFLAGS = @GCRYPT_LDFLAGS@
 GCRYPT_LIBS = @GCRYPT_LIBS@
-GLIB_CFLAGS = @GLIB_CFLAGS@
-GLIB_COMPILE_RESOURCES = @GLIB_COMPILE_RESOURCES@
-GLIB_GENMARSHAL = @GLIB_GENMARSHAL@
-GLIB_LIBS = @GLIB_LIBS@
-GLIB_MKENUMS = @GLIB_MKENUMS@
-GOBJECT_QUERY = @GOBJECT_QUERY@
 GREP = @GREP@
+GRPCPP_CFLAGS = @GRPCPP_CFLAGS@
+GRPCPP_LIBS = @GRPCPP_LIBS@
+GRPC_CPP_PLUGIN = @GRPC_CPP_PLUGIN@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
 INCLTDL = @INCLTDL@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
@@ -2308,24 +2465,31 @@
 LEXLIB = @LEXLIB@
 LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
 LIBADD_DL = @LIBADD_DL@
 LIBADD_DLD_LINK = @LIBADD_DLD_LINK@
 LIBADD_DLOPEN = @LIBADD_DLOPEN@
 LIBADD_SHL_LOAD = @LIBADD_SHL_LOAD@
-LIBGCRYPT_CFLAGS = @LIBGCRYPT_CFLAGS@
-LIBGCRYPT_CONFIG = @LIBGCRYPT_CONFIG@
-LIBGCRYPT_LIBS = @LIBGCRYPT_LIBS@
 LIBLTDL = @LIBLTDL@
+LIBLUA_PKG_CONFIG_NAME = @LIBLUA_PKG_CONFIG_NAME@
 LIBNETAPP_CPPFLAGS = @LIBNETAPP_CPPFLAGS@
 LIBNETAPP_LDFLAGS = @LIBNETAPP_LDFLAGS@
 LIBNETAPP_LIBS = @LIBNETAPP_LIBS@
 LIBNOTIFY_CFLAGS = @LIBNOTIFY_CFLAGS@
 LIBNOTIFY_LIBS = @LIBNOTIFY_LIBS@
 LIBOBJS = @LIBOBJS@
+LIBPYTHON_CPPFLAGS = @LIBPYTHON_CPPFLAGS@
+LIBPYTHON_LDFLAGS = @LIBPYTHON_LDFLAGS@
+LIBPYTHON_LIBS = @LIBPYTHON_LIBS@
+LIBRIEMANN_CLIENT_CFLAGS = @LIBRIEMANN_CLIENT_CFLAGS@
+LIBRIEMANN_CLIENT_LIBS = @LIBRIEMANN_CLIENT_LIBS@
 LIBS = @LIBS@
+LIBSIGROK_CFLAGS = @LIBSIGROK_CFLAGS@
+LIBSIGROK_LIBS = @LIBSIGROK_LIBS@
 LIBTOOL = @LIBTOOL@
+LIBXENCTL_CPPFLAGS = @LIBXENCTL_CPPFLAGS@
+LIBXENCTL_LDFLAGS = @LIBXENCTL_LDFLAGS@
 LIPO = @LIPO@
 LN_S = @LN_S@
 LOAD_PLUGIN_CSV = @LOAD_PLUGIN_CSV@
 LOAD_PLUGIN_LOGFILE = @LOAD_PLUGIN_LOGFILE@
 LOAD_PLUGIN_LOG_LOGSTASH = @LOAD_PLUGIN_LOG_LOGSTASH@
 LOAD_PLUGIN_NETWORK = @LOAD_PLUGIN_NETWORK@
@@ -2335,12 +2499,14 @@
 LTDLINCL = @LTDLINCL@
 LTDLOPEN = @LTDLOPEN@
 LTLIBOBJS = @LTLIBOBJS@
 LT_CONFIG_H = @LT_CONFIG_H@
 LT_DLLOADERS = @LT_DLLOADERS@
 LT_DLPREOPEN = @LT_DLPREOPEN@
+LUA_CFLAGS = @LUA_CFLAGS@
+LUA_LIBS = @LUA_LIBS@
 MAKEINFO = @MAKEINFO@
 MANIFEST_TOOL = @MANIFEST_TOOL@
 MKDIR_P = @MKDIR_P@
 NM = @NM@
 NMEDIT = @NMEDIT@
 OBJDUMP = @OBJDUMP@
@@ -2360,28 +2526,38 @@
 PERL_BINDINGS_OPTIONS = @PERL_BINDINGS_OPTIONS@
 PERL_CFLAGS = @PERL_CFLAGS@
 PERL_LIBS = @PERL_LIBS@
 PKG_CONFIG = @PKG_CONFIG@
 PKG_CONFIG_LIBDIR = @PKG_CONFIG_LIBDIR@
 PKG_CONFIG_PATH = @PKG_CONFIG_PATH@
+PROTOBUF_CFLAGS = @PROTOBUF_CFLAGS@
+PROTOBUF_C_CFLAGS = @PROTOBUF_C_CFLAGS@
+PROTOBUF_C_LIBS = @PROTOBUF_C_LIBS@
+PROTOBUF_LIBS = @PROTOBUF_LIBS@
+PROTOC = @PROTOC@
+PROTOC_C = @PROTOC_C@
+PTHREAD_LIBS = @PTHREAD_LIBS@
+PYTHON_CONFIG = @PYTHON_CONFIG@
 RANLIB = @RANLIB@
 RRD_CFLAGS = @RRD_CFLAGS@
 RRD_LIBS = @RRD_LIBS@
 SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
+VALGRIND = @VALGRIND@
 VERSION = @VERSION@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 abs_builddir = @abs_builddir@
 abs_srcdir = @abs_srcdir@
 abs_top_builddir = @abs_top_builddir@
 abs_top_srcdir = @abs_top_srcdir@
 ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
 ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
 am__tar = @am__tar@
 am__untar = @am__untar@
@@ -2394,13 +2570,12 @@
 builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
 exec_prefix = @exec_prefix@
-have_protoc_c = @have_protoc_c@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
 htmldir = @htmldir@
@@ -2430,135 +2605,153 @@
 target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 SUBDIRS = libcollectdclient $(am__append_1) daemon
 PLUGIN_LDFLAGS = -module -avoid-version -export-symbols-regex '\<module_register\>'
-@COMPILER_IS_GCC_TRUE@AM_CFLAGS = -Wall -Werror
 AM_CPPFLAGS = -I$(srcdir)/daemon -DPREFIX='"${prefix}"' \
 	-DCONFIGFILE='"${sysconfdir}/${PACKAGE_NAME}.conf"' \
 	-DLOCALSTATEDIR='"${localstatedir}"' \
 	-DPKGLOCALSTATEDIR='"${localstatedir}/lib/${PACKAGE_NAME}"' \
 	$(am__append_2) -DPLUGINDIR='"${pkglibdir}"' \
 	-DPKGDATADIR='"${pkgdatadir}"'
-AUTOMAKE_OPTIONS = subdir-objects
-noinst_LTLIBRARIES = libmount.la liblookup.la
-libmount_la_SOURCES = utils_mount.c utils_mount.h
-libmount_la_LIBADD = daemon/libcommon.la
+LOG_COMPILER = env VALGRIND="@VALGRIND@" $(abs_top_srcdir)/testwrapper.sh
+V_PROTOC = $(v_protoc_@AM_V@)
+v_protoc_ = $(v_protoc_@AM_DEFAULT_V@)
+v_protoc_0 = @echo "  PROTOC  " $@;
+noinst_LTLIBRARIES = libformat_json.la liblatency.la liblookup.la \
+	libmount.la
+libformat_json_la_SOURCES = utils_format_json.c utils_format_json.h
+libformat_json_la_CPPFLAGS = $(AM_CPPFLAGS) $(am__append_3)
+libformat_json_la_LDFLAGS = $(AM_LDFLAGS) $(am__append_4)
+libformat_json_la_LIBADD = $(am__append_5)
+@BUILD_WITH_LIBYAJL_TRUE@test_format_json_SOURCES = utils_format_json_test.c testing.h
+@BUILD_WITH_LIBYAJL_TRUE@test_format_json_LDADD = libformat_json.la daemon/libmetadata.la daemon/libplugin_mock.la -lm
+liblatency_la_SOURCES = utils_latency.c utils_latency.h
+test_utils_latency_SOURCES = utils_latency_test.c testing.h
+test_utils_latency_LDADD = liblatency.la daemon/libplugin_mock.la -lm
 liblookup_la_SOURCES = utils_vl_lookup.c utils_vl_lookup.h
-liblookup_la_LIBADD = daemon/libavltree.la daemon/libcommon.la
+liblookup_la_LIBADD = daemon/libavltree.la
+test_utils_vl_lookup_SOURCES = utils_vl_lookup_test.c testing.h
+test_utils_vl_lookup_LDADD = liblookup.la daemon/libplugin_mock.la \
+	$(am__append_8)
+libmount_la_SOURCES = utils_mount.c utils_mount.h
+test_utils_mount_SOURCES = utils_mount_test.c testing.h
+test_utils_mount_LDADD = libmount.la daemon/libplugin_mock.la \
+	$(am__append_9)
 collectdmon_SOURCES = collectdmon.c
-collectdmon_CPPFLAGS = $(AM_CPPFLAGS)
 collectd_nagios_SOURCES = collectd-nagios.c
-collectd_nagios_CPPFLAGS = $(AM_CPPFLAGS) -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
-collectd_nagios_LDADD = $(am__append_3) $(am__append_4) \
-	libcollectdclient/libcollectdclient.la
-collectd_nagios_DEPENDENCIES = libcollectdclient/libcollectdclient.la
+collectd_nagios_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
+
+collectd_nagios_LDADD = libcollectdclient/libcollectdclient.la \
+	$(am__append_10) $(am__append_11)
 collectdctl_SOURCES = collectdctl.c
-collectdctl_CPPFLAGS = $(AM_CPPFLAGS) -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
-collectdctl_LDADD = $(am__append_5) $(am__append_6) \
-	libcollectdclient/libcollectdclient.la
-collectdctl_DEPENDENCIES = libcollectdclient/libcollectdclient.la
+collectdctl_CPPFLAGS = $(AM_CPPFLAGS) \
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
+
+collectdctl_LDADD = libcollectdclient/libcollectdclient.la \
+	$(am__append_12) $(am__append_13)
 collectd_tg_SOURCES = collectd-tg.c
 collectd_tg_CPPFLAGS = $(AM_CPPFLAGS) \
-		       -I$(top_srcdir)/src/libcollectdclient/collectd -I$(top_builddir)/src/libcollectdclient/collectd
+	-I$(top_srcdir)/src/libcollectdclient/collectd \
+	-I$(top_builddir)/src/libcollectdclient/collectd
 
-collectd_tg_LDADD = daemon/libheap.la $(am__append_7) $(am__append_8) \
-	$(am__append_9) $(am__append_10) \
-	libcollectdclient/libcollectdclient.la
-collectd_tg_DEPENDENCIES = libcollectdclient/libcollectdclient.la
-pkglib_LTLIBRARIES = $(am__append_11) $(am__append_12) \
-	$(am__append_13) $(am__append_16) $(am__append_18) \
-	$(am__append_19) $(am__append_20) $(am__append_21) \
-	$(am__append_22) $(am__append_24) $(am__append_25) \
-	$(am__append_26) $(am__append_27) $(am__append_28) \
-	$(am__append_30) $(am__append_36) $(am__append_37) \
-	$(am__append_38) $(am__append_41) $(am__append_44) \
-	$(am__append_45) $(am__append_46) $(am__append_47) \
-	$(am__append_57) $(am__append_58) $(am__append_59) \
-	$(am__append_60) $(am__append_61) $(am__append_62) \
+collectd_tg_LDADD = $(PTHREAD_LIBS) daemon/libheap.la \
+	libcollectdclient/libcollectdclient.la $(am__append_14) \
+	$(am__append_15) $(am__append_16)
+pkglib_LTLIBRARIES = $(am__append_19) $(am__append_20) \
+	$(am__append_21) $(am__append_22) $(am__append_24) \
+	$(am__append_25) $(am__append_26) $(am__append_27) \
+	$(am__append_28) $(am__append_30) $(am__append_31) \
+	$(am__append_32) $(am__append_33) $(am__append_34) \
+	$(am__append_35) $(am__append_37) $(am__append_43) \
+	$(am__append_44) $(am__append_45) $(am__append_46) \
+	$(am__append_47) $(am__append_48) $(am__append_49) \
+	$(am__append_50) $(am__append_51) $(am__append_62) \
 	$(am__append_63) $(am__append_64) $(am__append_65) \
-	$(am__append_66) $(am__append_68) $(am__append_74) \
-	$(am__append_75) $(am__append_76) $(am__append_77) \
-	$(am__append_78) $(am__append_79) $(am__append_80) \
-	$(am__append_84) $(am__append_85) $(am__append_86) \
-	$(am__append_87) $(am__append_88) $(am__append_89) \
-	$(am__append_90) $(am__append_91) $(am__append_92) \
-	$(am__append_93) $(am__append_94) $(am__append_96) \
-	$(am__append_97) $(am__append_98) $(am__append_100) \
-	$(am__append_106) $(am__append_107) $(am__append_108) \
-	$(am__append_109) $(am__append_112) $(am__append_113) \
-	$(am__append_114) $(am__append_119) $(am__append_120) \
-	$(am__append_121) $(am__append_124) $(am__append_125) \
-	$(am__append_126) $(am__append_128) $(am__append_129) \
-	$(am__append_130) $(am__append_132) $(am__append_133) \
-	$(am__append_134) $(am__append_135) $(am__append_136) \
-	$(am__append_138) $(am__append_139) $(am__append_140) \
-	$(am__append_141) $(am__append_142) $(am__append_143) \
-	$(am__append_145) $(am__append_147) $(am__append_148) \
-	$(am__append_149) $(am__append_150) $(am__append_151) \
-	$(am__append_152) $(am__append_153) $(am__append_154) \
-	$(am__append_155) $(am__append_156) $(am__append_160) \
-	$(am__append_161) $(am__append_168) $(am__append_169) \
-	$(am__append_170) $(am__append_171) $(am__append_172) \
+	$(am__append_66) $(am__append_67) $(am__append_68) \
+	$(am__append_69) $(am__append_70) $(am__append_71) \
+	$(am__append_72) $(am__append_73) $(am__append_75) \
+	$(am__append_81) $(am__append_82) $(am__append_83) \
+	$(am__append_84) $(am__append_86) $(am__append_87) \
+	$(am__append_88) $(am__append_92) $(am__append_93) \
+	$(am__append_94) $(am__append_95) $(am__append_96) \
+	$(am__append_97) $(am__append_98) $(am__append_99) \
+	$(am__append_100) $(am__append_101) $(am__append_102) \
+	$(am__append_103) $(am__append_105) $(am__append_106) \
+	$(am__append_107) $(am__append_109) $(am__append_115) \
+	$(am__append_116) $(am__append_117) $(am__append_118) \
+	$(am__append_119) $(am__append_120) $(am__append_121) \
+	$(am__append_122) $(am__append_127) $(am__append_128) \
+	$(am__append_129) $(am__append_130) $(am__append_131) \
+	$(am__append_132) $(am__append_133) $(am__append_135) \
+	$(am__append_136) $(am__append_137) $(am__append_139) \
+	$(am__append_140) $(am__append_141) $(am__append_142) \
+	$(am__append_143) $(am__append_145) $(am__append_146) \
+	$(am__append_147) $(am__append_148) $(am__append_149) \
+	$(am__append_150) $(am__append_152) $(am__append_154) \
+	$(am__append_155) $(am__append_156) $(am__append_157) \
+	$(am__append_158) $(am__append_159) $(am__append_160) \
+	$(am__append_161) $(am__append_162) $(am__append_163) \
+	$(am__append_164) $(am__append_165) $(am__append_172) \
 	$(am__append_173) $(am__append_174) $(am__append_175) \
 	$(am__append_176) $(am__append_177) $(am__append_178) \
-	$(am__append_180) $(am__append_181) $(am__append_182) \
-	$(am__append_183) $(am__append_184) $(am__append_186) \
-	$(am__append_187) $(am__append_188) $(am__append_191) \
-	$(am__append_194) $(am__append_195) $(am__append_196) \
-	$(am__append_197) $(am__append_198) $(am__append_199) \
-	$(am__append_200) $(am__append_201) $(am__append_204) \
-	$(am__append_205) $(am__append_206) $(am__append_207) \
-	$(am__append_208) $(am__append_209) $(am__append_210) \
-	$(am__append_211) $(am__append_212) $(am__append_213)
-BUILT_SOURCES = $(dist_man_MANS) $(am__append_215) $(am__append_217)
-CLEANFILES = $(am__append_214) $(am__append_216)
+	$(am__append_179) $(am__append_180) $(am__append_181) \
+	$(am__append_182) $(am__append_184) $(am__append_185) \
+	$(am__append_186) $(am__append_187) $(am__append_188) \
+	$(am__append_190) $(am__append_191) $(am__append_192) \
+	$(am__append_195) $(am__append_198) $(am__append_199) \
+	$(am__append_200) $(am__append_201) $(am__append_202) \
+	$(am__append_203) $(am__append_204) $(am__append_205) \
+	$(am__append_206) $(am__append_207) $(am__append_208) \
+	$(am__append_209) $(am__append_210) $(am__append_211) \
+	$(am__append_212) $(am__append_213) $(am__append_214) \
+	$(am__append_215) $(am__append_216) $(am__append_217)
+BUILT_SOURCES = $(am__append_17) $(dist_man_MANS) $(am__append_219)
+CLEANFILES = $(am__append_18) $(am__append_218)
 @BUILD_PLUGIN_AGGREGATION_TRUE@aggregation_la_SOURCES = aggregation.c \
 @BUILD_PLUGIN_AGGREGATION_TRUE@                         utils_vl_lookup.c utils_vl_lookup.h
 
 @BUILD_PLUGIN_AGGREGATION_TRUE@aggregation_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_AGGREGATION_TRUE@aggregation_la_LIBADD = -lm
 @BUILD_PLUGIN_AMQP_TRUE@amqp_la_SOURCES = amqp.c \
 @BUILD_PLUGIN_AMQP_TRUE@		  utils_cmd_putval.c utils_cmd_putval.h \
 @BUILD_PLUGIN_AMQP_TRUE@  	          utils_parse_option.c utils_parse_option.h \
-@BUILD_PLUGIN_AMQP_TRUE@		  utils_format_graphite.c utils_format_graphite.h \
-@BUILD_PLUGIN_AMQP_TRUE@		  utils_format_json.c utils_format_json.h
+@BUILD_PLUGIN_AMQP_TRUE@		  utils_format_graphite.c utils_format_graphite.h
 
 @BUILD_PLUGIN_AMQP_TRUE@amqp_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBRABBITMQ_LDFLAGS)
 @BUILD_PLUGIN_AMQP_TRUE@amqp_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBRABBITMQ_CPPFLAGS)
-@BUILD_PLUGIN_AMQP_TRUE@amqp_la_LIBADD = $(BUILD_WITH_LIBRABBITMQ_LIBS)
+@BUILD_PLUGIN_AMQP_TRUE@amqp_la_LIBADD = $(BUILD_WITH_LIBRABBITMQ_LIBS) libformat_json.la
 @BUILD_PLUGIN_APACHE_TRUE@apache_la_SOURCES = apache.c
 @BUILD_PLUGIN_APACHE_TRUE@apache_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_APACHE_TRUE@apache_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_APACHE_TRUE@	$(am__append_14)
-@BUILD_PLUGIN_APACHE_TRUE@apache_la_LIBADD = $(am__append_15)
+@BUILD_PLUGIN_APACHE_TRUE@apache_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+@BUILD_PLUGIN_APACHE_TRUE@apache_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
 @BUILD_PLUGIN_APCUPS_TRUE@apcups_la_SOURCES = apcups.c
 @BUILD_PLUGIN_APCUPS_TRUE@apcups_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_APCUPS_TRUE@apcups_la_LIBADD = $(am__append_17)
+@BUILD_PLUGIN_APCUPS_TRUE@apcups_la_LIBADD = $(am__append_23)
 @BUILD_PLUGIN_APPLE_SENSORS_TRUE@apple_sensors_la_SOURCES = apple_sensors.c
-@BUILD_PLUGIN_APPLE_SENSORS_TRUE@apple_sensors_la_LDFLAGS =  \
-@BUILD_PLUGIN_APPLE_SENSORS_TRUE@	$(PLUGIN_LDFLAGS) -framework \
-@BUILD_PLUGIN_APPLE_SENSORS_TRUE@	IOKit
+@BUILD_PLUGIN_APPLE_SENSORS_TRUE@apple_sensors_la_LDFLAGS = $(PLUGIN_LDFLAGS) -framework IOKit
 @BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_SOURCES = aquaero.c
-@BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBAQUAERO5_CFLAGS)
-@BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_LIBADD = $(BUILD_WITH_LIBAQUAERO5_LDFLAGS) -laquaero5
+@BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBAQUAERO5_LDFLAGS)
+@BUILD_PLUGIN_AQUAERO_TRUE@aquaero_la_LIBADD = -laquaero5
 @BUILD_PLUGIN_ASCENT_TRUE@ascent_la_SOURCES = ascent.c
 @BUILD_PLUGIN_ASCENT_TRUE@ascent_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_ASCENT_TRUE@ascent_la_CFLAGS = $(AM_CFLAGS) \
 @BUILD_PLUGIN_ASCENT_TRUE@		$(BUILD_WITH_LIBCURL_CFLAGS) $(BUILD_WITH_LIBXML2_CFLAGS)
 
 @BUILD_PLUGIN_ASCENT_TRUE@ascent_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBXML2_LIBS)
 @BUILD_PLUGIN_BAROMETER_TRUE@barometer_la_SOURCES = barometer.c
 @BUILD_PLUGIN_BAROMETER_TRUE@barometer_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_BAROMETER_TRUE@barometer_la_LIBADD = -lm
 @BUILD_PLUGIN_BATTERY_TRUE@battery_la_SOURCES = battery.c
 @BUILD_PLUGIN_BATTERY_TRUE@battery_la_LDFLAGS = $(PLUGIN_LDFLAGS) \
-@BUILD_PLUGIN_BATTERY_TRUE@	$(am__append_23)
-@BUILD_PLUGIN_BATTERY_TRUE@battery_la_LIBADD = 
+@BUILD_PLUGIN_BATTERY_TRUE@	$(am__append_29)
 @BUILD_PLUGIN_BIND_TRUE@bind_la_SOURCES = bind.c
 @BUILD_PLUGIN_BIND_TRUE@bind_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_BIND_TRUE@bind_la_CFLAGS = $(AM_CFLAGS) \
 @BUILD_PLUGIN_BIND_TRUE@		 $(BUILD_WITH_LIBCURL_CFLAGS) $(BUILD_WITH_LIBXML2_CFLAGS)
 
 @BUILD_PLUGIN_BIND_TRUE@bind_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBXML2_LIBS)
@@ -2567,41 +2760,48 @@
 @BUILD_PLUGIN_CEPH_TRUE@ceph_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
 @BUILD_PLUGIN_CEPH_TRUE@ceph_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
 @BUILD_PLUGIN_CEPH_TRUE@ceph_la_LIBADD = $(BUILD_WITH_LIBYAJL_LIBS)
 @BUILD_PLUGIN_CGROUPS_TRUE@cgroups_la_SOURCES = cgroups.c
 @BUILD_PLUGIN_CGROUPS_TRUE@cgroups_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CGROUPS_TRUE@cgroups_la_LIBADD = libmount.la
+@BUILD_PLUGIN_CHRONY_TRUE@chrony_la_SOURCES = chrony.c
+@BUILD_PLUGIN_CHRONY_TRUE@chrony_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CONNTRACK_TRUE@conntrack_la_SOURCES = conntrack.c
 @BUILD_PLUGIN_CONNTRACK_TRUE@conntrack_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CONTEXTSWITCH_TRUE@contextswitch_la_SOURCES = contextswitch.c
 @BUILD_PLUGIN_CONTEXTSWITCH_TRUE@contextswitch_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CONTEXTSWITCH_TRUE@contextswitch_la_LIBADD =  \
-@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@	$(am__append_29)
+@BUILD_PLUGIN_CONTEXTSWITCH_TRUE@	$(am__append_36)
 @BUILD_PLUGIN_CPU_TRUE@cpu_la_SOURCES = cpu.c
-@BUILD_PLUGIN_CPU_TRUE@cpu_la_CFLAGS = $(AM_CFLAGS) $(am__append_33)
+@BUILD_PLUGIN_CPU_TRUE@cpu_la_CFLAGS = $(AM_CFLAGS) $(am__append_40)
 @BUILD_PLUGIN_CPU_TRUE@cpu_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_CPU_TRUE@cpu_la_LIBADD = $(am__append_31) \
-@BUILD_PLUGIN_CPU_TRUE@	$(am__append_32) $(am__append_34) \
-@BUILD_PLUGIN_CPU_TRUE@	$(am__append_35)
+@BUILD_PLUGIN_CPU_TRUE@cpu_la_LIBADD = $(am__append_38) \
+@BUILD_PLUGIN_CPU_TRUE@	$(am__append_39) $(am__append_41) \
+@BUILD_PLUGIN_CPU_TRUE@	$(am__append_42)
 @BUILD_PLUGIN_CPUFREQ_TRUE@cpufreq_la_SOURCES = cpufreq.c
 @BUILD_PLUGIN_CPUFREQ_TRUE@cpufreq_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_CPUSLEEP_TRUE@cpusleep_la_SOURCES = cpusleep.c
+@BUILD_PLUGIN_CPUSLEEP_TRUE@cpusleep_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CSV_TRUE@csv_la_SOURCES = csv.c
 @BUILD_PLUGIN_CSV_TRUE@csv_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_CURL_TRUE@curl_la_SOURCES = curl.c
+@BUILD_PLUGIN_CURL_TRUE@curl_la_SOURCES = curl.c \
+@BUILD_PLUGIN_CURL_TRUE@		  utils_curl_stats.c utils_curl_stats.h
+
 @BUILD_PLUGIN_CURL_TRUE@curl_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_CURL_TRUE@curl_la_CFLAGS = $(AM_CFLAGS) $(am__append_39)
-@BUILD_PLUGIN_CURL_TRUE@curl_la_LIBADD = $(am__append_40)
-@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_SOURCES = curl_json.c
-@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_CURL_JSON_TRUE@	$(am__append_42)
-@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
+@BUILD_PLUGIN_CURL_TRUE@curl_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+@BUILD_PLUGIN_CURL_TRUE@curl_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
+@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_SOURCES = curl_json.c \
+@BUILD_PLUGIN_CURL_JSON_TRUE@		  utils_curl_stats.c utils_curl_stats.h
+
+@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
 @BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
-@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_LIBADD =  \
-@BUILD_PLUGIN_CURL_JSON_TRUE@	$(BUILD_WITH_LIBYAJL_LIBS) \
-@BUILD_PLUGIN_CURL_JSON_TRUE@	$(am__append_43)
-@BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_SOURCES = curl_xml.c
+@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
+@BUILD_PLUGIN_CURL_JSON_TRUE@curl_json_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBYAJL_LIBS)
+@BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_SOURCES = curl_xml.c \
+@BUILD_PLUGIN_CURL_XML_TRUE@		  utils_curl_stats.c utils_curl_stats.h
+
 @BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_CFLAGS = $(AM_CFLAGS) \
 @BUILD_PLUGIN_CURL_XML_TRUE@		$(BUILD_WITH_LIBCURL_CFLAGS) $(BUILD_WITH_LIBXML2_CFLAGS)
 
 @BUILD_PLUGIN_CURL_XML_TRUE@curl_xml_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) $(BUILD_WITH_LIBXML2_LIBS)
 @BUILD_PLUGIN_DBI_TRUE@dbi_la_SOURCES = dbi.c \
@@ -2611,95 +2811,107 @@
 @BUILD_PLUGIN_DBI_TRUE@dbi_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBDBI_LDFLAGS)
 @BUILD_PLUGIN_DBI_TRUE@dbi_la_LIBADD = $(BUILD_WITH_LIBDBI_LIBS)
 @BUILD_PLUGIN_DF_TRUE@df_la_SOURCES = df.c
 @BUILD_PLUGIN_DF_TRUE@df_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_DF_TRUE@df_la_LIBADD = libmount.la
 @BUILD_PLUGIN_DISK_TRUE@disk_la_SOURCES = disk.c
-@BUILD_PLUGIN_DISK_TRUE@disk_la_CFLAGS = $(AM_CFLAGS) $(am__append_51) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__append_53)
+@BUILD_PLUGIN_DISK_TRUE@disk_la_CFLAGS = $(AM_CFLAGS) $(am__append_55) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__append_57)
 @BUILD_PLUGIN_DISK_TRUE@disk_la_LDFLAGS = $(PLUGIN_LDFLAGS) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__append_50) $(am__append_54)
-@BUILD_PLUGIN_DISK_TRUE@disk_la_LIBADD = $(am__append_48) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__append_49) $(am__append_52) \
-@BUILD_PLUGIN_DISK_TRUE@	$(am__append_55) $(am__append_56)
+@BUILD_PLUGIN_DISK_TRUE@	$(am__append_54) $(am__append_58)
+@BUILD_PLUGIN_DISK_TRUE@disk_la_LIBADD = $(am__append_52) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__append_53) $(am__append_56) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__append_59) $(am__append_60) \
+@BUILD_PLUGIN_DISK_TRUE@	$(am__append_61)
 @BUILD_PLUGIN_DNS_TRUE@dns_la_SOURCES = dns.c utils_dns.c utils_dns.h
 @BUILD_PLUGIN_DNS_TRUE@dns_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_DNS_TRUE@dns_la_LIBADD = -lpcap -lpthread
+@BUILD_PLUGIN_DNS_TRUE@dns_la_LIBADD = -lpcap
 @BUILD_PLUGIN_DRBD_TRUE@drbd_la_SOURCES = drbd.c
 @BUILD_PLUGIN_DRBD_TRUE@drbd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_DRBD_TRUE@drbd_la_LIBADD = -lpthread
 @BUILD_PLUGIN_EMAIL_TRUE@email_la_SOURCES = email.c
 @BUILD_PLUGIN_EMAIL_TRUE@email_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_EMAIL_TRUE@email_la_LIBADD = -lpthread
 @BUILD_PLUGIN_ENTROPY_TRUE@entropy_la_SOURCES = entropy.c
 @BUILD_PLUGIN_ENTROPY_TRUE@entropy_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_EXEC_TRUE@exec_la_SOURCES = exec.c \
 @BUILD_PLUGIN_EXEC_TRUE@		  utils_cmd_putnotif.c utils_cmd_putnotif.h \
 @BUILD_PLUGIN_EXEC_TRUE@		  utils_cmd_putval.c utils_cmd_putval.h \
 @BUILD_PLUGIN_EXEC_TRUE@		  utils_parse_option.h utils_parse_option.c
 
 @BUILD_PLUGIN_EXEC_TRUE@exec_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_EXEC_TRUE@exec_la_LIBADD = -lpthread
 @BUILD_PLUGIN_ETHSTAT_TRUE@ethstat_la_SOURCES = ethstat.c
 @BUILD_PLUGIN_ETHSTAT_TRUE@ethstat_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_FHCOUNT_TRUE@fhcount_la_SOURCES = fhcount.c
 @BUILD_PLUGIN_FHCOUNT_TRUE@fhcount_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_FILECOUNT_TRUE@filecount_la_SOURCES = filecount.c
 @BUILD_PLUGIN_FILECOUNT_TRUE@filecount_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_GMOND_TRUE@gmond_la_SOURCES = gmond.c
 @BUILD_PLUGIN_GMOND_TRUE@gmond_la_CPPFLAGS = $(AM_CPPFLAGS) $(GANGLIA_CPPFLAGS)
 @BUILD_PLUGIN_GMOND_TRUE@gmond_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(GANGLIA_LDFLAGS)
 @BUILD_PLUGIN_GMOND_TRUE@gmond_la_LIBADD = $(GANGLIA_LIBS)
+@BUILD_PLUGIN_GPS_TRUE@gps_la_SOURCES = gps.c
+@BUILD_PLUGIN_GPS_TRUE@gps_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBGPS_CFLAGS)
+@BUILD_PLUGIN_GPS_TRUE@gps_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBGPS_LDFLAGS)
+@BUILD_PLUGIN_GPS_TRUE@gps_la_LIBADD = -lpthread $(BUILD_WITH_LIBGPS_LIBS)
+@BUILD_PLUGIN_GRPC_TRUE@grpc_la_SOURCES = grpc.cc
+@BUILD_PLUGIN_GRPC_TRUE@nodist_grpc_la_SOURCES = collectd.grpc.pb.cc collectd.pb.cc types.pb.cc
+@BUILD_PLUGIN_GRPC_TRUE@grpc_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBGRPCPP_CPPFLAGS) $(BUILD_WITH_LIBPROTOBUF_CPPFLAGS)
+@BUILD_PLUGIN_GRPC_TRUE@grpc_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBGRPCPP_LDFLAGS) $(BUILD_WITH_LIBPROTOBUF_LDFLAGS)
+@BUILD_PLUGIN_GRPC_TRUE@grpc_la_LIBADD = $(BUILD_WITH_LIBGRPCPP_LIBS) $(BUILD_WITH_LIBPROTOBUF_LIBS)
 @BUILD_PLUGIN_HDDTEMP_TRUE@hddtemp_la_SOURCES = hddtemp.c
 @BUILD_PLUGIN_HDDTEMP_TRUE@hddtemp_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_HDDTEMP_TRUE@hddtemp_la_LIBADD = $(am__append_67)
+@BUILD_PLUGIN_HDDTEMP_TRUE@hddtemp_la_LIBADD = $(am__append_74)
 @BUILD_PLUGIN_INTERFACE_TRUE@interface_la_SOURCES = interface.c
 @BUILD_PLUGIN_INTERFACE_TRUE@interface_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_69)
+@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_76)
 @BUILD_PLUGIN_INTERFACE_TRUE@interface_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_INTERFACE_TRUE@interface_la_LIBADD = $(am__append_70) \
-@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_71) $(am__append_72) \
-@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_73)
+@BUILD_PLUGIN_INTERFACE_TRUE@interface_la_LIBADD = $(am__append_77) \
+@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_78) $(am__append_79) \
+@BUILD_PLUGIN_INTERFACE_TRUE@	$(am__append_80)
 @BUILD_PLUGIN_IPC_TRUE@ipc_la_SOURCES = ipc.c
-@BUILD_PLUGIN_IPC_TRUE@ipc_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_IPC_TRUE@ipc_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_IPTABLES_TRUE@iptables_la_SOURCES = iptables.c
 @BUILD_PLUGIN_IPTABLES_TRUE@iptables_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBIPTC_CPPFLAGS)
 @BUILD_PLUGIN_IPTABLES_TRUE@iptables_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_IPTABLES_TRUE@iptables_la_LIBADD = $(BUILD_WITH_LIBIPTC_LDFLAGS)
 @BUILD_PLUGIN_IPMI_TRUE@ipmi_la_SOURCES = ipmi.c
 @BUILD_PLUGIN_IPMI_TRUE@ipmi_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_OPENIPMI_CFLAGS)
 @BUILD_PLUGIN_IPMI_TRUE@ipmi_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_IPMI_TRUE@ipmi_la_LIBADD = $(BUILD_WITH_OPENIPMI_LIBS)
 @BUILD_PLUGIN_IPVS_TRUE@ipvs_la_SOURCES = ipvs.c
-@BUILD_PLUGIN_IPVS_TRUE@@IP_VS_H_NEEDS_KERNEL_CFLAGS_TRUE@ipvs_la_CFLAGS = $(AM_CFLAGS) $(KERNEL_CFLAGS)
+@BUILD_PLUGIN_IPVS_TRUE@ipvs_la_CFLAGS = $(AM_CFLAGS) $(am__append_85)
 @BUILD_PLUGIN_IPVS_TRUE@ipvs_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_IRQ_TRUE@irq_la_SOURCES = irq.c
 @BUILD_PLUGIN_IRQ_TRUE@irq_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_JAVA_TRUE@java_la_SOURCES = java.c
 @BUILD_PLUGIN_JAVA_TRUE@java_la_CPPFLAGS = $(AM_CPPFLAGS) $(JAVA_CPPFLAGS)
 @BUILD_PLUGIN_JAVA_TRUE@java_la_CFLAGS = $(AM_CFLAGS) $(JAVA_CFLAGS)
 @BUILD_PLUGIN_JAVA_TRUE@java_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(JAVA_LDFLAGS)
 @BUILD_PLUGIN_JAVA_TRUE@java_la_LIBADD = $(JAVA_LIBS)
 @BUILD_PLUGIN_LOAD_TRUE@load_la_SOURCES = load.c
-@BUILD_PLUGIN_LOAD_TRUE@load_la_CFLAGS = $(AM_CFLAGS) $(am__append_81)
+@BUILD_PLUGIN_LOAD_TRUE@load_la_CFLAGS = $(AM_CFLAGS) $(am__append_89)
 @BUILD_PLUGIN_LOAD_TRUE@load_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_LOAD_TRUE@load_la_LIBADD = $(am__append_82) \
-@BUILD_PLUGIN_LOAD_TRUE@	$(am__append_83)
+@BUILD_PLUGIN_LOAD_TRUE@load_la_LIBADD = $(am__append_90) \
+@BUILD_PLUGIN_LOAD_TRUE@	$(am__append_91)
 @BUILD_PLUGIN_LOGFILE_TRUE@logfile_la_SOURCES = logfile.c
 @BUILD_PLUGIN_LOGFILE_TRUE@logfile_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@log_logstash_la_SOURCES = log_logstash.c
-@BUILD_PLUGIN_LOG_LOGSTASH_TRUE@log_logstash_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@log_logstash_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@log_logstash_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
 @BUILD_PLUGIN_LOG_LOGSTASH_TRUE@log_logstash_la_LIBADD = $(BUILD_WITH_LIBYAJL_LIBS)
 @BUILD_PLUGIN_LPAR_TRUE@lpar_la_SOURCES = lpar.c
 @BUILD_PLUGIN_LPAR_TRUE@lpar_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_LPAR_TRUE@lpar_la_LIBADD = -lperfstat
+@BUILD_PLUGIN_LUA_TRUE@lua_la_SOURCES = lua.c \
+@BUILD_PLUGIN_LUA_TRUE@		 utils_lua.c utils_lua.h
+
+@BUILD_PLUGIN_LUA_TRUE@lua_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBLUA_CFLAGS)
+@BUILD_PLUGIN_LUA_TRUE@lua_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_LUA_TRUE@lua_la_LIBADD = $(BUILD_WITH_LIBLUA_LIBS)
 @BUILD_PLUGIN_LVM_TRUE@lvm_la_SOURCES = lvm.c
-@BUILD_PLUGIN_LVM_TRUE@lvm_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_LVM_TRUE@lvm_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBLVM2APP_CPPFLAGS)
+@BUILD_PLUGIN_LVM_TRUE@lvm_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBLVM2APP_LDFLAGS)
 @BUILD_PLUGIN_LVM_TRUE@lvm_la_LIBADD = $(BUILD_WITH_LIBLVM2APP_LIBS)
 @BUILD_PLUGIN_MADWIFI_TRUE@madwifi_la_SOURCES = madwifi.c madwifi.h
 @BUILD_PLUGIN_MADWIFI_TRUE@madwifi_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE@match_empty_counter_la_SOURCES = match_empty_counter.c
 @BUILD_PLUGIN_MATCH_EMPTY_COUNTER_TRUE@match_empty_counter_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MATCH_HASHED_TRUE@match_hashed_la_SOURCES = match_hashed.c
@@ -2709,126 +2921,132 @@
 @BUILD_PLUGIN_MATCH_TIMEDIFF_TRUE@match_timediff_la_SOURCES = match_timediff.c
 @BUILD_PLUGIN_MATCH_TIMEDIFF_TRUE@match_timediff_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MATCH_VALUE_TRUE@match_value_la_SOURCES = match_value.c
 @BUILD_PLUGIN_MATCH_VALUE_TRUE@match_value_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MBMON_TRUE@mbmon_la_SOURCES = mbmon.c
 @BUILD_PLUGIN_MBMON_TRUE@mbmon_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_MBMON_TRUE@mbmon_la_LIBADD = $(am__append_95)
+@BUILD_PLUGIN_MBMON_TRUE@mbmon_la_LIBADD = $(am__append_104)
 @BUILD_PLUGIN_MD_TRUE@md_la_SOURCES = md.c
 @BUILD_PLUGIN_MD_TRUE@md_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MEMCACHEC_TRUE@memcachec_la_SOURCES = memcachec.c
 @BUILD_PLUGIN_MEMCACHEC_TRUE@memcachec_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBMEMCACHED_LDFLAGS)
 @BUILD_PLUGIN_MEMCACHEC_TRUE@memcachec_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBMEMCACHED_CPPFLAGS)
 @BUILD_PLUGIN_MEMCACHEC_TRUE@memcachec_la_LIBADD = $(BUILD_WITH_LIBMEMCACHED_LIBS)
 @BUILD_PLUGIN_MEMCACHED_TRUE@memcached_la_SOURCES = memcached.c
 @BUILD_PLUGIN_MEMCACHED_TRUE@memcached_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_MEMCACHED_TRUE@memcached_la_LIBADD = $(am__append_99)
+@BUILD_PLUGIN_MEMCACHED_TRUE@memcached_la_LIBADD = $(am__append_108)
 @BUILD_PLUGIN_MEMORY_TRUE@memory_la_SOURCES = memory.c
 @BUILD_PLUGIN_MEMORY_TRUE@memory_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_103)
+@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_112)
 @BUILD_PLUGIN_MEMORY_TRUE@memory_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_MEMORY_TRUE@memory_la_LIBADD = $(am__append_101) \
-@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_102) $(am__append_104) \
-@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_105)
+@BUILD_PLUGIN_MEMORY_TRUE@memory_la_LIBADD = $(am__append_110) \
+@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_111) $(am__append_113) \
+@BUILD_PLUGIN_MEMORY_TRUE@	$(am__append_114)
 @BUILD_PLUGIN_MIC_TRUE@mic_la_SOURCES = mic.c
 @BUILD_PLUGIN_MIC_TRUE@mic_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_MIC_LIBPATH)
 @BUILD_PLUGIN_MIC_TRUE@mic_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_MIC_CPPFLAGS)
 @BUILD_PLUGIN_MIC_TRUE@mic_la_LIBADD = $(BUILD_WITH_MIC_LDADD)
 @BUILD_PLUGIN_MODBUS_TRUE@modbus_la_SOURCES = modbus.c
 @BUILD_PLUGIN_MODBUS_TRUE@modbus_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MODBUS_TRUE@modbus_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBMODBUS_CFLAGS)
 @BUILD_PLUGIN_MODBUS_TRUE@modbus_la_LIBADD = $(BUILD_WITH_LIBMODBUS_LIBS)
+@BUILD_PLUGIN_MQTT_TRUE@mqtt_la_SOURCES = mqtt.c
+@BUILD_PLUGIN_MQTT_TRUE@mqtt_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBMOSQUITTO_CPPFLAGS)
+@BUILD_PLUGIN_MQTT_TRUE@mqtt_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBMOSQUITTO_LDFLAGS)
+@BUILD_PLUGIN_MQTT_TRUE@mqtt_la_LIBADD = $(BUILD_WITH_LIBMOSQUITTO_LIBS)
 @BUILD_PLUGIN_MULTIMETER_TRUE@multimeter_la_SOURCES = multimeter.c
 @BUILD_PLUGIN_MULTIMETER_TRUE@multimeter_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_MYSQL_TRUE@mysql_la_SOURCES = mysql.c
+@BUILD_PLUGIN_MYSQL_TRUE@mysql_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBMYSQL_CFLAGS)
 @BUILD_PLUGIN_MYSQL_TRUE@mysql_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_MYSQL_TRUE@mysql_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_MYSQL_TRUE@	$(am__append_110)
-@BUILD_PLUGIN_MYSQL_TRUE@mysql_la_LIBADD = $(am__append_111)
+@BUILD_PLUGIN_MYSQL_TRUE@mysql_la_LIBADD = $(BUILD_WITH_LIBMYSQL_LIBS)
 @BUILD_PLUGIN_NETAPP_TRUE@netapp_la_SOURCES = netapp.c
 @BUILD_PLUGIN_NETAPP_TRUE@netapp_la_CPPFLAGS = $(AM_CPPFLAGS) $(LIBNETAPP_CPPFLAGS)
 @BUILD_PLUGIN_NETAPP_TRUE@netapp_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBNETAPP_LDFLAGS)
 @BUILD_PLUGIN_NETAPP_TRUE@netapp_la_LIBADD = $(LIBNETAPP_LIBS)
 @BUILD_PLUGIN_NETLINK_TRUE@netlink_la_SOURCES = netlink.c
 @BUILD_PLUGIN_NETLINK_TRUE@netlink_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_NETLINK_TRUE@netlink_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBMNL_CFLAGS)
 @BUILD_PLUGIN_NETLINK_TRUE@netlink_la_LIBADD = $(BUILD_WITH_LIBMNL_LIBS)
 @BUILD_PLUGIN_NETWORK_TRUE@network_la_SOURCES = network.c network.h \
 @BUILD_PLUGIN_NETWORK_TRUE@		     utils_fbhash.c utils_fbhash.h
 
 @BUILD_PLUGIN_NETWORK_TRUE@network_la_CPPFLAGS = $(AM_CPPFLAGS) \
-@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_116)
+@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_124)
 @BUILD_PLUGIN_NETWORK_TRUE@network_la_LDFLAGS = $(PLUGIN_LDFLAGS) \
-@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_117)
-@BUILD_PLUGIN_NETWORK_TRUE@network_la_LIBADD = -lpthread \
-@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_115) $(am__append_118)
+@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_125)
+@BUILD_PLUGIN_NETWORK_TRUE@network_la_LIBADD = $(am__append_123) \
+@BUILD_PLUGIN_NETWORK_TRUE@	$(am__append_126)
 @BUILD_PLUGIN_NFS_TRUE@nfs_la_SOURCES = nfs.c
 @BUILD_PLUGIN_NFS_TRUE@nfs_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_FSCACHE_TRUE@fscache_la_SOURCES = fscache.c
 @BUILD_PLUGIN_FSCACHE_TRUE@fscache_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_NGINX_TRUE@nginx_la_SOURCES = nginx.c
-@BUILD_PLUGIN_NGINX_TRUE@nginx_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_NGINX_TRUE@	$(am__append_122)
-@BUILD_PLUGIN_NGINX_TRUE@nginx_la_LIBADD = $(am__append_123)
+@BUILD_PLUGIN_NGINX_TRUE@nginx_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
 @BUILD_PLUGIN_NGINX_TRUE@nginx_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_NGINX_TRUE@nginx_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS)
 @BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@notify_desktop_la_SOURCES = notify_desktop.c
 @BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@notify_desktop_la_CFLAGS = $(AM_CFLAGS) $(LIBNOTIFY_CFLAGS)
 @BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@notify_desktop_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_NOTIFY_DESKTOP_TRUE@notify_desktop_la_LIBADD = $(LIBNOTIFY_LIBS)
 @BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@notify_email_la_SOURCES = notify_email.c
 @BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@notify_email_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@notify_email_la_LIBADD = -lesmtp -lssl -lcrypto -lpthread
+@BUILD_PLUGIN_NOTIFY_EMAIL_TRUE@notify_email_la_LIBADD = -lesmtp -lssl -lcrypto
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@notify_nagios_la_SOURCES = notify_nagios.c
+@BUILD_PLUGIN_NOTIFY_NAGIOS_TRUE@notify_nagios_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_NTPD_TRUE@ntpd_la_SOURCES = ntpd.c
 @BUILD_PLUGIN_NTPD_TRUE@ntpd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_NTPD_TRUE@ntpd_la_LIBADD = $(am__append_127)
+@BUILD_PLUGIN_NTPD_TRUE@ntpd_la_LIBADD = $(am__append_134)
 @BUILD_PLUGIN_NUMA_TRUE@numa_la_SOURCES = numa.c
 @BUILD_PLUGIN_NUMA_TRUE@numa_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_NUT_TRUE@nut_la_SOURCES = nut.c
 @BUILD_PLUGIN_NUT_TRUE@nut_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBUPSCLIENT_CFLAGS)
 @BUILD_PLUGIN_NUT_TRUE@nut_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_NUT_TRUE@nut_la_LIBADD = -lpthread $(BUILD_WITH_LIBUPSCLIENT_LIBS)
+@BUILD_PLUGIN_NUT_TRUE@nut_la_LIBADD = $(BUILD_WITH_LIBUPSCLIENT_LIBS)
 @BUILD_PLUGIN_OLSRD_TRUE@olsrd_la_SOURCES = olsrd.c
 @BUILD_PLUGIN_OLSRD_TRUE@olsrd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_OLSRD_TRUE@olsrd_la_LIBADD = $(am__append_131)
+@BUILD_PLUGIN_OLSRD_TRUE@olsrd_la_LIBADD = $(am__append_138)
 @BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_SOURCES = onewire.c
-@BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBOWCAPI_CPPFLAGS)
 @BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_LIBADD = $(BUILD_WITH_LIBOWCAPI_LIBS)
-@BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_ONEWIRE_TRUE@onewire_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBOWCAPI_LDFLAGS)
 @BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_SOURCES = openldap.c
-@BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_LDFLAGS = -module -avoid-version $(BUILD_WITH_LIBLDAP_LDFLAGS)
-@BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBLDAP_CPPFLAGS)
+@BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBLDAP_CPPFLAGS)
+@BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBLDAP_LDFLAGS)
 @BUILD_PLUGIN_OPENLDAP_TRUE@openldap_la_LIBADD = -lldap
 @BUILD_PLUGIN_OPENVPN_TRUE@openvpn_la_SOURCES = openvpn.c
-@BUILD_PLUGIN_OPENVPN_TRUE@openvpn_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_OPENVPN_TRUE@openvpn_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_ORACLE_TRUE@oracle_la_SOURCES = oracle.c \
 @BUILD_PLUGIN_ORACLE_TRUE@	utils_db_query.c utils_db_query.h
 
-@BUILD_PLUGIN_ORACLE_TRUE@oracle_la_CFLAGS = $(AM_CFLAGS)
-@BUILD_PLUGIN_ORACLE_TRUE@oracle_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_ORACLE_CFLAGS)
+@BUILD_PLUGIN_ORACLE_TRUE@oracle_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_ORACLE_CPPFLAGS)
 @BUILD_PLUGIN_ORACLE_TRUE@oracle_la_LIBADD = $(BUILD_WITH_ORACLE_LIBS)
 @BUILD_PLUGIN_ORACLE_TRUE@oracle_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_PERL_TRUE@perl_la_SOURCES = perl.c
 # Despite C99 providing the "bool" type thru stdbool.h, Perl defines its own
 # version of that type if HAS_BOOL is not defined... *sigh*
-@BUILD_PLUGIN_PERL_TRUE@perl_la_CPPFLAGS = $(AM_CPPFLAGS) -DHAS_BOOL=1
+# Despite off_t being 64 bit wide on 64 bit platforms, Perl insist on using
+# off64_t which is only exposed when _LARGEFILE64_SOURCE is defined... *sigh*
+# On older platforms we also need _REENTRANT. _GNU_SOURCE sets both of these.
+@BUILD_PLUGIN_PERL_TRUE@perl_la_CPPFLAGS = $(AM_CPPFLAGS) -DHAS_BOOL=1 \
+@BUILD_PLUGIN_PERL_TRUE@	-D_GNU_SOURCE
 @BUILD_PLUGIN_PERL_TRUE@perl_la_CFLAGS = $(AM_CFLAGS) $(PERL_CFLAGS) \
 @BUILD_PLUGIN_PERL_TRUE@	-DXS_VERSION=\"$(VERSION)\" \
 @BUILD_PLUGIN_PERL_TRUE@	-DVERSION=\"$(VERSION)\" \
-@BUILD_PLUGIN_PERL_TRUE@	$(am__append_137)
+@BUILD_PLUGIN_PERL_TRUE@	$(am__append_144)
 @BUILD_PLUGIN_PERL_TRUE@perl_la_LDFLAGS = $(PLUGIN_LDFLAGS) \
 @BUILD_PLUGIN_PERL_TRUE@		$(PERL_LDFLAGS)
 
 @BUILD_PLUGIN_PERL_TRUE@perl_la_LIBADD = $(PERL_LIBS)
 @BUILD_PLUGIN_PF_TRUE@pf_la_SOURCES = pf.c
 @BUILD_PLUGIN_PF_TRUE@pf_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_PINBA_TRUE@pinba_la_SOURCES = pinba.c
 @BUILD_PLUGIN_PINBA_TRUE@nodist_pinba_la_SOURCES = pinba.pb-c.c pinba.pb-c.h
-@BUILD_PLUGIN_PINBA_TRUE@pinba_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_PINBA_TRUE@pinba_la_LIBADD = -lprotobuf-c
+@BUILD_PLUGIN_PINBA_TRUE@pinba_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBPROTOBUF_C_CPPFLAGS)
+@BUILD_PLUGIN_PINBA_TRUE@pinba_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBPROTOBUF_C_LDFLAGS)
+@BUILD_PLUGIN_PINBA_TRUE@pinba_la_LIBADD = $(BUILD_WITH_LIBPROTOBUF_C_LIBS)
 @BUILD_PLUGIN_PING_TRUE@ping_la_SOURCES = ping.c
 @BUILD_PLUGIN_PING_TRUE@ping_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBOPING_CPPFLAGS)
 @BUILD_PLUGIN_PING_TRUE@ping_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBOPING_LDFLAGS)
 @BUILD_PLUGIN_PING_TRUE@ping_la_LIBADD = -loping -lm
 @BUILD_PLUGIN_POSTGRESQL_TRUE@postgresql_la_SOURCES = postgresql.c \
 @BUILD_PLUGIN_POSTGRESQL_TRUE@		 utils_db_query.c utils_db_query.h
@@ -2838,20 +3056,19 @@
 @BUILD_PLUGIN_POSTGRESQL_TRUE@		$(BUILD_WITH_LIBPQ_LDFLAGS)
 
 @BUILD_PLUGIN_POSTGRESQL_TRUE@postgresql_la_LIBADD = -lpq
 @BUILD_PLUGIN_POWERDNS_TRUE@powerdns_la_SOURCES = powerdns.c
 @BUILD_PLUGIN_POWERDNS_TRUE@powerdns_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_PYTHON_TRUE@python_la_SOURCES = python.c pyconfig.c pyvalues.c cpython.h
-@BUILD_PLUGIN_PYTHON_TRUE@python_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_PYTHON_CPPFLAGS)
-@BUILD_PLUGIN_PYTHON_TRUE@python_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_PYTHON_TRUE@	$(am__append_144)
-@BUILD_PLUGIN_PYTHON_TRUE@python_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_PYTHON_LDFLAGS)
-@BUILD_PLUGIN_PYTHON_TRUE@python_la_LIBADD = $(BUILD_WITH_PYTHON_LIBS)
+@BUILD_PLUGIN_PYTHON_TRUE@python_la_CPPFLAGS = $(AM_CPPFLAGS) \
+@BUILD_PLUGIN_PYTHON_TRUE@	$(LIBPYTHON_CPPFLAGS) \
+@BUILD_PLUGIN_PYTHON_TRUE@	$(am__append_151)
+@BUILD_PLUGIN_PYTHON_TRUE@python_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBPYTHON_LDFLAGS)
 @BUILD_PLUGIN_PROCESSES_TRUE@processes_la_SOURCES = processes.c
 @BUILD_PLUGIN_PROCESSES_TRUE@processes_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_PROCESSES_TRUE@processes_la_LIBADD = $(am__append_146)
+@BUILD_PLUGIN_PROCESSES_TRUE@processes_la_LIBADD = $(am__append_153)
 @BUILD_PLUGIN_PROTOCOLS_TRUE@protocols_la_SOURCES = protocols.c
 @BUILD_PLUGIN_PROTOCOLS_TRUE@protocols_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_REDIS_TRUE@redis_la_SOURCES = redis.c
 @BUILD_PLUGIN_REDIS_TRUE@redis_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBHIREDIS_LDFLAGS)
 @BUILD_PLUGIN_REDIS_TRUE@redis_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBHIREDIS_CPPFLAGS)
 @BUILD_PLUGIN_REDIS_TRUE@redis_la_LIBADD = -lhiredis
@@ -2871,37 +3088,33 @@
 @BUILD_PLUGIN_SENSORS_TRUE@sensors_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBSENSORS_CFLAGS)
 @BUILD_PLUGIN_SENSORS_TRUE@sensors_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBSENSORS_LDFLAGS)
 @BUILD_PLUGIN_SENSORS_TRUE@sensors_la_LIBADD = -lsensors
 @BUILD_PLUGIN_SERIAL_TRUE@serial_la_SOURCES = serial.c
 @BUILD_PLUGIN_SERIAL_TRUE@serial_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_SOURCES = sigrok.c
-@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBSIGROK_CFLAGS)
-@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBSIGROK_LDFLAGS)
-@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_LIBADD = -lsigrok
+@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_CFLAGS = $(AM_CFLAGS) $(LIBSIGROK_CFLAGS)
+@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_SIGROK_TRUE@sigrok_la_LIBADD = $(LIBSIGROK_LIBS)
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@smart_la_SOURCES = smart.c
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@smart_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBATASMART_CPPFLAGS) $(BUILD_WITH_LIBUDEV_CFLAGS)
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@smart_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBATASMART_LDFLAGS) $(BUILD_WITH_LIBUDEV_LDFLAGS)
 @BUILD_PLUGIN_SMART_TRUE@@BUILD_WITH_LIBUDEV_TRUE@smart_la_LIBADD = $(BUILD_WITH_LIBATASMART_LIBS) $(BUILD_WITH_LIBUDEV_LIBS)
 @BUILD_PLUGIN_SNMP_TRUE@snmp_la_SOURCES = snmp.c
-@BUILD_PLUGIN_SNMP_TRUE@snmp_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_SNMP_TRUE@snmp_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_SNMP_TRUE@	$(am__append_157)
-@BUILD_PLUGIN_SNMP_TRUE@snmp_la_LIBADD = $(am__append_158) \
-@BUILD_PLUGIN_SNMP_TRUE@	$(am__append_159)
-@BUILD_PLUGIN_STATSD_TRUE@statsd_la_SOURCES = statsd.c \
-@BUILD_PLUGIN_STATSD_TRUE@                    utils_latency.h utils_latency.c
-
+@BUILD_PLUGIN_SNMP_TRUE@snmp_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBNETSNMP_CPPFLAGS)
+@BUILD_PLUGIN_SNMP_TRUE@snmp_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBNETSNMP_LDFLAGS)
+@BUILD_PLUGIN_SNMP_TRUE@snmp_la_LIBADD = $(BUILD_WITH_LIBNETSNMP_LIBS)
+@BUILD_PLUGIN_STATSD_TRUE@statsd_la_SOURCES = statsd.c
 @BUILD_PLUGIN_STATSD_TRUE@statsd_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_STATSD_TRUE@statsd_la_LIBADD = -lpthread -lm
+@BUILD_PLUGIN_STATSD_TRUE@statsd_la_LIBADD = liblatency.la -lm
 @BUILD_PLUGIN_SWAP_TRUE@swap_la_SOURCES = swap.c
 @BUILD_PLUGIN_SWAP_TRUE@swap_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_165)
+@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_169)
 @BUILD_PLUGIN_SWAP_TRUE@swap_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_SWAP_TRUE@swap_la_LIBADD = $(am__append_162) \
-@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_163) $(am__append_164) \
-@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_166) $(am__append_167)
+@BUILD_PLUGIN_SWAP_TRUE@swap_la_LIBADD = $(am__append_166) \
+@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_167) $(am__append_168) \
+@BUILD_PLUGIN_SWAP_TRUE@	$(am__append_170) $(am__append_171)
 @BUILD_PLUGIN_SYSLOG_TRUE@syslog_la_SOURCES = syslog.c
 @BUILD_PLUGIN_SYSLOG_TRUE@syslog_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TABLE_TRUE@table_la_SOURCES = table.c
 @BUILD_PLUGIN_TABLE_TRUE@table_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TAIL_TRUE@tail_la_SOURCES = tail.c
 @BUILD_PLUGIN_TAIL_TRUE@tail_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -2919,49 +3132,48 @@
 @BUILD_PLUGIN_TARGET_SET_TRUE@target_set_la_SOURCES = target_set.c
 @BUILD_PLUGIN_TARGET_SET_TRUE@target_set_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TARGET_V5UPGRADE_TRUE@target_v5upgrade_la_SOURCES = target_v5upgrade.c
 @BUILD_PLUGIN_TARGET_V5UPGRADE_TRUE@target_v5upgrade_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TCPCONNS_TRUE@tcpconns_la_SOURCES = tcpconns.c
 @BUILD_PLUGIN_TCPCONNS_TRUE@tcpconns_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_TCPCONNS_TRUE@tcpconns_la_LIBADD = $(am__append_179)
+@BUILD_PLUGIN_TCPCONNS_TRUE@tcpconns_la_LIBADD = $(am__append_183)
 @BUILD_PLUGIN_TEAMSPEAK2_TRUE@teamspeak2_la_SOURCES = teamspeak2.c
 @BUILD_PLUGIN_TEAMSPEAK2_TRUE@teamspeak2_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TED_TRUE@ted_la_SOURCES = ted.c
 @BUILD_PLUGIN_TED_TRUE@ted_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_THERMAL_TRUE@thermal_la_SOURCES = thermal.c
 @BUILD_PLUGIN_THERMAL_TRUE@thermal_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_THRESHOLD_TRUE@threshold_la_SOURCES = threshold.c
 @BUILD_PLUGIN_THRESHOLD_TRUE@threshold_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_TOKYOTYRANT_TRUE@tokyotyrant_la_SOURCES = tokyotyrant.c
 @BUILD_PLUGIN_TOKYOTYRANT_TRUE@tokyotyrant_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBTOKYOTYRANT_CPPFLAGS)
 @BUILD_PLUGIN_TOKYOTYRANT_TRUE@tokyotyrant_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBTOKYOTYRANT_LDFLAGS)
 @BUILD_PLUGIN_TOKYOTYRANT_TRUE@tokyotyrant_la_LIBADD = $(BUILD_WITH_LIBTOKYOTYRANT_LIBS) \
-@BUILD_PLUGIN_TOKYOTYRANT_TRUE@	$(am__append_185)
+@BUILD_PLUGIN_TOKYOTYRANT_TRUE@	$(am__append_189)
 @BUILD_PLUGIN_TURBOSTAT_TRUE@turbostat_la_SOURCES = turbostat.c
 @BUILD_PLUGIN_TURBOSTAT_TRUE@turbostat_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_UNIXSOCK_TRUE@unixsock_la_SOURCES = unixsock.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_flush.h utils_cmd_flush.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_getval.h utils_cmd_getval.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_getthreshold.h utils_cmd_getthreshold.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_listval.h utils_cmd_listval.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_putval.h utils_cmd_putval.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_cmd_putnotif.h utils_cmd_putnotif.c \
 @BUILD_PLUGIN_UNIXSOCK_TRUE@		      utils_parse_option.h utils_parse_option.c
 
 @BUILD_PLUGIN_UNIXSOCK_TRUE@unixsock_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_UNIXSOCK_TRUE@unixsock_la_LIBADD = -lpthread
 @BUILD_PLUGIN_UPTIME_TRUE@uptime_la_SOURCES = uptime.c
 @BUILD_PLUGIN_UPTIME_TRUE@uptime_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_UPTIME_TRUE@uptime_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_UPTIME_TRUE@uptime_la_LIBADD = $(am__append_189) \
-@BUILD_PLUGIN_UPTIME_TRUE@	$(am__append_190)
+@BUILD_PLUGIN_UPTIME_TRUE@uptime_la_LIBADD = $(am__append_193) \
+@BUILD_PLUGIN_UPTIME_TRUE@	$(am__append_194)
 @BUILD_PLUGIN_USERS_TRUE@users_la_SOURCES = users.c
 @BUILD_PLUGIN_USERS_TRUE@users_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_USERS_TRUE@	$(am__append_192)
+@BUILD_PLUGIN_USERS_TRUE@	$(am__append_196)
 @BUILD_PLUGIN_USERS_TRUE@users_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_USERS_TRUE@users_la_LIBADD = $(am__append_193)
+@BUILD_PLUGIN_USERS_TRUE@users_la_LIBADD = $(am__append_197)
 @BUILD_PLUGIN_UUID_TRUE@uuid_la_SOURCES = uuid.c
 @BUILD_PLUGIN_UUID_TRUE@uuid_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBHAL_CFLAGS)
 @BUILD_PLUGIN_UUID_TRUE@uuid_la_LIBADD = $(BUILD_WITH_LIBHAL_LIBS)
 @BUILD_PLUGIN_UUID_TRUE@uuid_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_VARNISH_TRUE@varnish_la_SOURCES = varnish.c
 @BUILD_PLUGIN_VARNISH_TRUE@varnish_la_LDFLAGS = $(PLUGIN_LDFLAGS)
@@ -2977,113 +3189,108 @@
 @BUILD_PLUGIN_VMEM_TRUE@vmem_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_VSERVER_TRUE@vserver_la_SOURCES = vserver.c
 @BUILD_PLUGIN_VSERVER_TRUE@vserver_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_WIRELESS_TRUE@wireless_la_SOURCES = wireless.c
 @BUILD_PLUGIN_WIRELESS_TRUE@wireless_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@write_graphite_la_SOURCES = write_graphite.c \
-@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@                        utils_format_graphite.c utils_format_graphite.h \
-@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@                        utils_format_json.c utils_format_json.h
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@                        utils_format_graphite.c utils_format_graphite.h
 
 @BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@write_graphite_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_WRITE_GRAPHITE_TRUE@write_graphite_la_LIBADD = libformat_json.la
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_SOURCES = write_http.c \
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@			utils_format_json.c utils_format_json.h
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@			utils_format_kairosdb.c utils_format_kairosdb.h
 
 @BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_CFLAGS = $(AM_CFLAGS) \
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@	$(am__append_202)
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_LIBADD =  \
-@BUILD_PLUGIN_WRITE_HTTP_TRUE@	$(am__append_203)
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBCURL_CFLAGS)
+@BUILD_PLUGIN_WRITE_HTTP_TRUE@write_http_la_LIBADD = $(BUILD_WITH_LIBCURL_LIBS) libformat_json.la
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_SOURCES = write_kafka.c \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@                        utils_format_graphite.c utils_format_graphite.h \
-@BUILD_PLUGIN_WRITE_KAFKA_TRUE@                        utils_format_json.c utils_format_json.h \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@                        utils_cmd_putval.c utils_cmd_putval.h \
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@                        utils_crc32.c utils_crc32.h
 
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBRDKAFKA_CPPFLAGS)
 @BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBRDKAFKA_LDFLAGS)
-@BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_LIBADD = $(BUILD_WITH_LIBRDKAFKA_LIBS)
+@BUILD_PLUGIN_WRITE_KAFKA_TRUE@write_kafka_la_LIBADD = $(BUILD_WITH_LIBRDKAFKA_LIBS) libformat_json.la
 @BUILD_PLUGIN_WRITE_LOG_TRUE@write_log_la_SOURCES = write_log.c \
 @BUILD_PLUGIN_WRITE_LOG_TRUE@                        utils_format_graphite.c utils_format_graphite.h
 
 @BUILD_PLUGIN_WRITE_LOG_TRUE@write_log_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_WRITE_MONGODB_TRUE@write_mongodb_la_SOURCES = write_mongodb.c
 @BUILD_PLUGIN_WRITE_MONGODB_TRUE@write_mongodb_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBMONGOC_CPPFLAGS)
 @BUILD_PLUGIN_WRITE_MONGODB_TRUE@write_mongodb_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBMONGOC_LDFLAGS)
 @BUILD_PLUGIN_WRITE_MONGODB_TRUE@write_mongodb_la_LIBADD = -lmongoc
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@write_redis_la_SOURCES = write_redis.c
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@write_redis_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBHIREDIS_LDFLAGS)
-@BUILD_PLUGIN_WRITE_REDIS_TRUE@write_redis_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBHIREDIS_CPPFLAGS)
+@BUILD_PLUGIN_WRITE_REDIS_TRUE@write_redis_la_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBHIREDIS_CPPFLAGS)
 @BUILD_PLUGIN_WRITE_REDIS_TRUE@write_redis_la_LIBADD = -lhiredis
 @BUILD_PLUGIN_WRITE_RIEMANN_TRUE@write_riemann_la_SOURCES = write_riemann.c write_riemann_threshold.c write_riemann_threshold.h
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@nodist_write_riemann_la_SOURCES = riemann.pb-c.c riemann.pb-c.h
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@write_riemann_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@write_riemann_la_LIBADD = -lprotobuf-c
+@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@write_riemann_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBRIEMANN_CLIENT_LIBS)
+@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@write_riemann_la_CFLAGS = $(AM_CFLAGS) $(LIBRIEMANN_CLIENT_CFLAGS)
 @BUILD_PLUGIN_WRITE_SENSU_TRUE@write_sensu_la_SOURCES = write_sensu.c
 @BUILD_PLUGIN_WRITE_SENSU_TRUE@write_sensu_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_WRITE_TSDB_TRUE@write_tsdb_la_SOURCES = write_tsdb.c
 @BUILD_PLUGIN_WRITE_TSDB_TRUE@write_tsdb_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_XENCPU_TRUE@xencpu_la_SOURCES = xencpu.c
+@BUILD_PLUGIN_XENCPU_TRUE@xencpu_la_CPPFLAGS = $(AM_CPPFLAGS) $(LIBXENCTL_CPPFLAGS)
+@BUILD_PLUGIN_XENCPU_TRUE@xencpu_la_LDFLAGS = $(PLUGIN_LDFLAGS) $(LIBXENCTL_LDFLAGS)
+@BUILD_PLUGIN_XENCPU_TRUE@xencpu_la_LIBADD = -lxenctrl
 @BUILD_PLUGIN_XMMS_TRUE@xmms_la_SOURCES = xmms.c
 @BUILD_PLUGIN_XMMS_TRUE@xmms_la_CFLAGS = $(AM_CFLAGS) $(BUILD_WITH_LIBXMMS_CFLAGS)
 @BUILD_PLUGIN_XMMS_TRUE@xmms_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 @BUILD_PLUGIN_XMMS_TRUE@xmms_la_LIBADD = $(BUILD_WITH_LIBXMMS_LIBS)
 @BUILD_PLUGIN_ZFS_ARC_TRUE@zfs_arc_la_SOURCES = zfs_arc.c
-@BUILD_PLUGIN_ZFS_ARC_TRUE@zfs_arc_la_CFLAGS = $(AM_CFLAGS)
 @BUILD_PLUGIN_ZFS_ARC_TRUE@zfs_arc_la_LDFLAGS = $(PLUGIN_LDFLAGS)
-# zfs_arc requires no library on linux
-# solaris
-@BUILD_FREEBSD_FALSE@@BUILD_LINUX_FALSE@@BUILD_PLUGIN_ZFS_ARC_TRUE@zfs_arc_la_LIBADD = -lkstat
 @BUILD_FREEBSD_TRUE@@BUILD_PLUGIN_ZFS_ARC_TRUE@zfs_arc_la_LIBADD = -lm
+@BUILD_PLUGIN_ZFS_ARC_TRUE@@BUILD_SOLARIS_TRUE@zfs_arc_la_LIBADD = -lkstat
 @BUILD_PLUGIN_ZOOKEEPER_TRUE@zookeeper_la_SOURCES = zookeeper.c
 @BUILD_PLUGIN_ZOOKEEPER_TRUE@zookeeper_la_LDFLAGS = $(PLUGIN_LDFLAGS)
+@BUILD_PLUGIN_ZONE_TRUE@zone_la_SOURCES = zone.c
+@BUILD_PLUGIN_ZONE_TRUE@zone_la_LDFLAGS = $(PLUGIN_LDFLAGS)
 dist_man_MANS = collectd.1 \
 		collectd.conf.5 \
 		collectd-email.5 \
 		collectd-exec.5 \
 		collectdctl.1 \
 		collectd-java.5 \
+		collectd-lua.5 \
 		collectdmon.1 \
 		collectd-nagios.1 \
 		collectd-perl.5 \
 		collectd-python.5 \
 		collectd-snmp.5 \
 		collectd-tg.1 \
 		collectd-threshold.5 \
 		collectd-unixsock.5 \
 		types.db.5
 
 
-#collectd_1_SOURCES = collectd.pod
-
 # Protocol buffer for the "pinba" plugin.
-
-# Protocol buffer for the "write_riemann" plugin.
-EXTRA_DIST = types.db collectd.conf.pod collectd-email.pod \
-	collectd-exec.pod collectdctl.pod collectd-java.pod \
+EXTRA_DIST = collectd.conf.pod collectd-email.pod collectd-exec.pod \
+	collectdctl.pod collectd-java.pod collectd-lua.pod \
 	collectdmon.pod collectd-nagios.pod collectd-perl.pod \
 	collectd-python.pod collectd.pod collectd-snmp.pod \
 	collectd-tg.pod collectd-threshold.pod collectd-unixsock.pod \
-	postgresql_default.conf types.db.pod pinba.proto riemann.proto
+	postgresql_default.conf types.db types.db.pod \
+	valgrind.FreeBSD.suppress pinba.proto
+AM_V_POD2MAN_C = $(am__v_POD2MAN_C_@AM_V@)
+am__v_POD2MAN_C_ = $(am__v_POD2MAN_C_@AM_DEFAULT_V@)
+am__v_POD2MAN_C_0 = @echo "  POD2MAN " $@;
+am__v_POD2MAN_C_1 = 
 AM_V_PROTOC_C = $(am__v_PROTOC_C_@AM_V@)
 am__v_PROTOC_C_ = $(am__v_PROTOC_C_@AM_DEFAULT_V@)
-am__v_PROTOC_C_0 = @echo "  PROTOC-C    " $@;
+am__v_PROTOC_C_0 = @echo "  PROTOC-C" $@;
 am__v_PROTOC_C_1 = 
-test_utils_mount_SOURCES = utils_mount_test.c testing.h
-test_utils_mount_LDADD = libmount.la daemon/libplugin_mock.la \
-	$(am__append_218)
-test_utils_vl_lookup_SOURCES = utils_vl_lookup_test.c testing.h
-test_utils_vl_lookup_LDADD = liblookup.la daemon/libplugin_mock.la \
-	$(am__append_219)
 @BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_SOURCES = ceph_test.c
 @BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_CPPFLAGS = $(AM_CPPFLAGS) $(BUILD_WITH_LIBYAJL_CPPFLAGS)
 @BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_LDFLAGS = $(PLUGIN_LDFLAGS) $(BUILD_WITH_LIBYAJL_LDFLAGS)
-@BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_LDADD = daemon/libcommon.la daemon/libplugin_mock.la $(BUILD_WITH_LIBYAJL_LIBS)
+@BUILD_PLUGIN_CEPH_TRUE@test_plugin_ceph_LDADD = daemon/libplugin_mock.la $(BUILD_WITH_LIBYAJL_LIBS)
 all: $(BUILT_SOURCES) config.h
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 
 .SUFFIXES:
-.SUFFIXES: .1 .5 .c .lo .log .o .obj .pod .test .test$(EXEEXT) .trs
+.SUFFIXES: .1 .5 .c .cc .lo .log .o .obj .pod .test .test$(EXEEXT) .trs
 $(srcdir)/Makefile.in:  $(srcdir)/Makefile.am  $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
 	      ( cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh ) \
 	        && { if test -f $@; then exit 0; else break; fi; }; \
@@ -3208,24 +3415,30 @@
 ceph.la: $(ceph_la_OBJECTS) $(ceph_la_DEPENDENCIES) $(EXTRA_ceph_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(ceph_la_LINK) $(am_ceph_la_rpath) $(ceph_la_OBJECTS) $(ceph_la_LIBADD) $(LIBS)
 
 cgroups.la: $(cgroups_la_OBJECTS) $(cgroups_la_DEPENDENCIES) $(EXTRA_cgroups_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(cgroups_la_LINK) $(am_cgroups_la_rpath) $(cgroups_la_OBJECTS) $(cgroups_la_LIBADD) $(LIBS)
 
+chrony.la: $(chrony_la_OBJECTS) $(chrony_la_DEPENDENCIES) $(EXTRA_chrony_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(chrony_la_LINK) $(am_chrony_la_rpath) $(chrony_la_OBJECTS) $(chrony_la_LIBADD) $(LIBS)
+
 conntrack.la: $(conntrack_la_OBJECTS) $(conntrack_la_DEPENDENCIES) $(EXTRA_conntrack_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(conntrack_la_LINK) $(am_conntrack_la_rpath) $(conntrack_la_OBJECTS) $(conntrack_la_LIBADD) $(LIBS)
 
 contextswitch.la: $(contextswitch_la_OBJECTS) $(contextswitch_la_DEPENDENCIES) $(EXTRA_contextswitch_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(contextswitch_la_LINK) $(am_contextswitch_la_rpath) $(contextswitch_la_OBJECTS) $(contextswitch_la_LIBADD) $(LIBS)
 
 cpu.la: $(cpu_la_OBJECTS) $(cpu_la_DEPENDENCIES) $(EXTRA_cpu_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(cpu_la_LINK) $(am_cpu_la_rpath) $(cpu_la_OBJECTS) $(cpu_la_LIBADD) $(LIBS)
 
 cpufreq.la: $(cpufreq_la_OBJECTS) $(cpufreq_la_DEPENDENCIES) $(EXTRA_cpufreq_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(cpufreq_la_LINK) $(am_cpufreq_la_rpath) $(cpufreq_la_OBJECTS) $(cpufreq_la_LIBADD) $(LIBS)
 
+cpusleep.la: $(cpusleep_la_OBJECTS) $(cpusleep_la_DEPENDENCIES) $(EXTRA_cpusleep_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(cpusleep_la_LINK) $(am_cpusleep_la_rpath) $(cpusleep_la_OBJECTS) $(cpusleep_la_LIBADD) $(LIBS)
+
 csv.la: $(csv_la_OBJECTS) $(csv_la_DEPENDENCIES) $(EXTRA_csv_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(csv_la_LINK) $(am_csv_la_rpath) $(csv_la_OBJECTS) $(csv_la_LIBADD) $(LIBS)
 
 curl.la: $(curl_la_OBJECTS) $(curl_la_DEPENDENCIES) $(EXTRA_curl_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(curl_la_LINK) $(am_curl_la_rpath) $(curl_la_OBJECTS) $(curl_la_LIBADD) $(LIBS)
 
@@ -3271,12 +3484,18 @@
 fscache.la: $(fscache_la_OBJECTS) $(fscache_la_DEPENDENCIES) $(EXTRA_fscache_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(fscache_la_LINK) $(am_fscache_la_rpath) $(fscache_la_OBJECTS) $(fscache_la_LIBADD) $(LIBS)
 
 gmond.la: $(gmond_la_OBJECTS) $(gmond_la_DEPENDENCIES) $(EXTRA_gmond_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(gmond_la_LINK) $(am_gmond_la_rpath) $(gmond_la_OBJECTS) $(gmond_la_LIBADD) $(LIBS)
 
+gps.la: $(gps_la_OBJECTS) $(gps_la_DEPENDENCIES) $(EXTRA_gps_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(gps_la_LINK) $(am_gps_la_rpath) $(gps_la_OBJECTS) $(gps_la_LIBADD) $(LIBS)
+
+grpc.la: $(grpc_la_OBJECTS) $(grpc_la_DEPENDENCIES) $(EXTRA_grpc_la_DEPENDENCIES) 
+	$(AM_V_CXXLD)$(grpc_la_LINK) $(am_grpc_la_rpath) $(grpc_la_OBJECTS) $(grpc_la_LIBADD) $(LIBS)
+
 hddtemp.la: $(hddtemp_la_OBJECTS) $(hddtemp_la_DEPENDENCIES) $(EXTRA_hddtemp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(hddtemp_la_LINK) $(am_hddtemp_la_rpath) $(hddtemp_la_OBJECTS) $(hddtemp_la_LIBADD) $(LIBS)
 
 interface.la: $(interface_la_OBJECTS) $(interface_la_DEPENDENCIES) $(EXTRA_interface_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(interface_la_LINK) $(am_interface_la_rpath) $(interface_la_OBJECTS) $(interface_la_LIBADD) $(LIBS)
 
@@ -3295,12 +3514,18 @@
 irq.la: $(irq_la_OBJECTS) $(irq_la_DEPENDENCIES) $(EXTRA_irq_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(irq_la_LINK) $(am_irq_la_rpath) $(irq_la_OBJECTS) $(irq_la_LIBADD) $(LIBS)
 
 java.la: $(java_la_OBJECTS) $(java_la_DEPENDENCIES) $(EXTRA_java_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(java_la_LINK) $(am_java_la_rpath) $(java_la_OBJECTS) $(java_la_LIBADD) $(LIBS)
 
+libformat_json.la: $(libformat_json_la_OBJECTS) $(libformat_json_la_DEPENDENCIES) $(EXTRA_libformat_json_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(libformat_json_la_LINK)  $(libformat_json_la_OBJECTS) $(libformat_json_la_LIBADD) $(LIBS)
+
+liblatency.la: $(liblatency_la_OBJECTS) $(liblatency_la_DEPENDENCIES) $(EXTRA_liblatency_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(LINK)  $(liblatency_la_OBJECTS) $(liblatency_la_LIBADD) $(LIBS)
+
 liblookup.la: $(liblookup_la_OBJECTS) $(liblookup_la_DEPENDENCIES) $(EXTRA_liblookup_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(LINK)  $(liblookup_la_OBJECTS) $(liblookup_la_LIBADD) $(LIBS)
 
 libmount.la: $(libmount_la_OBJECTS) $(libmount_la_DEPENDENCIES) $(EXTRA_libmount_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(LINK)  $(libmount_la_OBJECTS) $(libmount_la_LIBADD) $(LIBS)
 
@@ -3313,12 +3538,15 @@
 logfile.la: $(logfile_la_OBJECTS) $(logfile_la_DEPENDENCIES) $(EXTRA_logfile_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(logfile_la_LINK) $(am_logfile_la_rpath) $(logfile_la_OBJECTS) $(logfile_la_LIBADD) $(LIBS)
 
 lpar.la: $(lpar_la_OBJECTS) $(lpar_la_DEPENDENCIES) $(EXTRA_lpar_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(lpar_la_LINK) $(am_lpar_la_rpath) $(lpar_la_OBJECTS) $(lpar_la_LIBADD) $(LIBS)
 
+lua.la: $(lua_la_OBJECTS) $(lua_la_DEPENDENCIES) $(EXTRA_lua_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(lua_la_LINK) $(am_lua_la_rpath) $(lua_la_OBJECTS) $(lua_la_LIBADD) $(LIBS)
+
 lvm.la: $(lvm_la_OBJECTS) $(lvm_la_DEPENDENCIES) $(EXTRA_lvm_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(lvm_la_LINK) $(am_lvm_la_rpath) $(lvm_la_OBJECTS) $(lvm_la_LIBADD) $(LIBS)
 
 madwifi.la: $(madwifi_la_OBJECTS) $(madwifi_la_DEPENDENCIES) $(EXTRA_madwifi_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(madwifi_la_LINK) $(am_madwifi_la_rpath) $(madwifi_la_OBJECTS) $(madwifi_la_LIBADD) $(LIBS)
 
@@ -3355,12 +3583,15 @@
 mic.la: $(mic_la_OBJECTS) $(mic_la_DEPENDENCIES) $(EXTRA_mic_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(mic_la_LINK) $(am_mic_la_rpath) $(mic_la_OBJECTS) $(mic_la_LIBADD) $(LIBS)
 
 modbus.la: $(modbus_la_OBJECTS) $(modbus_la_DEPENDENCIES) $(EXTRA_modbus_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(modbus_la_LINK) $(am_modbus_la_rpath) $(modbus_la_OBJECTS) $(modbus_la_LIBADD) $(LIBS)
 
+mqtt.la: $(mqtt_la_OBJECTS) $(mqtt_la_DEPENDENCIES) $(EXTRA_mqtt_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(mqtt_la_LINK) $(am_mqtt_la_rpath) $(mqtt_la_OBJECTS) $(mqtt_la_LIBADD) $(LIBS)
+
 multimeter.la: $(multimeter_la_OBJECTS) $(multimeter_la_DEPENDENCIES) $(EXTRA_multimeter_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(multimeter_la_LINK) $(am_multimeter_la_rpath) $(multimeter_la_OBJECTS) $(multimeter_la_LIBADD) $(LIBS)
 
 mysql.la: $(mysql_la_OBJECTS) $(mysql_la_DEPENDENCIES) $(EXTRA_mysql_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(mysql_la_LINK) $(am_mysql_la_rpath) $(mysql_la_OBJECTS) $(mysql_la_LIBADD) $(LIBS)
 
@@ -3382,12 +3613,15 @@
 notify_desktop.la: $(notify_desktop_la_OBJECTS) $(notify_desktop_la_DEPENDENCIES) $(EXTRA_notify_desktop_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(notify_desktop_la_LINK) $(am_notify_desktop_la_rpath) $(notify_desktop_la_OBJECTS) $(notify_desktop_la_LIBADD) $(LIBS)
 
 notify_email.la: $(notify_email_la_OBJECTS) $(notify_email_la_DEPENDENCIES) $(EXTRA_notify_email_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(notify_email_la_LINK) $(am_notify_email_la_rpath) $(notify_email_la_OBJECTS) $(notify_email_la_LIBADD) $(LIBS)
 
+notify_nagios.la: $(notify_nagios_la_OBJECTS) $(notify_nagios_la_DEPENDENCIES) $(EXTRA_notify_nagios_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(notify_nagios_la_LINK) $(am_notify_nagios_la_rpath) $(notify_nagios_la_OBJECTS) $(notify_nagios_la_LIBADD) $(LIBS)
+
 ntpd.la: $(ntpd_la_OBJECTS) $(ntpd_la_DEPENDENCIES) $(EXTRA_ntpd_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(ntpd_la_LINK) $(am_ntpd_la_rpath) $(ntpd_la_OBJECTS) $(ntpd_la_LIBADD) $(LIBS)
 
 numa.la: $(numa_la_OBJECTS) $(numa_la_DEPENDENCIES) $(EXTRA_numa_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(numa_la_LINK) $(am_numa_la_rpath) $(numa_la_OBJECTS) $(numa_la_LIBADD) $(LIBS)
 
@@ -3571,18 +3805,24 @@
 write_sensu.la: $(write_sensu_la_OBJECTS) $(write_sensu_la_DEPENDENCIES) $(EXTRA_write_sensu_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(write_sensu_la_LINK) $(am_write_sensu_la_rpath) $(write_sensu_la_OBJECTS) $(write_sensu_la_LIBADD) $(LIBS)
 
 write_tsdb.la: $(write_tsdb_la_OBJECTS) $(write_tsdb_la_DEPENDENCIES) $(EXTRA_write_tsdb_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(write_tsdb_la_LINK) $(am_write_tsdb_la_rpath) $(write_tsdb_la_OBJECTS) $(write_tsdb_la_LIBADD) $(LIBS)
 
+xencpu.la: $(xencpu_la_OBJECTS) $(xencpu_la_DEPENDENCIES) $(EXTRA_xencpu_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(xencpu_la_LINK) $(am_xencpu_la_rpath) $(xencpu_la_OBJECTS) $(xencpu_la_LIBADD) $(LIBS)
+
 xmms.la: $(xmms_la_OBJECTS) $(xmms_la_DEPENDENCIES) $(EXTRA_xmms_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(xmms_la_LINK) $(am_xmms_la_rpath) $(xmms_la_OBJECTS) $(xmms_la_LIBADD) $(LIBS)
 
 zfs_arc.la: $(zfs_arc_la_OBJECTS) $(zfs_arc_la_DEPENDENCIES) $(EXTRA_zfs_arc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(zfs_arc_la_LINK) $(am_zfs_arc_la_rpath) $(zfs_arc_la_OBJECTS) $(zfs_arc_la_LIBADD) $(LIBS)
 
+zone.la: $(zone_la_OBJECTS) $(zone_la_DEPENDENCIES) $(EXTRA_zone_la_DEPENDENCIES) 
+	$(AM_V_CCLD)$(zone_la_LINK) $(am_zone_la_rpath) $(zone_la_OBJECTS) $(zone_la_LIBADD) $(LIBS)
+
 zookeeper.la: $(zookeeper_la_OBJECTS) $(zookeeper_la_DEPENDENCIES) $(EXTRA_zookeeper_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(zookeeper_la_LINK) $(am_zookeeper_la_rpath) $(zookeeper_la_OBJECTS) $(zookeeper_la_LIBADD) $(LIBS)
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	@list='$(bin_PROGRAMS)'; test -n "$(bindir)" || list=; \
 	if test -n "$$list"; then \
@@ -3703,16 +3943,24 @@
 	$(AM_V_CCLD)$(LINK) $(collectdctl_OBJECTS) $(collectdctl_LDADD) $(LIBS)
 
 collectdmon$(EXEEXT): $(collectdmon_OBJECTS) $(collectdmon_DEPENDENCIES) $(EXTRA_collectdmon_DEPENDENCIES) 
 	@rm -f collectdmon$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(collectdmon_OBJECTS) $(collectdmon_LDADD) $(LIBS)
 
+test_format_json$(EXEEXT): $(test_format_json_OBJECTS) $(test_format_json_DEPENDENCIES) $(EXTRA_test_format_json_DEPENDENCIES) 
+	@rm -f test_format_json$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(test_format_json_OBJECTS) $(test_format_json_LDADD) $(LIBS)
+
 test_plugin_ceph$(EXEEXT): $(test_plugin_ceph_OBJECTS) $(test_plugin_ceph_DEPENDENCIES) $(EXTRA_test_plugin_ceph_DEPENDENCIES) 
 	@rm -f test_plugin_ceph$(EXEEXT)
 	$(AM_V_CCLD)$(test_plugin_ceph_LINK) $(test_plugin_ceph_OBJECTS) $(test_plugin_ceph_LDADD) $(LIBS)
 
+test_utils_latency$(EXEEXT): $(test_utils_latency_OBJECTS) $(test_utils_latency_DEPENDENCIES) $(EXTRA_test_utils_latency_DEPENDENCIES) 
+	@rm -f test_utils_latency$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(test_utils_latency_OBJECTS) $(test_utils_latency_LDADD) $(LIBS)
+
 test_utils_mount$(EXEEXT): $(test_utils_mount_OBJECTS) $(test_utils_mount_DEPENDENCIES) $(EXTRA_test_utils_mount_DEPENDENCIES) 
 	@rm -f test_utils_mount$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(test_utils_mount_OBJECTS) $(test_utils_mount_LDADD) $(LIBS)
 
 test_utils_vl_lookup$(EXEEXT): $(test_utils_vl_lookup_OBJECTS) $(test_utils_vl_lookup_DEPENDENCIES) $(EXTRA_test_utils_vl_lookup_DEPENDENCIES) 
 	@rm -f test_utils_vl_lookup$(EXEEXT)
@@ -3725,36 +3973,40 @@
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/aggregation.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amqp_la-amqp.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amqp_la-utils_cmd_putval.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amqp_la-utils_format_graphite.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amqp_la-utils_format_json.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amqp_la-utils_parse_option.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/apache_la-apache.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/apcups.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/apple_sensors.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/aquaero_la-aquaero.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ascent_la-ascent.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/barometer.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/battery.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/bind_la-bind.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ceph_la-ceph.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cgroups.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/chrony.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd_nagios-collectd-nagios.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectd_tg-collectd-tg.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectdctl-collectdctl.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectdmon-collectdmon.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/collectdmon.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/conntrack.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/contextswitch.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cpu_la-cpu.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cpufreq.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cpusleep.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/csv.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_json_la-curl_json.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_json_la-utils_curl_stats.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_la-curl.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_la-utils_curl_stats.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_xml_la-curl_xml.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_xml_la-utils_curl_stats.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dbi_la-dbi.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dbi_la-utils_db_query.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/df.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/disk_la-disk.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dns.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/drbd.Plo@am__quote@
@@ -3763,25 +4015,33 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ethstat.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/exec.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fhcount.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/filecount.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fscache.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gmond_la-gmond.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gps_la-gps.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/grpc_la-collectd.grpc.pb.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/grpc_la-collectd.pb.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/grpc_la-grpc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/grpc_la-types.pb.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/hddtemp.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/interface_la-interface.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipc_la-ipc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipc.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipmi_la-ipmi.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/iptables_la-iptables.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ipvs_la-ipvs.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/irq.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/java_la-java.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libformat_json_la-utils_format_json.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_la-load.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/log_logstash_la-log_logstash.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/logfile.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lpar.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lvm.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lua_la-lua.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lua_la-utils_lua.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lvm_la-lvm.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/madwifi.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match_empty_counter.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match_hashed.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match_regex.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match_timediff.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/match_value.Plo@am__quote@
@@ -3789,46 +4049,47 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memcachec_la-memcachec.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memcached.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memory_la-memory.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mic_la-mic.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/modbus_la-modbus.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mqtt_la-mqtt.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/multimeter.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mysql_la-mysql.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/netapp_la-netapp.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/netlink_la-netlink.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/network_la-network.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/network_la-utils_fbhash.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nfs.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nginx_la-nginx.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/notify_desktop_la-notify_desktop.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/notify_email.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/notify_nagios.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ntpd.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/numa.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nut_la-nut.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/olsrd.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/onewire_la-onewire.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/openldap_la-openldap.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/openvpn_la-openvpn.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/openvpn.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/oracle_la-oracle.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/oracle_la-utils_db_query.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/perl_la-perl.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pf.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pinba.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pinba.pb-c.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pinba_la-pinba.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pinba_la-pinba.pb-c.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ping_la-ping.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/postgresql_la-postgresql.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/postgresql_la-utils_db_query.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/powerdns.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/processes.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/protocols.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/python_la-pyconfig.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/python_la-python.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/python_la-pyvalues.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/redis_la-redis.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/riemann.pb-c.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/routeros_la-routeros.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rrdcached_la-rrdcached.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rrdcached_la-utils_rrdcreate.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rrdtool_la-rrdtool.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/rrdtool_la-utils_rrdcreate.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sensors_la-sensors.Plo@am__quote@
@@ -3864,42 +4125,44 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_cmd_getval.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_cmd_listval.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_cmd_putnotif.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_cmd_putval.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_dns.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_format_graphite.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_format_json.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_format_json_test.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_latency.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_latency_test.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_mount.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_mount_test.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_parse_option.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_vl_lookup.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils_vl_lookup_test.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/uuid_la-uuid.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/varnish_la-varnish.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/virt_la-virt.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/vmem.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/vserver.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/wireless.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_graphite.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_http_la-utils_format_json.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_http_la-utils_format_kairosdb.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_http_la-write_http.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_kafka_la-utils_cmd_putval.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_kafka_la-utils_crc32.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_kafka_la-utils_format_graphite.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_kafka_la-utils_format_json.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_kafka_la-write_kafka.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_log.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_mongodb_la-write_mongodb.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_redis_la-write_redis.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_riemann.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_riemann_threshold.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_riemann_la-write_riemann.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_riemann_la-write_riemann_threshold.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_sensu.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/write_tsdb.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/xencpu_la-xencpu.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/xmms_la-xmms.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/zfs_arc_la-zfs_arc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/zfs_arc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/zone.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/zookeeper.Plo@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	$(AM_V_CC)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`;\
 @am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
 @am__fastdepCC_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
@@ -3948,19 +4211,12 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(amqp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT amqp_la-utils_format_graphite.lo -MD -MP -MF $(DEPDIR)/amqp_la-utils_format_graphite.Tpo -c -o amqp_la-utils_format_graphite.lo `test -f 'utils_format_graphite.c' || echo '$(srcdir)/'`utils_format_graphite.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/amqp_la-utils_format_graphite.Tpo $(DEPDIR)/amqp_la-utils_format_graphite.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_graphite.c' object='amqp_la-utils_format_graphite.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(amqp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o amqp_la-utils_format_graphite.lo `test -f 'utils_format_graphite.c' || echo '$(srcdir)/'`utils_format_graphite.c
 
-amqp_la-utils_format_json.lo: utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(amqp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT amqp_la-utils_format_json.lo -MD -MP -MF $(DEPDIR)/amqp_la-utils_format_json.Tpo -c -o amqp_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/amqp_la-utils_format_json.Tpo $(DEPDIR)/amqp_la-utils_format_json.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_json.c' object='amqp_la-utils_format_json.lo' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(amqp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o amqp_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
-
 apache_la-apache.lo: apache.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(apache_la_CFLAGS) $(CFLAGS) -MT apache_la-apache.lo -MD -MP -MF $(DEPDIR)/apache_la-apache.Tpo -c -o apache_la-apache.lo `test -f 'apache.c' || echo '$(srcdir)/'`apache.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/apache_la-apache.Tpo $(DEPDIR)/apache_la-apache.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='apache.c' object='apache_la-apache.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(apache_la_CFLAGS) $(CFLAGS) -c -o apache_la-apache.lo `test -f 'apache.c' || echo '$(srcdir)/'`apache.c
@@ -4004,26 +4260,47 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_la_CFLAGS) $(CFLAGS) -MT curl_la-curl.lo -MD -MP -MF $(DEPDIR)/curl_la-curl.Tpo -c -o curl_la-curl.lo `test -f 'curl.c' || echo '$(srcdir)/'`curl.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_la-curl.Tpo $(DEPDIR)/curl_la-curl.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='curl.c' object='curl_la-curl.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_la_CFLAGS) $(CFLAGS) -c -o curl_la-curl.lo `test -f 'curl.c' || echo '$(srcdir)/'`curl.c
 
+curl_la-utils_curl_stats.lo: utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_la_CFLAGS) $(CFLAGS) -MT curl_la-utils_curl_stats.lo -MD -MP -MF $(DEPDIR)/curl_la-utils_curl_stats.Tpo -c -o curl_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_la-utils_curl_stats.Tpo $(DEPDIR)/curl_la-utils_curl_stats.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_curl_stats.c' object='curl_la-utils_curl_stats.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_la_CFLAGS) $(CFLAGS) -c -o curl_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+
 curl_json_la-curl_json.lo: curl_json.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(curl_json_la_CPPFLAGS) $(CPPFLAGS) $(curl_json_la_CFLAGS) $(CFLAGS) -MT curl_json_la-curl_json.lo -MD -MP -MF $(DEPDIR)/curl_json_la-curl_json.Tpo -c -o curl_json_la-curl_json.lo `test -f 'curl_json.c' || echo '$(srcdir)/'`curl_json.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_json_la-curl_json.Tpo $(DEPDIR)/curl_json_la-curl_json.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='curl_json.c' object='curl_json_la-curl_json.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(curl_json_la_CPPFLAGS) $(CPPFLAGS) $(curl_json_la_CFLAGS) $(CFLAGS) -c -o curl_json_la-curl_json.lo `test -f 'curl_json.c' || echo '$(srcdir)/'`curl_json.c
 
+curl_json_la-utils_curl_stats.lo: utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(curl_json_la_CPPFLAGS) $(CPPFLAGS) $(curl_json_la_CFLAGS) $(CFLAGS) -MT curl_json_la-utils_curl_stats.lo -MD -MP -MF $(DEPDIR)/curl_json_la-utils_curl_stats.Tpo -c -o curl_json_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_json_la-utils_curl_stats.Tpo $(DEPDIR)/curl_json_la-utils_curl_stats.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_curl_stats.c' object='curl_json_la-utils_curl_stats.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(curl_json_la_CPPFLAGS) $(CPPFLAGS) $(curl_json_la_CFLAGS) $(CFLAGS) -c -o curl_json_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+
 curl_xml_la-curl_xml.lo: curl_xml.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_xml_la_CFLAGS) $(CFLAGS) -MT curl_xml_la-curl_xml.lo -MD -MP -MF $(DEPDIR)/curl_xml_la-curl_xml.Tpo -c -o curl_xml_la-curl_xml.lo `test -f 'curl_xml.c' || echo '$(srcdir)/'`curl_xml.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_xml_la-curl_xml.Tpo $(DEPDIR)/curl_xml_la-curl_xml.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='curl_xml.c' object='curl_xml_la-curl_xml.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_xml_la_CFLAGS) $(CFLAGS) -c -o curl_xml_la-curl_xml.lo `test -f 'curl_xml.c' || echo '$(srcdir)/'`curl_xml.c
 
+curl_xml_la-utils_curl_stats.lo: utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_xml_la_CFLAGS) $(CFLAGS) -MT curl_xml_la-utils_curl_stats.lo -MD -MP -MF $(DEPDIR)/curl_xml_la-utils_curl_stats.Tpo -c -o curl_xml_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/curl_xml_la-utils_curl_stats.Tpo $(DEPDIR)/curl_xml_la-utils_curl_stats.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_curl_stats.c' object='curl_xml_la-utils_curl_stats.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(curl_xml_la_CFLAGS) $(CFLAGS) -c -o curl_xml_la-utils_curl_stats.lo `test -f 'utils_curl_stats.c' || echo '$(srcdir)/'`utils_curl_stats.c
+
 dbi_la-dbi.lo: dbi.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(dbi_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT dbi_la-dbi.lo -MD -MP -MF $(DEPDIR)/dbi_la-dbi.Tpo -c -o dbi_la-dbi.lo `test -f 'dbi.c' || echo '$(srcdir)/'`dbi.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/dbi_la-dbi.Tpo $(DEPDIR)/dbi_la-dbi.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='dbi.c' object='dbi_la-dbi.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(dbi_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o dbi_la-dbi.lo `test -f 'dbi.c' || echo '$(srcdir)/'`dbi.c
@@ -4046,26 +4323,26 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(gmond_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT gmond_la-gmond.lo -MD -MP -MF $(DEPDIR)/gmond_la-gmond.Tpo -c -o gmond_la-gmond.lo `test -f 'gmond.c' || echo '$(srcdir)/'`gmond.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/gmond_la-gmond.Tpo $(DEPDIR)/gmond_la-gmond.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gmond.c' object='gmond_la-gmond.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(gmond_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o gmond_la-gmond.lo `test -f 'gmond.c' || echo '$(srcdir)/'`gmond.c
 
+gps_la-gps.lo: gps.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(gps_la_CFLAGS) $(CFLAGS) -MT gps_la-gps.lo -MD -MP -MF $(DEPDIR)/gps_la-gps.Tpo -c -o gps_la-gps.lo `test -f 'gps.c' || echo '$(srcdir)/'`gps.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/gps_la-gps.Tpo $(DEPDIR)/gps_la-gps.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gps.c' object='gps_la-gps.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(gps_la_CFLAGS) $(CFLAGS) -c -o gps_la-gps.lo `test -f 'gps.c' || echo '$(srcdir)/'`gps.c
+
 interface_la-interface.lo: interface.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(interface_la_CFLAGS) $(CFLAGS) -MT interface_la-interface.lo -MD -MP -MF $(DEPDIR)/interface_la-interface.Tpo -c -o interface_la-interface.lo `test -f 'interface.c' || echo '$(srcdir)/'`interface.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/interface_la-interface.Tpo $(DEPDIR)/interface_la-interface.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='interface.c' object='interface_la-interface.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(interface_la_CFLAGS) $(CFLAGS) -c -o interface_la-interface.lo `test -f 'interface.c' || echo '$(srcdir)/'`interface.c
 
-ipc_la-ipc.lo: ipc.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(ipc_la_CFLAGS) $(CFLAGS) -MT ipc_la-ipc.lo -MD -MP -MF $(DEPDIR)/ipc_la-ipc.Tpo -c -o ipc_la-ipc.lo `test -f 'ipc.c' || echo '$(srcdir)/'`ipc.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/ipc_la-ipc.Tpo $(DEPDIR)/ipc_la-ipc.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='ipc.c' object='ipc_la-ipc.lo' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(ipc_la_CFLAGS) $(CFLAGS) -c -o ipc_la-ipc.lo `test -f 'ipc.c' || echo '$(srcdir)/'`ipc.c
-
 ipmi_la-ipmi.lo: ipmi.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(ipmi_la_CFLAGS) $(CFLAGS) -MT ipmi_la-ipmi.lo -MD -MP -MF $(DEPDIR)/ipmi_la-ipmi.Tpo -c -o ipmi_la-ipmi.lo `test -f 'ipmi.c' || echo '$(srcdir)/'`ipmi.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/ipmi_la-ipmi.Tpo $(DEPDIR)/ipmi_la-ipmi.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='ipmi.c' object='ipmi_la-ipmi.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(ipmi_la_CFLAGS) $(CFLAGS) -c -o ipmi_la-ipmi.lo `test -f 'ipmi.c' || echo '$(srcdir)/'`ipmi.c
@@ -4088,25 +4365,53 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(java_la_CPPFLAGS) $(CPPFLAGS) $(java_la_CFLAGS) $(CFLAGS) -MT java_la-java.lo -MD -MP -MF $(DEPDIR)/java_la-java.Tpo -c -o java_la-java.lo `test -f 'java.c' || echo '$(srcdir)/'`java.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/java_la-java.Tpo $(DEPDIR)/java_la-java.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='java.c' object='java_la-java.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(java_la_CPPFLAGS) $(CPPFLAGS) $(java_la_CFLAGS) $(CFLAGS) -c -o java_la-java.lo `test -f 'java.c' || echo '$(srcdir)/'`java.c
 
+libformat_json_la-utils_format_json.lo: utils_format_json.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libformat_json_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libformat_json_la-utils_format_json.lo -MD -MP -MF $(DEPDIR)/libformat_json_la-utils_format_json.Tpo -c -o libformat_json_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libformat_json_la-utils_format_json.Tpo $(DEPDIR)/libformat_json_la-utils_format_json.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_json.c' object='libformat_json_la-utils_format_json.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libformat_json_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o libformat_json_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
+
 load_la-load.lo: load.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_la_CFLAGS) $(CFLAGS) -MT load_la-load.lo -MD -MP -MF $(DEPDIR)/load_la-load.Tpo -c -o load_la-load.lo `test -f 'load.c' || echo '$(srcdir)/'`load.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/load_la-load.Tpo $(DEPDIR)/load_la-load.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='load.c' object='load_la-load.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_la_CFLAGS) $(CFLAGS) -c -o load_la-load.lo `test -f 'load.c' || echo '$(srcdir)/'`load.c
 
 log_logstash_la-log_logstash.lo: log_logstash.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(log_logstash_la_CPPFLAGS) $(CPPFLAGS) $(log_logstash_la_CFLAGS) $(CFLAGS) -MT log_logstash_la-log_logstash.lo -MD -MP -MF $(DEPDIR)/log_logstash_la-log_logstash.Tpo -c -o log_logstash_la-log_logstash.lo `test -f 'log_logstash.c' || echo '$(srcdir)/'`log_logstash.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(log_logstash_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT log_logstash_la-log_logstash.lo -MD -MP -MF $(DEPDIR)/log_logstash_la-log_logstash.Tpo -c -o log_logstash_la-log_logstash.lo `test -f 'log_logstash.c' || echo '$(srcdir)/'`log_logstash.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/log_logstash_la-log_logstash.Tpo $(DEPDIR)/log_logstash_la-log_logstash.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='log_logstash.c' object='log_logstash_la-log_logstash.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(log_logstash_la_CPPFLAGS) $(CPPFLAGS) $(log_logstash_la_CFLAGS) $(CFLAGS) -c -o log_logstash_la-log_logstash.lo `test -f 'log_logstash.c' || echo '$(srcdir)/'`log_logstash.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(log_logstash_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o log_logstash_la-log_logstash.lo `test -f 'log_logstash.c' || echo '$(srcdir)/'`log_logstash.c
+
+lua_la-lua.lo: lua.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lua_la_CFLAGS) $(CFLAGS) -MT lua_la-lua.lo -MD -MP -MF $(DEPDIR)/lua_la-lua.Tpo -c -o lua_la-lua.lo `test -f 'lua.c' || echo '$(srcdir)/'`lua.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lua_la-lua.Tpo $(DEPDIR)/lua_la-lua.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lua.c' object='lua_la-lua.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lua_la_CFLAGS) $(CFLAGS) -c -o lua_la-lua.lo `test -f 'lua.c' || echo '$(srcdir)/'`lua.c
+
+lua_la-utils_lua.lo: utils_lua.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lua_la_CFLAGS) $(CFLAGS) -MT lua_la-utils_lua.lo -MD -MP -MF $(DEPDIR)/lua_la-utils_lua.Tpo -c -o lua_la-utils_lua.lo `test -f 'utils_lua.c' || echo '$(srcdir)/'`utils_lua.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lua_la-utils_lua.Tpo $(DEPDIR)/lua_la-utils_lua.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_lua.c' object='lua_la-utils_lua.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(lua_la_CFLAGS) $(CFLAGS) -c -o lua_la-utils_lua.lo `test -f 'utils_lua.c' || echo '$(srcdir)/'`utils_lua.c
+
+lvm_la-lvm.lo: lvm.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lvm_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT lvm_la-lvm.lo -MD -MP -MF $(DEPDIR)/lvm_la-lvm.Tpo -c -o lvm_la-lvm.lo `test -f 'lvm.c' || echo '$(srcdir)/'`lvm.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/lvm_la-lvm.Tpo $(DEPDIR)/lvm_la-lvm.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='lvm.c' object='lvm_la-lvm.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(lvm_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o lvm_la-lvm.lo `test -f 'lvm.c' || echo '$(srcdir)/'`lvm.c
 
 memcachec_la-memcachec.lo: memcachec.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(memcachec_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT memcachec_la-memcachec.lo -MD -MP -MF $(DEPDIR)/memcachec_la-memcachec.Tpo -c -o memcachec_la-memcachec.lo `test -f 'memcachec.c' || echo '$(srcdir)/'`memcachec.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/memcachec_la-memcachec.Tpo $(DEPDIR)/memcachec_la-memcachec.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='memcachec.c' object='memcachec_la-memcachec.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
@@ -4130,12 +4435,19 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(modbus_la_CFLAGS) $(CFLAGS) -MT modbus_la-modbus.lo -MD -MP -MF $(DEPDIR)/modbus_la-modbus.Tpo -c -o modbus_la-modbus.lo `test -f 'modbus.c' || echo '$(srcdir)/'`modbus.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/modbus_la-modbus.Tpo $(DEPDIR)/modbus_la-modbus.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='modbus.c' object='modbus_la-modbus.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(modbus_la_CFLAGS) $(CFLAGS) -c -o modbus_la-modbus.lo `test -f 'modbus.c' || echo '$(srcdir)/'`modbus.c
 
+mqtt_la-mqtt.lo: mqtt.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(mqtt_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT mqtt_la-mqtt.lo -MD -MP -MF $(DEPDIR)/mqtt_la-mqtt.Tpo -c -o mqtt_la-mqtt.lo `test -f 'mqtt.c' || echo '$(srcdir)/'`mqtt.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/mqtt_la-mqtt.Tpo $(DEPDIR)/mqtt_la-mqtt.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='mqtt.c' object='mqtt_la-mqtt.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(mqtt_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o mqtt_la-mqtt.lo `test -f 'mqtt.c' || echo '$(srcdir)/'`mqtt.c
+
 mysql_la-mysql.lo: mysql.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mysql_la_CFLAGS) $(CFLAGS) -MT mysql_la-mysql.lo -MD -MP -MF $(DEPDIR)/mysql_la-mysql.Tpo -c -o mysql_la-mysql.lo `test -f 'mysql.c' || echo '$(srcdir)/'`mysql.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/mysql_la-mysql.Tpo $(DEPDIR)/mysql_la-mysql.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='mysql.c' object='mysql_la-mysql.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mysql_la_CFLAGS) $(CFLAGS) -c -o mysql_la-mysql.lo `test -f 'mysql.c' || echo '$(srcdir)/'`mysql.c
@@ -4187,53 +4499,60 @@
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/nut_la-nut.Tpo $(DEPDIR)/nut_la-nut.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='nut.c' object='nut_la-nut.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(nut_la_CFLAGS) $(CFLAGS) -c -o nut_la-nut.lo `test -f 'nut.c' || echo '$(srcdir)/'`nut.c
 
 onewire_la-onewire.lo: onewire.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(onewire_la_CPPFLAGS) $(CPPFLAGS) $(onewire_la_CFLAGS) $(CFLAGS) -MT onewire_la-onewire.lo -MD -MP -MF $(DEPDIR)/onewire_la-onewire.Tpo -c -o onewire_la-onewire.lo `test -f 'onewire.c' || echo '$(srcdir)/'`onewire.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(onewire_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT onewire_la-onewire.lo -MD -MP -MF $(DEPDIR)/onewire_la-onewire.Tpo -c -o onewire_la-onewire.lo `test -f 'onewire.c' || echo '$(srcdir)/'`onewire.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/onewire_la-onewire.Tpo $(DEPDIR)/onewire_la-onewire.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='onewire.c' object='onewire_la-onewire.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(onewire_la_CPPFLAGS) $(CPPFLAGS) $(onewire_la_CFLAGS) $(CFLAGS) -c -o onewire_la-onewire.lo `test -f 'onewire.c' || echo '$(srcdir)/'`onewire.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(onewire_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o onewire_la-onewire.lo `test -f 'onewire.c' || echo '$(srcdir)/'`onewire.c
 
 openldap_la-openldap.lo: openldap.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(openldap_la_CFLAGS) $(CFLAGS) -MT openldap_la-openldap.lo -MD -MP -MF $(DEPDIR)/openldap_la-openldap.Tpo -c -o openldap_la-openldap.lo `test -f 'openldap.c' || echo '$(srcdir)/'`openldap.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(openldap_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT openldap_la-openldap.lo -MD -MP -MF $(DEPDIR)/openldap_la-openldap.Tpo -c -o openldap_la-openldap.lo `test -f 'openldap.c' || echo '$(srcdir)/'`openldap.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/openldap_la-openldap.Tpo $(DEPDIR)/openldap_la-openldap.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='openldap.c' object='openldap_la-openldap.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(openldap_la_CFLAGS) $(CFLAGS) -c -o openldap_la-openldap.lo `test -f 'openldap.c' || echo '$(srcdir)/'`openldap.c
-
-openvpn_la-openvpn.lo: openvpn.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(openvpn_la_CFLAGS) $(CFLAGS) -MT openvpn_la-openvpn.lo -MD -MP -MF $(DEPDIR)/openvpn_la-openvpn.Tpo -c -o openvpn_la-openvpn.lo `test -f 'openvpn.c' || echo '$(srcdir)/'`openvpn.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/openvpn_la-openvpn.Tpo $(DEPDIR)/openvpn_la-openvpn.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='openvpn.c' object='openvpn_la-openvpn.lo' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(openvpn_la_CFLAGS) $(CFLAGS) -c -o openvpn_la-openvpn.lo `test -f 'openvpn.c' || echo '$(srcdir)/'`openvpn.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(openldap_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o openldap_la-openldap.lo `test -f 'openldap.c' || echo '$(srcdir)/'`openldap.c
 
 oracle_la-oracle.lo: oracle.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(oracle_la_CFLAGS) $(CFLAGS) -MT oracle_la-oracle.lo -MD -MP -MF $(DEPDIR)/oracle_la-oracle.Tpo -c -o oracle_la-oracle.lo `test -f 'oracle.c' || echo '$(srcdir)/'`oracle.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT oracle_la-oracle.lo -MD -MP -MF $(DEPDIR)/oracle_la-oracle.Tpo -c -o oracle_la-oracle.lo `test -f 'oracle.c' || echo '$(srcdir)/'`oracle.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/oracle_la-oracle.Tpo $(DEPDIR)/oracle_la-oracle.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='oracle.c' object='oracle_la-oracle.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(oracle_la_CFLAGS) $(CFLAGS) -c -o oracle_la-oracle.lo `test -f 'oracle.c' || echo '$(srcdir)/'`oracle.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o oracle_la-oracle.lo `test -f 'oracle.c' || echo '$(srcdir)/'`oracle.c
 
 oracle_la-utils_db_query.lo: utils_db_query.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(oracle_la_CFLAGS) $(CFLAGS) -MT oracle_la-utils_db_query.lo -MD -MP -MF $(DEPDIR)/oracle_la-utils_db_query.Tpo -c -o oracle_la-utils_db_query.lo `test -f 'utils_db_query.c' || echo '$(srcdir)/'`utils_db_query.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT oracle_la-utils_db_query.lo -MD -MP -MF $(DEPDIR)/oracle_la-utils_db_query.Tpo -c -o oracle_la-utils_db_query.lo `test -f 'utils_db_query.c' || echo '$(srcdir)/'`utils_db_query.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/oracle_la-utils_db_query.Tpo $(DEPDIR)/oracle_la-utils_db_query.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_db_query.c' object='oracle_la-utils_db_query.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(oracle_la_CFLAGS) $(CFLAGS) -c -o oracle_la-utils_db_query.lo `test -f 'utils_db_query.c' || echo '$(srcdir)/'`utils_db_query.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(oracle_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o oracle_la-utils_db_query.lo `test -f 'utils_db_query.c' || echo '$(srcdir)/'`utils_db_query.c
 
 perl_la-perl.lo: perl.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(perl_la_CPPFLAGS) $(CPPFLAGS) $(perl_la_CFLAGS) $(CFLAGS) -MT perl_la-perl.lo -MD -MP -MF $(DEPDIR)/perl_la-perl.Tpo -c -o perl_la-perl.lo `test -f 'perl.c' || echo '$(srcdir)/'`perl.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/perl_la-perl.Tpo $(DEPDIR)/perl_la-perl.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='perl.c' object='perl_la-perl.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(perl_la_CPPFLAGS) $(CPPFLAGS) $(perl_la_CFLAGS) $(CFLAGS) -c -o perl_la-perl.lo `test -f 'perl.c' || echo '$(srcdir)/'`perl.c
 
+pinba_la-pinba.lo: pinba.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(pinba_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT pinba_la-pinba.lo -MD -MP -MF $(DEPDIR)/pinba_la-pinba.Tpo -c -o pinba_la-pinba.lo `test -f 'pinba.c' || echo '$(srcdir)/'`pinba.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/pinba_la-pinba.Tpo $(DEPDIR)/pinba_la-pinba.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='pinba.c' object='pinba_la-pinba.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(pinba_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o pinba_la-pinba.lo `test -f 'pinba.c' || echo '$(srcdir)/'`pinba.c
+
+pinba_la-pinba.pb-c.lo: pinba.pb-c.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(pinba_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT pinba_la-pinba.pb-c.lo -MD -MP -MF $(DEPDIR)/pinba_la-pinba.pb-c.Tpo -c -o pinba_la-pinba.pb-c.lo `test -f 'pinba.pb-c.c' || echo '$(srcdir)/'`pinba.pb-c.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/pinba_la-pinba.pb-c.Tpo $(DEPDIR)/pinba_la-pinba.pb-c.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='pinba.pb-c.c' object='pinba_la-pinba.pb-c.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(pinba_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o pinba_la-pinba.pb-c.lo `test -f 'pinba.pb-c.c' || echo '$(srcdir)/'`pinba.pb-c.c
+
 ping_la-ping.lo: ping.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(ping_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT ping_la-ping.lo -MD -MP -MF $(DEPDIR)/ping_la-ping.Tpo -c -o ping_la-ping.lo `test -f 'ping.c' || echo '$(srcdir)/'`ping.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/ping_la-ping.Tpo $(DEPDIR)/ping_la-ping.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='ping.c' object='ping_la-ping.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(ping_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o ping_la-ping.lo `test -f 'ping.c' || echo '$(srcdir)/'`ping.c
@@ -4250,31 +4569,31 @@
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/postgresql_la-utils_db_query.Tpo $(DEPDIR)/postgresql_la-utils_db_query.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_db_query.c' object='postgresql_la-utils_db_query.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(postgresql_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o postgresql_la-utils_db_query.lo `test -f 'utils_db_query.c' || echo '$(srcdir)/'`utils_db_query.c
 
 python_la-python.lo: python.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -MT python_la-python.lo -MD -MP -MF $(DEPDIR)/python_la-python.Tpo -c -o python_la-python.lo `test -f 'python.c' || echo '$(srcdir)/'`python.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT python_la-python.lo -MD -MP -MF $(DEPDIR)/python_la-python.Tpo -c -o python_la-python.lo `test -f 'python.c' || echo '$(srcdir)/'`python.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/python_la-python.Tpo $(DEPDIR)/python_la-python.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='python.c' object='python_la-python.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -c -o python_la-python.lo `test -f 'python.c' || echo '$(srcdir)/'`python.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o python_la-python.lo `test -f 'python.c' || echo '$(srcdir)/'`python.c
 
 python_la-pyconfig.lo: pyconfig.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -MT python_la-pyconfig.lo -MD -MP -MF $(DEPDIR)/python_la-pyconfig.Tpo -c -o python_la-pyconfig.lo `test -f 'pyconfig.c' || echo '$(srcdir)/'`pyconfig.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT python_la-pyconfig.lo -MD -MP -MF $(DEPDIR)/python_la-pyconfig.Tpo -c -o python_la-pyconfig.lo `test -f 'pyconfig.c' || echo '$(srcdir)/'`pyconfig.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/python_la-pyconfig.Tpo $(DEPDIR)/python_la-pyconfig.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='pyconfig.c' object='python_la-pyconfig.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -c -o python_la-pyconfig.lo `test -f 'pyconfig.c' || echo '$(srcdir)/'`pyconfig.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o python_la-pyconfig.lo `test -f 'pyconfig.c' || echo '$(srcdir)/'`pyconfig.c
 
 python_la-pyvalues.lo: pyvalues.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -MT python_la-pyvalues.lo -MD -MP -MF $(DEPDIR)/python_la-pyvalues.Tpo -c -o python_la-pyvalues.lo `test -f 'pyvalues.c' || echo '$(srcdir)/'`pyvalues.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT python_la-pyvalues.lo -MD -MP -MF $(DEPDIR)/python_la-pyvalues.Tpo -c -o python_la-pyvalues.lo `test -f 'pyvalues.c' || echo '$(srcdir)/'`pyvalues.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/python_la-pyvalues.Tpo $(DEPDIR)/python_la-pyvalues.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='pyvalues.c' object='python_la-pyvalues.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(python_la_CFLAGS) $(CFLAGS) -c -o python_la-pyvalues.lo `test -f 'pyvalues.c' || echo '$(srcdir)/'`pyvalues.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(python_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o python_la-pyvalues.lo `test -f 'pyvalues.c' || echo '$(srcdir)/'`pyvalues.c
 
 redis_la-redis.lo: redis.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(redis_la_CFLAGS) $(CFLAGS) -MT redis_la-redis.lo -MD -MP -MF $(DEPDIR)/redis_la-redis.Tpo -c -o redis_la-redis.lo `test -f 'redis.c' || echo '$(srcdir)/'`redis.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/redis_la-redis.Tpo $(DEPDIR)/redis_la-redis.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='redis.c' object='redis_la-redis.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
@@ -4334,17 +4653,17 @@
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/smart_la-smart.Tpo $(DEPDIR)/smart_la-smart.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='smart.c' object='smart_la-smart.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(smart_la_CFLAGS) $(CFLAGS) -c -o smart_la-smart.lo `test -f 'smart.c' || echo '$(srcdir)/'`smart.c
 
 snmp_la-snmp.lo: snmp.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(snmp_la_CFLAGS) $(CFLAGS) -MT snmp_la-snmp.lo -MD -MP -MF $(DEPDIR)/snmp_la-snmp.Tpo -c -o snmp_la-snmp.lo `test -f 'snmp.c' || echo '$(srcdir)/'`snmp.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(snmp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT snmp_la-snmp.lo -MD -MP -MF $(DEPDIR)/snmp_la-snmp.Tpo -c -o snmp_la-snmp.lo `test -f 'snmp.c' || echo '$(srcdir)/'`snmp.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/snmp_la-snmp.Tpo $(DEPDIR)/snmp_la-snmp.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='snmp.c' object='snmp_la-snmp.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(snmp_la_CFLAGS) $(CFLAGS) -c -o snmp_la-snmp.lo `test -f 'snmp.c' || echo '$(srcdir)/'`snmp.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(snmp_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o snmp_la-snmp.lo `test -f 'snmp.c' || echo '$(srcdir)/'`snmp.c
 
 swap_la-swap.lo: swap.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(swap_la_CFLAGS) $(CFLAGS) -MT swap_la-swap.lo -MD -MP -MF $(DEPDIR)/swap_la-swap.Tpo -c -o swap_la-swap.lo `test -f 'swap.c' || echo '$(srcdir)/'`swap.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/swap_la-swap.Tpo $(DEPDIR)/swap_la-swap.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='swap.c' object='swap_la-swap.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
@@ -4396,18 +4715,18 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -MT write_http_la-write_http.lo -MD -MP -MF $(DEPDIR)/write_http_la-write_http.Tpo -c -o write_http_la-write_http.lo `test -f 'write_http.c' || echo '$(srcdir)/'`write_http.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_http_la-write_http.Tpo $(DEPDIR)/write_http_la-write_http.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_http.c' object='write_http_la-write_http.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -c -o write_http_la-write_http.lo `test -f 'write_http.c' || echo '$(srcdir)/'`write_http.c
 
-write_http_la-utils_format_json.lo: utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -MT write_http_la-utils_format_json.lo -MD -MP -MF $(DEPDIR)/write_http_la-utils_format_json.Tpo -c -o write_http_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_http_la-utils_format_json.Tpo $(DEPDIR)/write_http_la-utils_format_json.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_json.c' object='write_http_la-utils_format_json.lo' libtool=yes @AMDEPBACKSLASH@
+write_http_la-utils_format_kairosdb.lo: utils_format_kairosdb.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -MT write_http_la-utils_format_kairosdb.lo -MD -MP -MF $(DEPDIR)/write_http_la-utils_format_kairosdb.Tpo -c -o write_http_la-utils_format_kairosdb.lo `test -f 'utils_format_kairosdb.c' || echo '$(srcdir)/'`utils_format_kairosdb.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_http_la-utils_format_kairosdb.Tpo $(DEPDIR)/write_http_la-utils_format_kairosdb.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_kairosdb.c' object='write_http_la-utils_format_kairosdb.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -c -o write_http_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_http_la_CFLAGS) $(CFLAGS) -c -o write_http_la-utils_format_kairosdb.lo `test -f 'utils_format_kairosdb.c' || echo '$(srcdir)/'`utils_format_kairosdb.c
 
 write_kafka_la-write_kafka.lo: write_kafka.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT write_kafka_la-write_kafka.lo -MD -MP -MF $(DEPDIR)/write_kafka_la-write_kafka.Tpo -c -o write_kafka_la-write_kafka.lo `test -f 'write_kafka.c' || echo '$(srcdir)/'`write_kafka.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_kafka_la-write_kafka.Tpo $(DEPDIR)/write_kafka_la-write_kafka.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_kafka.c' object='write_kafka_la-write_kafka.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
@@ -4417,19 +4736,12 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT write_kafka_la-utils_format_graphite.lo -MD -MP -MF $(DEPDIR)/write_kafka_la-utils_format_graphite.Tpo -c -o write_kafka_la-utils_format_graphite.lo `test -f 'utils_format_graphite.c' || echo '$(srcdir)/'`utils_format_graphite.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_kafka_la-utils_format_graphite.Tpo $(DEPDIR)/write_kafka_la-utils_format_graphite.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_graphite.c' object='write_kafka_la-utils_format_graphite.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o write_kafka_la-utils_format_graphite.lo `test -f 'utils_format_graphite.c' || echo '$(srcdir)/'`utils_format_graphite.c
 
-write_kafka_la-utils_format_json.lo: utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT write_kafka_la-utils_format_json.lo -MD -MP -MF $(DEPDIR)/write_kafka_la-utils_format_json.Tpo -c -o write_kafka_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_kafka_la-utils_format_json.Tpo $(DEPDIR)/write_kafka_la-utils_format_json.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_format_json.c' object='write_kafka_la-utils_format_json.lo' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o write_kafka_la-utils_format_json.lo `test -f 'utils_format_json.c' || echo '$(srcdir)/'`utils_format_json.c
-
 write_kafka_la-utils_cmd_putval.lo: utils_cmd_putval.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT write_kafka_la-utils_cmd_putval.lo -MD -MP -MF $(DEPDIR)/write_kafka_la-utils_cmd_putval.Tpo -c -o write_kafka_la-utils_cmd_putval.lo `test -f 'utils_cmd_putval.c' || echo '$(srcdir)/'`utils_cmd_putval.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_kafka_la-utils_cmd_putval.Tpo $(DEPDIR)/write_kafka_la-utils_cmd_putval.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='utils_cmd_putval.c' object='write_kafka_la-utils_cmd_putval.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_kafka_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o write_kafka_la-utils_cmd_putval.lo `test -f 'utils_cmd_putval.c' || echo '$(srcdir)/'`utils_cmd_putval.c
@@ -4446,32 +4758,46 @@
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_mongodb_la-write_mongodb.Tpo $(DEPDIR)/write_mongodb_la-write_mongodb.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_mongodb.c' object='write_mongodb_la-write_mongodb.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_mongodb_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o write_mongodb_la-write_mongodb.lo `test -f 'write_mongodb.c' || echo '$(srcdir)/'`write_mongodb.c
 
 write_redis_la-write_redis.lo: write_redis.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_redis_la_CFLAGS) $(CFLAGS) -MT write_redis_la-write_redis.lo -MD -MP -MF $(DEPDIR)/write_redis_la-write_redis.Tpo -c -o write_redis_la-write_redis.lo `test -f 'write_redis.c' || echo '$(srcdir)/'`write_redis.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_redis_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT write_redis_la-write_redis.lo -MD -MP -MF $(DEPDIR)/write_redis_la-write_redis.Tpo -c -o write_redis_la-write_redis.lo `test -f 'write_redis.c' || echo '$(srcdir)/'`write_redis.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_redis_la-write_redis.Tpo $(DEPDIR)/write_redis_la-write_redis.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_redis.c' object='write_redis_la-write_redis.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_redis_la_CFLAGS) $(CFLAGS) -c -o write_redis_la-write_redis.lo `test -f 'write_redis.c' || echo '$(srcdir)/'`write_redis.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(write_redis_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o write_redis_la-write_redis.lo `test -f 'write_redis.c' || echo '$(srcdir)/'`write_redis.c
+
+write_riemann_la-write_riemann.lo: write_riemann.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_riemann_la_CFLAGS) $(CFLAGS) -MT write_riemann_la-write_riemann.lo -MD -MP -MF $(DEPDIR)/write_riemann_la-write_riemann.Tpo -c -o write_riemann_la-write_riemann.lo `test -f 'write_riemann.c' || echo '$(srcdir)/'`write_riemann.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_riemann_la-write_riemann.Tpo $(DEPDIR)/write_riemann_la-write_riemann.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_riemann.c' object='write_riemann_la-write_riemann.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_riemann_la_CFLAGS) $(CFLAGS) -c -o write_riemann_la-write_riemann.lo `test -f 'write_riemann.c' || echo '$(srcdir)/'`write_riemann.c
+
+write_riemann_la-write_riemann_threshold.lo: write_riemann_threshold.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_riemann_la_CFLAGS) $(CFLAGS) -MT write_riemann_la-write_riemann_threshold.lo -MD -MP -MF $(DEPDIR)/write_riemann_la-write_riemann_threshold.Tpo -c -o write_riemann_la-write_riemann_threshold.lo `test -f 'write_riemann_threshold.c' || echo '$(srcdir)/'`write_riemann_threshold.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/write_riemann_la-write_riemann_threshold.Tpo $(DEPDIR)/write_riemann_la-write_riemann_threshold.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='write_riemann_threshold.c' object='write_riemann_la-write_riemann_threshold.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(write_riemann_la_CFLAGS) $(CFLAGS) -c -o write_riemann_la-write_riemann_threshold.lo `test -f 'write_riemann_threshold.c' || echo '$(srcdir)/'`write_riemann_threshold.c
+
+xencpu_la-xencpu.lo: xencpu.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(xencpu_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT xencpu_la-xencpu.lo -MD -MP -MF $(DEPDIR)/xencpu_la-xencpu.Tpo -c -o xencpu_la-xencpu.lo `test -f 'xencpu.c' || echo '$(srcdir)/'`xencpu.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/xencpu_la-xencpu.Tpo $(DEPDIR)/xencpu_la-xencpu.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='xencpu.c' object='xencpu_la-xencpu.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(xencpu_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o xencpu_la-xencpu.lo `test -f 'xencpu.c' || echo '$(srcdir)/'`xencpu.c
 
 xmms_la-xmms.lo: xmms.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(xmms_la_CFLAGS) $(CFLAGS) -MT xmms_la-xmms.lo -MD -MP -MF $(DEPDIR)/xmms_la-xmms.Tpo -c -o xmms_la-xmms.lo `test -f 'xmms.c' || echo '$(srcdir)/'`xmms.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/xmms_la-xmms.Tpo $(DEPDIR)/xmms_la-xmms.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='xmms.c' object='xmms_la-xmms.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(xmms_la_CFLAGS) $(CFLAGS) -c -o xmms_la-xmms.lo `test -f 'xmms.c' || echo '$(srcdir)/'`xmms.c
 
-zfs_arc_la-zfs_arc.lo: zfs_arc.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(zfs_arc_la_CFLAGS) $(CFLAGS) -MT zfs_arc_la-zfs_arc.lo -MD -MP -MF $(DEPDIR)/zfs_arc_la-zfs_arc.Tpo -c -o zfs_arc_la-zfs_arc.lo `test -f 'zfs_arc.c' || echo '$(srcdir)/'`zfs_arc.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/zfs_arc_la-zfs_arc.Tpo $(DEPDIR)/zfs_arc_la-zfs_arc.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='zfs_arc.c' object='zfs_arc_la-zfs_arc.lo' libtool=yes @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(zfs_arc_la_CFLAGS) $(CFLAGS) -c -o zfs_arc_la-zfs_arc.lo `test -f 'zfs_arc.c' || echo '$(srcdir)/'`zfs_arc.c
-
 collectd_nagios-collectd-nagios.o: collectd-nagios.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectd_nagios_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT collectd_nagios-collectd-nagios.o -MD -MP -MF $(DEPDIR)/collectd_nagios-collectd-nagios.Tpo -c -o collectd_nagios-collectd-nagios.o `test -f 'collectd-nagios.c' || echo '$(srcdir)/'`collectd-nagios.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/collectd_nagios-collectd-nagios.Tpo $(DEPDIR)/collectd_nagios-collectd-nagios.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='collectd-nagios.c' object='collectd_nagios-collectd-nagios.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectd_nagios_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o collectd_nagios-collectd-nagios.o `test -f 'collectd-nagios.c' || echo '$(srcdir)/'`collectd-nagios.c
@@ -4508,26 +4834,12 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdctl_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT collectdctl-collectdctl.obj -MD -MP -MF $(DEPDIR)/collectdctl-collectdctl.Tpo -c -o collectdctl-collectdctl.obj `if test -f 'collectdctl.c'; then $(CYGPATH_W) 'collectdctl.c'; else $(CYGPATH_W) '$(srcdir)/collectdctl.c'; fi`
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/collectdctl-collectdctl.Tpo $(DEPDIR)/collectdctl-collectdctl.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='collectdctl.c' object='collectdctl-collectdctl.obj' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdctl_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o collectdctl-collectdctl.obj `if test -f 'collectdctl.c'; then $(CYGPATH_W) 'collectdctl.c'; else $(CYGPATH_W) '$(srcdir)/collectdctl.c'; fi`
 
-collectdmon-collectdmon.o: collectdmon.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdmon_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT collectdmon-collectdmon.o -MD -MP -MF $(DEPDIR)/collectdmon-collectdmon.Tpo -c -o collectdmon-collectdmon.o `test -f 'collectdmon.c' || echo '$(srcdir)/'`collectdmon.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/collectdmon-collectdmon.Tpo $(DEPDIR)/collectdmon-collectdmon.Po
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='collectdmon.c' object='collectdmon-collectdmon.o' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdmon_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o collectdmon-collectdmon.o `test -f 'collectdmon.c' || echo '$(srcdir)/'`collectdmon.c
-
-collectdmon-collectdmon.obj: collectdmon.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdmon_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT collectdmon-collectdmon.obj -MD -MP -MF $(DEPDIR)/collectdmon-collectdmon.Tpo -c -o collectdmon-collectdmon.obj `if test -f 'collectdmon.c'; then $(CYGPATH_W) 'collectdmon.c'; else $(CYGPATH_W) '$(srcdir)/collectdmon.c'; fi`
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/collectdmon-collectdmon.Tpo $(DEPDIR)/collectdmon-collectdmon.Po
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='collectdmon.c' object='collectdmon-collectdmon.obj' libtool=no @AMDEPBACKSLASH@
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(collectdmon_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o collectdmon-collectdmon.obj `if test -f 'collectdmon.c'; then $(CYGPATH_W) 'collectdmon.c'; else $(CYGPATH_W) '$(srcdir)/collectdmon.c'; fi`
-
 test_plugin_ceph-ceph_test.o: ceph_test.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(test_plugin_ceph_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT test_plugin_ceph-ceph_test.o -MD -MP -MF $(DEPDIR)/test_plugin_ceph-ceph_test.Tpo -c -o test_plugin_ceph-ceph_test.o `test -f 'ceph_test.c' || echo '$(srcdir)/'`ceph_test.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/test_plugin_ceph-ceph_test.Tpo $(DEPDIR)/test_plugin_ceph-ceph_test.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='ceph_test.c' object='test_plugin_ceph-ceph_test.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(test_plugin_ceph_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o test_plugin_ceph-ceph_test.o `test -f 'ceph_test.c' || echo '$(srcdir)/'`ceph_test.c
@@ -4536,12 +4848,64 @@
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(test_plugin_ceph_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT test_plugin_ceph-ceph_test.obj -MD -MP -MF $(DEPDIR)/test_plugin_ceph-ceph_test.Tpo -c -o test_plugin_ceph-ceph_test.obj `if test -f 'ceph_test.c'; then $(CYGPATH_W) 'ceph_test.c'; else $(CYGPATH_W) '$(srcdir)/ceph_test.c'; fi`
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/test_plugin_ceph-ceph_test.Tpo $(DEPDIR)/test_plugin_ceph-ceph_test.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='ceph_test.c' object='test_plugin_ceph-ceph_test.obj' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(test_plugin_ceph_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o test_plugin_ceph-ceph_test.obj `if test -f 'ceph_test.c'; then $(CYGPATH_W) 'ceph_test.c'; else $(CYGPATH_W) '$(srcdir)/ceph_test.c'; fi`
 
+.cc.o:
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.o$$||'`;\
+@am__fastdepCXX_TRUE@	$(CXXCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
+@am__fastdepCXX_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(CXXCOMPILE) -c -o $@ $<
+
+.cc.obj:
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.obj$$||'`;\
+@am__fastdepCXX_TRUE@	$(CXXCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ `$(CYGPATH_W) '$<'` &&\
+@am__fastdepCXX_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Po
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(CXXCOMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
+
+.cc.lo:
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)depbase=`echo $@ | sed 's|[^/]*$$|$(DEPDIR)/&|;s|\.lo$$||'`;\
+@am__fastdepCXX_TRUE@	$(LTCXXCOMPILE) -MT $@ -MD -MP -MF $$depbase.Tpo -c -o $@ $< &&\
+@am__fastdepCXX_TRUE@	$(am__mv) $$depbase.Tpo $$depbase.Plo
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(LTCXXCOMPILE) -c -o $@ $<
+
+grpc_la-grpc.lo: grpc.cc
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT grpc_la-grpc.lo -MD -MP -MF $(DEPDIR)/grpc_la-grpc.Tpo -c -o grpc_la-grpc.lo `test -f 'grpc.cc' || echo '$(srcdir)/'`grpc.cc
+@am__fastdepCXX_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/grpc_la-grpc.Tpo $(DEPDIR)/grpc_la-grpc.Plo
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='grpc.cc' object='grpc_la-grpc.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o grpc_la-grpc.lo `test -f 'grpc.cc' || echo '$(srcdir)/'`grpc.cc
+
+grpc_la-collectd.grpc.pb.lo: collectd.grpc.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT grpc_la-collectd.grpc.pb.lo -MD -MP -MF $(DEPDIR)/grpc_la-collectd.grpc.pb.Tpo -c -o grpc_la-collectd.grpc.pb.lo `test -f 'collectd.grpc.pb.cc' || echo '$(srcdir)/'`collectd.grpc.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/grpc_la-collectd.grpc.pb.Tpo $(DEPDIR)/grpc_la-collectd.grpc.pb.Plo
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='collectd.grpc.pb.cc' object='grpc_la-collectd.grpc.pb.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o grpc_la-collectd.grpc.pb.lo `test -f 'collectd.grpc.pb.cc' || echo '$(srcdir)/'`collectd.grpc.pb.cc
+
+grpc_la-collectd.pb.lo: collectd.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT grpc_la-collectd.pb.lo -MD -MP -MF $(DEPDIR)/grpc_la-collectd.pb.Tpo -c -o grpc_la-collectd.pb.lo `test -f 'collectd.pb.cc' || echo '$(srcdir)/'`collectd.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/grpc_la-collectd.pb.Tpo $(DEPDIR)/grpc_la-collectd.pb.Plo
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='collectd.pb.cc' object='grpc_la-collectd.pb.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o grpc_la-collectd.pb.lo `test -f 'collectd.pb.cc' || echo '$(srcdir)/'`collectd.pb.cc
+
+grpc_la-types.pb.lo: types.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_CXX)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT grpc_la-types.pb.lo -MD -MP -MF $(DEPDIR)/grpc_la-types.pb.Tpo -c -o grpc_la-types.pb.lo `test -f 'types.pb.cc' || echo '$(srcdir)/'`types.pb.cc
+@am__fastdepCXX_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/grpc_la-types.pb.Tpo $(DEPDIR)/grpc_la-types.pb.Plo
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	$(AM_V_CXX)source='types.pb.cc' object='grpc_la-types.pb.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCXX_FALSE@	$(AM_V_CXX@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(grpc_la_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o grpc_la-types.pb.lo `test -f 'types.pb.cc' || echo '$(srcdir)/'`types.pb.cc
+
 mostlyclean-libtool:
 	-rm -f *.lo
 
 clean-libtool:
 	-rm -rf .libs _libs
 install-man1: $(dist_man_MANS)
@@ -4868,26 +5232,40 @@
 	log_list=`for i in $$bases; do echo $$i.log; done`; \
 	log_list=`echo $$log_list`; \
 	$(MAKE) $(AM_MAKEFLAGS) $(TEST_SUITE_LOG) \
 	        am__force_recheck=am--force-recheck \
 	        TEST_LOGS="$$log_list"; \
 	exit $$?
-test_utils_mount.log: test_utils_mount$(EXEEXT)
-	@p='test_utils_mount$(EXEEXT)'; \
-	b='test_utils_mount'; \
+test_format_json.log: test_format_json$(EXEEXT)
+	@p='test_format_json$(EXEEXT)'; \
+	b='test_format_json'; \
+	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
+	--log-file $$b.log --trs-file $$b.trs \
+	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
+	"$$tst" $(AM_TESTS_FD_REDIRECT)
+test_utils_latency.log: test_utils_latency$(EXEEXT)
+	@p='test_utils_latency$(EXEEXT)'; \
+	b='test_utils_latency'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
 	"$$tst" $(AM_TESTS_FD_REDIRECT)
 test_utils_vl_lookup.log: test_utils_vl_lookup$(EXEEXT)
 	@p='test_utils_vl_lookup$(EXEEXT)'; \
 	b='test_utils_vl_lookup'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
 	"$$tst" $(AM_TESTS_FD_REDIRECT)
+test_utils_mount.log: test_utils_mount$(EXEEXT)
+	@p='test_utils_mount$(EXEEXT)'; \
+	b='test_utils_mount'; \
+	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
+	--log-file $$b.log --trs-file $$b.trs \
+	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
+	"$$tst" $(AM_TESTS_FD_REDIRECT)
 test_plugin_ceph.log: test_plugin_ceph$(EXEEXT)
 	@p='test_plugin_ceph$(EXEEXT)'; \
 	b='test_plugin_ceph'; \
 	$(am__check_pre) $(LOG_DRIVER) --test-name "$$f" \
 	--log-file $$b.log --trs-file $$b.trs \
 	$(am__common_driver_flags) $(AM_LOG_DRIVER_FLAGS) $(LOG_DRIVER_FLAGS) -- $(LOG_COMPILE) \
@@ -5110,33 +5488,40 @@
 	recheck tags tags-am uninstall uninstall-am \
 	uninstall-binPROGRAMS uninstall-hook uninstall-man \
 	uninstall-man1 uninstall-man5 uninstall-pkglibLTLIBRARIES \
 	uninstall-sbinPROGRAMS
 
 
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@collectd.grpc.pb.cc: $(top_srcdir)/proto/collectd.proto $(top_srcdir)/proto/types.proto
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto \
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@		--grpc_out=$(builddir) --plugin=protoc-gen-grpc=$(GRPC_CPP_PLUGIN) $<
+
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@collectd.pb.cc: $(top_srcdir)/proto/collectd.proto $(top_srcdir)/proto/types.proto
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto --cpp_out=$(builddir) $<
+
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@types.pb.cc: $(top_srcdir)/proto/types.proto
+@HAVE_GRPC_CPP_TRUE@@HAVE_PROTOC3_TRUE@	$(V_PROTOC)@PROTOC@ -I$(top_srcdir)/proto --cpp_out=$(builddir) $<
+
 .pod.1:
-	pod2man --release=$(VERSION) --center=$(PACKAGE) $< \
+	$(AM_V_POD2MAN_C)pod2man --release=$(VERSION) --center=$(PACKAGE) $< \
 		>.pod2man.tmp.$$$$ 2>/dev/null && mv -f .pod2man.tmp.$$$$ $@ || true
 	@if grep '\<POD ERRORS\>' $@ >/dev/null 2>&1; \
 	then \
 		echo "$@ has some POD errors!"; false; \
 	fi
 
 .pod.5:
-	pod2man --section=5 --release=$(VERSION) --center=$(PACKAGE) $< \
+	$(AM_V_POD2MAN_C)pod2man --section=5 --release=$(VERSION) --center=$(PACKAGE) $< \
 		>.pod2man.tmp.$$$$ 2>/dev/null && mv -f .pod2man.tmp.$$$$ $@ || true
 	@if grep '\<POD ERRORS\>' $@ >/dev/null 2>&1; \
 	then \
 		echo "$@ has some POD errors!"; false; \
 	fi
 
 @BUILD_PLUGIN_PINBA_TRUE@pinba.pb-c.c pinba.pb-c.h: pinba.proto
-@BUILD_PLUGIN_PINBA_TRUE@	$(AM_V_PROTOC_C)protoc-c -I$(srcdir) --c_out . $(srcdir)/pinba.proto
-
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@riemann.pb-c.c riemann.pb-c.h: riemann.proto
-@BUILD_PLUGIN_WRITE_RIEMANN_TRUE@	$(AM_V_PROTOC_C)protoc-c -I$(srcdir) --c_out . $(srcdir)/riemann.proto
+@BUILD_PLUGIN_PINBA_TRUE@	$(AM_V_PROTOC_C)$(PROTOC_C) -I$(srcdir) --c_out . $(srcdir)/pinba.proto
 
 install-exec-hook:
 	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)
 	if test -e $(DESTDIR)$(sysconfdir)/collectd.conf; \
 	then \
 		$(INSTALL) -m 0640 collectd.conf $(DESTDIR)$(sysconfdir)/collectd.conf.pkg-orig; \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_empty_counter.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_empty_counter.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_empty_counter.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_empty_counter.c	2016-09-11 16:10:25.263038721 +0800
@@ -1,9 +1,9 @@
 /**
  * collectd - src/match_empty_counter.c
- * Copyright (C) 2009       Florian Forster
+ * Copyright (C) 2009-2016  Florian Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -22,100 +22,66 @@
  *
  * Authors:
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
-#include "utils_cache.h"
 #include "filter_chain.h"
 
 /*
- * private data types
- */
-struct mec_match_s;
-typedef struct mec_match_s mec_match_t;
-struct mec_match_s
-{
-  int dummy;
-};
-
-/*
  * internal helper functions
  */
 static int mec_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
-  mec_match_t *m;
-
-  m = (mec_match_t *) malloc (sizeof (*m));
-  if (m == NULL)
-  {
-    ERROR ("mec_create: malloc failed.");
-    return (-ENOMEM);
-  }
-  memset (m, 0, sizeof (*m));
-
   if (ci->children_num != 0)
   {
     ERROR ("empty_counter match: This match does not take any additional "
         "configuration.");
   }
 
-  *user_data = m;
+  *user_data = NULL;
   return (0);
 } /* }}} int mec_create */
 
-static int mec_destroy (void **user_data) /* {{{ */
+static int mec_destroy (__attribute__((unused)) void **user_data) /* {{{ */
 {
-  if (user_data != NULL)
-  {
-    sfree (*user_data);
-  }
-
   return (0);
 } /* }}} int mec_destroy */
 
-static int mec_match (const data_set_t __attribute__((unused)) *ds, /* {{{ */
+static int mec_match (__attribute__((unused)) const data_set_t *ds, /* {{{ */
     const value_list_t *vl,
-    notification_meta_t __attribute__((unused)) **meta, void **user_data)
+    __attribute__((unused)) notification_meta_t **meta,
+    __attribute__((unused)) void **user_data)
 {
-  int num_counters;
-  int num_empty;
-  int i;
-
-  if ((user_data == NULL) || (*user_data == NULL))
-    return (-1);
+  int num_counters = 0;
+  int num_empty = 0;
 
-
-  num_counters = 0;
-  num_empty = 0;
-
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
-    if (ds->ds[i].type != DS_TYPE_COUNTER)
+    if ((ds->ds[i].type != DS_TYPE_DERIVE)
+        && (ds->ds[i].type != DS_TYPE_COUNTER))
       continue;
 
     num_counters++;
-    if (vl->values[i].counter == 0)
+    if (((ds->ds[i].type == DS_TYPE_DERIVE) && (vl->values[i].derive == 0))
+        || ((ds->ds[i].type == DS_TYPE_COUNTER) && (vl->values[i].counter == 0)))
       num_empty++;
   }
 
-  if (num_counters == 0)
-    return (FC_MATCH_NO_MATCH);
-  else if (num_counters == num_empty)
+  if ((num_counters != 0) && (num_counters == num_empty))
     return (FC_MATCH_MATCHES);
-  else
-    return (FC_MATCH_NO_MATCH);
+
+  return (FC_MATCH_NO_MATCH);
 } /* }}} int mec_match */
 
 void module_register (void)
 {
-  match_proc_t mproc;
-
-  memset (&mproc, 0, sizeof (mproc));
-  mproc.create  = mec_create;
-  mproc.destroy = mec_destroy;
-  mproc.match   = mec_match;
-  fc_register_match ("empty_counter", mproc);
+  fc_register_match ("empty_counter", (match_proc_t) {
+    .create  = mec_create,
+    .destroy = mec_destroy,
+    .match   = mec_match,
+  });
 } /* module_register */
 
 /* vim: set sw=2 sts=2 tw=78 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_hashed.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_hashed.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_hashed.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_hashed.c	2016-09-11 16:10:25.263038721 +0800
@@ -22,14 +22,14 @@
  *
  * Authors:
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
-#include "utils_cache.h"
 #include "filter_chain.h"
 
 /*
  * private data types
  */
 struct mh_hash_match_s
@@ -96,23 +96,21 @@
   return (0);
 } /* }}} int mh_config_match */
 
 static int mh_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   mh_match_t *m;
-  int i;
 
-  m = (mh_match_t *) malloc (sizeof (*m));
+  m = calloc (1, sizeof (*m));
   if (m == NULL)
   {
-    ERROR ("mh_create: malloc failed.");
+    ERROR ("mh_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (m, 0, sizeof (*m));
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Match", child->key) == 0)
       mh_config_match (child, m);
     else
@@ -148,41 +146,38 @@
 static int mh_match (const data_set_t __attribute__((unused)) *ds, /* {{{ */
     const value_list_t *vl,
     notification_meta_t __attribute__((unused)) **meta, void **user_data)
 {
   mh_match_t *m;
   uint32_t hash_val;
-  const char *host_ptr;
-  size_t i;
 
   if ((user_data == NULL) || (*user_data == NULL))
     return (-1);
 
   m = *user_data;
 
   hash_val = 0;
 
-  for (host_ptr = vl->host; *host_ptr != 0; host_ptr++)
+  for (const char *host_ptr = vl->host; *host_ptr != 0; host_ptr++)
   {
     /* 2184401929 is some appropriately sized prime number. */
     hash_val = (hash_val * UINT32_C (2184401929)) + ((uint32_t) *host_ptr);
   }
   DEBUG ("hashed match: host = %s; hash_val = %"PRIu32";", vl->host, hash_val);
 
-  for (i = 0; i < m->matches_num; i++)
+  for (size_t i = 0; i < m->matches_num; i++)
     if ((hash_val % m->matches[i].total) == m->matches[i].match)
       return (FC_MATCH_MATCHES);
 
   return (FC_MATCH_NO_MATCH);
 } /* }}} int mh_match */
 
 void module_register (void)
 {
-  match_proc_t mproc;
+  match_proc_t mproc = { 0 };
 
-  memset (&mproc, 0, sizeof (mproc));
   mproc.create  = mh_create;
   mproc.destroy = mh_destroy;
   mproc.match   = mh_match;
   fc_register_match ("hashed", mproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_regex.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_regex.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_regex.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_regex.c	2016-09-11 16:10:25.263038721 +0800
@@ -96,18 +97,16 @@
 	free (m);
 } /* }}} void mr_free_match */
 
 static int mr_match_regexen (mr_regex_t *re_head, /* {{{ */
 		const char *string)
 {
-	mr_regex_t *re;
-
 	if (re_head == NULL)
 		return (FC_MATCH_MATCHES);
 
-	for (re = re_head; re != NULL; re = re->next)
+	for (mr_regex_t *re = re_head; re != NULL; re = re->next)
 	{
 		int status;
 
 		status = regexec (&re->re, string,
 				/* nmatch = */ 0, /* pmatch = */ NULL,
 				/* eflags = */ 0);
@@ -137,19 +136,18 @@
 	if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
 	{
 		log_warn ("`%s' needs exactly one string argument.", ci->key);
 		return (-1);
 	}
 
-	re = (mr_regex_t *) malloc (sizeof (*re));
+	re = calloc (1, sizeof (*re));
 	if (re == NULL)
 	{
-		log_err ("mr_config_add_regex: malloc failed.");
+		log_err ("mr_config_add_regex: calloc failed.");
 		return (-1);
 	}
-	memset (re, 0, sizeof (*re));
 	re->next = NULL;
 
 	re->re_str = strdup (ci->values[0].value.string);
 	if (re->re_str == NULL)
 	{
 		free (re);
@@ -160,13 +158,13 @@
 	status = regcomp (&re->re, re->re_str, REG_EXTENDED | REG_NOSUB);
 	if (status != 0)
 	{
 		char errmsg[1024];
 		regerror (status, &re->re, errmsg, sizeof (errmsg));
 		errmsg[sizeof (errmsg) - 1] = 0;
-		log_err ("Compiling regex `%s' for `%s' failed: %s.", 
+		log_err ("Compiling regex `%s' for `%s' failed: %s.",
 				re->re_str, ci->key, errmsg);
 		free (re->re_str);
 		free (re);
 		return (-1);
 	}
 
@@ -189,26 +187,24 @@
 } /* }}} int mr_config_add_regex */
 
 static int mr_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
 	mr_match_t *m;
 	int status;
-	int i;
 
-	m = (mr_match_t *) malloc (sizeof (*m));
+	m = calloc (1, sizeof (*m));
 	if (m == NULL)
 	{
-		log_err ("mr_create: malloc failed.");
+		log_err ("mr_create: calloc failed.");
 		return (-ENOMEM);
 	}
-	memset (m, 0, sizeof (*m));
-	
+
 	m->invert = 0;
 
 	status = 0;
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if ((strcasecmp ("Host", child->key) == 0)
 				|| (strcasecmp ("Hostname", child->key) == 0))
 			status = mr_config_add_regex (&m->host, child);
@@ -302,15 +298,14 @@
 
 	return (match_value);
 } /* }}} int mr_match */
 
 void module_register (void)
 {
-	match_proc_t mproc;
+	match_proc_t mproc = { 0 };
 
-	memset (&mproc, 0, sizeof (mproc));
 	mproc.create  = mr_create;
 	mproc.destroy = mr_destroy;
 	mproc.match   = mr_match;
 	fc_register_match ("regex", mproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_timediff.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_timediff.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_timediff.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_timediff.c	2016-09-11 16:10:25.263038721 +0800
@@ -22,14 +22,14 @@
  *
  * Authors:
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
-#include "utils_cache.h"
 #include "filter_chain.h"
 
 #define SATISFY_ALL 0
 #define SATISFY_ANY 1
 
 /*
@@ -47,27 +47,25 @@
  * internal helper functions
  */
 static int mt_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   mt_match_t *m;
   int status;
-  int i;
 
-  m = (mt_match_t *) malloc (sizeof (*m));
+  m = calloc (1, sizeof (*m));
   if (m == NULL)
   {
-    ERROR ("mt_create: malloc failed.");
+    ERROR ("mt_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (m, 0, sizeof (*m));
 
   m->future = 0;
   m->past = 0;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Future", child->key) == 0)
       status = cf_util_get_cdtime (child, &m->future);
     else if (strcasecmp ("Past", child->key) == 0)
@@ -143,15 +141,14 @@
 
   return (FC_MATCH_NO_MATCH);
 } /* }}} int mt_match */
 
 void module_register (void)
 {
-  match_proc_t mproc;
+  match_proc_t mproc = { 0 };
 
-  memset (&mproc, 0, sizeof (mproc));
   mproc.create  = mt_create;
   mproc.destroy = mt_destroy;
   mproc.match   = mt_match;
   fc_register_match ("timediff", mproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_value.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_value.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/match_value.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/match_value.c	2016-09-11 16:10:25.267038716 +0800
@@ -55,24 +56,22 @@
 
 /*
  * internal helper functions
  */
 static void mv_free_match (mv_match_t *m) /* {{{ */
 {
-  int i;
-  
   if (m == NULL)
     return;
 
   if (m->data_sources != NULL)
   {
-    for (i = 0; i < m->data_sources_num; ++i)
+    for (size_t i = 0; i < m->data_sources_num; ++i)
       free(m->data_sources[i]);
     free(m->data_sources);
   }
-  
+
   free (m);
 } /* }}} void mv_free_match */
 
 static int mv_config_add_satisfy (mv_match_t *m, /* {{{ */
     oconfig_item_t *ci)
 {
@@ -100,24 +99,23 @@
 
 static int mv_config_add_data_source (mv_match_t *m, /* {{{ */
     oconfig_item_t *ci)
 {
   size_t new_data_sources_num;
   char **temp;
-  int i;
 
   /* Check number of arbuments. */
   if (ci->values_num < 1)
   {
     ERROR ("`value' match: `%s' needs at least one argument.",
         ci->key);
     return (-1);
   }
 
   /* Check type of arguments */
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     if (ci->values[i].type == OCONFIG_TYPE_STRING)
       continue;
 
     ERROR ("`value' match: `%s' accepts only string arguments "
         "(argument %i is a %s).",
@@ -126,30 +124,28 @@
         ? "truth value" : "number");
     return (-1);
   }
 
   /* Allocate space for the char pointers */
   new_data_sources_num = m->data_sources_num + ((size_t) ci->values_num);
-  temp = (char **) realloc (m->data_sources,
+  temp = realloc (m->data_sources,
       new_data_sources_num * sizeof (char *));
   if (temp == NULL)
   {
     ERROR ("`value' match: realloc failed.");
     return (-1);
   }
   m->data_sources = temp;
 
   /* Copy the strings, allocating memory as needed. */
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
-    size_t j;
-
     /* If we get here, there better be memory for us to write to. */
     assert (m->data_sources_num < new_data_sources_num);
 
-    j = m->data_sources_num;
+    size_t j = m->data_sources_num;
     m->data_sources[j] = sstrdup (ci->values[i].value.string);
     if (m->data_sources[j] == NULL)
     {
       ERROR ("`value' match: sstrdup failed.");
       continue;
     }
@@ -195,31 +191,29 @@
 } /* }}} int mv_config_add_boolean */
 
 static int mv_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   mv_match_t *m;
   int status;
-  int i;
 
-  m = (mv_match_t *) malloc (sizeof (*m));
+  m = calloc (1, sizeof (*m));
   if (m == NULL)
   {
-    ERROR ("mv_create: malloc failed.");
+    ERROR ("mv_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (m, 0, sizeof (*m));
 
   m->min = NAN;
   m->max = NAN;
   m->invert = 0;
   m->satisfy = SATISFY_ALL;
   m->data_sources = NULL;
   m->data_sources_num = 0;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Min", child->key) == 0)
       status = mv_config_add_gauge (&m->min, child);
     else if (strcasecmp ("Max", child->key) == 0)
@@ -274,13 +268,12 @@
 static int mv_match (const data_set_t *ds, const value_list_t *vl, /* {{{ */
     notification_meta_t __attribute__((unused)) **meta, void **user_data)
 {
   mv_match_t *m;
   gauge_t *values;
   int status;
-  int i;
 
   if ((user_data == NULL) || (*user_data == NULL))
     return (-1);
 
   m = *user_data;
 
@@ -291,13 +284,13 @@
         "failed.");
     return (-1);
   }
 
   status = FC_MATCH_NO_MATCH;
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     int value_matches = 0;
 
     /* Check if this data source is relevant. */
     if (m->data_sources != NULL)
     {
@@ -333,13 +326,13 @@
     if (value_matches != 0)
     {
       status = FC_MATCH_MATCHES;
       if (m->satisfy == SATISFY_ANY)
         break;
     }
-    else if (value_matches == 0)
+    else
     {
       status = FC_MATCH_NO_MATCH;
       if (m->satisfy == SATISFY_ALL)
         break;
     }
   } /* for (i = 0; i < ds->ds_num; i++) */
@@ -347,15 +340,14 @@
   free (values);
   return (status);
 } /* }}} int mv_match */
 
 void module_register (void)
 {
-  match_proc_t mproc;
+  match_proc_t mproc = { 0 };
 
-  memset (&mproc, 0, sizeof (mproc));
   mproc.create  = mv_create;
   mproc.destroy = mv_destroy;
   mproc.match   = mv_match;
   fc_register_match ("value", mproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mbmon.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mbmon.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mbmon.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mbmon.c	2016-09-11 16:10:25.267038716 +0800
@@ -21,18 +21,17 @@
  * Authors:
  *   Flavio Stanchina <flavio at stanchina.net>
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <netdb.h>
-#include <sys/socket.h>
 #include <netinet/in.h>
 #include <netinet/tcp.h>
 
 #define MBMON_DEF_HOST "127.0.0.1"
 #define MBMON_DEF_PORT "411" /* the default for Debian */
 
@@ -82,46 +81,43 @@
 	ssize_t status;
 	int buffer_fill;
 
 	const char *host;
 	const char *port;
 
-	struct addrinfo  ai_hints;
-	struct addrinfo *ai_list, *ai_ptr;
+	struct addrinfo *ai_list;
 	int              ai_return;
 
-	memset (&ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_flags    = 0;
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags   |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family   = PF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_STREAM;
-	ai_hints.ai_protocol = IPPROTO_TCP;
-
 	host = mbmon_host;
 	if (host == NULL)
 		host = MBMON_DEF_HOST;
 
 	port = mbmon_port;
 	if (port == NULL)
 		port = MBMON_DEF_PORT;
 
+	struct addrinfo ai_hints = {
+		.ai_family = AF_UNSPEC,
+		.ai_flags = AI_ADDRCONFIG,
+		.ai_protocol = IPPROTO_TCP,
+		.ai_socktype = SOCK_STREAM
+	};
+
 	if ((ai_return = getaddrinfo (host, port, &ai_hints, &ai_list)) != 0)
 	{
 		char errbuf[1024];
 		ERROR ("mbmon: getaddrinfo (%s, %s): %s",
 				host, port,
 				(ai_return == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
 				: gai_strerror (ai_return));
 		return (-1);
 	}
 
 	fd = -1;
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		/* create our socket descriptor */
 		if ((fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype, ai_ptr->ai_protocol)) < 0)
 		{
 			char errbuf[1024];
 			ERROR ("mbmon: socket: %s",
@@ -237,15 +233,13 @@
 	plugin_dispatch_values (&vl);
 } /* void mbmon_submit */
 
 /* Trim trailing whitespace from a string. */
 static void trim_spaces (char *s)
 {
-	size_t l;
-
-	for (l = strlen (s) - 1; (l > 0) && isspace ((int) s[l]); l--)
+	for (size_t l = strlen (s) - 1; (l > 0) && isspace ((int) s[l]); l--)
 		s[l] = '\0';
 }
 
 static int mbmon_read (void)
 {
 	char buf[1024];
@@ -258,14 +252,14 @@
 	s = buf;
 	while ((t = strchr (s, ':')) != NULL)
 	{
 		double value;
 		char *nextc;
 
-		char *type;
-		char *inst;
+		const char *type;
+		const char *inst;
 
 		*t++ = '\0';
 		trim_spaces (s);
 
 		value = strtod (t, &nextc);
 		if ((*nextc != '\n') && (*nextc != '\0'))
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memcachec.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memcachec.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memcachec.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memcachec.c	2016-09-11 16:10:25.267038716 +0800
@@ -19,15 +19,15 @@
  * Authors:
  *   Doug MacEachern <Doug.MacEachern at hyperic.com>
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_match.h"
 
 #include <libmemcached/memcached.h>
 
 /*
  * Data types
@@ -196,29 +196,27 @@
 
 static int cmc_config_add_match (web_page_t *page, /* {{{ */
     oconfig_item_t *ci)
 {
   web_match_t *match;
   int status;
-  int i;
 
   if (ci->values_num != 0)
   {
     WARNING ("memcachec plugin: Ignoring arguments for the `Match' block.");
   }
 
-  match = (web_match_t *) malloc (sizeof (*match));
+  match = calloc (1, sizeof (*match));
   if (match == NULL)
   {
-    ERROR ("memcachec plugin: malloc failed.");
+    ERROR ("memcachec plugin: calloc failed.");
     return (-1);
   }
-  memset (match, 0, sizeof (*match));
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Regex", child->key) == 0)
       status = cmc_config_add_string ("Regex", &match->regex, child);
     else if (strcasecmp ("ExcludeRegex", child->key) == 0)
@@ -269,13 +267,13 @@
   }
 
   match->match = match_create_simple (match->regex, match->exclude_regex,
       match->dstype);
   if (match->match == NULL)
   {
-    ERROR ("memcachec plugin: tail_match_add_match_simple failed.");
+    ERROR ("memcachec plugin: match_create_simple failed.");
     cmc_web_match_free (match);
     return (-1);
   }
   else
   {
     web_match_t *prev;
@@ -294,27 +292,25 @@
 } /* }}} int cmc_config_add_match */
 
 static int cmc_config_add_page (oconfig_item_t *ci) /* {{{ */
 {
   web_page_t *page;
   int status;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("memcachec plugin: `Page' blocks need exactly one string argument.");
     return (-1);
   }
 
-  page = (web_page_t *) malloc (sizeof (*page));
+  page = calloc (1, sizeof (*page));
   if (page == NULL)
   {
-    ERROR ("memcachec plugin: malloc failed.");
+    ERROR ("memcachec plugin: calloc failed.");
     return (-1);
   }
-  memset (page, 0, sizeof (*page));
   page->server = NULL;
   page->key = NULL;
 
   page->instance = strdup (ci->values[0].value.string);
   if (page->instance == NULL)
   {
@@ -322,13 +318,13 @@
     sfree (page);
     return (-1);
   }
 
   /* Process all children */
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Server", child->key) == 0)
       status = cmc_config_add_string ("Server", &page->server, child);
     else if (strcasecmp ("Key", child->key) == 0)
@@ -386,31 +382,30 @@
     pages_g = page;
   else
   {
     web_page_t *prev;
 
     prev = pages_g;
-    while ((prev != NULL) && (prev->next != NULL))
+    while (prev->next != NULL)
       prev = prev->next;
     prev->next = page;
   }
 
   return (0);
 } /* }}} int cmc_config_add_page */
 
 static int cmc_config (oconfig_item_t *ci) /* {{{ */
 {
   int success;
   int errors;
   int status;
-  int i;
 
   success = 0;
   errors = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Page", child->key) == 0)
     {
       status = cmc_config_add_page (child);
@@ -463,13 +458,12 @@
 
   plugin_dispatch_values (&vl);
 } /* }}} void cmc_submit */
 
 static int cmc_read_page (web_page_t *wp) /* {{{ */
 {
-  web_match_t *wm;
   memcached_return rc;
   size_t string_length;
   uint32_t flags;
   int status;
 
   if (wp->memc == NULL)
@@ -481,13 +475,13 @@
   {
     ERROR ("memcachec plugin: memcached_get failed: %s",
         memcached_strerror (wp->memc, rc));
     return (-1);
   }
 
-  for (wm = wp->matches; wm != NULL; wm = wm->next)
+  for (web_match_t *wm = wp->matches; wm != NULL; wm = wm->next)
   {
     cu_match_value_t *mv;
 
     status = match_apply (wm->match, wp->buffer);
     if (status != 0)
     {
@@ -510,15 +504,13 @@
 
   return (0);
 } /* }}} int cmc_read_page */
 
 static int cmc_read (void) /* {{{ */
 {
-  web_page_t *wp;
-
-  for (wp = pages_g; wp != NULL; wp = wp->next)
+  for (web_page_t *wp = pages_g; wp != NULL; wp = wp->next)
     cmc_read_page (wp);
 
   return (0);
 } /* }}} int cmc_read */
 
 static int cmc_shutdown (void) /* {{{ */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memcached.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memcached.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memcached.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memcached.c	2016-09-11 16:10:25.267038716 +0800
@@ -26,18 +26,17 @@
  *   Doug MacEachern <dougm at hyperic.com>
  *   Franck Lombardi
  *   Nicolas Szalay
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <netdb.h>
-#include <sys/socket.h>
 #include <sys/un.h>
 #include <netinet/in.h>
 #include <netinet/tcp.h>
 
 #define MEMCACHED_DEF_HOST "127.0.0.1"
 #define MEMCACHED_DEF_PORT "11211"
@@ -50,30 +49,30 @@
   char *port;
 };
 typedef struct memcached_s memcached_t;
 
 static _Bool memcached_have_instances = 0;
 
-static void memcached_free (memcached_t *st)
+static void memcached_free (void *arg)
 {
+  memcached_t *st = arg;
   if (st == NULL)
     return;
 
   sfree (st->name);
   sfree (st->socket);
   sfree (st->host);
   sfree (st->port);
   sfree (st);
 }
 
 static int memcached_connect_unix (memcached_t *st)
 {
-  struct sockaddr_un serv_addr;
+  struct sockaddr_un serv_addr = { 0 };
   int fd;
 
-  memset (&serv_addr, 0, sizeof (serv_addr));
   serv_addr.sun_family = AF_UNIX;
   sstrncpy (serv_addr.sun_path, st->socket,
       sizeof (serv_addr.sun_path));
 
   /* create our socket descriptor */
   fd = socket (AF_UNIX, SOCK_STREAM, 0);
@@ -96,33 +95,28 @@
 
   return (fd);
 } /* int memcached_connect_unix */
 
 static int memcached_connect_inet (memcached_t *st)
 {
-  char *host;
-  char *port;
+  const char *host;
+  const char *port;
 
-  struct addrinfo  ai_hints;
-  struct addrinfo *ai_list, *ai_ptr;
+  struct addrinfo *ai_list;
   int status;
   int fd = -1;
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags    = 0;
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags   |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family   = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_STREAM;
-  ai_hints.ai_protocol = 0;
-
   host = (st->host != NULL) ? st->host : MEMCACHED_DEF_HOST;
   port = (st->port != NULL) ? st->port : MEMCACHED_DEF_PORT;
 
-  ai_list = NULL;
+  struct addrinfo ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_ADDRCONFIG,
+    .ai_socktype = SOCK_STREAM
+  };
+
   status = getaddrinfo (host, port, &ai_hints, &ai_list);
   if (status != 0)
   {
     char errbuf[1024];
     ERROR ("memcached plugin: memcached_connect_inet: "
         "getaddrinfo(%s,%s) failed: %s",
@@ -130,13 +124,13 @@
         (status == EAI_SYSTEM)
         ? sstrerror (errno, errbuf, sizeof (errbuf))
         : gai_strerror (status));
     return (-1);
   }
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     /* create our socket descriptor */
     fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype, ai_ptr->ai_protocol);
     if (fd < 0)
     {
       char errbuf[1024];
@@ -171,14 +165,13 @@
   else
     return (memcached_connect_inet (st));
 }
 
 static int memcached_query_daemon (char *buffer, size_t buffer_size, memcached_t *st)
 {
-  int fd = -1;
-  int status;
+  int fd, status;
   size_t buffer_fill;
 
   fd = memcached_connect (st);
   if (fd < 0) {
     ERROR ("memcached plugin: Instance \"%s\" could not connect to daemon.",
         st->name);
@@ -243,27 +236,30 @@
   close(fd);
   return (status);
 } /* int memcached_query_daemon */
 
 static void memcached_init_vl (value_list_t *vl, memcached_t const *st)
 {
+  char const *host = st->host;
+
+  /* Set vl->host to hostname_g, if:
+   * - Legacy mode is used.
+   * - "Socket" option is given (doc: "Host option is ignored").
+   * - "Host" option is not provided.
+   * - "Host" option is set to "localhost" or "127.0.0.1". */
+  if ((strcmp (st->name, "__legacy__") == 0)
+      || (st->socket != NULL)
+      || (st->host == NULL)
+      || (strcmp ("127.0.0.1", st->host) == 0)
+      || (strcmp ("localhost", st->host) == 0))
+    host = hostname_g;
+
   sstrncpy (vl->plugin, "memcached", sizeof (vl->plugin));
-  if (strcmp (st->name, "__legacy__") == 0) /* legacy mode */
-  {
-    sstrncpy (vl->host, hostname_g, sizeof (vl->host));
-  }
-  else
-  {
-    if (st->socket != NULL)
-      sstrncpy (vl->host, hostname_g, sizeof (vl->host));
-    else
-      sstrncpy (vl->host,
-          (st->host != NULL) ? st->host : MEMCACHED_DEF_HOST,
-          sizeof (vl->host));
+  sstrncpy (vl->host, host, sizeof (vl->host));
+  if (strcmp (st->name, "__legacy__") != 0)
     sstrncpy (vl->plugin_instance, st->name, sizeof (vl->plugin_instance));
-  }
 }
 
 static void submit_derive (const char *type, const char *type_inst,
     derive_t value, memcached_t *st)
 {
   value_t values[1];
@@ -549,27 +545,27 @@
 
   return 0;
 } /* int memcached_read */
 
 static int memcached_add_read_callback (memcached_t *st)
 {
-  user_data_t ud;
   char callback_name[3*DATA_MAX_NAME_LEN];
   int status;
 
-  memset (&ud, 0, sizeof (ud));
-  ud.data = st;
-  ud.free_func = (void *) memcached_free;
-
   assert (st->name != NULL);
   ssnprintf (callback_name, sizeof (callback_name), "memcached/%s", st->name);
 
+  user_data_t ud = {
+    .data = st,
+    .free_func = memcached_free
+  };
+
   status = plugin_register_complex_read (/* group = */ "memcached",
       /* name      = */ callback_name,
       /* callback  = */ memcached_read,
-      /* interval  = */ NULL,
+      /* interval  = */ 0,
       /* user_data = */ &ud);
   return (status);
 } /* int memcached_add_read_callback */
 
 /* Configuration handling functiions
  * <Plugin memcached>
@@ -579,26 +575,24 @@
  *   </Instance>
  * </Plugin>
  */
 static int config_add_instance(oconfig_item_t *ci)
 {
   memcached_t *st;
-  int i;
   int status = 0;
 
   /* Disable automatic generation of default instance in the init callback. */
   memcached_have_instances = 1;
 
-  st = malloc (sizeof (*st));
+  st = calloc (1, sizeof (*st));
   if (st == NULL)
   {
-    ERROR ("memcached plugin: malloc failed.");
+    ERROR ("memcached plugin: calloc failed.");
     return (-1);
   }
 
-  memset (st, 0, sizeof (*st));
   st->name = NULL;
   st->socket = NULL;
   st->host = NULL;
   st->port = NULL;
 
   if (strcasecmp (ci->key, "Plugin") == 0) /* default instance */
@@ -609,13 +603,13 @@
   {
     sfree (st);
     return (status);
   }
   assert (st->name != NULL);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Socket", child->key) == 0)
       status = cf_util_get_string (child, &st->socket);
     else if (strcasecmp ("Host", child->key) == 0)
@@ -646,15 +640,14 @@
 }
 
 static int memcached_config (oconfig_item_t *ci)
 {
   int status = 0;
   _Bool have_instance_block = 0;
-  int i;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Instance", child->key) == 0)
     {
       config_add_instance (child);
@@ -683,16 +676,15 @@
   int status;
 
   if (memcached_have_instances)
     return (0);
 
   /* No instances were configured, lets start a default instance. */
-  st = malloc (sizeof (*st));
+  st = calloc (1, sizeof (*st));
   if (st == NULL)
     return (ENOMEM);
-  memset (st, 0, sizeof (*st));
   st->name = sstrdup ("__legacy__");
   st->socket = NULL;
   st->host = NULL;
   st->port = NULL;
 
   status = memcached_add_read_callback (st);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memory.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memory.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/memory.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/memory.c	2016-09-11 16:10:25.267038716 +0800
@@ -73,12 +74,13 @@
 /* no global variables */
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_LIBKSTAT
 static int pagesize;
 static kstat_t *ksp;
+static kstat_t *ksz;
 /* #endif HAVE_LIBKSTAT */
 
 #elif HAVE_SYSCTL
 static int pagesize;
 /* #endif HAVE_SYSCTL */
 
@@ -94,15 +96,13 @@
 
 static _Bool values_absolute = 1;
 static _Bool values_percentage = 0;
 
 static int memory_config (oconfig_item_t *ci) /* {{{ */
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 		if (strcasecmp ("ValuesAbsolute", child->key) == 0)
 			cf_util_get_boolean (child, &values_absolute);
 		else if (strcasecmp ("ValuesPercentage", child->key) == 0)
 			cf_util_get_boolean (child, &values_percentage);
@@ -134,12 +134,18 @@
 	pagesize = getpagesize ();
 	if (get_kstat (&ksp, "unix", 0, "system_pages") != 0)
 	{
 		ksp = NULL;
 		return (-1);
 	}
+	if (get_kstat (&ksz, "zfs", 0, "arcstats") != 0)
+	{
+		ksz = NULL;
+		return (-1);
+	}
+
 /* #endif HAVE_LIBKSTAT */
 
 #elif HAVE_SYSCTL
 	pagesize = getpagesize ();
 	if (pagesize <= 0)
 	{
@@ -227,28 +233,26 @@
 	 * vm.stats.vm.v_free_count: 28760
 	 * vm.stats.vm.v_wire_count: 37526
 	 * vm.stats.vm.v_active_count: 55239
 	 * vm.stats.vm.v_inactive_count: 113730
 	 * vm.stats.vm.v_cache_count: 10809
 	 */
-	char *sysctl_keys[8] =
+	const char *sysctl_keys[8] =
 	{
 		"vm.stats.vm.v_page_size",
 		"vm.stats.vm.v_page_count",
 		"vm.stats.vm.v_free_count",
 		"vm.stats.vm.v_wire_count",
 		"vm.stats.vm.v_active_count",
 		"vm.stats.vm.v_inactive_count",
 		"vm.stats.vm.v_cache_count",
 		NULL
 	};
 	double sysctl_vals[8];
 
-	int    i;
-
-	for (i = 0; sysctl_keys[i] != NULL; i++)
+	for (int i = 0; sysctl_keys[i] != NULL; i++)
 	{
 		int value;
 		size_t value_len = sizeof (value);
 
 		if (sysctlbyname (sysctl_keys[i], (void *) &value, &value_len,
 					NULL, 0) == 0)
@@ -260,13 +264,13 @@
 		{
 			sysctl_vals[i] = NAN;
 		}
 	} /* for (sysctl_keys) */
 
 	/* multiply all all page counts with the pagesize */
-	for (i = 1; sysctl_keys[i] != NULL; i++)
+	for (int i = 1; sysctl_keys[i] != NULL; i++)
 		if (!isnan (sysctl_vals[i]))
 			sysctl_vals[i] *= sysctl_vals[0];
 
 	MEMORY_SUBMIT ("free",     (gauge_t) sysctl_vals[2],
 	               "wired",    (gauge_t) sysctl_vals[3],
 	               "active",   (gauge_t) sysctl_vals[4],
@@ -368,30 +372,35 @@
 	 * Brendan Gregg and are subject to change I guess */
 	long long mem_used;
 	long long mem_free;
 	long long mem_lock;
 	long long mem_kern;
 	long long mem_unus;
+	long long arcsize;
+
 
 	long long pp_kernel;
 	long long physmem;
 	long long availrmem;
 
 	if (ksp == NULL)
 		return (-1);
+	if (ksz == NULL)
+		return (-1);
 
 	mem_used = get_kstat_value (ksp, "pagestotal");
 	mem_free = get_kstat_value (ksp, "pagesfree");
 	mem_lock = get_kstat_value (ksp, "pageslocked");
-	mem_kern = 0;
-	mem_unus = 0;
-
+	arcsize = get_kstat_value (ksz, "size");
 	pp_kernel = get_kstat_value (ksp, "pp_kernel");
 	physmem = get_kstat_value (ksp, "physmem");
 	availrmem = get_kstat_value (ksp, "availrmem");
 
+	mem_kern = 0;
+	mem_unus = 0;
+
 	if ((mem_used < 0LL) || (mem_free < 0LL) || (mem_lock < 0LL))
 	{
 		WARNING ("memory plugin: one of used, free or locked is negative.");
 		return (-1);
 	}
 
@@ -428,29 +437,31 @@
 
 	mem_used *= pagesize; /* If this overflows you have some serious */
 	mem_free *= pagesize; /* memory.. Why not call me up and give me */
 	mem_lock *= pagesize; /* some? ;) */
 	mem_kern *= pagesize; /* it's 2011 RAM is cheap */
 	mem_unus *= pagesize;
+	mem_kern -= arcsize;
+
 
 	MEMORY_SUBMIT ("used",     (gauge_t) mem_used,
 	               "free",     (gauge_t) mem_free,
 	               "locked",   (gauge_t) mem_lock,
 	               "kernel",   (gauge_t) mem_kern,
+	               "arc",      (gauge_t) arcsize,
 	               "unusable", (gauge_t) mem_unus);
 /* #endif HAVE_LIBKSTAT */
 
 #elif HAVE_SYSCTL
 	int mib[] = {CTL_VM, VM_METER};
-	struct vmtotal vmtotal;
+	struct vmtotal vmtotal = { 0 };
 	gauge_t mem_active;
 	gauge_t mem_inactive;
 	gauge_t mem_free;
 	size_t size;
 
-	memset (&vmtotal, 0, sizeof (vmtotal));
 	size = sizeof (vmtotal);
 
 	if (sysctl (mib, 2, &vmtotal, &size, NULL, 0) < 0) {
 		char errbuf[1024];
 		WARNING ("memory plugin: sysctl failed: %s",
 			sstrerror (errno, errbuf, sizeof (errbuf)));
@@ -477,15 +488,14 @@
 	MEMORY_SUBMIT ("used",   (gauge_t) ios->used,
 	               "cached", (gauge_t) ios->cache,
 	               "free",   (gauge_t) ios->free);
 /* #endif HAVE_LIBSTATGRAB */
 
 #elif HAVE_PERFSTAT
-	perfstat_memory_total_t pmemory;
+	perfstat_memory_total_t pmemory = { 0 };
 
-	memset (&pmemory, 0, sizeof (pmemory));
 	if (perfstat_memory_total(NULL, &pmemory, sizeof(pmemory), 1) < 0)
 	{
 		char errbuf[1024];
 		WARNING ("memory plugin: perfstat_memory_total failed: %s",
 			sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mic.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mic.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mic.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mic.c	2016-09-11 16:10:25.267038716 +0800
@@ -210,15 +211,14 @@
 }
 
 /* Gather Temperature Information */
 static int mic_read_temps(int mic)
 {
 	size_t num_therms = STATIC_ARRAY_SIZE(therm_ids);
-	size_t j;
 
-	for (j = 0; j < num_therms; j++) {
+	for (size_t j = 0; j < num_therms; j++) {
 		U32 status;
 		U32 temp_buffer;
 		U32 buffer_size = (U32)sizeof(temp_buffer);
 		char const *name = therm_names[j];
 
 		if (ignorelist_match(temp_ignore, name) != 0)
@@ -283,14 +283,13 @@
 		mic_submit_cpu(mic, "sys", -1, core_util.sum.sys);
 		mic_submit_cpu(mic, "nice", -1, core_util.sum.nice);
 		mic_submit_cpu(mic, "idle", -1, core_util.sum.idle);
 	}
 
 	if (show_cpu_cores) {
-		int j;
-		for (j = 0; j < core_util.core; j++) {
+		for (int j = 0; j < core_util.core; j++) {
 			mic_submit_cpu(mic, "user", j, core_jiffs[j].user);
 			mic_submit_cpu(mic, "sys", j, core_jiffs[j].sys);
 			mic_submit_cpu(mic, "nice", j, core_jiffs[j].nice);
 			mic_submit_cpu(mic, "idle", j, core_jiffs[j].idle);
 		}
 	}
@@ -353,18 +352,17 @@
 
 	return (0);
 }
 
 static int mic_read (void)
 {
-	int i;
 	U32 ret;
 	int error;
 
 	error=0;
-	for (i=0;i<num_mics;i++) {
+	for (int i=0;i<num_mics;i++) {
 		ret = MicInitAdapter(&mic_handle,&mics[i]);
 		if (ret != MIC_ACCESS_API_SUCCESS) {
 			ERROR("mic plugin: Problem initializing MicAdapter: %s",
 					MicGetErrorString(ret));
 			error=1;
 		}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/modbus.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/modbus.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/modbus.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/modbus.c	2016-09-11 16:10:25.267038716 +0800
@@ -20,18 +20,17 @@
  *   Florian Forster <octo at noris.net>
  **/
 
 #include "collectd.h"
 
 #include "common.h"
-#include "configfile.h"
 #include "plugin.h"
 
-#include <modbus.h>
 #include <netdb.h>
-#include <sys/socket.h>
+
+#include <modbus.h>
 
 #ifndef LIBMODBUS_VERSION_CHECK
 /* Assume version 2.0.3 */
 # define LEGACY_LIBMODBUS 1
 #else
 /* Assume version 2.9.2 */
@@ -78,13 +77,13 @@
   REG_TYPE_INT16,
   REG_TYPE_INT32,
   REG_TYPE_UINT16,
   REG_TYPE_UINT32,
   REG_TYPE_FLOAT
 }; /* }}} */
-enum mb_mreg_type_e /* {{{ */ 
+enum mb_mreg_type_e /* {{{ */
 {
   MREG_HOLDING,
   MREG_INPUT
 }; /* }}} */
 typedef enum mb_register_type_e mb_register_type_t;
 typedef enum mb_mreg_type_e mb_mreg_type_t;
@@ -159,18 +158,16 @@
 /*
  * Functions
  */
 static mb_data_t *data_get_by_name (mb_data_t *src, /* {{{ */
     const char *name)
 {
-  mb_data_t *ptr;
-
   if (name == NULL)
     return (NULL);
 
-  for (ptr = src; ptr != NULL; ptr = ptr->next)
+  for (mb_data_t *ptr = src; ptr != NULL; ptr = ptr->next)
     if (strcasecmp (ptr->name, name) == 0)
       return (ptr);
 
   return (NULL);
 } /* }}} mb_data_t *data_get_by_name */
 
@@ -255,13 +252,13 @@
 {
   value_list_t vl = VALUE_LIST_INIT;
 
   if ((host == NULL) || (slave == NULL) || (data == NULL))
     return (EINVAL);
 
-  if (host->interval <= 0)
+  if (host->interval == 0)
     host->interval = plugin_get_interval ();
 
   if (slave->instance[0] == 0)
     ssnprintf (slave->instance, sizeof (slave->instance), "slave_%i",
         slave->id);
 
@@ -425,13 +422,13 @@
     (vt).absolute = (absolute_t) (raw); \
 } while (0)
 
 static int mb_read_data (mb_host_t *host, mb_slave_t *slave, /* {{{ */
     mb_data_t *data)
 {
-  uint16_t values[2];
+  uint16_t values[2] = { 0 };
   int values_num;
   const data_set_t *ds;
   int status = 0;
 
   if ((host == NULL) || (slave == NULL) || (data == NULL))
     return (EINVAL);
@@ -442,13 +439,13 @@
     ERROR ("Modbus plugin: Type \"%s\" is not defined.", data->type);
     return (-1);
   }
 
   if (ds->ds_num != 1)
   {
-    ERROR ("Modbus plugin: The type \"%s\" has %i data sources. "
+    ERROR ("Modbus plugin: The type \"%s\" has %zu data sources. "
         "I can only handle data sets with only one data source.",
         data->type, ds->ds_num);
     return (-1);
   }
 
   if ((ds->ds[0].type != DS_TYPE_GAUGE)
@@ -457,13 +454,12 @@
   {
     NOTICE ("Modbus plugin: The data source of type \"%s\" is %s, not gauge. "
         "This will most likely result in problems, because the register type "
         "is not UINT32.", data->type, DS_TYPE_TO_STRING (ds->ds[0].type));
   }
 
-  memset (values, 0, sizeof (values));
   if ((data->register_type == REG_TYPE_INT32)
       || (data->register_type == REG_TYPE_UINT32)
       || (data->register_type == REG_TYPE_FLOAT))
     values_num = 2;
   else
     values_num = 1;
@@ -471,15 +467,18 @@
   if (host->connection == NULL)
   {
     status = EBADF;
   }
   else if (host->conntype == MBCONN_TCP)
   {
-    if (getpeername (modbus_get_socket (host->connection),
-          (void *) &(struct sockaddr_storage) {0},
-          &(socklen_t) {sizeof(struct sockaddr_storage)}) != 0)
+    struct sockaddr sockaddr;
+    socklen_t saddrlen = sizeof (sockaddr);
+
+    status = getpeername (modbus_get_socket (host->connection),
+        &sockaddr, &saddrlen);
+    if (status != 0)
       status = errno;
   }
 
   if ((status == EBADF) || (status == ENOTSOCK) || (status == ENOTCONN))
   {
     status = mb_init_connection (host);
@@ -498,13 +497,13 @@
     modbus_close (&host->connection);
 #else
     modbus_close (host->connection);
     modbus_free (host->connection);
 #endif
   }
- 
+
 #if LEGACY_LIBMODBUS
   /* Version 2.0.3: Pass the connection struct as a pointer and pass the slave
    * id to each call of "read_holding_registers". */
 # define modbus_read_registers(ctx, addr, nb, dest) \
   read_holding_registers (&(ctx), slave->id, (addr), (nb), (dest))
 #else /* if !LEGACY_LIBMODBUS */
@@ -617,21 +616,20 @@
 
   return (0);
 } /* }}} int mb_read_data */
 
 static int mb_read_slave (mb_host_t *host, mb_slave_t *slave) /* {{{ */
 {
-  mb_data_t *data;
   int success;
   int status;
 
   if ((host == NULL) || (slave == NULL))
     return (EINVAL);
 
   success = 0;
-  for (data = slave->collect; data != NULL; data = data->next)
+  for (mb_data_t *data = slave->collect; data != NULL; data = data->next)
   {
     status = mb_read_data (host, slave, data);
     if (status == 0)
       success++;
   }
 
@@ -641,23 +639,22 @@
     return (0);
 } /* }}} int mb_read_slave */
 
 static int mb_read (user_data_t *user_data) /* {{{ */
 {
   mb_host_t *host;
-  size_t i;
   int success;
   int status;
 
   if ((user_data == NULL) || (user_data->data == NULL))
     return (EINVAL);
 
   host = user_data->data;
 
   success = 0;
-  for (i = 0; i < host->slaves_num; i++)
+  for (size_t i = 0; i < host->slaves_num; i++)
   {
     status = mb_read_slave (host, host->slaves + i);
     if (status == 0)
       success++;
   }
 
@@ -690,18 +687,16 @@
 
   data_free_all (next);
 } /* }}} void data_free_all */
 
 static void slaves_free_all (mb_slave_t *slaves, size_t slaves_num) /* {{{ */
 {
-  size_t i;
-
   if (slaves == NULL)
     return;
 
-  for (i = 0; i < slaves_num; i++)
+  for (size_t i = 0; i < slaves_num; i++)
     data_free_all (slaves[i].collect);
   sfree (slaves);
 } /* }}} void slaves_free_all */
 
 static void host_free (void *void_host) /* {{{ */
 {
@@ -715,26 +710,24 @@
 } /* }}} void host_free */
 
 /* Config functions */
 
 static int mb_config_add_data (oconfig_item_t *ci) /* {{{ */
 {
-  mb_data_t data;
+  mb_data_t data = { 0 };
   int status;
-  int i;
 
-  memset (&data, 0, sizeof (data));
   data.name = NULL;
   data.register_type = REG_TYPE_UINT16;
   data.next = NULL;
 
   status = cf_util_get_string (ci, &data.name);
   if (status != 0)
     return (status);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Type", child->key) == 0)
       status = cf_util_get_string_buffer (child,
           data.type, sizeof (data.type));
@@ -814,43 +807,36 @@
 } /* }}} int mb_config_add_data */
 
 static int mb_config_set_host_address (mb_host_t *host, /* {{{ */
     const char *address)
 {
   struct addrinfo *ai_list;
-  struct addrinfo *ai_ptr;
-  struct addrinfo  ai_hints;
   int status;
 
   if ((host == NULL) || (address == NULL))
     return (EINVAL);
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-#if AI_ADDRCONFIG
-  ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-  /* XXX: libmodbus can only handle IPv4 addresses. */
-  ai_hints.ai_family = AF_INET;
-  ai_hints.ai_addr = NULL;
-  ai_hints.ai_canonname = NULL;
-  ai_hints.ai_next = NULL;
+  struct addrinfo  ai_hints = {
+    /* XXX: libmodbus can only handle IPv4 addresses. */
+    .ai_family = AF_INET,
+    .ai_flags = AI_ADDRCONFIG
+  };
 
-  ai_list = NULL;
   status = getaddrinfo (address, /* service = */ NULL,
       &ai_hints, &ai_list);
   if (status != 0)
   {
     char errbuf[1024];
     ERROR ("Modbus plugin: getaddrinfo failed: %s",
         (status == EAI_SYSTEM)
         ? sstrerror (errno, errbuf, sizeof (errbuf))
         : gai_strerror (status));
     return (status);
   }
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     status = getnameinfo (ai_ptr->ai_addr, ai_ptr->ai_addrlen,
         host->node, sizeof (host->node),
         /* service = */ NULL, /* length = */ 0,
         /* flags = */ NI_NUMERICHOST);
     if (status == 0)
@@ -871,13 +857,12 @@
 } /* }}} int mb_config_set_host_address */
 
 static int mb_config_add_slave (mb_host_t *host, oconfig_item_t *ci) /* {{{ */
 {
   mb_slave_t *slave;
   int status;
-  int i;
 
   if ((host == NULL) || (ci == NULL))
     return (EINVAL);
 
   slave = realloc (host->slaves, sizeof (*slave) * (host->slaves_num + 1));
   if (slave == NULL)
@@ -888,13 +873,13 @@
   slave->collect = NULL;
 
   status = cf_util_get_int (ci, &slave->id);
   if (status != 0)
     return (status);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Instance", child->key) == 0)
       status = cf_util_get_string_buffer (child,
           slave->instance, sizeof (slave->instance));
@@ -931,18 +916,16 @@
 } /* }}} int mb_config_add_slave */
 
 static int mb_config_add_host (oconfig_item_t *ci) /* {{{ */
 {
   mb_host_t *host;
   int status;
-  int i;
 
-  host = malloc (sizeof (*host));
+  host = calloc (1, sizeof (*host));
   if (host == NULL)
     return (ENOMEM);
-  memset (host, 0, sizeof (*host));
   host->slaves = NULL;
 
   status = cf_util_get_string_buffer (ci, host->host, sizeof (host->host));
   if (status != 0)
   {
     sfree (host);
@@ -951,13 +934,13 @@
   if (host->host[0] == 0)
   {
     sfree (host);
     return (EINVAL);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     status = 0;
 
     if (strcasecmp ("Address", child->key) == 0)
     {
@@ -1019,42 +1002,37 @@
   }
 
   if (status == 0)
   {
     user_data_t ud;
     char name[1024];
-    struct timespec interval = { 0, 0 };
 
     ud.data = host;
     ud.free_func = host_free;
 
     ssnprintf (name, sizeof (name), "modbus-%s", host->host);
 
-    CDTIME_T_TO_TIMESPEC (host->interval, &interval);
-
     plugin_register_complex_read (/* group = */ NULL, name,
         /* callback = */ mb_read,
-        /* interval = */ (host->interval > 0) ? &interval : NULL,
+        /* interval = */ host->interval,
         &ud);
   }
   else
   {
     host_free (host);
   }
 
   return (status);
 } /* }}} int mb_config_add_host */
 
 static int mb_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
   if (ci == NULL)
     return (EINVAL);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Data", child->key) == 0)
       mb_config_add_data (child);
     else if (strcasecmp ("Host", child->key) == 0)
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: mqtt.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/multimeter.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/multimeter.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/multimeter.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/multimeter.c	2016-09-11 16:10:25.267038716 +0800
@@ -145,26 +146,24 @@
 
 	return (-2);  /* no value received */
 } /* int multimeter_read_value */
 
 static int multimeter_init (void)
 {
-	int i;
 	char device[] = "/dev/ttyS ";
 
-	for (i = 0; i < 10; i++)
+	for (int i = 0; i < 10; i++)
 	{
 		device[strlen(device)-1] = i + '0';
 
 		if ((fd = open(device, O_RDWR | O_NOCTTY)) != -1)
 		{
-			struct termios tios;
+			struct termios tios = { 0 };
 			int rts = TIOCM_RTS;
 			double value;
 
-			memset (&tios, 0, sizeof (tios));
 			tios.c_cflag = B1200 | CS7 | CSTOPB | CREAD | CLOCAL;
 			tios.c_iflag = IGNBRK | IGNPAR;
 			tios.c_oflag = 0;
 			tios.c_lflag = 0;
 			tios.c_cc[VTIME] = 3;
 			tios.c_cc[VMIN]  = LINE_LENGTH;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mysql.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mysql.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/mysql.c	2016-11-29 00:08:22.411470509 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/mysql.c	2016-09-11 16:10:25.267038716 +0800
@@ -25,15 +25,15 @@
  *   Doug MacEachern <dougm at hyperic.com>
  *   Sebastian tokkee Harl <sh at tokkee.org>
  *   Rodolphe Quiédeville <rquiedeville at bearstech.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #ifdef HAVE_MYSQL_H
 #include <mysql.h>
 #elif defined(HAVE_MYSQL_MYSQL_H)
 #include <mysql/mysql.h>
 #endif
@@ -43,19 +43,28 @@
 	char *instance;
 	char *alias;
 	char *host;
 	char *user;
 	char *pass;
 	char *database;
+
+	/* mysql_ssl_set params */
+	char *key;
+	char *cert;
+	char *ca;
+	char *capath;
+	char *cipher;
+
 	char *socket;
 	int   port;
 	int   timeout;
 
 	_Bool master_stats;
 	_Bool slave_stats;
 	_Bool innodb_stats;
+	_Bool wsrep_stats;
 
 	_Bool slave_notif;
 	_Bool slave_io_running;
 	_Bool slave_sql_running;
 
 	MYSQL *con;
@@ -68,13 +77,13 @@
 static void mysql_database_free (void *arg) /* {{{ */
 {
 	mysql_database_t *db;
 
 	DEBUG ("mysql plugin: mysql_database_free (arg = %p);", arg);
 
-	db = (mysql_database_t *) arg;
+	db = arg;
 
 	if (db == NULL)
 		return;
 
 	if (db->con != NULL)
 		mysql_close (db->con);
@@ -83,12 +92,17 @@
 	sfree (db->host);
 	sfree (db->user);
 	sfree (db->pass);
 	sfree (db->socket);
 	sfree (db->instance);
 	sfree (db->database);
+	sfree (db->key);
+	sfree (db->cert);
+	sfree (db->ca);
+	sfree (db->capath);
+	sfree (db->cipher);
 	sfree (db);
 } /* }}} void mysql_database_free */
 
 /* Configuration handling functions {{{
  *
  * <Plugin mysql>
@@ -100,36 +114,40 @@
  * </Plugin>
  */
 static int mysql_config_database (oconfig_item_t *ci) /* {{{ */
 {
 	mysql_database_t *db;
 	int status = 0;
-	int i;
 
 	if ((ci->values_num != 1)
 	    || (ci->values[0].type != OCONFIG_TYPE_STRING))
 	{
 		WARNING ("mysql plugin: The `Database' block "
 			 "needs exactly one string argument.");
 		return (-1);
 	}
 
-	db = (mysql_database_t *) malloc (sizeof (*db));
+	db = calloc (1, sizeof (*db));
 	if (db == NULL)
 	{
-		ERROR ("mysql plugin: malloc failed.");
+		ERROR ("mysql plugin: calloc failed.");
 		return (-1);
 	}
-	memset (db, 0, sizeof (*db));
 
 	/* initialize all the pointers */
 	db->alias    = NULL;
 	db->host     = NULL;
 	db->user     = NULL;
 	db->pass     = NULL;
 	db->database = NULL;
+	db->key      = NULL;
+	db->cert     = NULL;
+	db->ca       = NULL;
+	db->capath   = NULL;
+	db->cipher   = NULL;
+
 	db->socket   = NULL;
 	db->con      = NULL;
 	db->timeout  = 0;
 
 	/* trigger a notification, if it's not running */
 	db->slave_io_running  = 1;
@@ -141,13 +159,13 @@
 		sfree (db);
 		return (status);
 	}
 	assert (db->instance != NULL);
 
 	/* Fill the `mysql_database_t' structure.. */
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Alias", child->key) == 0)
 			status = cf_util_get_string (child, &db->alias);
 		else if (strcasecmp ("Host", child->key) == 0)
@@ -166,22 +184,34 @@
 			}
 		}
 		else if (strcasecmp ("Socket", child->key) == 0)
 			status = cf_util_get_string (child, &db->socket);
 		else if (strcasecmp ("Database", child->key) == 0)
 			status = cf_util_get_string (child, &db->database);
+		else if (strcasecmp ("SSLKey", child->key) == 0)
+			status = cf_util_get_string (child, &db->key);
+		else if (strcasecmp ("SSLCert", child->key) == 0)
+			status = cf_util_get_string (child, &db->cert);
+		else if (strcasecmp ("SSLCA", child->key) == 0)
+			status = cf_util_get_string (child, &db->ca);
+		else if (strcasecmp ("SSLCAPath", child->key) == 0)
+			status = cf_util_get_string (child, &db->capath);
+		else if (strcasecmp ("SSLCipher", child->key) == 0)
+			status = cf_util_get_string (child, &db->cipher);
 		else if (strcasecmp ("ConnectTimeout", child->key) == 0)
 			status = cf_util_get_int (child, &db->timeout);
 		else if (strcasecmp ("MasterStats", child->key) == 0)
 			status = cf_util_get_boolean (child, &db->master_stats);
 		else if (strcasecmp ("SlaveStats", child->key) == 0)
 			status = cf_util_get_boolean (child, &db->slave_stats);
 		else if (strcasecmp ("SlaveNotifications", child->key) == 0)
 			status = cf_util_get_boolean (child, &db->slave_notif);
 		else if (strcasecmp ("InnodbStats", child->key) == 0)
 			status = cf_util_get_boolean (child, &db->innodb_stats);
+		else if (strcasecmp ("WsrepStats", child->key) == 0)
+			status = cf_util_get_boolean (child, &db->wsrep_stats);
 		else
 		{
 			WARNING ("mysql plugin: Option `%s' not allowed here.", child->key);
 			status = -1;
 		}
 
@@ -189,50 +219,48 @@
 			break;
 	}
 
 	/* If all went well, register this database for reading */
 	if (status == 0)
 	{
-		user_data_t ud;
 		char cb_name[DATA_MAX_NAME_LEN];
 
 		DEBUG ("mysql plugin: Registering new read callback: %s",
 				(db->database != NULL) ? db->database : "<default>");
 
-		memset (&ud, 0, sizeof (ud));
-		ud.data = (void *) db;
-		ud.free_func = mysql_database_free;
-
 		if (db->instance != NULL)
 			ssnprintf (cb_name, sizeof (cb_name), "mysql-%s",
 					db->instance);
 		else
 			sstrncpy (cb_name, "mysql", sizeof (cb_name));
 
+		user_data_t ud = {
+			.data = db,
+			.free_func = mysql_database_free
+		};
+
 		plugin_register_complex_read (/* group = */ NULL, cb_name,
 					      mysql_read,
-					      /* interval = */ NULL, &ud);
+					      /* interval = */ 0, &ud);
 	}
 	else
 	{
 		mysql_database_free (db);
 		return (-1);
 	}
 
 	return (0);
 } /* }}} int mysql_config_database */
 
 static int mysql_config (oconfig_item_t *ci) /* {{{ */
 {
-	int i;
-
 	if (ci == NULL)
 		return (EINVAL);
 
 	/* Fill the `mysql_database_t' structure.. */
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Database", child->key) == 0)
 			mysql_config_database (child);
 		else
@@ -244,12 +272,14 @@
 } /* }}} int mysql_config */
 
 /* }}} End of configuration handling functions */
 
 static MYSQL *getconnection (mysql_database_t *db)
 {
+	const char *cipher;
+
 	if (db->is_connected)
 	{
 		int status;
 
 		status = mysql_ping (db->con);
 		if (status == 0)
@@ -271,27 +301,33 @@
 		}
 	}
 
 	/* Configure TCP connect timeout (default: 0) */
 	db->con->options.connect_timeout = db->timeout;
 
+	mysql_ssl_set (db->con, db->key, db->cert, db->ca, db->capath, db->cipher);
+
 	if (mysql_real_connect (db->con, db->host, db->user, db->pass,
 				db->database, db->port, db->socket, 0) == NULL)
 	{
 		ERROR ("mysql plugin: Failed to connect to database %s "
 				"at server %s: %s",
 				(db->database != NULL) ? db->database : "<none>",
 				(db->host != NULL) ? db->host : "localhost",
 				mysql_error (db->con));
 		return (NULL);
 	}
 
+	cipher = mysql_get_ssl_cipher (db->con);
+
 	INFO ("mysql plugin: Successfully connected to database %s "
-			"at server %s (server version: %s, protocol version: %d)",
+			"at server %s with cipher %s "
+			"(server version: %s, protocol version: %d) ",
 			(db->database != NULL) ? db->database : "<none>",
 			mysql_get_host_info (db->con),
+			(cipher != NULL) ?  cipher : "<none>",
 			mysql_get_server_info (db->con),
 			mysql_get_proto_info (db->con));
 
 	db->is_connected = 1;
 	return (db->con);
 } /* static MYSQL *getconnection (mysql_database_t *db) */
@@ -397,14 +433,14 @@
 
 static int mysql_read_master_stats (mysql_database_t *db, MYSQL *con)
 {
 	MYSQL_RES *res;
 	MYSQL_ROW  row;
 
-	char *query;
-	int   field_num;
+	const char *query;
+	int         field_num;
 	unsigned long long position;
 
 	query = "SHOW MASTER STATUS";
 
 	res = exec_query (con, query);
 	if (res == NULL)
@@ -443,14 +479,14 @@
 
 static int mysql_read_slave_stats (mysql_database_t *db, MYSQL *con)
 {
 	MYSQL_RES *res;
 	MYSQL_ROW  row;
 
-	char *query;
-	int   field_num;
+	const char *query;
+	int         field_num;
 
 	/* WTF? libmysqlclient does not seem to provide any means to
 	 * translate a column name to a column index ... :-/ */
 	const int READ_MASTER_LOG_POS_IDX   = 6;
 	const int SLAVE_IO_RUNNING_IDX      = 10;
 	const int SLAVE_SQL_RUNNING_IDX     = 11;
@@ -566,138 +602,192 @@
 
 static int mysql_read_innodb_stats (mysql_database_t *db, MYSQL *con)
 {
 	MYSQL_RES *res;
 	MYSQL_ROW  row;
 
-	char *query;
-    struct {
-        char *key;
-        char *type;
-        int ds_type;
-    } metrics[] = {
-        { "metadata_mem_pool_size",         "bytes",        DS_TYPE_GAUGE },
-        { "lock_deadlocks",                 "mysql_locks",  DS_TYPE_DERIVE },
-        { "lock_timeouts",                  "mysql_locks",  DS_TYPE_DERIVE },
-        { "lock_row_lock_current_waits",    "mysql_locks",  DS_TYPE_DERIVE },
-        { "buffer_pool_size",               "bytes",        DS_TYPE_GAUGE },
-
-        { "buffer_pool_reads",              "operations",   DS_TYPE_DERIVE },
-        { "buffer_pool_read_requests",      "operations",   DS_TYPE_DERIVE },
-        { "buffer_pool_write_requests",     "operations",   DS_TYPE_DERIVE },
-        { "buffer_pool_wait_free",          "operations",   DS_TYPE_DERIVE },
-        { "buffer_pool_read_ahead",         "operations",   DS_TYPE_DERIVE },
-        { "buffer_pool_read_ahead_evicted", "operations",   DS_TYPE_DERIVE },
-
-        { "buffer_pool_pages_total",        "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_pages_misc",         "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_pages_data",         "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_bytes_data",         "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_pages_dirty",        "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_bytes_dirty",        "gauge",        DS_TYPE_GAUGE },
-        { "buffer_pool_pages_free",         "gauge",        DS_TYPE_GAUGE },
-
-        { "buffer_pages_created",           "operations",   DS_TYPE_DERIVE },
-        { "buffer_pages_written",           "operations",   DS_TYPE_DERIVE },
-        { "buffer_pages_read",              "operations",   DS_TYPE_DERIVE },
-        { "buffer_data_reads",              "operations",   DS_TYPE_DERIVE },
-        { "buffer_data_written",            "operations",   DS_TYPE_DERIVE },
-
-        { "os_data_reads",                  "operations",   DS_TYPE_DERIVE },
-        { "os_data_writes",                 "operations",   DS_TYPE_DERIVE },
-        { "os_data_fsyncs",                 "operations",   DS_TYPE_DERIVE },
-        { "os_log_bytes_written",           "operations",   DS_TYPE_DERIVE },
-        { "os_log_fsyncs",                  "operations",   DS_TYPE_DERIVE },
-        { "os_log_pending_fsyncs",          "operations",   DS_TYPE_DERIVE },
-        { "os_log_pending_writes",          "operations",   DS_TYPE_DERIVE },
-
-        { "trx_rseg_history_len",           "gauge",        DS_TYPE_GAUGE },
-
-        { "log_waits",                      "operations",   DS_TYPE_DERIVE },
-        { "log_write_requests",             "operations",   DS_TYPE_DERIVE },
-        { "log_writes",                     "operations",   DS_TYPE_DERIVE },
-        { "adaptive_hash_searches",         "operations",   DS_TYPE_DERIVE },
-
-        { "file_num_open_files",            "gauge",        DS_TYPE_GAUGE },
-
-        { "ibuf_merges_insert",             "operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_delete_mark",        "operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_delete",             "operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_discard_insert",     "operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_discard_delete_mark","operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_discard_delete",     "operations",   DS_TYPE_DERIVE },
-        { "ibuf_merges_discard_merges",     "operations",   DS_TYPE_DERIVE },
-        { "ibuf_size",                      "bytes",        DS_TYPE_GAUGE },
-
-        { "innodb_activity_count",          "gauge",        DS_TYPE_GAUGE },
-        { "innodb_dblwr_writes",            "operations",   DS_TYPE_DERIVE },
-        { "innodb_dblwr_pages_written",     "operations",   DS_TYPE_DERIVE },
-        { "innodb_dblwr_page_size",         "gauge",        DS_TYPE_GAUGE },
-
-        { "innodb_rwlock_s_spin_waits",     "operations",   DS_TYPE_DERIVE },
-        { "innodb_rwlock_x_spin_waits",     "operations",   DS_TYPE_DERIVE },
-        { "innodb_rwlock_s_spin_rounds",    "operations",   DS_TYPE_DERIVE },
-        { "innodb_rwlock_x_spin_rounds",    "operations",   DS_TYPE_DERIVE },
-        { "innodb_rwlock_s_os_waits",       "operations",   DS_TYPE_DERIVE },
-        { "innodb_rwlock_x_os_waits",       "operations",   DS_TYPE_DERIVE },
-
-        { "dml_reads",                      "operations",   DS_TYPE_DERIVE },
-        { "dml_inserts",                    "operations",   DS_TYPE_DERIVE },
-        { "dml_deletes",                    "operations",   DS_TYPE_DERIVE },
-        { "dml_updates",                    "operations",   DS_TYPE_DERIVE },
+	const char *query;
+	struct {
+		const char *key;
+		const char *type;
+		int ds_type;
+	} metrics[] = {
+		{ "metadata_mem_pool_size",          "bytes",        DS_TYPE_GAUGE },
+		{ "lock_deadlocks",                  "mysql_locks",  DS_TYPE_DERIVE },
+		{ "lock_timeouts",                   "mysql_locks",  DS_TYPE_DERIVE },
+		{ "lock_row_lock_current_waits",     "mysql_locks",  DS_TYPE_DERIVE },
+		{ "buffer_pool_size",                "bytes",        DS_TYPE_GAUGE },
+
+		{ "os_log_bytes_written",            "operations",   DS_TYPE_DERIVE },
+		{ "os_log_pending_fsyncs",           "operations",   DS_TYPE_DERIVE },
+		{ "os_log_pending_writes",           "operations",   DS_TYPE_DERIVE },
+
+		{ "trx_rseg_history_len",            "gauge",        DS_TYPE_GAUGE },
+
+		{ "adaptive_hash_searches",          "operations",   DS_TYPE_DERIVE },
+
+		{ "file_num_open_files",             "gauge",        DS_TYPE_GAUGE },
+
+		{ "ibuf_merges_insert",              "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_delete_mark",         "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_delete",              "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_discard_insert",      "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_discard_delete_mark", "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_discard_delete",      "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_merges_discard_merges",      "operations",   DS_TYPE_DERIVE },
+		{ "ibuf_size",                       "bytes",        DS_TYPE_GAUGE },
+
+		{ "innodb_activity_count",           "gauge",        DS_TYPE_GAUGE },
+
+		{ "innodb_rwlock_s_spin_waits",      "operations",   DS_TYPE_DERIVE },
+		{ "innodb_rwlock_x_spin_waits",      "operations",   DS_TYPE_DERIVE },
+		{ "innodb_rwlock_s_spin_rounds",     "operations",   DS_TYPE_DERIVE },
+		{ "innodb_rwlock_x_spin_rounds",     "operations",   DS_TYPE_DERIVE },
+		{ "innodb_rwlock_s_os_waits",        "operations",   DS_TYPE_DERIVE },
+		{ "innodb_rwlock_x_os_waits",        "operations",   DS_TYPE_DERIVE },
+
+		{ "dml_reads",                       "operations",   DS_TYPE_DERIVE },
+		{ "dml_inserts",                     "operations",   DS_TYPE_DERIVE },
+		{ "dml_deletes",                     "operations",   DS_TYPE_DERIVE },
+		{ "dml_updates",                     "operations",   DS_TYPE_DERIVE },
 
-        { NULL,                     NULL,           0}
-    };
+		{ NULL,                              NULL,           0}
+	};
 
 	query = "SELECT name, count, type FROM information_schema.innodb_metrics WHERE status = 'enabled'";
 
 	res = exec_query (con, query);
 	if (res == NULL)
 		return (-1);
 
 	while ((row = mysql_fetch_row (res)))
 	{
-        int i;
+		int i;
 		char *key;
 		unsigned long long val;
 
 		key = row[0];
 		val = atoll (row[1]);
 
-        for (i = 0;
-             metrics[i].key != NULL && strcmp(metrics[i].key, key) != 0;
-             i++)
-            ;
-
-        if (metrics[i].key == NULL)
-            continue;
-
-        switch (metrics[i].ds_type) {
-        case DS_TYPE_COUNTER:
-            counter_submit(metrics[i].type, key, (counter_t)val, db);
-            break;
-        case DS_TYPE_GAUGE:
-            gauge_submit(metrics[i].type, key, (gauge_t)val, db);
-            break;
-        case DS_TYPE_DERIVE:
-            derive_submit(metrics[i].type, key, (derive_t)val, db);
-            break;
+		for (i = 0; metrics[i].key != NULL && strcmp(metrics[i].key, key) != 0; i++)
+			;
+
+		if (metrics[i].key == NULL)
+			continue;
+
+		switch (metrics[i].ds_type) {
+			case DS_TYPE_COUNTER:
+				counter_submit(metrics[i].type, key, (counter_t)val, db);
+				break;
+			case DS_TYPE_GAUGE:
+				gauge_submit(metrics[i].type, key, (gauge_t)val, db);
+				break;
+			case DS_TYPE_DERIVE:
+				derive_submit(metrics[i].type, key, (derive_t)val, db);
+				break;
+		}
         }
-    }
 
-    mysql_free_result(res);
-    return (0);
+	mysql_free_result(res);
+	return (0);
 }
 
-static int mysql_read (user_data_t *ud)
+static int mysql_read_wsrep_stats (mysql_database_t *db, MYSQL *con)
 {
-	mysql_database_t *db;
-	MYSQL     *con;
 	MYSQL_RES *res;
 	MYSQL_ROW  row;
-	char      *query;
+
+	const char *query;
+	struct {
+		const char *key;
+		const char *type;
+		int ds_type;
+	} metrics[] = {
+
+		{ "wsrep_apply_oooe",                "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_apply_oool",                "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_causal_reads",              "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_commit_oooe",               "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_commit_oool",               "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_flow_control_recv",         "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_flow_control_sent",         "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_flow_control_paused",       "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_local_bf_aborts",           "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_local_cert_failures",       "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_local_commits",             "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_local_replays",             "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_received",                  "operations",   DS_TYPE_DERIVE },
+		{ "wsrep_replicated",                "operations",   DS_TYPE_DERIVE },
+
+		{ "wsrep_received_bytes",            "total_bytes",  DS_TYPE_DERIVE },
+		{ "wsrep_replicated_bytes",          "total_bytes",  DS_TYPE_DERIVE },
+
+		{ "wsrep_apply_window",              "gauge",        DS_TYPE_GAUGE },
+		{ "wsrep_commit_window",             "gauge",        DS_TYPE_GAUGE },
+
+		{ "wsrep_cluster_size",              "gauge",        DS_TYPE_GAUGE },
+		{ "wsrep_cert_deps_distance",        "gauge",        DS_TYPE_GAUGE },
+
+		{ "wsrep_local_recv_queue",          "queue_length", DS_TYPE_GAUGE },
+		{ "wsrep_local_send_queue",          "queue_length", DS_TYPE_GAUGE },
+
+		{ NULL,                              NULL,           0}
+
+	};
+
+	query = "SHOW GLOBAL STATUS LIKE 'wsrep_%'";
+
+	res = exec_query (con, query);
+	if (res == NULL)
+		return (-1);
+
+	row = mysql_fetch_row (res);
+	if (row == NULL)
+	{
+		ERROR ("mysql plugin: Failed to get wsrep statistics: "
+			"`%s' did not return any rows.", query);
+		mysql_free_result (res);
+		return (-1);
+	}
+
+	while ((row = mysql_fetch_row (res)))
+	{
+		int i;
+		char *key;
+		unsigned long long val;
+
+		key = row[0];
+		val = atoll (row[1]);
+
+		for (i = 0; metrics[i].key != NULL && strcmp(metrics[i].key, key) != 0; i++)
+			;
+
+		if (metrics[i].key == NULL)
+			continue;
+
+		switch (metrics[i].ds_type) {
+			case DS_TYPE_GAUGE:
+				gauge_submit(metrics[i].type, key, (gauge_t)val, db);
+				break;
+			case DS_TYPE_DERIVE:
+				derive_submit(metrics[i].type, key, (derive_t)val, db);
+				break;
+		}
+	}
+
+	mysql_free_result(res);
+	return (0);
+} /* mysql_read_wsrep_stats */
+
+static int mysql_read (user_data_t *ud)
+{
+	mysql_database_t *db;
+	MYSQL      *con;
+	MYSQL_RES  *res;
+	MYSQL_ROW   row;
+	const char *query;
 
 	derive_t qcache_hits          = 0;
 	derive_t qcache_inserts       = 0;
 	derive_t qcache_not_cached    = 0;
 	derive_t qcache_lowmem_prunes = 0;
 	gauge_t qcache_queries_in_cache = NAN;
@@ -706,13 +796,13 @@
 	gauge_t threads_connected = NAN;
 	gauge_t threads_cached    = NAN;
 	derive_t threads_created = 0;
 
 	unsigned long long traffic_incoming = 0ULL;
 	unsigned long long traffic_outgoing = 0ULL;
-    unsigned long mysql_version = 0ULL;
+	unsigned long mysql_version = 0ULL;
 
 	if ((ud == NULL) || (ud->data == NULL))
 	{
 		ERROR ("mysql plugin: mysql_database_read: Invalid user data.");
 		return (-1);
 	}
@@ -720,13 +810,13 @@
 	db = (mysql_database_t *) ud->data;
 
 	/* An error message will have been printed in this case */
 	if ((con = getconnection (db)) == NULL)
 		return (-1);
 
-  mysql_version = mysql_get_server_version(con);
+	mysql_version = mysql_get_server_version(con);
 
 	query = "SHOW STATUS";
 	if (mysql_version >= 50002)
 		query = "SHOW GLOBAL STATUS";
 
 	res = exec_query (con, query);
@@ -738,32 +828,32 @@
 		char *key;
 		unsigned long long val;
 
 		key = row[0];
 		val = atoll (row[1]);
 
-		if (strncmp (key, "Com_", 
+		if (strncmp (key, "Com_",
 			          strlen ("Com_")) == 0)
 		{
 			if (val == 0ULL)
 				continue;
 
 			/* Ignore `prepared statements' */
 			if (strncmp (key, "Com_stmt_", strlen ("Com_stmt_")) != 0)
-				counter_submit ("mysql_commands", 
-						key + strlen ("Com_"), 
+				counter_submit ("mysql_commands",
+						key + strlen ("Com_"),
 						val, db);
 		}
-		else if (strncmp (key, "Handler_", 
+		else if (strncmp (key, "Handler_",
 				        strlen ("Handler_")) == 0)
 		{
 			if (val == 0ULL)
 				continue;
 
-			counter_submit ("mysql_handler", 
-					key + strlen ("Handler_"), 
+			counter_submit ("mysql_handler",
+					key + strlen ("Handler_"),
 					val, db);
 		}
 		else if (strncmp (key, "Qcache_",
        				        strlen ("Qcache_")) == 0)
 		{
 			if (strcmp (key, "Qcache_hits") == 0)
@@ -774,21 +864,21 @@
 				qcache_not_cached = (derive_t) val;
 			else if (strcmp (key, "Qcache_lowmem_prunes") == 0)
 				qcache_lowmem_prunes = (derive_t) val;
 			else if (strcmp (key, "Qcache_queries_in_cache") == 0)
 				qcache_queries_in_cache = (gauge_t) val;
 		}
-		else if (strncmp (key, "Bytes_", 
+		else if (strncmp (key, "Bytes_",
 				        strlen ("Bytes_")) == 0)
 		{
 			if (strcmp (key, "Bytes_received") == 0)
 				traffic_incoming += val;
 			else if (strcmp (key, "Bytes_sent") == 0)
 				traffic_outgoing += val;
 		}
-		else if (strncmp (key, "Threads_", 
+		else if (strncmp (key, "Threads_",
        				        strlen ("Threads_")) == 0)
 		{
 			if (strcmp (key, "Threads_running") == 0)
 				threads_running = (gauge_t) val;
 			else if (strcmp (key, "Threads_connected") == 0)
 				threads_connected = (gauge_t) val;
@@ -826,12 +916,14 @@
 			else if (strcmp (key, "Innodb_buffer_pool_read_ahead_evicted") == 0)
 				counter_submit ("mysql_bpool_counters", "read_ahead_evicted", val, db);
 			else if (strcmp (key, "Innodb_buffer_pool_read_requests") == 0)
 				counter_submit ("mysql_bpool_counters", "read_requests", val, db);
 			else if (strcmp (key, "Innodb_buffer_pool_reads") == 0)
 				counter_submit ("mysql_bpool_counters", "reads", val, db);
+			else if (strcmp (key, "Innodb_buffer_pool_wait_free") == 0)
+				counter_submit ("mysql_bpool_counters", "wait_free", val, db);
 			else if (strcmp (key, "Innodb_buffer_pool_write_requests") == 0)
 				counter_submit ("mysql_bpool_counters", "write_requests", val, db);
 			else if (strcmp (key, "Innodb_buffer_pool_bytes_data") == 0)
 				gauge_submit ("mysql_bpool_bytes", "data", val, db);
 			else if (strcmp (key, "Innodb_buffer_pool_bytes_dirty") == 0)
 				gauge_submit ("mysql_bpool_bytes", "dirty", val, db);
@@ -850,12 +942,14 @@
 
 			/* double write */
 			else if (strcmp (key, "Innodb_dblwr_writes") == 0)
 				counter_submit ("mysql_innodb_dblwr", "writes", val, db);
 			else if (strcmp (key, "Innodb_dblwr_pages_written") == 0)
 				counter_submit ("mysql_innodb_dblwr", "written", val, db);
+			else if (strcmp (key, "Innodb_dblwr_page_size") == 0)
+				gauge_submit ("mysql_innodb_dblwr", "page_size", val, db);
 
 			/* log */
 			else if (strcmp (key, "Innodb_log_waits") == 0)
 				counter_submit ("mysql_innodb_log", "waits", val, db);
 			else if (strcmp (key, "Innodb_log_write_requests") == 0)
 				counter_submit ("mysql_innodb_log", "write_requests", val, db);
@@ -894,14 +988,25 @@
 		{
 			counter_submit ("mysql_select", key + strlen ("Select_"),
 					val, db);
 		}
 		else if (strncmp (key, "Sort_", strlen ("Sort_")) == 0)
 		{
-			counter_submit ("mysql_sort", key + strlen ("Sort_"),
-					val, db);
+			if (strcmp (key, "Sort_merge_passes") == 0)
+				counter_submit ("mysql_sort_merge_passes", NULL, val, db);
+			else if (strcmp (key, "Sort_rows") == 0)
+				counter_submit ("mysql_sort_rows", NULL, val, db);
+			else if (strcmp (key, "Sort_range") == 0)
+				counter_submit ("mysql_sort", "range", val, db);
+			else if (strcmp (key, "Sort_scan") == 0)
+				counter_submit ("mysql_sort", "scan", val, db);
+
+		}
+		else if (strncmp (key, "Slow_queries", strlen ("Slow_queries")) == 0)
+		{
+			counter_submit ("mysql_slow_queries", NULL , val, db);
 		}
 	}
 	mysql_free_result (res); res = NULL;
 
 	if ((qcache_hits != 0)
 			|| (qcache_inserts != 0)
@@ -934,20 +1039,23 @@
 				threads_created, db);
 	}
 
 	traffic_submit  (traffic_incoming, traffic_outgoing, db);
 
 	if (mysql_version >= 50600 && db->innodb_stats)
-        mysql_read_innodb_stats (db, con);
+		mysql_read_innodb_stats (db, con);
 
 	if (db->master_stats)
 		mysql_read_master_stats (db, con);
 
 	if ((db->slave_stats) || (db->slave_notif))
 		mysql_read_slave_stats (db, con);
 
+	if (db->wsrep_stats)
+		mysql_read_wsrep_stats (db, con);
+
 	return (0);
 } /* int mysql_read */
 
 void module_register (void)
 {
 	plugin_register_complex_config ("mysql", mysql_config);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/netapp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/netapp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/netapp.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/netapp.c	2016-09-11 16:10:25.267038716 +0800
@@ -461,16 +462,15 @@
 
 	for (d = cd->disks; d != NULL; d = d->next) {
 		if (strcmp(d->name, name) == 0)
 			return d;
 	}
 
-	d = malloc(sizeof(*d));
+	d = calloc (1, sizeof (*d));
 	if (d == NULL)
 		return (NULL);
-	memset (d, 0, sizeof (*d));
 	d->next = NULL;
 
 	d->name = strdup(name);
 	if (d->name == NULL) {
 		sfree (d);
 		return (NULL);
@@ -510,16 +510,15 @@
 	ignore_capacity = ignorelist_match (cvu->il_capacity, name);
 	ignore_snapshot = ignorelist_match (cvu->il_snapshot, name);
 	if ((ignore_capacity != 0) && (ignore_snapshot != 0))
 		return (NULL);
 
 	/* Not found: allocate. */
-	new = malloc (sizeof (*new));
+	new = calloc (1, sizeof (*new));
 	if (new == NULL)
 		return (NULL);
-	memset (new, 0, sizeof (*new));
 	new->next = NULL;
 
 	new->name = strdup (name);
 	if (new->name == NULL)
 	{
 		sfree (new);
@@ -578,16 +577,15 @@
 	ignore_latency = ignorelist_match (cvp->il_latency, name);
 	if ((ignore_octets != 0) || (ignore_operations != 0)
 			|| (ignore_latency != 0))
 		return (NULL);
 
 	/* Not found: allocate. */
-	new = malloc (sizeof (*new));
+	new = calloc (1, sizeof (*new));
 	if (new == NULL)
 		return (NULL);
-	memset (new, 0, sizeof (*new));
 	new->next = NULL;
 
 	new->name = strdup (name);
 	if (new->name == NULL)
 	{
 		sfree (new);
@@ -879,31 +877,28 @@
 	t = (time_t) na_child_get_uint64 (data, "timestamp", /* default = */ 0);
 
 	return (TIME_T_TO_CDTIME_T (t));
 } /* }}} cdtime_t cna_child_get_cdtime */
 
 
-/* 
+/*
  * Query functions
  *
  * These functions are called with appropriate data returned by the libnetapp
  * interface which is parsed and submitted with the above functions.
  */
 /* Data corresponding to <WAFL /> */
 static int cna_handle_wafl_data (const char *hostname, cfg_wafl_t *cfg_wafl, /* {{{ */
 		na_elem_t *data, cdtime_t interval)
 {
-	cfg_wafl_t perf_data;
+	cfg_wafl_t perf_data = { 0 };
 	const char *plugin_inst;
 
 	na_elem_t *instances;
-	na_elem_t *counter;
 	na_elem_iter_t counter_iter;
 
-	memset (&perf_data, 0, sizeof (perf_data));
-	
 	perf_data.timestamp = cna_child_get_cdtime (data);
 
 	instances = na_elem_child(na_elem_child (data, "instances"), "instance-data");
 	if (instances == NULL)
 	{
 		ERROR ("netapp plugin: cna_handle_wafl_data: "
@@ -920,13 +915,13 @@
 				"for host %s.", hostname);
 		return (-1);
 	}
 
 	/* Iterate over all counters */
 	counter_iter = na_child_iterator (na_elem_child (instances, "counters"));
-	for (counter = na_iterator_next (&counter_iter);
+	for (na_elem_t *counter = na_iterator_next (&counter_iter);
 			counter != NULL;
 			counter = na_iterator_next (&counter_iter))
 	{
 		const char *name;
 		uint64_t value;
 
@@ -1056,19 +1051,18 @@
 /* Data corresponding to <Disks /> */
 static int cna_handle_disk_data (const char *hostname, /* {{{ */
 		cfg_disk_t *cfg_disk, na_elem_t *data, cdtime_t interval)
 {
 	cdtime_t timestamp;
 	na_elem_t *instances;
-	na_elem_t *instance;
 	na_elem_iter_t instance_iter;
 	disk_t *worst_disk = NULL;
 
 	if ((cfg_disk == NULL) || (data == NULL))
 		return (EINVAL);
-	
+
 	timestamp = cna_child_get_cdtime (data);
 
 	instances = na_elem_child (data, "instances");
 	if (instances == NULL)
 	{
 		ERROR ("netapp plugin: cna_handle_disk_data: "
@@ -1076,33 +1070,31 @@
 				"for host %s.", hostname);
 		return (-1);
 	}
 
 	/* Iterate over all children */
 	instance_iter = na_child_iterator (instances);
-	for (instance = na_iterator_next (&instance_iter);
+	for (na_elem_t *instance = na_iterator_next (&instance_iter);
 			instance != NULL;
 			instance = na_iterator_next(&instance_iter))
 	{
 		disk_t *old_data;
-		disk_t  new_data;
+		disk_t  new_data = { 0 };
 
 		na_elem_iter_t counter_iterator;
-		na_elem_t *counter;
 
-		memset (&new_data, 0, sizeof (new_data));
 		new_data.timestamp = timestamp;
 		new_data.disk_busy_percent = NAN;
 
 		old_data = get_disk(cfg_disk, na_child_get_string (instance, "name"));
 		if (old_data == NULL)
 			continue;
 
 		/* Look for the "disk_busy" and "base_for_disk_busy" counters */
 		counter_iterator = na_child_iterator(na_elem_child(instance, "counters"));
-		for (counter = na_iterator_next(&counter_iterator);
+		for (na_elem_t *counter = na_iterator_next(&counter_iterator);
 				counter != NULL;
 				counter = na_iterator_next(&counter_iterator))
 		{
 			const char *name;
 			uint64_t value;
 
@@ -1253,40 +1245,37 @@
 static int cna_handle_volume_perf_data (const char *hostname, /* {{{ */
 		cfg_volume_perf_t *cvp, na_elem_t *data, cdtime_t interval)
 {
 	cdtime_t timestamp;
 	na_elem_t *elem_instances;
 	na_elem_iter_t iter_instances;
-	na_elem_t *elem_instance;
-	
+
 	timestamp = cna_child_get_cdtime (data);
 
 	elem_instances = na_elem_child(data, "instances");
 	if (elem_instances == NULL)
 	{
 		ERROR ("netapp plugin: handle_volume_perf_data: "
 				"na_elem_child (\"instances\") failed "
 				"for host %s.", hostname);
 		return (-1);
 	}
 
 	iter_instances = na_child_iterator (elem_instances);
-	for (elem_instance = na_iterator_next(&iter_instances);
+	for (na_elem_t *elem_instance = na_iterator_next(&iter_instances);
 			elem_instance != NULL;
 			elem_instance = na_iterator_next(&iter_instances))
 	{
 		const char *name;
 
-		data_volume_perf_t perf_data;
+		data_volume_perf_t perf_data = { 0 };
 		data_volume_perf_t *v;
 
 		na_elem_t *elem_counters;
 		na_elem_iter_t iter_counters;
-		na_elem_t *elem_counter;
 
-		memset (&perf_data, 0, sizeof (perf_data));
 		perf_data.timestamp = timestamp;
 
 		name = na_child_get_string (elem_instance, "name");
 		if (name == NULL)
 			continue;
 
@@ -1297,13 +1286,13 @@
 
 		elem_counters = na_elem_child (elem_instance, "counters");
 		if (elem_counters == NULL)
 			continue;
 
 		iter_counters = na_child_iterator (elem_counters);
-		for (elem_counter = na_iterator_next(&iter_counters);
+		for (na_elem_t *elem_counter = na_iterator_next(&iter_counters);
 				elem_counter != NULL;
 				elem_counter = na_iterator_next(&iter_counters))
 		{
 			const char *name;
 			uint64_t value;
 
@@ -1422,15 +1411,13 @@
 } /* }}} int cna_query_volume_perf */
 
 /* Data corresponding to <VolumeUsage /> */
 static int cna_submit_volume_usage_data (const char *hostname, /* {{{ */
 		cfg_volume_usage_t *cfg_volume, int interval)
 {
-	data_volume_usage_t *v;
-
-	for (v = cfg_volume->volumes; v != NULL; v = v->next)
+	for (data_volume_usage_t *v = cfg_volume->volumes; v != NULL; v = v->next)
 	{
 		char plugin_instance[DATA_MAX_NAME_LEN];
 
 		uint64_t norm_used = v->norm_used;
 		uint64_t norm_free = v->norm_free;
 		uint64_t sis_saved = v->sis_saved;
@@ -1519,15 +1506,14 @@
 
 /* Switch the state of a volume between online and offline and send out a
  * notification. */
 static int cna_change_volume_status (const char *hostname, /* {{{ */
 		data_volume_usage_t *v)
 {
-	notification_t n;
+	notification_t n = { 0 };
 
-	memset (&n, 0, sizeof (n));
 	n.time = cdtime ();
 	sstrncpy (n.host, hostname, sizeof (n.host));
 	sstrncpy (n.plugin, "netapp", sizeof (n.plugin));
 	sstrncpy (n.plugin_instance, v->name, sizeof (n.plugin_instance));
 
 	if ((v->flags & IS_VOLUME_USAGE_OFFLINE) != 0) {
@@ -1546,13 +1532,13 @@
 } /* }}} int cna_change_volume_status */
 
 static void cna_handle_volume_snap_usage(const host_config_t *host, /* {{{ */
 		data_volume_usage_t *v)
 {
 	uint64_t snap_used = 0, value;
-	na_elem_t *data, *elem_snap, *elem_snapshots;
+	na_elem_t *data, *elem_snapshots;
 	na_elem_iter_t iter_snap;
 
 	data = na_server_invoke_elem(host->srv, v->snap_query);
 	if (na_results_status(data) != NA_OK)
 	{
 		if (na_results_errno(data) == EVOLUMEOFFLINE) {
@@ -1578,13 +1564,13 @@
 				"for host %s.", host->name);
 		na_elem_free(data);
 		return;
 	}
 
 	iter_snap = na_child_iterator (elem_snapshots);
-	for (elem_snap = na_iterator_next (&iter_snap);
+	for (na_elem_t *elem_snap = na_iterator_next (&iter_snap);
 			elem_snap != NULL;
 			elem_snap = na_iterator_next (&iter_snap))
 	{
 		value = na_child_get_uint64(elem_snap, "cumulative-total", 0);
 		/* "cumulative-total" is the total size of the oldest snapshot plus all
 		 * newer ones in blocks (1KB). We therefore are looking for the highest
@@ -1693,13 +1679,12 @@
 	}
 } /* }}} void cna_handle_volume_sis_saved */
 
 static int cna_handle_volume_usage_data (const host_config_t *host, /* {{{ */
 		cfg_volume_usage_t *cfg_volume, na_elem_t *data)
 {
-	na_elem_t *elem_volume;
 	na_elem_t *elem_volumes;
 	na_elem_iter_t iter_volume;
 
 	elem_volumes = na_elem_child (data, "volumes");
 	if (elem_volumes == NULL)
 	{
@@ -1707,13 +1692,13 @@
 				"na_elem_child (\"volumes\") failed "
 				"for host %s.", host->name);
 		return (-1);
 	}
 
 	iter_volume = na_child_iterator (elem_volumes);
-	for (elem_volume = na_iterator_next (&iter_volume);
+	for (na_elem_t *elem_volume = na_iterator_next (&iter_volume);
 			elem_volume != NULL;
 			elem_volume = na_iterator_next (&iter_volume))
 	{
 		const char *volume_name, *state;
 
 		data_volume_usage_t *v;
@@ -1733,13 +1718,13 @@
 		v = get_volume_usage (cfg_volume, volume_name);
 		if (v == NULL)
 			continue;
 
 		if ((v->flags & CFG_VOLUME_USAGE_SNAP) != 0)
 			cna_handle_volume_snap_usage(host, v);
-		
+
 		if ((v->flags & CFG_VOLUME_USAGE_DF) == 0)
 			continue;
 
 		/* 2^4 exa-bytes? This will take a while ;) */
 		value = na_child_get_uint64(elem_volume, "size-available", UINT64_MAX);
 		if (value != UINT64_MAX) {
@@ -1831,13 +1816,12 @@
 } /* }}} int cna_query_volume_usage */
 
 /* Data corresponding to <Quota /> */
 static int cna_handle_quota_data (const host_config_t *host, /* {{{ */
 		cfg_quota_t *cfg_quota, na_elem_t *data)
 {
-	na_elem_t *elem_quota;
 	na_elem_t *elem_quotas;
 	na_elem_iter_t iter_quota;
 
 	elem_quotas = na_elem_child (data, "quotas");
 	if (elem_quotas == NULL)
 	{
@@ -1845,13 +1829,13 @@
 				"na_elem_child (\"quotas\") failed "
 				"for host %s.", host->name);
 		return (-1);
 	}
 
 	iter_quota = na_child_iterator (elem_quotas);
-	for (elem_quota = na_iterator_next (&iter_quota);
+	for (na_elem_t *elem_quota = na_iterator_next (&iter_quota);
 			elem_quota != NULL;
 			elem_quota = na_iterator_next (&iter_quota))
 	{
 		const char *quota_type, *volume_name, *tree_name;
 		uint64_t value;
 
@@ -1957,23 +1941,22 @@
 } /* }}} int cna_query_quota */
 
 /* Data corresponding to <SnapVault /> */
 static int cna_handle_snapvault_data (const char *hostname, /* {{{ */
 		cfg_snapvault_t *cfg_snapvault, na_elem_t *data, cdtime_t interval)
 {
-	na_elem_t *status;
 	na_elem_iter_t status_iter;
 
 	status = na_elem_child (data, "status-list");
 	if (! status) {
 		ERROR ("netapp plugin: SnapVault status record missing status-list");
 		return (0);
 	}
 
 	status_iter = na_child_iterator (status);
-	for (status = na_iterator_next (&status_iter);
+	for (na_elem_t *status = na_iterator_next (&status_iter);
 			status != NULL;
 			status = na_iterator_next (&status_iter))
 	{
 		const char *dest_sys, *dest_path, *src_sys, *src_path;
 		char plugin_instance[DATA_MAX_NAME_LEN];
 		uint64_t value;
@@ -2017,25 +2000,24 @@
 static int cna_handle_snapvault_iter (host_config_t *host, /* {{{ */
 		na_elem_t *data)
 {
 	const char *tag;
 
 	uint32_t records_count;
-	uint32_t i;
 
 	records_count = na_child_get_uint32 (data, "records", UINT32_MAX);
 	if (records_count == UINT32_MAX)
 		return 0;
 
 	tag = na_child_get_string (data, "tag");
 	if (! tag)
 		return 0;
 
 	DEBUG ("netapp plugin: Iterating %u SV records (tag = %s)", records_count, tag);
 
-	for (i = 0; i < records_count; ++i) {
+	for (uint32_t i = 0; i < records_count; ++i) {
 		na_elem_t *elem;
 
 		elem = na_server_invoke (host->srv,
 				"snapvault-secondary-relationship-status-list-iter-next",
 				"maximum", "1", "tag", tag, NULL);
 
@@ -2118,23 +2100,22 @@
 
 /* Data corresponding to <System /> */
 static int cna_handle_system_data (const char *hostname, /* {{{ */
 		cfg_system_t *cfg_system, na_elem_t *data, int interval)
 {
 	na_elem_t *instances;
-	na_elem_t *counter;
 	na_elem_iter_t counter_iter;
 
 	derive_t disk_read = 0, disk_written = 0;
 	derive_t net_recv = 0, net_sent = 0;
 	derive_t cpu_busy = 0, cpu_total = 0;
 	uint32_t counter_flags = 0;
 
 	const char *instance;
 	cdtime_t timestamp;
-	
+
 	timestamp = cna_child_get_cdtime (data);
 
 	instances = na_elem_child(na_elem_child (data, "instances"), "instance-data");
 	if (instances == NULL)
 	{
 		ERROR ("netapp plugin: cna_handle_system_data: "
@@ -2150,13 +2131,13 @@
 				"na_child_get_string (\"name\") failed "
 				"for host %s.", hostname);
 		return (-1);
 	}
 
 	counter_iter = na_child_iterator (na_elem_child (instances, "counters"));
-	for (counter = na_iterator_next (&counter_iter);
+	for (na_elem_t *counter = na_iterator_next (&counter_iter);
 			counter != NULL;
 			counter = na_iterator_next (&counter_iter))
 	{
 		const char *name;
 		uint64_t value;
 
@@ -2195,13 +2176,13 @@
 	} /* for (counter) */
 
 	if ((cfg_system->flags & CFG_SYSTEM_DISK)
 			&& (HAS_ALL_FLAGS (counter_flags, 0x01 | 0x02)))
 		submit_two_derive (hostname, instance, "disk_octets", NULL,
 				disk_read, disk_written, timestamp, interval);
-				
+
 	if ((cfg_system->flags & CFG_SYSTEM_NET)
 			&& (HAS_ALL_FLAGS (counter_flags, 0x04 | 0x08)))
 		submit_two_derive (hostname, instance, "if_octets", NULL,
 				net_recv, net_sent, timestamp, interval);
 
 	if ((cfg_system->flags & CFG_SYSTEM_CPU)
@@ -2395,23 +2376,21 @@
  */
 /* Corresponds to a <VolumePerf /> block */
 static int cna_config_volume_performance (host_config_t *host, /* {{{ */
 		const oconfig_item_t *ci)
 {
 	cfg_volume_perf_t *cfg_volume_perf;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_volume_perf == NULL)
 	{
-		cfg_volume_perf = malloc (sizeof (*cfg_volume_perf));
+		cfg_volume_perf = calloc (1, sizeof (*cfg_volume_perf));
 		if (cfg_volume_perf == NULL)
 			return (ENOMEM);
-		memset (cfg_volume_perf, 0, sizeof (*cfg_volume_perf));
 
 		/* Set default flags */
 		cfg_volume_perf->query = NULL;
 		cfg_volume_perf->volumes = NULL;
 
 		cfg_volume_perf->il_octets = ignorelist_create (/* invert = */ 1);
@@ -2438,16 +2417,16 @@
 			return (ENOMEM);
 		}
 
 		host->cfg_volume_perf = cfg_volume_perf;
 	}
 	cfg_volume_perf = host->cfg_volume_perf;
-	
-	for (i = 0; i < ci->children_num; ++i) {
+
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
-		
+
 		/* if (!item || !item->key || !*item->key) continue; */
 		if (strcasecmp(item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_volume_perf->interval);
 		else if (!strcasecmp(item->key, "GetIO"))
 			cna_config_volume_perf_option (cfg_volume_perf, item);
 		else if (!strcasecmp(item->key, "GetOps"))
@@ -2523,30 +2502,28 @@
 } /* }}} void cna_config_volume_usage_default */
 
 /* Corresponds to a <Quota /> block */
 static int cna_config_quota (host_config_t *host, oconfig_item_t *ci) /* {{{ */
 {
 	cfg_quota_t *cfg_quota;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_quota == NULL)
 	{
-		cfg_quota = malloc (sizeof (*cfg_quota));
+		cfg_quota = calloc (1, sizeof (*cfg_quota));
 		if (cfg_quota == NULL)
 			return (ENOMEM);
-		memset (cfg_quota, 0, sizeof (*cfg_quota));
 		cfg_quota->query = NULL;
 
 		host->cfg_quota = cfg_quota;
 	}
 	cfg_quota = host->cfg_quota;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
 
 		if (strcasecmp (item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_quota->interval);
 		else
 			WARNING ("netapp plugin: The option %s is not allowed within "
@@ -2556,36 +2533,34 @@
 	return (0);
 } /* }}} int cna_config_quota */
 
 /* Corresponds to a <Disks /> block */
 static int cna_config_disk(host_config_t *host, oconfig_item_t *ci) { /* {{{ */
 	cfg_disk_t *cfg_disk;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_disk == NULL)
 	{
-		cfg_disk = malloc (sizeof (*cfg_disk));
+		cfg_disk = calloc (1, sizeof (*cfg_disk));
 		if (cfg_disk == NULL)
 			return (ENOMEM);
-		memset (cfg_disk, 0, sizeof (*cfg_disk));
 
 		/* Set default flags */
 		cfg_disk->flags = CFG_DISK_ALL;
 		cfg_disk->query = NULL;
 		cfg_disk->disks = NULL;
 
 		host->cfg_disk = cfg_disk;
 	}
 	cfg_disk = host->cfg_disk;
-	
-	for (i = 0; i < ci->children_num; ++i) {
+
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
-		
+
 		/* if (!item || !item->key || !*item->key) continue; */
 		if (strcasecmp(item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_disk->interval);
 		else if (strcasecmp(item->key, "GetBusy") == 0)
 			cna_config_bool_to_flag (item, &cfg_disk->flags, CFG_DISK_BUSIEST);
 	}
@@ -2602,34 +2577,32 @@
 } /* }}} int cna_config_disk */
 
 /* Corresponds to a <WAFL /> block */
 static int cna_config_wafl(host_config_t *host, oconfig_item_t *ci) /* {{{ */
 {
 	cfg_wafl_t *cfg_wafl;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_wafl == NULL)
 	{
-		cfg_wafl = malloc (sizeof (*cfg_wafl));
+		cfg_wafl = calloc (1, sizeof (*cfg_wafl));
 		if (cfg_wafl == NULL)
 			return (ENOMEM);
-		memset (cfg_wafl, 0, sizeof (*cfg_wafl));
 
 		/* Set default flags */
 		cfg_wafl->flags = CFG_WAFL_ALL;
 
 		host->cfg_wafl = cfg_wafl;
 	}
 	cfg_wafl = host->cfg_wafl;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
-		
+
 		if (strcasecmp(item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_wafl->interval);
 		else if (!strcasecmp(item->key, "GetNameCache"))
 			cna_config_bool_to_flag (item, &cfg_wafl->flags, CFG_WAFL_NAME_CACHE);
 		else if (!strcasecmp(item->key, "GetDirCache"))
 			cna_config_bool_to_flag (item, &cfg_wafl->flags, CFG_WAFL_DIR_CACHE);
@@ -2671,23 +2644,21 @@
  */
 /* Corresponds to a <VolumeUsage /> block */
 static int cna_config_volume_usage(host_config_t *host, /* {{{ */
 		const oconfig_item_t *ci)
 {
 	cfg_volume_usage_t *cfg_volume_usage;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_volume_usage == NULL)
 	{
-		cfg_volume_usage = malloc (sizeof (*cfg_volume_usage));
+		cfg_volume_usage = calloc (1, sizeof (*cfg_volume_usage));
 		if (cfg_volume_usage == NULL)
 			return (ENOMEM);
-		memset (cfg_volume_usage, 0, sizeof (*cfg_volume_usage));
 
 		/* Set default flags */
 		cfg_volume_usage->query = NULL;
 		cfg_volume_usage->volumes = NULL;
 
 		cfg_volume_usage->il_capacity = ignorelist_create (/* invert = */ 1);
@@ -2705,16 +2676,16 @@
 			return (ENOMEM);
 		}
 
 		host->cfg_volume_usage = cfg_volume_usage;
 	}
 	cfg_volume_usage = host->cfg_volume_usage;
-	
-	for (i = 0; i < ci->children_num; ++i) {
+
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
-		
+
 		/* if (!item || !item->key || !*item->key) continue; */
 		if (strcasecmp(item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_volume_usage->interval);
 		else if (!strcasecmp(item->key, "GetCapacity"))
 			cna_config_volume_usage_option (cfg_volume_usage, item);
 		else if (!strcasecmp(item->key, "GetSnapshot"))
@@ -2733,31 +2704,29 @@
 
 /* Corresponds to a <SnapVault /> block */
 static int cna_config_snapvault (host_config_t *host, /* {{{ */
 		const oconfig_item_t *ci)
 {
 	cfg_snapvault_t *cfg_snapvault;
-	int i;
 
 	if ((host == NULL) || (ci == NULL))
 		return EINVAL;
 
 	if (host->cfg_snapvault == NULL)
 	{
-		cfg_snapvault = malloc (sizeof (*cfg_snapvault));
+		cfg_snapvault = calloc (1, sizeof (*cfg_snapvault));
 		if (cfg_snapvault == NULL)
 			return ENOMEM;
-		memset (cfg_snapvault, 0, sizeof (*cfg_snapvault));
 		cfg_snapvault->query = NULL;
 
 		host->cfg_snapvault = cfg_snapvault;
 	}
 
 	cfg_snapvault = host->cfg_snapvault;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
 
 		if (strcasecmp (item->key, "Interval") == 0)
 			cna_config_get_interval (item, &cfg_snapvault->interval);
 		else
 			WARNING ("netapp plugin: The option %s is not allowed within "
@@ -2769,33 +2738,31 @@
 
 /* Corresponds to a <System /> block */
 static int cna_config_system (host_config_t *host, /* {{{ */
 		oconfig_item_t *ci)
 {
 	cfg_system_t *cfg_system;
-	int i;
-	
+
 	if ((host == NULL) || (ci == NULL))
 		return (EINVAL);
 
 	if (host->cfg_system == NULL)
 	{
-		cfg_system = malloc (sizeof (*cfg_system));
+		cfg_system = calloc (1, sizeof (*cfg_system));
 		if (cfg_system == NULL)
 			return (ENOMEM);
-		memset (cfg_system, 0, sizeof (*cfg_system));
 
 		/* Set default flags */
 		cfg_system->flags = CFG_SYSTEM_ALL;
 		cfg_system->query = NULL;
 
 		host->cfg_system = cfg_system;
 	}
 	cfg_system = host->cfg_system;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
 
 		if (strcasecmp(item->key, "Interval") == 0) {
 			cna_config_get_interval (item, &cfg_system->interval);
 		} else if (!strcasecmp(item->key, "GetCPULoad")) {
 			cna_config_bool_to_flag (item, &cfg_system->flags, CFG_SYSTEM_CPU);
@@ -2824,16 +2791,15 @@
 
 /* Corresponds to a <Host /> block. */
 static host_config_t *cna_alloc_host (void) /* {{{ */
 {
 	host_config_t *host;
 
-	host = malloc(sizeof(*host));
-	if (! host)
+	host = calloc (1, sizeof (*host));
+	if (host == NULL)
 		return (NULL);
-	memset (host, 0, sizeof (*host));
 
 	host->name = NULL;
 	host->protocol = NA_SERVER_TRANSPORT_HTTPS;
 	host->host = NULL;
 	host->username = NULL;
 	host->password = NULL;
@@ -2903,42 +2869,38 @@
 
 static int cna_read (user_data_t *ud);
 
 static int cna_register_host (host_config_t *host) /* {{{ */
 {
 	char cb_name[256];
-	struct timespec interval;
-	user_data_t ud;
 
 	if (host->vfiler)
 		ssnprintf (cb_name, sizeof (cb_name), "netapp-%s-%s",
 				host->name, host->vfiler);
 	else
 		ssnprintf (cb_name, sizeof (cb_name), "netapp-%s", host->name);
 
-	CDTIME_T_TO_TIMESPEC (host->interval, &interval);
-
-	memset (&ud, 0, sizeof (ud));
-	ud.data = host;
-	ud.free_func = (void (*) (void *)) free_host_config;
+	user_data_t ud = {
+		.data = host,
+		.free_func = (void (*) (void *)) free_host_config
+	};
 
 	plugin_register_complex_read (/* group = */ NULL, cb_name,
 			/* callback  = */ cna_read,
-			/* interval  = */ (host->interval > 0) ? &interval : NULL,
+			/* interval  = */ host->interval,
 			/* user data = */ &ud);
 
 	return (0);
 } /* }}} int cna_register_host */
 
 static int cna_config_host (host_config_t *host, /* {{{ */
 		const oconfig_item_t *ci)
 {
 	oconfig_item_t *item;
 	_Bool is_vfiler = 0;
 	int status;
-	int i;
 
 	if (! strcasecmp (ci->key, "VFiler"))
 		is_vfiler = 1;
 
 	if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING)) {
 		WARNING ("netapp plugin: \"%s\" needs exactly one string argument. Ignoring host block.", ci->key);
@@ -2946,13 +2908,13 @@
 	}
 
 	status = cf_util_get_string (ci, &host->name);
 	if (status != 0)
 		return (1);
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		item = ci->children + i;
 
 		status = 0;
 
 		if (!strcasecmp(item->key, "Address")) {
 			status = cf_util_get_string (item, &host->host);
@@ -3085,15 +3047,14 @@
 
 	return (0);
 } /* }}} int cna_init_host */
 
 static int cna_init (void) /* {{{ */
 {
-	char err[256];
+	char err[256] = { 0 };
 
-	memset (err, 0, sizeof (err));
 	if (!na_startup(err, sizeof(err))) {
 		err[sizeof (err) - 1] = 0;
 		ERROR("netapp plugin: Error initializing netapp API: %s", err);
 		return 1;
 	}
 
@@ -3156,16 +3117,15 @@
 	}
 
 	return 0;
 } /* }}} int cna_read */
 
 static int cna_config (oconfig_item_t *ci) { /* {{{ */
-	int i;
 	oconfig_item_t *item;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		item = ci->children + i;
 
 		if (strcasecmp(item->key, "Host") == 0)
 		{
 			host_config_t *host;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/netlink.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/netlink.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/netlink.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/netlink.c	2016-09-11 16:10:25.267038716 +0800
@@ -23,17 +23,17 @@
  *   Sebastian Harl <sh at tokkee.org>
  *   Andreas Henriksson <andreas at fatal.se>
  *   Marc Fournier <marc.fournier at camptocamp.com>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
 
 #include <asm/types.h>
-#include <sys/socket.h>
 
 #include <linux/netlink.h>
 #include <linux/rtnetlink.h>
 #if HAVE_LINUX_GEN_STATS_H
 # include <linux/gen_stats.h>
 #endif
@@ -107,18 +107,16 @@
 
 static int add_ignorelist (const char *dev, const char *type,
     const char *inst)
 {
   ir_ignorelist_t *entry;
 
-  entry = (ir_ignorelist_t *) malloc (sizeof (ir_ignorelist_t));
+  entry = calloc (1, sizeof (*entry));
   if (entry == NULL)
     return (-1);
 
-  memset (entry, '\0', sizeof (ir_ignorelist_t));
-
   if (strcasecmp (dev, "All") != 0)
   {
     entry->device = strdup (dev);
     if (entry->device == NULL)
     {
       sfree (entry);
@@ -156,20 +154,18 @@
  * Checks wether a data set should be ignored. Returns `true' is the value
  * should be ignored, `false' otherwise.
  */
 static int check_ignorelist (const char *dev,
     const char *type, const char *type_instance)
 {
-  ir_ignorelist_t *i;
-
   assert ((dev != NULL) && (type != NULL));
 
   if (ir_ignorelist_head == NULL)
     return (ir_ignorelist_invert ? 0 : 1);
 
-  for (i = ir_ignorelist_head; i != NULL; i = i->next)
+  for (ir_ignorelist_t *i = ir_ignorelist_head; i != NULL; i = i->next)
   {
     /* i->device == NULL  =>  match all devices */
     if ((i->device != NULL)
         && (strcasecmp (i->device, dev) != 0))
       continue;
 
@@ -244,13 +240,13 @@
   /* Update the `iflist'. It's used to know which interfaces exist and query
    * them later for qdiscs and classes. */
   if ((msg->ifi_index >= 0) && ((size_t) msg->ifi_index >= iflist_len))
   {
     char **temp;
 
-    temp = (char **) realloc (iflist, (msg->ifi_index + 1) * sizeof (char *));
+    temp = realloc (iflist, (msg->ifi_index + 1) * sizeof (char *));
     if (temp == NULL)
     {
       ERROR ("netlink plugin: update_iflist: realloc failed.");
       return (-1);
     }
 
@@ -468,13 +464,13 @@
   int wanted_ifindex = *((int *) args);
 
   const char *dev;
   const char *kind = NULL;
 
   /* char *type_instance; */
-  char *tc_type;
+  const char *tc_type;
   char tc_inst[DATA_MAX_NAME_LEN];
 
   _Bool stats_submitted = 0;
 
   if (nlh->nlmsg_type == RTM_NEWQDISC)
     tc_type = "qdisc";
@@ -724,14 +720,12 @@
   char buf[MNL_SOCKET_BUFFER_SIZE];
   struct nlmsghdr *nlh;
   struct rtgenmsg *rt;
   int ret;
   unsigned int seq, portid;
 
-  size_t ifindex;
-
   static const int type_id[] = { RTM_GETQDISC, RTM_GETTCLASS, RTM_GETTFILTER };
   static const char *type_name[] = { "qdisc", "class", "filter" };
 
   portid = mnl_socket_get_portid (nl);
 
   nlh = mnl_nlmsg_put_header (buf);
@@ -760,21 +754,20 @@
     ERROR ("netlink plugin: ir_read: mnl_socket_recvfrom failed.");
     return (-1);
   }
 
   /* `link_filter_cb' will update `iflist' which is used here to iterate
    * over all interfaces. */
-  for (ifindex = 1; ifindex < iflist_len; ifindex++)
+  for (size_t ifindex = 1; ifindex < iflist_len; ifindex++)
   {
     struct tcmsg *tm;
-    size_t type_index;
 
     if (iflist[ifindex] == NULL)
       continue;
 
-    for (type_index = 0; type_index < STATIC_ARRAY_SIZE (type_id); type_index++)
+    for (size_t type_index = 0; type_index < STATIC_ARRAY_SIZE (type_id); type_index++)
     {
       if (check_ignorelist (iflist[ifindex], type_name[type_index], NULL))
       {
         DEBUG ("netlink plugin: ir_read: check_ignorelist (%s, %s, (nil)) "
             "== TRUE", iflist[ifindex], type_name[type_index]);
         continue;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/network.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/network.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/network.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/network.c	2016-09-11 16:10:25.267038716 +0800
@@ -23,28 +23,21 @@
  **/
 
 #define _DEFAULT_SOURCE
 #define _BSD_SOURCE /* For struct ip_mreq */
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "utils_fbhash.h"
-#include "utils_avltree.h"
 #include "utils_cache.h"
 #include "utils_complain.h"
 
 #include "network.h"
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NETDB_H
 # include <netdb.h>
 #endif
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
@@ -56,13 +49,12 @@
 #endif
 #if HAVE_NET_IF_H
 # include <net/if.h>
 #endif
 
 #if HAVE_LIBGCRYPT
-# include <pthread.h>
 # if defined __APPLE__
 /* default xcode compiler throws warnings even when deprecated functionality
  * is not used. -Werror breaks the build because of erroneous warnings.
  * http://stackoverflow.com/questions/10556299/compiler-warnings-with-libgcrypt-v1-5-0/12830209#12830209
  */
 #  pragma GCC diagnostic ignored "-Wdeprecated-declarations"
@@ -280,14 +272,14 @@
 /*
  * Private variables
  */
 static int network_config_ttl = 0;
 /* Ethernet - (IPv6 + UDP) = 1500 - (40 + 8) = 1452 */
 static size_t network_config_packet_size = 1452;
-static int network_config_forward = 0;
-static int network_config_stats = 0;
+static _Bool network_config_forward = 0;
+static _Bool network_config_stats = 0;
 
 static sockent_t *sending_sockets = NULL;
 
 static receive_list_entry_t *receive_list_head = NULL;
 static receive_list_entry_t *receive_list_tail = NULL;
 static pthread_mutex_t       receive_list_lock = PTHREAD_MUTEX_INITIALIZER;
@@ -307,12 +299,13 @@
 static pthread_t dispatch_thread_id;
 
 /* Buffer in which to-be-sent network packets are constructed. */
 static char            *send_buffer;
 static char            *send_buffer_ptr;
 static int              send_buffer_fill;
+static cdtime_t         send_buffer_last_update;
 static value_list_t     send_buffer_vl = VALUE_LIST_STATIC;
 static pthread_mutex_t  send_buffer_lock = PTHREAD_MUTEX_INITIALIZER;
 
 /* XXX: These counters are incremented from one place only. The spot in which
  * the values are incremented is either only reachable by one thread (the
  * dispatch thread, for example) or locked by some lock (send_buffer_lock for
@@ -350,13 +343,13 @@
 
 static _Bool check_send_okay (const value_list_t *vl) /* {{{ */
 {
   _Bool received = 0;
   int status;
 
-  if (network_config_forward != 0)
+  if (network_config_forward)
     return (1);
 
   if (vl->meta == NULL)
     return (1);
 
   status = meta_data_get_boolean (vl->meta, "network:received", &received);
@@ -373,15 +366,13 @@
    * network plugin. */
   return (!received);
 } /* }}} _Bool check_send_okay */
 
 static _Bool check_notify_received (const notification_t *n) /* {{{ */
 {
-  notification_meta_t *ptr;
-
-  for (ptr = n->meta; ptr != NULL; ptr = ptr->next)
+  for (notification_meta_t *ptr = n->meta; ptr != NULL; ptr = ptr->next)
     if ((strcmp ("network:received", ptr->name) == 0)
         && (ptr->type == NM_TYPE_BOOLEAN))
       return ((_Bool) ptr->nm_value.nm_boolean);
 
   return (0);
 } /* }}} _Bool check_notify_received */
@@ -413,16 +404,16 @@
 
 static int network_dispatch_values (value_list_t *vl, /* {{{ */
     const char *username)
 {
   int status;
 
-  if ((vl->time <= 0)
-      || (strlen (vl->host) <= 0)
-      || (strlen (vl->plugin) <= 0)
-      || (strlen (vl->type) <= 0))
+  if ((vl->time == 0)
+      || (strlen (vl->host) == 0)
+      || (strlen (vl->plugin) == 0)
+      || (strlen (vl->type) == 0))
     return (-EINVAL);
 
   if (!check_receive_okay (vl))
   {
 #if COLLECT_DEBUG
     char name[6*DATA_MAX_NAME_LEN];
@@ -610,56 +601,55 @@
   }
 
   return (*cyper_ptr);
 } /* }}} int network_get_aes256_cypher */
 #endif /* HAVE_LIBGCRYPT */
 
-static int write_part_values (char **ret_buffer, int *ret_buffer_len,
+static int write_part_values (char **ret_buffer, size_t *ret_buffer_len,
 		const data_set_t *ds, const value_list_t *vl)
 {
 	char *packet_ptr;
-	int packet_len;
+	size_t packet_len;
 	int num_values;
 
 	part_header_t pkg_ph;
 	uint16_t      pkg_num_values;
 	uint8_t      *pkg_values_types;
 	value_t      *pkg_values;
 
-	int offset;
-	int i;
+	size_t offset;
 
 	num_values = vl->values_len;
 	packet_len = sizeof (part_header_t) + sizeof (uint16_t)
 		+ (num_values * sizeof (uint8_t))
 		+ (num_values * sizeof (value_t));
 
 	if (*ret_buffer_len < packet_len)
 		return (-1);
 
-	pkg_values_types = (uint8_t *) malloc (num_values * sizeof (uint8_t));
+	pkg_values_types = malloc (num_values * sizeof (*pkg_values_types));
 	if (pkg_values_types == NULL)
 	{
 		ERROR ("network plugin: write_part_values: malloc failed.");
 		return (-1);
 	}
 
-	pkg_values = (value_t *) malloc (num_values * sizeof (value_t));
+	pkg_values = malloc (num_values * sizeof (*pkg_values));
 	if (pkg_values == NULL)
 	{
 		free (pkg_values_types);
 		ERROR ("network plugin: write_part_values: malloc failed.");
 		return (-1);
 	}
 
 	pkg_ph.type = htons (TYPE_VALUES);
 	pkg_ph.length = htons (packet_len);
 
 	pkg_num_values = htons ((uint16_t) vl->values_len);
 
-	for (i = 0; i < num_values; i++)
+	for (int i = 0; i < num_values; i++)
 	{
 		pkg_values_types[i] = (uint8_t) ds->ds[i].type;
 		switch (ds->ds[i].type)
 		{
 			case DS_TYPE_COUNTER:
 				pkg_values[i].counter = htonll (vl->values[i].counter);
@@ -711,22 +701,22 @@
 	free (pkg_values_types);
 	free (pkg_values);
 
 	return (0);
 } /* int write_part_values */
 
-static int write_part_number (char **ret_buffer, int *ret_buffer_len,
+static int write_part_number (char **ret_buffer, size_t *ret_buffer_len,
 		int type, uint64_t value)
 {
 	char *packet_ptr;
-	int packet_len;
+	size_t packet_len;
 
 	part_header_t pkg_head;
 	uint64_t pkg_value;
 
-	int offset;
+	size_t offset;
 
 	packet_len = sizeof (pkg_head) + sizeof (pkg_value);
 
 	if (*ret_buffer_len < packet_len)
 		return (-1);
 
@@ -746,22 +736,22 @@
 	*ret_buffer = packet_ptr + packet_len;
 	*ret_buffer_len -= packet_len;
 
 	return (0);
 } /* int write_part_number */
 
-static int write_part_string (char **ret_buffer, int *ret_buffer_len,
-		int type, const char *str, int str_len)
+static int write_part_string (char **ret_buffer, size_t *ret_buffer_len,
+		int type, const char *str, size_t str_len)
 {
 	char *buffer;
-	int buffer_len;
+	size_t buffer_len;
 
 	uint16_t pkg_type;
 	uint16_t pkg_length;
 
-	int offset;
+	size_t offset;
 
 	buffer_len = 2 * sizeof (uint16_t) + str_len + 1;
 	if (*ret_buffer_len < buffer_len)
 		return (-1);
 
 	pkg_type = htons (type);
@@ -784,24 +774,23 @@
 	*ret_buffer_len -= buffer_len;
 
 	return (0);
 } /* int write_part_string */
 
 static int parse_part_values (void **ret_buffer, size_t *ret_buffer_len,
-		value_t **ret_values, int *ret_num_values)
+		value_t **ret_values, size_t *ret_num_values)
 {
 	char *buffer = *ret_buffer;
 	size_t buffer_len = *ret_buffer_len;
 
 	uint16_t tmp16;
 	size_t exp_size;
-	int   i;
 
 	uint16_t pkg_length;
 	uint16_t pkg_type;
-	uint16_t pkg_numval;
+	size_t pkg_numval;
 
 	uint8_t *pkg_types;
 	value_t *pkg_values;
 
 	if (buffer_len < 15)
 	{
@@ -817,13 +806,13 @@
 	memcpy ((void *) &tmp16, buffer, sizeof (tmp16));
 	buffer += sizeof (tmp16);
 	pkg_length = ntohs (tmp16);
 
 	memcpy ((void *) &tmp16, buffer, sizeof (tmp16));
 	buffer += sizeof (tmp16);
-	pkg_numval = ntohs (tmp16);
+	pkg_numval = (size_t) ntohs (tmp16);
 
 	assert (pkg_type == TYPE_VALUES);
 
 	exp_size = 3 * sizeof (uint16_t)
 		+ pkg_numval * (sizeof (uint8_t) + sizeof (value_t));
 	if (buffer_len < exp_size)
@@ -832,37 +821,38 @@
 				"Packet too short: "
 				"Chunk of size %zu expected, "
 				"but buffer has only %zu bytes left.",
 				exp_size, buffer_len);
 		return (-1);
 	}
+	assert (pkg_numval <= ((buffer_len - 6) / 9));
 
 	if (pkg_length != exp_size)
 	{
 		WARNING ("network plugin: parse_part_values: "
 				"Length and number of values "
 				"in the packet don't match.");
 		return (-1);
 	}
 
-	pkg_types = (uint8_t *) malloc (pkg_numval * sizeof (uint8_t));
-	pkg_values = (value_t *) malloc (pkg_numval * sizeof (value_t));
+	pkg_types = calloc (pkg_numval, sizeof (*pkg_types));
+	pkg_values = calloc (pkg_numval, sizeof (*pkg_values));
 	if ((pkg_types == NULL) || (pkg_values == NULL))
 	{
 		sfree (pkg_types);
 		sfree (pkg_values);
-		ERROR ("network plugin: parse_part_values: malloc failed.");
+		ERROR ("network plugin: parse_part_values: calloc failed.");
 		return (-1);
 	}
 
-	memcpy ((void *) pkg_types, (void *) buffer, pkg_numval * sizeof (uint8_t));
-	buffer += pkg_numval * sizeof (uint8_t);
-	memcpy ((void *) pkg_values, (void *) buffer, pkg_numval * sizeof (value_t));
-	buffer += pkg_numval * sizeof (value_t);
+	memcpy (pkg_types, buffer, pkg_numval * sizeof (*pkg_types));
+	buffer += pkg_numval * sizeof (*pkg_types);
+	memcpy (pkg_values, buffer, pkg_numval * sizeof (*pkg_values));
+	buffer += pkg_numval * sizeof (*pkg_values);
 
-	for (i = 0; i < pkg_numval; i++)
+	for (size_t i = 0; i < pkg_numval; i++)
 	{
 		switch (pkg_types[i])
 		{
 		  case DS_TYPE_COUNTER:
 		    pkg_values[i].counter = (counter_t) ntohll (pkg_values[i].counter);
 		    break;
@@ -948,13 +938,13 @@
 	uint16_t tmp16;
 	size_t const header_size = 2 * sizeof (uint16_t);
 
 	uint16_t pkg_length;
 	size_t payload_size;
 
-	if (output_len <= 0)
+	if (output_len == 0)
 		return (EINVAL);
 
 	if (buffer_len < header_size)
 	{
 		WARNING ("network plugin: parse_part_string: "
 				"Packet too short: "
@@ -1155,13 +1145,13 @@
   gcry_md_close (hd);
   hd = NULL;
 
   if (memcmp (pss.hash, hash, sizeof (pss.hash)) != 0)
   {
     WARNING ("network plugin: Verifying HMAC-SHA-256 signature failed: "
-        "Hash mismatch.");
+        "Hash mismatch. Username: %s", pss.username);
   }
   else
   {
     parse_packet (se, buffer + buffer_offset, buffer_len - buffer_offset,
         flags | PP_SIGNED, pss.username);
   }
@@ -1231,13 +1221,13 @@
   size_t buffer_len = *ret_buffer_len;
   size_t payload_len;
   size_t part_size;
   size_t buffer_offset;
   uint16_t username_len;
   part_encryption_aes256_t pea;
-  unsigned char hash[sizeof (pea.hash)];
+  unsigned char hash[sizeof (pea.hash)] = { 0 };
 
   gcry_cipher_hd_t cypher;
   gcry_error_t err;
 
   /* Make sure at least the header if available. */
   if (buffer_len <= PART_ENCRYPTION_AES256_SIZE)
@@ -1264,13 +1254,13 @@
   }
 
   /* Read the username */
   BUFFER_READ (&username_len, sizeof (username_len));
   username_len = ntohs (username_len);
 
-  if ((username_len <= 0)
+  if ((username_len == 0)
       || (username_len > (part_size - (PART_ENCRYPTION_AES256_SIZE + 1))))
   {
     NOTICE ("network plugin: parse_part_encr_aes256: "
         "Discarding part with invalid username length.");
     return (-1);
   }
@@ -1290,12 +1280,13 @@
         PART_ENCRYPTION_AES256_SIZE - sizeof (pea.hash)));
 
   cypher = network_get_aes256_cypher (se, pea.iv, sizeof (pea.iv),
       pea.username);
   if (cypher == NULL)
   {
+    ERROR ("network plugin: Failed to get cypher. Username: %s", pea.username);
     sfree (pea.username);
     return (-1);
   }
 
   payload_len = part_size - (PART_ENCRYPTION_AES256_SIZE + username_len);
   assert (payload_len > 0);
@@ -1305,32 +1296,31 @@
       buffer    + buffer_offset,
       part_size - buffer_offset,
       /* in = */ NULL, /* in len = */ 0);
   if (err != 0)
   {
     sfree (pea.username);
-    ERROR ("network plugin: gcry_cipher_decrypt returned: %s",
-        gcry_strerror (err));
+    ERROR ("network plugin: gcry_cipher_decrypt returned: %s. Username: %s",
+        gcry_strerror (err), pea.username);
     return (-1);
   }
 
   /* Read the hash */
   BUFFER_READ (pea.hash, sizeof (pea.hash));
 
   /* Make sure we're at the right position - again */
   assert (buffer_offset == (username_len + PART_ENCRYPTION_AES256_SIZE));
   assert (buffer_offset == (part_size - payload_len));
 
   /* Check hash sum */
-  memset (hash, 0, sizeof (hash));
   gcry_md_hash_buffer (GCRY_MD_SHA1, hash,
       buffer + buffer_offset, payload_len);
   if (memcmp (hash, pea.hash, sizeof (hash)) != 0)
   {
+    ERROR ("network plugin: Checksum mismatch. Username: %s", pea.username);
     sfree (pea.username);
-    ERROR ("network plugin: Decryption failed: Checksum mismatch.");
     return (-1);
   }
 
   parse_packet (se, buffer + buffer_offset, payload_len,
       flags | PP_ENCRYPTED, pea.username);
 
@@ -1383,13 +1373,13 @@
     WARNING ("network plugin: Received encrypted packet, but the network "
         "plugin was not linked with libgcrypt, so I cannot "
         "decrypt it. The part will be discarded.");
     warning_has_been_printed = 1;
   }
 
-  *ret_buffer += ph_length;
+  *ret_buffer = (void *) (((char *) *ret_buffer) + ph_length);
   *ret_buffer_size -= ph_length;
 
   return (0);
 } /* }}} int parse_part_encr_aes256 */
 #endif /* !HAVE_LIBGCRYPT */
 
@@ -1399,36 +1389,35 @@
 		void *buffer, size_t buffer_size, int flags,
 		const char *username)
 {
 	int status;
 
 	value_list_t vl = VALUE_LIST_INIT;
-	notification_t n;
+	notification_t n = { 0 };
 
 #if HAVE_LIBGCRYPT
 	int packet_was_signed = (flags & PP_SIGNED);
         int packet_was_encrypted = (flags & PP_ENCRYPTED);
 	int printed_ignore_warning = 0;
 #endif /* HAVE_LIBGCRYPT */
 
 
 	memset (&vl, '\0', sizeof (vl));
-	memset (&n, '\0', sizeof (n));
 	status = 0;
 
 	while ((status == 0) && (0 < buffer_size)
 			&& ((unsigned int) buffer_size > sizeof (part_header_t)))
 	{
 		uint16_t pkg_length;
 		uint16_t pkg_type;
 
 		memcpy ((void *) &pkg_type,
 				(void *) buffer,
 				sizeof (pkg_type));
 		memcpy ((void *) &pkg_length,
-				(void *) (buffer + sizeof (pkg_type)),
+				(void *) (((char *) buffer) + sizeof (pkg_type)),
 				sizeof (pkg_length));
 
 		pkg_length = ntohs (pkg_length);
 		pkg_type = ntohs (pkg_type);
 
 		if (pkg_length > buffer_size)
@@ -1597,19 +1586,19 @@
 			{
 				INFO ("network plugin: "
 						"Ignoring notification with "
 						"unknown severity %i.",
 						n.severity);
 			}
-			else if (n.time <= 0)
+			else if (n.time == 0)
 			{
 				INFO ("network plugin: "
 						"Ignoring notification with "
 						"time == 0.");
 			}
-			else if (strlen (n.message) <= 0)
+			else if (strlen (n.message) == 0)
 			{
 				INFO ("network plugin: "
 						"Ignoring notification with "
 						"an empty message.");
 			}
 			else
@@ -1656,15 +1645,13 @@
     gcry_cipher_close (sec->cypher);
 #endif
 } /* }}} void free_sockent_client */
 
 static void free_sockent_server (struct sockent_server *ses) /* {{{ */
 {
-  size_t i;
-
-  for (i = 0; i < ses->fd_num; i++)
+  for (size_t i = 0; i < ses->fd_num; i++)
   {
     if (ses->fd[i] >= 0)
     {
       close (ses->fd[i]);
       ses->fd[i] = -1;
     }
@@ -1783,24 +1770,22 @@
 #if HAVE_STRUCT_IP_MREQN_IMR_IFINDEX
 			/* If possible, use the "ip_mreqn" structure which has
 			 * an "interface index" member. Using the interface
 			 * index is preferred here, because of its similarity
 			 * to the way IPv6 handles this. Unfortunately, it
 			 * appears not to be portable. */
-			struct ip_mreqn mreq;
-
-			memset (&mreq, 0, sizeof (mreq));
-			mreq.imr_multiaddr.s_addr = addr->sin_addr.s_addr;
-			mreq.imr_address.s_addr = ntohl (INADDR_ANY);
-			mreq.imr_ifindex = se->interface;
+			struct ip_mreqn mreq = {
+				.imr_multiaddr.s_addr = addr->sin_addr.s_addr,
+				.imr_address.s_addr = ntohl (INADDR_ANY),
+				.imr_ifindex = se->interface
+			};
 #else
-			struct ip_mreq mreq;
-
-			memset (&mreq, 0, sizeof (mreq));
-			mreq.imr_multiaddr.s_addr = addr->sin_addr.s_addr;
-			mreq.imr_interface.s_addr = ntohl (INADDR_ANY);
+			struct ip_mreq mreq = {
+				.imr_multiaddr.s_addr = addr->sin_addr.s_addr,
+				.imr_interface.s_addr = ntohl (INADDR_ANY)
+			};
 #endif
 
 			if (setsockopt (se->data.client.fd, IPPROTO_IP, IP_MULTICAST_IF,
 						&mreq, sizeof (mreq)) != 0)
 			{
 				char errbuf[1024];
@@ -2029,16 +2014,15 @@
 {
 	sockent_t *se;
 
 	if ((type != SOCKENT_TYPE_CLIENT) && (type != SOCKENT_TYPE_SERVER))
 		return (NULL);
 
-	se = malloc (sizeof (*se));
+	se = calloc (1, sizeof (*se));
 	if (se == NULL)
 		return (NULL);
-	memset (se, 0, sizeof (*se));
 
 	se->type = type;
 	se->node = NULL;
 	se->service = NULL;
 	se->interface = 0;
 	se->next = NULL;
@@ -2153,14 +2137,13 @@
 
 static int sockent_client_connect (sockent_t *se) /* {{{ */
 {
 	static c_complain_t complaint = C_COMPLAIN_INIT_STATIC;
 
 	struct sockent_client *client;
-	struct addrinfo  ai_hints;
-	struct addrinfo *ai_list = NULL, *ai_ptr;
+	struct addrinfo *ai_list;
 	int status;
 	_Bool reconnect = 0;
 	cdtime_t now;
 
 	if ((se == NULL) || (se->type != SOCKENT_TYPE_CLIENT))
 		return (EINVAL);
@@ -2174,19 +2157,18 @@
 		reconnect = 1;
 	}
 
 	if (client->fd >= 0 && !reconnect) /* already connected and not stale*/
 		return (0);
 
-	memset (&ai_hints, 0, sizeof (ai_hints));
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family   = AF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_DGRAM;
-	ai_hints.ai_protocol = IPPROTO_UDP;
+	struct addrinfo ai_hints = {
+		.ai_family   = AF_UNSPEC,
+		.ai_flags    = AI_ADDRCONFIG,
+		.ai_protocol = IPPROTO_UDP,
+		.ai_socktype = SOCK_DGRAM
+	};
 
 	status = getaddrinfo (se->node,
 			(se->service != NULL) ? se->service : NET_DEFAULT_PORT,
 			&ai_hints, &ai_list);
 	if (status != 0)
 	{
@@ -2201,13 +2183,13 @@
 	{
 		c_release (LOG_NOTICE, &complaint,
 				"network plugin: Successfully resolved \"%s\".",
 				se->node);
 	}
 
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		if (client->fd >= 0) /* when we reconnect */
 			sockent_client_disconnect(se);
 
 		client->fd = socket (ai_ptr->ai_family,
 				ai_ptr->ai_socktype,
@@ -2218,22 +2200,21 @@
 			ERROR ("network plugin: socket(2) failed: %s",
 					sstrerror (errno, errbuf,
 						sizeof (errbuf)));
 			continue;
 		}
 
-		client->addr = malloc (sizeof (*client->addr));
+		client->addr = calloc (1, sizeof (*client->addr));
 		if (client->addr == NULL)
 		{
-			ERROR ("network plugin: malloc failed.");
+			ERROR ("network plugin: calloc failed.");
 			close (client->fd);
 			client->fd = -1;
 			continue;
 		}
 
-		memset (client->addr, 0, sizeof (*client->addr));
 		assert (sizeof (*client->addr) >= ai_ptr->ai_addrlen);
 		memcpy (client->addr, ai_ptr->ai_addr, ai_ptr->ai_addrlen);
 		client->addrlen = ai_ptr->ai_addrlen;
 
 		network_set_ttl (se, ai_ptr);
 		network_set_interface (se, ai_ptr);
@@ -2252,14 +2233,13 @@
 	return (0);
 } /* }}} int sockent_client_connect */
 
 /* Open the file descriptors for a initialized sockent structure. */
 static int sockent_server_listen (sockent_t *se) /* {{{ */
 {
-	struct addrinfo  ai_hints;
-	struct addrinfo *ai_list, *ai_ptr;
+	struct addrinfo *ai_list;
 	int              status;
 
         const char *node;
         const char *service;
 
 	if (se == NULL)
@@ -2274,35 +2254,30 @@
         if (service == NULL)
           service = NET_DEFAULT_PORT;
 
         DEBUG ("network plugin: sockent_server_listen: node = %s; service = %s;",
             node, service);
 
-	memset (&ai_hints, 0, sizeof (ai_hints));
-	ai_hints.ai_flags  = 0;
-#ifdef AI_PASSIVE
-	ai_hints.ai_flags |= AI_PASSIVE;
-#endif
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family   = AF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_DGRAM;
-	ai_hints.ai_protocol = IPPROTO_UDP;
+	struct addrinfo ai_hints = {
+		.ai_family   = AF_UNSPEC,
+		.ai_flags    = AI_ADDRCONFIG | AI_PASSIVE,
+		.ai_protocol = IPPROTO_UDP,
+		.ai_socktype = SOCK_DGRAM
+	};
 
 	status = getaddrinfo (node, service, &ai_hints, &ai_list);
 	if (status != 0)
 	{
 		ERROR ("network plugin: getaddrinfo (%s, %s) failed: %s",
 				(se->node == NULL) ? "(null)" : se->node,
 				(se->service == NULL) ? "(null)" : se->service,
 				gai_strerror (status));
 		return (-1);
 	}
 
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		int *tmp;
 
 		tmp = realloc (se->data.server.fd,
 				sizeof (*tmp) * (se->data.server.fd_num + 1));
 		if (tmp == NULL)
@@ -2335,13 +2310,13 @@
 		se->data.server.fd_num++;
 		continue;
 	} /* for (ai_list) */
 
 	freeaddrinfo (ai_list);
 
-	if (se->data.server.fd_num <= 0)
+	if (se->data.server.fd_num == 0)
 		return (-1);
 	return (0);
 } /* }}} int sockent_server_listen */
 
 /* Add a sockent to the global list of sockets */
 static int sockent_add (sockent_t *se) /* {{{ */
@@ -2351,26 +2326,25 @@
 	if (se == NULL)
 		return (-1);
 
 	if (se->type == SOCKENT_TYPE_SERVER)
 	{
 		struct pollfd *tmp;
-		size_t i;
 
 		tmp = realloc (listen_sockets_pollfd,
 				sizeof (*tmp) * (listen_sockets_num
 					+ se->data.server.fd_num));
 		if (tmp == NULL)
 		{
 			ERROR ("network plugin: realloc failed.");
 			return (-1);
 		}
 		listen_sockets_pollfd = tmp;
 		tmp = listen_sockets_pollfd + listen_sockets_num;
 
-		for (i = 0; i < se->data.server.fd_num; i++)
+		for (size_t i = 0; i < se->data.server.fd_num; i++)
 		{
 			memset (tmp + i, 0, sizeof (*tmp));
 			tmp[i].fd = se->data.server.fd[i];
 			tmp[i].events = POLLIN | POLLPRI;
 			tmp[i].revents = 0;
 		}
@@ -2463,13 +2437,12 @@
 
 static int network_receive (void) /* {{{ */
 {
 	char buffer[network_config_packet_size];
 	int  buffer_len;
 
-	int i;
 	int status = 0;
 
 	receive_list_entry_t *private_list_head;
 	receive_list_entry_t *private_list_tail;
 	uint64_t              private_list_length;
 
@@ -2489,13 +2462,13 @@
 				continue;
 			ERROR ("network plugin: poll(2) failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			break;
 		}
 
-		for (i = 0; (i < listen_sockets_num) && (status > 0); i++)
+		for (size_t i = 0; (i < listen_sockets_num) && (status > 0); i++)
 		{
 			receive_list_entry_t *ent;
 
 			if ((listen_sockets_pollfd[i].revents
 						& (POLLIN | POLLPRI)) == 0)
 				continue;
@@ -2517,20 +2490,20 @@
 			stats_packets_rx++;
 
 			/* TODO: Possible performance enhancement: Do not free
 			 * these entries in the dispatch thread but put them in
 			 * another list, so we don't have to allocate more and
 			 * more of these structures. */
-			ent = malloc (sizeof (receive_list_entry_t));
+			ent = calloc (1, sizeof (*ent));
 			if (ent == NULL)
 			{
-				ERROR ("network plugin: malloc failed.");
+				ERROR ("network plugin: calloc failed.");
 				status = ENOMEM;
 				break;
 			}
-			memset (ent, 0, sizeof (receive_list_entry_t));
+
 			ent->data = malloc (network_config_packet_size);
 			if (ent->data == NULL)
 			{
 				sfree (ent);
 				ERROR ("network plugin: malloc failed.");
 				status = ENOMEM;
@@ -2604,17 +2577,18 @@
 
 static void network_init_buffer (void)
 {
 	memset (send_buffer, 0, network_config_packet_size);
 	send_buffer_ptr = send_buffer;
 	send_buffer_fill = 0;
+	send_buffer_last_update = 0;
 
 	memset (&send_buffer_vl, 0, sizeof (send_buffer_vl));
 } /* int network_init_buffer */
 
-static void networt_send_buffer_plain (sockent_t *se, /* {{{ */
+static void network_send_buffer_plain (sockent_t *se, /* {{{ */
 		const char *buffer, size_t buffer_size)
 {
 	int status;
 
 	while (42)
 	{
@@ -2638,24 +2612,23 @@
 			sockent_client_disconnect (se);
 			return;
 		}
 
 		break;
 	} /* while (42) */
-} /* }}} void networt_send_buffer_plain */
+} /* }}} void network_send_buffer_plain */
 
 #if HAVE_LIBGCRYPT
 #define BUFFER_ADD(p,s) do { \
   memcpy (buffer + buffer_offset, (p), (s)); \
   buffer_offset += (s); \
 } while (0)
 
-static void networt_send_buffer_signed (sockent_t *se, /* {{{ */
+static void network_send_buffer_signed (sockent_t *se, /* {{{ */
 		const char *in_buffer, size_t in_buffer_size)
 {
-  part_signature_sha256_t ps;
   char buffer[BUFF_SIG_SIZE + in_buffer_size];
   size_t buffer_offset;
   size_t username_len;
 
   gcry_md_hd_t hd;
   gcry_error_t err;
@@ -2691,15 +2664,16 @@
   memcpy (buffer + PART_SIGNATURE_SHA256_SIZE,
       se->data.client.username, username_len);
   memcpy (buffer + PART_SIGNATURE_SHA256_SIZE + username_len,
       in_buffer, in_buffer_size);
 
   /* Initialize the `ps' structure. */
-  memset (&ps, 0, sizeof (ps));
-  ps.head.type = htons (TYPE_SIGN_SHA256);
-  ps.head.length = htons (PART_SIGNATURE_SHA256_SIZE + username_len);
+  part_signature_sha256_t ps = {
+    .head.type = htons (TYPE_SIGN_SHA256),
+    .head.length = htons (PART_SIGNATURE_SHA256_SIZE + username_len)
+  };
 
   /* Calculate the hash value. */
   gcry_md_write (hd, buffer + PART_SIGNATURE_SHA256_SIZE,
       username_len + in_buffer_size);
   hash = gcry_md_read (hd, GCRY_MD_SHA256);
   if (hash == NULL)
@@ -2720,32 +2694,31 @@
   assert (buffer_offset == PART_SIGNATURE_SHA256_SIZE);
 
   gcry_md_close (hd);
   hd = NULL;
 
   buffer_offset = PART_SIGNATURE_SHA256_SIZE + username_len + in_buffer_size;
-  networt_send_buffer_plain (se, buffer, buffer_offset);
-} /* }}} void networt_send_buffer_signed */
+  network_send_buffer_plain (se, buffer, buffer_offset);
+} /* }}} void network_send_buffer_signed */
 
-static void networt_send_buffer_encrypted (sockent_t *se, /* {{{ */
+static void network_send_buffer_encrypted (sockent_t *se, /* {{{ */
 		const char *in_buffer, size_t in_buffer_size)
 {
-  part_encryption_aes256_t pea;
   char buffer[BUFF_SIG_SIZE + in_buffer_size];
   size_t buffer_size;
   size_t buffer_offset;
   size_t header_size;
   size_t username_len;
   gcry_error_t err;
   gcry_cipher_hd_t cypher;
 
   /* Initialize the header fields */
-  memset (&pea, 0, sizeof (pea));
-  pea.head.type = htons (TYPE_ENCR_AES256);
-
-  pea.username = se->data.client.username;
+  part_encryption_aes256_t pea = {
+    .head.type = htons (TYPE_ENCR_AES256),
+    .username = se->data.client.username
+  };
 
   username_len = strlen (pea.username);
   if ((PART_ENCRYPTION_AES256_SIZE + username_len) > BUFF_SIG_SIZE)
   {
     ERROR ("network plugin: Username too long: %s", pea.username);
     return;
@@ -2753,13 +2726,13 @@
 
   buffer_size = PART_ENCRYPTION_AES256_SIZE + username_len + in_buffer_size;
   header_size = PART_ENCRYPTION_AES256_SIZE + username_len
     - sizeof (pea.hash);
 
   assert (buffer_size <= sizeof (buffer));
-  DEBUG ("network plugin: networt_send_buffer_encrypted: "
+  DEBUG ("network plugin: network_send_buffer_encrypted: "
       "buffer_size = %zu;", buffer_size);
 
   pea.head.length = htons ((uint16_t) (PART_ENCRYPTION_AES256_SIZE
         + username_len + in_buffer_size));
   pea.username_length = htons ((uint16_t) username_len);
 
@@ -2800,37 +2773,35 @@
     ERROR ("network plugin: gcry_cipher_encrypt returned: %s",
         gcry_strerror (err));
     return;
   }
 
   /* Send it out without further modifications */
-  networt_send_buffer_plain (se, buffer, buffer_size);
-} /* }}} void networt_send_buffer_encrypted */
+  network_send_buffer_plain (se, buffer, buffer_size);
+} /* }}} void network_send_buffer_encrypted */
 #undef BUFFER_ADD
 #endif /* HAVE_LIBGCRYPT */
 
 static void network_send_buffer (char *buffer, size_t buffer_len) /* {{{ */
 {
-  sockent_t *se;
-
   DEBUG ("network plugin: network_send_buffer: buffer_len = %zu", buffer_len);
 
-  for (se = sending_sockets; se != NULL; se = se->next)
+  for (sockent_t *se = sending_sockets; se != NULL; se = se->next)
   {
 #if HAVE_LIBGCRYPT
     if (se->data.client.security_level == SECURITY_LEVEL_ENCRYPT)
-      networt_send_buffer_encrypted (se, buffer, buffer_len);
+      network_send_buffer_encrypted (se, buffer, buffer_len);
     else if (se->data.client.security_level == SECURITY_LEVEL_SIGN)
-      networt_send_buffer_signed (se, buffer, buffer_len);
+      network_send_buffer_signed (se, buffer, buffer_len);
     else /* if (se->data.client.security_level == SECURITY_LEVEL_NONE) */
 #endif /* HAVE_LIBGCRYPT */
-      networt_send_buffer_plain (se, buffer, buffer_len);
+      network_send_buffer_plain (se, buffer, buffer_len);
   } /* for (sending_sockets) */
 } /* }}} void network_send_buffer */
 
-static int add_to_buffer (char *buffer, int buffer_size, /* {{{ */
+static int add_to_buffer (char *buffer, size_t buffer_size, /* {{{ */
 		value_list_t *vl_def,
 		const data_set_t *ds, const value_list_t *vl)
 {
 	char *buffer_orig = buffer;
 
 	if (strcmp (vl_def->host, vl->host) != 0)
@@ -2948,12 +2919,13 @@
 			ds, vl);
 	if (status >= 0)
 	{
 		/* status == bytes added to the buffer */
 		send_buffer_fill += status;
 		send_buffer_ptr  += status;
+		send_buffer_last_update = cdtime();
 
 		stats_values_sent++;
 	}
 	else
 	{
 		flush_buffer ();
@@ -2984,133 +2956,55 @@
 
 	pthread_mutex_unlock (&send_buffer_lock);
 
 	return ((status < 0) ? -1 : 0);
 } /* int network_write */
 
-static int network_config_set_boolean (const oconfig_item_t *ci, /* {{{ */
-    int *retval)
-{
-  if ((ci->values_num != 1)
-      || ((ci->values[0].type != OCONFIG_TYPE_BOOLEAN)
-        && (ci->values[0].type != OCONFIG_TYPE_STRING)))
-  {
-    ERROR ("network plugin: The `%s' config option needs "
-        "exactly one boolean argument.", ci->key);
-    return (-1);
-  }
-
-  if (ci->values[0].type == OCONFIG_TYPE_BOOLEAN)
-  {
-    if (ci->values[0].value.boolean)
-      *retval = 1;
-    else
-      *retval = 0;
-  }
-  else
-  {
-    char *str = ci->values[0].value.string;
-
-    if (IS_TRUE (str))
-      *retval = 1;
-    else if (IS_FALSE (str))
-      *retval = 0;
-    else
-    {
-      ERROR ("network plugin: Cannot parse string value `%s' of the `%s' "
-          "option as boolean value.",
-          str, ci->key);
-      return (-1);
-    }
-  }
-
-  return (0);
-} /* }}} int network_config_set_boolean */
-
 static int network_config_set_ttl (const oconfig_item_t *ci) /* {{{ */
 {
-  int tmp;
-  if ((ci->values_num != 1)
-      || (ci->values[0].type != OCONFIG_TYPE_NUMBER))
-  {
-    WARNING ("network plugin: The `TimeToLive' config option needs exactly "
-        "one numeric argument.");
-    return (-1);
-  }
+  int tmp = 0;
 
-  tmp = (int) ci->values[0].value.number;
-  if ((tmp > 0) && (tmp <= 255))
+  if (cf_util_get_int (ci, &tmp) != 0)
+    return (-1);
+  else if ((tmp > 0) && (tmp <= 255))
     network_config_ttl = tmp;
   else {
     WARNING ("network plugin: The `TimeToLive' must be between 1 and 255.");
     return (-1);
   }
 
   return (0);
 } /* }}} int network_config_set_ttl */
 
 static int network_config_set_interface (const oconfig_item_t *ci, /* {{{ */
     int *interface)
 {
-  if ((ci->values_num != 1)
-      || (ci->values[0].type != OCONFIG_TYPE_STRING))
-  {
-    WARNING ("network plugin: The `Interface' config option needs exactly "
-        "one string argument.");
-    return (-1);
-  }
+  char if_name[256];
 
-  if (interface == NULL)
+  if (cf_util_get_string_buffer (ci, if_name, sizeof (if_name)) != 0)
     return (-1);
 
-  *interface = if_nametoindex (ci->values[0].value.string);
-
+  *interface = if_nametoindex (if_name);
   return (0);
 } /* }}} int network_config_set_interface */
 
 static int network_config_set_buffer_size (const oconfig_item_t *ci) /* {{{ */
 {
-  int tmp;
-  if ((ci->values_num != 1)
-      || (ci->values[0].type != OCONFIG_TYPE_NUMBER))
-  {
-    WARNING ("network plugin: The `MaxPacketSize' config option needs exactly "
-        "one numeric argument.");
-    return (-1);
-  }
+  int tmp = 0;
 
-  tmp = (int) ci->values[0].value.number;
-  if ((tmp >= 1024) && (tmp <= 65535))
+  if (cf_util_get_int (ci, &tmp) != 0)
+    return (-1);
+  else if ((tmp >= 1024) && (tmp <= 65535))
     network_config_packet_size = tmp;
-
-  return (0);
-} /* }}} int network_config_set_buffer_size */
-
-#if HAVE_LIBGCRYPT
-static int network_config_set_string (const oconfig_item_t *ci, /* {{{ */
-    char **ret_string)
-{
-  char *tmp;
-  if ((ci->values_num != 1)
-      || (ci->values[0].type != OCONFIG_TYPE_STRING))
-  {
-    WARNING ("network plugin: The `%s' config option needs exactly "
-        "one string argument.", ci->key);
+  else {
+    WARNING ("network plugin: The `MaxPacketSize' must be between 1024 and 65535.");
     return (-1);
   }
 
-  tmp = strdup (ci->values[0].value.string);
-  if (tmp == NULL)
-    return (-1);
-
-  sfree (*ret_string);
-  *ret_string = tmp;
-
   return (0);
-} /* }}} int network_config_set_string */
-#endif /* HAVE_LIBGCRYPT */
+} /* }}} int network_config_set_buffer_size */
 
 #if HAVE_LIBGCRYPT
 static int network_config_set_security_level (oconfig_item_t *ci, /* {{{ */
     int *retval)
 {
   char *str;
@@ -3140,13 +3034,12 @@
 #endif /* HAVE_LIBGCRYPT */
 
 static int network_config_add_listen (const oconfig_item_t *ci) /* {{{ */
 {
   sockent_t *se;
   int status;
-  int i;
 
   if ((ci->values_num < 1) || (ci->values_num > 2)
       || (ci->values[0].type != OCONFIG_TYPE_STRING)
       || ((ci->values_num > 1) && (ci->values[1].type != OCONFIG_TYPE_STRING)))
   {
     ERROR ("network plugin: The `%s' config option needs "
@@ -3162,27 +3055,26 @@
   }
 
   se->node = strdup (ci->values[0].value.string);
   if (ci->values_num >= 2)
     se->service = strdup (ci->values[1].value.string);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
 #if HAVE_LIBGCRYPT
     if (strcasecmp ("AuthFile", child->key) == 0)
-      network_config_set_string (child, &se->data.server.auth_file);
+      cf_util_get_string (child, &se->data.server.auth_file);
     else if (strcasecmp ("SecurityLevel", child->key) == 0)
       network_config_set_security_level (child,
           &se->data.server.security_level);
     else
 #endif /* HAVE_LIBGCRYPT */
     if (strcasecmp ("Interface", child->key) == 0)
-      network_config_set_interface (child,
-          &se->interface);
+      network_config_set_interface (child, &se->interface);
     else
     {
       WARNING ("network plugin: Option `%s' is not allowed here.",
           child->key);
     }
   }
@@ -3207,13 +3099,13 @@
     return (-1);
   }
 
   status = sockent_server_listen (se);
   if (status != 0)
   {
-    ERROR ("network plugin: network_config_add_server: sockent_server_listen failed.");
+    ERROR ("network plugin: network_config_add_listen: sockent_server_listen failed.");
     sockent_destroy (se);
     return (-1);
   }
 
   status = sockent_add (se);
   if (status != 0)
@@ -3227,13 +3119,12 @@
 } /* }}} int network_config_add_listen */
 
 static int network_config_add_server (const oconfig_item_t *ci) /* {{{ */
 {
   sockent_t *se;
   int status;
-  int i;
 
   if ((ci->values_num < 1) || (ci->values_num > 2)
       || (ci->values[0].type != OCONFIG_TYPE_STRING)
       || ((ci->values_num > 1) && (ci->values[1].type != OCONFIG_TYPE_STRING)))
   {
     ERROR ("network plugin: The `%s' config option needs "
@@ -3249,31 +3140,30 @@
   }
 
   se->node = strdup (ci->values[0].value.string);
   if (ci->values_num >= 2)
     se->service = strdup (ci->values[1].value.string);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
 #if HAVE_LIBGCRYPT
     if (strcasecmp ("Username", child->key) == 0)
-      network_config_set_string (child, &se->data.client.username);
+      cf_util_get_string (child, &se->data.client.username);
     else if (strcasecmp ("Password", child->key) == 0)
-      network_config_set_string (child, &se->data.client.password);
+      cf_util_get_string (child, &se->data.client.password);
     else if (strcasecmp ("SecurityLevel", child->key) == 0)
       network_config_set_security_level (child,
           &se->data.client.security_level);
     else
 #endif /* HAVE_LIBGCRYPT */
     if (strcasecmp ("Interface", child->key) == 0)
-      network_config_set_interface (child,
-          &se->interface);
-		else if (strcasecmp ("ResolveInterval", child->key) == 0)
-			cf_util_get_cdtime(child, &se->data.client.resolve_interval);
+      network_config_set_interface (child, &se->interface);
+    else if (strcasecmp ("ResolveInterval", child->key) == 0)
+      cf_util_get_cdtime(child, &se->data.client.resolve_interval);
     else
     {
       WARNING ("network plugin: Option `%s' is not allowed here.",
           child->key);
     }
   }
@@ -3297,13 +3187,13 @@
     ERROR ("network plugin: network_config_add_server: sockent_init_crypto() failed.");
     sockent_destroy (se);
     return (-1);
   }
 
   /* No call to sockent_client_connect() here -- it is called from
-   * networt_send_buffer_plain(). */
+   * network_send_buffer_plain(). */
 
   status = sockent_add (se);
   if (status != 0)
   {
     ERROR ("network plugin: network_config_add_server: sockent_add failed.");
     sockent_destroy (se);
@@ -3312,23 +3202,21 @@
 
   return (0);
 } /* }}} int network_config_add_server */
 
 static int network_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
   /* The options need to be applied first */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("TimeToLive", child->key) == 0)
       network_config_set_ttl (child);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Listen", child->key) == 0)
       network_config_add_listen (child);
     else if (strcasecmp ("Server", child->key) == 0)
@@ -3336,15 +3224,15 @@
     else if (strcasecmp ("TimeToLive", child->key) == 0) {
       /* Handled earlier */
     }
     else if (strcasecmp ("MaxPacketSize", child->key) == 0)
       network_config_set_buffer_size (child);
     else if (strcasecmp ("Forward", child->key) == 0)
-      network_config_set_boolean (child, &network_config_forward);
+      cf_util_get_boolean (child, &network_config_forward);
     else if (strcasecmp ("ReportStats", child->key) == 0)
-      network_config_set_boolean (child, &network_config_stats);
+      cf_util_get_boolean (child, &network_config_stats);
     else
     {
       WARNING ("network plugin: Option `%s' is not allowed here.",
           child->key);
     }
   }
@@ -3352,16 +3240,16 @@
   return (0);
 } /* }}} int network_config */
 
 static int network_notification (const notification_t *n,
     user_data_t __attribute__((unused)) *user_data)
 {
-  char  buffer[network_config_packet_size];
-  char *buffer_ptr = buffer;
-  int   buffer_free = sizeof (buffer);
-  int   status;
+  char   buffer[network_config_packet_size];
+  char  *buffer_ptr = buffer;
+  size_t buffer_free = sizeof (buffer);
+  int    status;
 
   if (!check_send_notify_okay (n))
     return (0);
 
   memset (buffer, 0, sizeof (buffer));
 
@@ -3425,14 +3313,12 @@
 
   return (0);
 } /* int network_notification */
 
 static int network_shutdown (void)
 {
-	sockent_t *se;
-
 	listen_loop++;
 
 	/* Kill the listening thread */
 	if (receive_thread_running != 0)
 	{
 		INFO ("network plugin: Stopping receive thread.");
@@ -3457,13 +3343,13 @@
 
 	if (send_buffer_fill > 0)
 		flush_buffer ();
 
 	sfree (send_buffer);
 
-	for (se = sending_sockets; se != NULL; se = se->next)
+	for (sockent_t *se = sending_sockets; se != NULL; se = se->next)
 		sockent_client_disconnect (se);
 	sockent_destroy (sending_sockets);
 
 	plugin_unregister_config ("network");
 	plugin_unregister_init ("network");
 	plugin_unregister_write ("network");
@@ -3555,13 +3441,13 @@
 	/* Check if we were already initialized. If so, just return - there's
 	 * nothing more to do (for now, that is). */
 	if (have_init)
 		return (0);
 	have_init = 1;
 
-	if (network_config_stats != 0)
+	if (network_config_stats)
 		plugin_register_read ("network", network_stats_read);
 
 	plugin_register_shutdown ("network", network_shutdown);
 
 	send_buffer = malloc (network_config_packet_size);
 	if (send_buffer == NULL)
@@ -3633,21 +3519,31 @@
  * The flush option of the network plugin cannot flush individual identifiers.
  * All the values are added to a buffer and sent when the buffer is full, the
  * requested value may or may not be in there, it's not worth finding out. We
  * just send the buffer if `flush'  is called - if the requested value was in
  * there, good. If not, well, then there is nothing to flush.. -octo
  */
-static int network_flush (__attribute__((unused)) cdtime_t timeout,
+static int network_flush (cdtime_t timeout,
 		__attribute__((unused)) const char *identifier,
 		__attribute__((unused)) user_data_t *user_data)
 {
 	pthread_mutex_lock (&send_buffer_lock);
 
 	if (send_buffer_fill > 0)
-	  flush_buffer ();
-
+	{
+		if (timeout > 0)
+		{
+			cdtime_t now = cdtime ();
+			if ((send_buffer_last_update + timeout) > now)
+			{
+				pthread_mutex_unlock (&send_buffer_lock);
+				return (0);
+			}
+		}
+		flush_buffer ();
+	}
 	pthread_mutex_unlock (&send_buffer_lock);
 
 	return (0);
 } /* int network_flush */
 
 void module_register (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nfs.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nfs.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nfs.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nfs.c	2016-09-11 16:10:25.267038716 +0800
@@ -218,13 +219,13 @@
 
 static size_t nfs4_server40_procedures_names_num = STATIC_ARRAY_SIZE (nfs4_server40_procedures_names);
 
 static const char *nfs4_server41_procedures_names[] =
 {
 	"backchannel_ctl",
-	"bind_conn_to_session",	
+	"bind_conn_to_session",
 	"exchange_id",
 	"create_session",
 	"destroy_session",
 	"free_stateid",
 	"get_dir_delegation",
 	"getdeviceinfo",
@@ -342,25 +343,23 @@
 }
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_LIBKSTAT
 static int nfs_init (void)
 {
-	kstat_t *ksp_chain = NULL;
-
 	nfs2_ksp_client = NULL;
 	nfs2_ksp_server = NULL;
 	nfs3_ksp_client = NULL;
 	nfs3_ksp_server = NULL;
 	nfs4_ksp_client = NULL;
 	nfs4_ksp_server = NULL;
 
 	if (kc == NULL)
 		return (-1);
 
-	for (ksp_chain = kc->kc_chain; ksp_chain != NULL;
+	for (kstat_t *ksp_chain = kc->kc_chain; ksp_chain != NULL;
 			ksp_chain = ksp_chain->ks_next)
 	{
 		if (strncmp (ksp_chain->ks_module, "nfs", 3) != 0)
 			continue;
 		else if (strncmp (ksp_chain->ks_name, "rfsproccnt_v2", 13) == 0)
 			nfs2_ksp_server = ksp_chain;
@@ -382,42 +381,40 @@
 
 static void nfs_procedures_submit (const char *plugin_instance,
 		const char **type_instances,
 		value_t *values, size_t values_num)
 {
 	value_list_t vl = VALUE_LIST_INIT;
-	size_t i;
 
 	vl.values_len = 1;
 	sstrncpy (vl.host, hostname_g, sizeof (vl.host));
 	sstrncpy (vl.plugin, "nfs", sizeof (vl.plugin));
 	sstrncpy (vl.plugin_instance, plugin_instance,
 			sizeof (vl.plugin_instance));
 	sstrncpy (vl.type, "nfs_procedure", sizeof (vl.type));
 
-	for (i = 0; i < values_num; i++)
+	for (size_t i = 0; i < values_num; i++)
 	{
 		vl.values = values + i;
 		sstrncpy (vl.type_instance, type_instances[i],
 				sizeof (vl.type_instance));
 		plugin_dispatch_values (&vl);
 	}
 } /* void nfs_procedures_submit */
 
 #if KERNEL_LINUX
-static void nfs_submit_fields (int nfs_version, const char *instance, 
+static void nfs_submit_fields (int nfs_version, const char *instance,
 		char **fields, size_t fields_num, const char **proc_names)
 {
 	char plugin_instance[DATA_MAX_NAME_LEN];
 	value_t values[fields_num];
-	size_t i;
 
 	ssnprintf (plugin_instance, sizeof (plugin_instance), "v%i%s",
 			nfs_version, instance);
 
-	for (i = 0; i < fields_num; i++)
+	for (size_t i = 0; i < fields_num; i++)
 		(void) parse_value (fields[i], &values[i], DS_TYPE_DERIVE);
 
 	nfs_procedures_submit (plugin_instance, proc_names, values,
 			fields_num);
 }
 
@@ -431,25 +428,25 @@
 				"NFSv%i %s statistics. Expected %zu, got %zu.",
 				nfs_version, instance,
 				proc_names_num, fields_num);
 		return (EINVAL);
 	}
 
-	nfs_submit_fields (nfs_version, instance, fields, fields_num, 
+	nfs_submit_fields (nfs_version, instance, fields, fields_num,
 			proc_names);
 
 	return (0);
 }
 
-static int nfs_submit_nfs4_server (const char *instance, char **fields, 
+static int nfs_submit_nfs4_server (const char *instance, char **fields,
 		size_t fields_num)
 {
 	static int suppress_warning = 0;
 
 	if (fields_num != NFS4_SERVER40_NUM_PROC &&
-		fields_num != NFS4_SERVER41_NUM_PROC) 
+		fields_num != NFS4_SERVER41_NUM_PROC)
 	{
 		if (!suppress_warning)
 		{
 			WARNING ("nfs plugin: Unexpected number of fields for "
 					"NFSv4 %s statistics: %zu. ",
 					instance, fields_num);
@@ -463,29 +460,29 @@
 		else
 		{
 			return (EINVAL);
 		}
 	}
 
-        nfs_submit_fields (4, instance, fields, 
+        nfs_submit_fields (4, instance, fields,
 			nfs4_server40_procedures_names_num,
 			nfs4_server40_procedures_names);
 
 	if (fields_num >= NFS4_SERVER41_NUM_PROC)
 	{
 		fields += nfs4_server40_procedures_names_num;
 
-	        nfs_submit_fields (4, instance, fields, 
-				nfs4_server41_procedures_names_num, 
+	        nfs_submit_fields (4, instance, fields,
+				nfs4_server41_procedures_names_num,
 				nfs4_server41_procedures_names);
 	}
 
 	return (0);
 }
 
-static int nfs_submit_nfs4_client (const char *instance, char **fields, 
+static int nfs_submit_nfs4_client (const char *instance, char **fields,
 		size_t fields_num)
 {
 	size_t proc40_names_num, proc41_names_num;
 
 	static int suppress_warning = 0;
 
@@ -551,13 +548,13 @@
 				 nfs4_client41_procedures_names);
 	}
 
 	return (0);
 }
 
-static void nfs_read_linux (FILE *fh, char *inst)
+static void nfs_read_linux (FILE *fh, const char *inst)
 {
 	char buffer[1024];
 
 	char *fields[64];
 	int fields_num = 0;
 
@@ -586,41 +583,40 @@
 					nfs3_procedures_names,
 					nfs3_procedures_names_num);
 		}
 		else if (strcmp (fields[0], "proc4ops") == 0)
 		{
 			if (inst[0] == 's')
-				nfs_submit_nfs4_server (inst, fields + 2, 
+				nfs_submit_nfs4_server (inst, fields + 2,
 						(size_t) (fields_num - 2));
 		}
 		else if (strcmp (fields[0], "proc4") == 0)
 		{
 			if (inst[0] == 'c')
 				nfs_submit_nfs4_client (inst, fields + 2,
-						(size_t) (fields_num - 2));			
+						(size_t) (fields_num - 2));
 		}
 	} /* while (fgets) */
 } /* void nfs_read_linux */
 #endif /* KERNEL_LINUX */
 
 #if HAVE_LIBKSTAT
-static int nfs_read_kstat (kstat_t *ksp, int nfs_version, char *inst,
+static int nfs_read_kstat (kstat_t *ksp, int nfs_version, const char *inst,
 		char const **proc_names, size_t proc_names_num)
 {
 	char plugin_instance[DATA_MAX_NAME_LEN];
 	value_t values[proc_names_num];
-	size_t i;
 
 	if (ksp == NULL)
 		return (EINVAL);
 
 	ssnprintf (plugin_instance, sizeof (plugin_instance), "v%i%s",
 			nfs_version, inst);
 
 	kstat_read(kc, ksp, NULL);
-	for (i = 0; i < proc_names_num; i++)
+	for (size_t i = 0; i < proc_names_num; i++)
 	{
 		/* The name passed to kstat_data_lookup() doesn't have the
 		 * "const" modifier, so we need to copy the name here. */
 		char name[32];
 		sstrncpy (name, proc_names[i], sizeof (name));
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nginx.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nginx.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nginx.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nginx.c	2016-09-11 16:10:25.267038716 +0800
@@ -24,15 +24,15 @@
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  *   Sebastian Harl <sh at tokkee.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <curl/curl.h>
 
 static char *url         = NULL;
 static char *user        = NULL;
 static char *pass        = NULL;
@@ -68,13 +68,13 @@
   if ((nginx_buffer_len + len) >= sizeof (nginx_buffer))
   {
     assert (sizeof (nginx_buffer) > nginx_buffer_len);
     len = (sizeof (nginx_buffer) - 1) - nginx_buffer_len;
   }
 
-  if (len <= 0)
+  if (len == 0)
     return (len);
 
   memcpy (&nginx_buffer[nginx_buffer_len], buf, len);
   nginx_buffer_len += len;
   nginx_buffer[nginx_buffer_len] = 0;
 
@@ -185,21 +185,20 @@
   if (timeout != NULL)
   {
     curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS, atol(timeout));
   }
   else
   {
-    curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS,
-       CDTIME_T_TO_MS(plugin_get_interval()));
+    curl_easy_setopt (curl, CURLOPT_TIMEOUT_MS, (long) CDTIME_T_TO_MS(plugin_get_interval()));
   }
 #endif
 
   return (0);
 } /* void init */
 
-static void submit (char *type, char *inst, long long value)
+static void submit (const char *type, const char *inst, long long value)
 {
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
 
   if (strcmp (type, "nginx_connections") == 0)
     values[0].gauge = value;
@@ -222,14 +221,12 @@
 
   plugin_dispatch_values (&vl);
 } /* void submit */
 
 static int nginx_read (void)
 {
-  int i;
-
   char *ptr;
   char *lines[16];
   int   lines_num = 0;
   char *saveptr;
 
   char *fields[16];
@@ -261,13 +258,13 @@
   /*
    * Active connections: 291
    * server accepts handled requests
    *  16630948 16630948 31070465
    * Reading: 6 Writing: 179 Waiting: 106
    */
-  for (i = 0; i < lines_num; i++)
+  for (int i = 0; i < lines_num; i++)
   {
     fields_num = strsplit (lines[i], fields,
 	(sizeof (fields) / sizeof (fields[0])));
 
     if (fields_num == 3)
     {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/notify_desktop.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/notify_desktop.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/notify_desktop.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/notify_desktop.c	2016-09-11 16:10:25.267038716 +0800
@@ -26,15 +26,15 @@
 
 /*
  * This plugin sends desktop notifications to a notification daemon.
  */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include <glib.h>
 #include <libnotify/notify.h>
 
 #ifndef NOTIFY_CHECK_VERSION
 # define NOTIFY_CHECK_VERSION(x,y,z) 0
@@ -63,15 +63,13 @@
 		*timeout = DEFAULT_TIMEOUT;
 	return 0;
 } /* set_timeout */
 
 static int c_notify_config (oconfig_item_t *ci)
 {
-	int i = 0;
-
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "OkayTimeout"))
 			set_timeout (c, &okay_timeout);
 		else if (0 == strcasecmp (c->key, "WarningTimeout"))
 			set_timeout (c, &warn_timeout);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/notify_email.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/notify_email.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/notify_email.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/notify_email.c	2016-09-11 16:10:25.267038716 +0800
@@ -20,18 +20,18 @@
  * Authors:
  *   Oleg King <king2 at kaluga.ru>
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
 #include <auth-client.h>
 #include <libesmtp.h>
-#include <pthread.h>
 
 #define MAXSTRING               256
 
 static const char *config_keys[] =
 {
   "SMTPServer",
@@ -63,15 +63,14 @@
 #define DEFAULT_SMTP_FROM	"root@localhost"
 #define DEFAULT_SMTP_SUBJECT	"Collectd notify: %s@%s"
 
 /* Callback to get username and password */
 static int authinteract (auth_client_request_t request, char **result,
     int fields, void __attribute__((unused)) *arg)
-{               
-  int i;
-  for (i = 0; i < fields; i++)
+{
+  for (int i = 0; i < fields; i++)
   {
     if (request[i].flags & AUTH_USER)
       result[i] = smtp_user;
     else if (request[i].flags & AUTH_PASS)
       result[i] = smtp_password;
     else
@@ -142,13 +141,13 @@
     auth_set_interact_cb (authctx, authinteract, NULL);
   }
 
   if ( !smtp_auth_set_context (session, authctx)) {
     pthread_mutex_unlock (&session_lock);
     ERROR ("notify_email plugin: cannot set SMTP auth context");
-    return (-1);   
+    return (-1);
   }
 
   pthread_mutex_unlock (&session_lock);
   return (0);
 } /* int notify_email_init */
 
@@ -173,13 +172,13 @@
 static int notify_email_config (const char *key, const char *value)
 {
   if (strcasecmp (key, "Recipient") == 0)
   {
     char **tmp;
 
-    tmp = (char **) realloc ((void *) recipients, (recipients_len + 1) * sizeof (char *));
+    tmp = realloc (recipients, (recipients_len + 1) * sizeof (char *));
     if (tmp == NULL) {
       ERROR ("notify_email: realloc failed.");
       return (-1);
     }
 
     recipients = tmp;
@@ -279,13 +278,13 @@
     return (-1);
   }
 
   if (!(message = smtp_add_message (session))) {
     pthread_mutex_unlock (&session_lock);
     ERROR ("notify_email plugin: cannot set SMTP message");
-    return (-1);   
+    return (-1);
   }
   smtp_set_reverse_path (message, email_from);
   smtp_set_header (message, "To", NULL, NULL);
   smtp_set_message_str (message, buf);
 
   for (i = 0; i < recipients_len; i++)
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: notify_nagios.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ntpd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ntpd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ntpd.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ntpd.c	2016-09-11 16:10:25.267038716 +0800
@@ -25,25 +25,22 @@
  **/
 
 #define _DEFAULT_SOURCE
 #define _BSD_SOURCE /* For NI_MAXHOST */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #if HAVE_STDINT_H
 # include <stdint.h>
 #endif
 #if HAVE_NETDB_H
 # include <netdb.h>
 #endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
 #if HAVE_ARPA_INET_H
 # include <arpa/inet.h> /* inet_ntoa */
 #endif
@@ -51,12 +48,16 @@
 # include <netinet/tcp.h>
 #endif
 #if HAVE_POLL_H
 # include <poll.h>
 #endif
 
+#ifndef STA_NANO
+# define STA_NANO 0x2000
+#endif
+
 static const char *config_keys[] =
 {
 	"Host",
 	"Port",
 	"ReverseLookups",
 	"IncludeUnitID"
@@ -247,13 +248,13 @@
 	int32_t  calcnt;
 	int32_t  errcnt;
 	int32_t  stbcnt;
 };
 
 /* List of reference clock names */
-static char *refclock_names[] =
+static const char *refclock_names[] =
 {
 	"UNKNOWN",    "LOCAL",        "GPS_TRAK",   "WWV_PST",     /*  0- 3 */
 	"SPECTRACOM", "TRUETIME",     "IRIG_AUDIO", "CHU_AUDIO",   /*  4- 7 */
 	"GENERIC",    "GPS_MX4200",   "GPS_AS2201", "GPS_ARBITER", /*  8-11 */
 	"IRIG_TPRO",  "ATOM_LEITCH",  "MSF_EES",    "GPSTM_TRUE",  /* 12-15 */
 	"GPS_BANC",   "GPS_DATUM",    "ACTS_NIST",  "WWV_HEATH",   /* 16-19 */
@@ -262,13 +263,13 @@
 	"SHM",        "GPS_PALISADE", "GPS_ONCORE", "GPS_JUPITER", /* 28-31 */
 	"CHRONOLOG",  "DUMBCLOCK",    "ULINK_M320", "PCF",         /* 32-35 */
 	"WWV_AUDIO",  "GPS_FG",       "HOPF_S",     "HOPF_P",      /* 36-39 */
 	"JJY",        "TT_IRIG",      "GPS_ZYFER",  "GPS_RIPENCC", /* 40-43 */
 	"NEOCLK4X"                                                 /* 44    */
 };
-static int refclock_names_num = STATIC_ARRAY_SIZE (refclock_names);
+static size_t refclock_names_num = STATIC_ARRAY_SIZE (refclock_names);
 /* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
  * End of the copied stuff..                                         *
  * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */
 
 static int ntpd_config (const char *key, const char *value)
 {
@@ -307,13 +308,13 @@
 		return (-1);
 	}
 
 	return (0);
 }
 
-static void ntpd_submit (char *type, char *type_inst, gauge_t value)
+static void ntpd_submit (const char *type, const char *type_inst, gauge_t value)
 {
 	value_t values[1];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].gauge = value;
 
@@ -328,29 +329,27 @@
 	plugin_dispatch_values (&vl);
 }
 
 /* Each time a peer is polled, ntpd shifts the reach register to the left and
  * sets the LSB based on whether the peer was reachable. If the LSB is zero,
  * the values are out of date. */
-static void ntpd_submit_reach (char *type, char *type_inst, uint8_t reach,
-		gauge_t value)
+static void ntpd_submit_reach (const char *type, const char *type_inst,
+		uint8_t reach, gauge_t value)
 {
 	if (!(reach & 1))
 		value = NAN;
 
 	ntpd_submit (type, type_inst, value);
 }
 
 static int ntpd_connect (void)
 {
-	char *host;
-	char *port;
+	const char *host;
+	const char *port;
 
-	struct addrinfo  ai_hints;
 	struct addrinfo *ai_list;
-	struct addrinfo *ai_ptr;
 	int              status;
 
 	if (sock_descr >= 0)
 		return (sock_descr);
 
 	DEBUG ("Opening a new socket");
@@ -360,33 +359,31 @@
 		host = NTPD_DEFAULT_HOST;
 
 	port = ntpd_port;
 	if (strlen (port) == 0)
 		port = NTPD_DEFAULT_PORT;
 
-	memset (&ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_flags    = 0;
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags   |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family   = PF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_DGRAM;
-	ai_hints.ai_protocol = IPPROTO_UDP;
+	struct addrinfo ai_hints = {
+		.ai_family   = AF_UNSPEC,
+		.ai_flags    = AI_ADDRCONFIG,
+		.ai_protocol = IPPROTO_UDP,
+		.ai_socktype = SOCK_DGRAM
+	};
 
 	if ((status = getaddrinfo (host, port, &ai_hints, &ai_list)) != 0)
 	{
 		char errbuf[1024];
 		ERROR ("ntpd plugin: getaddrinfo (%s, %s): %s",
 				host, port,
 				(status == EAI_SYSTEM)
 				? sstrerror (errno, errbuf, sizeof (errbuf))
 				: gai_strerror (status));
 		return (-1);
 	}
 
-	for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		/* create our socket descriptor */
 		if ((sock_descr = socket (ai_ptr->ai_family,
 						ai_ptr->ai_socktype,
 						ai_ptr->ai_protocol)) < 0)
 			continue;
@@ -418,36 +415,34 @@
 {
 	int              sd;
 	struct pollfd    poll_s;
 	struct resp_pkt  res;
 	int              status;
 	int              done;
-	int              i;
 
 	char            *items;
 	size_t           items_num;
 
 	struct timeval   time_end;
 	struct timeval   time_now;
 	int              timeout;
 
-	int              pkt_item_num;        /* items in this packet */
-	int              pkt_item_len;        /* size of the items in this packet */
+	int              pkt_item_num;                /* items in this packet */
+	int              pkt_item_len;                /* size of the items in this packet */
 	int              pkt_sequence;
-	char             pkt_recvd[MAXSEQ+1]; /* sequence numbers that have been received */
-	int              pkt_recvd_num;       /* number of packets that have been received */
-	int              pkt_lastseq;         /* the last sequence number */
-	ssize_t          pkt_padding;         /* Padding in this packet */
+	char             pkt_recvd[MAXSEQ+1] = { 0 }; /* sequence numbers that have been received */
+	int              pkt_recvd_num;               /* number of packets that have been received */
+	int              pkt_lastseq;                 /* the last sequence number */
+	ssize_t          pkt_padding;                 /* Padding in this packet */
 
 	if ((sd = ntpd_connect ()) < 0)
 		return (-1);
 
 	items = NULL;
 	items_num = 0;
 
-	memset (pkt_recvd, '\0', sizeof (pkt_recvd));
 	pkt_recvd_num = 0;
 	pkt_lastseq   = -1;
 
 	*res_items = 0;
 	*res_size  = 0;
 	*res_data  = NULL;
@@ -505,13 +500,13 @@
 		if (status == 0) /* timeout */
 		{
 			DEBUG ("timeout reached.");
 			break;
 		}
 
-		memset ((void *) &res, '\0', sizeof (res));
+		memset (&res, '\0', sizeof (res));
 		status = recv (sd, (void *) &res, sizeof (res), 0 /* no flags */);
 
 		if ((status < 0) && ((errno == EAGAIN) || (errno == EINTR)))
 			continue;
 
 		if (status < 0)
@@ -663,23 +658,23 @@
 		/*
 		 * Enough with the checks. Copy the data now.
 		 * We start by allocating some more memory.
 		 */
 		DEBUG ("realloc (%p, %zu)", (void *) *res_data,
 				(items_num + pkt_item_num) * res_item_size);
-		items = realloc ((void *) *res_data,
+		items = realloc (*res_data,
 				(items_num + pkt_item_num) * res_item_size);
 		if (items == NULL)
 		{
 			ERROR ("ntpd plugin: realloc failed.");
 			continue;
 		}
 		items_num += pkt_item_num;
 		*res_data = items;
 
-		for (i = 0; i < pkt_item_num; i++)
+		for (int i = 0; i < pkt_item_num; i++)
 		{
 			/* dst: There are already `*res_items' items with
 			 *      res_item_size bytes each in in `*res_data'. Set
 			 *      dst to the first byte after that. */
 			void *dst = (void *) (*res_data + ((*res_items) * res_item_size));
 			/* src: We use `pkt_item_len' to calculate the offset
@@ -710,23 +705,22 @@
 } /* int ntpd_receive_response */
 
 /* For a description of the arguments see `ntpd_do_query' below. */
 static int ntpd_send_request (int req_code, int req_items, int req_size, char *req_data)
 {
 	int             sd;
-	struct req_pkt  req;
+	struct req_pkt  req = { 0 };
 	size_t          req_data_len;
 	int             status;
 
 	assert (req_items >= 0);
 	assert (req_size  >= 0);
 
 	if ((sd = ntpd_connect ()) < 0)
 		return (-1);
 
-	memset ((void *) &req, '\0', sizeof (req));
 	req.rm_vn_mode = RM_VN_MODE(0, 0, 0);
 	req.auth_seq   = AUTH_SEQ (0, 0);
 	req.implementation = IMPL_XNTPD;
 	req.request = (unsigned char) req_code;
 
 	req_data_len = (size_t) (req_items * req_size);
@@ -801,41 +795,37 @@
 	return (refclock_id);
 }
 
 static int ntpd_get_name_from_address (char *buffer, size_t buffer_size,
 		struct info_peer_summary const *peer_info, _Bool do_reverse_lookup)
 {
-	struct sockaddr_storage sa;
+	struct sockaddr_storage sa = { 0 };
 	socklen_t sa_len;
 	int flags = 0;
 	int status;
 
-	memset (&sa, 0, sizeof (sa));
-
 	if (peer_info->v6_flag)
 	{
-		struct sockaddr_in6 sa6;
+		struct sockaddr_in6 sa6 = { 0 };
 
 		assert (sizeof (sa) >= sizeof (sa6));
 
-		memset (&sa6, 0, sizeof (sa6));
 		sa6.sin6_family = AF_INET6;
 		sa6.sin6_port = htons (123);
 		memcpy (&sa6.sin6_addr, &peer_info->srcadr6,
 				sizeof (struct in6_addr));
 		sa_len = sizeof (sa6);
 
 		memcpy (&sa, &sa6, sizeof (sa6));
 	}
 	else
 	{
-		struct sockaddr_in sa4;
+		struct sockaddr_in sa4 = { 0 };
 
 		assert (sizeof (sa) >= sizeof (sa4));
 
-		memset (&sa4, 0, sizeof (sa4));
 		sa4.sin_family = AF_INET;
 		sa4.sin_port = htons (123);
 		memcpy (&sa4.sin_addr, &peer_info->srcadr,
 				sizeof (struct in_addr));
 		sa_len = sizeof (sa4);
 
@@ -865,13 +855,13 @@
 static int ntpd_get_name_refclock (char *buffer, size_t buffer_size,
 		struct info_peer_summary const *peer_info)
 {
 	uint32_t refclock_id = ntpd_get_refclock_id (peer_info);
 	uint32_t unit_id = ntohl (peer_info->srcadr) & 0x00FF;
 
-	if (refclock_id >= refclock_names_num)
+	if (((size_t) refclock_id) >= refclock_names_num)
 		return (ntpd_get_name_from_address (buffer, buffer_size,
 					peer_info,
 					/* do_reverse_lookup = */ 0));
 
 	if (include_unit_id)
 		ssnprintf (buffer, buffer_size, "%s-%"PRIu32,
@@ -907,17 +897,15 @@
 
 	gauge_t offset_loop;
 	gauge_t freq_loop;
 	gauge_t offset_error;
 
 	int status;
-	int i;
 
 	/* On Linux, if the STA_NANO bit is set in ik->status, then ik->offset
-	 * is is nanoseconds, otherwise it's microseconds.
-	 * TODO(octo): STA_NANO is defined in the Linux specific <sys/timex.h> header. */
+	 * is is nanoseconds, otherwise it's microseconds. */
 	double scale_loop  = 1e-6;
 	double scale_error = 1e-6;
 
 	ik      = NULL;
 	ik_num  = 0;
 	ik_size = 0;
@@ -936,12 +924,17 @@
 		ERROR ("ntpd plugin: ntpd_do_query returned unexpected data. "
 				"(ik = %p; ik_num = %i; ik_size = %i)",
 				(void *) ik, ik_num, ik_size);
 		return (-1);
 	}
 
+	if (ntohs(ik->status) & STA_NANO) {
+		scale_loop  = 1e-9;
+		scale_error = 1e-9;
+	}
+
 	/* kerninfo -> estimated error */
 	offset_loop  = scale_loop * ((gauge_t) ntohl (ik->offset));
 	freq_loop    = ntpd_read_fp (ik->freq);
 	offset_error = scale_error * ((gauge_t) ntohl (ik->esterror));
 
 	DEBUG ("info_kernel:\n"
@@ -971,13 +964,13 @@
 		ERROR ("ntpd plugin: ntpd_do_query returned unexpected data. "
 				"(ps = %p; ps_num = %i; ps_size = %i)",
 				(void *) ps, ps_num, ps_size);
 		return (-1);
 	}
 
-	for (i = 0; i < ps_num; i++)
+	for (int i = 0; i < ps_num; i++)
 	{
 		struct info_peer_summary *ptr;
 		double offset;
 
 		char peername[NI_MAXHOST];
 		uint32_t refclock_id;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/numa.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/numa.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/numa.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/numa.c	2016-09-11 16:10:25.267038716 +0800
@@ -127,17 +128,16 @@
 static int numa_init (void) /* {{{ */
 {
   /* Determine the number of nodes on this machine. */
   while (42)
   {
     char path[PATH_MAX];
-    struct stat statbuf;
+    struct stat statbuf = { 0 };
     int status;
 
     ssnprintf (path, sizeof (path), NUMA_ROOT_DIR "/node%i", max_node + 1);
-    memset (&statbuf, 0, sizeof (statbuf));
 
     status = stat (path, &statbuf);
     if (status == 0)
     {
       max_node++;
       continue;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nut.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nut.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/nut.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/nut.c	2016-09-11 16:10:25.267038716 +0800
@@ -22,16 +22,16 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
-#include <pthread.h>
 #include <upsclient.h>
 
 #if HAVE_UPSCONN_T
 typedef UPSCONN_t collectd_upsconn_t;
 #elif HAVE_UPSCONN
 typedef UPSCONN collectd_upsconn_t;
@@ -77,19 +77,18 @@
 {
   nut_ups_t *ups;
   int status;
 
   DEBUG ("nut plugin: nut_add_ups (name = %s);", name);
 
-  ups = (nut_ups_t *) malloc (sizeof (nut_ups_t));
+  ups = calloc (1, sizeof (*ups));
   if (ups == NULL)
   {
-    ERROR ("nut plugin: nut_add_ups: malloc failed.");
+    ERROR ("nut plugin: nut_add_ups: calloc failed.");
     return (1);
   }
-  memset (ups, '\0', sizeof (nut_ups_t));
 
   status = upscli_splitname (name, &ups->upsname, &ups->hostname,
       &ups->port);
   if (status != 0)
   {
     ERROR ("nut plugin: nut_add_ups: upscli_splitname (%s) failed.", name);
@@ -149,13 +148,13 @@
   unsigned int answer_num;
   int status;
 
   /* (Re-)Connect if we have no connection */
   if (ups->conn == NULL)
   {
-    ups->conn = (collectd_upsconn_t *) malloc (sizeof (collectd_upsconn_t));
+    ups->conn = malloc (sizeof (*ups->conn));
     if (ups->conn == NULL)
     {
       ERROR ("nut plugin: malloc failed.");
       return (-1);
     }
 
@@ -246,24 +245,23 @@
 
   return (0);
 } /* int nut_read_one */
 
 static int nut_read (void)
 {
-  nut_ups_t *ups;
   int success = 0;
 
   pthread_mutex_lock (&read_lock);
   success = read_busy;
   read_busy = 1;
   pthread_mutex_unlock (&read_lock);
 
   if (success != 0)
     return (0);
 
-  for (ups = upslist_head; ups != NULL; ups = ups->next)
+  for (nut_ups_t *ups = upslist_head; ups != NULL; ups = ups->next)
     if (nut_read_one (ups) == 0)
       success++;
 
   pthread_mutex_lock (&read_lock);
   read_busy = 0;
   pthread_mutex_unlock (&read_lock);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/olsrd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/olsrd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/olsrd.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/olsrd.c	2016-09-11 16:10:25.267038716 +0800
@@ -22,18 +22,18 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
 #include <sys/types.h>
 #include <netdb.h>
-#include <sys/socket.h>
 #include <netinet/in.h>
 #include <netinet/tcp.h>
 
 #define OLSRD_DEFAULT_NODE "localhost"
 #define OLSRD_DEFAULT_SERVICE "2006"
 
@@ -147,40 +147,36 @@
 
   return (i);
 } /* }}} size_t strtabsplit */
 
 static FILE *olsrd_connect (void) /* {{{ */
 {
-  struct addrinfo  ai_hints;
-  struct addrinfo *ai_list, *ai_ptr;
+  struct addrinfo *ai_list;
   int              ai_return;
 
   FILE *fh;
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags    = 0;
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags   |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family   = PF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_STREAM;
-  ai_hints.ai_protocol = IPPROTO_TCP;
+  struct addrinfo ai_hints = {
+    .ai_family   = AF_UNSPEC,
+    .ai_flags    = AI_ADDRCONFIG,
+    .ai_protocol = IPPROTO_TCP,
+    .ai_socktype = SOCK_STREAM
+  };
 
-  ai_list = NULL;
   ai_return = getaddrinfo (olsrd_get_node (), olsrd_get_service (),
       &ai_hints, &ai_list);
   if (ai_return != 0)
   {
     ERROR ("olsrd plugin: getaddrinfo (%s, %s) failed: %s",
         olsrd_get_node (), olsrd_get_service (),
         gai_strerror (ai_return));
     return (NULL);
   }
 
   fh = NULL;
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     int fd;
     int status;
     char errbuf[1024];
 
     fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype, ai_ptr->ai_protocol);
@@ -555,15 +551,14 @@
       lq_sum += lq;
       lq_num++;
     }
 
     if (config_want_topology == OLSRD_WANT_DETAIL)
     {
-      char type_instance[DATA_MAX_NAME_LEN];
+      char type_instance[DATA_MAX_NAME_LEN] = { 0 };
 
-      memset (type_instance, 0, sizeof (type_instance));
       ssnprintf (type_instance, sizeof (type_instance), "%s-%s-lq",
           fields[0], fields[1]);
       DEBUG ("olsrd plugin: type_instance = %s; lq = %g;", type_instance, lq);
       olsrd_submit (/* p.-inst = */ "topology", /* type = */ "signal_quality",
           type_instance, lq);
     }
@@ -579,15 +574,14 @@
     if ((errno != 0) || (endptr == fields[3]))
     {
       ERROR ("olsrd plugin: Unable to parse NLQ: %s", fields[3]);
     }
     else
     {
-      char type_instance[DATA_MAX_NAME_LEN];
+      char type_instance[DATA_MAX_NAME_LEN] = { 0 };
 
-      memset (type_instance, 0, sizeof (type_instance));
       ssnprintf (type_instance, sizeof (type_instance), "%s-%s-nlq",
           fields[0], fields[1]);
       DEBUG ("olsrd plugin: type_instance = %s; nlq = %g;", type_instance, nlq);
       olsrd_submit (/* p.-inst = */ "topology", /* type = */ "signal_quality",
           type_instance, nlq);
     }
@@ -609,24 +603,24 @@
 
   lineno = 0;
   while (fgets (buffer, sizeof (buffer), fh) != NULL)
   {
     /* An empty line ends the table. */
     buffer_len = strchomp (buffer);
-    if (buffer_len <= 0)
+    if (buffer_len == 0)
     {
       (*callback) (lineno, /* fields_num = */ 0, /* fields = */ NULL);
       break;
     }
 
     fields_num = strtabsplit (buffer, fields, STATIC_ARRAY_SIZE (fields));
 
     (*callback) (lineno, fields_num, fields);
     lineno++;
   } /* while (fgets) */
-  
+
   return (0);
 } /* }}} int olsrd_read_table */
 
 static int olsrd_config (const char *key, const char *value) /* {{{ */
 {
   if (strcasecmp ("Host", key) == 0)
@@ -661,15 +655,15 @@
   fputs ("\r\n", fh);
   fflush (fh);
 
   while (fgets (buffer, sizeof (buffer), fh) != NULL)
   {
     buffer_len = strchomp (buffer);
-    if (buffer_len <= 0)
+    if (buffer_len == 0)
       continue;
-    
+
     if (strcmp ("Table: Links", buffer) == 0)
       olsrd_read_table (fh, olsrd_cb_links);
     else if (strcmp ("Table: Neighbors", buffer) == 0)
       olsrd_read_table (fh, olsrd_cb_ignore);
     else if (strcmp ("Table: Topology", buffer) == 0)
       olsrd_read_table (fh, olsrd_cb_topology);
@@ -688,13 +682,13 @@
     {
       DEBUG ("olsrd plugin: Unable to handle line: %s", buffer);
     }
   } /* while (fgets) */
 
   fclose (fh);
-  
+
   return (0);
 } /* }}} int olsrd_read */
 
 static int olsrd_shutdown (void) /* {{{ */
 {
   sfree (config_node);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/onewire.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/onewire.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/onewire.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/onewire.c	2016-09-11 16:10:25.267038716 +0800
@@ -173,17 +174,17 @@
 }
 
 static int direct_list_insert(const char * config)
 {
     regmatch_t               pmatch[3];
     size_t                   nmatch = 3;
-    direct_access_element_t *element = NULL;
+    direct_access_element_t *element;
 
     DEBUG ("onewire plugin: direct_list_insert <%s>", config);
 
-    element = (direct_access_element_t *) malloc (sizeof(*element));
+    element = malloc (sizeof (*element));
     if (element == NULL)
     {
         ERROR ("onewire plugin: direct_list_insert - cannot allocate element");
         return 1;
     }
     element->path    = NULL;
@@ -335,13 +336,12 @@
 static int cow_read_values (const char *path, const char *name,
     const ow_family_features_t *family_info)
 {
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
   int success = 0;
-  size_t i;
 
   if (sensor_list != NULL)
   {
     DEBUG ("onewire plugin: Checking ignorelist for `%s'", name);
     if (ignorelist_match (sensor_list, name) != 0)
       return 0;
@@ -351,13 +351,13 @@
   vl.values_len = 1;
 
   sstrncpy (vl.host, hostname_g, sizeof (vl.host));
   sstrncpy (vl.plugin, "onewire", sizeof (vl.plugin));
   sstrncpy (vl.plugin_instance, name, sizeof (vl.plugin_instance));
 
-  for (i = 0; i < family_info->features_num; i++)
+  for (size_t i = 0; i < family_info->features_num; i++)
   {
     char *buffer;
     size_t buffer_size;
     int status;
 
     char file[4096];
@@ -412,17 +412,17 @@
 static int cow_read_ds2409 (const char *path)
 {
   char subpath[4096];
   int status;
 
   status = ssnprintf (subpath, sizeof (subpath), "%s/main", path);
-  if ((status > 0) && (status < sizeof (subpath)))
+  if ((status > 0) && (status < (int) sizeof (subpath)))
     cow_read_bus (subpath);
 
   status = ssnprintf (subpath, sizeof (subpath), "%s/aux", path);
-  if ((status > 0) && (status < sizeof (subpath)))
+  if ((status > 0) && (status < (int) sizeof (subpath)))
     cow_read_bus (subpath);
 
   return (0);
 } /* int cow_read_ds2409 */
 
 static int cow_read_bus (const char *path)
@@ -456,13 +456,13 @@
 
     if (strcmp ("/", path) == 0)
       status = ssnprintf (subpath, sizeof (subpath), "/%s", buffer_ptr);
     else
       status = ssnprintf (subpath, sizeof (subpath), "%s/%s",
           path, buffer_ptr);
-    if ((status <= 0) || (status >= sizeof (subpath)))
+    if ((status <= 0) || (status >= (int) sizeof (subpath)))
       continue;
 
     for (i = 0; i < ow_family_features_num; i++)
     {
       if (strncmp (ow_family_features[i].family, buffer_ptr,
             strlen (ow_family_features[i].family)) != 0)
@@ -587,13 +587,12 @@
     return (0);
 } /* int cow_shutdown */
 
 static int cow_init (void)
 {
   int status;
-  struct timespec cb_interval;
 
   if (device_g == NULL)
   {
     ERROR ("onewire plugin: cow_init: No device configured.");
     return (-1);
   }
@@ -603,17 +602,14 @@
   if (status != 0)
   {
     ERROR ("onewire plugin: OW_init(%s) failed: %i.", device_g, status);
     return (1);
   }
 
-  CDTIME_T_TO_TIMESPEC (ow_interval, &cb_interval);
-
   plugin_register_complex_read (/* group = */ NULL, "onewire", cow_read,
-      (ow_interval != 0) ? &cb_interval : NULL,
-      /* user data = */ NULL);
+      ow_interval, /* user data = */ NULL);
   plugin_register_shutdown ("onewire", cow_shutdown);
 
   return (0);
 } /* int cow_init */
 
 void module_register (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/openldap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/openldap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/openldap.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/openldap.c	2016-09-11 16:10:25.267038716 +0800
@@ -1,10 +1,10 @@
 /**
  * collectd - src/openldap.c
  * Copyright (C) 2011       Kimo Rosenbaum
- * Copyright (C) 2014       Marc Fournier
+ * Copyright (C) 2014-2015  Marc Fournier
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -24,15 +24,15 @@
  * Authors:
  *   Kimo Rosenbaum <kimor79 at yahoo.com>
  *   Marc Fournier <marc.fournier at camptocamp.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #if defined(__APPLE__)
 #pragma clang diagnostic push
 #pragma clang diagnostic warning "-Wdeprecated-declarations"
 #endif
 
@@ -40,12 +40,14 @@
 #include <ldap.h>
 
 struct cldap_s /* {{{ */
 {
 	char *name;
 
+	char *binddn;
+	char *password;
 	char *cacert;
 	char *host;
 	int   state;
 	_Bool starttls;
 	int   timeout;
 	char *url;
@@ -53,17 +55,22 @@
 	int   version;
 
 	LDAP *ld;
 };
 typedef struct cldap_s cldap_t; /* }}} */
 
+static cldap_t **databases   = NULL;
+static size_t  databases_num = 0;
+
 static void cldap_free (cldap_t *st) /* {{{ */
 {
 	if (st == NULL)
 		return;
 
+	sfree (st->binddn);
+	sfree (st->password);
 	sfree (st->cacert);
 	sfree (st->host);
 	sfree (st->name);
 	sfree (st->url);
 	if (st->ld)
 		ldap_memfree (st->ld);
@@ -72,12 +79,19 @@
 
 /* initialize ldap for each host */
 static int cldap_init_host (cldap_t *st) /* {{{ */
 {
 	LDAP *ld;
 	int rc;
+
+	if (st->state && st->ld)
+	{
+		DEBUG ("openldap plugin: Already connected to %s", st->url);
+		return (0);
+	}
+
 	rc = ldap_initialize (&ld, st->url);
 	if (rc != LDAP_SUCCESS)
 	{
 		ERROR ("openldap plugin: ldap_initialize failed: %s",
 			ldap_err2string (rc));
 		st->state = 0;
@@ -89,12 +103,14 @@
 
 	ldap_set_option (st->ld, LDAP_OPT_PROTOCOL_VERSION, &st->version);
 
 	ldap_set_option (st->ld, LDAP_OPT_TIMEOUT,
 		&(const struct timeval){st->timeout, 0});
 
+	ldap_set_option (st->ld, LDAP_OPT_RESTART, LDAP_OPT_ON);
+
 	if (st->cacert != NULL)
 		ldap_set_option (st->ld, LDAP_OPT_X_TLS_CACERTFILE, st->cacert);
 
 	if (st->verifyhost == 0)
 	{
 		int never = LDAP_OPT_X_TLS_NEVER;
@@ -112,16 +128,25 @@
 			ldap_unbind_ext_s (st->ld, NULL, NULL);
 			return (-1);
 		}
 	}
 
 	struct berval cred;
-	cred.bv_val = "";
-	cred.bv_len = 0;
+	if (st->password != NULL)
+	{
+		cred.bv_val = st->password;
+		cred.bv_len = strlen (st->password);
+	}
+	else
+	{
+		cred.bv_val = "";
+		cred.bv_len = 0;
+	}
 
-	rc = ldap_sasl_bind_s (st->ld, NULL, NULL, &cred, NULL, NULL, NULL);
+	rc = ldap_sasl_bind_s (st->ld, st->binddn, LDAP_SASL_SIMPLE, &cred,
+			NULL, NULL, NULL);
 	if (rc != LDAP_SUCCESS)
 	{
 		ERROR ("openldap plugin: Failed to bind to %s: %s",
 				st->url, ldap_err2string (rc));
 		st->state = 0;
 		ldap_unbind_ext_s (st->ld, NULL, NULL);
@@ -144,19 +169,15 @@
 	vl.values     = &value;
 	vl.values_len = 1;
 
 	if ((st->host == NULL)
 			|| (strcmp ("", st->host) == 0)
 			|| (strcmp ("localhost", st->host) == 0))
-	{
 		sstrncpy (vl.host, hostname_g, sizeof (vl.host));
-	}
 	else
-	{
 		sstrncpy (vl.host, st->host, sizeof (vl.host));
-	}
 
 	sstrncpy (vl.plugin, "openldap", sizeof (vl.plugin));
 	if (st->name != NULL)
 		sstrncpy (vl.plugin_instance, st->name,
 				sizeof (vl.plugin_instance));
 
@@ -184,13 +205,13 @@
 	cldap_submit_value (type, type_instance, v, st);
 } /* }}} void cldap_submit_gauge */
 
 static int cldap_read_host (user_data_t *ud) /* {{{ */
 {
 	cldap_t *st;
-	LDAPMessage *e, *result;
+	LDAPMessage *result;
 	char *dn;
 	int rc;
 	int status;
 
 	char *attrs[9] = { "monitorCounter",
 				"monitorOpCompleted",
@@ -220,17 +241,18 @@
 
 	if (rc != LDAP_SUCCESS)
 	{
 		ERROR ("openldap plugin: Failed to execute search: %s",
 				ldap_err2string (rc));
 		ldap_msgfree (result);
+		st->state = 0;
 		ldap_unbind_ext_s (st->ld, NULL, NULL);
 		return (-1);
 	}
 
-	for (e = ldap_first_entry (st->ld, result); e != NULL;
+	for (LDAPMessage *e = ldap_first_entry (st->ld, result); e != NULL;
 		e = ldap_next_entry (st->ld, e))
 	{
 		if ((dn = ldap_get_dn (st->ld, e)) != NULL)
 		{
 			unsigned long long counter = 0;
 			unsigned long long opc = 0;
@@ -517,13 +539,12 @@
 		}
 
 		ldap_memfree (dn);
 	}
 
 	ldap_msgfree (result);
-	ldap_unbind_ext_s (st->ld, NULL, NULL);
 	return (0);
 } /* }}} int cldap_read_host */
 
 /* Configuration handling functions {{{
  *
  * <Plugin ldap>
@@ -534,40 +555,42 @@
  * </Plugin>
  */
 
 static int cldap_config_add (oconfig_item_t *ci) /* {{{ */
 {
 	cldap_t *st;
-	int i;
 	int status;
 
-	st = malloc (sizeof (*st));
+	st = calloc (1, sizeof (*st));
 	if (st == NULL)
 	{
-		ERROR ("openldap plugin: malloc failed.");
+		ERROR ("openldap plugin: calloc failed.");
 		return (-1);
 	}
-	memset (st, 0, sizeof (*st));
 
 	status = cf_util_get_string (ci, &st->name);
 	if (status != 0)
 	{
 		sfree (st);
 		return (status);
 	}
 
 	st->starttls = 0;
-	st->timeout = -1;
+	st->timeout = (long) (CDTIME_T_TO_MS(plugin_get_interval()) / 1000);
 	st->verifyhost = 1;
 	st->version = LDAP_VERSION3;
 
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
-		if (strcasecmp ("CACert", child->key) == 0)
+		if (strcasecmp ("BindDN", child->key) == 0)
+			status = cf_util_get_string (child, &st->binddn);
+		else if (strcasecmp ("Password", child->key) == 0)
+			status = cf_util_get_string (child, &st->password);
+		else if (strcasecmp ("CACert", child->key) == 0)
 			status = cf_util_get_string (child, &st->cacert);
 		else if (strcasecmp ("StartTLS", child->key) == 0)
 			status = cf_util_get_boolean (child, &st->starttls);
 		else if (strcasecmp ("Timeout", child->key) == 0)
 			status = cf_util_get_int (child, &st->timeout);
 		else if (strcasecmp ("URL", child->key) == 0)
@@ -597,49 +620,62 @@
 	}
 
 	/* Check if URL is valid */
 	if ((status == 0) && (st->url != NULL))
 	{
 		LDAPURLDesc *ludpp;
-		int rc;
 
-		if ((rc = ldap_url_parse (st->url, &ludpp)) != 0)
+		if (ldap_url_parse (st->url, &ludpp) != 0)
 		{
 			ERROR ("openldap plugin: Instance `%s': "
 				"Invalid URL: `%s'",
 				st->name, st->url);
 			status = -1;
 		}
 
 		if ((status == 0) && (ludpp->lud_host != NULL))
-		{
 			st->host = strdup (ludpp->lud_host);
-		}
 
 		ldap_free_urldesc (ludpp);
 	}
 
 	if (status == 0)
 	{
-		user_data_t ud;
-		char callback_name[3*DATA_MAX_NAME_LEN];
+		cldap_t **temp;
 
-		memset (&ud, 0, sizeof (ud));
-		ud.data = st;
+		temp = (cldap_t **) realloc (databases,
+			sizeof (*databases) * (databases_num + 1));
 
-		memset (callback_name, 0, sizeof (callback_name));
-		ssnprintf (callback_name, sizeof (callback_name),
-				"openldap/%s/%s",
-				(st->host != NULL) ? st->host : hostname_g,
-				(st->name != NULL) ? st->name : "default"),
-
-		status = plugin_register_complex_read (/* group = */ NULL,
-				/* name      = */ callback_name,
-				/* callback  = */ cldap_read_host,
-				/* interval  = */ NULL,
-				/* user_data = */ &ud);
+		if (temp == NULL)
+		{
+			ERROR ("openldap plugin: realloc failed");
+			status = -1;
+		}
+		else
+		{
+			char callback_name[3*DATA_MAX_NAME_LEN] = { 0 };
+
+			databases = temp;
+			databases[databases_num] = st;
+			databases_num++;
+
+			ssnprintf (callback_name, sizeof (callback_name),
+					"openldap/%s/%s",
+					(st->host != NULL) ? st->host : hostname_g,
+					(st->name != NULL) ? st->name : "default");
+
+			user_data_t ud = {
+				.data = st
+			};
+
+			status = plugin_register_complex_read (/* group = */ NULL,
+					/* name      = */ callback_name,
+					/* callback  = */ cldap_read_host,
+					/* interval  = */ 0,
+					/* user_data = */ &ud);
+		}
 	}
 
 	if (status != 0)
 	{
 		cldap_free (st);
 		return (-1);
@@ -647,16 +683,15 @@
 
 	return (0);
 } /* }}} int cldap_config_add */
 
 static int cldap_config (oconfig_item_t *ci) /* {{{ */
 {
-	int i;
 	int status = 0;
 
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Instance", child->key) == 0)
 			cldap_config_add (child);
 		else
@@ -678,15 +713,27 @@
 	 * ldap_initialize(3) */
 	int debug_level;
 	ldap_get_option (NULL, LDAP_OPT_DEBUG_LEVEL, &debug_level);
 	return (0);
 } /* }}} int cldap_init */
 
+static int cldap_shutdown (void) /* {{{ */
+{
+	for (size_t i = 0; i < databases_num; i++)
+		if (databases[i]->ld != NULL)
+			ldap_unbind_ext_s (databases[i]->ld, NULL, NULL);
+	sfree (databases);
+	databases_num = 0;
+
+	return (0);
+} /* }}} int cldap_shutdown */
+
 void module_register (void) /* {{{ */
 {
 	plugin_register_complex_config ("openldap", cldap_config);
 	plugin_register_init ("openldap", cldap_init);
+	plugin_register_shutdown ("openldap", cldap_shutdown);
 } /* }}} void module_register */
 
 #if defined(__APPLE__)
 #pragma clang diagnostic pop
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/openvpn.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/openvpn.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/openvpn.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/openvpn.c	2016-09-11 16:10:25.267038716 +0800
@@ -92,13 +93,14 @@
 	}
 
 	return (i);
 } /* int openvpn_strsplit */
 
 /* dispatches number of users */
-static void numusers_submit (char *pinst, char *tinst, gauge_t value)
+static void numusers_submit (const char *pinst, const char *tinst,
+		gauge_t value)
 {
 	value_t values[1];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].gauge = value;
 
@@ -112,14 +114,16 @@
 	if (tinst != NULL)
 		sstrncpy (vl.type_instance, tinst, sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 } /* void numusers_submit */
 
-/* dispatches stats about traffic (TCP or UDP) generated by the tunnel per single endpoint */
-static void iostats_submit (char *pinst, char *tinst, derive_t rx, derive_t tx)
+/* dispatches stats about traffic (TCP or UDP) generated by the tunnel
+ * per single endpoint */
+static void iostats_submit (const char *pinst, const char *tinst,
+		derive_t rx, derive_t tx)
 {
 	value_t values[2];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].derive = rx;
 	values[1].derive = tx;
@@ -142,13 +146,13 @@
 		sstrncpy (vl.type_instance, tinst, sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 } /* void traffic_submit */
 
 /* dispatches stats about data compression shown when in single mode */
-static void compression_submit (char *pinst, char *tinst,
+static void compression_submit (const char *pinst, const char *tinst,
 		derive_t uncompressed, derive_t compressed)
 {
 	value_t values[2];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].derive = uncompressed;
@@ -165,13 +169,13 @@
 	if (tinst != NULL)
 		sstrncpy (vl.type_instance, tinst, sizeof (vl.type_instance));
 
 	plugin_dispatch_values (&vl);
 } /* void compression_submit */
 
-static int single_read (char *name, FILE *fh)
+static int single_read (const char *name, FILE *fh)
 {
 	char buffer[1024];
 	char *fields[4];
 	const int max_fields = STATIC_ARRAY_SIZE (fields);
 	int  fields_num, read = 0;
 
@@ -258,13 +262,13 @@
 	read = 1;
 
 	return (read);
 } /* int single_read */
 
 /* for reading status version 1 */
-static int multi1_read (char *name, FILE *fh)
+static int multi1_read (const char *name, FILE *fh)
 {
 	char buffer[1024];
 	char *fields[10];
 	int  fields_num, found_header = 0;
 	long long sum_users = 0;
 
@@ -321,13 +325,13 @@
 		numusers_submit(name, name, sum_users);
 
 	return (1);
 } /* int multi1_read */
 
 /* for reading status version 2 */
-static int multi2_read (char *name, FILE *fh)
+static int multi2_read (const char *name, FILE *fh)
 {
 	char buffer[1024];
 	char *fields[10];
 	const int max_fields = STATIC_ARRAY_SIZE (fields);
 	int  fields_num, read = 0;
 	long long sum_users    = 0;
@@ -383,13 +387,13 @@
 	}
 
 	return (read);
 } /* int multi2_read */
 
 /* for reading status version 3 */
-static int multi3_read (char *name, FILE *fh)
+static int multi3_read (const char *name, FILE *fh)
 {
 	char buffer[1024];
 	char *fields[15];
 	const int max_fields = STATIC_ARRAY_SIZE (fields);
 	int  fields_num, read = 0;
 	long long sum_users    = 0;
@@ -448,13 +452,13 @@
 	}
 
 	return (read);
 } /* int multi3_read */
 
 /* for reading status version 4 */
-static int multi4_read (char *name, FILE *fh)
+static int multi4_read (const char *name, FILE *fh)
 {
 	char buffer[1024];
 	char *fields[11];
 	const int max_fields = STATIC_ARRAY_SIZE (fields);
 	int  fields_num, read = 0;
 	long long sum_users    = 0;
@@ -515,18 +519,18 @@
 } /* int multi4_read */
 
 /* read callback */
 static int openvpn_read (void)
 {
 	FILE *fh;
-	int  i, read;
+	int  read;
 
 	read = 0;
 
 	/* call the right read function for every status entry in the list */
-	for (i = 0; i < vpn_num; i++)
+	for (int i = 0; i < vpn_num; i++)
 	{
 		int vpn_read = 0;
 
 		fh = fopen (vpn_list[i]->file, "r");
 		if (fh == NULL)
 		{
@@ -644,13 +648,13 @@
 
 static int openvpn_config (const char *key, const char *value)
 {
 	if (strcasecmp ("StatusFile", key) == 0)
 	{
 		char    *status_file, *status_name, *filename;
-		int     status_version, i;
+		int     status_version;
 		vpn_status_t *temp;
 
 		/* try to detect the status file format */
 		status_version = version_detect (value);
 
 		if (status_version == 0)
@@ -680,49 +684,51 @@
 		{
 			/* doesn't waste memory, uses status_file starting at filename + 1 */
 			status_name = filename + 1;
 		}
 
 		/* scan the list looking for a clone */
-		for (i = 0; i < vpn_num; i++)
+		for (int i = 0; i < vpn_num; i++)
 		{
 			if (strcasecmp (vpn_list[i]->name, status_name) == 0)
 			{
 				WARNING ("openvpn plugin: status filename \"%s\" "
 						"already used, please choose a "
 						"different one.", status_name);
 				sfree (status_file);
 				return (1);
 			}
 		}
 
 		/* create a new vpn element since file, version and name are ok */
-		temp = (vpn_status_t *) malloc (sizeof (vpn_status_t));
+		temp = malloc (sizeof (*temp));
 		if (temp == NULL)
 		{
 			char errbuf[1024];
 			ERROR ("openvpn plugin: malloc failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			sfree (status_file);
 			return (1);
 		}
 		temp->file = status_file;
 		temp->version = status_version;
 		temp->name = status_name;
 
-		vpn_list = (vpn_status_t **) realloc (vpn_list, (vpn_num + 1) * sizeof (vpn_status_t *));
-		if (vpn_list == NULL)
+		vpn_status_t **tmp_list = realloc (vpn_list, (vpn_num + 1) * sizeof (*vpn_list));
+		if (tmp_list == NULL)
 		{
 			char errbuf[1024];
 			ERROR ("openvpn plugin: realloc failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 
+			sfree (vpn_list);
 			sfree (temp->file);
 			sfree (temp);
 			return (1);
 		}
+		vpn_list = tmp_list;
 
 		vpn_list[vpn_num] = temp;
 		vpn_num++;
 
 		DEBUG ("openvpn plugin: status file \"%s\" added", temp->file);
 
@@ -769,15 +775,13 @@
 	return (0);
 } /* int openvpn_config */
 
 /* shutdown callback */
 static int openvpn_shutdown (void)
 {
-	int i;
-
-	for (i = 0; i < vpn_num; i++)
+	for (int i = 0; i < vpn_num; i++)
 	{
 		sfree (vpn_list[i]->file);
 		sfree (vpn_list[i]);
 	}
 
 	sfree (vpn_list);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/oracle.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/oracle.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/oracle.c	2016-11-29 00:08:22.415470550 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/oracle.c	2016-09-11 16:10:25.267038716 +0800
@@ -43,15 +43,15 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_db_query.h"
 
 #include <oci.h>
 
 /*
  * Data types
@@ -90,22 +90,21 @@
     const char *db_name, const char *query_name,
     const char *what, OCIError *eh)
 {
   char buffer[2048];
   sb4 error_code;
   int status;
-  unsigned int record_number;
 
   if (db_name == NULL)
     db_name = "(none)";
   if (query_name == NULL)
     query_name = "(none)";
 
   /* An operation may cause / return multiple errors. Loop until we have
    * handled all errors available (with a fail-save limit of 16). */
-  for (record_number = 1; record_number <= 16; record_number++)
+  for (unsigned int record_number = 1; record_number <= 16; record_number++)
   {
     memset (buffer, 0, sizeof (buffer));
     error_code = -1;
 
     status = OCIErrorGet (eh, (ub4) record_number,
         /* sqlstate = */ NULL,
@@ -141,25 +140,23 @@
     }
   }
 } /* }}} void o_report_error */
 
 static void o_database_free (o_database_t *db) /* {{{ */
 {
-  size_t i;
-
   if (db == NULL)
     return;
 
   sfree (db->name);
   sfree (db->connect_id);
   sfree (db->username);
   sfree (db->password);
   sfree (db->queries);
 
   if (db->q_prep_areas != NULL)
-    for (i = 0; i < db->queries_num; ++i)
+    for (size_t i = 0; i < db->queries_num; ++i)
       udb_query_delete_preparation_area (db->q_prep_areas[i]);
   free (db->q_prep_areas);
 
   sfree (db);
 } /* }}} void o_database_free */
 
@@ -171,13 +168,13 @@
  *     <Result>
  *       Type "gauge"
  *       InstancesFrom "name"
  *       ValuesFrom "value"
  *     </Result>
  *   </Query>
- *     
+ *
  *   <Database "plugin_instance1">
  *     ConnectID "db01"
  *     Username "oracle"
  *     Password "secret"
  *     Query "plugin_instance0"
  *   </Database>
@@ -185,29 +182,27 @@
  */
 
 static int o_config_add_database (oconfig_item_t *ci) /* {{{ */
 {
   o_database_t *db;
   int status;
-  int i;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("oracle plugin: The `Database' block "
         "needs exactly one string argument.");
     return (-1);
   }
 
-  db = (o_database_t *) malloc (sizeof (*db));
+  db = calloc (1, sizeof (*db));
   if (db == NULL)
   {
-    ERROR ("oracle plugin: malloc failed.");
+    ERROR ("oracle plugin: calloc failed.");
     return (-1);
   }
-  memset (db, 0, sizeof (*db));
   db->name = NULL;
   db->host = NULL;
   db->connect_id = NULL;
   db->username = NULL;
   db->password = NULL;
 
@@ -216,13 +211,13 @@
   {
     sfree (db);
     return (status);
   }
 
   /* Fill the `o_database_t' structure.. */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("ConnectID", child->key) == 0)
       status = cf_util_get_string (child, &db->connect_id);
     else if (strcasecmp ("Host", child->key) == 0)
@@ -270,18 +265,18 @@
   {
     db->q_prep_areas = (udb_query_preparation_area_t **) calloc (
         db->queries_num, sizeof (*db->q_prep_areas));
 
     if (db->q_prep_areas == NULL)
     {
-      WARNING ("oracle plugin: malloc failed");
+      WARNING ("oracle plugin: calloc failed");
       status = -1;
       break;
     }
 
-    for (i = 0; i < db->queries_num; ++i)
+    for (int i = 0; i < db->queries_num; ++i)
     {
       db->q_prep_areas[i]
         = udb_query_allocate_preparation_area (db->queries[i]);
 
       if (db->q_prep_areas[i] == NULL)
       {
@@ -297,13 +292,13 @@
   /* If all went well, add this query to the list of queries within the
    * database structure. */
   if (status == 0)
   {
     o_database_t **temp;
 
-    temp = (o_database_t **) realloc (databases,
+    temp = realloc (databases,
         sizeof (*databases) * (databases_num + 1));
     if (temp == NULL)
     {
       ERROR ("oracle plugin: realloc failed");
       status = -1;
     }
@@ -323,15 +318,13 @@
 
   return (0);
 } /* }}} int o_config_add_database */
 
 static int o_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("Query", child->key) == 0)
       udb_query_create (&queries, &queries_num, child,
           /* callback = */ NULL);
     else if (strcasecmp ("Database", child->key) == 0)
@@ -397,13 +390,12 @@
 
   /* List of `OCIDefine' pointers. These defines map columns to the buffer
    * space declared above. */
   OCIDefine **oci_defines;
 
   int status;
-  size_t i;
 
   oci_statement = udb_query_get_user_data (q);
 
   /* Prepare the statement */
   if (oci_statement == NULL) /* {{{ */
   {
@@ -460,26 +452,26 @@
 
   /* Acquire the number of columns returned. */
   do /* {{{ */
   {
     ub4 param_counter = 0;
     status = OCIAttrGet (oci_statement, OCI_HTYPE_STMT, /* {{{ */
-        &param_counter, /* size pointer = */ NULL, 
+        &param_counter, /* size pointer = */ NULL,
         OCI_ATTR_PARAM_COUNT, oci_error);
     if (status != OCI_SUCCESS)
     {
       o_report_error ("o_read_database_query", db->name,
           udb_query_get_name (q), "OCIAttrGet", oci_error);
       return (-1);
     } /* }}} */
 
     column_num = (size_t) param_counter;
   } while (0); /* }}} */
 
   /* Allocate the following buffers:
-   * 
+   *
    *  +---------------+-----------------------------------+
    *  ! Name          ! Size                              !
    *  +---------------+-----------------------------------+
    *  ! column_names  ! column_num x DATA_MAX_NAME_LEN    !
    *  ! column_values ! column_num x DATA_MAX_NAME_LEN    !
    *  ! oci_defines   ! column_num x sizeof (OCIDefine *) !
@@ -499,44 +491,43 @@
   } \
   sfree (oci_defines)
 
 #define ALLOC_OR_FAIL(ptr, ptr_size) \
   do { \
     size_t alloc_size = (size_t) ((ptr_size)); \
-    (ptr) = malloc (alloc_size); \
+    (ptr) = calloc (1, alloc_size); \
     if ((ptr) == NULL) { \
       FREE_ALL; \
-      ERROR ("oracle plugin: o_read_database_query: malloc failed."); \
+      ERROR ("oracle plugin: o_read_database_query: calloc failed."); \
       return (-1); \
     } \
-    memset ((ptr), 0, alloc_size); \
   } while (0)
 
   /* Initialize everything to NULL so the above works. */
   column_names  = NULL;
   column_values = NULL;
   oci_defines   = NULL;
 
   ALLOC_OR_FAIL (column_names, column_num * sizeof (char *));
   ALLOC_OR_FAIL (column_names[0], column_num * DATA_MAX_NAME_LEN
       * sizeof (char));
-  for (i = 1; i < column_num; i++)
+  for (size_t i = 1; i < column_num; i++)
     column_names[i] = column_names[i - 1] + DATA_MAX_NAME_LEN;
 
   ALLOC_OR_FAIL (column_values, column_num * sizeof (char *));
   ALLOC_OR_FAIL (column_values[0], column_num * DATA_MAX_NAME_LEN
       * sizeof (char));
-  for (i = 1; i < column_num; i++)
+  for (size_t i = 1; i < column_num; i++)
     column_values[i] = column_values[i - 1] + DATA_MAX_NAME_LEN;
 
   ALLOC_OR_FAIL (oci_defines, column_num * sizeof (OCIDefine *));
   /* }}} End of buffer allocations. */
 
   /* ``Define'' the returned data, i. e. bind the columns to the buffers
    * allocated above. */
-  for (i = 0; i < column_num; i++) /* {{{ */
+  for (size_t i = 0; i < column_num; i++) /* {{{ */
   {
     char *column_name;
     ub4 column_name_length;
     OCIParam *oci_param;
 
     oci_param = NULL;
@@ -641,22 +632,21 @@
 #undef FREE_ALL
 #undef ALLOC_OR_FAIL
 } /* }}} int o_read_database_query */
 
 static int o_read_database (o_database_t *db) /* {{{ */
 {
-  size_t i;
   int status;
 
   if (db->oci_service_context != NULL)
   {
     OCIServer *server_handle;
     ub4 connection_status;
 
     server_handle = NULL;
-    status = OCIAttrGet ((void *) db->oci_service_context, OCI_HTYPE_SVCCTX, 
+    status = OCIAttrGet ((void *) db->oci_service_context, OCI_HTYPE_SVCCTX,
         (void *) &server_handle, /* size pointer = */ NULL,
         OCI_ATTR_SERVER, oci_error);
     if (status != OCI_SUCCESS)
     {
       o_report_error ("o_read_database", db->name, NULL, "OCIAttrGet",
           oci_error);
@@ -716,13 +706,13 @@
     assert (db->oci_service_context != NULL);
   }
 
   DEBUG ("oracle plugin: o_read_database: db->connect_id = %s; db->oci_service_context = %p;",
       db->connect_id, db->oci_service_context);
 
-  for (i = 0; i < db->queries_num; i++)
+  for (size_t i = 0; i < db->queries_num; i++)
     o_read_database_query (db, db->queries[i], db->q_prep_areas[i]);
 
   return (0);
 } /* }}} int o_read_database */
 
 static int o_read (void) /* {{{ */
@@ -742,25 +732,25 @@
   for (i = 0; i < databases_num; i++)
     if (databases[i]->oci_service_context != NULL)
     {
       OCIHandleFree (databases[i]->oci_service_context, OCI_HTYPE_SVCCTX);
       databases[i]->oci_service_context = NULL;
     }
-  
+
   for (i = 0; i < queries_num; i++)
   {
     OCIStmt *oci_statement;
 
     oci_statement = udb_query_get_user_data (queries[i]);
     if (oci_statement != NULL)
     {
       OCIHandleFree (oci_statement, OCI_HTYPE_STMT);
       udb_query_set_user_data (queries[i], NULL);
     }
   }
-  
+
   OCIHandleFree (oci_env, OCI_HTYPE_ENV);
   oci_env = NULL;
 
   udb_query_free (queries, queries_num);
   queries = NULL;
   queries_num = 0;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/perl.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/perl.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/perl.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/perl.c	2016-09-11 16:10:25.267038716 +0800
@@ -31,15 +31,14 @@
 
 /* do not automatically get the thread specific Perl interpreter */
 #define PERL_NO_GET_CONTEXT
 
 #define DONT_POISON_SPRINTF_YET 1
 #include "collectd.h"
-#undef DONT_POISON_SPRINTF_YET
 
-#include "configfile.h"
+#undef DONT_POISON_SPRINTF_YET
 
 #if HAVE_STDBOOL_H
 # include <stdbool.h>
 #endif
 
 #include <EXTERN.h>
@@ -60,14 +59,12 @@
 /* ... while we want the definition found in plugin.h. */
 #include "plugin.h"
 #include "common.h"
 
 #include "filter_chain.h"
 
-#include <pthread.h>
-
 #if !defined(USE_ITHREADS)
 # error "Perl does not support ithreads!"
 #endif /* !defined(USE_ITHREADS) */
 
 /* clear the Perl sub's stack frame
  * (this should only be used inside an XSUB) */
@@ -302,39 +299,37 @@
 		ds->max = SvNV (*tmp);
 	else
 		ds->max = NAN;
 	return 0;
 } /* static int hv2data_source (HV *, data_source_t *) */
 
-static int av2value (pTHX_ char *name, AV *array, value_t *value, int len)
+/* av2value converts at most "len" elements from "array" to "value". Returns the
+ * number of elements converted or zero on error. */
+static size_t av2value (pTHX_ char *name, AV *array, value_t *value, size_t array_len)
 {
 	const data_set_t *ds;
 
-	int i = 0;
-
-	if ((NULL == name) || (NULL == array) || (NULL == value))
-		return -1;
-
-	if (av_len (array) < len - 1)
-		len = av_len (array) + 1;
-
-	if (0 >= len)
-		return -1;
+	if ((NULL == name) || (NULL == array) || (NULL == value) || (array_len == 0))
+		return 0;
 
 	ds = plugin_get_ds (name);
 	if (NULL == ds) {
 		log_err ("av2value: Unknown dataset \"%s\"", name);
-		return -1;
+		return 0;
 	}
 
-	if (ds->ds_num < len) {
-		log_warn ("av2value: Value length exceeds data set length.");
-		len = ds->ds_num;
+	if (array_len < ds->ds_num) {
+		log_warn ("av2value: array does not contain enough elements for type \"%s\": got %zu, want %zu",
+				name, array_len, ds->ds_num);
+		return 0;
+	} else if (array_len > ds->ds_num) {
+		log_warn ("av2value: array contains excess elements for type \"%s\": got %zu, want %zu",
+				name, array_len, ds->ds_num);
 	}
 
-	for (i = 0; i < len; ++i) {
+	for (size_t i = 0; i < ds->ds_num; ++i) {
 		SV **tmp = av_fetch (array, i, 0);
 
 		if (NULL != tmp) {
 			if (DS_TYPE_COUNTER == ds->ds[i].type)
 				value[i].counter = SvIV (*tmp);
 			else if (DS_TYPE_GAUGE == ds->ds[i].type)
@@ -342,17 +337,18 @@
 			else if (DS_TYPE_DERIVE == ds->ds[i].type)
 				value[i].derive = SvIV (*tmp);
 			else if (DS_TYPE_ABSOLUTE == ds->ds[i].type)
 				value[i].absolute = SvIV (*tmp);
 		}
 		else {
-			return -1;
+			return 0;
 		}
 	}
-	return len;
-} /* static int av2value (char *, AV *, value_t *, int) */
+
+	return ds->ds_num;
+} /* static size_t av2value (char *, AV *, value_t *, size_t) */
 
 /*
  * value list:
  * {
  *   values => [ @values ],
  *   time   => $time,
@@ -381,22 +377,20 @@
 		log_err ("hv2value_list: No valid values given.");
 		return -1;
 	}
 
 	{
 		AV  *array = (AV *)SvRV (*tmp);
-		int len    = av_len (array) + 1;
-
-		if (len <= 0)
+		/* av_len returns the highest index, not the actual length. */
+		size_t array_len = (size_t) (av_len (array) + 1);
+		if (array_len == 0)
 			return -1;
 
-		vl->values     = (value_t *)smalloc (len * sizeof (value_t));
-		vl->values_len = av2value (aTHX_ vl->type, (AV *)SvRV (*tmp),
-				vl->values, len);
-
-		if (-1 == vl->values_len) {
+		vl->values     = calloc (array_len, sizeof (*vl->values));
+		vl->values_len = av2value (aTHX_ vl->type, (AV *)SvRV (*tmp), vl->values, array_len);
+		if (vl->values_len == 0) {
 			sfree (vl->values);
 			return -1;
 		}
 	}
 
 	if (NULL != (tmp = hv_fetch (hash, "time", 4, 0)))
@@ -428,28 +422,28 @@
 				sizeof (vl->type_instance));
 	return 0;
 } /* static int hv2value_list (pTHX_ HV *, value_list_t *) */
 
 static int av2data_set (pTHX_ AV *array, char *name, data_set_t *ds)
 {
-	int len, i;
+	int len;
 
 	if ((NULL == array) || (NULL == name) || (NULL == ds))
 		return -1;
 
 	len = av_len (array);
 
 	if (-1 == len) {
 		log_err ("av2data_set: Invalid data set.");
 		return -1;
 	}
 
-	ds->ds = (data_source_t *)smalloc ((len + 1) * sizeof (data_source_t));
+	ds->ds = smalloc ((len + 1) * sizeof (*ds->ds));
 	ds->ds_num = len + 1;
 
-	for (i = 0; i <= len; ++i) {
+	for (int i = 0; i <= len; ++i) {
 		SV **elem = av_fetch (array, i, 0);
 
 		if (NULL == elem) {
 			log_err ("av2data_set: Failed to fetch data source %i.", i);
 			return -1;
 		}
@@ -487,15 +481,14 @@
  */
 static int av2notification_meta (pTHX_ AV *array, notification_meta_t **meta)
 {
 	notification_meta_t **m = meta;
 
 	int len = av_len (array);
-	int i;
 
-	for (i = 0; i <= len; ++i) {
+	for (int i = 0; i <= len; ++i) {
 		SV **tmp = av_fetch (array, i, 0);
 		HV  *hash;
 
 		if (NULL == tmp)
 			return -1;
 
@@ -504,13 +497,13 @@
 					"meta information.");
 			continue;
 		}
 
 		hash = (HV *)SvRV (*tmp);
 
-		*m = (notification_meta_t *)smalloc (sizeof (**m));
+		*m = smalloc (sizeof (**m));
 
 		if (NULL == (tmp = hv_fetch (hash, "name", 4, 0))) {
 			log_warn ("av2notification_meta: Skipping invalid "
 					"meta information.");
 			free (*m);
 			continue;
@@ -605,20 +598,18 @@
 	}
 	return 0;
 } /* static int hv2notification (pTHX_ HV *, notification_t *) */
 
 static int data_set2av (pTHX_ data_set_t *ds, AV *array)
 {
-	int i = 0;
-
 	if ((NULL == ds) || (NULL == array))
 		return -1;
 
 	av_extend (array, ds->ds_num);
 
-	for (i = 0; i < ds->ds_num; ++i) {
+	for (size_t i = 0; i < ds->ds_num; ++i) {
 		HV *source = newHV ();
 
 		if (NULL == hv_store (source, "name", 4,
 				newSVpv (ds->ds[i].name, 0), 0))
 			return -1;
 
@@ -641,30 +632,23 @@
 	return 0;
 } /* static int data_set2av (data_set_t *, AV *) */
 
 static int value_list2hv (pTHX_ value_list_t *vl, data_set_t *ds, HV *hash)
 {
 	AV *values = NULL;
-
-	int i   = 0;
-	int len = 0;
+	size_t i;
 
 	if ((NULL == vl) || (NULL == ds) || (NULL == hash))
 		return -1;
 
-	len = vl->values_len;
-
-	if (ds->ds_num < len) {
-		log_warn ("value2av: Value length exceeds data set length.");
-		len = ds->ds_num;
-	}
-
 	values = newAV ();
-	av_extend (values, len - 1);
+	/* av_extend takes the last *index* to which the array should be extended. */
+	av_extend (values, vl->values_len - 1);
 
-	for (i = 0; i < len; ++i) {
+	assert (ds->ds_num == vl->values_len);
+	for (i = 0; i < vl->values_len; ++i) {
 		SV *val = NULL;
 
 		if (DS_TYPE_COUNTER == ds->ds[i].type)
 			val = newSViv (vl->values[i].counter);
 		else if (DS_TYPE_GAUGE == ds->ds[i].type)
 			val = newSVnv (vl->values[i].gauge);
@@ -719,22 +703,21 @@
 	return 0;
 } /* static int value2av (value_list_t *, data_set_t *, HV *) */
 
 static int notification_meta2av (pTHX_ notification_meta_t *meta, AV *array)
 {
 	int meta_num = 0;
-	int i;
 
 	while (meta) {
 		++meta_num;
 		meta = meta->next;
 	}
 
 	av_extend (array, meta_num);
 
-	for (i = 0; NULL != meta; meta = meta->next, ++i) {
+	for (int i = 0; NULL != meta; meta = meta->next, ++i) {
 		HV *m = newHV ();
 		SV *value;
 
 		if (NULL == hv_store (m, "name", 4, newSVpv (meta->name, 0), 0))
 			return -1;
 
@@ -815,14 +798,12 @@
 	}
 	return 0;
 } /* static int notification2hv (notification_t *, HV *) */
 
 static int oconfig_item2hv (pTHX_ oconfig_item_t *ci, HV *hash)
 {
-	int i;
-
 	AV *values;
 	AV *children;
 
 	if (NULL == hv_store (hash, "key", 3, newSVpv (ci->key, 0), 0))
 		return -1;
 
@@ -833,13 +814,13 @@
 	if (NULL == hv_store (hash, "values", 6, newRV_noinc ((SV *)values), 0)) {
 		av_clear (values);
 		av_undef (values);
 		return -1;
 	}
 
-	for (i = 0; i < ci->values_num; ++i) {
+	for (int i = 0; i < ci->values_num; ++i) {
 		SV *value;
 
 		switch (ci->values[i].type) {
 			case OCONFIG_TYPE_STRING:
 				value = newSVpv (ci->values[i].value.string, 0);
 				break;
@@ -870,13 +851,13 @@
 	if (NULL == hv_store (hash, "children", 8, newRV_noinc ((SV *)children), 0)) {
 		av_clear (children);
 		av_undef (children);
 		return -1;
 	}
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		HV *child = newHV ();
 
 		if (0 != oconfig_item2hv (aTHX_ ci->children + i, child)) {
 			hv_clear (child);
 			hv_undef (child);
 			return -1;
@@ -991,21 +972,19 @@
 
 /*
  * Dispatch a notification.
  */
 static int pplugin_dispatch_notification (pTHX_ HV *notif)
 {
-	notification_t n;
+	notification_t n = { 0 };
 
 	int ret;
 
 	if (NULL == notif)
 		return -1;
 
-	memset (&n, 0, sizeof (n));
-
 	if (0 != hv2notification (aTHX_ notif, &n))
 		return -1;
 
 	ret = plugin_dispatch_notification (&n);
 	plugin_notification_meta_free (n.meta);
 	return ret;
@@ -1254,13 +1233,13 @@
 {
 	c_ithread_t *t = NULL;
 	dTHXa (NULL);
 
 	assert (NULL != perl_threads);
 
-	t = (c_ithread_t *)smalloc (sizeof (c_ithread_t));
+	t = smalloc (sizeof (*t));
 	memset (t, 0, sizeof (c_ithread_t));
 
 	t->interp = (NULL == base)
 		? NULL
 		: perl_clone (base, CLONEf_KEEP_PTR_TABLE);
 
@@ -1467,13 +1446,13 @@
 			|| (OCONFIG_TYPE_STRING != ci->values[0].type)) {
 		log_warn ("A \"%s\" block expects a single string argument.",
 				(FC_MATCH == type) ? "Match" : "Target");
 		return -1;
 	}
 
-	data = (pfc_user_data_t *)smalloc (sizeof (*data));
+	data = smalloc (sizeof (*data));
 	data->name      = sstrdup (ci->values[0].value.string);
 	data->user_data = newSV (0);
 
 	ret = fc_call (aTHX_ type, FC_CB_CREATE, data, ci);
 
 	if (0 != ret)
@@ -2118,26 +2097,23 @@
 	}
 	return pplugin_call_all (aTHX_ PLUGIN_FLUSH, timeout, identifier);
 } /* static int perl_flush (const int) */
 
 static int perl_shutdown (void)
 {
-	c_ithread_t *t = NULL;
-
-	int ret = 0;
+	c_ithread_t *t;
+	int ret;
 
 	dTHX;
 
 	plugin_unregister_complex_config ("perl");
 
 	if (NULL == perl_threads)
 		return 0;
 
 	if (NULL == aTHX) {
-		t = NULL;
-
 		pthread_mutex_lock (&perl_threads->mutex);
 		t = c_ithread_create (perl_threads->head->interp);
 		pthread_mutex_unlock (&perl_threads->mutex);
 
 		aTHX = t->interp;
 	}
@@ -2251,36 +2227,34 @@
 static void xs_init (pTHX)
 {
 	HV   *stash = NULL;
 	SV   *tmp   = NULL;
 	char *file  = __FILE__;
 
-	int i = 0;
-
 	dXSUB_SYS;
 
 	/* enable usage of Perl modules using shared libraries */
 	newXS ("DynaLoader::boot_DynaLoader", boot_DynaLoader, file);
 
 	/* register API */
-	for (i = 0; NULL != api[i].f; ++i)
+	for (int i = 0; NULL != api[i].f; ++i)
 		newXS (api[i].name, api[i].f, file);
 
 	stash = gv_stashpv ("Collectd", 1);
 
 	/* export "constants" */
-	for (i = 0; '\0' != constants[i].name[0]; ++i)
+	for (int i = 0; '\0' != constants[i].name[0]; ++i)
 		newCONSTSUB (stash, constants[i].name, newSViv (constants[i].value));
 
 	/* export global variables
 	 * by adding "magic" to the SV's representing the globale variables
 	 * perl is able to automagically call the get/set function when
 	 * accessing any such variable (this is basically the same as using
 	 * tie() in Perl) */
 	/* global strings */
-	for (i = 0; '\0' != g_strings[i].name[0]; ++i) {
+	for (int i = 0; '\0' != g_strings[i].name[0]; ++i) {
 		tmp = get_sv (g_strings[i].name, 1);
 		sv_magicext (tmp, NULL, PERL_MAGIC_ext, &g_pv_vtbl,
 				g_strings[i].var, 0);
 	}
 
 	tmp = get_sv ("Collectd::interval_g", /* create = */ 1);
@@ -2299,15 +2273,13 @@
 	if (NULL != perl_threads)
 		return 0;
 
 	log_info ("Initializing Perl interpreter...");
 #if COLLECT_DEBUG
 	{
-		int i = 0;
-
-		for (i = 0; i < argc; ++i)
+		for (int i = 0; i < argc; ++i)
 			log_debug ("argv[%i] = \"%s\"", i, argv[i]);
 	}
 #endif /* COLLECT_DEBUG */
 
 	if (0 != pthread_key_create (&perl_thr_key, c_ithread_destructor)) {
 		log_err ("init_pi: pthread_key_create failed");
@@ -2320,13 +2292,13 @@
 	/* On FreeBSD, PERL_SYS_INIT3 expands to some expression which
 	 * triggers a "value computed is not used" warning by gcc. */
 	(void)
 #endif
 	PERL_SYS_INIT3 (&argc, &argv, &environ);
 
-	perl_threads = (c_ithread_list_t *)smalloc (sizeof (c_ithread_list_t));
+	perl_threads = smalloc (sizeof (*perl_threads));
 	memset (perl_threads, 0, sizeof (c_ithread_list_t));
 
 	pthread_mutexattr_init(&perl_threads->mutexattr);
 	pthread_mutexattr_settype(&perl_threads->mutexattr, PTHREAD_MUTEX_RECURSIVE);
 	pthread_mutex_init (&perl_threads->mutex, &perl_threads->mutexattr);
 	/* locking the mutex should not be necessary at this point
@@ -2452,25 +2424,25 @@
 		log_warn ("EnableDebugger has no effects if used after LoadPlugin.");
 		return 1;
 	}
 
 	value = ci->values[0].value.string;
 
-	perl_argv = (char **)realloc (perl_argv,
+	perl_argv = realloc (perl_argv,
 			(++perl_argc + 1) * sizeof (char *));
 
 	if (NULL == perl_argv) {
 		log_err ("perl_config: Not enough memory.");
 		exit (3);
 	}
 
 	if ('\0' == value[0]) {
 		perl_argv[perl_argc - 1] = "-d";
 	}
 	else {
-		perl_argv[perl_argc - 1] = (char *)smalloc (strlen (value) + 4);
+		perl_argv[perl_argc - 1] = smalloc (strlen (value) + 4);
 		sstrncpy (perl_argv[perl_argc - 1], "-d:", 4);
 		sstrncpy (perl_argv[perl_argc - 1] + 3, value, strlen (value) + 1);
 	}
 
 	perl_argv[perl_argc] = NULL;
 	return 0;
@@ -2489,21 +2461,21 @@
 		return 1;
 	}
 
 	value = ci->values[0].value.string;
 
 	if (NULL == aTHX) {
-		perl_argv = (char **)realloc (perl_argv,
+		perl_argv = realloc (perl_argv,
 				(++perl_argc + 1) * sizeof (char *));
 
 		if (NULL == perl_argv) {
 			log_err ("perl_config: Not enough memory.");
 			exit (3);
 		}
 
-		perl_argv[perl_argc - 1] = (char *)smalloc (strlen (value) + 3);
+		perl_argv[perl_argc - 1] = smalloc (strlen (value) + 3);
 		sstrncpy(perl_argv[perl_argc - 1], "-I", 3);
 		sstrncpy(perl_argv[perl_argc - 1] + 2, value, strlen (value) + 1);
 
 		perl_argv[perl_argc] = NULL;
 	}
 	else {
@@ -2570,17 +2542,16 @@
 	return ret;
 } /* static int perl_config_plugin (oconfig_item_it *) */
 
 static int perl_config (oconfig_item_t *ci)
 {
 	int status = 0;
-	int i = 0;
 
 	dTHXa (NULL);
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 		int current_status = 0;
 
 		if (NULL != perl_threads)
 		{
 			if ((aTHX = PERL_GET_CONTEXT) == NULL)
@@ -2615,13 +2586,13 @@
 	return status;
 } /* static int perl_config (oconfig_item_t *) */
 
 void module_register (void)
 {
 	perl_argc = 4;
-	perl_argv = (char **)smalloc ((perl_argc + 1) * sizeof (char *));
+	perl_argv = smalloc ((perl_argc + 1) * sizeof (*perl_argv));
 
 	/* default options for the Perl interpreter */
 	perl_argv[0] = "";
 	perl_argv[1] = "-MCollectd";
 	perl_argv[2] = "-e";
 	perl_argv[3] = "1";
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pf.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pf.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pf.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pf.c	2016-09-11 16:10:25.267038716 +0800
@@ -23,15 +24,12 @@
 #include "plugin.h"
 #include "common.h"
 
 #if HAVE_SYS_IOCTL_H
 # include <sys/ioctl.h>
 #endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NET_IF_H
 # include <net/if.h>
 #endif
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
@@ -82,54 +80,51 @@
 
 static int pf_read (void)
 {
 	struct pf_status state;
 	int fd;
 	int status;
-	int i;
 
 	fd = open (pf_device, O_RDONLY);
 	if (fd < 0)
 	{
 		char errbuf[1024];
 		ERROR("pf plugin: Unable to open %s: %s",
 				pf_device,
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	memset (&state, 0, sizeof (state));
 	status = ioctl (fd, DIOCGETSTATUS, &state);
 	if (status != 0)
 	{
 		char errbuf[1024];
 		ERROR("pf plugin: ioctl(DIOCGETSTATUS) failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		close(fd);
 		return (-1);
 	}
 
 	close (fd);
-	fd = -1;
 
 	if (!state.running)
 	{
 		WARNING ("pf plugin: PF is not running.");
 		return (-1);
 	}
 
-	for (i = 0; i < PFRES_MAX; i++)
+	for (int i = 0; i < PFRES_MAX; i++)
 		pf_submit ("pf_counters", pf_reasons[i], state.counters[i],
 				/* is gauge = */ 0);
-	for (i = 0; i < LCNT_MAX; i++)
+	for (int i = 0; i < LCNT_MAX; i++)
 		pf_submit ("pf_limits", pf_lcounters[i], state.lcounters[i],
 				/* is gauge = */ 0);
-	for (i = 0; i < FCNT_MAX; i++)
+	for (int i = 0; i < FCNT_MAX; i++)
 		pf_submit ("pf_state", pf_fcounters[i], state.fcounters[i],
 				/* is gauge = */ 0);
-	for (i = 0; i < SCNT_MAX; i++)
+	for (int i = 0; i < SCNT_MAX; i++)
 		pf_submit ("pf_source", pf_scounters[i], state.scounters[i],
 				/* is gauge = */ 0);
 
 	pf_submit ("pf_states", "current", (uint32_t) state.states,
 			/* is gauge = */ 1);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pinba.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pinba.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pinba.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pinba.c	2016-09-11 16:10:25.271038709 +0800
@@ -21,18 +21,16 @@
  *   Antony Dovgal <tony at daylessday.org>
  *   Phoenix Kayo <kayo.k11.4 at gmail.com>
  *   Florian Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
-#include <pthread.h>
-#include <sys/socket.h>
 #include <netdb.h>
 #include <poll.h>
 
 #include "pinba.pb-c.h"
 
 /* AIX doesn't have MSG_DONTWAIT */
@@ -169,71 +167,71 @@
 static void service_statnode_add(const char *name, /* {{{ */
     const char *host,
     const char *server,
     const char *script)
 {
   pinba_statnode_t *node;
-  
+
   node = realloc (stat_nodes,
       sizeof (*stat_nodes) * (stat_nodes_num + 1));
   if (node == NULL)
   {
     ERROR ("pinba plugin: realloc failed");
     return;
   }
   stat_nodes = node;
 
   node = stat_nodes + stat_nodes_num;
   memset (node, 0, sizeof (*node));
-  
+
   /* reset strings */
   node->name   = NULL;
   node->host   = NULL;
   node->server = NULL;
   node->script = NULL;
 
   node->mem_peak = NAN;
-  
+
   /* fill query data */
   strset (&node->name, name);
   strset (&node->host, host);
   strset (&node->server, server);
   strset (&node->script, script);
-  
+
   /* increment counter */
   stat_nodes_num++;
 } /* }}} void service_statnode_add */
 
 /* Copy the data from the global "stat_nodes" list into the buffer pointed to
  * by "res", doing the derivation in the process. Returns the next index or
  * zero if the end of the list has been reached. */
 static unsigned int service_statnode_collect (pinba_statnode_t *res, /* {{{ */
     unsigned int index)
 {
   pinba_statnode_t *node;
-  
+
   if (stat_nodes_num == 0)
     return 0;
-  
+
   /* begin collecting */
   if (index == 0)
     pthread_mutex_lock (&stat_nodes_lock);
-  
+
   /* end collecting */
   if (index >= stat_nodes_num)
   {
     pthread_mutex_unlock (&stat_nodes_lock);
     return 0;
   }
 
   node = stat_nodes + index;
   memcpy (res, node, sizeof (*res));
 
   /* reset node */
   node->mem_peak = NAN;
-  
+
   return (index + 1);
 } /* }}} unsigned int service_statnode_collect */
 
 static void service_statnode_process (pinba_statnode_t *node, /* {{{ */
     Pinba__Request* request)
 {
@@ -250,17 +248,15 @@
     node->mem_peak = (gauge_t) request->memory_peak;
 
 } /* }}} void service_statnode_process */
 
 static void service_process_request (Pinba__Request *request) /* {{{ */
 {
-  unsigned int i;
-
   pthread_mutex_lock (&stat_nodes_lock);
-  
-  for (i = 0; i < stat_nodes_num; i++)
+
+  for (unsigned int i = 0; i < stat_nodes_num; i++)
   {
     if ((stat_nodes[i].host != NULL)
         && (strcmp (request->hostname, stat_nodes[i].host) != 0))
       continue;
 
     if ((stat_nodes[i].server != NULL)
@@ -270,13 +266,13 @@
     if ((stat_nodes[i].script != NULL)
       && (strcmp (request->script_name, stat_nodes[i].script) != 0))
       continue;
 
     service_statnode_process(&stat_nodes[i], request);
   }
-  
+
   pthread_mutex_unlock(&stat_nodes_lock);
 } /* }}} void service_process_request */
 
 static int pb_del_socket (pinba_socket_t *s, /* {{{ */
     nfds_t index)
 {
@@ -350,57 +346,51 @@
 
 static pinba_socket_t *pinba_socket_open (const char *node, /* {{{ */
     const char *service)
 {
   pinba_socket_t *s;
   struct addrinfo *ai_list;
-  struct addrinfo *ai_ptr;
-  struct addrinfo  ai_hints;
   int status;
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags = AI_PASSIVE;
-  ai_hints.ai_family = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_DGRAM;
-  ai_hints.ai_addr = NULL;
-  ai_hints.ai_canonname = NULL;
-  ai_hints.ai_next = NULL;
-
   if (node == NULL)
     node = PINBA_DEFAULT_NODE;
 
   if (service == NULL)
     service = PINBA_DEFAULT_SERVICE;
 
-  ai_list = NULL;
+  struct addrinfo  ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_PASSIVE,
+    .ai_socktype = SOCK_DGRAM
+  };
+
   status = getaddrinfo (node, service,
       &ai_hints, &ai_list);
   if (status != 0)
   {
     ERROR ("pinba plugin: getaddrinfo(3) failed: %s",
         gai_strerror (status));
     return (NULL);
   }
   assert (ai_list != NULL);
 
-  s = malloc (sizeof (*s));
+  s = calloc (1, sizeof (*s));
   if (s == NULL)
   {
     freeaddrinfo (ai_list);
-    ERROR ("pinba plugin: malloc failed.");
+    ERROR ("pinba plugin: calloc failed.");
     return (NULL);
   }
-  memset (s, 0, sizeof (*s));
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     status = pb_add_socket (s, ai_ptr);
     if (status != 0)
       break;
   } /* for (ai_list) */
-  
+
   freeaddrinfo (ai_list);
 
   if (s->fd_num < 1)
   {
     WARNING ("pinba plugin: Unable to open socket for address %s.", node);
     sfree (s);
@@ -409,41 +399,39 @@
 
   return (s);
 } /* }}} pinba_socket_open */
 
 static void pinba_socket_free (pinba_socket_t *socket) /* {{{ */
 {
-  nfds_t i;
-
   if (!socket)
     return;
-  
-  for (i = 0; i < socket->fd_num; i++)
+
+  for (nfds_t i = 0; i < socket->fd_num; i++)
   {
     if (socket->fd[i].fd < 0)
       continue;
     close (socket->fd[i].fd);
     socket->fd[i].fd = -1;
   }
-  
+
   sfree(socket);
 } /* }}} void pinba_socket_free */
 
 static int pinba_process_stats_packet (const uint8_t *buffer, /* {{{ */
     size_t buffer_size)
 {
-  Pinba__Request *request;  
-  
+  Pinba__Request *request;
+
   request = pinba__request__unpack (NULL, buffer_size, buffer);
-  
+
   if (!request)
     return (-1);
 
   service_process_request(request);
   pinba__request__free_unpacked (request, NULL);
-    
+
   return (0);
 } /* }}} int pinba_process_stats_packet */
 
 static int pinba_udp_read_callback_fn (int sock) /* {{{ */
 {
   uint8_t buffer[PINBA_UDP_BUFFER_SIZE];
@@ -505,13 +493,12 @@
     return (-1);
   }
 
   while (!collector_thread_do_shutdown)
   {
     int status;
-    nfds_t i;
 
     if (s->fd_num < 1)
       break;
 
     status = poll (s->fd, s->fd_num, /* timeout = */ 1000);
     if (status == 0) /* timeout */
@@ -528,13 +515,13 @@
       ERROR ("pinba plugin: poll(2) failed: %s",
           sstrerror (errno, errbuf, sizeof (errbuf)));
       pinba_socket_free (s);
       return (-1);
     }
 
-    for (i = 0; i < s->fd_num; i++)
+    for (nfds_t i = 0; i < s->fd_num; i++)
     {
       if (s->fd[i].revents & (POLLERR | POLLHUP | POLLNVAL))
       {
         pb_del_socket (s, i);
         i--;
       }
@@ -568,19 +555,18 @@
 {
   char *name   = NULL;
   char *host   = NULL;
   char *server = NULL;
   char *script = NULL;
   int status;
-  int i;
 
   status = cf_util_get_string (ci, &name);
   if (status != 0)
     return (status);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       status = cf_util_get_string (child, &host);
     else if (strcasecmp ("Server", child->key) == 0)
@@ -607,19 +593,17 @@
 
   return (status);
 } /* }}} int pinba_config_view */
 
 static int plugin_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-  
   /* The lock should not be necessary in the config callback, but let's be
    * sure.. */
   pthread_mutex_lock (&stat_nodes_lock);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Address", child->key) == 0)
       cf_util_get_string (child, &conf_node);
     else if (strcasecmp ("Port", child->key) == 0)
@@ -628,13 +612,13 @@
       pinba_config_view (child);
     else
       WARNING ("pinba plugin: Unknown config option: %s", child->key);
   }
 
   pthread_mutex_unlock(&stat_nodes_lock);
-  
+
   return (0);
 } /* }}} int pinba_config */
 
 static int plugin_init (void) /* {{{ */
 {
   int status;
@@ -692,29 +676,29 @@
 } /* }}} int plugin_shutdown */
 
 static int plugin_submit (const pinba_statnode_t *res) /* {{{ */
 {
   value_t value;
   value_list_t vl = VALUE_LIST_INIT;
-  
+
   vl.values = &value;
   vl.values_len = 1;
   sstrncpy (vl.host, hostname_g, sizeof (vl.host));
   sstrncpy (vl.plugin, "pinba", sizeof (vl.plugin));
   sstrncpy (vl.plugin_instance, res->name, sizeof (vl.plugin_instance));
 
   value.derive = res->req_count;
-  sstrncpy (vl.type, "total_requests", sizeof (vl.type)); 
+  sstrncpy (vl.type, "total_requests", sizeof (vl.type));
   plugin_dispatch_values (&vl);
 
   value.derive = float_counter_get (&res->req_time, /* factor = */ 1000);
-  sstrncpy (vl.type, "total_time_in_ms", sizeof (vl.type)); 
+  sstrncpy (vl.type, "total_time_in_ms", sizeof (vl.type));
   plugin_dispatch_values (&vl);
 
   value.derive = res->doc_size;
-  sstrncpy (vl.type, "total_bytes", sizeof (vl.type)); 
+  sstrncpy (vl.type, "total_bytes", sizeof (vl.type));
   plugin_dispatch_values (&vl);
 
   value.derive = float_counter_get (&res->ru_utime, /* factor = */ 100);
   sstrncpy (vl.type, "cpu", sizeof (vl.type));
   sstrncpy (vl.type_instance, "user", sizeof (vl.type_instance));
   plugin_dispatch_values (&vl);
@@ -733,18 +717,18 @@
 } /* }}} int plugin_submit */
 
 static int plugin_read (void) /* {{{ */
 {
   unsigned int i=0;
   pinba_statnode_t data;
-  
+
   while ((i = service_statnode_collect (&data, i)) != 0)
   {
     plugin_submit (&data);
   }
-  
+
   return 0;
 } /* }}} int plugin_read */
 
 void module_register (void) /* {{{ */
 {
   plugin_register_complex_config ("pinba", plugin_config);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pinba.proto /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pinba.proto
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pinba.proto	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pinba.proto	2016-09-11 16:10:25.271038709 +0800
@@ -1,6 +1,8 @@
+syntax = "proto2";
+
 package Pinba;
 option optimize_for = SPEED;
 
 message Request {
 	required string hostname		= 1;
 	required string server_name		= 2;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ping.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ping.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ping.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ping.c	2016-09-11 16:10:25.271038709 +0800
@@ -22,23 +22,26 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_complain.h"
 
-#include <pthread.h>
 #include <netinet/in.h>
 #if HAVE_NETDB_H
 # include <netdb.h> /* NI_MAXHOST */
 #endif
 
+#ifdef HAVE_SYS_CAPABILITY_H
+# include <sys/capability.h>
+#endif
+
 #include <oping.h>
 
 #ifndef NI_MAXHOST
 # define NI_MAXHOST 1025
 #endif
 
@@ -70,12 +73,13 @@
 static hostlist_t *hostlist_head = NULL;
 
 static char  *ping_source = NULL;
 #ifdef HAVE_OPING_1_3
 static char  *ping_device = NULL;
 #endif
+static char  *ping_data = NULL;
 static int    ping_ttl = PING_DEF_TTL;
 static double ping_interval = 1.0;
 static double ping_timeout = 0.9;
 static int    ping_max_missed = -1;
 
 static int             ping_thread_loop = 0;
@@ -88,12 +92,13 @@
 {
   "Host",
   "SourceAddress",
 #ifdef HAVE_OPING_1_3
   "Device",
 #endif
+  "Size",
   "TTL",
   "Interval",
   "Timeout",
   "MaxMissed"
 };
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
@@ -147,17 +152,16 @@
 
   time_normalize (ts_dest);
 } /* }}} void time_calc */
 
 static int ping_dispatch_all (pingobj_t *pingobj) /* {{{ */
 {
-  pingobj_iter_t *iter;
   hostlist_t *hl;
   int status;
 
-  for (iter = ping_iterator_get (pingobj);
+  for (pingobj_iter_t *iter = ping_iterator_get (pingobj);
       iter != NULL;
       iter = ping_iterator_next (iter))
   { /* {{{ */
     char userhost[NI_MAXHOST];
     double latency;
     size_t param_size;
@@ -207,13 +211,14 @@
       /* reset missed packages counter */
       hl->pkg_missed = 0;
     } else
       hl->pkg_missed++;
 
     /* if the host did not answer our last N packages, trigger a resolv. */
-    if (ping_max_missed >= 0 && hl->pkg_missed >= ping_max_missed)
+    if ((ping_max_missed >= 0)
+        && (hl->pkg_missed >= ((uint32_t) ping_max_missed)))
     { /* {{{ */
       /* we reset the missed package counter here, since we only want to
        * trigger a resolv every N packages and not every package _AFTER_ N
        * missed packages */
       hl->pkg_missed = 0;
 
@@ -245,13 +250,12 @@
 
   struct timeval  tv_begin;
   struct timeval  tv_end;
   struct timespec ts_wait;
   struct timespec ts_int;
 
-  hostlist_t *hl;
   int count;
 
   c_complain_t complaint = C_COMPLAIN_INIT_STATIC;
 
   pthread_mutex_lock (&ping_lock);
 
@@ -276,15 +280,18 @@
           ping_get_error (pingobj));
 #endif
 
   ping_setopt (pingobj, PING_OPT_TIMEOUT, (void *) &ping_timeout);
   ping_setopt (pingobj, PING_OPT_TTL, (void *) &ping_ttl);
 
+  if (ping_data != NULL)
+    ping_setopt (pingobj, PING_OPT_DATA, (void *) ping_data);
+
   /* Add all the hosts to the ping object. */
   count = 0;
-  for (hl = hostlist_head; hl != NULL; hl = hl->next)
+  for (hostlist_t *hl = hostlist_head; hl != NULL; hl = hl->next)
   {
     int tmp_status;
     tmp_status = ping_host_add (pingobj, hl->host);
     if (tmp_status != 0)
       WARNING ("ping plugin: ping_host_add (%s) failed: %s",
           hl->host, ping_get_error (pingobj));
@@ -441,12 +448,26 @@
   {
     ping_timeout = 0.9 * ping_interval;
     WARNING ("ping plugin: Timeout is greater than interval. "
         "Will use a timeout of %gs.", ping_timeout);
   }
 
+#if defined(HAVE_SYS_CAPABILITY_H) && defined(CAP_NET_RAW)
+  if (check_capability (CAP_NET_RAW) != 0)
+  {
+    if (getuid () == 0)
+      WARNING ("ping plugin: Running collectd as root, but the CAP_NET_RAW "
+          "capability is missing. The plugin's read function will probably "
+          "fail. Is your init system dropping capabilities?");
+    else
+      WARNING ("ping plugin: collectd doesn't have the CAP_NET_RAW capability. "
+          "If you don't want to run collectd as root, try running \"setcap "
+          "cap_net_raw=ep\" on the collectd binary.");
+  }
+#endif
+
   return (start_thread ());
 } /* }}} int ping_init */
 
 static int config_set_string (const char *name, /* {{{ */
     char **var, const char *value)
 {
@@ -471,13 +492,13 @@
 {
   if (strcasecmp (key, "Host") == 0)
   {
     hostlist_t *hl;
     char *host;
 
-    hl = (hostlist_t *) malloc (sizeof (hostlist_t));
+    hl = malloc (sizeof (*hl));
     if (hl == NULL)
     {
       char errbuf[1024];
       ERROR ("ping plugin: malloc failed: %s",
           sstrerror (errno, errbuf, sizeof (errbuf)));
       return (1);
@@ -532,12 +553,43 @@
     if (tmp > 0.0)
       ping_interval = tmp;
     else
       WARNING ("ping plugin: Ignoring invalid interval %g (%s)",
           tmp, value);
   }
+  else if (strcasecmp (key, "Size") == 0) {
+    size_t size = (size_t) atoi (value);
+
+    /* Max IP packet size - (IPv6 + ICMP) = 65535 - (40 + 8) = 65487 */
+    if (size <= 65487)
+    {
+      sfree (ping_data);
+      ping_data = malloc (size + 1);
+      if (ping_data == NULL)
+      {
+        ERROR ("ping plugin: malloc failed.");
+        return (1);
+      }
+
+      /* Note: By default oping is using constant string
+       * "liboping -- ICMP ping library <http://octo.it/liboping/>"
+       * which is exactly 56 bytes.
+       *
+       * Optimally we would follow the ping(1) behaviour, but we
+       * cannot use byte 00 or start data payload at exactly same
+       * location, due to oping library limitations. */
+      for (size_t i = 0; i < size; i++) /* {{{ */
+      {
+        /* This restricts data pattern to be only composed of easily
+         * printable characters, and not NUL character. */
+        ping_data[i] = ('0' + i % 64);
+      }  /* }}} for (i = 0; i < size; i++) */
+      ping_data[size] = 0;
+    } else
+      WARNING ("ping plugin: Ignoring invalid Size %zu.", size);
+  }
   else if (strcasecmp (key, "Timeout") == 0)
   {
     double tmp;
 
     tmp = atof (value);
     if (tmp > 0.0)
@@ -578,34 +630,32 @@
 
   plugin_dispatch_values (&vl);
 } /* }}} void ping_submit */
 
 static int ping_read (void) /* {{{ */
 {
-  hostlist_t *hl;
-
   if (ping_thread_error != 0)
   {
     ERROR ("ping plugin: The ping thread had a problem. Restarting it.");
 
     stop_thread ();
 
-    for (hl = hostlist_head; hl != NULL; hl = hl->next)
+    for (hostlist_t *hl = hostlist_head; hl != NULL; hl = hl->next)
     {
       hl->pkg_sent = 0;
       hl->pkg_recv = 0;
       hl->latency_total = 0.0;
       hl->latency_squared = 0.0;
     }
 
     start_thread ();
 
     return (-1);
   } /* if (ping_thread_error != 0) */
 
-  for (hl = hostlist_head; hl != NULL; hl = hl->next) /* {{{ */
+  for (hostlist_t *hl = hostlist_head; hl != NULL; hl = hl->next) /* {{{ */
   {
     uint32_t pkg_sent;
     uint32_t pkg_recv;
     double latency_total;
     double latency_squared;
 
@@ -683,12 +733,17 @@
     sfree (hl->host);
     sfree (hl);
 
     hl = hl_next;
   }
 
+  if (ping_data != NULL) {
+    free (ping_data);
+    ping_data = NULL;
+  }
+
   return (0);
 } /* }}} int ping_shutdown */
 
 void module_register (void)
 {
   plugin_register_config ("ping", ping_config,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/postgresql.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/postgresql.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/postgresql.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/postgresql.c	2016-09-11 16:10:25.271038709 +0800
@@ -28,25 +28,21 @@
 
 /*
  * This module collects PostgreSQL database statistics.
  */
 
 #include "collectd.h"
+
 #include "common.h"
 
-#include "configfile.h"
 #include "plugin.h"
 
 #include "utils_cache.h"
 #include "utils_db_query.h"
 #include "utils_complain.h"
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
-
 #include <pg_config_manual.h>
 #include <libpq-fe.h>
 
 #define log_err(...) ERROR ("postgresql: " __VA_ARGS__)
 #define log_warn(...) WARNING ("postgresql: " __VA_ARGS__)
 #define log_info(...) INFO ("postgresql: " __VA_ARGS__)
@@ -151,13 +147,13 @@
 
 	char *service;
 
 	int ref_cnt;
 } c_psql_database_t;
 
-static char *def_queries[] = {
+static const char *const def_queries[] = {
 	"backends",
 	"transactions",
 	"queries",
 	"query_plans",
 	"table_states",
 	"disk_io",
@@ -215,19 +211,19 @@
 
 static c_psql_database_t *c_psql_database_new (const char *name)
 {
 	c_psql_database_t **tmp;
 	c_psql_database_t  *db;
 
-	db = (c_psql_database_t *)malloc (sizeof(*db));
+	db = malloc (sizeof(*db));
 	if (NULL == db) {
 		log_err ("Out of memory.");
 		return NULL;
 	}
 
-	tmp = (c_psql_database_t **)realloc (databases,
+	tmp = realloc (databases,
 			(databases_num + 1) * sizeof (*databases));
 	if (NULL == tmp) {
 		log_err ("Out of memory.");
 		sfree (db);
 		return NULL;
 	}
@@ -277,14 +273,12 @@
 	db->ref_cnt    = 0;
 	return db;
 } /* c_psql_database_new */
 
 static void c_psql_database_delete (void *data)
 {
-	size_t i;
-
 	c_psql_database_t *db = data;
 
 	--db->ref_cnt;
 	/* readers and writers may access this database */
 	if (db->ref_cnt > 0)
 		return;
@@ -296,13 +290,13 @@
 		c_psql_commit (db);
 
 	PQfinish (db->conn);
 	db->conn = NULL;
 
 	if (db->q_prep_areas)
-		for (i = 0; i < db->queries_num; ++i)
+		for (size_t i = 0; i < db->queries_num; ++i)
 			udb_query_delete_preparation_area (db->q_prep_areas[i]);
 	free (db->q_prep_areas);
 
 	sfree (db->queries);
 	db->queries_num = 0;
 
@@ -426,22 +420,21 @@
 	return PQexec (db->conn, udb_query_get_statement (q));
 } /* c_psql_exec_query_noparams */
 
 static PGresult *c_psql_exec_query_params (c_psql_database_t *db,
 		udb_query_t *q, c_psql_user_data_t *data)
 {
-	char *params[db->max_params_num];
-	char  interval[64];
-	int   i;
+	const char *params[db->max_params_num];
+	char        interval[64];
 
 	if ((data == NULL) || (data->params_num == 0))
 		return (c_psql_exec_query_noparams (db, q));
 
 	assert (db->max_params_num >= data->params_num);
 
-	for (i = 0; i < data->params_num; ++i) {
+	for (int i = 0; i < data->params_num; ++i) {
 		switch (data->params[i]) {
 			case C_PSQL_PARAM_HOST:
 				params[i] = C_PSQL_IS_UNIX_DOMAIN_SOCKET (db->host)
 					? "localhost" : db->host;
 				break;
 			case C_PSQL_PARAM_DB:
@@ -484,13 +477,12 @@
 	char **column_names;
 	char **column_values;
 	int    column_num;
 
 	int rows_num;
 	int status;
-	int row, col;
 
 	/* The user data may hold parameter information, but may be NULL. */
 	data = udb_query_get_user_data (q);
 
 	/* Versions up to `3' don't know how to handle parameters. */
 	if (3 <= db->proto_version)
@@ -552,14 +544,14 @@
 
 	column_values = (char **) calloc (column_num, sizeof (char *));
 	if (NULL == column_values) {
 		log_err ("calloc failed.");
 		BAIL_OUT (-1);
 	}
-	
-	for (col = 0; col < column_num; ++col) {
+
+	for (int col = 0; col < column_num; ++col) {
 		/* Pointers returned by `PQfname' are freed by `PQclear' via
 		 * `BAIL_OUT'. */
 		column_names[col] = PQfname (res, col);
 		if (NULL == column_names[col]) {
 			log_err ("Failed to resolve name of column %i.", col);
 			BAIL_OUT (-1);
@@ -578,13 +570,14 @@
 	if (0 != status) {
 		log_err ("udb_query_prepare_result failed with status %i.",
 				status);
 		BAIL_OUT (-1);
 	}
 
-	for (row = 0; row < rows_num; ++row) {
+	for (int row = 0; row < rows_num; ++row) {
+        int col;
 		for (col = 0; col < column_num; ++col) {
 			/* Pointers returned by `PQgetvalue' are freed by `PQclear' via
 			 * `BAIL_OUT'. */
 			column_values[col] = PQgetvalue (res, row, col);
 			if (NULL == column_values[col]) {
 				log_err ("Failed to get value at (row = %i, col = %i).",
@@ -612,13 +605,12 @@
 
 static int c_psql_read (user_data_t *ud)
 {
 	c_psql_database_t *db;
 
 	int success = 0;
-	int i;
 
 	if ((ud == NULL) || (ud->data == NULL)) {
 		log_err ("c_psql_read: Invalid user data.");
 		return -1;
 	}
 
@@ -632,13 +624,13 @@
 
 	if (0 != c_psql_check_connection (db)) {
 		pthread_mutex_unlock (&db->db_lock);
 		return -1;
 	}
 
-	for (i = 0; i < db->queries_num; ++i)
+	for (size_t i = 0; i < db->queries_num; ++i)
 	{
 		udb_query_preparation_area_t *prep_area;
 		udb_query_t *q;
 
 		prep_area = db->q_prep_areas[i];
 		q = db->queries[i];
@@ -661,18 +653,16 @@
 static char *values_name_to_sqlarray (const data_set_t *ds,
 		char *string, size_t string_len)
 {
 	char  *str_ptr;
 	size_t str_len;
 
-	int i;
-
 	str_ptr = string;
 	str_len = string_len;
 
-	for (i = 0; i < ds->ds_num; ++i) {
+	for (size_t i = 0; i < ds->ds_num; ++i) {
 		int status = ssnprintf (str_ptr, str_len, ",'%s'", ds->ds[i].name);
 
 		if (status < 1)
 			return NULL;
 		else if ((size_t)status >= str_len) {
 			str_len = 0;
@@ -700,18 +690,16 @@
 static char *values_type_to_sqlarray (const data_set_t *ds,
 		char *string, size_t string_len, _Bool store_rates)
 {
 	char  *str_ptr;
 	size_t str_len;
 
-	int i;
-
 	str_ptr = string;
 	str_len = string_len;
 
-	for (i = 0; i < ds->ds_num; ++i) {
+	for (size_t i = 0; i < ds->ds_num; ++i) {
 		int status;
 
 		if (store_rates)
 			status = ssnprintf(str_ptr, str_len, ",'gauge'");
 		else
 			status = ssnprintf(str_ptr, str_len, ",'%s'",
@@ -749,18 +737,16 @@
 {
 	char  *str_ptr;
 	size_t str_len;
 
 	gauge_t *rates = NULL;
 
-	int i;
-
 	str_ptr = string;
 	str_len = string_len;
 
-	for (i = 0; i < vl->values_len; ++i) {
+	for (size_t i = 0; i < vl->values_len; ++i) {
 		int status = 0;
 
 		if ((ds->ds[i].type != DS_TYPE_GAUGE)
 				&& (ds->ds[i].type != DS_TYPE_COUNTER)
 				&& (ds->ds[i].type != DS_TYPE_DERIVE)
 				&& (ds->ds[i].type != DS_TYPE_ABSOLUTE)) {
@@ -826,33 +812,32 @@
 
 static int c_psql_write (const data_set_t *ds, const value_list_t *vl,
 		user_data_t *ud)
 {
 	c_psql_database_t *db;
 
-	char time_str[32];
+	char time_str[RFC3339NANO_SIZE];
 	char values_name_str[1024];
 	char values_type_str[1024];
 	char values_str[1024];
 
 	const char *params[9];
 
 	int success = 0;
-	int i;
 
 	if ((ud == NULL) || (ud->data == NULL)) {
 		log_err ("c_psql_write: Invalid user data.");
 		return -1;
 	}
 
 	db = ud->data;
 	assert (db->database != NULL);
 	assert (db->writers != NULL);
 
-	if (cdtime_to_iso8601 (time_str, sizeof (time_str), vl->time) == 0) {
-		log_err ("c_psql_write: Failed to convert time to ISO 8601 format");
+	if (rfc3339nano (time_str, sizeof (time_str), vl->time) != 0) {
+		log_err ("c_psql_write: Failed to convert time to RFC 3339 format");
 		return -1;
 	}
 
 	if (values_name_to_sqlarray (ds,
 				values_name_str, sizeof (values_name_str)) == NULL)
 		return -1;
@@ -867,13 +852,13 @@
 	params[5] = VALUE_OR_NULL(vl->type_instance);
 	params[6] = values_name_str;
 
 #undef VALUE_OR_NULL
 
 	if( db->expire_delay > 0 && vl->time < (cdtime() - vl->interval - db->expire_delay) ) {
-		log_info ("c_psql_write: Skipped expired value @ %s - %s/%s-%s/%s-%s/%s", 
+		log_info ("c_psql_write: Skipped expired value @ %s - %s/%s-%s/%s-%s/%s",
 			params[0], params[1], params[2], params[3], params[4], params[5], params[6] );
 		return 0;
         }
 
 	pthread_mutex_lock (&db->db_lock);
 
@@ -883,13 +868,13 @@
 	}
 
 	if ((db->commit_interval > 0)
 			&& (db->next_commit == 0))
 		c_psql_begin (db);
 
-	for (i = 0; i < db->writers_num; ++i) {
+	for (size_t i = 0; i < db->writers_num; ++i) {
 		c_psql_writer_t *writer;
 		PGresult *res;
 
 		writer = db->writers[i];
 
 		if (values_type_to_sqlarray (ds,
@@ -971,20 +956,19 @@
 static int c_psql_flush (cdtime_t timeout,
 		__attribute__((unused)) const char *ident,
 		user_data_t *ud)
 {
 	c_psql_database_t **dbs = databases;
 	size_t dbs_num = databases_num;
-	size_t i;
 
 	if ((ud != NULL) && (ud->data != NULL)) {
 		dbs = (void *)&ud->data;
 		dbs_num = 1;
 	}
 
-	for (i = 0; i < dbs_num; ++i) {
+	for (size_t i = 0; i < dbs_num; ++i) {
 		c_psql_database_t *db = dbs[i];
 
 		/* don't commit if the timeout is larger than the regular commit
 		 * interval as in that case all requested data has already been
 		 * committed */
 		if ((db->next_commit > 0) && (db->commit_interval > timeout))
@@ -992,19 +976,17 @@
 	}
 	return 0;
 } /* c_psql_flush */
 
 static int c_psql_shutdown (void)
 {
-	size_t i = 0;
-
 	_Bool had_flush = 0;
 
 	plugin_unregister_read_group ("postgresql");
 
-	for (i = 0; i < databases_num; ++i) {
+	for (size_t i = 0; i < databases_num; ++i) {
 		c_psql_database_t *db = databases[i];
 
 		if (db->writers_num > 0) {
 			char cb_name[DATA_MAX_NAME_LEN];
 			ssnprintf (cb_name, sizeof (cb_name), "postgresql-%s",
 					db->database);
@@ -1042,18 +1024,17 @@
 	const char *param_str;
 
 	c_psql_param_t *tmp;
 
 	data = udb_query_get_user_data (q);
 	if (NULL == data) {
-		data = malloc (sizeof (*data));
+		data = calloc (1, sizeof (*data));
 		if (NULL == data) {
 			log_err ("Out of memory.");
 			return -1;
 		}
-		memset (data, 0, sizeof (*data));
 		data->params = NULL;
 		data->params_num = 0;
 
 		udb_query_set_user_data (q, data);
 	}
 
@@ -1116,13 +1097,13 @@
 	for (i = 0; i < src_writers_num; ++i) {
 		c_psql_writer_t **tmp;
 
 		if (strcasecmp (name, src_writers[i].name) != 0)
 			continue;
 
-		tmp = (c_psql_writer_t **)realloc (*dst_writers,
+		tmp = realloc (*dst_writers,
 				sizeof (**dst_writers) * (*dst_writers_num + 1));
 		if (tmp == NULL) {
 			log_err ("Out of memory.");
 			return -1;
 		}
 
@@ -1144,21 +1125,20 @@
 static int c_psql_config_writer (oconfig_item_t *ci)
 {
 	c_psql_writer_t *writer;
 	c_psql_writer_t *tmp;
 
 	int status = 0;
-	int i;
 
 	if ((ci->values_num != 1)
 			|| (ci->values[0].type != OCONFIG_TYPE_STRING)) {
 		log_err ("<Writer> expects a single string argument.");
 		return 1;
 	}
 
-	tmp = (c_psql_writer_t *)realloc (writers,
+	tmp = realloc (writers,
 			sizeof (*writers) * (writers_num + 1));
 	if (tmp == NULL) {
 		log_err ("Out of memory.");
 		return -1;
 	}
 
@@ -1167,13 +1147,13 @@
 	memset (writer, 0, sizeof (*writer));
 
 	writer->name = sstrdup (ci->values[0].value.string);
 	writer->statement = NULL;
 	writer->store_rates = 1;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (strcasecmp ("Statement", c->key) == 0)
 			status = cf_util_get_string (c, &writer->statement);
 		else if (strcasecmp ("StoreRates", c->key) == 0)
 			status = cf_util_get_boolean (c, &writer->store_rates);
@@ -1193,32 +1173,25 @@
 
 static int c_psql_config_database (oconfig_item_t *ci)
 {
 	c_psql_database_t *db;
 
 	char cb_name[DATA_MAX_NAME_LEN];
-	struct timespec cb_interval = { 0, 0 };
-	user_data_t ud;
-
 	static _Bool have_flush = 0;
 
-	int i;
-
 	if ((1 != ci->values_num)
 			|| (OCONFIG_TYPE_STRING != ci->values[0].type)) {
 		log_err ("<Database> expects a single string argument.");
 		return 1;
 	}
 
-	memset (&ud, 0, sizeof (ud));
-
 	db = c_psql_database_new (ci->values[0].value.string);
 	if (db == NULL)
 		return -1;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "Host"))
 			cf_util_get_string (c, &db->host);
 		else if (0 == strcasecmp (c->key, "Port"))
 			cf_util_get_service (c, &db->port);
@@ -1249,13 +1222,13 @@
 		else
 			log_warn ("Ignoring unknown config key \"%s\".", c->key);
 	}
 
 	/* If no `Query' options were given, add the default queries.. */
 	if ((db->queries_num == 0) && (db->writers_num == 0)){
-		for (i = 0; i < def_queries_num; i++)
+		for (int i = 0; i < def_queries_num; i++)
 			udb_query_pick_from_list_by_name (def_queries[i],
 					queries, queries_num,
 					&db->queries, &db->queries_num);
 	}
 
 	if (db->queries_num > 0) {
@@ -1266,13 +1239,13 @@
 			log_err ("Out of memory.");
 			c_psql_database_delete (db);
 			return -1;
 		}
 	}
 
-	for (i = 0; (size_t)i < db->queries_num; ++i) {
+	for (int i = 0; (size_t)i < db->queries_num; ++i) {
 		c_psql_user_data_t *data;
 		data = udb_query_get_user_data (db->queries[i]);
 		if ((data != NULL) && (data->params_num > db->max_params_num))
 			db->max_params_num = data->params_num;
 
 		db->q_prep_areas[i]
@@ -1282,24 +1255,23 @@
 			log_err ("Out of memory.");
 			c_psql_database_delete (db);
 			return -1;
 		}
 	}
 
-	ud.data = db;
-	ud.free_func = c_psql_database_delete;
-
 	ssnprintf (cb_name, sizeof (cb_name), "postgresql-%s", db->instance);
 
-	if (db->queries_num > 0) {
-		CDTIME_T_TO_TIMESPEC (db->interval, &cb_interval);
+	user_data_t ud = {
+		.data = db,
+		.free_func = c_psql_database_delete
+	};
 
+	if (db->queries_num > 0) {
 		++db->ref_cnt;
 		plugin_register_complex_read ("postgresql", cb_name, c_psql_read,
-				/* interval = */ (db->interval > 0) ? &cb_interval : NULL,
-				&ud);
+				/* interval = */ db->interval, &ud);
 	}
 	if (db->writers_num > 0) {
 		++db->ref_cnt;
 		plugin_register_write (cb_name, c_psql_write, &ud);
 
 		if (! have_flush) {
@@ -1322,14 +1294,12 @@
 } /* c_psql_config_database */
 
 static int c_psql_config (oconfig_item_t *ci)
 {
 	static int have_def_config = 0;
 
-	int i;
-
 	if (0 == have_def_config) {
 		oconfig_item_t *c;
 
 		have_def_config = 1;
 
 		c = oconfig_parse_file (C_PSQL_DEFAULT_CONF);
@@ -1340,13 +1310,13 @@
 
 		if (NULL == queries)
 			log_err ("Default config ("C_PSQL_DEFAULT_CONF") did not define "
 					"any queries - please check your installation.");
 	}
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "Query"))
 			udb_query_create (&queries, &queries_num, c,
 					/* callback = */ config_query_callback);
 		else if (0 == strcasecmp (c->key, "Writer"))
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/postgresql_default.conf /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/postgresql_default.conf
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/postgresql_default.conf	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/postgresql_default.conf	2016-09-11 16:10:25.271038709 +0800
@@ -156,16 +156,16 @@
 	</Result>
 
 	MinVersion 80300
 </Query>
 
 <Query query_plans>
-	Statement "SELECT coalesce(sum(seq_scan), 0) AS seq, \
-			  coalesce(sum(seq_tup_read), 0) AS seq_tup_read, \
-			  coalesce(sum(idx_scan), 0) AS idx, \
-			  coalesce(sum(idx_tup_fetch), 0) AS idx_tup_fetch \
+	Statement "SELECT sum(seq_scan) AS seq, \
+			sum(seq_tup_read) AS seq_tup_read, \
+			sum(idx_scan) AS idx, \
+			sum(idx_tup_fetch) AS idx_tup_fetch \
 		FROM pg_stat_user_tables;"
 
 	<Result>
 		Type "pg_scan"
 		InstancePrefix "seq"
 		ValuesFrom "seq"
@@ -204,16 +204,16 @@
 
 	MinVersion 80300
 </Query>
 
 <Query query_plans_by_table>
 	Statement "SELECT schemaname, relname, \
-			coalesce(seq_scan, 0) AS seq, \
-			coalesce(seq_tup_read, 0) AS seq_tup_read, \
-			coalesce(idx_scan, 0) AS idx, \
-			coalesce(idx_tup_fetch, 0) AS idx_tup_fetch \
+			seq_scan AS seq, \
+			seq_tup_read AS seq_tup_read, \
+			idx_scan AS idx, \
+			idx_tup_fetch AS idx_tup_fetch \
 		FROM pg_stat_user_tables;"
 
 	<Result>
 		Type "pg_scan"
 		InstancePrefix "seq"
 		InstancesFrom "schemaname" "relname"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/powerdns.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/powerdns.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/powerdns.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/powerdns.c	2016-09-11 16:10:25.271038709 +0800
@@ -22,25 +22,24 @@
  *
  * DESCRIPTION
  *   Queries a PowerDNS control socket for statistics
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_llist.h"
 
 #include <sys/stat.h>
 #include <unistd.h>
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <sys/un.h>
 
 #ifndef UNIX_PATH_MAX
 # define UNIX_PATH_MAX sizeof (((struct sockaddr_un *)0)->sun_path)
 #endif
 #define FUNC_ERROR(func) do { char errbuf[1024]; ERROR ("powerdns plugin: %s failed: %s", func, sstrerror (errno, errbuf, sizeof (errbuf))); } while (0)
@@ -48,13 +47,13 @@
 #define SERVER_SOCKET  LOCALSTATEDIR"/run/pdns.controlsocket"
 #define SERVER_COMMAND "SHOW * \n"
 
 #define RECURSOR_SOCKET  LOCALSTATEDIR"/run/pdns_recursor.controlsocket"
 #define RECURSOR_COMMAND "get noerror-answers nxdomain-answers " \
   "servfail-answers sys-msec user-msec qa-latency cache-entries cache-hits " \
-  "cache-misses questions \n"
+  "cache-misses questions\n"
 
 struct list_item_s;
 typedef struct list_item_s list_item_t;
 
 struct list_item_s
 {
@@ -73,58 +72,81 @@
   struct sockaddr_un sockaddr;
   int socktype;
 };
 
 struct statname_lookup_s
 {
-  char *name;
-  char *type;
-  char *type_instance;
+  const char *name;
+  const char *type;
+  const char *type_instance;
 };
 typedef struct statname_lookup_s statname_lookup_t;
 
 /* Description of statistics returned by the recursor: {{{
-all-outqueries      counts the number of outgoing UDP queries since starting
-answers0-1          counts the number of queries answered within 1 millisecond
-answers100-1000     counts the number of queries answered within 1 second
-answers10-100       counts the number of queries answered within 100 milliseconds
-answers1-10         counts the number of queries answered within 10 milliseconds
-answers-slow        counts the number of queries answered after 1 second
-cache-entries       shows the number of entries in the cache
-cache-hits          counts the number of cache hits since starting
-cache-misses        counts the number of cache misses since starting
-chain-resends       number of queries chained to existing outstanding query
-client-parse-errors counts number of client packets that could not be parsed
-concurrent-queries  shows the number of MThreads currently running
-dlg-only-drops      number of records dropped because of delegation only setting
-negcache-entries    shows the number of entries in the Negative answer cache
-noerror-answers     counts the number of times it answered NOERROR since starting
-nsspeeds-entries    shows the number of entries in the NS speeds map
-nsset-invalidations number of times an nsset was dropped because it no longer worked
-nxdomain-answers    counts the number of times it answered NXDOMAIN since starting
-outgoing-timeouts   counts the number of timeouts on outgoing UDP queries since starting
-qa-latency          shows the current latency average
-questions           counts all End-user initiated queries with the RD bit set
-resource-limits     counts number of queries that could not be performed because of resource limits
-server-parse-errors counts number of server replied packets that could not be parsed
-servfail-answers    counts the number of times it answered SERVFAIL since starting
-spoof-prevents      number of times PowerDNS considered itself spoofed, and dropped the data
-sys-msec            number of CPU milliseconds spent in 'system' mode
-tcp-client-overflow number of times an IP address was denied TCP access because it already had too many connections
-tcp-outqueries      counts the number of outgoing TCP queries since starting
-tcp-questions       counts all incoming TCP queries (since starting)
-throttled-out       counts the number of throttled outgoing UDP queries since starting
-throttle-entries    shows the number of entries in the throttle map
-unauthorized-tcp    number of TCP questions denied because of allow-from restrictions
-unauthorized-udp    number of UDP questions denied because of allow-from restrictions
-unexpected-packets  number of answers from remote servers that were unexpected (might point to spoofing)
-uptime              number of seconds process has been running (since 3.1.5)
-user-msec           number of CPU milliseconds spent in 'user' mode
+all-outqueries        counts the number of outgoing UDP queries since starting
+answers-slow          counts the number of queries answered after 1 second
+answers0-1            counts the number of queries answered within 1 millisecond
+answers1-10           counts the number of queries answered within 10 milliseconds
+answers10-100         counts the number of queries answered within 100 milliseconds
+answers100-1000       counts the number of queries answered within 1 second
+cache-bytes           size of the cache in bytes (since 3.3.1)
+cache-entries         shows the number of entries in the cache
+cache-hits            counts the number of cache hits since starting, this does not include hits that got answered from the packet-cache
+cache-misses          counts the number of cache misses since starting
+case-mismatches       counts the number of mismatches in character case since starting
+chain-resends         number of queries chained to existing outstanding query
+client-parse-errors   counts number of client packets that could not be parsed
+concurrent-queries    shows the number of MThreads currently running
+dlg-only-drops        number of records dropped because of delegation only setting
+dont-outqueries       number of outgoing queries dropped because of 'dont-query' setting (since 3.3)
+edns-ping-matches     number of servers that sent a valid EDNS PING respons
+edns-ping-mismatches  number of servers that sent an invalid EDNS PING response
+failed-host-entries   number of servers that failed to resolve
+ipv6-outqueries       number of outgoing queries over IPv6
+ipv6-questions        counts all End-user initiated queries with the RD bit set, received over IPv6 UDP
+malloc-bytes          returns the number of bytes allocated by the process (broken, always returns 0)
+max-mthread-stack     maximum amount of thread stack ever used
+negcache-entries      shows the number of entries in the Negative answer cache
+no-packet-error       number of errorneous received packets
+noedns-outqueries     number of queries sent out without EDNS
+noerror-answers       counts the number of times it answered NOERROR since starting
+noping-outqueries     number of queries sent out without ENDS PING
+nsset-invalidations   number of times an nsset was dropped because it no longer worked
+nsspeeds-entries      shows the number of entries in the NS speeds map
+nxdomain-answers      counts the number of times it answered NXDOMAIN since starting
+outgoing-timeouts     counts the number of timeouts on outgoing UDP queries since starting
+over-capacity-drops   questions dropped because over maximum concurrent query limit (since 3.2)
+packetcache-bytes     size of the packet cache in bytes (since 3.3.1)
+packetcache-entries   size of packet cache (since 3.2)
+packetcache-hits      packet cache hits (since 3.2)
+packetcache-misses    packet cache misses (since 3.2)
+policy-drops          packets dropped because of (Lua) policy decision
+qa-latency            shows the current latency average
+questions             counts all end-user initiated queries with the RD bit set
+resource-limits       counts number of queries that could not be performed because of resource limits
+security-status       security status based on security polling
+server-parse-errors   counts number of server replied packets that could not be parsed
+servfail-answers      counts the number of times it answered SERVFAIL since starting
+spoof-prevents        number of times PowerDNS considered itself spoofed, and dropped the data
+sys-msec              number of CPU milliseconds spent in 'system' mode
+tcp-client-overflow   number of times an IP address was denied TCP access because it already had too many connections
+tcp-clients           counts the number of currently active TCP/IP clients
+tcp-outqueries        counts the number of outgoing TCP queries since starting
+tcp-questions         counts all incoming TCP queries (since starting)
+throttle-entries      shows the number of entries in the throttle map
+throttled-out         counts the number of throttled outgoing UDP queries since starting
+throttled-outqueries  idem to throttled-out
+unauthorized-tcp      number of TCP questions denied because of allow-from restrictions
+unauthorized-udp      number of UDP questions denied because of allow-from restrictions
+unexpected-packets    number of answers from remote servers that were unexpected (might point to spoofing)
+unreachables          number of times nameservers were unreachable since starting
+uptime                number of seconds process has been running (since 3.1.5)
+user-msec             number of CPU milliseconds spent in 'user' mode
 }}} */
 
-const char* const default_server_fields[] = /* {{{ */
+static const char* const default_server_fields[] = /* {{{ */
 {
   "latency",
   "packetcache-hit",
   "packetcache-miss",
   "packetcache-size",
   "query-cache-hit",
@@ -133,15 +155,15 @@
   "recursing-questions",
   "tcp-answers",
   "tcp-queries",
   "udp-answers",
   "udp-queries",
 }; /* }}} */
-int default_server_fields_num = STATIC_ARRAY_SIZE (default_server_fields);
+static int default_server_fields_num = STATIC_ARRAY_SIZE (default_server_fields);
 
-statname_lookup_t lookup_table[] = /* {{{ */
+static statname_lookup_t lookup_table[] = /* {{{ */
 {
   /*********************
    * Server statistics *
    *********************/
   /* Questions */
   {"recursing-questions",    "dns_question", "recurse"},
@@ -154,14 +176,19 @@
   {"tcp-answers",            "dns_answer",   "tcp"},
   {"udp-answers",            "dns_answer",   "udp"},
   {"recursion-unanswered",   "dns_answer",   "recursion-unanswered"},
   {"udp-answers-bytes",      "total_bytes",  "udp-answers-bytes"},
 
   /* Cache stuff */
+  {"cache-bytes",            "cache_size",   "cache-bytes"},
+  {"packetcache-bytes",      "cache_size",   "packet-bytes"},
+  {"packetcache-entries",    "cache_size",   "packet-entries"},
   {"packetcache-hit",        "cache_result", "packet-hit"},
+  {"packetcache-hits",       "cache_result", "packet-hit"},
   {"packetcache-miss",       "cache_result", "packet-miss"},
+  {"packetcache-misses",     "cache_result", "packet-miss"},
   {"packetcache-size",       "cache_size",   "packet"},
   {"key-cache-size",         "cache_size",   "key"},
   {"meta-cache-size",        "cache_size",   "meta"},
   {"signature-cache-size",   "cache_size",   "signature"},
   {"query-cache-hit",        "cache_result", "query-hit"},
   {"query-cache-miss",       "cache_result", "query-miss"},
@@ -176,12 +203,13 @@
   {"dnsupdate-refused",      "dns_answer",   "dnsupdate-refused"},
 
   /* Other stuff.. */
   {"corrupt-packets",        "ipt_packets",  "corrupt"},
   {"deferred-cache-inserts", "counter",      "cache-deferred_insert"},
   {"deferred-cache-lookup",  "counter",      "cache-deferred_lookup"},
+  {"dont-outqueries",        "dns_question", "dont-outqueries"},
   {"qsize-a",                "cache_size",   "answers"},
   {"qsize-q",                "cache_size",   "questions"},
   {"servfail-packets",       "ipt_packets",  "servfail"},
   {"timedout-packets",       "ipt_packets",  "timeout"},
   {"udp4-answers",           "dns_answer",   "udp4"},
   {"udp4-queries",           "dns_question", "queries-udp4"},
@@ -192,75 +220,88 @@
   {"signatures",             "counter",      "signatures"},
 
   /***********************
    * Recursor statistics *
    ***********************/
   /* Answers by return code */
-  {"noerror-answers",     "dns_rcode",    "NOERROR"},
-  {"nxdomain-answers",    "dns_rcode",    "NXDOMAIN"},
-  {"servfail-answers",    "dns_rcode",    "SERVFAIL"},
+  {"noerror-answers",      "dns_rcode",    "NOERROR"},
+  {"nxdomain-answers",     "dns_rcode",    "NXDOMAIN"},
+  {"servfail-answers",     "dns_rcode",    "SERVFAIL"},
 
   /* CPU utilization */
-  {"sys-msec",            "cpu",          "system"},
-  {"user-msec",           "cpu",          "user"},
+  {"sys-msec",             "cpu",          "system"},
+  {"user-msec",            "cpu",          "user"},
 
   /* Question-to-answer latency */
-  {"qa-latency",          "latency",      NULL},
+  {"qa-latency",           "latency",      NULL},
 
   /* Cache */
-  {"cache-entries",       "cache_size",   NULL},
-  {"cache-hits",          "cache_result", "hit"},
-  {"cache-misses",        "cache_result", "miss"},
+  {"cache-entries",        "cache_size",   NULL},
+  {"cache-hits",           "cache_result", "hit"},
+  {"cache-misses",         "cache_result", "miss"},
 
   /* Total number of questions.. */
-  {"questions",           "dns_qtype",    "total"},
+  {"questions",            "dns_qtype",    "total"},
 
   /* All the other stuff.. */
-  {"all-outqueries",      "dns_question", "outgoing"},
-  {"answers0-1",          "dns_answer",   "0_1"},
-  {"answers1-10",         "dns_answer",   "1_10"},
-  {"answers10-100",       "dns_answer",   "10_100"},
-  {"answers100-1000",     "dns_answer",   "100_1000"},
-  {"answers-slow",        "dns_answer",   "slow"},
-  {"chain-resends",       "dns_question", "chained"},
-  {"client-parse-errors", "counter",      "drops-client_parse_error"},
-  {"concurrent-queries",  "dns_question", "concurrent"},
-  {"dlg-only-drops",      "counter",      "drops-delegation_only"},
-  {"negcache-entries",    "cache_size",   "negative"},
-  {"nsspeeds-entries",    "gauge",        "entries-ns_speeds"},
-  {"nsset-invalidations", "counter",      "ns_set_invalidation"},
-  {"outgoing-timeouts",   "counter",      "drops-timeout_outgoing"},
-  {"resource-limits",     "counter",      "drops-resource_limit"},
-  {"server-parse-errors", "counter",      "drops-server_parse_error"},
-  {"spoof-prevents",      "counter",      "drops-spoofed"},
-  {"tcp-client-overflow", "counter",      "denied-client_overflow_tcp"},
-  {"tcp-outqueries",      "dns_question", "outgoing-tcp"},
-  {"tcp-questions",       "dns_question", "incoming-tcp"},
-  {"throttled-out",       "dns_question", "outgoing-throttled"},
-  {"throttle-entries",    "gauge",        "entries-throttle"},
-  {"unauthorized-tcp",    "counter",      "denied-unauthorized_tcp"},
-  {"unauthorized-udp",    "counter",      "denied-unauthorized_udp"},
-  {"unexpected-packets",  "dns_answer",   "unexpected"},
-  {"uptime",              "uptime",       NULL}
+  {"all-outqueries",       "dns_question", "outgoing"},
+  {"answers0-1",           "dns_answer",   "0_1"},
+  {"answers1-10",          "dns_answer",   "1_10"},
+  {"answers10-100",        "dns_answer",   "10_100"},
+  {"answers100-1000",      "dns_answer",   "100_1000"},
+  {"answers-slow",         "dns_answer",   "slow"},
+  {"case-mismatches",      "counter",      "case_mismatches"},
+  {"chain-resends",        "dns_question", "chained"},
+  {"client-parse-errors",  "counter",      "drops-client_parse_error"},
+  {"concurrent-queries",   "dns_question", "concurrent"},
+  {"dlg-only-drops",       "counter",      "drops-delegation_only"},
+  {"edns-ping-matches",    "counter",      "edns-ping_matches"},
+  {"edns-ping-mismatches", "counter",      "edns-ping_mismatches"},
+  {"failed-host-entries",  "counter",      "entries-failed_host"},
+  {"ipv6-outqueries",      "dns_question", "outgoing-ipv6"},
+  {"ipv6-questions",       "dns_question", "incoming-ipv6"},
+  {"malloc-bytes",         "gauge",        "malloc_bytes"},
+  {"max-mthread-stack",    "gauge",        "max_mthread_stack"},
+  {"no-packet-error",      "gauge",        "no_packet_error"},
+  {"noedns-outqueries",    "dns_question", "outgoing-noedns"},
+  {"noping-outqueries",    "dns_question", "outgoing-noping"},
+  {"over-capacity-drops",  "dns_question", "incoming-over_capacity"},
+  {"negcache-entries",     "cache_size",   "negative"},
+  {"nsspeeds-entries",     "gauge",        "entries-ns_speeds"},
+  {"nsset-invalidations",  "counter",      "ns_set_invalidation"},
+  {"outgoing-timeouts",    "counter",      "drops-timeout_outgoing"},
+  {"policy-drops",         "counter",      "drops-policy"},
+  {"resource-limits",      "counter",      "drops-resource_limit"},
+  {"server-parse-errors",  "counter",      "drops-server_parse_error"},
+  {"spoof-prevents",       "counter",      "drops-spoofed"},
+  {"tcp-client-overflow",  "counter",      "denied-client_overflow_tcp"},
+  {"tcp-clients",          "gauge",        "clients-tcp"},
+  {"tcp-outqueries",       "dns_question", "outgoing-tcp"},
+  {"tcp-questions",        "dns_question", "incoming-tcp"},
+  {"throttled-out",        "dns_question", "outgoing-throttled"},
+  {"throttle-entries",     "gauge",        "entries-throttle"},
+  {"throttled-outqueries", "dns_question", "outgoing-throttle"},
+  {"unauthorized-tcp",     "counter",      "denied-unauthorized_tcp"},
+  {"unauthorized-udp",     "counter",      "denied-unauthorized_udp"},
+  {"unexpected-packets",   "dns_answer",   "unexpected"},
+  {"uptime",               "uptime",       NULL}
 }; /* }}} */
-int lookup_table_length = STATIC_ARRAY_SIZE (lookup_table);
+static int lookup_table_length = STATIC_ARRAY_SIZE (lookup_table);
 
 static llist_t *list = NULL;
 
 #define PDNS_LOCAL_SOCKPATH LOCALSTATEDIR"/run/"PACKAGE_NAME"-powerdns"
 static char *local_sockpath = NULL;
 
 /* TODO: Do this before 4.4:
- * - Recursor:
- *   - Complete list of known pdns -> collectd mappings.
  * - Update the collectd.conf(5) manpage.
  *
  * -octo
  */
 
-/* <http://doc.powerdns.com/recursor-stats.html> */
+/* <https://doc.powerdns.com/md/recursor/stats/> */
 static void submit (const char *plugin_instance, /* {{{ */
     const char *pdns_type, const char *value)
 {
   value_list_t vl = VALUE_LIST_INIT;
   value_t values[1];
 
@@ -295,13 +336,13 @@
         type);
     return;
   }
 
   if (ds->ds_num != 1)
   {
-    ERROR ("powerdns plugin: type `%s' has %i data sources, "
+    ERROR ("powerdns plugin: type `%s' has %zu data sources, "
         "but I can only handle one.",
         type, ds->ds_num);
     return;
   }
 
   if (0 != parse_value (value, &values[0], ds->ds[0].type))
@@ -331,25 +372,24 @@
   int status;
 
   char temp[4096];
   char *buffer = NULL;
   size_t buffer_size = 0;
 
-  struct sockaddr_un sa_unix;
+  struct sockaddr_un sa_unix = { 0 };
 
   struct timeval stv_timeout;
   cdtime_t cdt_timeout;
 
   sd = socket (PF_UNIX, item->socktype, 0);
   if (sd < 0)
   {
     FUNC_ERROR ("socket");
     return (-1);
   }
 
-  memset (&sa_unix, 0, sizeof (sa_unix));
   sa_unix.sun_family = AF_UNIX;
   sstrncpy (sa_unix.sun_path,
       (local_sockpath != NULL) ? local_sockpath : PDNS_LOCAL_SOCKPATH,
       sizeof (sa_unix.sun_path));
 
   status = unlink (sa_unix.sun_path);
@@ -421,13 +461,13 @@
   unlink (sa_unix.sun_path);
 
   if (status != 0)
     return (-1);
 
   assert (buffer_size > 0);
-  buffer = (char *) malloc (buffer_size);
+  buffer = malloc (buffer_size);
   if (buffer == NULL)
   {
     FUNC_ERROR ("malloc");
     return (-1);
   }
 
@@ -498,13 +538,13 @@
       FUNC_ERROR ("recv");
       break;
     }
     else if (status == 0)
       break;
 
-    buffer_new = (char *) realloc (buffer, buffer_size + status + 1);
+    buffer_new = realloc (buffer, buffer_size + status + 1);
     if (buffer_new == NULL)
     {
       FUNC_ERROR ("realloc");
       status = -1;
       break;
     }
@@ -587,14 +627,12 @@
 
   /* corrupt-packets=0,deferred-cache-inserts=0,deferred-cache-lookup=0,latency=0,packetcache-hit=0,packetcache-miss=0,packetcache-size=0,qsize-q=0,query-cache-hit=0,query-cache-miss=0,recursing-answers=0,recursing-questions=0,servfail-packets=0,tcp-answers=0,tcp-queries=0,timedout-packets=0,udp-answers=0,udp-queries=0,udp4-answers=0,udp4-queries=0,udp6-answers=0,udp6-queries=0, */
   dummy = buffer;
   saveptr = NULL;
   while ((key = strtok_r (dummy, ",", &saveptr)) != NULL)
   {
-    int i;
-
     dummy = NULL;
 
     value = strchr (key, '=');
     if (value == NULL)
       break;
 
@@ -602,12 +640,13 @@
     value++;
 
     if (value[0] == '\0')
       continue;
 
     /* Check if this item was requested. */
+    int i;
     for (i = 0; i < fields_num; i++)
       if (strcasecmp (key, fields[i]) == 0)
 	break;
     if (i >= fields_num)
       continue;
 
@@ -647,18 +686,18 @@
     if (status < 0)
     {
       ERROR ("powerdns plugin: strjoin failed.");
       return (-1);
     }
     buffer[sizeof (buffer) - 1] = 0;
-    int i = strlen (buffer);
-    if (i < sizeof (buffer) - 2)
+    size_t len = strlen (buffer);
+    if (len < sizeof (buffer) - 2)
     {
-      buffer[i++] = ' ';
-      buffer[i++] = '\n';
-      buffer[i++] = '\0';
+      buffer[len++] = ' ';
+      buffer[len++] = '\n';
+      buffer[len++] = '\0';
     }
   }
 
   buffer[sizeof (buffer) - 1] = 0;
   li->command = strdup (buffer);
   if (li->command == NULL)
@@ -737,40 +776,39 @@
   return (0);
 } /* }}} int powerdns_read_recursor */
 
 static int powerdns_config_add_collect (list_item_t *li, /* {{{ */
     oconfig_item_t *ci)
 {
-  int i;
   char **temp;
 
   if (ci->values_num < 1)
   {
     WARNING ("powerdns plugin: The `Collect' option needs "
 	"at least one argument.");
     return (-1);
   }
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("powerdns plugin: Only string arguments are allowed to "
 	  "the `Collect' option.");
       return (-1);
     }
 
-  temp = (char **) realloc (li->fields,
+  temp = realloc (li->fields,
       sizeof (char *) * (li->fields_num + ci->values_num));
   if (temp == NULL)
   {
     WARNING ("powerdns plugin: realloc failed.");
     return (-1);
   }
   li->fields = temp;
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     li->fields[li->fields_num] = strdup (ci->values[i].value.string);
     if (li->fields[li->fields_num] == NULL)
     {
       WARNING ("powerdns plugin: strdup failed.");
       continue;
@@ -787,28 +825,26 @@
 static int powerdns_config_add_server (oconfig_item_t *ci) /* {{{ */
 {
   char *socket_temp;
 
   list_item_t *item;
   int status;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("powerdns plugin: `%s' needs exactly one string argument.",
 	ci->key);
     return (-1);
   }
 
-  item = (list_item_t *) malloc (sizeof (list_item_t));
+  item = calloc (1, sizeof (*item));
   if (item == NULL)
   {
-    ERROR ("powerdns plugin: malloc failed.");
+    ERROR ("powerdns plugin: calloc failed.");
     return (-1);
   }
-  memset (item, '\0', sizeof (list_item_t));
 
   item->instance = strdup (ci->values[0].value.string);
   if (item->instance == NULL)
   {
     ERROR ("powerdns plugin: strdup failed.");
     sfree (item);
@@ -837,13 +873,13 @@
     /* We must never get here.. */
     assert (0);
     return (-1);
   }
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Collect", option->key) == 0)
       status = powerdns_config_add_collect (item, option);
     else if (strcasecmp ("Socket", option->key) == 0)
@@ -897,14 +933,12 @@
   sfree (socket_temp);
   return (0);
 } /* }}} int powerdns_config_add_server */
 
 static int powerdns_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
   DEBUG ("powerdns plugin: powerdns_config (ci = %p);", (void *) ci);
 
   if (list == NULL)
   {
     list = llist_create ();
 
@@ -912,13 +946,13 @@
     {
       ERROR ("powerdns plugin: `llist_create' failed.");
       return (-1);
     }
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if ((strcasecmp ("Server", option->key) == 0)
 	|| (strcasecmp ("Recursor", option->key) == 0))
       powerdns_config_add_server (option);
@@ -945,31 +979,27 @@
 
   return (0);
 } /* }}} int powerdns_config */
 
 static int powerdns_read (void)
 {
-  llentry_t *e;
-
-  for (e = llist_head (list); e != NULL; e = e->next)
+  for (llentry_t *e = llist_head (list); e != NULL; e = e->next)
   {
     list_item_t *item = e->value;
     item->func (item);
   }
 
   return (0);
 } /* static int powerdns_read */
 
 static int powerdns_shutdown (void)
 {
-  llentry_t *e;
-
   if (list == NULL)
     return (0);
 
-  for (e = llist_head (list); e != NULL; e = e->next)
+  for (llentry_t *e = llist_head (list); e != NULL; e = e->next)
   {
     list_item_t *item = (list_item_t *) e->value;
     e->value = NULL;
 
     sfree (item->instance);
     sfree (item->command);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/processes.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/processes.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/processes.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/processes.c	2016-09-11 16:10:25.271038709 +0800
@@ -32,15 +32,15 @@
  *   Manuel Sanmartin
  *   Clément Stenac <clement.stenac at diwi.org>
  *   Cosmin Ioiart <cioiart at gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 /* Include header files for the mach system, if they exist.. */
 #if HAVE_THREAD_INFO
 #  if HAVE_MACH_MACH_INIT_H
 #    include <mach/mach_init.h>
 #  endif
@@ -183,12 +183,15 @@
 	/* io data */
 	derive_t io_rchar;
 	derive_t io_wchar;
 	derive_t io_syscr;
 	derive_t io_syscw;
 
+	derive_t cswitch_vol;
+	derive_t cswitch_invol;
+
 	struct procstat_entry_s *next;
 } procstat_entry_t;
 
 #define PROCSTAT_NAME_LEN 256
 typedef struct procstat
 {
@@ -214,18 +217,23 @@
 	/* io data */
 	derive_t io_rchar;
 	derive_t io_wchar;
 	derive_t io_syscr;
 	derive_t io_syscw;
 
+	derive_t cswitch_vol;
+	derive_t cswitch_invol;
+
 	struct procstat   *next;
 	struct procstat_entry_s *instances;
 } procstat_t;
 
 static procstat_t *list_head_g = NULL;
 
+static _Bool report_ctx_switch = 0;
+
 #if HAVE_THREAD_INFO
 static mach_port_t port_host_self;
 static mach_port_t port_task_self;
 
 static processor_set_name_array_t pset_list;
 static mach_msg_type_number_t     pset_list_len;
@@ -257,39 +265,38 @@
 static void ps_list_register (const char *name, const char *regexp)
 {
 	procstat_t *new;
 	procstat_t *ptr;
 	int status;
 
-	new = (procstat_t *) malloc (sizeof (procstat_t));
+	new = calloc (1, sizeof (*new));
 	if (new == NULL)
 	{
-		ERROR ("processes plugin: ps_list_register: malloc failed.");
+		ERROR ("processes plugin: ps_list_register: calloc failed.");
 		return;
 	}
-	memset (new, 0, sizeof (procstat_t));
 	sstrncpy (new->name, name, sizeof (new->name));
 
 #if HAVE_REGEX_H
 	if (regexp != NULL)
 	{
 		DEBUG ("ProcessMatch: adding \"%s\" as criteria to process %s.", regexp, name);
-		new->re = (regex_t *) malloc (sizeof (regex_t));
+		new->re = malloc (sizeof (*new->re));
 		if (new->re == NULL)
 		{
 			ERROR ("processes plugin: ps_list_register: malloc failed.");
 			sfree (new);
 			return;
 		}
 
 		status = regcomp (new->re, regexp, REG_EXTENDED | REG_NOSUB);
 		if (status != 0)
 		{
 			DEBUG ("ProcessMatch: compiling the regular expression \"%s\" failed.", regexp);
-			sfree(new->re);
-			sfree(new);
+			sfree (new->re);
+			sfree (new);
 			return;
 		}
 	}
 #else
 	if (regexp != NULL)
 	{
@@ -356,38 +363,59 @@
 	if (strcmp (ps->name, name) == 0)
 		return (1);
 
 	return (0);
 } /* int ps_list_match */
 
+static void ps_update_counter (_Bool init, derive_t *group_counter,
+				derive_t *curr_counter, unsigned long *curr_value,
+				derive_t new_counter, unsigned long new_value)
+{
+	if (init)
+	{
+		*curr_value = new_value;
+		*curr_counter += new_value;
+		*group_counter += new_value;
+		return;
+	}
+
+	if (new_counter < *curr_counter)
+		*curr_value = new_counter + (ULONG_MAX - *curr_counter);
+	else
+		*curr_value = new_counter - *curr_counter;
+
+	*curr_counter = new_counter;
+	*group_counter += *curr_value;
+}
+
 /* add process entry to 'instances' of process 'name' (or refresh it) */
 static void ps_list_add (const char *name, const char *cmdline, procstat_entry_t *entry)
 {
-	procstat_t *ps;
 	procstat_entry_t *pse;
 
 	if (entry->id == 0)
 		return;
 
-	for (ps = list_head_g; ps != NULL; ps = ps->next)
+	for (procstat_t *ps = list_head_g; ps != NULL; ps = ps->next)
 	{
+		_Bool want_init;
+
 		if ((ps_list_match (name, cmdline, ps)) == 0)
 			continue;
 
 		for (pse = ps->instances; pse != NULL; pse = pse->next)
 			if ((pse->id == entry->id) || (pse->next == NULL))
 				break;
 
 		if ((pse == NULL) || (pse->id != entry->id))
 		{
 			procstat_entry_t *new;
 
-			new = (procstat_entry_t *) malloc (sizeof (procstat_entry_t));
+			new = calloc (1, sizeof (*new));
 			if (new == NULL)
 				return;
-			memset (new, 0, sizeof (procstat_entry_t));
 			new->id = entry->id;
 
 			if (pse == NULL)
 				ps->instances = new;
 			else
 				pse->next = new;
@@ -404,12 +432,14 @@
 		pse->vmem_code  = entry->vmem_code;
 		pse->stack_size = entry->stack_size;
 		pse->io_rchar   = entry->io_rchar;
 		pse->io_wchar   = entry->io_wchar;
 		pse->io_syscr   = entry->io_syscr;
 		pse->io_syscw   = entry->io_syscw;
+		pse->cswitch_vol   = entry->cswitch_vol;
+		pse->cswitch_invol = entry->cswitch_invol;
 
 		ps->num_proc   += pse->num_proc;
 		ps->num_lwp    += pse->num_lwp;
 		ps->vmem_size  += pse->vmem_size;
 		ps->vmem_rss   += pse->vmem_rss;
 		ps->vmem_data  += pse->vmem_data;
@@ -418,108 +448,60 @@
 
 		ps->io_rchar   += ((pse->io_rchar == -1)?0:pse->io_rchar);
 		ps->io_wchar   += ((pse->io_wchar == -1)?0:pse->io_wchar);
 		ps->io_syscr   += ((pse->io_syscr == -1)?0:pse->io_syscr);
 		ps->io_syscw   += ((pse->io_syscw == -1)?0:pse->io_syscw);
 
-		if ((entry->vmem_minflt_counter == 0)
-				&& (entry->vmem_majflt_counter == 0))
-		{
-			pse->vmem_minflt_counter += entry->vmem_minflt;
-			pse->vmem_minflt = entry->vmem_minflt;
-
-			pse->vmem_majflt_counter += entry->vmem_majflt;
-			pse->vmem_majflt = entry->vmem_majflt;
-		}
-		else
-		{
-			if (entry->vmem_minflt_counter < pse->vmem_minflt_counter)
-			{
-				pse->vmem_minflt = entry->vmem_minflt_counter
-					+ (ULONG_MAX - pse->vmem_minflt_counter);
-			}
-			else
-			{
-				pse->vmem_minflt = entry->vmem_minflt_counter - pse->vmem_minflt_counter;
-			}
-			pse->vmem_minflt_counter = entry->vmem_minflt_counter;
-
-			if (entry->vmem_majflt_counter < pse->vmem_majflt_counter)
-			{
-				pse->vmem_majflt = entry->vmem_majflt_counter
-					+ (ULONG_MAX - pse->vmem_majflt_counter);
-			}
-			else
-			{
-				pse->vmem_majflt = entry->vmem_majflt_counter - pse->vmem_majflt_counter;
-			}
-			pse->vmem_majflt_counter = entry->vmem_majflt_counter;
-		}
-
-		ps->vmem_minflt_counter += pse->vmem_minflt;
-		ps->vmem_majflt_counter += pse->vmem_majflt;
-
-		if ((entry->cpu_user_counter == 0)
-				&& (entry->cpu_system_counter == 0))
-		{
-			pse->cpu_user_counter += entry->cpu_user;
-			pse->cpu_user = entry->cpu_user;
-
-			pse->cpu_system_counter += entry->cpu_system;
-			pse->cpu_system = entry->cpu_system;
-		}
-		else
-		{
-			if (entry->cpu_user_counter < pse->cpu_user_counter)
-			{
-				pse->cpu_user = entry->cpu_user_counter
-					+ (ULONG_MAX - pse->cpu_user_counter);
-			}
-			else
-			{
-				pse->cpu_user = entry->cpu_user_counter - pse->cpu_user_counter;
-			}
-			pse->cpu_user_counter = entry->cpu_user_counter;
-
-			if (entry->cpu_system_counter < pse->cpu_system_counter)
-			{
-				pse->cpu_system = entry->cpu_system_counter
-					+ (ULONG_MAX - pse->cpu_system_counter);
-			}
-			else
-			{
-				pse->cpu_system = entry->cpu_system_counter - pse->cpu_system_counter;
-			}
-			pse->cpu_system_counter = entry->cpu_system_counter;
-		}
+		ps->cswitch_vol   += ((pse->cswitch_vol == -1)?0:pse->cswitch_vol);
+		ps->cswitch_invol += ((pse->cswitch_invol == -1)?0:pse->cswitch_invol);
 
-		ps->cpu_user_counter   += pse->cpu_user;
-		ps->cpu_system_counter += pse->cpu_system;
+		want_init = (entry->vmem_minflt_counter == 0)
+				&& (entry->vmem_majflt_counter == 0);
+		ps_update_counter (want_init,
+				&ps->vmem_minflt_counter,
+				&pse->vmem_minflt_counter, &pse->vmem_minflt,
+				entry->vmem_minflt_counter, entry->vmem_minflt);
+		ps_update_counter (want_init,
+				&ps->vmem_majflt_counter,
+				&pse->vmem_majflt_counter, &pse->vmem_majflt,
+				entry->vmem_majflt_counter, entry->vmem_majflt);
+
+		want_init = (entry->cpu_user_counter == 0)
+				&& (entry->cpu_system_counter == 0);
+		ps_update_counter (want_init,
+				&ps->cpu_user_counter,
+				&pse->cpu_user_counter, &pse->cpu_user,
+				entry->cpu_user_counter, entry->cpu_user);
+		ps_update_counter (want_init,
+				&ps->cpu_system_counter,
+				&pse->cpu_system_counter, &pse->cpu_system,
+				entry->cpu_system_counter, entry->cpu_system);
 	}
 }
 
 /* remove old entries from instances of processes in list_head_g */
 static void ps_list_reset (void)
 {
-	procstat_t *ps;
 	procstat_entry_t *pse;
 	procstat_entry_t *pse_prev;
 
-	for (ps = list_head_g; ps != NULL; ps = ps->next)
+	for (procstat_t *ps = list_head_g; ps != NULL; ps = ps->next)
 	{
 		ps->num_proc    = 0;
 		ps->num_lwp     = 0;
 		ps->vmem_size   = 0;
 		ps->vmem_rss    = 0;
 		ps->vmem_data   = 0;
 		ps->vmem_code   = 0;
 		ps->stack_size  = 0;
 		ps->io_rchar = -1;
 		ps->io_wchar = -1;
 		ps->io_syscr = -1;
 		ps->io_syscw = -1;
+		ps->cswitch_vol   = -1;
+		ps->cswitch_invol = -1;
 
 		pse_prev = NULL;
 		pse = ps->instances;
 		while (pse != NULL)
 		{
 			if (pse->age > 10)
@@ -551,21 +533,19 @@
 	} /* for (ps = list_head_g; ps != NULL; ps = ps->next) */
 }
 
 /* put all pre-defined 'Process' names from config to list_head_g tree */
 static int ps_config (oconfig_item_t *ci)
 {
-	int i;
-
 #if KERNEL_LINUX
 	const size_t max_procname_len = 15;
 #elif KERNEL_SOLARIS || KERNEL_FREEBSD
 	const size_t max_procname_len = MAXCOMLEN -1;
 #endif
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (strcasecmp (c->key, "Process") == 0)
 		{
 			if ((c->values_num != 1)
 					|| (OCONFIG_TYPE_STRING != c->values[0].type)) {
@@ -613,12 +593,16 @@
 						c->values[1].value.string);
 			}
 
 			ps_list_register (c->values[0].value.string,
 					c->values[1].value.string);
 		}
+		else if (strcasecmp (c->key, "CollectContextSwitch") == 0)
+		{
+			cf_util_get_boolean (c, &report_ctx_switch);
+		}
 		else
 		{
 			ERROR ("processes plugin: The `%s' configuration option is not "
 					"understood and will be ignored.", c->key);
 			continue;
 		}
@@ -762,25 +746,42 @@
 		vl.values[0].derive = ps->io_syscr;
 		vl.values[1].derive = ps->io_syscw;
 		vl.values_len = 2;
 		plugin_dispatch_values (&vl);
 	}
 
+	if ( report_ctx_switch )
+	{
+		sstrncpy (vl.type, "contextswitch", sizeof (vl.type));
+		sstrncpy (vl.type_instance, "voluntary", sizeof (vl.type_instance));
+		vl.values[0].derive = ps->cswitch_vol;
+		vl.values_len = 1;
+		plugin_dispatch_values (&vl);
+
+		sstrncpy (vl.type, "contextswitch", sizeof (vl.type));
+		sstrncpy (vl.type_instance, "involuntary", sizeof (vl.type_instance));
+		vl.values[0].derive = ps->cswitch_invol;
+		vl.values_len = 1;
+		plugin_dispatch_values (&vl);
+	}
+
 	DEBUG ("name = %s; num_proc = %lu; num_lwp = %lu; "
 			"vmem_size = %lu; vmem_rss = %lu; vmem_data = %lu; "
 			"vmem_code = %lu; "
 			"vmem_minflt_counter = %"PRIi64"; vmem_majflt_counter = %"PRIi64"; "
 			"cpu_user_counter = %"PRIi64"; cpu_system_counter = %"PRIi64"; "
 			"io_rchar = %"PRIi64"; io_wchar = %"PRIi64"; "
-			"io_syscr = %"PRIi64"; io_syscw = %"PRIi64";",
+			"io_syscr = %"PRIi64"; io_syscw = %"PRIi64"; "
+			"cswitch_vol = %"PRIi64"; cswitch_invol = %"PRIi64";",
 			ps->name, ps->num_proc, ps->num_lwp,
 			ps->vmem_size, ps->vmem_rss,
 			ps->vmem_data, ps->vmem_code,
 			ps->vmem_minflt_counter, ps->vmem_majflt_counter,
 			ps->cpu_user_counter, ps->cpu_system_counter,
-			ps->io_rchar, ps->io_wchar, ps->io_syscr, ps->io_syscw);
+			ps->io_rchar, ps->io_wchar, ps->io_syscr, ps->io_syscw,
+			ps->cswitch_vol, ps->cswitch_invol);
 } /* void ps_submit_proc_list */
 
 #if KERNEL_LINUX || KERNEL_SOLARIS
 static void ps_submit_fork_rate (derive_t value)
 {
 	value_t values[1];
@@ -799,72 +800,130 @@
 	plugin_dispatch_values(&vl);
 }
 #endif /* KERNEL_LINUX || KERNEL_SOLARIS*/
 
 /* ------- additional functions for KERNEL_LINUX/HAVE_THREAD_INFO ------- */
 #if KERNEL_LINUX
-static int ps_read_tasks (long pid)
+static procstat_t *ps_read_tasks_status (long pid, procstat_t *ps)
 {
 	char           dirname[64];
 	DIR           *dh;
+	char           filename[64];
+	FILE          *fh;
 	struct dirent *ent;
-	int count = 0;
+	derive_t cswitch_vol = 0;
+	derive_t cswitch_invol = 0;
+	char buffer[1024];
+	char *fields[8];
+	int numfields;
 
 	ssnprintf (dirname, sizeof (dirname), "/proc/%li/task", pid);
 
 	if ((dh = opendir (dirname)) == NULL)
 	{
 		DEBUG ("Failed to open directory `%s'", dirname);
-		return (-1);
+		return (NULL);
 	}
 
 	while ((ent = readdir (dh)) != NULL)
 	{
+		char *tpid;
+
 		if (!isdigit ((int) ent->d_name[0]))
 			continue;
-		else
-			count++;
+
+		tpid = ent->d_name;
+
+		ssnprintf (filename, sizeof (filename), "/proc/%li/task/%s/status", pid, tpid);
+		if ((fh = fopen (filename, "r")) == NULL)
+		{
+			DEBUG ("Failed to open file `%s'", filename);
+			continue;
+		}
+
+		while (fgets (buffer, sizeof(buffer), fh) != NULL)
+		{
+			derive_t tmp;
+			char *endptr;
+
+			if (strncmp (buffer, "voluntary_ctxt_switches", 23) != 0
+				&& strncmp (buffer, "nonvoluntary_ctxt_switches", 26) != 0)
+				continue;
+
+			numfields = strsplit (buffer, fields,
+				STATIC_ARRAY_SIZE (fields));
+
+			if (numfields < 2)
+				continue;
+
+			errno = 0;
+			endptr = NULL;
+			tmp = (derive_t) strtoll (fields[1], &endptr, /* base = */ 10);
+			if ((errno == 0) && (endptr != fields[1]))
+			{
+				if (strncmp (buffer, "voluntary_ctxt_switches", 23) == 0)
+				{
+					cswitch_vol += tmp;
+				}
+				else if (strncmp (buffer, "nonvoluntary_ctxt_switches", 26) == 0)
+				{
+					cswitch_invol += tmp;
+				}
+			}
+		} /* while (fgets) */
+
+		if (fclose (fh))
+		{
+			char errbuf[1024];
+			WARNING ("processes: fclose: %s",
+				sstrerror (errno, errbuf, sizeof (errbuf)));
+		}
 	}
 	closedir (dh);
 
-	return ((count >= 1) ? count : 1);
-} /* int *ps_read_tasks */
+	ps->cswitch_vol = cswitch_vol;
+	ps->cswitch_invol = cswitch_invol;
 
-/* Read advanced virtual memory data from /proc/pid/status */
-static procstat_t *ps_read_vmem (long pid, procstat_t *ps)
+	return (ps);
+} /* int *ps_read_tasks_status */
+
+/* Read data from /proc/pid/status */
+static procstat_t *ps_read_status (long pid, procstat_t *ps)
 {
 	FILE *fh;
 	char buffer[1024];
 	char filename[64];
-	unsigned long long lib = 0;
-	unsigned long long exe = 0;
-	unsigned long long data = 0;
+	unsigned long lib = 0;
+	unsigned long exe = 0;
+	unsigned long data = 0;
+	unsigned long threads = 0;
 	char *fields[8];
 	int numfields;
 
 	ssnprintf (filename, sizeof (filename), "/proc/%li/status", pid);
 	if ((fh = fopen (filename, "r")) == NULL)
 		return (NULL);
 
 	while (fgets (buffer, sizeof(buffer), fh) != NULL)
 	{
-		long long tmp;
+		unsigned long tmp;
 		char *endptr;
 
-		if (strncmp (buffer, "Vm", 2) != 0)
+		if (strncmp (buffer, "Vm", 2) != 0
+				&& strncmp (buffer, "Threads", 7) != 0)
 			continue;
 
 		numfields = strsplit (buffer, fields,
 				STATIC_ARRAY_SIZE (fields));
 
 		if (numfields < 2)
 			continue;
 
 		errno = 0;
 		endptr = NULL;
-		tmp = strtoll (fields[1], &endptr, /* base = */ 10);
+		tmp = strtoul (fields[1], &endptr, /* base = */ 10);
 		if ((errno == 0) && (endptr != fields[1]))
 		{
 			if (strncmp (buffer, "VmData", 6) == 0)
 			{
 				data = tmp;
 			}
@@ -873,24 +932,30 @@
 				lib = tmp;
 			}
 			else if  (strncmp(buffer, "VmExe", 5) == 0)
 			{
 				exe = tmp;
 			}
+			else if  (strncmp(buffer, "Threads", 7) == 0)
+			{
+				threads = tmp;
+			}
 		}
 	} /* while (fgets) */
 
 	if (fclose (fh))
 	{
 		char errbuf[1024];
 		WARNING ("processes: fclose: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 	}
 
 	ps->vmem_data = data * 1024;
 	ps->vmem_code = (exe + lib) * 1024;
+	if (threads != 0)
+		ps->num_lwp = threads;
 
 	return (ps);
 } /* procstat_t *ps_read_vmem */
 
 static procstat_t *ps_read_io (long pid, procstat_t *ps)
 {
@@ -952,48 +1017,48 @@
 	char  filename[64];
 	char  buffer[1024];
 
 	char *fields[64];
 	char  fields_len;
 
-	int   buffer_len;
+	size_t buffer_len;
 
-	char *buffer_ptr;
+	char  *buffer_ptr;
 	size_t name_start_pos;
 	size_t name_end_pos;
 	size_t name_len;
 
 	derive_t cpu_user_counter;
 	derive_t cpu_system_counter;
 	long long unsigned vmem_size;
 	long long unsigned vmem_rss;
 	long long unsigned stack_size;
 
+	ssize_t status;
+
 	memset (ps, 0, sizeof (procstat_t));
 
 	ssnprintf (filename, sizeof (filename), "/proc/%li/stat", pid);
 
-	buffer_len = read_file_contents (filename,
-			buffer, sizeof(buffer) - 1);
-	if (buffer_len <= 0)
+	status = read_file_contents (filename, buffer, sizeof(buffer) - 1);
+	if (status <= 0)
 		return (-1);
+	buffer_len = (size_t) status;
 	buffer[buffer_len] = 0;
 
 	/* The name of the process is enclosed in parens. Since the name can
 	 * contain parens itself, spaces, numbers and pretty much everything
 	 * else, use these to determine the process name. We don't use
 	 * strchr(3) and strrchr(3) to avoid pointer arithmetic which would
 	 * otherwise be required to determine name_len. */
 	name_start_pos = 0;
-	while ((buffer[name_start_pos] != '(')
-			&& (name_start_pos < buffer_len))
+	while (name_start_pos < buffer_len && buffer[name_start_pos] != '(')
 		name_start_pos++;
 
 	name_end_pos = buffer_len;
-	while ((buffer[name_end_pos] != ')')
-			&& (name_end_pos > 0))
+	while (name_end_pos > 0 && buffer[name_end_pos] != ')')
 		name_end_pos--;
 
 	/* Either '(' or ')' is not found or they are in the wrong order.
 	 * Anyway, something weird that shouldn't happen ever. */
 	if (name_start_pos >= name_end_pos)
 	{
@@ -1027,17 +1092,22 @@
 	{
 		ps->num_lwp  = 0;
 		ps->num_proc = 0;
 	}
 	else
 	{
-		if ( (ps->num_lwp = ps_read_tasks (pid)) == -1 )
+		ps->num_lwp = strtoul (fields[17], /* endptr = */ NULL, /* base = */ 10);
+		if ((ps_read_status(pid, ps)) == NULL)
 		{
-			/* returns -1 => kernel 2.4 */
-			ps->num_lwp = 1;
+			/* No VMem data */
+			ps->vmem_data = -1;
+			ps->vmem_code = -1;
+			DEBUG("ps_read_process: did not get vmem data for pid %li", pid);
 		}
+		if (ps->num_lwp == 0)
+			ps->num_lwp = 1;
 		ps->num_proc = 1;
 	}
 
 	/* Leave the rest at zero if this is only a zombi */
 	if (ps->num_proc == 0)
 	{
@@ -1064,20 +1134,12 @@
 
 	/* Convert jiffies to useconds */
 	cpu_user_counter   = cpu_user_counter   * 1000000 / CONFIG_HZ;
 	cpu_system_counter = cpu_system_counter * 1000000 / CONFIG_HZ;
 	vmem_rss = vmem_rss * pagesize_g;
 
-	if ( (ps_read_vmem(pid, ps)) == NULL)
-	{
-		/* No VMem data */
-		ps->vmem_data = -1;
-		ps->vmem_code = -1;
-		DEBUG("ps_read_process: did not get vmem data for pid %li", pid);
-	}
-
 	ps->cpu_user_counter = cpu_user_counter;
 	ps->cpu_system_counter = cpu_system_counter;
 	ps->vmem_size = (unsigned long) vmem_size;
 	ps->vmem_rss = (unsigned long) vmem_rss;
 	ps->stack_size = (unsigned long) stack_size;
 
@@ -1089,12 +1151,24 @@
 		ps->io_syscr = -1;
 		ps->io_syscw = -1;
 
 		DEBUG("ps_read_process: not get io data for pid %li", pid);
 	}
 
+	if ( report_ctx_switch )
+	{
+		if ( (ps_read_tasks_status(pid, ps)) == NULL)
+		{
+			ps->cswitch_vol = -1;
+			ps->cswitch_invol = -1;
+
+			DEBUG("ps_read_tasks_status: not get context "
+					"switch data for pid %li", pid);
+		}
+	}
+
 	/* success */
 	return (0);
 } /* int ps_read_process (...) */
 
 static char *ps_get_cmdline (long pid, char *name, char *buf, size_t buf_len)
 {
@@ -1150,13 +1224,13 @@
 		if (status == 0)
 			break;
 
 		buf_ptr += status;
 		len     -= status;
 
-		if (len <= 0)
+		if (len == 0)
 			break;
 	}
 
 	close (fd);
 
 	if (0 == n) {
@@ -1239,22 +1313,22 @@
 #if KERNEL_SOLARIS
 static char *ps_get_cmdline (long pid, char *name __attribute__((unused)), /* {{{ */
     char *buffer, size_t buffer_size)
 {
 	char path[PATH_MAX];
 	psinfo_t info;
-	int status;
+	ssize_t status;
 
 	snprintf(path, sizeof (path), "/proc/%li/psinfo", pid);
 
 	status = read_file_contents (path, (void *) &info, sizeof (info));
-	if (status != sizeof (info))
+	if ((status < 0) || (((size_t) status) != sizeof (info)))
 	{
 		ERROR ("processes plugin: Unexpected return value "
 				"while reading \"%s\": "
-				"Returned %i but expected %zu.",
+				"Returned %zd but expected %zu.",
 				path, status, buffer_size);
 		return (NULL);
 	}
 
 	info.pr_psargs[sizeof (info.pr_psargs) - 1] = 0;
 	sstrncpy (buffer, info.pr_psargs, buffer_size);
@@ -1280,24 +1354,21 @@
 
 	snprintf(filename, sizeof (filename), "/proc/%li/status", pid);
 	snprintf(f_psinfo, sizeof (f_psinfo), "/proc/%li/psinfo", pid);
 	snprintf(f_usage, sizeof (f_usage), "/proc/%li/usage", pid);
 
 
-	buffer = malloc(sizeof (pstatus_t));
-	memset(buffer, 0, sizeof (pstatus_t));
+	buffer = calloc(1, sizeof (pstatus_t));
 	read_file_contents(filename, buffer, sizeof (pstatus_t));
 	myStatus = (pstatus_t *) buffer;
 
-	buffer = malloc(sizeof (psinfo_t));
-	memset(buffer, 0, sizeof(psinfo_t));
+	buffer = calloc(1, sizeof (psinfo_t));
 	read_file_contents(f_psinfo, buffer, sizeof (psinfo_t));
 	myInfo = (psinfo_t *) buffer;
 
-	buffer = malloc(sizeof (prusage_t));
-	memset(buffer, 0, sizeof(prusage_t));
+	buffer = calloc(1, sizeof (prusage_t));
 	read_file_contents(f_usage, buffer, sizeof (prusage_t));
 	myUsage = (prusage_t *) buffer;
 
 	sstrncpy(ps->name, myInfo->pr_fname, sizeof (myInfo->pr_fname));
 	ps->num_lwp = myStatus->pr_nlwp;
 	if (myInfo->pr_wstat != 0) {
@@ -1349,12 +1420,18 @@
 		chars_per_block = tot_chars / tot_blocks;
 	ps->io_rchar = myUsage->pr_inblk * chars_per_block;
 	ps->io_wchar = myUsage->pr_oublk * chars_per_block;
 	ps->io_syscr = myUsage->pr_sysc;
 	ps->io_syscw = myUsage->pr_sysc;
 
+	/*
+	 * TODO: context switch counters for Solaris
+   */
+	ps->cswitch_vol   = -1;
+	ps->cswitch_invol = -1;
+
 
 	/*
 	 * TODO: Find way of setting BLOCKED and PAGING status
 	 */
 
 	*state = (char) 'R';
@@ -1380,22 +1457,21 @@
 
 /*
  * Reads the number of threads created since the last reboot. On Solaris these
  * are retrieved from kstat (module cpu, name sys, class misc, stat nthreads).
  * The result is the sum for all the threads created on each cpu
  */
-static int read_fork_rate()
+static int read_fork_rate (void)
 {
 	extern kstat_ctl_t *kc;
-	kstat_t *ksp_chain = NULL;
 	derive_t result = 0;
 
 	if (kc == NULL)
 		return (-1);
 
-	for (ksp_chain = kc->kc_chain;
+	for (kstat_t *ksp_chain = kc->kc_chain;
 			ksp_chain != NULL;
 			ksp_chain = ksp_chain->ks_next)
 	{
 		if ((strcmp (ksp_chain->ks_module, "cpu") == 0)
 				&& (strcmp (ksp_chain->ks_name, "sys") == 0)
 				&& (strcmp (ksp_chain->ks_class, "misc") == 0))
@@ -1455,23 +1531,20 @@
 /* do actual readings from kernel */
 static int ps_read (void)
 {
 #if HAVE_THREAD_INFO
 	kern_return_t            status;
 
-	int                      pset;
 	processor_set_t          port_pset_priv;
 
-	int                      task;
 	task_array_t             task_list;
 	mach_msg_type_number_t   task_list_len;
 
 	int                      task_pid;
 	char                     task_name[MAXCOMLEN + 1];
 
-	int                      thread;
 	thread_act_array_t       thread_list;
 	mach_msg_type_number_t   thread_list_len;
 	thread_basic_info_data_t thread_data;
 	mach_msg_type_number_t   thread_data_len;
 
 	int running  = 0;
@@ -1490,13 +1563,13 @@
 	 * concept: All the work is done in threads. Threads are contained in
 	 * `tasks'. Therefore, `task status' doesn't make much sense, since
 	 * it's actually a `thread status'.
 	 * Tasks are assigned to sets of processors, so that's where you go to
 	 * get a list.
 	 */
-	for (pset = 0; pset < pset_list_len; pset++)
+	for (mach_msg_type_number_t pset = 0; pset < pset_list_len; pset++)
 	{
 		if ((status = host_processor_set_priv (port_host_self,
 						pset_list[pset],
 						&port_pset_priv)) != KERN_SUCCESS)
 		{
 			ERROR ("host_processor_set_priv failed: %s\n",
@@ -1511,13 +1584,13 @@
 			ERROR ("processor_set_tasks failed: %s\n",
 					mach_error_string (status));
 			mach_port_deallocate (port_task_self, port_pset_priv);
 			continue;
 		}
 
-		for (task = 0; task < task_list_len; task++)
+		for (mach_msg_type_number_t task = 0; task < task_list_len; task++)
 		{
 			ps = NULL;
 			if (mach_get_task_name (task_list[task],
 						&task_pid,
 						task_name, PROCSTAT_NAME_LEN) == 0)
 			{
@@ -1586,12 +1659,16 @@
 
 				pse.vmem_minflt_counter = task_events_info.cow_faults;
 				pse.vmem_majflt_counter = task_events_info.faults;
 
 				pse.cpu_user_counter = task_absolutetime_info.total_user;
 				pse.cpu_system_counter = task_absolutetime_info.total_system;
+
+				/* context switch counters not implemented */
+				pse.cswitch_vol   = -1;
+				pse.cswitch_invol = -1;
 			}
 
 			status = task_threads (task_list[task], &thread_list,
 					&thread_list_len);
 			if (status != KERN_SUCCESS)
 			{
@@ -1605,13 +1682,13 @@
 				if (task_list[task] != port_task_self)
 					mach_port_deallocate (port_task_self,
 							task_list[task]);
 				continue; /* with next task_list */
 			}
 
-			for (thread = 0; thread < thread_list_len; thread++)
+			for (mach_msg_type_number_t thread = 0; thread < thread_list_len; thread++)
 			{
 				thread_data_len = THREAD_BASIC_INFO_COUNT;
 				status = thread_info (thread_list[thread],
 						THREAD_BASIC_INFO,
 						(thread_info_t) &thread_data,
 						&thread_data_len);
@@ -1736,14 +1813,12 @@
 
 	int        status;
 	procstat_t ps;
 	procstat_entry_t pse;
 	char       state;
 
-	procstat_t *ps_ptr;
-
 	running = sleeping = zombies = stopped = paging = blocked = 0;
 	ps_list_reset ();
 
 	if ((proc = opendir ("/proc")) == NULL)
 	{
 		char errbuf[1024];
@@ -1791,12 +1866,15 @@
 
 		pse.io_rchar = ps.io_rchar;
 		pse.io_wchar = ps.io_wchar;
 		pse.io_syscr = ps.io_syscr;
 		pse.io_syscw = ps.io_syscw;
 
+		pse.cswitch_vol = ps.cswitch_vol;
+		pse.cswitch_invol = ps.cswitch_invol;
+
 		switch (state)
 		{
 			case 'R': running++;  break;
 			case 'S': sleeping++; break;
 			case 'D': blocked++;  break;
 			case 'Z': zombies++;  break;
@@ -1815,13 +1893,13 @@
 	ps_submit_state ("sleeping", sleeping);
 	ps_submit_state ("zombies",  zombies);
 	ps_submit_state ("stopped",  stopped);
 	ps_submit_state ("paging",   paging);
 	ps_submit_state ("blocked",  blocked);
 
-	for (ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
+	for (procstat_t *ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
 		ps_submit_proc_list (ps_ptr);
 
 	read_fork_rate();
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_LIBKVM_GETPROCS && HAVE_STRUCT_KINFO_PROC_FREEBSD
@@ -1835,15 +1913,13 @@
 
 	kvm_t *kd;
 	char errbuf[_POSIX2_LINE_MAX];
 	struct kinfo_proc *procs;          /* array of processes */
 	struct kinfo_proc *proc_ptr = NULL;
 	int count;                         /* returns number of processes */
-	int i;
 
-	procstat_t *ps_ptr;
 	procstat_entry_t pse;
 
 	ps_list_reset ();
 
 	/* Open the kvm interface, get a descriptor */
 	kd = kvm_openfiles (NULL, "/dev/null", NULL, 0, errbuf);
@@ -1862,13 +1938,13 @@
 				kvm_geterr(kd));
 		kvm_close (kd);
 		return (0);
 	}
 
 	/* Iterate through the processes in kinfo_proc */
-	for (i = 0; i < count; i++)
+	for (int i = 0; i < count; i++)
 	{
 		/* Create only one process list entry per _process_, i.e.
 		 * filter out threads (duplicate PID entries). */
 		if ((proc_ptr == NULL) || (proc_ptr->ki_pid != procs[i].ki_pid))
 		{
 			char cmdline[CMDLINE_BUFFER_SIZE] = "";
@@ -1936,12 +2012,16 @@
 			/* no I/O data */
 			pse.io_rchar = -1;
 			pse.io_wchar = -1;
 			pse.io_syscr = -1;
 			pse.io_syscw = -1;
 
+			/* context switch counters not implemented */
+			pse.cswitch_vol   = -1;
+			pse.cswitch_invol = -1;
+
 			ps_list_add (procs[i].ki_comm, have_cmdline ? cmdline : NULL, &pse);
 
 			switch (procs[i].ki_stat)
 			{
 				case SSTOP:	stopped++;	break;
 				case SSLEEP:	sleeping++;	break;
@@ -1961,13 +2041,13 @@
 	ps_submit_state ("zombies",  zombies);
 	ps_submit_state ("stopped",  stopped);
 	ps_submit_state ("blocked",  blocked);
 	ps_submit_state ("idle",     idle);
 	ps_submit_state ("wait",     wait);
 
-	for (ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
+	for (procstat_t *ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
 		ps_submit_proc_list (ps_ptr);
 /* #endif HAVE_LIBKVM_GETPROCS && HAVE_STRUCT_KINFO_PROC_FREEBSD */
 
 #elif HAVE_LIBKVM_GETPROCS && HAVE_STRUCT_KINFO_PROC_OPENBSD
 	int running  = 0;
 	int sleeping = 0;
@@ -1979,15 +2059,13 @@
 
 	kvm_t *kd;
 	char errbuf[1024];
 	struct kinfo_proc *procs;          /* array of processes */
 	struct kinfo_proc *proc_ptr = NULL;
 	int count;                         /* returns number of processes */
-	int i;
 
-	procstat_t *ps_ptr;
 	procstat_entry_t pse;
 
 	ps_list_reset ();
 
 	/* Open the kvm interface, get a descriptor */
 	kd = kvm_open (NULL, NULL, NULL, 0, errbuf);
@@ -2006,13 +2084,13 @@
 				kvm_geterr(kd));
 		kvm_close (kd);
 		return (0);
 	}
 
 	/* Iterate through the processes in kinfo_proc */
-	for (i = 0; i < count; i++)
+	for (int i = 0; i < count; i++)
 	{
 		/* Create only one process list entry per _process_, i.e.
 		 * filter out threads (duplicate PID entries). */
 		if ((proc_ptr == NULL) || (proc_ptr->p_pid != procs[i].p_pid))
 		{
 			char cmdline[CMDLINE_BUFFER_SIZE] = "";
@@ -2069,12 +2147,16 @@
 			/* no I/O data */
 			pse.io_rchar = -1;
 			pse.io_wchar = -1;
 			pse.io_syscr = -1;
 			pse.io_syscw = -1;
 
+			/* context switch counters not implemented */
+			pse.cswitch_vol   = -1;
+			pse.cswitch_invol = -1;
+
 			ps_list_add (procs[i].p_comm, have_cmdline ? cmdline : NULL, &pse);
 
 			switch (procs[i].p_stat)
 			{
 				case SSTOP:	stopped++;	break;
 				case SSLEEP:	sleeping++;	break;
@@ -2094,13 +2176,13 @@
 	ps_submit_state ("zombies",  zombies);
 	ps_submit_state ("stopped",  stopped);
 	ps_submit_state ("onproc",   onproc);
 	ps_submit_state ("idle",     idle);
 	ps_submit_state ("dead",     dead);
 
-	for (ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
+	for (procstat_t *ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
 		ps_submit_proc_list (ps_ptr);
 /* #endif HAVE_LIBKVM_GETPROCS && HAVE_STRUCT_KINFO_PROC_OPENBSD */
 
 #elif HAVE_PROCINFO_H
 	/* AIX */
 	int running  = 0;
@@ -2110,23 +2192,20 @@
 	int paging   = 0;
 	int blocked  = 0;
 
 	pid_t pindex = 0;
 	int nprocs;
 
-	procstat_t *ps;
 	procstat_entry_t pse;
 
 	ps_list_reset ();
 	while ((nprocs = getprocs64 (procentry, sizeof(struct procentry64),
 					/* fdsinfo = */ NULL, sizeof(struct fdsinfo64),
 					&pindex, MAXPROCENTRY)) > 0)
 	{
-		int i;
-
-		for (i = 0; i < nprocs; i++)
+		for (int i = 0; i < nprocs; i++)
 		{
 			tid64_t thindex;
 			int nthreads;
 			char arglist[MAXARGLN+1];
 			char *cargs;
 			char *cmdline;
@@ -2215,12 +2294,15 @@
 
 			pse.io_rchar = -1;
 			pse.io_wchar = -1;
 			pse.io_syscr = -1;
 			pse.io_syscw = -1;
 
+			pse.cswitch_vol   = -1;
+			pse.cswitch_invol = -1;
+
 			ps_list_add (cmdline, cargs, &pse);
 		} /* for (i = 0 .. nprocs) */
 
 		if (nprocs < MAXPROCENTRY)
 			break;
 	} /* while (getprocs64() > 0) */
@@ -2228,13 +2310,13 @@
 	ps_submit_state ("sleeping", sleeping);
 	ps_submit_state ("zombies",  zombies);
 	ps_submit_state ("stopped",  stopped);
 	ps_submit_state ("paging",   paging);
 	ps_submit_state ("blocked",  blocked);
 
-	for (ps = list_head_g; ps != NULL; ps = ps->next)
+	for (procstat_t *ps = list_head_g; ps != NULL; ps = ps->next)
 		ps_submit_proc_list (ps);
 /* #endif HAVE_PROCINFO_H */
 
 #elif KERNEL_SOLARIS
 	/*
 	 * The Solaris section adds a few more process states and removes some
@@ -2252,13 +2334,12 @@
 	int orphan = 0;
 
 	struct dirent *ent;
 	DIR *proc;
 
 	int status;
-	procstat_t *ps_ptr;
 	char state;
 
 	char cmdline[PRARGSZ];
 
 	ps_list_reset ();
 
@@ -2311,12 +2392,15 @@
 
 		pse.io_rchar = ps.io_rchar;
 		pse.io_wchar = ps.io_wchar;
 		pse.io_syscr = ps.io_syscr;
 		pse.io_syscw = ps.io_syscw;
 
+		pse.cswitch_vol = -1;
+		pse.cswitch_invol = -1;
+
 		switch (state)
 		{
 			case 'R': running++;  break;
 			case 'S': sleeping++; break;
 			case 'E': detached++; break;
 			case 'Z': zombies++;  break;
@@ -2339,13 +2423,13 @@
 	ps_submit_state ("stopped",  stopped);
 	ps_submit_state ("detached", detached);
 	ps_submit_state ("daemon",   daemon);
 	ps_submit_state ("system",   system);
 	ps_submit_state ("orphan",   orphan);
 
-	for (ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
+	for (procstat_t *ps_ptr = list_head_g; ps_ptr != NULL; ps_ptr = ps_ptr->next)
 		ps_submit_proc_list (ps_ptr);
 
 	read_fork_rate();
 #endif /* KERNEL_SOLARIS */
 
 	return (0);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/protocols.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/protocols.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/protocols.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/protocols.c	2016-09-11 16:10:25.271038709 +0800
@@ -45,13 +46,13 @@
   "IgnoreSelected",
 };
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static ignorelist_t *values_list = NULL;
 
-/* 
+/*
  * Functions
  */
 static void submit (const char *protocol_name,
     const char *str_key, const char *str_value)
 {
   value_t values[1];
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pyconfig.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pyconfig.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pyconfig.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pyconfig.c	2016-09-11 16:10:25.271038709 +0800
@@ -18,13 +18,13 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Sven Trenkel <collectd at semidefinite.de>  
+ *   Sven Trenkel <collectd at semidefinite.de>
  **/
 
 #include <Python.h>
 #include <structmember.h>
 
 #include "collectd.h"
@@ -54,33 +55,33 @@
 static char children_doc[] = "This is a tuple of child nodes. For most nodes this will be\n"
 		"empty. If this node represents a block instead of a single line of the config\n"
 		"file it will contain all nodes in this block.\n";
 
 static PyObject *Config_new(PyTypeObject *type, PyObject *args, PyObject *kwds) {
 	Config *self;
-	
+
 	self = (Config *) type->tp_alloc(type, 0);
 	if (self == NULL)
 		return NULL;
-	
+
 	self->parent = NULL;
 	self->key = NULL;
 	self->values = NULL;
 	self->children = NULL;
 	return (PyObject *) self;
 }
 
 static int Config_init(PyObject *s, PyObject *args, PyObject *kwds) {
 	PyObject *key = NULL, *parent = NULL, *values = NULL, *children = NULL, *tmp;
 	Config *self = (Config *) s;
 	static char *kwlist[] = {"key", "parent", "values", "children", NULL};
-	
+
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "O|OOO", kwlist,
 			&key, &parent, &values, &children))
 		return -1;
-	
+
 	if (!IS_BYTES_OR_UNICODE(key)) {
 		PyErr_SetString(PyExc_TypeError, "argument 1 must be str");
 		Py_XDECREF(parent);
 		Py_XDECREF(values);
 		Py_XDECREF(children);
 		return -1;
@@ -119,31 +120,31 @@
 }
 
 static PyObject *Config_repr(PyObject *s) {
 	Config *self = (Config *) s;
 	PyObject *ret = NULL;
 	static PyObject *node_prefix = NULL, *root_prefix = NULL, *ending = NULL;
-	
+
 	/* This is ok because we have the GIL, so this is thread-save by default. */
 	if (node_prefix == NULL)
 		node_prefix = cpy_string_to_unicode_or_bytes("<collectd.Config node ");
 	if (root_prefix == NULL)
 		root_prefix = cpy_string_to_unicode_or_bytes("<collectd.Config root node ");
 	if (ending == NULL)
 		ending = cpy_string_to_unicode_or_bytes(">");
 	if (node_prefix == NULL || root_prefix == NULL || ending == NULL)
 		return NULL;
-	
+
 	ret = PyObject_Str(self->key);
 	CPY_SUBSTITUTE(PyObject_Repr, ret, ret);
 	if (self->parent == NULL || self->parent == Py_None)
 		CPY_STRCAT(&ret, root_prefix);
 	else
 		CPY_STRCAT(&ret, node_prefix);
 	CPY_STRCAT(&ret, ending);
-	
+
 	return ret;
 }
 
 static int Config_traverse(PyObject *self, visitproc visit, void *arg) {
 	Config *c = (Config *) self;
 	Py_VISIT(c->parent);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/python.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/python.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/python.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/python.c	2016-09-11 16:10:25.271038709 +0800
@@ -18,24 +18,22 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Sven Trenkel <collectd at semidefinite.de>  
+ *   Sven Trenkel <collectd at semidefinite.de>
  **/
 
 #include <Python.h>
 #include <structmember.h>
 
 #include <signal.h>
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
 
 #include "collectd.h"
+
 #include "common.h"
 
 #include "cpython.h"
 
 typedef struct cpy_callback_s {
 	char *name;
@@ -196,13 +194,13 @@
 		"    to specify a name here.\n"
 		"'identifier' is the full identifier assigned to this callback.\n"
 		"\n"
 		"The callback function will be called with two or three parameters:\n"
 		"timeout: Indicates that only data older than 'timeout' seconds is to\n"
 		"    be flushed.\n"
-		"id: Specifies which values are to be flushed.\n"
+		"id: Specifies which values are to be flushed. Might be None.\n"
 		"data: The optional data parameter passed to the register function.\n"
 		"    If the parameter was omitted it will be omitted here, too.";
 
 static char reg_shutdown_doc[] = "register_shutdown(callback[, data][, name]) -> identifier\n"
 		"\n"
 		"Register a callback function for collectd shutdown.\n"
@@ -218,13 +216,15 @@
 		"'identifier' is the full identifier assigned to this callback.\n"
 		"\n"
 		"The callback function will be called with no parameters except for\n"
 		"    data if it was supplied.";
 
 
-static int do_interactive = 0;
+static pthread_t main_thread;
+static PyOS_sighandler_t python_sigint_handler;
+static _Bool do_interactive = 0;
 
 /* This is our global thread state. Python saves some stuff in thread-local
  * storage. So if we allow the interpreter to run in the background
  * (the scriptwriters might have created some threads from python), we have
  * to save the state so we can resume it later after shutdown. */
 
@@ -233,53 +233,64 @@
 static PyObject *sys_path, *cpy_format_exception;
 
 static cpy_callback_t *cpy_config_callbacks;
 static cpy_callback_t *cpy_init_callbacks;
 static cpy_callback_t *cpy_shutdown_callbacks;
 
+/* Make sure to hold the GIL while modifying these. */
+static int cpy_shutdown_triggered = 0;
+static int cpy_num_callbacks = 0;
+
 static void cpy_destroy_user_data(void *data) {
 	cpy_callback_t *c = data;
 	free(c->name);
+	CPY_LOCK_THREADS
 	Py_DECREF(c->callback);
 	Py_XDECREF(c->data);
 	free(c);
+	--cpy_num_callbacks;
+	if (!cpy_num_callbacks && cpy_shutdown_triggered) {
+		Py_Finalize();
+		return;
+	}
+	CPY_RELEASE_THREADS
 }
 
 /* You must hold the GIL to call this function!
  * But if you managed to extract the callback parameter then you probably already do. */
 
 static void cpy_build_name(char *buf, size_t size, PyObject *callback, const char *name) {
 	const char *module = NULL;
 	PyObject *mod = NULL;
-	
+
 	if (name != NULL) {
 		snprintf(buf, size, "python.%s", name);
 		return;
 	}
-	
+
 	mod = PyObject_GetAttrString(callback, "__module__"); /* New reference. */
 	if (mod != NULL)
 		module = cpy_unicode_or_bytes_to_string(&mod);
-	
+
 	if (module != NULL) {
 		snprintf(buf, size, "python.%s", module);
 		Py_XDECREF(mod);
 		PyErr_Clear();
 		return;
 	}
 	Py_XDECREF(mod);
-	
+
 	snprintf(buf, size, "python.%p", callback);
 	PyErr_Clear();
 }
 
 void cpy_log_exception(const char *context) {
-	int l = 0, i;
+	int l = 0;
 	const char *typename = NULL, *message = NULL;
 	PyObject *type, *value, *traceback, *tn, *m, *list;
-	
+
 	PyErr_Fetch(&type, &value, &traceback);
 	PyErr_NormalizeException(&type, &value, &traceback);
 	if (type == NULL) return;
 	tn = PyObject_GetAttrString(type, "__name__"); /* New reference. */
 	m = PyObject_Str(value); /* New reference. */
 	if (tn != NULL)
@@ -303,13 +314,13 @@
 		return;
 	}
 	list = PyObject_CallFunction(cpy_format_exception, "NNN", type, value, traceback); /* New reference. Steals references from "type", "value" and "traceback". */
 	if (list)
 		l = PyObject_Length(list);
 
-	for (i = 0; i < l; ++i) {
+	for (int i = 0; i < l; ++i) {
 		PyObject *line;
 		char const *msg;
 		char *cpy;
 
 		line = PyList_GET_ITEM(list, i); /* Borrowed reference. */
 		Py_INCREF(line);
@@ -352,41 +363,31 @@
 	if (ret == NULL)
 		return 1;
 	return 0;
 }
 
 static int cpy_write_callback(const data_set_t *ds, const value_list_t *value_list, user_data_t *data) {
-	int i;
 	cpy_callback_t *c = data->data;
 	PyObject *ret, *list, *temp, *dict = NULL;
 	Values *v;
 
 	CPY_LOCK_THREADS
 		list = PyList_New(value_list->values_len); /* New reference. */
 		if (list == NULL) {
 			cpy_log_exception("write callback");
 			CPY_RETURN_FROM_THREADS 0;
 		}
-		for (i = 0; i < value_list->values_len; ++i) {
+		for (size_t i = 0; i < value_list->values_len; ++i) {
 			if (ds->ds[i].type == DS_TYPE_COUNTER) {
-				if ((long) value_list->values[i].counter == value_list->values[i].counter)
-					PyList_SetItem(list, i, PyInt_FromLong(value_list->values[i].counter));
-				else
-					PyList_SetItem(list, i, PyLong_FromUnsignedLongLong(value_list->values[i].counter));
+				PyList_SetItem(list, i, PyLong_FromUnsignedLongLong(value_list->values[i].counter));
 			} else if (ds->ds[i].type == DS_TYPE_GAUGE) {
 				PyList_SetItem(list, i, PyFloat_FromDouble(value_list->values[i].gauge));
 			} else if (ds->ds[i].type == DS_TYPE_DERIVE) {
-				if ((long) value_list->values[i].derive == value_list->values[i].derive)
-					PyList_SetItem(list, i, PyInt_FromLong(value_list->values[i].derive));
-				else
-					PyList_SetItem(list, i, PyLong_FromLongLong(value_list->values[i].derive));
+				PyList_SetItem(list, i, PyLong_FromLongLong(value_list->values[i].derive));
 			} else if (ds->ds[i].type == DS_TYPE_ABSOLUTE) {
-				if ((long) value_list->values[i].absolute == value_list->values[i].absolute)
-					PyList_SetItem(list, i, PyInt_FromLong(value_list->values[i].absolute));
-				else
-					PyList_SetItem(list, i, PyLong_FromUnsignedLongLong(value_list->values[i].absolute));
+				PyList_SetItem(list, i, PyLong_FromUnsignedLongLong(value_list->values[i].absolute));
 			} else {
 				Py_BEGIN_ALLOW_THREADS
 				ERROR("cpy_write_callback: Unknown value type %d.", ds->ds[i].type);
 				Py_END_ALLOW_THREADS
 				Py_DECREF(list);
 				CPY_RETURN_FROM_THREADS 0;
@@ -396,25 +397,24 @@
 				Py_DECREF(list);
 				CPY_RETURN_FROM_THREADS 0;
 			}
 		}
 		dict = PyDict_New();  /* New reference. */
 		if (value_list->meta) {
-			int num;
 			char **table;
 			meta_data_t *meta = value_list->meta;
 
-			num = meta_data_toc(meta, &table);
-			for (i = 0; i < num; ++i) {
+			int num = meta_data_toc(meta, &table);
+			for (int i = 0; i < num; ++i) {
 				int type;
 				char *string;
 				int64_t si;
 				uint64_t ui;
 				double d;
 				_Bool b;
-				
+
 				type = meta_data_type(meta, table[i]);
 				if (type == MD_TYPE_STRING) {
 					if (meta_data_get_string(meta, table[i], &string))
 						continue;
 					temp = cpy_string_to_unicode_or_bytes(string);  /* New reference. */
 					free(string);
@@ -526,13 +526,18 @@
 
 static void cpy_flush_callback(int timeout, const char *id, user_data_t *data) {
 	cpy_callback_t * c = data->data;
 	PyObject *ret, *text;
 
 	CPY_LOCK_THREADS
-	text = cpy_string_to_unicode_or_bytes(id);
+	if (id) {
+		text = cpy_string_to_unicode_or_bytes(id);
+	} else {
+		text = Py_None;
+		Py_INCREF(text);
+	}
 	if (c->data == NULL)
 		ret = PyObject_CallFunction(c->callback, "iN", timeout, text); /* New reference. */
 	else
 		ret = PyObject_CallFunction(c->callback, "iNO", timeout, text, c->data); /* New reference. */
 
 	if (ret == NULL) {
@@ -546,33 +551,33 @@
 static PyObject *cpy_register_generic(cpy_callback_t **list_head, PyObject *args, PyObject *kwds) {
 	char buf[512];
 	cpy_callback_t *c;
 	char *name = NULL;
 	PyObject *callback = NULL, *data = NULL, *mod = NULL;
 	static char *kwlist[] = {"callback", "data", "name", NULL};
-	
+
 	if (PyArg_ParseTupleAndKeywords(args, kwds, "O|Oet", kwlist, &callback, &data, NULL, &name) == 0) return NULL;
 	if (PyCallable_Check(callback) == 0) {
 		PyMem_Free(name);
 		PyErr_SetString(PyExc_TypeError, "callback needs a be a callable object.");
 		return NULL;
 	}
 	cpy_build_name(buf, sizeof(buf), callback, name);
 
 	Py_INCREF(callback);
 	Py_XINCREF(data);
 
-	c = malloc(sizeof(*c));
+	c = calloc(1, sizeof(*c));
 	if (c == NULL)
 		return NULL;
-	memset (c, 0, sizeof (*c));
 
 	c->name = strdup(buf);
 	c->callback = callback;
 	c->data = data;
 	c->next = *list_head;
+	++cpy_num_callbacks;
 	*list_head = c;
 	Py_XDECREF(mod);
 	PyMem_Free(name);
 	return cpy_string_to_unicode_or_bytes(buf);
 }
 
@@ -581,26 +586,25 @@
 		Py_RETURN_NONE;
 	}
 	return PyFloat_FromDouble(number);
 }
 
 static PyObject *cpy_get_dataset(PyObject *self, PyObject *args) {
-	int i;
 	char *name;
 	const data_set_t *ds;
 	PyObject *list, *tuple;
 
 	if (PyArg_ParseTuple(args, "et", NULL, &name) == 0) return NULL;
 	ds = plugin_get_ds(name);
 	PyMem_Free(name);
 	if (ds == NULL) {
 		PyErr_Format(PyExc_TypeError, "Dataset %s not found", name);
 		return NULL;
 	}
 	list = PyList_New(ds->ds_num); /* New reference. */
-	for (i = 0; i < ds->ds_num; ++i) {
+	for (size_t i = 0; i < ds->ds_num; ++i) {
 		tuple = PyTuple_New(4);
 		PyTuple_SET_ITEM(tuple, 0, cpy_string_to_unicode_or_bytes(ds->ds[i].name));
 		PyTuple_SET_ITEM(tuple, 1, cpy_string_to_unicode_or_bytes(DS_TYPE_TO_STRING(ds->ds[i].type)));
 		PyTuple_SET_ITEM(tuple, 2, float_or_none(ds->ds[i].min));
 		PyTuple_SET_ITEM(tuple, 3, float_or_none(ds->ds[i].max));
 		PyList_SET_ITEM(list, i, tuple);
@@ -609,13 +613,13 @@
 }
 
 static PyObject *cpy_flush(PyObject *self, PyObject *args, PyObject *kwds) {
 	int timeout = -1;
 	char *plugin = NULL, *identifier = NULL;
 	static char *kwlist[] = {"plugin", "timeout", "identifier", NULL};
-	
+
 	if (PyArg_ParseTupleAndKeywords(args, kwds, "|etiet", kwlist, NULL, &plugin, &timeout, NULL, &identifier) == 0) return NULL;
 	Py_BEGIN_ALLOW_THREADS
 	plugin_flush(plugin, timeout, identifier);
 	Py_END_ALLOW_THREADS
 	PyMem_Free(plugin);
 	PyMem_Free(identifier);
@@ -633,88 +637,84 @@
 typedef int reg_function_t(const char *name, void *callback, void *data);
 
 static PyObject *cpy_register_generic_userdata(void *reg, void *handler, PyObject *args, PyObject *kwds) {
 	char buf[512];
 	reg_function_t *register_function = (reg_function_t *) reg;
 	cpy_callback_t *c = NULL;
-	user_data_t user_data;
 	char *name = NULL;
 	PyObject *callback = NULL, *data = NULL;
 	static char *kwlist[] = {"callback", "data", "name", NULL};
-	
+
 	if (PyArg_ParseTupleAndKeywords(args, kwds, "O|Oet", kwlist, &callback, &data, NULL, &name) == 0) return NULL;
 	if (PyCallable_Check(callback) == 0) {
 		PyMem_Free(name);
 		PyErr_SetString(PyExc_TypeError, "callback needs a be a callable object.");
 		return NULL;
 	}
 	cpy_build_name(buf, sizeof(buf), callback, name);
 	PyMem_Free(name);
-	
+
 	Py_INCREF(callback);
 	Py_XINCREF(data);
 
-	c = malloc(sizeof(*c));
+	c = calloc(1, sizeof(*c));
 	if (c == NULL)
 		return NULL;
-	memset (c, 0, sizeof (*c));
 
 	c->name = strdup(buf);
 	c->callback = callback;
 	c->data = data;
 	c->next = NULL;
 
-	memset (&user_data, 0, sizeof (user_data));
-	user_data.free_func = cpy_destroy_user_data;
-	user_data.data = c;
+	user_data_t user_data = {
+		.data = c,
+		.free_func = cpy_destroy_user_data
+	};
 
 	register_function(buf, handler, &user_data);
+	++cpy_num_callbacks;
 	return cpy_string_to_unicode_or_bytes(buf);
 }
 
 static PyObject *cpy_register_read(PyObject *self, PyObject *args, PyObject *kwds) {
 	char buf[512];
 	cpy_callback_t *c = NULL;
-	user_data_t user_data;
 	double interval = 0;
 	char *name = NULL;
 	PyObject *callback = NULL, *data = NULL;
-	struct timespec ts;
 	static char *kwlist[] = {"callback", "interval", "data", "name", NULL};
-	
+
 	if (PyArg_ParseTupleAndKeywords(args, kwds, "O|dOet", kwlist, &callback, &interval, &data, NULL, &name) == 0) return NULL;
 	if (PyCallable_Check(callback) == 0) {
 		PyMem_Free(name);
 		PyErr_SetString(PyExc_TypeError, "callback needs a be a callable object.");
 		return NULL;
 	}
 	cpy_build_name(buf, sizeof(buf), callback, name);
 	PyMem_Free(name);
-	
+
 	Py_INCREF(callback);
 	Py_XINCREF(data);
 
-	c = malloc(sizeof(*c));
+	c = calloc(1, sizeof(*c));
 	if (c == NULL)
 		return NULL;
-	memset (c, 0, sizeof (*c));
 
 	c->name = strdup(buf);
 	c->callback = callback;
 	c->data = data;
 	c->next = NULL;
 
-	memset (&user_data, 0, sizeof (user_data));
-	user_data.free_func = cpy_destroy_user_data;
-	user_data.data = c;
+	user_data_t user_data = {
+		.data = c,
+		.free_func = cpy_destroy_user_data
+	};
 
-	ts.tv_sec = interval;
-	ts.tv_nsec = (interval - ts.tv_sec) * 1000000000;
 	plugin_register_complex_read(/* group = */ "python", buf,
-			cpy_read_callback, &ts, &user_data);
-
+			cpy_read_callback, DOUBLE_TO_CDTIME_T (interval), &user_data);
+	++cpy_num_callbacks;
 	return cpy_string_to_unicode_or_bytes(buf);
 }
 
 static PyObject *cpy_register_log(PyObject *self, PyObject *args, PyObject *kwds) {
 	return cpy_register_generic_userdata((void *) plugin_register_log,
 			(void *) cpy_log_callback, args, kwds);
@@ -814,22 +814,31 @@
 
 	Py_DECREF(arg);
 	if (tmp == NULL) {
 		PyErr_Format(PyExc_RuntimeError, "Unable to unregister %s callback '%s'.", desc, name);
 		return NULL;
 	}
-	/* Yes, this is actually save. To call this function the caller has to
-	 * hold the GIL. Well, save as long as there is only one GIL anyway ... */
+	/* Yes, this is actually safe. To call this function the caller has to
+	 * hold the GIL. Well, safe as long as there is only one GIL anyway ... */
 	if (prev == NULL)
 		*list_head = tmp->next;
 	else
 		prev->next = tmp->next;
 	cpy_destroy_user_data(tmp);
 	Py_RETURN_NONE;
 }
 
+static void cpy_unregister_list(cpy_callback_t **list_head) {
+	cpy_callback_t *cur, *next;
+	for (cur = *list_head; cur; cur = next) {
+		next = cur->next;
+		cpy_destroy_user_data(cur);
+	}
+	*list_head = NULL;
+}
+
 typedef int cpy_unregister_function_t(const char *name);
 
 static PyObject *cpy_unregister_generic_userdata(cpy_unregister_function_t *unreg, PyObject *arg, const char *desc) {
 	char buf[512];
 	const char *name;
 
@@ -911,139 +920,157 @@
 	{"unregister_flush", cpy_unregister_flush, METH_O, unregister_doc},
 	{"unregister_shutdown", cpy_unregister_shutdown, METH_O, unregister_doc},
 	{0, 0, 0, 0}
 };
 
 static int cpy_shutdown(void) {
-	cpy_callback_t *c;
 	PyObject *ret;
-	
-	/* This can happen if the module was loaded but not configured. */
-	if (state != NULL)
-		PyEval_RestoreThread(state);
 
-	for (c = cpy_shutdown_callbacks; c; c = c->next) {
+	if (!state) {
+		printf("================================================================\n");
+		printf("collectd shutdown while running an interactive session. This will\n");
+		printf("probably leave your terminal in a mess.\n");
+		printf("Run the command \"reset\" to get it back into a usable state.\n");
+		printf("You can press Ctrl+D in the interactive session to\n");
+		printf("close collectd and avoid this problem in the future.\n");
+		printf("================================================================\n");
+	}
+
+	CPY_LOCK_THREADS
+
+	for (cpy_callback_t *c = cpy_shutdown_callbacks; c; c = c->next) {
 		ret = PyObject_CallFunctionObjArgs(c->callback, c->data, (void *) 0); /* New reference. */
 		if (ret == NULL)
 			cpy_log_exception("shutdown callback");
 		else
 			Py_DECREF(ret);
 	}
 	PyErr_Print();
-	Py_Finalize();
+
+	Py_BEGIN_ALLOW_THREADS
+	cpy_unregister_list(&cpy_config_callbacks);
+	cpy_unregister_list(&cpy_init_callbacks);
+	cpy_unregister_list(&cpy_shutdown_callbacks);
+	cpy_shutdown_triggered = 1;
+	Py_END_ALLOW_THREADS
+
+	if (!cpy_num_callbacks) {
+		Py_Finalize();
+		return 0;
+	}
+
+	CPY_RELEASE_THREADS
 	return 0;
 }
 
-static void cpy_int_handler(int sig) {
-	return;
-}
+static void *cpy_interactive(void *pipefd) {
+	PyOS_sighandler_t cur_sig;
 
-static void *cpy_interactive(void *data) {
-	sigset_t sigset;
-	struct sigaction sig_int_action, old;
-	
 	/* Signal handler in a plugin? Bad stuff, but the best way to
 	 * handle it I guess. In an interactive session people will
 	 * press Ctrl+C at some time, which will generate a SIGINT.
 	 * This will cause collectd to shutdown, thus killing the
 	 * interactive interpreter, and leaving the terminal in a
 	 * mess. Chances are, this isn't what the user wanted to do.
-	 * 
+	 *
 	 * So this is the plan:
-	 * 1. Block SIGINT in the main thread.
-	 * 2. Install our own signal handler that does nothing.
-	 * 3. Unblock SIGINT in the interactive thread.
+	 * 1. Restore Python's own signal handler
+	 * 2. Tell Python we just forked so it will accept this thread
+	 *    as the main one. No version of Python will ever handle
+	 *    interrupts anywhere but in the main thread.
+	 * 3. After the interactive loop is done, restore collectd's
+	 *    SIGINT handler.
+	 * 4. Raise SIGINT for a clean shutdown. The signal is sent to
+	 *    the main thread to ensure it wakes up the main interval
+	 *    sleep so that collectd shuts down immediately not in 10
+	 *    seconds.
 	 *
 	 * This will make sure that SIGINT won't kill collectd but
-	 * still interrupt syscalls like sleep and pause.
-	 * It does not raise a KeyboardInterrupt exception because so
-	 * far nobody managed to figure out how to do that. */
-	memset (&sig_int_action, '\0', sizeof (sig_int_action));
-	sig_int_action.sa_handler = cpy_int_handler;
-	sigaction (SIGINT, &sig_int_action, &old);
-	
-	sigemptyset(&sigset);
-	sigaddset(&sigset, SIGINT);
-	pthread_sigmask(SIG_UNBLOCK, &sigset, NULL);
-	PyEval_AcquireThread(state);
+	 * still interrupt syscalls like sleep and pause. */
+
 	if (PyImport_ImportModule("readline") == NULL) {
 		/* This interactive session will suck. */
 		cpy_log_exception("interactive session init");
 	}
+	cur_sig = PyOS_setsig(SIGINT, python_sigint_handler);
+	PyOS_AfterFork();
+	PyEval_InitThreads();
+	close(*(int *) pipefd);
 	PyRun_InteractiveLoop(stdin, "<stdin>");
+	PyOS_setsig(SIGINT, cur_sig);
 	PyErr_Print();
-	PyEval_ReleaseThread(state);
+	state = PyEval_SaveThread();
 	NOTICE("python: Interactive interpreter exited, stopping collectd ...");
-	/* Restore the original collectd SIGINT handler and raise SIGINT.
-	 * The main thread still has SIGINT blocked and there's nothing we
-	 * can do about that so this thread will handle it. But that's not
-	 * important, except that it won't interrupt the main loop and so
-	 * it might take a few seconds before collectd really shuts down. */
-	sigaction (SIGINT, &old, NULL);
-	raise(SIGINT);
-	pause();
+	pthread_kill(main_thread, SIGINT);
 	return NULL;
 }
 
 static int cpy_init(void) {
-	cpy_callback_t *c;
 	PyObject *ret;
+	int pipefd[2];
+	char buf;
 	static pthread_t thread;
-	sigset_t sigset;
-	
+
 	if (!Py_IsInitialized()) {
 		WARNING("python: Plugin loaded but not configured.");
 		plugin_unregister_shutdown("python");
+		Py_Finalize();
 		return 0;
 	}
-	PyEval_InitThreads();
-	/* Now it's finally OK to use python threads. */
-	for (c = cpy_init_callbacks; c; c = c->next) {
+	main_thread = pthread_self();
+	if (do_interactive) {
+		if (pipe(pipefd)) {
+			ERROR("python: Unable to create pipe.");
+			return 1;
+		}
+		if (plugin_thread_create(&thread, NULL, cpy_interactive, pipefd + 1)) {
+			ERROR("python: Error creating thread for interactive interpreter.");
+		}
+		if(read(pipefd[0], &buf, 1))
+			;
+		(void)close(pipefd[0]);
+	} else {
+		PyEval_InitThreads();
+		state = PyEval_SaveThread();
+	}
+	CPY_LOCK_THREADS
+	for (cpy_callback_t *c = cpy_init_callbacks; c; c = c->next) {
 		ret = PyObject_CallFunctionObjArgs(c->callback, c->data, (void *) 0); /* New reference. */
 		if (ret == NULL)
 			cpy_log_exception("init callback");
 		else
 			Py_DECREF(ret);
 	}
-	sigemptyset(&sigset);
-	sigaddset(&sigset, SIGINT);
-	pthread_sigmask(SIG_BLOCK, &sigset, NULL);
-	state = PyEval_SaveThread();
-	if (do_interactive) {
-		if (plugin_thread_create(&thread, NULL, cpy_interactive, NULL)) {
-			ERROR("python: Error creating thread for interactive interpreter.");
-		}
-	}
+	CPY_RELEASE_THREADS
 
 	return 0;
 }
 
 static PyObject *cpy_oconfig_to_pyconfig(oconfig_item_t *ci, PyObject *parent) {
-	int i;
 	PyObject *item, *values, *children, *tmp;
-	
+
 	if (parent == NULL)
 		parent = Py_None;
-	
+
 	values = PyTuple_New(ci->values_num); /* New reference. */
-	for (i = 0; i < ci->values_num; ++i) {
+	for (int i = 0; i < ci->values_num; ++i) {
 		if (ci->values[i].type == OCONFIG_TYPE_STRING) {
 			PyTuple_SET_ITEM(values, i, cpy_string_to_unicode_or_bytes(ci->values[i].value.string));
 		} else if (ci->values[i].type == OCONFIG_TYPE_NUMBER) {
 			PyTuple_SET_ITEM(values, i, PyFloat_FromDouble(ci->values[i].value.number));
 		} else if (ci->values[i].type == OCONFIG_TYPE_BOOLEAN) {
 			PyTuple_SET_ITEM(values, i, PyBool_FromLong(ci->values[i].value.boolean));
 		}
 	}
-	
+
 	tmp = cpy_string_to_unicode_or_bytes(ci->key);
 	item = PyObject_CallFunction((void *) &ConfigType, "NONO", tmp, parent, values, Py_None);
 	if (item == NULL)
 		return NULL;
 	children = PyTuple_New(ci->children_num); /* New reference. */
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		PyTuple_SET_ITEM(children, i, cpy_oconfig_to_pyconfig(ci->children + i, item));
 	}
 	tmp = ((Config *) item)->children;
 	((Config *) item)->children = children;
 	Py_XDECREF(tmp);
 	return item;
@@ -1061,25 +1088,29 @@
 PyMODINIT_FUNC PyInit_collectd(void) {
 	return PyModule_Create(&collectdmodule);
 }
 #endif
 
 static int cpy_init_python(void) {
+	PyOS_sighandler_t cur_sig;
 	PyObject *sys;
 	PyObject *module;
 
 #ifdef IS_PY3K
 	wchar_t *argv = L"";
 	/* Add a builtin module, before Py_Initialize */
 	PyImport_AppendInittab("collectd", PyInit_collectd);
 #else
 	char *argv = "";
 #endif
-	
+
+	/* Chances are the current signal handler is already SIG_DFL, but let's make sure. */
+	cur_sig = PyOS_setsig(SIGINT, SIG_DFL);
 	Py_Initialize();
-	
+	python_sigint_handler = PyOS_setsig(SIGINT, cur_sig);
+
 	PyType_Ready(&ConfigType);
 	PyType_Ready(&PluginDataType);
 	ValuesType.tp_base = &PluginDataType;
 	PyType_Ready(&ValuesType);
 	NotificationType.tp_base = &PluginDataType;
 	PyType_Ready(&NotificationType);
@@ -1124,101 +1155,126 @@
 	PyModule_AddStringConstant(module, "DS_TYPE_DERIVE", DS_TYPE_TO_STRING(DS_TYPE_DERIVE));
 	PyModule_AddStringConstant(module, "DS_TYPE_ABSOLUTE", DS_TYPE_TO_STRING(DS_TYPE_ABSOLUTE));
 	return 0;
 }
 
 static int cpy_config(oconfig_item_t *ci) {
-	int i;
 	PyObject *tb;
+	int status = 0;
 
 	/* Ok in theory we shouldn't do initialization at this point
 	 * but we have to. In order to give python scripts a chance
 	 * to register a config callback we need to be able to execute
 	 * python code during the config callback so we have to start
 	 * the interpreter here. */
 	/* Do *not* use the python "thread" module at this point! */
 
 	if (!Py_IsInitialized() && cpy_init_python()) return 1;
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *item = ci->children + i;
-		
+
 		if (strcasecmp(item->key, "Interactive") == 0) {
-			if (item->values_num != 1 || item->values[0].type != OCONFIG_TYPE_BOOLEAN)
+			if (cf_util_get_boolean(item, &do_interactive) != 0) {
+				status = 1;
 				continue;
-			do_interactive = item->values[0].value.boolean;
+			}
 		} else if (strcasecmp(item->key, "Encoding") == 0) {
-			if (item->values_num != 1 || item->values[0].type != OCONFIG_TYPE_STRING)
+			char *encoding = NULL;
+			if (cf_util_get_string(item, &encoding) != 0) {
+				status = 1;
 				continue;
+			}
 #ifdef IS_PY3K
-			NOTICE("python: \"Encoding\" was used in the config file but Python3 was used, which does not support changing encodings. Ignoring this.");
+			ERROR("python: \"Encoding\" was used in the config file but Python3 was used, which does not support changing encodings");
+			status = 1;
+			sfree(encoding);
+			continue;
 #else
 			/* Why is this even necessary? And undocumented? */
-			if (PyUnicode_SetDefaultEncoding(item->values[0].value.string))
+			if (PyUnicode_SetDefaultEncoding(encoding)) {
 				cpy_log_exception("setting default encoding");
+				status = 1;
+			}
 #endif
+			sfree(encoding);
 		} else if (strcasecmp(item->key, "LogTraces") == 0) {
-			if (item->values_num != 1 || item->values[0].type != OCONFIG_TYPE_BOOLEAN)
+			_Bool log_traces;
+			if (cf_util_get_boolean(item, &log_traces) != 0) {
+				status = 1;
 				continue;
-			if (!item->values[0].value.boolean) {
+			}
+			if (!log_traces) {
 				Py_XDECREF(cpy_format_exception);
 				cpy_format_exception = NULL;
 				continue;
 			}
 			if (cpy_format_exception)
 				continue;
 			tb = PyImport_ImportModule("traceback"); /* New reference. */
 			if (tb == NULL) {
 				cpy_log_exception("python initialization");
+				status = 1;
 				continue;
 			}
 			cpy_format_exception = PyObject_GetAttrString(tb, "format_exception"); /* New reference. */
 			Py_DECREF(tb);
-			if (cpy_format_exception == NULL)
+			if (cpy_format_exception == NULL) {
 				cpy_log_exception("python initialization");
+				status = 1;
+			}
 		} else if (strcasecmp(item->key, "ModulePath") == 0) {
 			char *dir = NULL;
 			PyObject *dir_object;
-			
-			if (cf_util_get_string(item, &dir) != 0) 
+
+			if (cf_util_get_string(item, &dir) != 0) {
+				status = 1;
 				continue;
+			}
 			dir_object = cpy_string_to_unicode_or_bytes(dir); /* New reference. */
 			if (dir_object == NULL) {
 				ERROR("python plugin: Unable to convert \"%s\" to "
 				      "a python object.", dir);
 				free(dir);
 				cpy_log_exception("python initialization");
+				status = 1;
 				continue;
 			}
 			if (PyList_Insert(sys_path, 0, dir_object) != 0) {
 				ERROR("python plugin: Unable to prepend \"%s\" to "
 				      "python module path.", dir);
 				cpy_log_exception("python initialization");
+				status = 1;
 			}
 			Py_DECREF(dir_object);
 			free(dir);
 		} else if (strcasecmp(item->key, "Import") == 0) {
 			char *module_name = NULL;
 			PyObject *module;
-			
-			if (cf_util_get_string(item, &module_name) != 0) 
+
+			if (cf_util_get_string(item, &module_name) != 0) {
+				status = 1;
 				continue;
+			}
 			module = PyImport_ImportModule(module_name); /* New reference. */
 			if (module == NULL) {
 				ERROR("python plugin: Error importing module \"%s\".", module_name);
 				cpy_log_exception("importing module");
+				status = 1;
 			}
 			free(module_name);
 			Py_XDECREF(module);
 		} else if (strcasecmp(item->key, "Module") == 0) {
 			char *name = NULL;
 			cpy_callback_t *c;
 			PyObject *ret;
-			
-			if (cf_util_get_string(item, &name) != 0)
+
+			if (cf_util_get_string(item, &name) != 0) {
+				status = 1;
 				continue;
+			}
 			for (c = cpy_config_callbacks; c; c = c->next) {
 				if (strcasecmp(c->name + 7, name) == 0)
 					break;
 			}
 			if (c == NULL) {
 				WARNING("python plugin: Found a configuration for the \"%s\" plugin, "
@@ -1231,21 +1287,23 @@
 			if (c->data == NULL)
 				ret = PyObject_CallFunction(c->callback, "N",
 					cpy_oconfig_to_pyconfig(item, NULL)); /* New reference. */
 			else
 				ret = PyObject_CallFunction(c->callback, "NO",
 					cpy_oconfig_to_pyconfig(item, NULL), c->data); /* New reference. */
-			if (ret == NULL)
+			if (ret == NULL) {
 				cpy_log_exception("loading module");
-			else
+				status = 1;
+			} else
 				Py_DECREF(ret);
 		} else {
-			WARNING("python plugin: Ignoring unknown config key \"%s\".", item->key);
+			ERROR("python plugin: Unknown config key \"%s\".", item->key);
+			status = 1;
 		}
 	}
-	return 0;
+	return (status);
 }
 
 void module_register(void) {
 	plugin_register_complex_config("python", cpy_config);
 	plugin_register_init("python", cpy_init);
 	plugin_register_shutdown("python", cpy_shutdown);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pyvalues.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pyvalues.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/pyvalues.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/pyvalues.c	2016-09-11 16:10:25.271038709 +0800
@@ -18,13 +18,13 @@
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
- *   Sven Trenkel <collectd at semidefinite.de>  
+ *   Sven Trenkel <collectd at semidefinite.de>
  **/
 
 #include <Python.h>
 #include <structmember.h>
 
 #include "collectd.h"
@@ -42,29 +43,29 @@
 
 static PyObject *cpy_common_repr(PyObject *s) {
 	PyObject *ret, *tmp;
 	static PyObject *l_type = NULL, *l_type_instance = NULL, *l_plugin = NULL, *l_plugin_instance = NULL;
 	static PyObject *l_host = NULL, *l_time = NULL;
 	PluginData *self = (PluginData *) s;
-	
+
 	if (l_type == NULL)
 		l_type = cpy_string_to_unicode_or_bytes("(type=");
 	if (l_type_instance == NULL)
 		l_type_instance = cpy_string_to_unicode_or_bytes(",type_instance=");
 	if (l_plugin == NULL)
 		l_plugin = cpy_string_to_unicode_or_bytes(",plugin=");
 	if (l_plugin_instance == NULL)
 		l_plugin_instance = cpy_string_to_unicode_or_bytes(",plugin_instance=");
 	if (l_host == NULL)
 		l_host = cpy_string_to_unicode_or_bytes(",host=");
 	if (l_time == NULL)
 		l_time = cpy_string_to_unicode_or_bytes(",time=");
-	
+
 	if (!l_type || !l_type_instance || !l_plugin || !l_plugin_instance || !l_host || !l_time)
 		return NULL;
-	
+
 	ret = cpy_string_to_unicode_or_bytes(s->ob_type->tp_name);
 
 	CPY_STRCAT(&ret, l_type);
 	tmp = cpy_string_to_unicode_or_bytes(self->type);
 	CPY_SUBSTITUTE(PyObject_Repr, tmp, tmp);
 	CPY_STRCAT_AND_DEL(&ret, tmp);
@@ -103,45 +104,45 @@
 		CPY_SUBSTITUTE(PyObject_Repr, tmp, tmp);
 		CPY_STRCAT_AND_DEL(&ret, tmp);
 	}
 	return ret;
 }
 
-static char time_doc[] = "This is the Unix timestap of the time this value was read.\n"
+static char time_doc[] = "This is the Unix timestamp of the time this value was read.\n"
 		"For dispatching values this can be set to 0 which means \"now\".\n"
 		"This means the time the value is actually dispatched, not the time\n"
 		"it was set to 0.";
 
 static char host_doc[] = "The hostname of the host this value was read from.\n"
 		"For dispatching this can be set to an empty string which means\n"
-		"the local hostname as defined in the collectd.conf.";
+		"the local hostname as defined in collectd.conf.";
 
 static char type_doc[] = "The type of this value. This type has to be defined\n"
-		"in your types.db. Attempting to set it to any other value will\n"
-		"raise a TypeError exception.\n"
-		"Assigning a type is mandetory, calling dispatch without doing\n"
+		"in the types.db file. Attempting to set it to any other value\n"
+		"will raise a TypeError exception.\n"
+		"Assigning a type is mandatory, calling dispatch without doing\n"
 		"so will raise a RuntimeError exception.";
 
 static char type_instance_doc[] = "";
 
 static char plugin_doc[] = "The name of the plugin that read the data. Setting this\n"
 		"member to an empty string will insert \"python\" upon dispatching.";
 
 static char plugin_instance_doc[] = "";
 
 static char PluginData_doc[] = "This is an internal class that is the base for Values\n"
-		"and Notification. It is pretty useless by itself and was therefore not\n"
+		"and Notification. It is pretty useless by itself and is therefore not\n"
 		"exported to the collectd module.";
 
 static PyObject *PluginData_new(PyTypeObject *type, PyObject *args, PyObject *kwds) {
 	PluginData *self;
-	
+
 	self = (PluginData *) type->tp_alloc(type, 0);
 	if (self == NULL)
 		return NULL;
-	
+
 	self->time = 0;
 	self->host[0] = 0;
 	self->plugin[0] = 0;
 	self->plugin_instance[0] = 0;
 	self->type[0] = 0;
 	self->type_instance[0] = 0;
@@ -151,17 +152,17 @@
 static int PluginData_init(PyObject *s, PyObject *args, PyObject *kwds) {
 	PluginData *self = (PluginData *) s;
 	double time = 0;
 	char *type = NULL, *plugin_instance = NULL, *type_instance = NULL, *plugin = NULL, *host = NULL;
 	static char *kwlist[] = {"type", "plugin_instance", "type_instance",
 			"plugin", "host", "time", NULL};
-	
+
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "|etetetetetd", kwlist, NULL, &type,
 			NULL, &plugin_instance, NULL, &type_instance, NULL, &plugin, NULL, &host, &time))
 		return -1;
-	
+
 	if (type && plugin_get_ds(type) == NULL) {
 		PyErr_Format(PyExc_TypeError, "Dataset %s not found", type);
 		FreeAll();
 		return -1;
 	}
 
@@ -177,39 +178,39 @@
 	return 0;
 }
 
 static PyObject *PluginData_repr(PyObject *s) {
 	PyObject *ret;
 	static PyObject *l_closing = NULL;
-	
+
 	if (l_closing == NULL)
 		l_closing = cpy_string_to_unicode_or_bytes(")");
-	
+
 	if (l_closing == NULL)
 		return NULL;
-	
+
 	ret = cpy_common_repr(s);
 	CPY_STRCAT(&ret, l_closing);
 	return ret;
 }
 
 static PyMemberDef PluginData_members[] = {
 	{"time", T_DOUBLE, offsetof(PluginData, time), 0, time_doc},
 	{NULL}
 };
 
 static PyObject *PluginData_getstring(PyObject *self, void *data) {
 	const char *value = ((char *) self) + (intptr_t) data;
-	
+
 	return cpy_string_to_unicode_or_bytes(value);
 }
 
 static int PluginData_setstring(PyObject *self, PyObject *value, void *data) {
 	char *old;
 	const char *new;
-	
+
 	if (value == NULL) {
 		PyErr_SetString(PyExc_TypeError, "Cannot delete this attribute");
 		return -1;
 	}
 	Py_INCREF(value);
 	new = cpy_unicode_or_bytes_to_string(&value);
@@ -223,13 +224,13 @@
 	return 0;
 }
 
 static int PluginData_settype(PyObject *self, PyObject *value, void *data) {
 	char *old;
 	const char *new;
-	
+
 	if (value == NULL) {
 		PyErr_SetString(PyExc_TypeError, "Cannot delete this attribute");
 		return -1;
 	}
 	Py_INCREF(value);
 	new = cpy_unicode_or_bytes_to_string(&value);
@@ -309,23 +310,23 @@
 		"If you submit values more often than the specified interval, the average\n"
 		"will be used. If you submit less values, your graphs will have gaps.";
 
 static char values_doc[] = "These are the actual values that get dispatched to collectd.\n"
 		"It has to be a sequence (a tuple or list) of numbers.\n"
 		"The size of the sequence and the type of its content depend on the type\n"
-		"member your types.db file. For more information on this read the types.db\n"
-		"man page.\n"
+		"member in the types.db file. For more information on this read the\n"
+		"types.db man page.\n"
 		"\n"
 		"If the sequence does not have the correct size upon dispatch a RuntimeError\n"
 		"exception will be raised. If the content of the sequence is not a number,\n"
 		"a TypeError exception will be raised.";
 
 static char meta_doc[] = "These are the meta data for this Value object.\n"
 		"It has to be a dictionary of numbers, strings or bools. All keys must be\n"
 		"strings. int and long objects will be dispatched as signed integers unless\n"
-		"they are between 2**63 and 2**64-1, which will result in a unsigned integer.\n"
+		"they are between 2**63 and 2**64-1, which will result in an unsigned integer.\n"
 		"You can force one of these storage classes by using the classes\n"
 		"collectd.Signed and collectd.Unsigned. A meta object received by a write\n"
 		"callback will always contain Signed or Unsigned objects.";
 
 static char dispatch_doc[] = "dispatch([type][, values][, plugin_instance][, type_instance]"
 		"[, plugin][, host][, time][, interval]) -> None.  Dispatch a value list.\n"
@@ -337,26 +338,26 @@
 		"If you do not submit a parameter the value saved in its member will be submitted.\n"
 		"If you do provide a parameter it will be used instead, without altering the member.";
 
 static char write_doc[] = "write([destination][, type][, values][, plugin_instance][, type_instance]"
 		"[, plugin][, host][, time][, interval]) -> None.  Dispatch a value list.\n"
 		"\n"
-		"Write this instance to a single plugin or all plugins if 'destination' is obmitted.\n"
+		"Write this instance to a single plugin or all plugins if 'destination' is omitted.\n"
 		"This will bypass the main collectd process and all filtering and caching.\n"
 		"Other than that it works similar to 'dispatch'. In most cases 'dispatch' should be\n"
 		"used instead of 'write'.\n";
 
 static char Values_doc[] = "A Values object used for dispatching values to collectd and receiving values from write callbacks.";
 
 static PyObject *Values_new(PyTypeObject *type, PyObject *args, PyObject *kwds) {
 	Values *self;
-	
+
 	self = (Values *) PluginData_new(type, args, kwds);
 	if (self == NULL)
 		return NULL;
-	
+
 	self->values = PyList_New(0);
 	self->meta = PyDict_New();
 	self->interval = 0;
 	return (PyObject *) self;
 }
 
@@ -364,18 +365,18 @@
 	Values *self = (Values *) s;
 	double interval = 0, time = 0;
 	PyObject *values = NULL, *meta = NULL, *tmp;
 	char *type = NULL, *plugin_instance = NULL, *type_instance = NULL, *plugin = NULL, *host = NULL;
 	static char *kwlist[] = {"type", "values", "plugin_instance", "type_instance",
 			"plugin", "host", "time", "interval", "meta", NULL};
-	
+
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "|etOetetetetddO", kwlist,
 			NULL, &type, &values, NULL, &plugin_instance, NULL, &type_instance,
 			NULL, &plugin, NULL, &host, &time, &interval, &meta))
 		return -1;
-	
+
 	if (type && plugin_get_ds(type) == NULL) {
 		PyErr_Format(PyExc_TypeError, "Dataset %s not found", type);
 		FreeAll();
 		return -1;
 	}
 
@@ -391,37 +392,37 @@
 	if (values == NULL) {
 		values = PyList_New(0);
 		PyErr_Clear();
 	} else {
 		Py_INCREF(values);
 	}
-	
+
 	if (meta == NULL) {
 		meta = PyDict_New();
 		PyErr_Clear();
 	} else {
 		Py_INCREF(meta);
 	}
-	
+
 	tmp = self->values;
 	self->values = values;
 	Py_XDECREF(tmp);
-	
+
 	tmp = self->meta;
 	self->meta = meta;
 	Py_XDECREF(tmp);
 
 	self->interval = interval;
 	return 0;
 }
 
 static meta_data_t *cpy_build_meta(PyObject *meta) {
-	int i, s;
+	int s;
 	meta_data_t *m = NULL;
 	PyObject *l;
-	
+
 	if ((meta == NULL) || (meta == Py_None))
 		return NULL;
 
 	l = PyDict_Items(meta); /* New reference. */
 	if (!l) {
 		cpy_log_exception("building meta data");
@@ -431,16 +432,16 @@
 	if (s <= 0) {
 		Py_XDECREF(l);
 		return NULL;
 	}
 
 	m = meta_data_create();
-	for (i = 0; i < s; ++i) {
+	for (int i = 0; i < s; ++i) {
 		const char *string, *keystring;
 		PyObject *key, *value, *item, *tmp;
-		
+
 		item = PyList_GET_ITEM(l, i);
 		key = PyTuple_GET_ITEM(item, 0);
 		Py_INCREF(key);
 		keystring = cpy_unicode_or_bytes_to_string(&key);
 		if (!keystring) {
 			PyErr_Clear();
@@ -499,21 +500,21 @@
 	}
 	Py_XDECREF(l);
 	return m;
 }
 
 static PyObject *Values_dispatch(Values *self, PyObject *args, PyObject *kwds) {
-	int i, ret;
+	int ret;
 	const data_set_t *ds;
-	int size;
+	size_t size;
 	value_t *value;
 	value_list_t value_list = VALUE_LIST_INIT;
 	PyObject *values = self->values, *meta = self->meta;
 	double time = self->data.time, interval = self->interval;
 	char *host = NULL, *plugin = NULL, *plugin_instance = NULL, *type = NULL, *type_instance = NULL;
-	
+
 	static char *kwlist[] = {"type", "values", "plugin_instance", "type_instance",
 			"plugin", "host", "time", "interval", "meta", NULL};
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "|etOetetetetddO", kwlist,
 			NULL, &type, &values, NULL, &plugin_instance, NULL, &type_instance,
 			NULL, &plugin, NULL, &host, &time, &interval, &meta))
 		return NULL;
@@ -539,21 +540,21 @@
 		return NULL;
 	}
 	if (meta != NULL && meta != Py_None && !PyDict_Check(meta)) {
 		PyErr_Format(PyExc_TypeError, "meta must be a dict");
 		return NULL;
 	}
-	size = (int) PySequence_Length(values);
+	size = (size_t) PySequence_Length(values);
 	if (size != ds->ds_num) {
-		PyErr_Format(PyExc_RuntimeError, "type %s needs %d values, got %i", value_list.type, ds->ds_num, size);
+		PyErr_Format(PyExc_RuntimeError, "type %s needs %zu values, got %zu", value_list.type, ds->ds_num, size);
 		return NULL;
 	}
-	value = malloc(size * sizeof(*value));
-	for (i = 0; i < size; ++i) {
+	value = calloc(size, sizeof(*value));
+	for (size_t i = 0; i < size; ++i) {
 		PyObject *item, *num;
-		item = PySequence_Fast_GET_ITEM(values, i); /* Borrowed reference. */
+		item = PySequence_Fast_GET_ITEM(values, (int) i); /* Borrowed reference. */
 		switch (ds->ds[i].type) {
 		case DS_TYPE_COUNTER:
 			num = PyNumber_Long(item); /* New reference. */
 			if (num != NULL) {
 				value[i].counter = PyLong_AsUnsignedLongLong(num);
 				Py_XDECREF(num);
@@ -613,21 +614,21 @@
 		return NULL;
 	}
 	Py_RETURN_NONE;
 }
 
 static PyObject *Values_write(Values *self, PyObject *args, PyObject *kwds) {
-	int i, ret;
+	int ret;
 	const data_set_t *ds;
-	int size;
+	size_t size;
 	value_t *value;
 	value_list_t value_list = VALUE_LIST_INIT;
 	PyObject *values = self->values, *meta = self->meta;
 	double time = self->data.time, interval = self->interval;
 	char *host = NULL, *plugin = NULL, *plugin_instance = NULL, *type = NULL, *type_instance = NULL, *dest = NULL;
-	
+
 	static char *kwlist[] = {"destination", "type", "values", "plugin_instance", "type_instance",
 			"plugin", "host", "time", "interval", "meta", NULL};
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "et|etOetetetetdiO", kwlist, NULL, &dest,
 			NULL, &type, &values, NULL, &plugin_instance, NULL, &type_instance,
 			NULL, &plugin, NULL, &host, &time, &interval, &meta))
 		return NULL;
@@ -648,19 +649,19 @@
 		return NULL;
 	}
 	if (values == NULL || (PyTuple_Check(values) == 0 && PyList_Check(values) == 0)) {
 		PyErr_Format(PyExc_TypeError, "values must be list or tuple");
 		return NULL;
 	}
-	size = (int) PySequence_Length(values);
+	size = (size_t) PySequence_Length(values);
 	if (size != ds->ds_num) {
-		PyErr_Format(PyExc_RuntimeError, "type %s needs %d values, got %i", value_list.type, ds->ds_num, size);
+		PyErr_Format(PyExc_RuntimeError, "type %s needs %zu values, got %zu", value_list.type, ds->ds_num, size);
 		return NULL;
 	}
-	value = malloc(size * sizeof(*value));
-	for (i = 0; i < size; ++i) {
+	value = calloc(size, sizeof(*value));
+	for (size_t i = 0; i < size; ++i) {
 		PyObject *item, *num;
 		item = PySequence_Fast_GET_ITEM(values, i); /* Borrowed reference. */
 		switch (ds->ds[i].type) {
 		case DS_TYPE_COUNTER:
 			num = PyNumber_Long(item); /* New reference. */
 			if (num != NULL) {
@@ -704,13 +705,13 @@
 		}
 	}
 	value_list.values = value;
 	value_list.values_len = size;
 	value_list.time = DOUBLE_TO_CDTIME_T(time);
 	value_list.interval = DOUBLE_TO_CDTIME_T(interval);
-	value_list.meta = cpy_build_meta(meta);;
+	value_list.meta = cpy_build_meta(meta);
 	if (value_list.host[0] == 0)
 		sstrncpy(value_list.host, hostname_g, sizeof(value_list.host));
 	if (value_list.plugin[0] == 0)
 		sstrncpy(value_list.plugin, "python", sizeof(value_list.plugin));
 	Py_BEGIN_ALLOW_THREADS;
 	ret = plugin_write(dest, NULL, &value_list);
@@ -725,25 +726,25 @@
 }
 
 static PyObject *Values_repr(PyObject *s) {
 	PyObject *ret, *tmp;
 	static PyObject *l_interval = NULL, *l_values = NULL, *l_meta = NULL, *l_closing = NULL;
 	Values *self = (Values *) s;
-	
+
 	if (l_interval == NULL)
 		l_interval = cpy_string_to_unicode_or_bytes(",interval=");
 	if (l_values == NULL)
 		l_values = cpy_string_to_unicode_or_bytes(",values=");
 	if (l_meta == NULL)
 		l_meta = cpy_string_to_unicode_or_bytes(",meta=");
 	if (l_closing == NULL)
 		l_closing = cpy_string_to_unicode_or_bytes(")");
-	
+
 	if (l_interval == NULL || l_values == NULL || l_meta == NULL || l_closing == NULL)
 		return NULL;
-	
+
 	ret = cpy_common_repr(s);
 	if (self->interval != 0) {
 		CPY_STRCAT(&ret, l_interval);
 		tmp = PyFloat_FromDouble(self->interval);
 		CPY_SUBSTITUTE(PyObject_Repr, tmp, tmp);
 		CPY_STRCAT_AND_DEL(&ret, tmp);
@@ -851,18 +852,18 @@
 	int severity = 0;
 	double time = 0;
 	char *message = NULL;
 	char *type = NULL, *plugin_instance = NULL, *type_instance = NULL, *plugin = NULL, *host = NULL;
 	static char *kwlist[] = {"type", "message", "plugin_instance", "type_instance",
 			"plugin", "host", "time", "severity", NULL};
-	
+
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "|etetetetetetdi", kwlist,
 			NULL, &type, NULL, &message, NULL, &plugin_instance, NULL, &type_instance,
 			NULL, &plugin, NULL, &host, &time, &severity))
 		return -1;
-	
+
 	if (type && plugin_get_ds(type) == NULL) {
 		PyErr_Format(PyExc_TypeError, "Dataset %s not found", type);
 		FreeAll();
 		PyMem_Free(message);
 		return -1;
 	}
@@ -886,13 +887,13 @@
 	const data_set_t *ds;
 	notification_t notification;
 	double t = self->data.time;
 	int severity = self->severity;
 	char *host = NULL, *plugin = NULL, *plugin_instance = NULL, *type = NULL, *type_instance = NULL;
 	char *message = NULL;
-	
+
 	static char *kwlist[] = {"type", "message", "plugin_instance", "type_instance",
 			"plugin", "host", "time", "severity", NULL};
 	if (!PyArg_ParseTupleAndKeywords(args, kwds, "|etetetetetetdi", kwlist,
 			NULL, &type, NULL, &message, NULL, &plugin_instance, NULL, &type_instance,
 			NULL, &plugin, NULL, &host, &t, &severity))
 		return NULL;
@@ -934,26 +935,26 @@
 	}
 	Py_RETURN_NONE;
 }
 
 static PyObject *Notification_new(PyTypeObject *type, PyObject *args, PyObject *kwds) {
 	Notification *self;
-	
+
 	self = (Notification *) PluginData_new(type, args, kwds);
 	if (self == NULL)
 		return NULL;
-	
+
 	self->message[0] = 0;
 	self->severity = 0;
 	return (PyObject *) self;
 }
 
 static int Notification_setstring(PyObject *self, PyObject *value, void *data) {
 	char *old;
 	const char *new;
-	
+
 	if (value == NULL) {
 		PyErr_SetString(PyExc_TypeError, "Cannot delete this attribute");
 		return -1;
 	}
 	Py_INCREF(value);
 	new = cpy_unicode_or_bytes_to_string(&value);
@@ -968,23 +969,23 @@
 }
 
 static PyObject *Notification_repr(PyObject *s) {
 	PyObject *ret, *tmp;
 	static PyObject *l_severity = NULL, *l_message = NULL, *l_closing = NULL;
 	Notification *self = (Notification *) s;
-	
+
 	if (l_severity == NULL)
 		l_severity = cpy_string_to_unicode_or_bytes(",severity=");
 	if (l_message == NULL)
 		l_message = cpy_string_to_unicode_or_bytes(",message=");
 	if (l_closing == NULL)
 		l_closing = cpy_string_to_unicode_or_bytes(")");
-	
+
 	if (l_severity == NULL || l_message == NULL || l_closing == NULL)
 		return NULL;
-	
+
 	ret = cpy_common_repr(s);
 	if (self->severity != 0) {
 		CPY_STRCAT(&ret, l_severity);
 		tmp = PyInt_FromLong(self->severity);
 		CPY_SUBSTITUTE(PyObject_Repr, tmp, tmp);
 		CPY_STRCAT_AND_DEL(&ret, tmp);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/redis.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/redis.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/redis.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/redis.c	2016-09-11 16:10:25.271038709 +0800
@@ -18,17 +18,16 @@
  *
  * Authors:
  *   Andrés J. Díaz <ajdiaz@connectical.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
-#include <pthread.h>
 #include <sys/time.h>
 #include <hiredis/hiredis.h>
 
 #ifndef HOST_NAME_MAX
 # define HOST_NAME_MAX _POSIX_HOST_NAME_MAX
 #endif
@@ -123,17 +122,16 @@
 } /* }}} */
 
 static redis_query_t *redis_config_query (oconfig_item_t *ci) /* {{{ */
 {
     redis_query_t *rq;
     int status;
-    int i;
 
     rq = calloc(1, sizeof(*rq));
     if (rq == NULL) {
-        ERROR("redis plugin: calloca failed adding redis_query.");
+        ERROR("redis plugin: calloc failed adding redis_query.");
         return NULL;
     }
     status = cf_util_get_string_buffer(ci, rq->query, sizeof(rq->query));
     if (status != 0)
         goto err;
 
@@ -141,13 +139,13 @@
      * Default to a gauge type.
      */
     (void)strncpy(rq->type, "gauge", sizeof(rq->type));
     (void)sstrncpy(rq->instance, rq->query, sizeof(rq->instance));
     replace_special(rq->instance, sizeof(rq->instance));
 
-    for (i = 0; i < ci->children_num; i++) {
+    for (int i = 0; i < ci->children_num; i++) {
         oconfig_item_t *option = ci->children + i;
 
         if (strcasecmp("Type", option->key) == 0) {
             status = cf_util_get_string_buffer(option, rq->type, sizeof(rq->type));
         } else if (strcasecmp("Instance", option->key) == 0) {
             status = cf_util_get_string_buffer(option, rq->instance, sizeof(rq->instance));
@@ -163,29 +161,28 @@
     free(rq);
     return NULL;
 } /* }}} */
 
 static int redis_config_node (oconfig_item_t *ci) /* {{{ */
 {
-  redis_node_t rn;
   redis_query_t *rq;
-  int i;
   int status;
   int timeout;
 
-  memset (&rn, 0, sizeof (rn));
+  redis_node_t rn = {
+    .port = REDIS_DEF_PORT,
+    .timeout.tv_usec = REDIS_DEF_TIMEOUT
+  };
+
   sstrncpy (rn.host, REDIS_DEF_HOST, sizeof (rn.host));
-  rn.port = REDIS_DEF_PORT;
-  rn.timeout.tv_usec = REDIS_DEF_TIMEOUT;
-  rn.queries = NULL;
 
   status = cf_util_get_string_buffer (ci, rn.name, sizeof (rn.name));
   if (status != 0)
     return (status);
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Host", option->key) == 0)
       status = cf_util_get_string_buffer (option, rn.host, sizeof (rn.host));
     else if (strcasecmp ("Port", option->key) == 0)
@@ -227,15 +224,13 @@
 
   return (redis_node_add (&rn));
 } /* }}} int redis_config_node */
 
 static int redis_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Node", option->key) == 0)
       redis_config_node (option);
     else
@@ -301,13 +296,13 @@
   value_t val;
   if (str)
   {
     int i;
 
     str += strlen (field_name) + 1; /* also skip the ':' */
-    for(i=0;(*str && (isdigit(*str) || *str == '.'));i++,str++)
+    for(i=0;(*str && (isdigit((unsigned char)*str) || *str == '.'));i++,str++)
       buf[i] = *str;
     buf[i] ='\0';
 
     if(parse_value (buf, &val, ds_type) == -1)
     {
       WARNING ("redis plugin: Unable to parse field `%s'.", field_name);
@@ -377,16 +372,13 @@
     freeReplyObject (rr);
     return 0;
 } /* }}} int redis_handle_query */
 
 static int redis_read (void) /* {{{ */
 {
-  redis_node_t *rn;
-  redis_query_t *rq;
-
-  for (rn = nodes_head; rn != NULL; rn = rn->next)
+  for (redis_node_t *rn = nodes_head; rn != NULL; rn = rn->next)
   {
     redisContext *rh;
     redisReply   *rr;
 
     DEBUG ("redis plugin: querying info from node `%s' (%s:%d).", rn->name, rn->host, rn->port);
 
@@ -428,18 +420,24 @@
     redis_handle_info (rn->name, rr->str, "memory", NULL, "used_memory", DS_TYPE_GAUGE);
     redis_handle_info (rn->name, rr->str, "memory_lua", NULL, "used_memory_lua", DS_TYPE_GAUGE);
     /* changes_since_last_save: Deprecated in redis version 2.6 and above */
     redis_handle_info (rn->name, rr->str, "volatile_changes", NULL, "changes_since_last_save", DS_TYPE_GAUGE);
     redis_handle_info (rn->name, rr->str, "total_connections", NULL, "total_connections_received", DS_TYPE_DERIVE);
     redis_handle_info (rn->name, rr->str, "total_operations", NULL, "total_commands_processed", DS_TYPE_DERIVE);
+    redis_handle_info (rn->name, rr->str, "operations_per_second", NULL, "instantaneous_ops_per_sec", DS_TYPE_GAUGE);
     redis_handle_info (rn->name, rr->str, "expired_keys", NULL, "expired_keys", DS_TYPE_DERIVE);
+    redis_handle_info (rn->name, rr->str, "evicted_keys", NULL, "evicted_keys", DS_TYPE_DERIVE);
     redis_handle_info (rn->name, rr->str, "pubsub", "channels", "pubsub_channels", DS_TYPE_GAUGE);
     redis_handle_info (rn->name, rr->str, "pubsub", "patterns", "pubsub_patterns", DS_TYPE_GAUGE);
     redis_handle_info (rn->name, rr->str, "current_connections", "slaves", "connected_slaves", DS_TYPE_GAUGE);
+    redis_handle_info (rn->name, rr->str, "cache_result", "hits", "keyspace_hits", DS_TYPE_DERIVE);
+    redis_handle_info (rn->name, rr->str, "cache_result", "misses", "keyspace_misses", DS_TYPE_DERIVE);
+    redis_handle_info (rn->name, rr->str, "total_bytes", "input", "total_net_input_bytes", DS_TYPE_DERIVE);
+    redis_handle_info (rn->name, rr->str, "total_bytes", "output", "total_net_output_bytes", DS_TYPE_DERIVE);
 
-    for (rq = rn->queries; rq != NULL; rq = rq->next)
+    for (redis_query_t *rq = rn->queries; rq != NULL; rq = rq->next)
         redis_handle_query(rh, rn, rq);
 
 redis_fail:
     if (rr != NULL)
       freeReplyObject (rr);
     redisFree (rh);
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src: riemann.proto
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/routeros.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/routeros.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/routeros.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/routeros.c	2016-09-11 16:10:25.271038709 +0800
@@ -323,26 +324,24 @@
 static int cr_config_router (oconfig_item_t *ci) /* {{{ */
 {
   cr_data_t *router_data;
   char read_name[128];
   user_data_t user_data;
   int status;
-  int i;
 
-  router_data = malloc (sizeof (*router_data));
+  router_data = calloc (1, sizeof (*router_data));
   if (router_data == NULL)
     return (-1);
-  memset (router_data, 0, sizeof (*router_data));
   router_data->connection = NULL;
   router_data->node = NULL;
   router_data->service = NULL;
   router_data->username = NULL;
   router_data->password = NULL;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       status = cf_util_get_string (child, &router_data->node);
     else if (strcasecmp ("Port", child->key) == 0)
@@ -411,25 +410,23 @@
 
   ssnprintf (read_name, sizeof (read_name), "routeros/%s", router_data->node);
   user_data.data = router_data;
   user_data.free_func = (void *) cr_free_data;
   if (status == 0)
     status = plugin_register_complex_read (/* group = */ NULL, read_name,
-	cr_read, /* interval = */ NULL, &user_data);
+	cr_read, /* interval = */ 0, &user_data);
 
   if (status != 0)
     cr_free_data (router_data);
 
   return (status);
 } /* }}} int cr_config_router */
 
 static int cr_config (oconfig_item_t *ci)
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Router", child->key) == 0)
       cr_config_router (child);
     else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/rrdcached.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/rrdcached.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/rrdcached.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/rrdcached.c	2016-09-11 16:10:25.271038709 +0800
@@ -66,51 +67,50 @@
 
 static int value_list_to_string (char *buffer, int buffer_len,
     const data_set_t *ds, const value_list_t *vl)
 {
   int offset;
   int status;
-  int i;
   time_t t;
 
   assert (0 == strcmp (ds->type, vl->type));
 
   memset (buffer, '\0', buffer_len);
 
   t = CDTIME_T_TO_TIME_T (vl->time);
   status = ssnprintf (buffer, buffer_len, "%lu", (unsigned long) t);
   if ((status < 1) || (status >= buffer_len))
     return (-1);
   offset = status;
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     if ((ds->ds[i].type != DS_TYPE_COUNTER)
         && (ds->ds[i].type != DS_TYPE_GAUGE)
 	&& (ds->ds[i].type != DS_TYPE_DERIVE)
 	&& (ds->ds[i].type != DS_TYPE_ABSOLUTE))
       return (-1);
 
     if (ds->ds[i].type == DS_TYPE_COUNTER)
     {
       status = ssnprintf (buffer + offset, buffer_len - offset,
           ":%llu", vl->values[i].counter);
     }
-    else if (ds->ds[i].type == DS_TYPE_GAUGE) 
+    else if (ds->ds[i].type == DS_TYPE_GAUGE)
     {
       status = ssnprintf (buffer + offset, buffer_len - offset,
           ":%f", vl->values[i].gauge);
     }
     else if (ds->ds[i].type == DS_TYPE_DERIVE) {
       status = ssnprintf (buffer + offset, buffer_len - offset,
 	  ":%"PRIi64, vl->values[i].derive);
     }
     else /* if (ds->ds[i].type == DS_TYPE_ABSOLUTE) */ {
       status = ssnprintf (buffer + offset, buffer_len - offset,
 	  ":%"PRIu64, vl->values[i].absolute);
- 
+
     }
 
     if ((status < 1) || (status >= (buffer_len - offset)))
       return (-1);
 
     offset += status;
@@ -214,15 +214,13 @@
 
   return (0);
 } /* int rc_config_add_timespan */
 
 static int rc_config (oconfig_item_t *ci)
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t const *child = ci->children + i;
     const char *key = child->key;
     int status = 0;
 
     if (strcasecmp ("DataDir", key) == 0)
@@ -286,38 +284,16 @@
     plugin_register_write ("rrdcached", rc_write, /* user_data = */ NULL);
     plugin_register_flush ("rrdcached", rc_flush, /* user_data = */ NULL);
   }
   return (0);
 } /* int rc_config */
 
-static int try_reconnect (void)
-{
-  int status;
-
-  rrdc_disconnect ();
-
-  rrd_clear_error ();
-  status = rrdc_connect (daemon_address);
-  if (status != 0)
-  {
-    ERROR ("rrdcached plugin: Failed to reconnect to RRDCacheD "
-        "at %s: %s (status=%d)", daemon_address, rrd_get_error (), status);
-    return (-1);
-  }
-
-  INFO ("rrdcached plugin: Successfully reconnected to RRDCacheD "
-      "at %s", daemon_address);
-  return (0);
-} /* int try_reconnect */
-
 static int rc_read (void)
 {
   int status;
   rrdc_stats_t *head;
-  rrdc_stats_t *ptr;
-  _Bool retried = 0;
 
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
 
   if (daemon_address == NULL)
     return (-1);
@@ -332,45 +308,29 @@
       || (daemon_address[0] == '/'))
     sstrncpy (vl.host, hostname_g, sizeof (vl.host));
   else
     sstrncpy (vl.host, daemon_address, sizeof (vl.host));
   sstrncpy (vl.plugin, "rrdcached", sizeof (vl.plugin));
 
-  rrd_clear_error ();
   status = rrdc_connect (daemon_address);
   if (status != 0)
   {
-    ERROR ("rrdcached plugin: Failed to connect to RRDCacheD "
-        "at %s: %s (status=%d)", daemon_address, rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_connect (%s) failed with status %i.",
+        daemon_address, status);
     return (-1);
   }
 
-  while (42)
+  head = NULL;
+  status = rrdc_stats_get (&head);
+  if (status != 0)
   {
-    /* The RRD client lib does not provide any means for checking a
-     * connection, hence we'll have to retry upon failed operations. */
-    head = NULL;
-    rrd_clear_error ();
-    status = rrdc_stats_get (&head);
-    if (status == 0)
-      break;
-
-    if (! retried)
-    {
-      retried = 1;
-      if (try_reconnect () == 0)
-        continue;
-      /* else: report the error and fail */
-    }
-
-    ERROR ("rrdcached plugin: rrdc_stats_get failed: %s (status=%i).",
-        rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_stats_get failed with status %i.", status);
     return (-1);
   }
 
-  for (ptr = head; ptr != NULL; ptr = ptr->next)
+  for (rrdc_stats_t *ptr = head; ptr != NULL; ptr = ptr->next)
   {
     if (ptr->type == RRDC_STATS_TYPE_GAUGE)
       values[0].gauge = (gauge_t) ptr->value.gauge;
     else if (ptr->type == RRDC_STATS_TYPE_COUNTER)
       values[0].counter = (counter_t) ptr->value.counter;
     else
@@ -448,13 +408,12 @@
     user_data_t __attribute__((unused)) *user_data)
 {
   char filename[PATH_MAX];
   char values[512];
   char *values_array[2];
   int status;
-  _Bool retried = 0;
 
   if (daemon_address == NULL)
   {
     ERROR ("rrdcached plugin: daemon_address == NULL.");
     plugin_unregister_write ("rrdcached");
     return (-1);
@@ -505,90 +464,60 @@
       }
       else if (rrdcreate_config.async)
         return (0);
     }
   }
 
-  rrd_clear_error ();
   status = rrdc_connect (daemon_address);
   if (status != 0)
   {
-    ERROR ("rrdcached plugin: Failed to connect to RRDCacheD "
-        "at %s: %s (status=%d)", daemon_address, rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_connect (%s) failed with status %i.",
+        daemon_address, status);
     return (-1);
   }
 
-  while (42)
+  status = rrdc_update (filename, /* values_num = */ 1, (void *) values_array);
+  if (status != 0)
   {
-    /* The RRD client lib does not provide any means for checking a
-     * connection, hence we'll have to retry upon failed operations. */
-    rrd_clear_error ();
-    status = rrdc_update (filename, /* values_num = */ 1, (void *) values_array);
-    if (status == 0)
-      break;
-
-    if (! retried)
-    {
-      retried = 1;
-      if (try_reconnect () == 0)
-        continue;
-      /* else: report the error and fail */
-    }
-
-    ERROR ("rrdcached plugin: rrdc_update (%s, [%s], 1) failed: %s (status=%i)",
-        filename, values_array[0], rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_update (%s, [%s], 1) failed with "
+        "status %i.",
+        filename, values_array[0], status);
     return (-1);
   }
 
   return (0);
 } /* int rc_write */
 
 static int rc_flush (__attribute__((unused)) cdtime_t timeout, /* {{{ */
     const char *identifier,
     __attribute__((unused)) user_data_t *ud)
 {
   char filename[PATH_MAX + 1];
   int status;
-  _Bool retried = 0;
 
   if (identifier == NULL)
     return (EINVAL);
 
   if (datadir != NULL)
     ssnprintf (filename, sizeof (filename), "%s/%s.rrd", datadir, identifier);
   else
     ssnprintf (filename, sizeof (filename), "%s.rrd", identifier);
 
-  rrd_clear_error ();
   status = rrdc_connect (daemon_address);
   if (status != 0)
   {
-    ERROR ("rrdcached plugin: Failed to connect to RRDCacheD "
-        "at %s: %s (status=%d)", daemon_address, rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_connect (%s) failed with status %i.",
+        daemon_address, status);
     return (-1);
   }
 
-  while (42)
+  status = rrdc_flush (filename);
+  if (status != 0)
   {
-    /* The RRD client lib does not provide any means for checking a
-     * connection, hence we'll have to retry upon failed operations. */
-    rrd_clear_error ();
-    status = rrdc_flush (filename);
-    if (status == 0)
-      break;
-
-    if (! retried)
-    {
-      retried = 1;
-      if (try_reconnect () == 0)
-        continue;
-      /* else: report the error and fail */
-    }
-
-    ERROR ("rrdcached plugin: rrdc_flush (%s) failed: %s (status=%i).",
-        filename, rrd_get_error (), status);
+    ERROR ("rrdcached plugin: rrdc_flush (%s) failed with status %i.",
+        filename, status);
     return (-1);
   }
   DEBUG ("rrdcached plugin: rrdc_flush (%s): Success.", filename);
 
   return (0);
 } /* }}} int rc_flush */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/rrdtool.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/rrdtool.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/rrdtool.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/rrdtool.c	2016-09-11 16:10:25.271038709 +0800
@@ -29,16 +30,12 @@
 #include "utils_avltree.h"
 #include "utils_random.h"
 #include "utils_rrdcreate.h"
 
 #include <rrd.h>
 
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
-
 /*
  * Private types
  */
 struct rrd_cache_s
 {
 	int      values_num;
@@ -163,13 +160,13 @@
 	int new_argc;
 	char **new_argv;
 
 	assert (template == NULL);
 
 	new_argc = 2 + argc;
-	new_argv = (char **) malloc ((new_argc + 1) * sizeof (char *));
+	new_argv = malloc ((new_argc + 1) * sizeof (*new_argv));
 	if (new_argv == NULL)
 	{
 		ERROR ("rrdtool plugin: malloc failed.");
 		return (-1);
 	}
 
@@ -201,23 +198,22 @@
 static int value_list_to_string_multiple (char *buffer, int buffer_len,
 		const data_set_t *ds, const value_list_t *vl)
 {
 	int offset;
 	int status;
 	time_t tt;
-	int i;
 
 	memset (buffer, '\0', buffer_len);
 
 	tt = CDTIME_T_TO_TIME_T (vl->time);
 	status = ssnprintf (buffer, buffer_len, "%u", (unsigned int) tt);
 	if ((status < 1) || (status >= buffer_len))
 		return (-1);
 	offset = status;
 
-	for (i = 0; i < ds->ds_num; i++)
+	for (size_t i = 0; i < ds->ds_num; i++)
 	{
 		if ((ds->ds[i].type != DS_TYPE_COUNTER)
 				&& (ds->ds[i].type != DS_TYPE_GAUGE)
 				&& (ds->ds[i].type != DS_TYPE_DERIVE)
 				&& (ds->ds[i].type != DS_TYPE_ABSOLUTE))
 			return (-1);
@@ -332,13 +328,12 @@
 	{
 		rrd_queue_t *queue_entry;
 		rrd_cache_t *cache_entry;
 		char **values;
 		int    values_num;
 		int    status;
-		int    i;
 
 		values = NULL;
 		values_num = 0;
 
                 pthread_mutex_lock (&queue_lock);
                 /* Wait for values to arrive */
@@ -413,13 +408,13 @@
                 }
 
 		/* Unlock the queue again */
 		pthread_mutex_unlock (&queue_lock);
 
 		/* We now need the cache lock so the entry isn't updated while
-		 * we make a copy of it's values */
+		 * we make a copy of its values */
 		pthread_mutex_lock (&cache_lock);
 
 		status = c_avl_get (cache, queue_entry->filename,
 				(void *) &cache_entry);
 
 		if (status == 0)
@@ -439,13 +434,13 @@
 			sfree (queue_entry->filename);
 			sfree (queue_entry);
 			continue;
 		}
 
 		/* Update `tv_next_update' */
-		if (write_rate > 0.0) 
+		if (write_rate > 0.0)
                 {
                   gettimeofday (&tv_now, /* timezone = */ NULL);
                   tv_next_update.tv_sec = tv_now.tv_sec;
                   tv_next_update.tv_usec = tv_now.tv_usec
                     + ((suseconds_t) (1000000 * write_rate));
                   while (tv_next_update.tv_usec > 1000000)
@@ -459,13 +454,13 @@
 		srrd_update (queue_entry->filename, NULL,
 				values_num, (const char **)values);
 		DEBUG ("rrdtool plugin: queue thread: Wrote %i value%s to %s",
 				values_num, (values_num == 1) ? "" : "s",
 				queue_entry->filename);
 
-		for (i = 0; i < values_num; i++)
+		for (int i = 0; i < values_num; i++)
 		{
 			sfree (values[i]);
 		}
 		sfree (values);
 		sfree (queue_entry->filename);
 		sfree (queue_entry);
@@ -477,13 +472,13 @@
 
 static int rrd_queue_enqueue (const char *filename,
     rrd_queue_t **head, rrd_queue_t **tail)
 {
   rrd_queue_t *queue_entry;
 
-  queue_entry = (rrd_queue_t *) malloc (sizeof (rrd_queue_t));
+  queue_entry = malloc (sizeof (*queue_entry));
   if (queue_entry == NULL)
     return (-1);
 
   queue_entry->filename = strdup (filename);
   if (queue_entry->filename == NULL)
   {
@@ -519,13 +514,13 @@
   this = *head;
 
   while (this != NULL)
   {
     if (strcmp (this->filename, filename) == 0)
       break;
-    
+
     prev = this;
     this = this->next;
   }
 
   if (this == NULL)
   {
@@ -557,13 +552,12 @@
 
 	char **keys = NULL;
 	int    keys_num = 0;
 
 	char *key;
 	c_avl_iterator_t *iter;
-	int i;
 
 	DEBUG ("rrdtool plugin: Flushing cache, timeout = %.3f",
 			CDTIME_T_TO_DOUBLE (timeout));
 
 	now = cdtime ();
 	timeout = TIME_T_TO_CDTIME_T (timeout);
@@ -585,13 +579,13 @@
 			status = rrd_queue_enqueue (key, &queue_head,  &queue_tail);
 			if (status == 0)
 				rc->flags = FLAG_QUEUED;
 		}
 		else /* ancient and no values -> waste of memory */
 		{
-			char **tmp = (char **) realloc ((void *) keys,
+			char **tmp = realloc (keys,
 					(keys_num + 1) * sizeof (char *));
 			if (tmp == NULL)
 			{
 				char errbuf[1024];
 				ERROR ("rrdtool plugin: "
 						"realloc failed: %s",
@@ -604,14 +598,14 @@
 			keys = tmp;
 			keys[keys_num] = key;
 			keys_num++;
 		}
 	} /* while (c_avl_iterator_next) */
 	c_avl_iterator_destroy (iter);
-	
-	for (i = 0; i < keys_num; i++)
+
+	for (int i = 0; i < keys_num; i++)
 	{
 		if (c_avl_remove (cache, keys[i], (void *) &key, (void *) &rc) != 0)
 		{
 			DEBUG ("rrdtool plugin: c_avl_remove (%s) failed.", keys[i]);
 			continue;
 		}
@@ -689,13 +683,13 @@
 
 static int64_t rrd_get_random_variation (void)
 {
   long min;
   long max;
 
-  if (random_timeout <= 0)
+  if (random_timeout == 0)
     return (0);
 
   /* Assure that "cache_timeout + random_variation" is never negative. */
   if (random_timeout > cache_timeout)
   {
 	  INFO ("rrdtool plugin: Adjusting \"RandomTimeout\" to %.3f seconds.",
@@ -753,13 +747,13 @@
 		DEBUG ("rrdtool plugin: (rc->last_value = %"PRIu64") "
 				">= (value_time = %"PRIu64")",
 				rc->last_value, value_time);
 		return (-1);
 	}
 
-	values_new = (char **) realloc ((void *) rc->values,
+	values_new = realloc ((void *) rc->values,
 			(rc->values_num + 1) * sizeof (char *));
 	if (values_new == NULL)
 	{
 		char errbuf[1024];
 		void *cache_key = NULL;
 
@@ -857,24 +851,23 @@
     return (0);
   }
 
   while (c_avl_pick (cache, &key, &value) == 0)
   {
     rrd_cache_t *rc;
-    int i;
 
     sfree (key);
     key = NULL;
 
     rc = value;
     value = NULL;
 
     if (rc->values_num > 0)
       non_empty++;
 
-    for (i = 0; i < rc->values_num; i++)
+    for (int i = 0; i < rc->values_num; i++)
       sfree (rc->values[i]);
     sfree (rc->values);
     sfree (rc);
   }
 
   c_avl_destroy (cache);
@@ -1084,13 +1077,13 @@
 			return (1);
 
 		dummy = value_copy;
 		while ((ptr = strtok_r (dummy, ", \t", &saveptr)) != NULL)
 		{
 			dummy = NULL;
-			
+
 			tmp_alloc = realloc (rrdcreate_config.timespans,
 					sizeof (int) * (rrdcreate_config.timespans_num + 1));
 			if (tmp_alloc == NULL)
 			{
 				fprintf (stderr, "rrdtool: realloc failed.\n");
 				ERROR ("rrdtool: realloc failed.\n");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/sensors.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/sensors.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/sensors.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/sensors.c	2016-09-11 16:10:25.271038709 +0800
@@ -15,13 +15,13 @@
  * You should have received a copy of the GNU General Public License along
  * with this program; if not, write to the Free Software Foundation, Inc.,
  * 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
- *   
+ *
  *   Lubos Stanek <lubek at users.sourceforge.net> Wed Oct 27, 2006
  *   - config ExtendedSensorNaming option
  *   - precise sensor feature selection (chip-bus-address/type-feature)
  *     with ExtendedSensorNaming
  *   - more sensor features (finite list)
  *   - honor sensors.conf's ignored
@@ -31,15 +31,15 @@
  *   Henrique de Moraes Holschuh <hmh at debian.org>
  *   - use default libsensors config file on API 0x400
  *   - config SensorConfigFile option
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 
 #if defined(HAVE_SENSORS_SENSORS_H)
 # include <sensors/sensors.h>
 #endif
 
@@ -73,13 +73,13 @@
 	char *label;
 	int type;
 };
 typedef struct sensors_labeltypes_s sensors_labeltypes_t;
 
 /* finite list of known labels extracted from lm_sensors */
-static sensors_labeltypes_t known_features[] = 
+static sensors_labeltypes_t known_features[] =
 {
 	{ "fan1", SENSOR_TYPE_FANSPEED },
 	{ "fan2", SENSOR_TYPE_FANSPEED },
 	{ "fan3", SENSOR_TYPE_FANSPEED },
 	{ "fan4", SENSOR_TYPE_FANSPEED },
 	{ "fan5", SENSOR_TYPE_FANSPEED },
@@ -137,13 +137,14 @@
 #endif /* SENSORS_API_VERSION < 0x400 */
 
 static const char *config_keys[] =
 {
 	"Sensor",
 	"IgnoreSelected",
-	"SensorConfigFile"
+	"SensorConfigFile",
+	"UseLabels"
 };
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 #if SENSORS_API_VERSION < 0x400
 typedef struct featurelist
 {
@@ -166,20 +167,21 @@
 	const sensors_feature      *feature;
 	const sensors_subfeature   *subfeature;
 	struct featurelist         *next;
 } featurelist_t;
 
 static char *conffile = NULL;
+static _Bool use_labels = 0;
 /* #endif (SENSORS_API_VERSION >= 0x400) && (SENSORS_API_VERSION < 0x500) */
 
 #else /* if SENSORS_API_VERSION >= 0x500 */
 # error "This version of libsensors is not supported yet. Please report this " \
 	"as bug."
 #endif
 
-featurelist_t *first_feature = NULL;
+static featurelist_t *first_feature = NULL;
 static ignorelist_t *sensor_list;
 
 #if SENSORS_API_VERSION < 0x400
 /* full chip name logic borrowed from lm_sensors */
 static int sensors_snprintf_chip_name (char *buf, size_t buf_size,
 		const sensors_chip_name *chip)
@@ -210,17 +212,15 @@
 
 	return (status);
 } /* int sensors_snprintf_chip_name */
 
 static int sensors_feature_name_to_type (const char *name)
 {
-	int i;
-
 	/* Yes, this is slow, but it's only ever done during initialization, so
 	 * it's a one time cost.. */
-	for (i = 0; i < known_features_num; i++)
+	for (int i = 0; i < known_features_num; i++)
 		if (strcasecmp (known_features[i].label, name) == 0)
 			return (known_features[i].type);
 
 	return (SENSOR_TYPE_UNKNOWN);
 } /* int sensors_feature_name_to_type */
 #endif
@@ -254,31 +254,36 @@
 	else if (strcasecmp (key, "IgnoreSelected") == 0)
 	{
 		ignorelist_set_invert (sensor_list, 1);
 		if (IS_TRUE (value))
 			ignorelist_set_invert (sensor_list, 0);
 	}
+#if (SENSORS_API_VERSION >= 0x400) && (SENSORS_API_VERSION < 0x500)
+	else if (strcasecmp (key, "UseLabels") == 0)
+	{
+		use_labels = IS_TRUE (value) ? 1 : 0;
+	}
+#endif
 	else
 	{
 		return (-1);
 	}
 
 	return (0);
 }
 
 static void sensors_free_features (void)
 {
-	featurelist_t *thisft;
 	featurelist_t *nextft;
 
 	if (first_feature == NULL)
 		return;
 
 	sensors_cleanup ();
 
-	for (thisft = first_feature; thisft != NULL; thisft = nextft)
+	for (featurelist_t *thisft = first_feature; thisft != NULL; thisft = nextft)
 	{
 		nextft = thisft->next;
 		sfree (thisft);
 	}
 	first_feature = NULL;
 }
@@ -286,13 +291,13 @@
 static int sensors_load_conf (void)
 {
 	static int call_once = 0;
 
 	FILE *fh = NULL;
 	featurelist_t *last_feature = NULL;
-	
+
 	const sensors_chip_name *chip;
 	int chip_num;
 
 	int status;
 
 	if (call_once)
@@ -375,19 +380,18 @@
 						"because its type is "
 						"unknown.",
 						feature->name);
 				continue;
 			}
 
-			fl = (featurelist_t *) malloc (sizeof (featurelist_t));
+			fl = calloc (1, sizeof (*fl));
 			if (fl == NULL)
 			{
-				ERROR ("sensors plugin: malloc failed.");
+				ERROR ("sensors plugin: calloc failed.");
 				continue;
 			}
-			memset (fl, '\0', sizeof (featurelist_t));
 
 			fl->chip = chip;
 			fl->data = feature;
 			fl->type = feature_type;
 
 			if (first_feature == NULL)
@@ -432,19 +436,18 @@
 				if ((subfeature->type != SENSORS_SUBFEATURE_IN_INPUT)
 						&& (subfeature->type != SENSORS_SUBFEATURE_FAN_INPUT)
 						&& (subfeature->type != SENSORS_SUBFEATURE_TEMP_INPUT)
 						&& (subfeature->type != SENSORS_SUBFEATURE_POWER_INPUT))
 					continue;
 
-				fl = (featurelist_t *) malloc (sizeof (featurelist_t));
+				fl = calloc (1, sizeof (*fl));
 				if (fl == NULL)
 				{
-					ERROR ("sensors plugin: malloc failed.");
+					ERROR ("sensors plugin: calloc failed.");
 					continue;
 				}
-				memset (fl, '\0', sizeof (featurelist_t));
 
 				fl->chip = chip;
 				fl->feature = feature;
 				fl->subfeature = subfeature;
 
 				if (first_feature == NULL)
@@ -512,19 +515,17 @@
 
 	plugin_dispatch_values (&vl);
 } /* void sensors_submit */
 
 static int sensors_read (void)
 {
-	featurelist_t *fl;
-
 	if (sensors_load_conf () != 0)
 		return (-1);
 
 #if SENSORS_API_VERSION < 0x400
-	for (fl = first_feature; fl != NULL; fl = fl->next)
+	for (featurelist_t *fl = first_feature; fl != NULL; fl = fl->next)
 	{
 		double value;
 		int status;
 		char plugin_instance[DATA_MAX_NAME_LEN];
 		char type_instance[DATA_MAX_NAME_LEN];
 
@@ -546,32 +547,42 @@
 				type_instance,
 				value);
 	} /* for fl = first_feature .. NULL */
 /* #endif SENSORS_API_VERSION < 0x400 */
 
 #elif (SENSORS_API_VERSION >= 0x400) && (SENSORS_API_VERSION < 0x500)
-	for (fl = first_feature; fl != NULL; fl = fl->next)
+	for (featurelist_t *fl = first_feature; fl != NULL; fl = fl->next)
 	{
 		double value;
 		int status;
 		char plugin_instance[DATA_MAX_NAME_LEN];
 		char type_instance[DATA_MAX_NAME_LEN];
+		char *sensor_label;
 		const char *type;
 
 		status = sensors_get_value (fl->chip,
 				fl->subfeature->number, &value);
 		if (status < 0)
 			continue;
 
 		status = sensors_snprintf_chip_name (plugin_instance,
 				sizeof (plugin_instance), fl->chip);
 		if (status < 0)
 			continue;
 
-		sstrncpy (type_instance, fl->feature->name,
-				sizeof (type_instance));
+		if (use_labels)
+		{
+			sensor_label = sensors_get_label (fl->chip, fl->feature);
+			sstrncpy (type_instance, sensor_label, sizeof (type_instance));
+			free (sensor_label);
+		}
+		else
+		{
+			sstrncpy (type_instance, fl->feature->name,
+					sizeof (type_instance));
+		}
 
 		if (fl->feature->type == SENSORS_FEATURE_IN)
 			type = "voltage";
 		else if (fl->feature->type
 				== SENSORS_FEATURE_FAN)
 			type = "fanspeed";
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/serial.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/serial.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/serial.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/serial.c	2016-09-11 16:10:25.271038709 +0800
@@ -51,71 +52,67 @@
 
 static int serial_read (void)
 {
 	FILE *fh;
 	char buffer[1024];
 
-	derive_t rx = 0;
-	derive_t tx = 0;
-	
-	char *fields[16];
-	int i, numfields;
-	int len;
-
 	/* there are a variety of names for the serial device */
 	if ((fh = fopen ("/proc/tty/driver/serial", "r")) == NULL &&
 		(fh = fopen ("/proc/tty/driver/ttyS", "r")) == NULL)
 	{
 		char errbuf[1024];
 		WARNING ("serial: fopen: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	while (fgets (buffer, sizeof (buffer), fh) != NULL)
 	{
-		int have_rx = 0, have_tx = 0;
+		derive_t rx = 0;
+		derive_t tx = 0;
+		_Bool have_rx = 0, have_tx = 0;
+		size_t len;
 
-		numfields = strsplit (buffer, fields, 16);
+		char *fields[16];
+		int numfields;
 
+		numfields = strsplit (buffer, fields, STATIC_ARRAY_SIZE (fields));
 		if (numfields < 6)
 			continue;
 
 		/*
 		 * 0: uart:16550A port:000003F8 irq:4 tx:0 rx:0
 		 * 1: uart:16550A port:000002F8 irq:3 tx:0 rx:0
 		 */
-		len = strlen (fields[0]) - 1;
-		if (len < 1)
+		len = strlen (fields[0]);
+		if (len < 2)
 			continue;
-		if (fields[0][len] != ':')
+		if (fields[0][len - 1] != ':')
 			continue;
-		fields[0][len] = '\0';
+		fields[0][len - 1] = 0;
 
-		for (i = 1; i < numfields; i++)
+		for (int i = 1; i < numfields; i++)
 		{
 			len = strlen (fields[i]);
 			if (len < 4)
 				continue;
 
 			if (strncmp (fields[i], "tx:", 3) == 0)
 			{
-				tx = atoll (fields[i] + 3);
-				have_tx++;
+				if (strtoderive (fields[i] + 3, &tx) == 0)
+					have_tx = 1;
 			}
 			else if (strncmp (fields[i], "rx:", 3) == 0)
 			{
-				rx = atoll (fields[i] + 3);
-				have_rx++;
+				if (strtoderive (fields[i] + 3, &rx) == 0)
+					have_rx = 1;
 			}
 		}
 
-		if ((have_rx == 0) || (have_tx == 0))
-			continue;
-
-		serial_submit (fields[0], rx, tx);
+		if (have_rx && have_tx)
+			serial_submit (fields[0], rx, tx);
 	}
 
 	fclose (fh);
 	return (0);
 } /* int serial_read */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/sigrok.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/sigrok.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/sigrok.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/sigrok.c	2016-09-11 16:10:25.271038709 +0800
@@ -24,13 +25,12 @@
 #include "plugin.h"
 
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <time.h>
-#include <pthread.h>
 
 #include <glib.h>
 #include <libsigrok/libsigrok.h>
 
 /* Minimum interval between dispatches coming from this plugin. The RRD
  * plugin, at least, complains when written to with sub-second intervals.*/
@@ -67,27 +67,25 @@
 	return 0;
 }
 
 static int sigrok_config_device(oconfig_item_t *ci)
 {
 	struct config_device *cfdev;
-	int i;
 
-	if (!(cfdev = malloc(sizeof(struct config_device)))) {
-		ERROR("sigrok plugin: malloc() failed.");
+	if (!(cfdev = calloc(1, sizeof(*cfdev)))) {
+		ERROR("sigrok plugin: calloc failed.");
 		return -1;
 	}
-	memset(cfdev, 0, sizeof(*cfdev));
 	if (cf_util_get_string(ci, &cfdev->name)) {
 		free(cfdev);
 		WARNING("sigrok plugin: Invalid device name.");
 		return -1;
 	}
 	cfdev->min_dispatch_interval = DEFAULT_MIN_DISPATCH_INTERVAL;
 
-	for (i = 0; i < ci->children_num; i++) {
+	for (int i = 0; i < ci->children_num; i++) {
 		oconfig_item_t *item = ci->children + i;
 		if (!strcasecmp(item->key, "driver"))
 			cf_util_get_string(item, &cfdev->driver);
 		else if (!strcasecmp(item->key, "conn"))
 			cf_util_get_string(item, &cfdev->conn);
 		else if (!strcasecmp(item->key, "serialcomm"))
@@ -103,15 +101,13 @@
 
 	return 0;
 }
 
 static int sigrok_config(oconfig_item_t *ci)
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++) {
+	for (int i = 0; i < ci->children_num; i++) {
 		oconfig_item_t *item = ci->children + i;
 		if (strcasecmp("LogLevel", item->key) == 0) {
 			int status;
 			int tmp = -1;
 
 			status = cf_util_get_int (item, &tmp);
@@ -133,15 +129,15 @@
 					item->key);
 	}
 
 	return 0;
 }
 
-static char *sigrok_value_type(const struct sr_datafeed_analog *analog)
+static const char *sigrok_value_type(const struct sr_datafeed_analog *analog)
 {
-	char *s;
+	const char *s;
 
 	if (analog->mq == SR_MQ_VOLTAGE)
 		s = "voltage";
 	else if (analog->mq == SR_MQ_CURRENT)
 		s = "current";
 	else if (analog->mq == SR_MQ_FREQUENCY)
@@ -162,19 +158,18 @@
 
 static void sigrok_feed_callback(const struct sr_dev_inst *sdi,
 		const struct sr_datafeed_packet *packet, void *cb_data)
 {
 	const struct sr_datafeed_analog *analog;
 	struct config_device *cfdev;
-	GSList *l;
 	value_t value;
 	value_list_t vl = VALUE_LIST_INIT;
 
 	/* Find this device's configuration. */
 	cfdev = NULL;
-	for (l = config_devices; l; l = l->next) {
+	for (GSList *l = config_devices; l; l = l->next) {
 		cfdev = l->data;
 		if (cfdev->sdi == sdi) {
 			/* Found it. */
 			break;
 		}
 		cfdev = NULL;
@@ -233,20 +228,20 @@
 	if (sr_driver_init(sr_ctx, drv) != SR_OK)
 		/* Error was logged by libsigrok. */
 		return -1;
 
 	drvopts = NULL;
 	if (cfdev->conn) {
-		if (!(src = malloc(sizeof(struct sr_config))))
+		if (!(src = malloc(sizeof(*src))))
 			return -1;
 		src->key = SR_CONF_CONN;
 		src->data = g_variant_new_string(cfdev->conn);
 		drvopts = g_slist_append(drvopts, src);
 	}
 	if (cfdev->serialcomm) {
-		if (!(src = malloc(sizeof(struct sr_config))))
+		if (!(src = malloc(sizeof(*src))))
 			return -1;
 		src->key = SR_CONF_SERIALCOMM;
 		src->data = g_variant_new_string(cfdev->serialcomm);
 		drvopts = g_slist_append(drvopts, src);
 	}
 	devlist = sr_driver_scan(drv, drvopts);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/smart.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/smart.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/smart.c	2016-11-29 00:08:22.419470592 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/smart.c	2016-09-11 16:10:25.271038709 +0800
@@ -32,18 +33,22 @@
 #include <atasmart.h>
 #include <libudev.h>
 
 static const char *config_keys[] =
 {
   "Disk",
-  "IgnoreSelected"
+  "IgnoreSelected",
+  "IgnoreSleepMode",
+  "UseSerial"
 };
 
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static ignorelist_t *ignorelist = NULL;
+static int ignore_sleep_mode = 0;
+static int use_serial = 0;
 
 static int smart_config (const char *key, const char *value)
 {
   if (ignorelist == NULL)
     ignorelist = ignorelist_create (/* invert = */ 1);
   if (ignorelist == NULL)
@@ -57,21 +62,32 @@
   {
     int invert = 1;
     if (IS_TRUE (value))
       invert = 0;
     ignorelist_set_invert (ignorelist, invert);
   }
+  else if (strcasecmp ("IgnoreSleepMode", key) == 0)
+  {
+    if (IS_TRUE (value))
+      ignore_sleep_mode = 1;
+  }
+  else if (strcasecmp ("UseSerial", key) == 0)
+  {
+    if (IS_TRUE (value))
+      use_serial = 1;
+  }
   else
   {
     return (-1);
   }
 
   return (0);
 } /* int smart_config */
 
-static void smart_submit (const char *dev, char *type, char *type_inst, double value)
+static void smart_submit (const char *dev, const char *type,
+		const char *type_inst, double value)
 {
 	value_t values[1];
 	value_list_t vl = VALUE_LIST_INIT;
 
 	values[0].gauge = value;
 
@@ -126,24 +142,31 @@
                "attribute %s is below allowed threshold (%d < %d)",
                a->name, a->current_value, a->threshold);
     plugin_dispatch_notification (&notif);
   }
 }
 
-static void smart_handle_disk (const char *dev)
+static void smart_handle_disk (const char *dev, const char *serial)
 {
   SkDisk *d = NULL;
   SkBool awake = FALSE;
   SkBool available = FALSE;
   const char *shortname;
   const SkSmartParsedData *spd;
   uint64_t poweron, powercycles, badsectors, temperature;
 
-  shortname = strrchr(dev, '/');
-  if (!shortname) return;
-  shortname++;
+  if (use_serial && serial)
+  {
+    shortname = serial;
+  }
+  else
+  {
+    shortname = strrchr(dev, '/');
+    if (!shortname) return;
+    shortname++;
+  }
   if (ignorelist_match (ignorelist, shortname) != 0) {
     DEBUG ("smart plugin: ignoring %s.", dev);
     return;
   }
 
   DEBUG ("smart plugin: checking SMART status of %s.",
@@ -161,16 +184,19 @@
   }
   if (sk_disk_smart_is_available (d, &available) < 0 || !available)
   {
     DEBUG ("smart plugin: disk %s has no SMART support.", dev);
     goto end;
   }
-  if (sk_disk_check_sleep_mode (d, &awake) < 0 || !awake)
+  if (!ignore_sleep_mode)
   {
-    DEBUG ("smart plugin: disk %s is sleeping.", dev);
-    goto end;
+    if (sk_disk_check_sleep_mode (d, &awake) < 0 || !awake)
+    {
+      DEBUG ("smart plugin: disk %s is sleeping.", dev);
+      goto end;
+    }
   }
   if (sk_disk_smart_read_data (d) < 0)
   {
     ERROR ("smart plugin: unable to get SMART data for disk %s.", dev);
     goto end;
   }
@@ -243,19 +269,20 @@
   udev_enumerate_add_match_subsystem (enumerate, "block");
   udev_enumerate_add_match_property (enumerate, "DEVTYPE", "disk");
   udev_enumerate_scan_devices (enumerate);
   devices = udev_enumerate_get_list_entry (enumerate);
   udev_list_entry_foreach (dev_list_entry, devices)
   {
-    const char *path, *devpath;
+    const char *path, *devpath, *serial;
     path = udev_list_entry_get_name (dev_list_entry);
     dev = udev_device_new_from_syspath (handle_udev, path);
     devpath = udev_device_get_devnode (dev);
+    serial = udev_device_get_property_value (dev, "ID_SERIAL");
 
     /* Query status with libatasmart */
-    smart_handle_disk (devpath);
+    smart_handle_disk (devpath, serial);
     udev_device_unref (dev);
   }
 
   udev_enumerate_unref (enumerate);
   udev_unref (handle_udev);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/snmp.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/snmp.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/snmp.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/snmp.c	2016-09-11 16:10:25.271038709 +0800
@@ -22,18 +22,17 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 #include "utils_complain.h"
 
-#include <pthread.h>
-
 #include <net-snmp/net-snmp-config.h>
 #include <net-snmp/net-snmp-includes.h>
 
 #include <fnmatch.h>
 
 /*
@@ -58,13 +57,13 @@
   char *name; /* used to reference this from the `Collect' option */
   char *type; /* used to find the data_set */
   _Bool is_table;
   instance_t instance;
   char *instance_prefix;
   oid_t *values;
-  int values_len;
+  size_t values_len;
   double scale;
   double shift;
   struct data_definition_s *next;
   char **ignores;
   size_t ignores_len;
   int invert_match;
@@ -163,15 +162,14 @@
 
 static int csnmp_oid_to_string (char *buffer, size_t buffer_size,
     oid_t const *o)
 {
   char oid_str[MAX_OID_LEN][16];
   char *oid_str_ptr[MAX_OID_LEN];
-  size_t i;
 
-  for (i = 0; i < o->oid_len; i++)
+  for (size_t i = 0; i < o->oid_len; i++)
   {
     ssnprintf (oid_str[i], sizeof (oid_str[i]), "%lu", (unsigned long) o->oid[i]);
     oid_str_ptr[i] = oid_str[i];
   }
 
   return (strjoin (buffer, buffer_size,
@@ -290,35 +288,33 @@
   status = cf_util_get_string(ci, &dd->instance_prefix);
   return status;
 } /* int csnmp_config_add_data_instance_prefix */
 
 static int csnmp_config_add_data_values (data_definition_t *dd, oconfig_item_t *ci)
 {
-  int i;
-
   if (ci->values_num < 1)
   {
     WARNING ("snmp plugin: `Values' needs at least one argument.");
     return (-1);
   }
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("snmp plugin: `Values' needs only string argument.");
       return (-1);
     }
 
   sfree (dd->values);
   dd->values_len = 0;
-  dd->values = (oid_t *) malloc (sizeof (oid_t) * ci->values_num);
+  dd->values = malloc (sizeof (*dd->values) * ci->values_num);
   if (dd->values == NULL)
     return (-1);
-  dd->values_len = ci->values_num;
+  dd->values_len = (size_t) ci->values_num;
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     dd->values[i].oid_len = MAX_OID_LEN;
 
     if (NULL == snmp_parse_oid (ci->values[i].value.string,
           dd->values[i].oid, &dd->values[i].oid_len))
     {
@@ -333,30 +329,28 @@
 
   return (0);
 } /* int csnmp_config_add_data_instance */
 
 static int csnmp_config_add_data_blacklist(data_definition_t *dd, oconfig_item_t *ci)
 {
-  int i;
-
   if (ci->values_num < 1)
     return (0);
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("snmp plugin: `Ignore' needs only string argument.");
       return (-1);
     }
   }
 
   dd->ignores_len = 0;
   dd->ignores = NULL;
 
-  for (i = 0; i < ci->values_num; ++i)
+  for (int i = 0; i < ci->values_num; ++i)
   {
     if (strarray_add(&(dd->ignores), &(dd->ignores_len), ci->values[i].value.string) != 0)
     {
       ERROR("snmp plugin: Can't allocate memory");
       strarray_free(dd->ignores, dd->ignores_len);
       return (ENOMEM);
@@ -379,30 +373,28 @@
 } /* int csnmp_config_add_data_blacklist_match_inverted */
 
 static int csnmp_config_add_data (oconfig_item_t *ci)
 {
   data_definition_t *dd;
   int status = 0;
-  int i;
 
-  dd = (data_definition_t *) malloc (sizeof (data_definition_t));
+  dd = calloc (1, sizeof (*dd));
   if (dd == NULL)
     return (-1);
-  memset (dd, '\0', sizeof (data_definition_t));
 
   status = cf_util_get_string(ci, &dd->name);
   if (status != 0)
   {
     free (dd);
     return (-1);
   }
 
   dd->scale = 1.0;
   dd->shift = 0.0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Type", option->key) == 0)
       status = cf_util_get_string(option, &dd->type);
     else if (strcasecmp ("Table", option->key) == 0)
@@ -456,13 +448,13 @@
     sfree (dd->values);
     sfree (dd->ignores);
     sfree (dd);
     return (-1);
   }
 
-  DEBUG ("snmp plugin: dd = { name = %s, type = %s, is_table = %s, values_len = %i }",
+  DEBUG ("snmp plugin: dd = { name = %s, type = %s, is_table = %s, values_len = %zu }",
       dd->name, dd->type, (dd->is_table != 0) ? "true" : "false", dd->values_len);
 
   if (data_head == NULL)
     data_head = dd;
   else
   {
@@ -502,35 +494,34 @@
 static int csnmp_config_add_host_collect (host_definition_t *host,
     oconfig_item_t *ci)
 {
   data_definition_t *data;
   data_definition_t **data_list;
   int data_list_len;
-  int i;
 
   if (ci->values_num < 1)
   {
     WARNING ("snmp plugin: `Collect' needs at least one argument.");
     return (-1);
   }
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("snmp plugin: All arguments to `Collect' must be strings.");
       return (-1);
     }
 
   data_list_len = host->data_list_len + ci->values_num;
-  data_list = (data_definition_t **) realloc (host->data_list,
+  data_list = realloc (host->data_list,
       sizeof (data_definition_t *) * data_list_len);
   if (data_list == NULL)
     return (-1);
   host->data_list = data_list;
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     for (data = data_head; data != NULL; data = data->next)
       if (strcasecmp (ci->values[i].value.string, data->name) == 0)
         break;
 
     if (data == NULL)
@@ -637,23 +628,19 @@
 } /* int csnmp_config_add_host_security_level */
 
 static int csnmp_config_add_host (oconfig_item_t *ci)
 {
   host_definition_t *hd;
   int status = 0;
-  int i;
 
   /* Registration stuff. */
   char cb_name[DATA_MAX_NAME_LEN];
-  user_data_t cb_data;
-  struct timespec cb_interval;
 
-  hd = (host_definition_t *) malloc (sizeof (host_definition_t));
+  hd = calloc (1, sizeof (*hd));
   if (hd == NULL)
     return (-1);
-  memset (hd, '\0', sizeof (host_definition_t));
   hd->version = 2;
   C_COMPLAIN_INIT (&hd->complaint);
 
   status = cf_util_get_string(ci, &hd->name);
   if (status != 0)
   {
@@ -661,13 +648,13 @@
     return status;
   }
 
   hd->sess_handle = NULL;
   hd->interval = 0;
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
     status = 0;
 
     if (strcasecmp ("Address", option->key) == 0)
       status = cf_util_get_string(option, &hd->address);
@@ -774,38 +761,34 @@
 
   DEBUG ("snmp plugin: hd = { name = %s, address = %s, community = %s, version = %i }",
       hd->name, hd->address, hd->community, hd->version);
 
   ssnprintf (cb_name, sizeof (cb_name), "snmp-%s", hd->name);
 
-  memset (&cb_data, 0, sizeof (cb_data));
-  cb_data.data = hd;
-  cb_data.free_func = csnmp_host_definition_destroy;
-
-  CDTIME_T_TO_TIMESPEC (hd->interval, &cb_interval);
+  user_data_t ud = {
+    .data = hd,
+    .free_func = csnmp_host_definition_destroy
+  };
 
   status = plugin_register_complex_read (/* group = */ NULL, cb_name,
-      csnmp_read_host, /* interval = */ &cb_interval,
-      /* user_data = */ &cb_data);
+      csnmp_read_host, hd->interval, /* user_data = */ &ud);
   if (status != 0)
   {
     ERROR ("snmp plugin: Registering complex read function failed.");
     csnmp_host_definition_destroy (hd);
     return (-1);
   }
 
   return (0);
 } /* int csnmp_config_add_host */
 
 static int csnmp_config (oconfig_item_t *ci)
 {
-  int i;
-
   call_snmp_init_once ();
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
     if (strcasecmp ("Data", child->key) == 0)
       csnmp_config_add_data (child);
     else if (strcasecmp ("Host", child->key) == 0)
       csnmp_config_add_host (child);
@@ -947,15 +930,14 @@
   else if (vl->type == ASN_OCTET_STR)
   {
     /* We'll handle this later.. */
   }
   else
   {
-    char oid_buffer[1024];
+    char oid_buffer[1024] = { 0 };
 
-    memset (oid_buffer, 0, sizeof (oid_buffer));
     snprint_objid (oid_buffer, sizeof (oid_buffer) - 1,
         vl->name, vl->name_length);
 
 #ifdef ASN_NULL
     if (vl->type == ASN_NULL)
       INFO ("snmp plugin: OID \"%s\" is undefined (type ASN_NULL)",
@@ -1052,124 +1034,143 @@
     ret.gauge = NAN;
   }
 
   return (ret);
 } /* value_t csnmp_value_list_to_value */
 
+/* csnmp_strvbcopy_hexstring converts the bit string contained in "vb" to a hex
+ * representation and writes it to dst. Returns zero on success and ENOMEM if
+ * dst is not large enough to hold the string. dst is guaranteed to be
+ * nul-terminated. */
 static int csnmp_strvbcopy_hexstring (char *dst, /* {{{ */
     const struct variable_list *vb, size_t dst_size)
 {
   char *buffer_ptr;
   size_t buffer_free;
-  size_t i;
+
+  dst[0] = 0;
 
   buffer_ptr = dst;
   buffer_free = dst_size;
 
-  for (i = 0; i < vb->val_len; i++)
+  for (size_t i = 0; i < vb->val_len; i++)
   {
     int status;
 
     status = snprintf (buffer_ptr, buffer_free,
         (i == 0) ? "%02x" : ":%02x", (unsigned int) vb->val.bitstring[i]);
+    assert (status >= 0);
 
-    if (status >= buffer_free)
+    if (((size_t) status) >= buffer_free) /* truncated */
     {
-      buffer_ptr += (buffer_free - 1);
-      *buffer_ptr = 0;
-      return (dst_size + (buffer_free - status));
+      dst[dst_size - 1] = 0;
+      return ENOMEM;
     }
     else /* if (status < buffer_free) */
     {
-      buffer_ptr += status;
-      buffer_free -= status;
+      buffer_ptr  += (size_t) status;
+      buffer_free -= (size_t) status;
     }
   }
 
-  return ((int) (dst_size - buffer_free));
+  return 0;
 } /* }}} int csnmp_strvbcopy_hexstring */
 
+/* csnmp_strvbcopy copies the octet string or bit string contained in vb to
+ * dst. If non-printable characters are detected, it will switch to a hex
+ * representation of the string. Returns zero on success, EINVAL if vb does not
+ * contain a string and ENOMEM if dst is not large enough to contain the
+ * string. */
 static int csnmp_strvbcopy (char *dst, /* {{{ */
     const struct variable_list *vb, size_t dst_size)
 {
   char *src;
   size_t num_chars;
-  size_t i;
 
   if (vb->type == ASN_OCTET_STR)
     src = (char *) vb->val.string;
   else if (vb->type == ASN_BIT_STR)
     src = (char *) vb->val.bitstring;
+  else if (vb->type == ASN_IPADDRESS)
+  {
+    return ssnprintf (dst, dst_size, "%"PRIu8".%"PRIu8".%"PRIu8".%"PRIu8"",
+          (uint8_t) vb->val.string[0],
+          (uint8_t) vb->val.string[1],
+          (uint8_t) vb->val.string[2],
+          (uint8_t) vb->val.string[3]);
+  }
   else
   {
     dst[0] = 0;
     return (EINVAL);
   }
 
   num_chars = dst_size - 1;
   if (num_chars > vb->val_len)
     num_chars = vb->val_len;
 
-  for (i = 0; i < num_chars; i++)
+  for (size_t i = 0; i < num_chars; i++)
   {
     /* Check for control characters. */
     if ((unsigned char)src[i] < 32)
       return (csnmp_strvbcopy_hexstring (dst, vb, dst_size));
     dst[i] = src[i];
   }
   dst[num_chars] = 0;
+  dst[dst_size - 1] = 0;
+
+  if (dst_size <= vb->val_len)
+    return ENOMEM;
 
-  return ((int) vb->val_len);
+  return 0;
 } /* }}} int csnmp_strvbcopy */
 
 static int csnmp_instance_list_add (csnmp_list_instances_t **head,
     csnmp_list_instances_t **tail,
     const struct snmp_pdu *res,
     const host_definition_t *hd, const data_definition_t *dd)
 {
   csnmp_list_instances_t *il;
   struct variable_list *vb;
   oid_t vb_name;
   int status;
-  uint32_t i;
   uint32_t is_matched;
 
   /* Set vb on the last variable */
   for (vb = res->variables;
       (vb != NULL) && (vb->next_variable != NULL);
       vb = vb->next_variable)
     /* do nothing */;
   if (vb == NULL)
     return (-1);
 
   csnmp_oid_init (&vb_name, vb->name, vb->name_length);
 
-  il = malloc (sizeof (*il));
+  il = calloc (1, sizeof (*il));
   if (il == NULL)
   {
-    ERROR ("snmp plugin: malloc failed.");
+    ERROR ("snmp plugin: calloc failed.");
     return (-1);
   }
-  memset (il, 0, sizeof (*il));
   il->next = NULL;
 
   status = csnmp_oid_suffix (&il->suffix, &vb_name, &dd->instance.oid);
   if (status != 0)
   {
     sfree (il);
     return (status);
   }
 
   /* Get instance name */
-  if ((vb->type == ASN_OCTET_STR) || (vb->type == ASN_BIT_STR))
+  if ((vb->type == ASN_OCTET_STR) || (vb->type == ASN_BIT_STR) || (vb->type == ASN_IPADDRESS))
   {
     char *ptr;
 
     csnmp_strvbcopy (il->instance, vb, sizeof (il->instance));
     is_matched = 0;
-    for (i = 0; i < dd->ignores_len; i++)
+    for (uint32_t i = 0; i < dd->ignores_len; i++)
     {
       status = fnmatch(dd->ignores[i], il->instance, 0);
       if (status == 0)
       {
         if (dd->invert_match == 0)
         {
@@ -1223,13 +1224,13 @@
   const data_set_t *ds;
   value_list_t vl = VALUE_LIST_INIT;
 
   csnmp_list_instances_t *instance_list_ptr;
   csnmp_table_values_t **value_table_ptr;
 
-  int i;
+  size_t i;
   _Bool have_more;
   oid_t current_suffix;
 
   ds = plugin_get_ds (data->type);
   if (!ds)
   {
@@ -1238,13 +1239,13 @@
   }
   assert (ds->ds_num == data->values_len);
   assert (data->values_len > 0);
 
   instance_list_ptr = instance_list;
 
-  value_table_ptr = calloc ((size_t) data->values_len, sizeof (*value_table_ptr));
+  value_table_ptr = calloc (data->values_len, sizeof (*value_table_ptr));
   if (value_table_ptr == NULL)
     return (-1);
   for (i = 0; i < data->values_len; i++)
     value_table_ptr[i] = value_table[i];
 
   vl.values_len = data->values_len;
@@ -1259,13 +1260,12 @@
   sstrncpy (vl.host, host->name, sizeof (vl.host));
   sstrncpy (vl.plugin, "snmp", sizeof (vl.plugin));
 
   vl.interval = host->interval;
 
   have_more = 1;
-  memset (&current_suffix, 0, sizeof (current_suffix));
   while (have_more)
   {
     _Bool suffix_skipped = 0;
 
     /* Determine next suffix to handle. */
     if (instance_list != NULL)
@@ -1358,14 +1358,18 @@
             data->instance_prefix, temp);
     }
 
     for (i = 0; i < data->values_len; i++)
       vl.values[i] = value_table_ptr[i]->value;
 
-    /* If we get here `vl.type_instance' and all `vl.values' have been set */
-    plugin_dispatch_values (&vl);
+    /* If we get here `vl.type_instance' and all `vl.values' have been set
+     * vl.type_instance can be empty, i.e. a blank port description on a
+     * switch if you're using IF-MIB::ifDescr as Instance.
+     */
+    if (vl.type_instance[0] != '\0')
+      plugin_dispatch_values (&vl);
 
     if (instance_list != NULL)
       instance_list_ptr = instance_list_ptr->next;
     else
       value_table_ptr[0] = value_table_ptr[0]->next;
   } /* while (have_more) */
@@ -1381,23 +1385,22 @@
   struct snmp_pdu *req;
   struct snmp_pdu *res = NULL;
   struct variable_list *vb;
 
   const data_set_t *ds;
 
-  uint32_t oid_list_len = (uint32_t) (data->values_len + 1);
+  size_t oid_list_len = data->values_len + 1;
   /* Holds the last OID returned by the device. We use this in the GETNEXT
    * request to proceed. */
   oid_t oid_list[oid_list_len];
   /* Set to false when an OID has left its subtree so we don't re-request it
    * again. */
   _Bool oid_list_todo[oid_list_len];
 
   int status;
-  int i;
-  uint32_t j;
+  size_t i;
 
   /* `value_list_head' and `value_list_tail' implement a linked list for each
    * value. `instance_list_head' and `instance_list_tail' implement a linked list of
    * instance names. This is used to jump gaps in the table. */
   csnmp_list_instances_t *instance_list_head;
   csnmp_list_instances_t *instance_list_tail;
@@ -1419,27 +1422,27 @@
     ERROR ("snmp plugin: DataSet `%s' not defined.", data->type);
     return (-1);
   }
 
   if (ds->ds_num != data->values_len)
   {
-    ERROR ("snmp plugin: DataSet `%s' requires %i values, but config talks about %i",
+    ERROR ("snmp plugin: DataSet `%s' requires %zu values, but config talks about %zu",
         data->type, ds->ds_num, data->values_len);
     return (-1);
   }
   assert (data->values_len > 0);
 
   /* We need a copy of all the OIDs, because GETNEXT will destroy them. */
   memcpy (oid_list, data->values, data->values_len * sizeof (oid_t));
   if (data->instance.oid.oid_len > 0)
     memcpy (oid_list + data->values_len, &data->instance.oid, sizeof (oid_t));
   else /* no InstanceFrom option specified. */
     oid_list_len--;
 
-  for (j = 0; j < oid_list_len; j++)
-    oid_list_todo[j] = 1;
+  for (i = 0; i < oid_list_len; i++)
+    oid_list_todo[i] = 1;
 
   /* We're going to construct n linked lists, one for each "value".
    * value_list_head will contain pointers to the heads of these linked lists,
    * value_list_tail will contain pointers to the tail of the lists. */
   value_list_head = calloc (data->values_len, sizeof (*value_list_head));
   value_list_tail = calloc (data->values_len, sizeof (*value_list_tail));
@@ -1465,19 +1468,19 @@
       ERROR ("snmp plugin: snmp_pdu_create failed.");
       status = -1;
       break;
     }
 
     oid_list_todo_num = 0;
-    for (j = 0; j < oid_list_len; j++)
+    for (i = 0; i < oid_list_len; i++)
     {
       /* Do not rerequest already finished OIDs */
-      if (!oid_list_todo[j])
+      if (!oid_list_todo[i])
         continue;
       oid_list_todo_num++;
-      snmp_add_null_var (req, oid_list[j].oid, oid_list[j].oid_len);
+      snmp_add_null_var (req, oid_list[i].oid, oid_list[i].oid_len);
     }
 
     if (oid_list_todo_num == 0)
     {
       /* The request is still empty - so we are finished */
       DEBUG ("snmp plugin: all variables have left their subtree");
@@ -1567,39 +1570,38 @@
 
         /* Calculate the current suffix. This is later used to check that the
          * suffix is increasing. This also checks if we left the subtree */
         ret = csnmp_oid_suffix (&suffix, &vb_name, data->values + i);
         if (ret != 0)
         {
-          DEBUG ("snmp plugin: host = %s; data = %s; i = %i; "
+          DEBUG ("snmp plugin: host = %s; data = %s; i = %zu; "
               "Value probably left its subtree.",
               host->name, data->name, i);
           oid_list_todo[i] = 0;
           continue;
         }
 
         /* Make sure the OIDs returned by the agent are increasing. Otherwise our
          * table matching algorithm will get confused. */
         if ((value_list_tail[i] != NULL)
             && (csnmp_oid_compare (&suffix, &value_list_tail[i]->suffix) <= 0))
         {
-          DEBUG ("snmp plugin: host = %s; data = %s; i = %i; "
+          DEBUG ("snmp plugin: host = %s; data = %s; i = %zu; "
               "Suffix is not increasing.",
               host->name, data->name, i);
           oid_list_todo[i] = 0;
           continue;
         }
 
-        vt = malloc (sizeof (*vt));
+        vt = calloc (1, sizeof (*vt));
         if (vt == NULL)
         {
-          ERROR ("snmp plugin: malloc failed.");
+          ERROR ("snmp plugin: calloc failed.");
           status = -1;
           break;
         }
-        memset (vt, 0, sizeof (*vt));
 
         vt->value = csnmp_value_list_to_value (vb, ds->ds[i].type,
             data->scale, data->shift, host->name, data->name);
         memcpy (&vt->suffix, &suffix, sizeof (vt->suffix));
         vt->next = NULL;
 
@@ -1656,20 +1658,20 @@
   return (0);
 } /* int csnmp_read_table */
 
 static int csnmp_read_value (host_definition_t *host, data_definition_t *data)
 {
   struct snmp_pdu *req;
-  struct snmp_pdu *res;
+  struct snmp_pdu *res = NULL;
   struct variable_list *vb;
 
   const data_set_t *ds;
   value_list_t vl = VALUE_LIST_INIT;
 
   int status;
-  int i;
+  size_t i;
 
   DEBUG ("snmp plugin: csnmp_read_value (host = %s, data = %s)",
       host->name, data->name);
 
   if (host->sess_handle == NULL)
   {
@@ -1683,19 +1685,19 @@
     ERROR ("snmp plugin: DataSet `%s' not defined.", data->type);
     return (-1);
   }
 
   if (ds->ds_num != data->values_len)
   {
-    ERROR ("snmp plugin: DataSet `%s' requires %i values, but config talks about %i",
+    ERROR ("snmp plugin: DataSet `%s' requires %zu values, but config talks about %zu",
         data->type, ds->ds_num, data->values_len);
     return (-1);
   }
 
   vl.values_len = ds->ds_num;
-  vl.values = (value_t *) malloc (sizeof (value_t) * vl.values_len);
+  vl.values = malloc (sizeof (*vl.values) * vl.values_len);
   if (vl.values == NULL)
     return (-1);
   for (i = 0; i < vl.values_len; i++)
   {
     if (ds->ds[i].type == DS_TYPE_COUNTER)
       vl.values[i].counter = 0;
@@ -1718,26 +1720,24 @@
     return (-1);
   }
 
   for (i = 0; i < data->values_len; i++)
     snmp_add_null_var (req, data->values[i].oid, data->values[i].oid_len);
 
-  res = NULL;
   status = snmp_sess_synch_response (host->sess_handle, req, &res);
 
   if ((status != STAT_SUCCESS) || (res == NULL))
   {
     char *errstr = NULL;
 
     snmp_sess_error (host->sess_handle, NULL, NULL, &errstr);
     ERROR ("snmp plugin: host %s: snmp_sess_synch_response failed: %s",
         host->name, (errstr == NULL) ? "Unknown problem" : errstr);
 
     if (res != NULL)
       snmp_free_pdu (res);
-    res = NULL;
 
     sfree (errstr);
     sfree (vl.values);
     csnmp_host_close_session (host);
 
     return (-1);
@@ -1757,39 +1757,33 @@
       if (snmp_oid_compare (data->values[i].oid, data->values[i].oid_len,
             vb->name, vb->name_length) == 0)
         vl.values[i] = csnmp_value_list_to_value (vb, ds->ds[i].type,
             data->scale, data->shift, host->name, data->name);
   } /* for (res->variables) */
 
-  if (res != NULL)
-    snmp_free_pdu (res);
-  res = NULL;
+  snmp_free_pdu (res);
 
   DEBUG ("snmp plugin: -> plugin_dispatch_values (&vl);");
   plugin_dispatch_values (&vl);
   sfree (vl.values);
 
   return (0);
 } /* int csnmp_read_value */
 
 static int csnmp_read_host (user_data_t *ud)
 {
   host_definition_t *host;
-  cdtime_t time_start;
-  cdtime_t time_end;
   int status;
   int success;
   int i;
 
   host = ud->data;
 
   if (host->interval == 0)
     host->interval = plugin_get_interval ();
 
-  time_start = cdtime ();
-
   if (host->sess_handle == NULL)
     csnmp_host_open_session (host);
 
   if (host->sess_handle == NULL)
     return (-1);
 
@@ -1804,22 +1798,12 @@
       status = csnmp_read_value (host, data);
 
     if (status == 0)
       success++;
   }
 
-  time_end = cdtime ();
-  if ((time_end - time_start) > host->interval)
-  {
-    WARNING ("snmp plugin: Host `%s' should be queried every %.3f "
-        "seconds, but reading all values takes %.3f seconds.",
-        host->name,
-        CDTIME_T_TO_DOUBLE (host->interval),
-        CDTIME_T_TO_DOUBLE (time_end - time_start));
-  }
-
   if (success == 0)
     return (-1);
 
   return (0);
 } /* int csnmp_read_host */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/statsd.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/statsd.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/statsd.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/statsd.c	2016-09-11 16:10:25.271038709 +0800
@@ -22,23 +22,19 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "utils_avltree.h"
-#include "utils_complain.h"
 #include "utils_latency.h"
 
-#include <pthread.h>
-
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <netdb.h>
 #include <poll.h>
 
 /* AIX doesn't have MSG_DONTWAIT */
 #ifndef MSG_DONTWAIT
 #  define MSG_DONTWAIT MSG_NONBLOCK
@@ -62,12 +58,13 @@
 typedef enum metric_type_e metric_type_t;
 
 struct statsd_metric_s
 {
   metric_type_t type;
   double value;
+  derive_t counter;
   latency_counter_t *latency;
   c_avl_tree_t *set;
   unsigned long updates_num;
 };
 typedef struct statsd_metric_s statsd_metric_t;
 
@@ -86,12 +83,13 @@
 static _Bool conf_delete_gauges   = 0;
 static _Bool conf_delete_sets     = 0;
 
 static double *conf_timer_percentile = NULL;
 static size_t  conf_timer_percentile_num = 0;
 
+static _Bool conf_counter_sum     = 0;
 static _Bool conf_timer_lower     = 0;
 static _Bool conf_timer_upper     = 0;
 static _Bool conf_timer_sum       = 0;
 static _Bool conf_timer_count     = 0;
 
 /* Must hold metrics_lock when calling this function. */
@@ -123,20 +121,19 @@
   if (key_copy == NULL)
   {
     ERROR ("statsd plugin: strdup failed.");
     return (NULL);
   }
 
-  metric = malloc (sizeof (*metric));
+  metric = calloc (1, sizeof (*metric));
   if (metric == NULL)
   {
-    ERROR ("statsd plugin: malloc failed.");
+    ERROR ("statsd plugin: calloc failed.");
     sfree (key_copy);
     return (NULL);
   }
-  memset (metric, 0, sizeof (*metric));
 
   metric->type = type;
   metric->latency = NULL;
   metric->set = NULL;
 
   status = c_avl_insert (metrics_tree, key_copy, metric);
@@ -259,12 +256,14 @@
 
   value.gauge = 1.0;
   status = statsd_parse_value (value_str, &value);
   if (status != 0)
     return (status);
 
+  /* Changes to the counter are added to (statsd_metric_t*)->value. ->counter is
+   * only updated in statsd_metric_submit_unsafe(). */
   return (statsd_metric_add (name, (double) (value.gauge / scale.gauge),
         STATSD_COUNTER));
 } /* }}} int statsd_handle_counter */
 
 static int statsd_handle_gauge (char const *name, /* {{{ */
     char const *value_str)
@@ -353,13 +352,13 @@
     pthread_mutex_unlock (&metrics_lock);
     return (-1);
   }
 
   /* Make sure metric->set exists. */
   if (metric->set == NULL)
-    metric->set = c_avl_create ((void *) strcmp);
+    metric->set = c_avl_create ((int (*) (const void *, const void *)) strcmp);
 
   if (metric->set == NULL)
   {
     pthread_mutex_unlock (&metrics_lock);
     ERROR ("statsd plugin: c_avl_create failed.");
     return (-1);
@@ -498,38 +497,34 @@
 static int statsd_network_init (struct pollfd **ret_fds, /* {{{ */
     size_t *ret_fds_num)
 {
   struct pollfd *fds = NULL;
   size_t fds_num = 0;
 
-  struct addrinfo ai_hints;
-  struct addrinfo *ai_list = NULL;
-  struct addrinfo *ai_ptr;
+  struct addrinfo *ai_list;
   int status;
 
   char const *node = (conf_node != NULL) ? conf_node : STATSD_DEFAULT_NODE;
   char const *service = (conf_service != NULL)
     ? conf_service : STATSD_DEFAULT_SERVICE;
 
-  memset (&ai_hints, 0, sizeof (ai_hints));
-  ai_hints.ai_flags = AI_PASSIVE;
-#ifdef AI_ADDRCONFIG
-  ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-  ai_hints.ai_family = AF_UNSPEC;
-  ai_hints.ai_socktype = SOCK_DGRAM;
+  struct addrinfo ai_hints = {
+    .ai_family = AF_UNSPEC,
+    .ai_flags = AI_PASSIVE | AI_ADDRCONFIG,
+    .ai_socktype = SOCK_DGRAM
+  };
 
   status = getaddrinfo (node, service, &ai_hints, &ai_list);
   if (status != 0)
   {
     ERROR ("statsd plugin: getaddrinfo (\"%s\", \"%s\") failed: %s",
         node, service, gai_strerror (status));
     return (status);
   }
 
-  for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+  for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
   {
     int fd;
     struct pollfd *tmp;
 
     char dbg_node[NI_MAXHOST];
     char dbg_service[NI_MAXSERV];
@@ -590,13 +585,12 @@
 
 static void *statsd_network_thread (void *args) /* {{{ */
 {
   struct pollfd *fds = NULL;
   size_t fds_num = 0;
   int status;
-  size_t i;
 
   status = statsd_network_init (&fds, &fds_num);
   if (status != 0)
   {
     ERROR ("statsd plugin: Unable to open listening sockets.");
     pthread_exit ((void *) 0);
@@ -614,24 +608,24 @@
 
       ERROR ("statsd plugin: poll(2) failed: %s",
           sstrerror (errno, errbuf, sizeof (errbuf)));
       break;
     }
 
-    for (i = 0; i < fds_num; i++)
+    for (size_t i = 0; i < fds_num; i++)
     {
       if ((fds[i].revents & (POLLIN | POLLPRI)) == 0)
         continue;
 
       statsd_network_read (fds[i].fd);
       fds[i].revents = 0;
     }
   } /* while (!network_thread_shutdown) */
 
   /* Clean up */
-  for (i = 0; i < fds_num; i++)
+  for (size_t i = 0; i < fds_num; i++)
     close (fds[i].fd);
   sfree (fds);
 
   return ((void *) 0);
 } /* }}} void *statsd_network_thread */
 
@@ -665,15 +659,13 @@
 
   return (0);
 } /* }}} int statsd_config_timer_percentile */
 
 static int statsd_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       cf_util_get_string (child, &conf_node);
     else if (strcasecmp ("Port", child->key) == 0)
@@ -683,12 +675,14 @@
     else if (strcasecmp ("DeleteTimers", child->key) == 0)
       cf_util_get_boolean (child, &conf_delete_timers);
     else if (strcasecmp ("DeleteGauges", child->key) == 0)
       cf_util_get_boolean (child, &conf_delete_gauges);
     else if (strcasecmp ("DeleteSets", child->key) == 0)
       cf_util_get_boolean (child, &conf_delete_sets);
+    else if (strcasecmp ("CounterSum", child->key) == 0)
+      cf_util_get_boolean (child, &conf_counter_sum);
     else if (strcasecmp ("TimerLower", child->key) == 0)
       cf_util_get_boolean (child, &conf_timer_lower);
     else if (strcasecmp ("TimerUpper", child->key) == 0)
       cf_util_get_boolean (child, &conf_timer_upper);
     else if (strcasecmp ("TimerSum", child->key) == 0)
       cf_util_get_boolean (child, &conf_timer_sum);
@@ -705,13 +699,13 @@
 } /* }}} int statsd_config */
 
 static int statsd_init (void) /* {{{ */
 {
   pthread_mutex_lock (&metrics_lock);
   if (metrics_tree == NULL)
-    metrics_tree = c_avl_create ((void *) strcmp);
+    metrics_tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
 
   if (!network_thread_running)
   {
     int status;
 
     status = pthread_create (&network_thread,
@@ -753,14 +747,13 @@
   }
 
   return (0);
 } /* }}} int statsd_metric_clear_set_unsafe */
 
 /* Must hold metrics_lock when calling this function. */
-static int statsd_metric_submit_unsafe (char const *name, /* {{{ */
-    statsd_metric_t const *metric)
+static int statsd_metric_submit_unsafe (char const *name, statsd_metric_t *metric) /* {{{ */
 {
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
 
   vl.values = values;
   vl.values_len = 1;
@@ -779,13 +772,12 @@
   sstrncpy (vl.type_instance, name, sizeof (vl.type_instance));
 
   if (metric->type == STATSD_GAUGE)
     values[0].gauge = (gauge_t) metric->value;
   else if (metric->type == STATSD_TIMER)
   {
-    size_t i;
     _Bool have_events = (metric->updates_num > 0);
 
     /* Make sure all timer metrics share the *same* timestamp. */
     vl.time = cdtime ();
 
     ssnprintf (vl.type_instance, sizeof (vl.type_instance),
@@ -819,13 +811,13 @@
       values[0].gauge = have_events
         ? CDTIME_T_TO_DOUBLE (latency_counter_get_sum (metric->latency))
         : NAN;
       plugin_dispatch_values (&vl);
     }
 
-    for (i = 0; i < conf_timer_percentile_num; i++)
+    for (size_t i = 0; i < conf_timer_percentile_num; i++)
     {
       ssnprintf (vl.type_instance, sizeof (vl.type_instance),
           "%s-percentile-%.0f", name, conf_timer_percentile[i]);
       values[0].gauge = have_events
         ? CDTIME_T_TO_DOUBLE (latency_counter_get_percentile (metric->latency, conf_timer_percentile[i]))
         : NAN;
@@ -850,23 +842,34 @@
     if (metric->set == NULL)
       values[0].gauge = 0.0;
     else
       values[0].gauge = (gauge_t) c_avl_size (metric->set);
   }
   else { /* STATSD_COUNTER */
-      /*
-       * Expand a single value to two metrics:
-       *
-       * - The absolute counter, as a gauge
-       * - A derived rate for this counter
-       */
-      values[0].derive = (derive_t) metric->value;
-      plugin_dispatch_values(&vl);
+    gauge_t delta = nearbyint (metric->value);
+
+    /* Etsy's statsd writes counters as two metrics: a rate and the change since
+     * the last write. Since collectd does not reset its DERIVE metrics to zero,
+     * this makes little sense, but we're dispatching a "count" metric here
+     * anyway - if requested by the user - for compatibility reasons. */
+    if (conf_counter_sum)
+    {
+      sstrncpy (vl.type, "count", sizeof (vl.type));
+      values[0].gauge = delta;
+      plugin_dispatch_values (&vl);
+
+      /* restore vl.type */
+      sstrncpy (vl.type, "derive", sizeof (vl.type));
+    }
+
+    /* Rather than resetting value to zero, subtract delta so we correctly keep
+     * track of residuals. */
+    metric->value   -= delta;
+    metric->counter += (derive_t) delta;
 
-      sstrncpy(vl.type, "gauge", sizeof (vl.type));
-      values[0].gauge = (gauge_t) metric->value;
+    values[0].derive = metric->counter;
   }
 
   return (plugin_dispatch_values (&vl));
 } /* }}} int statsd_metric_submit_unsafe */
 
 static int statsd_read (void) /* {{{ */
@@ -874,13 +877,12 @@
   c_avl_iterator_t *iter;
   char *name;
   statsd_metric_t *metric;
 
   char **to_be_deleted = NULL;
   size_t to_be_deleted_num = 0;
-  size_t i;
 
   pthread_mutex_lock (&metrics_lock);
 
   if (metrics_tree == NULL)
   {
     pthread_mutex_unlock (&metrics_lock);
@@ -909,13 +911,13 @@
     metric->updates_num = 0;
     if (metric->type == STATSD_SET)
       statsd_metric_clear_set_unsafe (metric);
   }
   c_avl_iterator_destroy (iter);
 
-  for (i = 0; i < to_be_deleted_num; i++)
+  for (size_t i = 0; i < to_be_deleted_num; i++)
   {
     int status;
 
     status = c_avl_remove (metrics_tree, to_be_deleted[i],
         (void *) &name, (void *) &metric);
     if (status != 0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/swap.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/swap.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/swap.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/swap.c	2016-09-11 16:10:25.271038709 +0800
@@ -79,12 +80,16 @@
 #elif HAVE_SWAPCTL && HAVE_SWAPCTL_TWO_ARGS
 # define SWAP_HAVE_REPORT_BY_DEVICE 1
 static derive_t pagesize;
 static _Bool report_by_device = 0;
 /* #endif HAVE_SWAPCTL && HAVE_SWAPCTL_TWO_ARGS */
 
+#elif HAVE_SWAPCTL && HAVE_SWAPCTL_THREE_ARGS
+/* No global variables */
+/* #endif HAVE_SWAPCTL && HAVE_SWAPCTL_THREE_ARGS */
+
 #elif defined(VM_SWAPUSAGE)
 /* No global variables */
 /* #endif defined(VM_SWAPUSAGE) */
 
 #elif HAVE_LIBKVM_GETSWAPINFO
 static kvm_t *kvm_obj = NULL;
@@ -105,15 +110,13 @@
 
 static _Bool values_absolute = 1;
 static _Bool values_percentage = 0;
 
 static int swap_config (oconfig_item_t *ci) /* {{{ */
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 		if (strcasecmp ("ReportBytes", child->key) == 0)
 #if KERNEL_LINUX
 			cf_util_get_boolean (child, &report_bytes);
 #else
@@ -502,13 +505,12 @@
 static int swap_read (void) /* {{{ */
 {
         swaptbl_t *s;
 	char *s_paths;
         int swap_num;
         int status;
-        int i;
 
         gauge_t avail = 0;
         gauge_t total = 0;
 
         swap_num = swapctl (SC_GETNSWP, NULL);
         if (swap_num < 0)
@@ -535,13 +537,13 @@
 	if (s_paths == NULL)
 	{
 		ERROR ("swap plugin: calloc failed.");
 		sfree (s);
 		return (-1);
 	}
-        for (i = 0; i < swap_num; i++)
+        for (int i = 0; i < swap_num; i++)
 		s->swt_ent[i].ste_path = s_paths + (i * PATH_MAX);
         s->swt_n = swap_num;
 
         status = swapctl (SC_LIST, s);
         if (status < 0)
         {
@@ -565,13 +567,13 @@
                 return (-1);
 	}
 	else if (swap_num > status)
 		/* less elements returned than requested */
 		swap_num = status;
 
-        for (i = 0; i < swap_num; i++)
+        for (int i = 0; i < swap_num; i++)
         {
 		char path[PATH_MAX];
 		gauge_t this_total;
 		gauge_t this_avail;
 
                 if ((s->swt_ent[i].ste_flags & ST_INDEL) != 0)
@@ -618,13 +620,12 @@
 #elif HAVE_SWAPCTL && HAVE_SWAPCTL_THREE_ARGS
 static int swap_read (void) /* {{{ */
 {
 	struct swapent *swap_entries;
 	int swap_num;
 	int status;
-	int i;
 
 	gauge_t used  = 0;
 	gauge_t total = 0;
 
 	swap_num = swapctl (SWAP_NSWAP, NULL, 0);
 	if (swap_num < 0)
@@ -657,25 +658,26 @@
 #else
 # define C_SWAP_BLOCK_SIZE 512.0
 #endif
 
 	/* TODO: Report per-device stats. The path name is available from
 	 * swap_entries[i].se_path */
-	for (i = 0; i < swap_num; i++)
+	for (int i = 0; i < swap_num; i++)
 	{
 		if ((swap_entries[i].se_flags & SWF_ENABLE) == 0)
 			continue;
 
 		used  += ((gauge_t) swap_entries[i].se_inuse) * C_SWAP_BLOCK_SIZE;
 		total += ((gauge_t) swap_entries[i].se_nblks) * C_SWAP_BLOCK_SIZE;
 	}
 
 	if (total < used)
 	{
 		ERROR ("swap plugin: Total swap space (%g) is less than used swap space (%g).",
 				total, used);
+		sfree (swap_entries);
 		return (-1);
 	}
 
 	swap_submit_usage (NULL, used, total - used, NULL, NAN);
 
 	sfree (swap_entries);
@@ -754,20 +756,19 @@
 } /* }}} int swap_read */
 /* #endif  HAVE_LIBSTATGRAB */
 
 #elif HAVE_PERFSTAT
 static int swap_read (void) /* {{{ */
 {
-	perfstat_memory_total_t pmemory;
+	perfstat_memory_total_t pmemory = { 0 };
 	int status;
 
 	gauge_t total;
 	gauge_t free;
 	gauge_t reserved;
 
-	memset (&pmemory, 0, sizeof (pmemory));
         status = perfstat_memory_total (NULL, &pmemory, sizeof(perfstat_memory_total_t), 1);
 	if (status < 0)
 	{
                 char errbuf[1024];
                 WARNING ("swap plugin: perfstat_memory_total failed: %s",
                         sstrerror (errno, errbuf, sizeof (errbuf)));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/syslog.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/syslog.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/syslog.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/syslog.c	2016-09-11 16:10:25.271038709 +0800
@@ -87,13 +88,13 @@
 static int sl_notification (const notification_t *n,
 		user_data_t __attribute__((unused)) *user_data)
 {
 	char  buf[1024] = "";
 	size_t offset = 0;
 	int log_severity;
-	char *severity_string;
+	const char *severity_string;
 	int status;
 
 	if (n->severity > notif_severity)
 		return (0);
 
 	switch (n->severity)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/table.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/table.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/table.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/table.c	2016-09-11 16:10:25.271038709 +0800
@@ -26,31 +26,31 @@
 
 /*
  * This module provides generic means to parse and dispatch tabular data.
  */
 
 #include "collectd.h"
+
 #include "common.h"
 
-#include "configfile.h"
 #include "plugin.h"
 
 #define log_err(...) ERROR ("table plugin: " __VA_ARGS__)
 #define log_warn(...) WARNING ("table plugin: " __VA_ARGS__)
 
 /*
  * private data types
  */
 
 typedef struct {
-	char  *type;
-	char  *instance_prefix;
-	int   *instances;
-	size_t instances_num;
-	int   *values;
-	size_t values_num;
+	char   *type;
+	char   *instance_prefix;
+	size_t *instances;
+	size_t  instances_num;
+	size_t *values;
+	size_t  values_num;
 
 	const data_set_t *ds;
 } tbl_result_t;
 
 typedef struct {
 	char *file;
@@ -102,19 +102,17 @@
 
 	tbl->max_colnum  = 0;
 } /* tbl_setup */
 
 static void tbl_clear (tbl_t *tbl)
 {
-	size_t i;
-
 	sfree (tbl->file);
 	sfree (tbl->sep);
 	sfree (tbl->instance);
 
-	for (i = 0; i < tbl->results_num; ++i)
+	for (size_t i = 0; i < tbl->results_num; ++i)
 		tbl_result_clear (tbl->results + i);
 	sfree (tbl->results);
 	tbl->results_num = 0;
 
 	tbl->max_colnum  = 0;
 } /* tbl_clear */
@@ -136,33 +134,32 @@
 
 	sfree (*var);
 	*var = sstrdup (ci->values[0].value.string);
 	return 0;
 } /* tbl_config_set_separator */
 
-static int tbl_config_append_array_i (char *name, int **var, size_t *len,
+static int tbl_config_append_array_i (char *name, size_t **var, size_t *len,
 		oconfig_item_t *ci)
 {
-	int *tmp;
-
-	size_t i;
+	size_t *tmp;
+	size_t num;
 
 	if (1 > ci->values_num) {
 		log_err ("\"%s\" expects at least one argument.", name);
 		return 1;
 	}
 
-	for (i = 0; i < ci->values_num; ++i) {
+	num = (size_t) ci->values_num;
+	for (size_t i = 0; i < num; ++i) {
 		if (OCONFIG_TYPE_NUMBER != ci->values[i].type) {
 			log_err ("\"%s\" expects numerical arguments only.", name);
 			return 1;
 		}
 	}
 
-	*len += ci->values_num;
-	tmp = (int *)realloc (*var, *len * sizeof (**var));
+	tmp = realloc (*var, ((*len) + num) * sizeof (**var));
 	if (NULL == tmp) {
 		char errbuf[1024];
 		log_err ("realloc failed: %s.",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return -1;
 	}
@@ -163,33 +160,34 @@
 	if (NULL == tmp) {
 		char errbuf[1024];
 		log_err ("realloc failed: %s.",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return -1;
 	}
-
 	*var = tmp;
 
-	for (i = *len - ci->values_num; i < *len; ++i)
-		(*var)[i] = (int)ci->values[i].value.number;
+	for (size_t i = 0; i < num; ++i) {
+		(*var)[*len] = (size_t) ci->values[i].value.number;
+		(*len)++;
+	}
+
 	return 0;
 } /* tbl_config_append_array_s */
 
 static int tbl_config_result (tbl_t *tbl, oconfig_item_t *ci)
 {
 	tbl_result_t *res;
 
 	int status = 0;
-	size_t i;
 
 	if (0 != ci->values_num) {
 		log_err ("<Result> does not expect any arguments.");
 		return 1;
 	}
 
-	res = (tbl_result_t *)realloc (tbl->results,
+	res = realloc (tbl->results,
 			(tbl->results_num + 1) * sizeof (*tbl->results));
 	if (res == NULL) {
 		char errbuf[1024];
 		log_err ("realloc failed: %s.",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return -1;
@@ -198,13 +196,13 @@
 	tbl->results = res;
 	++tbl->results_num;
 
 	res = tbl->results + tbl->results_num - 1;
 	tbl_result_setup (res);
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "Type"))
 			tbl_config_set_s (c->key, &res->type, c);
 		else if (0 == strcasecmp (c->key, "InstancePrefix"))
 			tbl_config_set_s (c->key, &res->instance_prefix, c);
@@ -241,21 +239,20 @@
 
 static int tbl_config_table (oconfig_item_t *ci)
 {
 	tbl_t *tbl;
 
 	int status = 0;
-	size_t i;
 
 	if ((1 != ci->values_num)
 			|| (OCONFIG_TYPE_STRING != ci->values[0].type)) {
 		log_err ("<Table> expects a single string argument.");
 		return 1;
 	}
 
-	tbl = (tbl_t *)realloc (tables, (tables_num + 1) * sizeof (*tables));
+	tbl = realloc (tables, (tables_num + 1) * sizeof (*tables));
 	if (NULL == tbl) {
 		char errbuf[1024];
 		log_err ("realloc failed: %s.",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return -1;
 	}
@@ -263,13 +260,13 @@
 	tables = tbl;
 	++tables_num;
 
 	tbl = tables + tables_num - 1;
 	tbl_setup (tbl, ci->values[0].value.string);
 
-	for (i = 0; i < ci->children_num; ++i) {
+	for (size_t i = 0; i < ((size_t) ci->children_num); ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "Separator"))
 			tbl_config_set_s (c->key, &tbl->sep, c);
 		else if (0 == strcasecmp (c->key, "Instance"))
 			tbl_config_set_s (c->key, &tbl->instance, c);
@@ -301,32 +298,29 @@
 	if (0 != status) {
 		tbl_clear (tbl);
 		--tables_num;
 		return status;
 	}
 
-	for (i = 0; i < tbl->results_num; ++i) {
+	for (size_t i = 0; i < tbl->results_num; ++i) {
 		tbl_result_t *res = tbl->results + i;
-		size_t j;
 
-		for (j = 0; j < res->instances_num; ++j)
+		for (size_t j = 0; j < res->instances_num; ++j)
 			if (res->instances[j] > tbl->max_colnum)
 				tbl->max_colnum = res->instances[j];
 
-		for (j = 0; j < res->values_num; ++j)
+		for (size_t j = 0; j < res->values_num; ++j)
 			if (res->values[j] > tbl->max_colnum)
 				tbl->max_colnum = res->values[j];
 	}
 	return 0;
 } /* tbl_config_table */
 
 static int tbl_config (oconfig_item_t *ci)
 {
-	size_t i;
-
-	for (i = 0; i < ci->children_num; ++i) {
+	for (int i = 0; i < ci->children_num; ++i) {
 		oconfig_item_t *c = ci->children + i;
 
 		if (0 == strcasecmp (c->key, "Table"))
 			tbl_config_table (c);
 		else
 			log_warn ("Ignoring unknown config key \"%s\".", c->key);
@@ -337,56 +331,50 @@
 /*
  * result handling
  */
 
 static int tbl_prepare (tbl_t *tbl)
 {
-	size_t i;
-
-	for (i = 0; i < tbl->results_num; ++i) {
+	for (size_t i = 0; i < tbl->results_num; ++i) {
 		tbl_result_t *res = tbl->results + i;
 
 		res->ds = plugin_get_ds (res->type);
 		if (NULL == res->ds) {
 			log_err ("Unknown type \"%s\". See types.db(5) for details.",
 					res->type);
 			return -1;
 		}
 
-		if (res->values_num != (size_t)res->ds->ds_num) {
+		if (res->values_num != res->ds->ds_num) {
 			log_err ("Invalid type \"%s\". Expected %zu data source%s, "
-					"got %i.", res->type, res->values_num,
+					"got %zu.", res->type, res->values_num,
 					(1 == res->values_num) ? "" : "s",
 					res->ds->ds_num);
 			return -1;
 		}
 	}
 	return 0;
 } /* tbl_prepare */
 
 static int tbl_finish (tbl_t *tbl)
 {
-	size_t i;
-
-	for (i = 0; i < tbl->results_num; ++i)
+	for (size_t i = 0; i < tbl->results_num; ++i)
 		tbl->results[i].ds = NULL;
 	return 0;
 } /* tbl_finish */
 
 static int tbl_result_dispatch (tbl_t *tbl, tbl_result_t *res,
 		char **fields, size_t fields_num)
 {
 	value_list_t vl = VALUE_LIST_INIT;
 	value_t values[res->values_num];
 
-	size_t i;
-
 	assert (NULL != res->ds);
 	assert (res->values_num == res->ds->ds_num);
 
-	for (i = 0; i < res->values_num; ++i) {
+	for (size_t i = 0; i < res->values_num; ++i) {
 		char *value;
 
 		assert (res->values[i] < fields_num);
 		value = fields[res->values[i]];
 
 		if (0 != parse_value (value, &values[i], res->ds->ds[i].type))
@@ -407,13 +395,13 @@
 					sizeof (vl.type_instance));
 	}
 	else {
 		char *instances[res->instances_num];
 		char  instances_str[DATA_MAX_NAME_LEN];
 
-		for (i = 0; i < res->instances_num; ++i) {
+		for (size_t i = 0; i < res->instances_num; ++i) {
 			assert (res->instances[i] < fields_num);
 			instances[i] = fields[res->instances[i]];
 		}
 
 		strjoin (instances_str, sizeof (instances_str),
 				instances, STATIC_ARRAY_SIZE (instances), "-");
@@ -439,27 +427,26 @@
 
 static int tbl_parse_line (tbl_t *tbl, char *line, size_t len)
 {
 	char *fields[tbl->max_colnum + 1];
 	char *ptr, *saveptr;
 
-	size_t i;
+	size_t i = 0;
 
-	i = 0;
 	ptr = line;
 	saveptr = NULL;
 	while (NULL != (fields[i] = strtok_r (ptr, tbl->sep, &saveptr))) {
 		ptr = NULL;
 		++i;
 
 		if (i > tbl->max_colnum)
 			break;
 	}
 
 	if (i <= tbl->max_colnum) {
-		log_err ("Not enough columns in line "
+		log_warn ("Not enough columns in line "
 				"(expected at least %zu, got %zu).",
 				tbl->max_colnum + 1, i);
 		return -1;
 	}
 
 	for (i = 0; i < tbl->results_num; ++i)
@@ -485,17 +472,17 @@
 	}
 
 	buf[sizeof (buf) - 1] = '\0';
 	while (NULL != fgets (buf, sizeof (buf), fh)) {
 		if ('\0' != buf[sizeof (buf) - 1]) {
 			buf[sizeof (buf) - 1] = '\0';
-			log_err ("Table %s: Truncated line: %s", tbl->file, buf);
+			log_warn ("Table %s: Truncated line: %s", tbl->file, buf);
 		}
 
 		if (0 != tbl_parse_line (tbl, buf, sizeof (buf))) {
-			log_err ("Table %s: Failed to parse line: %s", tbl->file, buf);
+			log_warn ("Table %s: Failed to parse line: %s", tbl->file, buf);
 			continue;
 		}
 	}
 
 	if (0 != ferror (fh)) {
 		char errbuf[1024];
@@ -513,18 +500,17 @@
  * collectd callbacks
  */
 
 static int tbl_read (void)
 {
 	int status = -1;
-	size_t i;
 
 	if (0 == tables_num)
 		return 0;
 
-	for (i = 0; i < tables_num; ++i) {
+	for (size_t i = 0; i < tables_num; ++i) {
 		tbl_t *tbl = tables + i;
 
 		if (0 != tbl_prepare (tbl)) {
 			log_err ("Failed to prepare and parse table \"%s\".", tbl->file);
 			continue;
 		}
@@ -536,15 +522,13 @@
 	}
 	return status;
 } /* tbl_read */
 
 static int tbl_shutdown (void)
 {
-	size_t i;
-
-	for (i = 0; i < tables_num; ++i)
+	for (size_t i = 0; i < tables_num; ++i)
 		tbl_clear (&tables[i]);
 	sfree (tables);
 	return 0;
 } /* tbl_shutdown */
 
 static int tbl_init (void)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tail.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tail.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tail.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tail.c	2016-09-11 16:10:25.271038709 +0800
@@ -53,15 +54,15 @@
   char *type;
   char *type_instance;
   cdtime_t interval;
 };
 typedef struct ctail_config_match_s ctail_config_match_t;
 
-cu_tail_match_t **tail_match_list = NULL;
-size_t tail_match_list_num = 0;
-cdtime_t tail_match_list_intervals[255];
+static cu_tail_match_t **tail_match_list = NULL;
+static size_t tail_match_list_num = 0;
+static cdtime_t tail_match_list_intervals[255];
 
 static int ctail_config_add_match_dstype (ctail_config_match_t *cm,
     oconfig_item_t *ci)
 {
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -134,25 +135,22 @@
   return (0);
 } /* int ctail_config_add_match_dstype */
 
 static int ctail_config_add_match (cu_tail_match_t *tm,
     const char *plugin_instance, oconfig_item_t *ci, cdtime_t interval)
 {
-  ctail_config_match_t cm;
+  ctail_config_match_t cm = { 0 };
   int status;
-  int i;
-
-  memset (&cm, '\0', sizeof (cm));
 
   if (ci->values_num != 0)
   {
     WARNING ("tail plugin: Ignoring arguments for the `Match' block.");
   }
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Regex", option->key) == 0)
       status = cf_util_get_string (option, &cm.regex);
     else if (strcasecmp ("ExcludeRegex", option->key) == 0)
@@ -221,13 +219,12 @@
 static int ctail_config_add_file (oconfig_item_t *ci)
 {
   cu_tail_match_t *tm;
   cdtime_t interval = 0;
   char *plugin_instance = NULL;
   int num_matches = 0;
-  int i;
 
   if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
     WARNING ("tail plugin: `File' needs exactly one string argument.");
     return (-1);
   }
@@ -237,13 +234,13 @@
   {
     ERROR ("tail plugin: tail_match_create (%s) failed.",
         ci->values[0].value.string);
     return (-1);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
     int status = 0;
 
     if (strcasecmp ("Instance", option->key) == 0)
       status = cf_util_get_string (option, &plugin_instance);
@@ -276,13 +273,13 @@
     return (-1);
   }
   else
   {
     cu_tail_match_t **temp;
 
-    temp = (cu_tail_match_t **) realloc (tail_match_list,
+    temp = realloc (tail_match_list,
         sizeof (cu_tail_match_t *) * (tail_match_list_num + 1));
     if (temp == NULL)
     {
       ERROR ("tail plugin: realloc failed.");
       tail_match_destroy (tm);
       return (-1);
@@ -296,15 +293,13 @@
 
   return (0);
 } /* int ctail_config_add_file */
 
 static int ctail_config (oconfig_item_t *ci)
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("File", option->key) == 0)
       ctail_config_add_file (option);
     else
@@ -329,41 +324,37 @@
 
   return (0);
 } /* int ctail_read */
 
 static int ctail_init (void)
 {
-  struct timespec cb_interval;
   char str[255];
-  user_data_t ud;
-  size_t i;
 
   if (tail_match_list_num == 0)
   {
     WARNING ("tail plugin: File list is empty. Returning an error.");
     return (-1);
   }
 
-  memset(&ud, '\0', sizeof(ud));
-
-  for (i = 0; i < tail_match_list_num; i++)
+  for (size_t i = 0; i < tail_match_list_num; i++)
   {
-    ud.data = (void *)tail_match_list[i];
     ssnprintf(str, sizeof(str), "tail-%zu", i);
-    CDTIME_T_TO_TIMESPEC (tail_match_list_intervals[i], &cb_interval);
-    plugin_register_complex_read (NULL, str, ctail_read, &cb_interval, &ud);
+
+    user_data_t ud = {
+     .data = tail_match_list[i]
+    };
+
+    plugin_register_complex_read (NULL, str, ctail_read, tail_match_list_intervals[i], &ud);
   }
 
   return (0);
 } /* int ctail_init */
 
 static int ctail_shutdown (void)
 {
-  size_t i;
-
-  for (i = 0; i < tail_match_list_num; i++)
+  for (size_t i = 0; i < tail_match_list_num; i++)
   {
     tail_match_destroy (tail_match_list[i]);
     tail_match_list[i] = NULL;
   }
   sfree (tail_match_list);
   tail_match_list_num = 0;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tail_csv.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tail_csv.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tail_csv.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tail_csv.c	2016-09-11 16:10:25.271038709 +0800
@@ -30,29 +31,29 @@
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <stdlib.h>
 #include <string.h>
 
 struct metric_definition_s {
-    char *name;
-    char *type;
-    char *instance;
-    int data_source_type;
-    int value_from;
+    char   *name;
+    char   *type;
+    char   *instance;
+    int     data_source_type;
+    ssize_t value_from;
     struct metric_definition_s *next;
 };
 typedef struct metric_definition_s metric_definition_t;
 
 struct instance_definition_s {
-    char *instance;
-    char *path;
-    cu_tail_t *tail;
+    char                 *instance;
+    char                 *path;
+    cu_tail_t            *tail;
     metric_definition_t **metric_list;
-    size_t metric_list_len;
-    cdtime_t interval;
-    int time_from;
+    size_t                metric_list_len;
+    cdtime_t              interval;
+    ssize_t               time_from;
     struct instance_definition_s *next;
 };
 typedef struct instance_definition_s instance_definition_t;
 
 /* Private */
 static metric_definition_t *metric_head = NULL;
@@ -82,13 +83,13 @@
     return (plugin_dispatch_values(&vl));
 }
 
 static cdtime_t parse_time (char const *tbuf)
 {
     double t;
-    char *endptr = 0;
+    char *endptr = NULL;
 
     errno = 0;
     t = strtod (tbuf, &endptr);
     if ((errno != 0) || (endptr == NULL) || (endptr[0] != 0))
         return (cdtime ());
 
@@ -97,43 +98,43 @@
 
 static int tcsv_read_metric (instance_definition_t *id,
         metric_definition_t *md,
         char **fields, size_t fields_num)
 {
     value_t v;
-    cdtime_t t;
+    cdtime_t t = 0;
     int status;
 
     if (md->data_source_type == -1)
         return (EINVAL);
 
-    if (md->value_from >= fields_num)
-        return (EINVAL);
-
-    if (id->time_from >= 0 && (id->time_from >= fields_num))
+    assert (md->value_from >= 0);
+    if (((size_t) md->value_from) >= fields_num)
         return (EINVAL);
 
-    t = 0;
-    if (id->time_from >= 0)
-        t = parse_time (fields[id->time_from]);
-
     status = parse_value (fields[md->value_from], &v, md->data_source_type);
     if (status != 0)
         return (status);
 
+    if (id->time_from >= 0) {
+        if (((size_t) id->time_from) >= fields_num)
+            return (EINVAL);
+        t = parse_time (fields[id->time_from]);
+    }
+
     return (tcsv_submit (id, md, v, t));
 }
 
-static _Bool tcsv_check_index (int index, size_t fields_num, char const *name)
+static _Bool tcsv_check_index (ssize_t index, size_t fields_num, char const *name)
 {
     if (index < 0)
         return 1;
     else if (((size_t) index) < fields_num)
         return 1;
 
-    ERROR ("tail_csv plugin: Metric \"%s\": Request for index %i when "
+    ERROR ("tail_csv plugin: Metric \"%s\": Request for index %zd when "
             "only %zu fields are available.",
             name, index, fields_num);
     return (0);
 }
 
 static int tcsv_read_buffer (instance_definition_t *id,
@@ -264,42 +265,37 @@
     sfree(md->instance);
     sfree(md);
 
     tcsv_metric_definition_destroy (next);
 }
 
-static int tcsv_config_get_index(oconfig_item_t *ci, int *ret_index) {
-    int index;
-
+static int tcsv_config_get_index(oconfig_item_t *ci, ssize_t *ret_index) {
     if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_NUMBER)){
         WARNING("tail_csv plugin: The \"%s\" config option needs exactly one "
                 "integer argument.", ci->key);
         return (-1);
     }
 
-    index = (int) ci->values[0].value.number;
-    if (index < 0) {
+    if (ci->values[0].value.number < 0) {
         WARNING("tail_csv plugin: The \"%s\" config option must be positive "
                 "(or zero).", ci->key);
         return (-1);
     }
 
-    *ret_index = index;
+    *ret_index = (ssize_t) ci->values[0].value.number;
     return (0);
 }
 
 /* Parse metric  */
 static int tcsv_config_add_metric(oconfig_item_t *ci){
     metric_definition_t *md;
-    int status = 0;
-    int i;
+    int status;
 
-    md = (metric_definition_t *)malloc(sizeof(*md));
+    md = calloc(1, sizeof(*md));
     if (md == NULL)
         return (-1);
-    memset(md, 0, sizeof(*md));
     md->name = NULL;
     md->type = NULL;
     md->instance = NULL;
     md->data_source_type = -1;
     md->value_from = -1;
     md->next = NULL;
@@ -307,13 +303,13 @@
     status = cf_util_get_string (ci, &md->name);
     if (status != 0) {
         sfree (md);
         return (-1);
     }
 
-    for (i = 0; i < ci->children_num; ++i){
+    for (int i = 0; i < ci->children_num; ++i){
         oconfig_item_t *option = ci->children + i;
 
         if (strcasecmp("Type", option->key) == 0)
             status = cf_util_get_string(option, &md->type);
         else if (strcasecmp("Instance", option->key) == 0)
             status = cf_util_get_string(option, &md->instance);
@@ -377,26 +373,25 @@
 }
 
 static int tcsv_config_add_instance_collect(instance_definition_t *id, oconfig_item_t *ci) {
     metric_definition_t *metric;
     metric_definition_t **metric_list;
     size_t metric_list_size;
-    int i;
 
     if (ci->values_num < 1) {
         WARNING("tail_csv plugin: The `Collect' config option needs at least one argument.");
         return (-1);
     }
 
     metric_list_size = id->metric_list_len + (size_t) ci->values_num;
     metric_list = realloc (id->metric_list, sizeof (*id->metric_list) * metric_list_size);
     if (metric_list == NULL)
         return (-1);
     id->metric_list = metric_list;
 
-    for (i = 0; i < ci->values_num; i++) {
+    for (int i = 0; i < ci->values_num; i++) {
         char *metric_name;
 
         if (ci->values[i].type != OCONFIG_TYPE_STRING) {
             WARNING("tail_csv plugin: All arguments to `Collect' must be strings.");
             continue;
         }
@@ -420,23 +415,19 @@
 
 /* <File /> block */
 static int tcsv_config_add_file(oconfig_item_t *ci)
 {
     instance_definition_t* id;
     int status = 0;
-    int i;
 
     /* Registration variables */
     char cb_name[DATA_MAX_NAME_LEN];
-    user_data_t cb_data;
-    struct timespec cb_interval;
 
-    id = malloc(sizeof(*id));
+    id = calloc(1, sizeof(*id));
     if (id == NULL)
         return (-1);
-    memset(id, 0, sizeof(*id));
     id->instance = NULL;
     id->path = NULL;
     id->metric_list = NULL;
     id->time_from = -1;
     id->next = NULL;
 
@@ -446,13 +437,13 @@
         return (status);
     }
 
     /* Use default interval. */
     id->interval = plugin_get_interval();
 
-    for (i = 0; i < ci->children_num; ++i){
+    for (int i = 0; i < ci->children_num; ++i){
         oconfig_item_t *option = ci->children + i;
         status = 0;
 
         if (strcasecmp("Instance", option->key) == 0)
             status = cf_util_get_string(option, &id->instance);
         else if (strcasecmp("Collect", option->key) == 0)
@@ -487,31 +478,32 @@
     if (status != 0){
         tcsv_instance_definition_destroy(id);
         return (-1);
     }
 
     ssnprintf (cb_name, sizeof (cb_name), "tail_csv/%s", id->path);
-    memset(&cb_data, 0, sizeof(cb_data));
-    cb_data.data = id;
-    cb_data.free_func = tcsv_instance_definition_destroy;
-    CDTIME_T_TO_TIMESPEC(id->interval, &cb_interval);
-    status = plugin_register_complex_read(NULL, cb_name, tcsv_read, &cb_interval, &cb_data);
+
+    user_data_t ud = {
+        .data = id,
+        .free_func = tcsv_instance_definition_destroy
+    };
+
+    status = plugin_register_complex_read(NULL, cb_name, tcsv_read, id->interval, &ud);
 
     if (status != 0){
         ERROR("tail_csv plugin: Registering complex read function failed.");
         tcsv_instance_definition_destroy(id);
         return (-1);
     }
 
     return (0);
 }
 
 /* Parse blocks */
 static int tcsv_config(oconfig_item_t *ci){
-    int i;
-    for (i = 0; i < ci->children_num; ++i){
+    for (int i = 0; i < ci->children_num; ++i){
         oconfig_item_t *child = ci->children + i;
         if (strcasecmp("Metric", child->key) == 0)
             tcsv_config_add_metric(child);
         else if (strcasecmp("File", child->key) == 0)
             tcsv_config_add_file(child);
         else
@@ -541,14 +533,14 @@
                     "details.",
                     md->type, md->name);
             continue;
         }
         else if (ds->ds_num != 1)
         {
-            ERROR ("tail_csv plugin: The type \"%s\" has %i data sources. "
-                    "Only types with a single data source are supported.",
+            ERROR ("tail_csv plugin: The type \"%s\" has %zu data sources. "
+                    "Only types with a single data soure are supported.",
                     ds->type, ds->ds_num);
             continue;
         }
 
         md->data_source_type = ds->ds->type;
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tape.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tape.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tape.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tape.c	2016-09-11 16:10:25.271038709 +0800
@@ -95,21 +96,20 @@
 # define KIO_RTIME   rtime
 # define KIO_WTIME   wtime
 #else
 # error "kstat_io_t does not have the required members"
 #endif
 	static kstat_io_t kio;
-	int i;
 
 	if (kc == NULL)
 		return (-1);
 
 	if (numtape <= 0)
 		return (-1);
 
-	for (i = 0; i < numtape; i++)
+	for (int i = 0; i < numtape; i++)
 	{
 		if (kstat_read (kc, ksp[i], &kio) == -1)
 			continue;
 
 		if (strncmp (ksp[i]->ks_class, "tape", 4) == 0)
 		{
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_notification.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_notification.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_notification.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_notification.c	2016-09-11 16:10:25.271038709 +0800
@@ -121,27 +122,25 @@
 } /* }}} int tn_destroy */
 
 static int tn_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   tn_data_t *data;
   int status;
-  int i;
 
-  data = (tn_data_t *) malloc (sizeof (*data));
+  data = calloc (1, sizeof (*data));
   if (data == NULL)
   {
-    ERROR ("tn_create: malloc failed.");
+    ERROR ("tn_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (data, 0, sizeof (*data));
 
   data->message = NULL;
   data->severity = 0;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Message", child->key) == 0)
       status = tn_config_add_string (&data->message, child);
     else if (strcasecmp ("Severity", child->key) == 0)
@@ -190,32 +189,29 @@
 } /* }}} int tn_create */
 
 static int tn_invoke (const data_set_t *ds, value_list_t *vl, /* {{{ */
     notification_meta_t __attribute__((unused)) **meta, void **user_data)
 {
   tn_data_t *data;
-  notification_t n;
+  notification_t n = { 0 };
   char temp[NOTIF_MAX_MSG_LEN];
 
   gauge_t *rates;
   int rates_failed;
 
-  int i;
-
   if ((ds == NULL) || (vl == NULL) || (user_data == NULL))
     return (-EINVAL);
 
   data = *user_data;
   if (data == NULL)
   {
     ERROR ("Target `notification': Invoke: `data' is NULL.");
     return (-EINVAL);
   }
 
   /* Initialize the structure. */
-  memset (&n, 0, sizeof (n));
   n.severity = data->severity;
   n.time = cdtime ();
   sstrncpy (n.message, data->message, sizeof (n.message));
   sstrncpy (n.host, vl->host, sizeof (n.host));
   sstrncpy (n.plugin, vl->plugin, sizeof (n.plugin));
   sstrncpy (n.plugin_instance, vl->plugin_instance,
@@ -233,13 +229,14 @@
   REPLACE_FIELD ("%{plugin_instance}", n.plugin_instance);
   REPLACE_FIELD ("%{type}", n.type);
   REPLACE_FIELD ("%{type_instance}", n.type_instance);
 
   rates_failed = 0;
   rates = NULL;
-  for (i = 0; i < ds->ds_num; i++)
+
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     char template[DATA_MAX_NAME_LEN];
     char value_str[DATA_MAX_NAME_LEN];
 
     ssnprintf (template, sizeof (template), "%%{ds:%s}", ds->ds[i].name);
 
@@ -274,15 +271,14 @@
 
   return (FC_TARGET_CONTINUE);
 } /* }}} int tn_invoke */
 
 void module_register (void)
 {
-	target_proc_t tproc;
+	target_proc_t tproc = { 0 };
 
-	memset (&tproc, 0, sizeof (tproc));
 	tproc.create  = tn_create;
 	tproc.destroy = tn_destroy;
 	tproc.invoke  = tn_invoke;
 	fc_register_target ("notification", tproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_replace.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_replace.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_replace.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_replace.c	2016-09-11 16:10:25.271038709 +0800
@@ -58,13 +59,13 @@
   char *dest;
 
   if (orig == NULL)
     return (NULL);
 
   sz = strlen (orig) + 1;
-  dest = (char *) malloc (sz);
+  dest = malloc (sz);
   if (dest == NULL)
     return (NULL);
 
   memcpy (dest, orig, sz);
 
   return (dest);
@@ -99,19 +100,18 @@
   {
     ERROR ("Target `replace': The `%s' option requires exactly two string "
         "arguments.", ci->key);
     return (-1);
   }
 
-  act = (tr_action_t *) malloc (sizeof (*act));
+  act = calloc (1, sizeof (*act));
   if (act == NULL)
   {
-    ERROR ("tr_config_add_action: malloc failed.");
+    ERROR ("tr_config_add_action: calloc failed.");
     return (-ENOMEM);
   }
-  memset (act, 0, sizeof (*act));
 
   act->replacement = NULL;
   act->may_be_empty = may_be_empty;
 
   status = regcomp (&act->re, ci->values[0].value.string, REG_EXTENDED);
   if (status != 0)
@@ -153,26 +153,24 @@
   return (0);
 } /* }}} int tr_config_add_action */
 
 static int tr_action_invoke (tr_action_t *act_head, /* {{{ */
     char *buffer_in, size_t buffer_in_size, int may_be_empty)
 {
-  tr_action_t *act;
   int status;
   char buffer[DATA_MAX_NAME_LEN];
-  regmatch_t matches[8];
+  regmatch_t matches[8] = { [0] = { 0 } };
 
   if (act_head == NULL)
     return (-EINVAL);
 
   sstrncpy (buffer, buffer_in, sizeof (buffer));
-  memset (matches, 0, sizeof (matches));
 
   DEBUG ("target_replace plugin: tr_action_invoke: <- buffer = %s;", buffer);
 
-  for (act = act_head; act != NULL; act = act->next)
+  for (tr_action_t *act = act_head; act != NULL; act = act->next)
   {
     char temp[DATA_MAX_NAME_LEN];
     char *subst_status;
 
     status = regexec (&act->re, buffer,
         STATIC_ARRAY_SIZE (matches), matches,
@@ -187,13 +185,13 @@
       ERROR ("Target `replace': Executing a regular expression failed: %s.",
           errbuf);
       continue;
     }
 
     subst_status = subst (temp, sizeof (temp), buffer,
-        matches[0].rm_so, matches[0].rm_eo, act->replacement);
+        (size_t) matches[0].rm_so, (size_t) matches[0].rm_eo, act->replacement);
     if (subst_status == NULL)
     {
       ERROR ("Target `replace': subst (buffer = %s, start = %zu, end = %zu, "
           "replacement = %s) failed.",
           buffer, (size_t) matches[0].rm_so, (size_t) matches[0].rm_eo,
           act->replacement);
@@ -239,30 +237,28 @@
 } /* }}} int tr_destroy */
 
 static int tr_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   tr_data_t *data;
   int status;
-  int i;
 
-  data = (tr_data_t *) malloc (sizeof (*data));
+  data = calloc (1, sizeof (*data));
   if (data == NULL)
   {
-    ERROR ("tr_create: malloc failed.");
+    ERROR ("tr_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (data, 0, sizeof (*data));
 
   data->host = NULL;
   data->plugin = NULL;
   data->plugin_instance = NULL;
   /* data->type = NULL; */
   data->type_instance = NULL;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if ((strcasecmp ("Host", child->key) == 0)
         || (strcasecmp ("Hostname", child->key) == 0))
       status = tr_config_add_action (&data->host, child,
@@ -345,15 +341,14 @@
 
   return (FC_TARGET_CONTINUE);
 } /* }}} int tr_invoke */
 
 void module_register (void)
 {
-	target_proc_t tproc;
+	target_proc_t tproc = { 0 };
 
-	memset (&tproc, 0, sizeof (tproc));
 	tproc.create  = tr_create;
 	tproc.destroy = tr_destroy;
 	tproc.invoke  = tr_invoke;
 	fc_register_target ("replace", tproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_scale.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_scale.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_scale.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_scale.c	2016-09-11 16:10:25.271038709 +0800
@@ -86,40 +87,29 @@
 	status = uc_meta_data_get_double (vl, key_int_fraction, &int_fraction);
 	if (status != 0)
 		failure++;
 
 	if (failure == 0)
 	{
-		uint64_t difference;
+		uint64_t diff;
 		double rate;
 
-		/* Calcualte the rate */
-		if (prev_counter > curr_counter) /* => counter overflow */
-		{
-			if (prev_counter <= 4294967295UL) /* 32 bit overflow */
-				difference = (4294967295UL - prev_counter) + curr_counter;
-			else /* 64 bit overflow */
-				difference = (18446744073709551615ULL - prev_counter) + curr_counter;
-		}
-		else /* no overflow */
-		{
-			difference = curr_counter - prev_counter;
-		}
-		rate = ((double) difference) / CDTIME_T_TO_DOUBLE (vl->interval);
+		diff = (uint64_t) counter_diff (prev_counter, curr_counter);
+		rate = ((double) diff) / CDTIME_T_TO_DOUBLE (vl->interval);
 
 		/* Modify the rate. */
 		if (!isnan (data->factor))
 			rate *= data->factor;
 		if (!isnan (data->offset))
 			rate += data->offset;
 
 		/* Calculate the internal counter. */
 		int_fraction += (rate * CDTIME_T_TO_DOUBLE (vl->interval));
-		difference = (uint64_t) int_fraction;
-		int_fraction -= ((double) difference);
-		int_counter  += difference;
+		diff = (uint64_t) int_fraction;
+		int_fraction -= ((double) diff);
+		int_counter  += diff;
 
 		assert (int_fraction >= 0.0);
 		assert (int_fraction <  1.0);
 
 		DEBUG ("Target `scale': ts_invoke_counter: %"PRIu64" -> %g -> %"PRIu64
 				"(+%g)",
@@ -310,24 +300,23 @@
 
 static int ts_config_add_data_source(ts_data_t *data, /* {{{ */
 		oconfig_item_t *ci)
 {
 	size_t new_data_sources_num;
 	char **temp;
-	int i;
 
 	/* Check number of arbuments. */
 	if (ci->values_num < 1)
 	{
 		ERROR ("`value' match: `%s' needs at least one argument.",
 				ci->key);
 		return (-1);
 	}
 
 	/* Check type of arguments */
-	for (i = 0; i < ci->values_num; i++)
+	for (int i = 0; i < ci->values_num; i++)
 	{
 		if (ci->values[i].type == OCONFIG_TYPE_STRING)
 			continue;
 
 		ERROR ("`value' match: `%s' accepts only string arguments "
 				"(argument %i is a %s).",
@@ -336,23 +325,23 @@
 				? "truth value" : "number");
 		return (-1);
 	}
 
 	/* Allocate space for the char pointers */
 	new_data_sources_num = data->data_sources_num + ((size_t) ci->values_num);
-	temp = (char **) realloc (data->data_sources,
+	temp = realloc (data->data_sources,
 			new_data_sources_num * sizeof (char *));
 	if (temp == NULL)
 	{
 		ERROR ("`value' match: realloc failed.");
 		return (-1);
 	}
 	data->data_sources = temp;
 
 	/* Copy the strings, allocating memory as needed.  */
-	for (i = 0; i < ci->values_num; i++)
+	for (int i = 0; i < ci->values_num; i++)
 	{
 		size_t j;
 
 		/* If we get here, there better be memory for us to write to.  */
 		assert (data->data_sources_num < new_data_sources_num);
 
@@ -377,14 +366,13 @@
 		return (-EINVAL);
 
 	data = (ts_data_t *) *user_data;
 
 	if ((data != NULL) && (data->data_sources != NULL))
 	{
-		size_t i;
-		for (i = 0; i < data->data_sources_num; i++)
+		for (size_t i = 0; i < data->data_sources_num; i++)
 			sfree (data->data_sources[i]);
 		sfree (data->data_sources);
 	}
 
 	sfree (data);
 	*user_data = NULL;
@@ -393,27 +381,25 @@
 } /* }}} int ts_destroy */
 
 static int ts_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
 	ts_data_t *data;
 	int status;
-	int i;
 
-	data = (ts_data_t *) malloc (sizeof (*data));
+	data = calloc (1, sizeof (*data));
 	if (data == NULL)
 	{
-		ERROR ("ts_create: malloc failed.");
+		ERROR ("ts_create: calloc failed.");
 		return (-ENOMEM);
 	}
-	memset (data, 0, sizeof (*data));
 
 	data->factor = NAN;
 	data->offset = NAN;
 
 	status = 0;
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Factor", child->key) == 0)
 				status = ts_config_set_double (&data->factor, child);
 		else if (strcasecmp ("Offset", child->key) == 0)
@@ -455,25 +441,24 @@
 } /* }}} int ts_create */
 
 static int ts_invoke (const data_set_t *ds, value_list_t *vl, /* {{{ */
 		notification_meta_t __attribute__((unused)) **meta, void **user_data)
 {
 	ts_data_t *data;
-	int i;
 
 	if ((ds == NULL) || (vl == NULL) || (user_data == NULL))
 		return (-EINVAL);
 
 	data = *user_data;
 	if (data == NULL)
 	{
 		ERROR ("Target `scale': Invoke: `data' is NULL.");
 		return (-EINVAL);
 	}
 
-	for (i = 0; i < ds->ds_num; i++)
+	for (size_t i = 0; i < ds->ds_num; i++)
 	{
 		/* If we've got a list of data sources, is it in the list? */
 		if (data->data_sources) {
 			size_t j;
 			for (j = 0; j < data->data_sources_num; j++)
 				if (strcasecmp(ds->ds[i].name, data->data_sources[j]) == 0)
@@ -499,15 +484,14 @@
 
 	return (FC_TARGET_CONTINUE);
 } /* }}} int ts_invoke */
 
 void module_register (void)
 {
-	target_proc_t tproc;
+	target_proc_t tproc = { 0 };
 
-	memset (&tproc, 0, sizeof (tproc));
 	tproc.create  = ts_create;
 	tproc.destroy = ts_destroy;
 	tproc.invoke  = ts_invoke;
 	fc_register_target ("scale", tproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_set.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_set.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_set.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_set.c	2016-09-11 16:10:25.271038709 +0800
@@ -32,15 +33,33 @@
 {
   char *host;
   char *plugin;
   char *plugin_instance;
   /* char *type; */
   char *type_instance;
+  meta_data_t *meta;
 };
 typedef struct ts_data_s ts_data_t;
 
+static int ts_util_get_key_and_string_wo_strdup (const oconfig_item_t *ci, char **ret_key, char **ret_string) /* {{{ */
+{
+  if ((ci->values_num != 2)
+      || (ci->values[0].type != OCONFIG_TYPE_STRING)
+      || (ci->values[1].type != OCONFIG_TYPE_STRING))
+  {
+    ERROR ("ts_util_get_key_and_string_wo_strdup: The %s option requires "
+        "exactly two string argument.", ci->key);
+    return (-1);
+  }
+
+  *ret_key = ci->values[0].value.string;
+  *ret_string = ci->values[1].value.string;
+
+  return (0);
+} /* }}} int ts_util_get_key_and_string_wo_strdup */
+
 static int ts_config_add_string (char **dest, /* {{{ */
     const oconfig_item_t *ci, int may_be_empty)
 {
   char *tmp = NULL;
   int status;
 
@@ -57,12 +76,50 @@
   }
 
   *dest = tmp;
   return (0);
 } /* }}} int ts_config_add_string */
 
+static int ts_config_add_meta (meta_data_t **dest, /* {{{ */
+    const oconfig_item_t *ci, int may_be_empty)
+{
+  char *key = NULL;
+  char *string = NULL;
+  int status;
+
+  status = ts_util_get_key_and_string_wo_strdup (ci, &key, &string);
+  if (status != 0)
+    return (status);
+
+  if (strlen (key) == 0)
+  {
+    ERROR ("Target `set': The `%s' option does not accept empty string as first argument.",
+        ci->key);
+    return (-1);
+  }
+
+  if (!may_be_empty && (strlen (string) == 0))
+  {
+    ERROR ("Target `set': The `%s' option does not accept empty string as second argument.",
+        ci->key);
+    return (-1);
+  }
+
+  if ((*dest) == NULL)
+  {
+    // Create a new meta_data_t
+    if ((*dest = meta_data_create()) == NULL)
+    {
+      ERROR ("Target `set': failed to create a meta data for `%s'.", ci->key);
+      return (-1);
+    }
+  }
+
+  return (meta_data_add_string (*dest, key, string));
+} /* }}} int ts_config_add_meta */
+
 static int ts_destroy (void **user_data) /* {{{ */
 {
   ts_data_t *data;
 
   if (user_data == NULL)
     return (-EINVAL);
@@ -73,39 +130,39 @@
 
   free (data->host);
   free (data->plugin);
   free (data->plugin_instance);
   /* free (data->type); */
   free (data->type_instance);
+  meta_data_destroy(data->meta);
   free (data);
 
   return (0);
 } /* }}} int ts_destroy */
 
 static int ts_create (const oconfig_item_t *ci, void **user_data) /* {{{ */
 {
   ts_data_t *data;
   int status;
-  int i;
 
-  data = (ts_data_t *) malloc (sizeof (*data));
+  data = calloc (1, sizeof (*data));
   if (data == NULL)
   {
-    ERROR ("ts_create: malloc failed.");
+    ERROR ("ts_create: calloc failed.");
     return (-ENOMEM);
   }
-  memset (data, 0, sizeof (*data));
 
   data->host = NULL;
   data->plugin = NULL;
   data->plugin_instance = NULL;
   /* data->type = NULL; */
   data->type_instance = NULL;
+  data->meta = NULL;
 
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if ((strcasecmp ("Host", child->key) == 0)
         || (strcasecmp ("Hostname", child->key) == 0))
       status = ts_config_add_string (&data->host, child,
@@ -121,12 +178,15 @@
       status = ts_config_add_string (&data->type, child,
           /* may be empty = */ 0);
 #endif
     else if (strcasecmp ("TypeInstance", child->key) == 0)
       status = ts_config_add_string (&data->type_instance, child,
           /* may be empty = */ 1);
+    else if (strcasecmp ("MetaData", child->key) == 0)
+      status = ts_config_add_meta (&data->meta, child,
+          /* may be empty = */ 1);
     else
     {
       ERROR ("Target `set': The `%s' configuration option is not understood "
           "and will be ignored.", child->key);
       status = 0;
     }
@@ -139,16 +199,17 @@
   while (status == 0)
   {
     if ((data->host == NULL)
         && (data->plugin == NULL)
         && (data->plugin_instance == NULL)
         /* && (data->type == NULL) */
-        && (data->type_instance == NULL))
+        && (data->type_instance == NULL)
+        && (data->meta == NULL))
     {
       ERROR ("Target `set': You need to set at least one of `Host', "
-          "`Plugin', `PluginInstance' or `TypeInstance'.");
+          "`Plugin', `PluginInstance', `TypeInstance', `MetaData'.");
       status = -1;
     }
 
     break;
   }
 
@@ -174,27 +235,31 @@
   if (data == NULL)
   {
     ERROR ("Target `set': Invoke: `data' is NULL.");
     return (-EINVAL);
   }
 
+  if (data->meta != NULL)
+  {
+    meta_data_clone_merge(&(vl->meta), data->meta);
+  }
+
 #define SET_FIELD(f) if (data->f != NULL) { sstrncpy (vl->f, data->f, sizeof (vl->f)); }
   SET_FIELD (host);
   SET_FIELD (plugin);
   SET_FIELD (plugin_instance);
   /* SET_FIELD (type); */
   SET_FIELD (type_instance);
 
   return (FC_TARGET_CONTINUE);
 } /* }}} int ts_invoke */
 
 void module_register (void)
 {
-	target_proc_t tproc;
+	target_proc_t tproc = { 0 };
 
-	memset (&tproc, 0, sizeof (tproc));
 	tproc.create  = ts_create;
 	tproc.destroy = ts_destroy;
 	tproc.invoke  = ts_invoke;
 	fc_register_target ("set", tproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_v5upgrade.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_v5upgrade.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/target_v5upgrade.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/target_v5upgrade.c	2016-09-11 16:10:25.271038709 +0800
@@ -460,15 +461,14 @@
 
   return (FC_TARGET_CONTINUE);
 } /* }}} int v5_invoke */
 
 void module_register (void)
 {
-	target_proc_t tproc;
+	target_proc_t tproc = { 0 };
 
-	memset (&tproc, 0, sizeof (tproc));
 	tproc.create  = v5_create;
 	tproc.destroy = v5_destroy;
 	tproc.invoke  = v5_invoke;
 	fc_register_target ("v5upgrade", tproc);
 } /* module_register */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tcpconns.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tcpconns.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tcpconns.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tcpconns.c	2016-09-11 16:10:25.275038704 +0800
@@ -68,34 +69,28 @@
 #if !KERNEL_LINUX && !HAVE_SYSCTLBYNAME && !HAVE_LIBKVM_NLIST && !KERNEL_AIX
 # error "No applicable input method."
 #endif
 
 #if KERNEL_LINUX
 # include <asm/types.h>
-/* sys/socket.h is necessary to compile when using netlink on older systems. */
-# include <sys/socket.h>
 # include <linux/netlink.h>
 #if HAVE_LINUX_INET_DIAG_H
 # include <linux/inet_diag.h>
 #endif
-# include <sys/socket.h>
 # include <arpa/inet.h>
 /* #endif KERNEL_LINUX */
 
 #elif HAVE_SYSCTLBYNAME
 # include <sys/socketvar.h>
 # include <sys/sysctl.h>
 
 /* Some includes needed for compiling on FreeBSD */
 #include <sys/time.h>
 #if HAVE_SYS_TYPES_H
 # include <sys/types.h>
 #endif
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
 #if HAVE_NET_IF_H
 # include <net/if.h>
 #endif
 
 # include <net/route.h>
 # include <netinet/in.h>
@@ -110,13 +105,12 @@
 # include <netinet/tcp_var.h>
 /* #endif HAVE_SYSCTLBYNAME */
 
 /* This is for OpenBSD and NetBSD. */
 #elif HAVE_LIBKVM_NLIST
 # include <sys/queue.h>
-# include <sys/socket.h>
 # include <net/route.h>
 # include <netinet/in.h>
 # include <netinet/in_systm.h>
 # include <netinet/ip.h>
 # include <netinet/ip_var.h>
 # include <netinet/in_pcb.h>
@@ -287,13 +281,13 @@
 /* This depends on linux inet_diag_req because if this structure is missing,
  * sequence_number is useless and we get a compilation warning.
  */
 static uint32_t sequence_number = 0;
 #endif
 
-enum
+static enum
 {
   SRC_DUNNO,
   SRC_NETLINK,
   SRC_PROC
 } linux_source = SRC_DUNNO;
 #endif
@@ -308,23 +302,22 @@
 }
 
 static void conn_submit_port_entry (port_entry_t *pe)
 {
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
-  int i;
 
   conn_prepare_vl (&vl, values);
 
   if (((port_collect_listening != 0) && (pe->flags & PORT_IS_LISTENING))
       || (pe->flags & PORT_COLLECT_LOCAL))
   {
     ssnprintf (vl.plugin_instance, sizeof (vl.plugin_instance),
 	"%"PRIu16"-local", pe->port);
 
-    for (i = 1; i <= TCP_STATE_MAX; i++)
+    for (int i = 1; i <= TCP_STATE_MAX; i++)
     {
       vl.values[0].gauge = pe->count_local[i];
 
       sstrncpy (vl.type_instance, tcp_state[i], sizeof (vl.type_instance));
 
       plugin_dispatch_values (&vl);
@@ -333,13 +326,13 @@
 
   if (pe->flags & PORT_COLLECT_REMOTE)
   {
     ssnprintf (vl.plugin_instance, sizeof (vl.plugin_instance),
 	"%"PRIu16"-remote", pe->port);
 
-    for (i = 1; i <= TCP_STATE_MAX; i++)
+    for (int i = 1; i <= TCP_STATE_MAX; i++)
     {
       vl.values[0].gauge = pe->count_remote[i];
 
       sstrncpy (vl.type_instance, tcp_state[i], sizeof (vl.type_instance));
 
       plugin_dispatch_values (&vl);
@@ -348,36 +341,33 @@
 } /* void conn_submit */
 
 static void conn_submit_port_total (void)
 {
   value_t values[1];
   value_list_t vl = VALUE_LIST_INIT;
-  int i;
 
   conn_prepare_vl (&vl, values);
 
   sstrncpy (vl.plugin_instance, "all", sizeof (vl.plugin_instance));
 
-  for (i = 1; i <= TCP_STATE_MAX; i++)
+  for (int i = 1; i <= TCP_STATE_MAX; i++)
   {
     vl.values[0].gauge = count_total[i];
 
     sstrncpy (vl.type_instance, tcp_state[i], sizeof (vl.type_instance));
 
     plugin_dispatch_values (&vl);
   }
 }
 
 static void conn_submit_all (void)
 {
-  port_entry_t *pe;
-
   if (port_collect_total)
     conn_submit_port_total ();
 
-  for (pe = port_list_head; pe != NULL; pe = pe->next)
+  for (port_entry_t *pe = port_list_head; pe != NULL; pe = pe->next)
     conn_submit_port_entry (pe);
 } /* void conn_submit_all */
 
 static port_entry_t *conn_get_port_entry (uint16_t port, int create)
 {
   port_entry_t *ret;
@@ -389,16 +379,15 @@
       break;
     ret = ret->next;
   }
 
   if ((ret == NULL) && (create != 0))
   {
-    ret = (port_entry_t *) malloc (sizeof (port_entry_t));
+    ret = calloc (1, sizeof (*ret));
     if (ret == NULL)
       return (NULL);
-    memset (ret, '\0', sizeof (port_entry_t));
 
     ret->port = port;
     ret->next = port_list_head;
     port_list_head = ret;
   }
 
@@ -490,16 +479,12 @@
 /* Returns zero on success, less than zero on socket error and greater than
  * zero on other errors. */
 static int conn_read_netlink (void)
 {
 #if HAVE_STRUCT_LINUX_INET_DIAG_REQ
   int fd;
-  struct sockaddr_nl nladdr;
-  struct nlreq req;
-  struct msghdr msg;
-  struct iovec iov;
   struct inet_diag_msg *r;
   char buf[8192];
 
   /* If this fails, it's likely a permission problem. We'll fall back to
    * reading this information from files below. */
   fd = socket(AF_NETLINK, SOCK_RAW, NETLINK_INET_DIAG);
@@ -508,40 +493,44 @@
     ERROR ("tcpconns plugin: conn_read_netlink: socket(AF_NETLINK, SOCK_RAW, "
 	"NETLINK_INET_DIAG) failed: %s",
 	sstrerror (errno, buf, sizeof (buf)));
     return (-1);
   }
 
-  memset(&nladdr, 0, sizeof(nladdr));
-  nladdr.nl_family = AF_NETLINK;
+  struct sockaddr_nl nladdr = {
+    .nl_family = AF_NETLINK
+  };
 
-  memset(&req, 0, sizeof(req));
-  req.nlh.nlmsg_len = sizeof(req);
-  req.nlh.nlmsg_type = TCPDIAG_GETSOCK;
-  /* NLM_F_ROOT: return the complete table instead of a single entry.
-   * NLM_F_MATCH: return all entries matching criteria (not implemented)
-   * NLM_F_REQUEST: must be set on all request messages */
-  req.nlh.nlmsg_flags = NLM_F_ROOT | NLM_F_MATCH | NLM_F_REQUEST;
-  req.nlh.nlmsg_pid = 0;
-  /* The sequence_number is used to track our messages. Since netlink is not
-   * reliable, we don't want to end up with a corrupt or incomplete old
-   * message in case the system is/was out of memory. */
-  req.nlh.nlmsg_seq = ++sequence_number;
-  req.r.idiag_family = AF_INET;
-  req.r.idiag_states = 0xfff;
-  req.r.idiag_ext = 0;
-
-  memset(&iov, 0, sizeof(iov));
-  iov.iov_base = &req;
-  iov.iov_len = sizeof(req);
-
-  memset(&msg, 0, sizeof(msg));
-  msg.msg_name = (void*)&nladdr;
-  msg.msg_namelen = sizeof(nladdr);
-  msg.msg_iov = &iov;
-  msg.msg_iovlen = 1;
+  struct nlreq req = {
+    .nlh.nlmsg_len = sizeof(req),
+    .nlh.nlmsg_type = TCPDIAG_GETSOCK,
+    /* NLM_F_ROOT: return the complete table instead of a single entry.
+     * NLM_F_MATCH: return all entries matching criteria (not implemented)
+     * NLM_F_REQUEST: must be set on all request messages */
+    .nlh.nlmsg_flags = NLM_F_ROOT | NLM_F_MATCH | NLM_F_REQUEST,
+    .nlh.nlmsg_pid = 0,
+    /* The sequence_number is used to track our messages. Since netlink is not
+     * reliable, we don't want to end up with a corrupt or incomplete old
+     * message in case the system is/was out of memory. */
+    .nlh.nlmsg_seq = ++sequence_number,
+    .r.idiag_family = AF_INET,
+    .r.idiag_states = 0xfff,
+    .r.idiag_ext = 0
+  };
+
+  struct iovec iov = {
+    .iov_base = &req,
+    .iov_len = sizeof(req)
+  };
+
+  struct msghdr msg = {
+    .msg_name = (void*)&nladdr,
+    .msg_namelen = sizeof(nladdr),
+    .msg_iov = &iov,
+    .msg_iovlen = 1
+  };
 
   if (sendmsg (fd, &msg, 0) < 0)
   {
     ERROR ("tcpconns plugin: conn_read_netlink: sendmsg(2) failed: %s",
 	sstrerror (errno, buf, sizeof (buf)));
     close (fd);
@@ -836,13 +825,13 @@
   if (status < 0)
   {
     ERROR ("tcpconns plugin: sysctlbyname failed.");
     return (-1);
   }
 
-  buffer = (char *) malloc (buffer_len);
+  buffer = malloc (buffer_len);
   if (buffer == NULL)
   {
     ERROR ("tcpconns plugin: malloc failed.");
     return (-1);
   }
 
@@ -1021,13 +1010,12 @@
 
 #elif KERNEL_AIX
 
 static int conn_read (void)
 {
   int size;
-  int i;
   int nconn;
   void *data;
   struct netinfo_header *header;
   struct netinfo_conn *conn;
 
   conn_reset_port_entry ();
@@ -1063,13 +1051,13 @@
   }
 
   header = (struct netinfo_header *)data;
   nconn = header->size;
   conn = (struct netinfo_conn *)(data + sizeof(struct netinfo_header));
 
-  for (i=0; i < nconn; conn++, i++)
+  for (int i = 0; i < nconn; conn++, i++)
   {
     conn_handle_ports (conn->srcport, conn->dstport, conn->tcp_state);
   }
 
   free(data);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/teamspeak2.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/teamspeak2.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/teamspeak2.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/teamspeak2.c	2016-09-11 16:10:25.275038704 +0800
@@ -25,13 +26,12 @@
 #include "common.h"
 #include "plugin.h"
 
 #include <netinet/in.h>
 #include <arpa/inet.h>
 #include <sys/types.h>
-#include <sys/socket.h>
 #include <netdb.h>
 
 /*
  * Defines
  */
 /* Default host and port */
@@ -81,19 +81,18 @@
 		ERROR ("teamspeak2 plugin: VServer port is invalid: %i",
 				vserver_port);
 		return (-1);
 	}
 
 	/* Allocate memory */
-	entry = (vserver_list_t *) malloc (sizeof (vserver_list_t));
+	entry = calloc (1, sizeof (*entry));
 	if (entry == NULL)
 	{
-		ERROR ("teamspeak2 plugin: malloc failed.");
+		ERROR ("teamspeak2 plugin: calloc failed.");
 		return (-1);
 	}
-	memset (entry, 0, sizeof (vserver_list_t));
 
 	/* Save data */
 	entry->port = vserver_port;
 
 	/* Insert to list */
 	if(server_list == NULL) {
@@ -138,13 +137,13 @@
 
 	sstrncpy (vl.type, type, sizeof (vl.type));
 
 	if (type_instance != NULL)
 		sstrncpy (vl.type_instance, type_instance,
 				sizeof (vl.type_instance));
-	
+
 	plugin_dispatch_values (&vl);
 } /* void tss2_submit_gauge */
 
 static void tss2_submit_io (const char *plugin_instance, const char *type,
 		derive_t rx, derive_t tx)
 {
@@ -197,15 +196,13 @@
 static int tss2_get_socket (FILE **ret_read_fh, FILE **ret_write_fh)
 {
 	/*
 	 * Returns connected file objects or establishes the connection
 	 * if it's not already present
 	 */
-	struct addrinfo ai_hints;
 	struct addrinfo *ai_head;
-	struct addrinfo *ai_ptr;
 	int sd = -1;
 	int status;
 
 	/* Check if we already got opened connections */
 	if ((global_read_fh != NULL) && (global_write_fh != NULL))
 	{
@@ -215,18 +212,17 @@
 		if (ret_write_fh != NULL)
 			*ret_write_fh = global_write_fh;
 		return (0);
 	}
 
 	/* Get all addrs for this hostname */
-	memset (&ai_hints, 0, sizeof (ai_hints));
-#ifdef AI_ADDRCONFIG
-	ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-	ai_hints.ai_family = AF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_STREAM;
+	struct addrinfo ai_hints = {
+		.ai_family = AF_UNSPEC,
+		.ai_flags = AI_ADDRCONFIG,
+		.ai_socktype = SOCK_STREAM
+	};
 
 	status = getaddrinfo ((config_host != NULL) ? config_host : DEFAULT_HOST,
 			(config_port != NULL) ? config_port : DEFAULT_PORT,
 			&ai_hints,
 			&ai_head);
 	if (status != 0)
@@ -234,13 +230,13 @@
 		ERROR ("teamspeak2 plugin: getaddrinfo failed: %s",
 				gai_strerror (status));
 		return (-1);
 	}
 
 	/* Try all given hosts until we can connect to one */
-	for (ai_ptr = ai_head; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+	for (struct addrinfo *ai_ptr = ai_head; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
 	{
 		/* Create socket */
 		sd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype,
 				ai_ptr->ai_protocol);
 		if (sd < 0)
 		{
@@ -350,13 +346,13 @@
 static int tss2_receive_line (FILE *fh, char *buffer, int buffer_size)
 {
 	/*
 	 * Receive a single line from the given file object
 	 */
 	char *temp;
-	 
+
 	/*
 	 * fgets is blocking but much easier then doing anything else
 	 * TODO: Non-blocking Version would be safer
 	 */
 	temp = fgets (buffer, buffer_size, fh);
 	if (temp == NULL)
@@ -433,24 +429,24 @@
 
 	while (42)
 	{
 		char buffer[4096];
 		char *value;
 		char *endptr = NULL;
-		
+
 		status = tss2_receive_line (read_fh, buffer, sizeof (buffer));
 		if (status != 0)
 		{
 			/* Set to NULL just to make sure no one uses these FHs anymore. */
 			read_fh = NULL;
 			write_fh = NULL;
 			ERROR ("teamspeak2 plugin: tss2_receive_line failed.");
 			return (-1);
 		}
 		buffer[sizeof (buffer) - 1] = 0;
-		
+
 		if (strncmp ("average_packet_loss=", buffer,
 					strlen ("average_packet_loss=")) == 0)
 		{
 			/* Got average packet loss, now interpret it */
 			value = &buffer[20];
 			/* Replace , with . */
@@ -460,15 +456,15 @@
 				{
 					*value = '.';
 					break;
 				}
 				value++;
 			}
-			
+
 			value = &buffer[20];
-			
+
 			packet_loss = strtod (value, &endptr);
 			if (value == endptr)
 			{
 				/* Failed */
 				WARNING ("teamspeak2 plugin: Could not read average package "
 						"loss from string: %s", buffer);
@@ -487,13 +483,13 @@
 		else
 		{
 			WARNING ("teamspeak2 plugin: Server returned unexpected string: %s",
 					buffer);
 		}
 	}
-	
+
 	*ret_value = packet_loss;
 	return (0);
 } /* int tss2_vserver_gapl */
 
 static int tss2_read_vserver (vserver_list_t *vserver)
 {
@@ -510,13 +506,13 @@
 	derive_t tx_octets = 0;
 	derive_t rx_packets = 0;
 	derive_t tx_packets = 0;
 	gauge_t packet_loss = NAN;
 	int valid = 0;
 
-	char plugin_instance[DATA_MAX_NAME_LEN];
+	char plugin_instance[DATA_MAX_NAME_LEN] = { 0 };
 
 	FILE *read_fh;
 	FILE *write_fh;
 
 	/* Get the send/receive sockets */
 	status = tss2_get_socket (&read_fh, &write_fh);
@@ -526,14 +522,12 @@
 		return (-1);
 	}
 
 	if (vserver == NULL)
 	{
 		/* Request global information */
-		memset (plugin_instance, 0, sizeof (plugin_instance));
-
 		status = tss2_send_request (write_fh, "gi\r\n");
 	}
 	else
 	{
 		/* Request server information */
 		ssnprintf (plugin_instance, sizeof (plugin_instance), "vserver%i",
@@ -557,13 +551,13 @@
 	while (42)
 	{
 		char buffer[4096];
 		char *key;
 		char *value;
 		char *endptr = NULL;
-		
+
 		/* Read one line of the server's answer */
 		status = tss2_receive_line (read_fh, buffer, sizeof (buffer));
 		if (status != 0)
 		{
 			/* Set to NULL just to make sure no one uses these FHs anymore. */
 			read_fh = NULL;
@@ -722,13 +716,13 @@
 
 static int tss2_config (const char *key, const char *value)
 {
 	/*
 	 * Interpret configuration values
 	 */
-    if (strcasecmp ("Host", key) == 0)
+	if (strcasecmp ("Host", key) == 0)
 	{
 		char *temp;
 
 		temp = strdup (value);
 		if (temp == NULL)
 		{
@@ -752,13 +746,13 @@
 		config_port = temp;
 	}
 	else if (strcasecmp ("Server", key) == 0)
 	{
 		/* Server variable found */
 		int status;
-		
+
 		status = tss2_add_vserver (atoi (value));
 		if (status != 0)
 			return (1);
 	}
 	else
 	{
@@ -772,13 +766,12 @@
 static int tss2_read (void)
 {
 	/*
 	 * Poll function which collects global and vserver information
 	 * and submits it to collectd
 	 */
-	vserver_list_t *vserver;
 	int success = 0;
 	int status;
 
 	/* Handle global server variables */
 	status = tss2_read_vserver (NULL);
 	if (status == 0)
@@ -788,13 +781,13 @@
 	else
 	{
 		WARNING ("teamspeak2 plugin: Reading global server variables failed.");
 	}
 
 	/* Handle vservers */
-	for (vserver = server_list; vserver != NULL; vserver = vserver->next)
+	for (vserver_list_t *vserver = server_list; vserver != NULL; vserver = vserver->next)
 	{
 		status = tss2_read_vserver (vserver);
 		if (status == 0)
 		{
 			success++;
 		}
@@ -802,16 +795,16 @@
 		{
 			WARNING ("teamspeak2 plugin: Reading statistics "
 					"for vserver %i failed.", vserver->port);
 			continue;
 		}
 	}
-	
+
 	if (success == 0)
 		return (-1);
-    return (0);
+	return (0);
 } /* int tss2_read */
 
 static int tss2_shutdown(void)
 {
 	/*
 	 * Shutdown handler
@@ -831,13 +824,13 @@
 		entry = next;
 	}
 
 	/* Get rid of the configuration */
 	sfree (config_host);
 	sfree (config_port);
-	
+
     return (0);
 } /* int tss2_shutdown */
 
 void module_register(void)
 {
 	/*
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ted.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ted.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/ted.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/ted.c	2016-09-11 16:10:25.275038704 +0800
@@ -32,15 +32,15 @@
  * firmware version 9.01U. The USB port is uses the very common FTDI
  * USB-to-serial chip, so the RDU will show up as a serial device on
  * Windows, Mac OS, or Linux.
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #if HAVE_TERMIOS_H && HAVE_SYS_IOCTL_H && HAVE_MATH_H
 # include <termios.h>
 # include <sys/ioctl.h>
 # include <math.h>
 #else
@@ -67,34 +67,33 @@
 static int config_keys_num = STATIC_ARRAY_SIZE (config_keys);
 
 static int ted_read_value(double *ret_power, double *ret_voltage)
 {
     unsigned char receive_buffer[300];
     unsigned char package_buffer[300];
-    char pkt_request[1] = {0xAA};
+    unsigned char pkt_request[1] = {0xAA};
     int package_buffer_pos;
 
     fd_set input;
-    struct timeval timeout;
+
+    /* Initialize timeout structure, set to 2 seconds */
+    struct timeval timeout = {
+      .tv_sec = 2
+    };
 
     int end_flag;
     int escape_flag;
 
     int status;
 
     assert (fd >= 0);
 
     /* Initialize the input set*/
     FD_ZERO (&input);
     FD_SET (fd, &input);
 
-    /* Initialize timeout structure, set to 2 seconds */
-    memset (&timeout, 0, sizeof (timeout));
-    timeout.tv_sec = 2;
-    timeout.tv_usec = 0;
-
     /* clear out anything in the buffer */
     tcflush (fd, TCIFLUSH);
 
     status = write (fd, pkt_request, sizeof(pkt_request));
     if (status <= 0)
     {
@@ -105,13 +104,12 @@
     /* Loop until we find the end of the package */
     end_flag = 0;
     package_buffer_pos = 0;
     while (end_flag == 0)
     {
         ssize_t receive_buffer_length;
-        ssize_t i;
 
         /* check for timeout or input error*/
         status = select (fd + 1, &input, NULL, NULL, &timeout);
         if (status == 0) /* Timeout */
         {
             WARNING ("ted plugin: Timeout while waiting for file descriptor "
@@ -144,13 +142,13 @@
         else if (receive_buffer_length == 0)
         {
             /* Should we close the FD in this case? */
             WARNING ("ted plugin: Received EOF from file descriptor.");
             return (-1);
         }
-        else if (receive_buffer_length > sizeof (receive_buffer))
+        else if (((size_t) receive_buffer_length) > sizeof (receive_buffer))
         {
             ERROR ("ted plugin: read(2) returned invalid value %zi.",
                     receive_buffer_length);
             return (-1);
         }
 
@@ -162,13 +160,13 @@
          */
         /* We need to see the begin sequence first. When we receive `ESCAPE
          * PKT_BEGIN', we set `package_buffer_pos' to zero to signal that
          * the beginning of the package has been found. */
 
         escape_flag = 0;
-        for (i = 0; i < receive_buffer_length; i++)
+        for (ssize_t i = 0; i < receive_buffer_length; i++)
         {
             /* Check if previous byte was the escape byte. */
             if (escape_flag == 1)
             {
                 escape_flag = 0;
                 /* escape escape = single escape */
@@ -260,13 +258,13 @@
     tcsetattr(fd, TCSANOW, &options);
 
     INFO ("ted plugin: Successfully opened %s.", dev);
     return (0);
 } /* int ted_open_device */
 
-static void ted_submit (char *type, double value)
+static void ted_submit (const char *type, double value)
 {
     value_t values[1];
     value_list_t vl = VALUE_LIST_INIT;
 
     values[0].gauge = value;
 
@@ -309,21 +307,20 @@
 
 static int ted_read (void)
 {
     double power;
     double voltage;
     int status;
-    int i;
 
     status = ted_open_device ();
     if (status != 0)
         return (-1);
 
     power = NAN;
     voltage = NAN;
-    for (i = 0; i <= conf_retries; i++)
+    for (int i = 0; i <= conf_retries; i++)
     {
         status = ted_read_value (&power, &voltage);
         if (status == 0)
             break;
     }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/testing.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/testing.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/testing.h	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/testing.h	2016-09-11 16:10:25.275038704 +0800
@@ -1,9 +1,9 @@
 /**
  * collectd - src/tests/macros.h
- * Copyright (C) 2013       Florian octo Forster
+ * Copyright (C) 2013-2015  Florian octo Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -21,16 +21,25 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
+#ifndef TESTING_H
+#define TESTING_H 1
+
+#include <inttypes.h>
+
 static int fail_count__ = 0;
 static int check_count__ = 0;
 
-#define DEF_TEST(func) static int test_##func ()
+#ifndef DBL_PRECISION
+# define DBL_PRECISION 1e-12
+#endif
+
+#define DEF_TEST(func) static int test_##func (void)
 
 #define RUN_TEST(func) do { \
   int status; \
   printf ("Testing %s ...\n", #func); \
   status = test_ ## func (); \
   printf ("%s.\n", (status == 0) ? "Success" : "FAILURE"); \
@@ -39,22 +48,62 @@
 
 #define END_TEST exit ((fail_count__ == 0) ? 0 : 1);
 
 #define OK1(cond, text) do { \
   _Bool result = (cond); \
   printf ("%s %i - %s\n", result ? "ok" : "not ok", ++check_count__, text); \
+  if (!result) { return -1; } \
 } while (0)
 #define OK(cond) OK1(cond, #cond)
 
-#define STREQ(expect, actual) do { \
-  if (strcmp (expect, actual) != 0) { \
-    printf ("not ok %i - %s incorrect: expected \"%s\", got \"%s\"\n", \
-        ++check_count__, #actual, expect, actual); \
+#define EXPECT_EQ_STR(expect, actual) do { \
+  /* Evaluate 'actual' only once. */ \
+  const char *got__ = actual; \
+  if (strcmp (expect, got__) != 0) { \
+    printf ("not ok %i - %s = \"%s\", want \"%s\"\n", \
+        ++check_count__, #actual, got__, expect); \
     return (-1); \
   } \
-  printf ("ok %i - %s evaluates to \"%s\"\n", ++check_count__, #actual, expect); \
+  printf ("ok %i - %s = \"%s\"\n", ++check_count__, #actual, got__); \
+} while (0)
+
+#define EXPECT_EQ_INT(expect, actual) do { \
+  int want__ = (int) expect; \
+  int got__  = (int) actual; \
+  if (got__ != want__) { \
+    printf ("not ok %i - %s = %d, want %d\n", \
+        ++check_count__, #actual, got__, want__); \
+    return (-1); \
+  } \
+  printf ("ok %i - %s = %d\n", ++check_count__, #actual, got__); \
+} while (0)
+
+#define EXPECT_EQ_UINT64(expect, actual) do { \
+  uint64_t want__ = (uint64_t) expect; \
+  uint64_t got__  = (uint64_t) actual; \
+  if (got__ != want__) { \
+    printf ("not ok %i - %s = %"PRIu64", want %"PRIu64"\n", \
+        ++check_count__, #actual, got__, want__); \
+    return (-1); \
+  } \
+  printf ("ok %i - %s = %"PRIu64"\n", ++check_count__, #actual, got__); \
+} while (0)
+
+#define EXPECT_EQ_DOUBLE(expect, actual) do { \
+  double want__ = (double) expect; \
+  double got__  = (double) actual; \
+  if (isnan (want__) && !isnan (got__)) { \
+    printf ("not ok %i - %s = %.15g, want %.15g\n", \
+        ++check_count__, #actual, got__, want__); \
+    return (-1); \
+  } else if (!isnan (want__) && (((want__-got__) < -DBL_PRECISION) || ((want__-got__) > DBL_PRECISION))) { \
+    printf ("not ok %i - %s = %.15g, want %.15g\n", \
+        ++check_count__, #actual, got__, want__); \
+    return (-1); \
+  } \
+  printf ("ok %i - %s = %.15g\n", ++check_count__, #actual, got__); \
 } while (0)
 
 #define CHECK_NOT_NULL(expr) do { \
   void *ptr_; \
   ptr_ = (expr); \
   OK1(ptr_ != NULL, #expr); \
@@ -62,6 +111,8 @@
 
 #define CHECK_ZERO(expr) do { \
   long status_; \
   status_ = (long) (expr); \
   OK1(status_ == 0L, #expr); \
 } while (0)
+
+#endif /* TESTING_H */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/thermal.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/thermal.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/thermal.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/thermal.c	2016-09-11 16:10:25.275038704 +0800
@@ -17,29 +17,29 @@
  *
  * Authors:
  *   Michał Mirosław <mirq-linux at rere.qmqm.pl>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 
 #if !KERNEL_LINUX
 # error "This module is for Linux only."
 #endif
 
 static const char *config_keys[] = {
 	"Device",
 	"IgnoreSelected",
 	"ForceUseProcfs"
 };
 
-const char *const dirname_sysfs = "/sys/class/thermal";
-const char *const dirname_procfs = "/proc/acpi/thermal_zone";
+static const char *const dirname_sysfs = "/sys/class/thermal";
+static const char *const dirname_procfs = "/proc/acpi/thermal_zone";
 
 static _Bool force_procfs = 0;
 static ignorelist_t *device_list;
 
 enum dev_type {
 	TEMP = 0,
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/threshold.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/threshold.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/threshold.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/threshold.c	2016-09-11 16:10:25.275038704 +0800
@@ -27,15 +28,12 @@
 #include "common.h"
 #include "plugin.h"
 #include "utils_avltree.h"
 #include "utils_cache.h"
 #include "utils_threshold.h"
 
-#include <assert.h>
-#include <pthread.h>
-
 /*
  * Threshold management
  * ====================
  * The following functions add, delete, search, etc. configured thresholds to
  * the underlying AVL trees.
  */
@@ -67,21 +65,20 @@
   if (name_copy == NULL)
   {
     ERROR ("ut_threshold_add: strdup failed.");
     return (-1);
   }
 
-  th_copy = (threshold_t *) malloc (sizeof (threshold_t));
+  th_copy = malloc (sizeof (*th_copy));
   if (th_copy == NULL)
   {
     sfree (name_copy);
     ERROR ("ut_threshold_add: malloc failed.");
     return (-1);
   }
   memcpy (th_copy, th, sizeof (threshold_t));
-  th_ptr = NULL;
 
   DEBUG ("ut_threshold_add: Adding entry `%s'", name);
 
   pthread_mutex_lock (&threshold_lock);
 
   th_ptr = threshold_get (th->host, th->plugin, th->plugin_instance,
@@ -216,13 +213,12 @@
 
   return (0);
 } /* int ut_config_type_hysteresis */
 
 static int ut_config_type (const threshold_t *th_orig, oconfig_item_t *ci)
 {
-  int i;
   threshold_t th;
   int status = 0;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -245,13 +241,13 @@
   th.failure_min = NAN;
   th.failure_max = NAN;
   th.hits = 0;
   th.hysteresis = 0;
   th.flags = UT_FLAG_INTERESTING; /* interesting by default */
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Instance", option->key) == 0)
       status = ut_config_type_instance (&th, option);
     else if (strcasecmp ("DataSource", option->key) == 0)
@@ -310,13 +306,12 @@
 
   return (0);
 } /* int ut_config_plugin_instance */
 
 static int ut_config_plugin (const threshold_t *th_orig, oconfig_item_t *ci)
 {
-  int i;
   threshold_t th;
   int status = 0;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -332,13 +327,13 @@
     return (-1);
   }
 
   memcpy (&th, th_orig, sizeof (th));
   sstrncpy (th.plugin, ci->values[0].value.string, sizeof (th.plugin));
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Type", option->key) == 0)
       status = ut_config_type (&th, option);
     else if (strcasecmp ("Instance", option->key) == 0)
@@ -356,13 +351,12 @@
 
   return (status);
 } /* int ut_config_plugin */
 
 static int ut_config_host (const threshold_t *th_orig, oconfig_item_t *ci)
 {
-  int i;
   threshold_t th;
   int status = 0;
 
   if ((ci->values_num != 1)
       || (ci->values[0].type != OCONFIG_TYPE_STRING))
   {
@@ -378,13 +372,13 @@
     return (-1);
   }
 
   memcpy (&th, th_orig, sizeof (th));
   sstrncpy (th.host, ci->values[0].value.string, sizeof (th.host));
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Type", option->key) == 0)
       status = ut_config_type (&th, option);
     else if (strcasecmp ("Plugin", option->key) == 0)
@@ -550,16 +544,15 @@
       }
     }
     else if (th->flags & UT_FLAG_PERCENTAGE)
     {
       gauge_t value;
       gauge_t sum;
-      int i;
 
       sum = 0.0;
-      for (i = 0; i < vl->values_len; i++)
+      for (size_t i = 0; i < vl->values_len; i++)
       {
         if (isnan (values[i]))
           continue;
 
         sum += values[i];
       }
@@ -698,13 +691,12 @@
     const threshold_t *th,
     const gauge_t *values,
     int *ret_ds_index)
 { /* {{{ */
   int ret = -1;
   int ds_index = -1;
-  int i;
   gauge_t values_copy[ds->ds_num];
 
   memcpy (values_copy, values, sizeof (values_copy));
 
   if ((th->flags & UT_FLAG_PERCENTAGE) != 0)
   {
@@ -717,33 +709,33 @@
           "source, but you have configured to check this as a percentage. "
           "That doesn't make much sense, because the percentage will always "
           "be 100%%!", ds->type);
     }
 
     /* Prepare `sum' and `num'. */
-    for (i = 0; i < ds->ds_num; i++)
+    for (size_t i = 0; i < ds->ds_num; i++)
       if (!isnan (values[i]))
       {
         num++;
 	sum += values[i];
       }
 
     if ((num == 0) /* All data sources are undefined. */
         || (sum == 0.0)) /* Sum is zero, cannot calculate percentage. */
     {
-      for (i = 0; i < ds->ds_num; i++)
+      for (size_t i = 0; i < ds->ds_num; i++)
         values_copy[i] = NAN;
     }
     else /* We can actually calculate the percentage. */
     {
-      for (i = 0; i < ds->ds_num; i++)
+      for (size_t i = 0; i < ds->ds_num; i++)
         values_copy[i] = 100.0 * values[i] / sum;
     }
   } /* if (UT_FLAG_PERCENTAGE) */
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     int status;
 
     status = ut_check_one_data_source (ds, vl, th, values_copy, i);
     if (ret < status)
     {
@@ -867,39 +859,34 @@
 
   return (0);
 } /* }}} int ut_missing */
 
 static int ut_config (oconfig_item_t *ci)
 { /* {{{ */
-  int i;
   int status = 0;
   int old_size = c_avl_size (threshold_tree);
 
-  threshold_t th;
-
   if (threshold_tree == NULL)
   {
-    threshold_tree = c_avl_create ((void *) strcmp);
+    threshold_tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
     if (threshold_tree == NULL)
     {
       ERROR ("ut_config: c_avl_create failed.");
       return (-1);
     }
   }
 
-  memset (&th, '\0', sizeof (th));
-  th.warning_min = NAN;
-  th.warning_max = NAN;
-  th.failure_min = NAN;
-  th.failure_max = NAN;
-
-  th.hits = 0;
-  th.hysteresis = 0;
-  th.flags = UT_FLAG_INTERESTING; /* interesting by default */
+  threshold_t th = {
+    .warning_min = NAN,
+    .warning_max = NAN,
+    .failure_min = NAN,
+    .failure_max = NAN,
+    .flags = UT_FLAG_INTERESTING /* interesting by default */
+  };
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *option = ci->children + i;
 
     if (strcasecmp ("Type", option->key) == 0)
       status = ut_config_type (&th, option);
     else if (strcasecmp ("Plugin", option->key) == 0)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tokyotyrant.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tokyotyrant.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/tokyotyrant.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/tokyotyrant.c	2016-09-11 16:10:25.275038704 +0800
@@ -103,14 +104,14 @@
 
 	plugin_dispatch_values (&vl);
 }
 
 static void tt_open_db (void)
 {
-	char* host = NULL;
-	int   port = DEFAULT_PORT;
+	const char *host;
+	int         port = DEFAULT_PORT;
 
 	if (rdb != NULL)
 		return;
 
 	host = ((config_host != NULL) ? config_host : DEFAULT_HOST);
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/turbostat.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/turbostat.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/turbostat.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/turbostat.c	2016-09-11 16:10:25.275038704 +0800
@@ -648,17 +649,16 @@
  */
 static int __attribute__((warn_unused_result))
 for_all_cpus(int (func)(struct thread_data *, struct core_data *, struct pkg_data *),
 	struct thread_data *thread_base, struct core_data *core_base, struct pkg_data *pkg_base)
 {
 	int retval;
-	unsigned int pkg_no, core_no, thread_no;
 
-	for (pkg_no = 0; pkg_no < topology.num_packages; ++pkg_no) {
-		for (core_no = 0; core_no < topology.num_cores; ++core_no) {
-			for (thread_no = 0; thread_no < topology.num_threads; ++thread_no) {
+	for (unsigned int pkg_no = 0; pkg_no < topology.num_packages; ++pkg_no) {
+		for (unsigned int core_no = 0; core_no < topology.num_cores; ++core_no) {
+			for (unsigned int thread_no = 0; thread_no < topology.num_threads; ++thread_no) {
 				struct thread_data *t;
 				struct core_data *c;
 				struct pkg_data *p;
 
 				t = GET_THREAD(thread_base, thread_no, core_no, pkg_no);
 
@@ -688,17 +688,16 @@
  */
 static int __attribute__((warn_unused_result))
 for_all_cpus_delta(const struct thread_data *thread_new_base, const struct core_data *core_new_base, const struct pkg_data *pkg_new_base,
 		   const struct thread_data *thread_old_base, const struct core_data *core_old_base, const struct pkg_data *pkg_old_base)
 {
 	int retval;
-	unsigned int pkg_no, core_no, thread_no;
 
-	for (pkg_no = 0; pkg_no < topology.num_packages; ++pkg_no) {
-		for (core_no = 0; core_no < topology.num_cores; ++core_no) {
-			for (thread_no = 0; thread_no < topology.num_threads; ++thread_no) {
+	for (unsigned int pkg_no = 0; pkg_no < topology.num_packages; ++pkg_no) {
+		for (unsigned int core_no = 0; core_no < topology.num_cores; ++core_no) {
+			for (unsigned int thread_no = 0; thread_no < topology.num_threads; ++thread_no) {
 				struct thread_data *t_delta;
 				const struct thread_data *t_old, *t_new;
 				struct core_data *c_delta;
 
 				/* Get correct pointers for threads */
 				t_delta = GET_THREAD(thread_delta, thread_no, core_no, pkg_no);
@@ -1146,13 +1145,12 @@
 /*
  * Build a local representation of the cpu distribution
  */
 static int __attribute__((warn_unused_result))
 topology_probe(void)
 {
-	unsigned int i;
 	int ret;
 	unsigned int max_package_id, max_core_id, max_threads;
 	max_package_id = max_core_id = max_threads = 0;
 
 	/* Clean topology */
 	free(topology.cpus);
@@ -1183,13 +1181,13 @@
 		goto err;
 
 	/*
 	 * For online cpus
 	 * find max_core_id, max_package_id
 	 */
-	for (i = 0; i <= topology.max_cpu_id; ++i) {
+	for (unsigned int i = 0; i <= topology.max_cpu_id; ++i) {
 		unsigned int num_threads;
 		struct cpu_topology *cpu = &topology.cpus[i];
 
 		if (cpu_is_not_present(i)) {
 			WARNING("turbostat plugin: cpu%d NOT PRESENT", i);
 			continue;
@@ -1248,13 +1246,12 @@
  * Main alloc/init/free *
  ************************/
 
 static int
 allocate_counters(struct thread_data **threads, struct core_data **cores, struct pkg_data **packages)
 {
-	unsigned int i;
 	unsigned int total_threads, total_cores;
 
 	if ((topology.num_threads == 0)
 	    || (topology.num_cores == 0)
 	    || (topology.num_packages == 0))
 	{
@@ -1268,13 +1265,13 @@
 	if (*threads == NULL)
 	{
 		ERROR ("turbostat plugin: calloc failed");
 		return -1;
 	}
 
-	for (i = 0; i < total_threads; ++i)
+	for (unsigned int i = 0; i < total_threads; ++i)
 		(*threads)[i].cpu_id = topology.max_cpu_id + 1;
 
 	total_cores = topology.num_cores * topology.num_packages;
 	*cores = calloc(total_cores, sizeof(struct core_data));
 	if (*cores == NULL)
 	{
@@ -1318,15 +1315,13 @@
 	p->package_id = cpu->package_id;
 }
 
 static void
 initialize_counters(void)
 {
-	unsigned int cpu_id;
-
-	for (cpu_id = 0; cpu_id <= topology.max_cpu_id; ++cpu_id) {
+	for (unsigned int cpu_id = 0; cpu_id <= topology.max_cpu_id; ++cpu_id) {
 		if (cpu_is_not_present(cpu_id))
 			continue;
 		init_counter(EVEN_COUNTERS, cpu_id);
 		init_counter(ODD_COUNTERS, cpu_id);
 		init_counter(DELTA_COUNTERS, cpu_id);
 	}
@@ -1339,13 +1334,13 @@
 {
 	allocated = 0;
 	initialized = 0;
 
 	CPU_FREE(cpu_present_set);
 	cpu_present_set = NULL;
-	cpu_present_set = 0;
+	cpu_present_setsize = 0;
 
 	CPU_FREE(cpu_affinity_set);
 	cpu_affinity_set = NULL;
 	cpu_affinity_setsize = 0;
 
 	CPU_FREE(cpu_saved_affinity_set);
@@ -1476,41 +1471,28 @@
 	return ret;
 }
 
 static int
 check_permissions(void)
 {
-#ifdef HAVE_SYS_CAPABILITY_H
-	struct __user_cap_header_struct cap_header_data;
-	cap_user_header_t cap_header = &cap_header_data;
-	struct __user_cap_data_struct cap_data_data;
-	cap_user_data_t cap_data = &cap_data_data;
-	int ret = 0;
-#endif /* HAVE_SYS_CAPABILITY_H */
 
 	if (getuid() == 0) {
 		/* We have everything we need */
 		return 0;
-#ifndef HAVE_SYS_CAPABILITY_H
+#if !defined(HAVE_SYS_CAPABILITY_H) && !defined(CAP_SYS_RAWIO)
 	} else {
 		ERROR("turbostat plugin: Initialization failed: this plugin "
 		      "requires collectd to run as root");
 		return -1;
 	}
-#else /* HAVE_SYS_CAPABILITY_H */
+#else /* HAVE_SYS_CAPABILITY_H && CAP_SYS_RAWIO */
 	}
 
-	/* check for CAP_SYS_RAWIO */
-	cap_header->pid = getpid();
-	cap_header->version = _LINUX_CAPABILITY_VERSION;
-	if (capget(cap_header, cap_data) < 0) {
-		ERROR("turbostat plugin: capget failed");
-		return -1;
-	}
+	int ret = 0;
 
-	if ((cap_data->effective & (1 << CAP_SYS_RAWIO)) == 0) {
+	if (check_capability(CAP_SYS_RAWIO) != 0) {
 		WARNING("turbostat plugin: Collectd doesn't have the "
 			"CAP_SYS_RAWIO capability. If you don't want to run "
 			"collectd as root, try running \"setcap "
 			"cap_sys_rawio=ep\" on collectd binary");
 		ret = -1;
 	}
@@ -1526,13 +1508,13 @@
 	if (ret != 0)
 		ERROR("turbostat plugin: Initialization failed: this plugin "
 		      "requires collectd to either to run as root or give "
 		      "collectd a special capability (CAP_SYS_RAWIO) and read "
                       "access to /dev/cpu/*/msr (see previous warnings)");
 	return ret;
-#endif /* HAVE_SYS_CAPABILITY_H */
+#endif /* HAVE_SYS_CAPABILITY_H && CAP_SYS_RAWIO */
 }
 
 static int
 turbostat_init(void)
 {
 	struct stat sb;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/types.db /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/types.db
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/types.db	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/types.db	2016-09-11 16:10:25.275038704 +0800
@@ -5,80 +5,90 @@
 apache_requests		value:DERIVE:0:U
 apache_scoreboard	value:GAUGE:0:65535
 ath_nodes		value:GAUGE:0:65535
 ath_stat		value:DERIVE:0:U
 backends		value:GAUGE:0:65535
 bitrate			value:GAUGE:0:4294967295
-blocked_clients value:GAUGE:0:U
+blocked_clients         value:GAUGE:0:U
 bytes			value:GAUGE:0:U
 cache_eviction		value:DERIVE:0:U
 cache_operation		value:DERIVE:0:U
 cache_ratio		value:GAUGE:0:100
 cache_result		value:DERIVE:0:U
-cache_size		value:GAUGE:0:U
-capacity	value:GAUGE:0:U
+cache_size              value:GAUGE:0:1125899906842623
+capacity                value:GAUGE:0:U
 ceph_bytes		value:GAUGE:U:U
-ceph_latency	value:GAUGE:U:U
-ceph_rate			value:DERIVE:0:U
-changes_since_last_save   value:GAUGE:0:U
+ceph_latency            value:GAUGE:U:U
+ceph_rate               value:DERIVE:0:U
+changes_since_last_save value:GAUGE:0:U
 charge			value:GAUGE:0:U
-compression_ratio	value:GAUGE:0:2
+clock_last_meas         value:GAUGE:0:U
+clock_last_update       value:GAUGE:U:U
+clock_mode              value:GAUGE:0:U
+clock_reachability      value:GAUGE:0:U
+clock_skew_ppm          value:GAUGE:-2:2
+clock_state             value:GAUGE:0:U
+clock_stratum           value:GAUGE:0:U
 compression		uncompressed:DERIVE:0:U, compressed:DERIVE:0:U
+compression_ratio       value:GAUGE:0:2
 connections		value:DERIVE:0:U
 conntrack		value:GAUGE:0:4294967295
 contextswitch		value:DERIVE:0:U
 count			value:GAUGE:0:U
 counter			value:COUNTER:U:U
-cpufreq			value:GAUGE:0:U
 cpu			value:DERIVE:0:U
+cpufreq                 value:GAUGE:0:U
+current                 value:GAUGE:U:U
 current_connections	value:GAUGE:0:U
 current_sessions	value:GAUGE:0:U
-current			value:GAUGE:U:U
 delay			value:GAUGE:-1000000:1000000
 derive			value:DERIVE:0:U
+df                      used:GAUGE:0:1125899906842623, free:GAUGE:0:1125899906842623
 df_complex		value:GAUGE:0:U
 df_inodes		value:GAUGE:0:U
-df			used:GAUGE:0:1125899906842623, free:GAUGE:0:1125899906842623
+dilution_of_precision   value:GAUGE:0:U
+disk_io_time            io_time:DERIVE:0:U, weighted_io_time:DERIVE:0:U
 disk_latency		read:GAUGE:0:U, write:GAUGE:0:U
 disk_merged		read:DERIVE:0:U, write:DERIVE:0:U
 disk_octets		read:DERIVE:0:U, write:DERIVE:0:U
-disk_ops_complex	value:DERIVE:0:U
 disk_ops		read:DERIVE:0:U, write:DERIVE:0:U
+disk_ops_complex        value:DERIVE:0:U
 disk_time		read:DERIVE:0:U, write:DERIVE:0:U
-disk_io_time		io_time:DERIVE:0:U, weighted_io_time:DERIVE:0:U
 dns_answer		value:DERIVE:0:U
 dns_notify		value:DERIVE:0:U
 dns_octets		queries:DERIVE:0:U, responses:DERIVE:0:U
 dns_opcode		value:DERIVE:0:U
-dns_qtype_cached	value:GAUGE:0:4294967295
 dns_qtype		value:DERIVE:0:U
+dns_qtype_cached        value:GAUGE:0:4294967295
 dns_query		value:DERIVE:0:U
 dns_question		value:DERIVE:0:U
 dns_rcode		value:DERIVE:0:U
 dns_reject		value:DERIVE:0:U
 dns_request		value:DERIVE:0:U
 dns_resolver		value:DERIVE:0:U
 dns_response		value:DERIVE:0:U
 dns_transfer		value:DERIVE:0:U
 dns_update		value:DERIVE:0:U
 dns_zops		value:DERIVE:0:U
-drbd_resource	value:DERIVE:0:U
+drbd_resource           value:DERIVE:0:U
 duration		seconds:GAUGE:0:U
 email_check		value:GAUGE:0:U
 email_count		value:GAUGE:0:U
 email_size		value:GAUGE:0:U
 entropy			value:GAUGE:0:4294967295
-expired_keys    value:DERIVE:0:U
+evicted_keys            value:DERIVE:0:U
+expired_keys            value:DERIVE:0:U
 fanspeed		value:GAUGE:0:U
 file_handles		value:GAUGE:0:U
 file_size		value:GAUGE:0:U
 files			value:GAUGE:0:U
 flow			value:GAUGE:0:U
 fork_rate		value:DERIVE:0:U
-frequency_offset	value:GAUGE:-1000000:1000000
 frequency		value:GAUGE:0:U
+frequency_error         value:GAUGE:-2:2 
+frequency_offset        value:GAUGE:-1000000:1000000
 fscache_stat		value:DERIVE:0:U
 gauge			value:GAUGE:U:U
 hash_collisions		value:DERIVE:0:U
 http_request_methods	value:DERIVE:0:U
 http_requests		value:DERIVE:0:U
 http_response_codes	value:DERIVE:0:U
@@ -107,105 +117,116 @@
 memcached_connections	value:GAUGE:0:U
 memcached_items		value:GAUGE:0:U
 memcached_octets	rx:DERIVE:0:U, tx:DERIVE:0:U
 memcached_ops		value:DERIVE:0:U
 memory			value:GAUGE:0:281474976710656
 memory_lua		value:GAUGE:0:281474976710656
+memory_throttle_count   value:DERIVE:0:U
 multimeter		value:GAUGE:U:U
 mutex_operations	value:DERIVE:0:U
-mysql_commands		value:DERIVE:0:U
-mysql_handler		value:DERIVE:0:U
-mysql_locks		value:DERIVE:0:U
-mysql_log_position	value:DERIVE:0:U
-mysql_octets		rx:DERIVE:0:U, tx:DERIVE:0:U
-mysql_bpool_pages	value:GAUGE:0:U
 mysql_bpool_bytes	value:GAUGE:0:U
 mysql_bpool_counters	value:DERIVE:0:U
+mysql_bpool_pages       value:GAUGE:0:U
+mysql_commands          value:DERIVE:0:U
+mysql_handler           value:DERIVE:0:U
 mysql_innodb_data	value:DERIVE:0:U
 mysql_innodb_dblwr	value:DERIVE:0:U
 mysql_innodb_log	value:DERIVE:0:U
 mysql_innodb_pages	value:DERIVE:0:U
 mysql_innodb_row_lock	value:DERIVE:0:U
 mysql_innodb_rows	value:DERIVE:0:U
+mysql_locks             value:DERIVE:0:U
+mysql_log_position      value:DERIVE:0:U
+mysql_octets            rx:DERIVE:0:U, tx:DERIVE:0:U
 mysql_select		value:DERIVE:0:U
 mysql_sort		value:DERIVE:0:U
+mysql_sort_merge_passes value:DERIVE:0:U
+mysql_sort_rows         value:DERIVE:0:U
+mysql_slow_queries      value:DERIVE:0:U
 nfs_procedure		value:DERIVE:0:U
 nginx_connections	value:GAUGE:0:U
 nginx_requests		value:DERIVE:0:U
 node_octets		rx:DERIVE:0:U, tx:DERIVE:0:U
 node_rssi		value:GAUGE:0:255
 node_stat		value:DERIVE:0:U
 node_tx_rate		value:GAUGE:0:127
 objects			value:GAUGE:0:U
 operations		value:DERIVE:0:U
+operations_per_second   value:GAUGE:0:U
 packets			value:DERIVE:0:U
 pending_operations	value:GAUGE:0:U
 percent			value:GAUGE:0:100.1
 percent_bytes		value:GAUGE:0:100.1
 percent_inodes		value:GAUGE:0:100.1
 pf_counters		value:DERIVE:0:U
 pf_limits		value:DERIVE:0:U
 pf_source		value:DERIVE:0:U
-pf_states		value:GAUGE:0:U
 pf_state		value:DERIVE:0:U
+pf_states               value:GAUGE:0:U
 pg_blks			value:DERIVE:0:U
 pg_db_size		value:GAUGE:0:U
 pg_n_tup_c		value:DERIVE:0:U
 pg_n_tup_g		value:GAUGE:0:U
 pg_numbackends		value:GAUGE:0:U
 pg_scan			value:DERIVE:0:U
 pg_xact			value:DERIVE:0:U
+ping                    value:GAUGE:0:65535
 ping_droprate		value:GAUGE:0:100
 ping_stddev		value:GAUGE:0:65535
-ping			value:GAUGE:0:65535
 players			value:GAUGE:0:1000000
 power			value:GAUGE:U:U
-pressure			value:GAUGE:0:U
+pressure                value:GAUGE:0:U
 protocol_counter	value:DERIVE:0:U
 ps_code			value:GAUGE:0:9223372036854775807
 ps_count		processes:GAUGE:0:1000000, threads:GAUGE:0:1000000
 ps_cputime		user:DERIVE:0:U, syst:DERIVE:0:U
 ps_data			value:GAUGE:0:9223372036854775807
 ps_disk_octets		read:DERIVE:0:U, write:DERIVE:0:U
 ps_disk_ops		read:DERIVE:0:U, write:DERIVE:0:U
 ps_pagefaults		minflt:DERIVE:0:U, majflt:DERIVE:0:U
 ps_rss			value:GAUGE:0:9223372036854775807
 ps_stacksize		value:GAUGE:0:9223372036854775807
 ps_state		value:GAUGE:0:65535
 ps_vm			value:GAUGE:0:9223372036854775807
-pubsub        value:GAUGE:0:U
+pubsub                  value:GAUGE:0:U
 queue_length		value:GAUGE:0:U
 records			value:GAUGE:0:U
 requests		value:GAUGE:0:U
-response_time		value:GAUGE:0:U
 response_code		value:GAUGE:0:U
+response_time           value:GAUGE:0:U
+root_delay              value:GAUGE:U:U
+root_dispersion         value:GAUGE:U:U
 route_etx		value:GAUGE:0:U
 route_metric		value:GAUGE:0:U
 routes			value:GAUGE:0:U
+satellites              value:GAUGE:0:U
 segments 		value:GAUGE:0:65535
 serial_octets		rx:DERIVE:0:U, tx:DERIVE:0:U
 signal_noise		value:GAUGE:U:0
 signal_power		value:GAUGE:U:0
 signal_quality		value:GAUGE:0:U
-smart_poweron		value:GAUGE:0:U
-smart_powercycles	value:GAUGE:0:U
+smart_attribute         current:GAUGE:0:255, worst:GAUGE:0:255, threshold:GAUGE:0:255, pretty:GAUGE:0:U
 smart_badsectors	value:GAUGE:0:U
+smart_powercycles       value:GAUGE:0:U
+smart_poweron           value:GAUGE:0:U
 smart_temperature	value:GAUGE:-300:300
-smart_attribute         current:GAUGE:0:255, worst:GAUGE:0:255, threshold:GAUGE:0:255, pretty:GAUGE:0:U
 snr			value:GAUGE:0:U
 spam_check		value:GAUGE:0:U
 spam_score		value:GAUGE:U:U
 spl			value:GAUGE:U:U
-swap_io			value:DERIVE:0:U
 swap			value:GAUGE:0:1099511627776
+swap_io                 value:DERIVE:0:U
 tcp_connections		value:GAUGE:0:4294967295
 temperature		value:GAUGE:U:U
 threads			value:GAUGE:0:U
 time_dispersion		value:GAUGE:-1000000:1000000
-timeleft		value:GAUGE:0:U
 time_offset		value:GAUGE:-1000000:1000000
+time_offset_ntp         value:GAUGE:-1000000:1000000
+time_offset_rms         value:GAUGE:-1000000:1000000
+time_ref                value:GAUGE:0:U
+timeleft                value:GAUGE:0:U
 total_bytes		value:DERIVE:0:U
 total_connections	value:DERIVE:0:U
 total_objects		value:DERIVE:0:U
 total_operations	value:DERIVE:0:U
 total_requests		value:DERIVE:0:U
 total_sessions		value:DERIVE:0:U
@@ -220,14 +241,14 @@
 virt_vcpu		value:DERIVE:0:U
 vmpage_action		value:DERIVE:0:U
 vmpage_faults		minflt:DERIVE:0:U, majflt:DERIVE:0:U
 vmpage_io		in:DERIVE:0:U, out:DERIVE:0:U
 vmpage_number		value:GAUGE:0:4294967295
 volatile_changes	value:GAUGE:0:U
-voltage_threshold	value:GAUGE:U:U, threshold:GAUGE:U:U
 voltage			value:GAUGE:U:U
+voltage_threshold       value:GAUGE:U:U, threshold:GAUGE:U:U
 vs_memory		value:GAUGE:0:9223372036854775807
 vs_processes		value:GAUGE:0:65535
 vs_threads		value:GAUGE:0:65535
 
 #
 # Legacy types
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/types.db.5 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/types.db.5
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/types.db.5	2016-11-29 00:10:00.472500490 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/types.db.5	2016-09-11 16:11:16.074969500 +0800
@@ -130,13 +130,13 @@
 .    ds Ae AE
 .\}
 .rm #[ #] #H #V #F C
 .\" ========================================================================
 .\"
 .IX Title "TYPES.DB 5"
-.TH TYPES.DB 5 "2016-11-28" "5.5.3" "collectd"
+.TH TYPES.DB 5 "2016-09-11" "5.6.0" "collectd"
 .\" For nroff, turn off justification.  Always turn off hyphenation; it makes
 .\" way too many mistakes in technical documents.
 .if n .ad l
 .nh
 .SH "NAME"
 types.db \- Data\-set specifications for the system statistics collection daemon
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/unixsock.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/unixsock.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/unixsock.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/unixsock.c	2016-09-11 16:10:25.275038704 +0800
@@ -22,27 +22,23 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include "utils_cmd_flush.h"
 #include "utils_cmd_getval.h"
 #include "utils_cmd_getthreshold.h"
 #include "utils_cmd_listval.h"
 #include "utils_cmd_putval.h"
 #include "utils_cmd_putnotif.h"
 
-/* Folks without pthread will need to disable this plugin. */
-#include <pthread.h>
-
-#include <sys/socket.h>
 #include <sys/stat.h>
 #include <sys/un.h>
 
 #include <grp.h>
 
 #ifndef UNIX_PATH_MAX
@@ -77,25 +73,24 @@
 
 /*
  * Functions
  */
 static int us_open_socket (void)
 {
-	struct sockaddr_un sa;
+	struct sockaddr_un sa = { 0 };
 	int status;
 
 	sock_fd = socket (PF_UNIX, SOCK_STREAM, 0);
 	if (sock_fd < 0)
 	{
 		char errbuf[1024];
 		ERROR ("unixsock plugin: socket failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
-	memset (&sa, '\0', sizeof (sa));
 	sa.sun_family = AF_UNIX;
 	sstrncpy (sa.sun_path, (sock_file != NULL) ? sock_file : US_DEFAULT_PATH,
 			sizeof (sa.sun_path));
 
 	DEBUG ("unixsock plugin: socket path = %s", sa.sun_path);
 
@@ -149,13 +144,13 @@
 		sock_fd = -1;
 		return (-1);
 	}
 
 	do
 	{
-		char *grpname;
+		const char *grpname;
 		struct group *g;
 		struct group sg;
 		char grbuf[2048];
 
 		grpname = (sock_group != NULL) ? sock_group : COLLECTD_GRP_NAME;
 		g = NULL;
@@ -366,13 +361,13 @@
 			close (sock_fd);
 			sock_fd = -1;
 			pthread_attr_destroy (&th_attr);
 			pthread_exit ((void *) 1);
 		}
 
-		remote_fd = (int *) malloc (sizeof (int));
+		remote_fd = malloc (sizeof (*remote_fd));
 		if (remote_fd == NULL)
 		{
 			char errbuf[1024];
 			WARNING ("unixsock plugin: malloc failed: %s",
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 			close (status);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/uptime.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/uptime.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/uptime.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/uptime.c	2016-09-11 16:10:25.275038704 +0800
@@ -176,23 +177,19 @@
 			"but `boottime' is zero!");
 		return (-1);
 	}
 /* #endif HAVE_LIBKSTAT */
 
 # elif HAVE_SYS_SYSCTL_H
-	struct timeval boottv;
+	struct timeval boottv = { 0 };
 	size_t boottv_len;
 	int status;
 
-	int mib[2];
-
-	mib[0] = CTL_KERN;
-	mib[1] = KERN_BOOTTIME;
+	int mib[] = { CTL_KERN, KERN_BOOTTIME };
 
 	boottv_len = sizeof (boottv);
-	memset (&boottv, 0, boottv_len);
 
 	status = sysctl (mib, STATIC_ARRAY_SIZE (mib), &boottv, &boottv_len,
 			/* new_value = */ NULL, /* new_length = */ 0);
 	if (status != 0)
 	{
 		char errbuf[1024];
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/users.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/users.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/users.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/users.c	2016-09-11 16:10:25.275038704 +0800
@@ -1,12 +1,12 @@
 /**
  * collectd - src/users.c
  * Copyright (C) 2005-2007  Sebastian Harl
  * Copyright (C) 2005       Niki W. Waibel
  * Copyright (C) 2005-2007  Florian octo Forster
- * Copyright (C) 2008       Oleg King 
+ * Copyright (C) 2008       Oleg King
  *
  * This program is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License as published by the
  * Free Software Foundation; only version 2 of the license is applicable.
  *
  * This program is distributed in the hope that it will be useful, but
@@ -74,13 +75,13 @@
 		}
 	}
 	endutxent();
 
 	users_submit (users);
 /* #endif HAVE_GETUTXENT */
-	
+
 #elif HAVE_GETUTENT
 	unsigned int users = 0;
 	struct utmp *entry = NULL;
 
 	/* according to the *utent(3) man page none of the functions sets errno
 	   in case of an error, so we cannot do any error-checking here */
@@ -103,13 +104,13 @@
 	size_t num_entries;
 	us = sg_get_user_stats (&num_entries);
 # else
 	us = sg_get_user_stats ();
 # endif
 	if (us == NULL)
-		return (-1);   
+		return (-1);
 
 	users_submit ((gauge_t)
 # if HAVE_LIBSTATGRAB_0_90
 		      num_entries);
 # else
 		      us->num_entries);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_flush.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_flush.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_flush.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_flush.c	2016-09-11 16:10:25.275038704 +0800
@@ -40,14 +41,12 @@
 	double timeout = 0.0;
 	char **plugins = NULL;
 	size_t plugins_num = 0;
 	char **identifiers = NULL;
 	size_t identifiers_num = 0;
 
-	size_t i;
-
 #define PRINT_TO_SOCK(fh, ...) \
 	do { \
 		if (fprintf (fh, __VA_ARGS__) < 0) { \
 			char errbuf[1024]; \
 			WARNING ("handle_flush: failed to write to socket #%i: %s", \
 					fileno (fh), sstrerror (errno, errbuf, sizeof (errbuf))); \
@@ -119,21 +118,20 @@
 			strarray_free (plugins, plugins_num);
 			strarray_free (identifiers, identifiers_num);
 			return (-1);
 		}
 	} /* while (*buffer != 0) */
 
-	for (i = 0; (i == 0) || (i < plugins_num); i++)
+	for (size_t i = 0; (i == 0) || (i < plugins_num); i++)
 	{
 		char *plugin = NULL;
-		int j;
 
 		if (plugins_num != 0)
 			plugin = plugins[i];
 
-		for (j = 0; (j == 0) || (j < identifiers_num); j++)
+		for (size_t j = 0; (j == 0) || (j < identifiers_num); j++)
 		{
 			char *identifier = NULL;
 			int status;
 
 			if (identifiers_num != 0)
 				identifier = identifiers[j];
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_getthreshold.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_getthreshold.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_getthreshold.c	2016-11-29 00:08:22.423470634 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_getthreshold.c	2016-09-11 16:10:25.275038704 +0800
@@ -50,13 +51,12 @@
   char *host;
   char *plugin;
   char *plugin_instance;
   char *type;
   char *type_instance;
 
-  value_list_t vl;
   threshold_t threshold;
 
   int   status;
   size_t i;
 
   if ((fh == NULL) || (buffer == NULL))
@@ -107,23 +107,24 @@
     DEBUG ("handle_getthreshold: Cannot parse identifier `%s'.", identifier);
     print_to_socket (fh, "-1 Cannot parse identifier `%s'.\n", identifier);
     sfree (identifier_copy);
     return (-1);
   }
 
-  memset (&vl, 0, sizeof (vl));
+  value_list_t vl = {
+    .values = NULL
+  };
   sstrncpy (vl.host, host, sizeof (vl.host));
   sstrncpy (vl.plugin, plugin, sizeof (vl.plugin));
   if (plugin_instance != NULL)
     sstrncpy (vl.plugin_instance, plugin_instance, sizeof (vl.plugin_instance));
   sstrncpy (vl.type, type, sizeof (vl.type));
   if (type_instance != NULL)
     sstrncpy (vl.type_instance, type_instance, sizeof (vl.type_instance));
   sfree (identifier_copy);
 
-  memset (&threshold, 0, sizeof (threshold));
   status = ut_search_threshold (&vl, &threshold);
   if (status == ENOENT)
   {
     print_to_socket (fh, "-1 No threshold found for identifier %s\n",
         identifier);
     return (0);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_getval.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_getval.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_getval.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_getval.c	2016-09-11 16:10:25.275038704 +0800
@@ -57,13 +58,12 @@
   gauge_t *values;
   size_t values_num;
 
   const data_set_t *ds;
 
   int   status;
-  size_t i;
 
   if ((fh == NULL) || (buffer == NULL))
     return (-1);
 
   DEBUG ("utils_cmd_getval: handle_getval (fh = %p, buffer = %s);",
       (void *) fh, buffer);
@@ -129,26 +129,26 @@
   {
     print_to_socket (fh, "-1 No such value\n");
     sfree (identifier_copy);
     return (-1);
   }
 
-  if ((size_t) ds->ds_num != values_num)
+  if (ds->ds_num != values_num)
   {
-    ERROR ("ds[%s]->ds_num = %i, "
-	"but uc_get_rate_by_name returned %u values.",
-	ds->type, ds->ds_num, (unsigned int) values_num);
+    ERROR ("ds[%s]->ds_num = %zu, "
+	"but uc_get_rate_by_name returned %zu values.",
+	ds->type, ds->ds_num, values_num);
     print_to_socket (fh, "-1 Error reading value from cache.\n");
     sfree (values);
     sfree (identifier_copy);
     return (-1);
   }
 
-  print_to_socket (fh, "%u Value%s found\n", (unsigned int) values_num,
+  print_to_socket (fh, "%zu Value%s found\n", values_num,
       (values_num == 1) ? "" : "s");
-  for (i = 0; i < values_num; i++)
+  for (size_t i = 0; i < values_num; i++)
   {
     print_to_socket (fh, "%s=", ds->ds[i].name);
     if (isnan (values[i]))
     {
       print_to_socket (fh, "NaN\n");
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_listval.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_listval.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_listval.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_listval.c	2016-09-11 16:10:25.275038704 +0800
@@ -30,14 +31,13 @@
 
 #include "utils_cmd_listval.h"
 #include "utils_cache.h"
 #include "utils_parse_option.h"
 
 #define free_everything_and_return(status) do { \
-    size_t j; \
-    for (j = 0; j < number; j++) { \
+    for (size_t j = 0; j < number; j++) { \
       sfree(names[j]); \
       names[j] = NULL; \
     } \
     sfree(names); \
     sfree(times); \
     return (status); \
@@ -57,13 +57,12 @@
 int handle_listval (FILE *fh, char *buffer)
 {
   char *command;
   char **names = NULL;
   cdtime_t *times = NULL;
   size_t number = 0;
-  size_t i;
   int status;
 
   DEBUG ("utils_cmd_listval: handle_listval (fh = %p, buffer = %s);",
       (void *) fh, buffer);
 
   command = NULL;
@@ -94,13 +93,13 @@
     print_to_socket (fh, "-1 uc_get_names failed.\n");
     free_everything_and_return (-1);
   }
 
   print_to_socket (fh, "%i Value%s found\n",
       (int) number, (number == 1) ? "" : "s");
-  for (i = 0; i < number; i++)
+  for (size_t i = 0; i < number; i++)
     print_to_socket (fh, "%.3f %s\n", CDTIME_T_TO_DOUBLE (times[i]),
        	names[i]);
 
   free_everything_and_return (0);
 } /* int handle_listval */
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_putnotif.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_putnotif.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_putnotif.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_putnotif.c	2016-09-11 16:10:25.275038704 +0800
@@ -116,13 +117,13 @@
   return (0);
 } /* int set_option */
 
 int handle_putnotif (FILE *fh, char *buffer)
 {
   char *command;
-  notification_t n;
+  notification_t n = { 0 };
   int status;
 
   if ((fh == NULL) || (buffer == NULL))
     return (-1);
 
   DEBUG ("utils_cmd_putnotif: handle_putnotif (fh = %p, buffer = %s);",
@@ -140,14 +141,12 @@
   if (strcasecmp ("PUTNOTIF", command) != 0)
   {
     print_to_socket (fh, "-1 Unexpected command: `%s'.\n", command);
     return (-1);
   }
 
-  memset (&n, '\0', sizeof (n));
-
   status = 0;
   while (*buffer != 0)
   {
     char *key;
     char *value;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_putval.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_putval.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_cmd_putval.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_cmd_putval.c	2016-09-11 16:10:25.275038704 +0800
@@ -160,13 +161,13 @@
 	hostname = NULL;
 	plugin = NULL; plugin_instance = NULL;
 	type = NULL;   type_instance = NULL;
 	sfree (identifier_copy);
 
 	vl.values_len = ds->ds_num;
-	vl.values = (value_t *) malloc (vl.values_len * sizeof (value_t));
+	vl.values = malloc (vl.values_len * sizeof (*vl.values));
 	if (vl.values == NULL)
 	{
 		print_to_socket (fh, "-1 malloc failed.\n");
 		return (-1);
 	}
 
@@ -215,13 +216,14 @@
 
 		plugin_dispatch_values (&vl);
 		values_submitted++;
 	} /* while (*buffer != 0) */
 	/* Done parsing the options. */
 
-	print_to_socket (fh, "0 Success: %i %s been dispatched.\n",
+	if (fh!=stdout)
+		print_to_socket (fh, "0 Success: %i %s been dispatched.\n",
 			values_submitted,
 			(values_submitted == 1) ? "value has" : "values have");
 
 	sfree (vl.values);
 	return (0);
 } /* int handle_putval */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_crc32.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_crc32.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_crc32.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_crc32.c	2016-09-11 16:10:25.275038704 +0800
@@ -98,14 +98,13 @@
 
 /* Return a 32-bit CRC of the contents of the buffer. */
 
 uint32_t
 crc32_buffer(const unsigned char *s, size_t len)
 {
-    size_t      i;
     uint32_t   ret;
 
     ret = 0;
-    for (i = 0;  i < len;  i++)
+    for (size_t i = 0;  i < len;  i++)
         ret = crc32_tab[(ret ^ s[i]) & 0xff] ^ (ret >> 8);
     return ret;
 }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_curl_stats.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_curl_stats.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_db_query.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_db_query.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_db_query.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_db_query.c	2016-09-11 16:10:25.275038704 +0800
@@ -22,15 +22,15 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_db_query.h"
 
 /*
  * Data types
  */
 struct udb_result_s; /* {{{ */
@@ -51,12 +51,13 @@
 
 struct udb_query_s /* {{{ */
 {
   char *name;
   char *statement;
   void *user_data;
+  char *plugin_instance_from;
 
   unsigned int min_version;
   unsigned int max_version;
 
   udb_result_t *results;
 }; /* }}} */
@@ -67,20 +68,22 @@
   size_t *instances_pos;
   size_t *values_pos;
   size_t *metadata_pos;
   char  **instances_buffer;
   char  **values_buffer;
   char  **metadata_buffer;
+  char   *plugin_instance;
 
   struct udb_result_preparation_area_s *next;
 }; /* }}} */
 typedef struct udb_result_preparation_area_s udb_result_preparation_area_t;
 
 struct udb_query_preparation_area_s /* {{{ */
 {
   size_t column_num;
+  size_t plugin_instance_pos;
   char *host;
   char *plugin;
   char *db_name;
 
   cdtime_t interval;
 
@@ -119,42 +122,41 @@
 
 static int udb_config_add_string (char ***ret_array, /* {{{ */
     size_t *ret_array_len, oconfig_item_t *ci)
 {
   char **array;
   size_t array_len;
-  int i;
 
   if (ci->values_num < 1)
   {
     WARNING ("db query utils: The `%s' config option "
         "needs at least one argument.", ci->key);
     return (-1);
   }
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     if (ci->values[i].type != OCONFIG_TYPE_STRING)
     {
       WARNING ("db query utils: Argument %i to the `%s' option "
           "is not a string.", i + 1, ci->key);
       return (-1);
     }
   }
 
   array_len = *ret_array_len;
-  array = (char **) realloc (*ret_array,
+  array = realloc (*ret_array,
       sizeof (char *) * (array_len + ci->values_num));
   if (array == NULL)
   {
     ERROR ("db query utils: realloc failed.");
     return (-1);
   }
   *ret_array = array;
 
-  for (i = 0; i < ci->values_num; i++)
+  for (int i = 0; i < ci->values_num; i++)
   {
     array[array_len] = strdup (ci->values[i].value.string);
     if (array[array_len] == NULL)
     {
       ERROR ("db query utils: strdup failed.");
       *ret_array_len = array_len;
@@ -193,51 +195,57 @@
  */
 static int udb_result_submit (udb_result_t *r, /* {{{ */
     udb_result_preparation_area_t *r_area,
     udb_query_t const *q, udb_query_preparation_area_t *q_area)
 {
   value_list_t vl = VALUE_LIST_INIT;
-  size_t i;
-  int status;
 
   assert (r != NULL);
   assert (r_area->ds != NULL);
   assert (((size_t) r_area->ds->ds_num) == r->values_num);
   assert (r->values_num > 0);
 
-  vl.values = (value_t *) calloc (r->values_num, sizeof (value_t));
+  vl.values = calloc (r->values_num, sizeof (*vl.values));
   if (vl.values == NULL)
   {
-    ERROR ("db query utils: malloc failed.");
+    ERROR ("db query utils: calloc failed.");
     return (-1);
   }
   vl.values_len = r_area->ds->ds_num;
 
-  for (i = 0; i < r->values_num; i++)
+  for (size_t i = 0; i < r->values_num; i++)
   {
     char *value_str = r_area->values_buffer[i];
 
     if (0 != parse_value (value_str, &vl.values[i], r_area->ds->ds[i].type))
     {
       ERROR ("db query utils: udb_result_submit: Parsing `%s' as %s failed.",
           value_str, DS_TYPE_TO_STRING (r_area->ds->ds[i].type));
       errno = EINVAL;
+      free (vl.values);
       return (-1);
     }
   }
 
   if (q_area->interval > 0)
     vl.interval = q_area->interval;
 
   sstrncpy (vl.host, q_area->host, sizeof (vl.host));
   sstrncpy (vl.plugin, q_area->plugin, sizeof (vl.plugin));
-  sstrncpy (vl.plugin_instance, q_area->db_name, sizeof (vl.plugin_instance));
   sstrncpy (vl.type, r->type, sizeof (vl.type));
 
+  /* Set vl.plugin_instance */
+  if (q->plugin_instance_from != NULL) {
+    sstrncpy (vl.plugin_instance, r_area->plugin_instance, sizeof (vl.plugin_instance));
+  }
+  else {
+    sstrncpy (vl.plugin_instance, q_area->db_name, sizeof (vl.plugin_instance));
+  }
+
   /* Set vl.type_instance {{{ */
-  if (r->instances_num <= 0)
+  if (r->instances_num == 0)
   {
     if (r->instance_prefix == NULL)
       vl.type_instance[0] = 0;
     else
       sstrncpy (vl.type_instance, r->instance_prefix,
           sizeof (vl.type_instance));
@@ -283,15 +291,15 @@
     if (vl.meta == NULL)
     {
       ERROR ("db query utils:: meta_data_create failed.");
       return (-ENOMEM);
     }
 
-    for (i = 0; i < r->metadata_num; i++)
+    for (size_t i = 0; i < r->metadata_num; i++)
     {
-      status = meta_data_add_string (vl.meta, r->metadata[i],
+      int status = meta_data_add_string (vl.meta, r->metadata[i],
           r_area->metadata_buffer[i]);
       if (status != 0)
       {
         ERROR ("db query utils:: meta_data_add_string failed.");
         meta_data_destroy (vl.meta);
         vl.meta = NULL;
@@ -329,34 +337,33 @@
 
 static int udb_result_handle_result (udb_result_t *r, /* {{{ */
     udb_query_preparation_area_t *q_area,
     udb_result_preparation_area_t *r_area,
     udb_query_t const *q, char **column_values)
 {
-  size_t i;
-
   assert (r && q_area && r_area);
 
-  for (i = 0; i < r->instances_num; i++)
+  for (size_t i = 0; i < r->instances_num; i++)
     r_area->instances_buffer[i] = column_values[r_area->instances_pos[i]];
 
-  for (i = 0; i < r->values_num; i++)
+  for (size_t i = 0; i < r->values_num; i++)
     r_area->values_buffer[i] = column_values[r_area->values_pos[i]];
 
-  for (i = 0; i < r->metadata_num; i++)
+  for (size_t i = 0; i < r->metadata_num; i++)
     r_area->metadata_buffer[i] = column_values[r_area->metadata_pos[i]];
 
+  if (q->plugin_instance_from)
+    r_area->plugin_instance = column_values[q_area->plugin_instance_pos];
+
   return udb_result_submit (r, r_area, q, q_area);
 } /* }}} int udb_result_handle_result */
 
 static int udb_result_prepare_result (udb_result_t const *r, /* {{{ */
     udb_result_preparation_area_t *prep_area,
     char **column_names, size_t column_num)
 {
-  size_t i;
-
   if ((r == NULL) || (prep_area == NULL))
     return (-EINVAL);
 
 #define BAIL_OUT(status) \
   prep_area->ds = NULL; \
   sfree (prep_area->instances_pos); \
@@ -380,16 +387,16 @@
     ERROR ("db query utils: udb_result_prepare_result: Type `%s' is not "
         "known by the daemon. See types.db(5) for details.",
         r->type);
     BAIL_OUT (-1);
   }
 
-  if (((size_t) prep_area->ds->ds_num) != r->values_num)
+  if (prep_area->ds->ds_num != r->values_num)
   {
     ERROR ("db query utils: udb_result_prepare_result: The type `%s' "
-        "requires exactly %i value%s, but the configuration specifies %zu.",
+        "requires exactly %zu value%s, but the configuration specifies %zu.",
         r->type,
         prep_area->ds->ds_num, (prep_area->ds->ds_num == 1) ? "" : "s",
         r->values_num);
     BAIL_OUT (-1);
   }
   /* }}} */
@@ -399,61 +406,61 @@
   if (r->instances_num > 0)
   {
     prep_area->instances_pos
       = (size_t *) calloc (r->instances_num, sizeof (size_t));
     if (prep_area->instances_pos == NULL)
     {
-      ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+      ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
       BAIL_OUT (-ENOMEM);
     }
 
     prep_area->instances_buffer
       = (char **) calloc (r->instances_num, sizeof (char *));
     if (prep_area->instances_buffer == NULL)
     {
-      ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+      ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
       BAIL_OUT (-ENOMEM);
     }
   } /* if (r->instances_num > 0) */
 
   prep_area->values_pos
     = (size_t *) calloc (r->values_num, sizeof (size_t));
   if (prep_area->values_pos == NULL)
   {
-    ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+    ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
     BAIL_OUT (-ENOMEM);
   }
 
   prep_area->values_buffer
     = (char **) calloc (r->values_num, sizeof (char *));
   if (prep_area->values_buffer == NULL)
   {
-    ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+    ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
     BAIL_OUT (-ENOMEM);
   }
 
   prep_area->metadata_pos
     = (size_t *) calloc (r->metadata_num, sizeof (size_t));
   if (prep_area->metadata_pos == NULL)
   {
-    ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+    ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
     BAIL_OUT (-ENOMEM);
   }
 
   prep_area->metadata_buffer
     = (char **) calloc (r->metadata_num, sizeof (char *));
   if (prep_area->metadata_buffer == NULL)
   {
-    ERROR ("db query utils: udb_result_prepare_result: malloc failed.");
+    ERROR ("db query utils: udb_result_prepare_result: calloc failed.");
     BAIL_OUT (-ENOMEM);
   }
 
   /* }}} */
 
-  /* Determine the position of the instance columns {{{ */
-  for (i = 0; i < r->instances_num; i++)
+  /* Determine the position of the plugin instance column {{{ */
+  for (size_t i = 0; i < r->instances_num; i++)
   {
     size_t j;
 
     for (j = 0; j < column_num; j++)
     {
       if (strcasecmp (r->instances[i], column_names[j]) == 0)
@@ -469,14 +476,15 @@
           "Column `%s' could not be found.",
           r->instances[i]);
       BAIL_OUT (-ENOENT);
     }
   } /* }}} for (i = 0; i < r->instances_num; i++) */
 
+
   /* Determine the position of the value columns {{{ */
-  for (i = 0; i < r->values_num; i++)
+  for (size_t i = 0; i < r->values_num; i++)
   {
     size_t j;
 
     for (j = 0; j < column_num; j++)
     {
       if (strcasecmp (r->values[i], column_names[j]) == 0)
@@ -493,13 +501,13 @@
           r->values[i]);
       BAIL_OUT (-ENOENT);
     }
   } /* }}} for (i = 0; i < r->values_num; i++) */
 
   /* Determine the position of the metadata columns {{{ */
-  for (i = 0; i < r->metadata_num; i++)
+  for (size_t i = 0; i < r->metadata_num; i++)
   {
     size_t j;
 
     for (j = 0; j < column_num; j++)
     {
       if (strcasecmp (r->metadata[i], column_names[j]) == 0)
@@ -521,28 +529,27 @@
 #undef BAIL_OUT
   return (0);
 } /* }}} int udb_result_prepare_result */
 
 static void udb_result_free (udb_result_t *r) /* {{{ */
 {
-  size_t i;
-
   if (r == NULL)
     return;
 
   sfree (r->type);
+  sfree (r->instance_prefix);
 
-  for (i = 0; i < r->instances_num; i++)
+  for (size_t i = 0; i < r->instances_num; i++)
     sfree (r->instances[i]);
   sfree (r->instances);
 
-  for (i = 0; i < r->values_num; i++)
+  for (size_t i = 0; i < r->values_num; i++)
     sfree (r->values[i]);
   sfree (r->values);
 
-  for (i = 0; i < r->metadata_num; i++)
+  for (size_t i = 0; i < r->metadata_num; i++)
     sfree (r->metadata[i]);
   sfree (r->metadata);
 
   udb_result_free (r->next);
 
   sfree (r);
@@ -550,38 +557,36 @@
 
 static int udb_result_create (const char *query_name, /* {{{ */
     udb_result_t **r_head, oconfig_item_t *ci)
 {
   udb_result_t *r;
   int status;
-  int i;
 
   if (ci->values_num != 0)
   {
     WARNING ("db query utils: The `Result' block doesn't accept "
         "any arguments. Ignoring %i argument%s.",
         ci->values_num, (ci->values_num == 1) ? "" : "s");
   }
 
-  r = (udb_result_t *) malloc (sizeof (*r));
+  r = calloc (1, sizeof (*r));
   if (r == NULL)
   {
-    ERROR ("db query utils: malloc failed.");
+    ERROR ("db query utils: calloc failed.");
     return (-1);
   }
-  memset (r, 0, sizeof (*r));
   r->type = NULL;
   r->instance_prefix = NULL;
   r->instances = NULL;
   r->values = NULL;
   r->metadata = NULL;
   r->next = NULL;
 
   /* Fill the `udb_result_t' structure.. */
   status = 0;
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Type", child->key) == 0)
       status = udb_config_set_string (&r->type, child);
     else if (strcasecmp ("InstancePrefix", child->key) == 0)
@@ -654,12 +659,13 @@
 {
   if (q == NULL)
     return;
 
   sfree (q->name);
   sfree (q->statement);
+  sfree (q->plugin_instance_from);
 
   udb_result_free (q->results);
 
   sfree (q);
 } /* }}} void udb_query_free_one */
 
@@ -672,13 +678,12 @@
 {
   udb_query_t **query_list;
   size_t        query_list_len;
 
   udb_query_t *q;
   int status;
-  int i;
 
   if ((ret_query_list == NULL) || (ret_query_list_len == NULL))
     return (-EINVAL);
   query_list     = *ret_query_list;
   query_list_len = *ret_query_list_len;
 
@@ -687,42 +692,46 @@
   {
     WARNING ("db query utils: The `Query' block "
         "needs exactly one string argument.");
     return (-1);
   }
 
-  q = (udb_query_t *) malloc (sizeof (*q));
+  q = calloc (1, sizeof (*q));
   if (q == NULL)
   {
-    ERROR ("db query utils: malloc failed.");
+    ERROR ("db query utils: calloc failed.");
     return (-1);
   }
-  memset (q, 0, sizeof (*q));
   q->min_version = 0;
   q->max_version = UINT_MAX;
+  q->statement = NULL;
+  q->results = NULL;
+  q->plugin_instance_from = NULL;
 
   status = udb_config_set_string (&q->name, ci);
   if (status != 0)
   {
     sfree (q);
     return (status);
   }
 
   /* Fill the `udb_query_t' structure.. */
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Statement", child->key) == 0)
       status = udb_config_set_string (&q->statement, child);
     else if (strcasecmp ("Result", child->key) == 0)
       status = udb_result_create (q->name, &q->results, child);
     else if (strcasecmp ("MinVersion", child->key) == 0)
       status = udb_config_set_uint (&q->min_version, child);
     else if (strcasecmp ("MaxVersion", child->key) == 0)
       status = udb_config_set_uint (&q->max_version, child);
+    else if (strcasecmp ("PluginInstanceFrom", child->key) == 0)
+      status = udb_config_set_string (&q->plugin_instance_from, child);
 
     /* Call custom callbacks */
     else if (cb != NULL)
     {
       status = (*cb) (q, child);
       if (status != 0)
@@ -761,13 +770,13 @@
   /* If all went well, add this query to the list of queries within the
    * database structure. */
   if (status == 0)
   {
     udb_query_t **temp;
 
-    temp = (udb_query_t **) realloc (query_list,
+    temp = realloc (query_list,
         sizeof (*query_list) * (query_list_len + 1));
     if (temp == NULL)
     {
       ERROR ("db query utils: realloc failed");
       status = -1;
     }
@@ -790,49 +799,46 @@
 
   return (0);
 } /* }}} int udb_query_create */
 
 void udb_query_free (udb_query_t **query_list, size_t query_list_len) /* {{{ */
 {
-  size_t i;
-
   if (query_list == NULL)
     return;
 
-  for (i = 0; i < query_list_len; i++)
+  for (size_t i = 0; i < query_list_len; i++)
     udb_query_free_one (query_list[i]);
 
   sfree (query_list);
 } /* }}} void udb_query_free */
 
 int udb_query_pick_from_list_by_name (const char *name, /* {{{ */
     udb_query_t **src_list, size_t src_list_len,
     udb_query_t ***dst_list, size_t *dst_list_len)
 {
-  size_t i;
   int num_added;
 
   if ((name == NULL) || (src_list == NULL) || (dst_list == NULL)
       || (dst_list_len == NULL))
   {
     ERROR ("db query utils: udb_query_pick_from_list_by_name: "
         "Invalid argument.");
     return (-EINVAL);
   }
 
   num_added = 0;
-  for (i = 0; i < src_list_len; i++)
+  for (size_t i = 0; i < src_list_len; i++)
   {
     udb_query_t **tmp_list;
     size_t tmp_list_len;
 
     if (strcasecmp (name, src_list[i]->name) != 0)
       continue;
 
     tmp_list_len = *dst_list_len;
-    tmp_list = (udb_query_t **) realloc (*dst_list, (tmp_list_len + 1)
+    tmp_list = realloc (*dst_list, (tmp_list_len + 1)
         * sizeof (udb_query_t *));
     if (tmp_list == NULL)
     {
       ERROR ("db query utils: realloc failed.");
       return (-ENOMEM);
     }
@@ -978,15 +984,13 @@
     return (-EINVAL);
   }
 
 #if defined(COLLECT_DEBUG) && COLLECT_DEBUG /* {{{ */
   do
   {
-    size_t i;
-
-    for (i = 0; i < prep_area->column_num; i++)
+    for (size_t i = 0; i < prep_area->column_num; i++)
     {
       DEBUG ("db query utils: udb_query_handle_result (%s, %s): "
           "column[%zu] = %s;",
           prep_area->db_name, q->name, i, column_values[i]);
     }
   } while (0);
@@ -1041,23 +1045,46 @@
     return (-ENOMEM);
   }
 
 #if defined(COLLECT_DEBUG) && COLLECT_DEBUG
   do
   {
-    size_t i;
-
-    for (i = 0; i < column_num; i++)
+    for (size_t i = 0; i < column_num; i++)
     {
       DEBUG ("db query utils: udb_query_prepare_result: "
           "query = %s; column[%zu] = %s;",
           q->name, i, column_names[i]);
     }
   } while (0);
 #endif
 
+  /* Determine the position of the PluginInstance column {{{ */
+  if (q->plugin_instance_from != NULL)
+  {
+    size_t i;
+
+    for (i = 0; i < column_num; i++)
+    {
+      if (strcasecmp (q->plugin_instance_from, column_names[i]) == 0)
+      {
+        prep_area->plugin_instance_pos = i;
+        break;
+      }
+    }
+
+    if (i >= column_num)
+    {
+      ERROR ("db query utils: udb_query_prepare_result: "
+          "Column `%s' from `PluginInstanceFrom' could not be found.",
+          q->plugin_instance_from);
+      udb_query_finish_result (q, prep_area);
+      return (-ENOENT);
+    }
+  }
+  /* }}} */
+
   for (r = q->results, r_area = prep_area->result_prep_areas;
       r != NULL; r = r->next, r_area = r_area->next)
   {
     if (! r_area)
     {
       ERROR ("db query utils: Query `%s': Invalid number of result "
@@ -1081,23 +1108,22 @@
 udb_query_allocate_preparation_area (udb_query_t *q) /* {{{ */
 {
   udb_query_preparation_area_t   *q_area;
   udb_result_preparation_area_t **next_r_area;
   udb_result_t *r;
 
-  q_area = malloc (sizeof (*q_area));
+  q_area = calloc (1, sizeof (*q_area));
   if (q_area == NULL)
     return NULL;
-  memset (q_area, 0, sizeof (*q_area));
 
   next_r_area = &q_area->result_prep_areas;
   for (r = q->results; r != NULL; r = r->next)
   {
     udb_result_preparation_area_t *r_area;
 
-    r_area = malloc (sizeof (*r_area));
+    r_area = calloc (1, sizeof (*r_area));
     if (r_area == NULL)
     {
       udb_result_preparation_area_t *a = q_area->result_prep_areas;
 
       while (a != NULL)
       {
@@ -1107,14 +1133,12 @@
       }
 
       free (q_area);
       return NULL;
     }
 
-    memset (r_area, 0, sizeof (*r_area));
-
     *next_r_area = r_area;
     next_r_area  = &r_area->next;
   }
 
   return (q_area);
 } /* }}} udb_query_preparation_area_t *udb_query_allocate_preparation_area */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_db_query.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_db_query.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_db_query.h	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_db_query.h	2016-09-11 16:10:25.275038704 +0800
@@ -24,27 +24,25 @@
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #ifndef UTILS_DB_QUERY_H
 #define UTILS_DB_QUERY_H 1
 
-#include "configfile.h"
-
 /*
  * Data types
  */
 struct udb_query_s;
 typedef struct udb_query_s udb_query_t;
 
 struct udb_query_preparation_area_s;
 typedef struct udb_query_preparation_area_s udb_query_preparation_area_t;
 
 typedef int (*udb_query_create_callback_t) (udb_query_t *q,
     oconfig_item_t *ci);
 
-/* 
+/*
  * Public functions
  */
 int udb_query_create (udb_query_t ***ret_query_list,
     size_t *ret_query_list_len, oconfig_item_t *ci,
     udb_query_create_callback_t cb);
 void udb_query_free (udb_query_t **query_list, size_t query_list_len);
@@ -59,13 +57,13 @@
 const char *udb_query_get_name (udb_query_t *q);
 const char *udb_query_get_statement (udb_query_t *q);
 
 void  udb_query_set_user_data (udb_query_t *q, void *user_data);
 void *udb_query_get_user_data (udb_query_t *q);
 
-/* 
+/*
  * udb_query_check_version
  *
  * Returns 0 if the query is NOT suitable for `version' and >0 if the
  * query IS suitable.
  */
 int udb_query_check_version (udb_query_t *q, unsigned int version);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_dns.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_dns.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_dns.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_dns.c	2016-09-11 16:10:25.275038704 +0800
@@ -34,19 +34,16 @@
  */
 
 #define _DEFAULT_SOURCE
 #define _BSD_SOURCE
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
 
-#if HAVE_SYS_SOCKET_H
-# include <sys/socket.h>
-#endif
-
 #if HAVE_NET_IF_ARP_H
 # include <net/if_arp.h>
 #endif
 #if HAVE_NET_IF_H
 # include <net/if.h>
 #endif
@@ -63,15 +60,12 @@
 #if HAVE_NETINET_IN_H
 # include <netinet/in.h>
 #endif
 #if HAVE_NETINET_IP6_H
 # include <netinet/ip6.h>
 #endif
-#if HAVE_NETINET_IP_COMPAT_H
-# include <netinet/ip_compat.h>
-#endif
 #if HAVE_NETINET_IF_ETHER_H
 # include <netinet/if_ether.h>
 #endif
 #if HAVE_NETINET_IP_H
 # include <netinet/ip.h>
 #endif
@@ -160,15 +154,12 @@
 #define T_SRV 33
 #endif
 
 /*
  * Global variables
  */
-int qtype_counts[T_MAX];
-int opcode_counts[OP_MAX];
-int qclass_counts[C_MAX];
 
 #if HAVE_PCAP_H
 static pcap_t *pcap_obj = NULL;
 #endif
 
 static ip_list_t *IgnoreList = NULL;
@@ -201,28 +192,26 @@
 
     return (a->s6_addr[i] > b->s6_addr[i] ? 1 : -1);
 } /* int cmp_addrinfo */
 
 static inline int ignore_list_match (const struct in6_addr *addr)
 {
-    ip_list_t *ptr;
-
-    for (ptr = IgnoreList; ptr != NULL; ptr = ptr->next)
+    for (ip_list_t *ptr = IgnoreList; ptr != NULL; ptr = ptr->next)
 	if (cmp_in6_addr (addr, &ptr->addr) == 0)
 	    return (1);
     return (0);
 } /* int ignore_list_match */
 
 static void ignore_list_add (const struct in6_addr *addr)
 {
     ip_list_t *new;
 
     if (ignore_list_match (addr) != 0)
 	return;
 
-    new = malloc (sizeof (ip_list_t));
+    new = malloc (sizeof (*new));
     if (new == NULL)
     {
 	perror ("malloc");
 	return;
     }
 
@@ -232,21 +221,20 @@
     IgnoreList = new;
 } /* void ignore_list_add */
 
 void ignore_list_add_name (const char *name)
 {
     struct addrinfo *ai_list;
-    struct addrinfo *ai_ptr;
     struct in6_addr  addr;
     int status;
 
     status = getaddrinfo (name, NULL, NULL, &ai_list);
     if (status != 0)
 	return;
 
-    for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+    for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
     {
 	if (ai_ptr->ai_family == AF_INET)
 	{
 	    memset (&addr, '\0', sizeof (addr));
 	    addr.s6_addr[10] = 0xFF;
 	    addr.s6_addr[11] = 0xFF;
@@ -290,54 +278,52 @@
 {
 	Callback = cb;
 }
 
 #define RFC1035_MAXLABELSZ 63
 static int
-rfc1035NameUnpack(const char *buf, size_t sz, off_t * off, char *name, size_t ns
-)
+rfc1035NameUnpack(const char *buf, size_t sz, off_t * off, char *name, size_t ns)
 {
     off_t no = 0;
     unsigned char c;
     size_t len;
     static int loop_detect = 0;
     if (loop_detect > 2)
 	return 4;		/* compression loop */
-    if (ns <= 0)
+    if (ns == 0)
 	return 4;		/* probably compression loop */
     do {
-	if ((*off) >= sz)
+	if ((*off) >= ((off_t) sz))
 	    break;
 	c = *(buf + (*off));
 	if (c > 191) {
 	    /* blasted compression */
 	    int rc;
 	    unsigned short s;
 	    off_t ptr;
 	    memcpy(&s, buf + (*off), sizeof(s));
 	    s = ntohs(s);
 	    (*off) += sizeof(s);
 	    /* Sanity check */
-	    if ((*off) >= sz)
+	    if ((*off) >= ((off_t) sz))
 		return 1;	/* message too short */
 	    ptr = s & 0x3FFF;
 	    /* Make sure the pointer is inside this message */
-	    if (ptr >= sz)
+	    if (ptr >= ((off_t) sz))
 		return 2;	/* bad compression ptr */
 	    if (ptr < DNS_MSG_HDR_SZ)
 		return 2;	/* bad compression ptr */
 	    loop_detect++;
 	    rc = rfc1035NameUnpack(buf, sz, &ptr, name + no, ns - no);
 	    loop_detect--;
 	    return rc;
 	} else if (c > RFC1035_MAXLABELSZ) {
 	    /*
 	     * "(The 10 and 01 combinations are reserved for future use.)"
 	     */
 	    return 3;		/* reserved label/compression flags */
-	    break;
 	} else {
 	    (*off)++;
 	    len = (size_t) c;
 	    if (len == 0)
 		break;
 	    if (len > (ns - 1))
@@ -352,13 +338,13 @@
 	    *(name + (no++)) = '.';
 	}
     } while (c > 0);
     if (no > 0)
 	*(name + no - 1) = '\0';
     /* make sure we didn't allow someone to overflow the name buffer */
-    assert(no <= ns);
+    assert(no <= ((off_t) ns));
     return 0;
 }
 
 static int
 handle_dns(const char *buf, int len)
 {
@@ -422,17 +408,12 @@
     qh.qtype = ntohs(us);
     memcpy(&us, buf + offset + 2, 2);
     qh.qclass = ntohs(us);
 
     qh.length = (uint16_t) len;
 
-    /* gather stats */
-    qtype_counts[qh.qtype]++;
-    qclass_counts[qh.qclass]++;
-    opcode_counts[qh.opcode]++;
-
     if (Callback != NULL)
 	    Callback (&qh);
 
     return 1;
 }
 
@@ -543,13 +524,13 @@
     in6_addr_from_buffer (&c_src_addr, &ip->ip_src.s_addr, sizeof (ip->ip_src.s_addr), AF_INET);
     in6_addr_from_buffer (&c_dst_addr, &ip->ip_dst.s_addr, sizeof (ip->ip_dst.s_addr), AF_INET);
     if (ignore_list_match (&c_src_addr))
 	    return (0);
     if (IPPROTO_UDP != ip->ip_p)
 	return 0;
-    memcpy(buf, (void *) ip + offset, len - offset);
+    memcpy(buf, ((char *)ip) + offset, len - offset);
     if (0 == handle_udp((struct udphdr *) buf, len - offset))
 	return 0;
     return 1;
 }
 
 #if HAVE_NET_IF_PPP_H
@@ -765,28 +746,47 @@
 	    case ns_t_nxt:      return ("NXT");
 	    case ns_t_eid:      return ("EID");
 	    case ns_t_nimloc:   return ("NIMLOC");
 	    case ns_t_srv:      return ("SRV");
 	    case ns_t_atma:     return ("ATMA");
 	    case ns_t_naptr:    return ("NAPTR");
+	    case ns_t_opt:      return ("OPT");
+# if __NAMESER >= 19991006
 	    case ns_t_kx:       return ("KX");
 	    case ns_t_cert:     return ("CERT");
 	    case ns_t_a6:       return ("A6");
 	    case ns_t_dname:    return ("DNAME");
 	    case ns_t_sink:     return ("SINK");
-	    case ns_t_opt:      return ("OPT");
-# if __NAMESER >= 19991006
 	    case ns_t_tsig:     return ("TSIG");
 # endif
+# if __NAMESER >= 20090302
+	    case ns_t_apl:      return ("APL");
+	    case ns_t_ds:       return ("DS");
+	    case ns_t_sshfp:    return ("SSHFP");
+	    case ns_t_ipseckey: return ("IPSECKEY");
+	    case ns_t_rrsig:    return ("RRSIG");
+	    case ns_t_nsec:     return ("NSEC");
+	    case ns_t_dnskey:   return ("DNSKEY");
+	    case ns_t_dhcid:    return ("DHCID");
+	    case ns_t_nsec3:    return ("NSEC3");
+	    case ns_t_nsec3param: return ("NSEC3PARAM");
+	    case ns_t_hip:      return ("HIP");
+	    case ns_t_spf:      return ("SPF");
 	    case ns_t_ixfr:     return ("IXFR");
+# endif
 	    case ns_t_axfr:     return ("AXFR");
 	    case ns_t_mailb:    return ("MAILB");
 	    case ns_t_maila:    return ("MAILA");
 	    case ns_t_any:      return ("ANY");
+# if __NAMESER >= 19991006
 	    case ns_t_zxfr:     return ("ZXFR");
-/* #endif __NAMESER >= 19991006 */
+# endif
+# if __NAMESER >= 20090302
+	    case ns_t_dlv:       return ("DLV");
+# endif
+/* #endif __NAMESER >= 19991001 */
 #elif (defined (__BIND)) && (__BIND >= 19950621)
 	    case T_A:		return ("A"); /* 1 ... */
 	    case T_NS:		return ("NS");
 	    case T_MD:		return ("MD");
 	    case T_MF:		return ("MF");
 	    case T_CNAME:	return ("CNAME");
@@ -842,41 +842,33 @@
 	    case T_MAILA:	return ("MAILA");
 	    case T_ANY:		return ("ANY"); /* ... 255 */
 #endif /* __BIND >= 19950621 */
 	    default:
 		    ssnprintf (buf, sizeof (buf), "#%i", t);
 		    return (buf);
-    }; /* switch (t) */
-    /* NOTREACHED */
-    return (NULL);
+    } /* switch (t) */
 }
 
 const char *opcode_str (int o)
 {
     static char buf[30];
     switch (o) {
     case 0:
 	return "Query";
-	break;
     case 1:
 	return "Iquery";
-	break;
     case 2:
 	return "Status";
-	break;
     case 4:
 	return "Notify";
-	break;
     case 5:
 	return "Update";
-	break;
     default:
 	ssnprintf(buf, sizeof (buf), "Opcode%d", o);
 	return buf;
     }
-    /* NOTREACHED */
 }
 
 const char *rcode_str (int rcode)
 {
 	static char buf[32];
 	switch (rcode)
@@ -914,14 +906,12 @@
 #endif  /* RFC2136 rcodes */
 #endif /* __BIND >= 19950621 */
 		default:
 			ssnprintf (buf, sizeof (buf), "RCode%i", rcode);
 			return (buf);
 	}
-	/* Never reached */
-	return (NULL);
 } /* const char *rcode_str (int rcode) */
 
 #if 0
 static int
 main(int argc, char *argv[])
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_dns.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_dns.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_dns.h	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_dns.h	2016-09-11 16:10:25.275038704 +0800
@@ -1,15 +1,15 @@
 /*
  * collectd - src/utils_dns.h
  * Copyright (C) 2006       Florian octo Forster
  * Copyright (C) 2002       The Measurement Factory, Inc.
  * All rights reserved.
- * 
+ *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions are met:
- * 
+ *
  * 1. Redistributions of source code must retain the above copyright notice,
  *    this list of conditions and the following disclaimer.
  * 2. Redistributions in binary form must reproduce the above copyright notice,
  *    this list of conditions and the following disclaimer in the documentation
  *    and/or other materials provided with the distribution.
  * 3. Neither the name of The Measurement Factory nor the names of its
@@ -45,14 +45,12 @@
 # include <pcap.h>
 #endif
 
 #define DNS_MSG_HDR_SZ 12
 
 #define T_MAX 65536
-#define OP_MAX 16
-#define C_MAX 65536
 #define MAX_QNAME_SZ 512
 
 struct rfc1035_header_s {
     uint16_t id;
     unsigned int qr:1;
     unsigned int opcode:4;
@@ -72,16 +70,12 @@
     uint16_t qclass;
     char     qname[MAX_QNAME_SZ];
     uint16_t length;
 };
 typedef struct rfc1035_header_s rfc1035_header_t;
 
-extern int qtype_counts[T_MAX];
-extern int opcode_counts[OP_MAX];
-extern int qclass_counts[C_MAX];
-
 #if HAVE_PCAP_H
 void dnstop_set_pcap_obj (pcap_t *po);
 #endif
 void dnstop_set_callback (void (*cb) (const rfc1035_header_t *));
 
 void ignore_list_add_name (const char *name);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_fbhash.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_fbhash.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_fbhash.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_fbhash.c	2016-09-11 16:10:25.275038704 +0800
@@ -22,15 +22,14 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
-#include "plugin.h"
 
-#include <pthread.h>
+#include "plugin.h"
 
 #include "utils_fbhash.h"
 #include "utils_avltree.h"
 
 struct fbhash_s
 {
@@ -68,35 +67,32 @@
 } /* }}} void fbh_free_tree */
 
 static int fbh_read_file (fbhash_t *h) /* {{{ */
 {
   FILE *fh;
   char buffer[4096];
-  struct flock fl;
+  struct flock fl = { 0 };
   c_avl_tree_t *tree;
   int status;
 
   fh = fopen (h->filename, "r");
   if (fh == NULL)
     return (-1);
 
-  memset (&fl, 0, sizeof (fl));
   fl.l_type = F_RDLCK;
   fl.l_whence = SEEK_SET;
-  fl.l_start = 0;
-  fl.l_len = 0; /* == entire file */
   /* TODO: Lock file? -> fcntl */
 
   status = fcntl (fileno (fh), F_SETLK, &fl);
   if (status != 0)
   {
     fclose (fh);
     return (-1);
   }
 
-  tree = c_avl_create ((void *) strcmp);
+  tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
   if (tree == NULL)
   {
     fclose (fh);
     return (-1);
   }
 
@@ -176,17 +172,15 @@
 
   return (0);
 } /* }}} int fbh_read_file */
 
 static int fbh_check_file (fbhash_t *h) /* {{{ */
 {
-  struct stat statbuf;
+  struct stat statbuf = { 0 };
   int status;
 
-  memset (&statbuf, 0, sizeof (statbuf));
-
   status = stat (h->filename, &statbuf);
   if (status != 0)
     return (-1);
 
   if (h->mtime >= statbuf.st_mtime)
     return (0);
@@ -206,16 +200,15 @@
   fbhash_t *h;
   int status;
 
   if (file == NULL)
     return (NULL);
 
-  h = malloc (sizeof (*h));
+  h = calloc (1, sizeof (*h));
   if (h == NULL)
     return (NULL);
-  memset (h, 0, sizeof (*h));
 
   h->filename = strdup (file);
   if (h->filename == NULL)
   {
     free (h);
     return (NULL);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_graphite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_graphite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_graphite.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_graphite.c	2016-09-11 16:10:25.275038704 +0800
@@ -81,20 +82,18 @@
     return (0);
 }
 
 static void gr_copy_escape_part (char *dst, const char *src, size_t dst_len,
     char escape_char)
 {
-    size_t i;
-
     memset (dst, 0, dst_len);
 
     if (src == NULL)
         return;
 
-    for (i = 0; i < dst_len; i++)
+    for (size_t i = 0; i < dst_len; i++)
     {
         if (src[i] == 0)
         {
             dst[i] = 0;
             break;
         }
@@ -169,36 +168,33 @@
 
     return (0);
 }
 
 static void escape_graphite_string (char *buffer, char escape_char)
 {
-	char *head;
-
 	assert (strchr(GRAPHITE_FORBIDDEN, escape_char) == NULL);
 
-	for (head = buffer + strcspn(buffer, GRAPHITE_FORBIDDEN);
+	for (char *head = buffer + strcspn(buffer, GRAPHITE_FORBIDDEN);
 	     *head != '\0';
 	     head += strcspn(head, GRAPHITE_FORBIDDEN))
 		*head = escape_char;
 }
 
 int format_graphite (char *buffer, size_t buffer_size,
     data_set_t const *ds, value_list_t const *vl,
     char const *prefix, char const *postfix, char const escape_char,
     unsigned int flags)
 {
     int status = 0;
-    int i;
     int buffer_pos = 0;
 
     gauge_t *rates = NULL;
     if (flags & GRAPHITE_STORE_RATES)
       rates = uc_get_rate (ds, vl);
 
-    for (i = 0; i < ds->ds_num; i++)
+    for (size_t i = 0; i < ds->ds_num; i++)
     {
         char const *ds_name = NULL;
         char        key[10*DATA_MAX_NAME_LEN];
         char        values[512];
         size_t      message_len;
         char        message[1024];
@@ -247,13 +243,12 @@
             ERROR ("format_graphite: target buffer too small");
             sfree (rates);
             return (-ENOMEM);
         }
         memcpy((void *) (buffer + buffer_pos), message, message_len);
         buffer_pos += message_len;
-        buffer[buffer_pos] = '\0';
     }
     sfree (rates);
     return (status);
 } /* int format_graphite */
 
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_json.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_json.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_json.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_json.c	2016-09-11 16:10:25.275038704 +0800
@@ -1,9 +1,9 @@
 /**
  * collectd - src/utils_format_json.c
- * Copyright (C) 2009       Florian octo Forster
+ * Copyright (C) 2009-2015  Florian octo Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -22,22 +22,33 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
+#include "utils_format_json.h"
+
 #include "plugin.h"
 #include "common.h"
-
 #include "utils_cache.h"
-#include "utils_format_json.h"
+
+#if HAVE_LIBYAJL
+# include <yajl/yajl_common.h>
+# include <yajl/yajl_gen.h>
+# if HAVE_YAJL_YAJL_VERSION_H
+#  include <yajl/yajl_version.h>
+# endif
+# if defined(YAJL_MAJOR) && (YAJL_MAJOR > 1)
+#  define HAVE_YAJL_V2 1
+# endif
+#endif
 
 static int json_escape_string (char *buffer, size_t buffer_size, /* {{{ */
     const char *string)
 {
-  size_t src_pos;
   size_t dst_pos;
 
   if ((buffer == NULL) || (string == NULL))
     return (-EINVAL);
 
   if (buffer_size < 3)
@@ -53,13 +64,13 @@
   buffer[dst_pos] = (c); \
   dst_pos++; \
 } while (0)
 
   /* Escape special characters */
   BUFFER_ADD ('"');
-  for (src_pos = 0; string[src_pos] != 0; src_pos++)
+  for (size_t src_pos = 0; string[src_pos] != 0; src_pos++)
   {
     if ((string[src_pos] == '"')
         || (string[src_pos] == '\\'))
     {
       BUFFER_ADD ('\\');
       BUFFER_ADD (string[src_pos]);
@@ -78,13 +89,12 @@
 } /* }}} int json_escape_string */
 
 static int values_to_json (char *buffer, size_t buffer_size, /* {{{ */
                 const data_set_t *ds, const value_list_t *vl, int store_rates)
 {
   size_t offset = 0;
-  int i;
   gauge_t *rates = NULL;
 
   memset (buffer, 0, buffer_size);
 
 #define BUFFER_ADD(...) do { \
   int status; \
@@ -102,13 +112,13 @@
   } \
   else \
     offset += ((size_t) status); \
 } while (0)
 
   BUFFER_ADD ("[");
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     if (i > 0)
       BUFFER_ADD (",");
 
     if (ds->ds[i].type == DS_TYPE_GAUGE)
     {
@@ -157,13 +167,12 @@
 } /* }}} int values_to_json */
 
 static int dstypes_to_json (char *buffer, size_t buffer_size, /* {{{ */
                 const data_set_t *ds)
 {
   size_t offset = 0;
-  int i;
 
   memset (buffer, 0, buffer_size);
 
 #define BUFFER_ADD(...) do { \
   int status; \
   status = ssnprintf (buffer + offset, buffer_size - offset, \
@@ -174,13 +183,13 @@
     return (-ENOMEM); \
   else \
     offset += ((size_t) status); \
 } while (0)
 
   BUFFER_ADD ("[");
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     if (i > 0)
       BUFFER_ADD (",");
 
     BUFFER_ADD ("\"%s\"", DS_TYPE_TO_STRING (ds->ds[i].type));
   } /* for ds->ds_num */
@@ -194,13 +203,12 @@
 } /* }}} int dstypes_to_json */
 
 static int dsnames_to_json (char *buffer, size_t buffer_size, /* {{{ */
                 const data_set_t *ds)
 {
   size_t offset = 0;
-  int i;
 
   memset (buffer, 0, buffer_size);
 
 #define BUFFER_ADD(...) do { \
   int status; \
   status = ssnprintf (buffer + offset, buffer_size - offset, \
@@ -211,13 +219,13 @@
     return (-ENOMEM); \
   else \
     offset += ((size_t) status); \
 } while (0)
 
   BUFFER_ADD ("[");
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     if (i > 0)
       BUFFER_ADD (",");
 
     BUFFER_ADD ("\"%s\"", ds->ds[i].name);
   } /* for ds->ds_num */
@@ -232,13 +240,12 @@
 
 static int meta_data_keys_to_json (char *buffer, size_t buffer_size, /* {{{ */
     meta_data_t *meta, char **keys, size_t keys_num)
 {
   size_t offset = 0;
   int status;
-  size_t i;
 
   buffer[0] = 0;
 
 #define BUFFER_ADD(...) do { \
   status = ssnprintf (buffer + offset, buffer_size - offset, \
       __VA_ARGS__); \
@@ -247,13 +254,13 @@
   else if (((size_t) status) >= (buffer_size - offset)) \
     return (-ENOMEM); \
   else \
     offset += ((size_t) status); \
 } while (0)
 
-  for (i = 0; i < keys_num; ++i)
+  for (size_t i = 0; i < keys_num; ++i)
   {
     int type;
     char *key = keys[i];
 
     type = meta_data_type (meta, key);
     if (type == MD_TYPE_STRING)
@@ -294,13 +301,13 @@
       _Bool value = 0;
       if (meta_data_get_boolean (meta, key, &value) == 0)
         BUFFER_ADD (",\"%s\":%s", key, value ? "true" : "false");
     }
   } /* for (keys) */
 
-  if (offset <= 0)
+  if (offset == 0)
     return (ENOENT);
 
   buffer[0] = '{'; /* replace leading ',' */
   BUFFER_ADD ("}");
 
 #undef BUFFER_ADD
@@ -311,25 +318,24 @@
 static int meta_data_to_json (char *buffer, size_t buffer_size, /* {{{ */
     meta_data_t *meta)
 {
   char **keys = NULL;
   size_t keys_num;
   int status;
-  size_t i;
 
   if ((buffer == NULL) || (buffer_size == 0) || (meta == NULL))
     return (EINVAL);
 
   status = meta_data_toc (meta, &keys);
   if (status <= 0)
     return (status);
   keys_num = (size_t) status;
 
   status = meta_data_keys_to_json (buffer, buffer_size, meta, keys, keys_num);
 
-  for (i = 0; i < keys_num; ++i)
+  for (size_t i = 0; i < keys_num; ++i)
     sfree (keys[i]);
   sfree (keys);
 
   return status;
 } /* }}} int meta_data_to_json */
 
@@ -495,7 +501,218 @@
 
   return (format_json_value_list_nocheck (buffer,
         ret_buffer_fill, ret_buffer_free, ds, vl,
         store_rates, (*ret_buffer_free) - 2));
 } /* }}} int format_json_value_list */
 
+#if HAVE_LIBYAJL
+static int json_add_string (yajl_gen g, char const *str) /* {{{ */
+{
+  if (str == NULL)
+    return (int) yajl_gen_null (g);
+
+  return (int) yajl_gen_string (g, (unsigned char const *) str, (unsigned int) strlen (str));
+} /* }}} int json_add_string */
+
+#define JSON_ADD(g, str) do {                        \
+  yajl_gen_status status = json_add_string (g, str); \
+  if (status != yajl_gen_status_ok) { return -1; }   \
+} while (0)
+
+#define JSON_ADDF(g, format, ...) do {               \
+  char *str = ssnprintf_alloc (format, __VA_ARGS__); \
+  yajl_gen_status status = json_add_string (g, str); \
+  free (str);                                        \
+  if (status != yajl_gen_status_ok) { return -1; }   \
+} while (0)
+
+static int format_json_meta (yajl_gen g, notification_meta_t *meta) /* {{{ */
+{
+  if (meta == NULL)
+    return 0;
+
+  JSON_ADD (g, meta->name);
+  switch (meta->type)
+  {
+    case NM_TYPE_STRING:
+      JSON_ADD (g, meta->nm_value.nm_string);
+      break;
+    case NM_TYPE_SIGNED_INT:
+      JSON_ADDF (g, "%"PRIi64, meta->nm_value.nm_signed_int);
+      break;
+    case NM_TYPE_UNSIGNED_INT:
+      JSON_ADDF (g, "%"PRIu64, meta->nm_value.nm_unsigned_int);
+      break;
+    case NM_TYPE_DOUBLE:
+      JSON_ADDF (g, JSON_GAUGE_FORMAT, meta->nm_value.nm_double);
+      break;
+    case NM_TYPE_BOOLEAN:
+      JSON_ADD (g, meta->nm_value.nm_boolean ? "true" : "false");
+      break;
+    default:
+      ERROR ("format_json_meta: unknown meta data type %d (name \"%s\")", meta->type, meta->name);
+      yajl_gen_null (g);
+  }
+
+  return format_json_meta (g, meta->next);
+} /* }}} int format_json_meta */
+
+static int format_time (yajl_gen g, cdtime_t t) /* {{{ */
+{
+  char buffer[RFC3339NANO_SIZE] = "";
+
+  if (rfc3339nano (buffer, sizeof (buffer), t) != 0)
+    return -1;
+
+  JSON_ADD (g, buffer);
+  return 0;
+} /* }}} int format_time */
+
+static int format_alert (yajl_gen g, notification_t const *n) /* {{{ */
+{
+  yajl_gen_array_open (g);
+  yajl_gen_map_open (g); /* BEGIN alert */
+
+  /*
+   * labels
+   */
+  JSON_ADD (g, "labels");
+  yajl_gen_map_open (g); /* BEGIN labels */
+
+  JSON_ADD (g, "alertname");
+  if (strncmp (n->plugin, n->type, strlen (n->plugin)) == 0)
+    JSON_ADDF (g, "collectd_%s", n->type);
+  else
+    JSON_ADDF (g, "collectd_%s_%s", n->plugin, n->type);
+
+  JSON_ADD (g, "instance");
+  JSON_ADD (g, n->host);
+
+  /* mangling of plugin instance and type instance into labels is copied from
+   * the Prometheus collectd exporter. */
+  if (strlen (n->plugin_instance) > 0)
+  {
+    JSON_ADD (g, n->plugin);
+    JSON_ADD (g, n->plugin_instance);
+  }
+  if (strlen (n->type_instance) > 0)
+  {
+    if (strlen (n->plugin_instance) > 0)
+      JSON_ADD (g, "type");
+    else
+      JSON_ADD (g, n->plugin);
+    JSON_ADD (g, n->type_instance);
+  }
+
+  JSON_ADD (g, "severity");
+  JSON_ADD (g, (n->severity == NOTIF_FAILURE) ? "FAILURE"
+                   : (n->severity == NOTIF_WARNING) ? "WARNING"
+                   : (n->severity == NOTIF_OKAY) ? "OKAY"
+                   : "UNKNOWN");
+
+  JSON_ADD (g, "service");
+  JSON_ADD (g, "collectd");
+
+  yajl_gen_map_close (g); /* END labels */
+
+  /*
+   * annotations
+   */
+  JSON_ADD (g, "annotations");
+  yajl_gen_map_open (g); /* BEGIN annotations */
+
+  JSON_ADD (g, "summary");
+  JSON_ADD (g, n->message);
+
+  if (format_json_meta (g, n->meta) != 0)
+    return -1;
+
+  yajl_gen_map_close (g); /* END annotations */
+
+  JSON_ADD (g, "startsAt");
+  format_time (g, n->time);
+
+  yajl_gen_map_close (g); /* END alert */
+  yajl_gen_array_close (g);
+
+  return 0;
+} /* }}} format_alert */
+
+/*
+ * Format (prometheus/alertmanager v1):
+ *
+ * [{
+ *   "labels": {
+ *     "alertname": "collectd_cpu",
+ *     "instance":  "host.example.com",
+ *     "severity":  "FAILURE",
+ *     "service":   "collectd",
+ *     "cpu":       "0",
+ *     "type":      "wait"
+ *   },
+ *   "annotations": {
+ *     "summary": "...",
+ *     // meta
+ *   },
+ *   "startsAt": <rfc3339 time>,
+ *   "endsAt": <rfc3339 time>, // not used
+ * }]
+ */
+int format_json_notification (char *buffer, size_t buffer_size, /* {{{ */
+                              notification_t const *n)
+{
+  yajl_gen g;
+  unsigned char const *out;
+#if HAVE_YAJL_V2
+  size_t unused_out_len;
+#else
+  unsigned int unused_out_len;
+#endif
+
+  if ((buffer == NULL) || (n == NULL))
+    return EINVAL;
+
+#if HAVE_YAJL_V2
+  g = yajl_gen_alloc (NULL);
+  if (g == NULL)
+    return -1;
+# if COLLECT_DEBUG
+  yajl_gen_config (g, yajl_gen_beautify, 1);
+  yajl_gen_config (g, yajl_gen_validate_utf8, 1);
+# endif
+
+#else /* !HAVE_YAJL_V2 */
+  yajl_gen_config conf = { 0 };
+# if COLLECT_DEBUG
+  conf.beautify = 1;
+  conf.indentString = "  ";
+# endif
+  g = yajl_gen_alloc (&conf, NULL);
+  if (g == NULL)
+    return -1;
+#endif
+
+  if (format_alert (g, n) != 0)
+  {
+    yajl_gen_clear (g);
+    yajl_gen_free (g);
+    return -1;
+  }
+
+  /* copy to output buffer */
+  yajl_gen_get_buf (g, &out, &unused_out_len);
+  sstrncpy (buffer, (void *) out, buffer_size);
+
+  yajl_gen_clear (g);
+  yajl_gen_free (g);
+  return 0;
+} /* }}} format_json_notification */
+#else
+int format_json_notification (char *buffer, size_t buffer_size, /* {{{ */
+                              notification_t const *n)
+{
+  ERROR ("format_json_notification: Not available (requires libyajl).");
+  return ENOTSUP;
+} /* }}} int format_json_notification */
+#endif
+
 /* vim: set sw=2 sts=2 et fdm=marker : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_json.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_json.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_format_json.h	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_format_json.h	2016-09-11 16:10:25.275038704 +0800
@@ -38,8 +39,10 @@
     size_t *ret_buffer_fill, size_t *ret_buffer_free);
 int format_json_value_list (char *buffer,
     size_t *ret_buffer_fill, size_t *ret_buffer_free,
     const data_set_t *ds, const value_list_t *vl, int store_rates);
 int format_json_finalize (char *buffer,
     size_t *ret_buffer_fill, size_t *ret_buffer_free);
+int format_json_notification (char *buffer, size_t buffer_size,
+    notification_t const *n);
 
 #endif /* UTILS_FORMAT_JSON_H */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_format_json_test.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_format_kairosdb.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_format_kairosdb.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_latency.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_latency.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_latency.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_latency.c	2016-09-11 16:10:25.275038704 +0800
@@ -93,15 +94,14 @@
 
   /* bin_width has been increased, now iterate through all bins and move the
    * old bin's count to new bin. */
   if (lc->num > 0) // if the histogram has data then iterate else skip
   {
       double width_change_ratio = ((double) old_bin_width) / ((double) new_bin_width);
-      size_t i;
 
-      for (i = 0; i < HISTOGRAM_NUM_BINS; i++)
+      for (size_t i = 0; i < HISTOGRAM_NUM_BINS; i++)
       {
          size_t new_bin = (size_t) (((double) i) * width_change_ratio);
          if (i == new_bin)
              continue;
          assert (new_bin < i);
 
@@ -118,19 +118,18 @@
 } /* }}} void change_bin_width */
 
 latency_counter_t *latency_counter_create (void) /* {{{ */
 {
   latency_counter_t *lc;
 
-  lc = malloc (sizeof (*lc));
+  lc = calloc (1, sizeof (*lc));
   if (lc == NULL)
     return (NULL);
-  memset (lc, 0, sizeof (*lc));
 
-  latency_counter_reset (lc);
   lc->bin_width = HISTOGRAM_DEFAULT_BIN_WIDTH;
+  latency_counter_reset (lc);
   return (lc);
 } /* }}} latency_counter_t *latency_counter_create */
 
 void latency_counter_destroy (latency_counter_t *lc) /* {{{ */
 {
   sfree (lc);
@@ -173,12 +172,34 @@
 void latency_counter_reset (latency_counter_t *lc) /* {{{ */
 {
   if (lc == NULL)
     return;
 
   cdtime_t bin_width = lc->bin_width;
+  cdtime_t max_bin = (lc->max - 1) / lc->bin_width;
+
+/*
+  If max latency is REDUCE_THRESHOLD times less than histogram's range,
+  then cut it in half. REDUCE_THRESHOLD must be >= 2.
+  Value of 4 is selected to reduce frequent changes of bin width.
+*/
+#define REDUCE_THRESHOLD 4
+  if ((lc->num > 0) && (lc->bin_width >= HISTOGRAM_DEFAULT_BIN_WIDTH * 2)
+     && (max_bin < HISTOGRAM_NUM_BINS / REDUCE_THRESHOLD))
+  {
+    /* new bin width will be the previous power of 2 */
+    bin_width = bin_width / 2;
+
+    DEBUG("utils_latency: latency_counter_reset: max_latency = %.3f; "
+          "max_bin = %"PRIu64"; old_bin_width = %.3f; new_bin_width = %.3f;",
+        CDTIME_T_TO_DOUBLE (lc->max),
+        max_bin,
+        CDTIME_T_TO_DOUBLE (lc->bin_width),
+        CDTIME_T_TO_DOUBLE (bin_width));
+  }
+
   memset (lc, 0, sizeof (*lc));
 
   /* preserve bin width */
   lc->bin_width = bin_width;
   lc->start_time = cdtime ();
 } /* }}} void latency_counter_reset */
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_latency_test.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_lua.c
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: utils_lua.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount.c	2016-09-11 16:10:25.275038704 +0800
@@ -213,25 +214,24 @@
 	char *s;
 	int ma, mi, sz;
 	static char ptname[100];
 	FILE *procpt;
 	char uuid[16], *label = NULL;
 	char device[110];
-	int firstPass;
 	int handleOnFirst;
 
 	if(uuidCache) {
 		return;
 	}
 
 	procpt = fopen(PROC_PARTITIONS, "r");
 	if(procpt == NULL) {
 		return;
 	}
 
-	for(firstPass = 1; firstPass >= 0; firstPass--) {
+	for(int firstPass = 1; firstPass >= 0; firstPass--) {
 		fseek(procpt, 0, SEEK_SET);
 		while(fgets(line, sizeof(line), procpt)) {
 			if(sscanf(line, " %d %d %d %[^\n ]",
 				&ma, &mi, &sz, ptname) != 4)
 			{
 				continue;
@@ -315,20 +315,19 @@
 }
 
 static char *
 get_spec_by_uuid(const char *s)
 {
 	char uuid[16];
-	int i;
 
 	if(strlen(s) != 36
 	|| s[8] != '-' || s[13] != '-' || s[18] != '-' || s[23] != '-') {
 		goto bad_uuid;
 	}
 
-	for(i=0; i<16; i++) {
+	for(int i=0; i<16; i++) {
 		if(*s == '-') {
 			s++;
 		}
 		if(!isxdigit((int)s[0]) || !isxdigit((int)s[1])) {
 			goto bad_uuid;
 		}
@@ -379,25 +378,24 @@
 
 /* What weird OS is this..? I can't find any info with google :/ -octo */
 #if HAVE_LISTMNTENT && 0
 static cu_mount_t *cu_mount_listmntent (void)
 {
 	cu_mount_t *last = *list;
-	struct tabmntent *p;
 	struct mntent *mnt;
 
 	struct tabmntent *mntlist;
 	if(listmntent(&mntlist, COLLECTD_MNTTAB, NULL, NULL) < 0) {
 #if COLLECT_DEBUG
 		char errbuf[1024];
 		DEBUG("utils_mount: calling listmntent() failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 #endif /* COLLECT_DEBUG */
 	}
 
-	for(p = mntlist; p; p = p->next) {
+	for(struct tabmntent *p = mntlist; p; p = p->next) {
 		char *loop = NULL, *device = NULL;
 
 		mnt = p->ment;
 		loop = cu_mount_getoptionvalue(mnt->mnt_opts, "loop=");
 		if(loop == NULL) {   /* no loop= mount */
 			device = get_device_name(mnt->mnt_fsname);
@@ -448,13 +446,12 @@
 #endif /* HAVE_GETVFSSTAT */
 
 	int bufsize;
 	STRUCT_STATFS *buf;
 
 	int num;
-	int i;
 
 	cu_mount_t *first = NULL;
 	cu_mount_t *last  = NULL;
 	cu_mount_t *new   = NULL;
 
 	/* Get the number of mounted file systems */
@@ -465,16 +462,14 @@
 		DEBUG ("utils_mount: getv?fsstat failed: %s",
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 #endif /* COLLECT_DEBUG */
 		return (NULL);
 	}
 
-	if ((buf = (STRUCT_STATFS *) malloc (bufsize * sizeof (STRUCT_STATFS)))
-			== NULL)
+	if ((buf = calloc (bufsize, sizeof (*buf))) == NULL)
 		return (NULL);
-	memset (buf, '\0', bufsize * sizeof (STRUCT_STATFS));
 
 	/* The bufsize needs to be passed in bytes. Really. This is not in the
 	 * manpage.. -octo */
 	if ((num = CMD_STATFS (buf, bufsize * sizeof (STRUCT_STATFS), FLAGS_STATFS)) < 1)
 	{
 #if COLLECT_DEBUG
@@ -483,18 +478,17 @@
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 #endif /* COLLECT_DEBUG */
 		free (buf);
 		return (NULL);
 	}
 
-	for (i = 0; i < num; i++)
+	for (int i = 0; i < num; i++)
 	{
-		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+		if ((new = calloc (1, sizeof (*new))) == NULL)
 			break;
-		memset (new, '\0', sizeof (cu_mount_t));
-		
+
 		/* Copy values from `struct mnttab' */
 		new->dir         = sstrdup (buf[i].f_mntonname);
 		new->spec_device = sstrdup (buf[i].f_mntfromname);
 		new->type        = sstrdup (buf[i].f_fstypename);
 		new->options     = NULL;
 		new->device      = get_device_name (new->options);
@@ -539,16 +533,15 @@
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (NULL);
 	}
 
 	while (getmntent (fp, &mt) == 0)
 	{
-		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+		if ((new = calloc (1, sizeof (*new))) == NULL)
 			break;
-		memset (new, '\0', sizeof (cu_mount_t));
-		
+
 		/* Copy values from `struct mnttab' */
 		new->dir         = sstrdup (mt.mnt_mountp);
 		new->spec_device = sstrdup (mt.mnt_special);
 		new->type        = sstrdup (mt.mnt_fstype);
 		new->options     = sstrdup (mt.mnt_mntopts);
 		new->device      = get_device_name (new->options);
@@ -597,15 +590,14 @@
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (NULL);
 	}
 
 	while (getmntent_r (fp, &me, mntbuf, sizeof (mntbuf) ))
 	{
-		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+		if ((new = calloc (1, sizeof (*new))) == NULL)
 			break;
-		memset (new, '\0', sizeof (cu_mount_t));
 
 		/* Copy values from `struct mntent *' */
 		new->dir         = sstrdup (me.mnt_dir);
 		new->spec_device = sstrdup (me.mnt_fsname);
 		new->type        = sstrdup (me.mnt_type);
 		new->options     = sstrdup (me.mnt_opts);
@@ -654,16 +646,15 @@
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (NULL);
 	}
 
 	while ((me = getmntent (fp)) != NULL)
 	{
-		if ((new = malloc (sizeof (cu_mount_t))) == NULL)
+		if ((new = calloc (1, sizeof (*new))) == NULL)
 			break;
-		memset (new, '\0', sizeof (cu_mount_t));
-		
+
 		/* Copy values from `struct mntent *' */
 		new->dir         = sstrdup (me->mnt_dir);
 		new->spec_device = sstrdup (me->mnt_fsname);
 		new->type        = sstrdup (me->mnt_type);
 		new->options     = sstrdup (me->mnt_opts);
 		new->device      = get_device_name (new->options);
@@ -744,16 +735,15 @@
 
 	return (last);
 } /* cu_mount_t *cu_mount_getlist(cu_mount_t **list) */
 
 void cu_mount_freelist (cu_mount_t *list)
 {
-	cu_mount_t *this;
 	cu_mount_t *next;
 
-	for (this = list; this != NULL; this = next)
+	for (cu_mount_t *this = list; this != NULL; this = next)
 	{
 		next = this->next;
 
 		sfree (this->dir);
 		sfree (this->spec_device);
 		sfree (this->device);
@@ -761,13 +751,13 @@
 		sfree (this->options);
 		sfree (this);
 	}
 } /* void cu_mount_freelist(cu_mount_t *list) */
 
 char *
-cu_mount_checkoption(char *line, char *keyword, int full)
+cu_mount_checkoption(char *line, const char *keyword, int full)
 {
 	char *line2, *l2, *p1, *p2;
 	int l;
 
 	if(line == NULL || keyword == NULL) {
 		return NULL;
@@ -802,13 +792,13 @@
 
 	free(line2);
 	return NULL;
 } /* char *cu_mount_checkoption(char *line, char *keyword, int full) */
 
 char *
-cu_mount_getoptionvalue(char *line, char *keyword)
+cu_mount_getoptionvalue(char *line, const char *keyword)
 {
 	char *r;
 
 	r = cu_mount_checkoption(line, keyword, 0);
 	if(r != NULL) {
 		char *p;
@@ -818,19 +808,19 @@
 			return sstrdup(r);
 		} else {
 			char *m;
 			if((p-r) == 1) {
 				return NULL;
 			}
-			m = (char *)smalloc(p-r+1);
+			m = smalloc(p-r+1);
 			sstrncpy(m, r, p-r+1);
 			return m;
 		}
 	}
 	return r;
-} /* char *cu_mount_getoptionvalue(char *line, char *keyword) */
+} /* char *cu_mount_getoptionvalue(char *line, const char *keyword) */
 
 int
 cu_mount_type(const char *type)
 {
 	if(strcmp(type, "ext3") == 0) return CUMT_EXT3;
 	if(strcmp(type, "ext2") == 0) return CUMT_EXT2;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount.h	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount.h	2016-09-11 16:10:25.275038704 +0800
@@ -110,13 +110,13 @@
 /*
   DESCRIPTION
 	The cu_mount_freelist() function free()s all memory
 	allocated by *list and *list itself as well.
 */
 
-char *cu_mount_checkoption(char *line, char *keyword, int full);
+char *cu_mount_checkoption(char *line, const char *keyword, int full);
 /*
   DESCRIPTION
 	The cu_mount_checkoption() function is a replacement of
 	char *hasmntopt(const struct mntent *mnt, const char *opt).
 	In fact hasmntopt() just looks for the first occurrence of the
 	characters at opt in mnt->mnt_opts. cu_mount_checkoption()
@@ -150,13 +150,13 @@
 	If line is "rw,loop=/dev/loop1,quota", keyword is "loop="
 	and full is 0, then a pointer to "loop=/dev/loop1,quota"
 	is returned. If full is not 0 then NULL is returned. But
 	maybe you might want to try cu_mount_getoptionvalue()...
 */
 
-char *cu_mount_getoptionvalue(char *line, char *keyword);
+char *cu_mount_getoptionvalue(char *line, const char *keyword);
 /*
   DESCRIPTION
 	The cu_mount_getoptionvalue() function can be used to grab
 	a VALUE out of a mount option (line) like:
 		loop=VALUE
 	whereas "loop=" is the keyword.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_mount_test.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_mount_test.c	2016-09-11 16:10:25.275038704 +0800
@@ -21,14 +21,16 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  */
 
-#include "testing.h"
 #include "collectd.h"
+
+#include "common.h"
+#include "testing.h"
 #include "utils_mount.h"
 
 #if HAVE_LIBKSTAT
 kstat_ctl_t *kc;
 #endif /* HAVE_LIBKSTAT */
 
@@ -77,22 +79,31 @@
   return (0);
 }
 DEF_TEST(cu_mount_getoptionvalue)
 {
   char line_opts[] = "foo=one,bar=two,qux=three";
   char line_bool[] = "one,two,three";
+  char *v;
 
-  STREQ ("one", cu_mount_getoptionvalue (line_opts, "foo="));
-  STREQ ("two", cu_mount_getoptionvalue (line_opts, "bar="));
-  STREQ ("three", cu_mount_getoptionvalue (line_opts, "qux="));
-  OK (NULL == cu_mount_getoptionvalue (line_opts, "unknown="));
-
-  STREQ ("", cu_mount_getoptionvalue (line_bool, "one"));
-  STREQ ("", cu_mount_getoptionvalue (line_bool, "two"));
-  STREQ ("", cu_mount_getoptionvalue (line_bool, "three"));
-  OK (NULL == cu_mount_getoptionvalue (line_bool, "four"));
+  EXPECT_EQ_STR ("one", v = cu_mount_getoptionvalue (line_opts, "foo="));
+  sfree (v);
+  EXPECT_EQ_STR ("two", v = cu_mount_getoptionvalue (line_opts, "bar="));
+  sfree (v);
+  EXPECT_EQ_STR ("three", v = cu_mount_getoptionvalue (line_opts, "qux="));
+  sfree (v);
+  OK (NULL == (v = cu_mount_getoptionvalue (line_opts, "unknown=")));
+  sfree (v);
+
+  EXPECT_EQ_STR ("", v = cu_mount_getoptionvalue (line_bool, "one"));
+  sfree (v);
+  EXPECT_EQ_STR ("", v = cu_mount_getoptionvalue (line_bool, "two"));
+  sfree (v);
+  EXPECT_EQ_STR ("", v = cu_mount_getoptionvalue (line_bool, "three"));
+  sfree (v);
+  OK (NULL == (v = cu_mount_getoptionvalue (line_bool, "four")));
+  sfree (v);
 
   return (0);
 }
 
 int main (void)
 {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_parse_option.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_parse_option.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_parse_option.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_parse_option.c	2016-09-11 16:10:25.275038704 +0800
@@ -22,14 +22,13 @@
  *
  * Authors:
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
-#include "common.h"
-#include "plugin.h"
+
 #include "utils_parse_option.h"
 
 int parse_string (char **ret_buffer, char **ret_string)
 {
   char *buffer;
   char *string;
@@ -89,13 +88,13 @@
     if (*buffer != 0)
     {
       *buffer = 0;
       buffer++;
     }
   }
-  
+
   /* Eat up trailing spaces */
   while (isspace ((int) *buffer))
     buffer++;
 
   *ret_buffer = buffer;
   *ret_string = string;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_rrdcreate.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_rrdcreate.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_rrdcreate.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_rrdcreate.c	2016-09-11 16:10:25.275038704 +0800
@@ -59,35 +60,33 @@
   604800,
   2678400,
   31622400
 };
 static int rra_timespans_num = STATIC_ARRAY_SIZE (rra_timespans);
 
-static char *rra_types[] =
+static const char *const rra_types[] =
 {
   "AVERAGE",
   "MIN",
   "MAX"
 };
 static int rra_types_num = STATIC_ARRAY_SIZE (rra_types);
 
-#if !defined(HAVE_THREADSAFE_LIBRRD) || !HAVE_THREADSAFE_LIBRRD
+#if !defined(HAVE_THREADSAFE_LIBRRD)
 static pthread_mutex_t librrd_lock = PTHREAD_MUTEX_INITIALIZER;
 #endif
 
 static async_create_file_t *async_creation_list = NULL;
 static pthread_mutex_t async_creation_lock = PTHREAD_MUTEX_INITIALIZER;
 
 /*
  * Private functions
  */
 static void rra_free (int rra_num, char **rra_def) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < rra_num; i++)
+  for (int i = 0; i < rra_num; i++)
   {
     sfree (rra_def[i]);
   }
   sfree (rra_def);
 } /* }}} void rra_free */
 
@@ -96,33 +95,31 @@
   if (args == NULL)
     return;
 
   sfree (args->filename);
   if (args->argv != NULL)
   {
-    int i;
-    for (i = 0; i < args->argc; i++)
+    for (int i = 0; i < args->argc; i++)
       sfree (args->argv[i]);
     sfree (args->argv);
   }
   sfree (args);
 } /* void srrd_create_args_destroy */
 
 static srrd_create_args_t *srrd_create_args_create (const char *filename,
     unsigned long pdp_step, time_t last_up,
     int argc, const char **argv)
 {
   srrd_create_args_t *args;
 
-  args = malloc (sizeof (*args));
+  args = calloc (1, sizeof (*args));
   if (args == NULL)
   {
-    ERROR ("srrd_create_args_create: malloc failed.");
+    ERROR ("srrd_create_args_create: calloc failed.");
     return (NULL);
   }
-  memset (args, 0, sizeof (*args));
   args->filename = NULL;
   args->pdp_step = pdp_step;
   args->last_up = last_up;
   args->argv = NULL;
 
   args->filename = strdup (filename);
@@ -170,13 +167,12 @@
   int  rts_num;
 
   int rra_max;
 
   int cdp_num;
   int cdp_len;
-  int i, j;
 
   /* The stepsize we use here: If it is user-set, use it. If not, use the
    * interval of the value-list. */
   int ss;
 
   if (cfg->rrarows <= 0)
@@ -213,19 +209,18 @@
     rts_num = rra_timespans_num;
   }
 
   rra_max = rts_num * rra_types_num;
   assert (rra_max > 0);
 
-  if ((rra_def = malloc ((rra_max + 1) * sizeof (*rra_def))) == NULL)
+  if ((rra_def = calloc (rra_max + 1, sizeof (*rra_def))) == NULL)
     return (-1);
-  memset (rra_def, 0, (rra_max + 1) * sizeof (*rra_def));
   rra_num = 0;
 
   cdp_len = 0;
-  for (i = 0; i < rts_num; i++)
+  for (int i = 0; i < rts_num; i++)
   {
     int span = rts[i];
 
     if ((span / ss) < cfg->rrarows)
       span = ss * cfg->rrarows;
 
@@ -235,13 +230,13 @@
       cdp_len = (int) floor (((double) span)
           / ((double) (cfg->rrarows * ss)));
 
     cdp_num = (int) ceil (((double) span)
         / ((double) (cdp_len * ss)));
 
-    for (j = 0; j < rra_types_num; j++)
+    for (int j = 0; j < rra_types_num; j++)
     {
       char buffer[128];
       int status;
 
       if (rra_num >= rra_max)
         break;
@@ -268,47 +263,44 @@
   *ret = rra_def;
   return (rra_num);
 } /* }}} int rra_get */
 
 static void ds_free (int ds_num, char **ds_def) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ds_num; i++)
+  for (int i = 0; i < ds_num; i++)
     if (ds_def[i] != NULL)
       free (ds_def[i]);
   free (ds_def);
 } /* }}} void ds_free */
 
 static int ds_get (char ***ret, /* {{{ */
     const data_set_t *ds, const value_list_t *vl,
     const rrdcreate_config_t *cfg)
 {
   char **ds_def;
-  int ds_num;
+  size_t ds_num;
 
   char min[32];
   char max[32];
   char buffer[128];
 
   assert (ds->ds_num > 0);
 
-  ds_def = malloc (ds->ds_num * sizeof (*ds_def));
+  ds_def = calloc (ds->ds_num, sizeof (*ds_def));
   if (ds_def == NULL)
   {
     char errbuf[1024];
-    ERROR ("rrdtool plugin: malloc failed: %s",
+    ERROR ("rrdtool plugin: calloc failed: %s",
         sstrerror (errno, errbuf, sizeof (errbuf)));
     return (-1);
   }
-  memset (ds_def, 0, ds->ds_num * sizeof (*ds_def));
 
   for (ds_num = 0; ds_num < ds->ds_num; ds_num++)
   {
     data_source_t *d = ds->ds + ds_num;
-    char *type;
+    const char *type;
     int status;
 
     ds_def[ds_num] = NULL;
 
     if (d->type == DS_TYPE_COUNTER)
       type = "COUNTER";
@@ -355,13 +347,13 @@
   if (ds_num != ds->ds_num)
   {
     ds_free (ds_num, ds_def);
     return (-1);
   }
 
-  if (ds_num <= 0)
+  if (ds_num == 0)
   {
     sfree (ds_def);
     return (0);
   }
 
   *ret = ds_def;
@@ -418,13 +410,13 @@
   char **new_argv;
 
   char pdp_step_str[16];
   char last_up_str[16];
 
   new_argc = 6 + argc;
-  new_argv = (char **) malloc ((new_argc + 1) * sizeof (char *));
+  new_argv = malloc ((new_argc + 1) * sizeof (*new_argv));
   if (new_argv == NULL)
   {
     ERROR ("rrdtool plugin: malloc failed.");
     return (-1);
   }
 
@@ -686,13 +678,13 @@
     rra_free (rra_num, rra_def);
     return (-1);
   }
 
   argc = ds_num + rra_num;
 
-  if ((argv = (char **) malloc (sizeof (char *) * (argc + 1))) == NULL)
+  if ((argv = malloc (sizeof (*argv) * (argc + 1))) == NULL)
   {
     char errbuf[1024];
     ERROR ("cu_rrd_create_file failed: %s",
         sstrerror (errno, errbuf, sizeof (errbuf)));
     rra_free (rra_num, rra_def);
     ds_free (ds_num, ds_def);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_vl_lookup.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_vl_lookup.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_vl_lookup.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_vl_lookup.c	2016-09-11 16:10:25.275038704 +0800
@@ -154,25 +155,25 @@
 
   /* Copy string without the leading slash. */
   sstrncpy (match_part->str, ident_part + 1, sizeof (match_part->str));
   assert (sizeof (match_part->str) > len);
   /* strip trailing slash */
   match_part->str[len - 2] = 0;
-  
+
   status = regcomp (&match_part->regex, match_part->str,
       /* flags = */ REG_EXTENDED);
   if (status != 0)
   {
     char errbuf[1024];
     regerror (status, &match_part->regex, errbuf, sizeof (errbuf));
     ERROR ("utils_vl_lookup: Compiling regular expression \"%s\" failed: %s",
         match_part->str, errbuf);
     return (EINVAL);
   }
   match_part->is_regex = 1;
-  
+
   return (0);
 } /* }}} int lu_copy_ident_to_match_part */
 
 static int lu_copy_ident_to_match (identifier_match_t *match, /* {{{ */
     identifier_t const *ident, unsigned int group_by)
 {
@@ -201,19 +202,18 @@
 static void *lu_create_user_obj (lookup_t *obj, /* {{{ */
     data_set_t const *ds, value_list_t const *vl,
     user_class_t *user_class)
 {
   user_obj_t *user_obj;
 
-  user_obj = malloc (sizeof (*user_obj));
+  user_obj = calloc (1, sizeof (*user_obj));
   if (user_obj == NULL)
   {
-    ERROR ("utils_vl_lookup: malloc failed.");
+    ERROR ("utils_vl_lookup: calloc failed.");
     return (NULL);
   }
-  memset (user_obj, 0, sizeof (*user_obj));
   user_obj->next = NULL;
 
   user_obj->user_obj = obj->cb_user_class (ds, vl, user_class->user_class);
   if (user_obj->user_obj == NULL)
   {
     sfree (user_obj);
@@ -334,13 +334,13 @@
 static int lu_handle_user_class_list (lookup_t *obj, /* {{{ */
     data_set_t const *ds, value_list_t const *vl,
     user_class_list_t *user_class_list)
 {
   user_class_list_t *ptr;
   int retval = 0;
-  
+
   for (ptr = user_class_list; ptr != NULL; ptr = ptr->next)
   {
     int status;
 
     status = lu_handle_user_class (obj, ds, vl, &ptr->entry);
     if (status < 0)
@@ -370,23 +370,22 @@
   if (type_copy == NULL)
   {
     ERROR ("utils_vl_lookup: strdup failed.");
     return (NULL);
   }
 
-  by_type = malloc (sizeof (*by_type));
+  by_type = calloc (1, sizeof (*by_type));
   if (by_type == NULL)
   {
-    ERROR ("utils_vl_lookup: malloc failed.");
+    ERROR ("utils_vl_lookup: calloc failed.");
     sfree (type_copy);
     return (NULL);
   }
-  memset (by_type, 0, sizeof (*by_type));
   by_type->wildcard_plugin_list = NULL;
-  
-  by_type->by_plugin_tree = c_avl_create ((void *) strcmp);
+
+  by_type->by_plugin_tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
   if (by_type->by_plugin_tree == NULL)
   {
     ERROR ("utils_vl_lookup: c_avl_create failed.");
     sfree (by_type);
     sfree (type_copy);
     return (NULL);
@@ -400,13 +399,13 @@
     ERROR ("utils_vl_lookup: c_avl_insert failed.");
     c_avl_destroy (by_type->by_plugin_tree);
     sfree (by_type);
     sfree (type_copy);
     return (NULL);
   }
-  
+
   return (by_type);
 } /* }}} by_type_entry_t *lu_search_by_type */
 
 static int lu_add_by_plugin (by_type_entry_t *by_type, /* {{{ */
     user_class_list_t *user_class_list)
 {
@@ -494,25 +493,40 @@
     user_class_list_t *next = user_class_list->next;
 
     if (obj->cb_free_class != NULL)
       obj->cb_free_class (user_class_list->entry.user_class);
     user_class_list->entry.user_class = NULL;
 
+#define CLEAR_FIELD(field) do { \
+    if (user_class_list->entry.match.field.is_regex) { \
+      regfree (&user_class_list->entry.match.field.regex); \
+      user_class_list->entry.match.field.is_regex = 0; \
+    } \
+} while (0)
+
+    CLEAR_FIELD (host);
+    CLEAR_FIELD (plugin);
+    CLEAR_FIELD (plugin_instance);
+    CLEAR_FIELD (type);
+    CLEAR_FIELD (type_instance);
+
+#undef CLEAR_FIELD
+
     lu_destroy_user_obj (obj, user_class_list->entry.user_obj_list);
     user_class_list->entry.user_obj_list = NULL;
     pthread_mutex_destroy (&user_class_list->entry.lock);
 
     sfree (user_class_list);
     user_class_list = next;
   }
 } /* }}} void lu_destroy_user_class_list */
 
 static void lu_destroy_by_type (lookup_t *obj, /* {{{ */
     by_type_entry_t *by_type)
 {
-  
+
   while (42)
   {
     char *plugin = NULL;
     user_class_list_t *user_class_list = NULL;
     int status;
 
@@ -541,21 +555,20 @@
  */
 lookup_t *lookup_create (lookup_class_callback_t cb_user_class, /* {{{ */
     lookup_obj_callback_t cb_user_obj,
     lookup_free_class_callback_t cb_free_class,
     lookup_free_obj_callback_t cb_free_obj)
 {
-  lookup_t *obj = malloc (sizeof (*obj));
+  lookup_t *obj = calloc (1, sizeof (*obj));
   if (obj == NULL)
   {
-    ERROR ("utils_vl_lookup: malloc failed.");
+    ERROR ("utils_vl_lookup: calloc failed.");
     return (NULL);
   }
-  memset (obj, 0, sizeof (*obj));
 
-  obj->by_type_tree = c_avl_create ((void *) strcmp);
+  obj->by_type_tree = c_avl_create ((int (*) (const void *, const void *)) strcmp);
   if (obj->by_type_tree == NULL)
   {
     ERROR ("utils_vl_lookup: c_avl_create failed.");
     sfree (obj);
     return (NULL);
   }
@@ -602,19 +615,18 @@
   user_class_list_t *user_class_obj;
 
   by_type = lu_search_by_type (obj, ident->type, /* allocate = */ 1);
   if (by_type == NULL)
     return (-1);
 
-  user_class_obj = malloc (sizeof (*user_class_obj));
+  user_class_obj = calloc (1, sizeof (*user_class_obj));
   if (user_class_obj == NULL)
   {
-    ERROR ("utils_vl_lookup: malloc failed.");
+    ERROR ("utils_vl_lookup: calloc failed.");
     return (ENOMEM);
   }
-  memset (user_class_obj, 0, sizeof (*user_class_obj));
   pthread_mutex_init (&user_class_obj->entry.lock, /* attr = */ NULL);
   user_class_obj->entry.user_class = user_class;
   lu_copy_ident_to_match (&user_class_obj->entry.match, ident, group_by);
   user_class_obj->entry.user_obj_list = NULL;
   user_class_obj->next = NULL;
 
@@ -652,9 +664,9 @@
     status = lu_handle_user_class_list (obj, ds, vl,
         by_type->wildcard_plugin_list);
     if (status < 0)
       return (status);
     retval += status;
   }
-    
+
   return (retval);
 } /* }}} lookup_search */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_vl_lookup_test.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_vl_lookup_test.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/utils_vl_lookup_test.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/utils_vl_lookup_test.c	2016-09-11 16:10:25.275038704 +0800
@@ -21,14 +21,15 @@
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Florian Forster <octo at collectd.org>
  **/
 
-#include "testing.h"
 #include "collectd.h"
+
+#include "testing.h"
 #include "utils_vl_lookup.h"
 
 static _Bool expect_new_obj = 0;
 static _Bool have_new_obj = 0;
 
 static identifier_t last_class_ident;
@@ -62,49 +63,49 @@
 static void *lookup_class_callback (data_set_t const *ds,
     value_list_t const *vl, void *user_class)
 {
   identifier_t *class = user_class;
   identifier_t *obj;
 
-  OK(expect_new_obj);
+  assert (expect_new_obj);
 
   memcpy (&last_class_ident, class, sizeof (last_class_ident));
-  
+
   obj = malloc (sizeof (*obj));
   strncpy (obj->host, vl->host, sizeof (obj->host));
   strncpy (obj->plugin, vl->plugin, sizeof (obj->plugin));
   strncpy (obj->plugin_instance, vl->plugin_instance, sizeof (obj->plugin_instance));
   strncpy (obj->type, vl->type, sizeof (obj->type));
   strncpy (obj->type_instance, vl->type_instance, sizeof (obj->type_instance));
 
   have_new_obj = 1;
 
   return ((void *) obj);
 }
 
-static void checked_lookup_add (lookup_t *obj, /* {{{ */
+static int checked_lookup_add (lookup_t *obj, /* {{{ */
     char const *host,
     char const *plugin, char const *plugin_instance,
     char const *type, char const *type_instance,
     unsigned int group_by)
 {
   identifier_t ident;
   void *user_class;
 
-  memset (&ident, 0, sizeof (ident));
   strncpy (ident.host, host, sizeof (ident.host));
   strncpy (ident.plugin, plugin, sizeof (ident.plugin));
   strncpy (ident.plugin_instance, plugin_instance, sizeof (ident.plugin_instance));
   strncpy (ident.type, type, sizeof (ident.type));
   strncpy (ident.type_instance, type_instance, sizeof (ident.type_instance));
 
   user_class = malloc (sizeof (ident));
   memmove (user_class, &ident, sizeof (ident));
 
   OK(lookup_add (obj, &ident, group_by, user_class) == 0);
-} /* }}} void test_add */
+  return 0;
+} /* }}} int checked_lookup_add */
 
 static int checked_lookup_search (lookup_t *obj,
     char const *host,
     char const *plugin, char const *plugin_instance,
     char const *type, char const *type_instance,
     _Bool expect_new)
@@ -126,26 +127,17 @@
   have_new_obj = 0;
 
   status = lookup_search (obj, ds, &vl);
   return (status);
 }
 
-static lookup_t *checked_lookup_create (void)
-{
-  lookup_t *obj = lookup_create (
-      lookup_class_callback,
-      lookup_obj_callback,
-      (void *) free,
-      (void *) free);
-  OK(obj != NULL);
-  return (obj);
-}
-
 DEF_TEST(group_by_specific_host)
 {
-  lookup_t *obj = checked_lookup_create ();
+  lookup_t *obj;
+  CHECK_NOT_NULL (obj = lookup_create (
+        lookup_class_callback, lookup_obj_callback, (void *) free, (void *) free));
 
   checked_lookup_add (obj, "/.*/", "test", "", "test", "/.*/", LU_GROUP_BY_HOST);
   checked_lookup_search (obj, "host0", "test", "", "test", "0",
       /* expect new = */ 1);
   checked_lookup_search (obj, "host0", "test", "", "test", "1",
       /* expect new = */ 0);
@@ -157,13 +149,15 @@
   lookup_destroy (obj);
   return (0);
 }
 
 DEF_TEST(group_by_any_host)
 {
-  lookup_t *obj = checked_lookup_create ();
+  lookup_t *obj;
+  CHECK_NOT_NULL (obj = lookup_create (
+        lookup_class_callback, lookup_obj_callback, (void *) free, (void *) free));
 
   checked_lookup_add (obj, "/.*/", "/.*/", "/.*/", "test", "/.*/", LU_GROUP_BY_HOST);
   checked_lookup_search (obj, "host0", "plugin0", "", "test", "0",
       /* expect new = */ 1);
   checked_lookup_search (obj, "host0", "plugin0", "", "test", "1",
       /* expect new = */ 0);
@@ -183,15 +177,18 @@
   lookup_destroy (obj);
   return (0);
 }
 
 DEF_TEST(multiple_lookups)
 {
-  lookup_t *obj = checked_lookup_create ();
+  lookup_t *obj;
   int status;
 
+  CHECK_NOT_NULL (obj = lookup_create (
+        lookup_class_callback, lookup_obj_callback, (void *) free, (void *) free));
+
   checked_lookup_add (obj, "/.*/", "plugin0", "", "test", "/.*/", LU_GROUP_BY_HOST);
   checked_lookup_add (obj, "/.*/", "/.*/", "", "test", "ti0", LU_GROUP_BY_HOST);
 
   status = checked_lookup_search (obj, "host0", "plugin1", "", "test", "",
       /* expect new = */ 0);
   assert (status == 0);
@@ -208,13 +205,15 @@
   lookup_destroy (obj);
   return (0);
 }
 
 DEF_TEST(regex)
 {
-  lookup_t *obj = checked_lookup_create ();
+  lookup_t *obj;
+  CHECK_NOT_NULL (obj = lookup_create (
+        lookup_class_callback, lookup_obj_callback, (void *) free, (void *) free));
 
   checked_lookup_add (obj, "/^db[0-9]\\./", "cpu", "/.*/", "cpu", "/.*/",
       LU_GROUP_BY_TYPE_INSTANCE);
   checked_lookup_search (obj, "db0.example.com", "cpu", "0", "cpu", "user",
       /* expect new = */ 1);
   checked_lookup_search (obj, "db0.example.com", "cpu", "0", "cpu", "idle",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/uuid.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/uuid.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/uuid.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/uuid.c	2016-09-11 16:10:25.275038704 +0800
@@ -1,9 +1,10 @@
 /**
  * collectd - src/uuid.c
  * Copyright (C) 2007  Red Hat Inc.
+ * Copyright (C) 2015  Ruben Kerkhof
  *
  * This program is free software; you can redistribute it and/or modify it
  * under the terms of the GNU General Public License as published by the
  * Free Software Foundation; only version 2 of the License is applicable.
  *
  * This program is distributed in the hope that it will be useful, but
@@ -21,17 +22,21 @@
  *
  * Derived from UUID detection code by Dan Berrange <berrange@redhat.com>
  * http://hg.et.redhat.com/virt/daemons/spectre--devel?f=f6e3a1b06433;file=lib/uuid.c
  **/
 
 #include "collectd.h"
+
 #include "common.h"
-#include "configfile.h"
 #include "plugin.h"
 
-#if HAVE_LIBHAL
+#if HAVE_SYS_SYSCTL_H
+#include <sys/sysctl.h>
+#endif
+
+#if HAVE_LIBHAL_H
 #include <libhal.h>
 #endif
 
 #define UUID_RAW_LENGTH 16
 #define UUID_PRINTABLE_COMPACT_LENGTH  (UUID_RAW_LENGTH * 2)
 #define UUID_PRINTABLE_NORMAL_LENGTH  (UUID_PRINTABLE_COMPACT_LENGTH + 4)
@@ -44,24 +49,26 @@
 
 static int
 looks_like_a_uuid (const char *uuid)
 {
     int len;
 
-    if (!uuid) return 0;
+    if (!uuid)
+        return (0);
 
     len = strlen (uuid);
 
     if (len < UUID_PRINTABLE_COMPACT_LENGTH)
-        return 0;
+        return (0);
 
     while (*uuid) {
-        if (!isxdigit ((int)*uuid) && *uuid != '-') return 0;
+        if (!isxdigit ((int)*uuid) && *uuid != '-')
+            return (0);
         uuid++;
     }
-    return 1;
+    return (1);
 }
 
 static char *
 uuid_parse_dmidecode(FILE *file)
 {
     char line[1024];
@@ -83,34 +90,60 @@
         if (strcmp("UUID:", fields[0]) != 0)
             continue;
 
         if (!looks_like_a_uuid (fields[1]))
             continue;
 
-        return strdup (fields[1]);
+        return (strdup (fields[1]));
     }
-    return NULL;
+    return (NULL);
 }
 
 static char *
 uuid_get_from_dmidecode(void)
 {
-    FILE *dmidecode = popen("dmidecode 2>/dev/null", "r");
+    FILE *dmidecode = popen("dmidecode -t system 2>/dev/null", "r");
     char *uuid;
 
-    if (!dmidecode) {
-        return NULL;
-    }
-    
+    if (!dmidecode)
+        return (NULL);
+
     uuid = uuid_parse_dmidecode(dmidecode);
 
     pclose(dmidecode);
-    return uuid;
+    return (uuid);
+}
+
+#if defined(__APPLE__) || defined(__FreeBSD__) || defined(__NetBSD__)
+static char *
+uuid_get_from_sysctlbyname(const char *name)
+{
+    char uuid[UUID_PRINTABLE_NORMAL_LENGTH + 1];
+    size_t len = sizeof (uuid);
+    if (sysctlbyname(name, &uuid, &len, NULL, 0) == -1)
+        return NULL;
+    return (strdup (uuid));
+}
+#elif defined(__OpenBSD__)
+static char *
+uuid_get_from_sysctl(void)
+{
+    char uuid[UUID_PRINTABLE_NORMAL_LENGTH + 1];
+    size_t len = sizeof (uuid);
+    int mib[2];
+
+    mib[0] = CTL_HW;
+    mib[1] = HW_UUID;
+
+    if (sysctl(mib, 2, uuid, &len, NULL, 0) == -1)
+        return NULL;
+    return (strdup (uuid));
 }
+#endif
 
-#if HAVE_LIBHAL
+#if HAVE_LIBHAL_H
 
 #define UUID_PATH "/org/freedesktop/Hal/devices/computer"
 #define UUID_PROPERTY "smbios.system.uuid"
 
 static char *
 uuid_get_from_hal(void)
@@ -119,135 +152,141 @@
 
     DBusError error;
     DBusConnection *con;
 
     dbus_error_init(&error);
 
-    if (!(con = dbus_bus_get(DBUS_BUS_SYSTEM, &error)) ) {
+    if (!(con = dbus_bus_get(DBUS_BUS_SYSTEM, &error)))
         goto bailout_nobus;
-    }
 
     ctx = libhal_ctx_new();
     libhal_ctx_set_dbus_connection(ctx, con);
 
-    if (!libhal_ctx_init(ctx, &error)) {
+    if (!libhal_ctx_init(ctx, &error))
         goto bailout;
-    }
 
     if (!libhal_device_property_exists(ctx,
                                        UUID_PATH,
                                        UUID_PROPERTY,
-                                       &error)) {
+                                       &error))
         goto bailout;
-    }
 
     char *uuid  = libhal_device_get_property_string(ctx,
                                                     UUID_PATH,
                                                     UUID_PROPERTY,
                                                     &error);
-    if (looks_like_a_uuid (uuid)) {
-        return uuid;
-    }
+    if (looks_like_a_uuid (uuid))
+        return (uuid);
 
  bailout:
     {
         DBusError ctxerror;
         dbus_error_init(&ctxerror);
-        if (!(libhal_ctx_shutdown(ctx, &ctxerror))) {
+        if (!(libhal_ctx_shutdown(ctx, &ctxerror)))
             dbus_error_free(&ctxerror);
-        }
     }
 
     libhal_ctx_free(ctx);
-    //dbus_connection_unref(con);
 
  bailout_nobus:
-    if (dbus_error_is_set(&error)) {
-        /*printf("Error %s\n", error.name);*/
+    if (dbus_error_is_set(&error))
         dbus_error_free(&error);
-    }
-    return NULL;
+    return (NULL);
 }
 #endif
 
 static char *
 uuid_get_from_file(const char *path)
 {
     FILE *file;
     char uuid[UUID_PRINTABLE_NORMAL_LENGTH + 1] = "";
 
     file = fopen (path, "r");
     if (file == NULL)
-        return NULL;
+        return (NULL);
 
     if (!fgets(uuid, sizeof(uuid), file)) {
         fclose(file);
-        return NULL;
+        return (NULL);
     }
     fclose(file);
     strstripnewline (uuid);
 
-    return strdup (uuid);
+    return (strdup (uuid));
 }
 
 static char *
 uuid_get_local(void)
 {
     char *uuid;
 
     /* Check /etc/uuid / UUIDFile before any other method. */
-    if ((uuid = uuid_get_from_file(uuidfile ? uuidfile : "/etc/uuid")) != NULL){
-        return uuid;
-    }
+    if ((uuid = uuid_get_from_file(uuidfile ? uuidfile : "/etc/uuid")) != NULL)
+        return (uuid);
 
-#if HAVE_LIBHAL
-    if ((uuid = uuid_get_from_hal()) != NULL) {
-        return uuid;
-    }
+#if defined(__APPLE__)
+    if ((uuid = uuid_get_from_sysctlbyname("kern.uuid")) != NULL)
+        return (uuid);
+#elif defined(__FreeBSD__)
+    if ((uuid = uuid_get_from_sysctlbyname("kern.hostuuid")) != NULL)
+        return (uuid);
+#elif defined(__NetBSD__)
+    if ((uuid = uuid_get_from_sysctlbyname("machdep.dmi.system-uuid")) != NULL)
+        return (uuid);
+#elif defined(__OpenBSD__)
+    if ((uuid = uuid_get_from_sysctl()) != NULL)
+        return (uuid);
+#elif defined(__linux__)
+    if ((uuid = uuid_get_from_file("/sys/class/dmi/id/product_uuid")) != NULL)
+        return (uuid);
 #endif
 
-    if ((uuid = uuid_get_from_dmidecode()) != NULL) {
-        return uuid;
-    }
+#if HAVE_LIBHAL_H
+    if ((uuid = uuid_get_from_hal()) != NULL)
+        return (uuid);
+#endif
 
-    if ((uuid = uuid_get_from_file("/sys/hypervisor/uuid")) != NULL) {
-        return uuid;
-    }
+    if ((uuid = uuid_get_from_dmidecode()) != NULL)
+        return (uuid);
+
+#if defined(__linux__)
+    if ((uuid = uuid_get_from_file("/sys/hypervisor/uuid")) != NULL)
+        return (uuid);
+#endif
 
-    return NULL;
+    return (NULL);
 }
 
 static int
 uuid_config (const char *key, const char *value)
 {
     if (strcasecmp (key, "UUIDFile") == 0) {
         char *tmp = strdup (value);
         if (tmp == NULL)
-            return -1;
+            return (-1);
         sfree (uuidfile);
         uuidfile = tmp;
-    } else {
-        return 1;
+        return (0);
     }
 
-    return 0;
+    return (1);
 }
 
 static int
 uuid_init (void)
 {
     char *uuid = uuid_get_local ();
 
     if (uuid) {
         sstrncpy (hostname_g, uuid, DATA_MAX_NAME_LEN);
         sfree (uuid);
-        return 0;
+        return (0);
     }
 
     WARNING ("uuid: could not read UUID using any known method");
-    return 0;
+    return (0);
 }
 
 void module_register (void)
 {
     plugin_register_config ("uuid", uuid_config,
             config_keys, STATIC_ARRAY_SIZE (config_keys));
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: valgrind.FreeBSD.suppress
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/varnish.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/varnish.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/varnish.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/varnish.c	2016-09-11 16:10:25.279038699 +0800
@@ -21,15 +21,15 @@
  *   Jérôme Renard <jerome.renard at gmail.com>
  *   Marc Fournier <marc.fournier at camptocamp.com>
  *   Florian octo Forster <octo at collectd.org>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #if HAVE_VARNISH_V4
 #include <vapi/vsm.h>
 #include <vapi/vsc.h>
 typedef struct VSC_C_main c_varnish_stats_t;
 #endif
@@ -790,12 +790,13 @@
 
 #if HAVE_VARNISH_V3 || HAVE_VARNISH_V4
 static int varnish_read (user_data_t *ud) /* {{{ */
 {
 	struct VSM_data *vd;
 	const c_varnish_stats_t *stats;
+	_Bool ok;
 
 	user_config_t *conf;
 
 	if ((ud == NULL) || (ud->data == NULL))
 		return (EINVAL);
 
@@ -819,16 +820,17 @@
 					conf->instance, status);
 			return (-1);
 		}
 	}
 
 #if HAVE_VARNISH_V3
-	if (VSC_Open (vd, /* diag = */ 1))
+	ok = (VSC_Open (vd, /* diag = */ 1) == 0);
 #else /* if HAVE_VARNISH_V4 */
-	if (VSM_Open (vd))
+	ok = (VSM_Open (vd) == 0);
 #endif
+	if (!ok)
 	{
 		VSM_Delete (vd);
 		ERROR ("varnish plugin: Unable to open connection.");
 
 		return (-1);
 	}
@@ -933,50 +935,48 @@
 	return (0);
 } /* }}} int varnish_config_apply_default */
 
 static int varnish_init (void) /* {{{ */
 {
 	user_config_t *conf;
-	user_data_t ud;
 
 	if (have_instance)
 		return (0);
 
-	conf = malloc (sizeof (*conf));
+	conf = calloc (1, sizeof (*conf));
 	if (conf == NULL)
 		return (ENOMEM);
-	memset (conf, 0, sizeof (*conf));
 
 	/* Default settings: */
 	conf->instance = NULL;
 
 	varnish_config_apply_default (conf);
 
-	ud.data = conf;
-	ud.free_func = varnish_config_free;
+	user_data_t ud = {
+		.data = conf,
+		.free_func = varnish_config_free
+	};
 
 	plugin_register_complex_read (/* group = */ "varnish",
 			/* name      = */ "varnish/localhost",
 			/* callback  = */ varnish_read,
-			/* interval  = */ NULL,
+			/* interval  = */ 0,
 			/* user data = */ &ud);
 
 	return (0);
 } /* }}} int varnish_init */
 
 static int varnish_config_instance (const oconfig_item_t *ci) /* {{{ */
 {
 	user_config_t *conf;
 	user_data_t ud;
 	char callback_name[DATA_MAX_NAME_LEN];
-	int i;
 
-	conf = malloc (sizeof (*conf));
+	conf = calloc (1, sizeof (*conf));
 	if (conf == NULL)
 		return (ENOMEM);
-	memset (conf, 0, sizeof (*conf));
 	conf->instance = NULL;
 
 	varnish_config_apply_default (conf);
 
 	if (ci->values_num == 1)
 	{
@@ -1001,68 +1001,85 @@
 		WARNING ("Varnish plugin: \"Instance\" blocks accept only "
 				"one argument.");
 		sfree (conf);
 		return (EINVAL);
 	}
 
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("CollectCache", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_cache);
 		else if (strcasecmp ("CollectConnections", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_connections);
 		else if (strcasecmp ("CollectESI", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_esi);
-#ifdef HAVE_VARNISH_V3
 		else if (strcasecmp ("CollectDirectorDNS", child->key) == 0)
+#ifdef HAVE_VARNISH_V3
 			cf_util_get_boolean (child, &conf->collect_dirdns);
+#else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v3");
 #endif
 		else if (strcasecmp ("CollectBackend", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_backend);
 		else if (strcasecmp ("CollectFetch", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_fetch);
 		else if (strcasecmp ("CollectHCB", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_hcb);
 		else if (strcasecmp ("CollectObjects", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_objects);
-#if HAVE_VARNISH_V2
 		else if (strcasecmp ("CollectPurge", child->key) == 0)
+#if HAVE_VARNISH_V2
 			cf_util_get_boolean (child, &conf->collect_purge);
 #else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v2");
+#endif
 		else if (strcasecmp ("CollectBan", child->key) == 0)
+#if HAVE_VARNISH_V2
+			WARNING ("Varnish plugin: \"%s\" is not available for Varnish %s.", child->key, "v2");
+#else
 			cf_util_get_boolean (child, &conf->collect_ban);
 #endif
 		else if (strcasecmp ("CollectSession", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_session);
 		else if (strcasecmp ("CollectSHM", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_shm);
 		else if (strcasecmp ("CollectSMS", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_sms);
-#if HAVE_VARNISH_V2
 		else if (strcasecmp ("CollectSMA", child->key) == 0)
+#if HAVE_VARNISH_V2
 			cf_util_get_boolean (child, &conf->collect_sma);
+#else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v2");
+#endif
 		else if (strcasecmp ("CollectSM", child->key) == 0)
+#if HAVE_VARNISH_V2
 			cf_util_get_boolean (child, &conf->collect_sm);
+#else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v2");
 #endif
 		else if (strcasecmp ("CollectStruct", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_struct);
 		else if (strcasecmp ("CollectTotals", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_totals);
-#if HAVE_VARNISH_V3 || HAVE_VARNISH_V4
 		else if (strcasecmp ("CollectUptime", child->key) == 0)
+#if HAVE_VARNISH_V3 || HAVE_VARNISH_V4
 			cf_util_get_boolean (child, &conf->collect_uptime);
+#else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v3 and v4");
 #endif
 		else if (strcasecmp ("CollectVCL", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_vcl);
 		else if (strcasecmp ("CollectWorkers", child->key) == 0)
 			cf_util_get_boolean (child, &conf->collect_workers);
-#if HAVE_VARNISH_V4
 		else if (strcasecmp ("CollectVSM", child->key) == 0)
+#if HAVE_VARNISH_V4
 			cf_util_get_boolean (child, &conf->collect_vsm);
+#else
+			WARNING ("Varnish plugin: \"%s\" is available for Varnish %s only.", child->key, "v4");
 #endif
 		else
 		{
 			WARNING ("Varnish plugin: Ignoring unknown "
 					"configuration option: \"%s\". Did "
 					"you forget to add an <Instance /> "
@@ -1118,25 +1135,23 @@
 	ud.data = conf;
 	ud.free_func = varnish_config_free;
 
 	plugin_register_complex_read (/* group = */ "varnish",
 			/* name      = */ callback_name,
 			/* callback  = */ varnish_read,
-			/* interval  = */ NULL,
+			/* interval  = */ 0,
 			/* user data = */ &ud);
 
 	have_instance = 1;
 
 	return (0);
 } /* }}} int varnish_config_instance */
 
 static int varnish_config (oconfig_item_t *ci) /* {{{ */
 {
-	int i;
-
-	for (i = 0; i < ci->children_num; i++)
+	for (int i = 0; i < ci->children_num; i++)
 	{
 		oconfig_item_t *child = ci->children + i;
 
 		if (strcasecmp ("Instance", child->key) == 0)
 			varnish_config_instance (child);
 		else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/virt.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/virt.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/virt.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/virt.c	2016-09-11 16:10:25.279038699 +0800
@@ -17,15 +17,15 @@
  *
  * Authors:
  *   Richard W.M. Jones <rjones@redhat.com>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 #include "utils_ignorelist.h"
 #include "utils_complain.h"
 
 #include <libvirt/libvirt.h>
 #include <libvirt/virterror.h>
 #include <libxml/parser.h>
@@ -125,13 +125,13 @@
     plginst_none = 0,
     plginst_name,
     plginst_uuid
 };
 
 static enum plginst_field plugin_instance_format[PLGINST_MAX_FIELDS] =
-    { plginst_name };
+    { plginst_none };
 
 /* InterfaceFormat. */
 enum if_field {
     if_address,
     if_name,
     if_number
@@ -151,22 +151,22 @@
         if (err) ERROR ("%s: %s", (s), err->message);                   \
     } while(0)
 
 static void
 init_value_list (value_list_t *vl, virDomainPtr dom)
 {
-    int i, n;
+    int n;
     const char *name;
     char uuid[VIR_UUID_STRING_BUFLEN];
 
     sstrncpy (vl->plugin, PLUGIN_NAME, sizeof (vl->plugin));
 
     vl->host[0] = '\0';
 
     /* Construct the hostname field according to HostnameFormat. */
-    for (i = 0; i < HF_MAX_FIELDS; ++i) {
+    for (int i = 0; i < HF_MAX_FIELDS; ++i) {
         if (hostname_format[i] == hf_none)
             continue;
 
         n = DATA_MAX_NAME_LEN - strlen (vl->host) - 2;
 
         if (i > 0 && n >= 1) {
@@ -191,13 +191,13 @@
         }
     }
 
     vl->host[sizeof (vl->host) - 1] = '\0';
 
     /* Construct the plugin instance field according to PluginInstanceFormat. */
-    for (i = 0; i < PLGINST_MAX_FIELDS; ++i) {
+    for (int i = 0; i < PLGINST_MAX_FIELDS; ++i) {
         if (plugin_instance_format[i] == plginst_none)
             continue;
 
         n = sizeof(vl->plugin_instance) - strlen (vl->plugin_instance) - 2;
 
         if (i > 0 && n >= 1) {
@@ -391,13 +391,13 @@
         return 0;
     }
 
     if (strcasecmp (key, "HostnameFormat") == 0) {
         char *value_copy;
         char *fields[HF_MAX_FIELDS];
-        int i, n;
+        int n;
 
         value_copy = strdup (value);
         if (value_copy == NULL) {
             ERROR (PLUGIN_NAME " plugin: strdup failed.");
             return -1;
         }
@@ -406,13 +406,13 @@
         if (n < 1) {
             sfree (value_copy);
             ERROR (PLUGIN_NAME " plugin: HostnameFormat: no fields");
             return -1;
         }
 
-        for (i = 0; i < n; ++i) {
+        for (int i = 0; i < n; ++i) {
             if (strcasecmp (fields[i], "hostname") == 0)
                 hostname_format[i] = hf_hostname;
             else if (strcasecmp (fields[i], "name") == 0)
                 hostname_format[i] = hf_name;
             else if (strcasecmp (fields[i], "uuid") == 0)
                 hostname_format[i] = hf_uuid;
@@ -421,22 +421,22 @@
                 sfree (value_copy);
                 return -1;
             }
         }
         sfree (value_copy);
 
-        for (i = n; i < HF_MAX_FIELDS; ++i)
+        for (int i = n; i < HF_MAX_FIELDS; ++i)
             hostname_format[i] = hf_none;
 
         return 0;
     }
 
     if (strcasecmp (key, "PluginInstanceFormat") == 0) {
         char *value_copy;
         char *fields[PLGINST_MAX_FIELDS];
-        int i, n;
+        int n;
 
         value_copy = strdup (value);
         if (value_copy == NULL) {
             ERROR (PLUGIN_NAME " plugin: strdup failed.");
             return -1;
         }
@@ -445,26 +445,29 @@
         if (n < 1) {
             sfree (value_copy);
             ERROR (PLUGIN_NAME " plugin: PluginInstanceFormat: no fields");
             return -1;
         }
 
-        for (i = 0; i < n; ++i) {
-            if (strcasecmp (fields[i], "name") == 0)
+        for (int i = 0; i < n; ++i) {
+            if (strcasecmp (fields[i], "none") == 0) {
+                plugin_instance_format[i] = plginst_none;
+                break;
+            } else if (strcasecmp (fields[i], "name") == 0)
                 plugin_instance_format[i] = plginst_name;
             else if (strcasecmp (fields[i], "uuid") == 0)
                 plugin_instance_format[i] = plginst_uuid;
             else {
                 ERROR (PLUGIN_NAME " plugin: unknown PluginInstanceFormat field: %s", fields[i]);
                 sfree (value_copy);
                 return -1;
             }
         }
         sfree (value_copy);
 
-        for (i = n; i < PLGINST_MAX_FIELDS; ++i)
+        for (int i = n; i < PLGINST_MAX_FIELDS; ++i)
             plugin_instance_format[i] = plginst_none;
 
         return 0;
     }
 
     if (strcasecmp (key, "InterfaceFormat") == 0) {
@@ -486,13 +489,12 @@
 }
 
 static int
 lv_read (void)
 {
     time_t t;
-    int i;
 
     if (conn == NULL) {
         /* `conn_string == NULL' is acceptable. */
         conn = virConnectOpenReadOnly (conn_string);
         if (conn == NULL) {
             c_complain (LOG_ERR, &conn_complain,
@@ -516,31 +518,30 @@
             return -1;
         }
         last_refresh = t;
     }
 
 #if 0
-    for (i = 0; i < nr_domains; ++i)
+    for (int i = 0; i < nr_domains; ++i)
         fprintf (stderr, "domain %s\n", virDomainGetName (domains[i]));
-    for (i = 0; i < nr_block_devices; ++i)
+    for (int i = 0; i < nr_block_devices; ++i)
         fprintf  (stderr, "block device %d %s:%s\n",
                   i, virDomainGetName (block_devices[i].dom),
                   block_devices[i].path);
-    for (i = 0; i < nr_interface_devices; ++i)
+    for (int i = 0; i < nr_interface_devices; ++i)
         fprintf (stderr, "interface device %d %s:%s\n",
                  i, virDomainGetName (interface_devices[i].dom),
                  interface_devices[i].path);
 #endif
 
     /* Get CPU usage, memory, VCPU usage for each domain. */
-    for (i = 0; i < nr_domains; ++i) {
+    for (int i = 0; i < nr_domains; ++i) {
         virDomainInfo info;
         virVcpuInfoPtr vinfo = NULL;
         virDomainMemoryStatPtr minfo = NULL;
         int status;
-        int j;
 
         status = virDomainGetInfo (domains[i], &info);
         if (status != 0)
         {
             ERROR (PLUGIN_NAME " plugin: virDomainGetInfo failed with status %i.",
                     status);
@@ -569,43 +570,43 @@
             ERROR (PLUGIN_NAME " plugin: virDomainGetVcpus failed with status %i.",
                     status);
             sfree (vinfo);
             continue;
         }
 
-        for (j = 0; j < info.nrVirtCpu; ++j)
+        for (int j = 0; j < info.nrVirtCpu; ++j)
             vcpu_submit (vinfo[j].cpuTime,
                     domains[i], vinfo[j].number, "virt_vcpu");
 
         sfree (vinfo);
 
         minfo = malloc (VIR_DOMAIN_MEMORY_STAT_NR * sizeof (virDomainMemoryStatStruct));
         if (minfo == NULL) {
             ERROR ("virt plugin: malloc failed.");
             continue;
         }
 
-        status =  virDomainMemoryStats (domains[i], minfo, VIR_DOMAIN_MEMORY_STAT_NR, 0);
+        status = virDomainMemoryStats (domains[i], minfo, VIR_DOMAIN_MEMORY_STAT_NR, 0);
 
         if (status < 0) {
             ERROR ("virt plugin: virDomainMemoryStats failed with status %i.",
                     status);
             sfree (minfo);
             continue;
         }
 
-        for (j = 0; j < status; j++) {
+        for (int j = 0; j < status; j++) {
             memory_stats_submit ((gauge_t) minfo[j].val * 1024, domains[i], minfo[j].tag);
         }
 
         sfree (minfo);
     }
 
 
     /* Get block device stats for each domain. */
-    for (i = 0; i < nr_block_devices; ++i) {
+    for (int i = 0; i < nr_block_devices; ++i) {
         struct _virDomainBlockStats stats;
 
         if (virDomainBlockStats (block_devices[i].dom, block_devices[i].path,
                     &stats, sizeof stats) != 0)
             continue;
 
@@ -618,13 +619,13 @@
             submit_derive2 ("disk_octets",
                     (derive_t) stats.rd_bytes, (derive_t) stats.wr_bytes,
                     block_devices[i].dom, block_devices[i].path);
     } /* for (nr_block_devices) */
 
     /* Get interface stats for each domain. */
-    for (i = 0; i < nr_interface_devices; ++i) {
+    for (int i = 0; i < nr_interface_devices; ++i) {
         struct _virDomainInterfaceStats stats;
         char *display_name = NULL;
 
 
         switch (interface_format) {
             case if_address:
@@ -676,18 +677,17 @@
     if (n < 0) {
         VIRT_ERROR (conn, "reading number of domains");
         return -1;
     }
 
     if (n > 0) {
-        int i;
         int *domids;
 
         /* Get list of domains. */
-        domids = malloc (sizeof (int) * n);
-        if (domids == 0) {
+        domids = malloc (sizeof (*domids) * n);
+        if (domids == NULL) {
             ERROR (PLUGIN_NAME " plugin: malloc failed.");
             return -1;
         }
 
         n = virConnectListDomains (conn, domids, n);
         if (n < 0) {
@@ -698,20 +698,19 @@
 
         free_block_devices ();
         free_interface_devices ();
         free_domains ();
 
         /* Fetch each domain and add it to the list, unless ignore. */
-        for (i = 0; i < n; ++i) {
+        for (int i = 0; i < n; ++i) {
             virDomainPtr dom = NULL;
             const char *name;
             char *xml = NULL;
             xmlDocPtr xml_doc = NULL;
             xmlXPathContextPtr xpath_ctx = NULL;
             xmlXPathObjectPtr xpath_obj = NULL;
-            int j;
 
             dom = virDomainLookupByID (conn, domids[i]);
             if (dom == NULL) {
                 VIRT_ERROR (conn, "virDomainLookupByID");
                 /* Could be that the domain went away -- ignore it anyway. */
                 continue;
@@ -752,13 +751,13 @@
                 ((xmlChar *) "/domain/devices/disk/target[@dev]",
                  xpath_ctx);
             if (xpath_obj == NULL || xpath_obj->type != XPATH_NODESET ||
                 xpath_obj->nodesetval == NULL)
                 goto cont;
 
-            for (j = 0; j < xpath_obj->nodesetval->nodeNr; ++j) {
+            for (int j = 0; j < xpath_obj->nodesetval->nodeNr; ++j) {
                 xmlNodePtr node;
                 char *path = NULL;
 
                 node = xpath_obj->nodesetval->nodeTab[j];
                 if (!node) continue;
                 path = (char *) xmlGetProp (node, (xmlChar *) "dev");
@@ -781,22 +780,21 @@
             if (xpath_obj == NULL || xpath_obj->type != XPATH_NODESET ||
                 xpath_obj->nodesetval == NULL)
                 goto cont;
 
             xmlNodeSetPtr xml_interfaces = xpath_obj->nodesetval;
 
-            for (j = 0; j < xml_interfaces->nodeNr; ++j) {
+            for (int j = 0; j < xml_interfaces->nodeNr; ++j) {
                 char *path = NULL;
                 char *address = NULL;
                 xmlNodePtr xml_interface;
 
                 xml_interface = xml_interfaces->nodeTab[j];
                 if (!xml_interface) continue;
-                xmlNodePtr child = NULL;
 
-                for (child = xml_interface->children; child; child = child->next) {
+                for (xmlNodePtr child = xml_interface->children; child; child = child->next) {
                     if (child->type != XML_ELEMENT_NODE) continue;
 
                     if (xmlStrEqual(child->name, (const xmlChar *) "target")) {
                         path = (char *) xmlGetProp (child, (const xmlChar *) "dev");
                         if (!path) continue;
                     } else if (xmlStrEqual(child->name, (const xmlChar *) "mac")) {
@@ -827,18 +825,16 @@
     }
 
     return 0;
 }
 
 static void
-free_domains ()
+free_domains (void)
 {
-    int i;
-
     if (domains) {
-        for (i = 0; i < nr_domains; ++i)
+        for (int i = 0; i < nr_domains; ++i)
             virDomainFree (domains[i]);
         sfree (domains);
     }
     domains = NULL;
     nr_domains = 0;
 }
@@ -860,18 +856,16 @@
     domains = new_ptr;
     domains[nr_domains] = dom;
     return nr_domains++;
 }
 
 static void
-free_block_devices ()
+free_block_devices (void)
 {
-    int i;
-
     if (block_devices) {
-        for (i = 0; i < nr_block_devices; ++i)
+        for (int i = 0; i < nr_block_devices; ++i)
             sfree (block_devices[i].path);
         sfree (block_devices);
     }
     block_devices = NULL;
     nr_block_devices = 0;
 }
@@ -900,18 +894,16 @@
     block_devices[nr_block_devices].dom = dom;
     block_devices[nr_block_devices].path = path_copy;
     return nr_block_devices++;
 }
 
 static void
-free_interface_devices ()
+free_interface_devices (void)
 {
-    int i;
-
     if (interface_devices) {
-        for (i = 0; i < nr_interface_devices; ++i) {
+        for (int i = 0; i < nr_interface_devices; ++i) {
             sfree (interface_devices[i].path);
             sfree (interface_devices[i].address);
             sfree (interface_devices[i].number);
         }
         sfree (interface_devices);
     }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/vmem.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/vmem.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/vmem.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/vmem.c	2016-09-11 16:10:25.279038699 +0800
@@ -144,13 +145,13 @@
 
     endptr = NULL;
     gauge = strtod (fields[1], &endptr);
     if (fields[1] == endptr)
       continue;
 
-    /* 
+    /*
      * Number of pages
      *
      * The total number of {inst} pages, e. g dirty pages.
      */
     if (strncmp ("nr_", key, strlen ("nr_")) == 0)
     {
@@ -164,13 +165,13 @@
       {
         value_t value = { .gauge = gauge };
         submit_one (NULL, "vmpage_number", inst, value);
       }
     }
 
-    /* 
+    /*
      * Page in and page outs. For memory and swap.
      */
     else if (strcmp ("pgpgin", key) == 0)
     {
       pgpgin = counter;
       pgpgvalid |= 0x01;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/vserver.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/vserver.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/vserver.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/vserver.c	2016-09-11 16:10:25.279038699 +0800
@@ -128,69 +129,76 @@
 		return (-1);
 	return (v.derive);
 }
 
 static int vserver_read (void)
 {
-	DIR *proc;
+#if NAME_MAX < 1024
+# define DIRENT_BUFFER_SIZE (sizeof (struct dirent) + 1024 + 1)
+#else
+# define DIRENT_BUFFER_SIZE (sizeof (struct dirent) + NAME_MAX + 1)
+#endif
+
+	DIR 			*proc;
+	struct dirent 	*dent; /* 42 */
+	char dirent_buffer[DIRENT_BUFFER_SIZE];
 
 	errno = 0;
 	proc = opendir (PROCDIR);
 	if (proc == NULL)
 	{
 		char errbuf[1024];
-		ERROR ("vserver plugin: fopen (%s): %s", PROCDIR, 
+		ERROR ("vserver plugin: fopen (%s): %s", PROCDIR,
 				sstrerror (errno, errbuf, sizeof (errbuf)));
 		return (-1);
 	}
 
 	while (42)
 	{
-		struct dirent *dent;
 		int len;
 		char file[BUFSIZE];
 
 		FILE *fh;
 		char buffer[BUFSIZE];
 
 		struct stat statbuf;
 		char *cols[4];
 
 		int status;
 
-		errno = 0;
-		dent = readdir (proc);
-		if (dent == NULL)
+		status = readdir_r (proc, (struct dirent *) dirent_buffer, &dent);
+		if (status != 0)
 		{
 			char errbuf[4096];
-
-			if (errno == 0) /* end of directory */
-				break;
-
-			ERROR ("vserver plugin: failed to read directory %s: %s",
-					PROCDIR, sstrerror (errno, errbuf, sizeof (errbuf)));
+			ERROR ("vserver plugin: readdir_r failed: %s",
+					sstrerror (errno, errbuf, sizeof (errbuf)));
 			closedir (proc);
 			return (-1);
 		}
+		else if (dent == NULL)
+		{
+			/* end of directory */
+			break;
+		}
 
 		if (dent->d_name[0] == '.')
 			continue;
 
 		len = ssnprintf (file, sizeof (file), PROCDIR "/%s", dent->d_name);
 		if ((len < 0) || (len >= BUFSIZE))
 			continue;
-		
+
 		status = stat (file, &statbuf);
 		if (status != 0)
 		{
 			char errbuf[4096];
 			WARNING ("vserver plugin: stat (%s) failed: %s",
 					file, sstrerror (errno, errbuf, sizeof (errbuf)));
 			continue;
 		}
-		
+
 		if (!S_ISDIR (statbuf.st_mode))
 			continue;
 
 		/* socket message accounting */
 		len = ssnprintf (file, sizeof (file),
 				PROCDIR "/%s/cacct", dent->d_name);
@@ -205,13 +213,13 @@
 		}
 
 		while ((fh != NULL) && (NULL != fgets (buffer, BUFSIZE, fh)))
 		{
 			derive_t rx;
 			derive_t tx;
-			char *type_instance;
+			const char *type_instance;
 
 			if (strsplit (buffer, cols, 4) < 4)
 				continue;
 
 			if (0 == strcmp (cols[0], "UNIX:"))
 				type_instance = "unix";
@@ -255,13 +263,13 @@
 		while ((fh != NULL) && (NULL != fgets (buffer, BUFSIZE, fh)))
 		{
 			int n = strsplit (buffer, cols, 4);
 
 			if (2 == n)
 			{
-				char   *type_instance;
+				const char *type_instance;
 				gauge_t value;
 
 				if (0 == strcmp (cols[0], "nr_threads:"))
 					type_instance = "total";
 				else if (0 == strcmp (cols[0], "nr_running:"))
 					type_instance = "running";
@@ -304,14 +312,14 @@
 			ERROR ("Cannot open '%s': %s", file,
 					sstrerror (errno, errbuf, sizeof (errbuf)));
 		}
 
 		while ((fh != NULL) && (NULL != fgets (buffer, BUFSIZE, fh)))
 		{
-			char *type = "vs_memory";
-			char *type_instance;
+			const char *type = "vs_memory";
+			const char *type_instance;
 			gauge_t value;
 
 			if (strsplit (buffer, cols, 2) < 2)
 				continue;
 
 			if (0 == strcmp (cols[0], "PROC:"))
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/wireless.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/wireless.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/wireless.c	2016-11-29 00:08:22.427470675 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/wireless.c	2016-09-11 16:10:25.279038699 +0800
@@ -38,13 +39,13 @@
 static double wireless_dbm_to_watt (double dbm)
 {
 	double watt;
 
 	/*
 	 * dbm = 10 * log_{10} (1000 * power / W)
-	 * power = 10^(dbm/10) * W/1000 
+	 * power = 10^(dbm/10) * W/1000
 	 */
 
 	watt = pow (10.0, (dbm / 10.0)) / 1000.0;
 
 	return (watt);
 }
@@ -85,13 +86,13 @@
 	char buffer[1024];
 
 	char   *device;
 	double  quality;
 	double  power;
 	double  noise;
-	
+
 	char *fields[8];
 	int   numfields;
 
 	int devices_found;
 	int len;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_graphite.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_graphite.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_graphite.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_graphite.c	2016-09-11 16:10:25.279038699 +0800
@@ -40,54 +40,31 @@
   *     Prefix "collectd"
   *   </Carbon>
   * </Plugin>
   */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
-#include "utils_cache.h"
 #include "utils_complain.h"
 #include "utils_format_graphite.h"
 
-/* Folks without pthread will need to disable this plugin. */
-#include <pthread.h>
-
-#include <sys/socket.h>
 #include <netdb.h>
 
-#ifndef WG_DEFAULT_NODE
-# define WG_DEFAULT_NODE "localhost"
-#endif
-
-#ifndef WG_DEFAULT_SERVICE
-# define WG_DEFAULT_SERVICE "2003"
-#endif
-
-#ifndef WG_DEFAULT_PROTOCOL
-# define WG_DEFAULT_PROTOCOL "tcp"
-#endif
-
-#ifndef WG_DEFAULT_LOG_SEND_ERRORS
-# define WG_DEFAULT_LOG_SEND_ERRORS 1
-#endif
-
-#ifndef WG_DEFAULT_ESCAPE
-# define WG_DEFAULT_ESCAPE '_'
-#endif
+#define WG_DEFAULT_NODE "localhost"
+#define WG_DEFAULT_SERVICE "2003"
+#define WG_DEFAULT_PROTOCOL "tcp"
+#define WG_DEFAULT_LOG_SEND_ERRORS 1
+#define WG_DEFAULT_ESCAPE '_'
 
 /* Ethernet - (IPv6 + TCP) = 1500 - (40 + 32) = 1428 */
-#ifndef WG_SEND_BUF_SIZE
-# define WG_SEND_BUF_SIZE 1428
-#endif
-
-#ifndef WG_MIN_RECONNECT_INTERVAL
-# define WG_MIN_RECONNECT_INTERVAL TIME_T_TO_CDTIME_T (1)
-#endif
+#define WG_SEND_BUF_SIZE 1428
+
+#define WG_MIN_RECONNECT_INTERVAL TIME_T_TO_CDTIME_T (1)
 
 /*
  * Private variables
  */
 struct wg_callback
 {
@@ -110,14 +87,42 @@
     size_t   send_buf_fill;
     cdtime_t send_buf_init_time;
 
     pthread_mutex_t send_lock;
     c_complain_t init_complaint;
     cdtime_t last_connect_time;
+
+    /* Force reconnect useful for load balanced environments */
+    cdtime_t last_reconnect_time;
+    cdtime_t reconnect_interval;
+    _Bool reconnect_interval_reached;
 };
 
+/* wg_force_reconnect_check closes cb->sock_fd when it was open for longer
+ * than cb->reconnect_interval. Must hold cb->send_lock when calling. */
+static void wg_force_reconnect_check (struct wg_callback *cb)
+{
+    cdtime_t now;
+
+    if (cb->reconnect_interval == 0)
+        return;
+
+    /* check if address changes if addr_timeout */
+    now = cdtime ();
+    if ((now - cb->last_reconnect_time) < cb->reconnect_interval)
+        return;
+
+    /* here we should close connection on next */
+    close (cb->sock_fd);
+    cb->sock_fd = -1;
+    cb->last_reconnect_time = now;
+    cb->reconnect_interval_reached = 1;
+
+    INFO ("write_graphite plugin: Connection closed after %.3f seconds.",
+          CDTIME_T_TO_DOUBLE (now - cb->last_reconnect_time));
+}
 
 /*
  * Functions
  */
 static void wg_reset_buffer (struct wg_callback *cb)
 {
@@ -126,24 +131,25 @@
     cb->send_buf_fill = 0;
     cb->send_buf_init_time = cdtime ();
 }
 
 static int wg_send_buffer (struct wg_callback *cb)
 {
-    ssize_t status = 0;
+    ssize_t status;
+
+    if (cb->sock_fd < 0)
+        return (-1);
 
     status = swrite (cb->sock_fd, cb->send_buf, strlen (cb->send_buf));
     if (status != 0)
     {
-        const char *protocol = cb->protocol ? cb->protocol : WG_DEFAULT_PROTOCOL;
-
         if (cb->log_send_errors)
         {
             char errbuf[1024];
             ERROR ("write_graphite plugin: send to %s:%s (%s) failed with status %zi (%s)",
-                    cb->node, cb->service, protocol,
+                    cb->node, cb->service, cb->protocol,
                     status, sstrerror (errno, errbuf, sizeof (errbuf)));
         }
 
         close (cb->sock_fd);
         cb->sock_fd = -1;
 
@@ -170,13 +176,13 @@
 
         now = cdtime ();
         if ((cb->send_buf_init_time + timeout) > now)
             return (0);
     }
 
-    if (cb->send_buf_fill <= 0)
+    if (cb->send_buf_fill == 0)
     {
         cb->send_buf_init_time = cdtime ();
         return (0);
     }
 
     status = wg_send_buffer (cb);
@@ -184,67 +190,60 @@
 
     return (status);
 }
 
 static int wg_callback_init (struct wg_callback *cb)
 {
-    struct addrinfo ai_hints;
     struct addrinfo *ai_list;
-    struct addrinfo *ai_ptr;
     cdtime_t now;
     int status;
 
-    const char *node = cb->node ? cb->node : WG_DEFAULT_NODE;
-    const char *service = cb->service ? cb->service : WG_DEFAULT_SERVICE;
-    const char *protocol = cb->protocol ? cb->protocol : WG_DEFAULT_PROTOCOL;
-
     char connerr[1024] = "";
 
     if (cb->sock_fd > 0)
         return (0);
 
     /* Don't try to reconnect too often. By default, one reconnection attempt
      * is made per second. */
     now = cdtime ();
     if ((now - cb->last_connect_time) < WG_MIN_RECONNECT_INTERVAL)
         return (EAGAIN);
     cb->last_connect_time = now;
 
-    memset (&ai_hints, 0, sizeof (ai_hints));
-#ifdef AI_ADDRCONFIG
-    ai_hints.ai_flags |= AI_ADDRCONFIG;
-#endif
-    ai_hints.ai_family = AF_UNSPEC;
+    struct addrinfo ai_hints = {
+        .ai_family = AF_UNSPEC,
+        .ai_flags  = AI_ADDRCONFIG
+    };
 
-    if (0 == strcasecmp ("tcp", protocol))
+    if (0 == strcasecmp ("tcp", cb->protocol))
         ai_hints.ai_socktype = SOCK_STREAM;
     else
         ai_hints.ai_socktype = SOCK_DGRAM;
 
-    ai_list = NULL;
-
-    status = getaddrinfo (node, service, &ai_hints, &ai_list);
+    status = getaddrinfo (cb->node, cb->service, &ai_hints, &ai_list);
     if (status != 0)
     {
         ERROR ("write_graphite plugin: getaddrinfo (%s, %s, %s) failed: %s",
-                node, service, protocol, gai_strerror (status));
+                cb->node, cb->service, cb->protocol, gai_strerror (status));
         return (-1);
     }
 
     assert (ai_list != NULL);
-    for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+    for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
     {
         cb->sock_fd = socket (ai_ptr->ai_family, ai_ptr->ai_socktype,
                 ai_ptr->ai_protocol);
         if (cb->sock_fd < 0) {
             char errbuf[1024];
             snprintf (connerr, sizeof (connerr), "failed to open socket: %s",
                     sstrerror (errno, errbuf, sizeof (errbuf)));
             continue;
         }
 
+        set_sock_opts (cb->sock_fd);
+
         status = connect (cb->sock_fd, ai_ptr->ai_addr, ai_ptr->ai_addrlen);
         if (status != 0)
         {
             char errbuf[1024];
             snprintf (connerr, sizeof (connerr), "failed to connect to remote "
                     "host: %s", sstrerror (errno, errbuf, sizeof (errbuf)));
@@ -262,23 +261,29 @@
     {
         if (connerr[0] == '\0')
             /* this should not happen but try to get a message anyway */
             sstrerror (errno, connerr, sizeof (connerr));
         c_complain (LOG_ERR, &cb->init_complaint,
                   "write_graphite plugin: Connecting to %s:%s via %s failed. "
-                  "The last error was: %s", node, service, protocol, connerr);
+                  "The last error was: %s", cb->node, cb->service, cb->protocol, connerr);
         return (-1);
     }
     else
     {
         c_release (LOG_INFO, &cb->init_complaint,
                 "write_graphite plugin: Successfully connected to %s:%s via %s.",
-                node, service, protocol);
+                cb->node, cb->service, cb->protocol);
     }
 
-    wg_reset_buffer (cb);
+    /* wg_force_reconnect_check does not flush the buffer before closing a
+     * sending socket, so only call wg_reset_buffer() if the socket was closed
+     * for a different reason (tracked in cb->reconnect_interval_reached). */
+    if (!cb->reconnect_interval_reached || (cb->send_buf_free == 0))
+        wg_reset_buffer (cb);
+    else
+        cb->reconnect_interval_reached = 0;
 
     return (0);
 }
 
 static void wg_callback_free (void *data)
 {
@@ -348,12 +353,14 @@
     size_t message_len;
 
     message_len = strlen (message);
 
     pthread_mutex_lock (&cb->send_lock);
 
+    wg_force_reconnect_check (cb);
+
     if (cb->sock_fd < 0)
     {
         status = wg_callback_init (cb);
         if (status != 0)
         {
             /* An error message has already been printed. */
@@ -380,38 +387,35 @@
     memcpy (cb->send_buf + cb->send_buf_fill,
             message, message_len + 1);
     cb->send_buf_fill += message_len;
     cb->send_buf_free -= message_len;
 
     DEBUG ("write_graphite plugin: [%s]:%s (%s) buf %zu/%zu (%.1f %%) \"%s\"",
-            cb->node,
-            cb->service,
-            cb->protocol,
+            cb->node, cb->service, cb->protocol,
             cb->send_buf_fill, sizeof (cb->send_buf),
             100.0 * ((double) cb->send_buf_fill) / ((double) sizeof (cb->send_buf)),
             message);
 
     pthread_mutex_unlock (&cb->send_lock);
 
     return (0);
 }
 
 static int wg_write_messages (const data_set_t *ds, const value_list_t *vl,
         struct wg_callback *cb)
 {
-    char buffer[WG_SEND_BUF_SIZE];
+    char buffer[WG_SEND_BUF_SIZE] = { 0 };
     int status;
 
     if (0 != strcmp (ds->type, vl->type))
     {
         ERROR ("write_graphite plugin: DS type does not match "
                 "value list type");
         return -1;
     }
 
-    memset (buffer, 0, sizeof (buffer));
     status = format_graphite (buffer, sizeof (buffer), ds, vl,
             cb->prefix, cb->postfix, cb->escape_char, cb->format_flags);
     if (status != 0) /* error message has been printed already. */
         return (status);
 
     /* Send the message to graphite */
@@ -438,17 +442,15 @@
     return (status);
 }
 
 static int config_set_char (char *dest,
         oconfig_item_t *ci)
 {
-    char buffer[4];
+    char buffer[4] = { 0 };
     int status;
 
-    memset (buffer, 0, sizeof (buffer));
-
     status = cf_util_get_string_buffer (ci, buffer, sizeof (buffer));
     if (status != 0)
         return (status);
 
     if (buffer[0] == 0)
     {
@@ -469,29 +471,29 @@
     return (0);
 }
 
 static int wg_config_node (oconfig_item_t *ci)
 {
     struct wg_callback *cb;
-    user_data_t user_data;
     char callback_name[DATA_MAX_NAME_LEN];
-    int i;
     int status = 0;
 
-    cb = malloc (sizeof (*cb));
+    cb = calloc (1, sizeof (*cb));
     if (cb == NULL)
     {
-        ERROR ("write_graphite plugin: malloc failed.");
+        ERROR ("write_graphite plugin: calloc failed.");
         return (-1);
     }
-    memset (cb, 0, sizeof (*cb));
     cb->sock_fd = -1;
     cb->name = NULL;
-    cb->node = NULL;
-    cb->service = NULL;
-    cb->protocol = NULL;
+    cb->node = strdup (WG_DEFAULT_NODE);
+    cb->service = strdup (WG_DEFAULT_SERVICE);
+    cb->protocol = strdup (WG_DEFAULT_PROTOCOL);
+    cb->last_reconnect_time = cdtime();
+    cb->reconnect_interval = 0;
+    cb->reconnect_interval_reached = 0;
     cb->log_send_errors = WG_DEFAULT_LOG_SEND_ERRORS;
     cb->prefix = NULL;
     cb->postfix = NULL;
     cb->escape_char = WG_DEFAULT_ESCAPE;
     cb->format_flags = GRAPHITE_STORE_RATES;
 
@@ -506,13 +508,13 @@
         }
     }
 
     pthread_mutex_init (&cb->send_lock, /* attr = */ NULL);
     C_COMPLAIN_INIT (&cb->init_complaint);
 
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp ("Host", child->key) == 0)
             cf_util_get_string (child, &cb->node);
         else if (strcasecmp ("Port", child->key) == 0)
@@ -526,12 +528,14 @@
             {
                 ERROR ("write_graphite plugin: Unknown protocol (%s)",
                         cb->protocol);
                 status = -1;
             }
         }
+        else if (strcasecmp ("ReconnectInterval", child->key) == 0)
+            cf_util_get_cdtime (child, &cb->reconnect_interval);
         else if (strcasecmp ("LogSendErrors", child->key) == 0)
             cf_util_get_boolean (child, &cb->log_send_errors);
         else if (strcasecmp ("Prefix", child->key) == 0)
             cf_util_get_string (child, &cb->prefix);
         else if (strcasecmp ("Postfix", child->key) == 0)
             cf_util_get_string (child, &cb->postfix);
@@ -563,35 +567,33 @@
         return (status);
     }
 
     /* FIXME: Legacy configuration syntax. */
     if (cb->name == NULL)
         ssnprintf (callback_name, sizeof (callback_name), "write_graphite/%s/%s/%s",
-                cb->node != NULL ? cb->node : WG_DEFAULT_NODE,
-                cb->service != NULL ? cb->service : WG_DEFAULT_SERVICE,
-                cb->protocol != NULL ? cb->protocol : WG_DEFAULT_PROTOCOL);
+                cb->node, cb->service, cb->protocol);
     else
         ssnprintf (callback_name, sizeof (callback_name), "write_graphite/%s",
                 cb->name);
 
-    memset (&user_data, 0, sizeof (user_data));
-    user_data.data = cb;
-    user_data.free_func = wg_callback_free;
-    plugin_register_write (callback_name, wg_write, &user_data);
+    user_data_t ud = {
+        .data = cb,
+        .free_func = wg_callback_free
+    };
+
+    plugin_register_write (callback_name, wg_write, &ud);
 
-    user_data.free_func = NULL;
-    plugin_register_flush (callback_name, wg_flush, &user_data);
+    ud.free_func = NULL;
+    plugin_register_flush (callback_name, wg_flush, &ud);
 
     return (0);
 }
 
 static int wg_config (oconfig_item_t *ci)
 {
-    int i;
-
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp ("Node", child->key) == 0)
             wg_config_node (child);
         /* FIXME: Remove this legacy mode in version 6. */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_http.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_http.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_http.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_http.c	2016-09-11 16:10:25.279038699 +0800
@@ -21,20 +21,17 @@
  *   Florian octo Forster <octo at collectd.org>
  *   Doug MacEachern <dougm@hyperic.com>
  *   Paul Sadauskas <psadauskas@gmail.com>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "utils_cache.h"
 #include "utils_format_json.h"
-
-#if HAVE_PTHREAD_H
-# include <pthread.h>
-#endif
+#include "utils_format_kairosdb.h"
 
 #include <curl/curl.h>
 
 #ifndef WRITE_HTTP_DEFAULT_BUFFER_SIZE
 # define WRITE_HTTP_DEFAULT_BUFFER_SIZE 4096
 #endif
@@ -56,19 +53,23 @@
         char *capath;
         char *clientkey;
         char *clientcert;
         char *clientkeypass;
         long sslversion;
         _Bool store_rates;
+        _Bool log_http_error;
         int   low_speed_limit;
         time_t low_speed_time;
         int timeout;
 
-#define WH_FORMAT_COMMAND 0
-#define WH_FORMAT_JSON    1
+#define WH_FORMAT_COMMAND  0
+#define WH_FORMAT_JSON     1
+#define WH_FORMAT_KAIROSDB 2
         int format;
+        _Bool send_metrics;
+        _Bool send_notifications;
 
         CURL *curl;
         struct curl_slist *headers;
         char curl_errbuf[CURL_ERROR_SIZE];
 
         char  *send_buffer;
@@ -78,41 +79,61 @@
         cdtime_t send_buffer_init_time;
 
         pthread_mutex_t send_lock;
 };
 typedef struct wh_callback_s wh_callback_t;
 
+static void wh_log_http_error (wh_callback_t *cb)
+{
+        if (!cb->log_http_error)
+                return;
+
+        long http_code = 0;
+
+        curl_easy_getinfo (cb->curl, CURLINFO_RESPONSE_CODE, &http_code);
+
+        if (http_code != 200)
+                INFO ("write_http plugin: HTTP Error code: %lu", http_code);
+}
+
 static void wh_reset_buffer (wh_callback_t *cb)  /* {{{ */
 {
+        if ((cb == NULL) || (cb->send_buffer == NULL))
+                return;
+
         memset (cb->send_buffer, 0, cb->send_buffer_size);
         cb->send_buffer_free = cb->send_buffer_size;
         cb->send_buffer_fill = 0;
         cb->send_buffer_init_time = cdtime ();
 
-        if (cb->format == WH_FORMAT_JSON)
+        if (cb->format == WH_FORMAT_JSON || cb->format == WH_FORMAT_KAIROSDB)
         {
                 format_json_initialize (cb->send_buffer,
                                 &cb->send_buffer_fill,
                                 &cb->send_buffer_free);
         }
 } /* }}} wh_reset_buffer */
 
-static int wh_send_buffer (wh_callback_t *cb) /* {{{ */
+/* must hold cb->send_lock when calling */
+static int wh_post_nolock (wh_callback_t *cb, char const *data) /* {{{ */
 {
         int status = 0;
 
-        curl_easy_setopt (cb->curl, CURLOPT_POSTFIELDS, cb->send_buffer);
+        curl_easy_setopt (cb->curl, CURLOPT_POSTFIELDS, data);
         status = curl_easy_perform (cb->curl);
+
+        wh_log_http_error (cb);
+
         if (status != CURLE_OK)
         {
                 ERROR ("write_http plugin: curl_easy_perform failed with "
                                 "status %i: %s",
                                 status, cb->curl_errbuf);
         }
         return (status);
-} /* }}} wh_send_buffer */
+} /* }}} wh_post_nolock */
 
 static int wh_callback_init (wh_callback_t *cb) /* {{{ */
 {
         if (cb->curl != NULL)
                 return (0);
 
@@ -136,15 +157,14 @@
                 curl_easy_setopt (cb->curl, CURLOPT_TIMEOUT_MS, (long) cb->timeout);
 #endif
 
         curl_easy_setopt (cb->curl, CURLOPT_NOSIGNAL, 1L);
         curl_easy_setopt (cb->curl, CURLOPT_USERAGENT, COLLECTD_USERAGENT);
 
-        cb->headers = NULL;
         cb->headers = curl_slist_append (cb->headers, "Accept:  */*");
-        if (cb->format == WH_FORMAT_JSON)
+        if (cb->format == WH_FORMAT_JSON || cb->format == WH_FORMAT_KAIROSDB)
                 cb->headers = curl_slist_append (cb->headers, "Content-Type: application/json");
         else
                 cb->headers = curl_slist_append (cb->headers, "Content-Type: text/plain");
         cb->headers = curl_slist_append (cb->headers, "Expect:");
         curl_easy_setopt (cb->curl, CURLOPT_HTTPHEADER, cb->headers);
 
@@ -163,13 +183,13 @@
                 size_t credentials_size;
 
                 credentials_size = strlen (cb->user) + 2;
                 if (cb->pass != NULL)
                         credentials_size += strlen (cb->pass);
 
-                cb->credentials = (char *) malloc (credentials_size);
+                cb->credentials = malloc (credentials_size);
                 if (cb->credentials == NULL)
                 {
                         ERROR ("curl plugin: malloc failed.");
                         return (-1);
                 }
 
@@ -221,22 +241,22 @@
                 if ((cb->send_buffer_init_time + timeout) > now)
                         return (0);
         }
 
         if (cb->format == WH_FORMAT_COMMAND)
         {
-                if (cb->send_buffer_fill <= 0)
+                if (cb->send_buffer_fill == 0)
                 {
                         cb->send_buffer_init_time = cdtime ();
                         return (0);
                 }
 
-                status = wh_send_buffer (cb);
+                status = wh_post_nolock (cb, cb->send_buffer);
                 wh_reset_buffer (cb);
         }
-        else if (cb->format == WH_FORMAT_JSON)
+        else if (cb->format == WH_FORMAT_JSON || cb->format == WH_FORMAT_KAIROSDB)
         {
                 if (cb->send_buffer_fill <= 2)
                 {
                         cb->send_buffer_init_time = cdtime ();
                         return (0);
                 }
@@ -249,13 +269,13 @@
                         ERROR ("write_http: wh_flush_nolock: "
                                         "format_json_finalize failed.");
                         wh_reset_buffer (cb);
                         return (status);
                 }
 
-                status = wh_send_buffer (cb);
+                status = wh_post_nolock (cb, cb->send_buffer);
                 wh_reset_buffer (cb);
         }
         else
         {
                 ERROR ("write_http: wh_flush_nolock: "
                                 "Unknown format: %i",
@@ -277,21 +297,17 @@
                 return (-EINVAL);
 
         cb = user_data->data;
 
         pthread_mutex_lock (&cb->send_lock);
 
-        if (cb->curl == NULL)
+        if (wh_callback_init (cb) != 0)
         {
-                status = wh_callback_init (cb);
-                if (status != 0)
-                {
-                        ERROR ("write_http plugin: wh_callback_init failed.");
-                        pthread_mutex_unlock (&cb->send_lock);
-                        return (-1);
-                }
+                ERROR ("write_http plugin: wh_callback_init failed.");
+                pthread_mutex_unlock (&cb->send_lock);
+                return (-1);
         }
 
         status = wh_flush_nolock (timeout, cb);
         pthread_mutex_unlock (&cb->send_lock);
 
         return (status);
@@ -303,13 +319,14 @@
 
         if (data == NULL)
                 return;
 
         cb = data;
 
-        wh_flush_nolock (/* timeout = */ 0, cb);
+        if (cb->send_buffer != NULL)
+                wh_flush_nolock (/* timeout = */ 0, cb);
 
         if (cb->curl != NULL)
         {
                 curl_easy_cleanup (cb->curl);
                 cb->curl = NULL;
         }
@@ -342,13 +359,17 @@
         char values[512];
         char command[1024];
         size_t command_len;
 
         int status;
 
-        if (0 != strcmp (ds->type, vl->type)) {
+        /* sanity checks, primarily to make static analyzers happy. */
+        if ((cb == NULL) || (cb->send_buffer == NULL))
+                return -1;
+
+        if (strcmp (ds->type, vl->type) == 0) {
                 ERROR ("write_http plugin: DS type does not match "
                                 "value list type");
                 return -1;
         }
 
         /* Copy the identifier to `key' and escape it. */
@@ -377,22 +398,17 @@
                 ERROR ("write_http plugin: Command buffer too small: "
                                 "Need %zu bytes.", command_len + 1);
                 return (-1);
         }
 
         pthread_mutex_lock (&cb->send_lock);
-
-        if (cb->curl == NULL)
+        if (wh_callback_init (cb) != 0)
         {
-                status = wh_callback_init (cb);
-                if (status != 0)
-                {
-                        ERROR ("write_http plugin: wh_callback_init failed.");
-                        pthread_mutex_unlock (&cb->send_lock);
-                        return (-1);
-                }
+                ERROR ("write_http plugin: wh_callback_init failed.");
+                pthread_mutex_unlock (&cb->send_lock);
+                return (-1);
         }
 
         if (command_len >= cb->send_buffer_free)
         {
                 status = wh_flush_nolock (/* timeout = */ 0, cb);
                 if (status != 0)
@@ -425,39 +441,88 @@
 static int wh_write_json (const data_set_t *ds, const value_list_t *vl, /* {{{ */
                 wh_callback_t *cb)
 {
         int status;
 
         pthread_mutex_lock (&cb->send_lock);
+        if (wh_callback_init (cb) != 0)
+        {
+                ERROR ("write_http plugin: wh_callback_init failed.");
+                pthread_mutex_unlock (&cb->send_lock);
+                return (-1);
+        }
+
+        status = format_json_value_list (cb->send_buffer,
+                        &cb->send_buffer_fill,
+                        &cb->send_buffer_free,
+                        ds, vl, cb->store_rates);
+        if (status == -ENOMEM)
+        {
+                status = wh_flush_nolock (/* timeout = */ 0, cb);
+                if (status != 0)
+                {
+                        wh_reset_buffer (cb);
+                        pthread_mutex_unlock (&cb->send_lock);
+                        return (status);
+                }
+
+                status = format_json_value_list (cb->send_buffer,
+                                &cb->send_buffer_fill,
+                                &cb->send_buffer_free,
+                                ds, vl, cb->store_rates);
+        }
+        if (status != 0)
+        {
+                pthread_mutex_unlock (&cb->send_lock);
+                return (status);
+        }
+
+        DEBUG ("write_http plugin: <%s> buffer %zu/%zu (%g%%)",
+                        cb->location,
+                        cb->send_buffer_fill, cb->send_buffer_size,
+                        100.0 * ((double) cb->send_buffer_fill) / ((double) cb->send_buffer_size));
+
+        /* Check if we have enough space for this command. */
+        pthread_mutex_unlock (&cb->send_lock);
+
+        return (0);
+} /* }}} int wh_write_json */
+
+static int wh_write_kairosdb (const data_set_t *ds, const value_list_t *vl, /* {{{ */
+                wh_callback_t *cb)
+{
+        int status;
+
+        pthread_mutex_lock (&cb->send_lock);
 
         if (cb->curl == NULL)
         {
                 status = wh_callback_init (cb);
                 if (status != 0)
                 {
                         ERROR ("write_http plugin: wh_callback_init failed.");
                         pthread_mutex_unlock (&cb->send_lock);
                         return (-1);
                 }
         }
 
-        status = format_json_value_list (cb->send_buffer,
+        status = format_kairosdb_value_list (cb->send_buffer,
                         &cb->send_buffer_fill,
                         &cb->send_buffer_free,
                         ds, vl, cb->store_rates);
-        if (status == (-ENOMEM))
+        if (status == -ENOMEM)
         {
                 status = wh_flush_nolock (/* timeout = */ 0, cb);
                 if (status != 0)
                 {
                         wh_reset_buffer (cb);
                         pthread_mutex_unlock (&cb->send_lock);
                         return (status);
                 }
 
-                status = format_json_value_list (cb->send_buffer,
+                status = format_kairosdb_value_list (cb->send_buffer,
                                 &cb->send_buffer_fill,
                                 &cb->send_buffer_free,
                                 ds, vl, cb->store_rates);
         }
         if (status != 0)
         {
@@ -471,33 +536,73 @@
                         100.0 * ((double) cb->send_buffer_fill) / ((double) cb->send_buffer_size));
 
         /* Check if we have enough space for this command. */
         pthread_mutex_unlock (&cb->send_lock);
 
         return (0);
-} /* }}} int wh_write_json */
+} /* }}} int wh_write_kairosdb */
 
 static int wh_write (const data_set_t *ds, const value_list_t *vl, /* {{{ */
                 user_data_t *user_data)
 {
         wh_callback_t *cb;
         int status;
 
         if (user_data == NULL)
                 return (-EINVAL);
 
         cb = user_data->data;
+        assert (cb->send_metrics);
 
-        if (cb->format == WH_FORMAT_JSON)
+        switch(cb->format) {
+            case WH_FORMAT_JSON:
                 status = wh_write_json (ds, vl, cb);
-        else
+                break;
+            case WH_FORMAT_KAIROSDB:
+                status = wh_write_kairosdb (ds, vl, cb);
+                break;
+            default:
                 status = wh_write_command (ds, vl, cb);
-
+                break;
+        }
         return (status);
 } /* }}} int wh_write */
 
+static int wh_notify (notification_t const *n, user_data_t *ud) /* {{{ */
+{
+        wh_callback_t *cb;
+        char alert[4096];
+        int status;
+
+        if ((ud == NULL) || (ud->data == NULL))
+                return (EINVAL);
+
+        cb = ud->data;
+        assert (cb->send_notifications);
+
+        status = format_json_notification (alert, sizeof (alert), n);
+        if (status != 0)
+        {
+                ERROR ("write_http plugin: formatting notification failed");
+                return status;
+        }
+
+        pthread_mutex_lock (&cb->send_lock);
+        if (wh_callback_init (cb) != 0)
+        {
+                ERROR ("write_http plugin: wh_callback_init failed.");
+                pthread_mutex_unlock (&cb->send_lock);
+                return (-1);
+        }
+
+        status = wh_post_nolock (cb, alert);
+        pthread_mutex_unlock (&cb->send_lock);
+
+        return (status);
+} /* }}} int wh_notify */
+
 static int config_set_format (wh_callback_t *cb, /* {{{ */
                 oconfig_item_t *ci)
 {
         char *string;
 
         if ((ci->values_num != 1)
@@ -510,82 +615,106 @@
 
         string = ci->values[0].value.string;
         if (strcasecmp ("Command", string) == 0)
                 cb->format = WH_FORMAT_COMMAND;
         else if (strcasecmp ("JSON", string) == 0)
                 cb->format = WH_FORMAT_JSON;
+        else if (strcasecmp ("KAIROSDB", string) == 0)
+                cb->format = WH_FORMAT_KAIROSDB;
         else
         {
                 ERROR ("write_http plugin: Invalid format string: %s",
                                 string);
                 return (-1);
         }
 
         return (0);
 } /* }}} int config_set_format */
 
+static int wh_config_append_string (const char *name, struct curl_slist **dest, /* {{{ */
+    oconfig_item_t *ci)
+{
+  struct curl_slist *temp = NULL;
+  if ((ci->values_num != 1) || (ci->values[0].type != OCONFIG_TYPE_STRING))
+  {
+    WARNING ("write_http plugin: `%s' needs exactly one string argument.", name);
+    return (-1);
+  }
+
+  temp = curl_slist_append(*dest, ci->values[0].value.string);
+  if (temp == NULL)
+    return (-1);
+
+  *dest = temp;
+
+  return (0);
+} /* }}} int wh_config_append_string */
+
 static int wh_config_node (oconfig_item_t *ci) /* {{{ */
 {
         wh_callback_t *cb;
         int buffer_size = 0;
-        user_data_t user_data;
         char callback_name[DATA_MAX_NAME_LEN];
-        int i;
+        int status = 0;
 
-        cb = malloc (sizeof (*cb));
+        cb = calloc (1, sizeof (*cb));
         if (cb == NULL)
         {
-                ERROR ("write_http plugin: malloc failed.");
+                ERROR ("write_http plugin: calloc failed.");
                 return (-1);
         }
-        memset (cb, 0, sizeof (*cb));
         cb->verify_peer = 1;
         cb->verify_host = 1;
         cb->format = WH_FORMAT_COMMAND;
         cb->sslversion = CURL_SSLVERSION_DEFAULT;
         cb->low_speed_limit = 0;
         cb->timeout = 0;
+        cb->log_http_error = 0;
         cb->headers = NULL;
+        cb->send_metrics = 1;
+        cb->send_notifications = 0;
 
         pthread_mutex_init (&cb->send_lock, /* attr = */ NULL);
 
         cf_util_get_string (ci, &cb->name);
 
         /* FIXME: Remove this legacy mode in version 6. */
         if (strcasecmp ("URL", ci->key) == 0)
                 cf_util_get_string (ci, &cb->location);
 
-        for (i = 0; i < ci->children_num; i++)
+        for (int i = 0; i < ci->children_num; i++)
         {
                 oconfig_item_t *child = ci->children + i;
 
                 if (strcasecmp ("URL", child->key) == 0)
-                        cf_util_get_string (child, &cb->location);
+                        status = cf_util_get_string (child, &cb->location);
                 else if (strcasecmp ("User", child->key) == 0)
-                        cf_util_get_string (child, &cb->user);
+                        status = cf_util_get_string (child, &cb->user);
                 else if (strcasecmp ("Password", child->key) == 0)
-                        cf_util_get_string (child, &cb->pass);
+                        status = cf_util_get_string (child, &cb->pass);
                 else if (strcasecmp ("VerifyPeer", child->key) == 0)
-                        cf_util_get_boolean (child, &cb->verify_peer);
+                        status = cf_util_get_boolean (child, &cb->verify_peer);
                 else if (strcasecmp ("VerifyHost", child->key) == 0)
-                        cf_util_get_boolean (child, &cb->verify_host);
+                        status = cf_util_get_boolean (child, &cb->verify_host);
                 else if (strcasecmp ("CACert", child->key) == 0)
-                        cf_util_get_string (child, &cb->cacert);
+                        status = cf_util_get_string (child, &cb->cacert);
                 else if (strcasecmp ("CAPath", child->key) == 0)
-                        cf_util_get_string (child, &cb->capath);
+                        status = cf_util_get_string (child, &cb->capath);
                 else if (strcasecmp ("ClientKey", child->key) == 0)
-                        cf_util_get_string (child, &cb->clientkey);
+                        status = cf_util_get_string (child, &cb->clientkey);
                 else if (strcasecmp ("ClientCert", child->key) == 0)
-                        cf_util_get_string (child, &cb->clientcert);
+                        status = cf_util_get_string (child, &cb->clientcert);
                 else if (strcasecmp ("ClientKeyPass", child->key) == 0)
-                        cf_util_get_string (child, &cb->clientkeypass);
+                        status = cf_util_get_string (child, &cb->clientkeypass);
                 else if (strcasecmp ("SSLVersion", child->key) == 0)
                 {
                         char *value = NULL;
 
-                        cf_util_get_string (child, &value);
+                        status = cf_util_get_string (child, &value);
+                        if (status != 0)
+                                break;
 
                         if (value == NULL || strcasecmp ("default", value) == 0)
                                 cb->sslversion = CURL_SSLVERSION_DEFAULT;
                         else if (strcasecmp ("SSLv2", value) == 0)
                                 cb->sslversion = CURL_SSLVERSION_SSLv2;
                         else if (strcasecmp ("SSLv3", value) == 0)
@@ -598,42 +727,71 @@
                         else if (strcasecmp ("TLSv1_1", value) == 0)
                                 cb->sslversion = CURL_SSLVERSION_TLSv1_1;
                         else if (strcasecmp ("TLSv1_2", value) == 0)
                                 cb->sslversion = CURL_SSLVERSION_TLSv1_2;
 #endif
                         else
+                        {
                                 ERROR ("write_http plugin: Invalid SSLVersion "
                                                 "option: %s.", value);
+                                status = EINVAL;
+                        }
 
                         sfree(value);
                 }
                 else if (strcasecmp ("Format", child->key) == 0)
-                        config_set_format (cb, child);
+                        status = config_set_format (cb, child);
+                else if (strcasecmp ("Metrics", child->key) == 0)
+                        cf_util_get_boolean (child, &cb->send_metrics);
+                else if (strcasecmp ("Notifications", child->key) == 0)
+                        cf_util_get_boolean (child, &cb->send_notifications);
                 else if (strcasecmp ("StoreRates", child->key) == 0)
-                        cf_util_get_boolean (child, &cb->store_rates);
+                        status = cf_util_get_boolean (child, &cb->store_rates);
                 else if (strcasecmp ("BufferSize", child->key) == 0)
-                        cf_util_get_int (child, &buffer_size);
+                        status = cf_util_get_int (child, &buffer_size);
                 else if (strcasecmp ("LowSpeedLimit", child->key) == 0)
-                        cf_util_get_int (child, &cb->low_speed_limit);
+                        status = cf_util_get_int (child, &cb->low_speed_limit);
                 else if (strcasecmp ("Timeout", child->key) == 0)
-                        cf_util_get_int (child, &cb->timeout);
+                        status = cf_util_get_int (child, &cb->timeout);
+                else if (strcasecmp ("LogHttpError", child->key) == 0)
+                        status = cf_util_get_boolean (child, &cb->log_http_error);
+                else if (strcasecmp ("Header", child->key) == 0)
+                        status = wh_config_append_string ("Header", &cb->headers, child);
                 else
                 {
                         ERROR ("write_http plugin: Invalid configuration "
                                         "option: %s.", child->key);
+                        status = EINVAL;
                 }
+
+                if (status != 0)
+                        break;
+        }
+
+        if (status != 0)
+        {
+                wh_callback_free (cb);
+                return (status);
         }
 
         if (cb->location == NULL)
         {
                 ERROR ("write_http plugin: no URL defined for instance '%s'",
                         cb->name);
                 wh_callback_free (cb);
                 return (-1);
         }
 
+        if (!cb->send_metrics && !cb->send_notifications)
+        {
+                ERROR ("write_http plugin: Neither metrics nor notifications "
+                       "are enabled for \"%s\".", cb->name);
+                wh_callback_free (cb);
+                return (-1);
+        }
+
         if (cb->low_speed_limit > 0)
                 cb->low_speed_time = CDTIME_T_TO_TIME_T(plugin_get_interval());
 
         /* Determine send_buffer_size. */
         cb->send_buffer_size = WRITE_HTTP_DEFAULT_BUFFER_SIZE;
         if (buffer_size >= 1024)
@@ -655,28 +813,40 @@
 
         ssnprintf (callback_name, sizeof (callback_name), "write_http/%s",
                         cb->name);
         DEBUG ("write_http: Registering write callback '%s' with URL '%s'",
                         callback_name, cb->location);
 
-        memset (&user_data, 0, sizeof (user_data));
-        user_data.data = cb;
-        user_data.free_func = NULL;
+        user_data_t user_data = {
+                .data = cb
+        };
+
         plugin_register_flush (callback_name, wh_flush, &user_data);
 
         user_data.free_func = wh_callback_free;
-        plugin_register_write (callback_name, wh_write, &user_data);
+
+        if (cb->send_metrics)
+        {
+                plugin_register_write (callback_name, wh_write, &user_data);
+                user_data.free_func = NULL;
+
+                plugin_register_flush (callback_name, wh_flush, &user_data);
+        }
+
+        if (cb->send_notifications)
+        {
+                plugin_register_notification (callback_name, wh_notify, &user_data);
+                user_data.free_func = NULL;
+        }
 
         return (0);
 } /* }}} int wh_config_node */
 
 static int wh_config (oconfig_item_t *ci) /* {{{ */
 {
-        int i;
-
-        for (i = 0; i < ci->children_num; i++)
+        for (int i = 0; i < ci->children_num; i++)
         {
                 oconfig_item_t *child = ci->children + i;
 
                 if (strcasecmp ("Node", child->key) == 0)
                         wh_config_node (child);
                 /* FIXME: Remove this legacy mode in version 6. */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_kafka.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_kafka.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_kafka.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_kafka.c	2016-09-11 16:10:25.279038699 +0800
@@ -25,74 +25,69 @@
  */
 
 #include "collectd.h"
 
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
-#include "utils_cache.h"
 #include "utils_cmd_putval.h"
 #include "utils_format_graphite.h"
 #include "utils_format_json.h"
-#include "utils_crc32.h"
 
 #include <stdint.h>
 #include <librdkafka/rdkafka.h>
-#include <pthread.h>
-#include <zlib.h>
 #include <errno.h>
 
 struct kafka_topic_context {
 #define KAFKA_FORMAT_JSON        0
 #define KAFKA_FORMAT_COMMAND     1
 #define KAFKA_FORMAT_GRAPHITE    2
-    uint8_t                     format;
+    uint8_t                      format;
     unsigned int                 graphite_flags;
     _Bool                        store_rates;
     rd_kafka_topic_conf_t       *conf;
     rd_kafka_topic_t            *topic;
     rd_kafka_conf_t             *kafka_conf;
     rd_kafka_t                  *kafka;
-    int                          has_key;
-    uint32_t                    key;
+    char                        *key;
     char                        *prefix;
     char                        *postfix;
     char                         escape_char;
     char                        *topic_name;
-    pthread_mutex_t 		lock;
+    pthread_mutex_t              lock;
 };
 
 static int kafka_handle(struct kafka_topic_context *);
 static int kafka_write(const data_set_t *, const value_list_t *, user_data_t *);
 static int32_t kafka_partition(const rd_kafka_topic_t *, const void *, size_t,
                                int32_t, void *, void *);
 
-/* Version 0.9.0 of librdkafka deprecates rd_kafka_set_logger() in favor of
- * rd_kafka_conf_set_log_cb(). This is to make sure we're not using the
- * deprecated function. */
-#ifdef HAVE_LIBRDKAFKA_LOG_CB
-# undef HAVE_LIBRDKAFKA_LOGGER
-#endif
-
-#if defined(HAVE_LIBRDKAFKA_LOGGER) || defined(HAVE_LIBRDKAFKA_LOG_CB)
+#if defined HAVE_LIBRDKAFKA_LOGGER || defined HAVE_LIBRDKAFKA_LOG_CB
 static void kafka_log(const rd_kafka_t *, int, const char *, const char *);
 
 static void kafka_log(const rd_kafka_t *rkt, int level,
                       const char *fac, const char *msg)
 {
     plugin_log(level, "%s", msg);
 }
 #endif
 
+static uint32_t kafka_hash(const char *keydata, size_t keylen)
+{
+    uint32_t hash = 5381;
+    for (; keylen > 0; keylen--)
+        hash = ((hash << 5) + hash) + keydata[keylen - 1];
+    return hash;
+}
+
 static int32_t kafka_partition(const rd_kafka_topic_t *rkt,
                                const void *keydata, size_t keylen,
                                int32_t partition_cnt, void *p, void *m)
 {
-    uint32_t key = *((uint32_t *)keydata );
+    uint32_t key = kafka_hash(keydata, keylen);
     uint32_t target = key % partition_cnt;
-    int32_t   i = partition_cnt;
+    int32_t  i = partition_cnt;
 
     while (--i > 0 && !rd_kafka_topic_partition_available(rkt, target)) {
         target = (target + 1) % partition_cnt;
     }
     return target;
 }
@@ -111,37 +106,37 @@
             ERROR("write_kafka plugin: cannot duplicate kafka config");
             return(1);
         }
 
         if ((ctx->kafka = rd_kafka_new(RD_KAFKA_PRODUCER, conf,
                                     errbuf, sizeof(errbuf))) == NULL) {
-        	ERROR("write_kafka plugin: cannot create kafka handle.");
-        	return 1;
+            ERROR("write_kafka plugin: cannot create kafka handle.");
+            return 1;
         }
 
     	rd_kafka_conf_destroy(ctx->kafka_conf);
     	ctx->kafka_conf = NULL;
 
     	INFO ("write_kafka plugin: created KAFKA handle : %s", rd_kafka_name(ctx->kafka));
 
-#ifdef HAVE_LIBRDKAFKA_LOGGER
+#if defined(HAVE_LIBRDKAFKA_LOGGER) && !defined(HAVE_LIBRDKAFKA_LOG_CB)
     	rd_kafka_set_logger(ctx->kafka, kafka_log);
 #endif
     }
 
     if (ctx->topic == NULL ) {
     	if ((topic_conf = rd_kafka_topic_conf_dup(ctx->conf)) == NULL) {
             ERROR("write_kafka plugin: cannot duplicate kafka topic config");
             return 1;
 	}
 
     	if ((ctx->topic = rd_kafka_topic_new(ctx->kafka, ctx->topic_name,
-                                       		topic_conf)) == NULL) {
-        	ERROR("write_kafka plugin: cannot create topic : %s\n", 
-			rd_kafka_err2str(rd_kafka_errno2err(errno)));
-        	return errno;
+                                            topic_conf)) == NULL) {
+            ERROR("write_kafka plugin: cannot create topic : %s\n",
+            rd_kafka_err2str(rd_kafka_errno2err(errno)));
+            return errno;
 	}
 
     	rd_kafka_topic_conf_destroy(ctx->conf);
 	ctx->conf = NULL;
 
     	INFO ("write_kafka plugin: handle created for topic : %s", rd_kafka_topic_name(ctx->topic));
@@ -149,22 +144,23 @@
 
     return(0);
 
 } /* }}} int kafka_handle */
 
 static int kafka_write(const data_set_t *ds, /* {{{ */
-	      const value_list_t *vl,
-	      user_data_t *ud)
+          const value_list_t *vl,
+          user_data_t *ud)
 {
-	int			 status = 0;
-    uint32_t    key;
-    char         buffer[8192];
-    size_t bfree = sizeof(buffer);
-    size_t bfill = 0;
-    size_t blen = 0;
-	struct kafka_topic_context	*ctx = ud->data;
+    int      status = 0;
+    void    *key;
+    size_t   keylen = 0;
+    char     buffer[8192];
+    size_t   bfree = sizeof(buffer);
+    size_t   bfill = 0;
+    size_t   blen = 0;
+    struct   kafka_topic_context  *ctx = ud->data;
 
     if ((ds == NULL) || (vl == NULL) || (ctx == NULL))
         return EINVAL;
 
     pthread_mutex_lock (&ctx->lock);
     status = kafka_handle(ctx);
@@ -205,33 +200,31 @@
         break;
     default:
         ERROR("write_kafka plugin: invalid format %i.", ctx->format);
         return -1;
     }
 
-    /*
-     * We partition our stream by metric name
-     */
-    if (ctx->has_key)
-        key = ctx->key;
+    key = ctx->key;
+    if (key != NULL)
+        keylen = strlen (key);
     else
-        key = rand();
+        keylen = 0;
 
     rd_kafka_produce(ctx->topic, RD_KAFKA_PARTITION_UA,
                      RD_KAFKA_MSG_F_COPY, buffer, blen,
-                     &key, sizeof(key), NULL);
+                     key, keylen, NULL);
 
-	return status;
+    return status;
 } /* }}} int kafka_write */
 
 static void kafka_topic_context_free(void *p) /* {{{ */
 {
-	struct kafka_topic_context *ctx = p;
+    struct kafka_topic_context *ctx = p;
 
-	if (ctx == NULL)
-		return;
+    if (ctx == NULL)
+        return;
 
     if (ctx->topic_name != NULL)
         sfree(ctx->topic_name);
     if (ctx->topic != NULL)
         rd_kafka_topic_destroy(ctx->topic);
     if (ctx->conf != NULL)
@@ -244,30 +237,29 @@
     sfree(ctx);
 } /* }}} void kafka_topic_context_free */
 
 static void kafka_config_topic(rd_kafka_conf_t *conf, oconfig_item_t *ci) /* {{{ */
 {
     int                          status;
-    int                          i;
     struct kafka_topic_context  *tctx;
     char                        *key = NULL;
     char                        *val;
     char                         callback_name[DATA_MAX_NAME_LEN];
     char                         errbuf[1024];
-    user_data_t                  ud;
-	oconfig_item_t              *child;
+    oconfig_item_t              *child;
     rd_kafka_conf_res_t          ret;
 
-	if ((tctx = calloc(1, sizeof (*tctx))) == NULL) {
-		ERROR ("write_kafka plugin: calloc failed.");
+    if ((tctx = calloc(1, sizeof (*tctx))) == NULL) {
+        ERROR ("write_kafka plugin: calloc failed.");
         return;
-	}
+    }
 
     tctx->escape_char = '.';
     tctx->store_rates = 1;
     tctx->format = KAFKA_FORMAT_JSON;
+    tctx->key = NULL;
 
     if ((tctx->kafka_conf = rd_kafka_conf_dup(conf)) == NULL) {
         sfree(tctx);
         ERROR("write_kafka plugin: cannot allocate memory for kafka config");
         return;
     }
@@ -295,54 +287,43 @@
 
     if ((tctx->topic_name = strdup(ci->values[0].value.string)) == NULL) {
         ERROR("write_kafka plugin: cannot copy topic name.");
         goto errout;
     }
 
-	for (i = 0; i < ci->children_num; i++) {
-		/*
-		 * The code here could be simplified but makes room
-		 * for easy adding of new options later on.
-		 */
-		child = &ci->children[i];
-		status = 0;
-
-		if (strcasecmp ("Property", child->key) == 0) {
-			if (child->values_num != 2) {
-				WARNING("kafka properties need both a key and a value.");
+    for (int i = 0; i < ci->children_num; i++) {
+        /*
+         * The code here could be simplified but makes room
+         * for easy adding of new options later on.
+         */
+        child = &ci->children[i];
+        status = 0;
+
+        if (strcasecmp ("Property", child->key) == 0) {
+            if (child->values_num != 2) {
+                WARNING("kafka properties need both a key and a value.");
                 goto errout;
-			}
-			if (child->values[0].type != OCONFIG_TYPE_STRING ||
-			    child->values[1].type != OCONFIG_TYPE_STRING) {
-				WARNING("kafka properties needs string arguments.");
+            }
+            if (child->values[0].type != OCONFIG_TYPE_STRING ||
+                child->values[1].type != OCONFIG_TYPE_STRING) {
+                WARNING("kafka properties needs string arguments.");
                 goto errout;
-			}
+            }
             key = child->values[0].value.string;
             val = child->values[1].value.string;
             ret = rd_kafka_topic_conf_set(tctx->conf,key, val,
                                           errbuf, sizeof(errbuf));
             if (ret != RD_KAFKA_CONF_OK) {
-				WARNING("cannot set kafka topic property %s to %s: %s.",
+                WARNING("cannot set kafka topic property %s to %s: %s.",
                         key, val, errbuf);
                 goto errout;
-			}
-
-        } else if (strcasecmp ("Key", child->key) == 0)  {
-            char *tmp_buf = NULL;
-            status = cf_util_get_string(child, &tmp_buf);
-            if (status != 0) {
-                WARNING("write_kafka plugin: invalid key supplied");
-                break;
-            }
-
-            if (strcasecmp(tmp_buf, "Random") != 0) {
-                tctx->has_key = 1;
-                tctx->key = crc32_buffer((u_char *)tmp_buf, strlen(tmp_buf));
             }
-            sfree(tmp_buf);
 
+        } else if (strcasecmp ("Key", child->key) == 0)  {
+            cf_util_get_string (child, &tctx->key);
+            assert (tctx->key != NULL);
         } else if (strcasecmp ("Format", child->key) == 0) {
             status = cf_util_get_string(child, &key);
             if (status != 0)
                 goto errout;
 
             assert(key != NULL);
@@ -399,97 +380,99 @@
     rd_kafka_topic_conf_set_partitioner_cb(tctx->conf, kafka_partition);
     rd_kafka_topic_conf_set_opaque(tctx->conf, tctx);
 
     ssnprintf(callback_name, sizeof(callback_name),
               "write_kafka/%s", tctx->topic_name);
 
-    ud.data = tctx;
-    ud.free_func = kafka_topic_context_free;
-
-	status = plugin_register_write (callback_name, kafka_write, &ud);
-	if (status != 0) {
-		WARNING ("write_kafka plugin: plugin_register_write (\"%s\") "
-				"failed with status %i.",
-				callback_name, status);
+    user_data_t ud = {
+        .data = tctx,
+        .free_func = kafka_topic_context_free
+    };
+
+    status = plugin_register_write (callback_name, kafka_write, &ud);
+    if (status != 0) {
+        WARNING ("write_kafka plugin: plugin_register_write (\"%s\") "
+                "failed with status %i.",
+                callback_name, status);
         goto errout;
     }
 
     pthread_mutex_init (&tctx->lock, /* attr = */ NULL);
 
     return;
  errout:
     if (tctx->topic_name != NULL)
         free(tctx->topic_name);
     if (tctx->conf != NULL)
         rd_kafka_topic_conf_destroy(tctx->conf);
     if (tctx->kafka_conf != NULL)
-		rd_kafka_conf_destroy(tctx->kafka_conf);
+        rd_kafka_conf_destroy(tctx->kafka_conf);
     sfree(tctx);
 } /* }}} int kafka_config_topic */
 
 static int kafka_config(oconfig_item_t *ci) /* {{{ */
 {
-	int                          i;
-	oconfig_item_t              *child;
+    oconfig_item_t              *child;
     rd_kafka_conf_t             *conf;
     rd_kafka_conf_res_t          ret;
     char                         errbuf[1024];
 
     if ((conf = rd_kafka_conf_new()) == NULL) {
         WARNING("cannot allocate kafka configuration.");
         return -1;
     }
-	for (i = 0; i < ci->children_num; i++)  {
-		child = &ci->children[i];
+    for (int i = 0; i < ci->children_num; i++)  {
+        child = &ci->children[i];
 
-		if (strcasecmp("Topic", child->key) == 0) {
-			kafka_config_topic (conf, child);
-		} else if (strcasecmp(child->key, "Property") == 0) {
-			char *key = NULL;
-			char *val = NULL;
+        if (strcasecmp("Topic", child->key) == 0) {
+            kafka_config_topic (conf, child);
+        } else if (strcasecmp(child->key, "Property") == 0) {
+            char *key = NULL;
+            char *val = NULL;
 
-			if (child->values_num != 2) {
-				WARNING("kafka properties need both a key and a value.");
+            if (child->values_num != 2) {
+                WARNING("kafka properties need both a key and a value.");
                 goto errout;
-			}
-			if (child->values[0].type != OCONFIG_TYPE_STRING ||
-			    child->values[1].type != OCONFIG_TYPE_STRING) {
-				WARNING("kafka properties needs string arguments.");
+            }
+            if (child->values[0].type != OCONFIG_TYPE_STRING ||
+                child->values[1].type != OCONFIG_TYPE_STRING) {
+                WARNING("kafka properties needs string arguments.");
                 goto errout;
-			}
-			if ((key = strdup(child->values[0].value.string)) == NULL) {
-				WARNING("cannot allocate memory for attribute key.");
+            }
+            if ((key = strdup(child->values[0].value.string)) == NULL) {
+                WARNING("cannot allocate memory for attribute key.");
                 goto errout;
-			}
-			if ((val = strdup(child->values[1].value.string)) == NULL) {
-				WARNING("cannot allocate memory for attribute value.");
+            }
+            if ((val = strdup(child->values[1].value.string)) == NULL) {
+                WARNING("cannot allocate memory for attribute value.");
+                sfree(key);
                 goto errout;
-			}
+            }
             ret = rd_kafka_conf_set(conf, key, val, errbuf, sizeof(errbuf));
             if (ret != RD_KAFKA_CONF_OK) {
                 WARNING("cannot set kafka property %s to %s: %s",
                         key, val, errbuf);
+                sfree(key);
+                sfree(val);
                 goto errout;
             }
-			sfree(key);
-			sfree(val);
-		} else {
-			WARNING ("write_kafka plugin: Ignoring unknown "
-				 "configuration option \"%s\" at top level.",
-				 child->key);
-		}
+            sfree(key);
+            sfree(val);
+        } else {
+            WARNING ("write_kafka plugin: Ignoring unknown "
+                 "configuration option \"%s\" at top level.",
+                 child->key);
 	}
+    }
     if (conf != NULL)
         rd_kafka_conf_destroy(conf);
     return (0);
  errout:
     if (conf != NULL)
         rd_kafka_conf_destroy(conf);
     return -1;
 } /* }}} int kafka_config */
 
 void module_register(void)
 {
-	plugin_register_complex_config ("write_kafka", kafka_config);
+    plugin_register_complex_config ("write_kafka", kafka_config);
 }
-
-/* vim: set sw=8 sts=8 ts=8 noet : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_log.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_log.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_log.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_log.c	2016-09-11 16:10:25.279038699 +0800
@@ -23,51 +23,46 @@
  * Authors:
  *   Pierre-Yves Ritschard <pyr at spootnik.org>
  *
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include "utils_format_graphite.h"
 
-/* Folks without pthread will need to disable this plugin. */
-#include <pthread.h>
-
-#include <sys/socket.h>
 #include <netdb.h>
 
 #define WL_BUF_SIZE 8192
 
 static int wl_write_messages (const data_set_t *ds, const value_list_t *vl)
 {
-    char buffer[WL_BUF_SIZE];
+    char buffer[WL_BUF_SIZE] = { 0 };
     int status;
 
     if (0 != strcmp (ds->type, vl->type))
     {
         ERROR ("write_log plugin: DS type does not match "
                 "value list type");
         return -1;
     }
 
-    memset (buffer, 0, sizeof (buffer));
     status = format_graphite (buffer, sizeof (buffer), ds, vl,
                               NULL, NULL, '_', 0);
     if (status != 0) /* error message has been printed already. */
         return (status);
 
     INFO ("write_log values:\n%s", buffer);
 
     return (0);
 } /* int wl_write_messages */
 
 static int wl_write (const data_set_t *ds, const value_list_t *vl,
-        user_data_t *user_data)
+        __attribute__ ((unused)) user_data_t *user_data)
 {
     int status;
 
     status = wl_write_messages (ds, vl);
 
     return (status);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_mongodb.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_mongodb.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_mongodb.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_mongodb.c	2016-09-11 16:10:25.279038699 +0800
@@ -26,19 +26,17 @@
  *   Florian Forster <octo at collectd.org>
  *   Akkarit Sangpetch <asangpet at andrew.cmu.edu>
  *   Chris Lundquist <clundquist at bluebox.net>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "utils_cache.h"
 
-#include <pthread.h>
-
 #if HAVE_STDINT_H
 # define MONGO_HAVE_STDINT 1
 #else
 # define MONGO_USE_LONG_LONG_INT 1
 #endif
 #include <mongo.h>
@@ -74,13 +72,12 @@
 static bson *wm_create_bson (const data_set_t *ds, /* {{{ */
     const value_list_t *vl,
     _Bool store_rates)
 {
   bson *ret;
   gauge_t *rates;
-  int i;
 
   ret = bson_alloc (); /* matched by bson_dealloc() */
   if (ret == NULL)
   {
     ERROR ("write_mongodb plugin: bson_create failed.");
     return (NULL);
@@ -106,13 +103,13 @@
   bson_append_string (ret, "plugin", vl->plugin);
   bson_append_string (ret, "plugin_instance", vl->plugin_instance);
   bson_append_string (ret, "type", vl->type);
   bson_append_string (ret, "type_instance", vl->type_instance);
 
   bson_append_start_array (ret, "values"); /* {{{ */
-  for (i = 0; i < ds->ds_num; i++)
+  for (int i = 0; i < ds->ds_num; i++)
   {
     char key[16];
 
     ssnprintf (key, sizeof (key), "%i", i);
 
     if (ds->ds[i].type == DS_TYPE_GAUGE)
@@ -128,13 +125,13 @@
     else
       assert (23 == 42);
   }
   bson_append_finish_array (ret); /* }}} values */
 
   bson_append_start_array (ret, "dstypes"); /* {{{ */
-  for (i = 0; i < ds->ds_num; i++)
+  for (int i = 0; i < ds->ds_num; i++)
   {
     char key[16];
 
     ssnprintf (key, sizeof (key), "%i", i);
 
     if (store_rates)
@@ -142,13 +139,13 @@
     else
       bson_append_string (ret, key, DS_TYPE_TO_STRING (ds->ds[i].type));
   }
   bson_append_finish_array (ret); /* }}} dstypes */
 
   bson_append_start_array (ret, "dsnames"); /* {{{ */
-  for (i = 0; i < ds->ds_num; i++)
+  for (int i = 0; i < ds->ds_num; i++)
   {
     char key[16];
 
     ssnprintf (key, sizeof (key), "%i", i);
     bson_append_string (ret, key, ds->ds[i].name);
   }
@@ -269,18 +266,16 @@
 } /* }}} void wm_config_free */
 
 static int wm_config_node (oconfig_item_t *ci) /* {{{ */
 {
   wm_node_t *node;
   int status;
-  int i;
 
-  node = malloc (sizeof (*node));
+  node = calloc (1, sizeof (*node));
   if (node == NULL)
     return (ENOMEM);
-  memset (node, 0, sizeof (*node));
   mongo_init (node->conn);
   node->host = NULL;
   node->store_rates = 1;
   pthread_mutex_init (&node->lock, /* attr = */ NULL);
 
   status = cf_util_get_string_buffer (ci, node->name, sizeof (node->name));
@@ -288,13 +283,13 @@
   if (status != 0)
   {
     sfree (node);
     return (status);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       status = cf_util_get_string (child, &node->host);
     else if (strcasecmp ("Port", child->key) == 0)
@@ -338,18 +333,19 @@
     }
   }
 
   if (status == 0)
   {
     char cb_name[DATA_MAX_NAME_LEN];
-    user_data_t ud;
 
     ssnprintf (cb_name, sizeof (cb_name), "write_mongodb/%s", node->name);
 
-    ud.data = node;
-    ud.free_func = wm_config_free;
+    user_data_t ud = {
+      .data = node,
+      .free_func = wm_config_free
+    };
 
     status = plugin_register_write (cb_name, wm_write, &ud);
     INFO ("write_mongodb plugin: registered write plugin %s %d",cb_name,status);
   }
 
   if (status != 0)
@@ -357,15 +353,13 @@
 
   return (status);
 } /* }}} int wm_config_node */
 
 static int wm_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Node", child->key) == 0)
       wm_config_node (child);
     else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_redis.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_redis.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_redis.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_redis.c	2016-09-11 16:10:25.279038699 +0800
@@ -1,9 +1,9 @@
 /**
  * collectd - src/write_redis.c
- * Copyright (C) 2010       Florian Forster
+ * Copyright (C) 2010-2015  Florian Forster
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -22,27 +22,34 @@
  *
  * Authors:
  *   Florian Forster <ff at octo.it>
  **/
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 
-#include <pthread.h>
 #include <sys/time.h>
 #include <hiredis/hiredis.h>
 
+#ifndef REDIS_DEFAULT_PREFIX
+# define REDIS_DEFAULT_PREFIX "collectd/"
+#endif
+
 struct wr_node_s
 {
   char name[DATA_MAX_NAME_LEN];
 
   char *host;
   int port;
   struct timeval timeout;
+  char *prefix;
+  int database;
+  int max_set_size;
+  _Bool store_rates;
 
   redisContext *conn;
   pthread_mutex_t lock;
 };
 typedef struct wr_node_s wr_node_t;
 
@@ -53,40 +60,41 @@
     const value_list_t *vl,
     user_data_t *ud)
 {
   wr_node_t *node = ud->data;
   char ident[512];
   char key[512];
-  char value[512];
+  char value[512] = { 0 };
   char time[24];
   size_t value_size;
   char *value_ptr;
   int status;
   redisReply   *rr;
 
   status = FORMAT_VL (ident, sizeof (ident), vl);
   if (status != 0)
     return (status);
-  ssnprintf (key, sizeof (key), "collectd/%s", ident);
+  ssnprintf (key, sizeof (key), "%s%s",
+      (node->prefix != NULL) ? node->prefix : REDIS_DEFAULT_PREFIX,
+      ident);
   ssnprintf (time, sizeof (time), "%.9f", CDTIME_T_TO_DOUBLE(vl->time));
 
-  memset (value, 0, sizeof (value));
   value_size = sizeof (value);
   value_ptr = &value[0];
-  status = format_values (value_ptr, value_size, ds, vl, /* store rates = */ 0);
+  status = format_values (value_ptr, value_size, ds, vl, node->store_rates);
   if (status != 0)
     return (status);
 
   pthread_mutex_lock (&node->lock);
 
   if (node->conn == NULL)
   {
     node->conn = redisConnectWithTimeout ((char *)node->host, node->port, node->timeout);
     if (node->conn == NULL)
     {
-      ERROR ("write_redis plugin: Connecting to host \"%s\" (port %i) failed: Unknown reason",
+      ERROR ("write_redis plugin: Connecting to host \"%s\" (port %i) failed: Unkown reason",
           (node->host != NULL) ? node->host : "localhost",
           (node->port != 0) ? node->port : 6379);
       pthread_mutex_unlock (&node->lock);
       return (-1);
     }
     else if (node->conn->err)
@@ -95,24 +103,41 @@
           (node->host != NULL) ? node->host : "localhost",
           (node->port != 0) ? node->port : 6379,
           node->conn->errstr);
       pthread_mutex_unlock (&node->lock);
       return (-1);
     }
+
+    rr = redisCommand(node->conn, "SELECT %d", node->database);
+    if (rr == NULL)
+      WARNING("SELECT command error. database:%d message:%s", node->database, node->conn->errstr);
+    else
+      freeReplyObject (rr);
   }
 
   rr = redisCommand (node->conn, "ZADD %s %s %s", key, time, value);
   if (rr == NULL)
     WARNING("ZADD command error. key:%s message:%s", key, node->conn->errstr);
   else
     freeReplyObject (rr);
 
+  if (node->max_set_size >= 0)
+  {
+    rr = redisCommand (node->conn, "ZREMRANGEBYRANK %s %d %d", key, 0, (-1 * node->max_set_size) - 1);
+    if (rr == NULL)
+      WARNING("ZREMRANGEBYRANK command error. key:%s message:%s", key, node->conn->errstr);
+    else
+      freeReplyObject (rr);
+  }
+
   /* TODO(octo): This is more overhead than necessary. Use the cache and
    * metadata to determine if it is a new metric and call SADD only once for
    * each metric. */
-  rr = redisCommand (node->conn, "SADD collectd/values %s", ident);
+  rr = redisCommand (node->conn, "SADD %svalues %s",
+      (node->prefix != NULL) ? node->prefix : REDIS_DEFAULT_PREFIX,
+      ident);
   if (rr==NULL)
     WARNING("SADD command error. ident:%s message:%s", ident, node->conn->errstr);
   else
     freeReplyObject (rr);
 
   pthread_mutex_unlock (&node->lock);
@@ -139,33 +164,35 @@
 
 static int wr_config_node (oconfig_item_t *ci) /* {{{ */
 {
   wr_node_t *node;
   int timeout;
   int status;
-  int i;
 
-  node = malloc (sizeof (*node));
+  node = calloc (1, sizeof (*node));
   if (node == NULL)
     return (ENOMEM);
-  memset (node, 0, sizeof (*node));
   node->host = NULL;
   node->port = 0;
   node->timeout.tv_sec = 0;
   node->timeout.tv_usec = 1000;
   node->conn = NULL;
+  node->prefix = NULL;
+  node->database = 0;
+  node->max_set_size = -1;
+  node->store_rates = 1;
   pthread_mutex_init (&node->lock, /* attr = */ NULL);
 
   status = cf_util_get_string_buffer (ci, node->name, sizeof (node->name));
   if (status != 0)
   {
     sfree (node);
     return (status);
   }
 
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Host", child->key) == 0)
       status = cf_util_get_string (child, &node->host);
     else if (strcasecmp ("Port", child->key) == 0)
@@ -178,44 +205,55 @@
       }
     }
     else if (strcasecmp ("Timeout", child->key) == 0) {
       status = cf_util_get_int (child, &timeout);
       if (status == 0) node->timeout.tv_usec = timeout;
     }
+    else if (strcasecmp ("Prefix", child->key) == 0) {
+      status = cf_util_get_string (child, &node->prefix);
+    }
+    else if (strcasecmp ("Database", child->key) == 0) {
+      status = cf_util_get_int (child, &node->database);
+    }
+    else if (strcasecmp ("MaxSetSize", child->key) == 0) {
+      status = cf_util_get_int (child, &node->max_set_size);
+    }
+    else if (strcasecmp ("StoreRates", child->key) == 0) {
+      status = cf_util_get_boolean (child, &node->store_rates);
+    }
     else
       WARNING ("write_redis plugin: Ignoring unknown config option \"%s\".",
           child->key);
 
     if (status != 0)
       break;
   } /* for (i = 0; i < ci->children_num; i++) */
 
   if (status == 0)
   {
     char cb_name[DATA_MAX_NAME_LEN];
-    user_data_t ud;
 
     ssnprintf (cb_name, sizeof (cb_name), "write_redis/%s", node->name);
 
-    ud.data = node;
-    ud.free_func = wr_config_free;
+    user_data_t ud = {
+      .data = node,
+      .free_func = wr_config_free
+    };
 
     status = plugin_register_write (cb_name, wr_write, &ud);
   }
 
   if (status != 0)
     wr_config_free (node);
 
   return (status);
 } /* }}} int wr_config_node */
 
 static int wr_config (oconfig_item_t *ci) /* {{{ */
 {
-  int i;
-
-  for (i = 0; i < ci->children_num; i++)
+  for (int i = 0; i < ci->children_num; i++)
   {
     oconfig_item_t *child = ci->children + i;
 
     if (strcasecmp ("Node", child->key) == 0)
       wr_config_node (child);
     else
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann.c	2016-09-11 16:10:25.279038699 +0800
@@ -1,10 +1,11 @@
 /**
  * collectd - src/write_riemann.c
  * Copyright (C) 2012,2013  Pierre-Yves Ritschard
  * Copyright (C) 2013       Florian octo Forster
+ * Copyright (C) 2015,2016  Gergely Nagy
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
  * to deal in the Software without restriction, including without limitation
  * the rights to use, copy, modify, merge, publish, distribute, sublicense,
  * and/or sell copies of the Software, and to permit persons to whom the
@@ -21,1062 +22,881 @@
  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
  * DEALINGS IN THE SOFTWARE.
  *
  * Authors:
  *   Pierre-Yves Ritschard <pyr at spootnik.org>
  *   Florian octo Forster <octo at collectd.org>
+ *   Gergely Nagy <algernon at madhouse-project.org>
  */
 
 #include "collectd.h"
 
-#include "plugin.h"
 #include "common.h"
-#include "configfile.h"
+#include "plugin.h"
 #include "utils_cache.h"
-#include "riemann.pb-c.h"
+#include "utils_complain.h"
 #include "write_riemann_threshold.h"
 
-#include <sys/socket.h>
-#include <arpa/inet.h>
-#include <netdb.h>
-
-#define RIEMANN_HOST		"localhost"
-#define RIEMANN_PORT		"5555"
-#define RIEMANN_TTL_FACTOR	2.0
-#define RIEMANN_BATCH_MAX	8192
+#include <errno.h>
+#include <riemann/riemann-client.h>
+
+#define RIEMANN_HOST "localhost"
+#define RIEMANN_PORT 5555
+#define RIEMANN_TTL_FACTOR 2.0
+#define RIEMANN_BATCH_MAX 8192
 
 struct riemann_host {
-	char			*name;
-	char			*event_service_prefix;
-#define F_CONNECT	 0x01
-	uint8_t			 flags;
-	pthread_mutex_t	 lock;
-    _Bool            batch_mode;
-	_Bool            notifications;
-	_Bool            check_thresholds;
-	_Bool			 store_rates;
-	_Bool			 always_append_ds;
-	char			*node;
-	char			*service;
-	_Bool			 use_tcp;
-	int			     s;
-	double			 ttl_factor;
-    Msg             *batch_msg;
-    cdtime_t         batch_init;
-    int              batch_max;
-	int			     reference_count;
+  c_complain_t init_complaint;
+  char *name;
+  char *event_service_prefix;
+  pthread_mutex_t lock;
+  _Bool batch_mode;
+  _Bool notifications;
+  _Bool check_thresholds;
+  _Bool store_rates;
+  _Bool always_append_ds;
+  char *node;
+  int port;
+  riemann_client_type_t client_type;
+  riemann_client_t *client;
+  double ttl_factor;
+  cdtime_t batch_init;
+  int batch_max;
+  int batch_timeout;
+  int reference_count;
+  riemann_message_t *batch_msg;
+  char *tls_ca_file;
+  char *tls_cert_file;
+  char *tls_key_file;
+  struct timeval timeout;
 };
 
-static char	**riemann_tags;
-static size_t	  riemann_tags_num;
-static char	**riemann_attrs;
-static size_t     riemann_attrs_num;
-
-static void riemann_event_protobuf_free (Event *event) /* {{{ */
-{
-	size_t i;
-
-	if (event == NULL)
-		return;
-
-	sfree (event->state);
-	sfree (event->service);
-	sfree (event->host);
-	sfree (event->description);
-
-	strarray_free (event->tags, event->n_tags);
-	event->tags = NULL;
-	event->n_tags = 0;
-
-	for (i = 0; i < event->n_attributes; i++)
-	{
-		sfree (event->attributes[i]->key);
-		sfree (event->attributes[i]->value);
-		sfree (event->attributes[i]);
-	}
-	sfree (event->attributes);
-	event->n_attributes = 0;
-
-	sfree (event);
-} /* }}} void riemann_event_protobuf_free */
-
-static void riemann_msg_protobuf_free(Msg *msg) /* {{{ */
-{
-	size_t i;
-
-	if (msg == NULL)
-		return;
-
-	for (i = 0; i < msg->n_events; i++)
-	{
-		riemann_event_protobuf_free (msg->events[i]);
-		msg->events[i] = NULL;
-	}
-
-	sfree (msg->events);
-	msg->n_events = 0;
-
-	sfree (msg);
-} /* }}} void riemann_msg_protobuf_free */
+static char **riemann_tags;
+static size_t riemann_tags_num;
+static char **riemann_attrs;
+static size_t riemann_attrs_num;
 
 /* host->lock must be held when calling this function. */
-static int riemann_connect(struct riemann_host *host) /* {{{ */
+static int wrr_connect(struct riemann_host *host) /* {{{ */
 {
-	int			 e;
-	struct addrinfo		*ai, *res, hints;
-	char const		*node;
-	char const		*service;
-
-	if (host->flags & F_CONNECT)
-		return 0;
-
-	memset(&hints, 0, sizeof(hints));
-	memset(&service, 0, sizeof(service));
-	hints.ai_family = AF_UNSPEC;
-	hints.ai_socktype = host->use_tcp ? SOCK_STREAM : SOCK_DGRAM;
-#ifdef AI_ADDRCONFIG
-	hints.ai_flags |= AI_ADDRCONFIG;
-#endif
+  char const *node;
+  int port;
 
-	node = (host->node != NULL) ? host->node : RIEMANN_HOST;
-	service = (host->service != NULL) ? host->service : RIEMANN_PORT;
+  if (host->client)
+    return 0;
 
-	if ((e = getaddrinfo(node, service, &hints, &res)) != 0) {
-		ERROR ("write_riemann plugin: Unable to resolve host \"%s\": %s",
-			node, gai_strerror(e));
-		return -1;
-	}
-
-	host->s = -1;
-	for (ai = res; ai != NULL; ai = ai->ai_next) {
-		if ((host->s = socket(ai->ai_family,
-				      ai->ai_socktype,
-				      ai->ai_protocol)) == -1) {
-			continue;
-		}
-
-		if (connect(host->s, ai->ai_addr, ai->ai_addrlen) != 0) {
-			close(host->s);
-			host->s = -1;
-			continue;
-		}
-
-		host->flags |= F_CONNECT;
-		DEBUG("write_riemann plugin: got a successful connection for: %s:%s",
-				node, service);
-		break;
-	}
-
-	freeaddrinfo(res);
-
-	if (host->s < 0) {
-		WARNING("write_riemann plugin: Unable to connect to Riemann at %s:%s",
-				node, service);
-		return -1;
-	}
-	return 0;
-} /* }}} int riemann_connect */
-
-/* host->lock must be held when calling this function. */
-static int riemann_disconnect (struct riemann_host *host) /* {{{ */
-{
-	if ((host->flags & F_CONNECT) == 0)
-		return (0);
+  node = (host->node != NULL) ? host->node : RIEMANN_HOST;
+  port = (host->port) ? host->port : RIEMANN_PORT;
+
+  host->client = NULL;
+
+  host->client = riemann_client_create(
+      host->client_type, node, port, RIEMANN_CLIENT_OPTION_TLS_CA_FILE,
+      host->tls_ca_file, RIEMANN_CLIENT_OPTION_TLS_CERT_FILE,
+      host->tls_cert_file, RIEMANN_CLIENT_OPTION_TLS_KEY_FILE,
+      host->tls_key_file, RIEMANN_CLIENT_OPTION_NONE);
+  if (host->client == NULL) {
+    c_complain(LOG_ERR, &host->init_complaint,
+               "write_riemann plugin: Unable to connect to Riemann at %s:%d",
+               node, port);
+    return -1;
+  }
+#if RCC_VERSION_NUMBER >= 0x010800
+  if (host->timeout.tv_sec != 0) {
+    if (riemann_client_set_timeout(host->client, &host->timeout) != 0) {
+      riemann_client_free(host->client);
+      host->client = NULL;
+      c_complain(LOG_ERR, &host->init_complaint,
+                 "write_riemann plugin: Unable to connect to Riemann at %s:%d",
+                 node, port);
+      return -1;
+    }
+  }
+#endif
 
-	close (host->s);
-	host->s = -1;
-	host->flags &= ~F_CONNECT;
+  set_sock_opts(riemann_client_get_fd(host->client));
 
-	return (0);
-} /* }}} int riemann_disconnect */
+  c_release(LOG_INFO, &host->init_complaint,
+            "write_riemann plugin: Successfully connected to %s:%d", node,
+            port);
 
-static int riemann_send_msg (struct riemann_host *host, const Msg *msg) /* {{{ */
-{
-	int status = 0;
-	u_char *buffer = NULL;
-	size_t  buffer_len;
-
-	status = riemann_connect (host);
-	if (status != 0)
-		return status;
-
-	buffer_len = msg__get_packed_size(msg);
-
-	if (host->use_tcp)
-		buffer_len += 4;
-
-	buffer = malloc (buffer_len);
-	if (buffer == NULL) {
-		ERROR ("write_riemann plugin: malloc failed.");
-		return ENOMEM;
-	}
-	memset (buffer, 0, buffer_len);
-
-	if (host->use_tcp)
-	{
-		uint32_t length = htonl ((uint32_t) (buffer_len - 4));
-		memcpy (buffer, &length, 4);
-		msg__pack(msg, buffer + 4);
-	}
-	else
-	{
-		msg__pack(msg, buffer);
-	}
-
-	status = (int) swrite (host->s, buffer, buffer_len);
-	if (status != 0)
-	{
-		char errbuf[1024];
-		ERROR ("write_riemann plugin: Sending to Riemann at %s:%s failed: %s",
-				(host->node != NULL) ? host->node : RIEMANN_HOST,
-				(host->service != NULL) ? host->service : RIEMANN_PORT,
-				sstrerror (errno, errbuf, sizeof (errbuf)));
-		sfree (buffer);
-		return -1;
-	}
-
-	sfree (buffer);
-	return 0;
-} /* }}} int riemann_send_msg */
+  return 0;
+} /* }}} int wrr_connect */
 
-static int riemann_recv_ack(struct riemann_host *host) /* {{{ */
+/* host->lock must be held when calling this function. */
+static int wrr_disconnect(struct riemann_host *host) /* {{{ */
 {
-	int status = 0;
-	Msg *msg = NULL;
-	uint32_t header;
-
-	status = (int) sread (host->s, &header, 4);
-
-	if (status != 0)
-		return -1;
+  if (!host->client)
+    return (0);
 
-	size_t size = ntohl(header);
+  riemann_client_free(host->client);
+  host->client = NULL;
 
-	// Buffer on the stack since acknowledges are typically small.
-	u_char buffer[size];
-	memset (buffer, 0, size);
-
-	status = (int) sread (host->s, buffer, size);
-
-	if (status != 0)
-		return status;
-
-	msg = msg__unpack (NULL, size, buffer);
-
-	if (msg == NULL)
-		return -1;
-
-	if (!msg->ok)
-	{
-		ERROR ("write_riemann plugin: Sending to Riemann at %s:%s acknowledgement message reported error: %s",
-				(host->node != NULL) ? host->node : RIEMANN_HOST,
-				(host->service != NULL) ? host->service : RIEMANN_PORT,
-				msg->error);
-
-		msg__free_unpacked(msg, NULL);
-		return -1;
-	}
-
-	msg__free_unpacked (msg, NULL);
-	return 0;
-} /* }}} int riemann_recv_ack */
+  return (0);
+} /* }}} int wrr_disconnect */
 
 /**
- * Function to send messages (Msg) to riemann.
+ * Function to send messages to riemann.
  *
  * Acquires the host lock, disconnects on errors.
  */
-static int riemann_send(struct riemann_host *host, Msg const *msg) /* {{{ */
+static int wrr_send_nolock(struct riemann_host *host,
+                           riemann_message_t *msg) /* {{{ */
 {
-	int status = 0;
-	pthread_mutex_lock (&host->lock);
+  int status = 0;
 
-	status = riemann_send_msg(host, msg);
-	if (status != 0) {
-		riemann_disconnect (host);
-		pthread_mutex_unlock (&host->lock);
-		return status;
-	}
-
-	/*
-	 * For TCP we need to receive message acknowledgemenent.
-	 */
-	if (host->use_tcp)
-	{
-		status = riemann_recv_ack(host);
-
-		if (status != 0)
-		{
-			riemann_disconnect (host);
-			pthread_mutex_unlock (&host->lock);
-			return status;
-		}
-	}
-
-	pthread_mutex_unlock (&host->lock);
-	return 0;
-} /* }}} int riemann_send */
+  status = wrr_connect(host);
+  if (status != 0) {
+    return status;
+  }
 
-static int riemann_event_add_tag (Event *event, char const *tag) /* {{{ */
-{
-	return (strarray_add (&event->tags, &event->n_tags, tag));
-} /* }}} int riemann_event_add_tag */
+  status = riemann_client_send_message(host->client, msg);
+  if (status != 0) {
+    wrr_disconnect(host);
+    return status;
+  }
 
-static int riemann_event_add_attribute(Event *event, /* {{{ */
-		char const *key, char const *value)
-{
-	Attribute **new_attributes;
-	Attribute *a;
+  /*
+   * For TCP we need to receive message acknowledgemenent.
+   */
+  if (host->client_type != RIEMANN_CLIENT_UDP) {
+    riemann_message_t *response;
+
+    response = riemann_client_recv_message(host->client);
+
+    if (response == NULL) {
+      wrr_disconnect(host);
+      return errno;
+    }
+    riemann_message_free(response);
+  }
 
-	new_attributes = realloc (event->attributes,
-			sizeof (*event->attributes) * (event->n_attributes + 1));
-	if (new_attributes == NULL)
-	{
-		ERROR ("write_riemann plugin: realloc failed.");
-		return (ENOMEM);
-	}
-	event->attributes = new_attributes;
-
-	a = malloc (sizeof (*a));
-	if (a == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		return (ENOMEM);
-	}
-	attribute__init (a);
-
-	a->key = strdup (key);
-	if (value != NULL)
-		a->value = strdup (value);
+  return 0;
+} /* }}} int wrr_send */
 
-	event->attributes[event->n_attributes] = a;
-	event->n_attributes++;
+static int wrr_send(struct riemann_host *host, riemann_message_t *msg) {
+  int status = 0;
 
-	return (0);
-} /* }}} int riemann_event_add_attribute */
+  pthread_mutex_lock(&host->lock);
+  status = wrr_send_nolock(host, msg);
+  pthread_mutex_unlock(&host->lock);
+  return status;
+}
 
-static Msg *riemann_notification_to_protobuf(struct riemann_host *host, /* {{{ */
-		notification_t const *n)
-{
-	Msg *msg;
-	Event *event;
-	char service_buffer[6 * DATA_MAX_NAME_LEN];
-	char const *severity;
-	notification_meta_t *meta;
-	int i;
-
-	msg = malloc (sizeof (*msg));
-	if (msg == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		return (NULL);
-	}
-	memset (msg, 0, sizeof (*msg));
-	msg__init (msg);
-
-	msg->events = malloc (sizeof (*msg->events));
-	if (msg->events == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		sfree (msg);
-		return (NULL);
-	}
-
-	event = malloc (sizeof (*event));
-	if (event == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		sfree (msg->events);
-		sfree (msg);
-		return (NULL);
-	}
-	memset (event, 0, sizeof (*event));
-	event__init (event);
-
-	msg->events[0] = event;
-	msg->n_events = 1;
-
-	event->host = strdup (n->host);
-	event->time = CDTIME_T_TO_TIME_T (n->time);
-	event->has_time = 1;
-
-	switch (n->severity)
-	{
-		case NOTIF_OKAY:	severity = "ok"; break;
-		case NOTIF_WARNING:	severity = "warning"; break;
-		case NOTIF_FAILURE:	severity = "critical"; break;
-		default:		severity = "unknown";
-	}
-	event->state = strdup (severity);
-
-	riemann_event_add_tag (event, "notification");
-	if (n->host[0] != 0)
-		riemann_event_add_attribute (event, "host", n->host);
-	if (n->plugin[0] != 0)
-		riemann_event_add_attribute (event, "plugin", n->plugin);
-	if (n->plugin_instance[0] != 0)
-		riemann_event_add_attribute (event, "plugin_instance",
-				n->plugin_instance);
-
-	if (n->type[0] != 0)
-		riemann_event_add_attribute (event, "type", n->type);
-	if (n->type_instance[0] != 0)
-		riemann_event_add_attribute (event, "type_instance",
-				n->type_instance);
-
-	for (i = 0; i < riemann_attrs_num; i += 2)
-		riemann_event_add_attribute(event,
-					    riemann_attrs[i],
-					    riemann_attrs[i +1]);
-
-	for (i = 0; i < riemann_tags_num; i++)
-		riemann_event_add_tag (event, riemann_tags[i]);
-
-	format_name (service_buffer, sizeof (service_buffer),
-			/* host = */ "", n->plugin, n->plugin_instance,
-			n->type, n->type_instance);
-	event->service = strdup (&service_buffer[1]);
-
-	if (n->message[0] != 0)
-		riemann_event_add_attribute (event, "description", n->message);
-
-	/* Pull in values from threshold and add extra attributes */
-	for (meta = n->meta; meta != NULL; meta = meta->next)
-	{
-		if (strcasecmp ("CurrentValue", meta->name) == 0 && meta->type == NM_TYPE_DOUBLE)
-		{
-			event->metric_d = meta->nm_value.nm_double;
-			event->has_metric_d = 1;
-			continue;
-		}
-
-		if (meta->type == NM_TYPE_STRING) {
-			riemann_event_add_attribute (event, meta->name, meta->nm_value.nm_string);
-			continue;
-		}
-	}
-
-	DEBUG ("write_riemann plugin: Successfully created protobuf for notification: "
-			"host = \"%s\", service = \"%s\", state = \"%s\"",
-			event->host, event->service, event->state);
-	return (msg);
-} /* }}} Msg *riemann_notification_to_protobuf */
-
-static Event *riemann_value_to_protobuf(struct riemann_host const *host, /* {{{ */
-		data_set_t const *ds,
-		value_list_t const *vl, size_t index,
-					 gauge_t const *rates,
-					 int status)
-{
-	Event *event;
-	char name_buffer[5 * DATA_MAX_NAME_LEN];
-	char service_buffer[6 * DATA_MAX_NAME_LEN];
-	double ttl;
-	int i;
-
-	event = malloc (sizeof (*event));
-	if (event == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		return (NULL);
-	}
-	memset (event, 0, sizeof (*event));
-	event__init (event);
-
-	event->host = strdup (vl->host);
-	event->time = CDTIME_T_TO_TIME_T (vl->time);
-	event->has_time = 1;
-
-	if (host->check_thresholds) {
-		switch (status) {
-			case STATE_OKAY:
-				event->state = strdup("ok");
-				break;
-			case STATE_ERROR:
-				event->state = strdup("critical");
-				break;
-			case STATE_WARNING:
-				event->state = strdup("warning");
-				break;
-			case STATE_MISSING:
-				event->state = strdup("unknown");
-				break;
-		}
-	}
-
-	ttl = CDTIME_T_TO_DOUBLE (vl->interval) * host->ttl_factor;
-	event->ttl = (float) ttl;
-	event->has_ttl = 1;
-
-	riemann_event_add_attribute (event, "plugin", vl->plugin);
-	if (vl->plugin_instance[0] != 0)
-		riemann_event_add_attribute (event, "plugin_instance",
-				vl->plugin_instance);
-
-	riemann_event_add_attribute (event, "type", vl->type);
-	if (vl->type_instance[0] != 0)
-		riemann_event_add_attribute (event, "type_instance",
-				vl->type_instance);
-
-	if ((ds->ds[index].type != DS_TYPE_GAUGE) && (rates != NULL))
-	{
-		char ds_type[DATA_MAX_NAME_LEN];
-
-		ssnprintf (ds_type, sizeof (ds_type), "%s:rate",
-				DS_TYPE_TO_STRING(ds->ds[index].type));
-		riemann_event_add_attribute (event, "ds_type", ds_type);
-	}
-	else
-	{
-		riemann_event_add_attribute (event, "ds_type",
-				DS_TYPE_TO_STRING(ds->ds[index].type));
-	}
-	riemann_event_add_attribute (event, "ds_name", ds->ds[index].name);
-	{
-		char ds_index[DATA_MAX_NAME_LEN];
-
-		ssnprintf (ds_index, sizeof (ds_index), "%zu", index);
-		riemann_event_add_attribute (event, "ds_index", ds_index);
-	}
-
-	for (i = 0; i < riemann_attrs_num; i += 2)
-		riemann_event_add_attribute(event,
-					    riemann_attrs[i],
-					    riemann_attrs[i +1]);
-
-	for (i = 0; i < riemann_tags_num; i++)
-		riemann_event_add_tag (event, riemann_tags[i]);
-
-	if (ds->ds[index].type == DS_TYPE_GAUGE)
-	{
-		event->has_metric_d = 1;
-		event->metric_d = (double) vl->values[index].gauge;
-	}
-	else if (rates != NULL)
-	{
-		event->has_metric_d = 1;
-		event->metric_d = (double) rates[index];
-	}
-	else
-	{
-		event->has_metric_sint64 = 1;
-		if (ds->ds[index].type == DS_TYPE_DERIVE)
-			event->metric_sint64 = (int64_t) vl->values[index].derive;
-		else if (ds->ds[index].type == DS_TYPE_ABSOLUTE)
-			event->metric_sint64 = (int64_t) vl->values[index].absolute;
-		else
-			event->metric_sint64 = (int64_t) vl->values[index].counter;
-	}
-
-	format_name (name_buffer, sizeof (name_buffer),
-			/* host = */ "", vl->plugin, vl->plugin_instance,
-			vl->type, vl->type_instance);
-	if (host->always_append_ds || (ds->ds_num > 1))
-	{
-		if (host->event_service_prefix == NULL)
-			ssnprintf (service_buffer, sizeof (service_buffer), "%s/%s",
-					&name_buffer[1], ds->ds[index].name);
-		else
-			ssnprintf (service_buffer, sizeof (service_buffer), "%s%s/%s",
-					host->event_service_prefix, &name_buffer[1], ds->ds[index].name);
-	}
-	else
-	{
-		if (host->event_service_prefix == NULL)
-			sstrncpy (service_buffer, &name_buffer[1], sizeof (service_buffer));
-		else
-			ssnprintf (service_buffer, sizeof (service_buffer), "%s%s",
-					host->event_service_prefix, &name_buffer[1]);
-	}
-
-	event->service = strdup (service_buffer);
-
-	DEBUG ("write_riemann plugin: Successfully created protobuf for metric: "
-			"host = \"%s\", service = \"%s\"",
-			event->host, event->service);
-	return (event);
-} /* }}} Event *riemann_value_to_protobuf */
-
-static Msg *riemann_value_list_to_protobuf (struct riemann_host const *host, /* {{{ */
-					    data_set_t const *ds,
-					    value_list_t const *vl,
-					    int *statuses)
-{
-	Msg *msg;
-	size_t i;
-	gauge_t *rates = NULL;
-
-	/* Initialize the Msg structure. */
-	msg = malloc (sizeof (*msg));
-	if (msg == NULL)
-	{
-		ERROR ("write_riemann plugin: malloc failed.");
-		return (NULL);
-	}
-	memset (msg, 0, sizeof (*msg));
-	msg__init (msg);
-
-	/* Set up events. First, the list of pointers. */
-	msg->n_events = (size_t) vl->values_len;
-	msg->events = calloc (msg->n_events, sizeof (*msg->events));
-	if (msg->events == NULL)
-	{
-		ERROR ("write_riemann plugin: calloc failed.");
-		riemann_msg_protobuf_free (msg);
-		return (NULL);
-	}
-
-	if (host->store_rates)
-	{
-		rates = uc_get_rate (ds, vl);
-		if (rates == NULL)
-		{
-			ERROR ("write_riemann plugin: uc_get_rate failed.");
-			riemann_msg_protobuf_free (msg);
-			return (NULL);
-		}
-	}
-
-	for (i = 0; i < msg->n_events; i++)
-	{
-		msg->events[i] = riemann_value_to_protobuf (host, ds, vl,
-							    (int) i, rates, statuses[i]);
-		if (msg->events[i] == NULL)
-		{
-			riemann_msg_protobuf_free (msg);
-			sfree (rates);
-			return (NULL);
-		}
-	}
-
-	sfree (rates);
-	return (msg);
-} /* }}} Msg *riemann_value_list_to_protobuf */
+static riemann_message_t *
+wrr_notification_to_message(struct riemann_host *host, /* {{{ */
+                            notification_t const *n) {
+  riemann_message_t *msg;
+  riemann_event_t *event;
+  char service_buffer[6 * DATA_MAX_NAME_LEN];
+  char const *severity;
+
+  switch (n->severity) {
+  case NOTIF_OKAY:
+    severity = "ok";
+    break;
+  case NOTIF_WARNING:
+    severity = "warning";
+    break;
+  case NOTIF_FAILURE:
+    severity = "critical";
+    break;
+  default:
+    severity = "unknown";
+  }
+
+  format_name(service_buffer, sizeof(service_buffer),
+              /* host = */ "", n->plugin, n->plugin_instance, n->type,
+              n->type_instance);
+
+  event = riemann_event_create(
+      RIEMANN_EVENT_FIELD_HOST, n->host, RIEMANN_EVENT_FIELD_TIME,
+      (int64_t)CDTIME_T_TO_TIME_T(n->time), RIEMANN_EVENT_FIELD_TAGS,
+      "notification", NULL, RIEMANN_EVENT_FIELD_STATE, severity,
+      RIEMANN_EVENT_FIELD_SERVICE, &service_buffer[1],
+      RIEMANN_EVENT_FIELD_NONE);
+
+  if (n->host[0] != 0)
+    riemann_event_string_attribute_add(event, "host", n->host);
+  if (n->plugin[0] != 0)
+    riemann_event_string_attribute_add(event, "plugin", n->plugin);
+  if (n->plugin_instance[0] != 0)
+    riemann_event_string_attribute_add(event, "plugin_instance",
+                                       n->plugin_instance);
+
+  if (n->type[0] != 0)
+    riemann_event_string_attribute_add(event, "type", n->type);
+  if (n->type_instance[0] != 0)
+    riemann_event_string_attribute_add(event, "type_instance",
+                                       n->type_instance);
+
+  for (size_t i = 0; i < riemann_attrs_num; i += 2)
+    riemann_event_string_attribute_add(event, riemann_attrs[i],
+                                       riemann_attrs[i + 1]);
+
+  for (size_t i = 0; i < riemann_tags_num; i++)
+    riemann_event_tag_add(event, riemann_tags[i]);
+
+  if (n->message[0] != 0)
+    riemann_event_string_attribute_add(event, "description", n->message);
+
+  /* Pull in values from threshold and add extra attributes */
+  for (notification_meta_t *meta = n->meta; meta != NULL; meta = meta->next) {
+    if (strcasecmp("CurrentValue", meta->name) == 0 &&
+        meta->type == NM_TYPE_DOUBLE) {
+      riemann_event_set(event, RIEMANN_EVENT_FIELD_METRIC_D,
+                        (double)meta->nm_value.nm_double,
+                        RIEMANN_EVENT_FIELD_NONE);
+      continue;
+    }
 
+    if (meta->type == NM_TYPE_STRING) {
+      riemann_event_string_attribute_add(event, meta->name,
+                                         meta->nm_value.nm_string);
+      continue;
+    }
+  }
+
+  msg = riemann_message_create_with_events(event, NULL);
+  if (msg == NULL) {
+    ERROR("write_riemann plugin: riemann_message_create_with_events() failed.");
+    riemann_event_free(event);
+    return (NULL);
+  }
+
+  DEBUG("write_riemann plugin: Successfully created message for notification: "
+        "host = \"%s\", service = \"%s\", state = \"%s\"",
+        event->host, event->service, event->state);
+  return (msg);
+} /* }}} riemann_message_t *wrr_notification_to_message */
+
+static riemann_event_t *
+wrr_value_to_event(struct riemann_host const *host, /* {{{ */
+                   data_set_t const *ds, value_list_t const *vl, size_t index,
+                   gauge_t const *rates, int status) {
+  riemann_event_t *event;
+  char name_buffer[5 * DATA_MAX_NAME_LEN];
+  char service_buffer[6 * DATA_MAX_NAME_LEN];
+  size_t i;
+
+  event = riemann_event_new();
+  if (event == NULL) {
+    ERROR("write_riemann plugin: riemann_event_new() failed.");
+    return (NULL);
+  }
+
+  format_name(name_buffer, sizeof(name_buffer),
+              /* host = */ "", vl->plugin, vl->plugin_instance, vl->type,
+              vl->type_instance);
+  if (host->always_append_ds || (ds->ds_num > 1)) {
+    if (host->event_service_prefix == NULL)
+      ssnprintf(service_buffer, sizeof(service_buffer), "%s/%s",
+                &name_buffer[1], ds->ds[index].name);
+    else
+      ssnprintf(service_buffer, sizeof(service_buffer), "%s%s/%s",
+                host->event_service_prefix, &name_buffer[1],
+                ds->ds[index].name);
+  } else {
+    if (host->event_service_prefix == NULL)
+      sstrncpy(service_buffer, &name_buffer[1], sizeof(service_buffer));
+    else
+      ssnprintf(service_buffer, sizeof(service_buffer), "%s%s",
+                host->event_service_prefix, &name_buffer[1]);
+  }
+
+  riemann_event_set(
+      event, RIEMANN_EVENT_FIELD_HOST, vl->host, RIEMANN_EVENT_FIELD_TIME,
+      (int64_t)CDTIME_T_TO_TIME_T(vl->time), RIEMANN_EVENT_FIELD_TTL,
+      (float)CDTIME_T_TO_DOUBLE(vl->interval) * host->ttl_factor,
+      RIEMANN_EVENT_FIELD_STRING_ATTRIBUTES, "plugin", vl->plugin, "type",
+      vl->type, "ds_name", ds->ds[index].name, NULL,
+      RIEMANN_EVENT_FIELD_SERVICE, service_buffer, RIEMANN_EVENT_FIELD_NONE);
+
+  if (host->check_thresholds) {
+    const char *state = NULL;
+
+    switch (status) {
+    case STATE_OKAY:
+      state = "ok";
+      break;
+    case STATE_ERROR:
+      state = "critical";
+      break;
+    case STATE_WARNING:
+      state = "warning";
+      break;
+    case STATE_MISSING:
+      state = "unknown";
+      break;
+    }
+    if (state)
+      riemann_event_set(event, RIEMANN_EVENT_FIELD_STATE, state,
+                        RIEMANN_EVENT_FIELD_NONE);
+  }
+
+  if (vl->plugin_instance[0] != 0)
+    riemann_event_string_attribute_add(event, "plugin_instance",
+                                       vl->plugin_instance);
+  if (vl->type_instance[0] != 0)
+    riemann_event_string_attribute_add(event, "type_instance",
+                                       vl->type_instance);
+
+  if ((ds->ds[index].type != DS_TYPE_GAUGE) && (rates != NULL)) {
+    char ds_type[DATA_MAX_NAME_LEN];
+
+    ssnprintf(ds_type, sizeof(ds_type), "%s:rate",
+              DS_TYPE_TO_STRING(ds->ds[index].type));
+    riemann_event_string_attribute_add(event, "ds_type", ds_type);
+  } else {
+    riemann_event_string_attribute_add(event, "ds_type",
+                                       DS_TYPE_TO_STRING(ds->ds[index].type));
+  }
+
+  {
+    char ds_index[DATA_MAX_NAME_LEN];
+
+    ssnprintf(ds_index, sizeof(ds_index), "%zu", index);
+    riemann_event_string_attribute_add(event, "ds_index", ds_index);
+  }
+
+  for (i = 0; i < riemann_attrs_num; i += 2)
+    riemann_event_string_attribute_add(event, riemann_attrs[i],
+                                       riemann_attrs[i + 1]);
+
+  for (i = 0; i < riemann_tags_num; i++)
+    riemann_event_tag_add(event, riemann_tags[i]);
+
+  if (ds->ds[index].type == DS_TYPE_GAUGE) {
+    riemann_event_set(event, RIEMANN_EVENT_FIELD_METRIC_D,
+                      (double)vl->values[index].gauge,
+                      RIEMANN_EVENT_FIELD_NONE);
+  } else if (rates != NULL) {
+    riemann_event_set(event, RIEMANN_EVENT_FIELD_METRIC_D, (double)rates[index],
+                      RIEMANN_EVENT_FIELD_NONE);
+  } else {
+    int64_t metric;
+
+    if (ds->ds[index].type == DS_TYPE_DERIVE)
+      metric = (int64_t)vl->values[index].derive;
+    else if (ds->ds[index].type == DS_TYPE_ABSOLUTE)
+      metric = (int64_t)vl->values[index].absolute;
+    else
+      metric = (int64_t)vl->values[index].counter;
+
+    riemann_event_set(event, RIEMANN_EVENT_FIELD_METRIC_S64, (int64_t)metric,
+                      RIEMANN_EVENT_FIELD_NONE);
+  }
+
+  DEBUG("write_riemann plugin: Successfully created message for metric: "
+        "host = \"%s\", service = \"%s\"",
+        event->host, event->service);
+  return (event);
+} /* }}} riemann_event_t *wrr_value_to_event */
+
+static riemann_message_t *
+wrr_value_list_to_message(struct riemann_host const *host, /* {{{ */
+                          data_set_t const *ds, value_list_t const *vl,
+                          int *statuses) {
+  riemann_message_t *msg;
+  size_t i;
+  gauge_t *rates = NULL;
+
+  /* Initialize the Msg structure. */
+  msg = riemann_message_new();
+  if (msg == NULL) {
+    ERROR("write_riemann plugin: riemann_message_new failed.");
+    return (NULL);
+  }
+
+  if (host->store_rates) {
+    rates = uc_get_rate(ds, vl);
+    if (rates == NULL) {
+      ERROR("write_riemann plugin: uc_get_rate failed.");
+      riemann_message_free(msg);
+      return (NULL);
+    }
+  }
+
+  for (i = 0; i < vl->values_len; i++) {
+    riemann_event_t *event;
+
+    event = wrr_value_to_event(host, ds, vl, (int)i, rates, statuses[i]);
+    if (event == NULL) {
+      riemann_message_free(msg);
+      sfree(rates);
+      return (NULL);
+    }
+    riemann_message_append_events(msg, event, NULL);
+  }
+
+  sfree(rates);
+  return (msg);
+} /* }}} riemann_message_t *wrr_value_list_to_message */
 
 /*
  * Always call while holding host->lock !
  */
-static int riemann_batch_flush_nolock (cdtime_t timeout,
-                                       struct riemann_host *host)
-{
-    cdtime_t    now;
-    int         status = 0;
-
-    if (timeout > 0) {
-        now = cdtime ();
-        if ((host->batch_init + timeout) > now)
-            return status;
+static int wrr_batch_flush_nolock(cdtime_t timeout, struct riemann_host *host) {
+  cdtime_t now;
+  int status = 0;
+
+  now = cdtime();
+  if (timeout > 0) {
+    if ((host->batch_init + timeout) > now) {
+      return status;
     }
-    riemann_send_msg(host, host->batch_msg);
-    riemann_msg_protobuf_free(host->batch_msg);
+  }
+  wrr_send_nolock(host, host->batch_msg);
+  riemann_message_free(host->batch_msg);
+
+  host->batch_init = now;
+  host->batch_msg = NULL;
+  return status;
+}
 
-	if (host->use_tcp && ((status = riemann_recv_ack(host)) != 0))
-        riemann_disconnect (host);
+static int wrr_batch_flush(cdtime_t timeout,
+                           const char *identifier __attribute__((unused)),
+                           user_data_t *user_data) {
+  struct riemann_host *host;
+  int status;
+
+  if (user_data == NULL)
+    return (-EINVAL);
+
+  host = user_data->data;
+  pthread_mutex_lock(&host->lock);
+  status = wrr_batch_flush_nolock(timeout, host);
+  if (status != 0)
+    c_complain(
+        LOG_ERR, &host->init_complaint,
+        "write_riemann plugin: riemann_client_send failed with status %i",
+        status);
+  else
+    c_release(LOG_DEBUG, &host->init_complaint,
+              "write_riemann plugin: batch sent.");
 
-    host->batch_init = cdtime();
-    host->batch_msg = NULL;
-    return status;
+  pthread_mutex_unlock(&host->lock);
+  return status;
 }
 
-static int riemann_batch_flush (cdtime_t timeout,
-        const char *identifier __attribute__((unused)),
-        user_data_t *user_data)
-{
-    struct riemann_host *host;
+static int wrr_batch_add_value_list(struct riemann_host *host, /* {{{ */
+                                    data_set_t const *ds,
+                                    value_list_t const *vl, int *statuses) {
+  riemann_message_t *msg;
+  size_t len;
+  int ret;
+  cdtime_t timeout;
+
+  msg = wrr_value_list_to_message(host, ds, vl, statuses);
+  if (msg == NULL)
+    return -1;
+
+  pthread_mutex_lock(&host->lock);
+
+  if (host->batch_msg == NULL) {
+    host->batch_msg = msg;
+  } else {
     int status;
 
-    if (user_data == NULL)
-        return (-EINVAL);
-
-    host = user_data->data;
-    pthread_mutex_lock (&host->lock);
-    status = riemann_batch_flush_nolock (timeout, host);
-    if (status != 0)
-        ERROR ("write_riemann plugin: riemann_send failed with status %i",
-               status);
+    status = riemann_message_append_events_n(host->batch_msg, msg->n_events,
+                                             msg->events);
+    msg->n_events = 0;
+    msg->events = NULL;
+
+    riemann_message_free(msg);
+
+    if (status != 0) {
+      pthread_mutex_unlock(&host->lock);
+      ERROR("write_riemann plugin: out of memory");
+      return -1;
+    }
+  }
 
-    pthread_mutex_unlock(&host->lock);
-    return status;
-}
+  len = riemann_message_get_packed_size(host->batch_msg);
+  ret = 0;
+  if ((host->batch_max < 0) || (((size_t)host->batch_max) <= len)) {
+    ret = wrr_batch_flush_nolock(0, host);
+  } else {
+    if (host->batch_timeout > 0) {
+      timeout = TIME_T_TO_CDTIME_T((time_t)host->batch_timeout);
+      ret = wrr_batch_flush_nolock(timeout, host);
+    }
+  }
 
-static int riemann_batch_add_value_list (struct riemann_host *host, /* {{{ */
-                                         data_set_t const *ds,
-                                         value_list_t const *vl,
-                                         int *statuses)
-{
-	size_t i;
-    Event **events;
-    Msg *msg;
-    size_t len;
-    int ret;
+  pthread_mutex_unlock(&host->lock);
+  return ret;
+} /* }}} riemann_message_t *wrr_batch_add_value_list */
+
+static int wrr_notification(const notification_t *n, user_data_t *ud) /* {{{ */
+{
+  int status;
+  struct riemann_host *host = ud->data;
+  riemann_message_t *msg;
+
+  if (!host->notifications)
+    return 0;
+
+  /*
+   * Never batch for notifications, send them ASAP
+   */
+  msg = wrr_notification_to_message(host, n);
+  if (msg == NULL)
+    return (-1);
+
+  status = wrr_send(host, msg);
+  if (status != 0)
+    c_complain(
+        LOG_ERR, &host->init_complaint,
+        "write_riemann plugin: riemann_client_send failed with status %i",
+        status);
+  else
+    c_release(LOG_DEBUG, &host->init_complaint,
+              "write_riemann plugin: riemann_client_send succeeded");
+
+  riemann_message_free(msg);
+  return (status);
+} /* }}} int wrr_notification */
+
+static int wrr_write(const data_set_t *ds, /* {{{ */
+                     const value_list_t *vl, user_data_t *ud) {
+  int status = 0;
+  int statuses[vl->values_len];
+  struct riemann_host *host = ud->data;
+  riemann_message_t *msg;
 
-    msg = riemann_value_list_to_protobuf (host, ds, vl, statuses);
+  if (host->check_thresholds) {
+    status = write_riemann_threshold_check(ds, vl, statuses);
+    if (status != 0)
+      return status;
+  } else {
+    memset(statuses, 0, sizeof(statuses));
+  }
+
+  if (host->client_type != RIEMANN_CLIENT_UDP && host->batch_mode) {
+    wrr_batch_add_value_list(host, ds, vl, statuses);
+  } else {
+    msg = wrr_value_list_to_message(host, ds, vl, statuses);
     if (msg == NULL)
-        return -1;
+      return (-1);
 
-    pthread_mutex_lock(&host->lock);
+    status = wrr_send(host, msg);
 
-    if (host->batch_msg == NULL) {
-        host->batch_msg = msg;
-    } else {
-        len = msg->n_events + host->batch_msg->n_events;
-        events = realloc(host->batch_msg->events,
-                         (len * sizeof(*host->batch_msg->events)));
-        if (events == NULL) {
-            pthread_mutex_unlock(&host->lock);
-            ERROR ("write_riemann plugin: out of memory");
-            riemann_msg_protobuf_free (msg);
-            return -1;
-        }
-        host->batch_msg->events = events;
-
-        for (i = host->batch_msg->n_events; i < len; i++)
-            host->batch_msg->events[i] = msg->events[i - host->batch_msg->n_events];
-
-        host->batch_msg->n_events = len;
-        sfree (msg->events);
-        msg->n_events = 0;
-        sfree (msg);
-    }
+    riemann_message_free(msg);
+  }
+  return status;
+} /* }}} int wrr_write */
 
-	len = msg__get_packed_size(host->batch_msg);
-    ret = 0;
-    if (len >= host->batch_max) {
-        ret = riemann_batch_flush_nolock(0, host);
-    }
-
-    pthread_mutex_unlock(&host->lock);
-    return ret;
-} /* }}} Msg *riemann_batch_add_value_list */
-
-static int riemann_notification(const notification_t *n, user_data_t *ud) /* {{{ */
+static void wrr_free(void *p) /* {{{ */
 {
-	int			 status;
-	struct riemann_host	*host = ud->data;
-	Msg			*msg;
+  struct riemann_host *host = p;
 
-	if (!host->notifications)
-		return 0;
+  if (host == NULL)
+    return;
 
-    /*
-     * Never batch for notifications, send them ASAP
-     */
-	msg = riemann_notification_to_protobuf (host, n);
-	if (msg == NULL)
-		return (-1);
-
-	status = riemann_send (host, msg);
-	if (status != 0)
-		ERROR ("write_riemann plugin: riemann_send failed with status %i",
-				status);
-
-	riemann_msg_protobuf_free (msg);
-	return (status);
-} /* }}} int riemann_notification */
-
-static int riemann_write(const data_set_t *ds, /* {{{ */
-	      const value_list_t *vl,
-	      user_data_t *ud)
-{
-	int			 status = 0;
-	int			 statuses[vl->values_len];
-	struct riemann_host	*host = ud->data;
-	Msg			*msg;
+  pthread_mutex_lock(&host->lock);
 
-	if (host->check_thresholds)
-		write_riemann_threshold_check(ds, vl, statuses);
+  host->reference_count--;
+  if (host->reference_count > 0) {
+    pthread_mutex_unlock(&host->lock);
+    return;
+  }
 
-    if (host->use_tcp == 1 && host->batch_mode) {
+  wrr_disconnect(host);
 
-        riemann_batch_add_value_list (host, ds, vl, statuses);
+  pthread_mutex_destroy(&host->lock);
+  sfree(host);
+} /* }}} void wrr_free */
+
+static int wrr_config_node(oconfig_item_t *ci) /* {{{ */
+{
+  struct riemann_host *host = NULL;
+  int status = 0;
+  int i;
+  oconfig_item_t *child;
+  char callback_name[DATA_MAX_NAME_LEN];
+
+  if ((host = calloc(1, sizeof(*host))) == NULL) {
+    ERROR("write_riemann plugin: calloc failed.");
+    return ENOMEM;
+  }
+  pthread_mutex_init(&host->lock, NULL);
+  C_COMPLAIN_INIT(&host->init_complaint);
+  host->reference_count = 1;
+  host->node = NULL;
+  host->port = 0;
+  host->notifications = 1;
+  host->check_thresholds = 0;
+  host->store_rates = 1;
+  host->always_append_ds = 0;
+  host->batch_mode = 1;
+  host->batch_max = RIEMANN_BATCH_MAX; /* typical MSS */
+  host->batch_init = cdtime();
+  host->batch_timeout = 0;
+  host->ttl_factor = RIEMANN_TTL_FACTOR;
+  host->client = NULL;
+  host->client_type = RIEMANN_CLIENT_TCP;
+  host->timeout.tv_sec = 0;
+  host->timeout.tv_usec = 0;
+
+  status = cf_util_get_string(ci, &host->name);
+  if (status != 0) {
+    WARNING("write_riemann plugin: Required host name is missing.");
+    wrr_free(host);
+    return -1;
+  }
 
+  for (i = 0; i < ci->children_num; i++) {
+    /*
+     * The code here could be simplified but makes room
+     * for easy adding of new options later on.
+     */
+    child = &ci->children[i];
+    status = 0;
 
+    if (strcasecmp("Host", child->key) == 0) {
+      status = cf_util_get_string(child, &host->node);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("Notifications", child->key) == 0) {
+      status = cf_util_get_boolean(child, &host->notifications);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("EventServicePrefix", child->key) == 0) {
+      status = cf_util_get_string(child, &host->event_service_prefix);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("CheckThresholds", child->key) == 0) {
+      status = cf_util_get_boolean(child, &host->check_thresholds);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("Batch", child->key) == 0) {
+      status = cf_util_get_boolean(child, &host->batch_mode);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("BatchMaxSize", child->key) == 0) {
+      status = cf_util_get_int(child, &host->batch_max);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("BatchFlushTimeout", child->key) == 0) {
+      status = cf_util_get_int(child, &host->batch_timeout);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("Timeout", child->key) == 0) {
+#if RCC_VERSION_NUMBER >= 0x010800
+      status = cf_util_get_int(child, (int *)&host->timeout.tv_sec);
+      if (status != 0)
+        break;
+#else
+      WARNING("write_riemann plugin: The Timeout option is not supported. Please upgrade the Riemann client to at least 1.8.0.");
+#endif
+    } else if (strcasecmp("Port", child->key) == 0) {
+      host->port = cf_util_get_port_number(child);
+      if (host->port == -1) {
+        ERROR("write_riemann plugin: Invalid argument "
+              "configured for the \"Port\" "
+              "option.");
+        break;
+      }
+    } else if (strcasecmp("Protocol", child->key) == 0) {
+      char tmp[16];
+      status = cf_util_get_string_buffer(child, tmp, sizeof(tmp));
+      if (status != 0) {
+        ERROR("write_riemann plugin: cf_util_get_"
+              "string_buffer failed with "
+              "status %i.",
+              status);
+        break;
+      }
+
+      if (strcasecmp("UDP", tmp) == 0)
+        host->client_type = RIEMANN_CLIENT_UDP;
+      else if (strcasecmp("TCP", tmp) == 0)
+        host->client_type = RIEMANN_CLIENT_TCP;
+      else if (strcasecmp("TLS", tmp) == 0)
+        host->client_type = RIEMANN_CLIENT_TLS;
+      else
+        WARNING("write_riemann plugin: The value "
+                "\"%s\" is not valid for the "
+                "\"Protocol\" option. Use "
+                "either \"UDP\", \"TCP\" or \"TLS\".",
+                tmp);
+    } else if (strcasecmp("TLSCAFile", child->key) == 0) {
+      status = cf_util_get_string(child, &host->tls_ca_file);
+      if (status != 0) {
+        ERROR("write_riemann plugin: cf_util_get_"
+              "string_buffer failed with "
+              "status %i.",
+              status);
+        break;
+      }
+    } else if (strcasecmp("TLSCertFile", child->key) == 0) {
+      status = cf_util_get_string(child, &host->tls_cert_file);
+      if (status != 0) {
+        ERROR("write_riemann plugin: cf_util_get_"
+              "string_buffer failed with "
+              "status %i.",
+              status);
+        break;
+      }
+    } else if (strcasecmp("TLSKeyFile", child->key) == 0) {
+      status = cf_util_get_string(child, &host->tls_key_file);
+      if (status != 0) {
+        ERROR("write_riemann plugin: cf_util_get_"
+              "string_buffer failed with "
+              "status %i.",
+              status);
+        break;
+      }
+    } else if (strcasecmp("StoreRates", child->key) == 0) {
+      status = cf_util_get_boolean(child, &host->store_rates);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("AlwaysAppendDS", child->key) == 0) {
+      status = cf_util_get_boolean(child, &host->always_append_ds);
+      if (status != 0)
+        break;
+    } else if (strcasecmp("TTLFactor", child->key) == 0) {
+      double tmp = NAN;
+      status = cf_util_get_double(child, &tmp);
+      if (status != 0)
+        break;
+      if (tmp >= 2.0) {
+        host->ttl_factor = tmp;
+      } else if (tmp >= 1.0) {
+        NOTICE("write_riemann plugin: The configured "
+               "TTLFactor is very small "
+               "(%.1f). A value of 2.0 or "
+               "greater is recommended.",
+               tmp);
+        host->ttl_factor = tmp;
+      } else if (tmp > 0.0) {
+        WARNING("write_riemann plugin: The configured "
+                "TTLFactor is too small to be "
+                "useful (%.1f). I'll use it "
+                "since the user knows best, "
+                "but under protest.",
+                tmp);
+        host->ttl_factor = tmp;
+      } else { /* zero, negative and NAN */
+        ERROR("write_riemann plugin: The configured "
+              "TTLFactor is invalid (%.1f).",
+              tmp);
+      }
     } else {
-
-        msg = riemann_value_list_to_protobuf (host, ds, vl, statuses);
-        if (msg == NULL)
-            return (-1);
-
-        status = riemann_send (host, msg);
-        if (status != 0)
-            ERROR ("write_riemann plugin: riemann_send failed with status %i",
-                   status);
-
-        riemann_msg_protobuf_free (msg);
+      WARNING("write_riemann plugin: ignoring unknown config "
+              "option: \"%s\"",
+              child->key);
     }
-	return status;
-} /* }}} int riemann_write */
-
-static void riemann_free(void *p) /* {{{ */
-{
-	struct riemann_host	*host = p;
-
-	if (host == NULL)
-		return;
-
-	pthread_mutex_lock (&host->lock);
-
-	host->reference_count--;
-	if (host->reference_count > 0)
-	{
-		pthread_mutex_unlock (&host->lock);
-		return;
-	}
-
-	riemann_disconnect (host);
+  }
+  if (status != 0) {
+    wrr_free(host);
+    return status;
+  }
 
-	sfree(host->service);
-	pthread_mutex_destroy (&host->lock);
-	sfree(host);
-} /* }}} void riemann_free */
+  ssnprintf(callback_name, sizeof(callback_name), "write_riemann/%s",
+            host->name);
 
-static int riemann_config_node(oconfig_item_t *ci) /* {{{ */
-{
-	struct riemann_host	*host = NULL;
-	int			 status = 0;
-	int			 i;
-	oconfig_item_t		*child;
-	char			 callback_name[DATA_MAX_NAME_LEN];
-	user_data_t		 ud;
-
-	if ((host = calloc(1, sizeof (*host))) == NULL) {
-		ERROR ("write_riemann plugin: calloc failed.");
-		return ENOMEM;
-	}
-	pthread_mutex_init (&host->lock, NULL);
-	host->reference_count = 1;
-	host->node = NULL;
-	host->service = NULL;
-	host->notifications = 1;
-	host->check_thresholds = 0;
-	host->store_rates = 1;
-	host->always_append_ds = 0;
-	host->use_tcp = 1;
-	host->batch_mode = 1;
-	host->batch_max = RIEMANN_BATCH_MAX; /* typical MSS */
-	host->batch_init = cdtime();
-	host->ttl_factor = RIEMANN_TTL_FACTOR;
-
-	status = cf_util_get_string (ci, &host->name);
-	if (status != 0) {
-		WARNING("write_riemann plugin: Required host name is missing.");
-		riemann_free (host);
-		return -1;
-	}
-
-	for (i = 0; i < ci->children_num; i++) {
-		/*
-		 * The code here could be simplified but makes room
-		 * for easy adding of new options later on.
-		 */
-		child = &ci->children[i];
-		status = 0;
-
-		if (strcasecmp ("Host", child->key) == 0) {
-			status = cf_util_get_string (child, &host->node);
-			if (status != 0)
-				break;
-		} else if (strcasecmp ("Notifications", child->key) == 0) {
-			status = cf_util_get_boolean(child, &host->notifications);
-			if (status != 0)
-				break;
-		} else if (strcasecmp ("EventServicePrefix", child->key) == 0) {
-			status = cf_util_get_string (child, &host->event_service_prefix);
-			if (status != 0)
-				break;
-		} else if (strcasecmp ("CheckThresholds", child->key) == 0) {
-			status = cf_util_get_boolean(child, &host->check_thresholds);
-			if (status != 0)
-				break;
-        } else if (strcasecmp ("Batch", child->key) == 0) {
-            status = cf_util_get_boolean(child, &host->batch_mode);
-            if (status != 0)
-                break;
-        } else if (strcasecmp("BatchMaxSize", child->key) == 0) {
-            status = cf_util_get_int(child, &host->batch_max);
-            if (status != 0)
-                break;
-		} else if (strcasecmp ("Port", child->key) == 0) {
-			status = cf_util_get_service (child, &host->service);
-			if (status != 0) {
-				ERROR ("write_riemann plugin: Invalid argument "
-						"configured for the \"Port\" "
-						"option.");
-				break;
-			}
-		} else if (strcasecmp ("Protocol", child->key) == 0) {
-			char tmp[16];
-			status = cf_util_get_string_buffer (child,
-					tmp, sizeof (tmp));
-			if (status != 0)
-			{
-				ERROR ("write_riemann plugin: cf_util_get_"
-						"string_buffer failed with "
-						"status %i.", status);
-				break;
-			}
-
-			if (strcasecmp ("UDP", tmp) == 0)
-				host->use_tcp = 0;
-			else if (strcasecmp ("TCP", tmp) == 0)
-				host->use_tcp = 1;
-			else
-				WARNING ("write_riemann plugin: The value "
-						"\"%s\" is not valid for the "
-						"\"Protocol\" option. Use "
-						"either \"UDP\" or \"TCP\".",
-						tmp);
-		} else if (strcasecmp ("StoreRates", child->key) == 0) {
-			status = cf_util_get_boolean (child, &host->store_rates);
-			if (status != 0)
-				break;
-		} else if (strcasecmp ("AlwaysAppendDS", child->key) == 0) {
-			status = cf_util_get_boolean (child,
-					&host->always_append_ds);
-			if (status != 0)
-				break;
-		} else if (strcasecmp ("TTLFactor", child->key) == 0) {
-			double tmp = NAN;
-			status = cf_util_get_double (child, &tmp);
-			if (status != 0)
-				break;
-			if (tmp >= 2.0) {
-				host->ttl_factor = tmp;
-			} else if (tmp >= 1.0) {
-				NOTICE ("write_riemann plugin: The configured "
-						"TTLFactor is very small "
-						"(%.1f). A value of 2.0 or "
-						"greater is recommended.",
-						tmp);
-				host->ttl_factor = tmp;
-			} else if (tmp > 0.0) {
-				WARNING ("write_riemann plugin: The configured "
-						"TTLFactor is too small to be "
-						"useful (%.1f). I'll use it "
-						"since the user knows best, "
-						"but under protest.",
-						tmp);
-				host->ttl_factor = tmp;
-			} else { /* zero, negative and NAN */
-				ERROR ("write_riemann plugin: The configured "
-						"TTLFactor is invalid (%.1f).",
-						tmp);
-			}
-		} else {
-			WARNING("write_riemann plugin: ignoring unknown config "
-				"option: \"%s\"", child->key);
-		}
-	}
-	if (status != 0) {
-		riemann_free (host);
-		return status;
-	}
-
-	ssnprintf (callback_name, sizeof (callback_name), "write_riemann/%s",
-			host->name);
-	ud.data = host;
-	ud.free_func = riemann_free;
-
-	pthread_mutex_lock (&host->lock);
-
-	status = plugin_register_write (callback_name, riemann_write, &ud);
-
-    if (host->use_tcp == 1 && host->batch_mode) {
-        ud.free_func = NULL;
-        plugin_register_flush(callback_name, riemann_batch_flush, &ud);
+  user_data_t ud = {
+    .data = host,
+    .free_func = wrr_free
+  };
+
+  pthread_mutex_lock(&host->lock);
+
+  status = plugin_register_write(callback_name, wrr_write, &ud);
+
+  if (host->client_type != RIEMANN_CLIENT_UDP && host->batch_mode) {
+    ud.free_func = NULL;
+    plugin_register_flush(callback_name, wrr_batch_flush, &ud);
+  }
+  if (status != 0)
+    WARNING("write_riemann plugin: plugin_register_write (\"%s\") "
+            "failed with status %i.",
+            callback_name, status);
+  else /* success */
+    host->reference_count++;
+
+  status = plugin_register_notification(callback_name, wrr_notification, &ud);
+  if (status != 0)
+    WARNING("write_riemann plugin: plugin_register_notification (\"%s\") "
+            "failed with status %i.",
+            callback_name, status);
+  else /* success */
+    host->reference_count++;
+
+  if (host->reference_count <= 1) {
+    /* Both callbacks failed => free memory.
+     * We need to unlock here, because riemann_free() will lock.
+     * This is not a race condition, because we're the only one
+     * holding a reference. */
+    pthread_mutex_unlock(&host->lock);
+    wrr_free(host);
+    return (-1);
+  }
+
+  host->reference_count--;
+  pthread_mutex_unlock(&host->lock);
+
+  return status;
+} /* }}} int wrr_config_node */
+
+static int wrr_config(oconfig_item_t *ci) /* {{{ */
+{
+  int i;
+  oconfig_item_t *child;
+  int status;
+
+  for (i = 0; i < ci->children_num; i++) {
+    child = &ci->children[i];
+
+    if (strcasecmp("Node", child->key) == 0) {
+      wrr_config_node(child);
+    } else if (strcasecmp(child->key, "attribute") == 0) {
+      char *key = NULL;
+      char *val = NULL;
+
+      if (child->values_num != 2) {
+        WARNING("riemann attributes need both a key and a value.");
+        return (-1);
+      }
+      if (child->values[0].type != OCONFIG_TYPE_STRING ||
+          child->values[1].type != OCONFIG_TYPE_STRING) {
+        WARNING("riemann attribute needs string arguments.");
+        return (-1);
+      }
+      if ((key = strdup(child->values[0].value.string)) == NULL) {
+        WARNING("cannot allocate memory for attribute key.");
+        return (-1);
+      }
+      if ((val = strdup(child->values[1].value.string)) == NULL) {
+        WARNING("cannot allocate memory for attribute value.");
+        sfree(key);
+        return (-1);
+      }
+      strarray_add(&riemann_attrs, &riemann_attrs_num, key);
+      strarray_add(&riemann_attrs, &riemann_attrs_num, val);
+      DEBUG("write_riemann: got attr: %s => %s", key, val);
+      sfree(key);
+      sfree(val);
+    } else if (strcasecmp(child->key, "tag") == 0) {
+      char *tmp = NULL;
+      status = cf_util_get_string(child, &tmp);
+      if (status != 0)
+        continue;
+
+      strarray_add(&riemann_tags, &riemann_tags_num, tmp);
+      DEBUG("write_riemann plugin: Got tag: %s", tmp);
+      sfree(tmp);
+    } else {
+      WARNING("write_riemann plugin: Ignoring unknown "
+              "configuration option \"%s\" at top level.",
+              child->key);
     }
-	if (status != 0)
-		WARNING ("write_riemann plugin: plugin_register_write (\"%s\") "
-				"failed with status %i.",
-				callback_name, status);
-	else /* success */
-		host->reference_count++;
-
-	status = plugin_register_notification (callback_name,
-			riemann_notification, &ud);
-	if (status != 0)
-		WARNING ("write_riemann plugin: plugin_register_notification (\"%s\") "
-				"failed with status %i.",
-				callback_name, status);
-	else /* success */
-		host->reference_count++;
-
-	if (host->reference_count <= 1)
-	{
-		/* Both callbacks failed => free memory.
-		 * We need to unlock here, because riemann_free() will lock.
-		 * This is not a race condition, because we're the only one
-		 * holding a reference. */
-		pthread_mutex_unlock (&host->lock);
-		riemann_free (host);
-		return (-1);
-	}
+  }
+  return (0);
+} /* }}} int wrr_config */
 
-	host->reference_count--;
-	pthread_mutex_unlock (&host->lock);
-
-	return status;
-} /* }}} int riemann_config_node */
-
-static int riemann_config(oconfig_item_t *ci) /* {{{ */
-{
-	int		 i;
-	oconfig_item_t	*child;
-	int		 status;
-
-	for (i = 0; i < ci->children_num; i++)  {
-		child = &ci->children[i];
-
-		if (strcasecmp("Node", child->key) == 0) {
-			riemann_config_node (child);
-		} else if (strcasecmp(child->key, "attribute") == 0) {
-			char *key = NULL;
-			char *val = NULL;
-
-			if (child->values_num != 2) {
-				WARNING("riemann attributes need both a key and a value.");
-				return (-1);
-			}
-			if (child->values[0].type != OCONFIG_TYPE_STRING ||
-			    child->values[1].type != OCONFIG_TYPE_STRING) {
-				WARNING("riemann attribute needs string arguments.");
-				return (-1);
-			}
-			if ((key = strdup(child->values[0].value.string)) == NULL) {
-				WARNING("cannot allocate memory for attribute key.");
-				return (-1);
-			}
-			if ((val = strdup(child->values[1].value.string)) == NULL) {
-				WARNING("cannot allocate memory for attribute value.");
-				sfree (key);
-				return (-1);
-			}
-			strarray_add(&riemann_attrs, &riemann_attrs_num, key);
-			strarray_add(&riemann_attrs, &riemann_attrs_num, val);
-			DEBUG("write_riemann: got attr: %s => %s", key, val);
-			sfree(key);
-			sfree(val);
-		} else if (strcasecmp(child->key, "tag") == 0) {
-			char *tmp = NULL;
-			status = cf_util_get_string(child, &tmp);
-			if (status != 0)
-				continue;
-
-			strarray_add (&riemann_tags, &riemann_tags_num, tmp);
-			DEBUG("write_riemann plugin: Got tag: %s", tmp);
-			sfree (tmp);
-		} else {
-			WARNING ("write_riemann plugin: Ignoring unknown "
-				 "configuration option \"%s\" at top level.",
-				 child->key);
-		}
-	}
-	return (0);
-} /* }}} int riemann_config */
-
-void module_register(void)
-{
-	plugin_register_complex_config ("write_riemann", riemann_config);
+void module_register(void) {
+  plugin_register_complex_config("write_riemann", wrr_config);
 }
 
 /* vim: set sw=8 sts=8 ts=8 noet : */
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann_threshold.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann_threshold.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann_threshold.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann_threshold.c	2016-09-11 16:10:25.279038699 +0800
@@ -31,14 +31,12 @@
 #include "plugin.h"
 #include "utils_avltree.h"
 #include "utils_cache.h"
 #include "utils_threshold.h"
 #include "write_riemann_threshold.h"
 
-#include <ltdl.h>
-
 /*
  * Threshold management
  * ====================
  * The following functions add, delete, etc. configured thresholds to
  * the underlying AVL trees.
  */
@@ -130,13 +128,12 @@
     const value_list_t *vl,
     const threshold_t *th,
     const gauge_t *values,
     int *statuses)
 { /* {{{ */
   int ret = -1;
-  int i;
   int status;
   gauge_t values_copy[ds->ds_num];
 
   memcpy (values_copy, values, sizeof (values_copy));
 
   if ((th->flags & UT_FLAG_PERCENTAGE) != 0)
@@ -150,33 +147,33 @@
           "source, but you have configured to check this as a percentage. "
           "That doesn't make much sense, because the percentage will always "
           "be 100%%!", ds->type);
     }
 
     /* Prepare `sum' and `num'. */
-    for (i = 0; i < ds->ds_num; i++)
+    for (size_t i = 0; i < ds->ds_num; i++)
       if (!isnan (values[i]))
       {
         num++;
 	sum += values[i];
       }
 
     if ((num == 0) /* All data sources are undefined. */
         || (sum == 0.0)) /* Sum is zero, cannot calculate percentage. */
     {
-      for (i = 0; i < ds->ds_num; i++)
+      for (size_t i = 0; i < ds->ds_num; i++)
         values_copy[i] = NAN;
     }
     else /* We can actually calculate the percentage. */
     {
-      for (i = 0; i < ds->ds_num; i++)
+      for (size_t i = 0; i < ds->ds_num; i++)
         values_copy[i] = 100.0 * values[i] / sum;
     }
   } /* if (UT_FLAG_PERCENTAGE) */
 
-  for (i = 0; i < ds->ds_num; i++)
+  for (size_t i = 0; i < ds->ds_num; i++)
   {
     status = ut_check_one_data_source (ds, vl, th, values_copy, i);
     if (status != -1) {
 	    ret = 0;
 	    if (statuses[i] < status)
 		    statuses[i] = status;
@@ -199,13 +196,15 @@
 				   int *statuses)
 { /* {{{ */
   threshold_t *th;
   gauge_t *values;
   int status;
 
+  assert (vl->values_len > 0);
   memset(statuses, 0, vl->values_len * sizeof(*statuses));
+
   if (threshold_tree == NULL)
 	  return 0;
 
   /* Is this lock really necessary? So far, thresholds are only inserted at
    * startup. -octo */
   pthread_mutex_lock (&threshold_lock);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann_threshold.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann_threshold.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_riemann_threshold.h	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_riemann_threshold.h	2016-09-11 16:10:25.279038699 +0800
@@ -1,36 +1,6 @@
-/**
- * collectd - src/write_riemann_threshold.h
- * Copyright (C) 2016       Ruben Kerkhof
- *
- * This program is free software; you can redistribute it and/or modify it
- * under the terms of the GNU General Public License as published by the
- * Free Software Foundation; only version 2 of the License is applicable.
- *
- * This program is distributed in the hope that it will be useful, but
- * WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along
- * with this program; if not, write to the Free Software Foundation, Inc.,
- * 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA
- *
- * Author:
- *   Ruben Kerkhof <ruben at rubenkerkhof.com>
- **/
-
 #ifndef WRITE_RIEMANN_THRESHOLD_H
 #define WRITE_RIEMANN_THRESHOLD_H
 
-#include "plugin.h"
-
-/* write_riemann_threshold_check tests all matching thresholds and returns the
- * worst result for each data source in "statuses". "statuses" must point to
- * ds->ds_num integers to which the result is written.
- *
- * Returns zero on success and if no threshold has been configured. Returns
- * less than zero on failure. */
-int write_riemann_threshold_check(const data_set_t *ds, const value_list_t *vl,
-    int *statuses);
+int write_riemann_threshold_check(const data_set_t *, const value_list_t *, int *);
 
-#endif /* WRITE_RIEMANN_THRESHOLD_H */
+#endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_sensu.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_sensu.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_sensu.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_sensu.c	2016-09-11 16:10:25.279038699 +0800
@@ -24,28 +24,75 @@
  *   Fabrice A. Marie <fabrice at kibinlabs.com>
  */
 
 #define _GNU_SOURCE
 
 #include "collectd.h"
+
 #include "plugin.h"
 #include "common.h"
-#include "configfile.h"
 #include "utils_cache.h"
-#include <sys/socket.h>
 #include <arpa/inet.h>
 #include <errno.h>
 #include <netdb.h>
 #include <inttypes.h>
-#include <pthread.h>
 #include <stddef.h>
 
 #include <stdlib.h>
 #define SENSU_HOST		"localhost"
 #define SENSU_PORT		"3030"
 
+#ifdef HAVE_ASPRINTF
+#define my_asprintf asprintf
+#define my_vasprintf vasprintf
+#else
+/*
+ * asprintf() is available from Solaris 10 update 11.
+ * For older versions, use asprintf() portable implementation from
+ * https://github.com/littlstar/asprintf.c/blob/master/
+ * copyright (c) 2014 joseph werle <joseph.werle@gmail.com> under MIT license.
+ */
+
+static int my_vasprintf(char **str, const char *fmt, va_list args) {
+       int size = 0;
+       va_list tmpa;
+       // copy
+       va_copy(tmpa, args);
+       // apply variadic arguments to
+       // sprintf with format to get size
+       size = vsnprintf(NULL, size, fmt, tmpa);
+       // toss args
+       va_end(tmpa);
+       // return -1 to be compliant if
+       // size is less than 0
+       if (size < 0) { return -1; }
+       // alloc with size plus 1 for `\0'
+       *str = (char *) malloc(size + 1);
+       // return -1 to be compliant
+       // if pointer is `NULL'
+       if (NULL == *str) { return -1; }
+       // format string with original
+       // variadic arguments and set new size
+       size = vsprintf(*str, fmt, args);
+       return size;
+}
+
+static int my_asprintf(char **str, const char *fmt, ...) {
+       int size = 0;
+       va_list args;
+       // init variadic argumens
+       va_start(args, fmt);
+       // format and get size
+       size = my_vasprintf(str, fmt, args);
+       // toss args
+       va_end(args);
+       return size;
+}
+
+#endif
+
 struct str_list {
 	int nb_strs;
 	char **strs;
 };
 
 struct sensu_host {
@@ -93,53 +140,51 @@
 	return 0;
 }
 /* }}} int add_str_to_list */
 
 static void free_str_list(struct str_list *strs) /* {{{ */
 {
-	int i;
-	for (i=0; i<strs->nb_strs; i++)
+	for (int i=0; i<strs->nb_strs; i++)
 		free(strs->strs[i]);
 	free(strs->strs);
 }
 /* }}} void free_str_list */
 
 static int sensu_connect(struct sensu_host *host) /* {{{ */
 {
 	int			 e;
-	struct addrinfo		*ai, hints;
 	char const		*node;
 	char const		*service;
 
 	// Resolve the target if we haven't done already
 	if (!(host->flags & F_READY)) {
-		memset(&hints, 0, sizeof(hints));
 		memset(&service, 0, sizeof(service));
 		host->res = NULL;
-		hints.ai_family = AF_INET;
-		hints.ai_socktype = SOCK_STREAM;
-#ifdef AI_ADDRCONFIG
-		hints.ai_flags |= AI_ADDRCONFIG;
-#endif
 
 		node = (host->node != NULL) ? host->node : SENSU_HOST;
 		service = (host->service != NULL) ? host->service : SENSU_PORT;
 
-		if ((e = getaddrinfo(node, service, &hints, &(host->res))) != 0) {
+		struct addrinfo ai_hints = {
+			.ai_family = AF_INET,
+			.ai_flags = AI_ADDRCONFIG,
+			.ai_socktype = SOCK_STREAM
+		};
+
+		if ((e = getaddrinfo(node, service, &ai_hints, &(host->res))) != 0) {
 			ERROR("write_sensu plugin: Unable to resolve host \"%s\": %s",
 					node, gai_strerror(e));
 			return -1;
 		}
 		DEBUG("write_sensu plugin: successfully resolved host/port: %s/%s",
 				node, service);
 		host->flags |= F_READY;
 	}
 
 	struct linger so_linger;
 	host->s = -1;
-	for (ai = host->res; ai != NULL; ai = ai->ai_next) {
+	for (struct addrinfo *ai = host->res; ai != NULL; ai = ai->ai_next) {
 		// create the socket
 		if ((host->s = socket(ai->ai_family,
 				      ai->ai_socktype,
 				      ai->ai_protocol)) == -1) {
 			continue;
 		}
@@ -147,12 +192,14 @@
 		// Set very low close() lingering
 		so_linger.l_onoff = 1;
 		so_linger.l_linger = 3;
 		if (setsockopt(host->s, SOL_SOCKET, SO_LINGER, &so_linger, sizeof so_linger) != 0)
 			WARNING("write_sensu plugin: failed to set socket close() lingering");
 
+		set_sock_opts(host->s);
+
 		// connect the socket
 		if (connect(host->s, ai->ai_addr, ai->ai_addrlen) != 0) {
 			close(host->s);
 			host->s = -1;
 			continue;
 		}
@@ -175,39 +222,39 @@
 
 } /* }}} void sensu_close_socket */
 
 static char *build_json_str_list(const char *tag, struct str_list const *list) /* {{{ */
 {
 	int res;
-	char *ret_str;
+	char *ret_str = NULL;
 	char *temp_str;
-	int i;
 	if (list->nb_strs == 0) {
 		ret_str = malloc(sizeof(char));
 		if (ret_str == NULL) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str[0] = '\0';
 	}
 
-	res = asprintf(&temp_str, "\"%s\": [\"%s\"", tag, list->strs[0]);
+	res = my_asprintf(&temp_str, "\"%s\": [\"%s\"", tag, list->strs[0]);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
+		free(ret_str);
 		return NULL;
 	}
-	for (i=1; i<list->nb_strs; i++) {
-		res = asprintf(&ret_str, "%s, \"%s\"", temp_str, list->strs[i]);
+	for (int i=1; i<list->nb_strs; i++) {
+		res = my_asprintf(&ret_str, "%s, \"%s\"", temp_str, list->strs[i]);
 		free(temp_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		temp_str = ret_str;
 	}
-	res = asprintf(&ret_str, "%s]", temp_str);
+	res = my_asprintf(&ret_str, "%s]", temp_str);
 	free(temp_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 
@@ -258,15 +305,14 @@
 #undef APPEND
 	return (0);
 } /* int sensu_format_name2 */
 
 static void in_place_replace_sensu_name_reserved(char *orig_name) /* {{{ */
 {
-	int i;
 	int len=strlen(orig_name);
-	for (i=0; i<len; i++) {
+	for (int i=0; i<len; i++) {
 		// some plugins like ipmi generate special characters in metric name
 		switch(orig_name[i]) {
 			case '(': orig_name[i] = '_'; break;
 			case ')': orig_name[i] = '_'; break;
 			case ' ': orig_name[i] = '_'; break;
 			case '"': orig_name[i] = '_'; break;
@@ -281,13 +327,12 @@
 		value_list_t const *vl, size_t index,
 		gauge_t const *rates,
 		int status)
 {
 	char name_buffer[5 * DATA_MAX_NAME_LEN];
 	char service_buffer[6 * DATA_MAX_NAME_LEN];
-	int i;
 	char *ret_str;
 	char *temp_str;
 	char *value_str;
 	int res;
 	// First part of the JSON string
 	const char *part1 = "{\"name\": \"collectd\", \"type\": \"metric\"";
@@ -305,159 +350,159 @@
 		if (ret_str == NULL) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 	}
 	else {
-		res = asprintf(&ret_str, "%s, %s", part1, handlers_str);
+		res = my_asprintf(&ret_str, "%s, %s", part1, handlers_str);
 		free(handlers_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 	}
 
 	// incorporate the plugin name information
-	res = asprintf(&temp_str, "%s, \"collectd_plugin\": \"%s\"", ret_str, vl->plugin);
+	res = my_asprintf(&temp_str, "%s, \"collectd_plugin\": \"%s\"", ret_str, vl->plugin);
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
 
 	// incorporate the plugin type
-	res = asprintf(&temp_str, "%s, \"collectd_plugin_type\": \"%s\"", ret_str, vl->type);
+	res = my_asprintf(&temp_str, "%s, \"collectd_plugin_type\": \"%s\"", ret_str, vl->type);
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
 
 	// incorporate the plugin instance if any
 	if (vl->plugin_instance[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin_instance\": \"%s\"", ret_str, vl->plugin_instance);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin_instance\": \"%s\"", ret_str, vl->plugin_instance);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the plugin type instance if any
 	if (vl->type_instance[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin_type_instance\": \"%s\"", ret_str, vl->type_instance);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin_type_instance\": \"%s\"", ret_str, vl->type_instance);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the data source type
 	if ((ds->ds[index].type != DS_TYPE_GAUGE) && (rates != NULL)) {
 		char ds_type[DATA_MAX_NAME_LEN];
 		ssnprintf (ds_type, sizeof (ds_type), "%s:rate", DS_TYPE_TO_STRING(ds->ds[index].type));
-		res = asprintf(&temp_str, "%s, \"collectd_data_source_type\": \"%s\"", ret_str, ds_type);
+		res = my_asprintf(&temp_str, "%s, \"collectd_data_source_type\": \"%s\"", ret_str, ds_type);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	} else {
-		res = asprintf(&temp_str, "%s, \"collectd_data_source_type\": \"%s\"", ret_str, DS_TYPE_TO_STRING(ds->ds[index].type));
+		res = my_asprintf(&temp_str, "%s, \"collectd_data_source_type\": \"%s\"", ret_str, DS_TYPE_TO_STRING(ds->ds[index].type));
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the data source name
-	res = asprintf(&temp_str, "%s, \"collectd_data_source_name\": \"%s\"", ret_str, ds->ds[index].name);
+	res = my_asprintf(&temp_str, "%s, \"collectd_data_source_name\": \"%s\"", ret_str, ds->ds[index].name);
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
 
 	// incorporate the data source index
 	{
 		char ds_index[DATA_MAX_NAME_LEN];
 		ssnprintf (ds_index, sizeof (ds_index), "%zu", index);
-		res = asprintf(&temp_str, "%s, \"collectd_data_source_index\": %s", ret_str, ds_index);
+		res = my_asprintf(&temp_str, "%s, \"collectd_data_source_index\": %s", ret_str, ds_index);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// add key value attributes from config if any
-	for (i = 0; i < sensu_attrs_num; i += 2) {
-		res = asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, sensu_attrs[i], sensu_attrs[i+1]);
+	for (size_t i = 0; i < sensu_attrs_num; i += 2) {
+		res = my_asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, sensu_attrs[i], sensu_attrs[i+1]);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate sensu tags from config if any
 	if ((sensu_tags != NULL) && (strlen(sensu_tags) != 0)) {
-		res = asprintf(&temp_str, "%s, %s", ret_str, sensu_tags);
+		res = my_asprintf(&temp_str, "%s, %s", ret_str, sensu_tags);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// calculate the value and set to a string
 	if (ds->ds[index].type == DS_TYPE_GAUGE) {
-		res = asprintf(&value_str, GAUGE_FORMAT, vl->values[index].gauge);
+		res = my_asprintf(&value_str, GAUGE_FORMAT, vl->values[index].gauge);
 		if (res == -1) {
 			free(ret_str);
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 	} else if (rates != NULL) {
-		res = asprintf(&value_str, GAUGE_FORMAT, rates[index]);
+		res = my_asprintf(&value_str, GAUGE_FORMAT, rates[index]);
 		if (res == -1) {
 			free(ret_str);
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 	} else {
 		if (ds->ds[index].type == DS_TYPE_DERIVE) {
-			res = asprintf(&value_str, "%"PRIi64, vl->values[index].derive);
+			res = my_asprintf(&value_str, "%"PRIi64, vl->values[index].derive);
 			if (res == -1) {
 				free(ret_str);
 				ERROR("write_sensu plugin: Unable to alloc memory");
 				return NULL;
 			}
 		}
 		else if (ds->ds[index].type == DS_TYPE_ABSOLUTE) {
-			res = asprintf(&value_str, "%"PRIu64, vl->values[index].absolute);
+			res = my_asprintf(&value_str, "%"PRIu64, vl->values[index].absolute);
 			if (res == -1) {
 				free(ret_str);
 				ERROR("write_sensu plugin: Unable to alloc memory");
 				return NULL;
 			}
 		}
 		else {
-			res = asprintf(&value_str, "%llu", vl->values[index].counter);
+			res = my_asprintf(&value_str, "%llu", vl->values[index].counter);
 			if (res == -1) {
 				free(ret_str);
 				ERROR("write_sensu plugin: Unable to alloc memory");
 				return NULL;
 			}
 		}
@@ -483,13 +528,13 @@
 	}
 
 	// Replace collectd sensor name reserved characters so that time series DB is happy
 	in_place_replace_sensu_name_reserved(service_buffer);
 
 	// finalize the buffer by setting the output and closing curly bracket
-	res = asprintf(&temp_str, "%s, \"output\": \"%s %s %ld\"}\n", ret_str, service_buffer, value_str, CDTIME_T_TO_TIME_T(vl->time));
+	res = my_asprintf(&temp_str, "%s, \"output\": \"%s %s %lld\"}\n",ret_str, service_buffer, value_str, (long long)CDTIME_T_TO_TIME_T(vl->time));
 	free(ret_str);
 	free(value_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
@@ -522,17 +567,16 @@
 			count++;
 		/* This is undefined if p - str > PTRDIFF_MAX */
 		retlen = p - str + strlen(p) + count * (newlen - oldlen);
 	} else
 		retlen = strlen(str);
 
-	ret = malloc(retlen + 1);
+	ret = calloc(1, retlen + 1);
 	if (ret == NULL)
 		return NULL;
 	// added to original: not optimized, but keeps valgrind happy.
-	memset(ret, 0, retlen + 1);
 
 	r = ret;
 	p = str;
 	while (1) {
 		/* If the old and new strings are different lengths - in other
 		 * words we have already iterated through with strstr above,
@@ -589,17 +633,16 @@
 
 static char *sensu_notification_to_json(struct sensu_host *host, /* {{{ */
 		notification_t const *n)
 {
 	char service_buffer[6 * DATA_MAX_NAME_LEN];
 	char const *severity;
-	notification_meta_t *meta;
 	char *ret_str;
 	char *temp_str;
 	int status;
-	int i;
+	size_t i;
 	int res;
 	// add the severity/status
 	switch (n->severity) {
 		case NOTIF_OKAY:
 			severity = "OK";
 			status = 0;
@@ -613,21 +656,21 @@
 			status = 2;
 			break;
 		default:
 			severity = "UNKNOWN";
 			status = 3;
 	}
-	res = asprintf(&temp_str, "{\"status\": %d", status);
+	res = my_asprintf(&temp_str, "{\"status\": %d", status);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
 
 	// incorporate the timestamp
-	res = asprintf(&temp_str, "%s, \"timestamp\": %ld", ret_str, CDTIME_T_TO_TIME_T(n->time));
+	res = my_asprintf(&temp_str, "%s, \"timestamp\": %lld", ret_str, (long long)CDTIME_T_TO_TIME_T(n->time));
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
@@ -637,13 +680,13 @@
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		free(ret_str);
 		return NULL;
 	}
 	// incorporate the handlers
 	if (strlen(handlers_str) != 0) {
-		res = asprintf(&temp_str, "%s, %s", ret_str, handlers_str);
+		res = my_asprintf(&temp_str, "%s, %s", ret_str, handlers_str);
 		free(ret_str);
 		free(handlers_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
@@ -651,68 +694,68 @@
 	} else {
 		free(handlers_str);
 	}
 
 	// incorporate the plugin name information if any
 	if (n->plugin[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin\": \"%s\"", ret_str, n->plugin);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin\": \"%s\"", ret_str, n->plugin);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the plugin type if any
 	if (n->type[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin_type\": \"%s\"", ret_str, n->type);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin_type\": \"%s\"", ret_str, n->type);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the plugin instance if any
 	if (n->plugin_instance[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin_instance\": \"%s\"", ret_str, n->plugin_instance);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin_instance\": \"%s\"", ret_str, n->plugin_instance);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate the plugin type instance if any
 	if (n->type_instance[0] != 0) {
-		res = asprintf(&temp_str, "%s, \"collectd_plugin_type_instance\": \"%s\"", ret_str, n->type_instance);
+		res = my_asprintf(&temp_str, "%s, \"collectd_plugin_type_instance\": \"%s\"", ret_str, n->type_instance);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// add key value attributes from config if any
 	for (i = 0; i < sensu_attrs_num; i += 2) {
-		res = asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, sensu_attrs[i], sensu_attrs[i+1]);
+		res = my_asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, sensu_attrs[i], sensu_attrs[i+1]);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// incorporate sensu tags from config if any
 	if ((sensu_tags != NULL) && (strlen(sensu_tags) != 0)) {
-		res = asprintf(&temp_str, "%s, %s", ret_str, sensu_tags);
+		res = my_asprintf(&temp_str, "%s, %s", ret_str, sensu_tags);
 		free(ret_str);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
@@ -721,13 +764,13 @@
 	// incorporate the service name
 	sensu_format_name2(service_buffer, sizeof(service_buffer),
 				/* host */ "", n->plugin, n->plugin_instance,
 				n->type, n->type_instance, host->separator);
 	// replace sensu event name chars that are considered illegal
 	in_place_replace_sensu_name_reserved(service_buffer);
-	res = asprintf(&temp_str, "%s, \"name\": \"%s\"", ret_str, &service_buffer[1]);
+	res = my_asprintf(&temp_str, "%s, \"name\": \"%s\"", ret_str, &service_buffer[1]);
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
@@ -737,46 +780,46 @@
 		char *msg = replace_json_reserved(n->message);
 		if (msg == NULL) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			free(ret_str);
 			return NULL;
 		}
-		res = asprintf(&temp_str, "%s, \"output\": \"%s - %s\"", ret_str, severity, msg);
+		res = my_asprintf(&temp_str, "%s, \"output\": \"%s - %s\"", ret_str, severity, msg);
 		free(ret_str);
 		free(msg);
 		if (res == -1) {
 			ERROR("write_sensu plugin: Unable to alloc memory");
 			return NULL;
 		}
 		ret_str = temp_str;
 	}
 
 	// Pull in values from threshold and add extra attributes
-	for (meta = n->meta; meta != NULL; meta = meta->next) {
+	for (notification_meta_t *meta = n->meta; meta != NULL; meta = meta->next) {
 		if (strcasecmp("CurrentValue", meta->name) == 0 && meta->type == NM_TYPE_DOUBLE) {
-			res = asprintf(&temp_str, "%s, \"current_value\": \"%.8f\"", ret_str, meta->nm_value.nm_double);
+			res = my_asprintf(&temp_str, "%s, \"current_value\": \"%.8f\"", ret_str, meta->nm_value.nm_double);
 			free(ret_str);
 			if (res == -1) {
 				ERROR("write_sensu plugin: Unable to alloc memory");
 				return NULL;
 			}
 			ret_str = temp_str;
 		}
 		if (meta->type == NM_TYPE_STRING) {
-			res = asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, meta->name, meta->nm_value.nm_string);
+			res = my_asprintf(&temp_str, "%s, \"%s\": \"%s\"", ret_str, meta->name, meta->nm_value.nm_string);
 			free(ret_str);
 			if (res == -1) {
 				ERROR("write_sensu plugin: Unable to alloc memory");
 				return NULL;
 			}
 			ret_str = temp_str;
 		}
 	}
 
 	// close the curly bracket
-	res = asprintf(&temp_str, "%s}\n", ret_str);
+	res = my_asprintf(&temp_str, "%s}\n", ret_str);
 	free(ret_str);
 	if (res == -1) {
 		ERROR("write_sensu plugin: Unable to alloc memory");
 		return NULL;
 	}
 	ret_str = temp_str;
@@ -837,13 +880,12 @@
 	      user_data_t *ud)
 {
 	int status = 0;
 	int statuses[vl->values_len];
 	struct sensu_host	*host = ud->data;
 	gauge_t *rates = NULL;
-	int i;
 	char *msg;
 
 	pthread_mutex_lock(&host->lock);
 	memset(statuses, 0, vl->values_len * sizeof(*statuses));
 
 	if (host->store_rates) {
@@ -851,13 +893,13 @@
 		if (rates == NULL) {
 			ERROR("write_sensu plugin: uc_get_rate failed.");
 			pthread_mutex_unlock(&host->lock);
 			return -1;
 		}
 	}
-	for (i = 0; i < (size_t) vl->values_len; i++) {
+	for (size_t i = 0; i < vl->values_len; i++) {
 		msg = sensu_value_to_json(host, ds, vl, (int) i, rates, statuses[i]);
 		if (msg == NULL) {
 			sfree(rates);
 			pthread_mutex_unlock(&host->lock);
 			return -1;
 		}
@@ -931,16 +973,14 @@
 
 
 static int sensu_config_node(oconfig_item_t *ci) /* {{{ */
 {
 	struct sensu_host	*host = NULL;
 	int					status = 0;
-	int					i;
 	oconfig_item_t		*child;
 	char				callback_name[DATA_MAX_NAME_LEN];
-	user_data_t			ud;
 
 	if ((host = calloc(1, sizeof(*host))) == NULL) {
 		ERROR("write_sensu plugin: calloc failed.");
 		return ENOMEM;
 	}
 	pthread_mutex_init(&host->lock, NULL);
@@ -966,13 +1006,13 @@
 	if (status != 0) {
 		WARNING("write_sensu plugin: Required host name is missing.");
 		sensu_free(host);
 		return -1;
 	}
 
-	for (i = 0; i < ci->children_num; i++) {
+	for (int i = 0; i < ci->children_num; i++) {
 		child = &ci->children[i];
 		status = 0;
 
 		if (strcasecmp("Host", child->key) == 0) {
 			status = cf_util_get_string(child, &host->node);
 			if (status != 0)
@@ -1064,14 +1104,17 @@
 		WARNING("write_sensu plugin: neither metrics nor notifications enabled. Giving up.");
 		sensu_free(host);
 		return -1;
 	}
 
 	ssnprintf(callback_name, sizeof(callback_name), "write_sensu/%s", host->name);
-	ud.data = host;
-	ud.free_func = sensu_free;
+
+	user_data_t ud = {
+		.data = host,
+		.free_func = sensu_free
+	};
 
 	pthread_mutex_lock(&host->lock);
 
 	if (host->metrics) {
 		status = plugin_register_write(callback_name, sensu_write, &ud);
 		if (status != 0)
@@ -1107,21 +1150,20 @@
 
 	return status;
 } /* }}} int sensu_config_node */
 
 static int sensu_config(oconfig_item_t *ci) /* {{{ */
 {
-	int		 i;
 	oconfig_item_t	*child;
 	int		 status;
 	struct str_list sensu_tags_arr;
 
 	sensu_tags_arr.nb_strs = 0;
 	sensu_tags_arr.strs = NULL;
 
-	for (i = 0; i < ci->children_num; i++)  {
+	for (int i = 0; i < ci->children_num; i++)  {
 		child = &ci->children[i];
 
 		if (strcasecmp("Node", child->key) == 0) {
 			sensu_config_node(child);
 		} else if (strcasecmp(child->key, "attribute") == 0) {
 			if (child->values_num != 2) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_tsdb.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_tsdb.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/write_tsdb.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/write_tsdb.c	2016-09-11 16:10:25.279038699 +0800
@@ -39,20 +39,18 @@
  *     HostTags "status=production deviceclass=www"
  *   </Node>
  * </Plugin>
  */
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
-#include "configfile.h"
 
 #include "utils_cache.h"
 
-#include <pthread.h>
-#include <sys/socket.h>
 #include <netdb.h>
 
 #ifndef WT_DEFAULT_NODE
 # define WT_DEFAULT_NODE "localhost"
 #endif
 
@@ -140,13 +138,13 @@
 
         now = cdtime();
         if ((cb->send_buf_init_time + timeout) > now)
             return 0;
     }
 
-    if (cb->send_buf_fill <= 0)
+    if (cb->send_buf_fill == 0)
     {
         cb->send_buf_init_time = cdtime();
         return 0;
     }
 
     status = wt_send_buffer(cb);
@@ -154,48 +152,45 @@
 
     return status;
 }
 
 static int wt_callback_init(struct wt_callback *cb)
 {
-    struct addrinfo ai_hints;
     struct addrinfo *ai_list;
-    struct addrinfo *ai_ptr;
     int status;
 
     const char *node = cb->node ? cb->node : WT_DEFAULT_NODE;
     const char *service = cb->service ? cb->service : WT_DEFAULT_SERVICE;
 
     if (cb->sock_fd > 0)
         return 0;
 
-    memset(&ai_hints, 0, sizeof(ai_hints));
-#ifdef AI_ADDRCONFIG
-    ai_hints.ai_flags    |= AI_ADDRCONFIG;
-#endif
-    ai_hints.ai_family   = AF_UNSPEC;
-    ai_hints.ai_socktype = SOCK_STREAM;
-
-    ai_list = NULL;
+    struct addrinfo ai_hints = {
+        .ai_family = AF_UNSPEC,
+        .ai_flags = AI_ADDRCONFIG,
+        .ai_socktype = SOCK_STREAM
+    };
 
     status = getaddrinfo(node, service, &ai_hints, &ai_list);
     if (status != 0)
     {
         ERROR("write_tsdb plugin: getaddrinfo (%s, %s) failed: %s",
               node, service, gai_strerror (status));
         return -1;
     }
 
     assert (ai_list != NULL);
-    for (ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
+    for (struct addrinfo *ai_ptr = ai_list; ai_ptr != NULL; ai_ptr = ai_ptr->ai_next)
     {
         cb->sock_fd = socket(ai_ptr->ai_family, ai_ptr->ai_socktype,
                              ai_ptr->ai_protocol);
         if (cb->sock_fd < 0)
             continue;
 
+        set_sock_opts(cb->sock_fd);
+
         status = connect(cb->sock_fd, ai_ptr->ai_addr, ai_ptr->ai_addrlen);
         if (status != 0)
         {
             close(cb->sock_fd);
             cb->sock_fd = -1;
             continue;
@@ -344,13 +339,13 @@
                           const value_list_t *vl,
                           const struct wt_callback *cb,
                           const char *ds_name)
 {
     int status;
     char *temp = NULL;
-    char *prefix = "";
+    const char *prefix = "";
     const char *meta_prefix = "tsdb_prefix";
 
     if (vl->meta) {
         status = meta_data_get_string(vl->meta, meta_prefix, &temp);
         if (status == -ENOENT) {
             /* defaults to empty string */
@@ -407,17 +402,17 @@
 
 static int wt_send_message (const char* key, const char* value,
                             cdtime_t time, struct wt_callback *cb,
                             const char* host, meta_data_t *md)
 {
     int status;
-    int message_len;
+    size_t message_len;
     char *temp = NULL;
-    char *tags = "";
+    const char *tags = "";
     char message[1024];
-    char *host_tags = cb->host_tags ? cb->host_tags : "";
+    const char *host_tags = cb->host_tags ? cb->host_tags : "";
     const char *meta_tsdb = "tsdb_tags";
 
     /* skip if value is NaN */
     if (value[0] == 'n')
         return 0;
 
@@ -432,13 +427,13 @@
             return status;
         } else {
             tags = temp;
         }
     }
 
-    message_len = ssnprintf (message,
+    status = ssnprintf (message,
                              sizeof(message),
                              "put %s %.0f %s fqdn=%s %s %s\r\n",
                              key,
                              CDTIME_T_TO_DOUBLE(time),
                              value,
                              host,
@@ -441,18 +436,20 @@
                              key,
                              CDTIME_T_TO_DOUBLE(time),
                              value,
                              host,
                              tags,
                              host_tags);
-
     sfree(temp);
+    if (status < 0)
+        return -1;
+    message_len = (size_t) status;
 
     if (message_len >= sizeof(message)) {
         ERROR("write_tsdb plugin: message buffer too small: "
-              "Need %d bytes.", message_len + 1);
+              "Need %zu bytes.", message_len + 1);
         return -1;
     }
 
     pthread_mutex_lock(&cb->send_lock);
 
     if (cb->sock_fd < 0)
@@ -502,22 +499,22 @@
 static int wt_write_messages(const data_set_t *ds, const value_list_t *vl,
                              struct wt_callback *cb)
 {
     char key[10*DATA_MAX_NAME_LEN];
     char values[512];
 
-    int status, i;
+    int status;
 
     if (0 != strcmp(ds->type, vl->type))
     {
         ERROR("write_tsdb plugin: DS type does not match "
               "value list type");
         return -1;
     }
 
-    for (i = 0; i < ds->ds_num; i++)
+    for (size_t i = 0; i < ds->ds_num; i++)
     {
         const char *ds_name = NULL;
 
         if (cb->always_append_ds || (ds->ds_num > 1))
             ds_name = ds->ds[i].name;
 
@@ -570,32 +567,29 @@
     return status;
 }
 
 static int wt_config_tsd(oconfig_item_t *ci)
 {
     struct wt_callback *cb;
-    user_data_t user_data;
     char callback_name[DATA_MAX_NAME_LEN];
-    int i;
 
-    cb = malloc(sizeof(*cb));
+    cb = calloc(1, sizeof(*cb));
     if (cb == NULL)
     {
-        ERROR("write_tsdb plugin: malloc failed.");
+        ERROR("write_tsdb plugin: calloc failed.");
         return -1;
     }
-    memset(cb, 0, sizeof(*cb));
     cb->sock_fd = -1;
     cb->node = NULL;
     cb->service = NULL;
     cb->host_tags = NULL;
     cb->store_rates = 0;
 
     pthread_mutex_init (&cb->send_lock, NULL);
 
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp("Host", child->key) == 0)
             cf_util_get_string(child, &cb->node);
         else if (strcasecmp("Port", child->key) == 0)
@@ -614,28 +608,28 @@
     }
 
     ssnprintf(callback_name, sizeof(callback_name), "write_tsdb/%s/%s",
               cb->node != NULL ? cb->node : WT_DEFAULT_NODE,
               cb->service != NULL ? cb->service : WT_DEFAULT_SERVICE);
 
-    memset(&user_data, 0, sizeof(user_data));
-    user_data.data = cb;
-    user_data.free_func = wt_callback_free;
+    user_data_t user_data = {
+        .data = cb,
+        .free_func = wt_callback_free
+    };
+
     plugin_register_write(callback_name, wt_write, &user_data);
 
     user_data.free_func = NULL;
     plugin_register_flush(callback_name, wt_flush, &user_data);
 
     return 0;
 }
 
 static int wt_config(oconfig_item_t *ci)
 {
-    int i;
-
-    for (i = 0; i < ci->children_num; i++)
+    for (int i = 0; i < ci->children_num; i++)
     {
         oconfig_item_t *child = ci->children + i;
 
         if (strcasecmp("Node", child->key) == 0)
             wt_config_tsd(child);
         else
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: xencpu.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/zfs_arc.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/zfs_arc.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/zfs_arc.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/zfs_arc.c	2016-09-11 16:10:25.279038699 +0800
@@ -38,36 +39,81 @@
 #if defined(KERNEL_LINUX)
 #include "utils_llist.h"
 #define ZOL_ARCSTATS_FILE "/proc/spl/kstat/zfs/arcstats"
 
 typedef	llist_t kstat_t;
 
-static long long get_zfs_value(kstat_t *zfs_stats  __attribute__((unused)),
-		char *name)
+static int put_zfs_value (kstat_t *ksp, char const *k, value_t v)
 {
 	llentry_t *e;
+	char *k_copy;
+	value_t *v_copy;
+
+	k_copy = strdup (k);
+	if (k_copy == NULL)
+		return ENOMEM;
+
+	v_copy = malloc (sizeof (*v_copy));
+	if (v_copy == NULL)
+	{
+		sfree (k_copy);
+		return ENOMEM;
+	}
+	*v_copy = v;
 
-	e = llist_search (zfs_stats, name);
+	e = llentry_create (k_copy, v_copy);
 	if (e == NULL)
 	{
-		ERROR ("zfs_arc plugin: `llist_search` failed for key: '%s'.", name);
+		sfree (v_copy);
+		sfree (k_copy);
+		return ENOMEM;
+	}
+
+	llist_append (ksp, e);
+	return 0;
+}
+
+static long long get_zfs_value(kstat_t *ksp, const char *key)
+{
+	llentry_t *e;
+	value_t *v;
+
+	e = llist_search (ksp, key);
+	if (e == NULL)
+	{
+		ERROR ("zfs_arc plugin: `llist_search` failed for key: '%s'.", key);
 		return (-1);
 	}
 
-	return (*(long long int*)e->value);
+	v = e->value;
+	return ((long long) v->derive);
+}
+
+static void free_zfs_values (kstat_t *ksp)
+{
+	if (ksp == NULL)
+		return;
+
+	for (llentry_t *e = llist_head (ksp); e != NULL; e = e->next)
+	{
+		sfree (e->key);
+		sfree (e->value);
+	}
+
+	llist_destroy (ksp);
 }
 
-#elif !defined(__FreeBSD__) // Solaris
+#elif defined(KERNEL_SOLARIS)
 extern kstat_ctl_t *kc;
 
 static long long get_zfs_value(kstat_t *ksp, char *name)
 {
 
 	return (get_kstat_value(ksp, name));
 }
-#else // FreeBSD
+#elif defined(KERNEL_FREEBSD)
 #include <sys/types.h>
 #include <sys/sysctl.h>
 
 const char zfs_arcstat[] = "kstat.zfs.misc.arcstats.";
 
 #if !defined(kstat_t)
@@ -169,119 +215,94 @@
 static int za_read (void)
 {
 	gauge_t  arc_hits, arc_misses, l2_hits, l2_misses;
 	value_t  l2_io[2];
 	kstat_t	 *ksp	= NULL;
 
-#if KERNEL_LINUX
-	long long int *llvalues = NULL;
-	char file_contents[1024 * 10];
-	char *fields[3];
-	int numfields;
-	ssize_t len;
+#if defined(KERNEL_LINUX)
+	FILE *fh;
+	char buffer[1024];
+
+	fh = fopen (ZOL_ARCSTATS_FILE, "r");
+	if (fh == NULL)
+	{
+		char errbuf[1024];
+		ERROR ("zfs_arc plugin: Opening \"%s\" failed: %s", ZOL_ARCSTATS_FILE,
+		       sstrerror (errno, errbuf, sizeof (errbuf)));
+		return (-1);
+	}
 
 	ksp = llist_create ();
 	if (ksp == NULL)
 	{
 		ERROR ("zfs_arc plugin: `llist_create' failed.");
+		fclose (fh);
 		return (-1);
 	}
 
-	len = read_file_contents (ZOL_ARCSTATS_FILE, file_contents, sizeof(file_contents) - 1);
-	if (len > 1)
+	while (fgets (buffer, sizeof (buffer), fh) != NULL)
 	{
+		char *fields[3];
+		value_t v;
+		int status;
+
+		status = strsplit (buffer, fields, STATIC_ARRAY_SIZE (fields));
+		if (status != 3)
+			continue;
+
+		status = parse_value (fields[2], &v, DS_TYPE_DERIVE);
+		if (status != 0)
+			continue;
 
-		int i=0;
-		char *pnl = file_contents;
-		char *pnnl;
-
-		file_contents[len] = '\0';
-
-		while (pnl != NULL)
-		{
-			pnl = strchr(pnl, '\n');
-			i++;
-			if (pnl && (*pnl != '\0'))
-				pnl++;
-		}
-
-		if (i > 0)
-		{
-			llentry_t *e;
-			llvalues = malloc(sizeof(long long int) * i);
-			if (llvalues == NULL)
-			{
-				ERROR ("zfs_arc plugin: `malloc' failed.");
-				llist_destroy (ksp);
-				return (-1);
-			}
-			int j = 0;
-
-			pnl = file_contents;
-			while (pnl != NULL)
-			{
-				pnnl = strchr(pnl, '\n');
-				if (pnnl != NULL)
-					*pnnl = '\0';
-
-				numfields = strsplit (pnl, fields, 4);
-				if (numfields == 3)
-				{
-					llvalues[j] = atoll (fields[2]);
-
-					e = llentry_create (fields[0], &llvalues[j]);
-					if (e == NULL)
-					{
-						ERROR ("zfs_arc plugin: `llentry_create' failed.");
-					}
-					else
-					{
-						llist_append (ksp, e);
-					}
-					j++;
-				}
-				pnl = pnnl;
-				if (pnl != NULL)
-					pnl ++;
-			}
-		}
+		put_zfs_value (ksp, fields[0], v);
 	}
 
-#elif !defined(__FreeBSD__) // Solaris
+	fclose (fh);
+
+#elif defined(KERNEL_SOLARIS)
 	get_kstat (&ksp, "zfs", 0, "arcstats");
 	if (ksp == NULL)
 	{
 		ERROR ("zfs_arc plugin: Cannot find zfs:0:arcstats kstat.");
 		return (-1);
 	}
 #endif
 
 	/* Sizes */
-	za_read_gauge (ksp, "size",    "cache_size", "arc");
+	za_read_gauge (ksp, "anon_size",      "cache_size", "anon_size");
+	za_read_gauge (ksp, "c",              "cache_size", "c");
+	za_read_gauge (ksp, "c_max",          "cache_size", "c_max");
+	za_read_gauge (ksp, "c_min",          "cache_size", "c_min");
+	za_read_gauge (ksp, "hdr_size",       "cache_size", "hdr_size");
+	za_read_gauge (ksp, "metadata_size",  "cache_size", "metadata_size");
+	za_read_gauge (ksp, "mfu_ghost_size", "cache_size", "mfu_ghost_size");
+	za_read_gauge (ksp, "mfu_size",       "cache_size", "mfu_size");
+	za_read_gauge (ksp, "mru_ghost_size", "cache_size", "mru_ghost_size");
+	za_read_gauge (ksp, "mru_size",       "cache_size", "mru_size");
+	za_read_gauge (ksp, "other_size",     "cache_size", "other_size");
+	za_read_gauge (ksp, "p",              "cache_size", "p");
+	za_read_gauge (ksp, "size",           "cache_size", "arc");
 
 	/* The "l2_size" value has disappeared from Solaris some time in
 	 * early 2013, and has only reappeared recently in Solaris 11.2.
 	 * Stop trying if we ever fail to read it, so we don't spam the log.
 	 */
 	static int l2_size_avail = 1;
 	if (l2_size_avail && za_read_gauge (ksp, "l2_size", "cache_size", "L2") != 0)
 		l2_size_avail = 0;
 
 	/* Operations */
 	za_read_derive (ksp, "deleted",  "cache_operation", "deleted");
-#if __FreeBSD__
+#if defined(KERNEL_FREEBSD)
 	za_read_derive (ksp, "allocated","cache_operation", "allocated");
-#if defined(__FreeBSD_version) && (__FreeBSD_version < 1002501)
-	/* stolen removed from sysctl kstat.zfs.misc.arcstats on FreeBSD 10.2+ */
-	za_read_derive (ksp, "stolen",   "cache_operation", "stolen");
-#endif
 #endif
 
 	/* Issue indicators */
 	za_read_derive (ksp, "mutex_miss", "mutex_operations", "miss");
 	za_read_derive (ksp, "hash_collisions", "hash_collisions", "");
+	za_read_derive (ksp, "memory_throttle_count", "memory_throttle_count", "");
 
 	/* Evictions */
 	za_read_derive (ksp, "evict_l2_cached",     "cache_eviction", "cached");
 	za_read_derive (ksp, "evict_l2_eligible",   "cache_eviction", "eligible");
 	za_read_derive (ksp, "evict_l2_ineligible", "cache_eviction", "ineligible");
 
@@ -291,12 +312,17 @@
 	za_read_derive (ksp, "prefetch_data_hits",       "cache_result", "prefetch_data-hit");
 	za_read_derive (ksp, "prefetch_metadata_hits",   "cache_result", "prefetch_metadata-hit");
 	za_read_derive (ksp, "demand_data_misses",       "cache_result", "demand_data-miss");
 	za_read_derive (ksp, "demand_metadata_misses",   "cache_result", "demand_metadata-miss");
 	za_read_derive (ksp, "prefetch_data_misses",     "cache_result", "prefetch_data-miss");
 	za_read_derive (ksp, "prefetch_metadata_misses", "cache_result", "prefetch_metadata-miss");
+	za_read_derive (ksp, "mfu_hits",                 "cache_result", "mfu-hit");
+	za_read_derive (ksp, "mfu_ghost_hits",           "cache_result", "mfu_ghost-hit");
+	za_read_derive (ksp, "mru_hits",                 "cache_result", "mru-hit");
+	za_read_derive (ksp, "mru_ghost_hits",           "cache_result", "mru_ghost-hit");
+	za_read_derive (ksp, "prefetch_metadata_misses", "cache_result", "prefetch_metadata-miss");
 
 	/* Ratios */
 	arc_hits   = (gauge_t) get_zfs_value(ksp, "hits");
 	arc_misses = (gauge_t) get_zfs_value(ksp, "misses");
 	l2_hits    = (gauge_t) get_zfs_value(ksp, "l2_hits");
 	l2_misses  = (gauge_t) get_zfs_value(ksp, "l2_misses");
@@ -308,28 +334,21 @@
 	l2_io[0].derive = get_zfs_value(ksp, "l2_read_bytes");
 	l2_io[1].derive = get_zfs_value(ksp, "l2_write_bytes");
 
 	za_submit ("io_octets", "L2", l2_io, /* num values = */ 2);
 
 #if defined(KERNEL_LINUX)
-	if (llvalues != NULL)
-	{
-		free(llvalues);
-	}
-	if (ksp != NULL)
-	{
-		llist_destroy (ksp);
-	}
+	free_zfs_values (ksp);
 #endif
 
 	return (0);
 } /* int za_read */
 
 static int za_init (void) /* {{{ */
 {
-#if !defined(__FreeBSD__) && !defined(KERNEL_LINUX) // Solaris
+#if defined(KERNEL_SOLARIS)
 	/* kstats chain already opened by update_kstat (using *kc), verify everything went fine. */
 	if (kc == NULL)
 	{
 		ERROR ("zfs_arc plugin: kstat chain control structure not available.");
 		return (-1);
 	}
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src: zone.c
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/zookeeper.c /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/zookeeper.c
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/src/zookeeper.c	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/src/zookeeper.c	2016-09-11 16:10:25.279038699 +0800
@@ -22,17 +22,17 @@
  *
  * Authors:
  *   Jeremy Katz <jeremy at katzbox.net>
  **/
 
 #include "collectd.h"
+
 #include "common.h"
 #include "plugin.h"
 
 #include <netdb.h>
-#include <sys/socket.h>
 #include <sys/un.h>
 #include <netinet/in.h>
 #include <netinet/tcp.h>
 
 #define ZOOKEEPER_DEF_HOST "127.0.0.1"
 #define ZOOKEEPER_DEF_PORT "2181"
@@ -103,36 +103,36 @@
 } /* zookeeper_submit_derive */
 
 static int zookeeper_connect (void)
 {
 	int sk = -1;
 	int status;
-	struct addrinfo ai_hints;
-	struct addrinfo *ai;
 	struct addrinfo *ai_list;
-	char *host;
-	char *port;
-
-	memset ((void *) &ai_hints, '\0', sizeof (ai_hints));
-	ai_hints.ai_family   = AF_UNSPEC;
-	ai_hints.ai_socktype = SOCK_STREAM;
+	const char *host;
+	const char *port;
 
 	host = (zk_host != NULL) ? zk_host : ZOOKEEPER_DEF_HOST;
 	port = (zk_port != NULL) ? zk_port : ZOOKEEPER_DEF_PORT;
+
+	struct addrinfo ai_hints = {
+		.ai_family   = AF_UNSPEC,
+		.ai_socktype = SOCK_STREAM
+	};
+
 	status = getaddrinfo (host, port, &ai_hints, &ai_list);
 	if (status != 0)
 	{
 		char errbuf[1024];
 		INFO ("getaddrinfo failed: %s",
 			  (status == EAI_SYSTEM)
 			  ? sstrerror (errno, errbuf, sizeof (errbuf))
 			  : gai_strerror (status));
 		return (-1);
 	}
 
-	for (ai = ai_list; ai != NULL; ai = ai->ai_next)
+	for (struct addrinfo *ai = ai_list; ai != NULL; ai = ai->ai_next)
 	{
 		sk = socket (ai->ai_family, SOCK_STREAM, 0);
 		if (sk < 0)
 		{
 			char errbuf[1024];
 			WARNING ("zookeeper: socket(2) failed: %s",
@@ -157,14 +157,13 @@
 	freeaddrinfo(ai_list);
 	return (sk);
 } /* int zookeeper_connect */
 
 static int zookeeper_query (char *buffer, size_t buffer_size)
 {
-	int sk = -1;
-	int status;
+	int sk, status;
 	size_t buffer_fill;
 
 	sk = zookeeper_connect();
 	if (sk < 0)
 	{
 		ERROR ("zookeeper: Could not connect to daemon");
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0: testwrapper.sh
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/version-gen.sh /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/version-gen.sh
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.5.3/version-gen.sh	2016-11-29 00:08:22.431470717 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/collectd/repos/collectd-5.6.0/version-gen.sh	2016-09-11 16:10:25.279038699 +0800
@@ -1,13 +1,13 @@
 #!/bin/sh
 
-DEFAULT_VERSION="5.5.3.git"
+DEFAULT_VERSION="5.6.0.git"
 
-VERSION="`git describe 2> /dev/null | grep collectd | sed -e 's/^collectd-//'`"
+if [ -d .git ]; then
+	VERSION="`git describe --dirty=+ --abbrev=7 2> /dev/null | grep collectd | sed -e 's/^collectd-//' -e 's/-/./g'`"
+fi
 
 if test -z "$VERSION"; then
 	VERSION="$DEFAULT_VERSION"
 fi
 
-VERSION="`echo \"$VERSION\" | sed -e 's/-/./g'`"
-
 printf "%s" "$VERSION"
