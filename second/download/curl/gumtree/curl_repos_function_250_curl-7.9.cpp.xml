<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="0.9.5" language="C++" filename="usr/info/code/cpp/LogMonitor/LogMonitor/second/download/curl/gumtree/curl_repos_function_250_curl-7.9.cpp" pos:tabs="8"><function><type><name pos:line="1" pos:column="1">CURLcode<pos:position pos:line="1" pos:column="9"/></name></type> <name pos:line="1" pos:column="10">Curl_file<pos:position pos:line="1" pos:column="19"/></name><parameter_list pos:line="1" pos:column="19">(<parameter><decl><type><name><name pos:line="1" pos:column="20">struct<pos:position pos:line="1" pos:column="26"/></name> <name pos:line="1" pos:column="27">connectdata<pos:position pos:line="1" pos:column="38"/></name></name> <modifier pos:line="1" pos:column="39">*<pos:position pos:line="1" pos:column="40"/></modifier></type><name pos:line="1" pos:column="40">conn<pos:position pos:line="1" pos:column="44"/></name></decl></parameter>)<pos:position pos:line="1" pos:column="45"/></parameter_list>
<block pos:line="2" pos:column="1">{
  <comment type="block" pos:line="3" pos:column="3">/* This implementation ignores the host name in conformance with 
     RFC 1738. Only local files (reachable via the standard file system)
     are supported. This means that files on remotely mounted directories
     (via NFS, Samba, NT sharing) can be accessed through a file:// URL
  */</comment>
  <decl_stmt><decl><type><name pos:line="8" pos:column="3">CURLcode<pos:position pos:line="8" pos:column="11"/></name></type> <name pos:line="8" pos:column="12">res<pos:position pos:line="8" pos:column="15"/></name> <init pos:line="8" pos:column="16">= <expr><name pos:line="8" pos:column="18">CURLE_OK<pos:position pos:line="8" pos:column="26"/></name></expr></init></decl>;<pos:position pos:line="8" pos:column="27"/></decl_stmt>
  <decl_stmt><decl><type><name><name pos:line="9" pos:column="3">struct<pos:position pos:line="9" pos:column="9"/></name> <name pos:line="9" pos:column="10">stat<pos:position pos:line="9" pos:column="14"/></name></name></type> <name pos:line="9" pos:column="15">statbuf<pos:position pos:line="9" pos:column="22"/></name></decl>;<pos:position pos:line="9" pos:column="23"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="10" pos:column="3">ssize_t<pos:position pos:line="10" pos:column="10"/></name></type> <name pos:line="10" pos:column="11">expected_size<pos:position pos:line="10" pos:column="24"/></name><init pos:line="10" pos:column="24">=<expr><operator pos:line="10" pos:column="25">-<pos:position pos:line="10" pos:column="26"/></operator><literal type="number" pos:line="10" pos:column="26">1<pos:position pos:line="10" pos:column="27"/></literal></expr></init></decl>;<pos:position pos:line="10" pos:column="28"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="11" pos:column="3">ssize_t<pos:position pos:line="11" pos:column="10"/></name></type> <name pos:line="11" pos:column="11">nread<pos:position pos:line="11" pos:column="16"/></name></decl>;<pos:position pos:line="11" pos:column="17"/></decl_stmt>
  <decl_stmt><decl><type><name><name pos:line="12" pos:column="3">struct<pos:position pos:line="12" pos:column="9"/></name> <name pos:line="12" pos:column="10">SessionHandle<pos:position pos:line="12" pos:column="23"/></name></name> <modifier pos:line="12" pos:column="24">*<pos:position pos:line="12" pos:column="25"/></modifier></type><name pos:line="12" pos:column="25">data<pos:position pos:line="12" pos:column="29"/></name> <init pos:line="12" pos:column="30">= <expr><name><name pos:line="12" pos:column="32">conn<pos:position pos:line="12" pos:column="36"/></name><operator pos:line="12" pos:column="36">-&gt;<pos:position pos:line="12" pos:column="41"/></operator><name pos:line="12" pos:column="38">data<pos:position pos:line="12" pos:column="42"/></name></name></expr></init></decl>;<pos:position pos:line="12" pos:column="43"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="13" pos:column="3">char<pos:position pos:line="13" pos:column="7"/></name> <modifier pos:line="13" pos:column="8">*<pos:position pos:line="13" pos:column="9"/></modifier></type><name pos:line="13" pos:column="9">buf<pos:position pos:line="13" pos:column="12"/></name> <init pos:line="13" pos:column="13">= <expr><name><name pos:line="13" pos:column="15">data<pos:position pos:line="13" pos:column="19"/></name><operator pos:line="13" pos:column="19">-&gt;<pos:position pos:line="13" pos:column="24"/></operator><name pos:line="13" pos:column="21">state<pos:position pos:line="13" pos:column="26"/></name><operator pos:line="13" pos:column="26">.<pos:position pos:line="13" pos:column="27"/></operator><name pos:line="13" pos:column="27">buffer<pos:position pos:line="13" pos:column="33"/></name></name></expr></init></decl>;<pos:position pos:line="13" pos:column="34"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="14" pos:column="3">int<pos:position pos:line="14" pos:column="6"/></name></type> <name pos:line="14" pos:column="7">bytecount<pos:position pos:line="14" pos:column="16"/></name> <init pos:line="14" pos:column="17">= <expr><literal type="number" pos:line="14" pos:column="19">0<pos:position pos:line="14" pos:column="20"/></literal></expr></init></decl>;<pos:position pos:line="14" pos:column="21"/></decl_stmt>
  <decl_stmt><decl><type><name><name pos:line="15" pos:column="3">struct<pos:position pos:line="15" pos:column="9"/></name> <name pos:line="15" pos:column="10">timeval<pos:position pos:line="15" pos:column="17"/></name></name></type> <name pos:line="15" pos:column="18">start<pos:position pos:line="15" pos:column="23"/></name> <init pos:line="15" pos:column="24">= <expr><call><name pos:line="15" pos:column="26">Curl_tvnow<pos:position pos:line="15" pos:column="36"/></name><argument_list pos:line="15" pos:column="36">()<pos:position pos:line="15" pos:column="38"/></argument_list></call></expr></init></decl>;<pos:position pos:line="15" pos:column="39"/></decl_stmt>
  <decl_stmt><decl><type><name><name pos:line="16" pos:column="3">struct<pos:position pos:line="16" pos:column="9"/></name> <name pos:line="16" pos:column="10">timeval<pos:position pos:line="16" pos:column="17"/></name></name></type> <name pos:line="16" pos:column="18">now<pos:position pos:line="16" pos:column="21"/></name> <init pos:line="16" pos:column="22">= <expr><name pos:line="16" pos:column="24">start<pos:position pos:line="16" pos:column="29"/></name></expr></init></decl>;<pos:position pos:line="16" pos:column="30"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="17" pos:column="3">int<pos:position pos:line="17" pos:column="6"/></name></type> <name pos:line="17" pos:column="7">fd<pos:position pos:line="17" pos:column="9"/></name></decl>;<pos:position pos:line="17" pos:column="10"/></decl_stmt>

  <comment type="block" pos:line="19" pos:column="3">/* get the fd from the connection phase */</comment>
  <expr_stmt><expr><name pos:line="20" pos:column="3">fd<pos:position pos:line="20" pos:column="5"/></name> <operator pos:line="20" pos:column="6">=<pos:position pos:line="20" pos:column="7"/></operator> <name><name pos:line="20" pos:column="8">conn<pos:position pos:line="20" pos:column="12"/></name><operator pos:line="20" pos:column="12">-&gt;<pos:position pos:line="20" pos:column="17"/></operator><name pos:line="20" pos:column="14">proto<pos:position pos:line="20" pos:column="19"/></name><operator pos:line="20" pos:column="19">.<pos:position pos:line="20" pos:column="20"/></operator><name pos:line="20" pos:column="20">file<pos:position pos:line="20" pos:column="24"/></name><operator pos:line="20" pos:column="24">-&gt;<pos:position pos:line="20" pos:column="29"/></operator><name pos:line="20" pos:column="26">fd<pos:position pos:line="20" pos:column="28"/></name></name></expr>;<pos:position pos:line="20" pos:column="29"/></expr_stmt>

<comment type="block" pos:line="22" pos:column="1">/*VMS?? -- This only works reliable for STREAMLF files */</comment>
  <if pos:line="23" pos:column="3">if<condition pos:line="23" pos:column="5">( <expr><operator pos:line="23" pos:column="7">-<pos:position pos:line="23" pos:column="8"/></operator><literal type="number" pos:line="23" pos:column="8">1<pos:position pos:line="23" pos:column="9"/></literal> <operator pos:line="23" pos:column="10">!=<pos:position pos:line="23" pos:column="12"/></operator> <call><name pos:line="23" pos:column="13">fstat<pos:position pos:line="23" pos:column="18"/></name><argument_list pos:line="23" pos:column="18">(<argument><expr><name pos:line="23" pos:column="19">fd<pos:position pos:line="23" pos:column="21"/></name></expr></argument>, <argument><expr><operator pos:line="23" pos:column="23">&amp;<pos:position pos:line="23" pos:column="28"/></operator><name pos:line="23" pos:column="24">statbuf<pos:position pos:line="23" pos:column="31"/></name></expr></argument>)<pos:position pos:line="23" pos:column="32"/></argument_list></call></expr>)<pos:position pos:line="23" pos:column="33"/></condition><then pos:line="23" pos:column="33"> <block pos:line="23" pos:column="34">{
    <comment type="block" pos:line="24" pos:column="5">/* we could stat it, then read out the size */</comment>
    <expr_stmt><expr><name pos:line="25" pos:column="5">expected_size<pos:position pos:line="25" pos:column="18"/></name> <operator pos:line="25" pos:column="19">=<pos:position pos:line="25" pos:column="20"/></operator> <name><name pos:line="25" pos:column="21">statbuf<pos:position pos:line="25" pos:column="28"/></name><operator pos:line="25" pos:column="28">.<pos:position pos:line="25" pos:column="29"/></operator><name pos:line="25" pos:column="29">st_size<pos:position pos:line="25" pos:column="36"/></name></name></expr>;<pos:position pos:line="25" pos:column="37"/></expr_stmt>
  }<pos:position pos:line="26" pos:column="4"/></block></then></if>

  <comment type="block" pos:line="28" pos:column="3">/* The following is a shortcut implementation of file reading
     this is both more efficient than the former call to download() and
     it avoids problems with select() and recv() on file descriptors
     in Winsock */</comment>
  <if pos:line="32" pos:column="3">if<condition pos:line="32" pos:column="5">(<expr><name pos:line="32" pos:column="6">expected_size<pos:position pos:line="32" pos:column="19"/></name> <operator pos:line="32" pos:column="20">!=<pos:position pos:line="32" pos:column="22"/></operator> <operator pos:line="32" pos:column="23">-<pos:position pos:line="32" pos:column="24"/></operator><literal type="number" pos:line="32" pos:column="24">1<pos:position pos:line="32" pos:column="25"/></literal></expr>)<pos:position pos:line="32" pos:column="26"/></condition><then pos:line="32" pos:column="26">
    <block type="pseudo"><expr_stmt><expr><call><name pos:line="33" pos:column="5">Curl_pgrsSetDownloadSize<pos:position pos:line="33" pos:column="29"/></name><argument_list pos:line="33" pos:column="29">(<argument><expr><name pos:line="33" pos:column="30">data<pos:position pos:line="33" pos:column="34"/></name></expr></argument>, <argument><expr><name pos:line="33" pos:column="36">expected_size<pos:position pos:line="33" pos:column="49"/></name></expr></argument>)<pos:position pos:line="33" pos:column="50"/></argument_list></call></expr>;<pos:position pos:line="33" pos:column="51"/></expr_stmt></block></then></if>

  <while pos:line="35" pos:column="3">while <condition pos:line="35" pos:column="9">(<expr><name pos:line="35" pos:column="10">res<pos:position pos:line="35" pos:column="13"/></name> <operator pos:line="35" pos:column="14">==<pos:position pos:line="35" pos:column="16"/></operator> <name pos:line="35" pos:column="17">CURLE_OK<pos:position pos:line="35" pos:column="25"/></name></expr>)<pos:position pos:line="35" pos:column="26"/></condition> <block pos:line="35" pos:column="27">{
    <expr_stmt><expr><name pos:line="36" pos:column="5">nread<pos:position pos:line="36" pos:column="10"/></name> <operator pos:line="36" pos:column="11">=<pos:position pos:line="36" pos:column="12"/></operator> <call><name pos:line="36" pos:column="13">read<pos:position pos:line="36" pos:column="17"/></name><argument_list pos:line="36" pos:column="17">(<argument><expr><name pos:line="36" pos:column="18">fd<pos:position pos:line="36" pos:column="20"/></name></expr></argument>, <argument><expr><name pos:line="36" pos:column="22">buf<pos:position pos:line="36" pos:column="25"/></name></expr></argument>, <argument><expr><name pos:line="36" pos:column="27">BUFSIZE<pos:position pos:line="36" pos:column="34"/></name><operator pos:line="36" pos:column="34">-<pos:position pos:line="36" pos:column="35"/></operator><literal type="number" pos:line="36" pos:column="35">1<pos:position pos:line="36" pos:column="36"/></literal></expr></argument>)<pos:position pos:line="36" pos:column="37"/></argument_list></call></expr>;<pos:position pos:line="36" pos:column="38"/></expr_stmt>

    <if pos:line="38" pos:column="5">if <condition pos:line="38" pos:column="8">( <expr><name pos:line="38" pos:column="10">nread<pos:position pos:line="38" pos:column="15"/></name> <operator pos:line="38" pos:column="16">&gt;<pos:position pos:line="38" pos:column="20"/></operator> <literal type="number" pos:line="38" pos:column="18">0<pos:position pos:line="38" pos:column="19"/></literal></expr>)<pos:position pos:line="38" pos:column="20"/></condition><then pos:line="38" pos:column="20">
      <block type="pseudo"><expr_stmt><expr><name><name pos:line="39" pos:column="7">buf<pos:position pos:line="39" pos:column="10"/></name><index pos:line="39" pos:column="10">[<expr><name pos:line="39" pos:column="11">nread<pos:position pos:line="39" pos:column="16"/></name></expr>]<pos:position pos:line="39" pos:column="17"/></index></name> <operator pos:line="39" pos:column="18">=<pos:position pos:line="39" pos:column="19"/></operator> <literal type="number" pos:line="39" pos:column="20">0<pos:position pos:line="39" pos:column="21"/></literal></expr>;<pos:position pos:line="39" pos:column="22"/></expr_stmt></block></then></if>

    <if pos:line="41" pos:column="5">if <condition pos:line="41" pos:column="8">(<expr><name pos:line="41" pos:column="9">nread<pos:position pos:line="41" pos:column="14"/></name> <operator pos:line="41" pos:column="15">&lt;=<pos:position pos:line="41" pos:column="20"/></operator> <literal type="number" pos:line="41" pos:column="18">0<pos:position pos:line="41" pos:column="19"/></literal></expr>)<pos:position pos:line="41" pos:column="20"/></condition><then pos:line="41" pos:column="20">
      <block type="pseudo"><break pos:line="42" pos:column="7">break;<pos:position pos:line="42" pos:column="13"/></break></block></then></if>

    <expr_stmt><expr><name pos:line="44" pos:column="5">bytecount<pos:position pos:line="44" pos:column="14"/></name> <operator pos:line="44" pos:column="15">+=<pos:position pos:line="44" pos:column="17"/></operator> <name pos:line="44" pos:column="18">nread<pos:position pos:line="44" pos:column="23"/></name></expr>;<pos:position pos:line="44" pos:column="24"/></expr_stmt>
    <comment type="block" pos:line="45" pos:column="5">/* NOTE: The following call to fwrite does CR/LF translation on
       Windows systems if the target is stdout. Use -O or -o parameters
       to prevent CR/LF translation (this then goes to a binary mode
       file descriptor). */</comment>

    <expr_stmt><expr><name pos:line="50" pos:column="5">res<pos:position pos:line="50" pos:column="8"/></name> <operator pos:line="50" pos:column="9">=<pos:position pos:line="50" pos:column="10"/></operator> <call><name pos:line="50" pos:column="11">Curl_client_write<pos:position pos:line="50" pos:column="28"/></name><argument_list pos:line="50" pos:column="28">(<argument><expr><name pos:line="50" pos:column="29">data<pos:position pos:line="50" pos:column="33"/></name></expr></argument>, <argument><expr><name pos:line="50" pos:column="35">CLIENTWRITE_BODY<pos:position pos:line="50" pos:column="51"/></name></expr></argument>, <argument><expr><name pos:line="50" pos:column="53">buf<pos:position pos:line="50" pos:column="56"/></name></expr></argument>, <argument><expr><name pos:line="50" pos:column="58">nread<pos:position pos:line="50" pos:column="63"/></name></expr></argument>)<pos:position pos:line="50" pos:column="64"/></argument_list></call></expr>;<pos:position pos:line="50" pos:column="65"/></expr_stmt>
    <if pos:line="51" pos:column="5">if<condition pos:line="51" pos:column="7">(<expr><name pos:line="51" pos:column="8">res<pos:position pos:line="51" pos:column="11"/></name></expr>)<pos:position pos:line="51" pos:column="12"/></condition><then pos:line="51" pos:column="12">
      <block type="pseudo"><return pos:line="52" pos:column="7">return <expr><name pos:line="52" pos:column="14">res<pos:position pos:line="52" pos:column="17"/></name></expr>;<pos:position pos:line="52" pos:column="18"/></return></block></then></if>

    <expr_stmt><expr><name pos:line="54" pos:column="5">now<pos:position pos:line="54" pos:column="8"/></name> <operator pos:line="54" pos:column="9">=<pos:position pos:line="54" pos:column="10"/></operator> <call><name pos:line="54" pos:column="11">Curl_tvnow<pos:position pos:line="54" pos:column="21"/></name><argument_list pos:line="54" pos:column="21">()<pos:position pos:line="54" pos:column="23"/></argument_list></call></expr>;<pos:position pos:line="54" pos:column="24"/></expr_stmt>
    <if pos:line="55" pos:column="5">if<condition pos:line="55" pos:column="7">(<expr><call><name pos:line="55" pos:column="8">Curl_pgrsUpdate<pos:position pos:line="55" pos:column="23"/></name><argument_list pos:line="55" pos:column="23">(<argument><expr><name pos:line="55" pos:column="24">conn<pos:position pos:line="55" pos:column="28"/></name></expr></argument>)<pos:position pos:line="55" pos:column="29"/></argument_list></call></expr>)<pos:position pos:line="55" pos:column="30"/></condition><then pos:line="55" pos:column="30">
      <block type="pseudo"><expr_stmt><expr><name pos:line="56" pos:column="7">res<pos:position pos:line="56" pos:column="10"/></name> <operator pos:line="56" pos:column="11">=<pos:position pos:line="56" pos:column="12"/></operator> <name pos:line="56" pos:column="13">CURLE_ABORTED_BY_CALLBACK<pos:position pos:line="56" pos:column="38"/></name></expr>;<pos:position pos:line="56" pos:column="39"/></expr_stmt></block></then></if>
  }<pos:position pos:line="57" pos:column="4"/></block></while>
  <expr_stmt><expr><name pos:line="58" pos:column="3">now<pos:position pos:line="58" pos:column="6"/></name> <operator pos:line="58" pos:column="7">=<pos:position pos:line="58" pos:column="8"/></operator> <call><name pos:line="58" pos:column="9">Curl_tvnow<pos:position pos:line="58" pos:column="19"/></name><argument_list pos:line="58" pos:column="19">()<pos:position pos:line="58" pos:column="21"/></argument_list></call></expr>;<pos:position pos:line="58" pos:column="22"/></expr_stmt>
  <if pos:line="59" pos:column="3">if<condition pos:line="59" pos:column="5">(<expr><call><name pos:line="59" pos:column="6">Curl_pgrsUpdate<pos:position pos:line="59" pos:column="21"/></name><argument_list pos:line="59" pos:column="21">(<argument><expr><name pos:line="59" pos:column="22">conn<pos:position pos:line="59" pos:column="26"/></name></expr></argument>)<pos:position pos:line="59" pos:column="27"/></argument_list></call></expr>)<pos:position pos:line="59" pos:column="28"/></condition><then pos:line="59" pos:column="28">
    <block type="pseudo"><expr_stmt><expr><name pos:line="60" pos:column="5">res<pos:position pos:line="60" pos:column="8"/></name> <operator pos:line="60" pos:column="9">=<pos:position pos:line="60" pos:column="10"/></operator> <name pos:line="60" pos:column="11">CURLE_ABORTED_BY_CALLBACK<pos:position pos:line="60" pos:column="36"/></name></expr>;<pos:position pos:line="60" pos:column="37"/></expr_stmt></block></then></if>

  <expr_stmt><expr><call><name pos:line="62" pos:column="3">close<pos:position pos:line="62" pos:column="8"/></name><argument_list pos:line="62" pos:column="8">(<argument><expr><name pos:line="62" pos:column="9">fd<pos:position pos:line="62" pos:column="11"/></name></expr></argument>)<pos:position pos:line="62" pos:column="12"/></argument_list></call></expr>;<pos:position pos:line="62" pos:column="13"/></expr_stmt>

  <return pos:line="64" pos:column="3">return <expr><name pos:line="64" pos:column="10">res<pos:position pos:line="64" pos:column="13"/></name></expr>;<pos:position pos:line="64" pos:column="14"/></return>
}<pos:position pos:line="65" pos:column="2"/></block></function></unit>
