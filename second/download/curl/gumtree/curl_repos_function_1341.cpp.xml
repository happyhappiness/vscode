<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="0.9.5" language="C++" filename="usr/info/code/cpp/LogMonitor/LogMonitor/second/download/curl/gumtree/curl_repos_function_1341.cpp" pos:tabs="8"><function><specifier pos:line="1" pos:column="1">static<pos:position pos:line="1" pos:column="7"/></specifier> <type><name pos:line="1" pos:column="8">CURLcode<pos:position pos:line="1" pos:column="16"/></name></type> <name pos:line="1" pos:column="17">parseurlandfillconn<pos:position pos:line="1" pos:column="36"/></name><parameter_list pos:line="1" pos:column="36">(<parameter><decl><type><name><name pos:line="1" pos:column="37">struct<pos:position pos:line="1" pos:column="43"/></name> <name pos:line="1" pos:column="44">SessionHandle<pos:position pos:line="1" pos:column="57"/></name></name> <modifier pos:line="1" pos:column="58">*<pos:position pos:line="1" pos:column="59"/></modifier></type><name pos:line="1" pos:column="59">data<pos:position pos:line="1" pos:column="63"/></name></decl></parameter>,
                                    <parameter><decl><type><name><name pos:line="2" pos:column="37">struct<pos:position pos:line="2" pos:column="43"/></name> <name pos:line="2" pos:column="44">connectdata<pos:position pos:line="2" pos:column="55"/></name></name> <modifier pos:line="2" pos:column="56">*<pos:position pos:line="2" pos:column="57"/></modifier></type><name pos:line="2" pos:column="57">conn<pos:position pos:line="2" pos:column="61"/></name></decl></parameter>,
                                    <parameter><decl><type><name pos:line="3" pos:column="37">bool<pos:position pos:line="3" pos:column="41"/></name> <modifier pos:line="3" pos:column="42">*<pos:position pos:line="3" pos:column="43"/></modifier></type><name pos:line="3" pos:column="43">prot_missing<pos:position pos:line="3" pos:column="55"/></name></decl></parameter>,
                                    <parameter><decl><type><name pos:line="4" pos:column="37">char<pos:position pos:line="4" pos:column="41"/></name> <modifier pos:line="4" pos:column="42">*<pos:position pos:line="4" pos:column="43"/></modifier><modifier pos:line="4" pos:column="43">*<pos:position pos:line="4" pos:column="44"/></modifier></type><name pos:line="4" pos:column="44">userp<pos:position pos:line="4" pos:column="49"/></name></decl></parameter>, <parameter><decl><type><name pos:line="4" pos:column="51">char<pos:position pos:line="4" pos:column="55"/></name> <modifier pos:line="4" pos:column="56">*<pos:position pos:line="4" pos:column="57"/></modifier><modifier pos:line="4" pos:column="57">*<pos:position pos:line="4" pos:column="58"/></modifier></type><name pos:line="4" pos:column="58">passwdp<pos:position pos:line="4" pos:column="65"/></name></decl></parameter>,
                                    <parameter><decl><type><name pos:line="5" pos:column="37">char<pos:position pos:line="5" pos:column="41"/></name> <modifier pos:line="5" pos:column="42">*<pos:position pos:line="5" pos:column="43"/></modifier><modifier pos:line="5" pos:column="43">*<pos:position pos:line="5" pos:column="44"/></modifier></type><name pos:line="5" pos:column="44">optionsp<pos:position pos:line="5" pos:column="52"/></name></decl></parameter>)<pos:position pos:line="5" pos:column="53"/></parameter_list>
<block pos:line="6" pos:column="1">{
  <decl_stmt><decl><type><name pos:line="7" pos:column="3">char<pos:position pos:line="7" pos:column="7"/></name> <modifier pos:line="7" pos:column="8">*<pos:position pos:line="7" pos:column="9"/></modifier></type><name pos:line="7" pos:column="9">at<pos:position pos:line="7" pos:column="11"/></name></decl>;<pos:position pos:line="7" pos:column="12"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="8" pos:column="3">char<pos:position pos:line="8" pos:column="7"/></name> <modifier pos:line="8" pos:column="8">*<pos:position pos:line="8" pos:column="9"/></modifier></type><name pos:line="8" pos:column="9">fragment<pos:position pos:line="8" pos:column="17"/></name></decl>;<pos:position pos:line="8" pos:column="18"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="9" pos:column="3">char<pos:position pos:line="9" pos:column="7"/></name> <modifier pos:line="9" pos:column="8">*<pos:position pos:line="9" pos:column="9"/></modifier></type><name pos:line="9" pos:column="9">path<pos:position pos:line="9" pos:column="13"/></name> <init pos:line="9" pos:column="14">= <expr><name><name pos:line="9" pos:column="16">data<pos:position pos:line="9" pos:column="20"/></name><operator pos:line="9" pos:column="20">-&gt;<pos:position pos:line="9" pos:column="25"/></operator><name pos:line="9" pos:column="22">state<pos:position pos:line="9" pos:column="27"/></name><operator pos:line="9" pos:column="27">.<pos:position pos:line="9" pos:column="28"/></operator><name pos:line="9" pos:column="28">path<pos:position pos:line="9" pos:column="32"/></name></name></expr></init></decl>;<pos:position pos:line="9" pos:column="33"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="10" pos:column="3">char<pos:position pos:line="10" pos:column="7"/></name> <modifier pos:line="10" pos:column="8">*<pos:position pos:line="10" pos:column="9"/></modifier></type><name pos:line="10" pos:column="9">query<pos:position pos:line="10" pos:column="14"/></name></decl>;<pos:position pos:line="10" pos:column="15"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="11" pos:column="3">int<pos:position pos:line="11" pos:column="6"/></name></type> <name pos:line="11" pos:column="7">rc<pos:position pos:line="11" pos:column="9"/></name></decl>;<pos:position pos:line="11" pos:column="10"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="12" pos:column="3">char<pos:position pos:line="12" pos:column="7"/></name></type> <name><name pos:line="12" pos:column="8">protobuf<pos:position pos:line="12" pos:column="16"/></name><index pos:line="12" pos:column="16">[<expr><literal type="number" pos:line="12" pos:column="17">16<pos:position pos:line="12" pos:column="19"/></literal></expr>]<pos:position pos:line="12" pos:column="20"/></index></name> <init pos:line="12" pos:column="21">= <expr><literal type="string" pos:line="12" pos:column="23">""<pos:position pos:line="12" pos:column="25"/></literal></expr></init></decl>;<pos:position pos:line="12" pos:column="26"/></decl_stmt>
  <decl_stmt><decl><type><specifier pos:line="13" pos:column="3">const<pos:position pos:line="13" pos:column="8"/></specifier> <name pos:line="13" pos:column="9">char<pos:position pos:line="13" pos:column="13"/></name> <modifier pos:line="13" pos:column="14">*<pos:position pos:line="13" pos:column="15"/></modifier></type><name pos:line="13" pos:column="15">protop<pos:position pos:line="13" pos:column="21"/></name> <init pos:line="13" pos:column="22">= <expr><literal type="string" pos:line="13" pos:column="24">""<pos:position pos:line="13" pos:column="26"/></literal></expr></init></decl>;<pos:position pos:line="13" pos:column="27"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="14" pos:column="3">CURLcode<pos:position pos:line="14" pos:column="11"/></name></type> <name pos:line="14" pos:column="12">result<pos:position pos:line="14" pos:column="18"/></name></decl>;<pos:position pos:line="14" pos:column="19"/></decl_stmt>
  <decl_stmt><decl><type><name pos:line="15" pos:column="3">bool<pos:position pos:line="15" pos:column="7"/></name></type> <name pos:line="15" pos:column="8">rebuild_url<pos:position pos:line="15" pos:column="19"/></name> <init pos:line="15" pos:column="20">= <expr><name pos:line="15" pos:column="22">FALSE<pos:position pos:line="15" pos:column="27"/></name></expr></init></decl>;<pos:position pos:line="15" pos:column="28"/></decl_stmt>

  <expr_stmt><expr><operator pos:line="17" pos:column="3">*<pos:position pos:line="17" pos:column="4"/></operator><name pos:line="17" pos:column="4">prot_missing<pos:position pos:line="17" pos:column="16"/></name> <operator pos:line="17" pos:column="17">=<pos:position pos:line="17" pos:column="18"/></operator> <name pos:line="17" pos:column="19">FALSE<pos:position pos:line="17" pos:column="24"/></name></expr>;<pos:position pos:line="17" pos:column="25"/></expr_stmt>

  <comment type="block" pos:line="19" pos:column="3">/* We might pass the entire URL into the request so we need to make sure
   * there are no bad characters in there.*/</comment>
  <if pos:line="21" pos:column="3">if<condition pos:line="21" pos:column="5">(<expr><call><name pos:line="21" pos:column="6">strpbrk<pos:position pos:line="21" pos:column="13"/></name><argument_list pos:line="21" pos:column="13">(<argument><expr><name><name pos:line="21" pos:column="14">data<pos:position pos:line="21" pos:column="18"/></name><operator pos:line="21" pos:column="18">-&gt;<pos:position pos:line="21" pos:column="23"/></operator><name pos:line="21" pos:column="20">change<pos:position pos:line="21" pos:column="26"/></name><operator pos:line="21" pos:column="26">.<pos:position pos:line="21" pos:column="27"/></operator><name pos:line="21" pos:column="27">url<pos:position pos:line="21" pos:column="30"/></name></name></expr></argument>, <argument><expr><literal type="string" pos:line="21" pos:column="32">"\r\n"<pos:position pos:line="21" pos:column="38"/></literal></expr></argument>)<pos:position pos:line="21" pos:column="39"/></argument_list></call></expr>)<pos:position pos:line="21" pos:column="40"/></condition><then pos:line="21" pos:column="40"> <block pos:line="21" pos:column="41">{
    <expr_stmt><expr><call><name pos:line="22" pos:column="5">failf<pos:position pos:line="22" pos:column="10"/></name><argument_list pos:line="22" pos:column="10">(<argument><expr><name pos:line="22" pos:column="11">data<pos:position pos:line="22" pos:column="15"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="22" pos:column="17">"Illegal characters found in URL"<pos:position pos:line="22" pos:column="50"/></literal></expr></argument>)<pos:position pos:line="22" pos:column="51"/></argument_list></call></expr>;<pos:position pos:line="22" pos:column="52"/></expr_stmt>
    <return pos:line="23" pos:column="5">return <expr><name pos:line="23" pos:column="12">CURLE_URL_MALFORMAT<pos:position pos:line="23" pos:column="31"/></name></expr>;<pos:position pos:line="23" pos:column="32"/></return>
  }<pos:position pos:line="24" pos:column="4"/></block></then></if>

  <comment type="block" format="doxygen" pos:line="26" pos:column="3">/*************************************************************
   * Parse the URL.
   *
   * We need to parse the url even when using the proxy, because we will need
   * the hostname and port in case we are trying to SSL connect through the
   * proxy -- and we don't know if we will need to use SSL until we parse the
   * url ...
   ************************************************************/</comment>
  <if pos:line="34" pos:column="3">if<condition pos:line="34" pos:column="5">(<expr><operator pos:line="34" pos:column="6">(<pos:position pos:line="34" pos:column="7"/></operator><literal type="number" pos:line="34" pos:column="7">2<pos:position pos:line="34" pos:column="8"/></literal> <operator pos:line="34" pos:column="9">==<pos:position pos:line="34" pos:column="11"/></operator> <call><name pos:line="34" pos:column="12">sscanf<pos:position pos:line="34" pos:column="18"/></name><argument_list pos:line="34" pos:column="18">(<argument><expr><name><name pos:line="34" pos:column="19">data<pos:position pos:line="34" pos:column="23"/></name><operator pos:line="34" pos:column="23">-&gt;<pos:position pos:line="34" pos:column="28"/></operator><name pos:line="34" pos:column="25">change<pos:position pos:line="34" pos:column="31"/></name><operator pos:line="34" pos:column="31">.<pos:position pos:line="34" pos:column="32"/></operator><name pos:line="34" pos:column="32">url<pos:position pos:line="34" pos:column="35"/></name></name></expr></argument>, <argument><expr><literal type="string" pos:line="34" pos:column="37">"%15[^:]:%[^\n]"<pos:position pos:line="34" pos:column="53"/></literal></expr></argument>,
                  <argument><expr><name pos:line="35" pos:column="19">protobuf<pos:position pos:line="35" pos:column="27"/></name></expr></argument>, <argument><expr><name pos:line="35" pos:column="29">path<pos:position pos:line="35" pos:column="33"/></name></expr></argument>)<pos:position pos:line="35" pos:column="34"/></argument_list></call><operator pos:line="35" pos:column="34">)<pos:position pos:line="35" pos:column="35"/></operator> <operator pos:line="35" pos:column="36">&amp;&amp;<pos:position pos:line="35" pos:column="46"/></operator>
     <call><name pos:line="36" pos:column="6">Curl_raw_equal<pos:position pos:line="36" pos:column="20"/></name><argument_list pos:line="36" pos:column="20">(<argument><expr><name pos:line="36" pos:column="21">protobuf<pos:position pos:line="36" pos:column="29"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="36" pos:column="31">"file"<pos:position pos:line="36" pos:column="37"/></literal></expr></argument>)<pos:position pos:line="36" pos:column="38"/></argument_list></call></expr>)<pos:position pos:line="36" pos:column="39"/></condition><then pos:line="36" pos:column="39"> <block pos:line="36" pos:column="40">{
    <if pos:line="37" pos:column="5">if<condition pos:line="37" pos:column="7">(<expr><name><name pos:line="37" pos:column="8">path<pos:position pos:line="37" pos:column="12"/></name><index pos:line="37" pos:column="12">[<expr><literal type="number" pos:line="37" pos:column="13">0<pos:position pos:line="37" pos:column="14"/></literal></expr>]<pos:position pos:line="37" pos:column="15"/></index></name> <operator pos:line="37" pos:column="16">==<pos:position pos:line="37" pos:column="18"/></operator> <literal type="char" pos:line="37" pos:column="19">'/'<pos:position pos:line="37" pos:column="22"/></literal> <operator pos:line="37" pos:column="23">&amp;&amp;<pos:position pos:line="37" pos:column="33"/></operator> <name><name pos:line="37" pos:column="26">path<pos:position pos:line="37" pos:column="30"/></name><index pos:line="37" pos:column="30">[<expr><literal type="number" pos:line="37" pos:column="31">1<pos:position pos:line="37" pos:column="32"/></literal></expr>]<pos:position pos:line="37" pos:column="33"/></index></name> <operator pos:line="37" pos:column="34">==<pos:position pos:line="37" pos:column="36"/></operator> <literal type="char" pos:line="37" pos:column="37">'/'<pos:position pos:line="37" pos:column="40"/></literal></expr>)<pos:position pos:line="37" pos:column="41"/></condition><then pos:line="37" pos:column="41"> <block pos:line="37" pos:column="42">{
      <comment type="block" pos:line="38" pos:column="7">/* Allow omitted hostname (e.g. file:/&lt;path&gt;).  This is not strictly
       * speaking a valid file: URL by RFC 1738, but treating file:/&lt;path&gt; as
       * file://localhost/&lt;path&gt; is similar to how other schemes treat missing
       * hostnames.  See RFC 1808. */</comment>

      <comment type="block" pos:line="43" pos:column="7">/* This cannot be done with strcpy() in a portable manner, since the
         memory areas overlap! */</comment>
      <expr_stmt><expr><call><name pos:line="45" pos:column="7">memmove<pos:position pos:line="45" pos:column="14"/></name><argument_list pos:line="45" pos:column="14">(<argument><expr><name pos:line="45" pos:column="15">path<pos:position pos:line="45" pos:column="19"/></name></expr></argument>, <argument><expr><name pos:line="45" pos:column="21">path<pos:position pos:line="45" pos:column="25"/></name> <operator pos:line="45" pos:column="26">+<pos:position pos:line="45" pos:column="27"/></operator> <literal type="number" pos:line="45" pos:column="28">2<pos:position pos:line="45" pos:column="29"/></literal></expr></argument>, <argument><expr><call><name pos:line="45" pos:column="31">strlen<pos:position pos:line="45" pos:column="37"/></name><argument_list pos:line="45" pos:column="37">(<argument><expr><name pos:line="45" pos:column="38">path<pos:position pos:line="45" pos:column="42"/></name> <operator pos:line="45" pos:column="43">+<pos:position pos:line="45" pos:column="44"/></operator> <literal type="number" pos:line="45" pos:column="45">2<pos:position pos:line="45" pos:column="46"/></literal></expr></argument>)<pos:position pos:line="45" pos:column="47"/></argument_list></call><operator pos:line="45" pos:column="47">+<pos:position pos:line="45" pos:column="48"/></operator><literal type="number" pos:line="45" pos:column="48">1<pos:position pos:line="45" pos:column="49"/></literal></expr></argument>)<pos:position pos:line="45" pos:column="50"/></argument_list></call></expr>;<pos:position pos:line="45" pos:column="51"/></expr_stmt>
    }<pos:position pos:line="46" pos:column="6"/></block></then></if>
    <comment type="block" pos:line="47" pos:column="5">/*
     * we deal with file://&lt;host&gt;/&lt;path&gt; differently since it supports no
     * hostname other than "localhost" and "127.0.0.1", which is unique among
     * the URL protocols specified in RFC 1738
     */</comment>
    <if pos:line="52" pos:column="5">if<condition pos:line="52" pos:column="7">(<expr><name><name pos:line="52" pos:column="8">path<pos:position pos:line="52" pos:column="12"/></name><index pos:line="52" pos:column="12">[<expr><literal type="number" pos:line="52" pos:column="13">0<pos:position pos:line="52" pos:column="14"/></literal></expr>]<pos:position pos:line="52" pos:column="15"/></index></name> <operator pos:line="52" pos:column="16">!=<pos:position pos:line="52" pos:column="18"/></operator> <literal type="char" pos:line="52" pos:column="19">'/'<pos:position pos:line="52" pos:column="22"/></literal></expr>)<pos:position pos:line="52" pos:column="23"/></condition><then pos:line="52" pos:column="23"> <block pos:line="52" pos:column="24">{
      <comment type="block" pos:line="53" pos:column="7">/* the URL included a host name, we ignore host names in file:// URLs
         as the standards don't define what to do with them */</comment>
      <decl_stmt><decl><type><name pos:line="55" pos:column="7">char<pos:position pos:line="55" pos:column="11"/></name> <modifier pos:line="55" pos:column="12">*<pos:position pos:line="55" pos:column="13"/></modifier></type><name pos:line="55" pos:column="13">ptr<pos:position pos:line="55" pos:column="16"/></name><init pos:line="55" pos:column="16">=<expr><call><name pos:line="55" pos:column="17">strchr<pos:position pos:line="55" pos:column="23"/></name><argument_list pos:line="55" pos:column="23">(<argument><expr><name pos:line="55" pos:column="24">path<pos:position pos:line="55" pos:column="28"/></name></expr></argument>, <argument><expr><literal type="char" pos:line="55" pos:column="30">'/'<pos:position pos:line="55" pos:column="33"/></literal></expr></argument>)<pos:position pos:line="55" pos:column="34"/></argument_list></call></expr></init></decl>;<pos:position pos:line="55" pos:column="35"/></decl_stmt>
      <if pos:line="56" pos:column="7">if<condition pos:line="56" pos:column="9">(<expr><name pos:line="56" pos:column="10">ptr<pos:position pos:line="56" pos:column="13"/></name></expr>)<pos:position pos:line="56" pos:column="14"/></condition><then pos:line="56" pos:column="14"> <block pos:line="56" pos:column="15">{
        <comment type="block" pos:line="57" pos:column="9">/* there was a slash present

           RFC1738 (section 3.1, page 5) says:

           The rest of the locator consists of data specific to the scheme,
           and is known as the "url-path". It supplies the details of how the
           specified resource can be accessed. Note that the "/" between the
           host (or port) and the url-path is NOT part of the url-path.

           As most agents use file://localhost/foo to get '/foo' although the
           slash preceding foo is a separator and not a slash for the path,
           a URL as file://localhost//foo must be valid as well, to refer to
           the same file with an absolute path.
        */</comment>

        <if pos:line="72" pos:column="9">if<condition pos:line="72" pos:column="11">(<expr><name><name pos:line="72" pos:column="12">ptr<pos:position pos:line="72" pos:column="15"/></name><index pos:line="72" pos:column="15">[<expr><literal type="number" pos:line="72" pos:column="16">1<pos:position pos:line="72" pos:column="17"/></literal></expr>]<pos:position pos:line="72" pos:column="18"/></index></name> <operator pos:line="72" pos:column="19">&amp;&amp;<pos:position pos:line="72" pos:column="29"/></operator> <operator pos:line="72" pos:column="22">(<pos:position pos:line="72" pos:column="23"/></operator><literal type="char" pos:line="72" pos:column="23">'/'<pos:position pos:line="72" pos:column="26"/></literal> <operator pos:line="72" pos:column="27">==<pos:position pos:line="72" pos:column="29"/></operator> <name><name pos:line="72" pos:column="30">ptr<pos:position pos:line="72" pos:column="33"/></name><index pos:line="72" pos:column="33">[<expr><literal type="number" pos:line="72" pos:column="34">1<pos:position pos:line="72" pos:column="35"/></literal></expr>]<pos:position pos:line="72" pos:column="36"/></index></name><operator pos:line="72" pos:column="36">)<pos:position pos:line="72" pos:column="37"/></operator></expr>)<pos:position pos:line="72" pos:column="38"/></condition><then pos:line="72" pos:column="38">
          <comment type="block" pos:line="73" pos:column="11">/* if there was two slashes, we skip the first one as that is then
             used truly as a separator */</comment>
          <block type="pseudo"><expr_stmt><expr><name pos:line="75" pos:column="11">ptr<pos:position pos:line="75" pos:column="14"/></name><operator pos:line="75" pos:column="14">++<pos:position pos:line="75" pos:column="16"/></operator></expr>;<pos:position pos:line="75" pos:column="17"/></expr_stmt></block></then></if>

        <comment type="block" pos:line="77" pos:column="9">/* This cannot be made with strcpy, as the memory chunks overlap! */</comment>
        <expr_stmt><expr><call><name pos:line="78" pos:column="9">memmove<pos:position pos:line="78" pos:column="16"/></name><argument_list pos:line="78" pos:column="16">(<argument><expr><name pos:line="78" pos:column="17">path<pos:position pos:line="78" pos:column="21"/></name></expr></argument>, <argument><expr><name pos:line="78" pos:column="23">ptr<pos:position pos:line="78" pos:column="26"/></name></expr></argument>, <argument><expr><call><name pos:line="78" pos:column="28">strlen<pos:position pos:line="78" pos:column="34"/></name><argument_list pos:line="78" pos:column="34">(<argument><expr><name pos:line="78" pos:column="35">ptr<pos:position pos:line="78" pos:column="38"/></name></expr></argument>)<pos:position pos:line="78" pos:column="39"/></argument_list></call><operator pos:line="78" pos:column="39">+<pos:position pos:line="78" pos:column="40"/></operator><literal type="number" pos:line="78" pos:column="40">1<pos:position pos:line="78" pos:column="41"/></literal></expr></argument>)<pos:position pos:line="78" pos:column="42"/></argument_list></call></expr>;<pos:position pos:line="78" pos:column="43"/></expr_stmt>
      }<pos:position pos:line="79" pos:column="8"/></block></then></if>
    }<pos:position pos:line="80" pos:column="6"/></block></then></if>

    <expr_stmt><expr><name pos:line="82" pos:column="5">protop<pos:position pos:line="82" pos:column="11"/></name> <operator pos:line="82" pos:column="12">=<pos:position pos:line="82" pos:column="13"/></operator> <literal type="string" pos:line="82" pos:column="14">"file"<pos:position pos:line="82" pos:column="20"/></literal></expr>;<pos:position pos:line="82" pos:column="21"/></expr_stmt> <comment type="block" pos:line="82" pos:column="22">/* protocol string */</comment>
  }<pos:position pos:line="83" pos:column="4"/></block></then>
  <else pos:line="84" pos:column="3">else <block pos:line="84" pos:column="8">{
    <comment type="block" pos:line="85" pos:column="5">/* clear path */</comment>
    <expr_stmt><expr><name><name pos:line="86" pos:column="5">path<pos:position pos:line="86" pos:column="9"/></name><index pos:line="86" pos:column="9">[<expr><literal type="number" pos:line="86" pos:column="10">0<pos:position pos:line="86" pos:column="11"/></literal></expr>]<pos:position pos:line="86" pos:column="12"/></index></name><operator pos:line="86" pos:column="12">=<pos:position pos:line="86" pos:column="13"/></operator><literal type="number" pos:line="86" pos:column="13">0<pos:position pos:line="86" pos:column="14"/></literal></expr>;<pos:position pos:line="86" pos:column="15"/></expr_stmt>

    <if pos:line="88" pos:column="5">if<condition pos:line="88" pos:column="7">(<expr><literal type="number" pos:line="88" pos:column="8">2<pos:position pos:line="88" pos:column="9"/></literal> <operator pos:line="88" pos:column="10">&gt;<pos:position pos:line="88" pos:column="14"/></operator> <call><name pos:line="88" pos:column="12">sscanf<pos:position pos:line="88" pos:column="18"/></name><argument_list pos:line="88" pos:column="18">(<argument><expr><name><name pos:line="88" pos:column="19">data<pos:position pos:line="88" pos:column="23"/></name><operator pos:line="88" pos:column="23">-&gt;<pos:position pos:line="88" pos:column="28"/></operator><name pos:line="88" pos:column="25">change<pos:position pos:line="88" pos:column="31"/></name><operator pos:line="88" pos:column="31">.<pos:position pos:line="88" pos:column="32"/></operator><name pos:line="88" pos:column="32">url<pos:position pos:line="88" pos:column="35"/></name></name></expr></argument>,
                   <argument><expr><literal type="string" pos:line="89" pos:column="20">"%15[^\n:]://%[^\n/?]%[^\n]"<pos:position pos:line="89" pos:column="48"/></literal></expr></argument>,
                   <argument><expr><name pos:line="90" pos:column="20">protobuf<pos:position pos:line="90" pos:column="28"/></name></expr></argument>,
                   <argument><expr><name><name pos:line="91" pos:column="20">conn<pos:position pos:line="91" pos:column="24"/></name><operator pos:line="91" pos:column="24">-&gt;<pos:position pos:line="91" pos:column="29"/></operator><name pos:line="91" pos:column="26">host<pos:position pos:line="91" pos:column="30"/></name><operator pos:line="91" pos:column="30">.<pos:position pos:line="91" pos:column="31"/></operator><name pos:line="91" pos:column="31">name<pos:position pos:line="91" pos:column="35"/></name></name></expr></argument>, <argument><expr><name pos:line="91" pos:column="37">path<pos:position pos:line="91" pos:column="41"/></name></expr></argument>)<pos:position pos:line="91" pos:column="42"/></argument_list></call></expr>)<pos:position pos:line="91" pos:column="43"/></condition><then pos:line="91" pos:column="43"> <block pos:line="91" pos:column="44">{

      <comment type="block" pos:line="93" pos:column="7">/*
       * The URL was badly formatted, let's try the browser-style _without_
       * protocol specified like 'http://'.
       */</comment>
      <expr_stmt><expr><name pos:line="97" pos:column="7">rc<pos:position pos:line="97" pos:column="9"/></name> <operator pos:line="97" pos:column="10">=<pos:position pos:line="97" pos:column="11"/></operator> <call><name pos:line="97" pos:column="12">sscanf<pos:position pos:line="97" pos:column="18"/></name><argument_list pos:line="97" pos:column="18">(<argument><expr><name><name pos:line="97" pos:column="19">data<pos:position pos:line="97" pos:column="23"/></name><operator pos:line="97" pos:column="23">-&gt;<pos:position pos:line="97" pos:column="28"/></operator><name pos:line="97" pos:column="25">change<pos:position pos:line="97" pos:column="31"/></name><operator pos:line="97" pos:column="31">.<pos:position pos:line="97" pos:column="32"/></operator><name pos:line="97" pos:column="32">url<pos:position pos:line="97" pos:column="35"/></name></name></expr></argument>, <argument><expr><literal type="string" pos:line="97" pos:column="37">"%[^\n/?]%[^\n]"<pos:position pos:line="97" pos:column="53"/></literal></expr></argument>, <argument><expr><name><name pos:line="97" pos:column="55">conn<pos:position pos:line="97" pos:column="59"/></name><operator pos:line="97" pos:column="59">-&gt;<pos:position pos:line="97" pos:column="64"/></operator><name pos:line="97" pos:column="61">host<pos:position pos:line="97" pos:column="65"/></name><operator pos:line="97" pos:column="65">.<pos:position pos:line="97" pos:column="66"/></operator><name pos:line="97" pos:column="66">name<pos:position pos:line="97" pos:column="70"/></name></name></expr></argument>, <argument><expr><name pos:line="97" pos:column="72">path<pos:position pos:line="97" pos:column="76"/></name></expr></argument>)<pos:position pos:line="97" pos:column="77"/></argument_list></call></expr>;<pos:position pos:line="97" pos:column="78"/></expr_stmt>
      <if pos:line="98" pos:column="7">if<condition pos:line="98" pos:column="9">(<expr><literal type="number" pos:line="98" pos:column="10">1<pos:position pos:line="98" pos:column="11"/></literal> <operator pos:line="98" pos:column="12">&gt;<pos:position pos:line="98" pos:column="16"/></operator> <name pos:line="98" pos:column="14">rc<pos:position pos:line="98" pos:column="16"/></name></expr>)<pos:position pos:line="98" pos:column="17"/></condition><then pos:line="98" pos:column="17"> <block pos:line="98" pos:column="18">{
        <comment type="block" pos:line="99" pos:column="9">/*
         * We couldn't even get this format.
         * djgpp 2.04 has a sscanf() bug where 'conn-&gt;host.name' is
         * assigned, but the return value is EOF!
         */</comment>
<cpp:if pos:line="104" pos:column="1">#<cpp:directive pos:line="104" pos:column="2">if<pos:position pos:line="104" pos:column="4"/></cpp:directive> <expr><call><name pos:line="104" pos:column="5">defined<pos:position pos:line="104" pos:column="12"/></name><argument_list pos:line="104" pos:column="12">(<argument><expr><name pos:line="104" pos:column="13">__DJGPP__<pos:position pos:line="104" pos:column="22"/></name></expr></argument>)<pos:position pos:line="104" pos:column="23"/></argument_list></call> <operator pos:line="104" pos:column="24">&amp;&amp;<pos:position pos:line="104" pos:column="34"/></operator> <operator pos:line="104" pos:column="27">(<pos:position pos:line="104" pos:column="28"/></operator><name pos:line="104" pos:column="28">DJGPP_MINOR<pos:position pos:line="104" pos:column="39"/></name> <operator pos:line="104" pos:column="40">==<pos:position pos:line="104" pos:column="42"/></operator> <literal type="number" pos:line="104" pos:column="43">4<pos:position pos:line="104" pos:column="44"/></literal><operator pos:line="104" pos:column="44">)<pos:position pos:line="104" pos:column="45"/></operator></expr></cpp:if>
        <if pos:line="105" pos:column="9">if<condition pos:line="105" pos:column="11">(<expr><operator pos:line="105" pos:column="12">!<pos:position pos:line="105" pos:column="13"/></operator><operator pos:line="105" pos:column="13">(<pos:position pos:line="105" pos:column="14"/></operator><name pos:line="105" pos:column="14">rc<pos:position pos:line="105" pos:column="16"/></name> <operator pos:line="105" pos:column="17">==<pos:position pos:line="105" pos:column="19"/></operator> <operator pos:line="105" pos:column="20">-<pos:position pos:line="105" pos:column="21"/></operator><literal type="number" pos:line="105" pos:column="21">1<pos:position pos:line="105" pos:column="22"/></literal> <operator pos:line="105" pos:column="23">&amp;&amp;<pos:position pos:line="105" pos:column="33"/></operator> <operator pos:line="105" pos:column="26">*<pos:position pos:line="105" pos:column="27"/></operator><name><name pos:line="105" pos:column="27">conn<pos:position pos:line="105" pos:column="31"/></name><operator pos:line="105" pos:column="31">-&gt;<pos:position pos:line="105" pos:column="36"/></operator><name pos:line="105" pos:column="33">host<pos:position pos:line="105" pos:column="37"/></name><operator pos:line="105" pos:column="37">.<pos:position pos:line="105" pos:column="38"/></operator><name pos:line="105" pos:column="38">name<pos:position pos:line="105" pos:column="42"/></name></name><operator pos:line="105" pos:column="42">)<pos:position pos:line="105" pos:column="43"/></operator></expr>)<pos:position pos:line="105" pos:column="44"/></condition><then pos:line="105" pos:column="44">
<cpp:endif pos:line="106" pos:column="1">#<cpp:directive pos:line="106" pos:column="2">endif<pos:position pos:line="106" pos:column="7"/></cpp:directive></cpp:endif>
        <block pos:line="107" pos:column="9">{
          <expr_stmt><expr><call><name pos:line="108" pos:column="11">failf<pos:position pos:line="108" pos:column="16"/></name><argument_list pos:line="108" pos:column="16">(<argument><expr><name pos:line="108" pos:column="17">data<pos:position pos:line="108" pos:column="21"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="108" pos:column="23">"&lt;url&gt; malformed"<pos:position pos:line="108" pos:column="46"/></literal></expr></argument>)<pos:position pos:line="108" pos:column="41"/></argument_list></call></expr>;<pos:position pos:line="108" pos:column="42"/></expr_stmt>
          <return pos:line="109" pos:column="11">return <expr><name pos:line="109" pos:column="18">CURLE_URL_MALFORMAT<pos:position pos:line="109" pos:column="37"/></name></expr>;<pos:position pos:line="109" pos:column="38"/></return>
        }<pos:position pos:line="110" pos:column="10"/></block></then></if>
      }<pos:position pos:line="111" pos:column="8"/></block></then></if>

      <comment type="block" pos:line="113" pos:column="7">/*
       * Since there was no protocol part specified, we guess what protocol it
       * is based on the first letters of the server name.
       */</comment>

      <comment type="block" pos:line="118" pos:column="7">/* Note: if you add a new protocol, please update the list in
       * lib/version.c too! */</comment>

      <if pos:line="121" pos:column="7">if<condition pos:line="121" pos:column="9">(<expr><call><name pos:line="121" pos:column="10">checkprefix<pos:position pos:line="121" pos:column="21"/></name><argument_list pos:line="121" pos:column="21">(<argument><expr><literal type="string" pos:line="121" pos:column="22">"FTP."<pos:position pos:line="121" pos:column="28"/></literal></expr></argument>, <argument><expr><name><name pos:line="121" pos:column="30">conn<pos:position pos:line="121" pos:column="34"/></name><operator pos:line="121" pos:column="34">-&gt;<pos:position pos:line="121" pos:column="39"/></operator><name pos:line="121" pos:column="36">host<pos:position pos:line="121" pos:column="40"/></name><operator pos:line="121" pos:column="40">.<pos:position pos:line="121" pos:column="41"/></operator><name pos:line="121" pos:column="41">name<pos:position pos:line="121" pos:column="45"/></name></name></expr></argument>)<pos:position pos:line="121" pos:column="46"/></argument_list></call></expr>)<pos:position pos:line="121" pos:column="47"/></condition><then pos:line="121" pos:column="47">
        <block type="pseudo"><expr_stmt><expr><name pos:line="122" pos:column="9">protop<pos:position pos:line="122" pos:column="15"/></name> <operator pos:line="122" pos:column="16">=<pos:position pos:line="122" pos:column="17"/></operator> <literal type="string" pos:line="122" pos:column="18">"ftp"<pos:position pos:line="122" pos:column="23"/></literal></expr>;<pos:position pos:line="122" pos:column="24"/></expr_stmt></block></then>
      <elseif pos:line="123" pos:column="7">else <if pos:line="123" pos:column="12">if<condition pos:line="123" pos:column="14">(<expr><call><name pos:line="123" pos:column="15">checkprefix<pos:position pos:line="123" pos:column="26"/></name><argument_list pos:line="123" pos:column="26">(<argument><expr><literal type="string" pos:line="123" pos:column="27">"DICT."<pos:position pos:line="123" pos:column="34"/></literal></expr></argument>, <argument><expr><name><name pos:line="123" pos:column="36">conn<pos:position pos:line="123" pos:column="40"/></name><operator pos:line="123" pos:column="40">-&gt;<pos:position pos:line="123" pos:column="45"/></operator><name pos:line="123" pos:column="42">host<pos:position pos:line="123" pos:column="46"/></name><operator pos:line="123" pos:column="46">.<pos:position pos:line="123" pos:column="47"/></operator><name pos:line="123" pos:column="47">name<pos:position pos:line="123" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="123" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="123" pos:column="53"/></condition><then pos:line="123" pos:column="53">
        <block type="pseudo"><expr_stmt><expr><name pos:line="124" pos:column="9">protop<pos:position pos:line="124" pos:column="15"/></name> <operator pos:line="124" pos:column="16">=<pos:position pos:line="124" pos:column="17"/></operator> <literal type="string" pos:line="124" pos:column="18">"DICT"<pos:position pos:line="124" pos:column="24"/></literal></expr>;<pos:position pos:line="124" pos:column="25"/></expr_stmt></block></then></if></elseif>
      <elseif pos:line="125" pos:column="7">else <if pos:line="125" pos:column="12">if<condition pos:line="125" pos:column="14">(<expr><call><name pos:line="125" pos:column="15">checkprefix<pos:position pos:line="125" pos:column="26"/></name><argument_list pos:line="125" pos:column="26">(<argument><expr><literal type="string" pos:line="125" pos:column="27">"LDAP."<pos:position pos:line="125" pos:column="34"/></literal></expr></argument>, <argument><expr><name><name pos:line="125" pos:column="36">conn<pos:position pos:line="125" pos:column="40"/></name><operator pos:line="125" pos:column="40">-&gt;<pos:position pos:line="125" pos:column="45"/></operator><name pos:line="125" pos:column="42">host<pos:position pos:line="125" pos:column="46"/></name><operator pos:line="125" pos:column="46">.<pos:position pos:line="125" pos:column="47"/></operator><name pos:line="125" pos:column="47">name<pos:position pos:line="125" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="125" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="125" pos:column="53"/></condition><then pos:line="125" pos:column="53">
        <block type="pseudo"><expr_stmt><expr><name pos:line="126" pos:column="9">protop<pos:position pos:line="126" pos:column="15"/></name> <operator pos:line="126" pos:column="16">=<pos:position pos:line="126" pos:column="17"/></operator> <literal type="string" pos:line="126" pos:column="18">"LDAP"<pos:position pos:line="126" pos:column="24"/></literal></expr>;<pos:position pos:line="126" pos:column="25"/></expr_stmt></block></then></if></elseif>
      <elseif pos:line="127" pos:column="7">else <if pos:line="127" pos:column="12">if<condition pos:line="127" pos:column="14">(<expr><call><name pos:line="127" pos:column="15">checkprefix<pos:position pos:line="127" pos:column="26"/></name><argument_list pos:line="127" pos:column="26">(<argument><expr><literal type="string" pos:line="127" pos:column="27">"IMAP."<pos:position pos:line="127" pos:column="34"/></literal></expr></argument>, <argument><expr><name><name pos:line="127" pos:column="36">conn<pos:position pos:line="127" pos:column="40"/></name><operator pos:line="127" pos:column="40">-&gt;<pos:position pos:line="127" pos:column="45"/></operator><name pos:line="127" pos:column="42">host<pos:position pos:line="127" pos:column="46"/></name><operator pos:line="127" pos:column="46">.<pos:position pos:line="127" pos:column="47"/></operator><name pos:line="127" pos:column="47">name<pos:position pos:line="127" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="127" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="127" pos:column="53"/></condition><then pos:line="127" pos:column="53">
        <block type="pseudo"><expr_stmt><expr><name pos:line="128" pos:column="9">protop<pos:position pos:line="128" pos:column="15"/></name> <operator pos:line="128" pos:column="16">=<pos:position pos:line="128" pos:column="17"/></operator> <literal type="string" pos:line="128" pos:column="18">"IMAP"<pos:position pos:line="128" pos:column="24"/></literal></expr>;<pos:position pos:line="128" pos:column="25"/></expr_stmt></block></then></if></elseif>
      <elseif pos:line="129" pos:column="7">else <if pos:line="129" pos:column="12">if<condition pos:line="129" pos:column="14">(<expr><call><name pos:line="129" pos:column="15">checkprefix<pos:position pos:line="129" pos:column="26"/></name><argument_list pos:line="129" pos:column="26">(<argument><expr><literal type="string" pos:line="129" pos:column="27">"SMTP."<pos:position pos:line="129" pos:column="34"/></literal></expr></argument>, <argument><expr><name><name pos:line="129" pos:column="36">conn<pos:position pos:line="129" pos:column="40"/></name><operator pos:line="129" pos:column="40">-&gt;<pos:position pos:line="129" pos:column="45"/></operator><name pos:line="129" pos:column="42">host<pos:position pos:line="129" pos:column="46"/></name><operator pos:line="129" pos:column="46">.<pos:position pos:line="129" pos:column="47"/></operator><name pos:line="129" pos:column="47">name<pos:position pos:line="129" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="129" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="129" pos:column="53"/></condition><then pos:line="129" pos:column="53">
        <block type="pseudo"><expr_stmt><expr><name pos:line="130" pos:column="9">protop<pos:position pos:line="130" pos:column="15"/></name> <operator pos:line="130" pos:column="16">=<pos:position pos:line="130" pos:column="17"/></operator> <literal type="string" pos:line="130" pos:column="18">"smtp"<pos:position pos:line="130" pos:column="24"/></literal></expr>;<pos:position pos:line="130" pos:column="25"/></expr_stmt></block></then></if></elseif>
      <elseif pos:line="131" pos:column="7">else <if pos:line="131" pos:column="12">if<condition pos:line="131" pos:column="14">(<expr><call><name pos:line="131" pos:column="15">checkprefix<pos:position pos:line="131" pos:column="26"/></name><argument_list pos:line="131" pos:column="26">(<argument><expr><literal type="string" pos:line="131" pos:column="27">"POP3."<pos:position pos:line="131" pos:column="34"/></literal></expr></argument>, <argument><expr><name><name pos:line="131" pos:column="36">conn<pos:position pos:line="131" pos:column="40"/></name><operator pos:line="131" pos:column="40">-&gt;<pos:position pos:line="131" pos:column="45"/></operator><name pos:line="131" pos:column="42">host<pos:position pos:line="131" pos:column="46"/></name><operator pos:line="131" pos:column="46">.<pos:position pos:line="131" pos:column="47"/></operator><name pos:line="131" pos:column="47">name<pos:position pos:line="131" pos:column="51"/></name></name></expr></argument>)<pos:position pos:line="131" pos:column="52"/></argument_list></call></expr>)<pos:position pos:line="131" pos:column="53"/></condition><then pos:line="131" pos:column="53">
        <block type="pseudo"><expr_stmt><expr><name pos:line="132" pos:column="9">protop<pos:position pos:line="132" pos:column="15"/></name> <operator pos:line="132" pos:column="16">=<pos:position pos:line="132" pos:column="17"/></operator> <literal type="string" pos:line="132" pos:column="18">"pop3"<pos:position pos:line="132" pos:column="24"/></literal></expr>;<pos:position pos:line="132" pos:column="25"/></expr_stmt></block></then></if></elseif>
      <else pos:line="133" pos:column="7">else <block pos:line="133" pos:column="12">{
        <expr_stmt><expr><name pos:line="134" pos:column="9">protop<pos:position pos:line="134" pos:column="15"/></name> <operator pos:line="134" pos:column="16">=<pos:position pos:line="134" pos:column="17"/></operator> <literal type="string" pos:line="134" pos:column="18">"http"<pos:position pos:line="134" pos:column="24"/></literal></expr>;<pos:position pos:line="134" pos:column="25"/></expr_stmt>
      }<pos:position pos:line="135" pos:column="8"/></block></else></if>

      <expr_stmt><expr><operator pos:line="137" pos:column="7">*<pos:position pos:line="137" pos:column="8"/></operator><name pos:line="137" pos:column="8">prot_missing<pos:position pos:line="137" pos:column="20"/></name> <operator pos:line="137" pos:column="21">=<pos:position pos:line="137" pos:column="22"/></operator> <name pos:line="137" pos:column="23">TRUE<pos:position pos:line="137" pos:column="27"/></name></expr>;<pos:position pos:line="137" pos:column="28"/></expr_stmt> <comment type="block" pos:line="137" pos:column="29">/* not given in URL */</comment>
    }<pos:position pos:line="138" pos:column="6"/></block></then>
    <else pos:line="139" pos:column="5">else
      <block type="pseudo"><expr_stmt><expr><name pos:line="140" pos:column="7">protop<pos:position pos:line="140" pos:column="13"/></name> <operator pos:line="140" pos:column="14">=<pos:position pos:line="140" pos:column="15"/></operator> <name pos:line="140" pos:column="16">protobuf<pos:position pos:line="140" pos:column="24"/></name></expr>;<pos:position pos:line="140" pos:column="25"/></expr_stmt></block></else></if>
  }<pos:position pos:line="141" pos:column="4"/></block></else></if>

  <comment type="block" pos:line="143" pos:column="3">/* We search for '?' in the host name (but only on the right side of a
   * @-letter to allow ?-letters in username and password) to handle things
   * like http://example.com?param= (notice the missing '/').
   */</comment>
  <expr_stmt><expr><name pos:line="147" pos:column="3">at<pos:position pos:line="147" pos:column="5"/></name> <operator pos:line="147" pos:column="6">=<pos:position pos:line="147" pos:column="7"/></operator> <call><name pos:line="147" pos:column="8">strchr<pos:position pos:line="147" pos:column="14"/></name><argument_list pos:line="147" pos:column="14">(<argument><expr><name><name pos:line="147" pos:column="15">conn<pos:position pos:line="147" pos:column="19"/></name><operator pos:line="147" pos:column="19">-&gt;<pos:position pos:line="147" pos:column="24"/></operator><name pos:line="147" pos:column="21">host<pos:position pos:line="147" pos:column="25"/></name><operator pos:line="147" pos:column="25">.<pos:position pos:line="147" pos:column="26"/></operator><name pos:line="147" pos:column="26">name<pos:position pos:line="147" pos:column="30"/></name></name></expr></argument>, <argument><expr><literal type="char" pos:line="147" pos:column="32">'@'<pos:position pos:line="147" pos:column="35"/></literal></expr></argument>)<pos:position pos:line="147" pos:column="36"/></argument_list></call></expr>;<pos:position pos:line="147" pos:column="37"/></expr_stmt>
  <if pos:line="148" pos:column="3">if<condition pos:line="148" pos:column="5">(<expr><name pos:line="148" pos:column="6">at<pos:position pos:line="148" pos:column="8"/></name></expr>)<pos:position pos:line="148" pos:column="9"/></condition><then pos:line="148" pos:column="9">
    <block type="pseudo"><expr_stmt><expr><name pos:line="149" pos:column="5">query<pos:position pos:line="149" pos:column="10"/></name> <operator pos:line="149" pos:column="11">=<pos:position pos:line="149" pos:column="12"/></operator> <call><name pos:line="149" pos:column="13">strchr<pos:position pos:line="149" pos:column="19"/></name><argument_list pos:line="149" pos:column="19">(<argument><expr><name pos:line="149" pos:column="20">at<pos:position pos:line="149" pos:column="22"/></name><operator pos:line="149" pos:column="22">+<pos:position pos:line="149" pos:column="23"/></operator><literal type="number" pos:line="149" pos:column="23">1<pos:position pos:line="149" pos:column="24"/></literal></expr></argument>, <argument><expr><literal type="char" pos:line="149" pos:column="26">'?'<pos:position pos:line="149" pos:column="29"/></literal></expr></argument>)<pos:position pos:line="149" pos:column="30"/></argument_list></call></expr>;<pos:position pos:line="149" pos:column="31"/></expr_stmt></block></then>
  <else pos:line="150" pos:column="3">else
    <block type="pseudo"><expr_stmt><expr><name pos:line="151" pos:column="5">query<pos:position pos:line="151" pos:column="10"/></name> <operator pos:line="151" pos:column="11">=<pos:position pos:line="151" pos:column="12"/></operator> <call><name pos:line="151" pos:column="13">strchr<pos:position pos:line="151" pos:column="19"/></name><argument_list pos:line="151" pos:column="19">(<argument><expr><name><name pos:line="151" pos:column="20">conn<pos:position pos:line="151" pos:column="24"/></name><operator pos:line="151" pos:column="24">-&gt;<pos:position pos:line="151" pos:column="29"/></operator><name pos:line="151" pos:column="26">host<pos:position pos:line="151" pos:column="30"/></name><operator pos:line="151" pos:column="30">.<pos:position pos:line="151" pos:column="31"/></operator><name pos:line="151" pos:column="31">name<pos:position pos:line="151" pos:column="35"/></name></name></expr></argument>, <argument><expr><literal type="char" pos:line="151" pos:column="37">'?'<pos:position pos:line="151" pos:column="40"/></literal></expr></argument>)<pos:position pos:line="151" pos:column="41"/></argument_list></call></expr>;<pos:position pos:line="151" pos:column="42"/></expr_stmt></block></else></if>

  <if pos:line="153" pos:column="3">if<condition pos:line="153" pos:column="5">(<expr><name pos:line="153" pos:column="6">query<pos:position pos:line="153" pos:column="11"/></name></expr>)<pos:position pos:line="153" pos:column="12"/></condition><then pos:line="153" pos:column="12"> <block pos:line="153" pos:column="13">{
    <comment type="block" pos:line="154" pos:column="5">/* We must insert a slash before the '?'-letter in the URL. If the URL had
       a slash after the '?', that is where the path currently begins and the
       '?string' is still part of the host name.

       We must move the trailing part from the host name and put it first in
       the path. And have it all prefixed with a slash.
    */</comment>

    <decl_stmt><decl><type><name pos:line="162" pos:column="5">size_t<pos:position pos:line="162" pos:column="11"/></name></type> <name pos:line="162" pos:column="12">hostlen<pos:position pos:line="162" pos:column="19"/></name> <init pos:line="162" pos:column="20">= <expr><call><name pos:line="162" pos:column="22">strlen<pos:position pos:line="162" pos:column="28"/></name><argument_list pos:line="162" pos:column="28">(<argument><expr><name pos:line="162" pos:column="29">query<pos:position pos:line="162" pos:column="34"/></name></expr></argument>)<pos:position pos:line="162" pos:column="35"/></argument_list></call></expr></init></decl>;<pos:position pos:line="162" pos:column="36"/></decl_stmt>
    <decl_stmt><decl><type><name pos:line="163" pos:column="5">size_t<pos:position pos:line="163" pos:column="11"/></name></type> <name pos:line="163" pos:column="12">pathlen<pos:position pos:line="163" pos:column="19"/></name> <init pos:line="163" pos:column="20">= <expr><call><name pos:line="163" pos:column="22">strlen<pos:position pos:line="163" pos:column="28"/></name><argument_list pos:line="163" pos:column="28">(<argument><expr><name pos:line="163" pos:column="29">path<pos:position pos:line="163" pos:column="33"/></name></expr></argument>)<pos:position pos:line="163" pos:column="34"/></argument_list></call></expr></init></decl>;<pos:position pos:line="163" pos:column="35"/></decl_stmt>

    <comment type="block" pos:line="165" pos:column="5">/* move the existing path plus the zero byte forward, to make room for
       the host-name part */</comment>
    <expr_stmt><expr><call><name pos:line="167" pos:column="5">memmove<pos:position pos:line="167" pos:column="12"/></name><argument_list pos:line="167" pos:column="12">(<argument><expr><name pos:line="167" pos:column="13">path<pos:position pos:line="167" pos:column="17"/></name><operator pos:line="167" pos:column="17">+<pos:position pos:line="167" pos:column="18"/></operator><name pos:line="167" pos:column="18">hostlen<pos:position pos:line="167" pos:column="25"/></name><operator pos:line="167" pos:column="25">+<pos:position pos:line="167" pos:column="26"/></operator><literal type="number" pos:line="167" pos:column="26">1<pos:position pos:line="167" pos:column="27"/></literal></expr></argument>, <argument><expr><name pos:line="167" pos:column="29">path<pos:position pos:line="167" pos:column="33"/></name></expr></argument>, <argument><expr><name pos:line="167" pos:column="35">pathlen<pos:position pos:line="167" pos:column="42"/></name><operator pos:line="167" pos:column="42">+<pos:position pos:line="167" pos:column="43"/></operator><literal type="number" pos:line="167" pos:column="43">1<pos:position pos:line="167" pos:column="44"/></literal></expr></argument>)<pos:position pos:line="167" pos:column="45"/></argument_list></call></expr>;<pos:position pos:line="167" pos:column="46"/></expr_stmt>

     <comment type="block" pos:line="169" pos:column="6">/* now copy the trailing host part in front of the existing path */</comment>
    <expr_stmt><expr><call><name pos:line="170" pos:column="5">memcpy<pos:position pos:line="170" pos:column="11"/></name><argument_list pos:line="170" pos:column="11">(<argument><expr><name pos:line="170" pos:column="12">path<pos:position pos:line="170" pos:column="16"/></name><operator pos:line="170" pos:column="16">+<pos:position pos:line="170" pos:column="17"/></operator><literal type="number" pos:line="170" pos:column="17">1<pos:position pos:line="170" pos:column="18"/></literal></expr></argument>, <argument><expr><name pos:line="170" pos:column="20">query<pos:position pos:line="170" pos:column="25"/></name></expr></argument>, <argument><expr><name pos:line="170" pos:column="27">hostlen<pos:position pos:line="170" pos:column="34"/></name></expr></argument>)<pos:position pos:line="170" pos:column="35"/></argument_list></call></expr>;<pos:position pos:line="170" pos:column="36"/></expr_stmt>

    <expr_stmt><expr><name><name pos:line="172" pos:column="5">path<pos:position pos:line="172" pos:column="9"/></name><index pos:line="172" pos:column="9">[<expr><literal type="number" pos:line="172" pos:column="10">0<pos:position pos:line="172" pos:column="11"/></literal></expr>]<pos:position pos:line="172" pos:column="12"/></index></name><operator pos:line="172" pos:column="12">=<pos:position pos:line="172" pos:column="13"/></operator><literal type="char" pos:line="172" pos:column="13">'/'<pos:position pos:line="172" pos:column="16"/></literal></expr>;<pos:position pos:line="172" pos:column="17"/></expr_stmt> <comment type="block" pos:line="172" pos:column="18">/* prepend the missing slash */</comment>
    <expr_stmt><expr><name pos:line="173" pos:column="5">rebuild_url<pos:position pos:line="173" pos:column="16"/></name> <operator pos:line="173" pos:column="17">=<pos:position pos:line="173" pos:column="18"/></operator> <name pos:line="173" pos:column="19">TRUE<pos:position pos:line="173" pos:column="23"/></name></expr>;<pos:position pos:line="173" pos:column="24"/></expr_stmt>

    <expr_stmt><expr><operator pos:line="175" pos:column="5">*<pos:position pos:line="175" pos:column="6"/></operator><name pos:line="175" pos:column="6">query<pos:position pos:line="175" pos:column="11"/></name><operator pos:line="175" pos:column="11">=<pos:position pos:line="175" pos:column="12"/></operator><literal type="number" pos:line="175" pos:column="12">0<pos:position pos:line="175" pos:column="13"/></literal></expr>;<pos:position pos:line="175" pos:column="14"/></expr_stmt> <comment type="block" pos:line="175" pos:column="15">/* now cut off the hostname at the ? */</comment>
  }<pos:position pos:line="176" pos:column="4"/></block></then>
  <elseif pos:line="177" pos:column="3">else <if pos:line="177" pos:column="8">if<condition pos:line="177" pos:column="10">(<expr><operator pos:line="177" pos:column="11">!<pos:position pos:line="177" pos:column="12"/></operator><name><name pos:line="177" pos:column="12">path<pos:position pos:line="177" pos:column="16"/></name><index pos:line="177" pos:column="16">[<expr><literal type="number" pos:line="177" pos:column="17">0<pos:position pos:line="177" pos:column="18"/></literal></expr>]<pos:position pos:line="177" pos:column="19"/></index></name></expr>)<pos:position pos:line="177" pos:column="20"/></condition><then pos:line="177" pos:column="20"> <block pos:line="177" pos:column="21">{
    <comment type="block" pos:line="178" pos:column="5">/* if there's no path set, use a single slash */</comment>
    <expr_stmt><expr><call><name pos:line="179" pos:column="5">strcpy<pos:position pos:line="179" pos:column="11"/></name><argument_list pos:line="179" pos:column="11">(<argument><expr><name pos:line="179" pos:column="12">path<pos:position pos:line="179" pos:column="16"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="179" pos:column="18">"/"<pos:position pos:line="179" pos:column="21"/></literal></expr></argument>)<pos:position pos:line="179" pos:column="22"/></argument_list></call></expr>;<pos:position pos:line="179" pos:column="23"/></expr_stmt>
    <expr_stmt><expr><name pos:line="180" pos:column="5">rebuild_url<pos:position pos:line="180" pos:column="16"/></name> <operator pos:line="180" pos:column="17">=<pos:position pos:line="180" pos:column="18"/></operator> <name pos:line="180" pos:column="19">TRUE<pos:position pos:line="180" pos:column="23"/></name></expr>;<pos:position pos:line="180" pos:column="24"/></expr_stmt>
  }<pos:position pos:line="181" pos:column="4"/></block></then></if></elseif></if>

  <comment type="block" pos:line="183" pos:column="3">/* If the URL is malformatted (missing a '/' after hostname before path) we
   * insert a slash here. The only letter except '/' we accept to start a path
   * is '?'.
   */</comment>
  <if pos:line="187" pos:column="3">if<condition pos:line="187" pos:column="5">(<expr><name><name pos:line="187" pos:column="6">path<pos:position pos:line="187" pos:column="10"/></name><index pos:line="187" pos:column="10">[<expr><literal type="number" pos:line="187" pos:column="11">0<pos:position pos:line="187" pos:column="12"/></literal></expr>]<pos:position pos:line="187" pos:column="13"/></index></name> <operator pos:line="187" pos:column="14">==<pos:position pos:line="187" pos:column="16"/></operator> <literal type="char" pos:line="187" pos:column="17">'?'<pos:position pos:line="187" pos:column="20"/></literal></expr>)<pos:position pos:line="187" pos:column="21"/></condition><then pos:line="187" pos:column="21"> <block pos:line="187" pos:column="22">{
    <comment type="block" pos:line="188" pos:column="5">/* We need this function to deal with overlapping memory areas. We know
       that the memory area 'path' points to is 'urllen' bytes big and that
       is bigger than the path. Use +1 to move the zero byte too. */</comment>
    <expr_stmt><expr><call><name pos:line="191" pos:column="5">memmove<pos:position pos:line="191" pos:column="12"/></name><argument_list pos:line="191" pos:column="12">(<argument><expr><operator pos:line="191" pos:column="13">&amp;<pos:position pos:line="191" pos:column="18"/></operator><name><name pos:line="191" pos:column="14">path<pos:position pos:line="191" pos:column="18"/></name><index pos:line="191" pos:column="18">[<expr><literal type="number" pos:line="191" pos:column="19">1<pos:position pos:line="191" pos:column="20"/></literal></expr>]<pos:position pos:line="191" pos:column="21"/></index></name></expr></argument>, <argument><expr><name pos:line="191" pos:column="23">path<pos:position pos:line="191" pos:column="27"/></name></expr></argument>, <argument><expr><call><name pos:line="191" pos:column="29">strlen<pos:position pos:line="191" pos:column="35"/></name><argument_list pos:line="191" pos:column="35">(<argument><expr><name pos:line="191" pos:column="36">path<pos:position pos:line="191" pos:column="40"/></name></expr></argument>)<pos:position pos:line="191" pos:column="41"/></argument_list></call><operator pos:line="191" pos:column="41">+<pos:position pos:line="191" pos:column="42"/></operator><literal type="number" pos:line="191" pos:column="42">1<pos:position pos:line="191" pos:column="43"/></literal></expr></argument>)<pos:position pos:line="191" pos:column="44"/></argument_list></call></expr>;<pos:position pos:line="191" pos:column="45"/></expr_stmt>
    <expr_stmt><expr><name><name pos:line="192" pos:column="5">path<pos:position pos:line="192" pos:column="9"/></name><index pos:line="192" pos:column="9">[<expr><literal type="number" pos:line="192" pos:column="10">0<pos:position pos:line="192" pos:column="11"/></literal></expr>]<pos:position pos:line="192" pos:column="12"/></index></name> <operator pos:line="192" pos:column="13">=<pos:position pos:line="192" pos:column="14"/></operator> <literal type="char" pos:line="192" pos:column="15">'/'<pos:position pos:line="192" pos:column="18"/></literal></expr>;<pos:position pos:line="192" pos:column="19"/></expr_stmt>
    <expr_stmt><expr><name pos:line="193" pos:column="5">rebuild_url<pos:position pos:line="193" pos:column="16"/></name> <operator pos:line="193" pos:column="17">=<pos:position pos:line="193" pos:column="18"/></operator> <name pos:line="193" pos:column="19">TRUE<pos:position pos:line="193" pos:column="23"/></name></expr>;<pos:position pos:line="193" pos:column="24"/></expr_stmt>
  }<pos:position pos:line="194" pos:column="4"/></block></then>
  <else pos:line="195" pos:column="3">else <block pos:line="195" pos:column="8">{
    <comment type="block" pos:line="196" pos:column="5">/* sanitise paths and remove ../ and ./ sequences according to RFC3986 */</comment>
    <decl_stmt><decl><type><name pos:line="197" pos:column="5">char<pos:position pos:line="197" pos:column="9"/></name> <modifier pos:line="197" pos:column="10">*<pos:position pos:line="197" pos:column="11"/></modifier></type><name pos:line="197" pos:column="11">newp<pos:position pos:line="197" pos:column="15"/></name> <init pos:line="197" pos:column="16">= <expr><call><name pos:line="197" pos:column="18">Curl_dedotdotify<pos:position pos:line="197" pos:column="34"/></name><argument_list pos:line="197" pos:column="34">(<argument><expr><name pos:line="197" pos:column="35">path<pos:position pos:line="197" pos:column="39"/></name></expr></argument>)<pos:position pos:line="197" pos:column="40"/></argument_list></call></expr></init></decl>;<pos:position pos:line="197" pos:column="41"/></decl_stmt>
    <if pos:line="198" pos:column="5">if<condition pos:line="198" pos:column="7">(<expr><operator pos:line="198" pos:column="8">!<pos:position pos:line="198" pos:column="9"/></operator><name pos:line="198" pos:column="9">newp<pos:position pos:line="198" pos:column="13"/></name></expr>)<pos:position pos:line="198" pos:column="14"/></condition><then pos:line="198" pos:column="14">
      <block type="pseudo"><return pos:line="199" pos:column="7">return <expr><name pos:line="199" pos:column="14">CURLE_OUT_OF_MEMORY<pos:position pos:line="199" pos:column="33"/></name></expr>;<pos:position pos:line="199" pos:column="34"/></return></block></then></if>

    <if pos:line="201" pos:column="5">if<condition pos:line="201" pos:column="7">(<expr><call><name pos:line="201" pos:column="8">strcmp<pos:position pos:line="201" pos:column="14"/></name><argument_list pos:line="201" pos:column="14">(<argument><expr><name pos:line="201" pos:column="15">newp<pos:position pos:line="201" pos:column="19"/></name></expr></argument>, <argument><expr><name pos:line="201" pos:column="21">path<pos:position pos:line="201" pos:column="25"/></name></expr></argument>)<pos:position pos:line="201" pos:column="26"/></argument_list></call></expr>)<pos:position pos:line="201" pos:column="27"/></condition><then pos:line="201" pos:column="27"> <block pos:line="201" pos:column="28">{
      <expr_stmt><expr><name pos:line="202" pos:column="7">rebuild_url<pos:position pos:line="202" pos:column="18"/></name> <operator pos:line="202" pos:column="19">=<pos:position pos:line="202" pos:column="20"/></operator> <name pos:line="202" pos:column="21">TRUE<pos:position pos:line="202" pos:column="25"/></name></expr>;<pos:position pos:line="202" pos:column="26"/></expr_stmt>
      <expr_stmt><expr><call><name pos:line="203" pos:column="7">free<pos:position pos:line="203" pos:column="11"/></name><argument_list pos:line="203" pos:column="11">(<argument><expr><name><name pos:line="203" pos:column="12">data<pos:position pos:line="203" pos:column="16"/></name><operator pos:line="203" pos:column="16">-&gt;<pos:position pos:line="203" pos:column="21"/></operator><name pos:line="203" pos:column="18">state<pos:position pos:line="203" pos:column="23"/></name><operator pos:line="203" pos:column="23">.<pos:position pos:line="203" pos:column="24"/></operator><name pos:line="203" pos:column="24">pathbuffer<pos:position pos:line="203" pos:column="34"/></name></name></expr></argument>)<pos:position pos:line="203" pos:column="35"/></argument_list></call></expr>;<pos:position pos:line="203" pos:column="36"/></expr_stmt>
      <expr_stmt><expr><name><name pos:line="204" pos:column="7">data<pos:position pos:line="204" pos:column="11"/></name><operator pos:line="204" pos:column="11">-&gt;<pos:position pos:line="204" pos:column="16"/></operator><name pos:line="204" pos:column="13">state<pos:position pos:line="204" pos:column="18"/></name><operator pos:line="204" pos:column="18">.<pos:position pos:line="204" pos:column="19"/></operator><name pos:line="204" pos:column="19">pathbuffer<pos:position pos:line="204" pos:column="29"/></name></name> <operator pos:line="204" pos:column="30">=<pos:position pos:line="204" pos:column="31"/></operator> <name pos:line="204" pos:column="32">newp<pos:position pos:line="204" pos:column="36"/></name></expr>;<pos:position pos:line="204" pos:column="37"/></expr_stmt>
      <expr_stmt><expr><name><name pos:line="205" pos:column="7">data<pos:position pos:line="205" pos:column="11"/></name><operator pos:line="205" pos:column="11">-&gt;<pos:position pos:line="205" pos:column="16"/></operator><name pos:line="205" pos:column="13">state<pos:position pos:line="205" pos:column="18"/></name><operator pos:line="205" pos:column="18">.<pos:position pos:line="205" pos:column="19"/></operator><name pos:line="205" pos:column="19">path<pos:position pos:line="205" pos:column="23"/></name></name> <operator pos:line="205" pos:column="24">=<pos:position pos:line="205" pos:column="25"/></operator> <name pos:line="205" pos:column="26">newp<pos:position pos:line="205" pos:column="30"/></name></expr>;<pos:position pos:line="205" pos:column="31"/></expr_stmt>
      <expr_stmt><expr><name pos:line="206" pos:column="7">path<pos:position pos:line="206" pos:column="11"/></name> <operator pos:line="206" pos:column="12">=<pos:position pos:line="206" pos:column="13"/></operator> <name pos:line="206" pos:column="14">newp<pos:position pos:line="206" pos:column="18"/></name></expr>;<pos:position pos:line="206" pos:column="19"/></expr_stmt>
    }<pos:position pos:line="207" pos:column="6"/></block></then>
    <else pos:line="208" pos:column="5">else
      <block type="pseudo"><expr_stmt><expr><call><name pos:line="209" pos:column="7">free<pos:position pos:line="209" pos:column="11"/></name><argument_list pos:line="209" pos:column="11">(<argument><expr><name pos:line="209" pos:column="12">newp<pos:position pos:line="209" pos:column="16"/></name></expr></argument>)<pos:position pos:line="209" pos:column="17"/></argument_list></call></expr>;<pos:position pos:line="209" pos:column="18"/></expr_stmt></block></else></if>
  }<pos:position pos:line="210" pos:column="4"/></block></else></if>

  <comment type="block" pos:line="212" pos:column="3">/*
   * "rebuild_url" means that one or more URL components have been modified so
   * we need to generate an updated full version.  We need the corrected URL
   * when communicating over HTTP proxy and we don't know at this point if
   * we're using a proxy or not.
   */</comment>
  <if pos:line="218" pos:column="3">if<condition pos:line="218" pos:column="5">(<expr><name pos:line="218" pos:column="6">rebuild_url<pos:position pos:line="218" pos:column="17"/></name></expr>)<pos:position pos:line="218" pos:column="18"/></condition><then pos:line="218" pos:column="18"> <block pos:line="218" pos:column="19">{
    <decl_stmt><decl><type><name pos:line="219" pos:column="5">char<pos:position pos:line="219" pos:column="9"/></name> <modifier pos:line="219" pos:column="10">*<pos:position pos:line="219" pos:column="11"/></modifier></type><name pos:line="219" pos:column="11">reurl<pos:position pos:line="219" pos:column="16"/></name></decl>;<pos:position pos:line="219" pos:column="17"/></decl_stmt>

    <decl_stmt><decl><type><name pos:line="221" pos:column="5">size_t<pos:position pos:line="221" pos:column="11"/></name></type> <name pos:line="221" pos:column="12">plen<pos:position pos:line="221" pos:column="16"/></name> <init pos:line="221" pos:column="17">= <expr><call><name pos:line="221" pos:column="19">strlen<pos:position pos:line="221" pos:column="25"/></name><argument_list pos:line="221" pos:column="25">(<argument><expr><name pos:line="221" pos:column="26">path<pos:position pos:line="221" pos:column="30"/></name></expr></argument>)<pos:position pos:line="221" pos:column="31"/></argument_list></call></expr></init></decl>;<pos:position pos:line="221" pos:column="32"/></decl_stmt> <comment type="block" pos:line="221" pos:column="33">/* new path, should be 1 byte longer than
                                   the original */</comment>
    <decl_stmt><decl><type><name pos:line="223" pos:column="5">size_t<pos:position pos:line="223" pos:column="11"/></name></type> <name pos:line="223" pos:column="12">urllen<pos:position pos:line="223" pos:column="18"/></name> <init pos:line="223" pos:column="19">= <expr><call><name pos:line="223" pos:column="21">strlen<pos:position pos:line="223" pos:column="27"/></name><argument_list pos:line="223" pos:column="27">(<argument><expr><name><name pos:line="223" pos:column="28">data<pos:position pos:line="223" pos:column="32"/></name><operator pos:line="223" pos:column="32">-&gt;<pos:position pos:line="223" pos:column="37"/></operator><name pos:line="223" pos:column="34">change<pos:position pos:line="223" pos:column="40"/></name><operator pos:line="223" pos:column="40">.<pos:position pos:line="223" pos:column="41"/></operator><name pos:line="223" pos:column="41">url<pos:position pos:line="223" pos:column="44"/></name></name></expr></argument>)<pos:position pos:line="223" pos:column="45"/></argument_list></call></expr></init></decl>;<pos:position pos:line="223" pos:column="46"/></decl_stmt> <comment type="block" pos:line="223" pos:column="47">/* original URL length */</comment>

    <decl_stmt><decl><type><name pos:line="225" pos:column="5">size_t<pos:position pos:line="225" pos:column="11"/></name></type> <name pos:line="225" pos:column="12">prefixlen<pos:position pos:line="225" pos:column="21"/></name> <init pos:line="225" pos:column="22">= <expr><call><name pos:line="225" pos:column="24">strlen<pos:position pos:line="225" pos:column="30"/></name><argument_list pos:line="225" pos:column="30">(<argument><expr><name><name pos:line="225" pos:column="31">conn<pos:position pos:line="225" pos:column="35"/></name><operator pos:line="225" pos:column="35">-&gt;<pos:position pos:line="225" pos:column="40"/></operator><name pos:line="225" pos:column="37">host<pos:position pos:line="225" pos:column="41"/></name><operator pos:line="225" pos:column="41">.<pos:position pos:line="225" pos:column="42"/></operator><name pos:line="225" pos:column="42">name<pos:position pos:line="225" pos:column="46"/></name></name></expr></argument>)<pos:position pos:line="225" pos:column="47"/></argument_list></call></expr></init></decl>;<pos:position pos:line="225" pos:column="48"/></decl_stmt>

    <if pos:line="227" pos:column="5">if<condition pos:line="227" pos:column="7">(<expr><operator pos:line="227" pos:column="8">!<pos:position pos:line="227" pos:column="9"/></operator><operator pos:line="227" pos:column="9">*<pos:position pos:line="227" pos:column="10"/></operator><name pos:line="227" pos:column="10">prot_missing<pos:position pos:line="227" pos:column="22"/></name></expr>)<pos:position pos:line="227" pos:column="23"/></condition><then pos:line="227" pos:column="23">
      <block type="pseudo"><expr_stmt><expr><name pos:line="228" pos:column="7">prefixlen<pos:position pos:line="228" pos:column="16"/></name> <operator pos:line="228" pos:column="17">+=<pos:position pos:line="228" pos:column="19"/></operator> <call><name pos:line="228" pos:column="20">strlen<pos:position pos:line="228" pos:column="26"/></name><argument_list pos:line="228" pos:column="26">(<argument><expr><name pos:line="228" pos:column="27">protop<pos:position pos:line="228" pos:column="33"/></name></expr></argument>)<pos:position pos:line="228" pos:column="34"/></argument_list></call> <operator pos:line="228" pos:column="35">+<pos:position pos:line="228" pos:column="36"/></operator> <call><name pos:line="228" pos:column="37">strlen<pos:position pos:line="228" pos:column="43"/></name><argument_list pos:line="228" pos:column="43">(<argument><expr><literal type="string" pos:line="228" pos:column="44">"://"<pos:position pos:line="228" pos:column="49"/></literal></expr></argument>)<pos:position pos:line="228" pos:column="50"/></argument_list></call></expr>;<pos:position pos:line="228" pos:column="51"/></expr_stmt></block></then></if>

    <expr_stmt><expr><name pos:line="230" pos:column="5">reurl<pos:position pos:line="230" pos:column="10"/></name> <operator pos:line="230" pos:column="11">=<pos:position pos:line="230" pos:column="12"/></operator> <call><name pos:line="230" pos:column="13">malloc<pos:position pos:line="230" pos:column="19"/></name><argument_list pos:line="230" pos:column="19">(<argument><expr><name pos:line="230" pos:column="20">urllen<pos:position pos:line="230" pos:column="26"/></name> <operator pos:line="230" pos:column="27">+<pos:position pos:line="230" pos:column="28"/></operator> <literal type="number" pos:line="230" pos:column="29">2<pos:position pos:line="230" pos:column="30"/></literal></expr></argument>)<pos:position pos:line="230" pos:column="31"/></argument_list></call></expr>;<pos:position pos:line="230" pos:column="32"/></expr_stmt> <comment type="block" pos:line="230" pos:column="33">/* 2 for zerobyte + slash */</comment>
    <if pos:line="231" pos:column="5">if<condition pos:line="231" pos:column="7">(<expr><operator pos:line="231" pos:column="8">!<pos:position pos:line="231" pos:column="9"/></operator><name pos:line="231" pos:column="9">reurl<pos:position pos:line="231" pos:column="14"/></name></expr>)<pos:position pos:line="231" pos:column="15"/></condition><then pos:line="231" pos:column="15">
      <block type="pseudo"><return pos:line="232" pos:column="7">return <expr><name pos:line="232" pos:column="14">CURLE_OUT_OF_MEMORY<pos:position pos:line="232" pos:column="33"/></name></expr>;<pos:position pos:line="232" pos:column="34"/></return></block></then></if>

    <comment type="block" pos:line="234" pos:column="5">/* copy the prefix */</comment>
    <expr_stmt><expr><call><name pos:line="235" pos:column="5">memcpy<pos:position pos:line="235" pos:column="11"/></name><argument_list pos:line="235" pos:column="11">(<argument><expr><name pos:line="235" pos:column="12">reurl<pos:position pos:line="235" pos:column="17"/></name></expr></argument>, <argument><expr><name><name pos:line="235" pos:column="19">data<pos:position pos:line="235" pos:column="23"/></name><operator pos:line="235" pos:column="23">-&gt;<pos:position pos:line="235" pos:column="28"/></operator><name pos:line="235" pos:column="25">change<pos:position pos:line="235" pos:column="31"/></name><operator pos:line="235" pos:column="31">.<pos:position pos:line="235" pos:column="32"/></operator><name pos:line="235" pos:column="32">url<pos:position pos:line="235" pos:column="35"/></name></name></expr></argument>, <argument><expr><name pos:line="235" pos:column="37">prefixlen<pos:position pos:line="235" pos:column="46"/></name></expr></argument>)<pos:position pos:line="235" pos:column="47"/></argument_list></call></expr>;<pos:position pos:line="235" pos:column="48"/></expr_stmt>

    <comment type="block" pos:line="237" pos:column="5">/* append the trailing piece + zerobyte */</comment>
    <expr_stmt><expr><call><name pos:line="238" pos:column="5">memcpy<pos:position pos:line="238" pos:column="11"/></name><argument_list pos:line="238" pos:column="11">(<argument><expr><operator pos:line="238" pos:column="12">&amp;<pos:position pos:line="238" pos:column="17"/></operator><name><name pos:line="238" pos:column="13">reurl<pos:position pos:line="238" pos:column="18"/></name><index pos:line="238" pos:column="18">[<expr><name pos:line="238" pos:column="19">prefixlen<pos:position pos:line="238" pos:column="28"/></name></expr>]<pos:position pos:line="238" pos:column="29"/></index></name></expr></argument>, <argument><expr><name pos:line="238" pos:column="31">path<pos:position pos:line="238" pos:column="35"/></name></expr></argument>, <argument><expr><name pos:line="238" pos:column="37">plen<pos:position pos:line="238" pos:column="41"/></name> <operator pos:line="238" pos:column="42">+<pos:position pos:line="238" pos:column="43"/></operator> <literal type="number" pos:line="238" pos:column="44">1<pos:position pos:line="238" pos:column="45"/></literal></expr></argument>)<pos:position pos:line="238" pos:column="46"/></argument_list></call></expr>;<pos:position pos:line="238" pos:column="47"/></expr_stmt>

    <comment type="block" pos:line="240" pos:column="5">/* possible free the old one */</comment>
    <if pos:line="241" pos:column="5">if<condition pos:line="241" pos:column="7">(<expr><name><name pos:line="241" pos:column="8">data<pos:position pos:line="241" pos:column="12"/></name><operator pos:line="241" pos:column="12">-&gt;<pos:position pos:line="241" pos:column="17"/></operator><name pos:line="241" pos:column="14">change<pos:position pos:line="241" pos:column="20"/></name><operator pos:line="241" pos:column="20">.<pos:position pos:line="241" pos:column="21"/></operator><name pos:line="241" pos:column="21">url_alloc<pos:position pos:line="241" pos:column="30"/></name></name></expr>)<pos:position pos:line="241" pos:column="31"/></condition><then pos:line="241" pos:column="31"> <block pos:line="241" pos:column="32">{
      <expr_stmt><expr><call><name pos:line="242" pos:column="7">Curl_safefree<pos:position pos:line="242" pos:column="20"/></name><argument_list pos:line="242" pos:column="20">(<argument><expr><name><name pos:line="242" pos:column="21">data<pos:position pos:line="242" pos:column="25"/></name><operator pos:line="242" pos:column="25">-&gt;<pos:position pos:line="242" pos:column="30"/></operator><name pos:line="242" pos:column="27">change<pos:position pos:line="242" pos:column="33"/></name><operator pos:line="242" pos:column="33">.<pos:position pos:line="242" pos:column="34"/></operator><name pos:line="242" pos:column="34">url<pos:position pos:line="242" pos:column="37"/></name></name></expr></argument>)<pos:position pos:line="242" pos:column="38"/></argument_list></call></expr>;<pos:position pos:line="242" pos:column="39"/></expr_stmt>
      <expr_stmt><expr><name><name pos:line="243" pos:column="7">data<pos:position pos:line="243" pos:column="11"/></name><operator pos:line="243" pos:column="11">-&gt;<pos:position pos:line="243" pos:column="16"/></operator><name pos:line="243" pos:column="13">change<pos:position pos:line="243" pos:column="19"/></name><operator pos:line="243" pos:column="19">.<pos:position pos:line="243" pos:column="20"/></operator><name pos:line="243" pos:column="20">url_alloc<pos:position pos:line="243" pos:column="29"/></name></name> <operator pos:line="243" pos:column="30">=<pos:position pos:line="243" pos:column="31"/></operator> <name pos:line="243" pos:column="32">FALSE<pos:position pos:line="243" pos:column="37"/></name></expr>;<pos:position pos:line="243" pos:column="38"/></expr_stmt>
    }<pos:position pos:line="244" pos:column="6"/></block></then></if>

    <expr_stmt><expr><call><name pos:line="246" pos:column="5">infof<pos:position pos:line="246" pos:column="10"/></name><argument_list pos:line="246" pos:column="10">(<argument><expr><name pos:line="246" pos:column="11">data<pos:position pos:line="246" pos:column="15"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="246" pos:column="17">"Rebuilt URL to: %s\n"<pos:position pos:line="246" pos:column="39"/></literal></expr></argument>, <argument><expr><name pos:line="246" pos:column="41">reurl<pos:position pos:line="246" pos:column="46"/></name></expr></argument>)<pos:position pos:line="246" pos:column="47"/></argument_list></call></expr>;<pos:position pos:line="246" pos:column="48"/></expr_stmt>

    <expr_stmt><expr><name><name pos:line="248" pos:column="5">data<pos:position pos:line="248" pos:column="9"/></name><operator pos:line="248" pos:column="9">-&gt;<pos:position pos:line="248" pos:column="14"/></operator><name pos:line="248" pos:column="11">change<pos:position pos:line="248" pos:column="17"/></name><operator pos:line="248" pos:column="17">.<pos:position pos:line="248" pos:column="18"/></operator><name pos:line="248" pos:column="18">url<pos:position pos:line="248" pos:column="21"/></name></name> <operator pos:line="248" pos:column="22">=<pos:position pos:line="248" pos:column="23"/></operator> <name pos:line="248" pos:column="24">reurl<pos:position pos:line="248" pos:column="29"/></name></expr>;<pos:position pos:line="248" pos:column="30"/></expr_stmt>
    <expr_stmt><expr><name><name pos:line="249" pos:column="5">data<pos:position pos:line="249" pos:column="9"/></name><operator pos:line="249" pos:column="9">-&gt;<pos:position pos:line="249" pos:column="14"/></operator><name pos:line="249" pos:column="11">change<pos:position pos:line="249" pos:column="17"/></name><operator pos:line="249" pos:column="17">.<pos:position pos:line="249" pos:column="18"/></operator><name pos:line="249" pos:column="18">url_alloc<pos:position pos:line="249" pos:column="27"/></name></name> <operator pos:line="249" pos:column="28">=<pos:position pos:line="249" pos:column="29"/></operator> <name pos:line="249" pos:column="30">TRUE<pos:position pos:line="249" pos:column="34"/></name></expr>;<pos:position pos:line="249" pos:column="35"/></expr_stmt> <comment type="block" pos:line="249" pos:column="36">/* free this later */</comment>
  }<pos:position pos:line="250" pos:column="4"/></block></then></if>

  <comment type="block" pos:line="252" pos:column="3">/*
   * Parse the login details from the URL and strip them out of
   * the host name
   */</comment>
  <expr_stmt><expr><name pos:line="256" pos:column="3">result<pos:position pos:line="256" pos:column="9"/></name> <operator pos:line="256" pos:column="10">=<pos:position pos:line="256" pos:column="11"/></operator> <call><name pos:line="256" pos:column="12">parse_url_login<pos:position pos:line="256" pos:column="27"/></name><argument_list pos:line="256" pos:column="27">(<argument><expr><name pos:line="256" pos:column="28">data<pos:position pos:line="256" pos:column="32"/></name></expr></argument>, <argument><expr><name pos:line="256" pos:column="34">conn<pos:position pos:line="256" pos:column="38"/></name></expr></argument>, <argument><expr><name pos:line="256" pos:column="40">userp<pos:position pos:line="256" pos:column="45"/></name></expr></argument>, <argument><expr><name pos:line="256" pos:column="47">passwdp<pos:position pos:line="256" pos:column="54"/></name></expr></argument>, <argument><expr><name pos:line="256" pos:column="56">optionsp<pos:position pos:line="256" pos:column="64"/></name></expr></argument>)<pos:position pos:line="256" pos:column="65"/></argument_list></call></expr>;<pos:position pos:line="256" pos:column="66"/></expr_stmt>
  <if pos:line="257" pos:column="3">if<condition pos:line="257" pos:column="5">(<expr><name pos:line="257" pos:column="6">result<pos:position pos:line="257" pos:column="12"/></name></expr>)<pos:position pos:line="257" pos:column="13"/></condition><then pos:line="257" pos:column="13">
    <block type="pseudo"><return pos:line="258" pos:column="5">return <expr><name pos:line="258" pos:column="12">result<pos:position pos:line="258" pos:column="18"/></name></expr>;<pos:position pos:line="258" pos:column="19"/></return></block></then></if>

  <if pos:line="260" pos:column="3">if<condition pos:line="260" pos:column="5">(<expr><name><name pos:line="260" pos:column="6">conn<pos:position pos:line="260" pos:column="10"/></name><operator pos:line="260" pos:column="10">-&gt;<pos:position pos:line="260" pos:column="15"/></operator><name pos:line="260" pos:column="12">host<pos:position pos:line="260" pos:column="16"/></name><operator pos:line="260" pos:column="16">.<pos:position pos:line="260" pos:column="17"/></operator><name pos:line="260" pos:column="17">name<pos:position pos:line="260" pos:column="21"/></name><index pos:line="260" pos:column="21">[<expr><literal type="number" pos:line="260" pos:column="22">0<pos:position pos:line="260" pos:column="23"/></literal></expr>]<pos:position pos:line="260" pos:column="24"/></index></name> <operator pos:line="260" pos:column="25">==<pos:position pos:line="260" pos:column="27"/></operator> <literal type="char" pos:line="260" pos:column="28">'['<pos:position pos:line="260" pos:column="31"/></literal></expr>)<pos:position pos:line="260" pos:column="32"/></condition><then pos:line="260" pos:column="32"> <block pos:line="260" pos:column="33">{
    <comment type="block" pos:line="261" pos:column="5">/* This looks like an IPv6 address literal.  See if there is an address
       scope if there is no location header */</comment>
    <decl_stmt><decl><type><name pos:line="263" pos:column="5">char<pos:position pos:line="263" pos:column="9"/></name> <modifier pos:line="263" pos:column="10">*<pos:position pos:line="263" pos:column="11"/></modifier></type><name pos:line="263" pos:column="11">percent<pos:position pos:line="263" pos:column="18"/></name> <init pos:line="263" pos:column="19">= <expr><call><name pos:line="263" pos:column="21">strchr<pos:position pos:line="263" pos:column="27"/></name><argument_list pos:line="263" pos:column="27">(<argument><expr><name><name pos:line="263" pos:column="28">conn<pos:position pos:line="263" pos:column="32"/></name><operator pos:line="263" pos:column="32">-&gt;<pos:position pos:line="263" pos:column="37"/></operator><name pos:line="263" pos:column="34">host<pos:position pos:line="263" pos:column="38"/></name><operator pos:line="263" pos:column="38">.<pos:position pos:line="263" pos:column="39"/></operator><name pos:line="263" pos:column="39">name<pos:position pos:line="263" pos:column="43"/></name></name></expr></argument>, <argument><expr><literal type="char" pos:line="263" pos:column="45">'%'<pos:position pos:line="263" pos:column="48"/></literal></expr></argument>)<pos:position pos:line="263" pos:column="49"/></argument_list></call></expr></init></decl>;<pos:position pos:line="263" pos:column="50"/></decl_stmt>
    <if pos:line="264" pos:column="5">if<condition pos:line="264" pos:column="7">(<expr><name pos:line="264" pos:column="8">percent<pos:position pos:line="264" pos:column="15"/></name></expr>)<pos:position pos:line="264" pos:column="16"/></condition><then pos:line="264" pos:column="16"> <block pos:line="264" pos:column="17">{
      <decl_stmt><decl><type><name pos:line="265" pos:column="7">unsigned<pos:position pos:line="265" pos:column="15"/></name> <name pos:line="265" pos:column="16">int<pos:position pos:line="265" pos:column="19"/></name></type> <name pos:line="265" pos:column="20">identifier_offset<pos:position pos:line="265" pos:column="37"/></name> <init pos:line="265" pos:column="38">= <expr><literal type="number" pos:line="265" pos:column="40">3<pos:position pos:line="265" pos:column="41"/></literal></expr></init></decl>;<pos:position pos:line="265" pos:column="42"/></decl_stmt>
      <decl_stmt><decl><type><name pos:line="266" pos:column="7">char<pos:position pos:line="266" pos:column="11"/></name> <modifier pos:line="266" pos:column="12">*<pos:position pos:line="266" pos:column="13"/></modifier></type><name pos:line="266" pos:column="13">endp<pos:position pos:line="266" pos:column="17"/></name></decl>;<pos:position pos:line="266" pos:column="18"/></decl_stmt>
      <decl_stmt><decl><type><name pos:line="267" pos:column="7">unsigned<pos:position pos:line="267" pos:column="15"/></name> <name pos:line="267" pos:column="16">long<pos:position pos:line="267" pos:column="20"/></name></type> <name pos:line="267" pos:column="21">scope<pos:position pos:line="267" pos:column="26"/></name></decl>;<pos:position pos:line="267" pos:column="27"/></decl_stmt>
      <if pos:line="268" pos:column="7">if<condition pos:line="268" pos:column="9">(<expr><call><name pos:line="268" pos:column="10">strncmp<pos:position pos:line="268" pos:column="17"/></name><argument_list pos:line="268" pos:column="17">(<argument><expr><literal type="string" pos:line="268" pos:column="18">"%25"<pos:position pos:line="268" pos:column="23"/></literal></expr></argument>, <argument><expr><name pos:line="268" pos:column="25">percent<pos:position pos:line="268" pos:column="32"/></name></expr></argument>, <argument><expr><literal type="number" pos:line="268" pos:column="34">3<pos:position pos:line="268" pos:column="35"/></literal></expr></argument>)<pos:position pos:line="268" pos:column="36"/></argument_list></call> <operator pos:line="268" pos:column="37">!=<pos:position pos:line="268" pos:column="39"/></operator> <literal type="number" pos:line="268" pos:column="40">0<pos:position pos:line="268" pos:column="41"/></literal></expr>)<pos:position pos:line="268" pos:column="42"/></condition><then pos:line="268" pos:column="42"> <block pos:line="268" pos:column="43">{
        <expr_stmt><expr><call><name pos:line="269" pos:column="9">infof<pos:position pos:line="269" pos:column="14"/></name><argument_list pos:line="269" pos:column="14">(<argument><expr><name pos:line="269" pos:column="15">data<pos:position pos:line="269" pos:column="19"/></name></expr></argument>,
              <argument><expr><literal type="string" pos:line="270" pos:column="15">"Please URL encode %% as %%25, see RFC 6874.\n"<pos:position pos:line="270" pos:column="62"/></literal></expr></argument>)<pos:position pos:line="270" pos:column="63"/></argument_list></call></expr>;<pos:position pos:line="270" pos:column="64"/></expr_stmt>
        <expr_stmt><expr><name pos:line="271" pos:column="9">identifier_offset<pos:position pos:line="271" pos:column="26"/></name> <operator pos:line="271" pos:column="27">=<pos:position pos:line="271" pos:column="28"/></operator> <literal type="number" pos:line="271" pos:column="29">1<pos:position pos:line="271" pos:column="30"/></literal></expr>;<pos:position pos:line="271" pos:column="31"/></expr_stmt>
      }<pos:position pos:line="272" pos:column="8"/></block></then></if>
      <expr_stmt><expr><name pos:line="273" pos:column="7">scope<pos:position pos:line="273" pos:column="12"/></name> <operator pos:line="273" pos:column="13">=<pos:position pos:line="273" pos:column="14"/></operator> <call><name pos:line="273" pos:column="15">strtoul<pos:position pos:line="273" pos:column="22"/></name><argument_list pos:line="273" pos:column="22">(<argument><expr><name pos:line="273" pos:column="23">percent<pos:position pos:line="273" pos:column="30"/></name> <operator pos:line="273" pos:column="31">+<pos:position pos:line="273" pos:column="32"/></operator> <name pos:line="273" pos:column="33">identifier_offset<pos:position pos:line="273" pos:column="50"/></name></expr></argument>, <argument><expr><operator pos:line="273" pos:column="52">&amp;<pos:position pos:line="273" pos:column="57"/></operator><name pos:line="273" pos:column="53">endp<pos:position pos:line="273" pos:column="57"/></name></expr></argument>, <argument><expr><literal type="number" pos:line="273" pos:column="59">10<pos:position pos:line="273" pos:column="61"/></literal></expr></argument>)<pos:position pos:line="273" pos:column="62"/></argument_list></call></expr>;<pos:position pos:line="273" pos:column="63"/></expr_stmt>
      <if pos:line="274" pos:column="7">if<condition pos:line="274" pos:column="9">(<expr><operator pos:line="274" pos:column="10">*<pos:position pos:line="274" pos:column="11"/></operator><name pos:line="274" pos:column="11">endp<pos:position pos:line="274" pos:column="15"/></name> <operator pos:line="274" pos:column="16">==<pos:position pos:line="274" pos:column="18"/></operator> <literal type="char" pos:line="274" pos:column="19">']'<pos:position pos:line="274" pos:column="22"/></literal></expr>)<pos:position pos:line="274" pos:column="23"/></condition><then pos:line="274" pos:column="23"> <block pos:line="274" pos:column="24">{
        <comment type="block" pos:line="275" pos:column="9">/* The address scope was well formed.  Knock it out of the
           hostname. */</comment>
        <expr_stmt><expr><call><name pos:line="277" pos:column="9">memmove<pos:position pos:line="277" pos:column="16"/></name><argument_list pos:line="277" pos:column="16">(<argument><expr><name pos:line="277" pos:column="17">percent<pos:position pos:line="277" pos:column="24"/></name></expr></argument>, <argument><expr><name pos:line="277" pos:column="26">endp<pos:position pos:line="277" pos:column="30"/></name></expr></argument>, <argument><expr><call><name pos:line="277" pos:column="32">strlen<pos:position pos:line="277" pos:column="38"/></name><argument_list pos:line="277" pos:column="38">(<argument><expr><name pos:line="277" pos:column="39">endp<pos:position pos:line="277" pos:column="43"/></name></expr></argument>)<pos:position pos:line="277" pos:column="44"/></argument_list></call><operator pos:line="277" pos:column="44">+<pos:position pos:line="277" pos:column="45"/></operator><literal type="number" pos:line="277" pos:column="45">1<pos:position pos:line="277" pos:column="46"/></literal></expr></argument>)<pos:position pos:line="277" pos:column="47"/></argument_list></call></expr>;<pos:position pos:line="277" pos:column="48"/></expr_stmt>
        <expr_stmt><expr><name><name pos:line="278" pos:column="9">conn<pos:position pos:line="278" pos:column="13"/></name><operator pos:line="278" pos:column="13">-&gt;<pos:position pos:line="278" pos:column="18"/></operator><name pos:line="278" pos:column="15">scope_id<pos:position pos:line="278" pos:column="23"/></name></name> <operator pos:line="278" pos:column="24">=<pos:position pos:line="278" pos:column="25"/></operator> <operator pos:line="278" pos:column="26">(<pos:position pos:line="278" pos:column="27"/></operator><name pos:line="278" pos:column="27">unsigned<pos:position pos:line="278" pos:column="35"/></name> <name pos:line="278" pos:column="36">int<pos:position pos:line="278" pos:column="39"/></name><operator pos:line="278" pos:column="39">)<pos:position pos:line="278" pos:column="40"/></operator><name pos:line="278" pos:column="40">scope<pos:position pos:line="278" pos:column="45"/></name></expr>;<pos:position pos:line="278" pos:column="46"/></expr_stmt>
      }<pos:position pos:line="279" pos:column="8"/></block></then>
      <else pos:line="280" pos:column="7">else <block pos:line="280" pos:column="12">{
        <comment type="block" pos:line="281" pos:column="9">/* Zone identifier is not numeric */</comment>
<cpp:if pos:line="282" pos:column="1">#<cpp:directive pos:line="282" pos:column="2">if<pos:position pos:line="282" pos:column="4"/></cpp:directive> <expr><call><name pos:line="282" pos:column="5">defined<pos:position pos:line="282" pos:column="12"/></name><argument_list pos:line="282" pos:column="12">(<argument><expr><name pos:line="282" pos:column="13">HAVE_NET_IF_H<pos:position pos:line="282" pos:column="26"/></name></expr></argument>)<pos:position pos:line="282" pos:column="27"/></argument_list></call> <operator pos:line="282" pos:column="28">&amp;&amp;<pos:position pos:line="282" pos:column="38"/></operator> <call><name pos:line="282" pos:column="31">defined<pos:position pos:line="282" pos:column="38"/></name><argument_list pos:line="282" pos:column="38">(<argument><expr><name pos:line="282" pos:column="39">IFNAMSIZ<pos:position pos:line="282" pos:column="47"/></name></expr></argument>)<pos:position pos:line="282" pos:column="48"/></argument_list></call> <operator pos:line="282" pos:column="49">&amp;&amp;<pos:position pos:line="282" pos:column="59"/></operator> <call><name pos:line="282" pos:column="52">defined<pos:position pos:line="282" pos:column="59"/></name><argument_list pos:line="282" pos:column="59">(<argument><expr><name pos:line="282" pos:column="60">HAVE_IF_NAMETOINDEX<pos:position pos:line="282" pos:column="79"/></name></expr></argument>)<pos:position pos:line="282" pos:column="80"/></argument_list></call></expr></cpp:if>
        <decl_stmt><decl><type><name pos:line="283" pos:column="9">char<pos:position pos:line="283" pos:column="13"/></name></type> <name><name pos:line="283" pos:column="14">ifname<pos:position pos:line="283" pos:column="20"/></name><index pos:line="283" pos:column="20">[<expr><name pos:line="283" pos:column="21">IFNAMSIZ<pos:position pos:line="283" pos:column="29"/></name> <operator pos:line="283" pos:column="30">+<pos:position pos:line="283" pos:column="31"/></operator> <literal type="number" pos:line="283" pos:column="32">2<pos:position pos:line="283" pos:column="33"/></literal></expr>]<pos:position pos:line="283" pos:column="34"/></index></name></decl>;<pos:position pos:line="283" pos:column="35"/></decl_stmt>
        <decl_stmt><decl><type><name pos:line="284" pos:column="9">char<pos:position pos:line="284" pos:column="13"/></name> <modifier pos:line="284" pos:column="14">*<pos:position pos:line="284" pos:column="15"/></modifier></type><name pos:line="284" pos:column="15">square_bracket<pos:position pos:line="284" pos:column="29"/></name></decl>;<pos:position pos:line="284" pos:column="30"/></decl_stmt>
        <decl_stmt><decl><type><name pos:line="285" pos:column="9">unsigned<pos:position pos:line="285" pos:column="17"/></name> <name pos:line="285" pos:column="18">int<pos:position pos:line="285" pos:column="21"/></name></type> <name pos:line="285" pos:column="22">scopeidx<pos:position pos:line="285" pos:column="30"/></name> <init pos:line="285" pos:column="31">= <expr><literal type="number" pos:line="285" pos:column="33">0<pos:position pos:line="285" pos:column="34"/></literal></expr></init></decl>;<pos:position pos:line="285" pos:column="35"/></decl_stmt>
        <expr_stmt><expr><call><name pos:line="286" pos:column="9">strncpy<pos:position pos:line="286" pos:column="16"/></name><argument_list pos:line="286" pos:column="16">(<argument><expr><name pos:line="286" pos:column="17">ifname<pos:position pos:line="286" pos:column="23"/></name></expr></argument>, <argument><expr><name pos:line="286" pos:column="25">percent<pos:position pos:line="286" pos:column="32"/></name> <operator pos:line="286" pos:column="33">+<pos:position pos:line="286" pos:column="34"/></operator> <name pos:line="286" pos:column="35">identifier_offset<pos:position pos:line="286" pos:column="52"/></name></expr></argument>, <argument><expr><name pos:line="286" pos:column="54">IFNAMSIZ<pos:position pos:line="286" pos:column="62"/></name> <operator pos:line="286" pos:column="63">+<pos:position pos:line="286" pos:column="64"/></operator> <literal type="number" pos:line="286" pos:column="65">2<pos:position pos:line="286" pos:column="66"/></literal></expr></argument>)<pos:position pos:line="286" pos:column="67"/></argument_list></call></expr>;<pos:position pos:line="286" pos:column="68"/></expr_stmt>
        <comment type="block" pos:line="287" pos:column="9">/* Ensure nullbyte termination */</comment>
        <expr_stmt><expr><name><name pos:line="288" pos:column="9">ifname<pos:position pos:line="288" pos:column="15"/></name><index pos:line="288" pos:column="15">[<expr><name pos:line="288" pos:column="16">IFNAMSIZ<pos:position pos:line="288" pos:column="24"/></name> <operator pos:line="288" pos:column="25">+<pos:position pos:line="288" pos:column="26"/></operator> <literal type="number" pos:line="288" pos:column="27">1<pos:position pos:line="288" pos:column="28"/></literal></expr>]<pos:position pos:line="288" pos:column="29"/></index></name> <operator pos:line="288" pos:column="30">=<pos:position pos:line="288" pos:column="31"/></operator> <literal type="char" pos:line="288" pos:column="32">'\0'<pos:position pos:line="288" pos:column="36"/></literal></expr>;<pos:position pos:line="288" pos:column="37"/></expr_stmt>
        <expr_stmt><expr><name pos:line="289" pos:column="9">square_bracket<pos:position pos:line="289" pos:column="23"/></name> <operator pos:line="289" pos:column="24">=<pos:position pos:line="289" pos:column="25"/></operator> <call><name pos:line="289" pos:column="26">strchr<pos:position pos:line="289" pos:column="32"/></name><argument_list pos:line="289" pos:column="32">(<argument><expr><name pos:line="289" pos:column="33">ifname<pos:position pos:line="289" pos:column="39"/></name></expr></argument>, <argument><expr><literal type="char" pos:line="289" pos:column="41">']'<pos:position pos:line="289" pos:column="44"/></literal></expr></argument>)<pos:position pos:line="289" pos:column="45"/></argument_list></call></expr>;<pos:position pos:line="289" pos:column="46"/></expr_stmt>
        <if pos:line="290" pos:column="9">if<condition pos:line="290" pos:column="11">(<expr><name pos:line="290" pos:column="12">square_bracket<pos:position pos:line="290" pos:column="26"/></name></expr>)<pos:position pos:line="290" pos:column="27"/></condition><then pos:line="290" pos:column="27"> <block pos:line="290" pos:column="28">{
          <comment type="block" pos:line="291" pos:column="11">/* Remove ']' */</comment>
          <expr_stmt><expr><operator pos:line="292" pos:column="11">*<pos:position pos:line="292" pos:column="12"/></operator><name pos:line="292" pos:column="12">square_bracket<pos:position pos:line="292" pos:column="26"/></name> <operator pos:line="292" pos:column="27">=<pos:position pos:line="292" pos:column="28"/></operator> <literal type="char" pos:line="292" pos:column="29">'\0'<pos:position pos:line="292" pos:column="33"/></literal></expr>;<pos:position pos:line="292" pos:column="34"/></expr_stmt>
          <expr_stmt><expr><name pos:line="293" pos:column="11">scopeidx<pos:position pos:line="293" pos:column="19"/></name> <operator pos:line="293" pos:column="20">=<pos:position pos:line="293" pos:column="21"/></operator> <call><name pos:line="293" pos:column="22">if_nametoindex<pos:position pos:line="293" pos:column="36"/></name><argument_list pos:line="293" pos:column="36">(<argument><expr><name pos:line="293" pos:column="37">ifname<pos:position pos:line="293" pos:column="43"/></name></expr></argument>)<pos:position pos:line="293" pos:column="44"/></argument_list></call></expr>;<pos:position pos:line="293" pos:column="45"/></expr_stmt>
          <if pos:line="294" pos:column="11">if<condition pos:line="294" pos:column="13">(<expr><name pos:line="294" pos:column="14">scopeidx<pos:position pos:line="294" pos:column="22"/></name> <operator pos:line="294" pos:column="23">==<pos:position pos:line="294" pos:column="25"/></operator> <literal type="number" pos:line="294" pos:column="26">0<pos:position pos:line="294" pos:column="27"/></literal></expr>)<pos:position pos:line="294" pos:column="28"/></condition><then pos:line="294" pos:column="28"> <block pos:line="294" pos:column="29">{
            <expr_stmt><expr><call><name pos:line="295" pos:column="13">infof<pos:position pos:line="295" pos:column="18"/></name><argument_list pos:line="295" pos:column="18">(<argument><expr><name pos:line="295" pos:column="19">data<pos:position pos:line="295" pos:column="23"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="295" pos:column="25">"Invalid network interface: %s; %s\n"<pos:position pos:line="295" pos:column="62"/></literal></expr></argument>, <argument><expr><name pos:line="295" pos:column="64">ifname<pos:position pos:line="295" pos:column="70"/></name></expr></argument>,
                  <argument><expr><call><name pos:line="296" pos:column="19">strerror<pos:position pos:line="296" pos:column="27"/></name><argument_list pos:line="296" pos:column="27">(<argument><expr><name pos:line="296" pos:column="28">errno<pos:position pos:line="296" pos:column="33"/></name></expr></argument>)<pos:position pos:line="296" pos:column="34"/></argument_list></call></expr></argument>)<pos:position pos:line="296" pos:column="35"/></argument_list></call></expr>;<pos:position pos:line="296" pos:column="36"/></expr_stmt>
          }<pos:position pos:line="297" pos:column="12"/></block></then></if>
        }<pos:position pos:line="298" pos:column="10"/></block></then></if>
        <if pos:line="299" pos:column="9">if<condition pos:line="299" pos:column="11">(<expr><name pos:line="299" pos:column="12">scopeidx<pos:position pos:line="299" pos:column="20"/></name> <operator pos:line="299" pos:column="21">&gt;<pos:position pos:line="299" pos:column="25"/></operator> <literal type="number" pos:line="299" pos:column="23">0<pos:position pos:line="299" pos:column="24"/></literal></expr>)<pos:position pos:line="299" pos:column="25"/></condition><then pos:line="299" pos:column="25"> <block pos:line="299" pos:column="26">{
          <decl_stmt><decl><type><name pos:line="300" pos:column="11">char<pos:position pos:line="300" pos:column="15"/></name> <modifier pos:line="300" pos:column="16">*<pos:position pos:line="300" pos:column="17"/></modifier></type><name pos:line="300" pos:column="17">p<pos:position pos:line="300" pos:column="18"/></name> <init pos:line="300" pos:column="19">= <expr><name pos:line="300" pos:column="21">percent<pos:position pos:line="300" pos:column="28"/></name> <operator pos:line="300" pos:column="29">+<pos:position pos:line="300" pos:column="30"/></operator> <name pos:line="300" pos:column="31">identifier_offset<pos:position pos:line="300" pos:column="48"/></name> <operator pos:line="300" pos:column="49">+<pos:position pos:line="300" pos:column="50"/></operator> <call><name pos:line="300" pos:column="51">strlen<pos:position pos:line="300" pos:column="57"/></name><argument_list pos:line="300" pos:column="57">(<argument><expr><name pos:line="300" pos:column="58">ifname<pos:position pos:line="300" pos:column="64"/></name></expr></argument>)<pos:position pos:line="300" pos:column="65"/></argument_list></call></expr></init></decl>;<pos:position pos:line="300" pos:column="66"/></decl_stmt>

          <comment type="block" pos:line="302" pos:column="11">/* Remove zone identifier from hostname */</comment>
          <expr_stmt><expr><call><name pos:line="303" pos:column="11">memmove<pos:position pos:line="303" pos:column="18"/></name><argument_list pos:line="303" pos:column="18">(<argument><expr><name pos:line="303" pos:column="19">percent<pos:position pos:line="303" pos:column="26"/></name></expr></argument>, <argument><expr><name pos:line="303" pos:column="28">p<pos:position pos:line="303" pos:column="29"/></name></expr></argument>, <argument><expr><call><name pos:line="303" pos:column="31">strlen<pos:position pos:line="303" pos:column="37"/></name><argument_list pos:line="303" pos:column="37">(<argument><expr><name pos:line="303" pos:column="38">p<pos:position pos:line="303" pos:column="39"/></name></expr></argument>)<pos:position pos:line="303" pos:column="40"/></argument_list></call> <operator pos:line="303" pos:column="41">+<pos:position pos:line="303" pos:column="42"/></operator> <literal type="number" pos:line="303" pos:column="43">1<pos:position pos:line="303" pos:column="44"/></literal></expr></argument>)<pos:position pos:line="303" pos:column="45"/></argument_list></call></expr>;<pos:position pos:line="303" pos:column="46"/></expr_stmt>
          <expr_stmt><expr><name><name pos:line="304" pos:column="11">conn<pos:position pos:line="304" pos:column="15"/></name><operator pos:line="304" pos:column="15">-&gt;<pos:position pos:line="304" pos:column="20"/></operator><name pos:line="304" pos:column="17">scope_id<pos:position pos:line="304" pos:column="25"/></name></name> <operator pos:line="304" pos:column="26">=<pos:position pos:line="304" pos:column="27"/></operator> <name pos:line="304" pos:column="28">scopeidx<pos:position pos:line="304" pos:column="36"/></name></expr>;<pos:position pos:line="304" pos:column="37"/></expr_stmt>
        }<pos:position pos:line="305" pos:column="10"/></block></then>
        <else pos:line="306" pos:column="9">else
<cpp:endif pos:line="307" pos:column="1">#<cpp:directive pos:line="307" pos:column="2">endif<pos:position pos:line="307" pos:column="7"/></cpp:directive></cpp:endif> <comment type="block" pos:line="307" pos:column="8">/* HAVE_NET_IF_H &amp;&amp; IFNAMSIZ */</comment>
          <block type="pseudo"><expr_stmt><expr><call><name pos:line="308" pos:column="11">infof<pos:position pos:line="308" pos:column="16"/></name><argument_list pos:line="308" pos:column="16">(<argument><expr><name pos:line="308" pos:column="17">data<pos:position pos:line="308" pos:column="21"/></name></expr></argument>, <argument><expr><literal type="string" pos:line="308" pos:column="23">"Invalid IPv6 address format\n"<pos:position pos:line="308" pos:column="54"/></literal></expr></argument>)<pos:position pos:line="308" pos:column="55"/></argument_list></call></expr>;<pos:position pos:line="308" pos:column="56"/></expr_stmt></block></else></if>
      }<pos:position pos:line="309" pos:column="8"/></block></else></if>
    }<pos:position pos:line="310" pos:column="6"/></block></then></if>
  }<pos:position pos:line="311" pos:column="4"/></block></then></if>

  <if pos:line="313" pos:column="3">if<condition pos:line="313" pos:column="5">(<expr><name><name pos:line="313" pos:column="6">data<pos:position pos:line="313" pos:column="10"/></name><operator pos:line="313" pos:column="10">-&gt;<pos:position pos:line="313" pos:column="15"/></operator><name pos:line="313" pos:column="12">set<pos:position pos:line="313" pos:column="15"/></name><operator pos:line="313" pos:column="15">.<pos:position pos:line="313" pos:column="16"/></operator><name pos:line="313" pos:column="16">scope_id<pos:position pos:line="313" pos:column="24"/></name></name></expr>)<pos:position pos:line="313" pos:column="25"/></condition><then pos:line="313" pos:column="25">
    <comment type="block" pos:line="314" pos:column="5">/* Override any scope that was set above.  */</comment>
    <block type="pseudo"><expr_stmt><expr><name><name pos:line="315" pos:column="5">conn<pos:position pos:line="315" pos:column="9"/></name><operator pos:line="315" pos:column="9">-&gt;<pos:position pos:line="315" pos:column="14"/></operator><name pos:line="315" pos:column="11">scope_id<pos:position pos:line="315" pos:column="19"/></name></name> <operator pos:line="315" pos:column="20">=<pos:position pos:line="315" pos:column="21"/></operator> <name><name pos:line="315" pos:column="22">data<pos:position pos:line="315" pos:column="26"/></name><operator pos:line="315" pos:column="26">-&gt;<pos:position pos:line="315" pos:column="31"/></operator><name pos:line="315" pos:column="28">set<pos:position pos:line="315" pos:column="31"/></name><operator pos:line="315" pos:column="31">.<pos:position pos:line="315" pos:column="32"/></operator><name pos:line="315" pos:column="32">scope_id<pos:position pos:line="315" pos:column="40"/></name></name></expr>;<pos:position pos:line="315" pos:column="41"/></expr_stmt></block></then></if>

  <comment type="block" pos:line="317" pos:column="3">/* Remove the fragment part of the path. Per RFC 2396, this is always the
     last part of the URI. We are looking for the first '#' so that we deal
     gracefully with non conformant URI such as http://example.com#foo#bar. */</comment>
  <expr_stmt><expr><name pos:line="320" pos:column="3">fragment<pos:position pos:line="320" pos:column="11"/></name> <operator pos:line="320" pos:column="12">=<pos:position pos:line="320" pos:column="13"/></operator> <call><name pos:line="320" pos:column="14">strchr<pos:position pos:line="320" pos:column="20"/></name><argument_list pos:line="320" pos:column="20">(<argument><expr><name pos:line="320" pos:column="21">path<pos:position pos:line="320" pos:column="25"/></name></expr></argument>, <argument><expr><literal type="char" pos:line="320" pos:column="27">'#'<pos:position pos:line="320" pos:column="30"/></literal></expr></argument>)<pos:position pos:line="320" pos:column="31"/></argument_list></call></expr>;<pos:position pos:line="320" pos:column="32"/></expr_stmt>
  <if pos:line="321" pos:column="3">if<condition pos:line="321" pos:column="5">(<expr><name pos:line="321" pos:column="6">fragment<pos:position pos:line="321" pos:column="14"/></name></expr>)<pos:position pos:line="321" pos:column="15"/></condition><then pos:line="321" pos:column="15"> <block pos:line="321" pos:column="16">{
    <expr_stmt><expr><operator pos:line="322" pos:column="5">*<pos:position pos:line="322" pos:column="6"/></operator><name pos:line="322" pos:column="6">fragment<pos:position pos:line="322" pos:column="14"/></name> <operator pos:line="322" pos:column="15">=<pos:position pos:line="322" pos:column="16"/></operator> <literal type="number" pos:line="322" pos:column="17">0<pos:position pos:line="322" pos:column="18"/></literal></expr>;<pos:position pos:line="322" pos:column="19"/></expr_stmt>

    <comment type="block" pos:line="324" pos:column="5">/* we know the path part ended with a fragment, so we know the full URL
       string does too and we need to cut it off from there so it isn't used
       over proxy */</comment>
    <expr_stmt><expr><name pos:line="327" pos:column="5">fragment<pos:position pos:line="327" pos:column="13"/></name> <operator pos:line="327" pos:column="14">=<pos:position pos:line="327" pos:column="15"/></operator> <call><name pos:line="327" pos:column="16">strchr<pos:position pos:line="327" pos:column="22"/></name><argument_list pos:line="327" pos:column="22">(<argument><expr><name><name pos:line="327" pos:column="23">data<pos:position pos:line="327" pos:column="27"/></name><operator pos:line="327" pos:column="27">-&gt;<pos:position pos:line="327" pos:column="32"/></operator><name pos:line="327" pos:column="29">change<pos:position pos:line="327" pos:column="35"/></name><operator pos:line="327" pos:column="35">.<pos:position pos:line="327" pos:column="36"/></operator><name pos:line="327" pos:column="36">url<pos:position pos:line="327" pos:column="39"/></name></name></expr></argument>, <argument><expr><literal type="char" pos:line="327" pos:column="41">'#'<pos:position pos:line="327" pos:column="44"/></literal></expr></argument>)<pos:position pos:line="327" pos:column="45"/></argument_list></call></expr>;<pos:position pos:line="327" pos:column="46"/></expr_stmt>
    <if pos:line="328" pos:column="5">if<condition pos:line="328" pos:column="7">(<expr><name pos:line="328" pos:column="8">fragment<pos:position pos:line="328" pos:column="16"/></name></expr>)<pos:position pos:line="328" pos:column="17"/></condition><then pos:line="328" pos:column="17">
      <block type="pseudo"><expr_stmt><expr><operator pos:line="329" pos:column="7">*<pos:position pos:line="329" pos:column="8"/></operator><name pos:line="329" pos:column="8">fragment<pos:position pos:line="329" pos:column="16"/></name> <operator pos:line="329" pos:column="17">=<pos:position pos:line="329" pos:column="18"/></operator> <literal type="number" pos:line="329" pos:column="19">0<pos:position pos:line="329" pos:column="20"/></literal></expr>;<pos:position pos:line="329" pos:column="21"/></expr_stmt></block></then></if>
  }<pos:position pos:line="330" pos:column="4"/></block></then></if>

  <comment type="block" pos:line="332" pos:column="3">/*
   * So if the URL was A://B/C#D,
   *   protop is A
   *   conn-&gt;host.name is B
   *   data-&gt;state.path is /C
   */</comment>

  <return pos:line="339" pos:column="3">return <expr><call><name pos:line="339" pos:column="10">findprotocol<pos:position pos:line="339" pos:column="22"/></name><argument_list pos:line="339" pos:column="22">(<argument><expr><name pos:line="339" pos:column="23">data<pos:position pos:line="339" pos:column="27"/></name></expr></argument>, <argument><expr><name pos:line="339" pos:column="29">conn<pos:position pos:line="339" pos:column="33"/></name></expr></argument>, <argument><expr><name pos:line="339" pos:column="35">protop<pos:position pos:line="339" pos:column="41"/></name></expr></argument>)<pos:position pos:line="339" pos:column="42"/></argument_list></call></expr>;<pos:position pos:line="339" pos:column="43"/></return>
}<pos:position pos:line="340" pos:column="2"/></block></function></unit>
