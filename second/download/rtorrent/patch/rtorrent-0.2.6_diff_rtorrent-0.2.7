diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/configure	2005-06-27 03:59:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/configure	2005-07-01 15:57:17.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.57 for rtorrent 0.2.6.
+# Generated by GNU Autoconf 2.57 for rtorrent 0.2.7.
 #
 # Report bugs to <jaris@ifi.uio.no>.
 #
 # Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -265,14 +265,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='rtorrent'
 PACKAGE_TARNAME='rtorrent'
-PACKAGE_VERSION='0.2.6'
-PACKAGE_STRING='rtorrent 0.2.6'
+PACKAGE_VERSION='0.2.7'
+PACKAGE_STRING='rtorrent 0.2.7'
 PACKAGE_BUGREPORT='jaris@ifi.uio.no'
 
 ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO AMTAR install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM AWK SET_MAKE CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CXXDEPMODE RANLIB ac_ct_RANLIB CC CFLAGS ac_ct_CC CCDEPMODE PKG_CONFIG STUFF_CFLAGS STUFF_LIBS LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -742,13 +742,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures rtorrent 0.2.6 to adapt to many kinds of systems.
+\`configure' configures rtorrent 0.2.7 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -804,13 +804,13 @@
   --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of rtorrent 0.2.6:";;
+     short | recursive ) echo "Configuration of rtorrent 0.2.7:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -893,13 +893,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-rtorrent configure 0.2.6
+rtorrent configure 0.2.7
 generated by GNU Autoconf 2.57
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -908,13 +908,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by rtorrent $as_me 0.2.6, which was
+It was created by rtorrent $as_me 0.2.7, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1499,13 +1499,13 @@
 echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 # Define the identity of the package.
  PACKAGE=rtorrent
- VERSION=0.2.6
+ VERSION=0.2.7
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -3793,37 +3793,37 @@
      echo "*** in your path, or set the PKG_CONFIG environment variable"
      echo "*** to the full path to pkg-config."
      echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
   else
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo "$as_me:$LINENO: checking for sigc++-2.0 libtorrent >= 0.6.6" >&5
-echo $ECHO_N "checking for sigc++-2.0 libtorrent >= 0.6.6... $ECHO_C" >&6
+        echo "$as_me:$LINENO: checking for sigc++-2.0 libtorrent >= 0.6.7" >&5
+echo $ECHO_N "checking for sigc++-2.0 libtorrent >= 0.6.7... $ECHO_C" >&6
 
-        if $PKG_CONFIG --exists "sigc++-2.0 libtorrent >= 0.6.6" ; then
+        if $PKG_CONFIG --exists "sigc++-2.0 libtorrent >= 0.6.7" ; then
             echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6
             succeeded=yes
 
             echo "$as_me:$LINENO: checking STUFF_CFLAGS" >&5
 echo $ECHO_N "checking STUFF_CFLAGS... $ECHO_C" >&6
-            STUFF_CFLAGS=`$PKG_CONFIG --cflags "sigc++-2.0 libtorrent >= 0.6.6"`
+            STUFF_CFLAGS=`$PKG_CONFIG --cflags "sigc++-2.0 libtorrent >= 0.6.7"`
             echo "$as_me:$LINENO: result: $STUFF_CFLAGS" >&5
 echo "${ECHO_T}$STUFF_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking STUFF_LIBS" >&5
 echo $ECHO_N "checking STUFF_LIBS... $ECHO_C" >&6
-            STUFF_LIBS=`$PKG_CONFIG --libs "sigc++-2.0 libtorrent >= 0.6.6"`
+            STUFF_LIBS=`$PKG_CONFIG --libs "sigc++-2.0 libtorrent >= 0.6.7"`
             echo "$as_me:$LINENO: result: $STUFF_LIBS" >&5
 echo "${ECHO_T}$STUFF_LIBS" >&6
         else
             STUFF_CFLAGS=""
             STUFF_LIBS=""
             ## If we have a custom action on failure, don't print errors, but
             ## do set a variable so people can do so.
-            STUFF_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "sigc++-2.0 libtorrent >= 0.6.6"`
+            STUFF_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "sigc++-2.0 libtorrent >= 0.6.7"`
             echo $STUFF_PKG_ERRORS
         fi
 
 
 
      else
@@ -3833,14 +3833,14 @@
   fi
 
   if test $succeeded = yes; then
      CXXFLAGS="$CXXFLAGS $STUFF_CFLAGS $CURL_CFLAGS";
 		  LIBS="$LIBS $STUFF_LIBS $CURL_LIBS"
   else
-     { { echo "$as_me:$LINENO: error: Library requirements (sigc++-2.0 libtorrent >= 0.6.6) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&5
-echo "$as_me: error: Library requirements (sigc++-2.0 libtorrent >= 0.6.6) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&2;}
+     { { echo "$as_me:$LINENO: error: Library requirements (sigc++-2.0 libtorrent >= 0.6.7) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&5
+echo "$as_me: error: Library requirements (sigc++-2.0 libtorrent >= 0.6.7) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&2;}
    { (exit 1); exit 1; }; }
   fi
 
 
 
 cat >>confdefs.h <<\_ACEOF
@@ -4213,13 +4213,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by rtorrent $as_me 0.2.6, which was
+This file was extended by rtorrent $as_me 0.2.7, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -4276,13 +4276,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-rtorrent config.status 0.2.6
+rtorrent config.status 0.2.7
 configured by $0, generated by GNU Autoconf 2.57,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/configure.ac	2005-06-26 05:32:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/configure.ac	2005-06-29 04:50:31.000000000 +0800
@@ -1,7 +1,7 @@
-AC_INIT(rtorrent, 0.2.6, jaris@ifi.uio.no)
+AC_INIT(rtorrent, 0.2.7, jaris@ifi.uio.no)
 
 AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 
 sinclude(scripts/checks.m4)
 sinclude(scripts/common.m4)
@@ -17,13 +17,13 @@
 AC_SEARCH_LIBS(wbkgdset, ncurses curses,,echo "*** The ncurses library is required!";exit 1)
 
 TORRENT_CHECK_EXECINFO()
 TORRENT_CHECK_CURL()
 TORRENT_OTFD()
 
-PKG_CHECK_MODULES(STUFF, sigc++-2.0 libtorrent >= 0.6.6,
+PKG_CHECK_MODULES(STUFF, sigc++-2.0 libtorrent >= 0.6.7,
 	          CXXFLAGS="$CXXFLAGS $STUFF_CFLAGS $CURL_CFLAGS";
 		  LIBS="$LIBS $STUFF_LIBS $CURL_LIBS")
 
 AC_DEFINE(HAVE_CONFIG_H, 1, true if config.h was included)
 
 AC_OUTPUT([
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.1	2005-06-27 03:51:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.1	2005-07-07 02:54:25.000000000 +0800
@@ -1,12 +1,12 @@
 .\" This manpage has been automatically generated by docbook2man 
 .\" from a DocBook document.  This tool can be found at:
 .\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
 .\" Please send any bug reports, improvements, comments, patches, 
 .\" etc. to Steve Cheng <steve@ggi-project.org>.
-.TH "RTORRENT" "1" "26 June 2005" "BitTorrent client for ncurses" ""
+.TH "RTORRENT" "1" "06 July 2005" "BitTorrent client for ncurses" ""
 
 .SH NAME
 rtorrent \- a BitTorrent client for ncurses
 .SH SYNOPSIS
 
 \fBrtorrent\fR [ \fB-h\fR ] [ \fB-o key1=opt1,...\fR ] [ \fBURL | FILE\fR\fI ...\fR ]
@@ -86,13 +86,13 @@
 .TP
 \fBp\fR
 View peer and torrent information.
 .TP
 \fBt | T\fR
 Initiate tracker request. Use capital T to force the
-request, ignoring the "min interval".
+request, ignoring the "min interval" set by the tracker.
 .SH "OPTIONS"
 .TP
 \fB-b \fIa.b.c.d\fB\fR
 Bind listening socket and outgoing connections to this
 network interface address.
 .TP
@@ -144,17 +144,20 @@
 Bind listening socket and outgoing connections to this
 network interface address.
 .TP
 \fBip = \fIa.b.c.d\fB\fR
 Set the address reported to the tracker.
 .TP
-\fBport = \fIa-b\fB\fR
+\fBport_range = \fIa-b\fB\fR
 Try to open a listening port in the range
 \fBa\fR up to and including
 \fBb\fR.
 .TP
+\fBport_random = \fIyes | no\fB\fR
+Open the listening port at a random position in the port range.
+.TP
 \fBcheck_hash = \fIyes | no\fB\fR
 Perform hash check on finished downloads.
 .TP
 \fBdirectory = \fIdirectory\fB\fR
 Set the default download directory. Defaults to "./".
 .TP
@@ -163,23 +166,44 @@
 all open downloads will be stored in this directory. Only
 one instance of rtorrent should be used with each session
 directory, though at the moment no locking is done. An empty
 string will disable the session directory.
 .SH "ADVANCED SETTINGS"
 .PP
-This list contains settings normal users shouldn't need to touch.
+This list contains settings users shouldn't need to touch.
 .TP
 \fBhash_read_ahead = \fIMB\fB\fR
 Configure how far ahead we ask the kernel to read when doing
 hash checking. The hash checker uses madvise(...,
 MADV_WILLNEED) for the requests.
 .TP
+\fBhash_interval = \fIms\fB\fR
+Interval between attempts to check the hash when the chunk
+is not in memory, in milliseconds.
+.TP
+\fBhash_max_tries = \fItries\fB\fR
+Number of attempts to check the hash while using the mincore
+status, before forcing. Overworked systems might need lower
+values to get a decent hash checking rate.
+.TP
 \fBmax_open_files = \fIvalue\fB\fR
 Number of files to simultaneously keep open. Libtorrent
 dynamically opens and closes files when mapping files to
-memory.
+memory. Defaults to 128.
+.TP
+\fBmax_open_sockets = \fIvalue\fB\fR
+Number of sockets to simultaneously keep open. This value is
+set to be \fBsysconf(_SC_OPEN_MAX) - 256\fR
+at startup. This gives the client 128 sockets to use as it
+wishes.
+.TP
+\fBthrottle_interval = \fIms\fB\fR
+Interval between throttle ticks in milli-seconds, must be
+between \fB1-5000\fR and defaults to
+\fB1000\fR. Shorter intervals will cause less
+bandwidth usage spikes while requiring more CPU resources.
 .TP
 \fBtracker_dump = \fIyes | no\fB\fR
 Dump data received from trackers to the files
 "./tracker_dump.*".
 .SH "AUTHORS"
 .PP
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.1.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.1.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.1.xml	2005-06-27 01:09:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.1.xml	2005-07-06 18:34:36.000000000 +0800
@@ -211,13 +211,13 @@
 	</varlistentry>
 
 	<varlistentry>
 	  <term>t | T</term>
 	  <listitem><para>
             Initiate tracker request. Use capital T to force the
-            request, ignoring the "min interval".
+            request, ignoring the "min interval" set by the tracker.
           </para></listitem>
 	</varlistentry>
 
       </variablelist>
 
     </refsect2>
@@ -349,21 +349,28 @@
         <listitem><para>
           Set the address reported to the tracker.
         </para></listitem>
       </varlistentry>
 
       <varlistentry>
-        <term>port = <replaceable>a-b</replaceable></term>
+        <term>port_range = <replaceable>a-b</replaceable></term>
         <listitem><para>
           Try to open a listening port in the range
           <emphasis>a</emphasis> up to and including
           <emphasis>b</emphasis>.
         </para></listitem>
       </varlistentry>
 
       <varlistentry>
+        <term>port_random = <replaceable>yes | no</replaceable></term>
+        <listitem><para>
+          Open the listening port at a random position in the port range.
+        </para></listitem>
+      </varlistentry>
+
+      <varlistentry>
         <term>check_hash = <replaceable>yes | no</replaceable></term>
         <listitem><para>
           Perform hash check on finished downloads.
         </para></listitem>
       </varlistentry>
 
@@ -392,13 +399,13 @@
   </refsect1>
 
 
   <refsect1>
     <title>ADVANCED SETTINGS</title>
     <para>
-      This list contains settings normal users shouldn't need to touch.
+      This list contains settings users shouldn't need to touch.
     </para>
 
     <variablelist>
 
       <varlistentry>
         <term>hash_read_ahead = <replaceable>MB</replaceable></term>
@@ -407,17 +414,54 @@
           hash checking. The hash checker uses madvise(...,
           MADV_WILLNEED) for the requests.
         </para></listitem>
       </varlistentry>
 
       <varlistentry>
+        <term>hash_interval = <replaceable>ms</replaceable></term>
+        <listitem><para>
+          Interval between attempts to check the hash when the chunk
+          is not in memory, in milliseconds.
+        </para></listitem>
+      </varlistentry>
+
+      <varlistentry>
+        <term>hash_max_tries = <replaceable>tries</replaceable></term>
+        <listitem><para>
+          Number of attempts to check the hash while using the mincore
+	  status, before forcing. Overworked systems might need lower
+	  values to get a decent hash checking rate.
+        </para></listitem>
+      </varlistentry>
+
+      <varlistentry>
         <term>max_open_files = <replaceable>value</replaceable></term>
         <listitem><para>
           Number of files to simultaneously keep open. Libtorrent
           dynamically opens and closes files when mapping files to
-          memory.
+          memory. Defaults to 128.
+        </para></listitem>
+      </varlistentry>
+
+      <varlistentry>
+        <term>max_open_sockets = <replaceable>value</replaceable></term>
+        <listitem><para>
+          Number of sockets to simultaneously keep open. This value is
+          set to be <emphasis>sysconf(_SC_OPEN_MAX) - 256</emphasis>
+          at startup. This gives the client 128 sockets to use as it
+          wishes.
+        </para></listitem>
+      </varlistentry>
+
+      <varlistentry>
+        <term>throttle_interval = <replaceable>ms</replaceable></term>
+        <listitem><para>
+          Interval between throttle ticks in milli-seconds, must be
+          between <emphasis>1-5000</emphasis> and defaults to
+          <emphasis>1000</emphasis>. Shorter intervals will cause less
+          bandwidth usage spikes while requiring more CPU resources.
         </para></listitem>
       </varlistentry>
 
       <varlistentry>
         <term>tracker_dump = <replaceable>yes | no</replaceable></term>
         <listitem><para>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.rc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.rc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/doc/rtorrent.rc	2005-06-26 09:16:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/doc/rtorrent.rc	2005-07-06 18:34:36.000000000 +0800
@@ -31,13 +31,16 @@
 
 # The ip address the listening socket and outgoing connections is
 # bound to.
 #bind = 127.0.0.1
 
 # Port range to use for listening.
-#port = 6890-6999
+#port_range = 6890-6999
+
+# Start opening ports at a random position within the port range.
+#port_random = no
 
 # Check hash for finished torrents. Might be usefull until the bug is
 # fixed that causes lack of diskspace not to be properly reported.
 #check_hash = no
 
 #
@@ -47,11 +50,26 @@
 # Hash read-ahead controls how many MB to request the kernel to read
 # ahead. If the value is too low the disk may not be fully utilized,
 # while if too high the kernel might not be able to keep the read
 # pages in memory thus end up trashing.
 #hash_read_ahead = 10
 
+# Interval between attempts to check the hash, in milliseconds.
+#hash_interval = 100
+
+# Number of attempts to check the hash while using the mincore status,
+# before forcing. Overworked systems might need lower values to get a
+# decent hash checking rate.
+#hash_max_tries = 10
+
 # Max number of files to keep open simultaniously.
-#max_open_files = 100
+#max_open_files = 128
+
+# Number of sockets to simultaneously keep open.
+#max_open_sockets = <no default>
 
 # Dump data received from trackers to the files "./tracker_dump.<time>".
 #tracker_dump = no
+
+# Change the interval between each throttle tick, in milliseconds. In
+# the range 1-5000 ms.
+#throttle_interval = 1000
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/rak/algorithm.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/rak/algorithm.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/rak/algorithm.h	2005-06-06 09:10:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/rak/algorithm.h	2005-07-02 04:45:12.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_ALGORITHM_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/rak/functional.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/rak/functional.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/rak/functional.h	2005-06-06 09:10:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/rak/functional.h	2005-07-02 04:45:12.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_FUNCTIONAL_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/README	2005-06-24 00:51:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/README	2005-07-02 04:11:44.000000000 +0800
@@ -1,81 +1,27 @@
-LICENSE
-
- GNU GPL, see COPYING.
-
-
-Options and flags:
-
-  -b <a.b.c.d>      Bind the listening socket to this IP.
-  -i <a.b.c.d>      Set the IP address sent to the tracker.
-
-  -p <a-b>          Open a port in the range a to b.
-
-  -d <dir>          Sets the default path where the files in the
-                    torrent are found/saved. By default it is "./".
-
-  -s <dir>          The session directory, all the torrents you add
-                    will be saved there with the info hash as a file
-                    name. When you shutdown rtorrent it will store
-                    fast-resume data in those torrents. Restarting
-                    rtorrent with the sesssion directory will restart
-                    all the torrents you had when you last quit.
-
-
-All:
-
-  Ctrl-Q    - Quit
-
-  a/A       - Increase upload/download throttle by 1 KiB
-  z/Z       - Decrease upload/download throttle by 1 KiB
-
-  s/S       - Increase upload/download throttle by 5 KiB
-  x/X       - Decrease upload/download throttle by 5 KiB
+BUILDING
 
-  d/D       - Increase upload/download throttle by 50 KiB
-  c/C       - Decrease upload/download throttle by 50 KiB
+ Run "./autogen.sh" to generate the configure scripts if
+nessesary. The man page "doc/rtorrent.1" must be generated with
+"docbook2man rtorrent.1.xml" if it is missing.
 
+ Note that rtorrent follows the development of libtorrent closely, and
+thus the versions must be in sync. This should not be nessesary in the
+future, when the library API stabilizes.
 
-In main window:
+USAGE
 
-  Backspace - Activate text input for inserting urls/file
-              paths. Arrows/C^f/C^b for navigation, enter/C^m.
+ See the man page or website for instructions.
 
-  Up/Down   - Select torrent
-
-  Right     - View torrent
-
-  ^s        - Start torrent
-  ^d        - Stop/delete torrent
-
-  ^r        - Manually start a hash check of the torrent
-
-
-In torrent view:
-
-  Up/Down   - Select peer
-
-  Left      - Back to main
-
-  Right     - View files
-  P         - View peer
-  O         - View trackers
-
-  1         - Decrease max uploads
-  2         - Increase max uploads
-
-  3         - Decrease min peers connected
-  4         - Increase min peers connected
-
-  5         - Decrease max peers connected
-  6         - Increase max peers connected
+LICENSE
 
-  t         - Query tracker
-  T         - Force query tracker, ignores min reconnect time sendt by the tracker
+ GNU GPL, see COPYING.
 
-In file view:
+DEPENDENCIES
 
-  Up/Down   - Select file
+  libcurl >= 7.12.0
+  ncurses
 
-  Left      - Back to torrent view
+CONTACT
 
-  SpaceBar  - Change file priority
+ Send bug reports, suggestions and patches to <jaris@ifi.uio.no> or
+to the mailinglist.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_get.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_get.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_get.cc	2005-03-17 04:35:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_get.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_get.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_get.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_get.h	2005-06-09 00:01:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_get.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_CURL_GET_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_stack.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_stack.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_stack.cc	2005-03-17 04:35:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_stack.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_stack.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_stack.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/curl_stack.h	2005-06-09 00:01:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/curl_stack.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_CURL_STACK_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download.cc	2005-06-23 19:49:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,27 +12,57 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include "download.h"
-
+#include <stdexcept>
 #include <sigc++/bind.h>
 #include <sigc++/hide.h>
 #include <sigc++/signal.h>
 
+#include "download.h"
+
 namespace core {
 
+Download::Download() :
+  m_connectionLeech("default"),
+  m_connectionSeed("default") {
+}
+
+void
+Download::start() {
+  if (is_done())
+    m_download.set_connection_type(m_connectionSeed);
+  else
+    m_download.set_connection_type(m_connectionLeech);
+
+  m_download.start();
+}
+
 void
 Download::set_download(torrent::Download d) {
   m_download = d;
 
   m_connTrackerSucceded = m_download.signal_tracker_succeded(sigc::bind(sigc::mem_fun(*this, &Download::receive_tracker_msg), ""));
   m_connTrackerFailed = m_download.signal_tracker_failed(sigc::mem_fun(*this, &Download::receive_tracker_msg));
@@ -45,15 +75,25 @@
 			  (!d.empty() && *d.rbegin() != '/' ? "/" : "") +
 			  (m_download.get_entry_size() > 1 ? m_download.get_name() : ""));
 }
 
 void
 Download::release_download() {
+  if (!m_download.is_valid())
+    return;
+
   m_connTrackerSucceded.disconnect();
   m_connTrackerFailed.disconnect();
   m_connStorageError.disconnect();
+
+  m_download = torrent::Download();
+}
+
+void
+Download::receive_finished() {
+  m_download.set_connection_type(m_connectionSeed);
 }
 
 void
 Download::receive_tracker_msg(std::string msg) {
   if (msg.empty())
     m_message = "";
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download.h	2005-06-23 19:49:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,56 +12,87 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_DOWNLOAD_H
 #define RTORRENT_CORE_DOWNLOAD_H
 
 #include <sigc++/connection.h>
 #include <torrent/download.h>
+#include <torrent/torrent.h>
 
 namespace core {
 
 class Download {
 public:
+  Download();
+  ~Download() { release_download(); }
+
   bool               is_open()                       { return m_download.is_open(); }
   inline bool        is_done();
 
+  void               start();
+
   void               set_download(torrent::Download d);
   void               release_download();
 
   torrent::Download& get_download()                  { return m_download; }
   std::string        get_hash()                      { return m_download.get_hash(); }
+  torrent::Bencode&  get_bencode()                   { return torrent::download_bencode(m_download.get_hash()); }
   
   const std::string& get_message()                   { return m_message; }
 
   void               set_root_directory(const std::string& d);
 
+  void               set_connection_leech(const std::string& name) { m_connectionLeech = name; }
+  void               set_connection_seed(const std::string& name)  { m_connectionSeed = name; }
+
+  // Helper functions for calling functions in torrent::Download
+  // through sigc++.
   template <typename Ret, Ret (torrent::Download::*func)()>
   void               call()                                                { (m_download.*func)(); }
 
   template <typename Ret, typename Arg1, Ret (torrent::Download::*func)(Arg1)>
   void               call(Arg1 a1)                                         { (m_download.*func)(a1); }
 
   bool operator == (const std::string& str)                                { return str == m_download.get_hash(); }
 
+  void               receive_finished();
+
 private:
   void               receive_tracker_msg(std::string msg);
   void               receive_storage_error(std::string msg);
 
   torrent::Download  m_download;
 
   std::string        m_message;
 
+  std::string        m_connectionLeech;
+  std::string        m_connectionSeed;
+
   sigc::connection   m_connTrackerSucceded;
   sigc::connection   m_connTrackerFailed;
   sigc::connection   m_connStorageError;
 };
 
 inline bool
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_list.cc	2005-06-23 19:49:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_list.cc	2005-07-06 18:34:36.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -47,14 +61,14 @@
 }
 
 DownloadList::iterator
 DownloadList::erase(iterator itr) {
   m_slotMapErase.for_each(*itr);
 
-  (*itr)->release_download();
   torrent::download_remove((*itr)->get_hash());
+  (*itr)->release_download();
   delete *itr;
 
   return Base::erase(itr);
 }
 
 void
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_list.h	2005-06-23 19:49:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_DOWNLOAD_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_slot_map.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_slot_map.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_slot_map.h	2005-06-23 19:49:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_slot_map.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_DOWNLOAD_SLOT_MAP_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_store.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_store.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_store.cc	2005-06-26 09:06:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_store.cc	2005-07-02 06:33:33.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -72,13 +86,13 @@
   if (!is_active())
     return utils::Directory();
 
   utils::Directory d(m_path);
 
   if (!d.update())
-    throw std::runtime_error("core::DownloadStore::update() could not open directory");
+    throw std::runtime_error("core::DownloadStore::update() could not open directory \"" + m_path + "\"");
 
   d.erase(std::remove_if(d.begin(), d.end(), std::not1(std::ptr_fun(&DownloadStore::is_correct_format))), d.end());
 
   return d;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_store.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_store.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/download_store.h	2005-06-26 09:06:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/download_store.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_DOWNLOAD_STORE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/hash_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/hash_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/hash_queue.cc	2005-05-26 09:17:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/hash_queue.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/hash_queue.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/hash_queue.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/hash_queue.h	2005-06-21 04:17:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/hash_queue.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_HASH_QUEUE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/http_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/http_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/http_queue.cc	2005-03-17 04:35:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/http_queue.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/http_queue.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/http_queue.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/http_queue.h	2005-03-17 04:35:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/http_queue.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_HTTP_QUEUE_H
@@ -47,12 +61,15 @@
   using Base::rbegin;
   using Base::rend;
 
   using Base::empty;
   using Base::size;
 
+  HttpQueue() {}
+  ~HttpQueue() { clear(); }
+
   // Note that any slots connected to the CurlGet signals must be
   // pushed in front of the erase slot added by HttpQueue::insert.
   iterator    insert(const std::string& url);
   void        erase(iterator itr);
 
   void        clear();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/log.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/log.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/log.cc	2005-03-17 04:35:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/log.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/log.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/log.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/log.h	2005-03-17 04:35:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/log.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_LOG_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/manager.cc	2005-06-26 08:51:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/manager.cc	2005-07-06 18:34:36.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -28,13 +42,12 @@
 #include <fstream>
 #include <istream>
 #include <sigc++/bind.h>
 #include <sigc++/hide.h>
 #include <torrent/bencode.h>
 #include <torrent/exceptions.h>
-#include <torrent/torrent.h>
 
 #include "download.h"
 #include "manager.h"
 #include "curl_get.h"
 
 namespace core {
@@ -47,47 +60,59 @@
 void
 Manager::initialize() {
   torrent::Http::set_factory(m_poll.get_http_factory());
   m_httpQueue.slot_factory(m_poll.get_http_factory());
 
   CurlStack::init();
-
-  if (!torrent::listen_open(m_portFirst, m_portLast))
-    throw std::runtime_error("Could not open port for listening.");
+  listen_open();
 
   // Register slots to be called when a download is inserted/erased,
   // opened or closed.
-  m_downloadList.slot_map_insert().insert("2_connect_network_log", sigc::bind(sigc::ptr_fun(&connect_signal_network_log), sigc::mem_fun(m_logComplete, &Log::push_front)));
-  m_downloadList.slot_map_insert().insert("3_manager_start",       sigc::mem_fun(*this, &Manager::start));
+  m_downloadList.slot_map_insert().insert("0_initialize_bencode",  sigc::mem_fun(*this, &Manager::initialize_bencode));
+  m_downloadList.slot_map_insert().insert("1_connect_network_log", sigc::bind(sigc::ptr_fun(&connect_signal_network_log), sigc::mem_fun(m_logComplete, &Log::push_front)));
+  m_downloadList.slot_map_insert().insert("3_manager_inserted",    sigc::mem_fun(*this, &Manager::receive_download_inserted));
   m_downloadList.slot_map_insert().insert("4_store_save",          sigc::mem_fun(m_downloadStore, &DownloadStore::save));
 
   m_downloadList.slot_map_erase().insert("1_hash_queue_remove",    sigc::mem_fun(m_hashQueue, &HashQueue::remove));
   m_downloadList.slot_map_erase().insert("1_store_remove",         sigc::mem_fun(m_downloadStore, &DownloadStore::remove));
 
   //m_downloadList.slot_map_open().insert("1_download_open",         sigc::mem_fun(&Download::open));
   m_downloadList.slot_map_open().insert("1_download_open",         sigc::mem_fun(&Download::call<void, &torrent::Download::open>));
 
   // Currently does not call stop, might want to add a function that
   // checks if we're running, and if so stop?
-  m_downloadList.slot_map_close().insert("1_download_close",       sigc::mem_fun(&Download::call<void, &torrent::Download::close>));
   m_downloadList.slot_map_close().insert("1_hash_queue_remove",    sigc::mem_fun(m_hashQueue, &HashQueue::remove));
+  m_downloadList.slot_map_close().insert("2_download_close",       sigc::mem_fun(&Download::call<void, &torrent::Download::close>));
 
-  m_downloadList.slot_map_start().insert("1_download_start",       sigc::mem_fun(&Download::call<void, &torrent::Download::start>));
+  m_downloadList.slot_map_start().insert("1_download_start",       sigc::mem_fun(&Download::start));
 
   m_downloadList.slot_map_stop().insert("1_download_stop",         sigc::mem_fun(&Download::call<void, &torrent::Download::stop>));
   m_downloadList.slot_map_stop().insert("2_hash_resume_save",      sigc::mem_fun(&Download::call<void, &torrent::Download::hash_resume_save>));
   m_downloadList.slot_map_stop().insert("3_store_save",            sigc::mem_fun(m_downloadStore, &DownloadStore::save));
+
+  m_downloadList.slot_map_finished().insert("1_download_done",     sigc::bind(sigc::mem_fun(*this, &Manager::receive_download_done), true));
+  m_downloadList.slot_map_finished().insert("2_receive_finished",  sigc::mem_fun(&Download::receive_finished));
 }
 
 void
 Manager::cleanup() {
   // Need to disconnect log signals? Not really since we won't receive
   // any more.
 
   torrent::cleanup();
-  core::CurlStack::cleanup();
+  CurlStack::cleanup();
+}
+
+void
+Manager::shutdown(bool force) {
+  if (!force)
+    std::for_each(m_downloadList.begin(), m_downloadList.end(),
+		  std::bind1st(std::mem_fun(&DownloadList::stop), &m_downloadList));
+  else
+    std::for_each(m_downloadList.begin(), m_downloadList.end(),
+		  std::bind1st(std::mem_fun(&DownloadList::close), &m_downloadList));
 }
 
 void
 Manager::insert(std::string uri) {
   if (std::strncmp(uri.c_str(), "http://", 7) == 0) {
     create_http(uri);
@@ -108,12 +133,14 @@
   return m_downloadList.erase(itr);
 }  
 
 void
 Manager::start(Download* d) {
   try {
+    d->get_bencode()["rtorrent"]["state"] = "started";
+
     if (d->get_download().is_active())
       return;
 
     if (!d->get_download().is_open())
       m_downloadList.open(d);
 
@@ -129,12 +156,14 @@
   }
 }
 
 void
 Manager::stop(Download* d) {
   try {
+    d->get_bencode()["rtorrent"]["state"] = "stopped";
+
     m_downloadList.stop(d);
 
   } catch (torrent::local_error& e) {
     m_logImportant.push_front(e.what());
     m_logComplete.push_front(e.what());
   }
@@ -142,22 +171,13 @@
 
 void
 Manager::check_hash(Download* d) {
   bool restart = d->get_download().is_active();
 
   try {
-    m_downloadList.close(d);
-    d->get_download().hash_resume_clear();
-    m_downloadList.open(d);
-
-    if (d->get_download().is_hash_checking() ||
-	d->get_download().is_hash_checked())
-      throw std::logic_error("Manager::check_hash(...) closed the torrent but is_hash_check{ing,ed}() == true");
-
-    if (m_hashQueue.find(d) != m_hashQueue.end())
-      throw std::logic_error("Manager::check_hash(...) closed the torrent but it was found in m_hashQueue");
+    prepare_hash_check(d);
 
     if (restart)
       m_hashQueue.insert(d, sigc::bind(sigc::mem_fun(m_downloadList, &DownloadList::start), d));
     else
       m_hashQueue.insert(d, sigc::slot0<void>());
 
@@ -165,18 +185,51 @@
     m_logImportant.push_front(e.what());
     m_logComplete.push_front(e.what());
   }
 }  
 
 void
+Manager::receive_download_done(Download* d, bool check_hash) {
+  if (check_hash) {
+    // Start the hash checking, send completed to tracker after
+    // finishing.
+    prepare_hash_check(d);
+
+    // TODO: Need to restart the torrent.
+    m_hashQueue.insert(d, sigc::bind(sigc::mem_fun(*this, &Manager::receive_download_done_hash_checked), d));
+
+  } else {
+    receive_download_done_hash_checked(d);
+  }
+}
+
+void
+Manager::listen_open() {
+  if (m_portFirst > m_portLast)
+    throw std::runtime_error("Invalid port range for listening");
+
+  if (m_portRandom) {
+    int boundary = m_portFirst + random() % (m_portLast - m_portFirst + 1);
+
+    if (!torrent::listen_open(boundary, m_portLast) &&
+	!torrent::listen_open(m_portFirst, boundary))
+      throw std::runtime_error("Could not open port for listening.");
+
+  } else {
+    if (!torrent::listen_open(m_portFirst, m_portLast))
+      throw std::runtime_error("Could not open port for listening.");
+  }
+}
+
+void
 Manager::create_http(const std::string& uri) {
-  core::HttpQueue::iterator itr = m_httpQueue.insert(uri);
+  HttpQueue::iterator itr = m_httpQueue.insert(uri);
 
-  (*itr)->signal_done().slots().push_front(sigc::bind(sigc::mem_fun(*this, &core::Manager::create_final),
+  (*itr)->signal_done().slots().push_front(sigc::bind(sigc::mem_fun(*this, &Manager::create_final),
 						      (*itr)->get_stream()));
-  (*itr)->signal_failed().slots().push_front(sigc::mem_fun(*this, &core::Manager::receive_http_failed));
+  (*itr)->signal_failed().slots().push_front(sigc::mem_fun(*this, &Manager::receive_http_failed));
 }
 
 void
 Manager::create_final(std::istream* s) {
   try {
     m_downloadList.insert(s);
@@ -186,12 +239,61 @@
     m_logImportant.push_front(e.what());
     m_logComplete.push_front(e.what());
   }
 }
 
 void
+Manager::initialize_bencode(Download* d) {
+  torrent::Bencode& bencode = d->get_bencode();
+
+  // TODO: Check that stuff are the right type, like state etc.
+  if (bencode.has_key("rtorrent") &&
+      bencode["rtorrent"].is_map() &&
+      bencode["rtorrent"].has_key("state") &&
+      bencode["rtorrent"]["state"].is_string())
+    return;
+
+  bencode.insert_key("rtorrent", torrent::Bencode(torrent::Bencode::TYPE_MAP));
+  bencode["rtorrent"].insert_key("state", "started");
+}
+
+void
+Manager::prepare_hash_check(Download* d) {
+  m_downloadList.close(d);
+  d->get_download().hash_resume_clear();
+  m_downloadList.open(d);
+
+  if (d->get_download().is_hash_checking() ||
+      d->get_download().is_hash_checked())
+    throw std::logic_error("Manager::check_hash(...) closed the torrent but is_hash_check{ing,ed}() == true");
+
+  if (m_hashQueue.find(d) != m_hashQueue.end())
+    throw std::logic_error("Manager::check_hash(...) closed the torrent but it was found in m_hashQueue");
+}
+
+void
 Manager::receive_http_failed(std::string msg) {
   m_logImportant.push_front("Http download error: \"" + msg + "\"");
   m_logComplete.push_front("Http download error: \"" + msg + "\"");
 }
 
+void
+Manager::receive_download_done_hash_checked(Download* d) {
+  if (!d->get_download().is_active())
+    m_downloadList.start(d);
+
+  // Don't send if we did a hash check and found incompelete chunks.
+  //if (d->is_done())
+    d->get_download().tracker_send_completed();
+}
+
+void
+Manager::receive_download_inserted(Download* d) {
+  // Check if there is an "rtorrent" section in the bencoded data.
+
+  torrent::Bencode& bencode = d->get_bencode();
+
+  if (bencode["rtorrent"]["state"].as_string() == "started")
+    start(d);
+}
+
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/manager.h	2005-06-26 08:50:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/manager.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_MANAGER_H
@@ -41,52 +55,65 @@
 class Manager {
 public:
   typedef DownloadList::iterator                    DListItr;
   typedef sigc::slot1<void, DownloadList::iterator> SlotReady;
   typedef sigc::slot0<void>                         SlotFailed;
 
-  Manager() : m_portFirst(6890), m_portLast(6999) {}
+  Manager() : m_portRandom(false), m_portFirst(6890), m_portLast(6999) {}
 
   DownloadList&       get_download_list()                 { return m_downloadList; }
   DownloadStore&      get_download_store()                { return m_downloadStore; }
   HashQueue&          get_hash_queue()                    { return m_hashQueue; }
   HttpQueue&          get_http_queue()                    { return m_httpQueue; }
 
   Poll&               get_poll()                          { return m_poll; }
   Log&                get_log_important()                 { return m_logImportant; }
   Log&                get_log_complete()                  { return m_logComplete; }
 
+  void                set_port_random(bool v)             { m_portRandom = v; }
+  void                set_port_range(int a, int b)        { m_portFirst = a; m_portLast = b; }
+
   void                initialize();
   void                cleanup();
 
+  void                shutdown(bool force);
+
   void                insert(std::string uri);
   DListItr            erase(DListItr itr);
 
   void                start(Download* d);
   void                stop(Download* d);
 
   void                check_hash(Download* d);
 
-  void                set_port_range(int a, int b)            { m_portFirst = a; m_portLast = b; }
+  void                receive_download_done(Download* d, bool check_hash);
 
 private:
+  void                listen_open();
+
   void                create_http(const std::string& uri);
   void                create_final(std::istream* s);
 
-  void                receive_debug_tracker(std::istream* s);
+  void                initialize_bencode(Download* d);
+
+  void                prepare_hash_check(Download* d);
+
   void                receive_http_failed(std::string msg);
+  void                receive_download_done_hash_checked(Download* d);
+  void                receive_download_inserted(Download* d);
 
   DownloadList        m_downloadList;
   DownloadStore       m_downloadStore;
   HashQueue           m_hashQueue;
   HttpQueue           m_httpQueue;
 
   Poll                m_poll;
   Log                 m_logImportant;
   Log                 m_logComplete;
 
+  bool                m_portRandom;
   int                 m_portFirst;
   int                 m_portLast;
 };
 
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/poll.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/poll.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/poll.cc	2005-06-08 03:53:02.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/poll.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/poll.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/poll.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/core/poll.h	2005-03-17 04:35:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/core/poll.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_POLL_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/canvas.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/canvas.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/canvas.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/canvas.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/canvas.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/canvas.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/canvas.h	2005-06-23 19:49:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/canvas.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_CANVAS_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/manager.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/manager.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -80,14 +94,13 @@
 }
 
 void
 Manager::do_update() {
   Canvas::refresh_std();
 
-  std::for_each(begin(), end(), rak::if_then(std::mem_fun(&Window::is_active), rak::if_then(std::mem_fun(&Window::is_dirty),
-											    std::mem_fun(&Window::redraw))));
+  utils::displayScheduler.execute(utils::Timer::cache());
   std::for_each(begin(), end(), rak::if_then(std::mem_fun(&Window::is_active), std::mem_fun(&Window::refresh)));
 
   Canvas::do_update();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/manager.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/manager.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_MANAGER_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/utils.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/utils.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/utils.cc	2005-06-20 03:56:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/utils.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/utils.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/utils.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/utils.h	2005-06-20 03:30:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/utils.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_UTILS_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -27,17 +41,38 @@
 #include "window.h"
 
 namespace display {
 
 Window::Slot Window::m_slotAdjust;
 
+Window::Window(Canvas* c, bool d, int h) :
+  m_canvas(c),
+  m_active(true),
+  m_dynamic(d),
+  m_minHeight(h) {
+
+  m_taskUpdate.set_iterator(utils::displayScheduler.end());
+  m_taskUpdate.set_slot(sigc::mem_fun(*this, &Window::redraw));
+}
+
 Window::~Window() {
+  utils::displayScheduler.erase(&m_taskUpdate);
   delete m_canvas;
 }
 
 void
+Window::set_active(bool a) {
+  if (a)
+    mark_dirty();
+  else
+    utils::displayScheduler.erase(&m_taskUpdate);
+
+  m_active = a;
+}
+
+void
 Window::resize(int x, int y, int w, int h) {
   if (x < 0 || y < 0)
     throw std::logic_error("Window::resize(...) bad x or y position");
 
   if (w <= 0 || h <= 0)
     throw std::logic_error("Window::resize(...) bad size");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_list.cc	2005-03-19 00:03:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -41,13 +55,13 @@
 WindowDownloadList::~WindowDownloadList() {
   m_connChanged.disconnect();
 }
 
 void
 WindowDownloadList::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
 
   m_canvas->erase();
 
   if (m_list->base().empty())
     return;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_list.h	2005-03-19 00:03:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_DOWNLOAD_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_statusbar.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_statusbar.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -34,13 +48,13 @@
   Window(new Canvas, false, 3),
   m_download(d) {
 }
 
 void
 WindowDownloadStatusbar::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
 
   m_canvas->erase();
 
   if (m_download->get_download().get_chunks_done() != m_download->get_download().get_chunks_total() || !m_download->get_download().is_open())
     m_canvas->print(0, 0, "Torrent: %.1f / %.1f MiB Rate: %5.1f / %5.1f KiB Uploaded: %.1f MiB",
 		    (double)m_download->get_download().get_bytes_done() / (double)(1 << 20),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_statusbar.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_statusbar.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_download_statusbar.h	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_download_statusbar.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_WINDOW_DOWNLOAD_STATUSBAR_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_file_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_file_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_file_list.cc	2005-05-26 10:05:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_file_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -36,13 +50,13 @@
   m_download(d),
   m_focus(focus) {
 }
 
 void
 WindowFileList::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 10 * 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 10 * 1000000);
   m_canvas->erase();
 
   if (m_download->get_download().get_entry_size() == 0 ||
       m_canvas->get_height() < 2)
     return;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_file_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_file_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_file_list.h	2005-05-26 10:05:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_file_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_FILE_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,71 +12,91 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_WINDOW_BASE_H
 #define RTORRENT_WINDOW_BASE_H
 
 #include <sigc++/slot.h>
 
 #include "canvas.h"
+#include "utils/task.h"
 #include "utils/timer.h"
 
 namespace display {
 
 class Canvas;
 
 class Window {
 public:
   typedef sigc::slot0<void> Slot;
 
-  Window(Canvas* c = NULL, bool d = false, int h = 1) :
-    m_canvas(c), m_active(true), m_dynamic(d), m_minHeight(h) {}
+  Window(Canvas* c = NULL, bool d = false, int h = 1);
 
   virtual ~Window();
 
-  bool         is_active()                          { return m_active; }
-  bool         is_dynamic()                         { return m_dynamic; }
-  bool         is_dirty()                           { return m_nextDraw <= utils::Timer::cache(); }
+  bool                is_active()                          { return m_active; }
+  bool                is_dynamic()                         { return m_dynamic; }
+  bool                is_dirty()                           { return utils::displayScheduler.is_scheduled(&m_taskUpdate); }
 
-  utils::Timer get_next_draw()                      { return m_nextDraw; }
+  //utils::Timer        get_next_draw()                      { return m_nextDraw; }
 
-  int          get_min_height()                     { return m_minHeight; }
+  int                 get_min_height()                     { return m_minHeight; }
 
-  bool         get_active()                         { return m_active; }
-  void         set_active(bool a)                   { m_active = a; }
+  bool                get_active()                         { return m_active; }
+  void                set_active(bool a);
 
-  void         refresh()                            { m_canvas->refresh(); }
-  void         resize(int x, int y, int w, int h);
+  void                refresh()                            { m_canvas->refresh(); }
+  void                resize(int x, int y, int w, int h);
 
-  void         mark_dirty()                         { m_nextDraw = utils::Timer::min(); }
+  void                mark_dirty();
 
-  virtual void redraw() = 0;
+  virtual void        redraw() = 0;
 
-  static void  slot_adjust(Slot s)                  { m_slotAdjust = s; }
+  static void         slot_adjust(Slot s)                  { m_slotAdjust = s; }
 
 protected:
   Window(const Window&);
   void operator = (const Window&);
 
-  static Slot  m_slotAdjust;
+  static Slot         m_slotAdjust;
 
-  Canvas*      m_canvas;
+  Canvas*             m_canvas;
 
-  bool         m_active;
-  bool         m_dynamic;
-  int          m_minHeight;
+  bool                m_active;
+  bool                m_dynamic;
+  int                 m_minHeight;
 
-  utils::Timer m_nextDraw;
+  utils::TaskItem     m_taskUpdate;
 };
 
+inline void
+Window::mark_dirty() {
+  utils::displayScheduler.erase(&m_taskUpdate);
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache());
+}
+
 }
 
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_http_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_http_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_http_queue.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_http_queue.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -41,13 +55,13 @@
   m_connInsert = m_queue->signal_insert().connect(sigc::mem_fun(*this, &WindowHttpQueue::receive_insert));
   m_connErase  = m_queue->signal_erase().connect(sigc::mem_fun(*this, &WindowHttpQueue::receive_erase));
 }
 
 void
 WindowHttpQueue::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
 
   cleanup_list();
 
   if (m_container.empty()) {
     set_active(false);
     m_slotAdjust();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_http_queue.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_http_queue.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_http_queue.h	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_http_queue.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_HTTP_QUEUE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_input.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_input.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -34,15 +48,13 @@
   m_input(input),
   m_focus(false) {
 }
 
 void
 WindowInput::redraw() {
-  m_nextDraw = utils::Timer::max();
   m_canvas->erase();
-
   m_canvas->print(0, 0, "> %s", m_input->c_str());
 
   if (m_focus)
     m_canvas->set_attr(m_input->get_pos() + 2, 0, 1, A_REVERSE, COLOR_PAIR(0));
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_input.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_input.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_input.h	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_input.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_INPUT_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log.cc	2005-04-04 00:34:22.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -31,13 +45,13 @@
 namespace display {
 
 WindowLog::WindowLog(core::Log* l) :
   Window(new Canvas, false, 0),
   m_log(l) {
 
-  set_active(false);
+  m_active = false;
 
   // We're trying out scheduled tasks instead.
   m_connUpdate = l->signal_update().connect(sigc::mem_fun(*this, &WindowLog::receive_update));
 }
 
 WindowLog::~WindowLog() {
@@ -48,14 +62,12 @@
 WindowLog::find_older() {
   return m_log->find_older(utils::Timer::cache() - 60*1000000);
 }
 
 void
 WindowLog::redraw() {
-  m_nextDraw = utils::Timer::max();
-
   m_canvas->erase();
 
   int pos = 0;
 
   for (core::Log::iterator itr = m_log->begin(), end = find_older(); itr != end && pos < m_canvas->get_height(); ++itr)
     m_canvas->print(0, pos++, "(%s) %s",
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log_complete.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log_complete.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log_complete.cc	2005-03-19 01:56:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log_complete.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -46,14 +60,12 @@
 WindowLogComplete::find_older() {
   return m_log->find_older(utils::Timer::cache() - 60*1000000);
 }
 
 void
 WindowLogComplete::redraw() {
-  m_nextDraw = utils::Timer::max();
-
   m_canvas->erase();
 
   int pos = 0;
 
   m_canvas->print(std::max(0, (int)m_canvas->get_width() / 2 - 5), pos++, "*** Log ***");
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log_complete.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log_complete.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log_complete.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log_complete.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_LOG_COMPLETE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_log.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_log.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_LOG_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_info.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_info.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_info.cc	2005-06-20 03:38:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_info.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -39,13 +53,13 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerInfo::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
   m_canvas->erase();
 
   int y = 0;
   torrent::Download d = m_download->get_download();
 
   m_canvas->print(0, y++, "Hash:    %s", utils::string_to_hex(d.get_hash()).c_str());
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_info.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_info.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_info.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_info.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_PEER_INFO_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_list.cc	2005-04-28 04:39:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -38,13 +52,13 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerList::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
   m_canvas->erase();
 
   int x = 2;
   int y = 0;
 
   m_canvas->print(x, y, "DNS");   x += 16;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_peer_list.h	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_peer_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_PEER_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_statusbar.cc	2005-06-15 17:15:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_statusbar.cc	2005-07-06 18:34:37.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -36,16 +50,17 @@
   m_counter(0),
   m_core(c) {
 }
 
 void
 WindowStatusbar::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
 
   m_canvas->erase();
 
+  // TODO: Make a buffer with size = get_width?
   int pos = 0;
   char buf[128];
 
   if (torrent::get_write_throttle() == 0)
     pos = snprintf(buf, 128, "off/");
   else
@@ -53,17 +68,23 @@
 
   if (torrent::get_read_throttle() == 0)
     pos = snprintf(buf + pos, 128 - pos, "off");
   else
     pos = snprintf(buf + pos, 128 - pos, "%-3i", torrent::get_read_throttle() / 1024);
 
-  m_canvas->print(0, 0, "Throttle U/D: %s  Rate: %5.1f / %5.1f KiB  Listen: %s:%i%s  Handshakes: %i",
+  m_canvas->print(0, 0, "Throttle U/D: %s  Rate: %5.1f / %5.1f KiB  Listen: %s:%i%s",
 		  buf,
 		  (double)torrent::get_write_rate() / 1024.0,
 		  (double)torrent::get_read_rate() / 1024.0,
 		  !torrent::get_ip().empty() ? torrent::get_ip().c_str() : "<default>",
 		  (int)torrent::get_listen_port(),
-		  !torrent::get_bind().empty() ? ("  Bind: " + torrent::get_bind()).c_str() : "",
-		  torrent::get_total_handshakes());
+		  !torrent::get_bind().empty() ? ("  Bind: " + torrent::get_bind()).c_str() : "");
+
+  pos = snprintf(buf, 128, "[%3i/%3i/%3i]",
+		 torrent::get_total_handshakes(),
+		 torrent::get_open_sockets(),
+		 torrent::get_max_open_sockets());
+
+  m_canvas->print(m_canvas->get_width() - pos, 0, "%s", buf);
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_statusbar.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_statusbar.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_statusbar.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_statusbar.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_STATUSBAR_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_string_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_string_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_string_list.cc	2005-03-30 05:31:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_string_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -34,14 +48,12 @@
 
 WindowStringList::~WindowStringList() {
 }
 
 void
 WindowStringList::redraw() {
-  m_nextDraw = utils::Timer::max();
-
   m_canvas->erase();
 
   size_t ypos = 0;
   size_t xpos = 1;
   size_t width = 0;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_string_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_string_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_string_list.h	2005-03-30 05:31:46.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_string_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_STRING_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_title.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_title.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_title.cc	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_title.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -31,13 +45,13 @@
   Window(new Canvas, false, 1),
   m_title(s) {
 }
 
 void
 WindowTitle::redraw() {
-  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
   m_canvas->erase();
 
   m_canvas->print(std::max(0, (m_canvas->get_width() - (int)m_title.size()) / 2 - 4), 0,
 		  "*** %s ***", m_title.c_str());
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_title.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_title.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_title.h	2005-03-17 04:35:55.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_title.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_WINDOW_TITLE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_tracker_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_tracker_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_tracker_list.cc	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_tracker_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -38,13 +52,13 @@
   m_focus(focus) {
 }
 
 void
 WindowTrackerList::redraw() {
   // TODO: Make this depend on tracker signal.
-  m_nextDraw = utils::Timer::cache().round_seconds() + 10 * 1000000;
+  utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 10 * 1000000);
   m_canvas->erase();
 
   int pos = 0;
 
   m_canvas->print( 2, pos, "Trackers:");
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_tracker_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_tracker_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/display/window_tracker_list.h	2005-03-17 04:35:56.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/display/window_tracker_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_DISPLAY_TRACKER_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/bindings.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/bindings.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/bindings.cc	2005-03-17 04:35:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/bindings.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/bindings.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/bindings.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/bindings.h	2005-03-17 04:35:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/bindings.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_INPUT_BINDINGS_H
@@ -28,13 +42,14 @@
 #include <sigc++/slot.h>
 
 namespace input {
 
 class Bindings : private std::map<int, sigc::slot0<void> > {
 public:
-  typedef std::map<int, sigc::slot0<void> > Base;
+  typedef sigc::slot0<void>    Slot;
+  typedef std::map<int, Slot > Base;
 
   using Base::iterator;
   using Base::const_iterator;
   using Base::reverse_iterator;
   using Base::const_reverse_iterator;
 
@@ -47,18 +62,20 @@
   using Base::erase;
 
   using Base::operator[];
 
   Bindings() : m_active(true) {}
 
-  void      activate() { m_active = true; }
-  void      disable()  { m_active = false; }
+  void                activate()          { m_active = true; }
+  void                disable()           { m_active = false; }
+
+  bool                pressed(int key);
 
-  bool      pressed(int key);
+  void                ignore(int key)     { (*this)[key] = Slot(); }
 
 private:
-  bool      m_active;
+  bool                m_active;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/manager.cc	2005-03-17 04:35:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/manager.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/manager.h	2005-03-17 04:35:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/manager.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_INPUT_MANAGER_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/path_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/path_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/path_input.cc	2005-04-18 00:40:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/path_input.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/path_input.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/path_input.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/path_input.h	2005-03-30 05:48:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/path_input.h	2005-07-06 18:34:37.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_INPUT_PATH_INPUT_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/text_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/text_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/text_input.cc	2005-03-17 04:35:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/text_input.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/text_input.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/text_input.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/input/text_input.h	2005-03-17 06:53:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/input/text_input.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_INPUT_TEXT_INPUT_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/main.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/main.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/main.cc	2005-06-26 09:07:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/main.cc	2005-07-06 18:34:37.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -39,13 +53,12 @@
 #endif
 
 #include "core/download.h"
 #include "display/canvas.h"
 #include "display/window.h"
 #include "ui/control.h"
-#include "ui/root.h"
 #include "input/bindings.h"
 
 #include "utils/task.h"
 #include "utils/timer.h"
 #include "utils/directory.h"
 
@@ -61,12 +74,13 @@
 
 void do_panic(int signum);
 void print_help();
 
 namespace utils {
   TaskScheduler taskScheduler;
+  TaskScheduler displayScheduler;
 }
 
 bool
 is_resized() {
   static int x = 0;
   static int y = 0;
@@ -82,21 +96,18 @@
 void
 do_shutdown(ui::Control* c) {
   if (!is_shutting_down) {
     is_shutting_down = true;
 
     torrent::listen_close();
-
-    std::for_each(c->get_core().get_download_list().begin(), c->get_core().get_download_list().end(),
-		  std::bind1st(std::mem_fun(&core::Manager::stop), &c->get_core()));
+    c->get_core().shutdown(false);
 
   } else {
     // Close all torrents, this will stop all tracker connections and cause
     // a quick shutdown.
-    std::for_each(c->get_core().get_download_list().begin(), c->get_core().get_download_list().end(),
-		  std::mem_fun(&core::Download::call<void, &torrent::Download::close>));
+    c->get_core().shutdown(true);
   }
 }
 
 int
 parse_options(ui::Control* c, OptionHandler* optionHandler, int argc, char** argv) {
   OptionParser optionParser;
@@ -104,40 +115,49 @@
   // Converted.
   optionParser.insert_flag('h', sigc::ptr_fun(&print_help));
 
   optionParser.insert_option('b', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "bind"));
   optionParser.insert_option('d', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "directory"));
   optionParser.insert_option('i', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "ip"));
-  optionParser.insert_option('p', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "port"));
+  optionParser.insert_option('p', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "port_range"));
   optionParser.insert_option('s', sigc::bind<0>(sigc::mem_fun(*optionHandler, &OptionHandler::process), "session"));
 
   optionParser.insert_option_list('o', sigc::mem_fun(*optionHandler, &OptionHandler::process));
 
   return optionParser.process(argc, argv);
 }
 
 void
 initialize_option_handler(ui::Control* c, OptionHandler* optionHandler) {
-  optionHandler->insert("max_peers",       new OptionHandlerInt(c, &apply_download_max_peers, &validate_download_peers));
-  optionHandler->insert("min_peers",       new OptionHandlerInt(c, &apply_download_min_peers, &validate_download_peers));
-  optionHandler->insert("max_uploads",     new OptionHandlerInt(c, &apply_download_max_uploads, &validate_download_peers));
-
-  optionHandler->insert("download_rate",   new OptionHandlerInt(c, &apply_global_download_rate, &validate_rate));
-  optionHandler->insert("upload_rate",     new OptionHandlerInt(c, &apply_global_upload_rate, &validate_rate));
-
-  optionHandler->insert("bind",            new OptionHandlerString(c, &apply_bind, &validate_ip));
-  optionHandler->insert("ip",              new OptionHandlerString(c, &apply_ip, &validate_ip));
-  optionHandler->insert("port",            new OptionHandlerString(c, &apply_port_range, &validate_port_range));
-
-  optionHandler->insert("check_hash",      new OptionHandlerString(c, &apply_check_hash, &validate_yes_no));
-  optionHandler->insert("directory",       new OptionHandlerString(c, &apply_download_directory, &validate_directory));
-
-  optionHandler->insert("hash_read_ahead", new OptionHandlerInt(c, &apply_hash_read_ahead, &validate_read_ahead));
-  optionHandler->insert("max_open_files",  new OptionHandlerInt(c, &apply_max_open_files, &validate_fd));
-  optionHandler->insert("session",         new OptionHandlerString(c, &apply_session_directory, &validate_directory));
-  optionHandler->insert("tracker_dump",    new OptionHandlerString(c, &apply_tracker_dump, &validate_yes_no));
+  optionHandler->insert("max_peers",         new OptionHandlerInt(c, &apply_download_max_peers, &validate_download_peers));
+  optionHandler->insert("min_peers",         new OptionHandlerInt(c, &apply_download_min_peers, &validate_download_peers));
+  optionHandler->insert("max_uploads",       new OptionHandlerInt(c, &apply_download_max_uploads, &validate_download_peers));
+
+  optionHandler->insert("download_rate",     new OptionHandlerInt(c, &apply_global_download_rate, &validate_rate));
+  optionHandler->insert("upload_rate",       new OptionHandlerInt(c, &apply_global_upload_rate, &validate_rate));
+
+  optionHandler->insert("bind",              new OptionHandlerString(c, &apply_bind, &validate_ip));
+  optionHandler->insert("ip",                new OptionHandlerString(c, &apply_ip, &validate_ip));
+  optionHandler->insert("port_range",        new OptionHandlerString(c, &apply_port_range, &validate_port_range));
+  optionHandler->insert("port_random",       new OptionHandlerString(c, &apply_port_random, &validate_yes_no));
+
+  optionHandler->insert("check_hash",        new OptionHandlerString(c, &apply_check_hash, &validate_yes_no));
+  optionHandler->insert("directory",         new OptionHandlerString(c, &apply_download_directory, &validate_directory));
+
+  optionHandler->insert("hash_read_ahead",   new OptionHandlerInt(c, &apply_hash_read_ahead, &validate_hash_read_ahead));
+  optionHandler->insert("hash_interval",     new OptionHandlerInt(c, &apply_hash_interval, &validate_hash_interval));
+  optionHandler->insert("hash_max_tries",    new OptionHandlerInt(c, &apply_hash_max_tries, &validate_hash_max_tries));
+  optionHandler->insert("max_open_files",    new OptionHandlerInt(c, &apply_max_open_files, &validate_fd));
+  optionHandler->insert("max_open_sockets",  new OptionHandlerInt(c, &apply_max_open_sockets, &validate_fd));
+  optionHandler->insert("throttle_interval", new OptionHandlerInt(c, &apply_throttle_interval, &validate_throttle_interval));
+
+  optionHandler->insert("connection_leech",  new OptionHandlerString(c, &apply_connection_leech, &validate_non_empty));
+  optionHandler->insert("connection_seed",   new OptionHandlerString(c, &apply_connection_seed, &validate_non_empty));
+
+  optionHandler->insert("session",           new OptionHandlerString(c, &apply_session_directory, &validate_directory));
+  optionHandler->insert("tracker_dump",      new OptionHandlerString(c, &apply_tracker_dump, &validate_yes_no));
 }
 
 void
 load_option_file(const std::string& filename, OptionHandler* optionHandler, bool require = false) {
   std::fstream f(filename.c_str(), std::ios::in);
 
@@ -178,69 +198,70 @@
 
   c->get_core().initialize();
 }
 
 int
 main(int argc, char** argv) {
+  utils::Timer::update();
+
   OptionHandler optionHandler;
   ui::Control   uiControl;
-  ui::Root      uiRoot(&uiControl);
-
-  utils::Timer::update();
 
   srandom(utils::Timer::cache().usec());
   srand48(utils::Timer::cache().usec());
 
   initialize_option_handler(&uiControl, &optionHandler);
 
   try {
 
     SignalHandler::set_ignore(SIGPIPE);
-    SignalHandler::set_handler(SIGINT, sigc::bind(sigc::mem_fun(uiRoot, &ui::Root::set_shutdown_received), true));
+    SignalHandler::set_handler(SIGINT,  sigc::bind(sigc::mem_fun(uiControl, &ui::Control::set_shutdown_received), true));
     SignalHandler::set_handler(SIGSEGV, sigc::bind(sigc::ptr_fun(&do_panic), SIGSEGV));
-    SignalHandler::set_handler(SIGBUS, sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
-    SignalHandler::set_handler(SIGFPE, sigc::bind(sigc::ptr_fun(&do_panic), SIGFPE));
+    SignalHandler::set_handler(SIGBUS,  sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
+    SignalHandler::set_handler(SIGFPE,  sigc::bind(sigc::ptr_fun(&do_panic), SIGFPE));
 
     // Need to initialize this before parseing options.
     torrent::initialize();
 
     if (getenv("HOME"))
       load_option_file(getenv("HOME") + std::string("/.rtorrent.rc"), &optionHandler);
 
     int firstArg = parse_options(&uiControl, &optionHandler, argc, argv);
 
     initialize_display(&uiControl);
     initialize_core(&uiControl);
 
-    uiRoot.init();
+    uiControl.get_ui().init(&uiControl);
 
     load_session_torrents(&uiControl);
     load_arg_torrents(&uiControl, argv + firstArg, argv + argc);
 
     uiControl.get_display().adjust_layout();
 
     while (!is_shutting_down || !torrent::is_inactive()) {
 
-      if (uiRoot.get_shutdown_received()) {
+      if (uiControl.get_shutdown_received()) {
 	do_shutdown(&uiControl);
-	uiRoot.set_shutdown_received(false);
+	uiControl.set_shutdown_received(false);
       }
 
       utils::Timer::update();
       utils::taskScheduler.execute(utils::Timer::cache());
     
       // This needs to be called every second or so. Currently done by
       // the throttle task in libtorrent.
-      uiControl.get_display().do_update();
+      if (!utils::displayScheduler.empty() &&
+	  utils::displayScheduler.get_next_timeout() <= utils::Timer::cache())
+	uiControl.get_display().do_update();
 
       uiControl.get_core().get_poll().poll(!utils::taskScheduler.empty() ?
 					   utils::taskScheduler.get_next_timeout() - utils::Timer::cache() :
 					   60 * 1000000);
     }
 
-    uiRoot.cleanup();
+    uiControl.get_ui().cleanup();
     uiControl.get_core().cleanup();
 
     display::Canvas::erase_std();
     display::Canvas::refresh_std();
     display::Canvas::do_update();
     display::Canvas::cleanup();
@@ -276,14 +297,16 @@
 
 #else
   std::cout << "Stack dump not enabled." << std::endl;
 #endif
   
   if (signum == SIGBUS)
-    std::cout << "A bus error might mean you ran out of diskspace." << std::endl;
+    std::cout << "A bus error propably means you ran out of diskspace." << std::endl;
   
+  std::cout << "TO AVOID CORRUPT DOWNLOADS, RUN \"touch\" ON ALL DOWNLOADED FILES OR INITATE HASH RECHECK WITH ^R ON ALL TORRENTS." << std::endl;
+
   exit(-1);
 }
 
 void
 receive_tracker_dump(std::istream* s) {
   std::stringstream filename;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_file.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_file.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_file.cc	2005-06-27 02:50:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_file.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_file.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_file.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_file.h	2005-06-01 22:00:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_file.h	2005-07-02 04:45:12.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_OPTION_FILE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler.cc	2005-06-20 03:58:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler.h	2005-06-20 04:00:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_OPTION_HANDLER_H
@@ -51,12 +65,15 @@
   using Base::end;
   using Base::rbegin;
   using Base::rend;
 
   using Base::find;
 
+  OptionHandler() {}
+  ~OptionHandler() { clear(); }
+
   // We take over ownership of opt.
   void                insert(const std::string& key, OptionHandlerBase* opt);
   void                erase(const std::string& key);
 
   void                clear();
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler_rules.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler_rules.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler_rules.cc	2005-06-27 03:00:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler_rules.cc	2005-07-06 18:34:37.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -58,29 +72,49 @@
 bool
 validate_yes_no(const std::string& arg) {
   return arg == "yes" || arg == "no";
 }
 
 bool
+validate_non_empty(const std::string& arg) {
+  return !arg.empty();
+}
+
+bool
 validate_download_peers(int arg) {
   return arg > 0 && arg < (1 << 16);
 }
 
 bool
 validate_rate(int arg) {
   return arg >= 0 && arg < (1 << 20);
 }
 
 bool
-validate_read_ahead(int arg) {
+validate_hash_read_ahead(int arg) {
   return arg >= 1 && arg < 64;
 }
 
 bool
+validate_hash_interval(int arg) {
+  return arg >= 1 && arg < 1000;
+}
+
+bool
+validate_hash_max_tries(int arg) {
+  return arg >= 1 && arg < 20;
+}
+
+bool
 validate_fd(int arg) {
-  return arg >= 10 && arg < (1 << 16);
+  return arg >= 1 && arg < (1 << 16);
+}
+
+bool
+validate_throttle_interval(int arg) {
+  return arg > 0 && arg < 5000;
 }
 
 void
 apply_download_min_peers(ui::Control* m, int arg) {
   m->get_core().get_download_list().slot_map_insert().insert("1_min_peers", sigc::bind(sigc::mem_fun(&core::Download::call<void, uint32_t, &torrent::Download::set_peers_min>), arg));
 }
@@ -101,12 +135,22 @@
     m->get_core().get_download_list().slot_map_insert().insert("1_directory", sigc::bind(sigc::mem_fun(&core::Download::set_root_directory), arg));
   else
     m->get_core().get_download_list().slot_map_insert().erase("1_directory");
 }
 
 void
+apply_connection_leech(ui::Control* m, const std::string& arg) {
+  m->get_core().get_download_list().slot_map_insert().insert("1_connection_leech", sigc::bind(sigc::mem_fun(&core::Download::set_connection_leech), arg));
+}
+
+void
+apply_connection_seed(ui::Control* m, const std::string& arg) {
+  m->get_core().get_download_list().slot_map_insert().insert("1_connection_seed", sigc::bind(sigc::mem_fun(&core::Download::set_connection_seed), arg));
+}
+
+void
 apply_global_download_rate(ui::Control* m, int arg) {
   torrent::set_read_throttle(arg * 1024);
 }
 
 void
 apply_global_upload_rate(ui::Control* m, int arg) {
@@ -116,17 +160,37 @@
 void
 apply_hash_read_ahead(ui::Control* m, int arg) {
   torrent::set_hash_read_ahead(arg << 20);
 }
 
 void
+apply_hash_interval(ui::Control* m, int arg) {
+  torrent::set_hash_interval(arg * 1000);
+}
+
+void
+apply_hash_max_tries(ui::Control* m, int arg) {
+  torrent::set_hash_max_tries(arg);
+}
+
+void
 apply_max_open_files(ui::Control* m, int arg) {
   torrent::set_max_open_files(arg);
 }
 
 void
+apply_max_open_sockets(ui::Control* m, int arg) {
+  torrent::set_max_open_sockets(arg);
+}
+
+void
+apply_throttle_interval(ui::Control* m, int arg) {
+  torrent::set_throttle_interval(arg * 1000);
+}
+
+void
 apply_bind(ui::Control* m, const std::string& arg) {
   torrent::set_bind(arg);
 }
 
 void
 apply_ip(ui::Control* m, const std::string& arg) {
@@ -142,25 +206,30 @@
   std::sscanf(arg.c_str(), "%i-%i", &a, &b);
 
   m->get_core().set_port_range(a, b);
 }
 
 void
+apply_port_random(ui::Control* m, const std::string& arg) {
+  m->get_core().set_port_random(arg == "yes");
+}
+
+void
 apply_tracker_dump(ui::Control* m, const std::string& arg) {
   if (arg == "yes")
     m->get_core().get_download_list().slot_map_insert().insert("1_tracker_dump", sigc::bind(sigc::mem_fun(&core::Download::call<sigc::connection, torrent::Download::SlotIStream, &torrent::Download::signal_tracker_dump>), sigc::ptr_fun(&receive_tracker_dump)));
   else
     m->get_core().get_download_list().slot_map_insert().erase("1_tracker_dump");
 }
 
 void
 apply_check_hash(ui::Control* m, const std::string& arg) {
   if (arg == "yes")
-    m->get_core().get_download_list().slot_map_finished().insert("1_check_hash", sigc::mem_fun(m->get_core(), &core::Manager::check_hash));
+    m->get_core().get_download_list().slot_map_finished().insert("1_download_done", sigc::bind(sigc::mem_fun(m->get_core(), &core::Manager::receive_download_done), true));
   else
-    m->get_core().get_download_list().slot_map_finished().erase("1_check_hash");
+    m->get_core().get_download_list().slot_map_finished().insert("1_download_done", sigc::bind(sigc::mem_fun(m->get_core(), &core::Manager::receive_download_done), false));
 }
 
 void
 apply_session_directory(ui::Control* m, const std::string& arg) {
   m->get_core().get_download_store().use(arg);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler_rules.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler_rules.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_handler_rules.h	2005-06-26 09:00:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_handler_rules.h	2005-07-06 18:34:37.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_OPTION_HANDLER_RULES_H
@@ -31,37 +45,51 @@
 #include "core/download_slot_map.h"
 
 namespace ui {
   class Control;
 }
 
+// Not pretty, but it is simple and easy to modify.
+
 bool validate_ip(const std::string& arg);
 bool validate_directory(const std::string& arg);
 bool validate_port_range(const std::string& arg);
 bool validate_yes_no(const std::string& arg);
+bool validate_non_empty(const std::string& arg);
 
 bool validate_download_peers(int arg);
 bool validate_rate(int arg);
-bool validate_read_ahead(int arg);
+bool validate_hash_read_ahead(int arg);
+bool validate_hash_interval(int arg);
+bool validate_hash_max_tries(int arg);
 bool validate_fd(int arg);
 
+bool validate_throttle_interval(int arg);
+
 void apply_download_min_peers(ui::Control* m, int arg);
 void apply_download_max_peers(ui::Control* m, int arg);
 void apply_download_max_uploads(ui::Control* m, int arg);
-
 void apply_download_directory(ui::Control* m, const std::string& arg);
 
+void apply_connection_leech(ui::Control* m, const std::string& arg);
+void apply_connection_seed(ui::Control* m, const std::string& arg);
+
 void apply_global_download_rate(ui::Control* m, int arg);
 void apply_global_upload_rate(ui::Control* m, int arg);
 
 void apply_hash_read_ahead(ui::Control* m, int arg);
+void apply_hash_interval(ui::Control* m, int arg);
+void apply_hash_max_tries(ui::Control* m, int arg);
 void apply_max_open_files(ui::Control* m, int arg);
+void apply_max_open_sockets(ui::Control* m, int arg);
+void apply_throttle_interval(ui::Control* m, int arg);
 
 void apply_ip(ui::Control* m, const std::string& arg);
 void apply_bind(ui::Control* m, const std::string& arg);
 void apply_port_range(ui::Control* m, const std::string& arg);
+void apply_port_random(ui::Control* m, const std::string& arg);
 void apply_tracker_dump(ui::Control* m, const std::string& arg);
 void apply_check_hash(ui::Control* m, const std::string& arg);
 
 void apply_session_directory(ui::Control* m, const std::string& arg);
 
 class OptionHandlerInt : public OptionHandlerBase {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_parser.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_parser.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_parser.cc	2005-05-31 04:27:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_parser.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_parser.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_parser.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/option_parser.h	2005-05-31 04:14:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/option_parser.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_OPTION_PARSER_H
@@ -33,12 +47,15 @@
 public:
   typedef sigc::slot0<void>                                         Slot;
   typedef sigc::slot1<void, const std::string&>                     SlotString;
   typedef sigc::slot2<void, const std::string&, const std::string&> SlotStringPair;
   typedef sigc::slot2<void, int, int>                               SlotIntPair;
 
+  OptionParser() {}
+  ~OptionParser() { m_container.clear(); }
+
   void                insert_flag(char c, Slot s);
   void                insert_option(char c, SlotString s);
   void                insert_option_list(char c, SlotStringPair s);
   void                insert_int_pair(char c, SlotIntPair s);
 
   // Returns the index of the first non-option argument.
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/signal_handler.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/signal_handler.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/signal_handler.cc	2005-06-15 04:59:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/signal_handler.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/signal_handler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/signal_handler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/signal_handler.h	2005-06-15 04:53:05.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/signal_handler.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_SIGNAL_HANDLER_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/control.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/control.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/control.h	2005-03-17 04:35:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/control.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,40 +12,63 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_CONTROL_H
 #define RTORRENT_UI_CONTROL_H
 
 #include "core/manager.h"
 #include "display/manager.h"
 #include "input/manager.h"
 
+#include "root.h"
+
 namespace ui {
 
 class Control {
 public:
-  Control() {}
+  Control() : m_shutdownReceived(false) {}
   
-  core::Manager&    get_core()    { return m_core; }
-  display::Manager& get_display() { return m_display; }
-  input::Manager&   get_input()   { return m_input; }
+  bool                get_shutdown_received()       { return m_shutdownReceived; }
+  void                set_shutdown_received(bool v) { m_shutdownReceived = v; }
+
+  Root&               get_ui()                      { return m_ui; }
+  core::Manager&      get_core()                    { return m_core; }
+  display::Manager&   get_display()                 { return m_display; }
+  input::Manager&     get_input()                   { return m_input; }
 
 private:
   Control(const Control&);
   void operator = (const Control&);
 
-  core::Manager     m_core;
-  display::Manager  m_display;
-  input::Manager    m_input;
+  bool                m_shutdownReceived;
+
+  Root                m_ui;
+  core::Manager       m_core;
+  display::Manager    m_display;
+  input::Manager      m_input;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download.cc	2005-06-27 02:57:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -28,13 +42,12 @@
 #include <rak/functional.h>
 
 #include "core/download.h"
 #include "input/bindings.h"
 #include "display/window_title.h"
 #include "display/window_download_statusbar.h"
-#include "display/window_statusbar.h"
 
 #include "control.h"
 #include "download.h"
 #include "element_file_list.h"
 #include "element_peer_info.h"
 #include "element_peer_list.h"
@@ -45,13 +58,12 @@
 Download::Download(DPtr d, Control* c) :
   m_download(d),
   m_state(DISPLAY_MAX_SIZE),
 
   m_windowTitle(new WTitle(d->get_download().get_name())),
   m_windowDownloadStatus(new WDownloadStatus(d)),
-  m_windowMainStatus(new WMainStatus(&c->get_core())),
 
   m_window(c->get_display().end()),
 
   m_control(c),
   m_bindings(new input::Bindings) {
 
@@ -80,25 +92,22 @@
   delete m_bindings;
 
   std::for_each(m_uiArray, m_uiArray + DISPLAY_MAX_SIZE, rak::call_delete<ElementBase>());
 
   delete m_windowTitle;
   delete m_windowDownloadStatus;
-  delete m_windowMainStatus;
 }
 
 void
 Download::activate() {
   if (m_window != m_control->get_display().end())
     throw std::logic_error("ui::Download::activate() called on an already activated object");
 
+  m_control->get_display().push_front(m_windowDownloadStatus);
   m_window = m_control->get_display().insert(m_control->get_display().begin(), NULL);
-
-  m_control->get_display().insert(m_control->get_display().begin(), m_windowTitle);
-  m_control->get_display().insert(m_control->get_display().end(), m_windowDownloadStatus);
-  m_control->get_display().insert(m_control->get_display().end(), m_windowMainStatus);
+  m_control->get_display().push_front(m_windowTitle);
 
   m_control->get_input().push_front(m_bindings);
 
   activate_display(DISPLAY_PEER_LIST);
 }
 
@@ -109,13 +118,12 @@
 
   disable_display();
 
   m_control->get_display().erase(m_window);
   m_control->get_display().erase(m_windowTitle);
   m_control->get_display().erase(m_windowDownloadStatus);
-  m_control->get_display().erase(m_windowMainStatus);
 
   m_window = m_control->get_display().end();
 
   m_control->get_input().erase(m_bindings);
 }
 
@@ -178,26 +186,12 @@
     m_focus = m_peers.erase(itr);
   else
     m_peers.erase(itr);
 }
 
 void
-Download::receive_read_throttle(int t) {
-  m_windowMainStatus->mark_dirty();
-
-  torrent::set_read_throttle(torrent::get_read_throttle() + t * 1024);
-}
-
-void
-Download::receive_write_throttle(int t) {
-  m_windowMainStatus->mark_dirty();
-
-  torrent::set_write_throttle(torrent::get_write_throttle() + t * 1024);
-}
-
-void
 Download::receive_max_uploads(int t) {
   m_windowDownloadStatus->mark_dirty();
 
   m_download->get_download().set_uploads_max(std::max(m_download->get_download().get_uploads_max() + t, (uint32_t)2));
 }
 
@@ -233,26 +227,12 @@
 
   mark_dirty();
 }
 
 void
 Download::bind_keys() {
-  (*m_bindings)['a'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), 1);
-  (*m_bindings)['z'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), -1);
-  (*m_bindings)['s'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), 5);
-  (*m_bindings)['x'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), -5);
-  (*m_bindings)['d'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), 50);
-  (*m_bindings)['c'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_write_throttle), -50);
-
-  (*m_bindings)['A'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), 1);
-  (*m_bindings)['Z'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), -1);
-  (*m_bindings)['S'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), 5);
-  (*m_bindings)['X'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), -5);
-  (*m_bindings)['D'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), 50);
-  (*m_bindings)['C'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_read_throttle), -50);
-
   (*m_bindings)['1'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_uploads), -1);
   (*m_bindings)['2'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_uploads), 1);
   (*m_bindings)['3'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_min_peers), -5);
   (*m_bindings)['4'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_min_peers), 5);
   (*m_bindings)['5'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_peers), -5);
   (*m_bindings)['6'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_peers), 5);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download.h	2005-05-02 09:13:18.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_DOWNLOAD_H
@@ -44,13 +58,12 @@
 class Control;
 class ElementBase;
 
 class Download {
 public:
   typedef display::WindowTitle             WTitle;
-  typedef display::WindowStatusbar         WMainStatus;
   typedef display::WindowDownloadStatusbar WDownloadStatus;
 
   typedef core::Download*                  DPtr;
   typedef std::list<torrent::Peer>         PList;
   typedef display::Manager::iterator       MItr;
 
@@ -80,14 +93,12 @@
   void                receive_next();
   void                receive_prev();
 
   void                receive_peer_connected(torrent::Peer p);
   void                receive_peer_disconnected(torrent::Peer p);
 
-  void                receive_read_throttle(int t);
-  void                receive_write_throttle(int t);
   void                receive_max_uploads(int t);
   void                receive_min_peers(int t);
   void                receive_max_peers(int t);
   void                receive_change(Display d);
 
   void                receive_snub_peer();
@@ -103,13 +114,12 @@
   Display             m_state;
 
   ElementBase*        m_uiArray[DISPLAY_MAX_SIZE];
 
   WTitle*             m_windowTitle;
   WDownloadStatus*    m_windowDownloadStatus;
-  WMainStatus*        m_windowMainStatus;
 
   MItr                m_window;
 
   Control*            m_control;
   input::Bindings*    m_bindings;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download_list.cc	2005-06-26 02:19:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download_list.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -33,14 +47,14 @@
 #include "input/bindings.h"
 #include "input/path_input.h"
 
 #include "display/window_http_queue.h"
 #include "display/window_input.h"
 #include "display/window_log.h"
-#include "display/window_statusbar.h"
 #include "display/window_title.h"
+#include "display/window_statusbar.h"
 
 #include "control.h"
 #include "download.h"
 #include "download_list.h"
 #include "element_download_list.h"
 #include "element_log_complete.h"
@@ -51,13 +65,12 @@
 DownloadList::DownloadList(Control* c) :
   m_state(DISPLAY_MAX_SIZE),
 
   m_window(c->get_display().end()),
 
   m_windowTitle(new WTitle("rTorrent " VERSION " - libTorrent " + torrent::get_version())),
-  m_windowStatus(new WStatus(&c->get_core())),
   m_windowHttpQueue(new WHttp(&c->get_core().get_http_queue())),
 
   m_uiDownload(NULL),
 
   m_downloadList(&c->get_core().get_download_list()),
 
@@ -79,13 +92,12 @@
   if (is_active())
     throw std::logic_error("ui::DownloadList::~DownloadList() called on an active object");
 
   std::for_each(m_uiArray, m_uiArray + DISPLAY_MAX_SIZE, rak::call_delete<ElementBase>());
 
   delete m_windowTitle;
-  delete m_windowStatus;
   delete m_bindings;
 
   delete m_windowLog;
   delete m_windowTextInput->get_input();
   delete m_windowTextInput;
   delete m_windowHttpQueue;
@@ -97,42 +109,39 @@
     throw std::logic_error("ui::Download::activate() called on an already activated object");
 
   utils::taskScheduler.insert(&m_taskUpdate, utils::Timer::cache() + 1000000);
 
   m_windowTextInput->set_active(false);
 
+  m_control->get_display().push_front(m_windowTextInput);
+  m_control->get_display().push_front(m_windowHttpQueue);
+  m_control->get_display().push_front(m_windowLog);
   m_window = m_control->get_display().insert(m_control->get_display().begin(), NULL);
   m_control->get_display().push_front(m_windowTitle);
 
-  m_control->get_display().push_back(m_windowLog);
-  m_control->get_display().push_back(m_windowHttpQueue);
-  m_control->get_display().push_back(m_windowTextInput);
-  m_control->get_display().push_back(m_windowStatus);
-
   m_control->get_input().push_front(m_bindings);
 
   activate_display(DISPLAY_DOWNLOAD_LIST);
 }
 
 void
 DownloadList::disable() {
   if (!is_active())
     throw std::logic_error("ui::Download::disable() called on an already disabled object");
 
-  disable_display();
-
-  utils::taskScheduler.erase(&m_taskUpdate);
-
   if (m_windowTextInput->is_active()) {
     m_windowTextInput->get_input()->clear();
     receive_exit_input();
   }
 
+  disable_display();
+
+  utils::taskScheduler.erase(&m_taskUpdate);
+
   m_control->get_display().erase(m_window);
   m_control->get_display().erase(m_windowTitle);
-  m_control->get_display().erase(m_windowStatus);
   m_control->get_display().erase(m_windowTextInput);
   m_control->get_display().erase(m_windowLog);
   m_control->get_display().erase(m_windowHttpQueue);
 
   m_window = m_control->get_display().end();
 
@@ -170,26 +179,12 @@
 void
 DownloadList::receive_prev() {
   m_downloadList.dec_focus();
 }
 
 void
-DownloadList::receive_read_throttle(int t) {
-  m_windowStatus->mark_dirty();
-
-  torrent::set_read_throttle(torrent::get_read_throttle() + t * 1024);
-}
-
-void
-DownloadList::receive_write_throttle(int t) {
-  m_windowStatus->mark_dirty();
-
-  torrent::set_write_throttle(torrent::get_write_throttle() + t * 1024);
-}
-
-void
 DownloadList::receive_start_download() {
   if (m_downloadList.get_focus() == m_downloadList.end())
     return;
 
   m_control->get_core().start(*m_downloadList.get_focus());
 }
@@ -242,13 +237,13 @@
 
   m_control->get_core().check_hash(*m_downloadList.get_focus());
 }
 
 void
 DownloadList::receive_view_input() {
-  m_windowStatus->set_active(false);
+  m_control->get_ui().window_statusbar()->set_active(false);
   m_windowTextInput->set_active(true);
   m_control->get_display().adjust_layout();
 
   m_control->get_input().set_text_input(m_windowTextInput->get_input());
 
   m_windowTextInput->set_focus(true);
@@ -256,13 +251,13 @@
   (*m_bindings)['\n'] = sigc::mem_fun(*this, &DownloadList::receive_exit_input);
   (*m_bindings)[KEY_ENTER] = sigc::mem_fun(*this, &DownloadList::receive_exit_input);
 }
 
 void
 DownloadList::receive_exit_input() {
-  m_windowStatus->set_active(true);
+  m_control->get_ui().window_statusbar()->set_active(true);
   m_windowTextInput->set_active(false);
 
   m_control->get_input().set_text_input();
 
   m_slotOpenUri(m_windowTextInput->get_input()->str());
 
@@ -290,26 +285,12 @@
 
   utils::taskScheduler.insert(&m_taskUpdate, (utils::Timer::cache() + 1000000).round_seconds());
 }
 
 void
 DownloadList::setup_keys() {
-  (*m_bindings)['a']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), 1);
-  (*m_bindings)['z']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), -1);
-  (*m_bindings)['s']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), 5);
-  (*m_bindings)['x']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), -5);
-  (*m_bindings)['d']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), 50);
-  (*m_bindings)['c']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_write_throttle), -50);
-
-  (*m_bindings)['A']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), 1);
-  (*m_bindings)['Z']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), -1);
-  (*m_bindings)['S']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), 5);
-  (*m_bindings)['X']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), -5);
-  (*m_bindings)['D']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), 50);
-  (*m_bindings)['C']           = sigc::bind(sigc::mem_fun(*this, &DownloadList::receive_read_throttle), -50);
-
   (*m_bindings)['\x13']        = sigc::mem_fun(*this, &DownloadList::receive_start_download);
   (*m_bindings)['\x04']        = sigc::mem_fun(*this, &DownloadList::receive_stop_download);
   (*m_bindings)['\x12']        = sigc::mem_fun(*this, &DownloadList::receive_check_hash);
 
   (*m_bindings)['\x7f']        = sigc::mem_fun(*this, &DownloadList::receive_view_input);
   (*m_bindings)[KEY_BACKSPACE] = sigc::mem_fun(*this, &DownloadList::receive_view_input);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/download_list.h	2005-06-26 02:18:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/download_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_DOWNLOAD_LIST_H
@@ -36,13 +50,12 @@
 namespace display {
   class WindowDownloadList;
   class WindowHttpQueue;
   class WindowInput;
   class WindowLog;
   class WindowLogComplete;
-  class WindowStatusbar;
   class WindowTitle;
 }
 
 namespace ui {
 
 class Control;
@@ -53,13 +66,12 @@
 public:
   typedef display::WindowDownloadList              WList;
   typedef display::WindowHttpQueue                 WHttp;
   typedef display::WindowInput                     WInput;
   typedef display::WindowLog                       WLog;
   typedef display::WindowLogComplete               WLogComplete;
-  typedef display::WindowStatusbar                 WStatus;
   typedef display::WindowTitle                     WTitle;
 
   typedef utils::ListFocus<core::DownloadList>     DList;
 
   typedef sigc::slot1<void, const std::string&>    SlotOpenUri;
 
@@ -91,15 +103,12 @@
   DownloadList(const DownloadList&);
   void operator = (const DownloadList&);
 
   void                receive_next();
   void                receive_prev();
 
-  void                receive_read_throttle(int t);
-  void                receive_write_throttle(int t);
-
   void                receive_start_download();
   void                receive_stop_download();
 
   void                receive_view_download();
   void                receive_exit_download();
 
@@ -119,13 +128,12 @@
 
   ElementBase*        m_uiArray[DISPLAY_MAX_SIZE];
 
   MItr                m_window;
 
   WTitle*             m_windowTitle;
-  WStatus*            m_windowStatus;
   WLog*               m_windowLog;
   WInput*             m_windowTextInput;
   WHttp*              m_windowHttpQueue;
 
   utils::TaskItem     m_taskUpdate;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_base.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_base.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_base.h	2005-03-18 02:33:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_base.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_BASE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_download_list.cc	2005-03-18 23:56:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_download_list.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_download_list.h	2005-03-18 23:56:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_download_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_DOWNLOAD_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_file_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_file_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_file_list.cc	2005-06-26 23:30:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_file_list.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_file_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_file_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_file_list.h	2005-06-26 23:20:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_file_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_FILE_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_log_complete.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_log_complete.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_log_complete.cc	2005-03-18 04:06:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_log_complete.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_log_complete.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_log_complete.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_log_complete.h	2005-03-18 04:04:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_log_complete.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_LOG_COMPLETE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_info.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_info.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_info.cc	2005-03-18 02:51:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_info.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_info.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_info.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_info.h	2005-03-18 02:41:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_info.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_PEER_INFO_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_list.cc	2005-03-18 02:51:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_list.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_peer_list.h	2005-03-18 02:41:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_peer_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_PEER_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_string_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_string_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_string_list.cc	2005-03-30 05:57:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_string_list.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_string_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_string_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_string_list.h	2005-03-30 05:36:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_string_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_STRING_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_tracker_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_tracker_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_tracker_list.cc	2005-06-20 02:45:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_tracker_list.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
@@ -94,12 +108,12 @@
   if (m_window == NULL)
     throw std::logic_error("ui::ElementTrackerList::receive_group_cycle(...) called on a disabled object");
 
   if (m_focus >= m_download->get_download().get_tracker_size())
     throw std::logic_error("ui::ElementTrackerList::receive_group_cycle(...) called with an invalid focus");
 
-  m_download->get_download().cycle_tracker_group(m_download->get_download().get_tracker(m_focus).get_group());
+  m_download->get_download().tracker_cycle_group(m_download->get_download().get_tracker(m_focus).get_group());
 
   m_window->mark_dirty();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_tracker_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_tracker_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/element_tracker_list.h	2005-06-20 02:02:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/element_tracker_list.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_TRACKER_LIST_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/root.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/root.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/root.cc	2005-06-26 02:22:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/root.cc	2005-07-02 04:45:25.000000000 +0800
@@ -12,51 +12,116 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
+#include <stdexcept>
 #include <sigc++/bind.h>
+#include <torrent/torrent.h>
 
 #include "control.h"
 #include "download_list.h"
+#include "display/window_statusbar.h"
 
 #include "root.h"
 
 namespace ui {
 
+Root::Root() :
+  m_control(NULL),
+  m_downloadList(NULL),
+  m_windowStatusbar(NULL) {
+}
+
 void
-Root::init() {
+Root::init(Control* c) {
+  if (m_control != NULL)
+    throw std::logic_error("Root::init() called twice on the same object");
+
+  m_control = c;
   setup_keys();
 
-  m_downloadList = new DownloadList(m_control);
+  m_windowStatusbar = new WStatusbar(&m_control->get_core());
+  m_downloadList =    new DownloadList(m_control);
+
+  m_control->get_display().push_back(m_windowStatusbar);
 
   m_downloadList->activate();
   m_downloadList->slot_open_uri(sigc::mem_fun(m_control->get_core(), &core::Manager::insert));
 }
 
 void
 Root::cleanup() {
+  if (m_control == NULL)
+    throw std::logic_error("Root::cleanup() called twice on the same object");
+
   if (m_downloadList->is_active())
     m_downloadList->disable();
 
+  m_control->get_display().erase(m_windowStatusbar);
+
   delete m_downloadList;
+  delete m_windowStatusbar;
 
   m_control->get_input().erase(&m_bindings);
+  m_control = NULL;
 }
 
 void
 Root::setup_keys() {
   m_control->get_input().push_back(&m_bindings);
 
-  m_bindings[KEY_RESIZE] = sigc::mem_fun(m_control->get_display(), &display::Manager::adjust_layout);
-  m_bindings['\x11']     = sigc::bind(sigc::mem_fun(*this, &Root::set_shutdown_received), true);
+  m_bindings['a']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), 1);
+  m_bindings['z']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), -1);
+  m_bindings['s']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), 5);
+  m_bindings['x']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), -5);
+  m_bindings['d']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), 50);
+  m_bindings['c']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_write_throttle), -50);
+
+  m_bindings['A']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), 1);
+  m_bindings['Z']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), -1);
+  m_bindings['S']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), 5);
+  m_bindings['X']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), -5);
+  m_bindings['D']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), 50);
+  m_bindings['C']           = sigc::bind(sigc::mem_fun(*this, &Root::receive_read_throttle), -50);
+
+  m_bindings[KEY_RESIZE]    = sigc::mem_fun(m_control->get_display(), &display::Manager::adjust_layout);
+  m_bindings['\x11']        = sigc::bind(sigc::mem_fun(*m_control, &Control::set_shutdown_received), true);
+}
+
+void
+Root::receive_read_throttle(int t) {
+  m_windowStatusbar->mark_dirty();
+
+  torrent::set_read_throttle(torrent::get_read_throttle() + t * 1024);
+}
+
+void
+Root::receive_write_throttle(int t) {
+  m_windowStatusbar->mark_dirty();
+
+  torrent::set_write_throttle(torrent::get_write_throttle() + t * 1024);
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/root.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/root.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/ui/root.h	2005-03-17 04:35:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/ui/root.h	2005-07-02 04:45:11.000000000 +0800
@@ -12,44 +12,67 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ROOT_H
 #define RTORRENT_UI_ROOT_H
 
 #include "input/bindings.h"
 
+namespace display {
+  class WindowStatusbar;
+}
+
 namespace ui {
 
 class DownloadList;
+class Control;
 
 class Root {
 public:
-  Root(Control* c) : m_shutdownReceived(false), m_control(c), m_downloadList(NULL) {}
+  typedef display::WindowStatusbar WStatusbar;
+
+  Root();
 
-  void            init();
-  void            cleanup();
+  void                init(Control* c);
+  void                cleanup();
 
-  bool            get_shutdown_received()       { return m_shutdownReceived; }
-  void            set_shutdown_received(bool v) { m_shutdownReceived = v; }
+  WStatusbar*         window_statusbar()            { return m_windowStatusbar; }
 
 private:
-  void            setup_keys();
+  void                setup_keys();
+
+  void                receive_read_throttle(int t);
+  void                receive_write_throttle(int t);
 
-  bool            m_shutdownReceived;
+  Control*            m_control;
+  DownloadList*       m_downloadList;
 
-  Control*        m_control;
-  DownloadList*   m_downloadList;
+  WStatusbar*         m_windowStatusbar;
 
-  input::Bindings m_bindings;
+  input::Bindings     m_bindings;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/directory.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/directory.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/directory.cc	2005-06-26 09:21:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/directory.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/directory.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/directory.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/directory.h	2005-06-26 09:21:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/directory.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_DIRECTORY_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/file_stat.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/file_stat.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/file_stat.cc	2005-04-10 02:59:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/file_stat.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/file_stat.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/file_stat.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/file_stat.h	2005-03-30 03:04:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/file_stat.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_FILE_STAT_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/list_focus.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/list_focus.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/list_focus.h	2005-03-18 23:41:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/list_focus.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_LIST_FOCUS_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/parse.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/parse.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/parse.cc	2005-03-17 04:35:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/parse.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/parse.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/parse.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/parse.h	2005-03-17 04:35:53.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/parse.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_PARSE_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task.h	2005-06-24 02:27:37.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_TASK_H
@@ -25,10 +39,11 @@
 
 #include "task_scheduler.h"
 
 namespace utils {
   
 extern TaskScheduler taskScheduler;
+extern TaskScheduler displayScheduler;
   
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_item.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_item.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_item.h	2005-06-24 02:30:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_item.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_TASK_ITEM_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_scheduler.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_scheduler.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_scheduler.cc	2005-06-24 02:29:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_scheduler.cc	2005-07-02 04:45:24.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_scheduler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_scheduler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/task_scheduler.h	2005-06-24 02:28:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/task_scheduler.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_TASK_SCHEDULER_H
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/timer.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/timer.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.6/src/utils/timer.h	2005-06-21 04:17:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.2.7/src/utils/timer.h	2005-07-02 04:45:10.000000000 +0800
@@ -12,12 +12,26 @@
 // GNU General Public License for more details.
 // 
 // You should have received a copy of the GNU General Public License
 // along with this program; if not, write to the Free Software
 // Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 //
+// In addition, as a special exception, the copyright holders give
+// permission to link the code of portions of this program with the
+// OpenSSL library under certain conditions as described in each
+// individual source file, and distribute linked combinations
+// including the two.
+//
+// You must obey the GNU General Public License in all respects for
+// all of the code used other than OpenSSL.  If you modify file(s)
+// with this exception, you may extend this exception to your version
+// of the file(s), but you are not obligated to do so.  If you do not
+// wish to do so, delete this exception statement from your version.
+// If you delete this exception statement from all source files in the
+// program, then also delete it here.
+//
 // Contact:  Jari Sundell <jaris@ifi.uio.no>
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_TIMER_H
