diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/configure	2005-02-16 07:33:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/configure	2005-02-20 01:11:59.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.57 for rtorrent 0.0.2.
+# Generated by GNU Autoconf 2.57 for rtorrent 0.0.3.
 #
 # Report bugs to <jaris@ifi.uio.no>.
 #
 # Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -265,14 +265,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='rtorrent'
 PACKAGE_TARNAME='rtorrent'
-PACKAGE_VERSION='0.0.2'
-PACKAGE_STRING='rtorrent 0.0.2'
+PACKAGE_VERSION='0.0.3'
+PACKAGE_STRING='rtorrent 0.0.3'
 PACKAGE_BUGREPORT='jaris@ifi.uio.no'
 
 ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO AMTAR install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM AWK SET_MAKE CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CXXDEPMODE RANLIB ac_ct_RANLIB CC CFLAGS ac_ct_CC CCDEPMODE PKG_CONFIG STUFF_CFLAGS STUFF_LIBS LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -742,13 +742,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures rtorrent 0.0.2 to adapt to many kinds of systems.
+\`configure' configures rtorrent 0.0.3 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -804,13 +804,13 @@
   --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of rtorrent 0.0.2:";;
+     short | recursive ) echo "Configuration of rtorrent 0.0.3:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -893,13 +893,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-rtorrent configure 0.0.2
+rtorrent configure 0.0.3
 generated by GNU Autoconf 2.57
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -908,13 +908,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by rtorrent $as_me 0.0.2, which was
+It was created by rtorrent $as_me 0.0.3, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1499,13 +1499,13 @@
 echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 # Define the identity of the package.
  PACKAGE=rtorrent
- VERSION=0.0.2
+ VERSION=0.0.3
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -3823,13 +3823,13 @@
 
 cat >>confdefs.h <<\_ACEOF
 #define HAVE_CONFIG_H 1
 _ACEOF
 
 
-                                                            ac_config_files="$ac_config_files Makefile src/Makefile src/core/Makefile src/display/Makefile src/input/Makefile src/ui/Makefile"
+                                                                      ac_config_files="$ac_config_files Makefile src/Makefile src/core/Makefile src/display/Makefile src/input/Makefile src/ui/Makefile src/utils/Makefile"
 cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
 # scripts and configure runs, see configure's option --config-cache.
 # It is not useful on other systems.  If it contains results you don't
 # want to keep, you may remove or edit it.
@@ -4191,13 +4191,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by rtorrent $as_me 0.0.2, which was
+This file was extended by rtorrent $as_me 0.0.3, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -4254,13 +4254,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-rtorrent config.status 0.0.2
+rtorrent config.status 0.0.3
 configured by $0, generated by GNU Autoconf 2.57,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
@@ -4371,12 +4371,13 @@
   "Makefile" ) CONFIG_FILES="$CONFIG_FILES Makefile" ;;
   "src/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/Makefile" ;;
   "src/core/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/core/Makefile" ;;
   "src/display/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/display/Makefile" ;;
   "src/input/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/input/Makefile" ;;
   "src/ui/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/ui/Makefile" ;;
+  "src/utils/Makefile" ) CONFIG_FILES="$CONFIG_FILES src/utils/Makefile" ;;
   "depfiles" ) CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
   "config.h" ) CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
   *) { { echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
 echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
    { (exit 1); exit 1; }; };;
   esac
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/configure.ac	2005-02-16 07:12:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/configure.ac	2005-02-20 01:11:42.000000000 +0800
@@ -1,7 +1,7 @@
-AC_INIT(rtorrent, 0.0.2, jaris@ifi.uio.no)
+AC_INIT(rtorrent, 0.0.3, jaris@ifi.uio.no)
 
 AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 
 sinclude(scripts/checks.m4)
 
@@ -49,7 +49,8 @@
 	Makefile
 	src/Makefile
 	src/core/Makefile
 	src/display/Makefile
 	src/input/Makefile
 	src/ui/Makefile
+	src/utils/Makefile
 ])
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/README	2005-02-16 05:47:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/README	2005-02-21 01:22:45.000000000 +0800
@@ -1,6 +1,13 @@
+Options and flags:
+
+  -p <a-b>    Open a port in the range a to b.
+
+  -s <dir>    Use <dir> as the session directory. The torrents will be
+              saved with the info-hash in hex as the filename.
+
 All:
 
   Ctrl-Q  - Quit
 
   A       - Increase Throttle by 1 KiB
   Z       - Decrease Throttle by 1 KiB
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_get.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_get.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_get.cc	2005-02-11 03:35:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_get.cc	2005-02-18 05:13:22.000000000 +0800
@@ -55,12 +55,29 @@
 
   curl_easy_cleanup(m_handle);
 
   m_handle = NULL;
 }
 
+
+double
+CurlGet::get_size_done() {
+  double d = 0.0;
+  curl_easy_getinfo(m_handle, CURLINFO_SIZE_DOWNLOAD, &d);
+
+  return d;
+}
+
+double
+CurlGet::get_size_total() {
+  double d = 0.0;
+  curl_easy_getinfo(m_handle, CURLINFO_CONTENT_LENGTH_DOWNLOAD, &d);
+
+  return d;
+}
+
 void
 CurlGet::perform(CURLMsg* msg) {
   if (msg->msg != CURLMSG_DONE)
     throw torrent::client_error("CurlGet::process got CURLMSG that isn't done");
 
   if (msg->data.result == CURLE_OK)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_get.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_get.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_get.h	2005-02-10 05:35:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_get.h	2005-02-18 05:11:20.000000000 +0800
@@ -22,12 +22,15 @@
 
   void               start();
   void               close();
 
   bool               is_busy() { return m_handle; }
 
+  double             get_size_done();
+  double             get_size_total();
+
  protected:
   CURL*              handle() { return m_handle; }
 
   void               perform(CURLMsg* msg);
 
  private:
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_stack.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_stack.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/curl_stack.cc	2005-02-16 07:44:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/curl_stack.cc	2005-02-20 01:19:04.000000000 +0800
@@ -1,13 +1,13 @@
 #include "config.h"
 
 #include <algorithm>
 #include <curl/multi.h>
 #include <torrent/exceptions.h>
 
-#include "functional.h"
+#include "utils/functional.h"
 #include "curl_get.h"
 #include "curl_stack.h"
 
 namespace core {
 
 CurlStack::CurlStack() :
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download.h	2005-02-16 23:15:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download.h	2005-02-20 06:17:42.000000000 +0800
@@ -13,18 +13,18 @@
 
   torrent::Download& get_download()                  { return m_download; }
   std::string        get_hash()                      { return m_download.get_hash(); }
   
   const std::string& get_tracker_msg()               { return m_trackerMsg; }
 
-  void               open()                          { m_download.open(); }
-  void               close()                         { m_download.close(); }
-
   void               start()                         { m_download.start(); }
   void               stop()                          { m_download.stop(); }
 
+  void               open()                          { m_download.open(); }
+  void               close()                         { m_download.close(); }
+
   bool operator == (const std::string& str)          { return str == m_download.get_hash(); }
 
 private:
   void               receive_tracker_msg(std::string msg);
 
   torrent::Download  m_download;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download_list.cc	2005-02-16 23:17:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download_list.cc	2005-02-20 23:36:31.000000000 +0800
@@ -1,31 +1,40 @@
 #include "config.h"
 
 #include <algorithm>
-#include <stdexcept>
-#include <sigc++/bind.h>
-#include <torrent/exceptions.h>
 #include <torrent/torrent.h>
 
+#include "utils/functional.h"
+
+#include "download.h"
 #include "download_list.h"
 
 namespace core {
 
 DownloadList::iterator
 DownloadList::insert(std::istream* str) {
   torrent::Download d = torrent::download_create(str);
 
-  iterator itr = Base::insert(end(), Download());
-  itr->set_download(d);
+  iterator itr = Base::insert(end(), new Download);
+  (*itr)->set_download(d);
 
   return itr;
 }
 
-void
+DownloadList::iterator
 DownloadList::erase(iterator itr) {
-  itr->release_download();
+  (*itr)->release_download();
+
+  torrent::download_remove((*itr)->get_hash());
+  delete *itr;
+
+  return Base::erase(itr);
+}
+
+void
+DownloadList::clear() {
+  std::for_each(begin(), end(), func::call_delete());
 
-  torrent::download_remove(itr->get_hash());
-  Base::erase(itr);
+  Base::clear();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/download_list.h	2005-02-16 23:11:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/download_list.h	2005-02-20 23:36:18.000000000 +0800
@@ -1,18 +1,19 @@
 #ifndef RTORRENT_CORE_DOWNLOAD_LIST_H
 #define RTORRENT_CORE_DOWNLOAD_LIST_H
 
 #include <iosfwd>
-
-#include "download.h"
+#include <list>
 
 namespace core {
 
-class DownloadList : private std::list<Download> {
+class Download;
+
+class DownloadList : private std::list<Download*> {
 public:
-  typedef std::list<Download> Base;
+  typedef std::list<Download*> Base;
 
   using Base::iterator;
   using Base::const_iterator;
   using Base::reverse_iterator;
   using Base::const_reverse_iterator;
 
@@ -21,13 +22,18 @@
   using Base::rbegin;
   using Base::rend;
 
   using Base::empty;
   using Base::size;
 
+  ~DownloadList() { clear(); }
+
   iterator  insert(std::istream* str);
-  void      erase(iterator itr);
+  iterator  erase(iterator itr);
+
+private:
+  void      clear();
 };
 
 }
 
 #endif
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core: download_store.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core: download_store.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/hash_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/hash_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/hash_queue.cc	2005-02-16 05:13:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/hash_queue.cc	2005-02-20 01:19:04.000000000 +0800
@@ -2,13 +2,13 @@
 
 #include <algorithm>
 #include <stdexcept>
 #include <sigc++/bind.h>
 
 #include "download.h"
-#include "functional.h"
+#include "utils/functional.h"
 #include "hash_queue.h"
 
 namespace core {
 
 void
 HashQueue::insert(Download* d, Slot s) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/http_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/http_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/http_queue.cc	2005-02-11 03:42:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/http_queue.cc	2005-02-20 01:19:04.000000000 +0800
@@ -3,21 +3,21 @@
 #include <memory>
 #include <sstream>
 #include <sigc++/bind.h>
 #include <sigc++/hide.h>
 #include <torrent/http.h>
 
-#include "functional.h"
+#include "utils/functional.h"
 #include "http_queue.h"
 #include "curl_get.h"
 
 namespace core {
 
 HttpQueue::iterator
 HttpQueue::insert(const std::string& url) {
-  std::auto_ptr<torrent::Http> h(m_slotFactory());
+  std::auto_ptr<CurlGet> h(m_slotFactory());
   std::auto_ptr<std::stringstream> s(new std::stringstream);
   
   h->set_url(url);
   h->set_stream(s.get());
   h->set_user_agent("rtorrent/" VERSION);
 
@@ -28,26 +28,30 @@
 
   (*itr)->start();
 
   h.release();
   s.release();
 
+  m_signalInsert.emit(*itr);
+
   return itr;
 }
 
 void
 HttpQueue::erase(iterator itr) {
+  m_signalErase.emit(*itr);
+
   delete (*itr)->get_stream();
   delete *itr;
 
   Base::erase(itr);
 }
 
 void
 HttpQueue::clear() {
-  std::for_each(begin(), end(), func::on(func::call_delete(), std::mem_fun(&CurlGet::get_stream)));
-  std::for_each(begin(), end(), func::call_delete());
+  while (!empty())
+    erase(begin());
 
   Base::clear();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/http_queue.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/http_queue.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/http_queue.h	2005-02-11 03:01:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/http_queue.h	2005-02-18 04:23:45.000000000 +0800
@@ -1,23 +1,22 @@
 #ifndef RTORRENT_CORE_HTTP_QUEUE_H
 #define RTORRENT_CORE_HTTP_QUEUE_H
 
 #include <list>
 #include <iosfwd>
-#include <sigc++/slot.h>
-
-namespace torrent {
-  class Http;
-}
+#include <sigc++/signal.h>
 
 namespace core {
 
-class HttpQueue : private std::list<torrent::Http*> {
+class CurlGet;
+
+class HttpQueue : private std::list<CurlGet*> {
 public:
-  typedef std::list<torrent::Http*>   Base;
-  typedef sigc::slot0<torrent::Http*> SlotFactory;
+  typedef std::list<CurlGet*>           Base;
+  typedef sigc::signal1<void, CurlGet*> SignalHttp;
+  typedef sigc::slot0<CurlGet*>         SlotFactory;
 
   using Base::iterator;
   using Base::const_iterator;
   using Base::reverse_iterator;
   using Base::const_reverse_iterator;
 
@@ -26,22 +25,27 @@
   using Base::rbegin;
   using Base::rend;
 
   using Base::empty;
   using Base::size;
 
-  // Note that any slots connected to the torrent::Http signals must be
+  // Note that any slots connected to the CurlGet signals must be
   // pushed in front of the erase slot added by HttpQueue::insert.
   iterator    insert(const std::string& url);
   void        erase(iterator itr);
 
   void        clear();
 
   void        slot_factory(SlotFactory s) { m_slotFactory = s; }
 
+  SignalHttp& signal_insert()             { return m_signalInsert; }
+  SignalHttp& signal_erase()              { return m_signalErase; }
+
 private:
   SlotFactory m_slotFactory;
+  SignalHttp  m_signalInsert;
+  SignalHttp  m_signalErase;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/Makefile.am	2005-02-15 22:31:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/Makefile.am	2005-02-20 05:49:27.000000000 +0800
@@ -10,12 +10,14 @@
 	http_queue.cc \
 	http_queue.h \
 	download.cc \
 	download.h \
 	download_list.cc \
 	download_list.h \
+	download_store.cc \
+	download_store.h \
 	manager.cc \
 	manager.h \
 	poll.cc \
 	poll.h
 
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/Makefile.in	2005-02-16 07:33:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/Makefile.in	2005-02-20 05:56:15.000000000 +0800
@@ -88,12 +88,14 @@
 	http_queue.cc \
 	http_queue.h \
 	download.cc \
 	download.h \
 	download_list.cc \
 	download_list.h \
+	download_store.cc \
+	download_store.h \
 	manager.cc \
 	manager.h \
 	poll.cc \
 	poll.h
 
 
@@ -105,25 +107,27 @@
 LIBRARIES = $(noinst_LIBRARIES)
 
 libsub_core_a_AR = $(AR) cru
 libsub_core_a_LIBADD =
 am_libsub_core_a_OBJECTS = curl_get.$(OBJEXT) curl_stack.$(OBJEXT) \
 	hash_queue.$(OBJEXT) http_queue.$(OBJEXT) download.$(OBJEXT) \
-	download_list.$(OBJEXT) manager.$(OBJEXT) poll.$(OBJEXT)
+	download_list.$(OBJEXT) download_store.$(OBJEXT) \
+	manager.$(OBJEXT) poll.$(OBJEXT)
 libsub_core_a_OBJECTS = $(am_libsub_core_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/curl_get.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/curl_stack.Po ./$(DEPDIR)/download.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/download_list.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/download_store.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/hash_queue.Po ./$(DEPDIR)/http_queue.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/manager.Po ./$(DEPDIR)/poll.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
 CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
@@ -164,12 +168,13 @@
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_get.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/curl_stack.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download_list.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download_store.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/hash_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/manager.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poll.Po@am__quote@
 
 distclean-depend:
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/manager.cc	2005-02-16 23:23:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/manager.cc	2005-02-21 00:15:10.000000000 +0800
@@ -3,53 +3,56 @@
 #include <stdexcept>
 #include <cstring>
 #include <fstream>
 #include <istream>
 #include <sigc++/bind.h>
 #include <torrent/exceptions.h>
-#include <torrent/http.h>
 #include <torrent/torrent.h>
 
+#include "download.h"
 #include "manager.h"
+#include "curl_get.h"
 
 namespace core {
 
 void
 Manager::initialize() {
   torrent::Http::set_factory(m_poll.get_http_factory());
   m_httpQueue.slot_factory(m_poll.get_http_factory());
 
   CurlStack::init();
 
   torrent::initialize();
-  torrent::listen_open(10000, 20000);
+  torrent::listen_open(m_portFirst, m_portLast);
 }
 
 void
 Manager::cleanup() {
   torrent::cleanup();
   core::CurlStack::cleanup();
 }
 
 void
-Manager::insert(const std::string& uri) {
+Manager::insert(std::string uri) {
   if (std::strncmp(uri.c_str(), "http://", 7))
     create_file(uri);
   else
     create_http(uri);
 }
 
-void
+Manager::iterator
 Manager::erase(DownloadList::iterator itr) {
-  if (itr->get_download().is_active())
+  if ((*itr)->get_download().is_active())
     throw std::logic_error("core::Manager::erase(...) called on an active download");
 
-  if (itr->get_download().is_open())
-    itr->close();
+  if (!(*itr)->get_download().is_open())
+    throw std::logic_error("core::Manager::erase(...) called on an closed download");
+
+  m_downloadStore.remove(*itr);
 
-  m_downloadList.erase(itr);
+  return m_downloadList.erase(itr);
 }  
 
 void
 Manager::start(Download* d) {
   if (d->get_download().is_active())
     return;
@@ -57,32 +60,36 @@
   if (!d->get_download().is_open())
     d->open();
 
   if (d->get_download().is_hash_checked())
     d->start();
   else
-    m_hashQueue.insert(d, sigc::mem_fun(*d, &Download::start));
+    m_hashQueue.insert(d, sigc::mem_fun(d, &Download::start));
 }
 
 void
 Manager::stop(Download* d) {
   m_hashQueue.remove(d);
 
   d->stop();
+
+  d->get_download().hash_save();
+  m_downloadStore.save(d);
 }
 
 void
 Manager::create_file(const std::string& uri) {
   DownloadList::iterator itr = m_downloadList.end();
 
   try {
     std::fstream f(uri.c_str(), std::ios::in);
     
     itr = m_downloadList.insert(&f);
 
-    start(&*itr);
+    start(*itr);
+    m_downloadStore.save(*itr);
 
   } catch (torrent::local_error& e) {
     // What to do? Keep in list for now.
   }
 }
 
@@ -92,19 +99,20 @@
 
   (*itr)->signal_done().slots().push_front(sigc::bind(sigc::mem_fun(*this, &core::Manager::receive_http_done), *itr));
   // Add the failed signal here.
 }
 
 void
-Manager::receive_http_done(torrent::Http* http) {
+Manager::receive_http_done(CurlGet* http) {
   DownloadList::iterator itr = m_downloadList.end();
 
   try {
     itr = m_downloadList.insert(http->get_stream());
 
-    start(&*itr);
+    start(*itr);
+    m_downloadStore.save(*itr);
 
   } catch (torrent::local_error& e) {
     // What to do? Keep in list for now.
   }
 }  
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/manager.h	2005-02-16 23:12:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/manager.h	2005-02-21 00:15:00.000000000 +0800
@@ -1,45 +1,56 @@
 #ifndef RTORRENT_CORE_MANAGER_H
 #define RTORRENT_CORE_MANAGER_H
 
 #include "download_list.h"
+#include "download_store.h"
 #include "hash_queue.h"
 #include "http_queue.h"
 #include "poll.h"
 
 namespace core {
 
 class Manager {
 public:
+  typedef DownloadList::iterator                    iterator;
   typedef sigc::slot1<void, DownloadList::iterator> SlotReady;
   typedef sigc::slot0<void>                         SlotFailed;
 
-  DownloadList& get_download_list() { return m_downloadList; }
-  HashQueue&    get_hash_queue()    { return m_hashQueue; }
-  HttpQueue&    get_http_queue()    { return m_httpQueue; }
+  Manager() : m_portFirst(6890), m_portLast(6999) {}
 
-  Poll&         get_poll()          { return m_poll; }
+  DownloadList&   get_download_list()                 { return m_downloadList; }
+  DownloadStore&  get_download_store()                { return m_downloadStore; }
+  HashQueue&      get_hash_queue()                    { return m_hashQueue; }
+  HttpQueue&      get_http_queue()                    { return m_httpQueue; }
 
-  void          initialize();
-  void          cleanup();
+  Poll&           get_poll()                          { return m_poll; }
 
-  void          insert(const std::string& uri);
-  void          erase(DownloadList::iterator itr);
+  void            initialize();
+  void            cleanup();
 
-  void          start(Download* d);
-  void          stop(Download* d);
+  void            insert(std::string uri);
+  iterator        erase(DownloadList::iterator itr);
+
+  void            start(Download* d);
+  void            stop(Download* d);
+
+  void            set_port_range(int a, int b)        { m_portFirst = a; m_portLast = b; }
 
 private:
-  void          receive_http_done(torrent::Http* http);
+  void            receive_http_done(CurlGet* http);
+
+  void            create_file(const std::string& uri);
+  void            create_http(const std::string& uri);
 
-  void          create_file(const std::string& uri);
-  void          create_http(const std::string& uri);
+  DownloadList    m_downloadList;
+  DownloadStore   m_downloadStore;
+  HashQueue       m_hashQueue;
+  HttpQueue       m_httpQueue;
+  Poll            m_poll;
 
-  DownloadList  m_downloadList;
-  HashQueue     m_hashQueue;
-  HttpQueue     m_httpQueue;
-  Poll          m_poll;
+  int             m_portFirst;
+  int             m_portLast;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/poll.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/poll.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/core/poll.h	2005-02-16 07:32:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/core/poll.h	2005-02-18 04:26:08.000000000 +0800
@@ -3,23 +3,21 @@
 
 #include <sys/select.h>
 #include <sigc++/slot.h>
 
 #include "curl_stack.h"
 
-namespace torrent {
-  class Http;
-}
-
 namespace core {
 
+class CurlGet;
+
 class Poll {
 public:
-  typedef sigc::slot0<void>           Slot;
-  typedef sigc::slot1<void, int>      SlotInt;
-  typedef sigc::slot0<torrent::Http*> SlotFactory;
+  typedef sigc::slot0<void>      Slot;
+  typedef sigc::slot1<void, int> SlotInt;
+  typedef sigc::slot0<CurlGet*>  SlotFactory;
 
   Poll() : m_readSet(new fd_set), m_writeSet(new fd_set), m_exceptSet(new fd_set) {}
   ~Poll() { delete m_readSet; delete m_writeSet; delete m_exceptSet; }
 
   void        poll();
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/Makefile.am	2005-02-16 05:54:46.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/Makefile.am	2005-02-17 07:09:40.000000000 +0800
@@ -10,12 +10,14 @@
 	window.cc \
 	window.h \
 	window_download_statusbar.cc \
 	window_download_statusbar.h \
 	window_download_list.cc \
 	window_download_list.h \
+	window_http_queue.cc \
+	window_http_queue.h \
 	window_input.cc \
 	window_input.h \
 	window_peer_info.cc \
 	window_peer_info.h \
 	window_peer_list.cc \
 	window_peer_list.h \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/Makefile.in	2005-02-16 07:34:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/Makefile.in	2005-02-20 01:11:58.000000000 +0800
@@ -88,12 +88,14 @@
 	window.cc \
 	window.h \
 	window_download_statusbar.cc \
 	window_download_statusbar.h \
 	window_download_list.cc \
 	window_download_list.h \
+	window_http_queue.cc \
+	window_http_queue.h \
 	window_input.cc \
 	window_input.h \
 	window_peer_info.cc \
 	window_peer_info.h \
 	window_peer_list.cc \
 	window_peer_list.h \
@@ -112,15 +114,16 @@
 
 libsub_display_a_AR = $(AR) cru
 libsub_display_a_LIBADD =
 am_libsub_display_a_OBJECTS = canvas.$(OBJEXT) manager.$(OBJEXT) \
 	utils.$(OBJEXT) window.$(OBJEXT) \
 	window_download_statusbar.$(OBJEXT) \
-	window_download_list.$(OBJEXT) window_input.$(OBJEXT) \
-	window_peer_info.$(OBJEXT) window_peer_list.$(OBJEXT) \
-	window_statusbar.$(OBJEXT) window_title.$(OBJEXT)
+	window_download_list.$(OBJEXT) window_http_queue.$(OBJEXT) \
+	window_input.$(OBJEXT) window_peer_info.$(OBJEXT) \
+	window_peer_list.$(OBJEXT) window_statusbar.$(OBJEXT) \
+	window_title.$(OBJEXT)
 libsub_display_a_OBJECTS = $(am_libsub_display_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -128,12 +131,13 @@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/canvas.Po ./$(DEPDIR)/manager.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/utils.Po ./$(DEPDIR)/window.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_download_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_download_statusbar.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/window_http_queue.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_input.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_peer_info.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_peer_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_statusbar.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_title.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
@@ -179,12 +183,13 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/canvas.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/manager.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_download_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_download_statusbar.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_http_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_input.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_peer_info.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_peer_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_statusbar.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_title.Po@am__quote@
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/manager.cc	2005-02-17 04:27:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/manager.cc	2005-02-20 01:19:04.000000000 +0800
@@ -1,12 +1,12 @@
 #include "config.h"
 
 #include <stdexcept>
 #include <algorithm>
 
-#include "functional.h"
+#include "utils/functional.h"
 
 #include "canvas.h"
 #include "manager.h"
 #include "window.h"
 
 namespace display {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_download_list.cc	2005-02-16 05:54:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_download_list.cc	2005-02-20 06:31:01.000000000 +0800
@@ -1,8 +1,10 @@
 #include "config.h"
 
+#include "core/download.h"
+
 #include "canvas.h"
 #include "utils.h"
 #include "window_download_list.h"
 
 namespace display {
 
@@ -11,16 +13,16 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowDownloadList::redraw() {
-  if (Timer::cache() - m_lastDraw < 1000000)
+  if (utils::Timer::cache() - m_lastDraw < 1000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
 
   m_canvas->erase();
 
   if (m_list->empty())
     return;
 
@@ -49,32 +51,32 @@
     last = m_list->end();
   }    
 
   while (itr != m_list->end() && y < m_canvas->get_height()) {
     m_canvas->print(0, pos++, "%c %s",
 		    itr == *m_focus ? '*' : ' ',
-		    itr->get_download().get_name().c_str());
+		    (*itr)->get_download().get_name().c_str());
 
-    if (itr->get_download().get_chunks_done() != itr->get_download().get_chunks_total() || !itr->get_download().is_open())
+    if ((*itr)->get_download().get_chunks_done() != (*itr)->get_download().get_chunks_total() || !(*itr)->get_download().is_open())
       m_canvas->print(0, pos++, "%c Torrent: %.1f / %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
 		      itr == *m_focus ? '*' : ' ',
-		      (double)itr->get_download().get_bytes_done() / (double)(1 << 20),
-		      (double)itr->get_download().get_bytes_total() / (double)(1 << 20),
-		      (double)itr->get_download().get_rate_up() / 1024.0,
-		      (double)itr->get_download().get_rate_down() / 1024.0,
-		      (double)itr->get_download().get_bytes_up() / (double)(1 << 20));
+		      (double)(*itr)->get_download().get_bytes_done() / (double)(1 << 20),
+		      (double)(*itr)->get_download().get_bytes_total() / (double)(1 << 20),
+		      (double)(*itr)->get_download().get_rate_up() / 1024.0,
+		      (double)(*itr)->get_download().get_rate_down() / 1024.0,
+		      (double)(*itr)->get_download().get_bytes_up() / (double)(1 << 20));
  
     else
       m_canvas->print(0, pos++, "%c Torrent: Done %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
 		      itr == *m_focus ? '*' : ' ',
-		      (double)itr->get_download().get_bytes_total() / (double)(1 << 20),
-		      (double)itr->get_download().get_rate_up() / 1024.0,
-		      (double)itr->get_download().get_rate_down() / 1024.0,
-		      (double)itr->get_download().get_bytes_up() / (double)(1 << 20));
+		      (double)(*itr)->get_download().get_bytes_total() / (double)(1 << 20),
+		      (double)(*itr)->get_download().get_rate_up() / 1024.0,
+		      (double)(*itr)->get_download().get_rate_down() / 1024.0,
+		      (double)(*itr)->get_download().get_bytes_up() / (double)(1 << 20));
     
-    m_canvas->print(0, pos++, "%c %s", itr == *m_focus ? '*' : ' ', print_download_status(&*itr).c_str());
+    m_canvas->print(0, pos++, "%c %s", itr == *m_focus ? '*' : ' ', print_download_status(*itr).c_str());
 
     ++itr;
   }    
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_download_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_download_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_download_statusbar.cc	2005-02-16 05:56:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_download_statusbar.cc	2005-02-20 01:22:32.000000000 +0800
@@ -12,16 +12,16 @@
   Window(new Canvas, false, 3),
   m_download(d) {
 }
 
 void
 WindowDownloadStatusbar::redraw() {
-  if (Timer::cache() - m_lastDraw < 1000000)
+  if (utils::Timer::cache() - m_lastDraw < 1000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
 
   m_canvas->erase();
 
   if (m_download->get_download().get_chunks_done() != m_download->get_download().get_chunks_total() || !m_download->get_download().is_open())
     m_canvas->print(0, 0, "Torrent: %.1f / %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
 		    (double)m_download->get_download().get_bytes_done() / (double)(1 << 20),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window.h	2005-02-17 04:16:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window.h	2005-02-20 01:22:32.000000000 +0800
@@ -1,10 +1,10 @@
 #ifndef RTORRENT_WINDOW_BASE_H
 #define RTORRENT_WINDOW_BASE_H
 
-#include "timer.h"
+#include "utils/timer.h"
 
 namespace display {
 
 class Canvas;
 
 class Window {
@@ -37,13 +37,13 @@
   Canvas*      m_canvas;
 
   bool         m_active;
   bool         m_dynamic;
   int          m_minHeight;
 
-  Timer        m_lastDraw;
+  utils::Timer        m_lastDraw;
 };
 
 }
 
 #endif
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display: window_http_queue.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display: window_http_queue.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_input.cc	2005-02-14 05:42:34.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_input.cc	2005-02-20 01:22:32.000000000 +0800
@@ -15,13 +15,13 @@
 
 void
 WindowInput::redraw() {
   if (!is_dirty())
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
   m_canvas->erase();
 
   m_canvas->print(0, 0, "> %s", m_input->c_str());
 
   if (m_focus)
     m_canvas->set_attr(m_input->get_pos() + 2, 0, 1, A_REVERSE, COLOR_PAIR(0));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_peer_info.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_peer_info.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_peer_info.cc	2005-02-13 23:12:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_peer_info.cc	2005-02-20 23:22:44.000000000 +0800
@@ -1,13 +1,13 @@
 #include "config.h"
 
 #include <stdexcept>
 
 #include "core/download.h"
 
-#include "parse.h"
+#include "utils/parse.h"
 #include "canvas.h"
 #include "window_peer_info.h"
 
 namespace display {
 
 WindowPeerInfo::WindowPeerInfo(core::Download* d, PList* l, PList::iterator* f) :
@@ -16,21 +16,21 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerInfo::redraw() {
-  if (Timer::cache() - m_lastDraw < 1000000)
+  if (utils::Timer::cache() - m_lastDraw < 1000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
   m_canvas->erase();
 
   int y = 0;
 
-  m_canvas->print(0, y++, "Hash: %s", escape_string(m_download->get_download().get_hash()).c_str());
+  m_canvas->print(0, y++, "Hash: %s", utils::string_to_hex(m_download->get_download().get_hash()).c_str());
   m_canvas->print(0, y++, "Chunks: %u / %u * %u",
 		  m_download->get_download().get_chunks_done(),
 		  m_download->get_download().get_chunks_total(),
 		  m_download->get_download().get_chunks_size());
 
   y++;
@@ -39,13 +39,13 @@
     m_canvas->print(0, y++, "No peer in focus");
 
     return;
   }
 
   m_canvas->print(0, y++, "DNS: %s:%hu", (*m_focus)->get_dns().c_str(), (*m_focus)->get_port());
-  m_canvas->print(0, y++, "Id: %s" , escape_string((*m_focus)->get_id()).c_str());
+  m_canvas->print(0, y++, "Id: %s" , utils::escape_string((*m_focus)->get_id()).c_str());
   m_canvas->print(0, y++, "Snubbed: %s", (*m_focus)->get_snubbed() ? "Yes" : "No");
   m_canvas->print(0, y++, "Done: %i%", (*m_focus)->get_chunks_done());
 
   m_canvas->print(0, y++, "Rate: %5.1f/%5.1f KB Total: %.1f/%.1f MB",
 		  (double)(*m_focus)->get_rate_up() / (double)(1 << 10),
 		  (double)(*m_focus)->get_rate_down() / (double)(1 << 10),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_peer_list.cc	2005-02-16 05:55:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_peer_list.cc	2005-02-20 01:22:32.000000000 +0800
@@ -12,16 +12,16 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerList::redraw() {
-  if (Timer::cache() - m_lastDraw < 1000000)
+  if (utils::Timer::cache() - m_lastDraw < 1000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
   m_canvas->erase();
 
   int x = 2;
   int y = 0;
 
   m_canvas->print(x, y, "DNS");   x += 16;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_statusbar.cc	2005-02-08 05:37:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_statusbar.cc	2005-02-20 01:22:32.000000000 +0800
@@ -13,16 +13,16 @@
 }
 
 void
 WindowStatusbar::redraw() {
   m_counter++;
 
-  if (Timer::cache() - m_lastDraw < 10000000)
+  if (utils::Timer::cache() - m_lastDraw < 10000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
 
   m_canvas->erase();
   m_canvas->print(0, 0, "Throttle: %i Listen: %s:%i Handshakes: %i Select: %u",
 		  (int)torrent::get(torrent::THROTTLE_ROOT_CONST_RATE) / 1024,
 		  "",
 		  (int)torrent::get(torrent::LISTEN_PORT),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_title.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_title.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/display/window_title.cc	2005-02-13 23:54:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/display/window_title.cc	2005-02-20 01:22:32.000000000 +0800
@@ -9,16 +9,16 @@
   Window(new Canvas, false, 1),
   m_title(s) {
 }
 
 void
 WindowTitle::redraw() {
-  if (Timer::cache() - m_lastDraw < 10000000)
+  if (utils::Timer::cache() - m_lastDraw < 10000000)
     return;
 
-  m_lastDraw = Timer::cache();
+  m_lastDraw = utils::Timer::cache();
   m_canvas->erase();
 
   m_canvas->print(std::max(0, (m_canvas->get_width() - (int)m_title.size()) / 2 - 4), 0,
 		  "*** %s ***", m_title.c_str());
 }
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src: functional.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/main.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/main.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/main.cc	2005-02-17 03:39:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/main.cc	2005-02-21 01:51:12.000000000 +0800
@@ -10,25 +10,31 @@
 #include <sigc++/retype_return.h>
 
 #ifdef USE_EXECINFO
 #include <execinfo.h>
 #endif
 
+#include "core/download.h"
 #include "display/canvas.h"
 #include "ui/control.h"
 #include "ui/download_list.h"
 #include "input/bindings.h"
+#include "utils/timer.h"
+#include "utils/directory.h"
 
-#include "timer.h"
 #include "signal_handler.h"
+#include "option_parser.h"
 
-int64_t Timer::m_cache;
+int64_t utils::Timer::m_cache;
 
 bool start_shutdown = false;
 bool is_shutting_down = false;
 
+void do_panic(int signum);
+void print_help();
+
 bool
 is_resized() {
   static int x = 0;
   static int y = 0;
   
   bool r = display::Canvas::get_screen_width() != x || display::Canvas::get_screen_height() != y;
@@ -49,100 +55,179 @@
   if (!is_shutting_down) {
     is_shutting_down = true;
 
     torrent::listen_close();
 
     std::for_each(c->get_core().get_download_list().begin(), c->get_core().get_download_list().end(),
-		  std::mem_fun_ref(&core::Download::stop));
+		  std::bind1st(std::mem_fun(&core::Manager::stop), &c->get_core()));
 
   } else {
     // Close all torrents, this will stop all tracker connections and cause
     // a quick shutdown.
     std::for_each(c->get_core().get_download_list().begin(), c->get_core().get_download_list().end(),
-		  std::mem_fun_ref(&core::Download::close));
+		  std::mem_fun(&core::Download::close));
 
   }
+
+  start_shutdown = false;
 }
 
 void
-do_panic(int signum) {
-  display::Canvas::cleanup();
+test_dir(const std::string& s) {
+  utils::Directory d(s);
 
-  std::cout << "Signal " << (signum == SIGSEGV ? "SIGSEGV" : "SIGBUS") << " recived, dumping stack:" << std::endl;
-  
-#ifdef USE_EXECINFO
-  void* stackPtrs[20];
+  d.update();
 
-  // Print the stack and exit.
-  int stackSize = backtrace(stackPtrs, 20);
-  char** stackStrings = backtrace_symbols(stackPtrs, stackSize);
+  std::cout << "Listing dir \"" << s << '"' << std::endl;
 
-  for (int i = 0; i < stackSize; ++i)
-    std::cout << i << ' ' << stackStrings[i] << std::endl;
+  for (utils::Directory::iterator itr = d.begin(); itr != d.end(); ++itr)
+    std::cout << '"' << *itr << '"' << std::endl;
 
-#else
-  std::cout << "Stack dump not enabled." << std::endl;
-#endif
-  
-  if (signum == SIGBUS)
-    std::cout << "A bus error might mean you ran out of diskspace." << std::endl;
-  
-  exit(-1);
+  exit(0);
 }
 
 int
-main(int argc, char** argv) {
-  ui::Control uiControl;
+parse_options(ui::Control* c, int argc, char** argv) {
+  OptionParser optionParser;
+  optionParser.insert_flag('h', sigc::ptr_fun(&print_help));
+  optionParser.insert_option('p', sigc::bind(sigc::ptr_fun(OptionParser::call_int_pair),
+					     sigc::mem_fun(c->get_core(), &core::Manager::set_port_range)));
+  optionParser.insert_option('s', sigc::mem_fun(c->get_core().get_download_store(), &core::DownloadStore::activate));
 
-  try {
+  return optionParser.process(argc, argv);
+}
+
+void
+load_session_torrents(ui::Control* c) {
+  // Load session torrents.
+  std::list<std::string> l = c->get_core().get_download_store().get_formated_entries().make_list();
+
+  std::for_each(l.begin(), l.end(), std::bind1st(std::mem_fun(&core::Manager::insert), &c->get_core()));
+}
+
+void
+load_arg_torrents(ui::Control* c, char** begin, char** end) {
+  std::for_each(begin, end, std::bind1st(std::mem_fun(&core::Manager::insert), &c->get_core()));
+}
 
+void
+register_signals(ui::Control* c) {
   SignalHandler::set_handler(SIGINT, sigc::ptr_fun(&set_shutdown));
   SignalHandler::set_handler(SIGSEGV, sigc::bind(sigc::ptr_fun(&do_panic), SIGSEGV));
   SignalHandler::set_handler(SIGBUS, sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
+}
+
+void
+register_main_keys(ui::Control* c, input::Bindings* b) {
+  c->get_input().push_back(b);
+
+  (*b)[KEY_RESIZE] = sigc::mem_fun(c->get_display(), &display::Manager::adjust_layout);
+  (*b)['\x11']     = sigc::ptr_fun(&set_shutdown);
+}
+
+int
+main(int argc, char** argv) {
+  ui::Control uiControl;
+  input::Bindings inputMain;
+
+  try {
+
+  register_signals(&uiControl);
+
+  int firstArg = parse_options(&uiControl, argc, argv);
 
   display::Canvas::init();
 
   ui::DownloadList uiDownloadList(&uiControl);
 
   uiDownloadList.activate();
   uiDownloadList.slot_open_uri(sigc::mem_fun(uiControl.get_core(), &core::Manager::insert));
 
-  // Register main key events.
-  input::Bindings inputMain;
-  uiControl.get_input().push_back(&inputMain);
-
-  inputMain[KEY_RESIZE] = sigc::mem_fun(uiControl.get_display(), &display::Manager::adjust_layout);
-  inputMain['\x11'] = sigc::ptr_fun(&set_shutdown);
+  register_main_keys(&uiControl, &inputMain);
 
   uiControl.get_core().get_poll().slot_read_stdin(sigc::mem_fun(uiControl.get_input(), &input::Manager::pressed));
   uiControl.get_core().get_poll().slot_select_interrupted(sigc::ptr_fun(display::Canvas::do_update));
 
   uiControl.get_core().initialize();
 
-  for (int i = 1; i < argc; ++i)
-    uiControl.get_core().insert(argv[i]);
+  load_session_torrents(&uiControl);
+  load_arg_torrents(&uiControl, argv + firstArg, argv + argc);
 
   uiControl.get_display().adjust_layout();
 
   while (!is_shutting_down || !torrent::get(torrent::SHUTDOWN_DONE)) {
-    if (start_shutdown && !is_shutting_down)
+    if (start_shutdown)
       do_shutdown(&uiControl);
 
-    Timer::update();
+    utils::Timer::update();
 
     uiControl.get_display().do_update();
 
     uiControl.get_core().get_poll().poll();
   }
 
   display::Canvas::cleanup();
 
   } catch (std::exception& e) {
     display::Canvas::cleanup();
 
     std::cout << "Caught exception: \"" << e.what() << '"' << std::endl;
+    return -1;
   }
 
   uiControl.get_core().cleanup();
 
   return 0;
 }
+
+void
+do_panic(int signum) {
+  display::Canvas::cleanup();
+
+  std::cout << "Signal " << (signum == SIGSEGV ? "SIGSEGV" : "SIGBUS") << " recived, dumping stack:" << std::endl;
+  
+#ifdef USE_EXECINFO
+  void* stackPtrs[20];
+
+  // Print the stack and exit.
+  int stackSize = backtrace(stackPtrs, 20);
+  char** stackStrings = backtrace_symbols(stackPtrs, stackSize);
+
+  for (int i = 0; i < stackSize; ++i)
+    std::cout << i << ' ' << stackStrings[i] << std::endl;
+
+#else
+  std::cout << "Stack dump not enabled." << std::endl;
+#endif
+  
+  if (signum == SIGBUS)
+    std::cout << "A bus error might mean you ran out of diskspace." << std::endl;
+  
+  exit(-1);
+}
+
+void
+print_help() {
+  std::cout << "Rakshasa's Torrent client. <Neko-Mimi Mode-o!>" << std::endl;
+  std::cout << std::endl;
+  std::cout << "Usage: rtorrent [OPTIONS]... [FILE]... [URL]..." << std::endl;
+  std::cout << "  -h                Display this very helpful text" << std::endl;
+  std::cout << "  -p <int>-<int>    Set port range for incoming connections" << std::endl;
+  std::cout << "  -s <directory>    Set the session directory" << std::endl;
+  std::cout << std::endl;
+  std::cout << "Main view keys:" << std::endl;
+  std::cout << "  backspace         Add a torrent url or path" << std::endl;
+  std::cout << "  ^s                Start torrent" << std::endl;
+  std::cout << "  ^d                Stop torrent or delete a stopped torrent" << std::endl;
+  std::cout << "  ^q                Initiate shutdown or skip shutdown process" << std::endl;
+  std::cout << "  a,s,d,z,x,c       Adjust throttle" << std::endl;
+  std::cout << std::endl;
+  std::cout << "Download view keys:" << std::endl;
+  std::cout << "  1,2               Adjust max uploads" << std::endl;
+  std::cout << "  3,4,5,6           Adjust min/max connected peers" << std::endl;
+  std::cout << "  t                 Query tracker for more peers" << std::endl;
+  std::cout << std::endl;
+
+  std::cout << "Report bugs to <jaris@ifi.uio.no>." << std::endl;
+
+  exit(0);
+}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/Makefile.am	2005-02-15 03:24:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/Makefile.am	2005-02-20 01:26:46.000000000 +0800
@@ -1,22 +1,22 @@
 SUBDIRS = \
 	core \
 	display \
 	input \
-	ui
+	ui \
+	utils
 
 bin_PROGRAMS = rtorrent
 
 rtorrent_LDADD = \
 	$(top_srcdir)/src/ui/libsub_ui.a \
 	$(top_srcdir)/src/core/libsub_core.a \
 	$(top_srcdir)/src/display/libsub_display.a \
-	$(top_srcdir)/src/input/libsub_input.a
+	$(top_srcdir)/src/input/libsub_input.a \
+	$(top_srcdir)/src/utils/libsub_utils.a
 
 rtorrent_SOURCES = \
-	functional.h \
 	main.cc \
-	parse.cc \
-	parse.h \
+	option_parser.cc \
+	option_parser.h \
 	signal_handler.cc \
-	signal_handler.h \
-	timer.h
+	signal_handler.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/Makefile.in	2005-02-16 07:33:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/Makefile.in	2005-02-20 01:26:48.000000000 +0800
@@ -77,57 +77,58 @@
 am__quote = @am__quote@
 install_sh = @install_sh@
 SUBDIRS = \
 	core \
 	display \
 	input \
-	ui
+	ui \
+	utils
 
 
 bin_PROGRAMS = rtorrent
 
 rtorrent_LDADD = \
 	$(top_srcdir)/src/ui/libsub_ui.a \
 	$(top_srcdir)/src/core/libsub_core.a \
 	$(top_srcdir)/src/display/libsub_display.a \
-	$(top_srcdir)/src/input/libsub_input.a
+	$(top_srcdir)/src/input/libsub_input.a \
+	$(top_srcdir)/src/utils/libsub_utils.a
 
 
 rtorrent_SOURCES = \
-	functional.h \
 	main.cc \
-	parse.cc \
-	parse.h \
+	option_parser.cc \
+	option_parser.h \
 	signal_handler.cc \
-	signal_handler.h \
-	timer.h
+	signal_handler.h
 
 subdir = src
 mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 bin_PROGRAMS = rtorrent$(EXEEXT)
 PROGRAMS = $(bin_PROGRAMS)
 
-am_rtorrent_OBJECTS = main.$(OBJEXT) parse.$(OBJEXT) \
+am_rtorrent_OBJECTS = main.$(OBJEXT) option_parser.$(OBJEXT) \
 	signal_handler.$(OBJEXT)
 rtorrent_OBJECTS = $(am_rtorrent_OBJECTS)
 rtorrent_DEPENDENCIES = $(top_srcdir)/src/ui/libsub_ui.a \
 	$(top_srcdir)/src/core/libsub_core.a \
 	$(top_srcdir)/src/display/libsub_display.a \
-	$(top_srcdir)/src/input/libsub_input.a
+	$(top_srcdir)/src/input/libsub_input.a \
+	$(top_srcdir)/src/utils/libsub_utils.a
 rtorrent_LDFLAGS =
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
-@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/main.Po ./$(DEPDIR)/parse.Po \
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/main.Po ./$(DEPDIR)/option_parser.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/signal_handler.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
 CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
@@ -188,13 +189,13 @@
 	-rm -f *.$(OBJEXT) core *.core
 
 distclean-compile:
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/parse.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/option_parser.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/signal_handler.Po@am__quote@
 
 distclean-depend:
 	-rm -rf ./$(DEPDIR)
 
 .cc.o:
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src: option_parser.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src: option_parser.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src: parse.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src: parse.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src: timer.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/ui/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/ui/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/ui/download_list.cc	2005-02-17 04:30:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/ui/download_list.cc	2005-02-20 23:35:35.000000000 +0800
@@ -1,57 +1,66 @@
 #include "config.h"
 
 #include <stdexcept>
 #include <torrent/torrent.h>
 #include <sigc++/bind.h>
 
+#include "core/download.h"
+
 #include "input/bindings.h"
 #include "input/text_input.h"
-#include "display/window_title.h"
+
 #include "display/window_download_list.h"
-#include "display/window_statusbar.h"
+#include "display/window_http_queue.h"
 #include "display/window_input.h"
+#include "display/window_statusbar.h"
+#include "display/window_title.h"
 
 #include "control.h"
 #include "download.h"
 #include "download_list.h"
 
 namespace ui {
 
 DownloadList::DownloadList(Control* c) :
   m_title(new WTitle("rtorrent " VERSION " - " + torrent::get(torrent::LIBRARY_NAME))),
   m_status(new WStatus),
   m_textInput(new WInput(new input::TextInput)),
+  m_windowHttpQueue(new WHttp(&c->get_core().get_http_queue())),
+
   m_download(NULL),
   m_focus(c->get_core().get_download_list().end()),
   m_control(c),
   m_bindings(new input::Bindings) {
 
   m_window = new WList(&m_control->get_core().get_download_list(), &m_focus);
 
   bind_keys(m_bindings);
 
   m_textInput->get_input()->slot_dirty(sigc::mem_fun(*m_textInput, &WInput::mark_dirty));
+  m_windowHttpQueue->slot_adjust(sigc::mem_fun(c->get_display(), &display::Manager::adjust_layout));
 }
 
 DownloadList::~DownloadList() {
   delete m_window;
   delete m_title;
   delete m_status;
   delete m_bindings;
 
   delete m_textInput->get_input();
   delete m_textInput;
+  delete m_windowHttpQueue;
 }
 
 void
 DownloadList::activate() {
   m_textInput->set_active(false);
 
   m_control->get_input().push_front(m_bindings);
 
+  m_control->get_display().push_back(m_windowHttpQueue);
   m_control->get_display().push_back(m_textInput);
   m_control->get_display().push_back(m_status);
   m_control->get_display().push_front(m_window);
   m_control->get_display().push_front(m_title);
 }
 
@@ -65,12 +74,13 @@
   m_control->get_input().erase(m_bindings);
 
   m_control->get_display().erase(m_title);
   m_control->get_display().erase(m_window);
   m_control->get_display().erase(m_status);
   m_control->get_display().erase(m_textInput);
+  m_control->get_display().erase(m_windowHttpQueue);
 }
 
 void
 DownloadList::receive_next() {
   if (m_focus != m_control->get_core().get_download_list().end())
     ++m_focus;
@@ -99,37 +109,37 @@
 
 void
 DownloadList::receive_start_download() {
   if (m_focus == m_control->get_core().get_download_list().end())
     return;
 
-  m_control->get_core().start(&*m_focus);
+  m_control->get_core().start(*m_focus);
 }
 
 void
 DownloadList::receive_stop_download() {
   if (m_focus == m_control->get_core().get_download_list().end())
     return;
 
-  if (m_focus->get_download().is_active())
-    m_control->get_core().stop(&*m_focus);
+  if ((*m_focus)->get_download().is_active())
+    m_control->get_core().stop(*m_focus);
   else
-    m_control->get_core().erase(m_focus);
+    m_focus = m_control->get_core().erase(m_focus);
 }
 
 void
 DownloadList::receive_view_download() {
   if (m_focus == m_control->get_core().get_download_list().end())
     return;
 
   if (m_download != NULL)
     throw std::logic_error("DownloadList::receive_view_download() called but m_download != NULL");
 
   disable();
 
-  m_download = new Download(&*m_focus, m_control);
+  m_download = new Download(*m_focus, m_control);
 
   m_download->activate();
   m_download->get_bindings()[KEY_LEFT] = sigc::mem_fun(*this, &DownloadList::receive_exit_download);
 }
 
 void
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/ui/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/ui/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/src/ui/download_list.h	2005-02-17 03:54:23.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src/ui/download_list.h	2005-02-17 07:14:21.000000000 +0800
@@ -1,29 +1,32 @@
 #ifndef RTORRENT_UI_DOWNLOAD_LIST_H
 #define RTORRENT_UI_DOWNLOAD_LIST_H
 
 #include <sigc++/slot.h>
 
 namespace display {
-  class WindowTitle;
   class WindowDownloadList;
-  class WindowStatusbar;
+  class WindowHttpQueue;
   class WindowInput;
+  class WindowStatusbar;
+  class WindowTitle;
 }
 
 namespace ui {
 
 class Control;
 class Download;
 
 class DownloadList {
 public:
   typedef display::WindowDownloadList           WList;
-  typedef display::WindowTitle                  WTitle;
-  typedef display::WindowStatusbar              WStatus;
+  typedef display::WindowHttpQueue              WHttp;
   typedef display::WindowInput                  WInput;
+  typedef display::WindowStatusbar              WStatus;
+  typedef display::WindowTitle                  WTitle;
+
   typedef core::DownloadList                    DList;
 
   typedef sigc::slot1<void, const std::string&> SlotOpenUri;
 
   // We own 'window'.
   DownloadList(Control* c);
@@ -60,12 +63,13 @@
   void             mark_dirty();
 
   WList*           m_window;
   WTitle*          m_title;
   WStatus*         m_status;
   WInput*          m_textInput;
+  WHttp*           m_windowHttpQueue;
 
   Download*        m_download;
 
   DList*           m_list;
   DList::iterator  m_focus;
 
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/src: utils
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/TODO /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/TODO
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.2/TODO	2005-02-16 06:10:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.0.3/TODO	2005-02-18 03:03:33.000000000 +0800
@@ -1,5 +1,10 @@
 core::Manager::stop() should make sure ongoing hash checks get cleaned
 up.
 
 Polling during last phase of shutdown should be very quick, don't use
 normal timeout.
+
+Make clear distinction of upload/download throttle.
+
+"Caught exception: "Tried to add an existing DownloadMain to DownloadManager""
+Properly handle duplicate torrents. 
