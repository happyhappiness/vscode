diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/configure	2007-08-26 19:31:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/configure	2007-10-25 18:00:29.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.60 for rtorrent 0.7.8.
+# Generated by GNU Autoconf 2.60 for rtorrent 0.7.9.
 #
 # Report bugs to <jaris@ifi.uio.no>.
 #
 # Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 # 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -710,14 +710,14 @@
 MAKEFLAGS=
 SHELL=${CONFIG_SHELL-/bin/sh}
 
 # Identity of this package.
 PACKAGE_NAME='rtorrent'
 PACKAGE_TARNAME='rtorrent'
-PACKAGE_VERSION='0.7.8'
-PACKAGE_STRING='rtorrent 0.7.8'
+PACKAGE_VERSION='0.7.9'
+PACKAGE_STRING='rtorrent 0.7.9'
 PACKAGE_BUGREPORT='jaris@ifi.uio.no'
 
 # Factoring default headers for most tests.
 ac_includes_default="\
 #include <stdio.h>
 #if HAVE_SYS_TYPES_H
@@ -1375,13 +1375,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures rtorrent 0.7.8 to adapt to many kinds of systems.
+\`configure' configures rtorrent 0.7.9 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -1445,13 +1445,13 @@
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of rtorrent 0.7.8:";;
+     short | recursive ) echo "Configuration of rtorrent 0.7.9:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
@@ -1562,13 +1562,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-rtorrent configure 0.7.8
+rtorrent configure 0.7.9
 generated by GNU Autoconf 2.60
 
 Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -1576,13 +1576,13 @@
   exit
 fi
 cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by rtorrent $as_me 0.7.8, which was
+It was created by rtorrent $as_me 0.7.9, which was
 generated by GNU Autoconf 2.60.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 exec 5>>config.log
@@ -2247,13 +2247,13 @@
   fi
 fi
 
 
 # Define the identity of the package.
  PACKAGE='rtorrent'
- VERSION='0.7.8'
+ VERSION='0.7.9'
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -20223,42 +20223,35 @@
 
 
 
   { echo "$as_me:$LINENO: checking for execinfo.h" >&5
 echo $ECHO_N "checking for execinfo.h... $ECHO_C" >&6; }
 
+  if test "$cross_compiling" = yes; then
+  { { echo "$as_me:$LINENO: error: cannot run test program while cross compiling
+See \`config.log' for more details." >&5
+echo "$as_me: error: cannot run test program while cross compiling
+See \`config.log' for more details." >&2;}
+   { (exit 1); exit 1; }; }
+else
   cat >conftest.$ac_ext <<_ACEOF
 #include <execinfo.h>
       int main() { backtrace((void**)0, 0); backtrace_symbols((char**)0, 0); return 0;}
 
 _ACEOF
-rm -f conftest.$ac_objext
-if { (ac_try="$ac_compile"
+rm -f conftest$ac_exeext
+if { (ac_try="$ac_link"
 case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
 eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_compile") 2>conftest.er1
-  ac_status=$?
-  grep -v '^ *+' conftest.er1 >conftest.err
-  rm -f conftest.er1
-  cat conftest.err >&5
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-	 { ac_try='test -z "$ac_c_werror_flag" || test ! -s conftest.err'
-  { (case "(($ac_try" in
-  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
-  *) ac_try_echo=$ac_try;;
-esac
-eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
-  (eval "$ac_try") 2>&5
+  (eval "$ac_link") 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; } &&
-	 { ac_try='test -s conftest.$ac_objext'
+  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'
   { (case "(($ac_try" in
   *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
   *) ac_try_echo=$ac_try;;
 esac
 eval "echo \"\$as_me:$LINENO: $ac_try_echo\"") >&5
   (eval "$ac_try") 2>&5
@@ -20272,22 +20265,26 @@
 cat >>confdefs.h <<\_ACEOF
 #define USE_EXECINFO 1
 _ACEOF
 
 
 else
-  echo "$as_me: failed program was:" >&5
+  echo "$as_me: program exited with status $ac_status" >&5
+echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
+( exit $ac_status )
 
       { echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6; }
 
 fi
+rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
+fi
+
 
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
   ac_ext=cpp
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
@@ -21842,20 +21839,22 @@
 cat >>confdefs.h <<\_ACEOF
 #define FS_STAT_BLOCK_SIZE (m_stat.f_bsize)
 _ACEOF
 
       { echo "$as_me:$LINENO: result: ok" >&5
 echo "${ECHO_T}ok" >&6; }
+      have_stat_vfs=yes
 
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
 
       { echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6; }
+      have_stat_vfs=no
 
 fi
 
 rm -f core conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 
@@ -22169,20 +22168,22 @@
 cat >>confdefs.h <<\_ACEOF
 #define FS_STAT_BLOCK_SIZE (m_stat.f_bsize)
 _ACEOF
 
       { echo "$as_me:$LINENO: result: ok" >&5
 echo "${ECHO_T}ok" >&6; }
+      have_stat_vfs=yes
 
 else
   echo "$as_me: failed program was:" >&5
 sed 's/^/| /' conftest.$ac_ext >&5
 
 
       { echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6; }
+      have_stat_vfs=no
 
 fi
 
 rm -f core conftest.err conftest.$ac_objext \
       conftest$ac_exeext conftest.$ac_ext
 
@@ -23080,13 +23081,13 @@
 exec 6>&1
 
 # Save the log message, to keep $[0] and so on meaningful, and to
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by rtorrent $as_me 0.7.8, which was
+This file was extended by rtorrent $as_me 0.7.9, which was
 generated by GNU Autoconf 2.60.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -23133,13 +23134,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-rtorrent config.status 0.7.8
+rtorrent config.status 0.7.9
 configured by $0, generated by GNU Autoconf 2.60,
   with options \\"`echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright (C) 2006 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/configure.ac	2007-08-26 19:31:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/configure.ac	2007-10-25 17:48:45.000000000 +0800
@@ -1,7 +1,7 @@
-AC_INIT(rtorrent, 0.7.8, jaris@ifi.uio.no)
+AC_INIT(rtorrent, 0.7.9, jaris@ifi.uio.no)
 
 AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 
 TORRENT_CHECK_CXXFLAGS()
 TORRENT_ENABLE_DEBUG()
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/doc/rtorrent.1.xml /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/doc/rtorrent.1.xml
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/doc/rtorrent.1.xml	2007-08-31 03:15:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/doc/rtorrent.1.xml	2007-10-08 20:17:33.000000000 +0800
@@ -532,13 +532,14 @@
 
       <varlistentry>
         <term>close_low_diskspace = <replaceable>space</replaceable></term>
         <listitem><para>
 Close any active torrents on filesystems with less than
 <emphasis>space</emphasis> diskspace left. Use with
-the <emphasis>schedule</emphasis> option.
+the <emphasis>schedule</emphasis> option. A default scheduled event
+with id <emphasis>low_diskspace</emphasis> is set to 500Mb.
         </para></listitem>
       </varlistentry>
 
       <varlistentry>
         <term>load = <replaceable>file</replaceable></term>
         <term>load_verbose = <replaceable>file</replaceable></term>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/doc/rtorrent.rc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/doc/rtorrent.rc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/doc/rtorrent.rc	2007-08-31 03:15:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/doc/rtorrent.rc	2007-10-08 18:45:27.000000000 +0800
@@ -34,13 +34,13 @@
 #schedule = low_diskspace,5,60,close_low_diskspace=100M
 
 # Stop torrents when reaching upload ratio in percent,
 # when also reaching total upload in bytes, or when
 # reaching final upload ratio in percent.
 # example: stop at ratio 2.0 with at least 200 MB uploaded, or else ratio 20.0
-#schedule = ratio,60,60,stop_on_ratio=200,200M,2000
+#schedule = ratio,60,60,"stop_on_ratio=200,200M,2000"
 
 # The ip address reported to the tracker.
 #ip = 127.0.0.1
 #ip = rakshasa.no
 
 # The ip address the listening socket and outgoing connections is
@@ -92,21 +92,6 @@
 #hash_interval = 100
 
 # Number of attempts to check the hash while using the mincore status,
 # before forcing. Overworked systems might need lower values to get a
 # decent hash checking rate.
 #hash_max_tries = 10
-
-# Max number of files to keep open simultaniously.
-#max_open_files = 128
-
-# Number of sockets to simultaneously keep open.
-#max_open_sockets = <no default>
-
-
-# Example of scheduling commands: Switch between two ip's every 5
-# seconds.
-#schedule = "ip_tick1,5,10,ip=torretta"
-#schedule = "ip_tick2,10,10,ip=lampedusa"
-
-# Remove a scheduled event.
-#schedule_remove = "ip_tick1"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/scripts/checks.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/scripts/checks.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/scripts/checks.m4	2007-08-14 01:53:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/scripts/checks.m4	2007-10-09 09:41:13.000000000 +0800
@@ -212,15 +212,17 @@
       AC_DEFINE(FS_STAT_FN, [statfs(fn, &m_stat) == 0], Function to determine filesystem stats from filename)
       AC_DEFINE(FS_STAT_STRUCT, [struct statfs], Type of second argument to statfs function)
       AC_DEFINE(FS_STAT_SIZE_TYPE, [long], Type of block size member in stat struct)
       AC_DEFINE(FS_STAT_COUNT_TYPE, [long], Type of block count member in stat struct)
       AC_DEFINE(FS_STAT_BLOCK_SIZE, [(m_stat.f_bsize)], Determine the block size)
       AC_MSG_RESULT(ok)
+      have_stat_vfs=yes
     ],
     [
       AC_MSG_RESULT(no)
+      have_stat_vfs=no
     ])
 ])
 
 AC_DEFUN([TORRENT_DISABLED_STATFS], [
       AC_DEFINE(FS_STAT_FD, [(errno = ENOSYS) == 0], Function to determine filesystem stats from fd)
       AC_DEFINE(FS_STAT_FN, [(errno = ENOSYS) == 0], Function to determine filesystem stats from filename)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/scripts/common.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/scripts/common.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/scripts/common.m4	2007-04-11 05:15:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/scripts/common.m4	2007-10-10 00:11:16.000000000 +0800
@@ -139,13 +139,13 @@
         [
           AC_DEFINE(USE_MINCORE, 1, Use mincore)
           AC_DEFINE(USE_MINCORE_UNSIGNED, 0, use char* in mincore)
           AC_MSG_RESULT(signed)
         ],
         [
-          AC_MSG_ERROR([failed, do *not* attempt to use --disable-mincore unless you are running Win32.])
+          AC_MSG_ERROR([failed, do *not* attempt fix this with --disable-mincore unless you are running Win32.])
       ])
   ])
 
   AC_LANG_POP(C++)
 ])
 
@@ -180,13 +180,13 @@
   ])
 ])
 
 AC_DEFUN([TORRENT_CHECK_EXECINFO], [
   AC_MSG_CHECKING(for execinfo.h)
 
-  AC_COMPILE_IFELSE(
+  AC_RUN_IFELSE(
     [[#include <execinfo.h>
       int main() { backtrace((void**)0, 0); backtrace_symbols((char**)0, 0); return 0;}
     ]],
     [
       AC_MSG_RESULT(yes)
       AC_DEFINE(USE_EXECINFO, 1, Use execinfo.h)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_download.cc	2007-09-03 19:59:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_download.cc	2007-10-03 23:19:19.000000000 +0800
@@ -389,12 +389,13 @@
   ADD_CD_VALUE("is_open",          rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_open)));
   ADD_CD_VALUE("is_active",        rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_active)));
   ADD_CD_VALUE("is_hash_checked",  rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_hash_checked)));
   ADD_CD_VALUE("is_hash_checking", rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_hash_checking)));
   ADD_CD_VALUE("is_multi_file",    rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::is_multi_file)));
   ADD_CD_VALUE("is_private",       rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_private)));
+  ADD_CD_VALUE("is_pex_active",    rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::is_pex_active)));
 
   ADD_CD_VARIABLE_STRING_PUBLIC("custom1", "rtorrent", "custom1");
   ADD_CD_VARIABLE_STRING_PUBLIC("custom2", "rtorrent", "custom2");
   ADD_CD_VARIABLE_STRING_PUBLIC("custom3", "rtorrent", "custom3");
   ADD_CD_VARIABLE_STRING_PUBLIC("custom4", "rtorrent", "custom4");
   ADD_CD_VARIABLE_STRING_PUBLIC("custom5", "rtorrent", "custom5");
@@ -464,12 +465,14 @@
   ADD_CD_VALUE_UNI("chunks_hashed",       rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::chunks_hashed)));
   ADD_CD_VALUE_UNI("free_diskspace",      rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::free_diskspace)));
 
   ADD_CD_VALUE_UNI("size_files",          rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::size_files)));
   ADD_CD_VALUE_UNI("size_bytes",          rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::size_bytes)));
   ADD_CD_VALUE_UNI("size_chunks",         rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::size_chunks)));
+  ADD_CD_VALUE_UNI("size_pex",            rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::size_pex)));
+  ADD_CD_VALUE_UNI("max_size_pex",        rak::on(std::mem_fun(&core::Download::download), std::mem_fun(&torrent::Download::max_size_pex)));
 
   ADD_CD_VALUE_UNI("completed_bytes",     rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::completed_bytes)));
   ADD_CD_VALUE_UNI("completed_chunks",    rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::completed_chunks)));
   ADD_CD_VALUE_UNI("left_bytes",          rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::left_bytes)));
 
   ADD_CD_VALUE_UNI("chunk_size",          rak::on(std::mem_fun(&core::Download::file_list), std::mem_fun(&torrent::FileList::chunk_size)));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_events.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_events.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_events.cc	2007-09-07 07:33:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_events.cc	2007-10-24 23:42:12.000000000 +0800
@@ -37,13 +37,13 @@
 #include "config.h"
 
 #include <functional>
 #include <rak/file_stat.h>
 #include <rak/path.h>
 #include <rak/string_manip.h>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/rate.h>
 #include <torrent/hash_string.h>
 
 #include "core/download.h"
 #include "core/download_list.h"
 #include "core/manager.h"
@@ -233,25 +233,31 @@
 void apply_try_import(const std::string& path) { if (!rpc::parse_command_file(path)) control->core()->push_log_std("Could not read resource file: " + path); }
 
 void
 apply_close_low_diskspace(int64_t arg) {
   core::DownloadList* downloadList = control->core()->download_list();
 
+  bool closed = false;
   core::Manager::DListItr itr = downloadList->begin();
 
   while ((itr = std::find_if(itr, downloadList->end(), std::mem_fun(&core::Download::is_downloading)))
          != downloadList->end()) {
     if ((*itr)->file_list()->free_diskspace() < (uint64_t)arg) {
       downloadList->close(*itr);
 
       (*itr)->set_hash_failed(true);
       (*itr)->set_message(std::string("Low diskspace."));
+
+      closed = true;
     }
 
     ++itr;
   }
+
+  if (closed)
+    control->core()->push_log("Closed torrents due to low diskspace.");    
 }
 
 torrent::Object
 apply_download_list(const torrent::Object& rawArgs) {
   const torrent::Object::list_type&          args    = rawArgs.as_list();
   torrent::Object::list_type::const_iterator argsItr = args.begin();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_file.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_file.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_file.cc	2007-09-01 21:35:07.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_file.cc	2007-10-21 12:24:54.000000000 +0800
@@ -37,12 +37,13 @@
 #include "config.h"
 
 #include <rak/error_number.h>
 #include <rak/path.h>
 #include <torrent/data/file.h>
 #include <torrent/data/file_list.h>
+#include <torrent/data/file_list_iterator.h>
 
 #include "core/manager.h"
 
 #include "globals.h"
 #include "control.h"
 #include "command_helpers.h"
@@ -82,12 +83,23 @@
 
 torrent::Object
 apply_f_path_depth(torrent::File* file) {
   return (int64_t)file->path()->size();
 }
 
+torrent::Object
+apply_fi_filename_last(torrent::FileListIterator* itr) {
+  if (itr->file()->path()->empty())
+    return "EMPTY";
+
+  if (itr->depth() >= itr->file()->path()->size())
+    return "ERROR";
+
+  return itr->file()->path()->at(itr->depth());
+}
+
 #define ADD_CF_SLOT(key, function, slot, parm, doc)    \
   commandFileSlotsItr->set_slot(slot); \
   rpc::commands.insert_file(key, commandFileSlotsItr++, &rpc::CommandSlot<torrent::File*>::function, rpc::CommandMap::flag_dont_delete, parm, doc);
 
 #define ADD_CF_SLOT_PUBLIC(key, function, slot, parm, doc)    \
   commandFileSlotsItr->set_slot(slot); \
@@ -103,12 +115,22 @@
   ADD_CF_SLOT_PUBLIC("f.set_" key, call_value,   rpc::object_value_fn<torrent::File*>(set), "i:i", "") \
   ADD_CF_SLOT_PUBLIC("f.get_" key, call_unknown, rpc::object_void_fn<torrent::File*>(get), "i:", "")
 
 #define ADD_CF_STRING_UNI(key, get) \
   ADD_CF_SLOT_PUBLIC("f.get_" key, call_unknown, rpc::object_void_fn<torrent::File*>(get), "s:", "")
 
+#define ADD_CFI_SLOT_PUBLIC(key, function, slot, parm, doc)    \
+  commandFileItrSlotsItr->set_slot(slot); \
+  rpc::commands.insert_file_itr(key, commandFileItrSlotsItr++, &rpc::CommandSlot<torrent::FileListIterator*>::function, rpc::CommandMap::flag_dont_delete | rpc::CommandMap::flag_public_xmlrpc, parm, doc);
+
+#define ADD_CFI_VOID(key, slot) \
+  ADD_CFI_SLOT_PUBLIC("fi.get_" key, call_unknown, rpc::object_fn(slot), "i:", "")
+
+#define ADD_CFI_VALUE(key, get) \
+  ADD_CFI_SLOT_PUBLIC("fi." key, call_unknown, rpc::object_void_fn<torrent::FileListIterator*>(get), "i:", "")
+
 void
 initialize_command_file() {
   ADD_CF_VALUE_UNI("is_created",       std::mem_fun(&torrent::File::is_created));
   ADD_CF_VALUE_UNI("is_open",          std::mem_fun(&torrent::File::is_open));
 
   ADD_CF_VALUE_UNI("size_bytes",       std::mem_fun(&torrent::File::size_bytes));
@@ -127,7 +149,11 @@
   ADD_CF_STRING_UNI("frozen_path",     std::mem_fun(&torrent::File::frozen_path));
 
   ADD_CF_VALUE_UNI("match_depth_prev", std::mem_fun(&torrent::File::match_depth_prev));
   ADD_CF_VALUE_UNI("match_depth_next", std::mem_fun(&torrent::File::match_depth_next));
 
   ADD_CF_VALUE_UNI("last_touched",     std::mem_fun(&torrent::File::last_touched));
+
+  ADD_CFI_VOID("filename_last",        &apply_fi_filename_last);
+
+  ADD_CFI_VALUE("is_file",             std::mem_fun(&torrent::FileListIterator::is_file));
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_peer.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_peer.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_peer.cc	2007-09-01 21:34:58.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_peer.cc	2007-10-22 23:57:08.000000000 +0800
@@ -35,98 +35,114 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <rak/error_number.h>
 #include <rak/path.h>
+#include <rak/socket_address.h>
+#include <rak/string_manip.h>
+#include <torrent/bitfield.h>
+#include <torrent/rate.h>
 #include <torrent/peer/peer.h>
+#include <torrent/peer/peer_info.h>
 
 #include "core/manager.h"
+#include "display/utils.h"
 
 #include "globals.h"
 #include "control.h"
 #include "command_helpers.h"
 
-// void
-// apply_f_set_priority(torrent::File* file, uint32_t value) {
-//   if (value > torrent::PRIORITY_HIGH)
-//     throw torrent::input_error("Invalid value.");
-
-//   file->set_priority((torrent::priority_t)value);
-// }
-
-// torrent::Object
-// apply_f_path(torrent::File* file) {
-//   if (file->path()->empty())
-//     return std::string();
-
-//   torrent::Object resultRaw(*file->path()->begin());
-//   torrent::Object::string_type& result = resultRaw.as_string();
-
-//   for (torrent::Path::const_iterator itr = ++file->path()->begin(), last = file->path()->end(); itr != last; itr++)
-//     result += '/' + *itr;
-
-//   return resultRaw;
-// }
-
-// torrent::Object
-// apply_f_path_components(torrent::File* file) {
-//   torrent::Object resultRaw(torrent::Object::TYPE_LIST);
-//   torrent::Object::list_type& result = resultRaw.as_list();
-
-//   for (torrent::Path::const_iterator itr = file->path()->begin(), last = file->path()->end(); itr != last; itr++)
-//     result.push_back(*itr);
-
-//   return resultRaw;
-// }
-
-// torrent::Object
-// apply_f_path_depth(torrent::File* file) {
-//   return (int64_t)file->path()->size();
-// }
+torrent::Object
+retrieve_p_id(torrent::Peer* peer) {
+  const torrent::HashString* hashString = &peer->id();
+
+  return rak::transform_hex(hashString->begin(), hashString->end());
+}
+
+torrent::Object
+retrieve_p_id_html(torrent::Peer* peer) {
+  const torrent::HashString* hashString = &peer->id();
+
+  return rak::copy_escape_html(hashString->begin(), hashString->end());
+}
+
+torrent::Object
+retrieve_p_address(torrent::Peer* peer) {
+  return rak::socket_address::cast_from(peer->info()->socket_address())->address_str();
+}
+
+torrent::Object
+retrieve_p_port(torrent::Peer* peer) {
+  return rak::socket_address::cast_from(peer->info()->socket_address())->port();
+}
+
+torrent::Object
+retrieve_p_client_version(torrent::Peer* peer) {
+  char buf[128];
+  display::print_client_version(buf, buf + 128, peer->info()->client_info());
+
+  return std::string(buf);
+}
+
+torrent::Object
+retrieve_p_options_str(torrent::Peer* peer) {
+  return rak::transform_hex(peer->info()->options(), peer->info()->options() + 8);
+}
+
+torrent::Object
+retrieve_p_completed_percent(torrent::Peer* peer) {
+  return (100 * peer->bitfield()->size_set()) / peer->bitfield()->size_bits();
+}
 
 #define ADD_CP_SLOT(key, function, slot, parm, doc)    \
   commandPeerSlotsItr->set_slot(slot); \
   rpc::commands.insert_peer(key, commandPeerSlotsItr++, &rpc::CommandSlot<torrent::Peer*>::function, rpc::CommandMap::flag_dont_delete, parm, doc);
 
 #define ADD_CP_SLOT_PUBLIC(key, function, slot, parm, doc)    \
   commandPeerSlotsItr->set_slot(slot); \
   rpc::commands.insert_peer(key, commandPeerSlotsItr++, &rpc::CommandSlot<torrent::Peer*>::function, rpc::CommandMap::flag_dont_delete | rpc::CommandMap::flag_public_xmlrpc, parm, doc);
 
 #define ADD_CP_VOID(key, slot) \
   ADD_CP_SLOT_PUBLIC("p.get_" key, call_unknown, rpc::object_fn(slot), "i:", "")
 
+#define ADD_CP_VALUE(key, get) \
+  ADD_CP_SLOT_PUBLIC("p." key, call_unknown, rpc::object_void_fn<torrent::Peer*>(get), "i:", "")
+
 #define ADD_CP_VALUE_UNI(key, get) \
   ADD_CP_SLOT_PUBLIC("p.get_" key, call_unknown, rpc::object_void_fn<torrent::Peer*>(get), "i:", "")
 
 #define ADD_CP_VALUE_BI(key, set, get) \
   ADD_CP_SLOT_PUBLIC("p.set_" key, call_value, rpc::object_value_fn<torrent::Peer*>(set), "i:i", "") \
   ADD_CP_SLOT_PUBLIC("p.get_" key, call_unknown, rpc::object_void_fn<torrent::Peer*>(get), "i:", "")
 
+#define ADD_CP_VALUE_MEM_UNI(key, target, get) \
+  ADD_CP_SLOT_PUBLIC("p.get_" key, call_unknown, rpc::object_void_fn<torrent::Peer*>(rak::on(std::mem_fun(target), std::mem_fun(get))), "i:", "");
+
 #define ADD_CP_STRING_UNI(key, get) \
   ADD_CP_SLOT_PUBLIC("p.get_" key, call_unknown, rpc::object_void_fn<torrent::Peer*>(get), "s:", "")
 
 void
 initialize_command_peer() {
-//   ADD_CP_VALUE_UNI("is_created",       std::mem_fun(&torrent::Peer::is_created));
-//   ADD_CP_VALUE_UNI("is_open",          std::mem_fun(&torrent::Peer::is_open));
-
-//   ADD_CP_VALUE_UNI("size_bytes",       std::mem_fun(&torrent::Peer::size_bytes));
-//   ADD_CP_VALUE_UNI("size_chunks",      std::mem_fun(&torrent::Peer::size_chunks));
-//   ADD_CP_VALUE_UNI("completed_chunks", std::mem_fun(&torrent::Peer::completed_chunks));
-
-//   ADD_CP_VALUE_UNI("offset",           std::mem_fun(&torrent::Peer::offset));
-//   ADD_CP_VALUE_UNI("range_first",      std::mem_fun(&torrent::Peer::range_first));
-//   ADD_CP_VALUE_UNI("range_second",     std::mem_fun(&torrent::Peer::range_second));
-
-//   ADD_CP_VALUE_BI("priority",          std::ptr_fun(&apply_f_set_priority), std::mem_fun(&torrent::Peer::priority));
-
-//   ADD_CP_STRING_UNI("path",            std::ptr_fun(&apply_f_path));
-//   ADD_CP_STRING_UNI("path_components", std::ptr_fun(&apply_f_path_components));
-//   ADD_CP_STRING_UNI("path_depth",      std::ptr_fun(&apply_f_path_depth));
-//   ADD_CP_STRING_UNI("frozen_path",     std::mem_fun(&torrent::Peer::frozen_path));
-
-//   ADD_CP_VALUE_UNI("match_depth_prev", std::mem_fun(&torrent::Peer::match_depth_prev));
-//   ADD_CP_VALUE_UNI("match_depth_next", std::mem_fun(&torrent::Peer::match_depth_next));
-
-//   ADD_CP_VALUE_UNI("last_touched",     std::mem_fun(&torrent::Peer::last_touched));
+  ADD_CP_STRING_UNI("id",                 std::ptr_fun(&retrieve_p_id));
+  ADD_CP_STRING_UNI("id_html",            std::ptr_fun(&retrieve_p_id_html));
+  ADD_CP_STRING_UNI("client_version",     std::ptr_fun(&retrieve_p_client_version));
+
+  ADD_CP_STRING_UNI("options_str",        std::ptr_fun(&retrieve_p_options_str));
+
+  ADD_CP_VALUE("is_encrypted",            std::mem_fun(&torrent::Peer::is_encrypted));
+  ADD_CP_VALUE("is_incoming",             std::mem_fun(&torrent::Peer::is_incoming));
+  ADD_CP_VALUE("is_obfuscated",           std::mem_fun(&torrent::Peer::is_obfuscated));
+  ADD_CP_VALUE("is_snubbed",              std::mem_fun(&torrent::Peer::is_snubbed));
+
+  ADD_CP_STRING_UNI("address",            std::ptr_fun(&retrieve_p_address));
+  ADD_CP_VALUE_UNI("port",                std::ptr_fun(&retrieve_p_port));
+
+  ADD_CP_VALUE_UNI("completed_percent",   std::ptr_fun(&retrieve_p_completed_percent));
+
+  ADD_CP_VALUE_MEM_UNI("up_rate",         &torrent::Peer::up_rate, &torrent::Rate::rate);
+  ADD_CP_VALUE_MEM_UNI("up_total",        &torrent::Peer::up_rate, &torrent::Rate::total);
+  ADD_CP_VALUE_MEM_UNI("down_rate",       &torrent::Peer::down_rate, &torrent::Rate::rate);
+  ADD_CP_VALUE_MEM_UNI("down_total",      &torrent::Peer::down_rate, &torrent::Rate::total);
+  ADD_CP_VALUE_MEM_UNI("peer_rate",       &torrent::Peer::peer_rate, &torrent::Rate::rate);
+  ADD_CP_VALUE_MEM_UNI("peer_total",      &torrent::Peer::peer_rate, &torrent::Rate::total);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_ui.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_ui.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/command_ui.cc	2007-09-03 08:57:35.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/command_ui.cc	2007-10-20 01:20:56.000000000 +0800
@@ -35,13 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <rak/functional.h>
 #include <rak/functional_fun.h>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 
 #include "core/manager.h"
 #include "core/view_manager.h"
 #include "rpc/command_slot.h"
 #include "rpc/command_variable.h"
 #include "rpc/parse.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/curl_stack.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/curl_stack.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/curl_stack.cc	2007-07-20 05:23:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/curl_stack.cc	2007-10-20 01:20:56.000000000 +0800
@@ -35,13 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <algorithm>
 #include <curl/multi.h>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/exceptions.h>
 
 #include "rak/functional.h"
 #include "curl_get.h"
 #include "curl_stack.h"
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/curl_stack.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/curl_stack.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/curl_stack.h	2007-07-20 05:23:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/curl_stack.h	2007-10-25 18:22:56.000000000 +0800
@@ -36,13 +36,13 @@
 
 #ifndef RTORRENT_CORE_CURL_STACK_H
 #define RTORRENT_CORE_CURL_STACK_H
 
 #include <deque>
 #include <string>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 namespace core {
 
 class CurlGet;
 
 // By using a deque instead of vector we allow for cheaper removal of
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download.cc	2007-09-06 01:09:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download.cc	2007-10-20 01:20:56.000000000 +0800
@@ -33,14 +33,14 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include <sigc++/bind.h>
-#include <sigc++/hide.h>
+#include <sigc++/adaptors/bind.h>
+#include <sigc++/adaptors/hide.h>
 #include <sigc++/signal.h>
 #include <rak/path.h>
 #include <rak/functional.h>
 #include <torrent/exceptions.h>
 #include <torrent/rate.h>
 #include <torrent/torrent.h>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_factory.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_factory.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_factory.h	2007-08-24 20:05:52.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_factory.h	2007-10-25 18:22:56.000000000 +0800
@@ -39,13 +39,13 @@
 // settings while, or even after, the torrent is loading.
 
 #ifndef RTORRENT_CORE_DOWNLOAD_FACTORY_H
 #define RTORRENT_CORE_DOWNLOAD_FACTORY_H
 
 #include <iosfwd>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 #include <rak/priority_queue_default.h>
 #include <torrent/object.h>
 
 #include "http_queue.h"
 
 namespace core {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_list.cc	2007-09-07 02:05:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_list.cc	2007-10-20 01:20:56.000000000 +0800
@@ -35,13 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <algorithm>
 #include <iostream>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <rak/functional.h>
 #include <rak/string_manip.h>
 #include <torrent/exceptions.h>
 #include <torrent/download.h>
 #include <torrent/hash_string.h>
 #include <torrent/object.h>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_list.h	2007-09-07 02:04:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_list.h	2007-10-25 18:22:56.000000000 +0800
@@ -38,13 +38,13 @@
 #define RTORRENT_CORE_DOWNLOAD_LIST_H
 
 #include <iosfwd>
 #include <list>
 #include <map>
 #include <string>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 namespace torrent {
   class HashString;
 }
 
 namespace core {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_slot_map.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_slot_map.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/download_slot_map.h	2007-07-20 05:23:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/download_slot_map.h	2007-10-25 18:22:56.000000000 +0800
@@ -36,13 +36,13 @@
 
 #ifndef RTORRENT_CORE_DOWNLOAD_SLOT_MAP_H
 #define RTORRENT_CORE_DOWNLOAD_SLOT_MAP_H
 
 #include <map>
 #include <string>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 #include "download.h"
 
 namespace core {
 
 class DownloadSlotMap : public std::map<std::string, sigc::slot1<void, Download*> > {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/http_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/http_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/http_queue.cc	2007-07-20 05:23:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/http_queue.cc	2007-10-20 01:20:56.000000000 +0800
@@ -35,14 +35,14 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <memory>
 #include <sstream>
-#include <sigc++/bind.h>
-#include <sigc++/hide.h>
+#include <sigc++/adaptors/bind.h>
+#include <sigc++/adaptors/hide.h>
 #include <torrent/http.h>
 
 #include "rak/functional.h"
 #include "http_queue.h"
 #include "curl_get.h"
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/manager.cc	2007-08-28 06:30:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/manager.cc	2007-10-20 01:20:56.000000000 +0800
@@ -43,14 +43,14 @@
 #include <sys/select.h>
 #include <rak/address_info.h>
 #include <rak/error_number.h>
 #include <rak/regex.h>
 #include <rak/path.h>
 #include <rak/string_manip.h>
-#include <sigc++/bind.h>
-#include <sigc++/hide.h>
+#include <sigc++/adaptors/bind.h>
+#include <sigc++/adaptors/hide.h>
 #include <torrent/object.h>
 #include <torrent/connection_manager.h>
 #include <torrent/error.h>
 #include <torrent/exceptions.h>
 #include <torrent/resume.h>
 #include <torrent/tracker_list.h>
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/view.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/view.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/core/view.cc	2007-07-20 05:23:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/core/view.cc	2007-10-20 01:20:56.000000000 +0800
@@ -36,13 +36,13 @@
 
 #include "config.h"
 
 #include <algorithm>
 #include <functional>
 #include <rak/functional.h>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/download.h>
 #include <torrent/exceptions.h>
 
 #include "download.h"
 #include "download_list.h"
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/Makefile.am	2007-02-02 19:09:54.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/Makefile.am	2007-10-24 23:05:08.000000000 +0800
@@ -8,14 +8,12 @@
 	frame.h \
 	manager.cc \
 	manager.h \
 	utils.cc \
 	utils.h \
 	text_element.h \
-	text_element_helpers.h \
-	text_element_lambda.h \
 	text_element_list.cc \
 	text_element_list.h \
 	text_element_string.cc \
 	text_element_string.h \
 	text_element_value.cc \
 	text_element_value.h \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/Makefile.in	2007-09-01 21:28:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/Makefile.in	2007-10-25 18:16:25.000000000 +0800
@@ -202,14 +202,12 @@
 	frame.h \
 	manager.cc \
 	manager.h \
 	utils.cc \
 	utils.h \
 	text_element.h \
-	text_element_helpers.h \
-	text_element_lambda.h \
 	text_element_list.cc \
 	text_element_list.h \
 	text_element_string.cc \
 	text_element_string.h \
 	text_element_value.cc \
 	text_element_value.h \
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display: text_element_helpers.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display: text_element_lambda.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/text_element_string.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/text_element_string.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/text_element_string.h	2007-09-03 03:12:49.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/text_element_string.h	2007-10-24 23:06:32.000000000 +0800
@@ -190,9 +190,18 @@
   extent_type         m_length;
 
   const char*         m_command;
   const char*         m_commandEnd;
 };
 
+namespace helpers {
+
+inline TextElementCommand*
+te_command(const char* command, int flags = TextElementCommand::flag_normal, int attributes = Attributes::a_invalid) {
+  return new TextElementCommand(command, flags, attributes, TextElementCommand::extent_full);
+}
+
+}
+
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/window_text.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/window_text.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/window_text.cc	2007-08-28 21:17:51.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/window_text.cc	2007-10-23 23:39:54.000000000 +0800
@@ -45,20 +45,24 @@
 
 namespace display {
 
 WindowText::WindowText(rpc::target_type target, extent_type margin) :
   Window(new Canvas, 0, 0, 0, extent_static, extent_static),
   m_target(target),
+  m_errorHandler(NULL),
   m_margin(margin),
   m_interval(0) {
 }
 
 void
 WindowText::clear() {
   std::for_each(begin(), end(), rak::call_delete<TextElement>());
   base_type::clear();
+
+  delete m_errorHandler;
+  m_errorHandler = NULL;
 }
 
 void
 WindowText::push_back(TextElement* element) {
   base_type::push_back(element);
 
@@ -83,12 +87,27 @@
     m_slotSchedule(this, (cachedTime + rak::timer::from_seconds(m_interval)).round_seconds());
 
   m_canvas->erase();
 
   unsigned int position = 0;
 
+  if (m_canvas->height() == 0)
+    return;
+
+  if (m_errorHandler != NULL && m_target.second == NULL) {
+    char buffer[m_canvas->width() + 1];
+
+    Canvas::attributes_list attributes;
+    attributes.push_back(Attributes(buffer, Attributes::a_normal, Attributes::color_default));
+
+    char* last = m_errorHandler->print(buffer, buffer + m_canvas->width(), &attributes, m_target);
+
+    m_canvas->print_attributes(0, position, buffer, last, &attributes);
+    return;
+  }
+
   for (iterator itr = begin(); itr != end() && position < m_canvas->height(); ++itr, ++position) {
     if (*itr == NULL)
       continue;
 
     char buffer[m_canvas->width() + 1];
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/window_text.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/window_text.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/display/window_text.h	2007-08-28 21:22:33.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/display/window_text.h	2007-10-23 23:37:43.000000000 +0800
@@ -72,16 +72,21 @@
 
   uint32_t            interval() const         { return m_interval; }
   void                set_interval(uint32_t i) { m_interval = i; }
 
   void                push_back(TextElement* element);
 
+  // Set an error handler if targets pointing to NULL elements should
+  // be handled separately to avoid throwing errors.
+  void                set_error_handler(TextElement* element) { m_errorHandler = element; }
+
   virtual void        redraw();
 
 private:
   rpc::target_type    m_target;
+  TextElement*        m_errorHandler;
 
   extent_type         m_margin;
   uint32_t            m_interval;
 };
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/input/bindings.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/input/bindings.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/input/bindings.h	2007-07-20 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/input/bindings.h	2007-10-25 18:19:20.000000000 +0800
@@ -36,13 +36,13 @@
 
 #ifndef RTORRENT_INPUT_BINDINGS_H
 #define RTORRENT_INPUT_BINDINGS_H
 
 #include <map>
 #include <ncurses.h>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 namespace input {
 
 class Bindings : private std::map<int, sigc::slot0<void> > {
 public:
   typedef sigc::slot0<void>    Slot;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/input/input_event.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/input/input_event.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/input/input_event.h	2007-07-20 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/input/input_event.h	2007-10-25 18:22:55.000000000 +0800
@@ -34,13 +34,13 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_INPUT_INPUT_EVENT_H
 #define RTORRENT_INPUT_INPUT_EVENT_H
 
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 #include <torrent/event.h>
 #include <torrent/poll.h>
 
 namespace input {
 
 class InputEvent : public torrent::Event {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/main.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/main.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/main.cc	2007-09-08 04:56:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/main.cc	2007-10-20 01:20:56.000000000 +0800
@@ -36,13 +36,13 @@
 
 #include "config.h"
 
 #include <cstdlib>
 #include <iostream>
 #include <string>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/http.h>
 #include <torrent/torrent.h>
 #include <torrent/exceptions.h>
 #include <rak/functional.h>
 
 #ifdef USE_EXECINFO
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/option_parser.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/option_parser.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/option_parser.cc	2007-07-20 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/option_parser.cc	2007-10-20 01:20:56.000000000 +0800
@@ -40,14 +40,14 @@
 #include <cstring>
 #include <cstdio>
 #include <functional>
 #include <getopt.h>
 #include <stdexcept>
 #include <unistd.h>
-#include <sigc++/bind.h>
-#include <sigc++/hide.h>
+#include <sigc++/adaptors/bind.h>
+#include <sigc++/adaptors/hide.h>
 
 #include "option_parser.h"
 
 void
 OptionParser::insert_flag(char c, Slot s) {
   m_container[c].m_slot = sigc::hide(s);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/option_parser.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/option_parser.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/option_parser.h	2007-07-20 05:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/option_parser.h	2007-10-25 18:22:56.000000000 +0800
@@ -36,13 +36,13 @@
 
 #ifndef RTORRENT_OPTION_PARSER_H
 #define RTORRENT_OPTION_PARSER_H
 
 #include <map>
 #include <string>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 // Throws std::runtime_error upon receiving bad input.
 
 class OptionParser {
 public:
   typedef sigc::slot0<void>                                         Slot;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/rpc/command_map.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/rpc/command_map.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/rpc/command_map.cc	2007-09-02 15:45:13.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/rpc/command_map.cc	2007-10-21 02:58:46.000000000 +0800
@@ -35,12 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <torrent/exceptions.h>
 #include <torrent/object.h>
+#include <torrent/data/file_list_iterator.h>
 
 #include "command.h"
 #include "command_map.h"
 
 namespace rpc {
 
@@ -131,12 +132,13 @@
   // This _should_ be optimized int just one assignment.
   switch (itr->second.m_target) {
   case target_generic:  itr->second.m_genericSlot  = src.m_genericSlot; break;
   case target_any:      itr->second.m_anySlot      = src.m_anySlot; break;
   case target_download: itr->second.m_downloadSlot = src.m_downloadSlot; break;
   case target_file:     itr->second.m_fileSlot     = src.m_fileSlot; break;
+  case target_file_itr: itr->second.m_fileItrSlot  = src.m_fileItrSlot; break;
   case target_peer:     itr->second.m_peerSlot     = src.m_peerSlot; break;
   case target_tracker:  itr->second.m_trackerSlot  = src.m_trackerSlot; break;
   default: throw torrent::internal_error("CommandMap::insert(...) Invalid target.");
   }
 }
 
@@ -144,16 +146,26 @@
 CommandMap::call_command(key_type key, const mapped_type& arg, target_type target) {
   const_iterator itr = base_type::find(key);
 
   if (itr == base_type::end())
     throw torrent::input_error("Command \"" + std::string(key) + "\" does not exist.");
 
-  if ((itr->second.m_target != target.first && itr->second.m_target > target_any) ||
-      (target.second == NULL && itr->second.m_target != target_generic && !(itr->second.m_target == target_any && target.first == target_generic)))
+  if (target.second == NULL &&
+      itr->second.m_target != target_generic &&
+      !(itr->second.m_target == target_any && target.first == target_generic))
     throw torrent::input_error("Command type mis-match.");
 
+  if (itr->second.m_target != target.first && itr->second.m_target > target_any) {
+    // Mismatch between the target and command type. If it is not
+    // possible to convert, then throw an input error.
+    if (target.first == target_file_itr && itr->second.m_target == target_file)
+      target = target_type((int)target_file, static_cast<torrent::FileListIterator*>(target.second)->file());
+    else
+      throw torrent::input_error("Command type mis-match.");
+  }
+
   // This _should_ be optimized int just two calls.
   switch (itr->second.m_target) {
   case target_generic:  return itr->second.m_genericSlot (itr->second.m_variable, arg);
   case target_any:      return itr->second.m_anySlot     (itr->second.m_variable, target, arg);
   case target_download: return itr->second.m_downloadSlot(itr->second.m_variable, (core::Download*)target.second, arg);
   case target_peer:     return itr->second.m_peerSlot    (itr->second.m_variable, (torrent::Peer*)target.second, arg);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/signal_handler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/signal_handler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/signal_handler.h	2007-07-20 05:23:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/signal_handler.h	2007-10-25 18:22:56.000000000 +0800
@@ -35,13 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_SIGNAL_HANDLER_H
 #define RTORRENT_SIGNAL_HANDLER_H
 
 #include <sys/signal.h>
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 class SignalHandler {
 public:
   typedef sigc::slot0<void> Slot;
 
   static const unsigned int HIGHEST_SIGNAL = 32;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download.cc	2007-09-03 08:59:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download.cc	2007-10-24 23:14:57.000000000 +0800
@@ -33,13 +33,13 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <rak/functional.h>
 #include <rak/string_manip.h>
 #include <torrent/exceptions.h>
 #include <torrent/chunk_manager.h>
 #include <torrent/connection_manager.h>
 #include <torrent/torrent.h>
@@ -48,14 +48,13 @@
 
 #include "core/download.h"
 #include "input/manager.h"
 #include "display/window_title.h"
 #include "display/window_download_statusbar.h"
 
-#include "display/text_element_lambda.h"
-#include "display/text_element_helpers.h"
+#include "display/text_element_string.h"
 
 #include "control.h"
 #include "download.h"
 #include "root.h"
 #include "element_file_list.h"
 #include "element_menu.h"
@@ -157,13 +156,15 @@
   element->push_column("Tied to file:",     te_command("d.get_tied_to_file="));
   element->push_column("File stats:",       te_command("cat=$if=$d.is_multi_file=\\,multi\\,single,\" \",$d.get_size_files=,\" files\""));
 
   element->push_back("");
   element->push_column("Chunks:",           te_command("cat=$d.get_completed_chunks=,\" / \",$d.get_size_chunks=,\" * \",$d.get_chunk_size="));
   element->push_column("Priority:",         te_command("d.get_priority="));
-  element->push_column("Peer exchange:",    te_command("if=$d.get_peer_exchange=,enabled,disabled"));
+  element->push_column("Peer exchange:",    te_command("cat=$if=$d.get_peer_exchange=\\,enabled\\,disabled,\\ ,"
+                                                       "$if=$d.is_pex_active=\\,active\\,$d.is_private=\\,private\\,inactive,"
+                                                       "\\ (,$d.get_size_pex=,/,$d.get_max_size_pex=,)"));
 
   element->push_column("State changed:",    te_command("to_elapsed_time=$d.get_state_changed="));
 
   element->push_back("");
   element->push_column("Memory usage:",     te_command("cat=$to_mb=$get_memory_usage=,\" MB\""));
   element->push_column("Max memory usage:", te_command("cat=$to_mb=$get_max_memory_usage=,\" MB\""));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download_list.cc	2007-09-06 01:10:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download_list.cc	2007-10-20 01:20:55.000000000 +0800
@@ -35,14 +35,14 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <rak/functional.h>
 #include <rak/string_manip.h>
-#include <sigc++/bind.h>
-#include <sigc++/hide.h>
+#include <sigc++/adaptors/bind.h>
+#include <sigc++/adaptors/hide.h>
 #include <torrent/exceptions.h>
 #include <torrent/torrent.h>
 
 #include "core/download.h"
 #include "core/download_list.h"
 #include "core/manager.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/download_list.h	2007-07-20 05:23:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/download_list.h	2007-10-25 18:22:55.000000000 +0800
@@ -34,13 +34,13 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_DOWNLOAD_LIST_H
 #define RTORRENT_UI_DOWNLOAD_LIST_H
 
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 #include "display/manager.h"
 
 #include "element_base.h"
 #include "globals.h"
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_download_list.cc	2007-08-28 06:45:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_download_list.cc	2007-10-20 01:20:55.000000000 +0800
@@ -33,13 +33,13 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/exceptions.h>
 #include <torrent/object.h>
 
 #include "core/download.h"
 #include "core/manager.h"
 #include "core/view.h"
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_file_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_file_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_file_list.cc	2007-08-29 05:12:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_file_list.cc	2007-10-24 23:13:34.000000000 +0800
@@ -33,22 +33,21 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <rak/algorithm.h>
 #include <torrent/exceptions.h>
 #include <torrent/data/file.h>
 #include <torrent/data/file_list.h>
 
 #include "display/frame.h"
 #include "display/manager.h"
-#include "display/text_element_helpers.h"
-#include "display/text_element_lambda.h"
+#include "display/text_element_string.h"
 #include "display/window_file_list.h"
 #include "input/manager.h"
 
 #include "control.h"
 #include "element_file_list.h"
 #include "element_text.h"
@@ -75,41 +74,31 @@
   m_bindings[KEY_PPAGE] = sigc::mem_fun(*this, &ElementFileList::receive_pageprev);
 
   m_bindings[KEY_DOWN] = m_bindings['N' - '@'] = sigc::mem_fun(*this, &ElementFileList::receive_next);
   m_bindings[KEY_UP]   = m_bindings['P' - '@'] = sigc::mem_fun(*this, &ElementFileList::receive_prev);
 }
 
-const char*
-element_file_list_filename(const torrent::FileListIterator* itr) {
-  if ((**itr)->path()->empty())
-    return "EMPTY";
-
-  if (itr->depth() >= (**itr)->path()->size())
-    return "ERROR";
-
-  return (**itr)->path()->at(itr->depth()).c_str();
-}
-
 inline ElementText*
 element_file_list_create_info() {
   using namespace display::helpers;
 
   ElementText* element = new ElementText(rpc::make_target());
 
   element->set_column(1);
   element->set_interval(1);
 
   element->push_back("File info:");
   element->push_back("");
   
-  element->push_column("Filename:", te_string(&element_file_list_filename));
+  element->push_column("Filename:", te_command("fi.get_filename_last="));
   element->push_back("");
   
-  element->push_column("Size:",   te_branch(&torrent::FileListIterator::is_file, te_value(&torrent::File::size_bytes, value_base::flag_xb), te_string("---")));
-  element->push_column("Chunks:", te_value(&torrent::File::completed_chunks), " / ", te_value(&torrent::File::size_chunks));
-  element->push_column("Range:",  te_value(&torrent::File::range_first), " - ", te_value(&torrent::File::range_second));
+  element->push_column("Size:",   te_command("if=$fi.is_file=,$to_xb=$f.get_size_bytes=,---"));
+
+  element->push_column("Chunks:", te_command("cat=$f.get_completed_chunks=,\" / \",$f.get_size_chunks="));
+  element->push_column("Range:",  te_command("cat=$f.get_range_first=,\" - \",$f.get_range_second="));
 
   element->set_column_width(element->column_width() + 1);
 
   return element;
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_menu.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_menu.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_menu.h	2007-07-20 05:23:12.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_menu.h	2007-10-25 18:22:55.000000000 +0800
@@ -34,13 +34,13 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_MENU_H
 #define RTORRENT_UI_ELEMENT_MENU_H
 
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 #include "core/download.h"
 
 #include "element_base.h"
 
 namespace display {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_peer_list.cc	2007-08-28 21:31:50.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_peer_list.cc	2007-10-24 23:13:59.000000000 +0800
@@ -33,22 +33,21 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/exceptions.h>
 #include <torrent/rate.h>
 #include <torrent/hash_string.h>
 #include <torrent/peer/peer_info.h>
 
 #include "display/frame.h"
 #include "display/manager.h"
-#include "display/text_element_helpers.h"
-#include "display/text_element_lambda.h"
+#include "display/text_element_string.h"
 #include "display/utils.h"
 #include "display/window_peer_list.h"
 #include "input/manager.h"
 
 #include "control.h"
 #include "element_peer_list.h"
@@ -86,56 +85,39 @@
   m_connPeerDisconnected.disconnect();
 
   delete m_windowList;
   delete m_elementInfo;
 }
 
-std::string
-te_client_version(const torrent::PeerInfo* info) {
-  char buf[128];
-  display::print_client_version(buf, buf + 128, info->client_info());
-
-  return buf;
-}
-
 inline ElementText*
 ElementPeerList::create_info() {
   using namespace display::helpers;
 
   ElementText* element = new ElementText(rpc::make_target());
 
   element->set_column(1);
   element->set_interval(1);
 
-  // Get these bindings with some kind of string map.
-
   element->push_back("Peer info:");
 
   element->push_back("");
-  element->push_column("Address:",
-                       display::text_element_string_slot(rak::on(std::mem_fun(&torrent::Peer::address), std::ptr_fun(&te_address))), ":",
-                       display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::address), std::ptr_fun(&te_port))));
-
-  element->push_column("Id:",        display::text_element_string_slot(std::mem_fun(&torrent::Peer::id), string_base::flag_escape_html));
-//   element->push_column("Client:",    display::text_element_string_slot(rak::on(std::mem_fun(&torrent::Peer::id), rak::make_mem_fun(control->client_info(), &display::ClientInfo::hash_str))));
-  element->push_column("Client:",    display::text_element_string_slot(rak::on(std::mem_fun(&torrent::Peer::info), std::ptr_fun(&te_client_version))));
-  element->push_column("Options:",   display::text_element_string_slot(std::mem_fun(&torrent::Peer::options), string_base::flag_escape_hex | string_base::flag_fixed_width, 0, 8));
-  element->push_column("Connected:", display::text_element_branch(std::mem_fun(&torrent::Peer::is_incoming), te_string("incoming"), te_string("outgoing")));
-  element->push_column("Encrypted:", display::text_element_branch3(std::mem_fun(&torrent::Peer::is_encrypted), te_string("yes"), std::mem_fun(&torrent::Peer::is_obfuscated), te_string("handshake"), te_string("no")));
+  element->push_column("Address:",   te_command("cat=$p.get_address=,:,$p.get_port="));
+  element->push_column("Id:",        te_command("p.get_id_html="));
+  element->push_column("Client:",    te_command("p.get_client_version="));
+  element->push_column("Options:",   te_command("p.get_options_str="));
+  element->push_column("Connected:", te_command("if=$p.is_incoming=,incoming,outgoing"));
+  element->push_column("Encrypted:", te_command("if=$p.is_encrypted=,yes,$p.is_obfuscated=,handshake,no"));
 
   element->push_back("");
-  element->push_column("Snubbed:", display::text_element_branch(std::mem_fun(&torrent::Peer::is_snubbed), te_string("yes"), te_string("no")));
-  element->push_column("Done:",    display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::bitfield), std::ptr_fun(&te_bitfield_percentage))));
-  element->push_column("Rate:",
-                       display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::up_rate), std::mem_fun(&torrent::Rate::rate)), value_base::flag_kb), " KB / ",
-                       display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::down_rate), std::mem_fun(&torrent::Rate::rate)), value_base::flag_kb), " KB");
-  element->push_column("Total:",
-                       display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::up_rate), std::mem_fun(&torrent::Rate::total)), value_base::flag_xb), " / ",
-                       display::text_element_value_slot(rak::on(std::mem_fun(&torrent::Peer::down_rate), std::mem_fun(&torrent::Rate::total)), value_base::flag_xb));
+  element->push_column("Snubbed:",   te_command("if=$p.is_snubbed=,yes,no"));
+  element->push_column("Done:",      te_command("p.get_completed_percent="));
+  element->push_column("Rate:",      te_command("cat=$to_kb=$p.get_up_rate=,\\ KB\\ ,$to_kb=$p.get_down_rate=,\\ KB"));
+  element->push_column("Total:",     te_command("cat=$to_kb=$p.get_up_total=,\\ KB\\ ,$to_kb=$p.get_down_total=,\\ KB"));
 
   element->set_column_width(element->column_width() + 1);
+  element->set_error_handler(new display::TextElementCString("No peer selected."));
 
   return element;
 }
 
 void
 ElementPeerList::activate(display::Frame* frame, bool focus) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_text.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_text.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/element_text.h	2007-08-28 21:24:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/element_text.h	2007-10-25 18:22:55.000000000 +0800
@@ -34,13 +34,13 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UI_ELEMENT_TEXT_H
 #define RTORRENT_UI_ELEMENT_TEXT_H
 
-#include <sigc++/slot.h>
+#include <sigc++/functors/slot.h>
 
 #include "core/download.h"
 #include "display/text_element_string.h"
 #include "display/window_text.h"
 
 #include "element_base.h"
@@ -92,16 +92,17 @@
                                   text_element_wrapper entry5);
 
   void                push_column(text_element_wrapper entry1, text_element_wrapper entry2,
                                   text_element_wrapper entry3, text_element_wrapper entry4,
                                   text_element_wrapper entry5, text_element_wrapper entry6);
 
-  void                set_column(unsigned int column)     { m_column = column; }
+  void                set_column(unsigned int column)            { m_column = column; }
+  void                set_error_handler(display::TextElement* t) { m_window->set_error_handler(t); }
 
-  extent_type         column_width() const                { return m_columnWidth; }
-  void                set_column_width(extent_type width) { m_columnWidth = width; }
+  extent_type         column_width() const                       { return m_columnWidth; }
+  void                set_column_width(extent_type width)        { m_columnWidth = width; }
 
 private:
   WindowText*         m_window;
 
   unsigned int        m_column;
   extent_type         m_columnWidth;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/root.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/root.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.8/src/ui/root.cc	2007-08-03 03:53:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.7.9/src/ui/root.cc	2007-10-20 01:20:55.000000000 +0800
@@ -35,13 +35,13 @@
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <stdexcept>
 #include <string.h>
-#include <sigc++/bind.h>
+#include <sigc++/adaptors/bind.h>
 #include <torrent/torrent.h>
 
 #include "core/manager.h"
 #include "display/frame.h"
 #include "display/window_http_queue.h"
 #include "display/window_title.h"
