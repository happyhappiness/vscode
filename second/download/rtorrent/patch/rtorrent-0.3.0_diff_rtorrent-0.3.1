diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/config.h.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/config.h.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/config.h.in	2005-07-19 22:25:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/config.h.in	2005-08-05 01:32:03.000000000 +0800
@@ -21,12 +21,15 @@
 /* Define to the version of this package. */
 #undef PACKAGE_VERSION
 
 /* Use execinfo.h */
 #undef USE_EXECINFO
 
+/* defined when we allow the use of fd_set's of any size */
+#undef USE_VARIABLE_FDSET
+
 /* Version number of package */
 #undef VERSION
 
 /* Number of bits in a file offset, on hosts where this is settable. */
 #undef _FILE_OFFSET_BITS
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/configure	2005-07-19 22:16:30.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/configure	2005-08-05 01:32:07.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.57 for rtorrent 0.3.0.
+# Generated by GNU Autoconf 2.57 for rtorrent 0.3.1.
 #
 # Report bugs to <jaris@ifi.uio.no>.
 #
 # Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -265,14 +265,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='rtorrent'
 PACKAGE_TARNAME='rtorrent'
-PACKAGE_VERSION='0.3.0'
-PACKAGE_STRING='rtorrent 0.3.0'
+PACKAGE_VERSION='0.3.1'
+PACKAGE_STRING='rtorrent 0.3.1'
 PACKAGE_BUGREPORT='jaris@ifi.uio.no'
 
 ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO AMTAR install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM AWK SET_MAKE CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CXXDEPMODE RANLIB ac_ct_RANLIB CC CFLAGS ac_ct_CC CCDEPMODE PKG_CONFIG STUFF_CFLAGS STUFF_LIBS LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -742,13 +742,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures rtorrent 0.3.0 to adapt to many kinds of systems.
+\`configure' configures rtorrent 0.3.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -804,25 +804,30 @@
   --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of rtorrent 0.3.0:";;
+     short | recursive ) echo "Configuration of rtorrent 0.3.1:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
   --enable-debug          enable debug information default=yes
   --enable-werror         enable the -Werror flag default=no
   --disable-dependency-tracking Speeds up one-time builds
   --enable-dependency-tracking  Do not reject slow dependency extractors
   --disable-largefile     omit support for large files
 
+Optional Packages:
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --without-variable-fdset       do not use non-portable variable sized fd_set's.
+
 Some influential environment variables:
   CXX         C++ compiler command
   CXXFLAGS    C++ compiler flags
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
               nonstandard directory <lib dir>
   CPPFLAGS    C/C++ preprocessor flags, e.g. -I<include dir> if you have
@@ -893,13 +898,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-rtorrent configure 0.3.0
+rtorrent configure 0.3.1
 generated by GNU Autoconf 2.57
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -908,13 +913,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by rtorrent $as_me 0.3.0, which was
+It was created by rtorrent $as_me 0.3.1, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1499,13 +1504,13 @@
 echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 # Define the identity of the package.
  PACKAGE=rtorrent
- VERSION=0.3.0
+ VERSION=0.3.1
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -1656,26 +1661,52 @@
 
 
 
 
 
 
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
   echo "$as_me:$LINENO: checking for user-defined CXXFLAGS" >&5
 echo $ECHO_N "checking for user-defined CXXFLAGS... $ECHO_C" >&6
 
-  if test !$CXXFLAGS; then
+  if test -n "$CXXFLAGS"; then
+    echo "$as_me:$LINENO: result: user-defined \"$CXXFLAGS\"" >&5
+echo "${ECHO_T}user-defined \"$CXXFLAGS\"" >&6
+  else
     CXXFLAGS="-O3 -Wall"
     echo "$as_me:$LINENO: result: default \"$CXXFLAGS\"" >&5
 echo "${ECHO_T}default \"$CXXFLAGS\"" >&6
-  else
-    echo "$as_me:$LINENO: result: user-defined \"$CXXFLAGS\"" >&5
-echo "${ECHO_T}user-defined \"$CXXFLAGS\"" >&6
   fi
 
 
-
   # Check whether --enable-debug or --disable-debug was given.
 if test "${enable_debug+set}" = set; then
   enableval="$enable_debug"
 
         if test "$enableval" = "yes"; then
             CXXFLAGS="$CXXFLAGS -g -DDEBUG"
@@ -3663,14 +3692,14 @@
 
       if test x$ok != x0; then
         my_cv_curl_vers="$ver"
         echo "$as_me:$LINENO: result: $my_cv_curl_vers" >&5
 echo "${ECHO_T}$my_cv_curl_vers" >&6
 
-	CURL_CFLAGS="`curl-config --cflags`"
-	CURL_LIBS="`curl-config --libs`"
+	CURL_CFLAGS=`curl-config --cflags`
+	CURL_LIBS=`curl-config --libs`
       else
         echo "$as_me:$LINENO: result: FAILED" >&5
 echo "${ECHO_T}FAILED" >&6
         { { echo "$as_me:$LINENO: error: $ver is too old. Need version $check or higher." >&5
 echo "$as_me: error: $ver is too old. Need version $check or higher." >&2;}
    { (exit 1); exit 1; }; }
@@ -3740,12 +3768,37 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
 
 
+
+# Check whether --with-variable-fdset or --without-variable-fdset was given.
+if test "${with_variable_fdset+set}" = set; then
+  withval="$with_variable_fdset"
+
+      if test "$withval" = "yes"; then
+
+cat >>confdefs.h <<\_ACEOF
+#define USE_VARIABLE_FDSET 1
+_ACEOF
+
+      fi
+
+else
+
+
+cat >>confdefs.h <<\_ACEOF
+#define USE_VARIABLE_FDSET 1
+_ACEOF
+
+
+fi;
+
+
+
   succeeded=no
 
   if test -z "$PKG_CONFIG"; then
     # Extract the first word of "pkg-config", so it can be a program name with args.
 set dummy pkg-config; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
@@ -3793,37 +3846,37 @@
      echo "*** in your path, or set the PKG_CONFIG environment variable"
      echo "*** to the full path to pkg-config."
      echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
   else
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo "$as_me:$LINENO: checking for sigc++-2.0 libtorrent >= 0.7.0" >&5
-echo $ECHO_N "checking for sigc++-2.0 libtorrent >= 0.7.0... $ECHO_C" >&6
+        echo "$as_me:$LINENO: checking for sigc++-2.0 libtorrent >= 0.7.1" >&5
+echo $ECHO_N "checking for sigc++-2.0 libtorrent >= 0.7.1... $ECHO_C" >&6
 
-        if $PKG_CONFIG --exists "sigc++-2.0 libtorrent >= 0.7.0" ; then
+        if $PKG_CONFIG --exists "sigc++-2.0 libtorrent >= 0.7.1" ; then
             echo "$as_me:$LINENO: result: yes" >&5
 echo "${ECHO_T}yes" >&6
             succeeded=yes
 
             echo "$as_me:$LINENO: checking STUFF_CFLAGS" >&5
 echo $ECHO_N "checking STUFF_CFLAGS... $ECHO_C" >&6
-            STUFF_CFLAGS=`$PKG_CONFIG --cflags "sigc++-2.0 libtorrent >= 0.7.0"`
+            STUFF_CFLAGS=`$PKG_CONFIG --cflags "sigc++-2.0 libtorrent >= 0.7.1"`
             echo "$as_me:$LINENO: result: $STUFF_CFLAGS" >&5
 echo "${ECHO_T}$STUFF_CFLAGS" >&6
 
             echo "$as_me:$LINENO: checking STUFF_LIBS" >&5
 echo $ECHO_N "checking STUFF_LIBS... $ECHO_C" >&6
-            STUFF_LIBS=`$PKG_CONFIG --libs "sigc++-2.0 libtorrent >= 0.7.0"`
+            STUFF_LIBS=`$PKG_CONFIG --libs "sigc++-2.0 libtorrent >= 0.7.1"`
             echo "$as_me:$LINENO: result: $STUFF_LIBS" >&5
 echo "${ECHO_T}$STUFF_LIBS" >&6
         else
             STUFF_CFLAGS=""
             STUFF_LIBS=""
             ## If we have a custom action on failure, don't print errors, but
             ## do set a variable so people can do so.
-            STUFF_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "sigc++-2.0 libtorrent >= 0.7.0"`
+            STUFF_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "sigc++-2.0 libtorrent >= 0.7.1"`
             echo $STUFF_PKG_ERRORS
         fi
 
 
 
      else
@@ -3833,14 +3886,14 @@
   fi
 
   if test $succeeded = yes; then
      CXXFLAGS="$CXXFLAGS $STUFF_CFLAGS $CURL_CFLAGS";
 		  LIBS="$LIBS $STUFF_LIBS $CURL_LIBS"
   else
-     { { echo "$as_me:$LINENO: error: Library requirements (sigc++-2.0 libtorrent >= 0.7.0) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&5
-echo "$as_me: error: Library requirements (sigc++-2.0 libtorrent >= 0.7.0) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&2;}
+     { { echo "$as_me:$LINENO: error: Library requirements (sigc++-2.0 libtorrent >= 0.7.1) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&5
+echo "$as_me: error: Library requirements (sigc++-2.0 libtorrent >= 0.7.1) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." >&2;}
    { (exit 1); exit 1; }; }
   fi
 
 
 
 cat >>confdefs.h <<\_ACEOF
@@ -4213,13 +4266,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by rtorrent $as_me 0.3.0, which was
+This file was extended by rtorrent $as_me 0.3.1, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -4276,13 +4329,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-rtorrent config.status 0.3.0
+rtorrent config.status 0.3.1
 configured by $0, generated by GNU Autoconf 2.57,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/configure.ac	2005-07-10 02:40:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/configure.ac	2005-08-05 01:29:56.000000000 +0800
@@ -1,7 +1,7 @@
-AC_INIT(rtorrent, 0.3.0, jaris@ifi.uio.no)
+AC_INIT(rtorrent, 0.3.1, jaris@ifi.uio.no)
 
 AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 
 sinclude(scripts/checks.m4)
 sinclude(scripts/common.m4)
@@ -17,13 +17,15 @@
 AC_SEARCH_LIBS(wbkgdset, ncurses curses,,echo "*** The ncurses library is required!";exit 1)
 
 TORRENT_CHECK_EXECINFO()
 TORRENT_CHECK_CURL()
 TORRENT_OTFD()
 
-PKG_CHECK_MODULES(STUFF, sigc++-2.0 libtorrent >= 0.7.0,
+TORRENT_WITHOUT_VARIABLE_FDSET()
+
+PKG_CHECK_MODULES(STUFF, sigc++-2.0 libtorrent >= 0.7.1,
 	          CXXFLAGS="$CXXFLAGS $STUFF_CFLAGS $CURL_CFLAGS";
 		  LIBS="$LIBS $STUFF_LIBS $CURL_LIBS")
 
 AC_DEFINE(HAVE_CONFIG_H, 1, true if config.h was included)
 
 AC_OUTPUT([
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/doc/rtorrent.1 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/doc/rtorrent.1
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/doc/rtorrent.1	2005-07-07 02:54:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/doc/rtorrent.1	2005-08-08 00:31:52.000000000 +0800
@@ -1,12 +1,12 @@
 .\" This manpage has been automatically generated by docbook2man 
 .\" from a DocBook document.  This tool can be found at:
 .\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
 .\" Please send any bug reports, improvements, comments, patches, 
 .\" etc. to Steve Cheng <steve@ggi-project.org>.
-.TH "RTORRENT" "1" "06 July 2005" "BitTorrent client for ncurses" ""
+.TH "RTORRENT" "1" "07 August 2005" "BitTorrent client for ncurses" ""
 
 .SH NAME
 rtorrent \- a BitTorrent client for ncurses
 .SH SYNOPSIS
 
 \fBrtorrent\fR [ \fB-h\fR ] [ \fB-o key1=opt1,...\fR ] [ \fBURL | FILE\fR\fI ...\fR ]
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/rak/functional.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/rak/functional.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/rak/functional.h	2005-07-10 02:40:00.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/rak/functional.h	2005-08-05 01:29:56.000000000 +0800
@@ -69,12 +69,14 @@
 }
 
 // Operators:
 
 template <typename Type, typename Ftor>
 struct _equal {
+  typedef bool result_type;
+
   _equal(Type t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
   bool operator () (Arg& a) {
     return m_t == m_f(a);
   }
@@ -88,12 +90,14 @@
 equal(Type t, Ftor f) {
   return _equal<Type, Ftor>(t, f);
 }
 
 template <typename Type, typename Ftor>
 struct _less {
+  typedef bool result_type;
+
   _less(Type t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
   bool operator () (Arg& a) {
     return m_t < m_f(a);
   }
@@ -107,12 +111,14 @@
 less(Type t, Ftor f) {
   return _less<Type, Ftor>(t, f);
 }
 
 template <typename Type, typename Ftor>
 struct _greater {
+  typedef bool result_type;
+
   _greater(Type t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
   bool operator () (Arg& a) {
     return m_t > m_f(a);
   }
@@ -126,12 +132,14 @@
 greater(Type t, Ftor f) {
   return _greater<Type, Ftor>(t, f);
 }
 
 template <typename Type, typename Ftor>
 struct _less_equal {
+  typedef bool result_type;
+
   _less_equal(Type t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
   bool operator () (Arg& a) {
     return m_t <= m_f(a);
   }
@@ -145,12 +153,14 @@
 less_equal(Type t, Ftor f) {
   return _less_equal<Type, Ftor>(t, f);
 }
 
 template <typename Type, typename Ftor>
 struct _greater_equal {
+  typedef bool result_type;
+
   _greater_equal(Type t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
   bool operator () (Arg& a) {
     return m_t >= m_f(a);
   }
@@ -163,16 +173,18 @@
 inline _greater_equal<Type, Ftor>
 greater_equal(Type t, Ftor f) {
   return _greater_equal<Type, Ftor>(t, f);
 }
 
 template <typename Src, typename Dest>
-struct _on : public std::unary_function<typename Src::argument_type, typename Dest::result_type>  {
+struct _on : public std::unary_function<typename Src::argument_type, typename Dest::result_type> {
+  typedef typename Dest::result_type result_type;
+
   _on(Src s, Dest d) : m_dest(d), m_src(s) {}
 
-  typename Dest::result_type operator () (typename reference_fix<typename Src::argument_type>::type arg) {
+  result_type operator () (typename reference_fix<typename Src::argument_type>::type arg) {
     return m_dest(m_src(arg));
   }
 
   Dest m_dest;
   Src m_src;
 };
@@ -257,9 +269,35 @@
 template <typename Operation, typename Type>
 inline bind1st_t<Operation>
 bind1st(const Operation& op, const Type& val) {
   return bind1st_t<Operation>(op, val);
 }
 
+template <typename Operation>
+class bind2nd_t : public std::unary_function<typename Operation::first_argument_type,
+					     typename Operation::result_type> {
+protected:
+  typedef typename reference_fix<typename Operation::first_argument_type>::type argument_type;
+  typedef typename reference_fix<typename Operation::second_argument_type>::type value_type;
+
+  Operation  m_op;
+  value_type m_value;
+
+public:
+  bind2nd_t(const Operation& op, const value_type v) :
+    m_op(op), m_value(v) {}
+
+  typename Operation::result_type
+  operator () (const argument_type arg) {
+    return m_op(arg, m_value);
+  }
+};	    
+
+template <typename Operation, typename Type>
+inline bind2nd_t<Operation>
+bind2nd(const Operation& op, const Type& val) {
+  return bind2nd_t<Operation>(op, val);
+}
+
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/scripts/checks.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/scripts/checks.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/scripts/checks.m4	2005-06-29 04:50:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/scripts/checks.m4	2005-08-05 01:29:49.000000000 +0800
@@ -15,14 +15,14 @@
       ok=`echo "ibase=16; if($hex_ver>=$check_hex) $hex_ver else 0" | bc`
  
       if test x$ok != x0; then
         my_cv_curl_vers="$ver"
         AC_MSG_RESULT([$my_cv_curl_vers])
 
-	CURL_CFLAGS="`curl-config --cflags`"
-	CURL_LIBS="`curl-config --libs`"
+	CURL_CFLAGS=`curl-config --cflags`
+	CURL_LIBS=`curl-config --libs`
       else
         AC_MSG_RESULT(FAILED)
         AC_MSG_ERROR([$ver is too old. Need version $check or higher.])
       fi
     else
       AC_MSG_RESULT(FAILED)
@@ -33,19 +33,19 @@
 
 
 AC_DEFUN([TORRENT_CHECK_OPENSSL], [
   # first, deal with the user option : set places to be 'search' or the prefix
   AC_ARG_WITH(openssl,
     [  --with-openssl=PATH     Find the OpenSSL header and library in
-                      `PATH/include' and `PATH/lib'. If PATH is of the
-                      form `HEADER:LIB', then search for header files in
-                      HEADER, and the library in LIB.  If you omit the
-                      option completely, the configure script will
-                      search for OpenSSL in a number of standard
-                      places.
-    ], [
+                          `PATH/include' and `PATH/lib'. If PATH is of the
+                          form `HEADER:LIB', then search for header files in
+                          HEADER, and the library in LIB.  If you omit the
+                          option completely, the configure script will
+                          search for OpenSSL in a number of standard
+                          places.],
+    [
       if test "$withval" = "yes"; then
 	PKG_CHECK_MODULES(OPENSSL, openssl,
 	                  CXXFLAGS="$CXXFLAGS `pkg-config --cflags openssl`";
                           LIBS="$LIBS -lcrypto `pkg-config --libs-only-L openssl`",
 		          AC_MSG_ERROR(Could not find openssl's crypto library, try --with-openssl=PATH))
 
@@ -57,6 +57,127 @@
       PKG_CHECK_MODULES(OPENSSL, openssl,
       CXXFLAGS="$CXXFLAGS `pkg-config --cflags openssl`";
       LIBS="$LIBS -lcrypto `pkg-config --libs-only-L openssl`",
       AC_MSG_ERROR(Could not find openssl's crypto library, try --with-openssl=PATH))
     ])
 ])
+
+
+AC_DEFUN([TORRENT_CHECK_XFS], [
+  AC_MSG_CHECKING(for XFS support)
+
+  AC_COMPILE_IFELSE(
+    [[#include <xfs/libxfs.h>
+      #include <sys/ioctl.h>
+      int main() {
+        struct xfs_flock64 l;
+        ioctl(0, XFS_IOC_RESVSP64, &l);
+        return 0;
+      }
+    ]],
+    [
+      AC_DEFINE(USE_XFS, 1, Use XFS filesystem stuff.)
+      AC_MSG_RESULT(yes)
+    ], [
+      AC_MSG_RESULT(no)
+    ])
+])
+
+
+AC_DEFUN([TORRENT_WITHOUT_XFS], [
+  AC_ARG_WITH(xfs,
+    [  --without-xfs           Do not check for XFS filesystem support],
+    [
+      if test "$withval" = "yes"; then
+        TORRENT_CHECK_XFS
+      fi
+    ], [
+        TORRENT_CHECK_XFS
+    ])
+])
+
+
+AC_DEFUN([TORRENT_WITH_XFS], [
+  AC_ARG_WITH(xfs,
+    [  --with-xfs           Check for XFS filesystem support],
+    [
+      if test "$withval" = "yes"; then
+        TORRENT_CHECK_XFS
+      fi
+    ])
+])
+
+
+AC_DEFUN([TORRENT_CHECK_EPOLL], [
+  AC_MSG_CHECKING(for epoll support)
+
+  AC_COMPILE_IFELSE(
+    [[#include <sys/epoll.h>
+      int main() {
+        int fd = epoll_create(100);
+        return 0;
+      }
+    ]],
+    [
+      AC_DEFINE(USE_EPOLL, 1, Use epoll.)
+      AC_MSG_RESULT(yes)
+    ], [
+      AC_MSG_RESULT(no)
+    ])
+])
+
+
+AC_DEFUN([TORRENT_WITHOUT_EPOLL], [
+  AC_ARG_WITH(epoll,
+    [  --without-epoll         Do not check for epoll support.],
+    [
+      if test "$withval" = "yes"; then
+        TORRENT_CHECK_EPOLL
+      fi
+    ], [
+        TORRENT_CHECK_EPOLL
+    ])
+])
+
+
+AC_DEFUN([TORRENT_WITHOUT_VARIABLE_FDSET], [
+  AC_ARG_WITH(variable-fdset,
+
+    [  --without-variable-fdset       do not use non-portable variable sized fd_set's.],
+    [
+      if test "$withval" = "yes"; then
+        AC_DEFINE(USE_VARIABLE_FDSET, 1, defined when we allow the use of fd_set's of any size)
+      fi
+    ], [
+      AC_DEFINE(USE_VARIABLE_FDSET, 1, defined when we allow the use of fd_set's of any size)
+    ])
+])
+
+
+AC_DEFUN([TORRENT_CHECK_POSIX_FALLOCATE], [
+  AC_MSG_CHECKING(for posix_fallocate)
+
+  AC_COMPILE_IFELSE(
+    [[#include <fcntl.h>
+      int main() {
+	posix_fallocate(0, 0, 0);
+        return 0;
+      }
+    ]],
+    [
+      AC_DEFINE(USE_POSIX_FALLOCATE, 1, posix_fallocate supported.)
+      AC_MSG_RESULT(yes)
+    ], [
+      AC_MSG_RESULT(no)
+    ])
+])
+
+
+AC_DEFUN([TORRENT_WITH_POSIX_FALLOCATE], [
+  AC_ARG_WITH(posix-fallocate,
+    [  --with-fallocate        Check for posix_fallocate],
+    [
+      if test "$withval" = "no"; then
+        TORRENT_CHECK_POSIX_FALLOCATE
+      fi
+    ])
+])
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/scripts/common.m4 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/scripts/common.m4
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/scripts/common.m4	2005-06-29 04:50:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/scripts/common.m4	2005-08-05 01:29:49.000000000 +0800
@@ -1,21 +1,20 @@
 AC_DEFUN([TORRENT_CHECK_CXXFLAGS], [
 
   AC_MSG_CHECKING([for user-defined CXXFLAGS])
 
-  if test !$CXXFLAGS; then
+  if test -n "$CXXFLAGS"; then
+    AC_MSG_RESULT([user-defined "$CXXFLAGS"])
+  else
     CXXFLAGS="-O3 -Wall"
     AC_MSG_RESULT([default "$CXXFLAGS"])
-  else
-    AC_MSG_RESULT([user-defined "$CXXFLAGS"])
   fi
 ])
 
 
 AC_DEFUN([TORRENT_ENABLE_DEBUG], [
-
   AC_ARG_ENABLE(debug,
     [  --enable-debug          enable debug information [default=yes]],
     [
         if test "$enableval" = "yes"; then
             CXXFLAGS="$CXXFLAGS -g -DDEBUG"
         else
@@ -36,14 +34,29 @@
             CXXFLAGS="$CXXFLAGS -Werror"
         fi
   ])
 ])
 
 
-AC_DEFUN([TORRENT_OTFD], [
+AC_DEFUN([TORRENT_ENABLE_UNSAFE_OPTIMIZATION], [
+  AC_ARG_ENABLE(unsafe-optimization,
+    [  --enable-unsafe-optimization
+                          enable unsafe optimization [default=yes]],
+    [
+        if test "$enableval" = "yes"; then
+            AC_DEFINE(USE_UNSAFE_OPTIMIZATION, 1, Enable possibly unsafe optimization techniques.)
+	else
+            AC_DEFINE(USE_UNSAFE_OPTIMIZATION, 0, Disable possibly unsafe optimization techniques.)
+        fi
+    ],[
+      AC_DEFINE(USE_UNSAFE_OPTIMIZATION, 0, Disable possibly unsafe optimization techniques.)
+  ])
+])
 
+
+AC_DEFUN([TORRENT_OTFD], [
   AC_LANG_PUSH(C++)
   AC_MSG_CHECKING(for proper overloaded template function disambiguation)
 
   AC_COMPILE_IFELSE(
     [[template <typename T> void f(T&) {}
       template <typename T> void f(T*) {}
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_get.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_get.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_get.cc	2005-07-02 04:45:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_get.cc	2005-08-08 06:26:18.000000000 +0800
@@ -74,13 +74,16 @@
   m_handle = curl_easy_init();
 
   curl_easy_setopt(m_handle, CURLOPT_URL,           m_url.c_str());
   curl_easy_setopt(m_handle, CURLOPT_USERAGENT,     m_userAgent.c_str());
   curl_easy_setopt(m_handle, CURLOPT_WRITEFUNCTION, &curl_get_receive_write);
   curl_easy_setopt(m_handle, CURLOPT_WRITEDATA,     this);
-  curl_easy_setopt(m_handle, CURLOPT_FORBID_REUSE,  1);
+
+  curl_easy_setopt(m_handle, CURLOPT_FORBID_REUSE,   1);
+  curl_easy_setopt(m_handle, CURLOPT_FOLLOWLOCATION, 1);
+  curl_easy_setopt(m_handle, CURLOPT_MAXREDIRS,      5);
 
   m_stack->add_get(this);
 }
 
 void
 CurlGet::close() {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_stack.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_stack.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_stack.cc	2005-07-02 04:45:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_stack.cc	2005-08-05 01:29:52.000000000 +0800
@@ -34,13 +34,15 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
 #include <algorithm>
+#include <stdexcept>
 #include <curl/multi.h>
+#include <sigc++/bind.h>
 #include <torrent/exceptions.h>
 
 #include "rak/functional.h"
 #include "curl_get.h"
 #include "curl_stack.h"
 
@@ -86,16 +88,20 @@
       } while (t);
     }
 
   } while (code == CURLM_CALL_MULTI_PERFORM);
 }
 
-void
-CurlStack::fdset(fd_set* readfds, fd_set* writefds, fd_set* exceptfds, int* maxFd) {
-  if (curl_multi_fdset((CURLM*)m_handle, readfds, writefds, exceptfds, maxFd) > 0)
-    throw torrent::local_error("Error calling curl_multi_fdset");
+unsigned int
+CurlStack::fdset(fd_set* readfds, fd_set* writefds, fd_set* exceptfds) {
+  int maxFd = 0;
+
+  if (curl_multi_fdset((CURLM*)m_handle, readfds, writefds, exceptfds, &maxFd) != 0)
+    throw std::runtime_error("Error calling curl_multi_fdset");
+
+  return std::max(maxFd, 0);
 }
 
 void
 CurlStack::add_get(CurlGet* get) {
   CURLMcode code;
 
@@ -118,16 +124,21 @@
 
   m_size--;
   m_getList.erase(itr);
 }
 
 void
-CurlStack::init() {
+CurlStack::global_init() {
   curl_global_init(CURL_GLOBAL_ALL);
 }
 
 void
-CurlStack::cleanup() {
+CurlStack::global_cleanup() {
   curl_global_cleanup();
 }
 
+CurlStack::SlotFactory
+CurlStack::get_http_factory() {
+  return sigc::bind(sigc::ptr_fun(&CurlGet::new_object), this);
+}
+
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_stack.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_stack.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/curl_stack.h	2005-07-02 04:45:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/curl_stack.h	2005-08-05 01:29:51.000000000 +0800
@@ -35,48 +35,52 @@
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_CORE_CURL_STACK_H
 #define RTORRENT_CORE_CURL_STACK_H
 
 #include <list>
+#include <sigc++/slot.h>
 
 namespace core {
 
 class CurlGet;
 
 class CurlStack {
  public:
   friend class CurlGet;
 
-  typedef std::list<CurlGet*> CurlGetList;
+  typedef std::list<CurlGet*>   CurlGetList;
+  typedef sigc::slot0<CurlGet*> SlotFactory;
 
   CurlStack();
   ~CurlStack();
 
-  int         get_size() const { return m_size; }
-  bool        is_busy() const  { return !m_getList.empty(); }
+  int                 get_size() const { return m_size; }
+  bool                is_busy() const  { return !m_getList.empty(); }
 
-  void        perform();
+  void                perform();
 
   // TODO: Set fd_set's only once?
-  void        fdset(fd_set* readfds, fd_set* writefds, fd_set* exceptfds, int* maxFd);
+  unsigned int        fdset(fd_set* readfds, fd_set* writefds, fd_set* exceptfds);
 
-  static void init();
-  static void cleanup();
+  SlotFactory         get_http_factory();
+
+  static void         global_init();
+  static void         global_cleanup();
 
  protected:
-  void        add_get(CurlGet* get);
-  void        remove_get(CurlGet* get);
+  void                add_get(CurlGet* get);
+  void                remove_get(CurlGet* get);
 
  private:
   CurlStack(const CurlStack&);
   void operator = (const CurlStack&);
 
-  void*       m_handle;
+  void*               m_handle;
 
-  int         m_size;
-  CurlGetList m_getList;
+  int                 m_size;
+  CurlGetList         m_getList;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/Makefile.am	2005-07-10 02:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/Makefile.am	2005-08-05 01:29:52.000000000 +0800
@@ -19,11 +19,14 @@
 	http_queue.cc \
 	http_queue.h \
 	log.cc \
 	log.h \
 	manager.cc \
 	manager.h \
-	poll.cc \
-	poll.h
-
+	poll_manager.cc \
+	poll_manager.h \
+	poll_manager_epoll.cc \
+	poll_manager_epoll.h \
+	poll_manager_select.cc \
+	poll_manager_select.h
 
 INCLUDES = -I$(srcdir) -I$(srcdir)/.. -I$(top_srcdir)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/Makefile.in	2005-07-19 22:16:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/Makefile.in	2005-08-05 01:32:06.000000000 +0800
@@ -97,14 +97,18 @@
 	http_queue.cc \
 	http_queue.h \
 	log.cc \
 	log.h \
 	manager.cc \
 	manager.h \
-	poll.cc \
-	poll.h
+	poll_manager.cc \
+	poll_manager.h \
+	poll_manager_epoll.cc \
+	poll_manager_epoll.h \
+	poll_manager_select.cc \
+	poll_manager_select.h
 
 
 INCLUDES = -I$(srcdir) -I$(srcdir)/.. -I$(top_srcdir)
 subdir = src/core
 mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
@@ -114,13 +118,14 @@
 libsub_core_a_AR = $(AR) cru
 libsub_core_a_LIBADD =
 am_libsub_core_a_OBJECTS = curl_get.$(OBJEXT) curl_stack.$(OBJEXT) \
 	download.$(OBJEXT) download_factory.$(OBJEXT) \
 	download_list.$(OBJEXT) download_store.$(OBJEXT) \
 	hash_queue.$(OBJEXT) http_queue.$(OBJEXT) log.$(OBJEXT) \
-	manager.$(OBJEXT) poll.$(OBJEXT)
+	manager.$(OBJEXT) poll_manager.$(OBJEXT) \
+	poll_manager_epoll.$(OBJEXT) poll_manager_select.$(OBJEXT)
 libsub_core_a_OBJECTS = $(am_libsub_core_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -131,13 +136,15 @@
 @AMDEP_TRUE@	./$(DEPDIR)/curl_stack.Po ./$(DEPDIR)/download.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/download_factory.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/download_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/download_store.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/hash_queue.Po ./$(DEPDIR)/http_queue.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/log.Po ./$(DEPDIR)/manager.Po \
-@AMDEP_TRUE@	./$(DEPDIR)/poll.Po
+@AMDEP_TRUE@	./$(DEPDIR)/poll_manager.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/poll_manager_epoll.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/poll_manager_select.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
 CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
 CXXFLAGS = @CXXFLAGS@
@@ -182,13 +189,15 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download_store.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/hash_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/http_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/log.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/manager.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poll.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poll_manager.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poll_manager_epoll.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poll_manager_select.Po@am__quote@
 
 distclean-depend:
 	-rm -rf ./$(DEPDIR)
 
 .cc.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/manager.cc	2005-07-19 03:10:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/manager.cc	2005-08-13 01:09:57.000000000 +0800
@@ -45,15 +45,17 @@
 #include <sys/select.h>
 #include <sigc++/bind.h>
 #include <sigc++/hide.h>
 #include <torrent/bencode.h>
 #include <torrent/exceptions.h>
 
+#include "curl_get.h"
 #include "download.h"
 #include "manager.h"
-#include "curl_get.h"
+#include "poll_manager_epoll.h"
+#include "poll_manager_select.h"
 
 namespace core {
 
 static void
 connect_signal_network_log(Download* d, torrent::Download::SlotString s) {
   d->get_download().signal_network_log(s);
@@ -61,29 +63,40 @@
 
 static void
 connect_signal_tracker_log(Download* d, torrent::Download::SlotString s) {
   d->get_download().signal_tracker_failed(s);
 }
 
+Manager::Manager() :
+  m_pollManager(NULL),
+  m_portRandom(false),
+  m_portFirst(6890),
+  m_portLast(6999),
+  m_checkHash(true) {
+}
+
 void
-Manager::initialize() {
-  torrent::Http::set_factory(m_poll.get_http_factory());
-  m_httpQueue.slot_factory(m_poll.get_http_factory());
+Manager::initialize_first() {
+  if ((m_pollManager = PollManagerEPoll::create(sysconf(_SC_OPEN_MAX))) != NULL)
+    m_logImportant.push_front("Using 'epoll' based polling");
+  else if ((m_pollManager = PollManagerSelect::create(sysconf(_SC_OPEN_MAX))) != NULL)
+    m_logImportant.push_front("Using 'select' based polling");
+  else
+    throw std::runtime_error("Could not create any PollManager");
 
-  CurlStack::init();
-  listen_open();
+  // Need to initialize this before parseing options.
+  torrent::initialize(m_pollManager->get_torrent_poll());
+}
 
-  if (torrent::get_max_open_files() + torrent::get_max_open_sockets() + 32 > FD_SETSIZE) {
-    m_logImportant.push_front("Warning: Max open sockets and files exceeds FD_SETSIZE");
-    m_logComplete.push_front("Warning: Max open sockets and files exceeds FD_SETSIZE");
-  }    
-
-  if (torrent::get_max_open_files() + torrent::get_max_open_sockets() + 32 > (unsigned int)sysconf(_SC_OPEN_MAX)) {
-    m_logImportant.push_front("Warning: Max open sockets and files exceeds _SC_OPEN_MAX");
-    m_logComplete.push_front("Warning: Max open sockets and files exceeds _SC_OPEN_MAX");
-  }
+void
+Manager::initialize_second() {
+  torrent::Http::set_factory(m_pollManager->get_http_stack()->get_http_factory());
+  m_httpQueue.slot_factory(m_pollManager->get_http_stack()->get_http_factory());
+
+  CurlStack::global_init();
+  listen_open();
 
   // Register slots to be called when a download is inserted/erased,
   // opened or closed.
   m_downloadList.slot_map_insert()["0_initialize_bencode"]  = sigc::mem_fun(*this, &Manager::initialize_bencode);
   m_downloadList.slot_map_insert()["1_connect_network_log"] = sigc::bind(sigc::ptr_fun(&connect_signal_network_log), sigc::mem_fun(m_logComplete, &Log::push_front));
   m_downloadList.slot_map_insert()["1_connect_tracker_log"] = sigc::bind(sigc::ptr_fun(&connect_signal_tracker_log), sigc::mem_fun(m_logComplete, &Log::push_front));
@@ -112,13 +125,15 @@
 void
 Manager::cleanup() {
   // Need to disconnect log signals? Not really since we won't receive
   // any more.
 
   torrent::cleanup();
-  CurlStack::cleanup();
+  CurlStack::global_cleanup();
+
+  delete m_pollManager;
 }
 
 void
 Manager::shutdown(bool force) {
   if (!force)
     std::for_each(m_downloadList.begin(), m_downloadList.end(),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core/manager.h	2005-07-14 04:26:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core/manager.h	2005-08-05 01:29:52.000000000 +0800
@@ -40,13 +40,13 @@
 #include <iosfwd>
 
 #include "download_list.h"
 #include "download_store.h"
 #include "hash_queue.h"
 #include "http_queue.h"
-#include "poll.h"
+#include "poll_manager.h"
 #include "log.h"
 
 namespace torrent {
   class Bencode;
 }
 
@@ -55,29 +55,31 @@
 class Manager {
 public:
   typedef DownloadList::iterator                    DListItr;
   typedef sigc::slot1<void, DownloadList::iterator> SlotReady;
   typedef sigc::slot0<void>                         SlotFailed;
 
-  Manager() : m_portRandom(false), m_portFirst(6890), m_portLast(6999), m_checkHash(true) {}
+  Manager();
 
   DownloadList&       get_download_list()                 { return m_downloadList; }
   DownloadStore&      get_download_store()                { return m_downloadStore; }
   HashQueue&          get_hash_queue()                    { return m_hashQueue; }
   HttpQueue&          get_http_queue()                    { return m_httpQueue; }
 
-  Poll&               get_poll()                          { return m_poll; }
+  PollManager*        get_poll_manager()                  { return m_pollManager; }
   Log&                get_log_important()                 { return m_logImportant; }
   Log&                get_log_complete()                  { return m_logComplete; }
 
   void                set_port_random(bool v)             { m_portRandom = v; }
   void                set_port_range(int a, int b)        { m_portFirst = a; m_portLast = b; }
 
   void                set_check_hash(bool state)          { m_checkHash = state; }
 
-  void                initialize();
+  // Really should find a more descriptive name.
+  void                initialize_first();
+  void                initialize_second();
   void                cleanup();
 
   void                shutdown(bool force);
 
   DListItr            insert(std::istream* s);
   DListItr            erase(DListItr itr);
@@ -104,13 +106,13 @@
 
   DownloadList        m_downloadList;
   DownloadStore       m_downloadStore;
   HashQueue           m_hashQueue;
   HttpQueue           m_httpQueue;
 
-  Poll                m_poll;
+  PollManager*        m_pollManager;
   Log                 m_logImportant;
   Log                 m_logComplete;
 
   bool                m_portRandom;
   int                 m_portFirst;
   int                 m_portLast;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core: poll.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/core: poll.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager_epoll.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager_epoll.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager_select.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/core: poll_manager_select.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/utils.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/utils.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/utils.cc	2005-07-13 20:04:47.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/utils.cc	2005-08-13 01:09:58.000000000 +0800
@@ -36,12 +36,13 @@
 
 #include "config.h"
 
 #include <sstream>
 #include <iomanip>
 #include <torrent/rate.h>
+#include <torrent/tracker.h>
 
 #include "core/download.h"
 #include "utils/timer.h"
 
 #include "utils.h"
 
@@ -66,27 +67,31 @@
 				(double)d->get_download().get_bytes_total() / (double)(1 << 20)));
   else
     buf += std::max(0, snprintf(buf, last - buf, "%6.1f / %6.1f MB",
 				(double)d->get_download().get_bytes_done() / (double)(1 << 20),
 				(double)d->get_download().get_bytes_total() / (double)(1 << 20)));
   
-  buf += std::max(0, snprintf(buf, last - buf, " Rate: %5.1f / %5.1f KiB Uploaded: %.1f MiB",
+  buf += std::max(0, snprintf(buf, last - buf, " Rate: %5.1f / %5.1f KB Uploaded: %.1f MB",
 			      (double)d->get_download().get_write_rate().rate() / (1 << 10),
 			      (double)d->get_download().get_read_rate().rate() / (1 << 10),
 			      (double)d->get_download().get_write_rate().total() / (1 << 20)));
 
   return buf;
 }
 
 char*
 print_download_status(char* buf, unsigned int length, core::Download* d) {
   if (d->get_download().is_hash_checking())
     buf += std::max(0, snprintf(buf, length, "Checking hash"));
 
-  else if (d->get_download().is_tracker_busy())
-    buf += std::max(0, snprintf(buf, length, "Tracker: Connecting"));
+  else if (d->get_download().is_tracker_busy() &&
+	   d->get_download().get_tracker_focus() < d->get_download().get_tracker_size())
+    buf += std::max(0, snprintf(buf, length, "Tracker[%i:%i]: Connecting to %s",
+				d->get_download().get_tracker(d->get_download().get_tracker_focus()).get_group(),
+				d->get_download().get_tracker_focus(),
+				d->get_download().get_tracker(d->get_download().get_tracker_focus()).get_url().c_str()));
 
   else if (!d->get_download().is_active())
     buf += std::max(0, snprintf(buf, length, "Inactive"));
 
   else if (!d->get_message().empty())
     buf += std::max(0, snprintf(buf, length, "%s", d->get_message().c_str()));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_peer_info.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_peer_info.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_peer_info.cc	2005-07-10 02:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_peer_info.cc	2005-08-05 01:29:54.000000000 +0800
@@ -81,13 +81,15 @@
   }
 
   m_canvas->print(0, y++, "*** Peer Info ***");
 
   m_canvas->print(0, y++, "DNS: %s:%hu", (*m_focus)->get_dns().c_str(), (*m_focus)->get_port());
   m_canvas->print(0, y++, "Id: %s" , utils::escape_string((*m_focus)->get_id()).c_str());
-  m_canvas->print(0, y++, "Snubbed: %s", (*m_focus)->get_snubbed() ? "Yes" : "No");
+  m_canvas->print(0, y++, "Options: %s" , utils::string_to_hex(std::string((*m_focus)->get_options(), 8)).c_str());
+  m_canvas->print(0, y++, "Snubbed: %s", (*m_focus)->get_snubbed() ? "yes" : "no");
+  m_canvas->print(0, y++, "Connected: %s", (*m_focus)->is_incoming() ? "remote" : "local");
 
   m_canvas->print(0, y++, "Done: %i%", done_percentage(**m_focus));
 
   m_canvas->print(0, y++, "Rate: %5.1f/%5.1f KB Total: %.1f/%.1f MB",
 		  (double)(*m_focus)->get_write_rate().rate() / (double)(1 << 10),
 		  (double)(*m_focus)->get_read_rate().rate() / (double)(1 << 10),
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_peer_list.cc	2005-07-10 02:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_peer_list.cc	2005-08-05 01:29:54.000000000 +0800
@@ -59,20 +59,20 @@
   utils::displayScheduler.insert(&m_taskUpdate, utils::Timer::cache().round_seconds() + 1000000);
   m_canvas->erase();
 
   int x = 2;
   int y = 0;
 
-  m_canvas->print(x, y, "DNS");   x += 16;
-  m_canvas->print(x, y, "UP");    x += 7;
-  m_canvas->print(x, y, "DOWN");  x += 7;
-  m_canvas->print(x, y, "PEER");  x += 7;
-  m_canvas->print(x, y, "RE/LO"); x += 7;
-  m_canvas->print(x, y, "QS");    x += 6;
-  m_canvas->print(x, y, "DONE");  x += 6;
-  m_canvas->print(x, y, "REQ");   x += 6;
+  m_canvas->print(x, y, "DNS");     x += 16;
+  m_canvas->print(x, y, "UP");      x += 7;
+  m_canvas->print(x, y, "DOWN");    x += 7;
+  m_canvas->print(x, y, "PEER");    x += 7;
+  m_canvas->print(x, y, "C/RE/LO"); x += 9;
+  m_canvas->print(x, y, "QS");      x += 6;
+  m_canvas->print(x, y, "DONE");    x += 6;
+  m_canvas->print(x, y, "REQ");     x += 6;
   m_canvas->print(x, y, "SNUB");
 
   ++y;
 
   if (m_list->empty())
     return;
@@ -98,18 +98,19 @@
     x += 18;
 
     m_canvas->print(x, y, "%.1f", (double)p.get_write_rate().rate() / 1024); x += 7;
     m_canvas->print(x, y, "%.1f", (double)p.get_read_rate().rate() / 1024); x += 7;
     m_canvas->print(x, y, "%.1f", (double)p.get_peer_rate().rate() / 1024); x += 7;
 
-    m_canvas->print(x, y, "%c%c/%c%c",
+    m_canvas->print(x, y, "%c/%c%c/%c%c",
+		    p.is_incoming() ? 'r' : 'l',
 		    p.get_remote_choked() ? 'c' : 'u',
 		    p.get_remote_interested() ? 'i' : 'n',
 		    p.get_local_choked() ? 'c' : 'u',
 		    p.get_local_interested() ? 'i' : 'n');
-    x += 7;
+    x += 9;
 
     m_canvas->print(x, y, "%i/%i",
 		    p.get_outgoing_queue_size(),
 		    p.get_incoming_queue_size());
     x += 6;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_statusbar.cc	2005-07-19 03:10:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_statusbar.cc	2005-08-13 01:09:58.000000000 +0800
@@ -69,23 +69,25 @@
 
   if (torrent::get_read_throttle() == 0)
     pos = snprintf(buf + pos, 128 - pos, "off");
   else
     pos = snprintf(buf + pos, 128 - pos, "%-3i", torrent::get_read_throttle() / 1024);
 
-  m_canvas->print(0, 0, "Throttle U/D: %s  Rate: %5.1f / %5.1f KiB  Listen: %s:%i%s",
+  m_canvas->print(0, 0, "Throttle U/D: %s  Rate: %5.1f / %5.1f KB  Listen: %s:%i%s",
 		  buf,
 		  (double)torrent::get_write_rate().rate() / 1024.0,
 		  (double)torrent::get_read_rate().rate() / 1024.0,
-		  !torrent::get_address().empty() ? torrent::get_address().c_str() : "<default>",
+		  !torrent::get_local_address().empty() ? torrent::get_local_address().c_str() : "<default>",
 		  (int)torrent::get_listen_port(),
 		  !torrent::get_bind_address().empty() ? ("  Bind: " + torrent::get_bind_address()).c_str() : "");
 
-  pos = snprintf(buf, 128, "[%3i/%3i/%3i]",
+  pos = snprintf(buf, 128, "[S %i/%i/%i] [F %i/%i]",
 		 torrent::get_total_handshakes(),
 		 torrent::get_open_sockets(),
-		 torrent::get_max_open_sockets());
+		 torrent::get_max_open_sockets(),
+		 torrent::get_open_files(),
+		 torrent::get_max_open_files());
 
   m_canvas->print(m_canvas->get_width() - pos, 0, "%s", buf);
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_tracker_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_tracker_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/display/window_tracker_list.cc	2005-07-19 03:10:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/display/window_tracker_list.cc	2005-08-05 01:29:54.000000000 +0800
@@ -81,18 +81,19 @@
     torrent::Tracker t = m_download->get_download().get_tracker(range.first);
 
     m_canvas->print(0, pos++, "%c %s",
 		    range.first == *m_focus ? '*' : ' ',
 		    t.get_url().c_str());
 
-    m_canvas->print(0, pos++, "%c Group: %2i Id: %s Enabled: %s Open: %s",
+    m_canvas->print(0, pos++, "%c Group: %2i Id: %s Focus: %s Enabled: %s Open: %s",
 		    range.first == *m_focus ? '*' : ' ',
 		    t.get_group(),
 		    utils::escape_string(t.get_tracker_id()).c_str(),
-		    t.is_enabled() ? "yes" : "no",
-		    t.is_open() ? "yes" : "no");
+		    range.first == m_download->get_download().get_tracker_focus() ? "yes" : " no",
+		    t.is_enabled() ? "yes" : " no",
+		    t.is_open() ? "yes" : " no");
 
     ++range.first;
   }
 }
 
 }
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input: input_event.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input: input_event.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/Makefile.am	2005-06-29 04:50:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/Makefile.am	2005-08-05 01:29:52.000000000 +0800
@@ -1,11 +1,13 @@
 noinst_LIBRARIES = libsub_input.a
 
 libsub_input_a_SOURCES = \
 	bindings.cc \
 	bindings.h \
+	input_event.cc \
+	input_event.h \
 	manager.cc \
 	manager.h \
 	path_input.cc \
 	path_input.h \
 	text_input.cc \
 	text_input.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/Makefile.in	2005-07-19 22:16:29.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/Makefile.in	2005-08-05 01:32:06.000000000 +0800
@@ -78,12 +78,14 @@
 install_sh = @install_sh@
 noinst_LIBRARIES = libsub_input.a
 
 libsub_input_a_SOURCES = \
 	bindings.cc \
 	bindings.h \
+	input_event.cc \
+	input_event.h \
 	manager.cc \
 	manager.h \
 	path_input.cc \
 	path_input.h \
 	text_input.cc \
 	text_input.h
@@ -95,24 +97,25 @@
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 LIBRARIES = $(noinst_LIBRARIES)
 
 libsub_input_a_AR = $(AR) cru
 libsub_input_a_LIBADD =
-am_libsub_input_a_OBJECTS = bindings.$(OBJEXT) manager.$(OBJEXT) \
-	path_input.$(OBJEXT) text_input.$(OBJEXT)
+am_libsub_input_a_OBJECTS = bindings.$(OBJEXT) input_event.$(OBJEXT) \
+	manager.$(OBJEXT) path_input.$(OBJEXT) text_input.$(OBJEXT)
 libsub_input_a_OBJECTS = $(am_libsub_input_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
-@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/bindings.Po ./$(DEPDIR)/manager.Po \
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/bindings.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/input_event.Po ./$(DEPDIR)/manager.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/path_input.Po ./$(DEPDIR)/text_input.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
 CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
@@ -149,12 +152,13 @@
 	-rm -f *.$(OBJEXT) core *.core
 
 distclean-compile:
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/bindings.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/input_event.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/manager.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/path_input.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/text_input.Po@am__quote@
 
 distclean-depend:
 	-rm -rf ./$(DEPDIR)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/input/manager.cc	2005-07-02 04:45:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/input/manager.cc	2005-08-05 01:29:52.000000000 +0800
@@ -51,12 +51,15 @@
   iterator itr = std::find(begin(), end(), b);
 
   if (itr == end())
     throw std::logic_error("Manager::erase(...) could not find binding");
 
   Base::erase(itr);
+
+  if (std::find(begin(), end(), b) != end())
+    throw std::logic_error("Manager::erase(...) found duplicate bindings");
 }
 
 void
 Manager::pressed(int key) {
   if (m_textInput != NULL && m_textInput->pressed(key))
     return;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/main.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/main.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/main.cc	2005-07-14 04:26:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/main.cc	2005-08-13 01:09:58.000000000 +0800
@@ -185,26 +185,12 @@
     f->slot_finished(sigc::bind(sigc::ptr_fun(&rak::call_delete_func<core::DownloadFactory>), f));
     f->load();
     f->commit();
   }
 }
 
-void
-initialize_display(ui::Control* c) {
-  display::Canvas::init();
-  display::Window::slot_adjust(sigc::mem_fun(c->get_display(), &display::Manager::adjust_layout));
-}
-
-void
-initialize_core(ui::Control* c) {
-  c->get_core().get_poll().slot_read_stdin(sigc::mem_fun(c->get_input(), &input::Manager::pressed));
-  c->get_core().get_poll().slot_select_interrupted(sigc::ptr_fun(display::Canvas::do_update));
-
-  c->get_core().initialize();
-}
-
 int
 main(int argc, char** argv) {
   utils::Timer::update();
 
   OptionHandler optionHandler;
   ui::Control   uiControl;
@@ -219,24 +205,20 @@
     SignalHandler::set_ignore(SIGPIPE);
     SignalHandler::set_handler(SIGINT,  sigc::mem_fun(uiControl, &ui::Control::receive_shutdown));
     SignalHandler::set_handler(SIGSEGV, sigc::bind(sigc::ptr_fun(&do_panic), SIGSEGV));
     SignalHandler::set_handler(SIGBUS,  sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
     SignalHandler::set_handler(SIGFPE,  sigc::bind(sigc::ptr_fun(&do_panic), SIGFPE));
 
-    // Need to initialize this before parseing options.
-    torrent::initialize();
+    uiControl.get_core().initialize_first();
 
     if (getenv("HOME"))
       load_option_file(getenv("HOME") + std::string("/.rtorrent.rc"), &optionHandler);
 
     int firstArg = parse_options(&uiControl, &optionHandler, argc, argv);
 
-    initialize_display(&uiControl);
-    initialize_core(&uiControl);
-
-    uiControl.get_ui().init(&uiControl);
+    uiControl.initialize();
 
     load_session_torrents(&uiControl);
     load_arg_torrents(&uiControl, argv + firstArg, argv + argc);
 
     uiControl.get_display().adjust_layout();
 
@@ -248,24 +230,18 @@
       // the throttle task in libtorrent.
       if (!utils::displayScheduler.empty() &&
 	  utils::displayScheduler.get_next_timeout() <= utils::Timer::cache())
 	uiControl.get_display().do_update();
 
       // Do shutdown check before poll, not after.
-      uiControl.get_core().get_poll().poll(!utils::taskScheduler.empty() ?
-					   utils::taskScheduler.get_next_timeout() - utils::Timer::cache() :
-					   60 * 1000000);
+      uiControl.get_core().get_poll_manager()->poll(!utils::taskScheduler.empty() ?
+						    utils::taskScheduler.get_next_timeout() - utils::Timer::cache() :
+						    60 * 1000000);
     }
 
-    uiControl.get_ui().cleanup();
-    uiControl.get_core().cleanup();
-
-    display::Canvas::erase_std();
-    display::Canvas::refresh_std();
-    display::Canvas::do_update();
-    display::Canvas::cleanup();
+    uiControl.cleanup();
 
   } catch (std::exception& e) {
     display::Canvas::cleanup();
 
     std::cout << "Caught exception: \"" << e.what() << '"' << std::endl;
     return -1;
@@ -305,13 +281,13 @@
   exit(-1);
 }
 
 void
 receive_tracker_dump(std::istream* s) {
   std::stringstream filename;
-  filename << "./tracker_dump." << utils::Timer::current().sec();
+  filename << "./tracker_dump." << utils::Timer::current().seconds();
 
   std::fstream out(filename.str().c_str(), std::ios::out | std::ios::trunc);
 
   if (!out.is_open())
     return;
   
@@ -320,13 +296,13 @@
   std::copy(std::istream_iterator<char>(*s), std::istream_iterator<char>(),
 	    std::ostream_iterator<char>(out));
 }
 
 void
 print_help() {
-  std::cout << "Rakshasa's BitTorrent client " VERSION "." << std::endl;
+  std::cout << "Rakshasa's BitTorrent client version " VERSION "." << std::endl;
   std::cout << std::endl;
   std::cout << "All value pairs (f.ex rate and queue size) will be in the UP/DOWN" << std::endl;
   std::cout << "order. Use the up/down/left/right arrow keys to move between screens." << std::endl;
   std::cout << std::endl;
   std::cout << "Usage: rtorrent [OPTIONS]... [FILE]... [URL]..." << std::endl;
   std::cout << "  -h                Display this very helpful text" << std::endl;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/option_handler_rules.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/option_handler_rules.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/option_handler_rules.cc	2005-07-19 03:10:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/option_handler_rules.cc	2005-08-05 01:29:55.000000000 +0800
@@ -191,13 +191,13 @@
 apply_bind(ui::Control* m, const std::string& arg) {
   torrent::set_bind_address(arg);
 }
 
 void
 apply_ip(ui::Control* m, const std::string& arg) {
-  torrent::set_address(arg);
+  torrent::set_local_address(arg);
 }
 
 // The arg string *must* have been checked with validate_port_range
 // first.
 void
 apply_port_range(ui::Control* m, const std::string& arg) {
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/signal_handler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/signal_handler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/signal_handler.h	2005-07-02 04:45:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/signal_handler.h	2005-08-05 01:29:55.000000000 +0800
@@ -34,13 +34,13 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_SIGNAL_HANDLER_H
 #define RTORRENT_SIGNAL_HANDLER_H
 
-#include <signal.h>
+#include <sys/signal.h>
 #include <sigc++/slot.h>
 
 class SignalHandler {
 public:
   typedef sigc::slot0<void> Slot;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/control.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/control.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/control.cc	2005-07-10 02:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/control.cc	2005-08-14 01:14:27.000000000 +0800
@@ -33,22 +33,69 @@
 //
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #include "config.h"
 
+#include <unistd.h>
+
+#include "display/canvas.h"
+#include "display/window.h"
+
 #include "control.h"
 
 namespace ui {
 
+Control::Control() :
+  m_shutdownReceived(false) {
+
+  m_inputStdin = new input::InputEvent(STDIN_FILENO);
+  m_inputStdin->slot_pressed(sigc::mem_fun(m_input, &input::Manager::pressed));
+}
+
+Control::~Control() {
+  delete m_inputStdin;
+}
+
+void
+Control::initialize() {
+  display::Canvas::init();
+  display::Window::slot_adjust(sigc::mem_fun(m_display, &display::Manager::adjust_layout));
+
+  m_core.get_poll_manager()->signal_interrupted().connect(sigc::mem_fun(*m_inputStdin, &input::InputEvent::event_read));
+  m_core.get_poll_manager()->signal_interrupted().connect(sigc::ptr_fun(display::Canvas::do_update));
+
+  m_core.initialize_second();
+
+  m_ui.init(this);
+
+  m_inputStdin->insert(m_core.get_poll_manager()->get_torrent_poll());
+}
+
+void
+Control::cleanup() {
+  m_inputStdin->remove(m_core.get_poll_manager()->get_torrent_poll());
+
+  m_ui.cleanup();
+  m_core.cleanup();
+  
+  display::Canvas::erase_std();
+  display::Canvas::refresh_std();
+  display::Canvas::do_update();
+  display::Canvas::cleanup();
+}
+
 // I think it should be safe to initiate the shutdown from anywhere,
 // but if it isn't, use a delay task.
 void
 Control::receive_shutdown() {
-  if (!m_shutdownReceived)
+  if (!m_shutdownReceived) {
     torrent::listen_close();
     
-  m_core.shutdown(m_shutdownReceived);
-  m_shutdownReceived = true;
+    m_core.shutdown(false);
+    m_shutdownReceived = true;
+  } else {
+    m_core.shutdown(true);
+  }
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/control.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/control.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/control.h	2005-07-10 02:39:59.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/control.h	2005-08-05 01:29:55.000000000 +0800
@@ -39,28 +39,34 @@
 
 #include <torrent/torrent.h>
 
 #include "core/manager.h"
 #include "display/manager.h"
 #include "input/manager.h"
+#include "input/input_event.h"
 
 #include "root.h"
 
 namespace ui {
 
 class Control {
 public:
-  Control() : m_shutdownReceived(false) {}
+  Control();
+  ~Control();
   
   bool                is_shutdown_completed()       { return m_shutdownReceived && torrent::is_inactive(); }
   bool                is_shutdown_received()        { return m_shutdownReceived; }
 
   Root&               get_ui()                      { return m_ui; }
   core::Manager&      get_core()                    { return m_core; }
   display::Manager&   get_display()                 { return m_display; }
   input::Manager&     get_input()                   { return m_input; }
+  input::InputEvent*  get_input_stdin()             { return m_inputStdin; }
+
+  void                initialize();
+  void                cleanup();
 
   void                receive_shutdown();
 
 private:
   Control(const Control&);
   void operator = (const Control&);
@@ -68,11 +74,12 @@
   bool                m_shutdownReceived;
 
   Root                m_ui;
   core::Manager       m_core;
   display::Manager    m_display;
   input::Manager      m_input;
+  input::InputEvent*  m_inputStdin;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/download.cc	2005-07-02 04:45:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/download.cc	2005-08-09 23:02:44.000000000 +0800
@@ -234,14 +234,14 @@
   (*m_bindings)['2'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_uploads), 1);
   (*m_bindings)['3'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_min_peers), -5);
   (*m_bindings)['4'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_min_peers), 5);
   (*m_bindings)['5'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_peers), -5);
   (*m_bindings)['6'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_max_peers), 5);
 
-  (*m_bindings)['t'] = sigc::bind(sigc::bind(sigc::mem_fun(m_download->get_download(), &torrent::Download::set_tracker_timeout), false), 2 * 1000000);
-  (*m_bindings)['T'] = sigc::bind(sigc::bind(sigc::mem_fun(m_download->get_download(), &torrent::Download::set_tracker_timeout), true), 2 * 1000000);
+  (*m_bindings)['t'] = sigc::bind(sigc::mem_fun(m_download->get_download(), &torrent::Download::tracker_manual_request), false);
+  (*m_bindings)['T'] = sigc::bind(sigc::mem_fun(m_download->get_download(), &torrent::Download::tracker_manual_request), true);
 
   (*m_bindings)['p'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_PEER_INFO);
   (*m_bindings)['o'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_TRACKER_LIST);
 
   (*m_bindings)[KEY_UP]   = sigc::mem_fun(*this, &Download::receive_prev);
   (*m_bindings)[KEY_DOWN] = sigc::mem_fun(*this, &Download::receive_next);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/element_string_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/element_string_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/ui/element_string_list.cc	2005-07-02 04:45:25.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/ui/element_string_list.cc	2005-08-08 01:47:28.000000000 +0800
@@ -40,15 +40,14 @@
 
 #include "control.h"
 #include "element_string_list.h"
 
 namespace ui {
 
-ElementStringList::ElementStringList() {
-  m_list.push_back("Test string 1");
-  m_list.push_back("Test string 2");
+ElementStringList::ElementStringList() :
+  m_window(NULL) {
 }
 
 void
 ElementStringList::activate(Control* c, MItr mItr) {
   if (m_window != NULL)
     throw std::logic_error("ui::ElementStringList::activate(...) called on an object in the wrong state");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/task_item.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/task_item.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/task_item.h	2005-07-02 04:45:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/task_item.h	2005-08-09 23:02:46.000000000 +0800
@@ -54,15 +54,16 @@
   TaskItem(Slot s = Slot()) : m_slot(s) {}
 
   Slot&               get_slot()                    { return m_slot; }
   void                set_slot(Slot s)              { m_slot = s; }
 
   iterator            get_iterator()                { return m_iterator; }
+  const iterator      get_iterator() const          { return m_iterator; }
   void                set_iterator(iterator itr)    { m_iterator = itr; }
 
-  const Timer&        get_time()                    { return m_iterator->first; }
+  const Timer&        get_time() const              { return m_iterator->first; }
 
 private:
   TaskItem(const TaskItem& t);
   TaskItem&           operator = (const TaskItem& t);
 
   iterator            m_iterator;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/task_scheduler.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/task_scheduler.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/task_scheduler.h	2005-07-02 04:45:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/task_scheduler.h	2005-08-09 23:02:46.000000000 +0800
@@ -60,15 +60,15 @@
 
   void                insert(TaskItem* task, Timer time);
   void                erase(TaskItem* task);
 
   void                execute(Timer time);
 
-  bool                is_scheduled(TaskItem* task)        { return task->get_iterator() != end(); }
+  bool                is_scheduled(const TaskItem* task) const { return task->get_iterator() != end(); }
 
-  Timer               get_next_timeout() const            { return begin()->first; }
+  Timer               get_next_timeout() const                 { return begin()->first; }
 
 private:
   inline void         execute_task(const value_type& v);
 };
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/timer.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/timer.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/src/utils/timer.h	2005-07-02 04:45:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/src/utils/timer.h	2005-08-13 01:09:58.000000000 +0800
@@ -34,70 +34,65 @@
 //           Skomakerveien 33
 //           3185 Skoppum, NORWAY
 
 #ifndef RTORRENT_UTILS_TIMER_H
 #define RTORRENT_UTILS_TIMER_H
 
-#include <limits>
 #include <inttypes.h>
 #include <sys/time.h>
 
 namespace utils {
 
-// Don't convert negative Timer to timeval.
+// Don't convert negative Timer to timeval and then back to Timer, that will bork.
 class Timer {
  public:
   Timer() : m_time(0) {}
   Timer(int64_t usec) : m_time(usec) {}
   Timer(timeval tv) : m_time((int64_t)(uint32_t)tv.tv_sec * 1000000 + (int64_t)(uint32_t)tv.tv_usec % 1000000) {}
 
-  int64_t   usec() const                   { return m_time; }
-  int32_t   sec() const                    { return m_time / 1000000; }
-  timeval   tval() const                   { return (timeval) { m_time / 1000000, m_time % 1000000}; }
-
-  Timer     round_seconds() const          { return (m_time / 1000000) * 1000000; }
-
-  static Timer current() {
-    timeval t;
-    gettimeofday(&t, 0);
+  int32_t             seconds() const                    { return m_time / 1000000; }
+  int64_t             usec() const                       { return m_time; }
 
-    return Timer(t);
-  }
+  Timer               round_seconds() const              { return (m_time / 1000000) * 1000000; }
+
+  timeval             tval() const                       { return (timeval) { m_time / 1000000, m_time % 1000000}; }
+
+  static Timer        current();
 
   // Cached time, updated in the beginning of torrent::work call.
   // Don't use outside socket_base read/write/except or Service::service.
-  
-  // TODO: Find out if it's worth it. The kernel is supposed to cache the
-  // time. Though system calls would be more expensive than we can afford.
-  static Timer cache()                     { return Timer(m_cache); }
-
-  // TODO: Create sd::numeric_limits for these?
-  static Timer min()                       { return 0; }
-  static Timer max()                       { return (int64_t)std::numeric_limits<time_t>::max() * 1000000; }
-
-  static void  update()                    { m_cache = Timer::current().usec(); }
-
-  Timer operator - (const Timer& t) const  { return Timer(m_time - t.m_time); }
-  Timer operator + (const Timer& t) const  { return Timer(m_time + t.m_time); }
-
-  Timer operator -= (int64_t t)            { m_time -= t; return *this; }
-  Timer operator -= (const Timer& t)       { m_time -= t.m_time; return *this; }
-
-  Timer operator += (int64_t t)            { m_time += t; return *this; }
-  Timer operator += (const Timer& t)       { m_time += t.m_time; return *this; }
-
-  bool  operator <  (const Timer& t) const { return m_time < t.m_time; }
-  bool  operator >  (const Timer& t) const { return m_time > t.m_time; }
-  bool  operator <= (const Timer& t) const { return m_time <= t.m_time; }
-  bool  operator >= (const Timer& t) const { return m_time >= t.m_time; }
-  bool  operator == (const Timer& t) const { return m_time == t.m_time; }
+  static Timer        cache()                            { return Timer(m_cache); }
+
+  static void         update()                           { m_cache = Timer::current().usec(); }
+
+  bool                operator <  (const Timer& t) const { return m_time < t.m_time; }
+  bool                operator >  (const Timer& t) const { return m_time > t.m_time; }
+  bool                operator <= (const Timer& t) const { return m_time <= t.m_time; }
+  bool                operator >= (const Timer& t) const { return m_time >= t.m_time; }
+
+  Timer               operator - (const Timer& t) const  { return Timer(m_time - t.m_time); }
+  Timer               operator + (const Timer& t) const  { return Timer(m_time + t.m_time); }
+
+  Timer               operator -= (int64_t t)            { m_time -= t; return *this; }
+  Timer               operator -= (const Timer& t)       { m_time -= t.m_time; return *this; }
+
+  Timer               operator += (int64_t t)            { m_time += t; return *this; }
+  Timer               operator += (const Timer& t)       { m_time += t.m_time; return *this; }
 
  private:
-  int64_t m_time;
+  int64_t             m_time;
 
   // Instantiated in torrent.cc
-  static int64_t m_cache;
+  static int64_t      m_cache;
 };
 
+inline Timer
+Timer::current() {
+  timeval t;
+  gettimeofday(&t, 0);
+  
+  return Timer(t);
+}
+
 }
 
-#endif // LIBTORRENT_TIMER_H
+#endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/TODO /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/TODO
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.0/TODO	2005-06-29 04:50:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.3.1/TODO	2005-08-05 01:29:56.000000000 +0800
@@ -1,6 +1,8 @@
+See libtorrent/TODO for a list of TODO items.
+
 Polling during last phase of shutdown should be very quick, don't use
 normal timeout.
 
 Consider basing WindowPeer* on a common base class.
 
 Some kind of indication that a tracker request was tried, but won't be
