diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/configure /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/configure
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/configure	2005-02-27 07:24:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/configure	2005-03-08 02:51:19.000000000 +0800
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.57 for rtorrent 0.1.0.
+# Generated by GNU Autoconf 2.57 for rtorrent 0.1.1.
 #
 # Report bugs to <jaris@ifi.uio.no>.
 #
 # Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 # Free Software Foundation, Inc.
 # This configure script is free software; the Free Software Foundation
@@ -265,14 +265,14 @@
 # only ac_max_sed_lines should be used.
 : ${ac_max_here_lines=38}
 
 # Identity of this package.
 PACKAGE_NAME='rtorrent'
 PACKAGE_TARNAME='rtorrent'
-PACKAGE_VERSION='0.1.0'
-PACKAGE_STRING='rtorrent 0.1.0'
+PACKAGE_VERSION='0.1.1'
+PACKAGE_STRING='rtorrent 0.1.1'
 PACKAGE_BUGREPORT='jaris@ifi.uio.no'
 
 ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO AMTAR install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM AWK SET_MAKE CXX CXXFLAGS LDFLAGS CPPFLAGS ac_ct_CXX EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CXXDEPMODE RANLIB ac_ct_RANLIB CC CFLAGS ac_ct_CC CCDEPMODE PKG_CONFIG STUFF_CFLAGS STUFF_LIBS LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -742,13 +742,13 @@
 # Report the --help message.
 #
 if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures rtorrent 0.1.0 to adapt to many kinds of systems.
+\`configure' configures rtorrent 0.1.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
 To assign environment variables (e.g., CC, CFLAGS...), specify them as
 VAR=VALUE.  See below for descriptions of some of the useful variables.
 
@@ -804,23 +804,23 @@
   --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of rtorrent 0.1.0:";;
+     short | recursive ) echo "Configuration of rtorrent 0.1.1:";;
    esac
   cat <<\_ACEOF
 
 Optional Features:
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --enable-debug          enable debug information default=yes
   --disable-dependency-tracking Speeds up one-time builds
   --enable-dependency-tracking  Do not reject slow dependency extractors
   --disable-largefile     omit support for large files
-  --enable-debug          enable debug information default=yes
   --enable-werror         enable the -Werror flag default=no
 
 Some influential environment variables:
   CXX         C++ compiler command
   CXXFLAGS    C++ compiler flags
   LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
@@ -893,13 +893,13 @@
   done
 fi
 
 test -n "$ac_init_help" && exit 0
 if $ac_init_version; then
   cat <<\_ACEOF
-rtorrent configure 0.1.0
+rtorrent configure 0.1.1
 generated by GNU Autoconf 2.57
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
@@ -908,13 +908,13 @@
 fi
 exec 5>config.log
 cat >&5 <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by rtorrent $as_me 0.1.0, which was
+It was created by rtorrent $as_me 0.1.1, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   $ $0 $@
 
 _ACEOF
 {
@@ -1499,13 +1499,13 @@
 echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
 # Define the identity of the package.
  PACKAGE=rtorrent
- VERSION=0.1.0
+ VERSION=0.1.1
 
 
 cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
 _ACEOF
 
@@ -1649,12 +1649,29 @@
 
 
 
 
 CXXFLAGS="-O3"
 
+# Check whether --enable-debug or --disable-debug was given.
+if test "${enable_debug+set}" = set; then
+  enableval="$enable_debug"
+
+        if test "$enableval" = "yes"; then
+            CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
+        else
+            CXXFLAGS="$CXXFLAGS -Wall -DNDEBUG"
+        fi
+
+else
+
+        CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
+
+
+fi;
+
 ac_ext=cc
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 if test -n "$ac_tool_prefix"; then
@@ -3439,29 +3456,12 @@
 
 fi
 rm -f conftest*
 fi
 
 
-# Check whether --enable-debug or --disable-debug was given.
-if test "${enable_debug+set}" = set; then
-  enableval="$enable_debug"
-
-        if test "$enableval" = "yes"; then
-            CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
-        else
-            CXXFLAGS="$CXXFLAGS -Wall -DNDEBUG"
-        fi
-
-else
-
-        CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
-
-
-fi;
-
 # Check whether --enable-werror or --disable-werror was given.
 if test "${enable_werror+set}" = set; then
   enableval="$enable_werror"
 
         if test "$enableval" = "yes"; then
             CXXFLAGS="$CXXFLAGS -Werror"
@@ -4191,13 +4191,13 @@
   sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
 ## Running $as_me. ##
 _ASBOX
 } >&5
 cat >&5 <<_CSEOF
 
-This file was extended by rtorrent $as_me 0.1.0, which was
+This file was extended by rtorrent $as_me 0.1.1, which was
 generated by GNU Autoconf 2.57.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
   CONFIG_LINKS    = $CONFIG_LINKS
   CONFIG_COMMANDS = $CONFIG_COMMANDS
@@ -4254,13 +4254,13 @@
 
 Report bugs to <bug-autoconf@gnu.org>."
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
-rtorrent config.status 0.1.0
+rtorrent config.status 0.1.1
 configured by $0, generated by GNU Autoconf 2.57,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/configure.ac /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/configure.ac
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/configure.ac	2005-02-27 07:24:24.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/configure.ac	2005-03-08 02:49:11.000000000 +0800
@@ -1,19 +1,15 @@
-AC_INIT(rtorrent, 0.1.0, jaris@ifi.uio.no)
+AC_INIT(rtorrent, 0.1.1, jaris@ifi.uio.no)
 
 AM_INIT_AUTOMAKE
 AM_CONFIG_HEADER(config.h)
 
 sinclude(scripts/checks.m4)
 
 CXXFLAGS="-O3"
 
-AC_PROG_CXX
-AC_PROG_RANLIB
-AC_SYS_LARGEFILE
-
 AC_ARG_ENABLE(debug,
     [  --enable-debug          enable debug information [default=yes]],
     [
         if test "$enableval" = "yes"; then
             CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
         else
@@ -21,12 +17,16 @@
         fi
     ],[
         CXXFLAGS="$CXXFLAGS -Wall -g -DDEBUG"
     ]
 )
 
+AC_PROG_CXX
+AC_PROG_RANLIB
+AC_SYS_LARGEFILE
+
 AC_ARG_ENABLE(werror,
     [  --enable-werror         enable the -Werror flag [default=no]],
     [
         if test "$enableval" = "yes"; then
             CXXFLAGS="$CXXFLAGS -Werror"
         fi
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/README /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/README
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/README	2005-02-21 01:22:45.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/README	2005-03-08 02:49:11.000000000 +0800
@@ -1,25 +1,27 @@
 Options and flags:
 
-  -p <a-b>    Open a port in the range a to b.
+  -i <a.b.c.d>      Set the IP address sent to the tracker.
 
-  -s <dir>    Use <dir> as the session directory. The torrents will be
-              saved with the info-hash in hex as the filename.
+  -p <a-b>          Open a port in the range a to b.
+
+  -s <dir>          Use <dir> as the session directory. The torrents will be
+                    saved with the info-hash in hex as the filename.
 
 All:
 
-  Ctrl-Q  - Quit
+  Ctrl-Q    - Quit
 
-  A       - Increase Throttle by 1 KiB
-  Z       - Decrease Throttle by 1 KiB
+  A         - Increase Throttle by 1 KiB
+  Z         - Decrease Throttle by 1 KiB
 
-  S       - Increase Throttle by 5 KiB
-  X       - Decrease Throttle by 5 KiB
+  S         - Increase Throttle by 5 KiB
+  X         - Decrease Throttle by 5 KiB
 
-  D       - Increase Throttle by 50 KiB
-  C       - Decrease Throttle by 50 KiB
+  D         - Increase Throttle by 50 KiB
+  C         - Decrease Throttle by 50 KiB
 
 
 In main window:
 
   Backspace - Activate text input for inserting urls/file
               paths. Arrows/C^f/C^b for navigation, enter/C^m.
@@ -35,18 +37,26 @@
 In torrent view:
 
   Up/Down   - Select peer
 
   Left      - Back to main
 
-  Right     - View peer
+  Right     - View files
 
   1         - Decrease max uploads
   2         - Increase max uploads
 
   3         - Decrease min peers connected
   4         - Increase min peers connected
 
   5         - Decrease max peers connected
   6         - Increase max peers connected
 
-  T         - Query tracker
\ No newline at end of file
+  T         - Query tracker
+
+In file view:
+
+  Up/Down   - Select file
+
+  Left      - Back to torrent view
+
+  SpaceBar  - Change file priority
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/curl_stack.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/curl_stack.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/curl_stack.cc	2005-02-20 01:19:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/curl_stack.cc	2005-03-08 02:49:11.000000000 +0800
@@ -38,13 +38,13 @@
       int t;
 
       do {
 	CURLMsg* msg = curl_multi_info_read((CURLM*)m_handle, &t);
 
 	CurlGetList::iterator itr = std::find_if(m_getList.begin(), m_getList.end(),
-						 func::equal(msg->easy_handle, std::mem_fun(&CurlGet::handle)));
+						 utils::equal(msg->easy_handle, std::mem_fun(&CurlGet::handle)));
 
 	if (itr == m_getList.end())
 	  throw torrent::client_error("Could not find CurlGet with the right easy_handle");
 	
 	(*itr)->perform(msg);
       } while (t);
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download.cc	2005-02-27 04:32:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download.cc	2005-03-08 02:49:11.000000000 +0800
@@ -1,20 +1,21 @@
 #include "config.h"
 
 #include "download.h"
 
 #include <sigc++/bind.h>
+#include <sigc++/hide.h>
 #include <sigc++/signal.h>
 
 namespace core {
 
 void
 Download::set_download(torrent::Download d) {
   m_download = d;
 
-  m_connTrackerSucceded = m_download.signal_tracker_succeded(sigc::bind(sigc::mem_fun(*this, &Download::receive_tracker_msg), ""));
+  m_connTrackerSucceded = m_download.signal_tracker_succeded(sigc::hide(sigc::bind(sigc::mem_fun(*this, &Download::receive_tracker_msg), "")));
   m_connTrackerFailed = m_download.signal_tracker_failed(sigc::mem_fun(*this, &Download::receive_tracker_msg));
 }
 
 void
 Download::release_download() {
   m_connTrackerSucceded.disconnect();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download.h	2005-02-20 06:17:42.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download.h	2005-03-08 02:49:11.000000000 +0800
@@ -5,12 +5,15 @@
 #include <torrent/download.h>
 
 namespace core {
 
 class Download {
 public:
+  bool               is_open()                       { return m_download.is_open(); }
+  bool               is_done()                       { return m_download.get_chunks_done() == m_download.get_chunks_total(); }
+
   void               set_download(torrent::Download d);
   void               release_download();
 
   torrent::Download& get_download()                  { return m_download; }
   std::string        get_hash()                      { return m_download.get_hash(); }
   
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/download_list.cc	2005-02-20 23:36:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/download_list.cc	2005-03-08 02:49:11.000000000 +0800
@@ -29,12 +29,12 @@
 
   return Base::erase(itr);
 }
 
 void
 DownloadList::clear() {
-  std::for_each(begin(), end(), func::call_delete());
+  std::for_each(begin(), end(), utils::call_delete<Download>());
 
   Base::clear();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/hash_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/hash_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/hash_queue.cc	2005-02-20 01:19:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/hash_queue.cc	2005-03-08 02:49:11.000000000 +0800
@@ -12,13 +12,13 @@
 
 void
 HashQueue::insert(Download* d, Slot s) {
   if (d->get_download().is_hash_checking())
     return;
 
-  if (std::find_if(begin(), end(), func::equal(d, std::mem_fun(&HashQueueNode::get_download))) != end())
+  if (std::find_if(begin(), end(), utils::equal(d, std::mem_fun(&HashQueueNode::get_download))) != end())
     throw std::logic_error("core::HashQueue::insert(...) received a Download that is already queued");
 
   if (d->get_download().is_hash_checked()) {
     s();
     return;
   }
@@ -29,13 +29,13 @@
 
   fill_queue();
 }
 
 void
 HashQueue::remove(Download* d) {
-  iterator itr = std::find_if(begin(), end(), func::equal(d, std::mem_fun(&HashQueueNode::get_download)));
+  iterator itr = std::find_if(begin(), end(), utils::equal(d, std::mem_fun(&HashQueueNode::get_download)));
 
   if (itr == end())
     return;
 
   if ((*itr)->get_download()->get_download().is_hash_checking())
     // What do we do if we're already checking?
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/log.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/log.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/log.cc	2005-02-27 01:38:57.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/log.cc	2005-03-08 02:49:11.000000000 +0800
@@ -14,10 +14,10 @@
   m_signalUpdate.emit();
 }
 
 Log::iterator
 Log::find_older(utils::Timer t) {
   return std::find_if(begin(), end(),
-		      func::on(func::mem_ptr_ref(&Type::first), std::bind2nd(std::less_equal<utils::Timer>(), t)));
+		      utils::on(utils::mem_ptr_ref(&Type::first), std::bind2nd(std::less_equal<utils::Timer>(), t)));
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/manager.cc	2005-02-26 06:02:36.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/manager.cc	2005-03-08 02:49:11.000000000 +0800
@@ -3,13 +3,15 @@
 #include <stdexcept>
 #include <cstdio>
 #include <cstring>
 #include <fstream>
 #include <istream>
 #include <sstream>
+#include <iterator>
 #include <sigc++/bind.h>
+#include <torrent/bencode.h>
 #include <torrent/exceptions.h>
 #include <torrent/torrent.h>
 
 #include "download.h"
 #include "manager.h"
 #include "curl_get.h"
@@ -135,10 +137,26 @@
   
   (*itr)->get_download().set_ip(m_dns);
 
   start(*itr);
   m_downloadStore.save(*itr);
 
+  if (m_debugTracker >= 0)
+    (*itr)->get_download().signal_tracker_succeded(sigc::mem_fun(*this, &Manager::receive_debug_tracker));
+
   return itr;
 }
 
+void
+Manager::receive_debug_tracker(torrent::Bencode& bencode) {
+  std::stringstream filename;
+  filename << "./tracker_dump." << m_debugTracker++;
+
+  std::fstream out(filename.str().c_str(), std::ios::out | std::ios::trunc);
+
+  if (!out.good())
+    return;
+
+  out << bencode;
+}
+
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/manager.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/manager.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/manager.h	2005-02-26 06:02:41.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/manager.h	2005-03-08 02:49:11.000000000 +0800
@@ -5,21 +5,25 @@
 #include "download_store.h"
 #include "hash_queue.h"
 #include "http_queue.h"
 #include "poll.h"
 #include "log.h"
 
+namespace torrent {
+  class Bencode;
+}
+
 namespace core {
 
 class Manager {
 public:
   typedef DownloadList::iterator                    iterator;
   typedef sigc::slot1<void, DownloadList::iterator> SlotReady;
   typedef sigc::slot0<void>                         SlotFailed;
 
-  Manager() : m_portFirst(6890), m_portLast(6999) {}
+  Manager() : m_portFirst(6890), m_portLast(6999), m_debugTracker(-1) {}
 
   DownloadList&       get_download_list()                 { return m_downloadList; }
   DownloadStore&      get_download_store()                { return m_downloadStore; }
   HashQueue&          get_hash_queue()                    { return m_hashQueue; }
   HttpQueue&          get_http_queue()                    { return m_httpQueue; }
 
@@ -37,31 +41,37 @@
 
   const std::string&  get_dns()                           { return m_dns; }
   void                set_dns(const std::string& dns);
 
   void                set_port_range(int a, int b)        { m_portFirst = a; m_portLast = b; }
 
+  void                debug_tracker()                     { m_debugTracker = 0; }
+
 private:
   void                receive_http_done(CurlGet* http);
   void                receive_http_failed(std::string msg);
 
   void                create_file(const std::string& uri);
   void                create_http(const std::string& uri);
 
   iterator            create_final(std::istream* s);
 
+  void                receive_debug_tracker(torrent::Bencode& bencode);
+
   DownloadList        m_downloadList;
   DownloadStore       m_downloadStore;
   HashQueue           m_hashQueue;
   HttpQueue           m_httpQueue;
 
   Poll                m_poll;
   Log                 m_log;
 
   std::string         m_dns;
   int                 m_portFirst;
   int                 m_portLast;
+
+  int                 m_debugTracker;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/poll.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/poll.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/core/poll.cc	2005-02-27 03:18:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/core/poll.cc	2005-03-08 02:49:11.000000000 +0800
@@ -26,14 +26,13 @@
     int n;
 
     m_curlStack.fdset(m_readSet, m_writeSet, m_exceptSet, &n);
     m_maxFd = std::max(m_maxFd, n);
   }
 
-  timeout = std::min(timeout, utils::Timer(torrent::get(torrent::TIME_SELECT)));
-  timeval t = timeout.tval();
+  timeval t = std::min(timeout, utils::Timer(torrent::get(torrent::TIME_SELECT))).tval();
 
   errno = 0;
   m_maxFd = select(m_maxFd + 1, m_readSet, m_writeSet, m_exceptSet, &t);
 
   if (m_maxFd >= 0) {
     work();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/canvas.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/canvas.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/canvas.h	2005-02-14 02:03:16.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/canvas.h	2005-03-08 02:49:10.000000000 +0800
@@ -31,34 +31,38 @@
 
   void        print_border(chtype ls, chtype rs,
 			   chtype ts, chtype bs,
 			   chtype tl, chtype tr,
 			   chtype bl, chtype br)               { wborder(m_window, ls, rs, ts, bs, tl, tr, bl, br); }
 
-  void print(int x, int y, const char* str)                    { mvwprintw(m_window, y, x, str); }
+  // The format string is non-const, but that will not be a problem
+  // since the string shall always be a C string choosen at
+  // compiletime. Might cause extra copying of the string?
+
+  void print(int x, int y, char* str)                          { mvwprintw(m_window, y, x, str); }
 
   template <typename A1>
-  void print(int x, int y, const char* str, A1 a1)             { mvwprintw(m_window, y, x, str, a1); }
+  void print(int x, int y, char* str, A1 a1)                   { mvwprintw(m_window, y, x, str, a1); }
 
   template <typename A1, typename A2>
-  void print(int x, int y, const char* str, A1 a1, A2 a2)      { mvwprintw(m_window, y, x, str, a1, a2); }
+  void print(int x, int y, char* str, A1 a1, A2 a2)            { mvwprintw(m_window, y, x, str, a1, a2); }
 
   template <typename A1, typename A2, typename A3>
-  void print(int x, int y, const char* str,
+  void print(int x, int y, char* str,
 		  A1 a1, A2 a2, A3 a3)                         { mvwprintw(m_window, y, x, str, a1, a2, a3); }
 
   template <typename A1, typename A2, typename A3, typename A4>
-  void print(int x, int y, const char* str,
+  void print(int x, int y, char* str,
 		  A1 a1, A2 a2, A3 a3, A4 a4)                  { mvwprintw(m_window, y, x, str, a1, a2, a3, a4); }
 
   template <typename A1, typename A2, typename A3, typename A4, typename A5>
-  void print(int x, int y, const char* str,
+  void print(int x, int y, char* str,
 		  A1 a1, A2 a2, A3 a3, A4 a4, A5 a5)           { mvwprintw(m_window, y, x, str, a1, a2, a3, a4, a5); }
 
   template <typename A1, typename A2, typename A3, typename A4, typename A5, typename A6>
-  void print(int x, int y, const char* str,
+  void print(int x, int y, char* str,
 		  A1 a1, A2 a2, A3 a3, A4 a4, A5 a5, A6 a6)    { mvwprintw(m_window, y, x, str, a1, a2, a3, a4, a5, a6); }
 
   void set_attr(int x, int y, int n, int attr, int color)      { mvwchgat(m_window, y, x, n, attr, color, NULL); }
 
   // Initialize stdscr.
   static void init();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/Makefile.am	2005-02-26 04:50:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/Makefile.am	2005-03-08 02:49:10.000000000 +0800
@@ -6,16 +6,18 @@
 	manager.cc \
 	manager.h \
 	utils.cc \
 	utils.h \
 	window.cc \
 	window.h \
-	window_download_statusbar.cc \
-	window_download_statusbar.h \
 	window_download_list.cc \
 	window_download_list.h \
+	window_download_statusbar.cc \
+	window_download_statusbar.h \
+	window_file_list.cc \
+	window_file_list.h \
 	window_http_queue.cc \
 	window_http_queue.h \
 	window_input.cc \
 	window_input.h \
 	window_log.cc \
 	window_log.h \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/Makefile.in	2005-02-27 07:24:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/Makefile.in	2005-03-08 02:51:18.000000000 +0800
@@ -84,16 +84,18 @@
 	manager.cc \
 	manager.h \
 	utils.cc \
 	utils.h \
 	window.cc \
 	window.h \
-	window_download_statusbar.cc \
-	window_download_statusbar.h \
 	window_download_list.cc \
 	window_download_list.h \
+	window_download_statusbar.cc \
+	window_download_statusbar.h \
+	window_file_list.cc \
+	window_file_list.h \
 	window_http_queue.cc \
 	window_http_queue.h \
 	window_input.cc \
 	window_input.h \
 	window_log.cc \
 	window_log.h \
@@ -114,18 +116,18 @@
 CONFIG_CLEAN_FILES =
 LIBRARIES = $(noinst_LIBRARIES)
 
 libsub_display_a_AR = $(AR) cru
 libsub_display_a_LIBADD =
 am_libsub_display_a_OBJECTS = canvas.$(OBJEXT) manager.$(OBJEXT) \
-	utils.$(OBJEXT) window.$(OBJEXT) \
-	window_download_statusbar.$(OBJEXT) \
-	window_download_list.$(OBJEXT) window_http_queue.$(OBJEXT) \
-	window_input.$(OBJEXT) window_log.$(OBJEXT) \
-	window_peer_info.$(OBJEXT) window_peer_list.$(OBJEXT) \
-	window_statusbar.$(OBJEXT) window_title.$(OBJEXT)
+	utils.$(OBJEXT) window.$(OBJEXT) window_download_list.$(OBJEXT) \
+	window_download_statusbar.$(OBJEXT) window_file_list.$(OBJEXT) \
+	window_http_queue.$(OBJEXT) window_input.$(OBJEXT) \
+	window_log.$(OBJEXT) window_peer_info.$(OBJEXT) \
+	window_peer_list.$(OBJEXT) window_statusbar.$(OBJEXT) \
+	window_title.$(OBJEXT)
 libsub_display_a_OBJECTS = $(am_libsub_display_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
@@ -133,12 +135,13 @@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/canvas.Po ./$(DEPDIR)/manager.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/utils.Po ./$(DEPDIR)/window.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_download_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_download_statusbar.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/window_file_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_http_queue.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_input.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_log.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_peer_info.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_peer_list.Po \
 @AMDEP_TRUE@	./$(DEPDIR)/window_statusbar.Po \
@@ -186,12 +189,13 @@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/canvas.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/manager.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/utils.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_download_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_download_statusbar.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_file_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_http_queue.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_input.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_log.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_peer_info.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_peer_list.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/window_statusbar.Po@am__quote@
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/manager.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/manager.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/manager.cc	2005-02-20 01:19:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/manager.cc	2005-03-08 02:49:10.000000000 +0800
@@ -23,14 +23,14 @@
 
 void
 Manager::adjust_layout() {
   int countDynamic = 0;
   int staticHeight = 0;
 
-  std::for_each(begin(), end(), func::if_then(std::mem_fun(&Window::is_active), func::accumulate(staticHeight, std::mem_fun(&Window::get_min_height))));
-  std::for_each(begin(), end(), func::if_then(std::mem_fun(&Window::is_active), func::accumulate(countDynamic, std::mem_fun(&Window::is_dynamic))));
+  std::for_each(begin(), end(), utils::if_then(std::mem_fun(&Window::is_active), utils::accumulate(staticHeight, std::mem_fun(&Window::get_min_height))));
+  std::for_each(begin(), end(), utils::if_then(std::mem_fun(&Window::is_active), utils::accumulate(countDynamic, std::mem_fun(&Window::is_dynamic))));
 
   int dynamic = std::max(0, Canvas::get_screen_height() - staticHeight);
   int height = 0, h;
 
   for (iterator itr = begin(); itr != end(); ++itr, height += h) {
     h = 0;
@@ -53,13 +53,14 @@
 }
 
 void
 Manager::do_update() {
   Canvas::refresh_std();
 
-  std::for_each(begin(), end(), func::if_then(std::mem_fun(&Window::is_active), std::mem_fun(&Window::redraw)));
-  std::for_each(begin(), end(), func::if_then(std::mem_fun(&Window::is_active), std::mem_fun(&Window::refresh)));
+  std::for_each(begin(), end(), utils::if_then(std::mem_fun(&Window::is_active), utils::if_then(std::mem_fun(&Window::is_dirty),
+											      std::mem_fun(&Window::redraw))));
+  std::for_each(begin(), end(), utils::if_then(std::mem_fun(&Window::is_active), std::mem_fun(&Window::refresh)));
 
   Canvas::do_update();
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window.cc	2005-02-26 05:17:15.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window.cc	2005-03-08 02:49:10.000000000 +0800
@@ -1,27 +1,21 @@
 #include "config.h"
 
 #include <stdexcept>
 
-#include "canvas.h"
 #include "window.h"
 
 namespace display {
 
 Window::Slot Window::m_slotAdjust;
 
 Window::~Window() {
   delete m_canvas;
 }
 
 void
-Window::refresh() {
-  m_canvas->refresh();
-}
-
-void
 Window::resize(int x, int y, int w, int h) {
   if (x < 0 || y < 0)
     throw std::logic_error("Window::resize(...) bad x or y position");
 
   if (w <= 0 || h <= 0)
     throw std::logic_error("Window::resize(...) bad size");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_download_list.cc	2005-02-26 06:29:10.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_download_list.cc	2005-03-08 02:49:10.000000000 +0800
@@ -1,9 +1,10 @@
 #include "config.h"
 
 #include "core/download.h"
+#include "utils/algorithm.h"
 
 #include "canvas.h"
 #include "utils.h"
 #include "window_download_list.h"
 
 namespace display {
@@ -13,70 +14,60 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowDownloadList::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 1000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
 
   m_canvas->erase();
 
   if (m_list->empty())
     return;
 
-  DList::iterator itr, last;
-  
-  int pos = 0, y = 0;
-
-  if (*m_focus != m_list->end()) {
-    int i = 0;
-    itr = last = *m_focus;
-    
-    while (i < m_canvas->get_height() - y - 3 && !(itr == m_list->begin() && last == m_list->end())) {
-      if (last != m_list->end()) {
-	++last;
-	i += 3;
-      }
-
-      if (itr != m_list->begin() && i < m_canvas->get_height() - y - 3) {
-	--itr;
-	i += 3;
-      }
-    }
-
-  } else {
-    itr = m_list->begin();
-    last = m_list->end();
-  }    
+  typedef std::pair<DList::iterator, DList::iterator> Range;
+
+  Range range = utils::iterate_both_distance(m_list->begin(),
+					     *m_focus != m_list->end() ? *m_focus : m_list->begin(),
+					     m_list->end(),
+					     m_canvas->get_height() / 3);
+
+  // Make sure we properly fill out the last lines so it looks like
+  // there are more torrents, yet don't hide it if we got the last one
+  // in focus.
+  if (range.second != m_list->end())
+    ++range.second;
+
+  int pos = 0;
+
+  while (range.first != range.second) {
+    torrent::Download& d = (*range.first)->get_download();
 
-  while (itr != m_list->end() && y < m_canvas->get_height()) {
     m_canvas->print(0, pos++, "%c %s",
-		    itr == *m_focus ? '*' : ' ',
-		    (*itr)->get_download().get_name().c_str());
+		    range.first == *m_focus ? '*' : ' ',
+		    d.get_name().c_str());
 
-    if ((*itr)->get_download().get_chunks_done() != (*itr)->get_download().get_chunks_total() || !(*itr)->get_download().is_open())
-      m_canvas->print(0, pos++, "%c Torrent: %.1f / %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
-		      itr == *m_focus ? '*' : ' ',
-		      (double)(*itr)->get_download().get_bytes_done() / (double)(1 << 20),
-		      (double)(*itr)->get_download().get_bytes_total() / (double)(1 << 20),
-		      (double)(*itr)->get_download().get_rate_up() / 1024.0,
-		      (double)(*itr)->get_download().get_rate_down() / 1024.0,
-		      (double)(*itr)->get_download().get_bytes_up() / (double)(1 << 20));
- 
-    else
+    if ((*range.first)->is_open() && (*range.first)->is_done())
       m_canvas->print(0, pos++, "%c Torrent: Done %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
-		      itr == *m_focus ? '*' : ' ',
-		      (double)(*itr)->get_download().get_bytes_total() / (double)(1 << 20),
-		      (double)(*itr)->get_download().get_rate_up() / 1024.0,
-		      (double)(*itr)->get_download().get_rate_down() / 1024.0,
-		      (double)(*itr)->get_download().get_bytes_up() / (double)(1 << 20));
+		      range.first == *m_focus ? '*' : ' ',
+		      (double)d.get_bytes_total() / (double)(1 << 20),
+		      (double)d.get_rate_up() / 1024.0,
+		      (double)d.get_rate_down() / 1024.0,
+		      (double)d.get_bytes_up() / (double)(1 << 20));
+    else
+      m_canvas->print(0, pos++, "%c Torrent: %.1f / %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
+		      range.first == *m_focus ? '*' : ' ',
+		      (double)d.get_bytes_done() / (double)(1 << 20),
+		      (double)d.get_bytes_total() / (double)(1 << 20),
+		      (double)d.get_rate_up() / 1024.0,
+		      (double)d.get_rate_down() / 1024.0,
+		      (double)d.get_bytes_up() / (double)(1 << 20));
     
-    m_canvas->print(0, pos++, "%c %s", itr == *m_focus ? '*' : ' ', print_download_status(*itr).c_str());
+    m_canvas->print(0, pos++, "%c %s",
+		    range.first == *m_focus ? '*' : ' ',
+		    print_download_status(*range.first).c_str());
 
-    ++itr;
+    ++range.first;
   }    
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_download_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_download_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_download_statusbar.cc	2005-02-20 01:22:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_download_statusbar.cc	2005-03-08 02:49:10.000000000 +0800
@@ -12,16 +12,13 @@
   Window(new Canvas, false, 3),
   m_download(d) {
 }
 
 void
 WindowDownloadStatusbar::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 1000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
 
   m_canvas->erase();
 
   if (m_download->get_download().get_chunks_done() != m_download->get_download().get_chunks_total() || !m_download->get_download().is_open())
     m_canvas->print(0, 0, "Torrent: %.1f / %.1f MiB Rate:%5.1f /%5.1f KiB Uploaded: %.1f MiB",
 		    (double)m_download->get_download().get_bytes_done() / (double)(1 << 20),
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display: window_file_list.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display: window_file_list.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window.h	2005-02-26 05:15:39.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window.h	2005-03-08 02:49:10.000000000 +0800
@@ -1,11 +1,12 @@
 #ifndef RTORRENT_WINDOW_BASE_H
 #define RTORRENT_WINDOW_BASE_H
 
 #include <sigc++/slot.h>
 
+#include "canvas.h"
 #include "utils/timer.h"
 
 namespace display {
 
 class Canvas;
 
@@ -17,23 +18,25 @@
     m_canvas(c), m_active(true), m_dynamic(d), m_minHeight(h) {}
 
   virtual ~Window();
 
   bool         is_active()                          { return m_active; }
   bool         is_dynamic()                         { return m_dynamic; }
-  bool         is_dirty()                           { return m_lastDraw == 0; }
+  bool         is_dirty()                           { return m_nextDraw <= utils::Timer::cache(); }
+
+  utils::Timer get_next_draw()                      { return m_nextDraw; }
 
   int          get_min_height()                     { return m_minHeight; }
 
   bool         get_active()                         { return m_active; }
   void         set_active(bool a)                   { m_active = a; }
 
-  void         refresh();
+  void         refresh()                            { m_canvas->refresh(); }
   void         resize(int x, int y, int w, int h);
 
-  void         mark_dirty()                         { m_lastDraw = 0; }
+  void         mark_dirty()                         { m_nextDraw = utils::Timer::min(); }
 
   virtual void redraw() = 0;
 
   static void  slot_adjust(Slot s)                  { m_slotAdjust = s; }
 
 protected:
@@ -45,13 +48,13 @@
   Canvas*      m_canvas;
 
   bool         m_active;
   bool         m_dynamic;
   int          m_minHeight;
 
-  utils::Timer m_lastDraw;
+  utils::Timer m_nextDraw;
 };
 
 }
 
 #endif
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_http_queue.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_http_queue.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_http_queue.cc	2005-02-26 05:58:08.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_http_queue.cc	2005-03-08 02:49:10.000000000 +0800
@@ -19,16 +19,13 @@
   m_connInsert = m_queue->signal_insert().connect(sigc::mem_fun(*this, &WindowHttpQueue::receive_insert));
   m_connErase  = m_queue->signal_erase().connect(sigc::mem_fun(*this, &WindowHttpQueue::receive_erase));
 }
 
 void
 WindowHttpQueue::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 1000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
 
   cleanup_list();
 
   if (m_container.empty()) {
     set_active(false);
     m_slotAdjust();
@@ -105,13 +102,13 @@
   mark_dirty();
 }
 
 void
 WindowHttpQueue::receive_erase(core::CurlGet* h) {
   Container::iterator itr = std::find_if(m_container.begin(), m_container.end(),
-					 func::equal(h, std::mem_fun_ref(&Node::get_http)));
+					 utils::equal(h, std::mem_fun_ref(&Node::get_http)));
 
   if (itr == m_container.end())
     throw std::logic_error("WindowHttpQueue::receive_erase(...) tried to remove an object we don't have");
 
   itr->m_http = NULL;
   itr->m_timer = utils::Timer::cache() + 10000000;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_input.cc	2005-02-20 01:22:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_input.cc	2005-03-08 02:49:10.000000000 +0800
@@ -12,16 +12,13 @@
   m_input(input),
   m_focus(false) {
 }
 
 void
 WindowInput::redraw() {
-  if (!is_dirty())
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::max();
   m_canvas->erase();
 
   m_canvas->print(0, 0, "> %s", m_input->c_str());
 
   if (m_focus)
     m_canvas->set_attr(m_input->get_pos() + 2, 0, 1, A_REVERSE, COLOR_PAIR(0));
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_log.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_log.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_log.cc	2005-02-27 06:45:13.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_log.cc	2005-03-08 02:49:10.000000000 +0800
@@ -23,16 +23,13 @@
 WindowLog::find_older() {
   return m_log->find_older(utils::Timer::cache() - 60*1000000);
 }
 
 void
 WindowLog::redraw() {
-  if (!is_dirty())
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::max();
 
   m_canvas->erase();
 
   int pos = 0;
 
   //m_canvas->print(std::max(0, (int)m_canvas->get_width() / 2 - 5), pos++, "*** Log ***");
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_info.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_info.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_info.cc	2005-02-20 23:22:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_info.cc	2005-03-08 02:49:10.000000000 +0800
@@ -16,41 +16,47 @@
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerInfo::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 1000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
   m_canvas->erase();
 
   int y = 0;
+  torrent::Download d = m_download->get_download();
 
-  m_canvas->print(0, y++, "Hash: %s", utils::string_to_hex(m_download->get_download().get_hash()).c_str());
+  m_canvas->print(0, y++, "Hash: %s", utils::string_to_hex(d.get_hash()).c_str());
   m_canvas->print(0, y++, "Chunks: %u / %u * %u",
-		  m_download->get_download().get_chunks_done(),
-		  m_download->get_download().get_chunks_total(),
-		  m_download->get_download().get_chunks_size());
+		  d.get_chunks_done(),
+		  d.get_chunks_total(),
+		  d.get_chunks_size());
 
   y++;
 
   if (*m_focus == m_list->end()) {
     m_canvas->print(0, y++, "No peer in focus");
 
     return;
   }
 
   m_canvas->print(0, y++, "DNS: %s:%hu", (*m_focus)->get_dns().c_str(), (*m_focus)->get_port());
   m_canvas->print(0, y++, "Id: %s" , utils::escape_string((*m_focus)->get_id()).c_str());
   m_canvas->print(0, y++, "Snubbed: %s", (*m_focus)->get_snubbed() ? "Yes" : "No");
-  m_canvas->print(0, y++, "Done: %i%", (*m_focus)->get_chunks_done());
+
+  m_canvas->print(0, y++, "Done: %i%", done_percentage(**m_focus));
 
   m_canvas->print(0, y++, "Rate: %5.1f/%5.1f KB Total: %.1f/%.1f MB",
 		  (double)(*m_focus)->get_rate_up() / (double)(1 << 10),
 		  (double)(*m_focus)->get_rate_down() / (double)(1 << 10),
 		  (double)(*m_focus)->get_transfered_up() / (double)(1 << 20),
 		  (double)(*m_focus)->get_transfered_down() / (double)(1 << 20));
 }
 
+int
+WindowPeerInfo::done_percentage(torrent::Peer& p) {
+  int chunks = m_download->get_download().get_chunks_total();
+
+  return chunks ? (100 * p.get_chunks_done()) / chunks : 0;
+}
+
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_info.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_info.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_info.h	2005-02-09 00:13:06.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_info.h	2005-03-08 02:49:10.000000000 +0800
@@ -1,11 +1,10 @@
 #ifndef RTORRENT_DISPLAY_PEER_INFO_H
 #define RTORRENT_DISPLAY_PEER_INFO_H
 
 #include <list>
-#include <sigc++/slot.h>
 #include <torrent/peer.h>
 
 #include "window.h"
 
 namespace core {
   class Download;
@@ -13,26 +12,23 @@
 
 namespace display {
 
 class WindowPeerInfo : public Window {
 public:
   typedef std::list<torrent::Peer> PList;
-  typedef sigc::slot0<uint32_t>    SlotChunksTotal;
 
   WindowPeerInfo(core::Download* d, PList* l, PList::iterator* f);
 
-  void             slot_chunks_total(SlotChunksTotal s) { m_slotChunksTotal = s; }
-
   virtual void     redraw();
 
 private:
+  int              done_percentage(torrent::Peer& p);
+
   core::Download*  m_download;
 
   PList*           m_list;
   PList::iterator* m_focus;
-
-  SlotChunksTotal  m_slotChunksTotal;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_list.cc	2005-02-20 01:22:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_list.cc	2005-03-08 02:49:10.000000000 +0800
@@ -1,27 +1,28 @@
 #include "config.h"
 
 #include <stdexcept>
 
+#include "core/download.h"
+#include "utils/algorithm.h"
+
 #include "canvas.h"
 #include "window_peer_list.h"
 
 namespace display {
 
-WindowPeerList::WindowPeerList(PList* l, PList::iterator* f) :
+WindowPeerList::WindowPeerList(core::Download* d, PList* l, PList::iterator* f) :
   Window(new Canvas, true),
+  m_download(d),
   m_list(l),
   m_focus(f) {
 }
 
 void
 WindowPeerList::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 1000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
   m_canvas->erase();
 
   int x = 2;
   int y = 0;
 
   m_canvas->print(x, y, "DNS");   x += 16;
@@ -36,85 +37,72 @@
 
   ++y;
 
   if (m_list->empty())
     return;
 
-  PList::iterator itr, last;
-  
-  if (*m_focus != m_list->end()) {
-    int i = 0;
-    itr = last = *m_focus;
-    
-    while (i < m_canvas->get_height() - y && !(itr == m_list->begin() && last == m_list->end())) {
-      if (itr != m_list->begin()) {
-	--itr;
-	++i;
-      }
-      
-      if (last != m_list->end() && i < m_canvas->get_height() - y) {
-	++last;
-	++i;
-      }
-    }
-
-  } else {
-    itr = m_list->begin();
-    last = m_list->end();
-  }    
+  typedef std::pair<PList::iterator, PList::iterator> Range;
 
-  uint32_t chunksTotal = m_slotChunksTotal();
+  Range range = utils::iterate_both_distance(m_list->begin(),
+					     *m_focus != m_list->end() ? *m_focus : m_list->begin(),
+					     m_list->end(),
+					     m_canvas->get_height() - y);
 
-  if (chunksTotal <= 0)
+  if (m_download->get_download().get_chunks_total() <= 0)
     throw std::logic_error("WindowPeerList::redraw() m_slotChunksTotal() returned invalid value");
 
-  while (itr != m_list->end() && y < m_canvas->get_height()) {
+  while (range.first != range.second) {
+    torrent::Peer& p = *range.first;
+
     x = 0;
 
     m_canvas->print(x, y, "%c %s",
-	     itr == *m_focus ? '*' : ' ',
-	     itr->get_dns().c_str());
+		    range.first == *m_focus ? '*' : ' ',
+		    p.get_dns().c_str());
     x += 18;
 
-    m_canvas->print(x, y, "%.1f",
-	     (double)itr->get_rate_up() / 1024);
+    m_canvas->print(x, y, "%.1f", (double)p.get_rate_up() / 1024);
     x += 7;
 
-    m_canvas->print(x, y, "%.1f",
-	     (double)itr->get_rate_down() / 1024);
+    m_canvas->print(x, y, "%.1f", (double)p.get_rate_down() / 1024);
     x += 7;
 
-    m_canvas->print(x, y, "%.1f",
-	     (double)itr->get_rate_peer() / 1024);
+    m_canvas->print(x, y, "%.1f", (double)p.get_rate_peer() / 1024);
     x += 7;
 
     m_canvas->print(x, y, "%c%c/%c%c%c",
-	     itr->get_remote_choked() ? 'c' : 'u',
-	     itr->get_remote_interested() ? 'i' : 'n',
-	     itr->get_local_choked() ? 'c' : 'u',
-	     itr->get_local_interested() ? 'i' : 'n',
-	     itr->get_choke_delayed() ? 'd' : ' ');
+		    p.get_remote_choked() ? 'c' : 'u',
+		    p.get_remote_interested() ? 'i' : 'n',
+		    p.get_local_choked() ? 'c' : 'u',
+		    p.get_local_interested() ? 'i' : 'n',
+		    p.get_choke_delayed() ? 'd' : ' ');
     x += 7;
 
     m_canvas->print(x, y, "%i/%i",
-	     itr->get_outgoing_queue_size(),
-	     itr->get_incoming_queue_size());
+		    p.get_outgoing_queue_size(),
+		    p.get_incoming_queue_size());
     x += 6;
 
-    m_canvas->print(x, y, "%3i", (itr->get_chunks_done() * 100) / chunksTotal);
+    m_canvas->print(x, y, "%3i", done_percentage(*range.first));
     x += 6;
 
-    if (itr->get_incoming_queue_size())
-      m_canvas->print(x, y, "%i",
-	       itr->get_incoming_index(0));
+    if (p.get_incoming_queue_size())
+      m_canvas->print(x, y, "%i", p.get_incoming_index(0));
 
     x += 6;
 
-    if (itr->get_snubbed())
+    if (p.get_snubbed())
       m_canvas->print(x, y, "*");
 
     ++y;
-    ++itr;
+    ++range.first;
   }
 }
 
+int
+WindowPeerList::done_percentage(torrent::Peer& p) {
+  int chunks = m_download->get_download().get_chunks_total();
+
+  return chunks ? (100 * p.get_chunks_done()) / chunks : 0;
+}
+
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_peer_list.h	2005-02-06 02:34:48.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_peer_list.h	2005-03-08 02:49:10.000000000 +0800
@@ -1,32 +1,34 @@
 #ifndef RTORRENT_DISPLAY_PEER_LIST_H
 #define RTORRENT_DISPLAY_PEER_LIST_H
 
 #include <list>
-#include <sigc++/slot.h>
 #include <torrent/peer.h>
 
 #include "window.h"
 
+namespace core {
+  class Download;
+}
+
 namespace display {
 
 class WindowPeerList : public Window {
 public:
   typedef std::list<torrent::Peer> PList;
-  typedef sigc::slot0<uint32_t>    SlotChunksTotal;
-
-  WindowPeerList(PList* l, PList::iterator* f);
 
-  void             slot_chunks_total(SlotChunksTotal s) { m_slotChunksTotal = s; }
+  WindowPeerList(core::Download* d, PList* l, PList::iterator* f);
 
   virtual void     redraw();
 
 private:
+  int              done_percentage(torrent::Peer& p);
+
+  core::Download*  m_download;
+
   PList*           m_list;
   PList::iterator* m_focus;
-
-  SlotChunksTotal  m_slotChunksTotal;
 };
 
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_statusbar.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_statusbar.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_statusbar.cc	2005-02-26 00:17:31.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_statusbar.cc	2005-03-08 02:49:10.000000000 +0800
@@ -14,23 +14,17 @@
   m_counter(0),
   m_core(c) {
 }
 
 void
 WindowStatusbar::redraw() {
-  m_counter++;
-
-  if (utils::Timer::cache() - m_lastDraw < 10000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
 
   m_canvas->erase();
-  m_canvas->print(0, 0, "Throttle: %i Listen: %s:%i Handshakes: %i Select: %u",
+  m_canvas->print(0, 0, "Throttle: %i Listen: %s:%i Handshakes: %i",
 		  (int)torrent::get(torrent::THROTTLE_ROOT_CONST_RATE) / 1024,
 		  m_core->get_dns().empty() ? "<default>" : m_core->get_dns().c_str(),
 		  (int)torrent::get(torrent::LISTEN_PORT),
-		  (int)torrent::get(torrent::HANDSHAKES_TOTAL),
-		  m_counter);
+		  (int)torrent::get(torrent::HANDSHAKES_TOTAL));
 }
 
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_title.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_title.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/display/window_title.cc	2005-02-20 01:22:32.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/display/window_title.cc	2005-03-08 02:49:10.000000000 +0800
@@ -9,16 +9,13 @@
   Window(new Canvas, false, 1),
   m_title(s) {
 }
 
 void
 WindowTitle::redraw() {
-  if (utils::Timer::cache() - m_lastDraw < 10000000)
-    return;
-
-  m_lastDraw = utils::Timer::cache();
+  m_nextDraw = utils::Timer::cache().round_seconds() + 1000000;
   m_canvas->erase();
 
   m_canvas->print(std::max(0, (m_canvas->get_width() - (int)m_title.size()) / 2 - 4), 0,
 		  "*** %s ***", m_title.c_str());
 }
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/input/text_input.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/input/text_input.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/input/text_input.cc	2005-02-16 23:27:27.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/input/text_input.cc	2005-03-08 02:49:10.000000000 +0800
@@ -29,13 +29,13 @@
 
   } else if (key >= 0x20 && key < 0x7F) {
     Base::insert(m_pos++, 1, key);
 
   } else {
     switch (key) {
-    case 0x08:
+    case 0x7F:
     case KEY_BACKSPACE:
       if (m_pos != 0)
 	Base::erase(--m_pos, 1);
 
       break;
 
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/main.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/main.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/main.cc	2005-02-27 05:55:01.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/main.cc	2005-03-08 02:49:11.000000000 +0800
@@ -14,23 +14,24 @@
 #endif
 
 #include "core/download.h"
 #include "display/canvas.h"
 #include "display/window.h"
 #include "ui/control.h"
-#include "ui/download_list.h"
+#include "ui/root.h"
 #include "input/bindings.h"
+
 #include "utils/timer.h"
 #include "utils/directory.h"
+#include "utils/task_schedule.h"
 
 #include "signal_handler.h"
 #include "option_parser.h"
 
 int64_t utils::Timer::m_cache;
 
-bool start_shutdown = false;
 bool is_shutting_down = false;
 
 void do_panic(int signum);
 void print_help();
 
 bool
@@ -44,17 +45,12 @@
   y = display::Canvas::get_screen_height();
 
   return r;
 }
 
 void
-set_shutdown() {
-  start_shutdown = true;
-}
-
-void
 do_shutdown(ui::Control* c) {
   if (!is_shutting_down) {
     is_shutting_down = true;
 
     torrent::listen_close();
 
@@ -63,27 +59,26 @@
 
   } else {
     // Close all torrents, this will stop all tracker connections and cause
     // a quick shutdown.
     std::for_each(c->get_core().get_download_list().begin(), c->get_core().get_download_list().end(),
 		  std::mem_fun(&core::Download::close));
-
   }
-
-  start_shutdown = false;
 }
 
 int
 parse_options(ui::Control* c, int argc, char** argv) {
   OptionParser optionParser;
   optionParser.insert_flag('h', sigc::ptr_fun(&print_help));
   optionParser.insert_option('i', sigc::mem_fun(c->get_core(), &core::Manager::set_dns));
   optionParser.insert_option('p', sigc::bind(sigc::ptr_fun(OptionParser::call_int_pair),
 					     sigc::mem_fun(c->get_core(), &core::Manager::set_port_range)));
   optionParser.insert_option('s', sigc::mem_fun(c->get_core().get_download_store(), &core::DownloadStore::activate));
 
+  optionParser.insert_flag('t', sigc::mem_fun(c->get_core(), &core::Manager::debug_tracker));
+
   return optionParser.process(argc, argv);
 }
 
 void
 load_session_torrents(ui::Control* c) {
   // Load session torrents.
@@ -95,24 +90,15 @@
 void
 load_arg_torrents(ui::Control* c, char** begin, char** end) {
   std::for_each(begin, end, std::bind1st(std::mem_fun(&core::Manager::insert), &c->get_core()));
 }
 
 void
-register_signals(ui::Control* c) {
-  SignalHandler::set_handler(SIGINT, sigc::ptr_fun(&set_shutdown));
-  SignalHandler::set_handler(SIGSEGV, sigc::bind(sigc::ptr_fun(&do_panic), SIGSEGV));
-  SignalHandler::set_handler(SIGBUS, sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
-}
-
-void
-register_main_keys(ui::Control* c, input::Bindings* b) {
-  c->get_input().push_back(b);
-
-  (*b)[KEY_RESIZE] = sigc::mem_fun(c->get_display(), &display::Manager::adjust_layout);
-  (*b)['\x11']     = sigc::ptr_fun(&set_shutdown);
+initialize_display(ui::Control* c) {
+  display::Canvas::init();
+  display::Window::slot_adjust(sigc::mem_fun(c->get_display(), &display::Manager::adjust_layout));
 }
 
 void
 initialize_core(ui::Control* c) {
   c->get_core().get_poll().slot_read_stdin(sigc::mem_fun(c->get_input(), &input::Manager::pressed));
   c->get_core().get_poll().slot_select_interrupted(sigc::ptr_fun(display::Canvas::do_update));
@@ -120,51 +106,52 @@
   c->get_core().initialize();
 }
 
 int
 main(int argc, char** argv) {
   ui::Control uiControl;
-  input::Bindings inputMain;
+  ui::Root    uiRoot(&uiControl);
 
   utils::Timer::update();
 
   try {
 
-  register_signals(&uiControl);
+  SignalHandler::set_handler(SIGINT, sigc::bind(sigc::mem_fun(uiRoot, &ui::Root::set_shutdown_received), true));
+  SignalHandler::set_handler(SIGSEGV, sigc::bind(sigc::ptr_fun(&do_panic), SIGSEGV));
+  SignalHandler::set_handler(SIGBUS, sigc::bind(sigc::ptr_fun(&do_panic), SIGBUS));
 
   int firstArg = parse_options(&uiControl, argc, argv);
 
-  display::Canvas::init();
-  display::Window::slot_adjust(sigc::mem_fun(uiControl.get_display(), &display::Manager::adjust_layout));
-
-  ui::DownloadList uiDownloadList(&uiControl);
-
-  uiDownloadList.activate();
-  uiDownloadList.slot_open_uri(sigc::mem_fun(uiControl.get_core(), &core::Manager::insert));
-
-  register_main_keys(&uiControl, &inputMain);
-
+  initialize_display(&uiControl);
   initialize_core(&uiControl);
 
+  uiRoot.init();
+
   load_session_torrents(&uiControl);
   load_arg_torrents(&uiControl, argv + firstArg, argv + argc);
 
   uiControl.get_display().adjust_layout();
 
   while (!is_shutting_down || !torrent::get(torrent::SHUTDOWN_DONE)) {
-    if (start_shutdown)
+
+    if (uiRoot.get_shutdown_received()) {
       do_shutdown(&uiControl);
+      uiRoot.set_shutdown_received(false);
+    }
 
     utils::Timer::update();
     utils::TaskSchedule::perform(utils::Timer::cache());
     
+    // This needs to be called every second or so. Currently done by
+    // the throttle task in libtorrent.
     uiControl.get_display().do_update();
 
     uiControl.get_core().get_poll().poll(utils::TaskSchedule::get_timeout());
   }
 
+  uiRoot.cleanup();
   display::Canvas::cleanup();
 
   } catch (std::exception& e) {
     display::Canvas::cleanup();
 
     std::cout << "Caught exception: \"" << e.what() << '"' << std::endl;
@@ -201,13 +188,16 @@
   
   exit(-1);
 }
 
 void
 print_help() {
-  std::cout << "Rakshasa's Torrent client. <Neko-Mimi Mode-o!>" << std::endl;
+  std::cout << "Rakshasa's BitTorrent client " VERSION "." << std::endl;
+  std::cout << std::endl;
+  std::cout << "All value pairs (f.ex rate and queue size) will be in the UP/DOWN" << std::endl;
+  std::cout << "order. Use the up/down/left/right arrow keys to move between screens." << std::endl;
   std::cout << std::endl;
   std::cout << "Usage: rtorrent [OPTIONS]... [FILE]... [URL]..." << std::endl;
   std::cout << "  -h                Display this very helpful text" << std::endl;
   std::cout << "  -i <a.b.c.d>      Set the IP address that is sent to the tracker" << std::endl;
   std::cout << "  -p <int>-<int>    Set port range for incoming connections" << std::endl;
   std::cout << "  -s <directory>    Set the session directory" << std::endl;
@@ -217,15 +207,17 @@
   std::cout << "  ^s                Start torrent" << std::endl;
   std::cout << "  ^d                Stop torrent or delete a stopped torrent" << std::endl;
   std::cout << "  ^q                Initiate shutdown or skip shutdown process" << std::endl;
   std::cout << "  a,s,d,z,x,c       Adjust throttle" << std::endl;
   std::cout << std::endl;
   std::cout << "Download view keys:" << std::endl;
+  std::cout << "  spacebar          Depends on the current view" << std::endl;
   std::cout << "  1,2               Adjust max uploads" << std::endl;
   std::cout << "  3,4,5,6           Adjust min/max connected peers" << std::endl;
   std::cout << "  t                 Query tracker for more peers" << std::endl;
+  std::cout << "  p                 View peer information" << std::endl;
   std::cout << std::endl;
 
   std::cout << "Report bugs to <jaris@ifi.uio.no>." << std::endl;
 
   exit(0);
 }
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download.cc	2005-02-26 00:16:19.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download.cc	2005-03-08 02:49:11.000000000 +0800
@@ -11,19 +11,22 @@
 #include "display/window_peer_info.h"
 #include "display/window_download_statusbar.h"
 #include "display/window_statusbar.h"
 
 #include "control.h"
 #include "download.h"
+#include "file_list.h"
 
 namespace ui {
 
 Download::Download(DPtr d, Control* c) :
   m_download(d),
   m_state(DISPLAY_NONE),
 
+  m_uiFileList(NULL),
+
   m_title(c->get_display().end()),
   m_window(c->get_display().end()),
   m_downloadStatus(c->get_display().end()),
   m_mainStatus(c->get_display().end()),
 
   m_control(c),
@@ -54,33 +57,39 @@
 
   m_window         = m_control->get_display().insert(m_control->get_display().begin(), NULL);
   m_title          = m_control->get_display().insert(m_control->get_display().begin(), new WTitle(m_download->get_download().get_name()));
   m_downloadStatus = m_control->get_display().insert(m_control->get_display().end(), new WDownloadStatus(m_download));
   m_mainStatus     = m_control->get_display().insert(m_control->get_display().end(), new WMainStatus(&m_control->get_core()));
 
+  m_uiFileList = new FileList(m_control, m_download);
+
   m_control->get_input().push_front(m_bindings);
 
   activate_display(DISPLAY_MAIN);
 }
 
 void
 Download::disable() {
   if (m_window == m_control->get_display().end())
     throw std::logic_error("ui::Download::disable() called on an already disabled object");
 
   disable_display();
 
-  delete *m_title;
-  delete *m_downloadStatus;
-  delete *m_mainStatus;
-
   m_control->get_display().erase(m_window);
   m_control->get_display().erase(m_title);
   m_control->get_display().erase(m_downloadStatus);
   m_control->get_display().erase(m_mainStatus);
 
+  delete *m_title;
+  delete *m_downloadStatus;
+  delete *m_mainStatus;
+
+  delete m_uiFileList;
+
+  m_uiFileList = NULL;
+
   m_window = m_title = m_downloadStatus = m_mainStatus = m_control->get_display().end();
 
   m_control->get_input().erase(m_bindings);
 }
 
 void
@@ -90,27 +99,30 @@
 
   if (m_window == m_control->get_display().end())
     throw std::logic_error("ui::Download::activate_display(...) could not find previous display iterator");
 
   switch (d) {
   case DISPLAY_MAIN:
-    *m_window = wpl = new WPeerList(&m_peers, &m_focus);
+    *m_window = wpl = new WPeerList(m_download, &m_peers, &m_focus);
 
-    wpl->slot_chunks_total(sigc::mem_fun(m_download->get_download(), &torrent::Download::get_chunks_total));
-
-    (*m_bindings)[KEY_RIGHT] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_PEER);
+    (*m_bindings)['p'] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_PEER);
+    (*m_bindings)[KEY_RIGHT] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_FILE_LIST);
     break;
 
   case DISPLAY_PEER:
     *m_window = wpi = new WPeerInfo(m_download, &m_peers, &m_focus);
 
-    wpi->slot_chunks_total(sigc::mem_fun(m_download->get_download(), &torrent::Download::get_chunks_total));
-
     (*m_bindings)[' '] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_MAIN);
     break;
 
+  case DISPLAY_FILE_LIST:
+    m_uiFileList->activate(m_window);
+    m_uiFileList->get_bindings()[KEY_LEFT] = sigc::bind(sigc::mem_fun(*this, &Download::receive_change), DISPLAY_MAIN);
+
+    break;    
+
   default:
     throw std::logic_error("ui::Download::activate_display(...) got wrong state");
   }
 
   m_state = d;
 
@@ -128,16 +140,23 @@
 
   case DISPLAY_PEER:
     m_bindings->erase(' ');
 
     break;
 
+  case DISPLAY_FILE_LIST:
+    m_uiFileList->disable();
+    *m_window = NULL;
+
+    return;
+
   default:
     break;
   }
 
+  // urgh, get ui's for the rest too.
   delete *m_window;
 
   *m_window = NULL;
 }
 
 void
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download.h	2005-02-13 06:31:04.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download.h	2005-03-08 02:49:11.000000000 +0800
@@ -5,24 +5,25 @@
 #include <torrent/peer.h>
 #include <sigc++/connection.h>
 
 namespace display {
   class WindowTitle;
   class WindowPeerInfo;
-  class WindowPeerList;
   class WindowStatusbar;
+  class WindowPeerList;
   class WindowDownloadStatusbar;
 }
 
 namespace core {
   class Download;
 }
 
 namespace ui {
 
 class Control;
+class FileList;
 
 class Download {
 public:
   typedef display::Window                  Window;
   typedef display::WindowPeerInfo          WPeerInfo;
   typedef display::WindowPeerList          WPeerList;
@@ -34,13 +35,14 @@
   typedef std::list<torrent::Peer>         PList;
   typedef display::Manager::iterator       MItr;
 
   typedef enum {
     DISPLAY_NONE,
     DISPLAY_MAIN,
-    DISPLAY_PEER
+    DISPLAY_PEER,
+    DISPLAY_FILE_LIST
   } Display;
 
   // We own 'window'.
   Download(DPtr d, Control* c);
   ~Download();
 
@@ -76,12 +78,14 @@
   DPtr             m_download;
   PList            m_peers;
   PList::iterator  m_focus;
 
   Display          m_state;
 
+  FileList*        m_uiFileList;
+
   MItr             m_title;
   MItr             m_window;
   MItr             m_downloadStatus;
   MItr             m_mainStatus;
 
   Control*         m_control;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download_list.cc /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download_list.cc
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download_list.cc	2005-02-27 05:29:40.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download_list.cc	2005-03-08 02:49:11.000000000 +0800
@@ -216,12 +216,13 @@
   (*b)['\x04'] = sigc::mem_fun(*this, &DownloadList::receive_stop_download);
 
   (*b)[KEY_UP]    = sigc::mem_fun(*this, &DownloadList::receive_prev);
   (*b)[KEY_DOWN]  = sigc::mem_fun(*this, &DownloadList::receive_next);
   (*b)[KEY_RIGHT] = sigc::mem_fun(*this, &DownloadList::receive_view_download);
 
+  (*b)['\x7f'] = sigc::mem_fun(*this, &DownloadList::receive_view_input);
   (*b)[KEY_BACKSPACE] = sigc::mem_fun(*this, &DownloadList::receive_view_input);
 }
 
 void
 DownloadList::mark_dirty() {
   m_window->mark_dirty();
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download_list.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download_list.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/download_list.h	2005-02-27 05:22:43.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/download_list.h	2005-03-08 02:49:11.000000000 +0800
@@ -1,13 +1,18 @@
 #ifndef RTORRENT_UI_DOWNLOAD_LIST_H
 #define RTORRENT_UI_DOWNLOAD_LIST_H
 
 #include <sigc++/slot.h>
 
+#include "core/download_list.h"
 #include "utils/task.h"
 
+namespace input {
+  class Bindings;
+}
+
 namespace display {
   class WindowDownloadList;
   class WindowHttpQueue;
   class WindowInput;
   class WindowLog;
   class WindowStatusbar;
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui: file_list.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui: file_list.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/Makefile.am	2005-02-01 23:56:14.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/Makefile.am	2005-03-08 02:49:11.000000000 +0800
@@ -2,9 +2,13 @@
 
 libsub_ui_a_SOURCES = \
 	control.h \
 	download.cc \
 	download.h \
 	download_list.cc \
-	download_list.h
+	download_list.h \
+	file_list.cc \
+	file_list.h \
+	root.cc \
+	root.h
 
 INCLUDES = -I$(srcdir) -I$(srcdir)/.. -I$(top_srcdir)
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/ui/Makefile.in	2005-02-27 07:24:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui/Makefile.in	2005-03-08 02:51:18.000000000 +0800
@@ -80,36 +80,42 @@
 
 libsub_ui_a_SOURCES = \
 	control.h \
 	download.cc \
 	download.h \
 	download_list.cc \
-	download_list.h
+	download_list.h \
+	file_list.cc \
+	file_list.h \
+	root.cc \
+	root.h
 
 
 INCLUDES = -I$(srcdir) -I$(srcdir)/.. -I$(top_srcdir)
 subdir = src/ui
 mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 LIBRARIES = $(noinst_LIBRARIES)
 
 libsub_ui_a_AR = $(AR) cru
 libsub_ui_a_LIBADD =
-am_libsub_ui_a_OBJECTS = download.$(OBJEXT) download_list.$(OBJEXT)
+am_libsub_ui_a_OBJECTS = download.$(OBJEXT) download_list.$(OBJEXT) \
+	file_list.$(OBJEXT) root.$(OBJEXT)
 libsub_ui_a_OBJECTS = $(am_libsub_ui_a_OBJECTS)
 
 DEFS = @DEFS@
 DEFAULT_INCLUDES =  -I. -I$(srcdir) -I$(top_builddir)
 CPPFLAGS = @CPPFLAGS@
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 @AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/download.Po \
-@AMDEP_TRUE@	./$(DEPDIR)/download_list.Po
+@AMDEP_TRUE@	./$(DEPDIR)/download_list.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/file_list.Po ./$(DEPDIR)/root.Po
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
 CXXLINK = $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
 CXXFLAGS = @CXXFLAGS@
@@ -146,12 +152,14 @@
 
 distclean-compile:
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download_list.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/file_list.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/root.Po@am__quote@
 
 distclean-depend:
 	-rm -rf ./$(DEPDIR)
 
 .cc.o:
 @AMDEP_TRUE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui: root.cc
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/ui: root.h
Only in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils: algorithm.h
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/functional.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/functional.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/functional.h	2005-02-26 04:05:38.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/functional.h	2005-03-08 02:49:10.000000000 +0800
@@ -1,23 +1,12 @@
-#ifndef RTORRENT_FUNCTIONAL_H
-#define RTORRENT_FUNCTIONAL_H
+#ifndef RTORRENT_UTILS_FUNCTIONAL_H
+#define RTORRENT_UTILS_FUNCTIONAL_H
 
 #include <functional>
 
-namespace func {
-
-template <typename Iterator, typename Ftor>
-inline void for_each(Iterator first, Iterator last, Ftor ftor) {
-  Iterator tmp;
-
-  while (first != last) {
-    tmp = first++;
-    
-    ftor(*tmp);
-  }
-}
+namespace utils {
 
 template <typename Type, typename Ftor>
 struct _accumulate {
   _accumulate(Type& t, Ftor f) : m_t(t), m_f(f) {}
 
   template <typename Arg>
@@ -105,23 +94,16 @@
 template <typename Cond, typename Then>
 inline _if_then<Cond, Then>
 if_then(Cond c, Then t) {
   return _if_then<Cond, Then>(c, t);
 }
 
-struct _call_delete
-  : public std::unary_function<void, void> {
-  
-  template <typename Type>
-  void operator () (Type* t) {
+template <typename T>
+struct call_delete : public std::unary_function<T*, void> {
+  void operator () (T* t) {
     delete t;
   }
 };
 
-inline _call_delete
-call_delete() {
-  return _call_delete();
-}
-
 }
 
 #endif
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/Makefile.am /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/Makefile.am
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/Makefile.am	2005-02-27 02:42:21.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/Makefile.am	2005-03-08 02:49:10.000000000 +0800
@@ -1,9 +1,10 @@
 noinst_LIBRARIES = libsub_utils.a
 
 libsub_utils_a_SOURCES = \
+	algorithm.h \
 	directory.cc \
 	directory.h \
 	functional.h \
 	parse.cc \
 	parse.h \
 	task.h \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/Makefile.in /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/Makefile.in
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/Makefile.in	2005-02-27 07:24:44.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/Makefile.in	2005-03-08 02:51:18.000000000 +0800
@@ -76,12 +76,13 @@
 am__include = @am__include@
 am__quote = @am__quote@
 install_sh = @install_sh@
 noinst_LIBRARIES = libsub_utils.a
 
 libsub_utils_a_SOURCES = \
+	algorithm.h \
 	directory.cc \
 	directory.h \
 	functional.h \
 	parse.cc \
 	parse.h \
 	task.h \
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/timer.h /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/timer.h
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/src/utils/timer.h	2005-02-20 01:21:28.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/src/utils/timer.h	2005-03-08 02:49:10.000000000 +0800
@@ -1,33 +1,26 @@
 #ifndef LIBTORRENT_TIMER_H
 #define LIBTORRENT_TIMER_H
 
+#include <limits>
 #include <inttypes.h>
 #include <sys/time.h>
 
 namespace utils {
 
 // Don't convert negative Timer to timeval.
 class Timer {
  public:
   Timer() : m_time(0) {}
   Timer(int64_t usec) : m_time(usec) {}
   Timer(timeval tv) : m_time((int64_t)(uint32_t)tv.tv_sec * 1000000 + (int64_t)(uint32_t)tv.tv_usec % 1000000) {}
 
-  int64_t   usec() const                  { return m_time; }
+  int64_t   usec() const                   { return m_time; }
+  timeval   tval() const                   { return (timeval) { m_time / 1000000, m_time % 1000000}; }
 
-  timeval tval() const                    { return (timeval) { m_time / 1000000, m_time % 1000000}; }
-
-  Timer operator - (const Timer& t) const { return Timer(m_time - t.m_time); }
-  Timer operator + (const Timer& t) const { return Timer(m_time + t.m_time); }
-
-  Timer operator -= (int64_t t)           { m_time -= t; return *this; }
-  Timer operator -= (const Timer& t)      { m_time -= t.m_time; return *this; }
-
-  Timer operator += (int64_t t)           { m_time += t; return *this; }
-  Timer operator += (const Timer& t)      { m_time += t.m_time; return *this; }
+  Timer     round_seconds() const          { return (m_time / 1000000) * 1000000; }
 
   static Timer current() {
     timeval t;
     gettimeofday(&t, 0);
 
     return Timer(t);
@@ -35,21 +28,33 @@
 
   // Cached time, updated in the beginning of torrent::work call.
   // Don't use outside socket_base read/write/except or Service::service.
   
   // TODO: Find out if it's worth it. The kernel is supposed to cache the
   // time. Though system calls would be more expensive than we can afford.
-  static Timer cache()                    { return Timer(m_cache); }
+  static Timer cache()                     { return Timer(m_cache); }
+
+  static Timer min()                       { return 0; }
+  static Timer max()                       { return (int64_t)std::numeric_limits<time_t>::max() * 1000000; }
+
+  static void  update()                    { m_cache = Timer::current().usec(); }
+
+  Timer operator - (const Timer& t) const  { return Timer(m_time - t.m_time); }
+  Timer operator + (const Timer& t) const  { return Timer(m_time + t.m_time); }
+
+  Timer operator -= (int64_t t)            { m_time -= t; return *this; }
+  Timer operator -= (const Timer& t)       { m_time -= t.m_time; return *this; }
 
-  static void update()                    { m_cache = Timer::current().usec(); }
+  Timer operator += (int64_t t)            { m_time += t; return *this; }
+  Timer operator += (const Timer& t)       { m_time += t.m_time; return *this; }
 
-  bool operator <  (const Timer& t) const { return m_time < t.m_time; }
-  bool operator >  (const Timer& t) const { return m_time > t.m_time; }
-  bool operator <= (const Timer& t) const { return m_time <= t.m_time; }
-  bool operator >= (const Timer& t) const { return m_time >= t.m_time; }
-  bool operator == (const Timer& t) const { return m_time == t.m_time; }
+  bool  operator <  (const Timer& t) const { return m_time < t.m_time; }
+  bool  operator >  (const Timer& t) const { return m_time > t.m_time; }
+  bool  operator <= (const Timer& t) const { return m_time <= t.m_time; }
+  bool  operator >= (const Timer& t) const { return m_time >= t.m_time; }
+  bool  operator == (const Timer& t) const { return m_time == t.m_time; }
 
  private:
   int64_t m_time;
 
   // Instantiated in torrent.cc
   static int64_t m_cache;
diff -BEr -U 6 /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/TODO /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/TODO
--- /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.0/TODO	2005-02-26 04:23:11.000000000 +0800
+++ /usr/info/code/cpp/LogMonitor/LogMonitor/second/download/rtorrent/repos/rtorrent-0.1.1/TODO	2005-03-08 02:49:11.000000000 +0800
@@ -3,10 +3,10 @@
 
 Polling during last phase of shutdown should be very quick, don't use
 normal timeout.
 
 Make clear distinction of upload/download throttle.
 
-"Caught exception: "Tried to add an existing DownloadMain to DownloadManager""
-Properly handle duplicate torrents. 
+Consider basing WindowPeer* on a common base class.
 
-Add log message for failed http requests.
+Some kind of indication that a tracker request was tried, but won't be
+allowed since the tracker set a min interval.
\ No newline at end of file
